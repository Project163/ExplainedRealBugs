diff --git a/CHANGES.txt b/CHANGES.txt
index df267e5693..f4ea89cf1b 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -22,8 +22,6 @@ Trunk (unreleased changes)
 
   BUG FIXES
 
-    HIVE-342. Fix TestMTQueries. (Prasad Chakka via zshao)
-
     HIVE-349. Fix TestCliDriver when there are test cases with no tasks.
     (Suresh Antony via zshao)
 
@@ -81,6 +79,8 @@ Trunk (unreleased changes)
     HIVE-342. Fix TestMTQueries
     (Prasad Chakka via namit)
 
+    HIVE-318. Fix union all queries. (Namit Jain via zshao)
+
 Release 0.2.0 - Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java
index 28b1f13522..304944d0b3 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java
@@ -49,6 +49,13 @@ public abstract class Operator <T extends Serializable> implements Serializable,
   protected List<Operator<? extends Serializable>> parentOperators;
   private static int seqId;
 
+  // It can be opimized later so that an operator operator (init/close) is performed
+  // only after that operation has been performed on all the parents. This will require
+  // initializing the whole tree in all the mappers (which might be required for mappers
+  // spanning multiple files anyway, in future)
+  public static enum State { UNINIT, INIT, CLOSE };
+  transient private State state = State.UNINIT;
+
   static {
     seqId = 0;
   }
@@ -213,6 +220,11 @@ public Map<Enum<?>, Long> getStats() {
   }
 
   public void initialize (Configuration hconf, Reporter reporter) throws HiveException {
+    if (state == state.INIT) {
+      LOG.info("Already Initialized");
+      return;
+    }
+
     LOG.info("Initializing Self");
     this.reporter = reporter;
     
@@ -223,6 +235,9 @@ public void initialize (Configuration hconf, Reporter reporter) throws HiveExcep
     for(Operator<? extends Serializable> op: childOperators) {
       op.initialize(hconf, reporter);
     }    
+
+    state = State.INIT;
+
     LOG.info("Initialization Done");
   }
 
@@ -258,18 +273,23 @@ public void endGroup() throws HiveException
   }
 
   public void close(boolean abort) throws HiveException {
-      try {
-        logStats();
-        if(childOperators == null)
-          return;
-
-        for(Operator<? extends Serializable> op: childOperators) {
-          op.close(abort);
-        }
-      } catch (HiveException e) {
-        e.printStackTrace();
-        throw e;
+    if (state == state.CLOSE) 
+      return;
+
+    try {
+      logStats();
+      if(childOperators == null)
+        return;
+
+      for(Operator<? extends Serializable> op: childOperators) {
+        op.close(abort);
       }
+
+      state = State.CLOSE;
+    } catch (HiveException e) {
+      e.printStackTrace();
+      throw e;
+    }
   }
 
   /**
@@ -319,7 +339,6 @@ public void resetStats() {
     }
   }
 
-
   public static interface OperatorFunc {
     public void func(Operator<? extends Serializable> op);
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java
index c7794288d3..8b15f0f31b 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java
@@ -50,6 +50,7 @@ public opTuple(Class<T> descClass, Class<? extends Operator<T>> opClass) {
     opvec.add(new opTuple<joinDesc> (joinDesc.class, JoinOperator.class));
     opvec.add(new opTuple<limitDesc> (limitDesc.class, LimitOperator.class));
     opvec.add(new opTuple<tableScanDesc> (tableScanDesc.class, TableScanOperator.class));
+    opvec.add(new opTuple<unionDesc> (unionDesc.class, UnionOperator.class));
   }
               
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/UnionOperator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/UnionOperator.java
new file mode 100644
index 0000000000..262337b5a9
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/UnionOperator.java
@@ -0,0 +1,49 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.io.*;
+
+import org.apache.hadoop.hive.ql.metadata.HiveException;
+import org.apache.hadoop.hive.ql.plan.unionDesc;
+import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;
+import org.apache.hadoop.mapred.Reporter;
+import org.apache.hadoop.conf.Configuration;
+
+/**
+ * Union Operator
+ * Just forwards. Doesn't do anything itself.
+ **/
+public class UnionOperator extends  Operator<unionDesc>  implements Serializable {
+  private static final long serialVersionUID = 1L;
+
+  @Override
+  public void process(Object row, ObjectInspector rowInspector)
+      throws HiveException {
+    forward(row, rowInspector);    
+  }
+
+  /**
+   * @return the name of the operator
+   */
+  @Override
+  public String getName() {
+    return new String("UNION");
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java
index b8a73e0ad2..fd592f54db 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java
@@ -77,7 +77,7 @@ public Object dispatch(Node nd, Stack<Node> ndStack, Object... nodeOutputs)
     // Do nothing in case proc is null
     if (proc != null) {
       // Call the process function
-      return proc.process(nd, procCtx, nodeOutputs);
+      return proc.process(nd, ndStack, procCtx, nodeOutputs);
     }
     else
       return null;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessor.java
index febb81846a..70200e5a3b 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessor.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessor.java
@@ -18,6 +18,8 @@
 package org.apache.hadoop.hive.ql.lib;
 
 
+import java.util.Stack;
+
 import org.apache.hadoop.hive.ql.parse.SemanticException;
 
 /**
@@ -34,6 +36,6 @@ public interface NodeProcessor {
    * @return Object to be returned by the process call
    * @throws SemanticException
    */
-  public Object process(Node nd, NodeProcessorCtx procCtx, Object... nodeOutputs) 
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx, Object... nodeOutputs) 
     throws SemanticException;
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/PreOrderWalker.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/PreOrderWalker.java
new file mode 100644
index 0000000000..8623af745a
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/PreOrderWalker.java
@@ -0,0 +1,68 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.lib;
+
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Set;
+import java.util.Stack;
+import java.lang.Object;
+
+import org.apache.hadoop.hive.ql.parse.SemanticException;
+
+/**
+ * base class for operator graph walker
+ * this class takes list of starting ops and walks them one by one.
+ */
+public class PreOrderWalker extends DefaultGraphWalker {
+
+  /* 
+   * Since the operator tree is a DAG, nodes with mutliple parents will be visited more than once.
+   * This can be made configurable.
+   */
+
+  /**
+   * Constructor
+   * @param ctx graph of operators to walk
+   * @param disp dispatcher to call for each op encountered
+   */
+  public PreOrderWalker(Dispatcher disp) {
+    super(disp);
+  }
+
+  /**
+   * walk the current operator and its descendants
+   * @param nd current operator in the graph
+   * @throws SemanticException
+   */
+  public void walk(Node nd) throws SemanticException {
+    opStack.push(nd);
+    dispatch(nd, opStack);
+    
+    // move all the children to the front of queue
+    if (nd.getChildren() != null) 
+      for (Node n : nd.getChildren())
+        walk(n);
+
+    opStack.pop();
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
index 7b12dd80c3..40e6d6aef5 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
@@ -22,6 +22,7 @@
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
+import java.util.Stack;
 
 import org.apache.hadoop.hive.ql.exec.ColumnInfo;
 import org.apache.hadoop.hive.ql.exec.FileSinkOperator;
@@ -54,7 +55,7 @@ public class ColumnPrunerProcFactory {
    * Node Processor for Column Pruning on Filter Operators.
    */
   public static class ColumnPrunerFilterProc implements NodeProcessor {  
-    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       FilterOperator op = (FilterOperator)nd;
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       exprNodeDesc condn = op.getConf().getPredicate();
@@ -78,7 +79,7 @@ public static ColumnPrunerFilterProc getFilterProc() {
    * Node Processor for Column Pruning on Group By Operators.
    */
   public static class ColumnPrunerGroupByProc implements NodeProcessor {
-    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       GroupByOperator op = (GroupByOperator)nd;
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       List<String> colLists = new ArrayList<String>();
@@ -111,7 +112,7 @@ public static ColumnPrunerGroupByProc getGroupByProc() {
    * The Default Node Processor for Column Pruning.
    */
   public static class ColumnPrunerDefaultProc implements NodeProcessor {
-    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       cppCtx.getPrunedColLists().put((Operator<? extends Serializable>)nd, 
           cppCtx.genColLists((Operator<? extends Serializable>)nd));
@@ -132,7 +133,7 @@ public static ColumnPrunerDefaultProc getDefaultProc() {
    * The Node Processor for Column Pruning on Reduce Sink Operators.
    */
   public static class ColumnPrunerReduceSinkProc implements NodeProcessor {
-    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       ReduceSinkOperator op = (ReduceSinkOperator)nd;
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       HashMap<Operator<? extends Serializable>, OpParseContext> opToParseCtxMap = 
@@ -191,7 +192,7 @@ public static ColumnPrunerReduceSinkProc getReduceSinkProc() {
    * The Node Processor for Column Pruning on Select Operators.
    */
   public static class ColumnPrunerSelectProc implements NodeProcessor {
-    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       SelectOperator op = (SelectOperator)nd;
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       List<String> cols = new ArrayList<String>();
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java
index c54f80c565..2448b8d1f2 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java
@@ -20,10 +20,10 @@
 
 import java.util.List;
 import java.util.HashMap;
+import java.util.Stack;
 import java.io.Serializable;
 
 import org.apache.hadoop.hive.ql.exec.Operator;
-import org.apache.hadoop.hive.ql.exec.FileSinkOperator;
 import org.apache.hadoop.hive.ql.exec.Task;
 import org.apache.hadoop.hive.ql.plan.mapredWork;
 import org.apache.hadoop.hive.ql.lib.Node;
@@ -44,8 +44,7 @@ public GenMRFileSink1() {
    * @param nd the file sink operator encountered
    * @param opProcCtx context
    */
-  public Object process(Node nd, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
-    FileSinkOperator op = (FileSinkOperator)nd;
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
     GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
     boolean ret = false;
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java
index e9a77d828f..6c9c3d86de 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java
@@ -20,6 +20,7 @@
 
 import java.io.Serializable;
 import java.util.Map;
+import java.util.Stack;
 
 import org.apache.hadoop.hive.ql.exec.Operator;
 import org.apache.hadoop.hive.ql.parse.SemanticException;
@@ -41,7 +42,7 @@ public GenMROperator() {
    * @param nd the reduce sink operator encountered
    * @param procCtx context
    */
-  public Object process(Node nd, NodeProcessorCtx procCtx, Object... nodeOutputs) throws SemanticException {
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx, Object... nodeOutputs) throws SemanticException {
     GenMRProcContext ctx = (GenMRProcContext)procCtx;
 
     Map<Operator<? extends Serializable>, GenMapRedCtx> mapCurrCtx = ctx.getMapCurrCtx();
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
index dfc723afd4..4e30b1cfa2 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
@@ -22,34 +22,13 @@
 import java.util.ArrayList;
 import java.util.Map;
 import java.util.HashMap;
-import java.util.LinkedHashMap;
-import java.util.Set;
-import java.util.Stack;
 import java.io.Serializable;
-import java.io.File;
-
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
 
 import org.apache.hadoop.hive.ql.exec.Operator;
-import org.apache.hadoop.hive.ql.exec.ReduceSinkOperator;
-import org.apache.hadoop.hive.ql.exec.FileSinkOperator;
-import org.apache.hadoop.hive.ql.exec.TableScanOperator;
-import org.apache.hadoop.hive.ql.exec.JoinOperator;
+import org.apache.hadoop.hive.ql.exec.UnionOperator;
 import org.apache.hadoop.hive.ql.exec.Task;
-import org.apache.hadoop.hive.ql.exec.TaskFactory;
-import org.apache.hadoop.hive.ql.exec.OperatorFactory;
-import org.apache.hadoop.hive.ql.plan.mapredWork;
-import org.apache.hadoop.hive.ql.plan.reduceSinkDesc;
-import org.apache.hadoop.hive.ql.plan.tableDesc;
-import org.apache.hadoop.hive.ql.plan.partitionDesc;
-import org.apache.hadoop.hive.ql.plan.fileSinkDesc;
-import org.apache.hadoop.hive.ql.plan.PlanUtils;
 import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
-import org.apache.hadoop.hive.ql.metadata.*;
 import org.apache.hadoop.hive.ql.parse.ParseContext;
-import org.apache.hadoop.hive.ql.exec.Utilities;
-import org.apache.hadoop.fs.Path;
 
 /**
  * Processor Context for creating map reduce task. Walk the tree in a DFS manner and process the nodes. Some state is 
@@ -99,8 +78,9 @@ public String getCurrAliasId() {
       return currAliasId;
     }
   }
-  
+
   private HashMap<Operator<? extends Serializable>, Task<? extends Serializable>> opTaskMap;
+  private HashMap<UnionOperator, Task<? extends Serializable>>   unionTaskMap;
   private List<Operator<? extends Serializable>> seenOps;
 
   private ParseContext                          parseCtx;
@@ -151,6 +131,7 @@ public GenMRProcContext (
     currAliasId     = null;
     rootOps         = new ArrayList<Operator<? extends Serializable>>();
     rootOps.addAll(parseCtx.getTopOps().values());
+    unionTaskMap = new HashMap<UnionOperator, Task<? extends Serializable>>();
   }
 
   /**
@@ -334,4 +315,12 @@ public String  getCurrAliasId() {
   public void setCurrAliasId(String currAliasId) {
     this.currAliasId = currAliasId;
   }
+
+  public Task<? extends Serializable> getUnionTask(UnionOperator op) {
+    return unionTaskMap.get(op);
+  }
+
+  public void setUnionTask(UnionOperator op, Task<? extends Serializable> uTask) {
+    unionTaskMap.put(op, uTask);
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java
index 0a4d059a54..21a126e987 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java
@@ -20,6 +20,7 @@
 
 import java.util.Map;
 import java.util.HashMap;
+import java.util.Stack;
 import java.io.Serializable;
 
 import org.apache.hadoop.hive.ql.exec.Operator;
@@ -45,7 +46,7 @@ public GenMRRedSink1() {
    * @param nd the reduce sink operator encountered
    * @param opProcCtx context
    */
-  public Object process(Node nd, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
     ReduceSinkOperator op = (ReduceSinkOperator)nd;
     GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java
index 9001e64ff4..a770dbb214 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java
@@ -20,6 +20,7 @@
 
 import java.io.Serializable;
 import java.util.Map;
+import java.util.Stack;
 
 import org.apache.hadoop.hive.ql.exec.Operator;
 import org.apache.hadoop.hive.ql.exec.ReduceSinkOperator;
@@ -43,7 +44,7 @@ public GenMRRedSink2() {
    * @param nd the reduce sink operator encountered
    * @param opProcCtx context
    */
-  public Object process(Node nd, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
     ReduceSinkOperator op = (ReduceSinkOperator)nd;
     GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
index 77778bec57..39edff91d8 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
@@ -20,6 +20,7 @@
 
 import java.io.Serializable;
 import java.util.Map;
+import java.util.Stack;
 
 import org.apache.hadoop.hive.ql.exec.Operator;
 import org.apache.hadoop.hive.ql.exec.TableScanOperator;
@@ -44,7 +45,7 @@ public GenMRTableScan1() {
    * @param nd the table sink operator encountered
    * @param opProcCtx context
    */
-  public Object process(Node nd, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
     TableScanOperator op = (TableScanOperator)nd;
     GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
     ParseContext parseCtx = ctx.getParseCtx();
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java
new file mode 100644
index 0000000000..d6129dd903
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java
@@ -0,0 +1,164 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.optimizer;
+
+import java.util.List;
+import java.util.ArrayList;
+import java.util.Stack;
+import java.io.Serializable;
+import java.io.File;
+import java.util.Map;
+
+import org.apache.hadoop.hive.ql.exec.Operator;
+import org.apache.hadoop.hive.ql.exec.UnionOperator;
+import org.apache.hadoop.hive.ql.exec.Task;
+import org.apache.hadoop.hive.ql.plan.mapredWork;
+import org.apache.hadoop.hive.ql.lib.Node;
+import org.apache.hadoop.hive.ql.lib.NodeProcessor;
+import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
+import org.apache.hadoop.hive.ql.parse.SemanticException;
+import org.apache.hadoop.hive.ql.parse.ParseContext;
+import org.apache.hadoop.hive.ql.plan.tableDesc;
+import org.apache.hadoop.hive.ql.plan.partitionDesc;
+import org.apache.hadoop.hive.ql.plan.PlanUtils;
+import org.apache.hadoop.fs.Path;
+import org.apache.hadoop.hive.ql.exec.TaskFactory;
+import org.apache.hadoop.hive.ql.plan.fileSinkDesc;
+import org.apache.hadoop.hive.conf.HiveConf;
+import org.apache.hadoop.hive.ql.exec.OperatorFactory;
+import org.apache.hadoop.hive.ql.optimizer.GenMRProcContext.GenMapRedCtx;
+import org.apache.hadoop.hive.ql.optimizer.unionproc.UnionProcFactory;
+import org.apache.hadoop.hive.ql.optimizer.unionproc.UnionProcContext.UnionParseContext;
+
+/**
+ * Processor for the rule - any operator tree followed by union
+ */
+public class GenMRUnion1 implements NodeProcessor {
+
+  public GenMRUnion1() {
+  }
+
+  /**
+   * Union Operator encountered .
+   * Currently, the algorithm is pretty simple:
+   *   If all the sub-queries are map-only, dont do anything.
+   *   Otherwise, insert a FileSink on top of all the sub-queries.
+   *
+   * This can be optimized later on.
+   * @param nd the file sink operator encountered
+   * @param opProcCtx context
+   */
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
+    UnionOperator union = (UnionOperator)nd;
+    GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
+    ParseContext parseCtx = ctx.getParseCtx();
+    UnionParseContext uPrsCtx = parseCtx.getUCtx().getUnionParseContext(union);
+    assert uPrsCtx != null;
+
+    // The plan needs to be broken only if one of the sub-queries involve a map-reduce job
+    int numInputs = uPrsCtx.getNumInputs();
+    boolean mapOnly = true;
+    int pos = 0;
+    for (pos = 0; pos < numInputs; pos++) {
+      if (!uPrsCtx.getMapOnlySubq(pos)) {
+        mapOnly = false;
+        break;
+      }
+    }
+
+    // Map-only subqueries can be optimized in future to not write to a file in future
+    Map<Operator<? extends Serializable>, GenMapRedCtx> mapCurrCtx = ctx.getMapCurrCtx();
+
+    if (mapOnly) {
+      mapCurrCtx.put((Operator<? extends Serializable>)nd, new GenMapRedCtx(ctx.getCurrTask(), ctx.getCurrTopOp(), ctx.getCurrAliasId()));
+      return null;
+    }
+
+    Task<? extends Serializable> currTask = ctx.getCurrTask();
+    pos = UnionProcFactory.getPositionParent(union, stack);
+
+    // is the current task a root task
+    if (uPrsCtx.getRootTask(pos) && (!ctx.getRootTasks().contains(currTask)))
+      ctx.getRootTasks().add(currTask);
+    
+    Task<? extends Serializable> uTask = ctx.getUnionTask(union);
+
+    pos = UnionProcFactory.getPositionParent(union, stack);
+    Operator<? extends Serializable> parent = union.getParentOperators().get(pos);   
+    mapredWork uPlan = null;
+
+    // union is encountered for the first time
+    if (uTask == null) {
+      uPlan = GenMapRedUtils.getMapRedWork();
+      uTask = TaskFactory.get(uPlan, parseCtx.getConf());
+      ctx.setUnionTask(union, uTask);
+    }
+    else 
+      uPlan = (mapredWork)uTask.getWork();
+    
+    tableDesc tt_desc = 
+      PlanUtils.getBinaryTableDesc(PlanUtils.getFieldSchemasFromRowSchema(parent.getSchema(), "temporarycol")); 
+    
+    // generate the temporary file
+    String scratchDir = ctx.getScratchDir();
+    int randomid = ctx.getRandomId();
+    int pathid   = ctx.getPathId();
+    
+    String taskTmpDir = (new Path(scratchDir + File.separator + randomid + '.' + pathid)).toString();
+    
+    pathid++;
+    ctx.setPathId(pathid);
+    
+    // Add the path to alias mapping
+    assert uPlan.getPathToAliases().get(taskTmpDir) == null;
+    uPlan.getPathToAliases().put(taskTmpDir, new ArrayList<String>());
+    uPlan.getPathToAliases().get(taskTmpDir).add(taskTmpDir);
+    uPlan.getPathToPartitionInfo().put(taskTmpDir, new partitionDesc(tt_desc, null));
+    uPlan.getAliasToWork().put(taskTmpDir, union);
+    GenMapRedUtils.setKeyAndValueDesc(uPlan, union);
+    
+    // Create a file sink operator for this file name
+    Operator<? extends Serializable> fs_op =
+      OperatorFactory.get
+      (new fileSinkDesc(taskTmpDir, tt_desc,
+                        parseCtx.getConf().getBoolVar(HiveConf.ConfVars.COMPRESSINTERMEDIATE)),
+       parent.getSchema());
+    
+    assert parent.getChildOperators().size() == 1;
+    parent.getChildOperators().set(0, fs_op);
+
+    List<Operator<? extends Serializable>> parentOpList = new ArrayList<Operator<? extends Serializable>>();
+    parentOpList.add(parent);
+    fs_op.setParentOperators(parentOpList);
+
+    currTask.addDependentTask(uTask);
+
+    // If it is map-only task, add the files to be processed
+    if (uPrsCtx.getMapOnlySubq(pos) && uPrsCtx.getRootTask(pos))
+      GenMapRedUtils.setTaskPlan(ctx.getCurrAliasId(), ctx.getCurrTopOp(), (mapredWork) currTask.getWork(), false, ctx);
+
+    ctx.setCurrTask(uTask);
+    ctx.setCurrAliasId(null);
+    ctx.setCurrTopOp(null);
+
+    mapCurrCtx.put((Operator<? extends Serializable>)nd, new GenMapRedCtx(ctx.getCurrTask(), null, null));
+    
+    return null;
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
index 9cfe80a29a..cc8fb110c1 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
@@ -233,7 +233,7 @@ public static void setTaskPlan(String alias_id, Operator<? extends Serializable>
    * @param plan     current plan
    * @param topOp    current top operator in the path
    */
-  private static void setKeyAndValueDesc(mapredWork plan, Operator<? extends Serializable> topOp) {
+  public static void setKeyAndValueDesc(mapredWork plan, Operator<? extends Serializable> topOp) {
     if (topOp instanceof ReduceSinkOperator) {
       ReduceSinkOperator rs = (ReduceSinkOperator)topOp;
       plan.setKeyDesc(rs.getConf().getKeySerializeInfo());
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java
index 9add7923cc..235017bf4b 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/Optimizer.java
@@ -23,6 +23,7 @@
 
 import org.apache.hadoop.hive.ql.parse.ParseContext;
 import org.apache.hadoop.hive.ql.parse.SemanticException;
+import org.apache.hadoop.hive.ql.optimizer.unionproc.UnionProcessor;
 
 /**
  * Implementation of the optimizer
@@ -43,6 +44,7 @@ public Optimizer() {
 	public void initialize() {
 		transformations = new ArrayList<Transform>();
 		transformations.add(new ColumnPruner());
+		transformations.add(new UnionProcessor());
 	}
 	
 	/**
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcContext.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcContext.java
new file mode 100644
index 0000000000..ad152e1f4a
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcContext.java
@@ -0,0 +1,80 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.optimizer.unionproc;
+
+import java.util.Map;
+import java.util.HashMap;
+
+import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
+import org.apache.hadoop.hive.ql.exec.UnionOperator;
+
+public class UnionProcContext implements NodeProcessorCtx {
+
+  public static class UnionParseContext {
+    transient private boolean[] mapOnlySubq;
+    transient private boolean[] rootTask;
+    
+    // currently, union has 2 inputs, but that should change - merging of unions should be allowed
+    transient private int numInputs = 2;
+
+    public UnionParseContext() {
+      mapOnlySubq = new boolean[numInputs];
+      rootTask    = new boolean[numInputs];
+    }
+    
+    public boolean getMapOnlySubq(int pos) {
+      return mapOnlySubq[pos];
+    }
+    
+    public void setMapOnlySubq(int pos, boolean mapOnlySubq) {
+      this.mapOnlySubq[pos] = mapOnlySubq;
+    }
+    
+    public boolean getRootTask(int pos) {
+      return rootTask[pos];
+    }
+    
+    public void setRootTask(int pos, boolean rootTask) {
+      this.rootTask[pos] = rootTask;
+    }
+    
+    public int getNumInputs() {
+      return numInputs;
+    }
+    
+    public void setNumInputs(int numInputs) {
+      this.numInputs = numInputs;
+    }
+  }
+   
+  private Map<UnionOperator, UnionParseContext> uCtxMap;
+
+  public UnionProcContext() {
+    uCtxMap = new HashMap<UnionOperator, UnionParseContext>();
+  }
+
+  public void setUnionParseContext(UnionOperator u, UnionParseContext uCtx) { 
+    uCtxMap.put(u, uCtx);
+  }
+
+  public UnionParseContext getUnionParseContext(UnionOperator u) { 
+    return uCtxMap.get(u);
+  }
+
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcFactory.java
new file mode 100644
index 0000000000..2cec6904e6
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcFactory.java
@@ -0,0 +1,148 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.hadoop.hive.ql.optimizer.unionproc;
+
+import java.io.Serializable;
+import java.util.List;
+import java.util.Stack;
+
+import org.apache.hadoop.hive.ql.lib.Node;
+import org.apache.hadoop.hive.ql.lib.NodeProcessor;
+import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
+import org.apache.hadoop.hive.ql.exec.Operator;
+import org.apache.hadoop.hive.ql.exec.UnionOperator;
+import org.apache.hadoop.hive.ql.parse.SemanticException;
+import org.apache.hadoop.hive.ql.optimizer.unionproc.UnionProcContext.UnionParseContext;
+
+/**
+ * Operator factory for union processing
+ */
+public class UnionProcFactory {
+
+  public static int getPositionParent(UnionOperator union, Stack<Node> stack) {
+    int pos = 0;
+    int size = stack.size();
+    assert size >= 2 && stack.get(size - 1) == union;
+    Operator<? extends Serializable> parent = (Operator<? extends Serializable>)stack.get(size - 2);
+    List<Operator<? extends Serializable>> parUnion = union.getParentOperators();
+    pos = parUnion.indexOf(parent);
+    assert pos < parUnion.size(); 
+    return pos;
+  }
+  
+  /**
+   * MapRed subquery followed by Union
+   */
+  public static class MapRedUnion implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+      UnionOperator union = (UnionOperator)nd;
+      UnionProcContext ctx = (UnionProcContext) procCtx;
+
+      // find the branch on which this processor was invoked
+      int pos = getPositionParent(union, stack);
+      UnionParseContext uCtx = ctx.getUnionParseContext(union);
+      if (uCtx == null)
+        uCtx = new UnionParseContext();
+
+      uCtx.setMapOnlySubq(pos, false);
+      uCtx.setRootTask(pos, false);
+      ctx.setUnionParseContext(union, uCtx); 
+      return null;
+    }
+  }
+
+  /**
+   * Map-only subquery followed by Union
+   */
+  public static class MapUnion implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+      UnionOperator union = (UnionOperator)nd;
+      UnionProcContext ctx = (UnionProcContext) procCtx;
+
+      // find the branch on which this processor was invoked
+      int pos = getPositionParent(union, stack);
+      UnionParseContext uCtx = ctx.getUnionParseContext(union);
+      if (uCtx == null)
+        uCtx = new UnionParseContext();
+
+      uCtx.setMapOnlySubq(pos, true);
+      uCtx.setRootTask(pos, true);
+      ctx.setUnionParseContext(union, uCtx); 
+      return null;
+    }
+  }
+
+  /**
+   * Union subquery followed by Union
+   */
+  public static class UnknownUnion implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+      UnionOperator union = (UnionOperator)nd;
+      UnionProcContext ctx = (UnionProcContext) procCtx;
+
+      // find the branch on which this processor was invoked
+      int pos = getPositionParent(union, stack);
+      UnionParseContext uCtx = ctx.getUnionParseContext(union);
+      if (uCtx == null)
+        uCtx = new UnionParseContext();
+
+      uCtx.setMapOnlySubq(pos, true);
+      uCtx.setRootTask(pos, false);
+      ctx.setUnionParseContext(union, uCtx); 
+      return null;
+    }
+  }
+  
+  /**
+   * Default processor
+   */
+  public static class NoUnion implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+      return null;
+    }
+  }
+
+  public static NodeProcessor getMapRedUnion() {
+    return new MapRedUnion();
+  }
+
+  public static NodeProcessor getMapUnion() {
+    return new MapUnion();
+  }
+
+  public static NodeProcessor getUnknownUnion() {
+    return new UnknownUnion();
+  }
+  
+  public static NodeProcessor getNoUnion() {
+    return new NoUnion();
+  }
+
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcessor.java
new file mode 100644
index 0000000000..e21ef63011
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcessor.java
@@ -0,0 +1,78 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.optimizer.unionproc;
+
+import java.util.ArrayList;
+import java.util.LinkedHashMap;
+import java.util.Map;
+import org.apache.hadoop.hive.ql.lib.PreOrderWalker;
+import org.apache.hadoop.hive.ql.lib.DefaultRuleDispatcher;
+import org.apache.hadoop.hive.ql.lib.Dispatcher;
+import org.apache.hadoop.hive.ql.lib.Node;
+import org.apache.hadoop.hive.ql.lib.GraphWalker;
+import org.apache.hadoop.hive.ql.lib.NodeProcessor;
+import org.apache.hadoop.hive.ql.lib.Rule;
+import org.apache.hadoop.hive.ql.lib.RuleRegExp;
+import org.apache.hadoop.hive.ql.parse.ParseContext;
+import org.apache.hadoop.hive.ql.parse.SemanticException;
+import org.apache.hadoop.hive.ql.optimizer.Transform;
+
+/**
+ * Implementation of the union processor. This can be enhanced later on.
+ * Currently, it does the following:
+ *   Identify if both the subqueries of UNION are map-only. 
+ *   Store that fact in the unionDesc/UnionOperator. 
+ *   If either of the sub-query involves a map-reduce job, a FS is introduced on top of the UNION.
+ *   This can be later optimized to clone all the operators above the UNION.
+
+ * The parse Context is not changed.
+ */
+public class UnionProcessor implements Transform {
+
+  /**
+   * empty constructor
+   */
+  public UnionProcessor() { }
+
+  /**
+   * Transform the query tree. For each union, store the fact whether both the 
+   * sub-queries are map-only
+   * @param pactx the current parse context
+   */
+  public ParseContext transform(ParseContext pCtx) throws SemanticException {
+    // create a walker which walks the tree in a DFS manner while maintaining the operator stack.
+    Map<Rule, NodeProcessor> opRules = new LinkedHashMap<Rule, NodeProcessor>();
+    opRules.put(new RuleRegExp(new String("R1"), "RS%.*UNION%"), UnionProcFactory.getMapRedUnion());
+    opRules.put(new RuleRegExp(new String("R2"), "UNION%.*UNION%"), UnionProcFactory.getUnknownUnion());
+    opRules.put(new RuleRegExp(new String("R3"), "TS%.*UNION%"), UnionProcFactory.getMapUnion());
+
+    // The dispatcher fires the processor for the matching rule and passes the context along
+    UnionProcContext uCtx = new UnionProcContext();
+    Dispatcher disp = new DefaultRuleDispatcher(UnionProcFactory.getNoUnion(), opRules, uCtx);
+    GraphWalker ogw = new PreOrderWalker(disp);
+   
+    // Create a list of topop nodes
+    ArrayList<Node> topNodes = new ArrayList<Node>();
+    topNodes.addAll(pCtx.getTopOps().values());
+    ogw.startWalking(topNodes, null);
+    pCtx.setUCtx(uCtx);
+    
+    return pCtx;
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java
index 706de8ec08..9e45ff3744 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/ParseContext.java
@@ -27,6 +27,7 @@
 import org.apache.hadoop.hive.ql.plan.loadTableDesc;
 import org.apache.hadoop.hive.ql.Context;
 import org.apache.hadoop.hive.conf.HiveConf;
+import org.apache.hadoop.hive.ql.optimizer.unionproc.UnionProcContext;
 
 /**
  * Parse Context: The current parse context. This is passed to the optimizer
@@ -52,7 +53,8 @@ public class ParseContext {
   private HiveConf conf;
   private HashMap<String, String> idToTableNameMap;
   private int destTableId;
-
+  private UnionProcContext uCtx;
+  
   /**
    * @param qb
    *          current QB
@@ -81,7 +83,7 @@ public ParseContext(HiveConf conf, QB qb, ASTNode ast,
       HashMap<String, Operator<? extends Serializable>> topSelOps,
       HashMap<Operator<? extends Serializable>, OpParseContext> opParseCtx,
       List<loadTableDesc> loadTableWork, List<loadFileDesc> loadFileWork,
-      Context ctx, HashMap<String, String> idToTableNameMap, int destTableId) {
+      Context ctx, HashMap<String, String> idToTableNameMap, int destTableId, UnionProcContext uCtx) {
     this.conf = conf;
     this.qb = qb;
     this.ast = ast;
@@ -95,6 +97,7 @@ public ParseContext(HiveConf conf, QB qb, ASTNode ast,
     this.ctx = ctx;
     this.idToTableNameMap = idToTableNameMap;
     this.destTableId = destTableId;
+    this.uCtx = uCtx;
   }
 
   /**
@@ -281,5 +284,12 @@ public void setDestTableId(int destTableId) {
     this.destTableId = destTableId;
   }
   
-  
+  public UnionProcContext getUCtx() {
+    return uCtx;
+  }
+
+  public void setUCtx(UnionProcContext uCtx) {
+    this.uCtx = uCtx;
+  }
+
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/PrintOpTreeProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/PrintOpTreeProcessor.java
index 8153d78ec9..3af27c17a8 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/PrintOpTreeProcessor.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/PrintOpTreeProcessor.java
@@ -21,6 +21,8 @@
 import java.io.PrintStream;
 import java.io.Serializable;
 import java.util.HashMap;
+import java.util.Stack;
+
 import org.apache.hadoop.hive.ql.exec.Operator;
 import org.apache.hadoop.hive.ql.lib.Node;
 import org.apache.hadoop.hive.ql.lib.NodeProcessor;
@@ -70,7 +72,7 @@ private String getChildren(Operator<? extends Serializable> op) {
     return ret.toString();
   }
   
-  public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
     Operator<? extends Serializable> op = (Operator<? extends Serializable>)nd;
     if (opMap.get(op) == null) {
       opMap.put(op, curNum++);
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
index 0485fb7781..b8f3c6eaab 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
@@ -49,9 +49,11 @@
 import org.apache.hadoop.hive.ql.optimizer.Optimizer;
 import org.apache.hadoop.hive.ql.optimizer.GenMRProcContext;
 import org.apache.hadoop.hive.ql.optimizer.GenMRProcContext.GenMapRedCtx;
+import org.apache.hadoop.hive.ql.optimizer.unionproc.UnionProcContext;
 import org.apache.hadoop.hive.ql.optimizer.GenMROperator;
 import org.apache.hadoop.hive.ql.optimizer.GenMRTableScan1;
 import org.apache.hadoop.hive.ql.optimizer.GenMRFileSink1;
+import org.apache.hadoop.hive.ql.optimizer.GenMRUnion1;
 import org.apache.hadoop.hive.ql.optimizer.GenMRRedSink1;
 import org.apache.hadoop.hive.ql.optimizer.GenMRRedSink2;
 import org.apache.hadoop.hive.ql.plan.*;
@@ -82,6 +84,7 @@ public class SemanticAnalyzer extends BaseSemanticAnalyzer {
   private QB qb;
   private ASTNode ast;
   private int destTableId;
+  private UnionProcContext uCtx;
 
   private static class Phase1Ctx {
     String dest;
@@ -100,8 +103,7 @@ public SemanticAnalyzer(HiveConf conf) throws SemanticException {
     this.loadFileWork = new ArrayList<loadFileDesc>();
     opParseCtx = new HashMap<Operator<? extends Serializable>, OpParseContext>();
     this.destTableId = 1;
- 
-    
+    this.uCtx = null;
   }
   
 
@@ -117,6 +119,7 @@ protected void reset() {
     this.idToTableNameMap.clear();
     qb = null;
     ast = null;
+    uCtx = null;
   }
 
   public void init(ParseContext pctx) {
@@ -130,11 +133,12 @@ public void init(ParseContext pctx) {
     ctx = pctx.getContext();
     destTableId = pctx.getDestTableId();
     idToTableNameMap = pctx.getIdToTableNameMap();
+    this.uCtx = pctx.getUCtx();
   }
 
   public ParseContext getParseContext() {
     return new ParseContext(conf, qb, ast, aliasToPruner, aliasToSamplePruner, topOps, 
-                            topSelOps, opParseCtx, loadTableWork, loadFileWork, ctx, idToTableNameMap, destTableId);
+                            topSelOps, opParseCtx, loadTableWork, loadFileWork, ctx, idToTableNameMap, destTableId, uCtx);
   }
   
   @SuppressWarnings("nls")
@@ -2885,6 +2889,8 @@ private Operator genUnionPlan(String unionalias, String leftalias,
       Operator leftOp, String rightalias, Operator rightOp)
       throws SemanticException {
 
+    // Currently, the unions are not merged - each union has only 2 parents. So, a n-way union will lead to (n-1) union operators.
+    // This can be easily merged into 1 union
     RowResolver leftRR = opParseCtx.get(leftOp).getRR();
     RowResolver rightRR = opParseCtx.get(rightOp).getRR();
     HashMap<String, ColumnInfo> leftmap = leftRR.getFieldMap(leftalias);
@@ -2920,18 +2926,23 @@ private Operator genUnionPlan(String unionalias, String leftalias,
       ColumnInfo lInfo = lEntry.getValue();
       unionoutRR.put(unionalias, field, lInfo);
     }
-    Operator<? extends Serializable> unionforward = OperatorFactory.get(forwardDesc.class,
-        new RowSchema(unionoutRR.getColumnInfos()));
+    Operator<? extends Serializable> unionforward = 
+      OperatorFactory.getAndMakeChild(new unionDesc(), new RowSchema(unionoutRR.getColumnInfos()));
+
     // set forward operator as child of each of leftOp and rightOp
     List<Operator<? extends Serializable>> child = new ArrayList<Operator<? extends Serializable>>();
     child.add(unionforward);
     rightOp.setChildOperators(child);
+
+    child = new ArrayList<Operator<? extends Serializable>>();
+    child.add(unionforward);
     leftOp.setChildOperators(child);
+
     List<Operator<? extends Serializable>> parent = new ArrayList<Operator<? extends Serializable>>();
     parent.add(leftOp);
     parent.add(rightOp);
     unionforward.setParentOperators(parent);
-
+    
     // create operator info list to return
     return putOpInsertMap(unionforward, unionoutRR);
   }
@@ -3286,13 +3297,14 @@ private void genMapRedTasks(QB qb) throws SemanticException {
         getParseContext(), mvTask, this.rootTasks, this.scratchDir, this.randomid, this.pathid,
         new HashMap<Operator<? extends Serializable>, GenMapRedCtx>());
 
-    // create a walker which walks the tree in a DFS manner while maintaining the operator stack. The dispatcher
-    // generates the plan from the operator tree
+    // create a walker which walks the tree in a DFS manner while maintaining the operator stack. 
+    // The dispatcher generates the plan from the operator tree
     Map<Rule, NodeProcessor> opRules = new LinkedHashMap<Rule, NodeProcessor>();
     opRules.put(new RuleRegExp(new String("R1"), "TS%"), new GenMRTableScan1());
     opRules.put(new RuleRegExp(new String("R2"), "TS%.*RS%"), new GenMRRedSink1());
     opRules.put(new RuleRegExp(new String("R3"), "RS%.*RS%"), new GenMRRedSink2());
     opRules.put(new RuleRegExp(new String("R4"), "FS%"), new GenMRFileSink1());
+    opRules.put(new RuleRegExp(new String("R4"), "UNION%"), new GenMRUnion1());
 
     // The dispatcher fires the processor corresponding to the closest matching rule and passes the context along
     Dispatcher disp = new DefaultRuleDispatcher(new GenMROperator(), opRules, procCtx);
@@ -3354,7 +3366,7 @@ public void analyzeInternal(ASTNode ast, Context ctx) throws SemanticException {
     
 
     ParseContext pCtx = new ParseContext(conf, qb, ast, aliasToPruner, aliasToSamplePruner, topOps, 
-    		                                 topSelOps, opParseCtx, loadTableWork, loadFileWork, ctx, idToTableNameMap, destTableId);
+    		                                 topSelOps, opParseCtx, loadTableWork, loadFileWork, ctx, idToTableNameMap, destTableId, uCtx);
   
     Optimizer optm = new Optimizer();
     optm.setPctx(pCtx);
@@ -3370,9 +3382,6 @@ public void analyzeInternal(ASTNode ast, Context ctx) throws SemanticException {
     // Do any sample pruning
     genSamplePruners(qb);
     LOG.info("Completed sample pruning");
-    
-    // TODO - this can be extended to create multiple
-    // map reduce plans later
 
     // At this point we have the complete operator tree
     // from which we want to find the reduce operator
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java
index 5b8d52263f..686dcacc76 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java
@@ -24,6 +24,7 @@
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
+import java.util.Stack;
 
 import org.apache.hadoop.hive.ql.exec.ColumnInfo;
 import org.apache.hadoop.hive.ql.exec.FunctionRegistry;
@@ -91,7 +92,7 @@ public static exprNodeDesc processGByExpr(Node nd, Object procCtx)
   public static class NullExprProcessor implements NodeProcessor {
 
     @Override
-    public Object process(Node nd, NodeProcessorCtx procCtx,
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
         Object... nodeOutputs) throws SemanticException {
 
       exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
@@ -118,7 +119,7 @@ public static NullExprProcessor getNullExprProcessor() {
   public static class NumExprProcessor implements NodeProcessor {
 
     @Override
-    public Object process(Node nd, NodeProcessorCtx procCtx,
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
         Object... nodeOutputs) throws SemanticException {
 
       exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
@@ -160,7 +161,7 @@ public static NumExprProcessor getNumExprProcessor() {
   public static class StrExprProcessor implements NodeProcessor {
 
     @Override
-    public Object process(Node nd, NodeProcessorCtx procCtx,
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
         Object... nodeOutputs) throws SemanticException {
 
       exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
@@ -202,7 +203,7 @@ public static StrExprProcessor getStrExprProcessor() {
   public static class BoolExprProcessor implements NodeProcessor {
 
     @Override
-    public Object process(Node nd, NodeProcessorCtx procCtx,
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
         Object... nodeOutputs) throws SemanticException {
 
       exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
@@ -242,7 +243,7 @@ public static BoolExprProcessor getBoolExprProcessor() {
   public static class ColumnExprProcessor implements NodeProcessor {
 
     @Override
-    public Object process(Node nd, NodeProcessorCtx procCtx,
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
         Object... nodeOutputs) throws SemanticException {
 
       exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
@@ -581,7 +582,7 @@ else if (myt.getCategory() == Category.MAP) {
     }
 
     @Override
-    public Object process(Node nd, NodeProcessorCtx procCtx,
+    public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
         Object... nodeOutputs) throws SemanticException {
 
       ASTNode expr = (ASTNode)nd;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/plan/unionDesc.java b/ql/src/java/org/apache/hadoop/hive/ql/plan/unionDesc.java
new file mode 100644
index 0000000000..b51b288ae8
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/plan/unionDesc.java
@@ -0,0 +1,33 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.plan;
+
+import java.io.Serializable;
+
+/**
+ * unionDesc is a empty class currently. 
+ * However, union has more than one input (as compared with forward), and therefore, we need a separate class.
+ **/
+@explain(displayName="Union")
+public class unionDesc implements Serializable {
+  private static final long serialVersionUID = 1L;
+
+  @SuppressWarnings("nls")
+  public unionDesc() { }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/tools/LineageInfo.java b/ql/src/java/org/apache/hadoop/hive/ql/tools/LineageInfo.java
index 73b7733827..c33f97a582 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/tools/LineageInfo.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/tools/LineageInfo.java
@@ -23,6 +23,7 @@
 import java.util.ArrayList;
 import java.util.LinkedHashMap;
 import java.util.Map;
+import java.util.Stack;
 import java.util.TreeSet;
 
 import org.apache.hadoop.hive.ql.lib.DefaultGraphWalker;
@@ -76,7 +77,7 @@ public TreeSet<String> getOutputTableList() {
   /**
    * Implements the process method for the NodeProcessor interface.
    */
-  public Object process(Node nd, NodeProcessorCtx procCtx, Object... nodeOutputs)
+  public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx, Object... nodeOutputs)
   throws SemanticException {
     ASTNode pt = (ASTNode)nd;
 
diff --git a/ql/src/test/queries/clientpositive/union.q b/ql/src/test/queries/clientpositive/union.q
index 8f95be9f37..91bbd1b07f 100644
--- a/ql/src/test/queries/clientpositive/union.q
+++ b/ql/src/test/queries/clientpositive/union.q
@@ -1,3 +1,5 @@
+-- union case: both subqueries are map jobs on same input, followed by filesink
+
 EXPLAIN
 FROM (
   FROM src select src.key, src.value WHERE src.key < 100
diff --git a/ql/src/test/queries/clientpositive/union10.q b/ql/src/test/queries/clientpositive/union10.q
new file mode 100644
index 0000000000..0498bc9eb6
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union10.q
@@ -0,0 +1,21 @@
+set hive.map.aggr = true;
+
+-- union case: all subqueries are a map-reduce jobs, 3 way union, same input for all sub-queries, followed by filesink
+
+explain 
+  select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, count(1) as value from src s1
+                                        UNION  ALL  
+                                            select 'tst2' as key, count(1) as value from src s2
+                                        UNION ALL
+                                            select 'tst3' as key, count(1) as value from src s3) unionsrc;
+
+
+
+  select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, count(1) as value from src s1
+                                        UNION  ALL  
+                                            select 'tst2' as key, count(1) as value from src s2
+                                        UNION ALL
+                                            select 'tst3' as key, count(1) as value from src s3) unionsrc;
+
+
+
diff --git a/ql/src/test/queries/clientpositive/union11.q b/ql/src/test/queries/clientpositive/union11.q
new file mode 100644
index 0000000000..77dc2efec5
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union11.q
@@ -0,0 +1,20 @@
+set hive.map.aggr = true;
+
+-- union case: all subqueries are a map-reduce jobs, 3 way union, same input for all sub-queries, followed by reducesink
+
+explain 
+  select unionsrc.key, count(1) FROM (select 'tst1' as key, count(1) as value from src s1
+                                        UNION  ALL  
+                                            select 'tst2' as key, count(1) as value from src s2
+                                        UNION ALL
+                                            select 'tst3' as key, count(1) as value from src s3) unionsrc group by unionsrc.key;
+
+
+  select unionsrc.key, count(1) FROM (select 'tst1' as key, count(1) as value from src s1
+                                        UNION  ALL  
+                                            select 'tst2' as key, count(1) as value from src s2
+                                        UNION ALL
+                                            select 'tst3' as key, count(1) as value from src s3) unionsrc group by unionsrc.key;
+
+
+
diff --git a/ql/src/test/queries/clientpositive/union12.q b/ql/src/test/queries/clientpositive/union12.q
new file mode 100644
index 0000000000..13296f2522
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union12.q
@@ -0,0 +1,21 @@
+set hive.map.aggr = true;
+
+-- union case: all subqueries are a map-reduce jobs, 3 way union, different inputs for all sub-queries, followed by filesink
+
+explain 
+  select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, count(1) as value from src s1
+                                        UNION  ALL  
+                                            select 'tst2' as key, count(1) as value from src1 s2
+                                        UNION ALL
+                                            select 'tst3' as key, count(1) as value from srcbucket s3) unionsrc;
+
+
+
+  select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, count(1) as value from src s1
+                                        UNION  ALL  
+                                            select 'tst2' as key, count(1) as value from src1 s2
+                                        UNION ALL
+                                            select 'tst3' as key, count(1) as value from srcbucket s3) unionsrc;
+
+
+
diff --git a/ql/src/test/queries/clientpositive/union13.q b/ql/src/test/queries/clientpositive/union13.q
new file mode 100644
index 0000000000..8bee1d7993
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union13.q
@@ -0,0 +1,8 @@
+-- union case: both subqueries are a map-only jobs, same input, followed by filesink
+
+explain 
+  select unionsrc.key, unionsrc.value FROM (select s1.key as key, s1.value as value from src s1 UNION  ALL  
+                                            select s2.key as key, s2.value as value from src s2) unionsrc;
+
+select unionsrc.key, unionsrc.value FROM (select s1.key as key, s1.value as value from src s1 UNION  ALL  
+                                          select s2.key as key, s2.value as value from src s2) unionsrc;
diff --git a/ql/src/test/queries/clientpositive/union2.q b/ql/src/test/queries/clientpositive/union2.q
index 857862fdaf..581cbebd86 100644
--- a/ql/src/test/queries/clientpositive/union2.q
+++ b/ql/src/test/queries/clientpositive/union2.q
@@ -1,3 +1,5 @@
+-- union case: both subqueries are map-reduce jobs on same input, followed by reduce sink
+
 explain 
   select count(1) FROM (select s1.key as key, s1.value as value from src s1 UNION  ALL  
                         select s2.key as key, s2.value as value from src s2) unionsrc;
diff --git a/ql/src/test/queries/clientpositive/union4.q b/ql/src/test/queries/clientpositive/union4.q
new file mode 100644
index 0000000000..2838904be7
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union4.q
@@ -0,0 +1,12 @@
+set hive.map.aggr = true;
+
+-- union case: both subqueries are map-reduce jobs on same input, followed by filesink
+
+explain 
+  select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, count(1) as value from src s1
+                                        UNION  ALL  
+                                            select 'tst2' as key, count(1) as value from src s2) unionsrc;
+
+select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, count(1) as value from src s1
+                                        UNION  ALL  
+                                          select 'tst2' as key, count(1) as value from src s2) unionsrc;
diff --git a/ql/src/test/queries/clientpositive/union5.q b/ql/src/test/queries/clientpositive/union5.q
new file mode 100644
index 0000000000..9844127e4a
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union5.q
@@ -0,0 +1,12 @@
+set hive.map.aggr = true;
+
+-- union case: both subqueries are map-reduce jobs on same input, followed by reduce sink
+
+explain 
+  select unionsrc.key, count(1) FROM (select 'tst1' as key, count(1) as value from src s1
+                                    UNION  ALL  
+                                      select 'tst2' as key, count(1) as value from src s2) unionsrc group by unionsrc.key;
+
+select unionsrc.key, count(1) FROM (select 'tst1' as key, count(1) as value from src s1
+                                  UNION  ALL  
+                                    select 'tst2' as key, count(1) as value from src s2) unionsrc group by unionsrc.key;
diff --git a/ql/src/test/queries/clientpositive/union6.q b/ql/src/test/queries/clientpositive/union6.q
new file mode 100644
index 0000000000..54f72415c5
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union6.q
@@ -0,0 +1,14 @@
+set hive.map.aggr = true;
+
+-- union case: 1 subquery is a map-reduce job, different inputs for sub-queries, followed by filesink
+
+explain 
+  select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
+                                        UNION  ALL  
+                                            select s2.key as key, s2.value as value from src1 s2) unionsrc;
+
+
+select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
+                                      UNION  ALL  
+                                          select s2.key as key, s2.value as value from src1 s2) unionsrc;
+
diff --git a/ql/src/test/queries/clientpositive/union7.q b/ql/src/test/queries/clientpositive/union7.q
new file mode 100644
index 0000000000..d66d5960bd
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union7.q
@@ -0,0 +1,14 @@
+set hive.map.aggr = true;
+
+-- union case: 1 subquery is a map-reduce job, different inputs for sub-queries, followed by reducesink
+
+explain 
+  select unionsrc.key, count(1) FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
+                                        UNION  ALL  
+                                            select s2.key as key, s2.value as value from src1 s2) unionsrc group by unionsrc.key;
+
+select unionsrc.key, count(1) FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
+                                      UNION  ALL  
+                                    select s2.key as key, s2.value as value from src1 s2) unionsrc group by unionsrc.key;
+
+
diff --git a/ql/src/test/queries/clientpositive/union8.q b/ql/src/test/queries/clientpositive/union8.q
new file mode 100644
index 0000000000..6d5bf673e0
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union8.q
@@ -0,0 +1,10 @@
+-- union case: all subqueries are a map-only jobs, 3 way union, same input for all sub-queries, followed by filesink
+
+explain 
+  select unionsrc.key, unionsrc.value FROM (select s1.key as key, s1.value as value from src s1 UNION  ALL  
+                                            select s2.key as key, s2.value as value from src s2 UNION  ALL  
+                                            select s3.key as key, s3.value as value from src s3) unionsrc;
+
+select unionsrc.key, unionsrc.value FROM (select s1.key as key, s1.value as value from src s1 UNION  ALL  
+                                          select s2.key as key, s2.value as value from src s2 UNION  ALL  
+                                          select s3.key as key, s3.value as value from src s3) unionsrc;
diff --git a/ql/src/test/queries/clientpositive/union9.q b/ql/src/test/queries/clientpositive/union9.q
new file mode 100644
index 0000000000..7d4c11b252
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union9.q
@@ -0,0 +1,10 @@
+-- union case: all subqueries are a map-only jobs, 3 way union, same input for all sub-queries, followed by reducesink
+
+explain 
+  select count(1) FROM (select s1.key as key, s1.value as value from src s1 UNION  ALL  
+                        select s2.key as key, s2.value as value from src s2 UNION ALL
+                        select s3.key as key, s3.value as value from src s3) unionsrc;
+
+  select count(1) FROM (select s1.key as key, s1.value as value from src s1 UNION  ALL  
+                        select s2.key as key, s2.value as value from src s2 UNION ALL
+                        select s3.key as key, s3.value as value from src s3) unionsrc;
diff --git a/ql/src/test/results/clientpositive/cluster.q.out b/ql/src/test/results/clientpositive/cluster.q.out
index 11c64c1e01..62d0e53adf 100644
--- a/ql/src/test/results/clientpositive/cluster.q.out
+++ b/ql/src/test/results/clientpositive/cluster.q.out
@@ -486,7 +486,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/suresh/hive_external/build/ql/tmp/567040252/108440248.10002 
+        /data/users/njain/hive2/hive/build/ql/tmp/596968299/28368921.10002 
           Reduce Output Operator
             key expressions:
                   expr: 1
@@ -592,7 +592,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/suresh/hive_external/build/ql/tmp/124737534/554653212.10002 
+        /data/users/njain/hive2/hive/build/ql/tmp/12416576/480017656.10002 
           Reduce Output Operator
             key expressions:
                   expr: 1
@@ -700,7 +700,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/suresh/hive_external/build/ql/tmp/247667797/531125383.10002 
+        /data/users/njain/hive2/hive/build/ql/tmp/15199144/1962713711.10002 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -808,7 +808,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/suresh/hive_external/build/ql/tmp/94432770/53306218.10002 
+        /data/users/njain/hive2/hive/build/ql/tmp/103416384/41425981.10002 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -862,6 +862,7 @@ STAGE PLANS:
                       type: string
                       expr: value
                       type: string
+                Union
                   Select Operator
                     expressions:
                           expr: 0
@@ -893,6 +894,7 @@ STAGE PLANS:
                       type: string
                       expr: value
                       type: string
+                Union
                   Select Operator
                     expressions:
                           expr: 0
diff --git a/ql/src/test/results/clientpositive/input_part7.q.out b/ql/src/test/results/clientpositive/input_part7.q.out
index 4e70e076e0..81d8da250b 100644
--- a/ql/src/test/results/clientpositive/input_part7.q.out
+++ b/ql/src/test/results/clientpositive/input_part7.q.out
@@ -24,6 +24,7 @@ STAGE PLANS:
                       type: string
                       expr: hr
                       type: string
+                Union
                   Select Operator
                     expressions:
                           expr: 0
@@ -64,6 +65,7 @@ STAGE PLANS:
                       type: string
                       expr: hr
                       type: string
+                Union
                   Select Operator
                     expressions:
                           expr: 0
@@ -91,10 +93,10 @@ STAGE PLANS:
                             type: string
       Needs Tagging: false
       Path -> Alias:
-        file:/data/users/suresh/hive_external/build/ql/test/data/warehouse/srcpart/hr=11/ds=2008-04-08 
-        file:/data/users/suresh/hive_external/build/ql/test/data/warehouse/srcpart/hr=12/ds=2008-04-08 
+        file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/srcpart/hr=11/ds=2008-04-08 
+        file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/srcpart/hr=12/ds=2008-04-08 
       Path -> Partition:
-        file:/data/users/suresh/hive_external/build/ql/test/data/warehouse/srcpart/hr=11/ds=2008-04-08 
+        file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/srcpart/hr=11/ds=2008-04-08 
           Partition
             partition values:
               ds 2008-04-08
@@ -113,10 +115,10 @@ STAGE PLANS:
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                location file:/data/users/suresh/hive_external/build/ql/test/data/warehouse/srcpart
+                location file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/srcpart
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: srcpart
-        file:/data/users/suresh/hive_external/build/ql/test/data/warehouse/srcpart/hr=12/ds=2008-04-08 
+        file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/srcpart/hr=12/ds=2008-04-08 
           Partition
             partition values:
               ds 2008-04-08
@@ -135,7 +137,7 @@ STAGE PLANS:
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                location file:/data/users/suresh/hive_external/build/ql/test/data/warehouse/srcpart
+                location file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/srcpart
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: srcpart
       Reduce Operator Tree:
@@ -143,7 +145,7 @@ STAGE PLANS:
           File Output Operator
             compressed: false
             GlobalTableId: 0
-            directory: /data/users/suresh/hive_external/ql/../build/ql/tmp/1565954774/21907520.10001.insclause-0
+            directory: /data/users/njain/hive2/hive/ql/../build/ql/tmp/193440808/125134681.10001.insclause-0
             table:
                 input format: org.apache.hadoop.mapred.TextInputFormat
                 output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
diff --git a/ql/src/test/results/clientpositive/union.q.out b/ql/src/test/results/clientpositive/union.q.out
index aee53904c5..3ed4633a9d 100644
--- a/ql/src/test/results/clientpositive/union.q.out
+++ b/ql/src/test/results/clientpositive/union.q.out
@@ -20,6 +20,7 @@ STAGE PLANS:
                       type: string
                       expr: value
                       type: string
+                Union
                   Select Operator
                     expressions:
                           expr: 0
@@ -43,6 +44,7 @@ STAGE PLANS:
                       type: string
                       expr: value
                       type: string
+                Union
                   Select Operator
                     expressions:
                           expr: 0
diff --git a/ql/src/test/results/clientpositive/union10.q.out b/ql/src/test/results/clientpositive/union10.q.out
new file mode 100644
index 0000000000..c50a4f972b
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union10.q.out
@@ -0,0 +1,179 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst2' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src s3)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst3' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_COLREF unionsrc value)))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-5
+  Stage-3 depends on stages: Stage-2, Stage-4
+  Stage-4 is a root stage
+  Stage-3 depends on stages: Stage-2, Stage-4
+  Stage-5 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-5
+  Stage-3 depends on stages: Stage-2, Stage-4
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2-subquery1:unionsrc-subquery2-subquery1:s2 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst2'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1262385163/235073004.10005 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+        /data/users/njain/hive1/hive/build/ql/tmp/1262385163/235073004.10002 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1262385163/235073004.10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: string
+                    expr: 1
+                    type: bigint
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        /data/users/njain/hive1/hive/build/ql/tmp/1262385163/235073004.10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: string
+                    expr: 1
+                    type: bigint
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst1'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-5
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2-subquery2:unionsrc-subquery2-subquery2:s3 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst3'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+tst2	500
+tst3	500
+tst1	500
diff --git a/ql/src/test/results/clientpositive/union11.q.out b/ql/src/test/results/clientpositive/union11.q.out
new file mode 100644
index 0000000000..4a44894ed8
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union11.q.out
@@ -0,0 +1,223 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst2' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src s3)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst3' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_FUNCTION count 1))) (TOK_GROUPBY (TOK_COLREF unionsrc key))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-6
+  Stage-3 depends on stages: Stage-2, Stage-5
+  Stage-4 depends on stages: Stage-3
+  Stage-5 is a root stage
+  Stage-3 depends on stages: Stage-2, Stage-5
+  Stage-4 depends on stages: Stage-3
+  Stage-6 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-6
+  Stage-3 depends on stages: Stage-2, Stage-5
+  Stage-4 depends on stages: Stage-3
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2-subquery1:unionsrc-subquery2-subquery1:s2 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst2'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1314958843/118504340.10006 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+        /data/users/njain/hive1/hive/build/ql/tmp/1314958843/118504340.10002 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1314958843/118504340.10005 
+          Union
+            Group By Operator
+              aggregations:
+                    expr: count(1)
+              keys:
+                    expr: 0
+                    type: string
+              mode: hash
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
+        /data/users/njain/hive1/hive/build/ql/tmp/1314958843/118504340.10003 
+          Union
+            Group By Operator
+              aggregations:
+                    expr: count(1)
+              keys:
+                    expr: 0
+                    type: string
+              mode: hash
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1314958843/118504340.10004 
+          Reduce Output Operator
+            key expressions:
+                  expr: 0
+                  type: string
+            sort order: +
+            Map-reduce partition columns:
+                  expr: 0
+                  type: string
+            tag: -1
+            value expressions:
+                  expr: 1
+                  type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          keys:
+                expr: KEY.0
+                type: string
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 0
+                  type: string
+                  expr: 1
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.TextInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-5
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst1'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-6
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2-subquery2:unionsrc-subquery2-subquery2:s3 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst3'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+tst1	1
+tst2	1
+tst3	1
diff --git a/ql/src/test/results/clientpositive/union12.q.out b/ql/src/test/results/clientpositive/union12.q.out
new file mode 100644
index 0000000000..a79b26c168
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union12.q.out
@@ -0,0 +1,179 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src1 s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst2' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF srcbucket s3)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst3' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_COLREF unionsrc value)))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-5
+  Stage-3 depends on stages: Stage-2, Stage-4
+  Stage-4 is a root stage
+  Stage-3 depends on stages: Stage-2, Stage-4
+  Stage-5 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-5
+  Stage-3 depends on stages: Stage-2, Stage-4
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2-subquery1:unionsrc-subquery2-subquery1:s2 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst2'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/63508421/145942527.10002 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+        /data/users/njain/hive1/hive/build/ql/tmp/63508421/145942527.10005 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/63508421/145942527.10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: string
+                    expr: 1
+                    type: bigint
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        /data/users/njain/hive1/hive/build/ql/tmp/63508421/145942527.10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: string
+                    expr: 1
+                    type: bigint
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst1'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-5
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2-subquery2:unionsrc-subquery2-subquery2:s3 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst3'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+tst2	25
+tst3	1000
+tst1	500
diff --git a/ql/src/test/results/clientpositive/union13.q.out b/ql/src/test/results/clientpositive/union13.q.out
new file mode 100644
index 0000000000..cbe3feb303
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union13.q.out
@@ -0,0 +1,1057 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s1 key) key) (TOK_SELEXPR (TOK_COLREF s1 value) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s2 key) key) (TOK_SELEXPR (TOK_COLREF s2 value) value))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_COLREF unionsrc value)))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              Union
+                Select Operator
+                  expressions:
+                        expr: 0
+                        type: string
+                        expr: 1
+                        type: string
+                  File Output Operator
+                    compressed: false
+                    GlobalTableId: 0
+                    table:
+                        input format: org.apache.hadoop.mapred.TextInputFormat
+                        output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        null-subquery2:unionsrc-subquery2:s2 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              Union
+                Select Operator
+                  expressions:
+                        expr: 0
+                        type: string
+                        expr: 1
+                        type: string
+                  File Output Operator
+                    compressed: false
+                    GlobalTableId: 0
+                    table:
+                        input format: org.apache.hadoop.mapred.TextInputFormat
+                        output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+238	val_238
+238	val_238
+86	val_86
+86	val_86
+311	val_311
+311	val_311
+27	val_27
+27	val_27
+165	val_165
+165	val_165
+409	val_409
+409	val_409
+255	val_255
+255	val_255
+278	val_278
+278	val_278
+98	val_98
+98	val_98
+484	val_484
+484	val_484
+265	val_265
+265	val_265
+193	val_193
+193	val_193
+401	val_401
+401	val_401
+150	val_150
+150	val_150
+273	val_273
+273	val_273
+224	val_224
+224	val_224
+369	val_369
+369	val_369
+66	val_66
+66	val_66
+128	val_128
+128	val_128
+213	val_213
+213	val_213
+146	val_146
+146	val_146
+406	val_406
+406	val_406
+429	val_429
+429	val_429
+374	val_374
+374	val_374
+152	val_152
+152	val_152
+469	val_469
+469	val_469
+145	val_145
+145	val_145
+495	val_495
+495	val_495
+37	val_37
+37	val_37
+327	val_327
+327	val_327
+281	val_281
+281	val_281
+277	val_277
+277	val_277
+209	val_209
+209	val_209
+15	val_15
+15	val_15
+82	val_82
+82	val_82
+403	val_403
+403	val_403
+166	val_166
+166	val_166
+417	val_417
+417	val_417
+430	val_430
+430	val_430
+252	val_252
+252	val_252
+292	val_292
+292	val_292
+219	val_219
+219	val_219
+287	val_287
+287	val_287
+153	val_153
+153	val_153
+193	val_193
+193	val_193
+338	val_338
+338	val_338
+446	val_446
+446	val_446
+459	val_459
+459	val_459
+394	val_394
+394	val_394
+237	val_237
+237	val_237
+482	val_482
+482	val_482
+174	val_174
+174	val_174
+413	val_413
+413	val_413
+494	val_494
+494	val_494
+207	val_207
+207	val_207
+199	val_199
+199	val_199
+466	val_466
+466	val_466
+208	val_208
+208	val_208
+174	val_174
+174	val_174
+399	val_399
+399	val_399
+396	val_396
+396	val_396
+247	val_247
+247	val_247
+417	val_417
+417	val_417
+489	val_489
+489	val_489
+162	val_162
+162	val_162
+377	val_377
+377	val_377
+397	val_397
+397	val_397
+309	val_309
+309	val_309
+365	val_365
+365	val_365
+266	val_266
+266	val_266
+439	val_439
+439	val_439
+342	val_342
+342	val_342
+367	val_367
+367	val_367
+325	val_325
+325	val_325
+167	val_167
+167	val_167
+195	val_195
+195	val_195
+475	val_475
+475	val_475
+17	val_17
+17	val_17
+113	val_113
+113	val_113
+155	val_155
+155	val_155
+203	val_203
+203	val_203
+339	val_339
+339	val_339
+0	val_0
+0	val_0
+455	val_455
+455	val_455
+128	val_128
+128	val_128
+311	val_311
+311	val_311
+316	val_316
+316	val_316
+57	val_57
+57	val_57
+302	val_302
+302	val_302
+205	val_205
+205	val_205
+149	val_149
+149	val_149
+438	val_438
+438	val_438
+345	val_345
+345	val_345
+129	val_129
+129	val_129
+170	val_170
+170	val_170
+20	val_20
+20	val_20
+489	val_489
+489	val_489
+157	val_157
+157	val_157
+378	val_378
+378	val_378
+221	val_221
+221	val_221
+92	val_92
+92	val_92
+111	val_111
+111	val_111
+47	val_47
+47	val_47
+72	val_72
+72	val_72
+4	val_4
+4	val_4
+280	val_280
+280	val_280
+35	val_35
+35	val_35
+427	val_427
+427	val_427
+277	val_277
+277	val_277
+208	val_208
+208	val_208
+356	val_356
+356	val_356
+399	val_399
+399	val_399
+169	val_169
+169	val_169
+382	val_382
+382	val_382
+498	val_498
+498	val_498
+125	val_125
+125	val_125
+386	val_386
+386	val_386
+437	val_437
+437	val_437
+469	val_469
+469	val_469
+192	val_192
+192	val_192
+286	val_286
+286	val_286
+187	val_187
+187	val_187
+176	val_176
+176	val_176
+54	val_54
+54	val_54
+459	val_459
+459	val_459
+51	val_51
+51	val_51
+138	val_138
+138	val_138
+103	val_103
+103	val_103
+239	val_239
+239	val_239
+213	val_213
+213	val_213
+216	val_216
+216	val_216
+430	val_430
+430	val_430
+278	val_278
+278	val_278
+176	val_176
+176	val_176
+289	val_289
+289	val_289
+221	val_221
+221	val_221
+65	val_65
+65	val_65
+318	val_318
+318	val_318
+332	val_332
+332	val_332
+311	val_311
+311	val_311
+275	val_275
+275	val_275
+137	val_137
+137	val_137
+241	val_241
+241	val_241
+83	val_83
+83	val_83
+333	val_333
+333	val_333
+180	val_180
+180	val_180
+284	val_284
+284	val_284
+12	val_12
+12	val_12
+230	val_230
+230	val_230
+181	val_181
+181	val_181
+67	val_67
+67	val_67
+260	val_260
+260	val_260
+404	val_404
+404	val_404
+384	val_384
+384	val_384
+489	val_489
+489	val_489
+353	val_353
+353	val_353
+373	val_373
+373	val_373
+272	val_272
+272	val_272
+138	val_138
+138	val_138
+217	val_217
+217	val_217
+84	val_84
+84	val_84
+348	val_348
+348	val_348
+466	val_466
+466	val_466
+58	val_58
+58	val_58
+8	val_8
+8	val_8
+411	val_411
+411	val_411
+230	val_230
+230	val_230
+208	val_208
+208	val_208
+348	val_348
+348	val_348
+24	val_24
+24	val_24
+463	val_463
+463	val_463
+431	val_431
+431	val_431
+179	val_179
+179	val_179
+172	val_172
+172	val_172
+42	val_42
+42	val_42
+129	val_129
+129	val_129
+158	val_158
+158	val_158
+119	val_119
+119	val_119
+496	val_496
+496	val_496
+0	val_0
+0	val_0
+322	val_322
+322	val_322
+197	val_197
+197	val_197
+468	val_468
+468	val_468
+393	val_393
+393	val_393
+454	val_454
+454	val_454
+100	val_100
+100	val_100
+298	val_298
+298	val_298
+199	val_199
+199	val_199
+191	val_191
+191	val_191
+418	val_418
+418	val_418
+96	val_96
+96	val_96
+26	val_26
+26	val_26
+165	val_165
+165	val_165
+327	val_327
+327	val_327
+230	val_230
+230	val_230
+205	val_205
+205	val_205
+120	val_120
+120	val_120
+131	val_131
+131	val_131
+51	val_51
+51	val_51
+404	val_404
+404	val_404
+43	val_43
+43	val_43
+436	val_436
+436	val_436
+156	val_156
+156	val_156
+469	val_469
+469	val_469
+468	val_468
+468	val_468
+308	val_308
+308	val_308
+95	val_95
+95	val_95
+196	val_196
+196	val_196
+288	val_288
+288	val_288
+481	val_481
+481	val_481
+457	val_457
+457	val_457
+98	val_98
+98	val_98
+282	val_282
+282	val_282
+197	val_197
+197	val_197
+187	val_187
+187	val_187
+318	val_318
+318	val_318
+318	val_318
+318	val_318
+409	val_409
+409	val_409
+470	val_470
+470	val_470
+137	val_137
+137	val_137
+369	val_369
+369	val_369
+316	val_316
+316	val_316
+169	val_169
+169	val_169
+413	val_413
+413	val_413
+85	val_85
+85	val_85
+77	val_77
+77	val_77
+0	val_0
+0	val_0
+490	val_490
+490	val_490
+87	val_87
+87	val_87
+364	val_364
+364	val_364
+179	val_179
+179	val_179
+118	val_118
+118	val_118
+134	val_134
+134	val_134
+395	val_395
+395	val_395
+282	val_282
+282	val_282
+138	val_138
+138	val_138
+238	val_238
+238	val_238
+419	val_419
+419	val_419
+15	val_15
+15	val_15
+118	val_118
+118	val_118
+72	val_72
+72	val_72
+90	val_90
+90	val_90
+307	val_307
+307	val_307
+19	val_19
+19	val_19
+435	val_435
+435	val_435
+10	val_10
+10	val_10
+277	val_277
+277	val_277
+273	val_273
+273	val_273
+306	val_306
+306	val_306
+224	val_224
+224	val_224
+309	val_309
+309	val_309
+389	val_389
+389	val_389
+327	val_327
+327	val_327
+242	val_242
+242	val_242
+369	val_369
+369	val_369
+392	val_392
+392	val_392
+272	val_272
+272	val_272
+331	val_331
+331	val_331
+401	val_401
+401	val_401
+242	val_242
+242	val_242
+452	val_452
+452	val_452
+177	val_177
+177	val_177
+226	val_226
+226	val_226
+5	val_5
+5	val_5
+497	val_497
+497	val_497
+402	val_402
+402	val_402
+396	val_396
+396	val_396
+317	val_317
+317	val_317
+395	val_395
+395	val_395
+58	val_58
+58	val_58
+35	val_35
+35	val_35
+336	val_336
+336	val_336
+95	val_95
+95	val_95
+11	val_11
+11	val_11
+168	val_168
+168	val_168
+34	val_34
+34	val_34
+229	val_229
+229	val_229
+233	val_233
+233	val_233
+143	val_143
+143	val_143
+472	val_472
+472	val_472
+322	val_322
+322	val_322
+498	val_498
+498	val_498
+160	val_160
+160	val_160
+195	val_195
+195	val_195
+42	val_42
+42	val_42
+321	val_321
+321	val_321
+430	val_430
+430	val_430
+119	val_119
+119	val_119
+489	val_489
+489	val_489
+458	val_458
+458	val_458
+78	val_78
+78	val_78
+76	val_76
+76	val_76
+41	val_41
+41	val_41
+223	val_223
+223	val_223
+492	val_492
+492	val_492
+149	val_149
+149	val_149
+449	val_449
+449	val_449
+218	val_218
+218	val_218
+228	val_228
+228	val_228
+138	val_138
+138	val_138
+453	val_453
+453	val_453
+30	val_30
+30	val_30
+209	val_209
+209	val_209
+64	val_64
+64	val_64
+468	val_468
+468	val_468
+76	val_76
+76	val_76
+74	val_74
+74	val_74
+342	val_342
+342	val_342
+69	val_69
+69	val_69
+230	val_230
+230	val_230
+33	val_33
+33	val_33
+368	val_368
+368	val_368
+103	val_103
+103	val_103
+296	val_296
+296	val_296
+113	val_113
+113	val_113
+216	val_216
+216	val_216
+367	val_367
+367	val_367
+344	val_344
+344	val_344
+167	val_167
+167	val_167
+274	val_274
+274	val_274
+219	val_219
+219	val_219
+239	val_239
+239	val_239
+485	val_485
+485	val_485
+116	val_116
+116	val_116
+223	val_223
+223	val_223
+256	val_256
+256	val_256
+263	val_263
+263	val_263
+70	val_70
+70	val_70
+487	val_487
+487	val_487
+480	val_480
+480	val_480
+401	val_401
+401	val_401
+288	val_288
+288	val_288
+191	val_191
+191	val_191
+5	val_5
+5	val_5
+244	val_244
+244	val_244
+438	val_438
+438	val_438
+128	val_128
+128	val_128
+467	val_467
+467	val_467
+432	val_432
+432	val_432
+202	val_202
+202	val_202
+316	val_316
+316	val_316
+229	val_229
+229	val_229
+469	val_469
+469	val_469
+463	val_463
+463	val_463
+280	val_280
+280	val_280
+2	val_2
+2	val_2
+35	val_35
+35	val_35
+283	val_283
+283	val_283
+331	val_331
+331	val_331
+235	val_235
+235	val_235
+80	val_80
+80	val_80
+44	val_44
+44	val_44
+193	val_193
+193	val_193
+321	val_321
+321	val_321
+335	val_335
+335	val_335
+104	val_104
+104	val_104
+466	val_466
+466	val_466
+366	val_366
+366	val_366
+175	val_175
+175	val_175
+403	val_403
+403	val_403
+483	val_483
+483	val_483
+53	val_53
+53	val_53
+105	val_105
+105	val_105
+257	val_257
+257	val_257
+406	val_406
+406	val_406
+409	val_409
+409	val_409
+190	val_190
+190	val_190
+406	val_406
+406	val_406
+401	val_401
+401	val_401
+114	val_114
+114	val_114
+258	val_258
+258	val_258
+90	val_90
+90	val_90
+203	val_203
+203	val_203
+262	val_262
+262	val_262
+348	val_348
+348	val_348
+424	val_424
+424	val_424
+12	val_12
+12	val_12
+396	val_396
+396	val_396
+201	val_201
+201	val_201
+217	val_217
+217	val_217
+164	val_164
+164	val_164
+431	val_431
+431	val_431
+454	val_454
+454	val_454
+478	val_478
+478	val_478
+298	val_298
+298	val_298
+125	val_125
+125	val_125
+431	val_431
+431	val_431
+164	val_164
+164	val_164
+424	val_424
+424	val_424
+187	val_187
+187	val_187
+382	val_382
+382	val_382
+5	val_5
+5	val_5
+70	val_70
+70	val_70
+397	val_397
+397	val_397
+480	val_480
+480	val_480
+291	val_291
+291	val_291
+24	val_24
+24	val_24
+351	val_351
+351	val_351
+255	val_255
+255	val_255
+104	val_104
+104	val_104
+70	val_70
+70	val_70
+163	val_163
+163	val_163
+438	val_438
+438	val_438
+119	val_119
+119	val_119
+414	val_414
+414	val_414
+200	val_200
+200	val_200
+491	val_491
+491	val_491
+237	val_237
+237	val_237
+439	val_439
+439	val_439
+360	val_360
+360	val_360
+248	val_248
+248	val_248
+479	val_479
+479	val_479
+305	val_305
+305	val_305
+417	val_417
+417	val_417
+199	val_199
+199	val_199
+444	val_444
+444	val_444
+120	val_120
+120	val_120
+429	val_429
+429	val_429
+169	val_169
+169	val_169
+443	val_443
+443	val_443
+323	val_323
+323	val_323
+325	val_325
+325	val_325
+277	val_277
+277	val_277
+230	val_230
+230	val_230
+478	val_478
+478	val_478
+178	val_178
+178	val_178
+468	val_468
+468	val_468
+310	val_310
+310	val_310
+317	val_317
+317	val_317
+333	val_333
+333	val_333
+493	val_493
+493	val_493
+460	val_460
+460	val_460
+207	val_207
+207	val_207
+249	val_249
+249	val_249
+265	val_265
+265	val_265
+480	val_480
+480	val_480
+83	val_83
+83	val_83
+136	val_136
+136	val_136
+353	val_353
+353	val_353
+172	val_172
+172	val_172
+214	val_214
+214	val_214
+462	val_462
+462	val_462
+233	val_233
+233	val_233
+406	val_406
+406	val_406
+133	val_133
+133	val_133
+175	val_175
+175	val_175
+189	val_189
+189	val_189
+454	val_454
+454	val_454
+375	val_375
+375	val_375
+401	val_401
+401	val_401
+421	val_421
+421	val_421
+407	val_407
+407	val_407
+384	val_384
+384	val_384
+256	val_256
+256	val_256
+26	val_26
+26	val_26
+134	val_134
+134	val_134
+67	val_67
+67	val_67
+384	val_384
+384	val_384
+379	val_379
+379	val_379
+18	val_18
+18	val_18
+462	val_462
+462	val_462
+492	val_492
+492	val_492
+100	val_100
+100	val_100
+298	val_298
+298	val_298
+9	val_9
+9	val_9
+341	val_341
+341	val_341
+498	val_498
+498	val_498
+146	val_146
+146	val_146
+458	val_458
+458	val_458
+362	val_362
+362	val_362
+186	val_186
+186	val_186
+285	val_285
+285	val_285
+348	val_348
+348	val_348
+167	val_167
+167	val_167
+18	val_18
+18	val_18
+273	val_273
+273	val_273
+183	val_183
+183	val_183
+281	val_281
+281	val_281
+344	val_344
+344	val_344
+97	val_97
+97	val_97
+469	val_469
+469	val_469
+315	val_315
+315	val_315
+84	val_84
+84	val_84
+28	val_28
+28	val_28
+37	val_37
+37	val_37
+448	val_448
+448	val_448
+152	val_152
+152	val_152
+348	val_348
+348	val_348
+307	val_307
+307	val_307
+194	val_194
+194	val_194
+414	val_414
+414	val_414
+477	val_477
+477	val_477
+222	val_222
+222	val_222
+126	val_126
+126	val_126
+90	val_90
+90	val_90
+169	val_169
+169	val_169
+403	val_403
+403	val_403
+400	val_400
+400	val_400
+200	val_200
+200	val_200
+97	val_97
+97	val_97
diff --git a/ql/src/test/results/clientpositive/union2.q.out b/ql/src/test/results/clientpositive/union2.q.out
index 30e25ebfc3..571eedba52 100644
--- a/ql/src/test/results/clientpositive/union2.q.out
+++ b/ql/src/test/results/clientpositive/union2.q.out
@@ -16,6 +16,7 @@ STAGE PLANS:
                     type: string
                     expr: value
                     type: string
+              Union
                 Group By Operator
                   aggregations:
                         expr: count(1)
@@ -33,6 +34,7 @@ STAGE PLANS:
                     type: string
                     expr: value
                     type: string
+              Union
                 Group By Operator
                   aggregations:
                         expr: count(1)
diff --git a/ql/src/test/results/clientpositive/union3.q.out b/ql/src/test/results/clientpositive/union3.q.out
index 06c3f9a912..c3ba1036f6 100644
--- a/ql/src/test/results/clientpositive/union3.q.out
+++ b/ql/src/test/results/clientpositive/union3.q.out
@@ -4,10 +4,19 @@ ABSTRACT SYNTAX TREE:
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
   Stage-2 depends on stages: Stage-1
-  Stage-3 is a root stage
-  Stage-4 is a root stage
-  Stage-5 depends on stages: Stage-4
-  Stage-6 is a root stage
+  Stage-3 depends on stages: Stage-2, Stage-6
+  Stage-4 depends on stages: Stage-3, Stage-8
+  Stage-5 is a root stage
+  Stage-6 depends on stages: Stage-5, Stage-9
+  Stage-3 depends on stages: Stage-2, Stage-6
+  Stage-4 depends on stages: Stage-3, Stage-8
+  Stage-7 is a root stage
+  Stage-8 depends on stages: Stage-7
+  Stage-4 depends on stages: Stage-3, Stage-8
+  Stage-9 is a root stage
+  Stage-6 depends on stages: Stage-5, Stage-9
+  Stage-3 depends on stages: Stage-2, Stage-6
+  Stage-4 depends on stages: Stage-3, Stage-8
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -48,7 +57,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /mnt/vol/devrs004.snc1/jssarma/projects/hive_patches/build/ql/tmp/1045942737/136575081.10002 
+        /data/users/njain/hive1/hive/build/ql/tmp/1348616199/203957602.10002 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -63,18 +72,65 @@ STAGE PLANS:
                   type: int
       Reduce Operator Tree:
         Extract
-              Select Operator
-                expressions:
-                      expr: 0
-                      type: int
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+          File Output Operator
+            compressed: false
+            GlobalTableId: 0
+            table:
+                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                name: binary_table
 
   Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1348616199/203957602.10003 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+        /data/users/njain/hive1/hive/build/ql/tmp/1348616199/203957602.10006 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1348616199/203957602.10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: int
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        /data/users/njain/hive1/hive/build/ql/tmp/1348616199/203957602.10008 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: int
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-5
     Map Reduce
       Alias -> Map Operator Tree:
         null-subquery2-subquery2-subquery2:a-subquery2-subquery2-subquery2:s2:src 
@@ -100,18 +156,37 @@ STAGE PLANS:
               expressions:
                     expr: 4
                     type: int
-                    Select Operator
-                      expressions:
-                            expr: 0
-                            type: int
-                      File Output Operator
-                        compressed: false
-                        GlobalTableId: 0
-                        table:
-                            input format: org.apache.hadoop.mapred.TextInputFormat
-                            output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
 
-  Stage: Stage-4
+  Stage: Stage-6
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1348616199/203957602.10005 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+        /data/users/njain/hive1/hive/build/ql/tmp/1348616199/203957602.10009 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-7
     Map Reduce
       Alias -> Map Operator Tree:
         null-subquery1:a-subquery1:s1:src 
@@ -145,10 +220,10 @@ STAGE PLANS:
                     output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
                     name: binary_table
 
-  Stage: Stage-5
+  Stage: Stage-8
     Map Reduce
       Alias -> Map Operator Tree:
-        /mnt/vol/devrs004.snc1/jssarma/projects/hive_patches/build/ql/tmp/1045942737/136575081.10003 
+        /data/users/njain/hive1/hive/build/ql/tmp/1348616199/203957602.10007 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -163,18 +238,15 @@ STAGE PLANS:
                   type: int
       Reduce Operator Tree:
         Extract
-            Select Operator
-              expressions:
-                    expr: 0
-                    type: int
-              File Output Operator
-                compressed: false
-                GlobalTableId: 0
-                table:
-                    input format: org.apache.hadoop.mapred.TextInputFormat
-                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+          File Output Operator
+            compressed: false
+            GlobalTableId: 0
+            table:
+                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                name: binary_table
 
-  Stage: Stage-6
+  Stage: Stage-9
     Map Reduce
       Alias -> Map Operator Tree:
         null-subquery2-subquery2-subquery1:a-subquery2-subquery2-subquery1:s2:src 
@@ -200,16 +272,13 @@ STAGE PLANS:
               expressions:
                     expr: 3
                     type: int
-                    Select Operator
-                      expressions:
-                            expr: 0
-                            type: int
-                      File Output Operator
-                        compressed: false
-                        GlobalTableId: 0
-                        table:
-                            input format: org.apache.hadoop.mapred.TextInputFormat
-                            output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/union4.q.out b/ql/src/test/results/clientpositive/union4.q.out
new file mode 100644
index 0000000000..992cf02cd0
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union4.q.out
@@ -0,0 +1,118 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst2' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_COLREF unionsrc value)))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-3
+  Stage-3 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-3
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst1'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/663543405/51390228.10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: string
+                    expr: 1
+                    type: bigint
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        /data/users/njain/hive1/hive/build/ql/tmp/663543405/51390228.10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: string
+                    expr: 1
+                    type: bigint
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst2'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+tst1	500
+tst2	500
diff --git a/ql/src/test/results/clientpositive/union5.q.out b/ql/src/test/results/clientpositive/union5.q.out
new file mode 100644
index 0000000000..c24ae7ed14
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union5.q.out
@@ -0,0 +1,161 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst2' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_FUNCTION count 1))) (TOK_GROUPBY (TOK_COLREF unionsrc key))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-4
+  Stage-3 depends on stages: Stage-2
+  Stage-4 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-4
+  Stage-3 depends on stages: Stage-2
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst1'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1182578141/25944894.10004 
+          Union
+            Group By Operator
+              aggregations:
+                    expr: count(1)
+              keys:
+                    expr: 0
+                    type: string
+              mode: hash
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
+        /data/users/njain/hive1/hive/build/ql/tmp/1182578141/25944894.10002 
+          Union
+            Group By Operator
+              aggregations:
+                    expr: count(1)
+              keys:
+                    expr: 0
+                    type: string
+              mode: hash
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/1182578141/25944894.10003 
+          Reduce Output Operator
+            key expressions:
+                  expr: 0
+                  type: string
+            sort order: +
+            Map-reduce partition columns:
+                  expr: 0
+                  type: string
+            tag: -1
+            value expressions:
+                  expr: 1
+                  type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          keys:
+                expr: KEY.0
+                type: string
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 0
+                  type: string
+                  expr: 1
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.TextInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst2'
+                  type: string
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+tst1	1
+tst2	1
diff --git a/ql/src/test/results/clientpositive/union6.q.out b/ql/src/test/results/clientpositive/union6.q.out
new file mode 100644
index 0000000000..926c3b529a
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union6.q.out
@@ -0,0 +1,126 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION TOK_STRING (TOK_FUNCTION count 1)) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src1 s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s2 key) key) (TOK_SELEXPR (TOK_COLREF s2 value) value))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_COLREF unionsrc value)))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-3
+  Stage-3 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-3
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst1'
+                  type: string
+                  expr: UDFToString(0)
+                  type: string
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/139790801/454578640.10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: string
+                    expr: 1
+                    type: string
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        /data/users/njain/hive1/hive/build/ql/tmp/139790801/454578640.10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: string
+                    expr: 1
+                    type: string
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+tst1	500
+238	val_238
+	
+311	val_311
+	val_27
+	val_165
+	val_409
+255	val_255
+278	val_278
+98	val_98
+	val_484
+	val_265
+	val_193
+401	val_401
+150	val_150
+273	val_273
+224	
+369	
+66	val_66
+128	
+213	val_213
+146	val_146
+406	val_406
+	
+	
+	
diff --git a/ql/src/test/results/clientpositive/union7.q.out b/ql/src/test/results/clientpositive/union7.q.out
new file mode 100644
index 0000000000..b47e2b6eac
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union7.q.out
@@ -0,0 +1,160 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION TOK_STRING (TOK_FUNCTION count 1)) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src1 s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s2 key) key) (TOK_SELEXPR (TOK_COLREF s2 value) value))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_FUNCTION count 1))) (TOK_GROUPBY (TOK_COLREF unionsrc key))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-4
+  Stage-3 depends on stages: Stage-2
+  Stage-4 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-4
+  Stage-3 depends on stages: Stage-2
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                mode: hash
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: 0
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 'tst1'
+                  type: string
+                  expr: UDFToString(0)
+                  type: string
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                  name: binary_table
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/5099413/43325262.10004 
+          Union
+            Group By Operator
+              aggregations:
+                    expr: count(1)
+              keys:
+                    expr: 0
+                    type: string
+              mode: hash
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
+        /data/users/njain/hive1/hive/build/ql/tmp/5099413/43325262.10002 
+          Union
+            Group By Operator
+              aggregations:
+                    expr: count(1)
+              keys:
+                    expr: 0
+                    type: string
+              mode: hash
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/njain/hive1/hive/build/ql/tmp/5099413/43325262.10003 
+          Reduce Output Operator
+            key expressions:
+                  expr: 0
+                  type: string
+            sort order: +
+            Map-reduce partition columns:
+                  expr: 0
+                  type: string
+            tag: -1
+            value expressions:
+                  expr: 1
+                  type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          keys:
+                expr: KEY.0
+                type: string
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 0
+                  type: string
+                  expr: 1
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.TextInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                    name: binary_table
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+	10
+128	1
+146	1
+150	1
+213	1
+224	1
+238	1
+255	1
+273	1
+278	1
+311	1
+369	1
+401	1
+406	1
+66	1
+98	1
+tst1	1
diff --git a/ql/src/test/results/clientpositive/union8.q.out b/ql/src/test/results/clientpositive/union8.q.out
new file mode 100644
index 0000000000..9865278fc9
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union8.q.out
@@ -0,0 +1,1579 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s1 key) key) (TOK_SELEXPR (TOK_COLREF s1 value) value)))) (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s2 key) key) (TOK_SELEXPR (TOK_COLREF s2 value) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src s3)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s3 key) key) (TOK_SELEXPR (TOK_COLREF s3 value) value)))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF unionsrc key)) (TOK_SELEXPR (TOK_COLREF unionsrc value)))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2-subquery1:unionsrc-subquery2-subquery1:s2 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              Union
+                Union
+                  Select Operator
+                    expressions:
+                          expr: 0
+                          type: string
+                          expr: 1
+                          type: string
+                    File Output Operator
+                      compressed: false
+                      GlobalTableId: 0
+                      table:
+                          input format: org.apache.hadoop.mapred.TextInputFormat
+                          output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              Union
+                Select Operator
+                  expressions:
+                        expr: 0
+                        type: string
+                        expr: 1
+                        type: string
+                  File Output Operator
+                    compressed: false
+                    GlobalTableId: 0
+                    table:
+                        input format: org.apache.hadoop.mapred.TextInputFormat
+                        output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        null-subquery2-subquery2:unionsrc-subquery2-subquery2:s3 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              Union
+                Union
+                  Select Operator
+                    expressions:
+                          expr: 0
+                          type: string
+                          expr: 1
+                          type: string
+                    File Output Operator
+                      compressed: false
+                      GlobalTableId: 0
+                      table:
+                          input format: org.apache.hadoop.mapred.TextInputFormat
+                          output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+238	val_238
+238	val_238
+238	val_238
+86	val_86
+86	val_86
+86	val_86
+311	val_311
+311	val_311
+311	val_311
+27	val_27
+27	val_27
+27	val_27
+165	val_165
+165	val_165
+165	val_165
+409	val_409
+409	val_409
+409	val_409
+255	val_255
+255	val_255
+255	val_255
+278	val_278
+278	val_278
+278	val_278
+98	val_98
+98	val_98
+98	val_98
+484	val_484
+484	val_484
+484	val_484
+265	val_265
+265	val_265
+265	val_265
+193	val_193
+193	val_193
+193	val_193
+401	val_401
+401	val_401
+401	val_401
+150	val_150
+150	val_150
+150	val_150
+273	val_273
+273	val_273
+273	val_273
+224	val_224
+224	val_224
+224	val_224
+369	val_369
+369	val_369
+369	val_369
+66	val_66
+66	val_66
+66	val_66
+128	val_128
+128	val_128
+128	val_128
+213	val_213
+213	val_213
+213	val_213
+146	val_146
+146	val_146
+146	val_146
+406	val_406
+406	val_406
+406	val_406
+429	val_429
+429	val_429
+429	val_429
+374	val_374
+374	val_374
+374	val_374
+152	val_152
+152	val_152
+152	val_152
+469	val_469
+469	val_469
+469	val_469
+145	val_145
+145	val_145
+145	val_145
+495	val_495
+495	val_495
+495	val_495
+37	val_37
+37	val_37
+37	val_37
+327	val_327
+327	val_327
+327	val_327
+281	val_281
+281	val_281
+281	val_281
+277	val_277
+277	val_277
+277	val_277
+209	val_209
+209	val_209
+209	val_209
+15	val_15
+15	val_15
+15	val_15
+82	val_82
+82	val_82
+82	val_82
+403	val_403
+403	val_403
+403	val_403
+166	val_166
+166	val_166
+166	val_166
+417	val_417
+417	val_417
+417	val_417
+430	val_430
+430	val_430
+430	val_430
+252	val_252
+252	val_252
+252	val_252
+292	val_292
+292	val_292
+292	val_292
+219	val_219
+219	val_219
+219	val_219
+287	val_287
+287	val_287
+287	val_287
+153	val_153
+153	val_153
+153	val_153
+193	val_193
+193	val_193
+193	val_193
+338	val_338
+338	val_338
+338	val_338
+446	val_446
+446	val_446
+446	val_446
+459	val_459
+459	val_459
+459	val_459
+394	val_394
+394	val_394
+394	val_394
+237	val_237
+237	val_237
+237	val_237
+482	val_482
+482	val_482
+482	val_482
+174	val_174
+174	val_174
+174	val_174
+413	val_413
+413	val_413
+413	val_413
+494	val_494
+494	val_494
+494	val_494
+207	val_207
+207	val_207
+207	val_207
+199	val_199
+199	val_199
+199	val_199
+466	val_466
+466	val_466
+466	val_466
+208	val_208
+208	val_208
+208	val_208
+174	val_174
+174	val_174
+174	val_174
+399	val_399
+399	val_399
+399	val_399
+396	val_396
+396	val_396
+396	val_396
+247	val_247
+247	val_247
+247	val_247
+417	val_417
+417	val_417
+417	val_417
+489	val_489
+489	val_489
+489	val_489
+162	val_162
+162	val_162
+162	val_162
+377	val_377
+377	val_377
+377	val_377
+397	val_397
+397	val_397
+397	val_397
+309	val_309
+309	val_309
+309	val_309
+365	val_365
+365	val_365
+365	val_365
+266	val_266
+266	val_266
+266	val_266
+439	val_439
+439	val_439
+439	val_439
+342	val_342
+342	val_342
+342	val_342
+367	val_367
+367	val_367
+367	val_367
+325	val_325
+325	val_325
+325	val_325
+167	val_167
+167	val_167
+167	val_167
+195	val_195
+195	val_195
+195	val_195
+475	val_475
+475	val_475
+475	val_475
+17	val_17
+17	val_17
+17	val_17
+113	val_113
+113	val_113
+113	val_113
+155	val_155
+155	val_155
+155	val_155
+203	val_203
+203	val_203
+203	val_203
+339	val_339
+339	val_339
+339	val_339
+0	val_0
+0	val_0
+0	val_0
+455	val_455
+455	val_455
+455	val_455
+128	val_128
+128	val_128
+128	val_128
+311	val_311
+311	val_311
+311	val_311
+316	val_316
+316	val_316
+316	val_316
+57	val_57
+57	val_57
+57	val_57
+302	val_302
+302	val_302
+302	val_302
+205	val_205
+205	val_205
+205	val_205
+149	val_149
+149	val_149
+149	val_149
+438	val_438
+438	val_438
+438	val_438
+345	val_345
+345	val_345
+345	val_345
+129	val_129
+129	val_129
+129	val_129
+170	val_170
+170	val_170
+170	val_170
+20	val_20
+20	val_20
+20	val_20
+489	val_489
+489	val_489
+489	val_489
+157	val_157
+157	val_157
+157	val_157
+378	val_378
+378	val_378
+378	val_378
+221	val_221
+221	val_221
+221	val_221
+92	val_92
+92	val_92
+92	val_92
+111	val_111
+111	val_111
+111	val_111
+47	val_47
+47	val_47
+47	val_47
+72	val_72
+72	val_72
+72	val_72
+4	val_4
+4	val_4
+4	val_4
+280	val_280
+280	val_280
+280	val_280
+35	val_35
+35	val_35
+35	val_35
+427	val_427
+427	val_427
+427	val_427
+277	val_277
+277	val_277
+277	val_277
+208	val_208
+208	val_208
+208	val_208
+356	val_356
+356	val_356
+356	val_356
+399	val_399
+399	val_399
+399	val_399
+169	val_169
+169	val_169
+169	val_169
+382	val_382
+382	val_382
+382	val_382
+498	val_498
+498	val_498
+498	val_498
+125	val_125
+125	val_125
+125	val_125
+386	val_386
+386	val_386
+386	val_386
+437	val_437
+437	val_437
+437	val_437
+469	val_469
+469	val_469
+469	val_469
+192	val_192
+192	val_192
+192	val_192
+286	val_286
+286	val_286
+286	val_286
+187	val_187
+187	val_187
+187	val_187
+176	val_176
+176	val_176
+176	val_176
+54	val_54
+54	val_54
+54	val_54
+459	val_459
+459	val_459
+459	val_459
+51	val_51
+51	val_51
+51	val_51
+138	val_138
+138	val_138
+138	val_138
+103	val_103
+103	val_103
+103	val_103
+239	val_239
+239	val_239
+239	val_239
+213	val_213
+213	val_213
+213	val_213
+216	val_216
+216	val_216
+216	val_216
+430	val_430
+430	val_430
+430	val_430
+278	val_278
+278	val_278
+278	val_278
+176	val_176
+176	val_176
+176	val_176
+289	val_289
+289	val_289
+289	val_289
+221	val_221
+221	val_221
+221	val_221
+65	val_65
+65	val_65
+65	val_65
+318	val_318
+318	val_318
+318	val_318
+332	val_332
+332	val_332
+332	val_332
+311	val_311
+311	val_311
+311	val_311
+275	val_275
+275	val_275
+275	val_275
+137	val_137
+137	val_137
+137	val_137
+241	val_241
+241	val_241
+241	val_241
+83	val_83
+83	val_83
+83	val_83
+333	val_333
+333	val_333
+333	val_333
+180	val_180
+180	val_180
+180	val_180
+284	val_284
+284	val_284
+284	val_284
+12	val_12
+12	val_12
+12	val_12
+230	val_230
+230	val_230
+230	val_230
+181	val_181
+181	val_181
+181	val_181
+67	val_67
+67	val_67
+67	val_67
+260	val_260
+260	val_260
+260	val_260
+404	val_404
+404	val_404
+404	val_404
+384	val_384
+384	val_384
+384	val_384
+489	val_489
+489	val_489
+489	val_489
+353	val_353
+353	val_353
+353	val_353
+373	val_373
+373	val_373
+373	val_373
+272	val_272
+272	val_272
+272	val_272
+138	val_138
+138	val_138
+138	val_138
+217	val_217
+217	val_217
+217	val_217
+84	val_84
+84	val_84
+84	val_84
+348	val_348
+348	val_348
+348	val_348
+466	val_466
+466	val_466
+466	val_466
+58	val_58
+58	val_58
+58	val_58
+8	val_8
+8	val_8
+8	val_8
+411	val_411
+411	val_411
+411	val_411
+230	val_230
+230	val_230
+230	val_230
+208	val_208
+208	val_208
+208	val_208
+348	val_348
+348	val_348
+348	val_348
+24	val_24
+24	val_24
+24	val_24
+463	val_463
+463	val_463
+463	val_463
+431	val_431
+431	val_431
+431	val_431
+179	val_179
+179	val_179
+179	val_179
+172	val_172
+172	val_172
+172	val_172
+42	val_42
+42	val_42
+42	val_42
+129	val_129
+129	val_129
+129	val_129
+158	val_158
+158	val_158
+158	val_158
+119	val_119
+119	val_119
+119	val_119
+496	val_496
+496	val_496
+496	val_496
+0	val_0
+0	val_0
+0	val_0
+322	val_322
+322	val_322
+322	val_322
+197	val_197
+197	val_197
+197	val_197
+468	val_468
+468	val_468
+468	val_468
+393	val_393
+393	val_393
+393	val_393
+454	val_454
+454	val_454
+454	val_454
+100	val_100
+100	val_100
+100	val_100
+298	val_298
+298	val_298
+298	val_298
+199	val_199
+199	val_199
+199	val_199
+191	val_191
+191	val_191
+191	val_191
+418	val_418
+418	val_418
+418	val_418
+96	val_96
+96	val_96
+96	val_96
+26	val_26
+26	val_26
+26	val_26
+165	val_165
+165	val_165
+165	val_165
+327	val_327
+327	val_327
+327	val_327
+230	val_230
+230	val_230
+230	val_230
+205	val_205
+205	val_205
+205	val_205
+120	val_120
+120	val_120
+120	val_120
+131	val_131
+131	val_131
+131	val_131
+51	val_51
+51	val_51
+51	val_51
+404	val_404
+404	val_404
+404	val_404
+43	val_43
+43	val_43
+43	val_43
+436	val_436
+436	val_436
+436	val_436
+156	val_156
+156	val_156
+156	val_156
+469	val_469
+469	val_469
+469	val_469
+468	val_468
+468	val_468
+468	val_468
+308	val_308
+308	val_308
+308	val_308
+95	val_95
+95	val_95
+95	val_95
+196	val_196
+196	val_196
+196	val_196
+288	val_288
+288	val_288
+288	val_288
+481	val_481
+481	val_481
+481	val_481
+457	val_457
+457	val_457
+457	val_457
+98	val_98
+98	val_98
+98	val_98
+282	val_282
+282	val_282
+282	val_282
+197	val_197
+197	val_197
+197	val_197
+187	val_187
+187	val_187
+187	val_187
+318	val_318
+318	val_318
+318	val_318
+318	val_318
+318	val_318
+318	val_318
+409	val_409
+409	val_409
+409	val_409
+470	val_470
+470	val_470
+470	val_470
+137	val_137
+137	val_137
+137	val_137
+369	val_369
+369	val_369
+369	val_369
+316	val_316
+316	val_316
+316	val_316
+169	val_169
+169	val_169
+169	val_169
+413	val_413
+413	val_413
+413	val_413
+85	val_85
+85	val_85
+85	val_85
+77	val_77
+77	val_77
+77	val_77
+0	val_0
+0	val_0
+0	val_0
+490	val_490
+490	val_490
+490	val_490
+87	val_87
+87	val_87
+87	val_87
+364	val_364
+364	val_364
+364	val_364
+179	val_179
+179	val_179
+179	val_179
+118	val_118
+118	val_118
+118	val_118
+134	val_134
+134	val_134
+134	val_134
+395	val_395
+395	val_395
+395	val_395
+282	val_282
+282	val_282
+282	val_282
+138	val_138
+138	val_138
+138	val_138
+238	val_238
+238	val_238
+238	val_238
+419	val_419
+419	val_419
+419	val_419
+15	val_15
+15	val_15
+15	val_15
+118	val_118
+118	val_118
+118	val_118
+72	val_72
+72	val_72
+72	val_72
+90	val_90
+90	val_90
+90	val_90
+307	val_307
+307	val_307
+307	val_307
+19	val_19
+19	val_19
+19	val_19
+435	val_435
+435	val_435
+435	val_435
+10	val_10
+10	val_10
+10	val_10
+277	val_277
+277	val_277
+277	val_277
+273	val_273
+273	val_273
+273	val_273
+306	val_306
+306	val_306
+306	val_306
+224	val_224
+224	val_224
+224	val_224
+309	val_309
+309	val_309
+309	val_309
+389	val_389
+389	val_389
+389	val_389
+327	val_327
+327	val_327
+327	val_327
+242	val_242
+242	val_242
+242	val_242
+369	val_369
+369	val_369
+369	val_369
+392	val_392
+392	val_392
+392	val_392
+272	val_272
+272	val_272
+272	val_272
+331	val_331
+331	val_331
+331	val_331
+401	val_401
+401	val_401
+401	val_401
+242	val_242
+242	val_242
+242	val_242
+452	val_452
+452	val_452
+452	val_452
+177	val_177
+177	val_177
+177	val_177
+226	val_226
+226	val_226
+226	val_226
+5	val_5
+5	val_5
+5	val_5
+497	val_497
+497	val_497
+497	val_497
+402	val_402
+402	val_402
+402	val_402
+396	val_396
+396	val_396
+396	val_396
+317	val_317
+317	val_317
+317	val_317
+395	val_395
+395	val_395
+395	val_395
+58	val_58
+58	val_58
+58	val_58
+35	val_35
+35	val_35
+35	val_35
+336	val_336
+336	val_336
+336	val_336
+95	val_95
+95	val_95
+95	val_95
+11	val_11
+11	val_11
+11	val_11
+168	val_168
+168	val_168
+168	val_168
+34	val_34
+34	val_34
+34	val_34
+229	val_229
+229	val_229
+229	val_229
+233	val_233
+233	val_233
+233	val_233
+143	val_143
+143	val_143
+143	val_143
+472	val_472
+472	val_472
+472	val_472
+322	val_322
+322	val_322
+322	val_322
+498	val_498
+498	val_498
+498	val_498
+160	val_160
+160	val_160
+160	val_160
+195	val_195
+195	val_195
+195	val_195
+42	val_42
+42	val_42
+42	val_42
+321	val_321
+321	val_321
+321	val_321
+430	val_430
+430	val_430
+430	val_430
+119	val_119
+119	val_119
+119	val_119
+489	val_489
+489	val_489
+489	val_489
+458	val_458
+458	val_458
+458	val_458
+78	val_78
+78	val_78
+78	val_78
+76	val_76
+76	val_76
+76	val_76
+41	val_41
+41	val_41
+41	val_41
+223	val_223
+223	val_223
+223	val_223
+492	val_492
+492	val_492
+492	val_492
+149	val_149
+149	val_149
+149	val_149
+449	val_449
+449	val_449
+449	val_449
+218	val_218
+218	val_218
+218	val_218
+228	val_228
+228	val_228
+228	val_228
+138	val_138
+138	val_138
+138	val_138
+453	val_453
+453	val_453
+453	val_453
+30	val_30
+30	val_30
+30	val_30
+209	val_209
+209	val_209
+209	val_209
+64	val_64
+64	val_64
+64	val_64
+468	val_468
+468	val_468
+468	val_468
+76	val_76
+76	val_76
+76	val_76
+74	val_74
+74	val_74
+74	val_74
+342	val_342
+342	val_342
+342	val_342
+69	val_69
+69	val_69
+69	val_69
+230	val_230
+230	val_230
+230	val_230
+33	val_33
+33	val_33
+33	val_33
+368	val_368
+368	val_368
+368	val_368
+103	val_103
+103	val_103
+103	val_103
+296	val_296
+296	val_296
+296	val_296
+113	val_113
+113	val_113
+113	val_113
+216	val_216
+216	val_216
+216	val_216
+367	val_367
+367	val_367
+367	val_367
+344	val_344
+344	val_344
+344	val_344
+167	val_167
+167	val_167
+167	val_167
+274	val_274
+274	val_274
+274	val_274
+219	val_219
+219	val_219
+219	val_219
+239	val_239
+239	val_239
+239	val_239
+485	val_485
+485	val_485
+485	val_485
+116	val_116
+116	val_116
+116	val_116
+223	val_223
+223	val_223
+223	val_223
+256	val_256
+256	val_256
+256	val_256
+263	val_263
+263	val_263
+263	val_263
+70	val_70
+70	val_70
+70	val_70
+487	val_487
+487	val_487
+487	val_487
+480	val_480
+480	val_480
+480	val_480
+401	val_401
+401	val_401
+401	val_401
+288	val_288
+288	val_288
+288	val_288
+191	val_191
+191	val_191
+191	val_191
+5	val_5
+5	val_5
+5	val_5
+244	val_244
+244	val_244
+244	val_244
+438	val_438
+438	val_438
+438	val_438
+128	val_128
+128	val_128
+128	val_128
+467	val_467
+467	val_467
+467	val_467
+432	val_432
+432	val_432
+432	val_432
+202	val_202
+202	val_202
+202	val_202
+316	val_316
+316	val_316
+316	val_316
+229	val_229
+229	val_229
+229	val_229
+469	val_469
+469	val_469
+469	val_469
+463	val_463
+463	val_463
+463	val_463
+280	val_280
+280	val_280
+280	val_280
+2	val_2
+2	val_2
+2	val_2
+35	val_35
+35	val_35
+35	val_35
+283	val_283
+283	val_283
+283	val_283
+331	val_331
+331	val_331
+331	val_331
+235	val_235
+235	val_235
+235	val_235
+80	val_80
+80	val_80
+80	val_80
+44	val_44
+44	val_44
+44	val_44
+193	val_193
+193	val_193
+193	val_193
+321	val_321
+321	val_321
+321	val_321
+335	val_335
+335	val_335
+335	val_335
+104	val_104
+104	val_104
+104	val_104
+466	val_466
+466	val_466
+466	val_466
+366	val_366
+366	val_366
+366	val_366
+175	val_175
+175	val_175
+175	val_175
+403	val_403
+403	val_403
+403	val_403
+483	val_483
+483	val_483
+483	val_483
+53	val_53
+53	val_53
+53	val_53
+105	val_105
+105	val_105
+105	val_105
+257	val_257
+257	val_257
+257	val_257
+406	val_406
+406	val_406
+406	val_406
+409	val_409
+409	val_409
+409	val_409
+190	val_190
+190	val_190
+190	val_190
+406	val_406
+406	val_406
+406	val_406
+401	val_401
+401	val_401
+401	val_401
+114	val_114
+114	val_114
+114	val_114
+258	val_258
+258	val_258
+258	val_258
+90	val_90
+90	val_90
+90	val_90
+203	val_203
+203	val_203
+203	val_203
+262	val_262
+262	val_262
+262	val_262
+348	val_348
+348	val_348
+348	val_348
+424	val_424
+424	val_424
+424	val_424
+12	val_12
+12	val_12
+12	val_12
+396	val_396
+396	val_396
+396	val_396
+201	val_201
+201	val_201
+201	val_201
+217	val_217
+217	val_217
+217	val_217
+164	val_164
+164	val_164
+164	val_164
+431	val_431
+431	val_431
+431	val_431
+454	val_454
+454	val_454
+454	val_454
+478	val_478
+478	val_478
+478	val_478
+298	val_298
+298	val_298
+298	val_298
+125	val_125
+125	val_125
+125	val_125
+431	val_431
+431	val_431
+431	val_431
+164	val_164
+164	val_164
+164	val_164
+424	val_424
+424	val_424
+424	val_424
+187	val_187
+187	val_187
+187	val_187
+382	val_382
+382	val_382
+382	val_382
+5	val_5
+5	val_5
+5	val_5
+70	val_70
+70	val_70
+70	val_70
+397	val_397
+397	val_397
+397	val_397
+480	val_480
+480	val_480
+480	val_480
+291	val_291
+291	val_291
+291	val_291
+24	val_24
+24	val_24
+24	val_24
+351	val_351
+351	val_351
+351	val_351
+255	val_255
+255	val_255
+255	val_255
+104	val_104
+104	val_104
+104	val_104
+70	val_70
+70	val_70
+70	val_70
+163	val_163
+163	val_163
+163	val_163
+438	val_438
+438	val_438
+438	val_438
+119	val_119
+119	val_119
+119	val_119
+414	val_414
+414	val_414
+414	val_414
+200	val_200
+200	val_200
+200	val_200
+491	val_491
+491	val_491
+491	val_491
+237	val_237
+237	val_237
+237	val_237
+439	val_439
+439	val_439
+439	val_439
+360	val_360
+360	val_360
+360	val_360
+248	val_248
+248	val_248
+248	val_248
+479	val_479
+479	val_479
+479	val_479
+305	val_305
+305	val_305
+305	val_305
+417	val_417
+417	val_417
+417	val_417
+199	val_199
+199	val_199
+199	val_199
+444	val_444
+444	val_444
+444	val_444
+120	val_120
+120	val_120
+120	val_120
+429	val_429
+429	val_429
+429	val_429
+169	val_169
+169	val_169
+169	val_169
+443	val_443
+443	val_443
+443	val_443
+323	val_323
+323	val_323
+323	val_323
+325	val_325
+325	val_325
+325	val_325
+277	val_277
+277	val_277
+277	val_277
+230	val_230
+230	val_230
+230	val_230
+478	val_478
+478	val_478
+478	val_478
+178	val_178
+178	val_178
+178	val_178
+468	val_468
+468	val_468
+468	val_468
+310	val_310
+310	val_310
+310	val_310
+317	val_317
+317	val_317
+317	val_317
+333	val_333
+333	val_333
+333	val_333
+493	val_493
+493	val_493
+493	val_493
+460	val_460
+460	val_460
+460	val_460
+207	val_207
+207	val_207
+207	val_207
+249	val_249
+249	val_249
+249	val_249
+265	val_265
+265	val_265
+265	val_265
+480	val_480
+480	val_480
+480	val_480
+83	val_83
+83	val_83
+83	val_83
+136	val_136
+136	val_136
+136	val_136
+353	val_353
+353	val_353
+353	val_353
+172	val_172
+172	val_172
+172	val_172
+214	val_214
+214	val_214
+214	val_214
+462	val_462
+462	val_462
+462	val_462
+233	val_233
+233	val_233
+233	val_233
+406	val_406
+406	val_406
+406	val_406
+133	val_133
+133	val_133
+133	val_133
+175	val_175
+175	val_175
+175	val_175
+189	val_189
+189	val_189
+189	val_189
+454	val_454
+454	val_454
+454	val_454
+375	val_375
+375	val_375
+375	val_375
+401	val_401
+401	val_401
+401	val_401
+421	val_421
+421	val_421
+421	val_421
+407	val_407
+407	val_407
+407	val_407
+384	val_384
+384	val_384
+384	val_384
+256	val_256
+256	val_256
+256	val_256
+26	val_26
+26	val_26
+26	val_26
+134	val_134
+134	val_134
+134	val_134
+67	val_67
+67	val_67
+67	val_67
+384	val_384
+384	val_384
+384	val_384
+379	val_379
+379	val_379
+379	val_379
+18	val_18
+18	val_18
+18	val_18
+462	val_462
+462	val_462
+462	val_462
+492	val_492
+492	val_492
+492	val_492
+100	val_100
+100	val_100
+100	val_100
+298	val_298
+298	val_298
+298	val_298
+9	val_9
+9	val_9
+9	val_9
+341	val_341
+341	val_341
+341	val_341
+498	val_498
+498	val_498
+498	val_498
+146	val_146
+146	val_146
+146	val_146
+458	val_458
+458	val_458
+458	val_458
+362	val_362
+362	val_362
+362	val_362
+186	val_186
+186	val_186
+186	val_186
+285	val_285
+285	val_285
+285	val_285
+348	val_348
+348	val_348
+348	val_348
+167	val_167
+167	val_167
+167	val_167
+18	val_18
+18	val_18
+18	val_18
+273	val_273
+273	val_273
+273	val_273
+183	val_183
+183	val_183
+183	val_183
+281	val_281
+281	val_281
+281	val_281
+344	val_344
+344	val_344
+344	val_344
+97	val_97
+97	val_97
+97	val_97
+469	val_469
+469	val_469
+469	val_469
+315	val_315
+315	val_315
+315	val_315
+84	val_84
+84	val_84
+84	val_84
+28	val_28
+28	val_28
+28	val_28
+37	val_37
+37	val_37
+37	val_37
+448	val_448
+448	val_448
+448	val_448
+152	val_152
+152	val_152
+152	val_152
+348	val_348
+348	val_348
+348	val_348
+307	val_307
+307	val_307
+307	val_307
+194	val_194
+194	val_194
+194	val_194
+414	val_414
+414	val_414
+414	val_414
+477	val_477
+477	val_477
+477	val_477
+222	val_222
+222	val_222
+222	val_222
+126	val_126
+126	val_126
+126	val_126
+90	val_90
+90	val_90
+90	val_90
+169	val_169
+169	val_169
+169	val_169
+403	val_403
+403	val_403
+403	val_403
+400	val_400
+400	val_400
+400	val_400
+200	val_200
+200	val_200
+200	val_200
+97	val_97
+97	val_97
+97	val_97
diff --git a/ql/src/test/results/clientpositive/union9.q.out b/ql/src/test/results/clientpositive/union9.q.out
new file mode 100644
index 0000000000..60e56675b6
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union9.q.out
@@ -0,0 +1,89 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s1 key) key) (TOK_SELEXPR (TOK_COLREF s1 value) value)))) (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s2 key) key) (TOK_SELEXPR (TOK_COLREF s2 value) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src s3)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s3 key) key) (TOK_SELEXPR (TOK_COLREF s3 value) value)))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION count 1)))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2-subquery1:unionsrc-subquery2-subquery1:s2 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              Union
+                Union
+                  Group By Operator
+                    aggregations:
+                          expr: count(1)
+                    mode: hash
+                    Reduce Output Operator
+                      sort order: 
+                      tag: -1
+                      value expressions:
+                            expr: 0
+                            type: bigint
+        null-subquery1:unionsrc-subquery1:s1 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              Union
+                Group By Operator
+                  aggregations:
+                        expr: count(1)
+                  mode: hash
+                  Reduce Output Operator
+                    sort order: 
+                    tag: -1
+                    value expressions:
+                          expr: 0
+                          type: bigint
+        null-subquery2-subquery2:unionsrc-subquery2-subquery2:s3 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              Union
+                Union
+                  Group By Operator
+                    aggregations:
+                          expr: count(1)
+                    mode: hash
+                    Reduce Output Operator
+                      sort order: 
+                      tag: -1
+                      value expressions:
+                            expr: 0
+                            type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE.0)
+          mode: mergepartial
+          Select Operator
+            expressions:
+                  expr: 0
+                  type: bigint
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.TextInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+1500
diff --git a/ql/src/test/results/compiler/plan/union.q.xml b/ql/src/test/results/compiler/plan/union.q.xml
index a21878b964..6676703a7b 100644
--- a/ql/src/test/results/compiler/plan/union.q.xml
+++ b/ql/src/test/results/compiler/plan/union.q.xml
@@ -28,7 +28,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/data/users/njain/hive_commit/trunk/ql/../build/ql/tmp/734937386/100618839.10000.insclause-0</string> 
+             <string>/data/users/njain/hive1/hive/ql/../build/ql/tmp/19261714/504589071.10000.insclause-0</string> 
             </void> 
             <void property="targetDir"> 
              <string>../build/ql/test/data/warehouse/union.out</string> 
@@ -65,9 +65,9 @@
               <void method="add"> 
                <object id="SelectOperator0" class="org.apache.hadoop.hive.ql.exec.SelectOperator"> 
                 <void property="childOperators"> 
-                 <object id="ArrayList0" class="java.util.ArrayList"> 
+                 <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object id="ForwardOperator0" class="org.apache.hadoop.hive.ql.exec.ForwardOperator"> 
+                   <object id="UnionOperator0" class="org.apache.hadoop.hive.ql.exec.UnionOperator"> 
                     <void property="childOperators"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
@@ -82,7 +82,7 @@
                                <int>1</int> 
                               </void> 
                               <void property="dirName"> 
-                               <string>/data/users/njain/hive_commit/trunk/ql/../build/ql/tmp/734937386/100618839.10000.insclause-0</string> 
+                               <string>/data/users/njain/hive1/hive/ql/../build/ql/tmp/19261714/504589071.10000.insclause-0</string> 
                               </void> 
                               <void property="tableInfo"> 
                                <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -188,7 +188,7 @@
                         <void property="parentOperators"> 
                          <object class="java.util.ArrayList"> 
                           <void method="add"> 
-                           <object idref="ForwardOperator0"/> 
+                           <object idref="UnionOperator0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -203,6 +203,9 @@
                       </void> 
                      </object> 
                     </void> 
+                    <void property="conf"> 
+                     <object class="org.apache.hadoop.hive.ql.plan.unionDesc"/> 
+                    </void> 
                     <void property="parentOperators"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
@@ -211,7 +214,11 @@
                       <void method="add"> 
                        <object id="SelectOperator2" class="org.apache.hadoop.hive.ql.exec.SelectOperator"> 
                         <void property="childOperators"> 
-                         <object idref="ArrayList0"/> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object idref="UnionOperator0"/> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="conf"> 
                          <object class="org.apache.hadoop.hive.ql.plan.selectDesc"> 
@@ -693,7 +700,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/njain/hive_commit/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>null-subquery1:unioninput-subquery1:src</string> 
@@ -708,7 +715,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/njain/hive_commit/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -764,7 +771,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/njain/hive_commit/trunk/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
