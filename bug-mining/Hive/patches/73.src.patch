diff --git a/CHANGES.txt b/CHANGES.txt
index 6d79313d06..9cf027eda4 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -294,3 +294,5 @@ Release 0.2.0 - Unreleased
     right outer join gave spurious rows in join. (Namit Jain via athusoo)
 
     HIVE-189. Make sampling tests deterministic by sorting output. (athusoo)
+
+    HIVE-273. Fix avg UDAF which got broken hive 65. (athusoo)
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java
index 543694aadf..ca85462f5d 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java
@@ -416,7 +416,8 @@ public static Object invoke(Method m, Object thisObject, Object[] arguments) thr
         }
         argumentString.append("} of size " + arguments.length);
       }
-      
+     
+      e.printStackTrace();
       throw new HiveException("Unable to execute method " + m + " " 
           + " on object " + thisObjectString
           + " with arguments " + argumentString.toString() 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
index 7275739e58..e9128d6a6c 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
@@ -147,15 +147,11 @@ public void initialize(Configuration hconf, Reporter reporter) throws HiveExcept
     // aggregationsEvaluateMethods
     aggregationsAggregateMethods = new Method[aggregationClasses.length];
     aggregationsEvaluateMethods = new Method[aggregationClasses.length];
-    String evaluateMethodName = ((conf.getMode() == groupByDesc.Mode.PARTIAL1 || conf.getMode() == groupByDesc.Mode.HASH ||
-                                  conf.getMode() == groupByDesc.Mode.PARTIAL2)
-                                 ? "terminatePartial" : "terminate");
 
     for(int i=0; i<aggregationClasses.length; i++) {
-      String aggregateMethodName = (((conf.getMode() == groupByDesc.Mode.PARTIAL1) || (conf.getMode() == groupByDesc.Mode.HASH)) ? "iterate" : "merge");
+      String evaluateMethodName = conf.getEvalMethods().get(i);
+      String aggregateMethodName = conf.getAggMethods().get(i);
 
-      if (aggregationIsDistinct[i] && (conf.getMode() != groupByDesc.Mode.FINAL))
-        aggregateMethodName = "iterate";
       // aggregationsAggregateMethods
       for( Method m : aggregationClasses[i].getMethods() ){
         if( m.getName().equals( aggregateMethodName ) 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
index 2b9f8950d7..5e1291610c 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
@@ -1205,6 +1205,8 @@ static class UDAFInfo {
     ArrayList<exprNodeDesc> convertedParameters;
     Class<?> retType;
     Class<? extends UDAFEvaluator> evalClass;
+    Method evalMethod;
+    Method aggMethod;
   }
 
   /**
@@ -1229,32 +1231,37 @@ UDAFInfo getUDAFInfo(String aggName, groupByDesc.Mode mode,
       throw new SemanticException(ErrorMsg.INVALID_FUNCTION_SIGNATURE.getMsg((ASTNode)aggTree.getChild(0), reason));
     }
     
-    Method aggregateMethod = null;
+    r.aggMethod = null;
+    String funcName = (((mode == groupByDesc.Mode.PARTIAL1) || (mode == groupByDesc.Mode.HASH)) ? "iterate" : "merge");
+    if (aggTree.getToken().getType() == HiveParser.TOK_FUNCTIONDI && (mode != groupByDesc.Mode.FINAL))
+        funcName = "iterate";
+
     for(Method m: r.evalClass.getMethods()) {
-      if (m.getName().equalsIgnoreCase("iterate")) {
-        aggregateMethod = m;
+      if (m.getName().equalsIgnoreCase(funcName)) {
+        r.aggMethod = m;
       }
     }
     
-    if (null == aggregateMethod) {
+    if (null == r.aggMethod) {
       String reason = "Looking for UDAF Evaluator Iterator\"" + aggName + "\" with parameters " + aggClasses;
       throw new SemanticException(ErrorMsg.INVALID_FUNCTION_SIGNATURE.getMsg((ASTNode)aggTree.getChild(0), reason));
     }
 
-    r.convertedParameters = convertParameters(aggregateMethod, aggParameters);
-    
-    Method evaluateMethod = FunctionRegistry.getUDAFEvaluateMethod(aggName, mode);
-    String funcName = (mode == groupByDesc.Mode.COMPLETE || mode == groupByDesc.Mode.FINAL) ? "terminate" : "terminatePartial";
+    r.convertedParameters = convertParameters(r.aggMethod, aggParameters);
+
+    funcName = ((mode == groupByDesc.Mode.PARTIAL1 || mode == groupByDesc.Mode.HASH ||
+                 mode == groupByDesc.Mode.PARTIAL2) ? "terminatePartial" : "terminate");
+    r.evalMethod = null;
     for(Method m: r.evalClass.getMethods()) {
       if (m.getName().equalsIgnoreCase(funcName)) {
-        evaluateMethod = m;
+        r.evalMethod = m;
       }
     }
-    if (evaluateMethod == null) {
+    if (r.evalMethod == null) {
       String reason = "UDAF \"" + aggName + "\" does not have terminate()/terminatePartial() methods.";
       throw new SemanticException(ErrorMsg.INVALID_FUNCTION.getMsg((ASTNode)aggTree.getChild(0), reason)); 
     }
-    r.retType = evaluateMethod.getReturnType();
+    r.retType = r.evalMethod.getReturnType();
     
     return r;
   }
@@ -1276,6 +1283,8 @@ private Operator genGroupByPlanGroupByOperator(
     groupByOutputRowResolver.setIsExprResolver(true);
     ArrayList<exprNodeDesc> groupByKeys = new ArrayList<exprNodeDesc>();
     ArrayList<aggregationDesc> aggregations = new ArrayList<aggregationDesc>();
+    ArrayList<String> evalMethods = new ArrayList<String>();
+    ArrayList<String> aggMethods = new ArrayList<String>();
     List<ASTNode> grpByExprs = getGroupByForClause(parseInfo, dest);
     for (int i = 0; i < grpByExprs.size(); ++i) {
       ASTNode grpbyExpr = grpByExprs.get(i);
@@ -1319,13 +1328,15 @@ private Operator genGroupByPlanGroupByOperator(
       
       aggregations.add(new aggregationDesc(udaf.evalClass, udaf.convertedParameters,
           value.getToken().getType() == HiveParser.TOK_FUNCTIONDI));
+      evalMethods.add(udaf.evalMethod.getName());
+      aggMethods.add(udaf.aggMethod.getName());
       groupByOutputRowResolver.put("",value.toStringTree(),
                                    new ColumnInfo(Integer.valueOf(groupByKeys.size() + aggregations.size() -1).toString(),
                                        udaf.retType));
     }
 
     return 
-      putOpInsertMap(OperatorFactory.getAndMakeChild(new groupByDesc(mode, groupByKeys, aggregations),
+      putOpInsertMap(OperatorFactory.getAndMakeChild(new groupByDesc(mode, groupByKeys, aggregations, evalMethods, aggMethods),
                                                      new RowSchema(groupByOutputRowResolver.getColumnInfos()),
                                                      reduceSinkOperatorInfo),
         groupByOutputRowResolver
@@ -1349,6 +1360,8 @@ private Operator genGroupByPlanGroupByOperator1(
     groupByOutputRowResolver.setIsExprResolver(true);
     ArrayList<exprNodeDesc> groupByKeys = new ArrayList<exprNodeDesc>();
     ArrayList<aggregationDesc> aggregations = new ArrayList<aggregationDesc>();
+    ArrayList<String> evalMethods = new ArrayList<String>();
+    ArrayList<String> aggMethods = new ArrayList<String>();
     List<ASTNode> grpByExprs = getGroupByForClause(parseInfo, dest);
     for (int i = 0; i < grpByExprs.size(); ++i) {
       ASTNode grpbyExpr = grpByExprs.get(i);
@@ -1404,13 +1417,15 @@ private Operator genGroupByPlanGroupByOperator1(
       UDAFInfo udaf = getUDAFInfo(aggName, mode, aggParameters, value);
       aggregations.add(new aggregationDesc(udaf.evalClass, udaf.convertedParameters, 
           ((mode == groupByDesc.Mode.FINAL) ? false : (value.getToken().getType() == HiveParser.TOK_FUNCTIONDI))));
+      evalMethods.add(udaf.evalMethod.getName());
+      aggMethods.add(udaf.aggMethod.getName());
       groupByOutputRowResolver.put("", value.toStringTree(),
                                     new ColumnInfo(Integer.valueOf(groupByKeys.size() + aggregations.size() - 1).toString(),
                                         udaf.retType));
     }
 
     return putOpInsertMap(
-        OperatorFactory.getAndMakeChild(new groupByDesc(mode, groupByKeys, aggregations),
+        OperatorFactory.getAndMakeChild(new groupByDesc(mode, groupByKeys, aggregations, evalMethods, aggMethods),
                                         new RowSchema(groupByOutputRowResolver.getColumnInfos()),
                                         reduceSinkOperatorInfo),
         groupByOutputRowResolver);
@@ -1433,6 +1448,8 @@ private Operator genGroupByPlanMapGroupByOperator(QB qb, String dest, Operator i
     groupByOutputRowResolver.setIsExprResolver(true);
     ArrayList<exprNodeDesc> groupByKeys = new ArrayList<exprNodeDesc>();
     ArrayList<aggregationDesc> aggregations = new ArrayList<aggregationDesc>();
+    ArrayList<String> evalMethods = new ArrayList<String>();
+    ArrayList<String> aggMethods = new ArrayList<String>();
     List<ASTNode> grpByExprs = getGroupByForClause(parseInfo, dest);
     for (int i = 0; i < grpByExprs.size(); ++i) {
       ASTNode grpbyExpr = grpByExprs.get(i);
@@ -1486,13 +1503,15 @@ private Operator genGroupByPlanMapGroupByOperator(QB qb, String dest, Operator i
       
       aggregations.add(new aggregationDesc(udaf.evalClass, udaf.convertedParameters,
                                            value.getToken().getType() == HiveParser.TOK_FUNCTIONDI));
+      evalMethods.add(udaf.evalMethod.getName());
+      aggMethods.add(udaf.aggMethod.getName());
       groupByOutputRowResolver.put("",value.toStringTree(),
                                    new ColumnInfo(Integer.valueOf(groupByKeys.size() + aggregations.size() -1).toString(),
                                        udaf.retType));
     }
 
     return putOpInsertMap(
-      OperatorFactory.getAndMakeChild(new groupByDesc(mode, groupByKeys, aggregations),
+      OperatorFactory.getAndMakeChild(new groupByDesc(mode, groupByKeys, aggregations, evalMethods, aggMethods),
                                       new RowSchema(groupByOutputRowResolver.getColumnInfos()),
                                       inputOperatorInfo),
       groupByOutputRowResolver);
@@ -1777,6 +1796,8 @@ private Operator genGroupByPlanGroupByOperator2MR(
     groupByOutputRowResolver2.setIsExprResolver(true);
     ArrayList<exprNodeDesc> groupByKeys = new ArrayList<exprNodeDesc>();
     ArrayList<aggregationDesc> aggregations = new ArrayList<aggregationDesc>();
+    ArrayList<String> evalMethods = new ArrayList<String>();
+    ArrayList<String> aggMethods = new ArrayList<String>();
     List<ASTNode> grpByExprs = getGroupByForClause(parseInfo, dest);
     for (int i = 0; i < grpByExprs.size(); ++i) {
       ASTNode grpbyExpr = grpByExprs.get(i);
@@ -1815,13 +1836,15 @@ private Operator genGroupByPlanGroupByOperator2MR(
       UDAFInfo udaf = getUDAFInfo(aggName, mode, aggParameters, value);      
       aggregations.add(new aggregationDesc(udaf.evalClass, udaf.convertedParameters, 
                                            ((mode == groupByDesc.Mode.FINAL) ? false : (value.getToken().getType() == HiveParser.TOK_FUNCTIONDI))));
+      evalMethods.add(udaf.evalMethod.getName());
+      aggMethods.add(udaf.aggMethod.getName());
       groupByOutputRowResolver2.put("", value.toStringTree(),
                                     new ColumnInfo(Integer.valueOf(groupByKeys.size() + aggregations.size() - 1).toString(),
                                         udaf.retType));
     }
 
     return putOpInsertMap(
-      OperatorFactory.getAndMakeChild(new groupByDesc(mode, groupByKeys, aggregations),
+      OperatorFactory.getAndMakeChild(new groupByDesc(mode, groupByKeys, aggregations, evalMethods, aggMethods),
                                       new RowSchema(groupByOutputRowResolver2.getColumnInfos()),
                                       reduceSinkOperatorInfo2),
         groupByOutputRowResolver2
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/plan/groupByDesc.java b/ql/src/java/org/apache/hadoop/hive/ql/plan/groupByDesc.java
index 8ff46ce6df..25bedc927f 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/plan/groupByDesc.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/plan/groupByDesc.java
@@ -32,14 +32,20 @@ public static enum Mode { COMPLETE, PARTIAL1, PARTIAL2, FINAL, HASH };
   private Mode mode;
   private java.util.ArrayList<exprNodeDesc> keys;
   private java.util.ArrayList<org.apache.hadoop.hive.ql.plan.aggregationDesc> aggregators;
+  private java.util.ArrayList<String> evalMethods;
+  private java.util.ArrayList<String> aggMethods;
   public groupByDesc() { }
   public groupByDesc(
     final Mode mode,
     final java.util.ArrayList<exprNodeDesc> keys,
-    final java.util.ArrayList<org.apache.hadoop.hive.ql.plan.aggregationDesc> aggregators) {
+    final java.util.ArrayList<org.apache.hadoop.hive.ql.plan.aggregationDesc> aggregators,
+    final java.util.ArrayList<String> evalMethods,
+    final java.util.ArrayList<String> aggMethods) {
     this.mode = mode;
     this.keys = keys;
     this.aggregators = aggregators;
+    this.evalMethods = evalMethods;
+    this.aggMethods = aggMethods;
   }
   public Mode getMode() {
     return this.mode;
@@ -79,4 +85,18 @@ public java.util.ArrayList<org.apache.hadoop.hive.ql.plan.aggregationDesc> getAg
   public void setAggregators(final java.util.ArrayList<org.apache.hadoop.hive.ql.plan.aggregationDesc> aggregators) {
     this.aggregators = aggregators;
   }
+  
+  public java.util.ArrayList<String> getEvalMethods() {
+    return this.evalMethods;
+  }
+  public void setEvalMethods(final java.util.ArrayList<String> evalMethods) {
+    this.evalMethods = evalMethods;
+  }
+  
+  public java.util.ArrayList<String> getAggMethods() {
+    return this.aggMethods;
+  }
+  public void setAggMethods(final java.util.ArrayList<String> aggMethods) {
+    this.aggMethods = aggMethods;
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMin.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMin.java
index 77089d0e5b..b07be2a0e0 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMin.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMin.java
@@ -240,7 +240,7 @@ public boolean iterate(String o) {
         if (mEmpty) {
           mMin = o;
           mEmpty = false;
-        } else if (mMin.compareTo(o) < 0) {
+        } else if (mMin.compareTo(o) > 0) {
           mMin = o;
         }
       }
@@ -279,7 +279,7 @@ public boolean iterate(Date o) {
         if (mEmpty) {
           mMin = o;
           mEmpty = false;
-        } else if (mMin.compareTo(o) < 0){
+        } else if (mMin.compareTo(o) > 0){
           mMin = o;
         }
       }
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java b/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
index 7da467a8a4..db5571e3db 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
@@ -650,7 +650,7 @@ public int checkCliDriverResults(String tname) throws Exception {
     cmdArray[4] = (new File(logDir, tname + ".out")).getPath();
     cmdArray[5] = (new File(outDir, tname + ".out")).getPath();
     System.out.println(cmdArray[0] + " " + cmdArray[1] + " " + cmdArray[2] + " " +
-                       cmdArray[3] + " " + cmdArray[4]);
+                       cmdArray[3] + " " + cmdArray[4] + " " + cmdArray[5]);
 
     Process executor = Runtime.getRuntime().exec(cmdArray);
 
diff --git a/ql/src/test/queries/clientpositive/udf8.q b/ql/src/test/queries/clientpositive/udf8.q
new file mode 100644
index 0000000000..a9e696369a
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/udf8.q
@@ -0,0 +1,10 @@
+CREATE TABLE dest1(c1 STRING) STORED AS TEXTFILE;
+
+FROM src INSERT OVERWRITE TABLE dest1 SELECT '' WHERE src.key = 86;
+
+FROM src INSERT OVERWRITE TABLE dest1 SELECT '1' WHERE src.key = 86;
+
+EXPLAIN
+SELECT avg(c1), sum(c1), count(c1) FROM dest1;
+
+SELECT avg(c1), sum(c1), count(c1) FROM dest1;
diff --git a/ql/src/test/results/clientpositive/groupby3.q.out b/ql/src/test/results/clientpositive/groupby3.q.out
index a3ebafb148..e0b8ced96b 100644
--- a/ql/src/test/results/clientpositive/groupby3.q.out
+++ b/ql/src/test/results/clientpositive/groupby3.q.out
@@ -43,7 +43,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/1302296/900109453.10001 
+        /data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/156149158/223155059.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
@@ -63,9 +63,9 @@ STAGE PLANS:
           aggregations:
                 expr: sum(VALUE.0)
                 expr: max(VALUE.1)
-                expr: avg(UDFToDouble(VALUE.2))
+                expr: avg(VALUE.2)
                 expr: min(VALUE.3)
-                expr: avg(UDFToDouble(VALUE.4))
+                expr: avg(VALUE.4)
           mode: final
           Select Operator
             expressions:
@@ -110,4 +110,4 @@ STAGE PLANS:
                 name: dest1
 
 
-130091.0	NULL	NULL	98.0	98.0
+130091.0	260.182	256.10355987055016	98.0	0.0
diff --git a/ql/src/test/results/clientpositive/groupby3_map.q.out b/ql/src/test/results/clientpositive/groupby3_map.q.out
index 590635641c..9438b2c911 100644
--- a/ql/src/test/results/clientpositive/groupby3_map.q.out
+++ b/ql/src/test/results/clientpositive/groupby3_map.q.out
@@ -53,7 +53,7 @@ STAGE PLANS:
                 expr: max(VALUE.1)
                 expr: avg(DISTINCT UDFToDouble(KEY.0))
                 expr: min(VALUE.3)
-                expr: avg(UDFToDouble(VALUE.4))
+                expr: avg(VALUE.4)
           mode: partial2
           File Output Operator
             compressed: false
@@ -65,7 +65,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/1389629365/204290894.10001 
+        /data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/1134254033/650040203.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
@@ -85,9 +85,9 @@ STAGE PLANS:
           aggregations:
                 expr: sum(VALUE.0)
                 expr: max(VALUE.1)
-                expr: avg(UDFToDouble(VALUE.2))
+                expr: avg(VALUE.2)
                 expr: min(VALUE.3)
-                expr: avg(UDFToDouble(VALUE.4))
+                expr: avg(VALUE.4)
           mode: final
           Select Operator
             expressions:
@@ -132,4 +132,4 @@ STAGE PLANS:
                 name: dest1
 
 
-130091.0	NULL	NULL	98.0	98.0
+130091.0	260.182	256.10355987055016	98.0	0.0
diff --git a/ql/src/test/results/clientpositive/udf3.q.out b/ql/src/test/results/clientpositive/udf3.q.out
index a56065e8cb..c136fe7443 100644
--- a/ql/src/test/results/clientpositive/udf3.q.out
+++ b/ql/src/test/results/clientpositive/udf3.q.out
@@ -40,7 +40,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/68854306/763012378.10001 
+        /data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/461551864/1010092958.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
@@ -59,7 +59,7 @@ STAGE PLANS:
         Group By Operator
           aggregations:
                 expr: max(VALUE.0)
-                expr: avg(UDFToDouble(VALUE.1))
+                expr: avg(VALUE.1)
                 expr: count(VALUE.2)
                 expr: sum(VALUE.3)
                 expr: min(VALUE.4)
diff --git a/ql/src/test/results/clientpositive/udf8.q.out b/ql/src/test/results/clientpositive/udf8.q.out
new file mode 100644
index 0000000000..4e63f5709f
--- /dev/null
+++ b/ql/src/test/results/clientpositive/udf8.q.out
@@ -0,0 +1,77 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_TABREF dest1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION avg (TOK_COLREF c1))) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_COLREF c1))) (TOK_SELEXPR (TOK_FUNCTION count (TOK_COLREF c1))))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        dest1 
+            Reduce Output Operator
+              sort order: 
+              Map-reduce partition columns:
+                    expr: rand()
+                    type: double
+              tag: -1
+              value expressions:
+                    expr: c1
+                    type: string
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: sum(UDFToDouble(VALUE.0))
+                expr: count(VALUE.0)
+                expr: avg(UDFToDouble(VALUE.0))
+          mode: partial1
+          File Output Operator
+            compressed: false
+            table:
+                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
+                name: binary_table
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        /data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/181599227/280831237.10002 
+          Reduce Output Operator
+            sort order: 
+            tag: -1
+            value expressions:
+                  expr: 0
+                  type: double
+                  expr: 1
+                  type: bigint
+                  expr: 2
+                  type: string
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: sum(VALUE.0)
+                expr: count(VALUE.1)
+                expr: avg(VALUE.2)
+          mode: final
+          Select Operator
+            expressions:
+                  expr: 2
+                  type: double
+                  expr: 0
+                  type: double
+                  expr: 1
+                  type: bigint
+            File Output Operator
+              compressed: false
+              table:
+                  input format: org.apache.hadoop.mapred.TextInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
+1.0	1.0	1
diff --git a/ql/src/test/results/compiler/plan/groupby1.q.xml b/ql/src/test/results/compiler/plan/groupby1.q.xml
index 264e5cb4b4..55fc257027 100755
--- a/ql/src/test/results/compiler/plan/groupby1.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby1.q.xml
@@ -35,7 +35,7 @@
                  <boolean>true</boolean> 
                 </void> 
                 <void property="sourceDir"> 
-                 <string>/data/users/zshao/sync/apache-trunk-HIVE-105/ql/../build/ql/tmp/361270251/169850988.10000.insclause-0</string> 
+                 <string>/data/users/athusoo/commits/hive_trunk_ws2/ql/../build/ql/tmp/568109016/211707412.10000.insclause-0</string> 
                 </void> 
                 <void property="table"> 
                  <object id="tableDesc0" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -84,7 +84,7 @@
                     </void> 
                     <void method="put"> 
                      <string>location</string> 
-                     <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/dest1</string> 
+                     <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/dest1</string> 
                     </void> 
                    </object> 
                   </void> 
@@ -118,7 +118,7 @@
         <void property="aliasToWork"> 
          <object class="java.util.HashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/361270251/169850988.10001</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/568109016/211707412.10001</string> 
            <object id="ReduceSinkOperator0" class="org.apache.hadoop.hive.ql.exec.ReduceSinkOperator"> 
             <void property="conf"> 
              <object class="org.apache.hadoop.hive.ql.plan.reduceSinkDesc"> 
@@ -242,7 +242,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/361270251/169850988.10001</string> 
+                       <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/568109016/211707412.10001</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object id="tableDesc3" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -316,6 +316,13 @@
                 </void> 
                 <void property="conf"> 
                  <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+                  <void property="aggMethods"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                   </object> 
+                  </void> 
                   <void property="aggregators"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -365,6 +372,13 @@
                     </void> 
                    </object> 
                   </void> 
+                  <void property="evalMethods"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                   </object> 
+                  </void> 
                   <void property="keys"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -677,10 +691,10 @@
         <void property="pathToAliases"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/361270251/169850988.10001</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/568109016/211707412.10001</string> 
            <object class="java.util.ArrayList"> 
             <void method="add"> 
-             <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/361270251/169850988.10001</string> 
+             <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/568109016/211707412.10001</string> 
             </void> 
            </object> 
           </void> 
@@ -689,7 +703,7 @@
         <void property="pathToPartitionInfo"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/361270251/169850988.10001</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/568109016/211707412.10001</string> 
            <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
             <void property="tableDesc"> 
              <object idref="tableDesc3"/> 
@@ -711,7 +725,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/zshao/sync/apache-trunk-HIVE-105/ql/../build/ql/tmp/361270251/169850988.10000.insclause-0</string> 
+                     <string>/data/users/athusoo/commits/hive_trunk_ws2/ql/../build/ql/tmp/568109016/211707412.10000.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object idref="tableDesc0"/> 
@@ -805,6 +819,13 @@
           </void> 
           <void property="conf"> 
            <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+            <void property="aggMethods"> 
+             <object class="java.util.ArrayList"> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+             </object> 
+            </void> 
             <void property="aggregators"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -830,6 +851,13 @@
               </void> 
              </object> 
             </void> 
+            <void property="evalMethods"> 
+             <object class="java.util.ArrayList"> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+             </object> 
+            </void> 
             <void property="keys"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -923,7 +951,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -935,7 +963,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -987,7 +1015,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby2.q.xml b/ql/src/test/results/compiler/plan/groupby2.q.xml
index 318c9093c4..14cd76a94e 100755
--- a/ql/src/test/results/compiler/plan/groupby2.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby2.q.xml
@@ -20,7 +20,7 @@
         <void property="aliasToWork"> 
          <object class="java.util.HashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/187708922/156247810.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/622430055/9149509.10002</string> 
            <object id="ReduceSinkOperator0" class="org.apache.hadoop.hive.ql.exec.ReduceSinkOperator"> 
             <void property="conf"> 
              <object class="org.apache.hadoop.hive.ql.plan.reduceSinkDesc"> 
@@ -158,7 +158,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/187708922/156247810.10002</string> 
+                       <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/622430055/9149509.10002</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -242,6 +242,16 @@
                 </void> 
                 <void property="conf"> 
                  <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+                  <void property="aggMethods"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                   </object> 
+                  </void> 
                   <void property="aggregators"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -315,6 +325,16 @@
                     </void> 
                    </object> 
                   </void> 
+                  <void property="evalMethods"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                   </object> 
+                  </void> 
                   <void property="keys"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -666,10 +686,10 @@
         <void property="pathToAliases"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/187708922/156247810.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/622430055/9149509.10002</string> 
            <object class="java.util.ArrayList"> 
             <void method="add"> 
-             <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/187708922/156247810.10002</string> 
+             <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/622430055/9149509.10002</string> 
             </void> 
            </object> 
           </void> 
@@ -678,7 +698,7 @@
         <void property="pathToPartitionInfo"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/187708922/156247810.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/622430055/9149509.10002</string> 
            <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
             <void property="tableDesc"> 
              <object idref="tableDesc2"/> 
@@ -700,7 +720,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/zshao/sync/apache-trunk-HIVE-105/ql/../build/ql/tmp/187708922/156247810.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/commits/hive_trunk_ws2/ql/../build/ql/tmp/622430055/9149509.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -897,6 +917,16 @@
           </void> 
           <void property="conf"> 
            <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+            <void property="aggMethods"> 
+             <object class="java.util.ArrayList"> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+             </object> 
+            </void> 
             <void property="aggregators"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -943,6 +973,16 @@
               </void> 
              </object> 
             </void> 
+            <void property="evalMethods"> 
+             <object class="java.util.ArrayList"> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+             </object> 
+            </void> 
             <void property="keys"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -1046,7 +1086,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -1058,7 +1098,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -1110,7 +1150,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby3.q.xml b/ql/src/test/results/compiler/plan/groupby3.q.xml
index bcfed6dab4..2a53f15462 100644
--- a/ql/src/test/results/compiler/plan/groupby3.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby3.q.xml
@@ -20,7 +20,7 @@
         <void property="aliasToWork"> 
          <object class="java.util.HashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/6568832/173702865.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/362183700/102440280.10002</string> 
            <object id="ReduceSinkOperator0" class="org.apache.hadoop.hive.ql.exec.ReduceSinkOperator"> 
             <void property="conf"> 
              <object class="org.apache.hadoop.hive.ql.plan.reduceSinkDesc"> 
@@ -173,7 +173,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/6568832/173702865.10002</string> 
+                       <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/362183700/102440280.10002</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -277,6 +277,25 @@
                 </void> 
                 <void property="conf"> 
                  <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+                  <void property="aggMethods"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                   </object> 
+                  </void> 
                   <void property="aggregators"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -461,6 +480,25 @@
                     </void> 
                    </object> 
                   </void> 
+                  <void property="evalMethods"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                   </object> 
+                  </void> 
                   <void property="keys"> 
                    <object class="java.util.ArrayList"/> 
                   </void> 
@@ -802,10 +840,10 @@
         <void property="pathToAliases"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/6568832/173702865.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/362183700/102440280.10002</string> 
            <object class="java.util.ArrayList"> 
             <void method="add"> 
-             <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/6568832/173702865.10002</string> 
+             <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/362183700/102440280.10002</string> 
             </void> 
            </object> 
           </void> 
@@ -814,7 +852,7 @@
         <void property="pathToPartitionInfo"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/6568832/173702865.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/362183700/102440280.10002</string> 
            <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
             <void property="tableDesc"> 
              <object idref="tableDesc2"/> 
@@ -836,7 +874,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/zshao/sync/apache-trunk-HIVE-105/ql/../build/ql/tmp/1072875330.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/commits/hive_trunk_ws2/ql/../build/ql/tmp/343125472.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -1012,6 +1050,25 @@
           </void> 
           <void property="conf"> 
            <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+            <void property="aggMethods"> 
+             <object class="java.util.ArrayList"> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+             </object> 
+            </void> 
             <void property="aggregators"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -1064,36 +1121,12 @@
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
-                    <void property="UDFClass"> 
-                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
-                    </void> 
-                    <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
-                      <string>evaluate</string> 
-                      <array class="java.lang.Class" length="1"> 
-                       <void index="0"> 
-                        <class>java.lang.String</class> 
-                       </void> 
-                      </array> 
-                     </object> 
-                    </void> 
-                    <void property="children"> 
-                     <object class="java.util.ArrayList"> 
-                      <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>VALUE.2</string> 
-                        </void> 
-                        <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
-                        </void> 
-                       </object> 
-                      </void> 
-                     </object> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                    <void property="column"> 
+                     <string>VALUE.2</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1130,36 +1163,12 @@
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
-                    <void property="UDFClass"> 
-                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
-                    </void> 
-                    <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
-                      <string>evaluate</string> 
-                      <array class="java.lang.Class" length="1"> 
-                       <void index="0"> 
-                        <class>java.lang.String</class> 
-                       </void> 
-                      </array> 
-                     </object> 
-                    </void> 
-                    <void property="children"> 
-                     <object class="java.util.ArrayList"> 
-                      <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>VALUE.4</string> 
-                        </void> 
-                        <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
-                        </void> 
-                       </object> 
-                      </void> 
-                     </object> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                    <void property="column"> 
+                     <string>VALUE.4</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1169,6 +1178,25 @@
               </void> 
              </object> 
             </void> 
+            <void property="evalMethods"> 
+             <object class="java.util.ArrayList"> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+             </object> 
+            </void> 
             <void property="keys"> 
              <object class="java.util.ArrayList"/> 
             </void> 
@@ -1281,7 +1309,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -1293,7 +1321,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -1345,7 +1373,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby4.q.xml b/ql/src/test/results/compiler/plan/groupby4.q.xml
index a9ff511edf..a0955eaa4c 100644
--- a/ql/src/test/results/compiler/plan/groupby4.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby4.q.xml
@@ -20,7 +20,7 @@
         <void property="aliasToWork"> 
          <object class="java.util.HashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/42922291/496011429.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/578183610/484947383.10002</string> 
            <object id="ReduceSinkOperator0" class="org.apache.hadoop.hive.ql.exec.ReduceSinkOperator"> 
             <void property="conf"> 
              <object class="org.apache.hadoop.hive.ql.plan.reduceSinkDesc"> 
@@ -129,7 +129,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/42922291/496011429.10002</string> 
+                       <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/578183610/484947383.10002</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -193,9 +193,15 @@
                 </void> 
                 <void property="conf"> 
                  <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+                  <void property="aggMethods"> 
+                   <object class="java.util.ArrayList"/> 
+                  </void> 
                   <void property="aggregators"> 
                    <object class="java.util.ArrayList"/> 
                   </void> 
+                  <void property="evalMethods"> 
+                   <object class="java.util.ArrayList"/> 
+                  </void> 
                   <void property="keys"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -545,10 +551,10 @@
         <void property="pathToAliases"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/42922291/496011429.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/578183610/484947383.10002</string> 
            <object class="java.util.ArrayList"> 
             <void method="add"> 
-             <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/42922291/496011429.10002</string> 
+             <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/578183610/484947383.10002</string> 
             </void> 
            </object> 
           </void> 
@@ -557,7 +563,7 @@
         <void property="pathToPartitionInfo"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/42922291/496011429.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/578183610/484947383.10002</string> 
            <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
             <void property="tableDesc"> 
              <object idref="tableDesc2"/> 
@@ -579,7 +585,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/zshao/sync/apache-trunk-HIVE-105/ql/../build/ql/tmp/731171602.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/commits/hive_trunk_ws2/ql/../build/ql/tmp/284773865.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -675,9 +681,15 @@
           </void> 
           <void property="conf"> 
            <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+            <void property="aggMethods"> 
+             <object class="java.util.ArrayList"/> 
+            </void> 
             <void property="aggregators"> 
              <object class="java.util.ArrayList"/> 
             </void> 
+            <void property="evalMethods"> 
+             <object class="java.util.ArrayList"/> 
+            </void> 
             <void property="keys"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -761,7 +773,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -773,7 +785,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -825,7 +837,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby5.q.xml b/ql/src/test/results/compiler/plan/groupby5.q.xml
index 154a27427a..7292b0cb5c 100644
--- a/ql/src/test/results/compiler/plan/groupby5.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby5.q.xml
@@ -20,7 +20,7 @@
         <void property="aliasToWork"> 
          <object class="java.util.HashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/475879510/9101030.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/259144896/37104862.10002</string> 
            <object id="ReduceSinkOperator0" class="org.apache.hadoop.hive.ql.exec.ReduceSinkOperator"> 
             <void property="conf"> 
              <object class="org.apache.hadoop.hive.ql.plan.reduceSinkDesc"> 
@@ -144,7 +144,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/475879510/9101030.10002</string> 
+                       <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/259144896/37104862.10002</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -218,6 +218,13 @@
                 </void> 
                 <void property="conf"> 
                  <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+                  <void property="aggMethods"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <string>iterate</string> 
+                    </void> 
+                   </object> 
+                  </void> 
                   <void property="aggregators"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -267,6 +274,13 @@
                     </void> 
                    </object> 
                   </void> 
+                  <void property="evalMethods"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <string>terminatePartial</string> 
+                    </void> 
+                   </object> 
+                  </void> 
                   <void property="keys"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -579,10 +593,10 @@
         <void property="pathToAliases"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/475879510/9101030.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/259144896/37104862.10002</string> 
            <object class="java.util.ArrayList"> 
             <void method="add"> 
-             <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/475879510/9101030.10002</string> 
+             <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/259144896/37104862.10002</string> 
             </void> 
            </object> 
           </void> 
@@ -591,7 +605,7 @@
         <void property="pathToPartitionInfo"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/475879510/9101030.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/259144896/37104862.10002</string> 
            <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
             <void property="tableDesc"> 
              <object idref="tableDesc2"/> 
@@ -613,7 +627,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/zshao/sync/apache-trunk-HIVE-105/ql/../build/ql/tmp/475879510/9101030.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/commits/hive_trunk_ws2/ql/../build/ql/tmp/259144896/37104862.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -729,6 +743,13 @@
           </void> 
           <void property="conf"> 
            <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+            <void property="aggMethods"> 
+             <object class="java.util.ArrayList"> 
+              <void method="add"> 
+               <string>merge</string> 
+              </void> 
+             </object> 
+            </void> 
             <void property="aggregators"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -754,6 +775,13 @@
               </void> 
              </object> 
             </void> 
+            <void property="evalMethods"> 
+             <object class="java.util.ArrayList"> 
+              <void method="add"> 
+               <string>terminate</string> 
+              </void> 
+             </object> 
+            </void> 
             <void property="keys"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -847,7 +875,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -859,7 +887,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -911,7 +939,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby6.q.xml b/ql/src/test/results/compiler/plan/groupby6.q.xml
index 911c364dea..14ea035799 100644
--- a/ql/src/test/results/compiler/plan/groupby6.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby6.q.xml
@@ -20,7 +20,7 @@
         <void property="aliasToWork"> 
          <object class="java.util.HashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/593011474/260610884.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/1903292308/734509258.10002</string> 
            <object id="ReduceSinkOperator0" class="org.apache.hadoop.hive.ql.exec.ReduceSinkOperator"> 
             <void property="conf"> 
              <object class="org.apache.hadoop.hive.ql.plan.reduceSinkDesc"> 
@@ -129,7 +129,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/593011474/260610884.10002</string> 
+                       <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/1903292308/734509258.10002</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -193,9 +193,15 @@
                 </void> 
                 <void property="conf"> 
                  <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+                  <void property="aggMethods"> 
+                   <object class="java.util.ArrayList"/> 
+                  </void> 
                   <void property="aggregators"> 
                    <object class="java.util.ArrayList"/> 
                   </void> 
+                  <void property="evalMethods"> 
+                   <object class="java.util.ArrayList"/> 
+                  </void> 
                   <void property="keys"> 
                    <object class="java.util.ArrayList"> 
                     <void method="add"> 
@@ -545,10 +551,10 @@
         <void property="pathToAliases"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/593011474/260610884.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/1903292308/734509258.10002</string> 
            <object class="java.util.ArrayList"> 
             <void method="add"> 
-             <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/593011474/260610884.10002</string> 
+             <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/1903292308/734509258.10002</string> 
             </void> 
            </object> 
           </void> 
@@ -557,7 +563,7 @@
         <void property="pathToPartitionInfo"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/tmp/593011474/260610884.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/1903292308/734509258.10002</string> 
            <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
             <void property="tableDesc"> 
              <object idref="tableDesc2"/> 
@@ -579,7 +585,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/zshao/sync/apache-trunk-HIVE-105/ql/../build/ql/tmp/14682144.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/commits/hive_trunk_ws2/ql/../build/ql/tmp/279156304.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -675,9 +681,15 @@
           </void> 
           <void property="conf"> 
            <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
+            <void property="aggMethods"> 
+             <object class="java.util.ArrayList"/> 
+            </void> 
             <void property="aggregators"> 
              <object class="java.util.ArrayList"/> 
             </void> 
+            <void property="evalMethods"> 
+             <object class="java.util.ArrayList"/> 
+            </void> 
             <void property="keys"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
@@ -761,7 +773,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -773,7 +785,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -825,7 +837,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/zshao/sync/apache-trunk-HIVE-105/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/commits/hive_trunk_ws2/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
