diff --git a/CHANGES.txt b/CHANGES.txt
index 6bcb4cbc25..fb5f5866d0 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -267,6 +267,9 @@ Trunk - Unreleased
 
     HIVE-575. Fix Map join out-of-memory problem. (Namit Jain via zshao)
 
+    HIVE-472. HiveFileFormatUtils's checkInputFormat does not include RCFile.
+    (He Yongqiang via namit)
+
 Release 0.3.1 - Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/MoveTask.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/MoveTask.java
index 5c4bd77875..1d797aa3f0 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/MoveTask.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/MoveTask.java
@@ -123,7 +123,9 @@ public int execute() {
           }
 
           // Check if the file format of the file matches that of the table.
-          HiveFileFormatUtils.checkInputFormat(fs, conf, tbd.getTable().getInputFileFormatClass(), files);
+          boolean flag = HiveFileFormatUtils.checkInputFormat(fs, conf, tbd.getTable().getInputFileFormatClass(), files);
+          if(!flag)
+            throw new HiveException("Wrong file format. Please check the file's format.");
         }
 
         if(tbd.getPartitionSpec().size() == 0) {
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java b/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java
index 5eecaade8e..84d4ac8dc2 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/io/HiveFileFormatUtils.java
@@ -22,6 +22,7 @@
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.Map;
+import java.util.Set;
 
 import org.apache.hadoop.fs.FileStatus;
 import org.apache.hadoop.fs.FileSystem;
@@ -35,6 +36,7 @@
 import org.apache.hadoop.mapred.OutputFormat;
 import org.apache.hadoop.mapred.SequenceFileInputFormat;
 import org.apache.hadoop.mapred.SequenceFileOutputFormat;
+import org.apache.hadoop.mapred.TextInputFormat;
 
 /**
  * An util class for various Hive file format tasks.
@@ -43,9 +45,6 @@
  * compatibility. They return the newly added HiveOutputFormat for the older 
  * ones.
  * 
- * }
- * 
- * 
  */
 public class HiveFileFormatUtils {
 
@@ -59,7 +58,7 @@ public class HiveFileFormatUtils {
 
   @SuppressWarnings("unchecked")
   private static Map<Class<? extends OutputFormat>, Class<? extends HiveOutputFormat>> outputFormatSubstituteMap;
-
+  
   /**
    * register a substitute
    * 
@@ -104,35 +103,87 @@ public static Path getOutputFormatFinalPath(Path parent, JobConf jc,
     }
     return defaultFinalPath;
   }
+  
+  static {
+    inputFormatCheckerMap = new HashMap<Class<? extends InputFormat>, Class<? extends InputFormatChecker>>();
+    HiveFileFormatUtils.registerInputFormatChecker(SequenceFileInputFormat.class, SequenceFileInputFormatChecker.class);
+    HiveFileFormatUtils.registerInputFormatChecker(RCFileInputFormat.class, RCFileInputFormat.class);
+    inputFormatCheckerInstanceCache = new HashMap<Class<? extends InputFormatChecker>, InputFormatChecker>();
+  }
+
+  @SuppressWarnings("unchecked")
+  private static Map<Class<? extends InputFormat>, Class<? extends InputFormatChecker>> inputFormatCheckerMap;
+
+  private static Map<Class<? extends InputFormatChecker>, InputFormatChecker> inputFormatCheckerInstanceCache;
+
+  /**
+   * register an InputFormatChecker for a given InputFormat
+   * 
+   * @param format
+   *          the class that need to be substituted
+   * @param checker
+   */
+  @SuppressWarnings("unchecked")
+  public synchronized static void registerInputFormatChecker(
+      Class<? extends InputFormat> format,
+      Class<? extends InputFormatChecker> checker) {
+    inputFormatCheckerMap.put(format, checker);
+  }
+
+	/**
+   * get an InputFormatChecker for a file format.
+   */
+  public synchronized static Class<? extends InputFormatChecker> getInputFormatChecker(
+      Class<?> inputFormat) {
+    Class<? extends InputFormatChecker> result = inputFormatCheckerMap.get(inputFormat);
+    return result;
+  }
 
   /**
    * checks if files are in same format as the given input format
    */
+  @SuppressWarnings("unchecked")
   public static boolean checkInputFormat(FileSystem fs, HiveConf conf,
       Class<? extends InputFormat> inputFormatCls, ArrayList<FileStatus> files)
       throws HiveException {
     if (files.size() > 0) {
-      boolean tableIsSequenceFile = inputFormatCls
-          .equals(SequenceFileInputFormat.class);
-      int fileId = 0;
-      boolean fileIsSequenceFile = true;
-      try {
-        SequenceFile.Reader reader = new SequenceFile.Reader(fs, files.get(
-            fileId).getPath(), conf);
-        reader.close();
-      } catch (IOException e) {
-        fileIsSequenceFile = false;
-      }
-      if (!fileIsSequenceFile && tableIsSequenceFile) {
-        throw new HiveException(
-            "Cannot load text files into a table stored as SequenceFile.");
+      Class<? extends InputFormatChecker> checkerCls = getInputFormatChecker(inputFormatCls);
+      if(checkerCls==null && inputFormatCls.isAssignableFrom(TextInputFormat.class)) {
+        // we get a text input format here, we can not determine a file is text
+        // according to its content, so we can do is to test if other file
+        // format can accept it. If one other file format can accept this file,
+        // we treat this file as text file, although it maybe not.
+       return checkTextInputFormat(fs, conf, files);
       }
-      if (fileIsSequenceFile && !tableIsSequenceFile) {
-        throw new HiveException(
-            "Cannot load SequenceFiles into a table stored as TextFile.");
+      
+      if (checkerCls != null) {
+        InputFormatChecker checkerInstance = inputFormatCheckerInstanceCache
+            .get(checkerCls);
+        try {
+          if (checkerInstance == null) {
+            checkerInstance = checkerCls.newInstance();
+            inputFormatCheckerInstanceCache.put(checkerCls, checkerInstance);
+          }
+          return checkerInstance.validateInput(fs, conf, files);
+        } catch (Exception e) {
+          throw new HiveException(e);
+        }
       }
       return true;
     }
     return false;
   }
+
+  @SuppressWarnings("unchecked")
+  private static boolean checkTextInputFormat(FileSystem fs, HiveConf conf,
+      ArrayList<FileStatus> files) throws HiveException {
+    Set<Class<? extends InputFormat>> inputFormatter = inputFormatCheckerMap
+        .keySet();
+    for (Class<? extends InputFormat> reg : inputFormatter) {
+      boolean result = checkInputFormat(fs, conf, reg, files);
+      if (result)
+        return false;
+    }
+    return true;
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/io/InputFormatChecker.java b/ql/src/java/org/apache/hadoop/hive/ql/io/InputFormatChecker.java
new file mode 100644
index 0000000000..1bbf3b1155
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/io/InputFormatChecker.java
@@ -0,0 +1,39 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.io;
+
+import java.io.IOException;
+import java.util.ArrayList;
+
+import org.apache.hadoop.fs.FileStatus;
+import org.apache.hadoop.fs.FileSystem;
+import org.apache.hadoop.hive.conf.HiveConf;
+
+/**
+ * Check for validity of the input files.
+ */
+public interface InputFormatChecker {
+
+	/**
+	 * This method is used to validate the input files
+	 * 
+	 */
+	public boolean validateInput(FileSystem fs, HiveConf conf, ArrayList<FileStatus> files) throws IOException;
+
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/io/RCFileInputFormat.java b/ql/src/java/org/apache/hadoop/hive/ql/io/RCFileInputFormat.java
index 2edfa6412b..227aa54860 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/io/RCFileInputFormat.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/io/RCFileInputFormat.java
@@ -19,7 +19,11 @@
 package org.apache.hadoop.hive.ql.io;
 
 import java.io.IOException;
+import java.util.ArrayList;
 
+import org.apache.hadoop.fs.FileStatus;
+import org.apache.hadoop.fs.FileSystem;
+import org.apache.hadoop.hive.conf.HiveConf;
 import org.apache.hadoop.hive.serde2.columnar.BytesRefArrayWritable;
 import org.apache.hadoop.io.LongWritable;
 import org.apache.hadoop.io.SequenceFile;
@@ -31,7 +35,7 @@
 import org.apache.hadoop.mapred.Reporter;
 
 public class RCFileInputFormat<K extends LongWritable, V extends BytesRefArrayWritable>
-    extends FileInputFormat<K, V> {
+    extends FileInputFormat<K, V> implements InputFormatChecker{
 
   public RCFileInputFormat() {
     setMinSplitSize(SequenceFile.SYNC_INTERVAL);
@@ -45,4 +49,20 @@ public RecordReader<K, V> getRecordReader(InputSplit split, JobConf job,
 
     return new RCFileRecordReader(job, (FileSplit) split);
   }
+
+  @Override
+  public boolean validateInput(FileSystem fs, HiveConf conf,
+      ArrayList<FileStatus> files) throws IOException {
+    if (files.size() <= 0)
+      return false;
+    for (int fileId = 0; fileId < files.size(); fileId++) {
+      try {
+        RCFile.Reader reader = new RCFile.Reader(fs, files.get(fileId).getPath(), conf);
+        reader.close();
+      } catch (IOException e) {
+        return false;
+      }
+    }
+    return true;
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/io/SequenceFileInputFormatChecker.java b/ql/src/java/org/apache/hadoop/hive/ql/io/SequenceFileInputFormatChecker.java
new file mode 100644
index 0000000000..feff3fa1a0
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/io/SequenceFileInputFormatChecker.java
@@ -0,0 +1,48 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.io;
+
+import java.io.IOException;
+import java.util.ArrayList;
+
+import org.apache.hadoop.fs.FileStatus;
+import org.apache.hadoop.fs.FileSystem;
+import org.apache.hadoop.hive.conf.HiveConf;
+import org.apache.hadoop.io.SequenceFile;
+
+public class SequenceFileInputFormatChecker implements InputFormatChecker {
+
+  @Override
+  public boolean validateInput(FileSystem fs, HiveConf conf,
+      ArrayList<FileStatus> files) throws IOException {
+    if (files.size() <= 0)
+      return false;
+    for (int fileId = 0; fileId < files.size(); fileId++) {
+      try {
+        SequenceFile.Reader reader = new SequenceFile.Reader(fs, files.get(
+            fileId).getPath(), conf);
+        reader.close();
+      } catch (IOException e) {
+        return false;
+      }
+    }
+    return true;
+  }
+
+}
diff --git a/ql/src/test/queries/clientnegative/load_wrong_fileformat_rc_seq.q b/ql/src/test/queries/clientnegative/load_wrong_fileformat_rc_seq.q
new file mode 100644
index 0000000000..e4af72e3c5
--- /dev/null
+++ b/ql/src/test/queries/clientnegative/load_wrong_fileformat_rc_seq.q
@@ -0,0 +1,6 @@
+-- test for loading into tables with the correct file format
+-- test for loading into partitions with the correct file format
+
+DROP TABLE T1;
+CREATE TABLE T1(name STRING) STORED AS RCFILE;
+LOAD DATA LOCAL INPATH '../data/files/kv1.seq' INTO TABLE T1;
\ No newline at end of file
diff --git a/ql/src/test/queries/clientnegative/load_wrong_fileformat_txt_seq.q b/ql/src/test/queries/clientnegative/load_wrong_fileformat_txt_seq.q
new file mode 100644
index 0000000000..90d118a5f1
--- /dev/null
+++ b/ql/src/test/queries/clientnegative/load_wrong_fileformat_txt_seq.q
@@ -0,0 +1,6 @@
+-- test for loading into tables with the correct file format
+-- test for loading into partitions with the correct file format
+
+DROP TABLE T1;
+CREATE TABLE T1(name STRING) STORED AS TEXTFILE;
+LOAD DATA LOCAL INPATH '../data/files/kv1.seq' INTO TABLE T1;
\ No newline at end of file
diff --git a/ql/src/test/results/clientnegative/load_wrong_fileformat.q.out b/ql/src/test/results/clientnegative/load_wrong_fileformat.q.out
index 3f6360d4f9..da9421b2dc 100644
--- a/ql/src/test/results/clientnegative/load_wrong_fileformat.q.out
+++ b/ql/src/test/results/clientnegative/load_wrong_fileformat.q.out
@@ -4,5 +4,5 @@ query: -- test for loading into tables with the correct file format
 DROP TABLE T1
 query: CREATE TABLE T1(name STRING) STORED AS SEQUENCEFILE
 query: LOAD DATA LOCAL INPATH '../data/files/kv1.txt' INTO TABLE T1
-Failed with exception Cannot load text files into a table stored as SequenceFile.
+Failed with exception Wrong file format. Please check the file's format.
 FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask
diff --git a/ql/src/test/results/clientnegative/load_wrong_fileformat_rc_seq.q.out b/ql/src/test/results/clientnegative/load_wrong_fileformat_rc_seq.q.out
new file mode 100644
index 0000000000..dfa9fc1d9a
--- /dev/null
+++ b/ql/src/test/results/clientnegative/load_wrong_fileformat_rc_seq.q.out
@@ -0,0 +1,8 @@
+query: -- test for loading into tables with the correct file format
+-- test for loading into partitions with the correct file format
+
+DROP TABLE T1
+query: CREATE TABLE T1(name STRING) STORED AS RCFILE
+query: LOAD DATA LOCAL INPATH '../data/files/kv1.seq' INTO TABLE T1
+Failed with exception Wrong file format. Please check the file's format.
+FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask
diff --git a/ql/src/test/results/clientnegative/load_wrong_fileformat_txt_seq.q.out b/ql/src/test/results/clientnegative/load_wrong_fileformat_txt_seq.q.out
new file mode 100644
index 0000000000..cd625f3feb
--- /dev/null
+++ b/ql/src/test/results/clientnegative/load_wrong_fileformat_txt_seq.q.out
@@ -0,0 +1,8 @@
+query: -- test for loading into tables with the correct file format
+-- test for loading into partitions with the correct file format
+
+DROP TABLE T1
+query: CREATE TABLE T1(name STRING) STORED AS TEXTFILE
+query: LOAD DATA LOCAL INPATH '../data/files/kv1.seq' INTO TABLE T1
+Failed with exception Wrong file format. Please check the file's format.
+FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask
