diff --git a/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/DatabaseProduct.java b/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/DatabaseProduct.java
index 8418e59cf1..0c1511b5c5 100644
--- a/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/DatabaseProduct.java
+++ b/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/DatabaseProduct.java
@@ -77,8 +77,16 @@ public static DatabaseProduct determineDatabaseProduct(String productName,
       Configuration conf) {
     DbType dbt;
 
+    Preconditions.checkNotNull(conf, "Configuration is null");
+    // Check if we are using an external database product
+    boolean isExternal = MetastoreConf.getBoolVar(conf, ConfVars.USE_CUSTOM_RDBMS);
+
     if (theDatabaseProduct != null) {
-      Preconditions.checkState(theDatabaseProduct.dbType == getDbType(productName));
+      dbt = getDbType(productName);
+      if (isExternal) {
+        dbt = DbType.CUSTOM;
+      }
+      Preconditions.checkState(theDatabaseProduct.dbType == dbt);
       return theDatabaseProduct;
     }
 
@@ -93,10 +101,6 @@ public static DatabaseProduct determineDatabaseProduct(String productName,
 
       // Check for null again in case of race condition
       if (theDatabaseProduct == null) {
-        Preconditions.checkNotNull(conf, "Configuration is null");
-        // Check if we are using an external database product
-        boolean isExternal = MetastoreConf.getBoolVar(conf, ConfVars.USE_CUSTOM_RDBMS);
-
         if (isExternal) {
           // The DatabaseProduct will be created by instantiating an external class via
           // reflection. The external class can override any method in the current class
