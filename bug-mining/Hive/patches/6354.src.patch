diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/cost/HiveVolcanoPlanner.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/cost/HiveVolcanoPlanner.java
index fbf2202679..23ff518ada 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/cost/HiveVolcanoPlanner.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/cost/HiveVolcanoPlanner.java
@@ -23,15 +23,15 @@
 import org.apache.calcite.plan.Convention;
 import org.apache.calcite.plan.ConventionTraitDef;
 import org.apache.calcite.plan.RelOptCost;
-import org.apache.calcite.plan.RelOptCostImpl;
 import org.apache.calcite.plan.RelOptPlanner;
+import org.apache.calcite.plan.RelOptUtil;
 import org.apache.calcite.plan.volcano.RelSubset;
 import org.apache.calcite.plan.volcano.VolcanoPlanner;
 import org.apache.calcite.rel.RelCollationTraitDef;
 import org.apache.calcite.rel.RelNode;
 import org.apache.calcite.rel.core.TableScan;
 import org.apache.calcite.rel.metadata.RelMetadataQuery;
-import org.apache.commons.math3.util.FastMath;
+import org.apache.calcite.util.Util;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveConfPlannerContext;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HivePlannerContext;
 import org.apache.hadoop.hive.ql.optimizer.calcite.RelOptHiveTable;
@@ -48,7 +48,6 @@ public class HiveVolcanoPlanner extends VolcanoPlanner {
   private static final boolean ENABLE_COLLATION_TRAIT = true;
 
   private final boolean isHeuristic;
-  private static final double FACTOR = 0.2d;
 
 
   /** Creates a HiveVolcanoPlanner. */
@@ -96,7 +95,9 @@ public void registerClass(RelNode node) {
   public RelOptCost getCost(RelNode rel, RelMetadataQuery mq) {
     assert rel != null : "pre-condition: rel != null";
     if (rel instanceof RelSubset) {
-      return getCost(((RelSubset) rel).getBest(), mq);
+      // Get cost of the subset, best rel may have been chosen or not
+      RelSubset subset = (RelSubset) rel;
+      return getCost(Util.first(subset.getBest(), subset.getOriginal()), mq);
     }
     if (rel.getTraitSet().getTrait(ConventionTraitDef.INSTANCE)
         == Convention.NONE) {
@@ -121,15 +122,19 @@ public RelOptCost getCost(RelNode rel, RelMetadataQuery mq) {
       }
     }
     if (isHeuristic && usesMaterializedViews) {
-      cost = costFactory.makeTinyCost();
+      // If a child of this expression uses a materialized view,
+      // then we decrease its cost by a certain factor. This is
+      // useful for e.g. partial rewritings, where a part of plan
+      // does not use the materialization, but we still want to
+      // decrease its cost so it is chosen instead of the original
+      // plan
+      cost = cost.multiplyBy(RelOptUtil.EPSILON);
+      if (!costFactory.makeZeroCost().isLt(cost)) {
+        // cost must be positive, so nudge it
+        cost = costFactory.makeTinyCost();
+      }
       for (RelNode input : rel.getInputs()) {
-        // If a child of this expression uses a materialized view,
-        // then we decrease its cost by a certain factor. This is
-        // useful for e.g. partial rewritings, where a part of plan
-        // does not use the materialization, but we still want to
-        // decrease its cost so it is chosen instead of the original
-        // plan
-        cost = cost.plus(getCost(input, mq).multiplyBy(FACTOR));
+        cost = cost.plus(getCost(input, mq));
       }
     } else {
       // No materialized view or not heuristic approach, normal costing
diff --git a/ql/src/test/results/clientpositive/beeline/materialized_view_create_rewrite.q.out b/ql/src/test/results/clientpositive/beeline/materialized_view_create_rewrite.q.out
index 1574fc7c27..17343e7721 100644
--- a/ql/src/test/results/clientpositive/beeline/materialized_view_create_rewrite.q.out
+++ b/ql/src/test/results/clientpositive/beeline/materialized_view_create_rewrite.q.out
@@ -266,7 +266,7 @@ POSTHOOK: query: alter materialized view cmv_mat_view2 enable rewrite
 POSTHOOK: type: ALTER_MATERIALIZED_VIEW_REWRITE
 POSTHOOK: Input: default@cmv_mat_view2
 POSTHOOK: Output: default@cmv_mat_view2
-Warning: Shuffle Join JOIN[7][tables = [$hdt$_0, $hdt$_1]] in Stage 'Stage-1:MAPRED' is a cross product
+Warning: Shuffle Join JOIN[6][tables = [test_db_materialized_view_create_rewrite.cmv_mat_view2, $hdt$_0]] in Stage 'Stage-1:MAPRED' is a cross product
 PREHOOK: query: explain
 select * from (
   (select a, c from cmv_basetable where a = 3) table1
@@ -289,17 +289,6 @@ STAGE PLANS:
   Stage: Stage-1
     Map Reduce
       Map Operator Tree:
-          TableScan
-            alias: default.cmv_mat_view2
-            Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
-            Select Operator
-              expressions: c (type: decimal(10,2))
-              outputColumnNames: _col0
-              Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
-              Reduce Output Operator
-                sort order: 
-                Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
-                value expressions: _col0 (type: decimal(10,2))
           TableScan
             alias: cmv_basetable
             Statistics: Num rows: 5 Data size: 1205 Basic stats: COMPLETE Column stats: NONE
@@ -314,6 +303,13 @@ STAGE PLANS:
                   sort order: 
                   Statistics: Num rows: 1 Data size: 241 Basic stats: COMPLETE Column stats: NONE
                   value expressions: _col1 (type: decimal(10,2))
+          TableScan
+            alias: default.cmv_mat_view2
+            Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
+            Reduce Output Operator
+              sort order: 
+              Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
+              value expressions: a (type: int), c (type: decimal(10,2))
       Reduce Operator Tree:
         Join Operator
           condition map:
@@ -321,10 +317,10 @@ STAGE PLANS:
           keys:
             0 
             1 
-          outputColumnNames: _col0, _col2
+          outputColumnNames: _col0, _col1, _col6
           Statistics: Num rows: 2 Data size: 716 Basic stats: COMPLETE Column stats: NONE
           Select Operator
-            expressions: 3 (type: int), _col0 (type: decimal(10,2)), 3 (type: int), _col2 (type: decimal(10,2))
+            expressions: _col0 (type: int), _col1 (type: decimal(10,2)), _col0 (type: int), _col6 (type: decimal(10,2))
             outputColumnNames: _col0, _col1, _col2, _col3
             Statistics: Num rows: 2 Data size: 716 Basic stats: COMPLETE Column stats: NONE
             File Output Operator
@@ -341,7 +337,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join JOIN[7][tables = [$hdt$_0, $hdt$_1]] in Stage 'Stage-1:MAPRED' is a cross product
+Warning: Shuffle Join JOIN[6][tables = [test_db_materialized_view_create_rewrite.cmv_mat_view2, $hdt$_0]] in Stage 'Stage-1:MAPRED' is a cross product
 PREHOOK: query: select * from (
   (select a, c from cmv_basetable where a = 3) table1
   join
diff --git a/ql/src/test/results/clientpositive/llap/materialized_view_create_rewrite.q.out b/ql/src/test/results/clientpositive/llap/materialized_view_create_rewrite.q.out
index 7d46874818..f9879f7ba9 100644
--- a/ql/src/test/results/clientpositive/llap/materialized_view_create_rewrite.q.out
+++ b/ql/src/test/results/clientpositive/llap/materialized_view_create_rewrite.q.out
@@ -278,7 +278,7 @@ POSTHOOK: query: alter materialized view cmv_mat_view2 enable rewrite
 POSTHOOK: type: ALTER_MATERIALIZED_VIEW_REWRITE
 POSTHOOK: Input: default@cmv_mat_view2
 POSTHOOK: Output: default@cmv_mat_view2
-Warning: Shuffle Join MERGEJOIN[11][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
+Warning: Shuffle Join MERGEJOIN[10][tables = [default.cmv_mat_view2, $hdt$_0]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: explain
 select * from (
   (select a, c from cmv_basetable where a = 3) table1
@@ -306,21 +306,6 @@ STAGE PLANS:
 #### A masked pattern was here ####
       Vertices:
         Map 1 
-            Map Operator Tree:
-                TableScan
-                  alias: default.cmv_mat_view2
-                  Statistics: Num rows: 2 Data size: 224 Basic stats: COMPLETE Column stats: NONE
-                  Select Operator
-                    expressions: c (type: decimal(10,2))
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 2 Data size: 224 Basic stats: COMPLETE Column stats: NONE
-                    Reduce Output Operator
-                      sort order: 
-                      Statistics: Num rows: 2 Data size: 224 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col0 (type: decimal(10,2))
-            Execution mode: llap
-            LLAP IO: all inputs
-        Map 3 
             Map Operator Tree:
                 TableScan
                   alias: cmv_basetable
@@ -338,6 +323,17 @@ STAGE PLANS:
                         value expressions: _col1 (type: decimal(10,2))
             Execution mode: llap
             LLAP IO: may be used (ACID table)
+        Map 3 
+            Map Operator Tree:
+                TableScan
+                  alias: default.cmv_mat_view2
+                  Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    sort order: 
+                    Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: a (type: int), c (type: decimal(10,2))
+            Execution mode: llap
+            LLAP IO: all inputs
         Reducer 2 
             Execution mode: llap
             Reduce Operator Tree:
@@ -347,15 +343,15 @@ STAGE PLANS:
                 keys:
                   0 
                   1 
-                outputColumnNames: _col0, _col2
-                Statistics: Num rows: 2 Data size: 466 Basic stats: COMPLETE Column stats: NONE
+                outputColumnNames: _col0, _col1, _col6
+                Statistics: Num rows: 2 Data size: 474 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
-                  expressions: 3 (type: int), _col0 (type: decimal(10,2)), 3 (type: int), _col2 (type: decimal(10,2))
+                  expressions: _col0 (type: int), _col1 (type: decimal(10,2)), _col0 (type: int), _col6 (type: decimal(10,2))
                   outputColumnNames: _col0, _col1, _col2, _col3
-                  Statistics: Num rows: 2 Data size: 466 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 2 Data size: 474 Basic stats: COMPLETE Column stats: NONE
                   File Output Operator
                     compressed: false
-                    Statistics: Num rows: 2 Data size: 466 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 2 Data size: 474 Basic stats: COMPLETE Column stats: NONE
                     table:
                         input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                         output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
@@ -367,7 +363,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[11][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
+Warning: Shuffle Join MERGEJOIN[10][tables = [default.cmv_mat_view2, $hdt$_0]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select * from (
   (select a, c from cmv_basetable where a = 3) table1
   join
diff --git a/ql/src/test/results/clientpositive/llap/materialized_view_create_rewrite_dummy.q.out b/ql/src/test/results/clientpositive/llap/materialized_view_create_rewrite_dummy.q.out
index 7d46874818..f9879f7ba9 100644
--- a/ql/src/test/results/clientpositive/llap/materialized_view_create_rewrite_dummy.q.out
+++ b/ql/src/test/results/clientpositive/llap/materialized_view_create_rewrite_dummy.q.out
@@ -278,7 +278,7 @@ POSTHOOK: query: alter materialized view cmv_mat_view2 enable rewrite
 POSTHOOK: type: ALTER_MATERIALIZED_VIEW_REWRITE
 POSTHOOK: Input: default@cmv_mat_view2
 POSTHOOK: Output: default@cmv_mat_view2
-Warning: Shuffle Join MERGEJOIN[11][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
+Warning: Shuffle Join MERGEJOIN[10][tables = [default.cmv_mat_view2, $hdt$_0]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: explain
 select * from (
   (select a, c from cmv_basetable where a = 3) table1
@@ -306,21 +306,6 @@ STAGE PLANS:
 #### A masked pattern was here ####
       Vertices:
         Map 1 
-            Map Operator Tree:
-                TableScan
-                  alias: default.cmv_mat_view2
-                  Statistics: Num rows: 2 Data size: 224 Basic stats: COMPLETE Column stats: NONE
-                  Select Operator
-                    expressions: c (type: decimal(10,2))
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 2 Data size: 224 Basic stats: COMPLETE Column stats: NONE
-                    Reduce Output Operator
-                      sort order: 
-                      Statistics: Num rows: 2 Data size: 224 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col0 (type: decimal(10,2))
-            Execution mode: llap
-            LLAP IO: all inputs
-        Map 3 
             Map Operator Tree:
                 TableScan
                   alias: cmv_basetable
@@ -338,6 +323,17 @@ STAGE PLANS:
                         value expressions: _col1 (type: decimal(10,2))
             Execution mode: llap
             LLAP IO: may be used (ACID table)
+        Map 3 
+            Map Operator Tree:
+                TableScan
+                  alias: default.cmv_mat_view2
+                  Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    sort order: 
+                    Statistics: Num rows: 2 Data size: 232 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: a (type: int), c (type: decimal(10,2))
+            Execution mode: llap
+            LLAP IO: all inputs
         Reducer 2 
             Execution mode: llap
             Reduce Operator Tree:
@@ -347,15 +343,15 @@ STAGE PLANS:
                 keys:
                   0 
                   1 
-                outputColumnNames: _col0, _col2
-                Statistics: Num rows: 2 Data size: 466 Basic stats: COMPLETE Column stats: NONE
+                outputColumnNames: _col0, _col1, _col6
+                Statistics: Num rows: 2 Data size: 474 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
-                  expressions: 3 (type: int), _col0 (type: decimal(10,2)), 3 (type: int), _col2 (type: decimal(10,2))
+                  expressions: _col0 (type: int), _col1 (type: decimal(10,2)), _col0 (type: int), _col6 (type: decimal(10,2))
                   outputColumnNames: _col0, _col1, _col2, _col3
-                  Statistics: Num rows: 2 Data size: 466 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 2 Data size: 474 Basic stats: COMPLETE Column stats: NONE
                   File Output Operator
                     compressed: false
-                    Statistics: Num rows: 2 Data size: 466 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 2 Data size: 474 Basic stats: COMPLETE Column stats: NONE
                     table:
                         input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                         output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
@@ -367,7 +363,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[11][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
+Warning: Shuffle Join MERGEJOIN[10][tables = [default.cmv_mat_view2, $hdt$_0]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select * from (
   (select a, c from cmv_basetable where a = 3) table1
   join
