diff --git a/ant/build.xml b/ant/build.xml
index c4351d06c4..e23d6ddc6f 100644
--- a/ant/build.xml
+++ b/ant/build.xml
@@ -27,12 +27,8 @@ to call at top-level: ant deploy-contrib compile-core-test
   <property name="src.dir"  location="${basedir}/src"/>
   <import file="../build-common.xml"/>
 
-  <target name="init" depends="create-dirs">
-    <echo message="Project: ${ant.project.name}"/>
-  </target>
-
-  <target name="compile" depends="init">
-    <echo message="Project: ${ant.project.name}"/>
+  <target name="compile" depends="init,ivy-retrieve">
+    <echo message="${ant.project.name}"/>
     <javac
      encoding="${build.encoding}"
      srcdir="${src.dir}"
@@ -46,7 +42,7 @@ to call at top-level: ant deploy-contrib compile-core-test
   </target>
 
   <target name="jar" depends="compile">
-    <echo message="Project: ${ant.project.name}"/>
+    <echo message="${ant.project.name}"/>
     <copy file="${src.dir}/org/apache/hadoop/hive/ant/antlib.xml"
           todir="${build.dir}/classes/org/apache/hadoop/hive/ant"/>
     <jar destfile="${build.dir}/hive-anttasks-${version}.jar">
diff --git a/ant/ivy.xml b/ant/ivy.xml
index deb96f0854..0fe0a23009 100644
--- a/ant/ivy.xml
+++ b/ant/ivy.xml
@@ -15,12 +15,18 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-anttasks" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-
+  <info organisation="${hive.ivy.org}" module="hive-anttasks" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <dependency org="commons-lang" name="commons-lang" rev="${commons-lang.version}"/>
+    <dependency org="velocity" name="velocity" rev="${velocity.version}" transitive="false"/>
+  </dependencies>
 </ivy-module>
diff --git a/build-common.xml b/build-common.xml
index 37b32ec7b0..eca98f7c2a 100644
--- a/build-common.xml
+++ b/build-common.xml
@@ -72,24 +72,7 @@
   </path>
 
 
-  <!-- IVY properties set here -->
-  <property name="build.ivy.dir" location="${build.dir.hive}/ivy"/>
-  <property name="build.ivy.lib.dir" location="${build.ivy.dir}/lib"/>
-  <property name="build.ivy.report.dir" location="${build.ivy.dir}/report"/>
-  <property name="build.ivy.maven.dir" location="${build.ivy.dir}/maven"/>
-  <property name="ivy.conf.dir" location="${hive.root}/ivy"/>
   <loadproperties srcfile="${ivy.conf.dir}/libraries.properties"/>
-  <property name="ivy.jar" location="${build.ivy.lib.dir}/ivy-${ivy.version}.jar"/>
-  <property name="ivysettings.xml" location="${ivy.conf.dir}/ivysettings.xml" />
-  <property name="mvn.repo" value="http://repo2.maven.org/maven2"/>
-  <property name="ivy_repo_url" value="${mvn.repo}/org/apache/ivy/ivy/${ivy.version}/ivy-${ivy.version}.jar"/>
-
-  <!-- Maven properties set here -->
-  <property name="hive.ivy.org" value="org.apache.hive"/>
-  <property name="mvn.publish.repo" value="snapshots"/>
-  <property name="mvn.jar.dir" value="${build.dir.hive}/maven/jars"/>
-  <property name="mvn.pom.dir" value="${build.dir.hive}/maven/poms"/>
-  <property name="mvn.license.dir" value="${build.dir.hive}/maven/licenses"/>
 
   <condition property="offline">
     <istrue value="${is-offline}"/>
@@ -107,10 +90,7 @@
   <!--this is the naming policy for artifacts we want pulled down-->
   <property name="ivy.artifact.retrieve.pattern" value="[conf]/[artifact]-[revision](-[classifier]).[ext]"/>
 
-  <property name="ivyresolvelog" value="download-only"/>
-  <property name="ivyretrievelog" value="quite"/>
-
-  <target name="ivy-init">
+  <target name="ivy-init-settings">
     <!--Configure Ivy by reading in the settings file
         If anyone has already read in a settings file into this settings ID, it gets priority
     -->
@@ -118,10 +98,12 @@
     <ivy:settings id="${ant.project.name}.ivy.settings" file="${ivysettings.xml}"/>
   </target>
 
-  <target name="ivy-resolve" depends="ivy-init" unless="offline">
+  <target name="ivy-resolve" depends="ivy-init-settings" unless="offline">
     <echo message="Project: ${ant.project.name}"/>
     <ivy:resolve settingsRef="${ant.project.name}.ivy.settings"
-      log="${ivyresolvelog}"/>
+      conf="default" log="${ivyresolvelog}"/>
+    <ivy:report todir="${build.ivy.report.dir}" settingsRef="${ant.project.name}.ivy.settings"
+                graph="false" />
   </target>
 
   <target name="ivy-retrieve" depends="ivy-resolve"
@@ -132,52 +114,15 @@
       log="${ivyresolvelog}"/>
   </target>
 
-  <target name="ivy-resolve-checkstyle" depends="ivy-init">
-    <echo message="Project: ${ant.project.name}"/>
-    <ivy:resolve settingsRef="${ant.project.name}.ivy.settings" conf="checkstyle"
-      log="${ivyresolvelog}"/>
-  </target>
-
-  <target name="ivy-retrieve-checkstyle" depends="ivy-resolve-checkstyle"
-    description="Retrieve Ivy-managed artifacts for the checkstyle configurations">
-    <echo message="Project: ${ant.project.name}"/>
-    <ivy:retrieve settingsRef="${ant.project.name}.ivy.settings"
-      pattern="${build.ivy.lib.dir}/${ivy.artifact.retrieve.pattern}"
-      log="${ivyresolvelog}"/>
-    <ivy:cachepath pathid="checkstyle-classpath" conf="checkstyle"/>
-  </target>
-
-  <target name="ivy-resolve-maven-ant-tasks" depends="ivy-init">
-    <echo message="Project: ${ant.project.name}"/>
-    <ivy:resolve settingsRef="${ant.project.name}.ivy.settings" conf="maven"
-      log="${ivyresolvelog}"/>
-  </target>
 
-  <target name="ivy-retrieve-maven-ant-tasks" depends="ivy-resolve-maven-ant-tasks"
-    description="Retrieve Ivy-managed artifacts for the maven-ant-tasks configurations">
-    <echo message="Project: ${ant.project.name}"/>
-    <ivy:retrieve settingsRef="${ant.project.name}.ivy.settings"
-      pattern="${build.ivy.lib.dir}/${ivy.artifact.retrieve.pattern}"
-      log="${ivyresolvelog}"/>
-    <ivy:cachepath pathid="maven-ant-tasks.classpath" conf="maven"/>
-  </target>
-
-  <target name="ivy-retrieve-hadoop-source" depends="ivy-init"
+  <target name="ivy-retrieve-hadoop-source" depends="ivy-init-settings"
     description="Retrieve Ivy-managed Hadoop source artifacts" unless="ivy.skip">
     <echo message="Project: ${ant.project.name}"/>
     <ivy:retrieve settingsRef="${ant.project.name}.ivy.settings"
       pattern="${build.dir.hadoop}/[artifact]-[revision].[ext]"/>
   </target>
 
-  <target name="ivy-docs" depends="ivy-init"
-    description="Resolve, Retrieve Ivy-managed artifacts for docs configuration">
-    <echo message="Project: ${ant.project.name}"/>
-    <ivy:resolve settingsRef="${ant.project.name}.ivy.settings" conf="docs"/>
-    <ivy:retrieve settingsRef="${ant.project.name}.ivy.settings"
-                  pattern="${build.ivy.lib.dir}/${ivy.artifact.retrieve.pattern}" conf="docs"/>
-    <ivy:cachepath pathid="docs-classpath" conf="docs"/>
-  </target>
-
+  
   <available property="hadoopcore.${hadoop.version.ant-internal}.install.done"
     file="${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}.installed"/>
 
@@ -213,7 +158,6 @@
     <pathelement location="${build.dir.hive}/classes"/>
     <fileset dir="${build.dir.hive}" includes="*/*.jar"/>
     <fileset dir="${hive.root}/lib" includes="*.jar"/>
-    <fileset dir="${hive.root}/ql/lib" includes="*.jar"/>
     <fileset dir="${build.ivy.lib.dir}/default" includes="*.jar" excludes="*hadoop*.jar"
              erroronmissingdir="false"/>
   </path>
@@ -234,6 +178,7 @@
   </path>
 
   <target name="create-dirs">
+    <echo message="Project: ${ant.project.name}"/>
     <mkdir dir="${build.dir.hive}"/>
     <mkdir dir="${build.dir}"/>
     <mkdir dir="${build.classes}"/>
@@ -263,7 +208,7 @@
     <echo message="Project: ${ant.project.name}"/>
   </target>
 
-  <target name="compile" depends="init, setup">
+  <target name="compile" depends="init, setup, ivy-retrieve">
     <echo message="Project: ${ant.project.name}"/>
     <javac
      encoding="${build.encoding}"
@@ -271,7 +216,8 @@
      includes="**/*.java"
      destdir="${build.classes}"
      debug="${javac.debug}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
     </javac>
@@ -281,7 +227,7 @@
   </target>
 
   <target name="jar" depends="compile">
-    <echo message="Project: ${ant.project.name}"/>
+    <echo message="Project: ${ant.project.name}" />
     <jar
       jarfile="${build.dir}/hive-${ant.project.name}-${version}.jar"
       basedir="${build.classes}">
@@ -309,7 +255,8 @@
      optimize="${javac.optimize}"
      target="${javac.version}"
      source="${javac.version}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="test.classpath"/>
     </javac>
@@ -322,7 +269,8 @@
      optimize="${javac.optimize}"
      target="${javac.version}"
      source="${javac.version}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="test.classpath"/>
     </javac>
@@ -339,7 +287,6 @@
 
   <target name="test-conditions">
     <echo message="Project: ${ant.project.name}"/>
-
     <condition property="qfile" value="">
       <not>
         <isset property="qfile"/>
@@ -405,7 +352,7 @@
            errorProperty="tests.failed" failureProperty="tests.failed" filtertrace="off">
      
       <env key="HADOOP_HOME" value="${hadoop.root}"/>
-      <env key="HADOOP_CLASSPATH" value="${test.src.data.dir}/conf:${build.dir.hive}/dist/lib/derby.jar:${build.dir.hive}/dist/lib/javaewah-0.3.jar"/>
+      <env key="HADOOP_CLASSPATH" value="${test.src.data.dir}/conf:${build.dir.hive}/dist/lib/derby-${derby.version}.jar:${build.dir.hive}/dist/lib/javaewah-${javaewah.version}.jar"/>
       <env key="TZ" value="US/Pacific"/>
       <sysproperty key="test.output.overwrite" value="${overwrite}"/>
       <sysproperty key="test.service.standalone.server" value="${standalone}"/>
@@ -424,6 +371,8 @@
       <sysproperty key="fs.default.name" value="${fs.default.name}"/>
       <sysproperty key="build.dir" value="${build.dir}"/>
       <sysproperty key="build.dir.hive" value="${build.dir.hive}"/>
+      <sysproperty key="build.ivy.lib.dir" value="${build.ivy.lib.dir}"/>
+      <sysproperty key="derby.version" value="${derby.version}"/>
       <sysproperty key="hive.version" value="${version}"/>
 
       <classpath refid="${test.classpath.id}"/>
@@ -442,15 +391,6 @@
     </junit>
     <fail if="tests.failed">Tests failed!</fail>
   </target>
-  
-  <target name="test-shims">
-    <echo message="Project: ${ant.project.name}"/>
-     <subant target="test">
-       <property name="hadoop.version" value="${hadoop.security.version}"/>
-       <property name="hadoop.security.version" value="${hadoop.security.version}"/>
-       <fileset dir="${hive.root}/shims" includes="build.xml"/>
-     </subant>
-  </target>
 
   <target name="clean-test">
     <echo message="Project: ${ant.project.name}"/>
@@ -476,9 +416,9 @@
     </condition>
   </target>
 
-  <target name="check-ivy" depends="ivy-init">
+  <target name="check-ivy" depends="ivy-init-settings">
     <echo message="Project: ${ant.project.name}"/>
-   <available file="${basedir}/ivy.xml" property="ivy.present"/>
+    <available file="${basedir}/ivy.xml" property="ivy.present"/>
   </target>
 
   <target name="make-pom" if="ivy.present" depends="check-ivy, jar">
@@ -487,7 +427,7 @@
 
     <ivy:makepom ivyfile="${basedir}/ivy.xml" pomfile="${build.dir}/pom.xml">
       <mapping conf="default" scope="compile" />
-      <mapping conf="runtime" scope="runtime" />
+      <mapping conf="runtime" scope="compile" />
     </ivy:makepom>
     <replace file="${build.dir}/pom.xml">
       <replacetoken>&lt;dependencies&gt;</replacetoken>
@@ -509,38 +449,4 @@
     </replace>
   </target>
 
-  <!-- Deploy a single artifact to the maven repository -->
-  <target name="maven-publish-artifact">
-    <echo message="Project: ${ant.project.name}"/>
-    <artifact:pom
-       file="${mvn.pom.dir}/hive-${hive.project}-${version}.pom"
-       id="hive.project.pom" />
-    <artifact:install-provider artifactId="wagon-http" version="1.0-beta-2" />
-    <if>
-      <equals arg1="${mvn.publish.repo}" arg2="staging" />
-      <then>
-        <artifact:deploy
-            file="${mvn.jar.dir}/hive-${hive.project}-${version}.jar">
-          <pom refid="hive.project.pom" />
-          <remoteRepository
-              id="apache.staging.https"
-              url="https://repository.apache.org/service/local/staging/deploy/maven2" />
-          <attach file="${mvn.jar.dir}/hive-${hive.project}-${version}.jar.asc"
-                  type="jar.asc"/>
-          <attach file="${mvn.pom.dir}/hive-${hive.project}-${version}.pom.asc"
-                  type="pom.asc"/>
-        </artifact:deploy>
-      </then>
-      <else>
-        <artifact:deploy
-            file="${mvn.jar.dir}/hive-${hive.project}-${version}.jar">
-          <pom refid="hive.project.pom" />
-          <remoteRepository
-              id="apache.snapshots.https"
-              url="https://repository.apache.org/content/repositories/snapshots" />
-        </artifact:deploy>
-      </else>
-    </if>
-  </target>
-
 </project>
diff --git a/build.properties b/build.properties
index fc80b03742..2470b5334d 100644
--- a/build.properties
+++ b/build.properties
@@ -39,9 +39,28 @@ jsp.test.jar=${hadoop.root}/lib/jetty-ext/jsp-api.jar
 common.jar=${hadoop.root}/lib/commons-httpclient-3.0.1.jar
 
 #
-# Data nucleus repository - needed for jdo2-api-2.3-ec.jar download
+# Ivy Properties
 #
-datanucleus.repo=http://www.datanucleus.org/downloads/maven2
+build.ivy.dir=${build.dir.hive}/ivy
+build.ivy.lib.dir=${build.ivy.dir}/lib
+build.ivy.report.dir=${build.ivy.dir}/report
+build.ivy.maven.dir=${build.ivy.dir}/maven
+ivy.conf.dir=${hive.root}/ivy
+ivy.version=2.2.0
+ivy.jar=${build.ivy.lib.dir}/ivy-${ivy.version}.jar
+ivysettings.xml=${ivy.conf.dir}/ivysettings.xml
+ivyresolvelog=download-only
+ivy.mvn.repo=http://repo2.maven.org/maven2
+ivy_repo_url=${ivy.mvn.repo}/org/apache/ivy/ivy/${ivy.version}/ivy-${ivy.version}.jar
+hive.ivy.org=org.apache.hive
+mvn.publish.repo=snapshots
+mvn.jar.dir=${build.dir.hive}/maven/jars
+mvn.pom.dir=${build.dir.hive}/maven/poms
+mvn.license.dir=${build.dir.hive}/maven/licenses
 
 
+#
+# Data nucleus repository - needed for jdo2-api-2.3-ec.jar download
+#
+datanucleus.repo=http://www.datanucleus.org/downloads/maven2
 
diff --git a/build.xml b/build.xml
index a3a95a508b..2dd245d62a 100644
--- a/build.xml
+++ b/build.xml
@@ -18,12 +18,15 @@
 -->
 
 
-<project name="hive" default="jar" xmlns:artifact="urn:maven-artifact-ant" >
+<project name="hive" default="jar"
+         xmlns:ivy="antlib:org.apache.ivy.ant"
+         xmlns:artifact="urn:maven-artifact-ant" >
 
   <property name="hive.root" location="${basedir}"/>
   <property file="${hive.root}/build.properties"/>
   <property file="${user.home}/build.properties" />
   <property file="${basedir}/build.properties" />
+  <loadproperties srcfile="${ivy.conf.dir}/libraries.properties"/>
 
   <property environment="env"/>
 
@@ -58,6 +61,17 @@
     <isset property="offline"/>
   </condition>
 
+  <condition property="ivy.cache.name" value="offline" else="online">
+    <isset property="offline"/>
+  </condition>
+
+  <condition property="ivy.skip">
+    <and>
+      <isset property="offline"/>
+      <available file="${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}.installed"/>
+    </and>
+  </condition>
+
   <condition property="staging">
     <equals arg1="${mvn.publish.repo}" arg2="staging"/>
   </condition>
@@ -152,7 +166,6 @@
     <pathelement location="${build.dir.hive}/classes"/>
     <fileset dir="${hive.root}" includes="hive-*.jar"/>
     <fileset dir="${hive.root}/lib" includes="*.jar"/>
-    <fileset dir="${hive.root}/ql/lib" includes="*.jar"/>
     <fileset dir="${build.dir.hive}/ivy/lib/default" includes="*.jar"
 	excludes="*hadoop*.jar" erroronmissingdir="false"/>
   </path>
@@ -170,8 +183,14 @@
     <path refid="common-classpath"/>
   </path>
 
-
-
+  <target name="ivy-init-settings">
+    <!--Configure Ivy by reading in the settings file
+        If anyone has already read in a settings file into this settings ID, it gets priority
+    -->
+    <echo message="Project: ${ant.project.name}"/>
+    <ivy:settings id="${ant.project.name}.ivy.settings" file="${ivysettings.xml}"/>
+  </target>
+  
   <target name="ivy-init-dirs">
     <echo message="Project: ${ant.project.name}"/>
     <mkdir dir="${build.ivy.dir}" />
@@ -192,7 +211,7 @@
     <echo message="Project: ${ant.project.name}"/>
     <get src="${ivy_repo_url}" dest="${ivy.jar}" usetimestamp="true"/>
   </target>
-
+  
   <!--
   To avoid Ivy leaking things across big projects, always load Ivy in the same classloader.
   Also note how we skip loading Ivy if it is already there, just to make sure all is well.
@@ -302,6 +321,15 @@
     </for>
   </target>
 
+  <target name="test-shims">
+    <echo message="Project: ${ant.project.name}"/>
+    <subant target="test">
+      <property name="hadoop.version" value="${hadoop.security.version}"/>
+      <property name="hadoop.security.version" value="${hadoop.security.version}"/>
+      <fileset dir="${hive.root}/shims" includes="build.xml"/>
+    </subant>
+  </target>
+
   <!-- create an html report from junit output files -->
   <target name="testreport"
           description="Generate JUnit HTML test report">
@@ -727,9 +755,23 @@
   <!-- Checkstyle                                                         -->
   <!-- ================================================================== -->
 
-  <import file="${hive.root}/build-common.xml"/>
 
-  <target name="checkstyle" depends="ivy-retrieve-checkstyle,check-for-checkstyle"
+  <target name="ivy-resolve-checkstyle" depends="ivy-init-settings">
+    <echo message="Project: ${ant.project.name}"/>
+    <ivy:resolve settingsRef="${ant.project.name}.ivy.settings" conf="checkstyle"
+                 log="${ivyresolvelog}"/>
+  </target>
+  
+  <target name="ivy-retrieve-checkstyle" depends="ivy-resolve-checkstyle"
+    description="Retrieve Ivy-managed artifacts for the checkstyle configurations">
+    <echo message="Project: ${ant.project.name}"/>
+    <ivy:retrieve settingsRef="${ant.project.name}.ivy.settings"
+      pattern="${build.ivy.lib.dir}/${ivy.artifact.retrieve.pattern}"
+      log="${ivyresolvelog}"/>
+    <ivy:cachepath pathid="checkstyle-classpath" conf="checkstyle"/>
+  </target>
+
+  <target name="checkstyle" depends="init,ivy-retrieve-checkstyle,check-for-checkstyle"
           if="checkstyle.present"
           description="Run Checkstyle on source files">
     <echo message="Project: ${ant.project.name}"/>
@@ -763,6 +805,15 @@
     </available>
   </target>
 
+  <target name="ivy-docs" depends="ivy-init-settings"
+    description="Resolve, Retrieve Ivy-managed artifacts for docs configuration">
+    <echo message="Project: ${ant.project.name}"/>
+    <ivy:resolve settingsRef="${ant.project.name}.ivy.settings" conf="docs"/>
+    <ivy:retrieve settingsRef="${ant.project.name}.ivy.settings"
+                  pattern="${build.ivy.lib.dir}/${ivy.artifact.retrieve.pattern}" conf="docs"/>
+    <ivy:cachepath pathid="docs-classpath" conf="docs"/>
+  </target>
+  
   <target name="docs-anakia" depends="ivy-docs">
     <echo message="Project: ${ant.project.name}"/>
     <echo message="Building xdocs with anakia"/>
@@ -792,6 +843,22 @@
 
   <!-- Prepare for maven deploy i.e. jars, poms, and licence -->
 
+  <target name="ivy-resolve-maven-ant-tasks" depends="ivy-init-settings">
+    <echo message="Project: ${ant.project.name}"/>
+    <ivy:resolve settingsRef="${ant.project.name}.ivy.settings" conf="maven"
+      log="${ivyresolvelog}"/>
+  </target>
+
+  <target name="ivy-retrieve-maven-ant-tasks" depends="ivy-resolve-maven-ant-tasks"
+    description="Retrieve Ivy-managed artifacts for the maven-ant-tasks configurations">
+    <echo message="Project: ${ant.project.name}"/>
+    <ivy:retrieve settingsRef="${ant.project.name}.ivy.settings"
+      pattern="${build.ivy.lib.dir}/${ivy.artifact.retrieve.pattern}"
+      log="${ivyresolvelog}"/>
+    <ivy:cachepath pathid="maven-ant-tasks.classpath" conf="maven"/>
+  </target>
+
+  
   <target name="mvn-taskdef" depends="ivy-retrieve-maven-ant-tasks">
     <echo message="Project: ${ant.project.name}"/>
     <typedef resource="org/apache/maven/artifact/ant/antlib.xml"
@@ -889,7 +956,42 @@
     </echo>
   </target>
 
-  <target name="maven-publish" depends="mvn-taskdef,maven-sign"
+  <!-- Deploy a single artifact to the maven repository -->
+  <target name="maven-publish-artifact">
+    <echo message="Project: ${ant.project.name}"/>
+    <artifact:pom
+       file="${mvn.pom.dir}/hive-${hive.project}-${version}.pom"
+       id="hive.project.pom" />
+    <artifact:install-provider artifactId="wagon-http" version="1.0-beta-2" />
+    <if>
+      <equals arg1="${mvn.publish.repo}" arg2="staging" />
+      <then>
+        <artifact:deploy
+            file="${mvn.jar.dir}/hive-${hive.project}-${version}.jar">
+          <pom refid="hive.project.pom" />
+          <remoteRepository
+              id="apache.staging.https"
+              url="https://repository.apache.org/service/local/staging/deploy/maven2" />
+          <attach file="${mvn.jar.dir}/hive-${hive.project}-${version}.jar.asc"
+                  type="jar.asc"/>
+          <attach file="${mvn.pom.dir}/hive-${hive.project}-${version}.pom.asc"
+                  type="pom.asc"/>
+        </artifact:deploy>
+      </then>
+      <else>
+        <artifact:deploy
+            file="${mvn.jar.dir}/hive-${hive.project}-${version}.jar">
+          <pom refid="hive.project.pom" />
+          <remoteRepository
+              id="apache.snapshots.https"
+              url="https://repository.apache.org/content/repositories/snapshots" />
+        </artifact:deploy>
+      </else>
+    </if>
+  </target>
+
+  
+  <target name="maven-publish" depends="init,mvn-taskdef,maven-sign"
           description="Publish Maven artifacts">
     <echo message="Project: ${ant.project.name}"/>
     <antcall target="maven-publish-artifact">
diff --git a/cli/build.xml b/cli/build.xml
index 958cfe74c4..6e70d5f0d0 100755
--- a/cli/build.xml
+++ b/cli/build.xml
@@ -35,7 +35,8 @@ to call at top-level: ant deploy-contrib compile-core-test
      includes="**/*.java"
      destdir="${build.classes}"
      debug="${javac.debug}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
     </javac>
diff --git a/cli/ivy.xml b/cli/ivy.xml
index 0595d94a42..326fe41657 100644
--- a/cli/ivy.xml
+++ b/cli/ivy.xml
@@ -16,20 +16,46 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-cli" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency>
-        <dependency org="commons-cli" name="commons-cli" rev="${commons-cli.version}"/>
-        <dependency org="org.mockito" name="mockito-all" rev="${mockito-all.version}" />
-        <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
-                    transitive="false"/>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-cli" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <!-- Runtime Dependencies -->
+    <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency>
+    <dependency org="commons-cli" name="commons-cli" rev="${commons-cli.version}"/>
+    <dependency org="commons-lang" name="commons-lang" rev="${commons-lang.version}"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+    <dependency org="jline" name="jline" rev="${jline.version}"
+                transitive="false"/>
+    <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
+                transitive="false"/>
+
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-metastore" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-exec" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-serde" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-service" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-shims" rev="${version}"
+                conf="runtime" transitive="false"/>
+    
+    <!-- Test Dependencies -->
+    <dependency org="org.mockito" name="mockito-all" rev="${mockito-all.version}" />
+  </dependencies>
 </ivy-module>
diff --git a/cli/lib/README b/cli/lib/README
deleted file mode 100644
index 446b0e6322..0000000000
--- a/cli/lib/README
+++ /dev/null
@@ -1,5 +0,0 @@
-Folowing is the list of external jars contained in this directory and the sources from where they were obtained:
----------------------------------------------------------------------------------------------------------------
-
-*  jline-0.9.94.jar - http://jline.sourceforge.net/
-
diff --git a/cli/lib/jline-0.9.94.LICENSE b/cli/lib/jline-0.9.94.LICENSE
deleted file mode 100644
index 246f54f736..0000000000
--- a/cli/lib/jline-0.9.94.LICENSE
+++ /dev/null
@@ -1,32 +0,0 @@
-Copyright (c) 2002-2006, Marc Prud'hommeaux <mwp1@cornell.edu>
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or
-without modification, are permitted provided that the following
-conditions are met:
-
-Redistributions of source code must retain the above copyright
-notice, this list of conditions and the following disclaimer.
-
-Redistributions in binary form must reproduce the above copyright
-notice, this list of conditions and the following disclaimer
-in the documentation and/or other materials provided with
-the distribution.
-
-Neither the name of JLine nor the names of its contributors
-may be used to endorse or promote products derived from this
-software without specific prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
-BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
-AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
-EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
-FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
-OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
-PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
-AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
-LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
-IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
-OF THE POSSIBILITY OF SUCH DAMAGE.
diff --git a/cli/lib/jline-0.9.94.jar b/cli/lib/jline-0.9.94.jar
deleted file mode 100644
index dafca7c46e..0000000000
Binary files a/cli/lib/jline-0.9.94.jar and /dev/null differ
diff --git a/common/build.xml b/common/build.xml
index 66322dc038..432eba5072 100755
--- a/common/build.xml
+++ b/common/build.xml
@@ -35,7 +35,8 @@ to call at top-level: ant deploy-contrib compile-core-test
      includes="**/*.java"
      destdir="${build.classes}"
      debug="${javac.debug}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
     </javac>
diff --git a/common/ivy.xml b/common/ivy.xml
index 722249e478..bfd0688a93 100644
--- a/common/ivy.xml
+++ b/common/ivy.xml
@@ -16,17 +16,29 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-common" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency> 
-        <dependency org="commons-cli" name="commons-cli" rev="${commons-cli.version}"/>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-common" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency> 
+    <dependency org="org.apache.hive" name="hive-shims" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="commons-cli" name="commons-cli" rev="${commons-cli.version}"/>
+    <dependency org="commons-lang" name="commons-lang" rev="${commons-lang.version}"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+    <dependency org="log4j" name="log4j" rev="${log4j.version}"
+                transitive="false"/>
+  </dependencies>
 </ivy-module>
diff --git a/contrib/build.xml b/contrib/build.xml
index 14e1e20c7f..1c6908cbb7 100644
--- a/contrib/build.xml
+++ b/contrib/build.xml
@@ -59,7 +59,7 @@
   <target name="gen-test" depends="test-conditions, test-init" >
     <echo message="Project: ${ant.project.name}"/>
     <taskdef name="qtestgen" classname="org.apache.hadoop.hive.ant.QTestGenTask"
-             classpath="${build.dir.hive}/anttasks/hive-anttasks-${version}.jar:${hive.root}/lib/velocity-1.5.jar:${hive.root}/lib/commons-collections-3.2.1.jar:${hive.root}/lib/commons-lang-2.4.jar"/>
+             classpath="${build.dir.hive}/anttasks/hive-anttasks-${version}.jar:${build.ivy.lib.dir}/default/velocity-${velocity.version}.jar:${build.ivy.lib.dir}/default/commons-collections-${commons-collections.version}.jar:${build.ivy.lib.dir}/default/commons-lang-${commons-lang.version}.jar"/>
     
     <mkdir dir="${test.build.src}/org/apache/hadoop/hive/ql/parse"/>
     <mkdir dir="${test.build.src}/org/apache/hadoop/hive/cli"/>
diff --git a/contrib/ivy.xml b/contrib/ivy.xml
index 100cc039e1..c1e1c9d83a 100644
--- a/contrib/ivy.xml
+++ b/contrib/ivy.xml
@@ -15,17 +15,35 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-contrib" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency> 
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-contrib" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>  
+  <dependencies>
+    <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency>
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-metastore" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-exec" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-serde" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-shims" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+    <dependency org="commons-codec" name="commons-codec" rev="${commons-codec.version}"
+                transitive="false"/>
+  </dependencies>
 </ivy-module>
diff --git a/contrib/src/test/queries/clientpositive/dboutput.q b/contrib/src/test/queries/clientpositive/dboutput.q
index dbbcfcbd25..c56ecd1d55 100644
--- a/contrib/src/test/queries/clientpositive/dboutput.q
+++ b/contrib/src/test/queries/clientpositive/dboutput.q
@@ -1,4 +1,4 @@
-add jar ${system:build.dir}/hive-contrib-${system:hive.version}.jar;
+ADD JAR ${system:build.dir}/hive-contrib-${system:hive.version}.jar;
 
 CREATE TEMPORARY FUNCTION dboutput AS 'org.apache.hadoop.hive.contrib.genericudf.example.GenericUDFDBOutput';
 
@@ -7,7 +7,7 @@ set mapred.reduce.tasks.speculative.execution=false;
 set mapred.map.tasks=1;
 set mapred.reduce.tasks=1;
 
-ADD JAR ../lib/derby.jar ;
+ADD JAR ${system:build.ivy.lib.dir}/default/derby-${system:derby.version}.jar;
 
 DESCRIBE FUNCTION dboutput;
 
diff --git a/eclipse-templates/.classpath b/eclipse-templates/.classpath
index 1b97ae9a5a..69bee4bd7a 100644
--- a/eclipse-templates/.classpath
+++ b/eclipse-templates/.classpath
@@ -7,22 +7,22 @@
   <classpathentry exported="true" kind="lib" path="build/hadoopcore/hadoop-@HADOOPVER@/lib/@SERVLETAPIJAR@"/>
   <classpathentry exported="true" kind="lib" path="build/hadoopcore/hadoop-@HADOOPVER@/lib/@JETTYJAR@"/>
   <classpathentry exported="true" kind="lib" path="build/hadoopcore/hadoop-@HADOOPVER@/lib/@JETTYUTILJAR@"/>
-  <classpathentry exported="true" kind="lib" path="cli/lib/jline-@jline.version@.jar"/>
-  <classpathentry exported="true" kind="lib" path="lib/json.jar"/>
-  <classpathentry exported="true" kind="lib" path="lib/asm-@asm.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/jline-@jline.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/json-@json.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/asm-@asm.version@.jar"/>
   <classpathentry exported="true" kind="lib" path="build/hadoopcore/hadoop-@HADOOPVER@/lib/commons-codec-@commons-codec.version@.jar"/>
-  <classpathentry exported="true" kind="lib" path="lib/commons-lang-@commons-lang.version@.jar"/>
-  <classpathentry exported="true" kind="lib" path="lib/commons-logging-@commons-logging.version@.jar"/>
-  <classpathentry exported="true" kind="lib" path="lib/commons-logging-api-@commons-logging-api.version@.jar"/>
-  <classpathentry exported="true" kind="lib" path="lib/derby.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/commons-lang-@commons-lang.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/commons-logging-@commons-logging.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/commons-logging-api-@commons-logging-api.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/derby-@derby.version@.jar"/>
   <classpathentry exported="true" kind="lib" path="build/dist/lib/hbase-@hbase.version@.jar"/>
   <classpathentry exported="true" kind="lib" path="build/dist/lib/hbase-@hbase-test.version@-tests.jar"/>
   <classpathentry exported="true" kind="lib" path="build/dist/lib/libfb303-@libfb303.version@.jar"/>
   <classpathentry exported="true" kind="lib" path="build/dist/lib/libthrift-@libthrift.version@.jar"/>
   <classpathentry exported="true" kind="lib" path="build/dist/lib/zookeeper-@zookeeper.version@.jar"/>
-  <classpathentry exported="true" kind="lib" path="lib/log4j-@log4j.version@.jar"/>
-  <classpathentry exported="true" kind="lib" path="ql/lib/antlr-@antlr.version@.jar"/>
-  <classpathentry exported="true" kind="lib" path="ql/lib/antlr-runtime-@antlr-runtime.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/log4j-@log4j.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/antlr-@antlr.version@.jar"/>
+  <classpathentry exported="true" kind="lib" path="build/dist/lib/antlr-runtime-@antlr-runtime.version@.jar"/>
   <classpathentry exported="true" kind="lib" path="testlibs/junit-@junit.version@.jar"/>
   <classpathentry kind="lib" path="build/dist/lib/jdo2-api-@jdo-api.version@.jar"/>
   <classpathentry kind="lib" path="build/dist/lib/datanucleus-core-@datanucleus-core.version@.jar"/>
@@ -35,7 +35,7 @@
   <classpathentry kind="lib" path="build/dist/lib/commons-pool-@commons-pool.version@.jar"/>
   <classpathentry kind="lib" path="build/dist/lib/slf4j-api-@slf4j-api.version@.jar"/>
   <classpathentry kind="lib" path="build/dist/lib/slf4j-log4j12-@slf4j-log4j12.version@.jar"/>
-  <classpathentry kind="lib" path="build/dist/lib/javaewah-0.3.jar"/>
+  <classpathentry kind="lib" path="build/dist/lib/javaewah-@javaewah.version@.jar"/>
   <classpathentry kind="lib" path="build/dist/lib/mockito-all-@mockito-all.version@.jar"/>
   <classpathentry kind="src" path="build/contrib/test/src"/>
   <classpathentry kind="src" path="build/metastore/gen/antlr/gen-java"/>
diff --git a/hbase-handler/build.xml b/hbase-handler/build.xml
index f45dbfc5ba..14b3bcbe74 100644
--- a/hbase-handler/build.xml
+++ b/hbase-handler/build.xml
@@ -63,7 +63,7 @@
   <target name="gen-test" depends="test-conditions, test-init" >
     <echo message="Project: ${ant.project.name}"/>
     <taskdef name="qtestgen" classname="org.apache.hadoop.hive.ant.QTestGenTask"
-             classpath="${build.dir.hive}/anttasks/hive-anttasks-${version}.jar:${hive.root}/lib/velocity-1.5.jar:${hive.root}/lib/commons-collections-3.2.1.jar:${hive.root}/lib/commons-lang-2.4.jar"/>
+             classpath="${build.dir.hive}/anttasks/hive-anttasks-${version}.jar:${build.ivy.lib.dir}/default/velocity-${velocity.version}.jar:${build.ivy.lib.dir}/default/commons-collections-${commons-collections.version}.jar:${build.ivy.lib.dir}/default/commons-lang-${commons-lang.version}.jar"/>
     
     <mkdir dir="${test.build.src}/org/apache/hadoop/hive/cli"/>
     <mkdir dir="${test.log.dir}/hbase-handler"/>
diff --git a/hbase-handler/ivy.xml b/hbase-handler/ivy.xml
index 9b4b38fe27..f70a579d45 100644
--- a/hbase-handler/ivy.xml
+++ b/hbase-handler/ivy.xml
@@ -14,18 +14,42 @@
    See the License for the specific language governing permissions and
    limitations under the License.
 -->
-<ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-hbase-handler" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency> 
-    </dependencies>
+<ivy-module version="2.0" xmlns:m="http://ant.apache.org/ivy/maven">
+  <info organisation="${hive.ivy.org}" module="hive-hbase-handler" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>  
+  <dependencies>
+    <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency>
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-metastore" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-exec" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-serde" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+    <dependency org="log4j" name="log4j" rev="${log4j.version}"
+                transitive="false"/>
+    <dependency org="org.apache.hbase" name="hbase" rev="${hbase.version}"
+                transitive="false">
+      <artifact name="hbase" type="jar"/>
+      <artifact name="hbase" type="test-jar" ext="jar"
+                m:classifier="tests"/>
+    </dependency>
+    <dependency org="org.apache.zookeeper" name="zookeeper" rev="${zookeeper.version}"
+                transitive="false"/>
+  </dependencies>
 </ivy-module>
diff --git a/hwi/build.xml b/hwi/build.xml
index 4919570ff4..e13517f397 100644
--- a/hwi/build.xml
+++ b/hwi/build.xml
@@ -61,7 +61,7 @@
        We include the war target as a dependency. In this way the war target
        is called without changes to the upstream build infrastructure.
   -->
-  <target name="compile" depends="init, install-hadoopcore, setup, war">
+  <target name="compile" depends="init, setup, ivy-retrieve, war">
     <echo message="Project: ${ant.project.name}"/>
     <javac
      encoding="${build.encoding}"
diff --git a/hwi/ivy.xml b/hwi/ivy.xml
index 1860b66c19..d513e90eba 100644
--- a/hwi/ivy.xml
+++ b/hwi/ivy.xml
@@ -15,17 +15,31 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-hwi" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-hwi" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>  
+  <dependencies>
+    <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency>
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-cli" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-exec" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-shims" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+  </dependencies>
 </ivy-module>
diff --git a/ivy.xml b/ivy.xml
index 566bb4094a..9b97f7aa4c 100644
--- a/ivy.xml
+++ b/ivy.xml
@@ -23,11 +23,7 @@
   </info>
 
   <configurations defaultconfmapping="default">
-    <!--these match the Maven configurations-->
-    <conf name="default" extends="master,runtime"/>
-    <conf name="master" description="contains the artifact but no dependencies"/>
-    <conf name="compile" description="contains the artifact but no dependencies"/>
-    <conf name="runtime" description="runtime but not the artifact"/>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
     <!-- Private configurations -->
     <conf name="docs" visibility="private"/>
     <conf name="checkstyle" visibility="private"/>
diff --git a/ivy/common-configurations.xml b/ivy/common-configurations.xml
new file mode 100644
index 0000000000..79c7ddde9f
--- /dev/null
+++ b/ivy/common-configurations.xml
@@ -0,0 +1,23 @@
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+<configurations defaultconfmapping="default">
+  <!--these match the Maven configurations-->
+  <conf name="default" extends="master,compile"/>
+  <conf name="master" description="contains the artifact but no dependencies"/>
+  <conf name="compile" description="contains the artifact but no dependencies"/>
+  <conf name="runtime" description="runtime but not the artifact"/>
+</configurations>
\ No newline at end of file
diff --git a/ivy/ivysettings.xml b/ivy/ivysettings.xml
index a2587c785f..1b986e7e48 100644
--- a/ivy/ivysettings.xml
+++ b/ivy/ivysettings.xml
@@ -61,11 +61,11 @@
     </filesystem>
 
     <chain name="default" dual="true" returnFirst="true" checkmodified="true" changingPattern=".*SNAPSHOT">
-      <resolver ref="hadoop-source"/>
-      <resolver ref="hadoop-source2"/>
       <resolver ref="apache-snapshot"/>
       <resolver ref="maven2"/>
       <resolver ref="datanucleus-repo"/>
+      <resolver ref="hadoop-source"/>
+      <resolver ref="hadoop-source2"/>
     </chain>
 
     <chain name="internal" dual="true">
diff --git a/ivy/libraries.properties b/ivy/libraries.properties
index 8d88562680..355426753e 100644
--- a/ivy/libraries.properties
+++ b/ivy/libraries.properties
@@ -18,6 +18,7 @@
 
 # These are the versions of our dependencies (in alphabetical order)
 apacheant.version=1.7.1
+ant-contrib.version=1.0b3
 ant-task.version=2.0.10
 antlr.version=3.0.1
 antlr-runtime.version=3.0.1
@@ -35,19 +36,23 @@ commons-lang.version=2.4
 commons-logging.version=1.0.4
 commons-logging-api.version=1.0.4
 commons-pool.version=1.5.4
+derby.version=10.4.2.0
+guava.version=r06
 hbase.version=0.89.0-SNAPSHOT
 hbase-test.version=0.89.0-SNAPSHOT
-ivy.version=2.1.0
+javaewah.version=0.3
 jdo-api.version=2.3-ec
 jdom.version=1.1
 jline.version=0.9.94
+json.version=20090211
 junit.version=4.10
 libfb303.version=0.7.0
 libthrift.version=0.7.0
-log4j.version=1.2.15
+log4j.version=1.2.16
 maven-ant-tasks.version=2.1.0
 mockito-all.version=1.8.2
 slf4j-api.version=1.6.1
 slf4j-log4j12.version=1.6.1
+velocity.version=1.5
 zookeeper.version=3.3.1
-guava.version=r06
+
diff --git a/jdbc/build.xml b/jdbc/build.xml
index 641938abab..0ec18f0e56 100644
--- a/jdbc/build.xml
+++ b/jdbc/build.xml
@@ -40,23 +40,20 @@
     <path refid="classpath"/>
   </path>
 
-  <target name="core-compile" depends="init">
+  <target name="compile" depends="init,ivy-retrieve">
     <echo message="Project: ${ant.project.name}"/>
     <javac
-     encoding="${build.encoding}"
-     srcdir="${src.dir}/java"
-     includes="**/*.java"
-     destdir="${build.classes}"
-     debug="${javac.debug}"
-     deprecation="${javac.deprecation}"
-     >
+        encoding="${build.encoding}"
+        srcdir="${src.dir}/java"
+        includes="**/*.java"
+        destdir="${build.classes}"
+        debug="${javac.debug}"
+        deprecation="${javac.deprecation}"
+        includeantruntime="false"
+        >
       <classpath refid="classpath"/>
     </javac>
   </target>
- 
-  <target name="compile" depends="core-compile">
-    <echo message="Project: ${ant.project.name}"/>
-  </target>
 
   <target name="clean">
     <echo message="Project: ${ant.project.name}"/>
diff --git a/jdbc/ivy.xml b/jdbc/ivy.xml
index bc9c69e8f2..5c95c71133 100644
--- a/jdbc/ivy.xml
+++ b/jdbc/ivy.xml
@@ -16,15 +16,28 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-jdbc" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-      <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
-                  transitive="false"/>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-jdbc" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-metastore" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-serde" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-service" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+  </dependencies>
 </ivy-module>
diff --git a/lib/README b/lib/README
index 6e993ee221..f10b1d199a 100644
--- a/lib/README
+++ b/lib/README
@@ -1,14 +1,4 @@
 Folowing is the list of external jars contained in this directory and the sources from where they were obtained:
 ---------------------------------------------------------------------------------------------------------------
 
-*  jpox-core-1.2.2.jar - http://www.jpox.org/docs/download.html
-*  derby.jar - http://db.apache.org/derby/derby_downloads.html
-*  asm-3.1.jar - http://forge.objectweb.org/projects/asm/
-*  jpox-enhancer-1.2.2.jar - http://www.jpox.org/docs/download.html
-*  jdo2-api-2.1.jar - http://db.apache.org/jdo/downloads.html
-*  jpox-rdbms-1.2.2.jar - http://www.jpox.org/docs/download.html
-*  velocity-1.5.jar - http://velocity.apache.org/engine/releases/velocity-1.5/
-*  commons-collections-3.2.1.jar - http://commons.apache.org/downloads/download_collections.cgi
-*  commons-lang-2.4.jar - http://commons.apache.org/downloads/download_lang.cgi
-*  json.jar - http://www.json.org/java/index.html
-*  javaewah-0.2.jar - http://code.google.com/p/javaewah/downloads/
+*  javaewah-0.3.jar - http://code.google.com/p/javaewah/downloads/
diff --git a/lib/asm-3.1.LICENSE b/lib/asm-3.1.LICENSE
deleted file mode 100644
index 75ad085e2b..0000000000
--- a/lib/asm-3.1.LICENSE
+++ /dev/null
@@ -1,29 +0,0 @@
-Copyright (c) 2000-2005 INRIA, France Telecom
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or without
-modification, are permitted provided that the following conditions
-are met:
-
-1. Redistributions of source code must retain the above copyright
-   notice, this list of conditions and the following disclaimer.
-
-2. Redistributions in binary form must reproduce the above copyright
-   notice, this list of conditions and the following disclaimer in the
-   documentation and/or other materials provided with the distribution.
-
-3. Neither the name of the copyright holders nor the names of its
-   contributors may be used to endorse or promote products derived from
-   this software without specific prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
-AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
-IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
-ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
-LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
-INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
-CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
-ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
-THE POSSIBILITY OF SUCH DAMAGE.
diff --git a/lib/asm-3.1.jar b/lib/asm-3.1.jar
deleted file mode 100644
index b3baf3feb6..0000000000
Binary files a/lib/asm-3.1.jar and /dev/null differ
diff --git a/lib/commons-collections-3.2.1.LICENSE b/lib/commons-collections-3.2.1.LICENSE
deleted file mode 100644
index 261eeb9e9f..0000000000
--- a/lib/commons-collections-3.2.1.LICENSE
+++ /dev/null
@@ -1,201 +0,0 @@
-                                 Apache License
-                           Version 2.0, January 2004
-                        http://www.apache.org/licenses/
-
-   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
-
-   1. Definitions.
-
-      "License" shall mean the terms and conditions for use, reproduction,
-      and distribution as defined by Sections 1 through 9 of this document.
-
-      "Licensor" shall mean the copyright owner or entity authorized by
-      the copyright owner that is granting the License.
-
-      "Legal Entity" shall mean the union of the acting entity and all
-      other entities that control, are controlled by, or are under common
-      control with that entity. For the purposes of this definition,
-      "control" means (i) the power, direct or indirect, to cause the
-      direction or management of such entity, whether by contract or
-      otherwise, or (ii) ownership of fifty percent (50%) or more of the
-      outstanding shares, or (iii) beneficial ownership of such entity.
-
-      "You" (or "Your") shall mean an individual or Legal Entity
-      exercising permissions granted by this License.
-
-      "Source" form shall mean the preferred form for making modifications,
-      including but not limited to software source code, documentation
-      source, and configuration files.
-
-      "Object" form shall mean any form resulting from mechanical
-      transformation or translation of a Source form, including but
-      not limited to compiled object code, generated documentation,
-      and conversions to other media types.
-
-      "Work" shall mean the work of authorship, whether in Source or
-      Object form, made available under the License, as indicated by a
-      copyright notice that is included in or attached to the work
-      (an example is provided in the Appendix below).
-
-      "Derivative Works" shall mean any work, whether in Source or Object
-      form, that is based on (or derived from) the Work and for which the
-      editorial revisions, annotations, elaborations, or other modifications
-      represent, as a whole, an original work of authorship. For the purposes
-      of this License, Derivative Works shall not include works that remain
-      separable from, or merely link (or bind by name) to the interfaces of,
-      the Work and Derivative Works thereof.
-
-      "Contribution" shall mean any work of authorship, including
-      the original version of the Work and any modifications or additions
-      to that Work or Derivative Works thereof, that is intentionally
-      submitted to Licensor for inclusion in the Work by the copyright owner
-      or by an individual or Legal Entity authorized to submit on behalf of
-      the copyright owner. For the purposes of this definition, "submitted"
-      means any form of electronic, verbal, or written communication sent
-      to the Licensor or its representatives, including but not limited to
-      communication on electronic mailing lists, source code control systems,
-      and issue tracking systems that are managed by, or on behalf of, the
-      Licensor for the purpose of discussing and improving the Work, but
-      excluding communication that is conspicuously marked or otherwise
-      designated in writing by the copyright owner as "Not a Contribution."
-
-      "Contributor" shall mean Licensor and any individual or Legal Entity
-      on behalf of whom a Contribution has been received by Licensor and
-      subsequently incorporated within the Work.
-
-   2. Grant of Copyright License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      copyright license to reproduce, prepare Derivative Works of,
-      publicly display, publicly perform, sublicense, and distribute the
-      Work and such Derivative Works in Source or Object form.
-
-   3. Grant of Patent License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      (except as stated in this section) patent license to make, have made,
-      use, offer to sell, sell, import, and otherwise transfer the Work,
-      where such license applies only to those patent claims licensable
-      by such Contributor that are necessarily infringed by their
-      Contribution(s) alone or by combination of their Contribution(s)
-      with the Work to which such Contribution(s) was submitted. If You
-      institute patent litigation against any entity (including a
-      cross-claim or counterclaim in a lawsuit) alleging that the Work
-      or a Contribution incorporated within the Work constitutes direct
-      or contributory patent infringement, then any patent licenses
-      granted to You under this License for that Work shall terminate
-      as of the date such litigation is filed.
-
-   4. Redistribution. You may reproduce and distribute copies of the
-      Work or Derivative Works thereof in any medium, with or without
-      modifications, and in Source or Object form, provided that You
-      meet the following conditions:
-
-      (a) You must give any other recipients of the Work or
-          Derivative Works a copy of this License; and
-
-      (b) You must cause any modified files to carry prominent notices
-          stating that You changed the files; and
-
-      (c) You must retain, in the Source form of any Derivative Works
-          that You distribute, all copyright, patent, trademark, and
-          attribution notices from the Source form of the Work,
-          excluding those notices that do not pertain to any part of
-          the Derivative Works; and
-
-      (d) If the Work includes a "NOTICE" text file as part of its
-          distribution, then any Derivative Works that You distribute must
-          include a readable copy of the attribution notices contained
-          within such NOTICE file, excluding those notices that do not
-          pertain to any part of the Derivative Works, in at least one
-          of the following places: within a NOTICE text file distributed
-          as part of the Derivative Works; within the Source form or
-          documentation, if provided along with the Derivative Works; or,
-          within a display generated by the Derivative Works, if and
-          wherever such third-party notices normally appear. The contents
-          of the NOTICE file are for informational purposes only and
-          do not modify the License. You may add Your own attribution
-          notices within Derivative Works that You distribute, alongside
-          or as an addendum to the NOTICE text from the Work, provided
-          that such additional attribution notices cannot be construed
-          as modifying the License.
-
-      You may add Your own copyright statement to Your modifications and
-      may provide additional or different license terms and conditions
-      for use, reproduction, or distribution of Your modifications, or
-      for any such Derivative Works as a whole, provided Your use,
-      reproduction, and distribution of the Work otherwise complies with
-      the conditions stated in this License.
-
-   5. Submission of Contributions. Unless You explicitly state otherwise,
-      any Contribution intentionally submitted for inclusion in the Work
-      by You to the Licensor shall be under the terms and conditions of
-      this License, without any additional terms or conditions.
-      Notwithstanding the above, nothing herein shall supersede or modify
-      the terms of any separate license agreement you may have executed
-      with Licensor regarding such Contributions.
-
-   6. Trademarks. This License does not grant permission to use the trade
-      names, trademarks, service marks, or product names of the Licensor,
-      except as required for reasonable and customary use in describing the
-      origin of the Work and reproducing the content of the NOTICE file.
-
-   7. Disclaimer of Warranty. Unless required by applicable law or
-      agreed to in writing, Licensor provides the Work (and each
-      Contributor provides its Contributions) on an "AS IS" BASIS,
-      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
-      implied, including, without limitation, any warranties or conditions
-      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
-      PARTICULAR PURPOSE. You are solely responsible for determining the
-      appropriateness of using or redistributing the Work and assume any
-      risks associated with Your exercise of permissions under this License.
-
-   8. Limitation of Liability. In no event and under no legal theory,
-      whether in tort (including negligence), contract, or otherwise,
-      unless required by applicable law (such as deliberate and grossly
-      negligent acts) or agreed to in writing, shall any Contributor be
-      liable to You for damages, including any direct, indirect, special,
-      incidental, or consequential damages of any character arising as a
-      result of this License or out of the use or inability to use the
-      Work (including but not limited to damages for loss of goodwill,
-      work stoppage, computer failure or malfunction, or any and all
-      other commercial damages or losses), even if such Contributor
-      has been advised of the possibility of such damages.
-
-   9. Accepting Warranty or Additional Liability. While redistributing
-      the Work or Derivative Works thereof, You may choose to offer,
-      and charge a fee for, acceptance of support, warranty, indemnity,
-      or other liability obligations and/or rights consistent with this
-      License. However, in accepting such obligations, You may act only
-      on Your own behalf and on Your sole responsibility, not on behalf
-      of any other Contributor, and only if You agree to indemnify,
-      defend, and hold each Contributor harmless for any liability
-      incurred by, or claims asserted against, such Contributor by reason
-      of your accepting any such warranty or additional liability.
-
-   END OF TERMS AND CONDITIONS
-
-   APPENDIX: How to apply the Apache License to your work.
-
-      To apply the Apache License to your work, attach the following
-      boilerplate notice, with the fields enclosed by brackets "[]"
-      replaced with your own identifying information. (Don't include
-      the brackets!)  The text should be enclosed in the appropriate
-      comment syntax for the file format. We also recommend that a
-      file or class name and description of purpose be included on the
-      same "printed page" as the copyright notice for easier
-      identification within third-party archives.
-
-   Copyright [yyyy] [name of copyright owner]
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-   you may not use this file except in compliance with the License.
-   You may obtain a copy of the License at
-
-       http://www.apache.org/licenses/LICENSE-2.0
-
-   Unless required by applicable law or agreed to in writing, software
-   distributed under the License is distributed on an "AS IS" BASIS,
-   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-   See the License for the specific language governing permissions and
-   limitations under the License.
diff --git a/lib/commons-collections-3.2.1.jar b/lib/commons-collections-3.2.1.jar
deleted file mode 100644
index c35fa1fee1..0000000000
Binary files a/lib/commons-collections-3.2.1.jar and /dev/null differ
diff --git a/lib/commons-lang-2.4.LICENSE b/lib/commons-lang-2.4.LICENSE
deleted file mode 100644
index 261eeb9e9f..0000000000
--- a/lib/commons-lang-2.4.LICENSE
+++ /dev/null
@@ -1,201 +0,0 @@
-                                 Apache License
-                           Version 2.0, January 2004
-                        http://www.apache.org/licenses/
-
-   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
-
-   1. Definitions.
-
-      "License" shall mean the terms and conditions for use, reproduction,
-      and distribution as defined by Sections 1 through 9 of this document.
-
-      "Licensor" shall mean the copyright owner or entity authorized by
-      the copyright owner that is granting the License.
-
-      "Legal Entity" shall mean the union of the acting entity and all
-      other entities that control, are controlled by, or are under common
-      control with that entity. For the purposes of this definition,
-      "control" means (i) the power, direct or indirect, to cause the
-      direction or management of such entity, whether by contract or
-      otherwise, or (ii) ownership of fifty percent (50%) or more of the
-      outstanding shares, or (iii) beneficial ownership of such entity.
-
-      "You" (or "Your") shall mean an individual or Legal Entity
-      exercising permissions granted by this License.
-
-      "Source" form shall mean the preferred form for making modifications,
-      including but not limited to software source code, documentation
-      source, and configuration files.
-
-      "Object" form shall mean any form resulting from mechanical
-      transformation or translation of a Source form, including but
-      not limited to compiled object code, generated documentation,
-      and conversions to other media types.
-
-      "Work" shall mean the work of authorship, whether in Source or
-      Object form, made available under the License, as indicated by a
-      copyright notice that is included in or attached to the work
-      (an example is provided in the Appendix below).
-
-      "Derivative Works" shall mean any work, whether in Source or Object
-      form, that is based on (or derived from) the Work and for which the
-      editorial revisions, annotations, elaborations, or other modifications
-      represent, as a whole, an original work of authorship. For the purposes
-      of this License, Derivative Works shall not include works that remain
-      separable from, or merely link (or bind by name) to the interfaces of,
-      the Work and Derivative Works thereof.
-
-      "Contribution" shall mean any work of authorship, including
-      the original version of the Work and any modifications or additions
-      to that Work or Derivative Works thereof, that is intentionally
-      submitted to Licensor for inclusion in the Work by the copyright owner
-      or by an individual or Legal Entity authorized to submit on behalf of
-      the copyright owner. For the purposes of this definition, "submitted"
-      means any form of electronic, verbal, or written communication sent
-      to the Licensor or its representatives, including but not limited to
-      communication on electronic mailing lists, source code control systems,
-      and issue tracking systems that are managed by, or on behalf of, the
-      Licensor for the purpose of discussing and improving the Work, but
-      excluding communication that is conspicuously marked or otherwise
-      designated in writing by the copyright owner as "Not a Contribution."
-
-      "Contributor" shall mean Licensor and any individual or Legal Entity
-      on behalf of whom a Contribution has been received by Licensor and
-      subsequently incorporated within the Work.
-
-   2. Grant of Copyright License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      copyright license to reproduce, prepare Derivative Works of,
-      publicly display, publicly perform, sublicense, and distribute the
-      Work and such Derivative Works in Source or Object form.
-
-   3. Grant of Patent License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      (except as stated in this section) patent license to make, have made,
-      use, offer to sell, sell, import, and otherwise transfer the Work,
-      where such license applies only to those patent claims licensable
-      by such Contributor that are necessarily infringed by their
-      Contribution(s) alone or by combination of their Contribution(s)
-      with the Work to which such Contribution(s) was submitted. If You
-      institute patent litigation against any entity (including a
-      cross-claim or counterclaim in a lawsuit) alleging that the Work
-      or a Contribution incorporated within the Work constitutes direct
-      or contributory patent infringement, then any patent licenses
-      granted to You under this License for that Work shall terminate
-      as of the date such litigation is filed.
-
-   4. Redistribution. You may reproduce and distribute copies of the
-      Work or Derivative Works thereof in any medium, with or without
-      modifications, and in Source or Object form, provided that You
-      meet the following conditions:
-
-      (a) You must give any other recipients of the Work or
-          Derivative Works a copy of this License; and
-
-      (b) You must cause any modified files to carry prominent notices
-          stating that You changed the files; and
-
-      (c) You must retain, in the Source form of any Derivative Works
-          that You distribute, all copyright, patent, trademark, and
-          attribution notices from the Source form of the Work,
-          excluding those notices that do not pertain to any part of
-          the Derivative Works; and
-
-      (d) If the Work includes a "NOTICE" text file as part of its
-          distribution, then any Derivative Works that You distribute must
-          include a readable copy of the attribution notices contained
-          within such NOTICE file, excluding those notices that do not
-          pertain to any part of the Derivative Works, in at least one
-          of the following places: within a NOTICE text file distributed
-          as part of the Derivative Works; within the Source form or
-          documentation, if provided along with the Derivative Works; or,
-          within a display generated by the Derivative Works, if and
-          wherever such third-party notices normally appear. The contents
-          of the NOTICE file are for informational purposes only and
-          do not modify the License. You may add Your own attribution
-          notices within Derivative Works that You distribute, alongside
-          or as an addendum to the NOTICE text from the Work, provided
-          that such additional attribution notices cannot be construed
-          as modifying the License.
-
-      You may add Your own copyright statement to Your modifications and
-      may provide additional or different license terms and conditions
-      for use, reproduction, or distribution of Your modifications, or
-      for any such Derivative Works as a whole, provided Your use,
-      reproduction, and distribution of the Work otherwise complies with
-      the conditions stated in this License.
-
-   5. Submission of Contributions. Unless You explicitly state otherwise,
-      any Contribution intentionally submitted for inclusion in the Work
-      by You to the Licensor shall be under the terms and conditions of
-      this License, without any additional terms or conditions.
-      Notwithstanding the above, nothing herein shall supersede or modify
-      the terms of any separate license agreement you may have executed
-      with Licensor regarding such Contributions.
-
-   6. Trademarks. This License does not grant permission to use the trade
-      names, trademarks, service marks, or product names of the Licensor,
-      except as required for reasonable and customary use in describing the
-      origin of the Work and reproducing the content of the NOTICE file.
-
-   7. Disclaimer of Warranty. Unless required by applicable law or
-      agreed to in writing, Licensor provides the Work (and each
-      Contributor provides its Contributions) on an "AS IS" BASIS,
-      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
-      implied, including, without limitation, any warranties or conditions
-      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
-      PARTICULAR PURPOSE. You are solely responsible for determining the
-      appropriateness of using or redistributing the Work and assume any
-      risks associated with Your exercise of permissions under this License.
-
-   8. Limitation of Liability. In no event and under no legal theory,
-      whether in tort (including negligence), contract, or otherwise,
-      unless required by applicable law (such as deliberate and grossly
-      negligent acts) or agreed to in writing, shall any Contributor be
-      liable to You for damages, including any direct, indirect, special,
-      incidental, or consequential damages of any character arising as a
-      result of this License or out of the use or inability to use the
-      Work (including but not limited to damages for loss of goodwill,
-      work stoppage, computer failure or malfunction, or any and all
-      other commercial damages or losses), even if such Contributor
-      has been advised of the possibility of such damages.
-
-   9. Accepting Warranty or Additional Liability. While redistributing
-      the Work or Derivative Works thereof, You may choose to offer,
-      and charge a fee for, acceptance of support, warranty, indemnity,
-      or other liability obligations and/or rights consistent with this
-      License. However, in accepting such obligations, You may act only
-      on Your own behalf and on Your sole responsibility, not on behalf
-      of any other Contributor, and only if You agree to indemnify,
-      defend, and hold each Contributor harmless for any liability
-      incurred by, or claims asserted against, such Contributor by reason
-      of your accepting any such warranty or additional liability.
-
-   END OF TERMS AND CONDITIONS
-
-   APPENDIX: How to apply the Apache License to your work.
-
-      To apply the Apache License to your work, attach the following
-      boilerplate notice, with the fields enclosed by brackets "[]"
-      replaced with your own identifying information. (Don't include
-      the brackets!)  The text should be enclosed in the appropriate
-      comment syntax for the file format. We also recommend that a
-      file or class name and description of purpose be included on the
-      same "printed page" as the copyright notice for easier
-      identification within third-party archives.
-
-   Copyright [yyyy] [name of copyright owner]
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-   you may not use this file except in compliance with the License.
-   You may obtain a copy of the License at
-
-       http://www.apache.org/licenses/LICENSE-2.0
-
-   Unless required by applicable law or agreed to in writing, software
-   distributed under the License is distributed on an "AS IS" BASIS,
-   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-   See the License for the specific language governing permissions and
-   limitations under the License.
diff --git a/lib/commons-lang-2.4.jar b/lib/commons-lang-2.4.jar
deleted file mode 100644
index 532939ecab..0000000000
Binary files a/lib/commons-lang-2.4.jar and /dev/null differ
diff --git a/lib/commons-logging-1.0.4.jar b/lib/commons-logging-1.0.4.jar
deleted file mode 100644
index b73a80fab6..0000000000
Binary files a/lib/commons-logging-1.0.4.jar and /dev/null differ
diff --git a/lib/commons-logging-api-1.0.4.jar b/lib/commons-logging-api-1.0.4.jar
deleted file mode 100644
index ade9a13c78..0000000000
Binary files a/lib/commons-logging-api-1.0.4.jar and /dev/null differ
diff --git a/lib/derby.LICENSE b/lib/derby.LICENSE
deleted file mode 100644
index 261eeb9e9f..0000000000
--- a/lib/derby.LICENSE
+++ /dev/null
@@ -1,201 +0,0 @@
-                                 Apache License
-                           Version 2.0, January 2004
-                        http://www.apache.org/licenses/
-
-   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
-
-   1. Definitions.
-
-      "License" shall mean the terms and conditions for use, reproduction,
-      and distribution as defined by Sections 1 through 9 of this document.
-
-      "Licensor" shall mean the copyright owner or entity authorized by
-      the copyright owner that is granting the License.
-
-      "Legal Entity" shall mean the union of the acting entity and all
-      other entities that control, are controlled by, or are under common
-      control with that entity. For the purposes of this definition,
-      "control" means (i) the power, direct or indirect, to cause the
-      direction or management of such entity, whether by contract or
-      otherwise, or (ii) ownership of fifty percent (50%) or more of the
-      outstanding shares, or (iii) beneficial ownership of such entity.
-
-      "You" (or "Your") shall mean an individual or Legal Entity
-      exercising permissions granted by this License.
-
-      "Source" form shall mean the preferred form for making modifications,
-      including but not limited to software source code, documentation
-      source, and configuration files.
-
-      "Object" form shall mean any form resulting from mechanical
-      transformation or translation of a Source form, including but
-      not limited to compiled object code, generated documentation,
-      and conversions to other media types.
-
-      "Work" shall mean the work of authorship, whether in Source or
-      Object form, made available under the License, as indicated by a
-      copyright notice that is included in or attached to the work
-      (an example is provided in the Appendix below).
-
-      "Derivative Works" shall mean any work, whether in Source or Object
-      form, that is based on (or derived from) the Work and for which the
-      editorial revisions, annotations, elaborations, or other modifications
-      represent, as a whole, an original work of authorship. For the purposes
-      of this License, Derivative Works shall not include works that remain
-      separable from, or merely link (or bind by name) to the interfaces of,
-      the Work and Derivative Works thereof.
-
-      "Contribution" shall mean any work of authorship, including
-      the original version of the Work and any modifications or additions
-      to that Work or Derivative Works thereof, that is intentionally
-      submitted to Licensor for inclusion in the Work by the copyright owner
-      or by an individual or Legal Entity authorized to submit on behalf of
-      the copyright owner. For the purposes of this definition, "submitted"
-      means any form of electronic, verbal, or written communication sent
-      to the Licensor or its representatives, including but not limited to
-      communication on electronic mailing lists, source code control systems,
-      and issue tracking systems that are managed by, or on behalf of, the
-      Licensor for the purpose of discussing and improving the Work, but
-      excluding communication that is conspicuously marked or otherwise
-      designated in writing by the copyright owner as "Not a Contribution."
-
-      "Contributor" shall mean Licensor and any individual or Legal Entity
-      on behalf of whom a Contribution has been received by Licensor and
-      subsequently incorporated within the Work.
-
-   2. Grant of Copyright License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      copyright license to reproduce, prepare Derivative Works of,
-      publicly display, publicly perform, sublicense, and distribute the
-      Work and such Derivative Works in Source or Object form.
-
-   3. Grant of Patent License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      (except as stated in this section) patent license to make, have made,
-      use, offer to sell, sell, import, and otherwise transfer the Work,
-      where such license applies only to those patent claims licensable
-      by such Contributor that are necessarily infringed by their
-      Contribution(s) alone or by combination of their Contribution(s)
-      with the Work to which such Contribution(s) was submitted. If You
-      institute patent litigation against any entity (including a
-      cross-claim or counterclaim in a lawsuit) alleging that the Work
-      or a Contribution incorporated within the Work constitutes direct
-      or contributory patent infringement, then any patent licenses
-      granted to You under this License for that Work shall terminate
-      as of the date such litigation is filed.
-
-   4. Redistribution. You may reproduce and distribute copies of the
-      Work or Derivative Works thereof in any medium, with or without
-      modifications, and in Source or Object form, provided that You
-      meet the following conditions:
-
-      (a) You must give any other recipients of the Work or
-          Derivative Works a copy of this License; and
-
-      (b) You must cause any modified files to carry prominent notices
-          stating that You changed the files; and
-
-      (c) You must retain, in the Source form of any Derivative Works
-          that You distribute, all copyright, patent, trademark, and
-          attribution notices from the Source form of the Work,
-          excluding those notices that do not pertain to any part of
-          the Derivative Works; and
-
-      (d) If the Work includes a "NOTICE" text file as part of its
-          distribution, then any Derivative Works that You distribute must
-          include a readable copy of the attribution notices contained
-          within such NOTICE file, excluding those notices that do not
-          pertain to any part of the Derivative Works, in at least one
-          of the following places: within a NOTICE text file distributed
-          as part of the Derivative Works; within the Source form or
-          documentation, if provided along with the Derivative Works; or,
-          within a display generated by the Derivative Works, if and
-          wherever such third-party notices normally appear. The contents
-          of the NOTICE file are for informational purposes only and
-          do not modify the License. You may add Your own attribution
-          notices within Derivative Works that You distribute, alongside
-          or as an addendum to the NOTICE text from the Work, provided
-          that such additional attribution notices cannot be construed
-          as modifying the License.
-
-      You may add Your own copyright statement to Your modifications and
-      may provide additional or different license terms and conditions
-      for use, reproduction, or distribution of Your modifications, or
-      for any such Derivative Works as a whole, provided Your use,
-      reproduction, and distribution of the Work otherwise complies with
-      the conditions stated in this License.
-
-   5. Submission of Contributions. Unless You explicitly state otherwise,
-      any Contribution intentionally submitted for inclusion in the Work
-      by You to the Licensor shall be under the terms and conditions of
-      this License, without any additional terms or conditions.
-      Notwithstanding the above, nothing herein shall supersede or modify
-      the terms of any separate license agreement you may have executed
-      with Licensor regarding such Contributions.
-
-   6. Trademarks. This License does not grant permission to use the trade
-      names, trademarks, service marks, or product names of the Licensor,
-      except as required for reasonable and customary use in describing the
-      origin of the Work and reproducing the content of the NOTICE file.
-
-   7. Disclaimer of Warranty. Unless required by applicable law or
-      agreed to in writing, Licensor provides the Work (and each
-      Contributor provides its Contributions) on an "AS IS" BASIS,
-      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
-      implied, including, without limitation, any warranties or conditions
-      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
-      PARTICULAR PURPOSE. You are solely responsible for determining the
-      appropriateness of using or redistributing the Work and assume any
-      risks associated with Your exercise of permissions under this License.
-
-   8. Limitation of Liability. In no event and under no legal theory,
-      whether in tort (including negligence), contract, or otherwise,
-      unless required by applicable law (such as deliberate and grossly
-      negligent acts) or agreed to in writing, shall any Contributor be
-      liable to You for damages, including any direct, indirect, special,
-      incidental, or consequential damages of any character arising as a
-      result of this License or out of the use or inability to use the
-      Work (including but not limited to damages for loss of goodwill,
-      work stoppage, computer failure or malfunction, or any and all
-      other commercial damages or losses), even if such Contributor
-      has been advised of the possibility of such damages.
-
-   9. Accepting Warranty or Additional Liability. While redistributing
-      the Work or Derivative Works thereof, You may choose to offer,
-      and charge a fee for, acceptance of support, warranty, indemnity,
-      or other liability obligations and/or rights consistent with this
-      License. However, in accepting such obligations, You may act only
-      on Your own behalf and on Your sole responsibility, not on behalf
-      of any other Contributor, and only if You agree to indemnify,
-      defend, and hold each Contributor harmless for any liability
-      incurred by, or claims asserted against, such Contributor by reason
-      of your accepting any such warranty or additional liability.
-
-   END OF TERMS AND CONDITIONS
-
-   APPENDIX: How to apply the Apache License to your work.
-
-      To apply the Apache License to your work, attach the following
-      boilerplate notice, with the fields enclosed by brackets "[]"
-      replaced with your own identifying information. (Don't include
-      the brackets!)  The text should be enclosed in the appropriate
-      comment syntax for the file format. We also recommend that a
-      file or class name and description of purpose be included on the
-      same "printed page" as the copyright notice for easier
-      identification within third-party archives.
-
-   Copyright [yyyy] [name of copyright owner]
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-   you may not use this file except in compliance with the License.
-   You may obtain a copy of the License at
-
-       http://www.apache.org/licenses/LICENSE-2.0
-
-   Unless required by applicable law or agreed to in writing, software
-   distributed under the License is distributed on an "AS IS" BASIS,
-   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-   See the License for the specific language governing permissions and
-   limitations under the License.
diff --git a/lib/derby.jar b/lib/derby.jar
deleted file mode 100644
index dbdc4543cf..0000000000
Binary files a/lib/derby.jar and /dev/null differ
diff --git a/lib/json-LICENSE.txt b/lib/json-LICENSE.txt
deleted file mode 100644
index a8c1705ceb..0000000000
--- a/lib/json-LICENSE.txt
+++ /dev/null
@@ -1,22 +0,0 @@
-Copyright (c) 2002 JSON.org
-
-Permission is hereby granted, free of charge, to any person obtaining
-a copy of this software and associated documentation files (the
-"Software"), to deal in the Software without restriction, including
-without limitation the rights to use, copy, modify, merge, publish,
-distribute, sublicense, and/or sell copies of the Software, and to
-permit persons to whom the Software is furnished to do so, subject to
-the following conditions:
-
-The above copyright notice and this permission notice shall be
-included in all copies or substantial portions of the Software.
-
-The Software shall be used for Good, not Evil.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
-EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
-MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
-NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
-LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
-OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
-WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
diff --git a/lib/json-README.txt b/lib/json-README.txt
deleted file mode 100644
index 67b89092e7..0000000000
--- a/lib/json-README.txt
+++ /dev/null
@@ -1,563 +0,0 @@
-
-
-
-
-
-
-Network Working Group                                       D. Crockford
-Request for Comments: 4627                                      JSON.org
-Category: Informational                                        July 2006
-
-
- The application/json Media Type for JavaScript Object Notation (JSON)
-
-Status of This Memo
-
-   This memo provides information for the Internet community.  It does
-   not specify an Internet standard of any kind.  Distribution of this
-   memo is unlimited.
-
-Copyright Notice
-
-   Copyright (C) The Internet Society (2006).
-
-Abstract
-
-   JavaScript Object Notation (JSON) is a lightweight, text-based,
-   language-independent data interchange format.  It was derived from
-   the ECMAScript Programming Language Standard.  JSON defines a small
-   set of formatting rules for the portable representation of structured
-   data.
-
-1.  Introduction
-
-   JavaScript Object Notation (JSON) is a text format for the
-   serialization of structured data.  It is derived from the object
-   literals of JavaScript, as defined in the ECMAScript Programming
-   Language Standard, Third Edition [ECMA].
-
-   JSON can represent four primitive types (strings, numbers, booleans,
-   and null) and two structured types (objects and arrays).
-
-   A string is a sequence of zero or more Unicode characters [UNICODE].
-
-   An object is an unordered collection of zero or more name/value
-   pairs, where a name is a string and a value is a string, number,
-   boolean, null, object, or array.
-
-   An array is an ordered sequence of zero or more values.
-
-   The terms "object" and "array" come from the conventions of
-   JavaScript.
-
-   JSON's design goals were for it to be minimal, portable, textual, and
-   a subset of JavaScript.
-
-
-
-Crockford                    Informational                      [Page 1]
-
-RFC 4627                          JSON                         July 2006
-
-
-1.1.  Conventions Used in This Document
-
-   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
-   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
-   document are to be interpreted as described in [RFC2119].
-
-   The grammatical rules in this document are to be interpreted as
-   described in [RFC4234].
-
-2.  JSON Grammar
-
-   A JSON text is a sequence of tokens.  The set of tokens includes six
-   structural characters, strings, numbers, and three literal names.
-
-   A JSON text is a serialized object or array.
-
-      JSON-text = object / array
-
-   These are the six structural characters:
-
-      begin-array     = ws %x5B ws  ; [ left square bracket
-
-      begin-object    = ws %x7B ws  ; { left curly bracket
-
-      end-array       = ws %x5D ws  ; ] right square bracket
-
-      end-object      = ws %x7D ws  ; } right curly bracket
-
-      name-separator  = ws %x3A ws  ; : colon
-
-      value-separator = ws %x2C ws  ; , comma
-
-   Insignificant whitespace is allowed before or after any of the six
-   structural characters.
-
-      ws = *(
-                %x20 /              ; Space
-                %x09 /              ; Horizontal tab
-                %x0A /              ; Line feed or New line
-                %x0D                ; Carriage return
-            )
-
-2.1.  Values
-
-   A JSON value MUST be an object, array, number, or string, or one of
-   the following three literal names:
-
-      false null true
-
-
-
-Crockford                    Informational                      [Page 2]
-
-RFC 4627                          JSON                         July 2006
-
-
-   The literal names MUST be lowercase.  No other literal names are
-   allowed.
-
-         value = false / null / true / object / array / number / string
-
-         false = %x66.61.6c.73.65   ; false
-
-         null  = %x6e.75.6c.6c      ; null
-
-         true  = %x74.72.75.65      ; true
-
-2.2.  Objects
-
-   An object structure is represented as a pair of curly brackets
-   surrounding zero or more name/value pairs (or members).  A name is a
-   string.  A single colon comes after each name, separating the name
-   from the value.  A single comma separates a value from a following
-   name.  The names within an object SHOULD be unique.
-
-      object = begin-object [ member *( value-separator member ) ]
-      end-object
-
-      member = string name-separator value
-
-2.3.  Arrays
-
-   An array structure is represented as square brackets surrounding zero
-   or more values (or elements).  Elements are separated by commas.
-
-      array = begin-array [ value *( value-separator value ) ] end-array
-
-2.4.  Numbers
-
-   The representation of numbers is similar to that used in most
-   programming languages.  A number contains an integer component that
-   may be prefixed with an optional minus sign, which may be followed by
-   a fraction part and/or an exponent part.
-
-   Octal and hex forms are not allowed.  Leading zeros are not allowed.
-
-   A fraction part is a decimal point followed by one or more digits.
-
-   An exponent part begins with the letter E in upper or lowercase,
-   which may be followed by a plus or minus sign.  The E and optional
-   sign are followed by one or more digits.
-
-   Numeric values that cannot be represented as sequences of digits
-   (such as Infinity and NaN) are not permitted.
-
-
-
-Crockford                    Informational                      [Page 3]
-
-RFC 4627                          JSON                         July 2006
-
-
-         number = [ minus ] int [ frac ] [ exp ]
-
-         decimal-point = %x2E       ; .
-
-         digit1-9 = %x31-39         ; 1-9
-
-         e = %x65 / %x45            ; e E
-
-         exp = e [ minus / plus ] 1*DIGIT
-
-         frac = decimal-point 1*DIGIT
-
-         int = zero / ( digit1-9 *DIGIT )
-
-         minus = %x2D               ; -
-
-         plus = %x2B                ; +
-
-         zero = %x30                ; 0
-
-2.5.  Strings
-
-   The representation of strings is similar to conventions used in the C
-   family of programming languages.  A string begins and ends with
-   quotation marks.  All Unicode characters may be placed within the
-   quotation marks except for the characters that must be escaped:
-   quotation mark, reverse solidus, and the control characters (U+0000
-   through U+001F).
-
-   Any character may be escaped.  If the character is in the Basic
-   Multilingual Plane (U+0000 through U+FFFF), then it may be
-   represented as a six-character sequence: a reverse solidus, followed
-   by the lowercase letter u, followed by four hexadecimal digits that
-   encode the character's code point.  The hexadecimal letters A though
-   F can be upper or lowercase.  So, for example, a string containing
-   only a single reverse solidus character may be represented as
-   "\u005C".
-
-   Alternatively, there are two-character sequence escape
-   representations of some popular characters.  So, for example, a
-   string containing only a single reverse solidus character may be
-   represented more compactly as "\\".
-
-   To escape an extended character that is not in the Basic Multilingual
-   Plane, the character is represented as a twelve-character sequence,
-   encoding the UTF-16 surrogate pair.  So, for example, a string
-   containing only the G clef character (U+1D11E) may be represented as
-   "\uD834\uDD1E".
-
-
-
-Crockford                    Informational                      [Page 4]
-
-RFC 4627                          JSON                         July 2006
-
-
-         string = quotation-mark *char quotation-mark
-
-         char = unescaped /
-                escape (
-                    %x22 /          ; "    quotation mark  U+0022
-                    %x5C /          ; \    reverse solidus U+005C
-                    %x2F /          ; /    solidus         U+002F
-                    %x62 /          ; b    backspace       U+0008
-                    %x66 /          ; f    form feed       U+000C
-                    %x6E /          ; n    line feed       U+000A
-                    %x72 /          ; r    carriage return U+000D
-                    %x74 /          ; t    tab             U+0009
-                    %x75 4HEXDIG )  ; uXXXX                U+XXXX
-
-         escape = %x5C              ; \
-
-         quotation-mark = %x22      ; "
-
-         unescaped = %x20-21 / %x23-5B / %x5D-10FFFF
-
-3.  Encoding
-
-   JSON text SHALL be encoded in Unicode.  The default encoding is
-   UTF-8.
-
-   Since the first two characters of a JSON text will always be ASCII
-   characters [RFC0020], it is possible to determine whether an octet
-   stream is UTF-8, UTF-16 (BE or LE), or UTF-32 (BE or LE) by looking
-   at the pattern of nulls in the first four octets.
-
-           00 00 00 xx  UTF-32BE
-           00 xx 00 xx  UTF-16BE
-           xx 00 00 00  UTF-32LE
-           xx 00 xx 00  UTF-16LE
-           xx xx xx xx  UTF-8
-
-4.  Parsers
-
-   A JSON parser transforms a JSON text into another representation.  A
-   JSON parser MUST accept all texts that conform to the JSON grammar.
-   A JSON parser MAY accept non-JSON forms or extensions.
-
-   An implementation may set limits on the size of texts that it
-   accepts.  An implementation may set limits on the maximum depth of
-   nesting.  An implementation may set limits on the range of numbers.
-   An implementation may set limits on the length and character contents
-   of strings.
-
-
-
-
-Crockford                    Informational                      [Page 5]
-
-RFC 4627                          JSON                         July 2006
-
-
-5. Generators
-
-   A JSON generator produces JSON text.  The resulting text MUST
-   strictly conform to the JSON grammar.
-
-6. IANA Considerations
-
-   The MIME media type for JSON text is application/json.
-
-   Type name: application
-
-   Subtype name: json
-
-   Required parameters: n/a
-
-   Optional parameters: n/a
-
-   Encoding considerations: 8bit if UTF-8; binary if UTF-16 or UTF-32
-
-      JSON may be represented using UTF-8, UTF-16, or UTF-32.  When JSON
-      is written in UTF-8, JSON is 8bit compatible.  When JSON is
-      written in UTF-16 or UTF-32, the binary content-transfer-encoding
-      must be used.
-
-   Security considerations:
-
-   Generally there are security issues with scripting languages.  JSON
-   is a subset of JavaScript, but it is a safe subset that excludes
-   assignment and invocation.
-
-   A JSON text can be safely passed into JavaScript's eval() function
-   (which compiles and executes a string) if all the characters not
-   enclosed in strings are in the set of characters that form JSON
-   tokens.  This can be quickly determined in JavaScript with two
-   regular expressions and calls to the test and replace methods.
-
-      var my_JSON_object = !(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(
-             text.replace(/"(\\.|[^"\\])*"/g, ''))) &&
-         eval('(' + text + ')');
-
-   Interoperability considerations: n/a
-
-   Published specification: RFC 4627
-
-
-
-
-
-
-
-
-Crockford                    Informational                      [Page 6]
-
-RFC 4627                          JSON                         July 2006
-
-
-   Applications that use this media type:
-
-      JSON has been used to exchange data between applications written
-      in all of these programming languages: ActionScript, C, C#,
-      ColdFusion, Common Lisp, E, Erlang, Java, JavaScript, Lua,
-      Objective CAML, Perl, PHP, Python, Rebol, Ruby, and Scheme.
-
-   Additional information:
-
-      Magic number(s): n/a
-      File extension(s): .json
-      Macintosh file type code(s): TEXT
-
-   Person & email address to contact for further information:
-      Douglas Crockford
-      douglas@crockford.com
-
-   Intended usage: COMMON
-
-   Restrictions on usage: none
-
-   Author:
-      Douglas Crockford
-      douglas@crockford.com
-
-   Change controller:
-      Douglas Crockford
-      douglas@crockford.com
-
-7. Security Considerations
-
-   See Security Considerations in Section 6.
-
-8. Examples
-
-   This is a JSON object:
-
-   {
-      "Image": {
-          "Width":  800,
-          "Height": 600,
-          "Title":  "View from 15th Floor",
-          "Thumbnail": {
-              "Url":    "http://www.example.com/image/481989943",
-              "Height": 125,
-              "Width":  "100"
-          },
-          "IDs": [116, 943, 234, 38793]
-
-
-
-Crockford                    Informational                      [Page 7]
-
-RFC 4627                          JSON                         July 2006
-
-
-        }
-   }
-
-   Its Image member is an object whose Thumbnail member is an object
-   and whose IDs member is an array of numbers.
-
-   This is a JSON array containing two objects:
-
-   [
-      {
-         "precision": "zip",
-         "Latitude":  37.7668,
-         "Longitude": -122.3959,
-         "Address":   "",
-         "City":      "SAN FRANCISCO",
-         "State":     "CA",
-         "Zip":       "94107",
-         "Country":   "US"
-      },
-      {
-         "precision": "zip",
-         "Latitude":  37.371991,
-         "Longitude": -122.026020,
-         "Address":   "",
-         "City":      "SUNNYVALE",
-         "State":     "CA",
-         "Zip":       "94085",
-         "Country":   "US"
-      }
-   ]
-
-9. References
-
-9.1.  Normative References
-
-   [ECMA]    European Computer Manufacturers Association, "ECMAScript
-             Language Specification 3rd Edition", December 1999,
-             <http://www.ecma-international.org/publications/files/
-             ecma-st/ECMA-262.pdf>.
-
-   [RFC0020] Cerf, V., "ASCII format for network interchange", RFC 20,
-             October 1969.
-
-   [RFC2119] Bradner, S., "Key words for use in RFCs to Indicate
-             Requirement Levels", BCP 14, RFC 2119, March 1997.
-
-   [RFC4234] Crocker, D. and P.  Overell, "Augmented BNF for Syntax
-             Specifications: ABNF", RFC 4234, October 2005.
-
-
-
-Crockford                    Informational                      [Page 8]
-
-RFC 4627                          JSON                         July 2006
-
-
-   [UNICODE] The Unicode Consortium, "The Unicode Standard Version 4.0",
-             2003, <http://www.unicode.org/versions/Unicode4.1.0/>.
-
-Author's Address
-
-   Douglas Crockford
-   JSON.org
-   EMail: douglas@crockford.com
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-Crockford                    Informational                      [Page 9]
-
-RFC 4627                          JSON                         July 2006
-
-
-Full Copyright Statement
-
-   Copyright (C) The Internet Society (2006).
-
-   This document is subject to the rights, licenses and restrictions
-   contained in BCP 78, and except as set forth therein, the authors
-   retain all their rights.
-
-   This document and the information contained herein are provided on an
-   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
-   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
-   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
-   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
-   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
-   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
-
-Intellectual Property
-
-   The IETF takes no position regarding the validity or scope of any
-   Intellectual Property Rights or other rights that might be claimed to
-   pertain to the implementation or use of the technology described in
-   this document or the extent to which any license under such rights
-   might or might not be available; nor does it represent that it has
-   made any independent effort to identify any such rights.  Information
-   on the procedures with respect to rights in RFC documents can be
-   found in BCP 78 and BCP 79.
-
-   Copies of IPR disclosures made to the IETF Secretariat and any
-   assurances of licenses to be made available, or the result of an
-   attempt made to obtain a general license or permission for the use of
-   such proprietary rights by implementers or users of this
-   specification can be obtained from the IETF on-line IPR repository at
-   http://www.ietf.org/ipr.
-
-   The IETF invites any interested party to bring to its attention any
-   copyrights, patents or patent applications, or other proprietary
-   rights that may cover technology that may be required to implement
-   this standard.  Please address the information to the IETF at
-   ietf-ipr@ietf.org.
-
-Acknowledgement
-
-   Funding for the RFC Editor function is provided by the IETF
-   Administrative Support Activity (IASA).
-
-
-
-
-
-
-
-Crockford                    Informational                     [Page 10]
-
diff --git a/lib/json.jar b/lib/json.jar
deleted file mode 100644
index 219760c7ba..0000000000
Binary files a/lib/json.jar and /dev/null differ
diff --git a/lib/velocity-1.5.jar b/lib/velocity-1.5.jar
deleted file mode 100644
index 7c7f2c43b4..0000000000
Binary files a/lib/velocity-1.5.jar and /dev/null differ
diff --git a/lib/velocity.LICENSE b/lib/velocity.LICENSE
deleted file mode 100644
index 261eeb9e9f..0000000000
--- a/lib/velocity.LICENSE
+++ /dev/null
@@ -1,201 +0,0 @@
-                                 Apache License
-                           Version 2.0, January 2004
-                        http://www.apache.org/licenses/
-
-   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
-
-   1. Definitions.
-
-      "License" shall mean the terms and conditions for use, reproduction,
-      and distribution as defined by Sections 1 through 9 of this document.
-
-      "Licensor" shall mean the copyright owner or entity authorized by
-      the copyright owner that is granting the License.
-
-      "Legal Entity" shall mean the union of the acting entity and all
-      other entities that control, are controlled by, or are under common
-      control with that entity. For the purposes of this definition,
-      "control" means (i) the power, direct or indirect, to cause the
-      direction or management of such entity, whether by contract or
-      otherwise, or (ii) ownership of fifty percent (50%) or more of the
-      outstanding shares, or (iii) beneficial ownership of such entity.
-
-      "You" (or "Your") shall mean an individual or Legal Entity
-      exercising permissions granted by this License.
-
-      "Source" form shall mean the preferred form for making modifications,
-      including but not limited to software source code, documentation
-      source, and configuration files.
-
-      "Object" form shall mean any form resulting from mechanical
-      transformation or translation of a Source form, including but
-      not limited to compiled object code, generated documentation,
-      and conversions to other media types.
-
-      "Work" shall mean the work of authorship, whether in Source or
-      Object form, made available under the License, as indicated by a
-      copyright notice that is included in or attached to the work
-      (an example is provided in the Appendix below).
-
-      "Derivative Works" shall mean any work, whether in Source or Object
-      form, that is based on (or derived from) the Work and for which the
-      editorial revisions, annotations, elaborations, or other modifications
-      represent, as a whole, an original work of authorship. For the purposes
-      of this License, Derivative Works shall not include works that remain
-      separable from, or merely link (or bind by name) to the interfaces of,
-      the Work and Derivative Works thereof.
-
-      "Contribution" shall mean any work of authorship, including
-      the original version of the Work and any modifications or additions
-      to that Work or Derivative Works thereof, that is intentionally
-      submitted to Licensor for inclusion in the Work by the copyright owner
-      or by an individual or Legal Entity authorized to submit on behalf of
-      the copyright owner. For the purposes of this definition, "submitted"
-      means any form of electronic, verbal, or written communication sent
-      to the Licensor or its representatives, including but not limited to
-      communication on electronic mailing lists, source code control systems,
-      and issue tracking systems that are managed by, or on behalf of, the
-      Licensor for the purpose of discussing and improving the Work, but
-      excluding communication that is conspicuously marked or otherwise
-      designated in writing by the copyright owner as "Not a Contribution."
-
-      "Contributor" shall mean Licensor and any individual or Legal Entity
-      on behalf of whom a Contribution has been received by Licensor and
-      subsequently incorporated within the Work.
-
-   2. Grant of Copyright License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      copyright license to reproduce, prepare Derivative Works of,
-      publicly display, publicly perform, sublicense, and distribute the
-      Work and such Derivative Works in Source or Object form.
-
-   3. Grant of Patent License. Subject to the terms and conditions of
-      this License, each Contributor hereby grants to You a perpetual,
-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
-      (except as stated in this section) patent license to make, have made,
-      use, offer to sell, sell, import, and otherwise transfer the Work,
-      where such license applies only to those patent claims licensable
-      by such Contributor that are necessarily infringed by their
-      Contribution(s) alone or by combination of their Contribution(s)
-      with the Work to which such Contribution(s) was submitted. If You
-      institute patent litigation against any entity (including a
-      cross-claim or counterclaim in a lawsuit) alleging that the Work
-      or a Contribution incorporated within the Work constitutes direct
-      or contributory patent infringement, then any patent licenses
-      granted to You under this License for that Work shall terminate
-      as of the date such litigation is filed.
-
-   4. Redistribution. You may reproduce and distribute copies of the
-      Work or Derivative Works thereof in any medium, with or without
-      modifications, and in Source or Object form, provided that You
-      meet the following conditions:
-
-      (a) You must give any other recipients of the Work or
-          Derivative Works a copy of this License; and
-
-      (b) You must cause any modified files to carry prominent notices
-          stating that You changed the files; and
-
-      (c) You must retain, in the Source form of any Derivative Works
-          that You distribute, all copyright, patent, trademark, and
-          attribution notices from the Source form of the Work,
-          excluding those notices that do not pertain to any part of
-          the Derivative Works; and
-
-      (d) If the Work includes a "NOTICE" text file as part of its
-          distribution, then any Derivative Works that You distribute must
-          include a readable copy of the attribution notices contained
-          within such NOTICE file, excluding those notices that do not
-          pertain to any part of the Derivative Works, in at least one
-          of the following places: within a NOTICE text file distributed
-          as part of the Derivative Works; within the Source form or
-          documentation, if provided along with the Derivative Works; or,
-          within a display generated by the Derivative Works, if and
-          wherever such third-party notices normally appear. The contents
-          of the NOTICE file are for informational purposes only and
-          do not modify the License. You may add Your own attribution
-          notices within Derivative Works that You distribute, alongside
-          or as an addendum to the NOTICE text from the Work, provided
-          that such additional attribution notices cannot be construed
-          as modifying the License.
-
-      You may add Your own copyright statement to Your modifications and
-      may provide additional or different license terms and conditions
-      for use, reproduction, or distribution of Your modifications, or
-      for any such Derivative Works as a whole, provided Your use,
-      reproduction, and distribution of the Work otherwise complies with
-      the conditions stated in this License.
-
-   5. Submission of Contributions. Unless You explicitly state otherwise,
-      any Contribution intentionally submitted for inclusion in the Work
-      by You to the Licensor shall be under the terms and conditions of
-      this License, without any additional terms or conditions.
-      Notwithstanding the above, nothing herein shall supersede or modify
-      the terms of any separate license agreement you may have executed
-      with Licensor regarding such Contributions.
-
-   6. Trademarks. This License does not grant permission to use the trade
-      names, trademarks, service marks, or product names of the Licensor,
-      except as required for reasonable and customary use in describing the
-      origin of the Work and reproducing the content of the NOTICE file.
-
-   7. Disclaimer of Warranty. Unless required by applicable law or
-      agreed to in writing, Licensor provides the Work (and each
-      Contributor provides its Contributions) on an "AS IS" BASIS,
-      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
-      implied, including, without limitation, any warranties or conditions
-      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
-      PARTICULAR PURPOSE. You are solely responsible for determining the
-      appropriateness of using or redistributing the Work and assume any
-      risks associated with Your exercise of permissions under this License.
-
-   8. Limitation of Liability. In no event and under no legal theory,
-      whether in tort (including negligence), contract, or otherwise,
-      unless required by applicable law (such as deliberate and grossly
-      negligent acts) or agreed to in writing, shall any Contributor be
-      liable to You for damages, including any direct, indirect, special,
-      incidental, or consequential damages of any character arising as a
-      result of this License or out of the use or inability to use the
-      Work (including but not limited to damages for loss of goodwill,
-      work stoppage, computer failure or malfunction, or any and all
-      other commercial damages or losses), even if such Contributor
-      has been advised of the possibility of such damages.
-
-   9. Accepting Warranty or Additional Liability. While redistributing
-      the Work or Derivative Works thereof, You may choose to offer,
-      and charge a fee for, acceptance of support, warranty, indemnity,
-      or other liability obligations and/or rights consistent with this
-      License. However, in accepting such obligations, You may act only
-      on Your own behalf and on Your sole responsibility, not on behalf
-      of any other Contributor, and only if You agree to indemnify,
-      defend, and hold each Contributor harmless for any liability
-      incurred by, or claims asserted against, such Contributor by reason
-      of your accepting any such warranty or additional liability.
-
-   END OF TERMS AND CONDITIONS
-
-   APPENDIX: How to apply the Apache License to your work.
-
-      To apply the Apache License to your work, attach the following
-      boilerplate notice, with the fields enclosed by brackets "[]"
-      replaced with your own identifying information. (Don't include
-      the brackets!)  The text should be enclosed in the appropriate
-      comment syntax for the file format. We also recommend that a
-      file or class name and description of purpose be included on the
-      same "printed page" as the copyright notice for easier
-      identification within third-party archives.
-
-   Copyright [yyyy] [name of copyright owner]
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-   you may not use this file except in compliance with the License.
-   You may obtain a copy of the License at
-
-       http://www.apache.org/licenses/LICENSE-2.0
-
-   Unless required by applicable law or agreed to in writing, software
-   distributed under the License is distributed on an "AS IS" BASIS,
-   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-   See the License for the specific language governing permissions and
-   limitations under the License.
diff --git a/metastore/build.xml b/metastore/build.xml
index af46bc95ad..2348dc2c12 100755
--- a/metastore/build.xml
+++ b/metastore/build.xml
@@ -36,10 +36,10 @@
     <mapper type="merge" to="${build.dir}/gen/antlr/gen-java/org/apache/hadoop/hive/metastore/parser/FilterParser.java"/>
   </uptodate>
 
-  <target name="build-grammar" unless="grammarBuild.notRequired">
+  <target name="build-grammar" unless="grammarBuild.notRequired" depends="ivy-retrieve">
     <echo message="Project: ${ant.project.name}"/>
     <echo>Building Grammar ${src.dir}/java/org/apache/hadoop/hive/metastore/parser/Filter.g  ....</echo>
-    <java classname="org.antlr.Tool" classpathref="classpath" fork="false">
+    <java classname="org.antlr.Tool" classpathref="classpath" fork="false" failonerror="true">
        <arg value="-fo" />
        <arg value="${build.dir}/gen/antlr/gen-java/org/apache/hadoop/hive/metastore/parser" />
        <arg value="${src.dir}/java/org/apache/hadoop/hive/metastore/parser/Filter.g" />
@@ -60,7 +60,7 @@
      destdir="${build.classes}"
      debug="${javac.debug}"
      deprecation="${javac.deprecation}"
-     >
+     includeantruntime="false">
       <classpath refid="classpath"/>
     </javac>
   </target>
@@ -71,7 +71,11 @@
 
   <target name="model-compile" depends="init">
     <echo message="Project: ${ant.project.name}"/>
-    <javac srcdir="${model.dir}"  destdir="${build.classes}" debug="${javac.debug}">
+    <javac
+        srcdir="${model.dir}"
+        destdir="${build.classes}"
+        debug="${javac.debug}"
+        includeantruntime="false">
        <classpath refid="classpath"/>
     </javac>
     <!-- ORM data for model -->
diff --git a/metastore/ivy.xml b/metastore/ivy.xml
index 7d90b254b3..3bbfb17032 100644
--- a/metastore/ivy.xml
+++ b/metastore/ivy.xml
@@ -15,66 +15,57 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-metastore" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency>
-        <dependency org="commons-cli" name="commons-cli" rev="${commons-cli.version}"/>
-	<dependency org="commons-dbcp" name="commons-dbcp" rev="${commons-dbcp.version}">
-          <exclude module="commons-pool" />
-          <exclude org="org.apache.geronimo.specs" module="geronimo-jta_1.1_spec"/>
-        </dependency>
-        <dependency org="commons-pool" name="commons-pool" rev="${commons-pool.version}"/>
-        <dependency org="org.datanucleus" name="datanucleus-connectionpool" rev="${datanucleus-connectionpool.version}">
-          <exclude module="proxool" />
-          <exclude module="c3p0" />
-          <exclude module="datanucleus-core" />
-          <exclude module="datanucleus-rdbms" />
-          <exclude module="commons-collections" />
-          <exclude module="commons-pool" />
-          <exclude module="commons-dbcp" />
-          <exclude org="com.jolbox" module="bonecp"/>
-        </dependency>
-        <dependency org="org.datanucleus" name="datanucleus-core" rev="${datanucleus-core.version}">
-          <exclude org="javax.jdo" module="jdo2-api"/>
-          <exclude org="org.apache.geronimo.specs" module="geronimo-jta_1.1_spec"/>
-          <exclude org="org.eclipse.equinox" module="org.eclipse.equinox.registry"/>
-          <exclude org="org.eclipse.equinox" module="org.eclipse.equinox.common"/>
-          <exclude org="org.eclipse.core" module="org.eclipse.core.runtime"/>
-          <exclude org="org.eclipse.osgi" module="org.eclipse.osgi"/>
-          <exclude org="log4j" module="log4j"/>
-        </dependency>
-        <dependency org="org.datanucleus" name="datanucleus-enhancer" rev="${datanucleus-enhancer.version}">
-          <exclude org="org.datanucleus" module="datanucleus-core"/>
-          <exclude org="javax.jdo" module="jdo2-api"/>
-          <exclude org="asm" module="asm"/>
-          <exclude org="org.apache.ant" module="ant"/>
-        </dependency>
-        <dependency org="org.datanucleus" name="datanucleus-rdbms" rev="${datanucleus-rdbms.version}">
-          <exclude org="org.datanucleus" module="datanucleus-core"/>
-          <exclude org="javax.jdo" module="jdo2-api"/>
-          <exclude org="org.apache.geronimo.specs" module="geronimo-jta_1.1_spec"/>
-          <exclude org="org.datanucleus" module="datanucleus-thirdparty"/>
-          <exclude org="org.apache.ant" module="ant"/>
-          <exclude org="oracle" module="ojdbc14_g"/>
-        </dependency>
-        <dependency org="javax.jdo" name="jdo2-api" rev="${jdo-api.version}">
-          <exclude org="javax.transaction" module="jta"/>
-          <exclude org="org.apache.ant" module="ant"/>
-          <exclude org="org.apache.geronimo.specs" module="geronimo-jpa_3.0_spec"/>
-        </dependency>
-        <dependency org="org.slf4j" name="slf4j-api" rev="${slf4j-api.version}"/>
-        <dependency org="org.slf4j" name="slf4j-log4j12" rev="${slf4j-log4j12.version}"/>
-        <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
-                    transitive="false"/>
-        <dependency org="org.apache.thrift" name="libfb303" rev="${libfb303.version}"
-                    transitive="false"/>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-metastore" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency>
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-serde" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-shims" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.antlr" name="antlr" rev="${antlr.version}"/>
+    <dependency org="org.antlr" name="antlr-runtime" rev="${antlr-runtime.version}"/>
+    <dependency org="commons-cli" name="commons-cli" rev="${commons-cli.version}"/>
+    <dependency org="commons-lang" name="commons-lang" rev="${commons-lang.version}"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+    <dependency org="commons-dbcp" name="commons-dbcp" rev="${commons-dbcp.version}">
+      <exclude module="commons-pool" />
+      <exclude org="org.apache.geronimo.specs" module="geronimo-jta_1.1_spec"/>
+    </dependency>
+    <dependency org="commons-pool" name="commons-pool" rev="${commons-pool.version}"/>
+    <dependency org="org.datanucleus" name="datanucleus-connectionpool" rev="${datanucleus-connectionpool.version}"
+                transitive="false"/>
+    <dependency org="org.datanucleus" name="datanucleus-core" rev="${datanucleus-core.version}"
+                transitive="false"/>
+    <dependency org="org.datanucleus" name="datanucleus-enhancer" rev="${datanucleus-enhancer.version}"
+                transitive="false"/>
+    <dependency org="org.datanucleus" name="datanucleus-rdbms" rev="${datanucleus-rdbms.version}"
+                transitive="false"/>
+    <dependency org="javax.jdo" name="jdo2-api" rev="${jdo-api.version}"
+                transitive="false"/>
+    <dependency org="org.apache.derby" name="derby" rev="${derby.version}"/>
+    <dependency org="org.slf4j" name="slf4j-api" rev="${slf4j-api.version}"/>
+    <dependency org="org.slf4j" name="slf4j-log4j12" rev="${slf4j-log4j12.version}"
+                transitive="false"/>
+    <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
+                transitive="false"/>
+    <dependency org="org.apache.thrift" name="libfb303" rev="${libfb303.version}"
+                transitive="false"/>
+    <dependency org="asm" name="asm" rev="${asm.version}"/>
+  </dependencies>
 </ivy-module>
diff --git a/odbc/ivy.xml b/odbc/ivy.xml
new file mode 100644
index 0000000000..be556ab242
--- /dev/null
+++ b/odbc/ivy.xml
@@ -0,0 +1,34 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+<ivy-module version="2.0">
+  <info organisation="${hive.ivy.org}" module="hive-odbc" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <!-- THIS POM IS NOT PUBLISHED! IT EXISTS ONLY TO KEEP IVY/ANT HAPPY DURING THE BUILD.
+         PLEASE IGNORE.
+         -->
+  </dependencies>
+</ivy-module>
diff --git a/pdk/build.xml b/pdk/build.xml
index 374e5d1f2d..abef0be7bc 100644
--- a/pdk/build.xml
+++ b/pdk/build.xml
@@ -27,7 +27,7 @@
     <path refid="classpath"/>
   </path>
 
-  <target name="compile" depends="init, setup">
+  <target name="compile" depends="init, setup, ivy-retrieve">
     <echo message="Project: ${ant.project.name}"/>
     <javac
      encoding="${build.encoding}"
@@ -35,7 +35,8 @@
      includes="**/*.java"
      destdir="${build.classes}"
      debug="${javac.debug}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath-pdk"/>
     </javac>
diff --git a/pdk/ivy.xml b/pdk/ivy.xml
index 411e126533..9fc165fc4b 100644
--- a/pdk/ivy.xml
+++ b/pdk/ivy.xml
@@ -16,13 +16,16 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-pdk" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-pdk" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+  </dependencies>
 </ivy-module>
diff --git a/ql/build.xml b/ql/build.xml
index 8b22508df1..636bd4da70 100644
--- a/ql/build.xml
+++ b/ql/build.xml
@@ -38,7 +38,6 @@
     <pathelement location="${hadoop.conf.dir}"/>
     <pathelement location="${test.src.data.dir}/conf"/>
     <pathelement location="${hive.conf.dir}"/>
-    <pathelement location="${hive.root}/cli/lib/jline-0.9.94.jar"/>
     <pathelement location="${hadoop.oldstyle-name.test.jar}"/>
     <pathelement location="${hadoop.newstyle-name.test.jar}"/>
     <pathelement location="${jetty.test.jar}"/>
@@ -47,7 +46,7 @@
     <pathelement location="${jasperc.test.jar}"/>
     <pathelement location="${jsp.test.jar}"/>
     <pathelement location="${common.jar}"/>
-    <pathelement location="${hive.root}/lib/derby.jar"/>
+    <pathelement location="${hive.root}/build/ivy/lib/default/derby-${derby.version}.jar"/>
     <fileset dir="${hive.root}" includes="testlibs/*.jar"/>
     <fileset dir="${hadoop.root}/lib" includes="*.jar"/>
     <fileset dir="${hadoop.root}/lib" includes="jsp-2.1/*.jar"/>
@@ -55,7 +54,7 @@
   </path>
 
   <target name="thriftif" depends="check-thrift-home">
-    <echo message="Project: ${ant.project.name}"/>
+    <echo message="${ant.project.name}"/>
     <fail unless="thrift.home">You must set the 'thrift.home' property!</fail>
     <echo>Executing ${thrift.home}/bin/thrift on ${ant.project.name}/if/queryplan.thrift</echo>
     <exec executable="${thrift.home}/bin/thrift"  failonerror="true" dir=".">
@@ -64,9 +63,9 @@
   </target>
 
   <target name="gen-test" depends="test-conditions, test-init" >
-    <echo message="Project: ${ant.project.name}"/>
+    <echo message="${ant.project.name}"/>
     <taskdef name="qtestgen" classname="org.apache.hadoop.hive.ant.QTestGenTask"
-             classpath="${build.dir.hive}/anttasks/hive-anttasks-${version}.jar:${hive.root}/lib/velocity-1.5.jar:${hive.root}/lib/commons-collections-3.2.1.jar:${hive.root}/lib/commons-lang-2.4.jar:${hive.root}/lib/derby.jar"/>
+             classpath="${build.dir.hive}/anttasks/hive-anttasks-${version}.jar:${build.ivy.lib.dir}/default/velocity-${velocity.version}.jar:${build.ivy.lib.dir}/default/commons-collections-${commons-collections.version}.jar:${build.ivy.lib.dir}/default/commons-lang-${commons-lang.version}.jar:${build.ivy.lib.dir}/default/derby-${derby.version}.jar"/>
     
     <qtestgen outputDirectory="${test.build.src}/org/apache/hadoop/hive/ql/parse" 
               templatePath="${ql.test.template.dir}" template="TestParse.vm" 
@@ -171,7 +170,7 @@
     <mkdir dir="${build.dir}/gen/antlr/gen-java/org/apache/hadoop/hive/ql/parse"/>
   </target>
 
-  <target name="compile" depends="init, ql-init, build-grammar, ivy-retrieve">
+  <target name="compile" depends="init, ql-init, ivy-retrieve, build-grammar">
     <echo message="Project: ${ant.project.name}"/>
     <javac
      encoding="${build.encoding}"
@@ -179,7 +178,8 @@
      includes="**/*.java"
      destdir="${build.classes}"
      debug="${javac.debug}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
     </javac>
@@ -198,18 +198,24 @@
           <exclude name="META-INF/MANIFEST.MF"/>
       </patternset>
     </unzip>
-    <unzip src="${hive.root}/lib/commons-lang-2.4.jar" dest="${build.dir.hive}/commons-lang/classes">
+    <unzip src="${build.ivy.lib.dir}/default/commons-lang-${commons-lang.version}.jar" dest="${build.dir.hive}/commons-lang/classes">
       <patternset>
           <exclude name="META-INF"/>
           <exclude name="META-INF/MANIFEST.MF"/>
       </patternset>
     </unzip>
-    <unzip src="${hive.root}/lib/json.jar" dest="${build.dir.hive}/json/classes">
+    <unzip src="${build.ivy.lib.dir}/default/json-${json.version}.jar" dest="${build.dir.hive}/json/classes">
       <patternset>
           <exclude name="META-INF"/>
           <exclude name="META-INF/MANIFEST.MF"/>
       </patternset>
     </unzip>
+    <unzip src="${hive.root}/lib/javaewah-${javaewah.version}.jar" dest="${build.dir.hive}/javaewah/classes">
+      <patternset>
+        <exclude name="meta-inf"/>
+        <exclude name="meta-inf/manifest.mf"/>
+      </patternset>
+    </unzip>
     <!-- jar jarfile="${build.dir}/hive_${name}.jar" basedir="${build.classes}" / -->
     <jar jarfile="${build.dir}/hive-exec-${version}.jar">
       <fileset dir="${build.dir.hive}/common/classes" includes="**/*.class"/>
@@ -219,6 +225,7 @@
       <fileset dir="${build.dir.hive}/commons-lang/classes" includes="**/StringUtils.class,**/WordUtils.class"/>
       <fileset dir="${build.dir.hive}/json/classes" includes="**/*.class"/>
       <fileset dir="${build.dir.hive}/shims/classes" includes="**/*.class"/>
+      <fileset dir="${build.dir.hive}/javaewah/classes" includes="**/*.class"/>
       <manifest>
         <!-- Not putting these in their own manifest section, since that inserts
              a new-line, which breaks the reading of the attributes. -->
@@ -232,7 +239,7 @@
 
   <!-- Override deploy since we are deploying hive_exec and not hive_ql -->
   <target name="deploy" depends="jar">
-    <echo message="Project: ${ant.project.name}"/>
+    <echo message="${ant.project.name}"/>
     <mkdir dir="${deploy.dir}"/>
     <copy file="${build.dir}/hive-exec-${version}.jar"
           todir="${deploy.dir}"/>
diff --git a/ql/ivy.xml b/ql/ivy.xml
index a09e970b15..541ae58dd3 100644
--- a/ql/ivy.xml
+++ b/ql/ivy.xml
@@ -15,32 +15,50 @@
    limitations under the License.
 -->
 <ivy-module version="2.0" xmlns:m="http://ant.apache.org/ivy/maven">
-    <info organisation="${hive.ivy.org}" module="hive-exec" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency>
-        <dependency org="org.slf4j" name="slf4j-api" rev="${slf4j-api.version}"/>
-        <dependency org="org.slf4j" name="slf4j-log4j12" rev="${slf4j-log4j12.version}"/>
-        <dependency org="org.apache.hbase" name="hbase" rev="${hbase.version}"
-                    transitive="false">
-          <artifact name="hbase" type="jar"/>
-          <artifact name="hbase" type="test-jar" ext="jar"
-                    m:classifier="tests"/>
-        </dependency>
-        <dependency org="org.apache.zookeeper" name="zookeeper"
-                    rev="${zookeeper.version}" transitive="false">
-          <include type="jar"/>
-        </dependency>
-        <dependency org="com.google.guava" name="guava" rev="${guava.version}"
-                    transitive="false"/>
-        <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
-                    transitive="false"/>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-exec" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency>
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-metastore" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-serde" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-shims" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.antlr" name="antlr" rev="${antlr.version}"
+                transitive="false"/>
+    <dependency org="org.antlr" name="antlr-runtime" rev="${antlr-runtime.version}"/>
+    <dependency org="org.slf4j" name="slf4j-api" rev="${slf4j-api.version}"/>
+    <dependency org="org.slf4j" name="slf4j-log4j12" rev="${slf4j-log4j12.version}"
+                transitive="false"/>
+    <dependency org="org.apache.zookeeper" name="zookeeper"
+                rev="${zookeeper.version}" transitive="false">
+      <include type="jar"/>
+    </dependency>
+    <dependency org="com.google.guava" name="guava" rev="${guava.version}"
+                transitive="false"/>
+    <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
+                transitive="false"/>
+    <dependency org="log4j" name="log4j" rev="${log4j.version}" transitive="false"/>
+    <dependency org="org.json" name="json" rev="${json.version}"/>
+    <dependency org="commons-collections" name="commons-collections" rev="${commons-collections.version}"/>
+    <dependency org="commons-lang" name="commons-lang" rev="${commons-lang.version}"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+    <dependency org="org.apache.derby" name="derby" rev="${derby.version}"/>
+  </dependencies>
 </ivy-module>
diff --git a/ql/lib/README b/ql/lib/README
deleted file mode 100644
index d11400ef7e..0000000000
--- a/ql/lib/README
+++ /dev/null
@@ -1,7 +0,0 @@
-Folowing is the list of external jars contained in this directory and the sources from where they were obtained:
----------------------------------------------------------------------------------------------------------------
-
-*  stringtemplate-3.1b1.jar - http://www.stringtemplate.org/download.html
-*  antlr-2.7.7.jar - http://www.antlr.org/download.html
-*  antlr-3.0.1.jar - http://www.antlr.org/download.html
-*  antlr-runtime-3.0.1.jar - http://www.antlr.org/download.html
diff --git a/ql/lib/antlr-2.7.7.LICENSE b/ql/lib/antlr-2.7.7.LICENSE
deleted file mode 100644
index 1d1d5d644b..0000000000
--- a/ql/lib/antlr-2.7.7.LICENSE
+++ /dev/null
@@ -1,26 +0,0 @@
-[The "BSD licence"]
-Copyright (c) 2003-2006 Terence Parr
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or without
-modification, are permitted provided that the following conditions
-are met:
-
- 1. Redistributions of source code must retain the above copyright
-    notice, this list of conditions and the following disclaimer.
- 2. Redistributions in binary form must reproduce the above copyright
-    notice, this list of conditions and the following disclaimer in the
-    documentation and/or other materials provided with the distribution.
- 3. The name of the author may not be used to endorse or promote products
-    derived from this software without specific prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
-IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
-OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
-IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
-INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
-NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
-THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
diff --git a/ql/lib/antlr-2.7.7.jar b/ql/lib/antlr-2.7.7.jar
deleted file mode 100644
index 5e5f14b355..0000000000
Binary files a/ql/lib/antlr-2.7.7.jar and /dev/null differ
diff --git a/ql/lib/antlr-3.0.1.LICENSE b/ql/lib/antlr-3.0.1.LICENSE
deleted file mode 100644
index 1d1d5d644b..0000000000
--- a/ql/lib/antlr-3.0.1.LICENSE
+++ /dev/null
@@ -1,26 +0,0 @@
-[The "BSD licence"]
-Copyright (c) 2003-2006 Terence Parr
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or without
-modification, are permitted provided that the following conditions
-are met:
-
- 1. Redistributions of source code must retain the above copyright
-    notice, this list of conditions and the following disclaimer.
- 2. Redistributions in binary form must reproduce the above copyright
-    notice, this list of conditions and the following disclaimer in the
-    documentation and/or other materials provided with the distribution.
- 3. The name of the author may not be used to endorse or promote products
-    derived from this software without specific prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
-IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
-OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
-IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
-INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
-NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
-THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
diff --git a/ql/lib/antlr-3.0.1.jar b/ql/lib/antlr-3.0.1.jar
deleted file mode 100644
index 7d37952bab..0000000000
Binary files a/ql/lib/antlr-3.0.1.jar and /dev/null differ
diff --git a/ql/lib/antlr-runtime-3.0.1.LICENSE b/ql/lib/antlr-runtime-3.0.1.LICENSE
deleted file mode 100644
index 1d1d5d644b..0000000000
--- a/ql/lib/antlr-runtime-3.0.1.LICENSE
+++ /dev/null
@@ -1,26 +0,0 @@
-[The "BSD licence"]
-Copyright (c) 2003-2006 Terence Parr
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or without
-modification, are permitted provided that the following conditions
-are met:
-
- 1. Redistributions of source code must retain the above copyright
-    notice, this list of conditions and the following disclaimer.
- 2. Redistributions in binary form must reproduce the above copyright
-    notice, this list of conditions and the following disclaimer in the
-    documentation and/or other materials provided with the distribution.
- 3. The name of the author may not be used to endorse or promote products
-    derived from this software without specific prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
-IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
-OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
-IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
-INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
-NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
-THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
diff --git a/ql/lib/antlr-runtime-3.0.1.jar b/ql/lib/antlr-runtime-3.0.1.jar
deleted file mode 100644
index b2efb5b666..0000000000
Binary files a/ql/lib/antlr-runtime-3.0.1.jar and /dev/null differ
diff --git a/ql/lib/stringtemplate-3.1b1.LICENSE b/ql/lib/stringtemplate-3.1b1.LICENSE
deleted file mode 100644
index 1d1d5d644b..0000000000
--- a/ql/lib/stringtemplate-3.1b1.LICENSE
+++ /dev/null
@@ -1,26 +0,0 @@
-[The "BSD licence"]
-Copyright (c) 2003-2006 Terence Parr
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or without
-modification, are permitted provided that the following conditions
-are met:
-
- 1. Redistributions of source code must retain the above copyright
-    notice, this list of conditions and the following disclaimer.
- 2. Redistributions in binary form must reproduce the above copyright
-    notice, this list of conditions and the following disclaimer in the
-    documentation and/or other materials provided with the distribution.
- 3. The name of the author may not be used to endorse or promote products
-    derived from this software without specific prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
-IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
-OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
-IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
-INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
-NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
-DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
-THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
-THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
diff --git a/ql/lib/stringtemplate-3.1b1.jar b/ql/lib/stringtemplate-3.1b1.jar
deleted file mode 100644
index 096f863357..0000000000
Binary files a/ql/lib/stringtemplate-3.1b1.jar and /dev/null differ
diff --git a/ql/src/test/queries/clientpositive/set_processor_namespaces.q b/ql/src/test/queries/clientpositive/set_processor_namespaces.q
index 8fe2eb8bc8..7e3d1f4d8a 100644
--- a/ql/src/test/queries/clientpositive/set_processor_namespaces.q
+++ b/ql/src/test/queries/clientpositive/set_processor_namespaces.q
@@ -24,9 +24,8 @@ set b=a;
 set c=${hiveconf:${hiveconf:b}};
 set c;
 
-set jar=../lib/derby.jar;
+set jar=${system:build.ivy.lib.dir}/default/derby-${system:derby.version}.jar;
 
 add file ${hiveconf:jar};
-list file;
 delete file ${hiveconf:jar};
 list file;
diff --git a/ql/src/test/results/clientpositive/set_processor_namespaces.q.out b/ql/src/test/results/clientpositive/set_processor_namespaces.q.out
index a365e2c879..c8fd233836 100644
--- a/ql/src/test/results/clientpositive/set_processor_namespaces.q.out
+++ b/ql/src/test/results/clientpositive/set_processor_namespaces.q.out
@@ -47,13 +47,12 @@ STAGE PLANS:
 PREHOOK: query: SELECT * FROM src where key=5
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
-PREHOOK: Output: file:/tmp/sdong/hive_2011-02-10_17-07-36_889_4709058180675925800/-mr-10000
+PREHOOK: Output: file:/tmp/carl/hive_2011-11-04_15-25-57_635_7657597640646099982/-mr-10000
 POSTHOOK: query: SELECT * FROM src where key=5
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@src
-POSTHOOK: Output: file:/tmp/sdong/hive_2011-02-10_17-07-36_889_4709058180675925800/-mr-10000
+POSTHOOK: Output: file:/tmp/carl/hive_2011-11-04_15-25-57_635_7657597640646099982/-mr-10000
 5	val_5
 5	val_5
 5	val_5
 c=1
-../lib/derby.jar
diff --git a/serde/build.xml b/serde/build.xml
index 471c43df12..a4255d59af 100644
--- a/serde/build.xml
+++ b/serde/build.xml
@@ -17,11 +17,6 @@
    limitations under the License.
 -->
 
-
-<!--
-Before you can run these subtargets directly, you need
-to call at top-level: ant deploy-contrib compile-core-test
--->
 <project name="serde" default="jar">
     
   <property name="src.dir"  location="${basedir}/src"/> 
@@ -42,14 +37,15 @@ to call at top-level: ant deploy-contrib compile-core-test
     />
   </target>
 
-  <target name="compile" depends="init,dynamic-serde,ivy-retrieve">
+  <target name="compile" depends="init,ivy-retrieve,dynamic-serde">
     <echo message="Project: ${ant.project.name}"/>
     <javac
      encoding="${build.encoding}"
      srcdir="${src.dir}/java/:${src.dir}/gen/thrift/gen-javabean/:${src.dir}/gen/protobuf/gen-java/"
      destdir="${build.classes}"
      debug="${javac.debug}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
     </javac>
diff --git a/serde/ivy.xml b/serde/ivy.xml
index 290cb6c749..499b8419da 100644
--- a/serde/ivy.xml
+++ b/serde/ivy.xml
@@ -15,23 +15,38 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-serde" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency>
-        <dependency org="org.slf4j" name="slf4j-api" rev="${slf4j-api.version}"/>
-        <dependency org="org.slf4j" name="slf4j-log4j12" rev="${slf4j-log4j12.version}"/>
-        <dependency org="org.mockito" name="mockito-all" rev="${mockito-all.version}"/>
-        <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
-                    transitive="false"/>
-        <dependency org="org.apache.thrift" name="libfb303" rev="${libfb303.version}"
-                    transitive="false"/>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-serde" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency>
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-shims" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.slf4j" name="slf4j-api" rev="${slf4j-api.version}"/>
+    <dependency org="org.slf4j" name="slf4j-log4j12" rev="${slf4j-log4j12.version}"
+                transitive="false"/>
+    <dependency org="org.mockito" name="mockito-all" rev="${mockito-all.version}"/>
+    <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
+                transitive="false"/>
+    <dependency org="org.apache.thrift" name="libfb303" rev="${libfb303.version}"
+                transitive="false"/>
+    <dependency org="commons-lang" name="commons-lang" rev="${commons-lang.version}"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+    <dependency org="commons-codec" name="commons-codec" rev="${commons-codec.version}"
+                transitive="false"/>
+  </dependencies>
 </ivy-module>
diff --git a/service/build.xml b/service/build.xml
index 10e8cf12ea..9144b21ad7 100644
--- a/service/build.xml
+++ b/service/build.xml
@@ -49,7 +49,7 @@
     </exec>
   </target>
 
-  <target name="core-compile" depends="init">
+  <target name="compile" depends="init,ivy-retrieve">
     <echo message="Project: ${ant.project.name}"/>
     <javac
      encoding="${build.encoding}"
@@ -58,15 +58,11 @@
      destdir="${build.classes}"
      debug="${javac.debug}"
      deprecation="${javac.deprecation}"
-     >
+     includeantruntime="false">
       <classpath refid="classpath"/>
     </javac>
   </target>
  
-  <target name="compile" depends="core-compile">
-    <echo message="Project: ${ant.project.name}"/>
-  </target>
-
   <target name="clean">
     <echo message="Project: ${ant.project.name}"/>
     <delete dir="${build.classes}/../"/>
diff --git a/service/ivy.xml b/service/ivy.xml
index c37efdc130..dd30158a6d 100644
--- a/service/ivy.xml
+++ b/service/ivy.xml
@@ -16,17 +16,30 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-service" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-      <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
-                  transitive="false"/>
-      <dependency org="org.apache.thrift" name="libfb303" rev="${libfb303.version}"
-                  transitive="false"/>
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-service" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <dependency org="org.apache.hive" name="hive-common" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-metastore" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.hive" name="hive-exec" rev="${version}"
+                conf="runtime" transitive="false"/>
+    <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
+                transitive="false"/>
+    <dependency org="org.apache.thrift" name="libfb303" rev="${libfb303.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+  </dependencies>
 </ivy-module>
diff --git a/shims/build.xml b/shims/build.xml
index 3930ca2054..2a02b685fd 100644
--- a/shims/build.xml
+++ b/shims/build.xml
@@ -51,7 +51,8 @@ to call at top-level: ant deploy-contrib compile-core-test
      excludes="**/Proxy*.java"
      destdir="${build.classes}"
      debug="${javac.debug}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
       <src path="${basedir}/src/${hadoop.version.ant-internal.prefix}/java" />
@@ -59,7 +60,7 @@ to call at top-level: ant deploy-contrib compile-core-test
     </javac>
   </target>
 
-  <target name="compile" depends="init">
+  <target name="compile" depends="init,ivy-retrieve">
     <echo message="Project: ${ant.project.name}"/>
     <antcall target="build_shims" inheritRefs="false" inheritAll="false">
       <param name="hadoop.version.ant-internal" value="${hadoop.version}" />
@@ -74,7 +75,8 @@ to call at top-level: ant deploy-contrib compile-core-test
      includes="**/Proxy*.java"
      destdir="${build.classes}"
      debug="${javac.debug}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
       <src path="${basedir}/src/${hadoop.version.ant-internal.prefix}/java" />
@@ -96,7 +98,8 @@ to call at top-level: ant deploy-contrib compile-core-test
      optimize="${javac.optimize}"
      target="${javac.version}"
      source="${javac.version}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
     </javac>
@@ -109,7 +112,8 @@ to call at top-level: ant deploy-contrib compile-core-test
      optimize="${javac.optimize}"
      target="${javac.version}"
      source="${javac.version}"
-     deprecation="${javac.deprecation}">
+     deprecation="${javac.deprecation}"
+     includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
     </javac>
diff --git a/shims/ivy.xml b/shims/ivy.xml
index c1785aae3e..4b789e60a1 100644
--- a/shims/ivy.xml
+++ b/shims/ivy.xml
@@ -16,22 +16,29 @@
    limitations under the License.
 -->
 <ivy-module version="2.0">
-    <info organisation="${hive.ivy.org}" module="hive-shims" revision="${version}">
-      <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
-      <description homepage="http://hive.apache.org">
-        The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
-        https://cwiki.apache.org/confluence/display/Hive/Home
-      </description>
-    </info>
-    <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency> 
-        <dependency org="hadoop" name="core" rev="${hadoop.security.version}">
-          <artifact name="hadoop" type="source" ext="tar.gz"/>
-        </dependency>
-        <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
-                    transitive="false"/>
-        <conflict manager="all" />
-    </dependencies>
+  <info organisation="${hive.ivy.org}" module="hive-shims" revision="${version}">
+    <license name="The Apache Software License, Version 2.0" url="http://www.apache.org/licenses/LICENSE-2.0.txt" />
+    <description homepage="http://hive.apache.org">
+      The Apache Hive (TM) data warehouse software facilitates querying and managing large datasets residing in distributed storage.
+      https://cwiki.apache.org/confluence/display/Hive/Home
+    </description>
+  </info>
+  <configurations>
+    <include file="${ivy.conf.dir}/common-configurations.xml"/>
+  </configurations>
+  <dependencies>
+    <dependency org="hadoop" name="core" rev="${hadoop.version}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency> 
+    <dependency org="hadoop" name="core" rev="${hadoop.security.version}">
+      <artifact name="hadoop" type="source" ext="tar.gz"/>
+    </dependency>
+    <dependency org="org.apache.thrift" name="libthrift" rev="${libthrift.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging" rev="${commons-logging.version}"
+                transitive="false"/>
+    <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
+                transitive="false"/>
+    <conflict manager="all" />
+  </dependencies>
 </ivy-module>
