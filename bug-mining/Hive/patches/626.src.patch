diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java
index dfadb9fc92..fd4daee254 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java
@@ -384,8 +384,15 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
         if (colInfo == null) {
           // It's not a column or a table alias.
           if (input.getIsExprResolver()) {
-            stack.pop();
-            ctx.setError(ErrorMsg.NON_KEY_EXPR_IN_GROUPBY.getMsg((ASTNode) stack.peek()), expr);
+            ASTNode exprNode = expr;
+            if (!stack.empty()) {
+              ASTNode tmp = (ASTNode) stack.pop();
+              if (!stack.empty()) {
+                exprNode = (ASTNode) stack.peek();
+              }
+              stack.push(tmp);
+            }
+            ctx.setError(ErrorMsg.NON_KEY_EXPR_IN_GROUPBY.getMsg(exprNode), expr);
             return null;
           } else {
             ctx.setError(ErrorMsg.INVALID_TABLE_OR_COLUMN.getMsg(expr
diff --git a/ql/src/test/queries/clientnegative/nonkey_groupby.q b/ql/src/test/queries/clientnegative/nonkey_groupby.q
new file mode 100644
index 0000000000..431e04efd9
--- /dev/null
+++ b/ql/src/test/queries/clientnegative/nonkey_groupby.q
@@ -0,0 +1 @@
+EXPLAIN SELECT key, count(1) FROM src;
diff --git a/ql/src/test/results/clientnegative/nonkey_groupby.q.out b/ql/src/test/results/clientnegative/nonkey_groupby.q.out
new file mode 100644
index 0000000000..062250fe62
--- /dev/null
+++ b/ql/src/test/results/clientnegative/nonkey_groupby.q.out
@@ -0,0 +1 @@
+FAILED: Error in semantic analysis: Line 1:15 Expression not in GROUP BY key 'key'
