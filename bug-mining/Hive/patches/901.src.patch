diff --git a/build-common.xml b/build-common.xml
index 0b279f3a90..5ffd960c75 100644
--- a/build-common.xml
+++ b/build-common.xml
@@ -59,7 +59,7 @@
   <property name="test.junit.output.format" value="xml"/>
   <property name="test.junit.output.usefile" value="true"/>
   <property name="minimr.query.files" value="input16_cc.q,scriptfile1.q,bucket4.q,bucketmapjoin6.q,disable_merge_for_bucketing.q,reduce_deduplicate.q,smb_mapjoin_8.q,join1.q,groupby2.q,bucketizedhiveinputformat.q"/>
-  <property name="minimr.query.negative.files" value="minimr_broken_pipe.q,mapreduce_stack_trace.q,mapreduce_stack_trace_turnoff.q" />
+  <property name="minimr.query.negative.files" value="minimr_broken_pipe.q,mapreduce_stack_trace.q,mapreduce_stack_trace_turnoff.q,mapreduce_stack_trace_hadoop20.q,mapreduce_stack_trace_turnoff_hadoop20.q" />
   <property name="test.silent" value="true"/>
   <property name="hadoopVersion" value="${hadoop.version.ant-internal}"/>
   <property name="test.serialize.qplan" value="false"/>
diff --git a/ql/src/test/queries/clientnegative/mapreduce_stack_trace.q b/ql/src/test/queries/clientnegative/mapreduce_stack_trace.q
index 37b86aab9e..0c5dcaeb36 100644
--- a/ql/src/test/queries/clientnegative/mapreduce_stack_trace.q
+++ b/ql/src/test/queries/clientnegative/mapreduce_stack_trace.q
@@ -3,3 +3,11 @@ set hive.exec.job.debug.capture.stacktraces=true;
 set hive.exec.failure.hooks=org.apache.hadoop.hive.ql.hooks.VerifySessionStateStackTracesHook;
 
 FROM src SELECT TRANSFORM(key, value) USING 'script_does_not_exist' AS (key, value);
+
+-- EXCLUDE_HADOOP_MAJOR_VERSIONS(0.20)
+-- Hadoop 0.23 changes the getTaskDiagnostics behavior
+-- The Error Code of hive failure MapReduce job changes
+-- In Hadoop 0.20
+-- Hive failure MapReduce job gets 20000 as Error Code
+-- In Hadoop 0.23
+-- Hive failure MapReduce job gets 2 as Error Code
diff --git a/ql/src/test/queries/clientnegative/mapreduce_stack_trace_hadoop20.q b/ql/src/test/queries/clientnegative/mapreduce_stack_trace_hadoop20.q
new file mode 100644
index 0000000000..8f38b0a2bb
--- /dev/null
+++ b/ql/src/test/queries/clientnegative/mapreduce_stack_trace_hadoop20.q
@@ -0,0 +1,13 @@
+set hive.exec.mode.local.auto=false;
+set hive.exec.job.debug.capture.stacktraces=true;
+set hive.exec.failure.hooks=org.apache.hadoop.hive.ql.hooks.VerifySessionStateStackTracesHook;
+
+FROM src SELECT TRANSFORM(key, value) USING 'script_does_not_exist' AS (key, value);
+
+-- INCLUDE_HADOOP_MAJOR_VERSIONS(0.20)
+-- Hadoop 0.23 changes the getTaskDiagnostics behavior
+-- The Error Code of hive failure MapReduce job changes
+-- In Hadoop 0.20
+-- Hive failure MapReduce job gets 20000 as Error Code
+-- In Hadoop 0.23
+-- Hive failure MapReduce job gets 2 as Error Code
diff --git a/ql/src/test/queries/clientnegative/mapreduce_stack_trace_turnoff.q b/ql/src/test/queries/clientnegative/mapreduce_stack_trace_turnoff.q
index e86ca6590d..047fb83f34 100644
--- a/ql/src/test/queries/clientnegative/mapreduce_stack_trace_turnoff.q
+++ b/ql/src/test/queries/clientnegative/mapreduce_stack_trace_turnoff.q
@@ -3,3 +3,11 @@ set hive.exec.job.debug.capture.stacktraces=false;
 set hive.exec.failure.hooks=org.apache.hadoop.hive.ql.hooks.VerifySessionStateStackTracesHook;
 
 FROM src SELECT TRANSFORM(key, value) USING 'script_does_not_exist' AS (key, value);
+
+-- EXCLUDE_HADOOP_MAJOR_VERSIONS(0.20)
+-- Hadoop 0.23 changes the getTaskDiagnostics behavior
+-- The Error Code of hive failure MapReduce job changes
+-- In Hadoop 0.20
+-- Hive failure MapReduce job gets 20000 as Error Code
+-- In Hadoop 0.23
+-- Hive failure MapReduce job gets 2 as Error Code
diff --git a/ql/src/test/queries/clientnegative/mapreduce_stack_trace_turnoff_hadoop20.q b/ql/src/test/queries/clientnegative/mapreduce_stack_trace_turnoff_hadoop20.q
new file mode 100644
index 0000000000..a6c888d702
--- /dev/null
+++ b/ql/src/test/queries/clientnegative/mapreduce_stack_trace_turnoff_hadoop20.q
@@ -0,0 +1,13 @@
+set hive.exec.mode.local.auto=false;
+set hive.exec.job.debug.capture.stacktraces=false;
+set hive.exec.failure.hooks=org.apache.hadoop.hive.ql.hooks.VerifySessionStateStackTracesHook;
+
+FROM src SELECT TRANSFORM(key, value) USING 'script_does_not_exist' AS (key, value);
+
+-- INCLUDE_HADOOP_MAJOR_VERSIONS(0.20)
+-- Hadoop 0.23 changes the getTaskDiagnostics behavior
+-- The Error Code of hive failure MapReduce job changes
+-- In Hadoop 0.20
+-- Hive failure MapReduce job gets 20000 as Error Code
+-- In Hadoop 0.23
+-- Hive failure MapReduce job gets 2 as Error Code
diff --git a/ql/src/test/results/clientnegative/mapreduce_stack_trace.q.out b/ql/src/test/results/clientnegative/mapreduce_stack_trace.q.out
index 592ecda2a7..b199241fe6 100644
--- a/ql/src/test/results/clientnegative/mapreduce_stack_trace.q.out
+++ b/ql/src/test/results/clientnegative/mapreduce_stack_trace.q.out
@@ -10,4 +10,4 @@ FATAL ExecMapper: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime
 Hive Runtime Error while processing row {"key":"238","value":"val_238"}
 FATAL ExecMapper: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row {"key":"238","value":"val_238"}
 Hive Runtime Error while processing row {"key":"238","value":"val_238"}
-FAILED: Execution Error, return code 20000 from org.apache.hadoop.hive.ql.exec.MapRedTask. Unable to initialize custom script.
+FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.MapRedTask
diff --git a/ql/src/test/results/clientnegative/mapreduce_stack_trace_hadoop20.q.out b/ql/src/test/results/clientnegative/mapreduce_stack_trace_hadoop20.q.out
new file mode 100644
index 0000000000..592ecda2a7
--- /dev/null
+++ b/ql/src/test/results/clientnegative/mapreduce_stack_trace_hadoop20.q.out
@@ -0,0 +1,13 @@
+PREHOOK: query: FROM src SELECT TRANSFORM(key, value) USING 'script_does_not_exist' AS (key, value)
+PREHOOK: type: QUERY
+PREHOOK: Input: default@src
+#### A masked pattern was here ####
+FATAL ExecMapper: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row {"key":"238","value":"val_238"}
+Hive Runtime Error while processing row {"key":"238","value":"val_238"}
+FATAL ExecMapper: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row {"key":"238","value":"val_238"}
+Hive Runtime Error while processing row {"key":"238","value":"val_238"}
+FATAL ExecMapper: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row {"key":"238","value":"val_238"}
+Hive Runtime Error while processing row {"key":"238","value":"val_238"}
+FATAL ExecMapper: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row {"key":"238","value":"val_238"}
+Hive Runtime Error while processing row {"key":"238","value":"val_238"}
+FAILED: Execution Error, return code 20000 from org.apache.hadoop.hive.ql.exec.MapRedTask. Unable to initialize custom script.
diff --git a/ql/src/test/results/clientnegative/mapreduce_stack_trace_turnoff.q.out b/ql/src/test/results/clientnegative/mapreduce_stack_trace_turnoff.q.out
index e1cd0c5f9c..da9203daa1 100644
--- a/ql/src/test/results/clientnegative/mapreduce_stack_trace_turnoff.q.out
+++ b/ql/src/test/results/clientnegative/mapreduce_stack_trace_turnoff.q.out
@@ -2,4 +2,4 @@ PREHOOK: query: FROM src SELECT TRANSFORM(key, value) USING 'script_does_not_exi
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
 #### A masked pattern was here ####
-FAILED: Execution Error, return code 20000 from org.apache.hadoop.hive.ql.exec.MapRedTask. Unable to initialize custom script.
+FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.MapRedTask
diff --git a/ql/src/test/results/clientnegative/mapreduce_stack_trace_turnoff_hadoop20.q.out b/ql/src/test/results/clientnegative/mapreduce_stack_trace_turnoff_hadoop20.q.out
new file mode 100644
index 0000000000..e1cd0c5f9c
--- /dev/null
+++ b/ql/src/test/results/clientnegative/mapreduce_stack_trace_turnoff_hadoop20.q.out
@@ -0,0 +1,5 @@
+PREHOOK: query: FROM src SELECT TRANSFORM(key, value) USING 'script_does_not_exist' AS (key, value)
+PREHOOK: type: QUERY
+PREHOOK: Input: default@src
+#### A masked pattern was here ####
+FAILED: Execution Error, return code 20000 from org.apache.hadoop.hive.ql.exec.MapRedTask. Unable to initialize custom script.
