diff --git a/llap-common/src/java/org/apache/hadoop/hive/llap/security/LlapTokenIdentifier.java b/llap-common/src/java/org/apache/hadoop/hive/llap/security/LlapTokenIdentifier.java
index e28edddddb..7c47f0b025 100644
--- a/llap-common/src/java/org/apache/hadoop/hive/llap/security/LlapTokenIdentifier.java
+++ b/llap-common/src/java/org/apache/hadoop/hive/llap/security/LlapTokenIdentifier.java
@@ -28,6 +28,8 @@
 import org.apache.hadoop.security.token.Token;
 import org.apache.hadoop.security.token.delegation.AbstractDelegationTokenIdentifier;
 
+import com.google.common.base.Preconditions;
+
 /** For now, a LLAP token gives access to any LLAP server. */
 public class LlapTokenIdentifier extends AbstractDelegationTokenIdentifier {
   private static final String KIND = "LLAP_TOKEN";
@@ -42,6 +44,7 @@ public LlapTokenIdentifier() {
   public LlapTokenIdentifier(Text owner, Text renewer, Text realUser,
       String clusterId, String appId) {
     super(owner, renewer, realUser);
+    Preconditions.checkNotNull(clusterId);
     this.clusterId = clusterId;
     this.appId = appId == null ? "" : appId;
   }
@@ -57,7 +60,9 @@ public void write(DataOutput out) throws IOException {
   public void readFields(DataInput in) throws IOException {
     super.readFields(in);
     clusterId = in.readUTF();
+    Preconditions.checkNotNull(clusterId);
     appId = in.readUTF();
+    appId = appId == null ? "" : appId;
   }
 
   @Override
@@ -76,7 +81,7 @@ public String getClusterId() {
   @Override
   public int hashCode() {
     final int prime = 31;
-    int result = prime * super.hashCode() + ((appId == null) ? 0 : appId.hashCode());
+    int result = prime * super.hashCode() + (StringUtils.isBlank(appId) ? 0 : appId.hashCode());
     return prime * result + ((clusterId == null) ? 0 : clusterId.hashCode());
   }
 
@@ -85,14 +90,14 @@ public boolean equals(Object obj) {
     if (this == obj) return true;
     if (!(obj instanceof LlapTokenIdentifier) || !super.equals(obj)) return false;
     LlapTokenIdentifier other = (LlapTokenIdentifier) obj;
-    return (appId == null ? other.appId == null : appId.equals(other.appId))
+    return (StringUtils.isBlank(appId)
+        ? StringUtils.isBlank(other.appId) : appId.equals(other.appId))
         && (clusterId == null ? other.clusterId == null : clusterId.equals(other.clusterId));
   }
 
   @Override
   public String toString() {
-    return KIND + "; " + super.toString() + ", cluster " + clusterId + ", app secret hash "
-        + (StringUtils.isBlank(appId) ? 0 : appId.hashCode());
+    return KIND + "; " + super.toString() + ", cluster " + clusterId + ", app ID " + appId;
   }
 
   @InterfaceAudience.Private
diff --git a/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapDaemon.java b/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapDaemon.java
index de817e3a81..5ab7b3c97b 100644
--- a/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapDaemon.java
+++ b/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapDaemon.java
@@ -143,7 +143,7 @@ public LlapDaemon(Configuration daemonConf, int numExecutors, long executorMemor
     }
     String hostName = MetricsUtils.getHostName();
     try {
-      daemonId = new DaemonId(UserGroupInformation.getCurrentUser().getUserName(),
+      daemonId = new DaemonId(UserGroupInformation.getCurrentUser().getShortUserName(),
           LlapUtil.generateClusterName(daemonConf), hostName, appName, System.currentTimeMillis());
     } catch (IOException ex) {
       throw new RuntimeException(ex);
diff --git a/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapTokenChecker.java b/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapTokenChecker.java
index 03ee0550b3..04df9293b7 100644
--- a/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapTokenChecker.java
+++ b/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapTokenChecker.java
@@ -14,6 +14,7 @@
 package org.apache.hadoop.hive.llap.daemon.impl;
 
 import com.google.common.annotations.VisibleForTesting;
+import com.google.common.base.Preconditions;
 
 import java.util.ArrayList;
 
@@ -95,6 +96,7 @@ static Pair<String, String> getTokenInfoInternal(
   public static void checkPermissions(
       String clusterId, String userName, String appId, Object hint) throws IOException {
     if (!UserGroupInformation.isSecurityEnabled()) return;
+    Preconditions.checkNotNull(userName);
     UserGroupInformation current = UserGroupInformation.getCurrentUser();
     String kerberosName = current.hasKerberosCredentials() ? current.getShortUserName() : null;
     List<LlapTokenIdentifier> tokens = getLlapTokens(current, clusterId);
@@ -104,7 +106,7 @@ public static void checkPermissions(
   @VisibleForTesting
   static void checkPermissionsInternal(String kerberosName, List<LlapTokenIdentifier> tokens,
       String userName, String appId, Object hint) {
-    if (kerberosName != null && StringUtils.isEmpty(appId) && kerberosName.equals(userName)) {
+    if (kerberosName != null && StringUtils.isBlank(appId) && kerberosName.equals(userName)) {
       return;
     }
     if (tokens != null) {
@@ -132,6 +134,6 @@ public static void checkPermissions(
   private static boolean checkTokenPermissions(
       String userName, String appId, String tokenUser, String tokenAppId) {
     return userName.equals(tokenUser)
-        && (StringUtils.isEmpty(appId) || appId.equals(tokenAppId));
+        && (StringUtils.isBlank(appId) || appId.equals(tokenAppId));
   }
-}
\ No newline at end of file
+}
diff --git a/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/QueryTracker.java b/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/QueryTracker.java
index 8abd1989ec..c55436b636 100644
--- a/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/QueryTracker.java
+++ b/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/QueryTracker.java
@@ -14,6 +14,7 @@
 
 package org.apache.hadoop.hive.llap.daemon.impl;
 
+import com.google.common.base.Preconditions;
 import com.google.common.util.concurrent.ThreadFactoryBuilder;
 import java.util.concurrent.Executors;
 import java.util.concurrent.ScheduledExecutorService;
@@ -21,6 +22,7 @@
 
 import org.apache.commons.lang3.tuple.Pair;
 import org.apache.hadoop.fs.Path;
+import org.apache.hadoop.security.UserGroupInformation;
 import org.apache.hadoop.security.token.Token;
 import org.apache.tez.common.CallableWithNdc;
 
@@ -134,9 +136,12 @@ QueryFragmentInfo registerFragment(QueryIdentifier queryIdentifier, String appId
       boolean isExistingQueryInfo = true;
       QueryInfo queryInfo = queryInfoMap.get(queryIdentifier);
       if (queryInfo == null) {
+        String tokenUser = tokenInfo.getLeft(), tokenAppId = tokenInfo.getRight();
+        if (UserGroupInformation.isSecurityEnabled()) {
+          Preconditions.checkNotNull(tokenUser);
+        }
         queryInfo = new QueryInfo(queryIdentifier, appIdString, dagName, dagIdentifier, user,
-            getSourceCompletionMap(queryIdentifier), localDirsBase, localFs,
-            tokenInfo.getLeft(), tokenInfo.getRight());
+           getSourceCompletionMap(queryIdentifier), localDirsBase, localFs, tokenUser, tokenAppId);
         QueryInfo old = queryInfoMap.putIfAbsent(queryIdentifier, queryInfo);
         if (old != null) {
           queryInfo = old;
@@ -341,8 +346,8 @@ protected Void callInternal() {
   private QueryInfo checkPermissionsAndGetQuery(QueryIdentifier queryId) throws IOException {
     QueryInfo queryInfo = queryInfoMap.get(queryId);
     if (queryInfo == null) return null;
-    LlapTokenChecker.checkPermissions(clusterId, queryInfo.getTokenAppId(),
-        queryInfo.getTokenUserName(), queryInfo.getQueryIdentifier());
+    LlapTokenChecker.checkPermissions(clusterId, queryInfo.getTokenUserName(),
+        queryInfo.getTokenAppId(), queryInfo.getQueryIdentifier());
     return queryInfo;
   }
 
diff --git a/llap-server/src/test/org/apache/hadoop/hive/llap/daemon/impl/TaskExecutorTestHelpers.java b/llap-server/src/test/org/apache/hadoop/hive/llap/daemon/impl/TaskExecutorTestHelpers.java
index 279baf1dda..e0f0676992 100644
--- a/llap-server/src/test/org/apache/hadoop/hive/llap/daemon/impl/TaskExecutorTestHelpers.java
+++ b/llap-server/src/test/org/apache/hadoop/hive/llap/daemon/impl/TaskExecutorTestHelpers.java
@@ -79,7 +79,7 @@ public static QueryInfo createQueryInfo() {
     QueryInfo queryInfo =
         new QueryInfo(queryIdentifier, "fake_app_id_string", "fake_dag_name", 1, "fakeUser",
             new ConcurrentHashMap<String, LlapDaemonProtocolProtos.SourceStateProto>(),
-            new String[0], null, null, null);
+            new String[0], null, "fakeUser", null);
     return queryInfo;
   }
 
