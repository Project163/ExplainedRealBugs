diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java
index f74569f8e8..097d33b0b6 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java
@@ -680,19 +680,16 @@ public void removeParent(Operator<? extends Serializable> parent) {
     assert parentIndex != -1;
     if (parentOperators.size() == 1) {
       parentOperators = null;
-    }
-    else {
+    } else {
       parentOperators.remove(parentIndex);
     }
 
     int childIndex = parent.getChildOperators().indexOf(this);
-    if (childIndex >= 0) {
-      if (parent.getChildOperators().size() == 1) {
-        parent.setChildOperators(null);
-      }
-      else {
-        parent.getChildOperators().remove(childIndex);
-      }
+    assert childIndex != -1;
+    if (parent.getChildOperators().size() == 1) {
+      parent.setChildOperators(null);
+    } else {
+      parent.getChildOperators().remove(childIndex);
     }
   }
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
index 449e2ffac3..c2e884d472 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
@@ -102,13 +102,11 @@ public static class GenMRUnionCtx {
     Task<? extends Serializable> uTask;
     List<String> taskTmpDir;
     List<TableDesc> tt_desc;
-    List<Operator<? extends Serializable>> listTopOperators;
 
     public GenMRUnionCtx() {
       uTask = null;
       taskTmpDir = new ArrayList<String>();
       tt_desc = new ArrayList<TableDesc>();
-      listTopOperators = new ArrayList<Operator<? extends Serializable>>();
     }
 
     public Task<? extends Serializable> getUTask() {
@@ -134,19 +132,6 @@ public void addTTDesc(TableDesc tt_desc) {
     public List<TableDesc> getTTDesc() {
       return tt_desc;
     }
-
-    public List<Operator<? extends Serializable>> getListTopOperators() {
-      return listTopOperators;
-    }
-
-    public void setListTopOperators(
-        List<Operator<? extends Serializable>> listTopOperators) {
-      this.listTopOperators = listTopOperators;
-    }
-    
-    public void addListTopOperators(Operator<? extends Serializable> topOperator) {
-      listTopOperators.add(topOperator);
-    }
   }
 
   /**
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java
index 8bf42c90e7..b6d4526762 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java
@@ -50,7 +50,6 @@
 import org.apache.hadoop.hive.ql.plan.PartitionDesc;
 import org.apache.hadoop.hive.ql.plan.PlanUtils;
 import org.apache.hadoop.hive.ql.plan.TableDesc;
-import org.apache.hadoop.hive.ql.plan.TableScanDesc;
 
 /**
  * Processor for the rule - TableScan followed by Union.
@@ -60,146 +59,14 @@ public class GenMRUnion1 implements NodeProcessor {
   public GenMRUnion1() {
   }
 
-  /**
-   * Process the union if all sub-queries are map-only
-   * 
-   * @return
-   * @throws SemanticException
-   */
-  private Object processMapOnlyUnion(UnionOperator union, Stack<Node> stack,
-      GenMRProcContext ctx, UnionProcContext uCtx) throws SemanticException {
-    // merge currTask from multiple topOps
-    HashMap<Operator<? extends Serializable>, Task<? extends Serializable>> opTaskMap = ctx.getOpTaskMap();
-    if (opTaskMap != null && opTaskMap.size() > 0) {
-      Task<? extends Serializable> tsk = opTaskMap.get(null);
-      if (tsk != null) {
-        ctx.setCurrTask(tsk);
-      }
-    }
-
-    UnionParseContext uPrsCtx = uCtx.getUnionParseContext(union);
-    if ((uPrsCtx != null) && (uPrsCtx.getMapJoinQuery())) {
-      GenMapRedUtils.mergeMapJoinUnion(union, ctx,
-          UnionProcFactory.getPositionParent(union, stack));
-    }
-    else {
-      ctx.getMapCurrCtx().put(
-          (Operator<? extends Serializable>) union,
-          new GenMapRedCtx(ctx.getCurrTask(), ctx.getCurrTopOp(),
-              ctx.getCurrAliasId()));
-    }
-    return null;
-  }
-
-  /**
-   * Process the union when the parent is a map-reduce job. Create a temporary
-   * output, and let the union task read from the temporary output.
-   * 
-   * The files created for all the inputs are in the union context and later
-   * used to initialize the union plan
-   * 
-   * @param parent
-   * @param child
-   * @param uTask
-   * @param ctx
-   * @param uCtxTask
-   */
-  private void processSubQueryUnionCreateIntermediate(
-      Operator<? extends Serializable> parent,
-      Operator<? extends Serializable> child,
-      Task<? extends Serializable> uTask, GenMRProcContext ctx,
-      GenMRUnionCtx uCtxTask) {
-    ParseContext parseCtx = ctx.getParseCtx();
-
-    TableDesc tt_desc = PlanUtils.getIntermediateFileTableDesc(PlanUtils.getFieldSchemasFromRowSchema(
-        parent.getSchema(), "temporarycol"));
-
-    // generate the temporary file
-    Context baseCtx = parseCtx.getContext();
-    String taskTmpDir = baseCtx.getMRTmpFileURI();
-
-    // Create a file sink operator for this file name
-    Operator<? extends Serializable> fs_op = OperatorFactory.get(
-        new FileSinkDesc(taskTmpDir, tt_desc, parseCtx.getConf().getBoolVar(
-            HiveConf.ConfVars.COMPRESSINTERMEDIATE)), parent.getSchema());
-
-    assert parent.getChildOperators().size() == 1;
-    parent.getChildOperators().set(0, fs_op);
-
-    List<Operator<? extends Serializable>> parentOpList = new ArrayList<Operator<? extends Serializable>>();
-    parentOpList.add(parent);
-    fs_op.setParentOperators(parentOpList);
-
-    // Create a dummy table scan operator
-    Operator<? extends Serializable> ts_op = OperatorFactory.get(
-        new TableScanDesc(), parent.getSchema());
-    List<Operator<? extends Serializable>> childOpList = new ArrayList<Operator<? extends Serializable>>();
-    childOpList.add(child);
-    ts_op.setChildOperators(childOpList);
-    child.replaceParent(parent, ts_op);
-
-    // Add the path to alias mapping
-
-    uCtxTask.addTaskTmpDir(taskTmpDir);
-    uCtxTask.addTTDesc(tt_desc);
-    uCtxTask.addListTopOperators(ts_op);
-
-    // The union task is empty. The files created for all the inputs are
-    // assembled in the union context and later used to initialize the union
-    // plan
-
-    ctx.getCurrTask().addDependentTask(uTask);
-  }
-
-  /**
-   * Union Operator encountered. A map-only query is encountered at the given
-   * position. However, atleast of the sub-qeuries is a map-reduce job. Copy the
-   * information from the current top operator to the union context.
-   * 
-   * @param ctx
-   * @param uCtxTask
-   * @param union
-   * @param stack
-   * @throws SemanticException
-   */
-  private void processSubQueryUnionMerge(GenMRProcContext ctx,
-      GenMRUnionCtx uCtxTask, UnionOperator union, Stack<Node> stack)
-      throws SemanticException {
-    // The current plan can be thrown away after being merged with the union
-    // plan
-    Task<? extends Serializable> uTask = uCtxTask.getUTask();
-    MapredWork plan = (MapredWork) uTask.getWork();
-    Operator<? extends Serializable> currTopOp = ctx.getCurrTopOp();
-    String currAliasId = ctx.getCurrAliasId();
-    GenMapRedUtils.setTaskPlan(ctx.getCurrAliasId(), ctx.getCurrTopOp(), plan,
-        false, ctx);
-  }
-
-  private void processSubQueryUnionMapJoin(GenMRProcContext ctx) {
-    AbstractMapJoinOperator<? extends MapJoinDesc> mjOp = ctx.getCurrMapJoinOp();
-    assert mjOp != null;
-    GenMRMapJoinCtx mjCtx = ctx.getMapJoinCtx(mjOp);
-    assert mjCtx != null;
-    MapredWork plan = (MapredWork) ctx.getCurrTask().getWork();
-
-    String taskTmpDir = mjCtx.getTaskTmpDir();
-    TableDesc tt_desc = mjCtx.getTTDesc();
-    assert plan.getPathToAliases().get(taskTmpDir) == null;
-    plan.getPathToAliases().put(taskTmpDir, new ArrayList<String>());
-    plan.getPathToAliases().get(taskTmpDir).add(taskTmpDir);
-    plan.getPathToPartitionInfo().put(taskTmpDir,
-        new PartitionDesc(tt_desc, null));
-    plan.getAliasToWork().put(taskTmpDir, mjCtx.getRootMapJoinOp());
-  }
-
   /**
    * Union Operator encountered . Currently, the algorithm is pretty simple: If
-   * all the sub-queries are map-only, don't do anything. However, if there is a
+   * all the sub-queries are map-only, dont do anything. However, if there is a
    * mapjoin followed by the union, merge at the union Otherwise, insert a
    * FileSink on top of all the sub-queries.
-   * 
+   *
    * This can be optimized later on.
-   * 
+   *
    * @param nd
    *          the file sink operator encountered
    * @param opProcCtx
@@ -214,12 +81,31 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx,
 
     // Map-only subqueries can be optimized in future to not write to a file in
     // future
-    Map<Operator<? extends Serializable>, GenMapRedCtx> mapCurrCtx = ctx.getMapCurrCtx();
+    Map<Operator<? extends Serializable>, GenMapRedCtx> mapCurrCtx = ctx
+        .getMapCurrCtx();
 
     // The plan needs to be broken only if one of the sub-queries involve a
     // map-reduce job
     if (uCtx.isMapOnlySubq()) {
-      return processMapOnlyUnion(union, stack, ctx, uCtx);
+      // merge currTask from multiple topOps
+      HashMap<Operator<? extends Serializable>, Task<? extends Serializable>> opTaskMap = ctx
+          .getOpTaskMap();
+      if (opTaskMap != null && opTaskMap.size() > 0) {
+        Task<? extends Serializable> tsk = opTaskMap.get(null);
+        if (tsk != null) {
+          ctx.setCurrTask(tsk);
+        }
+      }
+
+      UnionParseContext uPrsCtx = uCtx.getUnionParseContext(union);
+      if ((uPrsCtx != null) && (uPrsCtx.getMapJoinQuery())) {
+        GenMapRedUtils.mergeMapJoinUnion(union, ctx, UnionProcFactory
+            .getPositionParent(union, stack));
+      } else {
+        mapCurrCtx.put((Operator<? extends Serializable>) nd, new GenMapRedCtx(
+            ctx.getCurrTask(), ctx.getCurrTopOp(), ctx.getCurrAliasId()));
+      }
+      return null;
     }
 
     ctx.setCurrUnionOp(union);
@@ -230,8 +116,16 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx,
     Task<? extends Serializable> currTask = ctx.getCurrTask();
     int pos = UnionProcFactory.getPositionParent(union, stack);
 
+    // is the current task a root task
+    if (uPrsCtx.getRootTask(pos) && (!ctx.getRootTasks().contains(currTask))) {
+      ctx.getRootTasks().add(currTask);
+    }
+
     GenMRUnionCtx uCtxTask = ctx.getUnionTask(union);
     Task<? extends Serializable> uTask = null;
+
+    Operator<? extends Serializable> parent = union.getParentOperators().get(
+        pos);
     MapredWork uPlan = null;
 
     // union is encountered for the first time
@@ -241,36 +135,70 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx,
       uTask = TaskFactory.get(uPlan, parseCtx.getConf());
       uCtxTask.setUTask(uTask);
       ctx.setUnionTask(union, uCtxTask);
-    }
-    else {
+    } else {
       uTask = uCtxTask.getUTask();
     }
 
-    // Copy into the current union task plan if  
-    if (uPrsCtx.getMapOnlySubq(pos) && uPrsCtx.getRootTask(pos)
-        && !uPrsCtx.getMapJoinSubq(pos)) {
-      processSubQueryUnionMerge(ctx, uCtxTask, union, stack);
+    // If there is a mapjoin at position 'pos'
+    if (uPrsCtx.getMapJoinSubq(pos)) {
+      AbstractMapJoinOperator<? extends MapJoinDesc> mjOp = ctx.getCurrMapJoinOp();
+      assert mjOp != null;
+      GenMRMapJoinCtx mjCtx = ctx.getMapJoinCtx(mjOp);
+      assert mjCtx != null;
+      MapredWork plan = (MapredWork) currTask.getWork();
+
+      String taskTmpDir = mjCtx.getTaskTmpDir();
+      TableDesc tt_desc = mjCtx.getTTDesc();
+      assert plan.getPathToAliases().get(taskTmpDir) == null;
+      plan.getPathToAliases().put(taskTmpDir, new ArrayList<String>());
+      plan.getPathToAliases().get(taskTmpDir).add(taskTmpDir);
+      plan.getPathToPartitionInfo().put(taskTmpDir,
+          new PartitionDesc(tt_desc, null));
+      plan.getAliasToWork().put(taskTmpDir, mjCtx.getRootMapJoinOp());
     }
-    // If it a map-reduce job, create a temporary file
-    else {
-      // is the current task a root task
-      if (uPrsCtx.getRootTask(pos) && (!ctx.getRootTasks().contains(currTask))) {
-        ctx.getRootTasks().add(currTask);
-      }
-      // If there is a mapjoin at position 'pos'
-      if (uPrsCtx.getMapJoinSubq(pos)) {
-        processSubQueryUnionMapJoin(ctx);
-      }
 
-      processSubQueryUnionCreateIntermediate(union.getParentOperators().get(pos), union, uTask, ctx, uCtxTask);
+    TableDesc tt_desc = PlanUtils.getIntermediateFileTableDesc(PlanUtils
+        .getFieldSchemasFromRowSchema(parent.getSchema(), "temporarycol"));
+
+    // generate the temporary file
+    Context baseCtx = parseCtx.getContext();
+    String taskTmpDir = baseCtx.getMRTmpFileURI();
+
+    // Add the path to alias mapping
+    uCtxTask.addTaskTmpDir(taskTmpDir);
+    uCtxTask.addTTDesc(tt_desc);
+
+    // The union task is empty. The files created for all the inputs are
+    // assembled in the
+    // union context and later used to initialize the union plan
+
+    // Create a file sink operator for this file name
+    Operator<? extends Serializable> fs_op = OperatorFactory.get(
+        new FileSinkDesc(taskTmpDir, tt_desc, parseCtx.getConf().getBoolVar(
+        HiveConf.ConfVars.COMPRESSINTERMEDIATE)), parent.getSchema());
+
+    assert parent.getChildOperators().size() == 1;
+    parent.getChildOperators().set(0, fs_op);
+
+    List<Operator<? extends Serializable>> parentOpList =
+      new ArrayList<Operator<? extends Serializable>>();
+    parentOpList.add(parent);
+    fs_op.setParentOperators(parentOpList);
+
+    currTask.addDependentTask(uTask);
+
+    // If it is map-only task, add the files to be processed
+    if (uPrsCtx.getMapOnlySubq(pos) && uPrsCtx.getRootTask(pos)) {
+      GenMapRedUtils.setTaskPlan(ctx.getCurrAliasId(), ctx.getCurrTopOp(),
+          (MapredWork) currTask.getWork(), false, ctx);
     }
 
     ctx.setCurrTask(uTask);
     ctx.setCurrAliasId(null);
     ctx.setCurrTopOp(null);
 
-    mapCurrCtx.put((Operator<? extends Serializable>) nd,
-        new GenMapRedCtx(ctx.getCurrTask(), null, null));
+    mapCurrCtx.put((Operator<? extends Serializable>) nd, new GenMapRedCtx(ctx
+        .getCurrTask(), null, null));
 
     return null;
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
index faee343cb3..ae33079c45 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
@@ -326,18 +326,12 @@ public static void initUnionPlan(GenMRProcContext opProcCtx,
     assert uCtx != null;
 
     List<String> taskTmpDirLst = uCtx.getTaskTmpDir();
-    if ((taskTmpDirLst == null) || (taskTmpDirLst.isEmpty())) {
-      return;
-    }
-    
     List<TableDesc> tt_descLst = uCtx.getTTDesc();
     assert !taskTmpDirLst.isEmpty() && !tt_descLst.isEmpty();
     assert taskTmpDirLst.size() == tt_descLst.size();
     int size = taskTmpDirLst.size();
     assert local == false;
 
-    List<Operator<? extends Serializable>> topOperators = uCtx.getListTopOperators();
-    
     for (int pos = 0; pos < size; pos++) {
       String taskTmpDir = taskTmpDirLst.get(pos);
       TableDesc tt_desc = tt_descLst.get(pos);
@@ -346,7 +340,7 @@ public static void initUnionPlan(GenMRProcContext opProcCtx,
         plan.getPathToAliases().get(taskTmpDir).add(taskTmpDir);
         plan.getPathToPartitionInfo().put(taskTmpDir,
             new PartitionDesc(tt_desc, null));
-        plan.getAliasToWork().put(taskTmpDir, topOperators.get(pos));
+        plan.getAliasToWork().put(taskTmpDir, currUnionOp);
       }
     }
   }
diff --git a/ql/src/test/queries/clientpositive/union25.q b/ql/src/test/queries/clientpositive/union25.q
new file mode 100644
index 0000000000..04e782e2a5
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/union25.q
@@ -0,0 +1,23 @@
+create table tmp_srcpart like srcpart;
+
+insert overwrite table tmp_srcpart partition (ds='2008-04-08', hr='11')
+select key, value from srcpart where ds='2008-04-08' and hr='11';
+
+explain
+create table tmp_unionall as
+SELECT count(1) as counts, key, value
+FROM
+(
+  SELECT key, value FROM srcpart a WHERE a.ds='2008-04-08' and a.hr='11'
+
+    UNION ALL
+
+  SELECT key, key as value FROM (
+    SELECT distinct key FROM (
+      SELECT key, value FROM tmp_srcpart a WHERE a.ds='2008-04-08' and a.hr='11'
+        UNION ALL
+      SELECT key, value FROM tmp_srcpart b WHERE b.ds='2008-04-08' and b.hr='11'
+    )t
+  ) master_table
+) a GROUP BY key, value
+;
diff --git a/ql/src/test/results/clientpositive/auto_join27.q.out b/ql/src/test/results/clientpositive/auto_join27.q.out
index 5b877a7044..ce52dbd30f 100644
--- a/ql/src/test/results/clientpositive/auto_join27.q.out
+++ b/ql/src/test/results/clientpositive/auto_join27.q.out
@@ -27,13 +27,14 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-8 depends on stages: Stage-1 , consists of Stage-9, Stage-10, Stage-2
+  Stage-8 depends on stages: Stage-1, Stage-4 , consists of Stage-9, Stage-10, Stage-2
   Stage-9 has a backup stage: Stage-2
   Stage-6 depends on stages: Stage-9
   Stage-3 depends on stages: Stage-2, Stage-6, Stage-7
   Stage-10 has a backup stage: Stage-2
   Stage-7 depends on stages: Stage-10
   Stage-2
+  Stage-4 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -131,75 +132,65 @@ STAGE PLANS:
   Stage: Stage-6
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-36-43_167_4198125662621366018/-mr-10002 
-          TableScan
-            Union
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                condition expressions:
-                  0 
-                  1 
-                handleSkewJoin: false
-                keys:
-                  0 [Column[_col0]]
-                  1 [Column[_col0]]
-                Position of Big Table: 0
-                Select Operator
-                  Group By Operator
-                    aggregations:
-                          expr: count(1)
-                    bucketGroup: false
-                    mode: hash
-                    outputColumnNames: _col0
-                    File Output Operator
-                      compressed: false
-                      GlobalTableId: 0
-                      table:
-                          input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-                          output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-        null-subquery1:src_12-subquery1:src 
-          TableScan
-            alias: src
-            Select Operator
-              expressions:
-                    expr: key
-                    type: string
-                    expr: value
-                    type: string
-              outputColumnNames: _col0, _col1
-              Union
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  condition expressions:
-                    0 
-                    1 
-                  handleSkewJoin: false
-                  keys:
-                    0 [Column[_col0]]
-                    1 [Column[_col0]]
-                  Position of Big Table: 0
-                  Select Operator
-                    Group By Operator
-                      aggregations:
-                            expr: count(1)
-                      bucketGroup: false
-                      mode: hash
-                      outputColumnNames: _col0
-                      File Output Operator
-                        compressed: false
-                        GlobalTableId: 0
-                        table:
-                            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-                            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10002 
+          Union
+            Map Join Operator
+              condition map:
+                   Inner Join 0 to 1
+              condition expressions:
+                0 
+                1 
+              handleSkewJoin: false
+              keys:
+                0 [Column[_col0]]
+                1 [Column[_col0]]
+              Position of Big Table: 0
+              Select Operator
+                Group By Operator
+                  aggregations:
+                        expr: count(1)
+                  bucketGroup: false
+                  mode: hash
+                  outputColumnNames: _col0
+                  File Output Operator
+                    compressed: false
+                    GlobalTableId: 0
+                    table:
+                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10004 
+          Union
+            Map Join Operator
+              condition map:
+                   Inner Join 0 to 1
+              condition expressions:
+                0 
+                1 
+              handleSkewJoin: false
+              keys:
+                0 [Column[_col0]]
+                1 [Column[_col0]]
+              Position of Big Table: 0
+              Select Operator
+                Group By Operator
+                  aggregations:
+                        expr: count(1)
+                  bucketGroup: false
+                  mode: hash
+                  outputColumnNames: _col0
+                  File Output Operator
+                    compressed: false
+                    GlobalTableId: 0
+                    table:
+                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
       Local Work:
         Map Reduce Local Work
 
   Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-36-43_167_4198125662621366018/-mr-10003 
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10003 
             Reduce Output Operator
               sort order: 
               tag: -1
@@ -228,45 +219,35 @@ STAGE PLANS:
   Stage: Stage-10
     Map Reduce Local Work
       Alias -> Map Local Tables:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-36-43_167_4198125662621366018/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10002 
           Fetch Operator
             limit: -1
-        null-subquery1:src_12-subquery1:src 
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10004 
           Fetch Operator
             limit: -1
       Alias -> Map Local Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-36-43_167_4198125662621366018/-mr-10002 
-          TableScan
-            Union
-              HashTable Sink Operator
-                condition expressions:
-                  0 
-                  1 
-                handleSkewJoin: false
-                keys:
-                  0 [Column[_col0]]
-                  1 [Column[_col0]]
-                Position of Big Table: 1
-        null-subquery1:src_12-subquery1:src 
-          TableScan
-            alias: src
-            Select Operator
-              expressions:
-                    expr: key
-                    type: string
-                    expr: value
-                    type: string
-              outputColumnNames: _col0, _col1
-              Union
-                HashTable Sink Operator
-                  condition expressions:
-                    0 
-                    1 
-                  handleSkewJoin: false
-                  keys:
-                    0 [Column[_col0]]
-                    1 [Column[_col0]]
-                  Position of Big Table: 1
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10002 
+          Union
+            HashTable Sink Operator
+              condition expressions:
+                0 
+                1 
+              handleSkewJoin: false
+              keys:
+                0 [Column[_col0]]
+                1 [Column[_col0]]
+              Position of Big Table: 1
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10004 
+          Union
+            HashTable Sink Operator
+              condition expressions:
+                0 
+                1 
+              handleSkewJoin: false
+              keys:
+                0 [Column[_col0]]
+                1 [Column[_col0]]
+              Position of Big Table: 1
 
   Stage: Stage-7
     Map Reduce
@@ -313,38 +294,28 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-36-43_167_4198125662621366018/-mr-10002 
-          TableScan
-            Union
-              Reduce Output Operator
-                key expressions:
-                      expr: _col0
-                      type: string
-                sort order: +
-                Map-reduce partition columns:
-                      expr: _col0
-                      type: string
-                tag: 0
-        null-subquery1:src_12-subquery1:src 
-          TableScan
-            alias: src
-            Select Operator
-              expressions:
-                    expr: key
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10002 
+          Union
+            Reduce Output Operator
+              key expressions:
+                    expr: _col0
                     type: string
-                    expr: value
+              sort order: +
+              Map-reduce partition columns:
+                    expr: _col0
                     type: string
-              outputColumnNames: _col0, _col1
-              Union
-                Reduce Output Operator
-                  key expressions:
-                        expr: _col0
-                        type: string
-                  sort order: +
-                  Map-reduce partition columns:
-                        expr: _col0
-                        type: string
-                  tag: 0
+              tag: 0
+        file:/tmp/njain/hive_2011-12-07_17-55-14_715_2499487755302424085/-mr-10004 
+          Union
+            Reduce Output Operator
+              key expressions:
+                    expr: _col0
+                    type: string
+              sort order: +
+              Map-reduce partition columns:
+                    expr: _col0
+                    type: string
+              tag: 0
         src3:src 
           TableScan
             alias: src
@@ -388,6 +359,26 @@ STAGE PLANS:
                     input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                     output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
 
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:src_12-subquery1:src 
+          TableScan
+            alias: src
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
   Stage: Stage-0
     Fetch Operator
       limit: -1
@@ -405,7 +396,7 @@ JOIN
 ON src_12.key = src3.k AND src3.k < 200
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-36-44_708_3827922999145042039/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-55-16_087_2232818405314135078/-mr-10000
 POSTHOOK: query: SELECT count(1)
 FROM
 (
@@ -418,5 +409,5 @@ JOIN
 ON src_12.key = src3.k AND src3.k < 200
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@src
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-36-44_708_3827922999145042039/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-55-16_087_2232818405314135078/-mr-10000
 548
diff --git a/ql/src/test/results/clientpositive/input25.q.out b/ql/src/test/results/clientpositive/input25.q.out
index 2b7526afa2..0df8a72937 100644
--- a/ql/src/test/results/clientpositive/input25.q.out
+++ b/ql/src/test/results/clientpositive/input25.q.out
@@ -80,42 +80,40 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-23-45_579_6808174009465727795/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: int
-                      expr: _col1
-                      type: int
-                      expr: _col2
-                      type: string
-                outputColumnNames: _col0, _col1, _col2
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-23-45_579_6808174009465727795/-mr-10003 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: int
-                      expr: _col1
-                      type: int
-                      expr: _col2
-                      type: string
-                outputColumnNames: _col0, _col1, _col2
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_17-57-51_725_5932902027949948969/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: int
+                    expr: _col1
+                    type: int
+                    expr: _col2
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_17-57-51_725_5932902027949948969/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: int
+                    expr: _col1
+                    type: int
+                    expr: _col2
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
 
   Stage: Stage-3
     Map Reduce
@@ -166,7 +164,7 @@ PREHOOK: query: select * from (
 PREHOOK: type: QUERY
 PREHOOK: Input: default@tst@d=2009-01-01
 PREHOOK: Input: default@tst@d=2009-02-02
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-23-45_772_1308096997862615956/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-57-51_941_2422734399279293092/-mr-10000
 POSTHOOK: query: select * from (
   select * from tst x where x.d='2009-01-01' limit 10
     union all
@@ -175,4 +173,4 @@ POSTHOOK: query: select * from (
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@tst@d=2009-01-01
 POSTHOOK: Input: default@tst@d=2009-02-02
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-23-45_772_1308096997862615956/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-57-51_941_2422734399279293092/-mr-10000
diff --git a/ql/src/test/results/clientpositive/input26.q.out b/ql/src/test/results/clientpositive/input26.q.out
index db222cf85b..38f2de46aa 100644
--- a/ql/src/test/results/clientpositive/input26.q.out
+++ b/ql/src/test/results/clientpositive/input26.q.out
@@ -67,46 +67,44 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-24-02_277_2484701533078645970/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                      expr: _col2
-                      type: string
-                      expr: _col3
-                      type: string
-                outputColumnNames: _col0, _col1, _col2, _col3
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-24-02_277_2484701533078645970/-mr-10003 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                      expr: _col2
-                      type: string
-                      expr: _col3
-                      type: string
-                outputColumnNames: _col0, _col1, _col2, _col3
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_17-58-02_024_2246324478859482077/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col2
+                    type: string
+                    expr: _col3
+                    type: string
+              outputColumnNames: _col0, _col1, _col2, _col3
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_17-58-02_024_2246324478859482077/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col2
+                    type: string
+                    expr: _col3
+                    type: string
+              outputColumnNames: _col0, _col1, _col2, _col3
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
 
   Stage: Stage-3
     Map Reduce
@@ -164,7 +162,7 @@ PREHOOK: query: select * from (
 )subq
 PREHOOK: type: QUERY
 PREHOOK: Input: default@srcpart@ds=2008-04-08/hr=11
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-24-02_446_3327945036790717255/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-58-02_317_4884615947790921319/-mr-10000
 POSTHOOK: query: select * from (
   select * from srcpart a where a.ds = '2008-04-08' and a.hr = '11' order by a.key limit 5
     union all
@@ -172,7 +170,7 @@ POSTHOOK: query: select * from (
 )subq
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@srcpart@ds=2008-04-08/hr=11
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-24-02_446_3327945036790717255/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-58-02_317_4884615947790921319/-mr-10000
 0	val_0	2008-04-08	11
 0	val_0	2008-04-08	11
 0	val_0	2008-04-08	11
diff --git a/ql/src/test/results/clientpositive/join35.q.out b/ql/src/test/results/clientpositive/join35.q.out
index 7d0373f164..99c81be28b 100644
--- a/ql/src/test/results/clientpositive/join35.q.out
+++ b/ql/src/test/results/clientpositive/join35.q.out
@@ -78,9 +78,9 @@ STAGE PLANS:
                           type: bigint
       Needs Tagging: false
       Path -> Alias:
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/src [null-subquery1:subq1-subquery1:x]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src [null-subquery1:subq1-subquery1:x]
       Path -> Partition:
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/src 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src 
           Partition
             base file name: src
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -91,12 +91,12 @@ STAGE PLANS:
               columns.types string:string
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/src
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src
               name default.src
               serialization.ddl struct src { string key, string value}
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-              transient_lastDdlTime 1321061801
+              transient_lastDdlTime 1323309312
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -107,12 +107,12 @@ STAGE PLANS:
                 columns.types string:string
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/src
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src
                 name default.src
                 serialization.ddl struct src { string key, string value}
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                transient_lastDdlTime 1321061801
+                transient_lastDdlTime 1323309312
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src
             name: default.src
@@ -136,7 +136,7 @@ STAGE PLANS:
             File Output Operator
               compressed: false
               GlobalTableId: 0
-              directory: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10002
+              directory: file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10002
               NumFilesPerFileSink: 1
               table:
                   input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -173,152 +173,148 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10002 
-          TableScan
-            GatherStats: false
-            Union
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                condition expressions:
-                  0 {_col1}
-                  1 {key} {value}
-                handleSkewJoin: false
-                keys:
-                  0 [Column[_col0]]
-                  1 [Column[key]]
+        file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10002 
+          Union
+            Map Join Operator
+              condition map:
+                   Inner Join 0 to 1
+              condition expressions:
+                0 {_col1}
+                1 {key} {value}
+              handleSkewJoin: false
+              keys:
+                0 [Column[_col0]]
+                1 [Column[key]]
+              outputColumnNames: _col1, _col2, _col3
+              Position of Big Table: 0
+              Select Operator
+                expressions:
+                      expr: _col1
+                      type: bigint
+                      expr: _col2
+                      type: string
+                      expr: _col3
+                      type: string
                 outputColumnNames: _col1, _col2, _col3
-                Position of Big Table: 0
                 Select Operator
                   expressions:
-                        expr: _col1
-                        type: bigint
                         expr: _col2
                         type: string
                         expr: _col3
                         type: string
-                  outputColumnNames: _col1, _col2, _col3
+                        expr: _col1
+                        type: bigint
+                  outputColumnNames: _col0, _col1, _col2
                   Select Operator
                     expressions:
-                          expr: _col2
-                          type: string
-                          expr: _col3
+                          expr: _col0
                           type: string
                           expr: _col1
-                          type: bigint
+                          type: string
+                          expr: UDFToInteger(_col2)
+                          type: int
                     outputColumnNames: _col0, _col1, _col2
-                    Select Operator
-                      expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: string
-                            expr: UDFToInteger(_col2)
-                            type: int
-                      outputColumnNames: _col0, _col1, _col2
-                      File Output Operator
-                        compressed: false
-                        GlobalTableId: 1
-                        directory: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10003
-                        NumFilesPerFileSink: 1
-                        Stats Publishing Key Prefix: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10000/
-                        table:
-                            input format: org.apache.hadoop.mapred.TextInputFormat
-                            output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                            properties:
-                              bucket_count -1
-                              columns key,value,val2
-                              columns.types string:string:int
-                              file.inputformat org.apache.hadoop.mapred.TextInputFormat
-                              file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                              location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/dest_j1
-                              name default.dest_j1
-                              serialization.ddl struct dest_j1 { string key, string value, i32 val2}
-                              serialization.format 1
-                              serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                              transient_lastDdlTime 1321062478
-                            serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                            name: default.dest_j1
-                        TotalFiles: 1
-                        GatherStats: true
-                        MultiFileSpray: false
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10004 
-          TableScan
-            GatherStats: false
-            Union
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                condition expressions:
-                  0 {_col1}
-                  1 {key} {value}
-                handleSkewJoin: false
-                keys:
-                  0 [Column[_col0]]
-                  1 [Column[key]]
+                    File Output Operator
+                      compressed: false
+                      GlobalTableId: 1
+                      directory: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10003
+                      NumFilesPerFileSink: 1
+                      Stats Publishing Key Prefix: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10000/
+                      table:
+                          input format: org.apache.hadoop.mapred.TextInputFormat
+                          output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                          properties:
+                            bucket_count -1
+                            columns key,value,val2
+                            columns.types string:string:int
+                            file.inputformat org.apache.hadoop.mapred.TextInputFormat
+                            file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                            location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/dest_j1
+                            name default.dest_j1
+                            serialization.ddl struct dest_j1 { string key, string value, i32 val2}
+                            serialization.format 1
+                            serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                            transient_lastDdlTime 1323309492
+                          serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                          name: default.dest_j1
+                      TotalFiles: 1
+                      GatherStats: true
+                      MultiFileSpray: false
+        file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10004 
+          Union
+            Map Join Operator
+              condition map:
+                   Inner Join 0 to 1
+              condition expressions:
+                0 {_col1}
+                1 {key} {value}
+              handleSkewJoin: false
+              keys:
+                0 [Column[_col0]]
+                1 [Column[key]]
+              outputColumnNames: _col1, _col2, _col3
+              Position of Big Table: 0
+              Select Operator
+                expressions:
+                      expr: _col1
+                      type: bigint
+                      expr: _col2
+                      type: string
+                      expr: _col3
+                      type: string
                 outputColumnNames: _col1, _col2, _col3
-                Position of Big Table: 0
                 Select Operator
                   expressions:
-                        expr: _col1
-                        type: bigint
                         expr: _col2
                         type: string
                         expr: _col3
                         type: string
-                  outputColumnNames: _col1, _col2, _col3
+                        expr: _col1
+                        type: bigint
+                  outputColumnNames: _col0, _col1, _col2
                   Select Operator
                     expressions:
-                          expr: _col2
-                          type: string
-                          expr: _col3
+                          expr: _col0
                           type: string
                           expr: _col1
-                          type: bigint
+                          type: string
+                          expr: UDFToInteger(_col2)
+                          type: int
                     outputColumnNames: _col0, _col1, _col2
-                    Select Operator
-                      expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: string
-                            expr: UDFToInteger(_col2)
-                            type: int
-                      outputColumnNames: _col0, _col1, _col2
-                      File Output Operator
-                        compressed: false
-                        GlobalTableId: 1
-                        directory: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10003
-                        NumFilesPerFileSink: 1
-                        Stats Publishing Key Prefix: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10000/
-                        table:
-                            input format: org.apache.hadoop.mapred.TextInputFormat
-                            output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                            properties:
-                              bucket_count -1
-                              columns key,value,val2
-                              columns.types string:string:int
-                              file.inputformat org.apache.hadoop.mapred.TextInputFormat
-                              file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                              location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/dest_j1
-                              name default.dest_j1
-                              serialization.ddl struct dest_j1 { string key, string value, i32 val2}
-                              serialization.format 1
-                              serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                              transient_lastDdlTime 1321062478
-                            serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                            name: default.dest_j1
-                        TotalFiles: 1
-                        GatherStats: true
-                        MultiFileSpray: false
+                    File Output Operator
+                      compressed: false
+                      GlobalTableId: 1
+                      directory: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10003
+                      NumFilesPerFileSink: 1
+                      Stats Publishing Key Prefix: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10000/
+                      table:
+                          input format: org.apache.hadoop.mapred.TextInputFormat
+                          output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                          properties:
+                            bucket_count -1
+                            columns key,value,val2
+                            columns.types string:string:int
+                            file.inputformat org.apache.hadoop.mapred.TextInputFormat
+                            file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                            location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/dest_j1
+                            name default.dest_j1
+                            serialization.ddl struct dest_j1 { string key, string value, i32 val2}
+                            serialization.format 1
+                            serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                            transient_lastDdlTime 1323309492
+                          serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                          name: default.dest_j1
+                      TotalFiles: 1
+                      GatherStats: true
+                      MultiFileSpray: false
       Local Work:
         Map Reduce Local Work
       Needs Tagging: false
       Path -> Alias:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10002 [file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10002]
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10004 [file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10004]
+        file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10002 [file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10002]
+        file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10004 [file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10004]
       Path -> Partition:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10002 
           Partition
             base file name: -mr-10002
             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -334,7 +330,7 @@ STAGE PLANS:
                 columns _col0,_col1
                 columns.types string,bigint
                 escape.delim \
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10004 
+        file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10004 
           Partition
             base file name: -mr-10004
             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -358,14 +354,14 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          source: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10003
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10000
+          source: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10003
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10000
 
   Stage: Stage-0
     Move Operator
       tables:
           replace: true
-          source: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10000
+          source: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10000
           table:
               input format: org.apache.hadoop.mapred.TextInputFormat
               output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
@@ -375,28 +371,28 @@ STAGE PLANS:
                 columns.types string:string:int
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/dest_j1
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/dest_j1
                 name default.dest_j1
                 serialization.ddl struct dest_j1 { string key, string value, i32 val2}
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                transient_lastDdlTime 1321062478
+                transient_lastDdlTime 1323309492
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.dest_j1
-          tmp directory: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10001
+          tmp directory: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10001
 
   Stage: Stage-3
     Stats-Aggr Operator
-      Stats Aggregation Key Prefix: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10000/
+      Stats Aggregation Key Prefix: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10000/
 
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10003 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10003 
             File Output Operator
               compressed: false
               GlobalTableId: 0
-              directory: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10000
+              directory: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10000
               NumFilesPerFileSink: 1
               table:
                   input format: org.apache.hadoop.mapred.TextInputFormat
@@ -407,12 +403,12 @@ STAGE PLANS:
                     columns.types string:string:int
                     file.inputformat org.apache.hadoop.mapred.TextInputFormat
                     file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                    location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/dest_j1
+                    location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/dest_j1
                     name default.dest_j1
                     serialization.ddl struct dest_j1 { string key, string value, i32 val2}
                     serialization.format 1
                     serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                    transient_lastDdlTime 1321062478
+                    transient_lastDdlTime 1323309492
                   serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                   name: default.dest_j1
               TotalFiles: 1
@@ -420,9 +416,9 @@ STAGE PLANS:
               MultiFileSpray: false
       Needs Tagging: false
       Path -> Alias:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10003 [pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10003]
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10003 [pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10003]
       Path -> Partition:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-47-58_134_7214786013092589853/-ext-10003 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-12_129_4473789020840822175/-ext-10003 
           Partition
             base file name: -ext-10003
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -433,12 +429,12 @@ STAGE PLANS:
               columns.types string:string:int
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/dest_j1
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/dest_j1
               name default.dest_j1
               serialization.ddl struct dest_j1 { string key, string value, i32 val2}
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-              transient_lastDdlTime 1321062478
+              transient_lastDdlTime 1323309492
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -449,12 +445,12 @@ STAGE PLANS:
                 columns.types string:string:int
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/dest_j1
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/dest_j1
                 name default.dest_j1
                 serialization.ddl struct dest_j1 { string key, string value, i32 val2}
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                transient_lastDdlTime 1321062478
+                transient_lastDdlTime 1323309492
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.dest_j1
             name: default.dest_j1
@@ -499,9 +495,9 @@ STAGE PLANS:
                           type: bigint
       Needs Tagging: false
       Path -> Alias:
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/src [null-subquery2:subq1-subquery2:x1]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src [null-subquery2:subq1-subquery2:x1]
       Path -> Partition:
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/src 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src 
           Partition
             base file name: src
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -512,12 +508,12 @@ STAGE PLANS:
               columns.types string:string
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/src
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src
               name default.src
               serialization.ddl struct src { string key, string value}
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-              transient_lastDdlTime 1321061801
+              transient_lastDdlTime 1323309312
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -528,12 +524,12 @@ STAGE PLANS:
                 columns.types string:string
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/src
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src
                 name default.src
                 serialization.ddl struct src { string key, string value}
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                transient_lastDdlTime 1321061801
+                transient_lastDdlTime 1323309312
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src
             name: default.src
@@ -557,7 +553,7 @@ STAGE PLANS:
             File Output Operator
               compressed: false
               GlobalTableId: 0
-              directory: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-47-58_134_7214786013092589853/-mr-10004
+              directory: file:/tmp/njain/hive_2011-12-07_17-58-12_129_4473789020840822175/-mr-10004
               NumFilesPerFileSink: 1
               table:
                   input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -601,11 +597,11 @@ POSTHOOK: Lineage: dest_j1.value SIMPLE [(src1)x.FieldSchema(name:value, type:st
 PREHOOK: query: select * from dest_j1 x order by x.key
 PREHOOK: type: QUERY
 PREHOOK: Input: default@dest_j1
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-48-31_514_2648201231429080670/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-58-25_435_1706583075891060460/-mr-10000
 POSTHOOK: query: select * from dest_j1 x order by x.key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@dest_j1
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-48-31_514_2648201231429080670/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-58-25_435_1706583075891060460/-mr-10000
 POSTHOOK: Lineage: dest_j1.key SIMPLE [(src1)x.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: dest_j1.val2 EXPRESSION [(src)x.null, (src)x1.null, ]
 POSTHOOK: Lineage: dest_j1.value SIMPLE [(src1)x.FieldSchema(name:value, type:string, comment:default), ]
diff --git a/ql/src/test/results/clientpositive/lineage1.q.out b/ql/src/test/results/clientpositive/lineage1.q.out
index 952f7a16a9..4e58ae85a3 100644
--- a/ql/src/test/results/clientpositive/lineage1.q.out
+++ b/ql/src/test/results/clientpositive/lineage1.q.out
@@ -102,56 +102,54 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-48-38_851_484927696341419107/-mr-10002 
-          TableScan
-            Union
+        file:/tmp/njain/hive_2011-12-07_17-58-28_928_7172632558607469868/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
-                      expr: _col0
-                      type: string
+                      expr: UDFToInteger(_col0)
+                      type: int
                       expr: _col1
                       type: string
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: UDFToInteger(_col0)
-                        type: int
-                        expr: _col1
-                        type: string
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.dest_l1
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_17-48-38_851_484927696341419107/-mr-10004 
-          TableScan
-            Union
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.dest_l1
+        file:/tmp/njain/hive_2011-12-07_17-58-28_928_7172632558607469868/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
-                      expr: _col0
-                      type: string
+                      expr: UDFToInteger(_col0)
+                      type: int
                       expr: _col1
                       type: string
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: UDFToInteger(_col0)
-                        type: int
-                        expr: _col1
-                        type: string
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.dest_l1
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.dest_l1
 
   Stage: Stage-6
     Conditional Operator
@@ -160,7 +158,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-48-38_851_484927696341419107/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-28_928_7172632558607469868/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -178,7 +176,7 @@ STAGE PLANS:
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_17-48-38_851_484927696341419107/-ext-10003 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-28_928_7172632558607469868/-ext-10003 
             File Output Operator
               compressed: false
               GlobalTableId: 0
diff --git a/ql/src/test/results/clientpositive/load_dyn_part14.q.out b/ql/src/test/results/clientpositive/load_dyn_part14.q.out
index 61d360fddf..80e70cd071 100644
--- a/ql/src/test/results/clientpositive/load_dyn_part14.q.out
+++ b/ql/src/test/results/clientpositive/load_dyn_part14.q.out
@@ -12,7 +12,7 @@ POSTHOOK: type: DESCTABLE
 key	string	
 value	string	
 	 	 
-Detailed Table Information	Table(tableName:nzhang_part14, dbName:default, owner:njain, createTime:1321035905, lastAccessTime:0, retention:0, sd:StorageDescriptor(cols:[FieldSchema(name:key, type:string, comment:null), FieldSchema(name:value, type:string, comment:null)], location:pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/nzhang_part14, inputFormat:org.apache.hadoop.mapred.TextInputFormat, outputFormat:org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat, compressed:false, numBuckets:-1, serdeInfo:SerDeInfo(name:null, serializationLib:org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, parameters:{serialization.format=1}), bucketCols:[], sortCols:[], parameters:{}), partitionKeys:[FieldSchema(name:value, type:string, comment:null)], parameters:{transient_lastDdlTime=1321035905}, viewOriginalText:null, viewExpandedText:null, tableType:MANAGED_TABLE)	
+Detailed Table Information	Table(tableName:nzhang_part14, dbName:default, owner:njain, createTime:1323309520, lastAccessTime:0, retention:0, sd:StorageDescriptor(cols:[FieldSchema(name:key, type:string, comment:null), FieldSchema(name:value, type:string, comment:null)], location:pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/nzhang_part14, inputFormat:org.apache.hadoop.mapred.TextInputFormat, outputFormat:org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat, compressed:false, numBuckets:-1, serdeInfo:SerDeInfo(name:null, serializationLib:org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, parameters:{serialization.format=1}), bucketCols:[], sortCols:[], parameters:{}), partitionKeys:[FieldSchema(name:value, type:string, comment:null)], parameters:{transient_lastDdlTime=1323309520}, viewOriginalText:null, viewExpandedText:null, tableType:MANAGED_TABLE)	
 PREHOOK: query: explain
 insert overwrite table nzhang_part14 partition(value) 
 select key, value from (
@@ -83,60 +83,57 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-25-05_842_9192092705231412985/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                outputColumnNames: _col0, _col1
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 1
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.nzhang_part14
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-25-05_842_9192092705231412985/-mr-10004 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                outputColumnNames: _col0, _col1
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 1
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.nzhang_part14
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-25-05_842_9192092705231412985/-mr-10005 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                outputColumnNames: _col0, _col1
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 1
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.nzhang_part14
+        file:/tmp/njain/hive_2011-12-07_17-58-40_914_3018145671418748325/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.nzhang_part14
+        file:/tmp/njain/hive_2011-12-07_17-58-40_914_3018145671418748325/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.nzhang_part14
+        file:/tmp/njain/hive_2011-12-07_17-58-40_914_3018145671418748325/-mr-10005 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.nzhang_part14
 
   Stage: Stage-6
     Conditional Operator
@@ -145,7 +142,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-25-05_842_9192092705231412985/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-40_914_3018145671418748325/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -165,7 +162,7 @@ STAGE PLANS:
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-25-05_842_9192092705231412985/-ext-10003 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-58-40_914_3018145671418748325/-ext-10003 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -278,13 +275,13 @@ order by key, value
 PREHOOK: type: QUERY
 PREHOOK: Input: default@nzhang_part14@value= 
 PREHOOK: Input: default@nzhang_part14@value=__HIVE_DEFAULT_PARTITION__
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-25-41_035_2320609910504169210/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-58-56_195_4783722404416817168/-mr-10000
 POSTHOOK: query: select * from nzhang_part14 where value <> 'a'
 order by key, value
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@nzhang_part14@value= 
 POSTHOOK: Input: default@nzhang_part14@value=__HIVE_DEFAULT_PARTITION__
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-25-41_035_2320609910504169210/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-58-56_195_4783722404416817168/-mr-10000
 POSTHOOK: Lineage: nzhang_part14 PARTITION(value= ).key EXPRESSION []
 POSTHOOK: Lineage: nzhang_part14 PARTITION(value=__HIVE_DEFAULT_PARTITION__).key EXPRESSION []
 k1	__HIVE_DEFAULT_PARTITION__
diff --git a/ql/src/test/results/clientpositive/merge4.q.out b/ql/src/test/results/clientpositive/merge4.q.out
index 2f0201c55d..d03120e782 100644
--- a/ql/src/test/results/clientpositive/merge4.q.out
+++ b/ql/src/test/results/clientpositive/merge4.q.out
@@ -52,7 +52,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-25-48_199_75823943869650709/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-59-00_378_4278082963343867697/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -73,7 +73,7 @@ STAGE PLANS:
   Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-25-48_199_75823943869650709/-ext-10002 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-59-00_378_4278082963343867697/-ext-10002 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -103,12 +103,12 @@ PREHOOK: query: select * from nzhang_part
 PREHOOK: type: QUERY
 PREHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=11
 PREHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=12
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-25-57_240_7775227106868293962/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-06_638_1841311597568472705/-mr-10000
 POSTHOOK: query: select * from nzhang_part
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=11
 POSTHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=12
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-25-57_240_7775227106868293962/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-06_638_1841311597568472705/-mr-10000
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=11).key SIMPLE [(srcpart)srcpart.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=11).value SIMPLE [(srcpart)srcpart.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=12).key SIMPLE [(srcpart)srcpart.FieldSchema(name:key, type:string, comment:default), ]
@@ -1164,7 +1164,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-25-57_633_4953118072095492995/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-59-07_043_361641447208211747/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -1185,7 +1185,7 @@ STAGE PLANS:
   Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-25-57_633_4953118072095492995/-ext-10002 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-59-07_043_361641447208211747/-ext-10002 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -1216,12 +1216,12 @@ PREHOOK: query: select * from nzhang_part
 PREHOOK: type: QUERY
 PREHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=11
 PREHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=12
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-26-11_260_5079660234104469969/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-14_916_5356646178470655639/-mr-10000
 POSTHOOK: query: select * from nzhang_part
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=11
 POSTHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=12
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-26-11_260_5079660234104469969/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-14_916_5356646178470655639/-mr-10000
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=11).key SIMPLE [(srcpart)srcpart.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=11).value SIMPLE [(srcpart)srcpart.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=11).key SIMPLE [(srcpart)srcpart.FieldSchema(name:key, type:string, comment:default), ]
@@ -2752,104 +2752,79 @@ ABSTRACT SYNTAX TREE:
   (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME srcpart))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value)) (TOK_SELEXPR (TOK_TABLE_OR_COL hr))) (TOK_WHERE (= (TOK_TABLE_OR_COL ds) '2008-04-08')))) (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR '1' key) (TOK_SELEXPR '1' value) (TOK_SELEXPR 'file,' hr)) (TOK_LIMIT 1)))) s)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB (TOK_TABNAME nzhang_part) (TOK_PARTSPEC (TOK_PARTVAL ds '2010-08-15') (TOK_PARTVAL hr)))) (TOK_SELECT (TOK_SELEXPR TOK_ALLCOLREF))))
 
 STAGE DEPENDENCIES:
-  Stage-7 is a root stage
-  Stage-2 depends on stages: Stage-7
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-7
   Stage-6 depends on stages: Stage-2 , consists of Stage-5, Stage-4
   Stage-5
   Stage-0 depends on stages: Stage-5, Stage-4
   Stage-3 depends on stages: Stage-0
   Stage-4
+  Stage-7 is a root stage
 
 STAGE PLANS:
-  Stage: Stage-7
+  Stage: Stage-1
     Map Reduce
       Alias -> Map Operator Tree:
-        null-subquery2:s-subquery2:src 
+        null-subquery1:s-subquery1:srcpart 
           TableScan
-            alias: src
+            alias: srcpart
             Select Operator
               expressions:
-                    expr: '1'
+                    expr: key
                     type: string
-                    expr: '1'
+                    expr: value
                     type: string
-                    expr: 'file,'
+                    expr: hr
                     type: string
               outputColumnNames: _col0, _col1, _col2
-              Limit
-                Reduce Output Operator
-                  sort order: 
-                  tag: -1
-                  value expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                        expr: _col2
-                        type: string
-      Reduce Operator Tree:
-        Extract
-          Limit
-            File Output Operator
-              compressed: false
-              GlobalTableId: 0
-              table:
-                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
 
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-26-11_672_292946710488046856/-mr-10003 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                      expr: _col2
-                      type: string
-                outputColumnNames: _col0, _col1, _col2
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 1
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.nzhang_part
-        null-subquery1:s-subquery1:srcpart 
-          TableScan
-            alias: srcpart
+        file:/tmp/njain/hive_2011-12-07_17-59-15_348_3709397881979493458/-mr-10002 
+          Union
             Select Operator
               expressions:
-                    expr: key
+                    expr: _col0
                     type: string
-                    expr: value
+                    expr: _col1
                     type: string
-                    expr: hr
+                    expr: _col2
                     type: string
               outputColumnNames: _col0, _col1, _col2
-              Union
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                        expr: _col2
-                        type: string
-                  outputColumnNames: _col0, _col1, _col2
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.nzhang_part
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.nzhang_part
+        file:/tmp/njain/hive_2011-12-07_17-59-15_348_3709397881979493458/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col2
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.nzhang_part
 
   Stage: Stage-6
     Conditional Operator
@@ -2858,7 +2833,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-26-11_672_292946710488046856/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-59-15_348_3709397881979493458/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -2879,7 +2854,7 @@ STAGE PLANS:
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-26-11_672_292946710488046856/-ext-10002 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_17-59-15_348_3709397881979493458/-ext-10003 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -2889,6 +2864,42 @@ STAGE PLANS:
                   serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                   name: default.nzhang_part
 
+  Stage: Stage-7
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:s-subquery2:src 
+          TableScan
+            alias: src
+            Select Operator
+              expressions:
+                    expr: '1'
+                    type: string
+                    expr: '1'
+                    type: string
+                    expr: 'file,'
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              Limit
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
+                        expr: _col0
+                        type: string
+                        expr: _col1
+                        type: string
+                        expr: _col2
+                        type: string
+      Reduce Operator Tree:
+        Extract
+          Limit
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
 
 PREHOOK: query: insert overwrite table nzhang_part partition (ds='2010-08-15', hr) 
 select * from (
@@ -2946,11 +2957,11 @@ ds=2010-08-15/hr=file,
 PREHOOK: query: select * from nzhang_part where hr = 'file,'
 PREHOOK: type: QUERY
 PREHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=file,
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-26-27_547_1178916331512957671/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-27_738_6424516172281287687/-mr-10000
 POSTHOOK: query: select * from nzhang_part where hr = 'file,'
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@nzhang_part@ds=2010-08-15/hr=file,
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-26-27_547_1178916331512957671/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-27_738_6424516172281287687/-mr-10000
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=11).key SIMPLE [(srcpart)srcpart.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=11).value SIMPLE [(srcpart)srcpart.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: nzhang_part PARTITION(ds=2010-08-15,hr=11).key EXPRESSION [(srcpart)srcpart.FieldSchema(name:key, type:string, comment:default), ]
diff --git a/ql/src/test/results/clientpositive/ppd_union_view.q.out b/ql/src/test/results/clientpositive/ppd_union_view.q.out
index d4ba4d16ce..66e284edd1 100644
--- a/ql/src/test/results/clientpositive/ppd_union_view.q.out
+++ b/ql/src/test/results/clientpositive/ppd_union_view.q.out
@@ -145,7 +145,7 @@ on t1_old.keymap = t1_mapping.keymap and
    t1_old.ds = t1_mapping.ds
 ) subq
 PREHOOK: type: CREATEVIEW
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_133_7179148436805529475/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-57_427_4933330454359178305/-mr-10000
 POSTHOOK: query: create view t1 partitioned on (ds) as
 select * from
 (
@@ -157,7 +157,7 @@ on t1_old.keymap = t1_mapping.keymap and
 ) subq
 POSTHOOK: type: CREATEVIEW
 POSTHOOK: Output: default@t1
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_133_7179148436805529475/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-57_427_4933330454359178305/-mr-10000
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).key SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).keymap SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-14).key SIMPLE []
@@ -193,7 +193,8 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1
+  Stage-2 depends on stages: Stage-1, Stage-4
+  Stage-4 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -244,10 +245,10 @@ STAGE PLANS:
                     type: string
       Needs Tagging: true
       Path -> Alias:
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_mapping/ds=2011-10-13 [t1-subquery2:subq-subquery2:t1_mapping]
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_old/ds=2011-10-13 [t1-subquery2:subq-subquery2:t1_old]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_mapping/ds=2011-10-13 [t1-subquery2:subq-subquery2:t1_mapping]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_old/ds=2011-10-13 [t1-subquery2:subq-subquery2:t1_old]
       Path -> Partition:
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_mapping/ds=2011-10-13 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_mapping/ds=2011-10-13 
           Partition
             base file name: ds=2011-10-13
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -260,7 +261,7 @@ STAGE PLANS:
               columns.types string:string
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_mapping/ds=2011-10-13
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_mapping/ds=2011-10-13
               name default.t1_mapping
               numFiles 1
               numPartitions 2
@@ -271,7 +272,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 13
-              transient_lastDdlTime 1321036455
+              transient_lastDdlTime 1323309592
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -282,7 +283,7 @@ STAGE PLANS:
                 columns.types string:string
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_mapping
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_mapping
                 name default.t1_mapping
                 numFiles 2
                 numPartitions 2
@@ -293,11 +294,11 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 26
-                transient_lastDdlTime 1321036463
+                transient_lastDdlTime 1323309597
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.t1_mapping
             name: default.t1_mapping
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_old/ds=2011-10-13 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_old/ds=2011-10-13 
           Partition
             base file name: ds=2011-10-13
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -310,7 +311,7 @@ STAGE PLANS:
               columns.types string:string
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_old/ds=2011-10-13
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_old/ds=2011-10-13
               name default.t1_old
               numFiles 1
               numPartitions 2
@@ -321,7 +322,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 15
-              transient_lastDdlTime 1321036439
+              transient_lastDdlTime 1323309583
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -332,7 +333,7 @@ STAGE PLANS:
                 columns.types string:string
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_old
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_old
                 name default.t1_old
                 numFiles 2
                 numPartitions 2
@@ -343,7 +344,7 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 30
-                transient_lastDdlTime 1321036447
+                transient_lastDdlTime 1323309588
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.t1_old
             name: default.t1_old
@@ -368,7 +369,7 @@ STAGE PLANS:
             File Output Operator
               compressed: false
               GlobalTableId: 0
-              directory: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-mr-10002
+              directory: file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10002
               NumFilesPerFileSink: 1
               table:
                   input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -384,10 +385,17 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-mr-10002 
-          TableScan
-            GatherStats: false
-            Union
+        file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col2
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
               Select Operator
                 expressions:
                       expr: _col0
@@ -397,91 +405,66 @@ STAGE PLANS:
                       expr: _col2
                       type: string
                 outputColumnNames: _col0, _col1, _col2
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                        expr: _col2
-                        type: string
-                  outputColumnNames: _col0, _col1, _col2
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 0
-                    directory: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-ext-10001
-                    NumFilesPerFileSink: 1
-                    Stats Publishing Key Prefix: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-ext-10001/
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        properties:
-                          columns _col0,_col1,_col2
-                          columns.types string:string:string
-                          escape.delim \
-                          serialization.format 1
-                    TotalFiles: 1
-                    GatherStats: false
-                    MultiFileSpray: false
-        t1-subquery1:subq-subquery1:t1_new 
-          TableScan
-            alias: t1_new
-            GatherStats: false
-            Filter Operator
-              isSamplingPred: false
-              predicate:
-                  expr: (ds = '2011-10-13')
-                  type: boolean
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-ext-10001
+                  NumFilesPerFileSink: 1
+                  Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-ext-10001/
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      properties:
+                        columns _col0,_col1,_col2
+                        columns.types string:string:string
+                        escape.delim \
+                        serialization.format 1
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
+        file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col2
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
               Select Operator
                 expressions:
-                      expr: key
+                      expr: _col0
                       type: string
-                      expr: value
+                      expr: _col1
                       type: string
-                      expr: ds
+                      expr: _col2
                       type: string
                 outputColumnNames: _col0, _col1, _col2
-                Union
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: string
-                          expr: _col2
-                          type: string
-                    outputColumnNames: _col0, _col1, _col2
-                    Select Operator
-                      expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: string
-                            expr: _col2
-                            type: string
-                      outputColumnNames: _col0, _col1, _col2
-                      File Output Operator
-                        compressed: false
-                        GlobalTableId: 0
-                        directory: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-ext-10001
-                        NumFilesPerFileSink: 1
-                        Stats Publishing Key Prefix: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-ext-10001/
-                        table:
-                            input format: org.apache.hadoop.mapred.TextInputFormat
-                            output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                            properties:
-                              columns _col0,_col1,_col2
-                              columns.types string:string:string
-                              escape.delim \
-                              serialization.format 1
-                        TotalFiles: 1
-                        GatherStats: false
-                        MultiFileSpray: false
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-ext-10001
+                  NumFilesPerFileSink: 1
+                  Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-ext-10001/
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      properties:
+                        columns _col0,_col1,_col2
+                        columns.types string:string:string
+                        escape.delim \
+                        serialization.format 1
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
       Needs Tagging: false
       Path -> Alias:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-mr-10002 [file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-mr-10002]
+        file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10002 [file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10002]
+        file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10003 [file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10003]
       Path -> Partition:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_203_8551954162415833557/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10002 
           Partition
             base file name: -mr-10002
             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -497,6 +480,60 @@ STAGE PLANS:
                 columns _col0,_col1,_col2
                 columns.types string,string,string
                 escape.delim \
+        file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10003 
+          Partition
+            base file name: -mr-10003
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1,_col2
+              columns.types string,string,string
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1,_col2
+                columns.types string,string,string
+                escape.delim \
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        t1-subquery1:subq-subquery1:t1_new 
+          TableScan
+            alias: t1_new
+            GatherStats: false
+            Filter Operator
+              isSamplingPred: false
+              predicate:
+                  expr: (ds = '2011-10-13')
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: key
+                      type: string
+                      expr: value
+                      type: string
+                      expr: ds
+                      type: string
+                outputColumnNames: _col0, _col1, _col2
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_17-59-57_508_5002711420896465312/-mr-10003
+                  NumFilesPerFileSink: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                      properties:
+                        columns _col0,_col1,_col2
+                        columns.types string,string,string
+                        escape.delim \
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
+      Needs Tagging: false
 
   Stage: Stage-0
     Fetch Operator
@@ -507,12 +544,12 @@ PREHOOK: query: select * from t1 where ds = '2011-10-13'
 PREHOOK: type: QUERY
 PREHOOK: Input: default@t1_mapping@ds=2011-10-13
 PREHOOK: Input: default@t1_old@ds=2011-10-13
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_379_7098575606866456722/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-57_704_7072628915724048041/-mr-10000
 POSTHOOK: query: select * from t1 where ds = '2011-10-13'
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@t1_mapping@ds=2011-10-13
 POSTHOOK: Input: default@t1_old@ds=2011-10-13
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-23_379_7098575606866456722/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_17-59-57_704_7072628915724048041/-mr-10000
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).key SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).keymap SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-14).key SIMPLE []
@@ -530,12 +567,12 @@ PREHOOK: query: select * from t1 where ds = '2011-10-14'
 PREHOOK: type: QUERY
 PREHOOK: Input: default@t1_mapping@ds=2011-10-14
 PREHOOK: Input: default@t1_old@ds=2011-10-14
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-35_931_1341120083174453247/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-11_672_9171054609535884201/-mr-10000
 POSTHOOK: query: select * from t1 where ds = '2011-10-14'
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@t1_mapping@ds=2011-10-14
 POSTHOOK: Input: default@t1_old@ds=2011-10-14
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-35_931_1341120083174453247/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-11_672_9171054609535884201/-mr-10000
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).key SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).keymap SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-14).key SIMPLE []
@@ -572,7 +609,8 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1
+  Stage-2 depends on stages: Stage-1, Stage-4
+  Stage-4 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -653,7 +691,7 @@ STAGE PLANS:
             File Output Operator
               compressed: false
               GlobalTableId: 0
-              directory: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-mr-10002
+              directory: file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10002
               NumFilesPerFileSink: 1
               table:
                   input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -669,10 +707,17 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-mr-10002 
-          TableScan
-            GatherStats: false
-            Union
+        file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col2
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
               Select Operator
                 expressions:
                       expr: _col0
@@ -682,87 +727,66 @@ STAGE PLANS:
                       expr: _col2
                       type: string
                 outputColumnNames: _col0, _col1, _col2
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                        expr: _col2
-                        type: string
-                  outputColumnNames: _col0, _col1, _col2
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 0
-                    directory: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-ext-10001
-                    NumFilesPerFileSink: 1
-                    Stats Publishing Key Prefix: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-ext-10001/
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        properties:
-                          columns _col0,_col1,_col2
-                          columns.types string:string:string
-                          escape.delim \
-                          serialization.format 1
-                    TotalFiles: 1
-                    GatherStats: false
-                    MultiFileSpray: false
-        t1-subquery1:subq-subquery1:t1_new 
-          TableScan
-            alias: t1_new
-            GatherStats: false
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-ext-10001
+                  NumFilesPerFileSink: 1
+                  Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-ext-10001/
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      properties:
+                        columns _col0,_col1,_col2
+                        columns.types string:string:string
+                        escape.delim \
+                        serialization.format 1
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
+        file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10003 
+          Union
             Select Operator
               expressions:
-                    expr: key
+                    expr: _col0
                     type: string
-                    expr: value
+                    expr: _col1
                     type: string
-                    expr: ds
+                    expr: _col2
                     type: string
               outputColumnNames: _col0, _col1, _col2
-              Union
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                        expr: _col2
-                        type: string
-                  outputColumnNames: _col0, _col1, _col2
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: string
-                          expr: _col2
-                          type: string
-                    outputColumnNames: _col0, _col1, _col2
-                    File Output Operator
-                      compressed: false
-                      GlobalTableId: 0
-                      directory: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-ext-10001
-                      NumFilesPerFileSink: 1
-                      Stats Publishing Key Prefix: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-ext-10001/
-                      table:
-                          input format: org.apache.hadoop.mapred.TextInputFormat
-                          output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                          properties:
-                            columns _col0,_col1,_col2
-                            columns.types string:string:string
-                            escape.delim \
-                            serialization.format 1
-                      TotalFiles: 1
-                      GatherStats: false
-                      MultiFileSpray: false
+              Select Operator
+                expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
+                      type: string
+                      expr: _col2
+                      type: string
+                outputColumnNames: _col0, _col1, _col2
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-ext-10001
+                  NumFilesPerFileSink: 1
+                  Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-ext-10001/
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      properties:
+                        columns _col0,_col1,_col2
+                        columns.types string:string:string
+                        escape.delim \
+                        serialization.format 1
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
       Needs Tagging: false
       Path -> Alias:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-mr-10002 [file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-mr-10002]
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_new/ds=2011-10-15 [t1-subquery1:subq-subquery1:t1_new]
+        file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10002 [file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10002]
+        file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10003 [file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10003]
       Path -> Partition:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-48_823_4755131068301333177/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10002 
           Partition
             base file name: -mr-10002
             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -778,7 +802,59 @@ STAGE PLANS:
                 columns _col0,_col1,_col2
                 columns.types string,string,string
                 escape.delim \
-        pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_new/ds=2011-10-15 
+        file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10003 
+          Partition
+            base file name: -mr-10003
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1,_col2
+              columns.types string,string,string
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1,_col2
+                columns.types string,string,string
+                escape.delim \
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        t1-subquery1:subq-subquery1:t1_new 
+          TableScan
+            alias: t1_new
+            GatherStats: false
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+                    expr: ds
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                directory: file:/tmp/njain/hive_2011-12-07_18-00-22_449_3722924256194688266/-mr-10003
+                NumFilesPerFileSink: 1
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                    properties:
+                      columns _col0,_col1,_col2
+                      columns.types string,string,string
+                      escape.delim \
+                TotalFiles: 1
+                GatherStats: false
+                MultiFileSpray: false
+      Needs Tagging: false
+      Path -> Alias:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_new/ds=2011-10-15 [t1-subquery1:subq-subquery1:t1_new]
+      Path -> Partition:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_new/ds=2011-10-15 
           Partition
             base file name: ds=2011-10-15
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -791,7 +867,7 @@ STAGE PLANS:
               columns.types string:string
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_new/ds=2011-10-15
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_new/ds=2011-10-15
               name default.t1_new
               numFiles 1
               numPartitions 2
@@ -802,7 +878,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 12
-              transient_lastDdlTime 1321036423
+              transient_lastDdlTime 1323309573
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -813,7 +889,7 @@ STAGE PLANS:
                 columns.types string:string
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/Users/njain/hive/hive2/build/ql/test/data/warehouse/t1_new
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/t1_new
                 name default.t1_new
                 numFiles 2
                 numPartitions 2
@@ -824,7 +900,7 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 24
-                transient_lastDdlTime 1321036431
+                transient_lastDdlTime 1323309578
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.t1_new
             name: default.t1_new
@@ -837,11 +913,11 @@ STAGE PLANS:
 PREHOOK: query: select * from t1 where ds = '2011-10-15'
 PREHOOK: type: QUERY
 PREHOOK: Input: default@t1_new@ds=2011-10-15
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-49_027_6131917522768153961/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-22_644_4521419412274619409/-mr-10000
 POSTHOOK: query: select * from t1 where ds = '2011-10-15'
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@t1_new@ds=2011-10-15
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-34-49_027_6131917522768153961/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-22_644_4521419412274619409/-mr-10000
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).key SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).keymap SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-14).key SIMPLE []
@@ -858,11 +934,11 @@ key1	value1	2011-10-15
 PREHOOK: query: select * from t1 where ds = '2011-10-16'
 PREHOOK: type: QUERY
 PREHOOK: Input: default@t1_new@ds=2011-10-16
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-35-00_981_6595119879373197541/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-32_771_9209360595176810349/-mr-10000
 POSTHOOK: query: select * from t1 where ds = '2011-10-16'
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@t1_new@ds=2011-10-16
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-35-00_981_6595119879373197541/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-32_771_9209360595176810349/-mr-10000
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).key SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-13).keymap SIMPLE []
 POSTHOOK: Lineage: t1_mapping PARTITION(ds=2011-10-14).key SIMPLE []
diff --git a/ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out b/ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out
index d815e6f85b..de59940d34 100644
--- a/ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out
+++ b/ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out
@@ -150,14 +150,14 @@ group by l_shipdate
 order by l_shipdate
 PREHOOK: type: QUERY
 PREHOOK: Input: default@lineitem
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-03-58_256_4359739093927465788/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-52_012_8071976135987072046/-mr-10000
 POSTHOOK: query: select l_shipdate, count(l_shipdate)
 from lineitem
 group by l_shipdate
 order by l_shipdate
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@lineitem
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-03-58_256_4359739093927465788/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-52_012_8071976135987072046/-mr-10000
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._bucketname SIMPLE [(lineitem)lineitem.FieldSchema(name:INPUT__FILE__NAME, type:string, comment:), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._count_of_l_shipdate EXPRESSION [(lineitem)lineitem.FieldSchema(name:l_shipdate, type:string, comment:null), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._offsets EXPRESSION [(lineitem)lineitem.FieldSchema(name:BLOCK__OFFSET__INSIDE__FILE, type:bigint, comment:), ]
@@ -346,14 +346,14 @@ group by l_shipdate
 order by l_shipdate
 PREHOOK: type: QUERY
 PREHOOK: Input: default@default__lineitem_lineitem_lshipdate_idx__
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-04-11_823_1547404645018211524/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-58_386_5252653541132989710/-mr-10000
 POSTHOOK: query: select l_shipdate, count(l_shipdate)
 from lineitem
 group by l_shipdate
 order by l_shipdate
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@default__lineitem_lineitem_lshipdate_idx__
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-04-11_823_1547404645018211524/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-00-58_386_5252653541132989710/-mr-10000
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._bucketname SIMPLE [(lineitem)lineitem.FieldSchema(name:INPUT__FILE__NAME, type:string, comment:), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._count_of_l_shipdate EXPRESSION [(lineitem)lineitem.FieldSchema(name:l_shipdate, type:string, comment:null), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._offsets EXPRESSION [(lineitem)lineitem.FieldSchema(name:BLOCK__OFFSET__INSIDE__FILE, type:bigint, comment:), ]
@@ -549,7 +549,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-04-25_528_4656091135628161209/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_18-01-05_039_3668243048784602339/-mr-10002 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -587,7 +587,7 @@ group by year(l_shipdate), month(l_shipdate)
 order by year, month
 PREHOOK: type: QUERY
 PREHOOK: Input: default@lineitem
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-04-25_613_8938618162298839937/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-01-05_145_7846787341043525292/-mr-10000
 POSTHOOK: query: select year(l_shipdate) as year,
         month(l_shipdate) as month,
         count(l_shipdate) as monthly_shipments
@@ -596,7 +596,7 @@ group by year(l_shipdate), month(l_shipdate)
 order by year, month
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@lineitem
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-04-25_613_8938618162298839937/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-01-05_145_7846787341043525292/-mr-10000
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._bucketname SIMPLE [(lineitem)lineitem.FieldSchema(name:INPUT__FILE__NAME, type:string, comment:), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._count_of_l_shipdate EXPRESSION [(lineitem)lineitem.FieldSchema(name:l_shipdate, type:string, comment:null), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._offsets EXPRESSION [(lineitem)lineitem.FieldSchema(name:BLOCK__OFFSET__INSIDE__FILE, type:bigint, comment:), ]
@@ -742,7 +742,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-04-47_584_6045415739978643731/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_18-01-11_386_3243920698852999950/-mr-10002 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -780,7 +780,7 @@ group by year(l_shipdate), month(l_shipdate)
 order by year, month
 PREHOOK: type: QUERY
 PREHOOK: Input: default@default__lineitem_lineitem_lshipdate_idx__
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-04-47_791_5806712921581936542/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-01-11_523_7411731261235643286/-mr-10000
 POSTHOOK: query: select year(l_shipdate) as year,
         month(l_shipdate) as month,
         count(l_shipdate) as monthly_shipments
@@ -789,7 +789,7 @@ group by year(l_shipdate), month(l_shipdate)
 order by year, month
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@default__lineitem_lineitem_lshipdate_idx__
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-04-47_791_5806712921581936542/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-01-11_523_7411731261235643286/-mr-10000
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._bucketname SIMPLE [(lineitem)lineitem.FieldSchema(name:INPUT__FILE__NAME, type:string, comment:), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._count_of_l_shipdate EXPRESSION [(lineitem)lineitem.FieldSchema(name:l_shipdate, type:string, comment:null), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._offsets EXPRESSION [(lineitem)lineitem.FieldSchema(name:BLOCK__OFFSET__INSIDE__FILE, type:bigint, comment:), ]
@@ -1115,7 +1115,8 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1
+  Stage-2 depends on stages: Stage-1, Stage-3
+  Stage-3 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -1180,22 +1181,40 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-05-09_490_5748831156089956075/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: bigint
-                outputColumnNames: _col0, _col1
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_18-01-18_107_7914726636641975616/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_18-01-18_107_7914726636641975616/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
         null-subquery2:dummy-subquery2:lineitem 
           TableScan
             alias: lineitem
@@ -1206,20 +1225,12 @@ STAGE PLANS:
                     expr: l_orderkey
                     type: int
               outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: bigint
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 0
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
 
   Stage: Stage-0
     Fetch Operator
@@ -3764,7 +3775,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-06-49_654_5924927149801403952/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_18-02-11_412_1990342123241011719/-mr-10002 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -3793,11 +3804,11 @@ STAGE PLANS:
 PREHOOK: query: select key, count(key) from tbl group by key order by key
 PREHOOK: type: QUERY
 PREHOOK: Input: default@tbl
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-06-49_751_2601799861432475313/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-11_492_2440459618491904996/-mr-10000
 POSTHOOK: query: select key, count(key) from tbl group by key order by key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@tbl
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-06-49_751_2601799861432475313/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-11_492_2440459618491904996/-mr-10000
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._bucketname SIMPLE [(lineitem)lineitem.FieldSchema(name:INPUT__FILE__NAME, type:string, comment:), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._count_of_l_shipdate EXPRESSION [(lineitem)lineitem.FieldSchema(name:l_shipdate, type:string, comment:null), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._offsets EXPRESSION [(lineitem)lineitem.FieldSchema(name:BLOCK__OFFSET__INSIDE__FILE, type:bigint, comment:), ]
@@ -3950,7 +3961,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-07-00_174_9033409821752767504/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_18-02-17_666_9208222129968129531/-mr-10002 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -3979,11 +3990,11 @@ STAGE PLANS:
 PREHOOK: query: select key, count(key) from tbl group by key order by key
 PREHOOK: type: QUERY
 PREHOOK: Input: default@default__tbl_tbl_key_idx__
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-07-00_328_6505949201900258519/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-17_798_1950624779635034326/-mr-10000
 POSTHOOK: query: select key, count(key) from tbl group by key order by key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@default__tbl_tbl_key_idx__
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_18-07-00_328_6505949201900258519/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-17_798_1950624779635034326/-mr-10000
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._bucketname SIMPLE [(lineitem)lineitem.FieldSchema(name:INPUT__FILE__NAME, type:string, comment:), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._count_of_l_shipdate EXPRESSION [(lineitem)lineitem.FieldSchema(name:l_shipdate, type:string, comment:null), ]
 POSTHOOK: Lineage: default__lineitem_lineitem_lshipdate_idx__._offsets EXPRESSION [(lineitem)lineitem.FieldSchema(name:BLOCK__OFFSET__INSIDE__FILE, type:bigint, comment:), ]
diff --git a/ql/src/test/results/clientpositive/stats1.q.out b/ql/src/test/results/clientpositive/stats1.q.out
index 8e88a5d160..3e60d42203 100644
--- a/ql/src/test/results/clientpositive/stats1.q.out
+++ b/ql/src/test/results/clientpositive/stats1.q.out
@@ -22,9 +22,10 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1
+  Stage-2 depends on stages: Stage-1, Stage-4
   Stage-0 depends on stages: Stage-2
   Stage-3 depends on stages: Stage-0
+  Stage-4 is a root stage
 
 STAGE PLANS:
   Stage: Stage-1
@@ -70,50 +71,40 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-41-19_798_1971155912112422091/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                outputColumnNames: _col0, _col1
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 1
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.tmptable
-        null-subquery2:unionsrc-subquery2:s2 
-          TableScan
-            alias: s2
+        file:/tmp/njain/hive_2011-12-07_18-02-24_750_6534230780541205365/-mr-10002 
+          Union
             Select Operator
               expressions:
-                    expr: key
+                    expr: _col0
                     type: string
-                    expr: value
+                    expr: _col1
                     type: string
               outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.tmptable
+        file:/tmp/njain/hive_2011-12-07_18-02-24_750_6534230780541205365/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.tmptable
 
   Stage: Stage-0
     Move Operator
@@ -128,6 +119,26 @@ STAGE PLANS:
   Stage: Stage-3
     Stats-Aggr Operator
 
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+          TableScan
+            alias: s2
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
 
 PREHOOK: query: INSERT OVERWRITE TABLE tmptable
 SELECT unionsrc.key, unionsrc.value 
@@ -152,11 +163,11 @@ POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src1)s2.FieldSchema
 PREHOOK: query: SELECT * FROM tmptable x SORT BY x.key, x.value
 PREHOOK: type: QUERY
 PREHOOK: Input: default@tmptable
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-41-27_356_8089553974050116678/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-35_439_727433938178853804/-mr-10000
 POSTHOOK: query: SELECT * FROM tmptable x SORT BY x.key, x.value
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@tmptable
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-41-27_356_8089553974050116678/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-35_439_727433938178853804/-mr-10000
 POSTHOOK: Lineage: tmptable.key EXPRESSION [(src1)s2.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src1)s2.FieldSchema(name:value, type:string, comment:default), ]
 	
@@ -194,4 +205,4 @@ POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src1)s2.FieldSchema
 key	string	
 value	string	
 	 	 
-Detailed Table Information	Table(tableName:tmptable, dbName:default, owner:njain, createTime:1321065679, lastAccessTime:0, retention:0, sd:StorageDescriptor(cols:[FieldSchema(name:key, type:string, comment:null), FieldSchema(name:value, type:string, comment:null)], location:pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/tmptable, inputFormat:org.apache.hadoop.mapred.TextInputFormat, outputFormat:org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat, compressed:false, numBuckets:-1, serdeInfo:SerDeInfo(name:null, serializationLib:org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, parameters:{serialization.format=1}), bucketCols:[], sortCols:[], parameters:{}), partitionKeys:[], parameters:{numPartitions=0, numFiles=2, transient_lastDdlTime=1321065687, numRows=26, totalSize=225, rawDataSize=199}, viewOriginalText:null, viewExpandedText:null, tableType:MANAGED_TABLE)	
+Detailed Table Information	Table(tableName:tmptable, dbName:default, owner:njain, createTime:1323309744, lastAccessTime:0, retention:0, sd:StorageDescriptor(cols:[FieldSchema(name:key, type:string, comment:null), FieldSchema(name:value, type:string, comment:null)], location:pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/tmptable, inputFormat:org.apache.hadoop.mapred.TextInputFormat, outputFormat:org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat, compressed:false, numBuckets:-1, serdeInfo:SerDeInfo(name:null, serializationLib:org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, parameters:{serialization.format=1}), bucketCols:[], sortCols:[], parameters:{}), partitionKeys:[], parameters:{numPartitions=0, numFiles=1, transient_lastDdlTime=1323309755, numRows=26, totalSize=225, rawDataSize=199}, viewOriginalText:null, viewExpandedText:null, tableType:MANAGED_TABLE)	
diff --git a/ql/src/test/results/clientpositive/union10.q.out b/ql/src/test/results/clientpositive/union10.q.out
index 56912d5ce9..20735fc5b1 100644
--- a/ql/src/test/results/clientpositive/union10.q.out
+++ b/ql/src/test/results/clientpositive/union10.q.out
@@ -81,81 +81,78 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-55-21_947_8308643198736653618/-mr-10002 
-          TableScan
-            Union
+        file:/tmp/njain/hive_2011-12-07_18-02-38_989_3821093086240595817/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: bigint
+                      expr: UDFToInteger(_col1)
+                      type: int
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: UDFToInteger(_col1)
-                        type: int
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-55-21_947_8308643198736653618/-mr-10004 
-          TableScan
-            Union
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.tmptable
+        file:/tmp/njain/hive_2011-12-07_18-02-38_989_3821093086240595817/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: bigint
+                      expr: UDFToInteger(_col1)
+                      type: int
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: UDFToInteger(_col1)
-                        type: int
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-55-21_947_8308643198736653618/-mr-10005 
-          TableScan
-            Union
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.tmptable
+        file:/tmp/njain/hive_2011-12-07_18-02-38_989_3821093086240595817/-mr-10005 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: bigint
+                      expr: UDFToInteger(_col1)
+                      type: int
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: UDFToInteger(_col1)
-                        type: int
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.tmptable
 
   Stage: Stage-6
     Conditional Operator
@@ -164,7 +161,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-55-21_947_8308643198736653618/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-02-38_989_3821093086240595817/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -182,7 +179,7 @@ STAGE PLANS:
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-55-21_947_8308643198736653618/-ext-10003 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-02-38_989_3821093086240595817/-ext-10003 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -296,11 +293,11 @@ POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src)s2.null, (src)s
 PREHOOK: query: select * from tmptable x sort by x.key
 PREHOOK: type: QUERY
 PREHOOK: Input: default@tmptable
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-55-53_706_2688637592498218353/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-53_260_7981936505385901161/-mr-10000
 POSTHOOK: query: select * from tmptable x sort by x.key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@tmptable
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-55-53_706_2688637592498218353/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-53_260_7981936505385901161/-mr-10000
 POSTHOOK: Lineage: tmptable.key EXPRESSION []
 POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src)s2.null, (src)s3.null, ]
 tst1	500
diff --git a/ql/src/test/results/clientpositive/union11.q.out b/ql/src/test/results/clientpositive/union11.q.out
index e81cad8efe..bf8e13ae13 100644
--- a/ql/src/test/results/clientpositive/union11.q.out
+++ b/ql/src/test/results/clientpositive/union11.q.out
@@ -70,93 +70,90 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-00_764_2746565021676130441/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
+        file:/tmp/njain/hive_2011-12-07_18-02-56_729_1436248963824606248/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
                       expr: _col0
                       type: string
-                outputColumnNames: _col0
-                Group By Operator
-                  aggregations:
-                        expr: count(1)
-                  bucketGroup: false
-                  keys:
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-00_764_2746565021676130441/-mr-10003 
-          TableScan
-            Union
-              Select Operator
-                expressions:
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-02-56_729_1436248963824606248/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
                       expr: _col0
                       type: string
-                outputColumnNames: _col0
-                Group By Operator
-                  aggregations:
-                        expr: count(1)
-                  bucketGroup: false
-                  keys:
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-00_764_2746565021676130441/-mr-10004 
-          TableScan
-            Union
-              Select Operator
-                expressions:
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-02-56_729_1436248963824606248/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
                       expr: _col0
                       type: string
-                outputColumnNames: _col0
-                Group By Operator
-                  aggregations:
-                        expr: count(1)
-                  bucketGroup: false
-                  keys:
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
@@ -273,7 +270,7 @@ PREHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, count(
                                             select 'tst3' as key, count(1) as value from src s3) unionsrc group by unionsrc.key
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-00_880_566315918713338735/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-56_855_5081522479982578048/-mr-10000
 POSTHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, count(1) as value from src s1
                                         UNION  ALL  
                                             select 'tst2' as key, count(1) as value from src s2
@@ -281,7 +278,7 @@ POSTHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, count
                                             select 'tst3' as key, count(1) as value from src s3) unionsrc group by unionsrc.key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@src
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-00_880_566315918713338735/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-02-56_855_5081522479982578048/-mr-10000
 tst1	1
 tst2	1
 tst3	1
diff --git a/ql/src/test/results/clientpositive/union12.q.out b/ql/src/test/results/clientpositive/union12.q.out
index a764a89722..9df7d481a6 100644
--- a/ql/src/test/results/clientpositive/union12.q.out
+++ b/ql/src/test/results/clientpositive/union12.q.out
@@ -81,81 +81,78 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-25_019_376395372604357845/-mr-10002 
-          TableScan
-            Union
+        file:/tmp/njain/hive_2011-12-07_18-03-10_228_8410433153782064994/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: bigint
+                      expr: UDFToInteger(_col1)
+                      type: int
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: UDFToInteger(_col1)
-                        type: int
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-25_019_376395372604357845/-mr-10004 
-          TableScan
-            Union
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.tmptable
+        file:/tmp/njain/hive_2011-12-07_18-03-10_228_8410433153782064994/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: bigint
+                      expr: UDFToInteger(_col1)
+                      type: int
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: UDFToInteger(_col1)
-                        type: int
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-25_019_376395372604357845/-mr-10005 
-          TableScan
-            Union
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.tmptable
+        file:/tmp/njain/hive_2011-12-07_18-03-10_228_8410433153782064994/-mr-10005 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: bigint
+                      expr: UDFToInteger(_col1)
+                      type: int
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: UDFToInteger(_col1)
-                        type: int
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.tmptable
 
   Stage: Stage-6
     Conditional Operator
@@ -164,7 +161,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-56-25_019_376395372604357845/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-03-10_228_8410433153782064994/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -182,7 +179,7 @@ STAGE PLANS:
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_10-56-25_019_376395372604357845/-ext-10003 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-03-10_228_8410433153782064994/-ext-10003 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -300,11 +297,11 @@ POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src1)s2.null, (srcb
 PREHOOK: query: select * from tmptable x sort by x.key
 PREHOOK: type: QUERY
 PREHOOK: Input: default@tmptable
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-59_422_9146371764111979198/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-03-24_504_2428324100622025728/-mr-10000
 POSTHOOK: query: select * from tmptable x sort by x.key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@tmptable
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-56-59_422_9146371764111979198/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-03-24_504_2428324100622025728/-mr-10000
 POSTHOOK: Lineage: tmptable.key EXPRESSION []
 POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src1)s2.null, (srcbucket)s3.null, ]
 tst1	500
diff --git a/ql/src/test/results/clientpositive/union14.q.out b/ql/src/test/results/clientpositive/union14.q.out
index 82f4b2a767..e653869dcb 100644
--- a/ql/src/test/results/clientpositive/union14.q.out
+++ b/ql/src/test/results/clientpositive/union14.q.out
@@ -18,143 +18,154 @@ ABSTRACT SYNTAX TREE:
   (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src1) s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL s2) key) key) (TOK_SELEXPR (. (TOK_TABLE_OR_COL s2) value) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src) s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION TOK_STRING (TOK_FUNCTION count 1)) value))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL unionsrc) key)) (TOK_SELEXPR (TOK_FUNCTION count 1))) (TOK_GROUPBY (. (TOK_TABLE_OR_COL unionsrc) key))))
 
 STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-3
   Stage-3 is a root stage
-  Stage-2 depends on stages: Stage-3
   Stage-0 is a root stage
 
 STAGE PLANS:
-  Stage: Stage-3
+  Stage: Stage-1
     Map Reduce
       Alias -> Map Operator Tree:
-        null-subquery2:unionsrc-subquery2:s1 
+        null-subquery1:unionsrc-subquery1:s2 
           TableScan
-            alias: s1
+            alias: s2
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        file:/tmp/njain/hive_2011-12-07_18-03-27_983_5817128832919821487/-mr-10002 
+          Union
             Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
               Group By Operator
                 aggregations:
                       expr: count(1)
                 bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
                 mode: hash
-                outputColumnNames: _col0
+                outputColumnNames: _col0, _col1
                 Reduce Output Operator
-                  sort order: 
+                  key expressions:
+                        expr: _col0
+                        type: string
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
                   tag: -1
                   value expressions:
+                        expr: _col1
+                        type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-03-27_983_5817128832919821487/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
+                        expr: _col0
+                        type: string
+                  sort order: +
+                  Map-reduce partition columns:
                         expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
                         type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
                 expr: count(VALUE._col0)
           bucketGroup: false
+          keys:
+                expr: KEY._col0
+                type: string
           mode: mergepartial
-          outputColumnNames: _col0
+          outputColumnNames: _col0, _col1
           Select Operator
             expressions:
-                  expr: 'tst1'
-                  type: string
-                  expr: UDFToString(_col0)
+                  expr: _col0
                   type: string
+                  expr: _col1
+                  type: bigint
             outputColumnNames: _col0, _col1
             File Output Operator
               compressed: false
               GlobalTableId: 0
               table:
-                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                  input format: org.apache.hadoop.mapred.TextInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
 
-  Stage: Stage-2
+  Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-57-10_782_8545995354441159380/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                outputColumnNames: _col0
-                Group By Operator
-                  aggregations:
-                        expr: count(1)
-                  bucketGroup: false
-                  keys:
-                        expr: _col0
-                        type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
-        null-subquery1:unionsrc-subquery1:s2 
+        null-subquery2:unionsrc-subquery2:s1 
           TableScan
-            alias: s2
+            alias: s1
             Select Operator
-              expressions:
-                    expr: key
-                    type: string
-                    expr: value
-                    type: string
-              outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                mode: hash
+                outputColumnNames: _col0
+                Reduce Output Operator
+                  sort order: 
+                  tag: -1
+                  value expressions:
                         expr: _col0
-                        type: string
-                  outputColumnNames: _col0
-                  Group By Operator
-                    aggregations:
-                          expr: count(1)
-                    bucketGroup: false
-                    keys:
-                          expr: _col0
-                          type: string
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      Map-reduce partition columns:
-                            expr: _col0
-                            type: string
-                      tag: -1
-                      value expressions:
-                            expr: _col1
-                            type: bigint
+                        type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
                 expr: count(VALUE._col0)
           bucketGroup: false
-          keys:
-                expr: KEY._col0
-                type: string
           mode: mergepartial
-          outputColumnNames: _col0, _col1
+          outputColumnNames: _col0
           Select Operator
             expressions:
-                  expr: _col0
+                  expr: 'tst1'
+                  type: string
+                  expr: UDFToString(_col0)
                   type: string
-                  expr: _col1
-                  type: bigint
             outputColumnNames: _col0, _col1
             File Output Operator
               compressed: false
               GlobalTableId: 0
               table:
-                  input format: org.apache.hadoop.mapred.TextInputFormat
-                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
 
   Stage: Stage-0
     Fetch Operator
@@ -168,7 +179,7 @@ PREHOOK: query: select unionsrc.key, count(1) FROM (select s2.key as key, s2.val
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
 PREHOOK: Input: default@src1
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-57-10_879_8932885890935655590/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-03-28_088_661726235931648241/-mr-10000
 POSTHOOK: query: select unionsrc.key, count(1) FROM (select s2.key as key, s2.value as value from src1 s2
                                         UNION  ALL  
                                       select 'tst1' as key, cast(count(1) as string) as value from src s1) 
@@ -176,7 +187,7 @@ POSTHOOK: query: select unionsrc.key, count(1) FROM (select s2.key as key, s2.va
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@src
 POSTHOOK: Input: default@src1
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_10-57-10_879_8932885890935655590/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-03-28_088_661726235931648241/-mr-10000
 	10
 128	1
 146	1
diff --git a/ql/src/test/results/clientpositive/union15.q.out b/ql/src/test/results/clientpositive/union15.q.out
index b331364692..4da25d3218 100644
--- a/ql/src/test/results/clientpositive/union15.q.out
+++ b/ql/src/test/results/clientpositive/union15.q.out
@@ -21,7 +21,9 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1
+  Stage-2 depends on stages: Stage-1, Stage-3, Stage-4
+  Stage-3 is a root stage
+  Stage-4 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -68,109 +70,90 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-44-21_507_2125703197567872880/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
+        file:/tmp/njain/hive_2011-12-07_18-03-37_668_492706794491473988/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
                       expr: _col0
                       type: string
-                outputColumnNames: _col0
-                Group By Operator
-                  aggregations:
-                        expr: count(1)
-                  bucketGroup: false
-                  keys:
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
-        null-subquery1-subquery2:unionsrc-subquery1-subquery2:s2 
-          TableScan
-            alias: s2
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-03-37_668_492706794491473988/-mr-10003 
+          Union
             Select Operator
               expressions:
-                    expr: key
+                    expr: _col0
                     type: string
-                    expr: value
-                    type: string
-              outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  outputColumnNames: _col0
-                  Group By Operator
-                    aggregations:
-                          expr: count(1)
-                    bucketGroup: false
-                    keys:
-                          expr: _col0
-                          type: string
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      Map-reduce partition columns:
-                            expr: _col0
-                            type: string
-                      tag: -1
-                      value expressions:
-                            expr: _col1
-                            type: bigint
-        null-subquery2:unionsrc-subquery2:s3 
-          TableScan
-            alias: s3
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-03-37_668_492706794491473988/-mr-10004 
+          Union
             Select Operator
               expressions:
-                    expr: key
-                    type: string
-                    expr: value
+                    expr: _col0
                     type: string
-              outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  outputColumnNames: _col0
-                  Group By Operator
-                    aggregations:
-                          expr: count(1)
-                    bucketGroup: false
-                    keys:
-                          expr: _col0
-                          type: string
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      Map-reduce partition columns:
-                            expr: _col0
-                            type: string
-                      tag: -1
-                      value expressions:
-                            expr: _col1
-                            type: bigint
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
@@ -195,6 +178,46 @@ STAGE PLANS:
                   input format: org.apache.hadoop.mapred.TextInputFormat
                   output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
 
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1-subquery2:unionsrc-subquery1-subquery2:s2 
+          TableScan
+            alias: s2
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s3 
+          TableScan
+            alias: s3
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
   Stage: Stage-0
     Fetch Operator
       limit: -1
@@ -208,7 +231,7 @@ PREHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, cast(c
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
 PREHOOK: Input: default@src1
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-44-21_627_586305899053312380/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-03-37_794_191359379207326828/-mr-10000
 POSTHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
                                         UNION  ALL  
                                             select s2.key as key, s2.value as value from src1 s2
@@ -217,7 +240,7 @@ POSTHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, cast(
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@src
 POSTHOOK: Input: default@src1
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-44-21_627_586305899053312380/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-03-37_794_191359379207326828/-mr-10000
 	20
 128	2
 146	2
diff --git a/ql/src/test/results/clientpositive/union17.q.out b/ql/src/test/results/clientpositive/union17.q.out
index 170b156a5e..6c6bed0e37 100644
--- a/ql/src/test/results/clientpositive/union17.q.out
+++ b/ql/src/test/results/clientpositive/union17.q.out
@@ -31,13 +31,14 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-2 is a root stage
-  Stage-3 depends on stages: Stage-2
+  Stage-3 depends on stages: Stage-2, Stage-8
   Stage-4 depends on stages: Stage-3
   Stage-0 depends on stages: Stage-4
   Stage-5 depends on stages: Stage-0
   Stage-6 depends on stages: Stage-3
   Stage-1 depends on stages: Stage-6
   Stage-7 depends on stages: Stage-1
+  Stage-8 is a root stage
 
 STAGE PLANS:
   Stage: Stage-2
@@ -83,48 +84,38 @@ STAGE PLANS:
   Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-44-33_959_6338494989611388938/-mr-10004 
-          TableScan
-            Union
-              Reduce Output Operator
-                key expressions:
-                      expr: substr(_col1, 5)
-                      type: string
-                sort order: +
-                Map-reduce partition columns:
-                      expr: substr(_col1, 5)
-                      type: string
-                tag: -1
-                value expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-        null-subquery2:unionsrc-subquery2:s2 
-          TableScan
-            alias: s2
-            Select Operator
-              expressions:
-                    expr: key
+        file:/tmp/njain/hive_2011-12-07_18-03-50_661_6509786186647589223/-mr-10004 
+          Union
+            Reduce Output Operator
+              key expressions:
+                    expr: substr(_col1, 5)
                     type: string
-                    expr: value
+              sort order: +
+              Map-reduce partition columns:
+                    expr: substr(_col1, 5)
+                    type: string
+              tag: -1
+              value expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+        file:/tmp/njain/hive_2011-12-07_18-03-50_661_6509786186647589223/-mr-10007 
+          Union
+            Reduce Output Operator
+              key expressions:
+                    expr: substr(_col1, 5)
+                    type: string
+              sort order: +
+              Map-reduce partition columns:
+                    expr: substr(_col1, 5)
+                    type: string
+              tag: -1
+              value expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
                     type: string
-              outputColumnNames: _col0, _col1
-              Union
-                Reduce Output Operator
-                  key expressions:
-                        expr: substr(_col1, 5)
-                        type: string
-                  sort order: +
-                  Map-reduce partition columns:
-                        expr: substr(_col1, 5)
-                        type: string
-                  tag: -1
-                  value expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
       Reduce Operator Tree:
         Forward
           Group By Operator
@@ -163,7 +154,7 @@ STAGE PLANS:
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-44-33_959_6338494989611388938/-mr-10005 
+        file:/tmp/njain/hive_2011-12-07_18-03-50_661_6509786186647589223/-mr-10005 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -218,7 +209,7 @@ STAGE PLANS:
   Stage: Stage-6
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-44-33_959_6338494989611388938/-mr-10006 
+        file:/tmp/njain/hive_2011-12-07_18-03-50_661_6509786186647589223/-mr-10006 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -278,6 +269,26 @@ STAGE PLANS:
   Stage: Stage-7
     Stats-Aggr Operator
 
+  Stage: Stage-8
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+          TableScan
+            alias: s2
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
 
 PREHOOK: query: FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
                          UNION  ALL  
@@ -305,11 +316,11 @@ POSTHOOK: Lineage: dest2.val2 EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name
 PREHOOK: query: SELECT DEST1.* FROM DEST1
 PREHOOK: type: QUERY
 PREHOOK: Input: default@dest1
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-44-49_359_8447037142158352093/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-08_648_6904408471110189565/-mr-10000
 POSTHOOK: query: SELECT DEST1.* FROM DEST1
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@dest1
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-44-49_359_8447037142158352093/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-08_648_6904408471110189565/-mr-10000
 POSTHOOK: Lineage: dest1.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: dest1.value EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: dest2.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
@@ -628,11 +639,11 @@ tst1	1
 PREHOOK: query: SELECT DEST2.* FROM DEST2
 PREHOOK: type: QUERY
 PREHOOK: Input: default@dest2
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-44-49_536_8596475375635774367/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-08_883_4325419205851366019/-mr-10000
 POSTHOOK: query: SELECT DEST2.* FROM DEST2
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@dest2
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-44-49_536_8596475375635774367/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-08_883_4325419205851366019/-mr-10000
 POSTHOOK: Lineage: dest1.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: dest1.value EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: dest2.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
diff --git a/ql/src/test/results/clientpositive/union18.q.out b/ql/src/test/results/clientpositive/union18.q.out
index 49109d4aed..47c92e48f7 100644
--- a/ql/src/test/results/clientpositive/union18.q.out
+++ b/ql/src/test/results/clientpositive/union18.q.out
@@ -31,7 +31,7 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-2 is a root stage
-  Stage-3 depends on stages: Stage-2
+  Stage-3 depends on stages: Stage-2, Stage-12
   Stage-7 depends on stages: Stage-3 , consists of Stage-6, Stage-5
   Stage-6
   Stage-0 depends on stages: Stage-6, Stage-5
@@ -42,6 +42,7 @@ STAGE DEPENDENCIES:
   Stage-1 depends on stages: Stage-10, Stage-9
   Stage-8 depends on stages: Stage-1
   Stage-9
+  Stage-12 is a root stage
 
 STAGE PLANS:
   Stage: Stage-2
@@ -87,84 +88,74 @@ STAGE PLANS:
   Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-44-50_145_1216043361112817214/-mr-10004 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                outputColumnNames: _col0, _col1
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 1
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.dest1
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                      expr: _col1
-                      type: string
-                outputColumnNames: _col0, _col1, _col2
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 2
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.dest2
-        null-subquery2:unionsrc-subquery2:s2 
-          TableScan
-            alias: s2
+        file:/tmp/njain/hive_2011-12-07_18-04-09_626_3143271523364813511/-mr-10004 
+          Union
             Select Operator
               expressions:
-                    expr: key
+                    expr: _col0
                     type: string
-                    expr: value
+                    expr: _col1
                     type: string
               outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.dest1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                        expr: _col1
-                        type: string
-                  outputColumnNames: _col0, _col1, _col2
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 2
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.dest2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.dest1
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 2
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.dest2
+        file:/tmp/njain/hive_2011-12-07_18-04-09_626_3143271523364813511/-mr-10007 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.dest1
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 2
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.dest2
 
   Stage: Stage-7
     Conditional Operator
@@ -173,7 +164,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/data/users/njain/hive_commit1/build/ql/scratchdir/hive_2011-11-11_18-44-50_145_1216043361112817214/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-04-09_626_3143271523364813511/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -191,7 +182,7 @@ STAGE PLANS:
   Stage: Stage-5
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/data/users/njain/hive_commit1/build/ql/scratchdir/hive_2011-11-11_18-44-50_145_1216043361112817214/-ext-10005 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-04-09_626_3143271523364813511/-ext-10005 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -208,7 +199,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/data/users/njain/hive_commit1/build/ql/scratchdir/hive_2011-11-11_18-44-50_145_1216043361112817214/-ext-10002
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-04-09_626_3143271523364813511/-ext-10002
 
   Stage: Stage-1
     Move Operator
@@ -226,7 +217,7 @@ STAGE PLANS:
   Stage: Stage-9
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/data/users/njain/hive_commit1/build/ql/scratchdir/hive_2011-11-11_18-44-50_145_1216043361112817214/-ext-10006 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-04-09_626_3143271523364813511/-ext-10006 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -236,6 +227,26 @@ STAGE PLANS:
                   serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                   name: default.dest2
 
+  Stage: Stage-12
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+          TableScan
+            alias: s2
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
 
 PREHOOK: query: FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
                          UNION  ALL  
@@ -263,11 +274,11 @@ POSTHOOK: Lineage: dest2.val2 EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name
 PREHOOK: query: SELECT DEST1.* FROM DEST1 SORT BY DEST1.key, DEST1.value
 PREHOOK: type: QUERY
 PREHOOK: Input: default@dest1
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-05_088_4825286294412544717/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-23_740_603654379243514671/-mr-10000
 POSTHOOK: query: SELECT DEST1.* FROM DEST1 SORT BY DEST1.key, DEST1.value
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@dest1
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-05_088_4825286294412544717/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-23_740_603654379243514671/-mr-10000
 POSTHOOK: Lineage: dest1.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: dest1.value EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: dest2.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
@@ -777,11 +788,11 @@ tst1	500
 PREHOOK: query: SELECT DEST2.* FROM DEST2 SORT BY DEST2.key, DEST2.val1, DEST2.val2
 PREHOOK: type: QUERY
 PREHOOK: Input: default@dest2
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-08_648_6682422004742420258/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-26_980_2715436732076711130/-mr-10000
 POSTHOOK: query: SELECT DEST2.* FROM DEST2 SORT BY DEST2.key, DEST2.val1, DEST2.val2
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@dest2
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-08_648_6682422004742420258/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-26_980_2715436732076711130/-mr-10000
 POSTHOOK: Lineage: dest1.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: dest1.value EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: dest2.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
diff --git a/ql/src/test/results/clientpositive/union19.q.out b/ql/src/test/results/clientpositive/union19.q.out
index 801830b8c6..062d7175a3 100644
--- a/ql/src/test/results/clientpositive/union19.q.out
+++ b/ql/src/test/results/clientpositive/union19.q.out
@@ -31,11 +31,12 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-2 is a root stage
-  Stage-3 depends on stages: Stage-2
+  Stage-3 depends on stages: Stage-2, Stage-6
   Stage-0 depends on stages: Stage-3
   Stage-4 depends on stages: Stage-0
   Stage-1 depends on stages: Stage-3
   Stage-5 depends on stages: Stage-1
+  Stage-6 is a root stage
 
 STAGE PLANS:
   Stage: Stage-2
@@ -81,110 +82,100 @@ STAGE PLANS:
   Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-45-12_312_7781375403068710979/-mr-10004 
-          TableScan
-            Union
-              Select Operator
-                expressions:
+        file:/tmp/njain/hive_2011-12-07_18-04-33_197_8409668105765066267/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              Group By Operator
+                aggregations:
+                      expr: count(_col1)
+                bucketGroup: false
+                keys:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: string
+                mode: hash
                 outputColumnNames: _col0, _col1
-                Group By Operator
-                  aggregations:
-                        expr: count(_col1)
-                  bucketGroup: false
-                  keys:
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                      expr: _col1
-                      type: string
-                outputColumnNames: _col0, _col1, _col2
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 2
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.dest2
-        null-subquery2:unionsrc-subquery2:s2 
-          TableScan
-            alias: s2
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
             Select Operator
               expressions:
-                    expr: key
+                    expr: _col0
                     type: string
-                    expr: value
+                    expr: _col1
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 2
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.dest2
+        file:/tmp/njain/hive_2011-12-07_18-04-33_197_8409668105765066267/-mr-10005 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
                     type: string
               outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
+              Group By Operator
+                aggregations:
+                      expr: count(_col1)
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                        expr: _col1
-                        type: string
-                  outputColumnNames: _col0, _col1
-                  Group By Operator
-                    aggregations:
-                          expr: count(_col1)
-                    bucketGroup: false
-                    keys:
-                          expr: _col0
-                          type: string
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      Map-reduce partition columns:
-                            expr: _col0
-                            type: string
-                      tag: -1
-                      value expressions:
-                            expr: _col1
-                            type: bigint
-                Select Operator
-                  expressions:
+                  sort order: +
+                  Map-reduce partition columns:
                         expr: _col0
                         type: string
+                  tag: -1
+                  value expressions:
                         expr: _col1
-                        type: string
-                        expr: _col1
-                        type: string
-                  outputColumnNames: _col0, _col1, _col2
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 2
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.dest2
+                        type: bigint
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1, _col2
+              File Output Operator
+                compressed: false
+                GlobalTableId: 2
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.dest2
       Reduce Operator Tree:
         Group By Operator
           aggregations:
@@ -237,6 +228,26 @@ STAGE PLANS:
   Stage: Stage-5
     Stats-Aggr Operator
 
+  Stage: Stage-6
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+          TableScan
+            alias: s2
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
 
 PREHOOK: query: FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
                          UNION  ALL  
@@ -264,11 +275,11 @@ POSTHOOK: Lineage: dest2.val2 EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name
 PREHOOK: query: SELECT DEST1.* FROM DEST1 SORT BY DEST1.key, DEST1.value
 PREHOOK: type: QUERY
 PREHOOK: Input: default@dest1
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-21_613_4288475577316753396/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-54_471_8662048643353835173/-mr-10000
 POSTHOOK: query: SELECT DEST1.* FROM DEST1 SORT BY DEST1.key, DEST1.value
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@dest1
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-21_613_4288475577316753396/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-54_471_8662048643353835173/-mr-10000
 POSTHOOK: Lineage: dest1.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: dest1.value EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: dest2.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
@@ -587,11 +598,11 @@ tst1	1
 PREHOOK: query: SELECT DEST2.* FROM DEST2 SORT BY DEST2.key, DEST2.val1, DEST2.val2
 PREHOOK: type: QUERY
 PREHOOK: Input: default@dest2
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-24_769_1643306397793328945/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-57_634_6401136136299268271/-mr-10000
 POSTHOOK: query: SELECT DEST2.* FROM DEST2 SORT BY DEST2.key, DEST2.val1, DEST2.val2
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@dest2
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-24_769_1643306397793328945/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-04-57_634_6401136136299268271/-mr-10000
 POSTHOOK: Lineage: dest1.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: dest1.value EXPRESSION [(src)s1.null, (src)s2.FieldSchema(name:value, type:string, comment:default), ]
 POSTHOOK: Lineage: dest2.key EXPRESSION [(src)s2.FieldSchema(name:key, type:string, comment:default), ]
diff --git a/ql/src/test/results/clientpositive/union20.q.out b/ql/src/test/results/clientpositive/union20.q.out
index 817e32ae77..1d3e43b2e0 100644
--- a/ql/src/test/results/clientpositive/union20.q.out
+++ b/ql/src/test/results/clientpositive/union20.q.out
@@ -29,9 +29,11 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1, Stage-5
+  Stage-2 depends on stages: Stage-1, Stage-3, Stage-5
+  Stage-3 is a root stage
+  Stage-4 is a root stage
+  Stage-5 depends on stages: Stage-4, Stage-6
   Stage-6 is a root stage
-  Stage-5 depends on stages: Stage-6
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -93,52 +95,38 @@ STAGE PLANS:
                     type: string
                     expr: _col1
                     type: string
-        file:/tmp/njain/hive_2011-11-11_18-45-31_836_8101530069181152276/-mr-10002 
-          TableScan
-            Union
-              Reduce Output Operator
-                key expressions:
-                      expr: _col0
-                      type: string
-                sort order: +
-                Map-reduce partition columns:
-                      expr: _col0
-                      type: string
-                tag: 1
-                value expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-        null-subquery2:unionsrc2-subquery2:s4 
-          TableScan
-            alias: s4
-            Filter Operator
-              predicate:
-                  expr: (key < 10)
-                  type: boolean
-              Select Operator
-                expressions:
-                      expr: key
-                      type: string
-                      expr: value
-                      type: string
-                outputColumnNames: _col0, _col1
-                Union
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: 1
-                    value expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: string
+        file:/tmp/njain/hive_2011-12-07_18-05-02_524_3478183075357722431/-mr-10002 
+          Union
+            Reduce Output Operator
+              key expressions:
+                    expr: _col0
+                    type: string
+              sort order: +
+              Map-reduce partition columns:
+                    expr: _col0
+                    type: string
+              tag: 1
+              value expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+        file:/tmp/njain/hive_2011-12-07_18-05-02_524_3478183075357722431/-mr-10003 
+          Union
+            Reduce Output Operator
+              key expressions:
+                    expr: _col0
+                    type: string
+              sort order: +
+              Map-reduce partition columns:
+                    expr: _col0
+                    type: string
+              tag: 1
+              value expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
       Reduce Operator Tree:
         Join Operator
           condition map:
@@ -166,6 +154,74 @@ STAGE PLANS:
                   input format: org.apache.hadoop.mapred.TextInputFormat
                   output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
 
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc2-subquery2:s4 
+          TableScan
+            alias: s4
+            Filter Operator
+              predicate:
+                  expr: (key < 10)
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: key
+                      type: string
+                      expr: value
+                      type: string
+                outputColumnNames: _col0, _col1
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc1-subquery2:s2 
+          TableScan
+            alias: s2
+            Filter Operator
+              predicate:
+                  expr: (key < 10)
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: key
+                      type: string
+                      expr: value
+                      type: string
+                outputColumnNames: _col0, _col1
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
+  Stage: Stage-5
+    Map Reduce
+      Alias -> Map Operator Tree:
+        file:/tmp/njain/hive_2011-12-07_18-05-02_524_3478183075357722431/-mr-10004 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+        file:/tmp/njain/hive_2011-12-07_18-05-02_524_3478183075357722431/-mr-10006 
+          Union
+            File Output Operator
+              compressed: false
+              GlobalTableId: 0
+              table:
+                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
   Stage: Stage-6
     Map Reduce
       Alias -> Map Operator Tree:
@@ -206,40 +262,6 @@ STAGE PLANS:
                   input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                   output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
 
-  Stage: Stage-5
-    Map Reduce
-      Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-45-31_836_8101530069181152276/-mr-10004 
-          TableScan
-            Union
-              File Output Operator
-                compressed: false
-                GlobalTableId: 0
-                table:
-                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-        null-subquery2:unionsrc1-subquery2:s2 
-          TableScan
-            alias: s2
-            Filter Operator
-              predicate:
-                  expr: (key < 10)
-                  type: boolean
-              Select Operator
-                expressions:
-                      expr: key
-                      type: string
-                      expr: value
-                      type: string
-                outputColumnNames: _col0, _col1
-                Union
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 0
-                    table:
-                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-
   Stage: Stage-0
     Fetch Operator
       limit: -1
@@ -256,7 +278,7 @@ JOIN
 ON (unionsrc1.key = unionsrc2.key)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-31_982_246659288493998228/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-05-02_728_8213800151047927461/-mr-10000
 POSTHOOK: query: SELECT unionsrc1.key, unionsrc1.value, unionsrc2.key, unionsrc2.value
 FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
                          UNION  ALL  
@@ -268,7 +290,7 @@ JOIN
 ON (unionsrc1.key = unionsrc2.key)
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@src
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-45-31_982_246659288493998228/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-05-02_728_8213800151047927461/-mr-10000
 0	val_0	0	val_0
 0	val_0	0	val_0
 0	val_0	0	val_0
diff --git a/ql/src/test/results/clientpositive/union24.q.out b/ql/src/test/results/clientpositive/union24.q.out
index 1a41170ee4..96f1d20fe9 100644
--- a/ql/src/test/results/clientpositive/union24.q.out
+++ b/ql/src/test/results/clientpositive/union24.q.out
@@ -54,11 +54,273 @@ ABSTRACT SYNTAX TREE:
   (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_UNION (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src2))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL count))) (TOK_WHERE (< (TOK_TABLE_OR_COL key) 10)))) (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src3))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL count))) (TOK_WHERE (< (TOK_TABLE_OR_COL key) 10))))) (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src4))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL count))) (TOK_WHERE (< (TOK_TABLE_OR_COL key) 10))))) (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src5))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_FUNCTION count 1) count)) (TOK_WHERE (< (TOK_TABLE_OR_COL key) 10)) (TOK_GROUPBY (TOK_TABLE_OR_COL key))))) s)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL s) key)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL s) count))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (. (TOK_TABLE_OR_COL s) key)))))
 
 STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-3, Stage-4, Stage-5
   Stage-3 is a root stage
-  Stage-2 depends on stages: Stage-3
+  Stage-4 is a root stage
+  Stage-5 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1-subquery2:s-subquery1-subquery2:src4 
+          TableScan
+            alias: src4
+            GatherStats: false
+            Filter Operator
+              isSamplingPred: false
+              predicate:
+                  expr: (key < 10)
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: key
+                      type: string
+                      expr: count
+                      type: bigint
+                outputColumnNames: _col0, _col1
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10002
+                  NumFilesPerFileSink: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                      properties:
+                        columns _col0,_col1
+                        columns.types string,bigint
+                        escape.delim \
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
+      Needs Tagging: false
+      Path -> Alias:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4 [null-subquery1-subquery2:s-subquery1-subquery2:src4]
+      Path -> Partition:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4 
+          Partition
+            base file name: src4
+            input format: org.apache.hadoop.mapred.TextInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+            properties:
+              bucket_count -1
+              columns key,count
+              columns.types string:bigint
+              file.inputformat org.apache.hadoop.mapred.TextInputFormat
+              file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4
+              name default.src4
+              numFiles 1
+              numPartitions 0
+              numRows 309
+              rawDataSize 1482
+              serialization.ddl struct src4 { string key, i64 count}
+              serialization.format 1
+              serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+              totalSize 1791
+              transient_lastDdlTime 1323309936
+            serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+          
+              input format: org.apache.hadoop.mapred.TextInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+              properties:
+                bucket_count -1
+                columns key,count
+                columns.types string:bigint
+                file.inputformat org.apache.hadoop.mapred.TextInputFormat
+                file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4
+                name default.src4
+                numFiles 1
+                numPartitions 0
+                numRows 309
+                rawDataSize 1482
+                serialization.ddl struct src4 { string key, i64 count}
+                serialization.format 1
+                serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                totalSize 1791
+                transient_lastDdlTime 1323309936
+              serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+              name: default.src4
+            name: default.src4
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
+                      type: string
+                sort order: +
+                tag: -1
+                value expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
+                      type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
+                      type: string
+                sort order: +
+                tag: -1
+                value expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
+                      type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
+                      type: string
+                sort order: +
+                tag: -1
+                value expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
+                      type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10005 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
+                      type: string
+                sort order: +
+                tag: -1
+                value expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
+                      type: bigint
+      Needs Tagging: false
+      Path -> Alias:
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10002 [file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10002]
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10003 [file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10003]
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10004 [file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10004]
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10005 [file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10005]
+      Path -> Partition:
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10002 
+          Partition
+            base file name: -mr-10002
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10003 
+          Partition
+            base file name: -mr-10003
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10004 
+          Partition
+            base file name: -mr-10004
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+        file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10005 
+          Partition
+            base file name: -mr-10005
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+      Reduce Operator Tree:
+        Extract
+          File Output Operator
+            compressed: false
+            GlobalTableId: 0
+            directory: file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-ext-10001
+            NumFilesPerFileSink: 1
+            Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-ext-10001/
+            table:
+                input format: org.apache.hadoop.mapred.TextInputFormat
+                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                properties:
+                  columns _col0,_col1
+                  columns.types string:bigint
+                  escape.delim \
+                  serialization.format 1
+            TotalFiles: 1
+            GatherStats: false
+            MultiFileSpray: false
+
   Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
@@ -99,9 +361,9 @@ STAGE PLANS:
                           type: bigint
       Needs Tagging: false
       Path -> Alias:
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5 [null-subquery2:s-subquery2:src5]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5 [null-subquery2:s-subquery2:src5]
       Path -> Partition:
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5 
           Partition
             base file name: src5
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -112,7 +374,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5
               name default.src5
               numFiles 1
               numPartitions 0
@@ -122,7 +384,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386862
+              transient_lastDdlTime 1323309941
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -133,7 +395,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5
                 name default.src5
                 numFiles 1
                 numPartitions 0
@@ -143,7 +405,7 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386862
+                transient_lastDdlTime 1323309941
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src5
             name: default.src5
@@ -167,7 +429,7 @@ STAGE PLANS:
             File Output Operator
               compressed: false
               GlobalTableId: 0
-              directory: file:/tmp/njain/hive_2011-11-15_11-54-22_876_2630154306961832139/-mr-10002
+              directory: file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10003
               NumFilesPerFileSink: 1
               table:
                   input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -180,66 +442,9 @@ STAGE PLANS:
               GatherStats: false
               MultiFileSpray: false
 
-  Stage: Stage-2
+  Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-15_11-54-22_876_2630154306961832139/-mr-10002 
-          TableScan
-            GatherStats: false
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: bigint
-                outputColumnNames: _col0, _col1
-                Reduce Output Operator
-                  key expressions:
-                        expr: _col0
-                        type: string
-                  sort order: +
-                  tag: -1
-                  value expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: bigint
-        null-subquery1-subquery1-subquery1:s-subquery1-subquery1-subquery1:src2 
-          TableScan
-            alias: src2
-            GatherStats: false
-            Filter Operator
-              isSamplingPred: false
-              predicate:
-                  expr: (key < 10)
-                  type: boolean
-              Select Operator
-                expressions:
-                      expr: key
-                      type: string
-                      expr: count
-                      type: bigint
-                outputColumnNames: _col0, _col1
-                Union
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: bigint
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      tag: -1
-                      value expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: bigint
         null-subquery1-subquery1-subquery2:s-subquery1-subquery1-subquery2:src3 
           TableScan
             alias: src3
@@ -256,130 +461,26 @@ STAGE PLANS:
                       expr: count
                       type: bigint
                 outputColumnNames: _col0, _col1
-                Union
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: bigint
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      tag: -1
-                      value expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: bigint
-        null-subquery1-subquery2:s-subquery1-subquery2:src4 
-          TableScan
-            alias: src4
-            GatherStats: false
-            Filter Operator
-              isSamplingPred: false
-              predicate:
-                  expr: (key < 10)
-                  type: boolean
-              Select Operator
-                expressions:
-                      expr: key
-                      type: string
-                      expr: count
-                      type: bigint
-                outputColumnNames: _col0, _col1
-                Union
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: bigint
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      tag: -1
-                      value expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: bigint
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10004
+                  NumFilesPerFileSink: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                      properties:
+                        columns _col0,_col1
+                        columns.types string,bigint
+                        escape.delim \
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
       Needs Tagging: false
       Path -> Alias:
-        file:/tmp/njain/hive_2011-11-15_11-54-22_876_2630154306961832139/-mr-10002 [file:/tmp/njain/hive_2011-11-15_11-54-22_876_2630154306961832139/-mr-10002]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2 [null-subquery1-subquery1-subquery1:s-subquery1-subquery1-subquery1:src2]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3 [null-subquery1-subquery1-subquery2:s-subquery1-subquery1-subquery2:src3]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4 [null-subquery1-subquery2:s-subquery1-subquery2:src4]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3 [null-subquery1-subquery1-subquery2:s-subquery1-subquery1-subquery2:src3]
       Path -> Partition:
-        file:/tmp/njain/hive_2011-11-15_11-54-22_876_2630154306961832139/-mr-10002 
-          Partition
-            base file name: -mr-10002
-            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-            properties:
-              columns _col0,_col1
-              columns.types string,bigint
-              escape.delim \
-          
-              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-              properties:
-                columns _col0,_col1
-                columns.types string,bigint
-                escape.delim \
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2 
-          Partition
-            base file name: src2
-            input format: org.apache.hadoop.mapred.TextInputFormat
-            output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-            properties:
-              bucket_count -1
-              columns key,count
-              columns.types string:bigint
-              file.inputformat org.apache.hadoop.mapred.TextInputFormat
-              file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2
-              name default.src2
-              numFiles 1
-              numPartitions 0
-              numRows 309
-              rawDataSize 1482
-              serialization.ddl struct src2 { string key, i64 count}
-              serialization.format 1
-              serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-              totalSize 1791
-              transient_lastDdlTime 1321386849
-            serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-          
-              input format: org.apache.hadoop.mapred.TextInputFormat
-              output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              properties:
-                bucket_count -1
-                columns key,count
-                columns.types string:bigint
-                file.inputformat org.apache.hadoop.mapred.TextInputFormat
-                file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2
-                name default.src2
-                numFiles 1
-                numPartitions 0
-                numRows 309
-                rawDataSize 1482
-                serialization.ddl struct src2 { string key, i64 count}
-                serialization.format 1
-                serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                totalSize 1791
-                transient_lastDdlTime 1321386849
-              serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-              name: default.src2
-            name: default.src2
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3 
           Partition
             base file name: src3
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -390,7 +491,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3
               name default.src3
               numFiles 1
               numPartitions 0
@@ -400,7 +501,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386854
+              transient_lastDdlTime 1323309930
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -411,7 +512,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3
                 name default.src3
                 numFiles 1
                 numPartitions 0
@@ -421,13 +522,52 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386854
+                transient_lastDdlTime 1323309930
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src3
             name: default.src3
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4 
+
+  Stage: Stage-5
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1-subquery1-subquery1:s-subquery1-subquery1-subquery1:src2 
+          TableScan
+            alias: src2
+            GatherStats: false
+            Filter Operator
+              isSamplingPred: false
+              predicate:
+                  expr: (key < 10)
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: key
+                      type: string
+                      expr: count
+                      type: bigint
+                outputColumnNames: _col0, _col1
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-05-41_298_8482350737870409263/-mr-10005
+                  NumFilesPerFileSink: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                      properties:
+                        columns _col0,_col1
+                        columns.types string,bigint
+                        escape.delim \
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
+      Needs Tagging: false
+      Path -> Alias:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2 [null-subquery1-subquery1-subquery1:s-subquery1-subquery1-subquery1:src2]
+      Path -> Partition:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2 
           Partition
-            base file name: src4
+            base file name: src2
             input format: org.apache.hadoop.mapred.TextInputFormat
             output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
             properties:
@@ -436,17 +576,17 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4
-              name default.src4
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2
+              name default.src2
               numFiles 1
               numPartitions 0
               numRows 309
               rawDataSize 1482
-              serialization.ddl struct src4 { string key, i64 count}
+              serialization.ddl struct src2 { string key, i64 count}
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386858
+              transient_lastDdlTime 1323309926
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -457,39 +597,20 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4
-                name default.src4
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2
+                name default.src2
                 numFiles 1
                 numPartitions 0
                 numRows 309
                 rawDataSize 1482
-                serialization.ddl struct src4 { string key, i64 count}
+                serialization.ddl struct src2 { string key, i64 count}
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386858
+                transient_lastDdlTime 1323309926
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-              name: default.src4
-            name: default.src4
-      Reduce Operator Tree:
-        Extract
-          File Output Operator
-            compressed: false
-            GlobalTableId: 0
-            directory: file:/tmp/njain/hive_2011-11-15_11-54-22_876_2630154306961832139/-ext-10001
-            NumFilesPerFileSink: 1
-            Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-11-15_11-54-22_876_2630154306961832139/-ext-10001/
-            table:
-                input format: org.apache.hadoop.mapred.TextInputFormat
-                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                properties:
-                  columns _col0,_col1
-                  columns.types string:bigint
-                  escape.delim \
-                  serialization.format 1
-            TotalFiles: 1
-            GatherStats: false
-            MultiFileSpray: false
+              name: default.src2
+            name: default.src2
 
   Stage: Stage-0
     Fetch Operator
@@ -511,7 +632,7 @@ PREHOOK: Input: default@src2
 PREHOOK: Input: default@src3
 PREHOOK: Input: default@src4
 PREHOOK: Input: default@src5
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-15_11-54-23_140_8208503169307044015/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-05-41_450_3758431232103877540/-mr-10000
 POSTHOOK: query: select s.key, s.count from (
   select key, count from src2  where key < 10
   union all
@@ -527,7 +648,7 @@ POSTHOOK: Input: default@src2
 POSTHOOK: Input: default@src3
 POSTHOOK: Input: default@src4
 POSTHOOK: Input: default@src5
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-15_11-54-23_140_8208503169307044015/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-05-41_450_3758431232103877540/-mr-10000
 0	3
 0	1
 0	3
@@ -541,8 +662,8 @@ POSTHOOK: Output: file:/tmp/njain/hive_2011-11-15_11-54-23_140_82085031693070440
 4	1
 4	1
 5	3
-5	1
 5	3
+5	1
 5	3
 8	1
 8	1
@@ -577,7 +698,9 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1
+  Stage-2 depends on stages: Stage-1, Stage-4, Stage-5
+  Stage-4 is a root stage
+  Stage-5 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -628,10 +751,10 @@ STAGE PLANS:
                       type: bigint
       Needs Tagging: true
       Path -> Alias:
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4 [null-subquery2:s-subquery2:a]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5 [null-subquery2:s-subquery2:b]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4 [null-subquery2:s-subquery2:a]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5 [null-subquery2:s-subquery2:b]
       Path -> Partition:
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4 
           Partition
             base file name: src4
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -642,7 +765,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4
               name default.src4
               numFiles 1
               numPartitions 0
@@ -652,7 +775,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386858
+              transient_lastDdlTime 1323309936
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -663,7 +786,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4
                 name default.src4
                 numFiles 1
                 numPartitions 0
@@ -673,11 +796,11 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386858
+                transient_lastDdlTime 1323309936
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src4
             name: default.src4
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5 
           Partition
             base file name: src5
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -688,7 +811,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5
               name default.src5
               numFiles 1
               numPartitions 0
@@ -698,7 +821,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386862
+              transient_lastDdlTime 1323309941
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -709,7 +832,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5
                 name default.src5
                 numFiles 1
                 numPartitions 0
@@ -719,7 +842,7 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386862
+                transient_lastDdlTime 1323309941
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src5
             name: default.src5
@@ -742,7 +865,7 @@ STAGE PLANS:
             File Output Operator
               compressed: false
               GlobalTableId: 0
-              directory: file:/tmp/njain/hive_2011-11-15_11-54-30_437_6095966146467413825/-mr-10002
+              directory: file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10002
               NumFilesPerFileSink: 1
               table:
                   input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -758,66 +881,146 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-15_11-54-30_437_6095966146467413825/-mr-10002 
-          TableScan
-            GatherStats: false
-            Union
-              Select Operator
-                expressions:
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
+                      type: string
+                sort order: +
+                tag: -1
+                value expressions:
                       expr: _col0
                       type: string
                       expr: _col1
                       type: bigint
-                outputColumnNames: _col0, _col1
-                Reduce Output Operator
-                  key expressions:
-                        expr: _col0
-                        type: string
-                  sort order: +
-                  tag: -1
-                  value expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: bigint
-        null-subquery1-subquery1:s-subquery1-subquery1:src2 
-          TableScan
-            alias: src2
-            GatherStats: false
-            Filter Operator
-              isSamplingPred: false
-              predicate:
-                  expr: (key < 10)
-                  type: boolean
-              Select Operator
-                expressions:
-                      expr: key
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
                       type: string
-                      expr: count
+                sort order: +
+                tag: -1
+                value expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
                       type: bigint
-                outputColumnNames: _col0, _col1
-                Union
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: bigint
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      tag: -1
-                      value expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: bigint
-        null-subquery1-subquery2:s-subquery1-subquery2:src3 
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
+                      type: string
+                sort order: +
+                tag: -1
+                value expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
+                      type: bigint
+      Needs Tagging: false
+      Path -> Alias:
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10002 [file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10002]
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10003 [file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10003]
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10004 [file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10004]
+      Path -> Partition:
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10002 
+          Partition
+            base file name: -mr-10002
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10003 
+          Partition
+            base file name: -mr-10003
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+        file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10004 
+          Partition
+            base file name: -mr-10004
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+      Reduce Operator Tree:
+        Extract
+          File Output Operator
+            compressed: false
+            GlobalTableId: 0
+            directory: file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-ext-10001
+            NumFilesPerFileSink: 1
+            Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-ext-10001/
+            table:
+                input format: org.apache.hadoop.mapred.TextInputFormat
+                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                properties:
+                  columns _col0,_col1
+                  columns.types string:bigint
+                  escape.delim \
+                  serialization.format 1
+            TotalFiles: 1
+            GatherStats: false
+            MultiFileSpray: false
+
+  Stage: Stage-4
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1-subquery1:s-subquery1-subquery1:src2 
           TableScan
-            alias: src3
+            alias: src2
             GatherStats: false
             Filter Operator
               isSamplingPred: false
@@ -831,48 +1034,26 @@ STAGE PLANS:
                       expr: count
                       type: bigint
                 outputColumnNames: _col0, _col1
-                Union
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: bigint
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      tag: -1
-                      value expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: bigint
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10003
+                  NumFilesPerFileSink: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                      properties:
+                        columns _col0,_col1
+                        columns.types string,bigint
+                        escape.delim \
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
       Needs Tagging: false
       Path -> Alias:
-        file:/tmp/njain/hive_2011-11-15_11-54-30_437_6095966146467413825/-mr-10002 [file:/tmp/njain/hive_2011-11-15_11-54-30_437_6095966146467413825/-mr-10002]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2 [null-subquery1-subquery1:s-subquery1-subquery1:src2]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3 [null-subquery1-subquery2:s-subquery1-subquery2:src3]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2 [null-subquery1-subquery1:s-subquery1-subquery1:src2]
       Path -> Partition:
-        file:/tmp/njain/hive_2011-11-15_11-54-30_437_6095966146467413825/-mr-10002 
-          Partition
-            base file name: -mr-10002
-            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-            properties:
-              columns _col0,_col1
-              columns.types string,bigint
-              escape.delim \
-          
-              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-              properties:
-                columns _col0,_col1
-                columns.types string,bigint
-                escape.delim \
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2 
           Partition
             base file name: src2
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -883,7 +1064,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2
               name default.src2
               numFiles 1
               numPartitions 0
@@ -893,7 +1074,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386849
+              transient_lastDdlTime 1323309926
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -904,7 +1085,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2
                 name default.src2
                 numFiles 1
                 numPartitions 0
@@ -914,11 +1095,50 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386849
+                transient_lastDdlTime 1323309926
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src2
             name: default.src2
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3 
+
+  Stage: Stage-5
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1-subquery2:s-subquery1-subquery2:src3 
+          TableScan
+            alias: src3
+            GatherStats: false
+            Filter Operator
+              isSamplingPred: false
+              predicate:
+                  expr: (key < 10)
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: key
+                      type: string
+                      expr: count
+                      type: bigint
+                outputColumnNames: _col0, _col1
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-05-57_369_5480373477963759883/-mr-10004
+                  NumFilesPerFileSink: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                      properties:
+                        columns _col0,_col1
+                        columns.types string,bigint
+                        escape.delim \
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
+      Needs Tagging: false
+      Path -> Alias:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3 [null-subquery1-subquery2:s-subquery1-subquery2:src3]
+      Path -> Partition:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3 
           Partition
             base file name: src3
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -929,7 +1149,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3
               name default.src3
               numFiles 1
               numPartitions 0
@@ -939,7 +1159,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386854
+              transient_lastDdlTime 1323309930
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -950,7 +1170,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3
                 name default.src3
                 numFiles 1
                 numPartitions 0
@@ -960,29 +1180,10 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386854
+                transient_lastDdlTime 1323309930
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src3
             name: default.src3
-      Reduce Operator Tree:
-        Extract
-          File Output Operator
-            compressed: false
-            GlobalTableId: 0
-            directory: file:/tmp/njain/hive_2011-11-15_11-54-30_437_6095966146467413825/-ext-10001
-            NumFilesPerFileSink: 1
-            Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-11-15_11-54-30_437_6095966146467413825/-ext-10001/
-            table:
-                input format: org.apache.hadoop.mapred.TextInputFormat
-                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                properties:
-                  columns _col0,_col1
-                  columns.types string:bigint
-                  escape.delim \
-                  serialization.format 1
-            TotalFiles: 1
-            GatherStats: false
-            MultiFileSpray: false
 
   Stage: Stage-0
     Fetch Operator
@@ -1002,7 +1203,7 @@ PREHOOK: Input: default@src2
 PREHOOK: Input: default@src3
 PREHOOK: Input: default@src4
 PREHOOK: Input: default@src5
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-15_11-54-30_664_3264922141339790749/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-05-57_532_8796691937141834686/-mr-10000
 POSTHOOK: query: select s.key, s.count from (
   select key, count from src2  where key < 10
   union all
@@ -1016,7 +1217,7 @@ POSTHOOK: Input: default@src2
 POSTHOOK: Input: default@src3
 POSTHOOK: Input: default@src4
 POSTHOOK: Input: default@src5
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-15_11-54-30_664_3264922141339790749/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-05-57_532_8796691937141834686/-mr-10000
 0	3
 0	3
 0	3
@@ -1061,7 +1262,9 @@ ABSTRACT SYNTAX TREE:
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
   Stage-2 depends on stages: Stage-1
-  Stage-3 depends on stages: Stage-2
+  Stage-3 depends on stages: Stage-2, Stage-5, Stage-6
+  Stage-5 is a root stage
+  Stage-6 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -1109,10 +1312,10 @@ STAGE PLANS:
                 tag: 1
       Needs Tagging: true
       Path -> Alias:
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4 [null-subquery2:s-subquery2:a]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5 [null-subquery2:s-subquery2:b]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4 [null-subquery2:s-subquery2:a]
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5 [null-subquery2:s-subquery2:b]
       Path -> Partition:
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4 
           Partition
             base file name: src4
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -1123,7 +1326,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4
               name default.src4
               numFiles 1
               numPartitions 0
@@ -1133,7 +1336,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386858
+              transient_lastDdlTime 1323309936
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -1144,7 +1347,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src4
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src4
                 name default.src4
                 numFiles 1
                 numPartitions 0
@@ -1154,11 +1357,11 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386858
+                transient_lastDdlTime 1323309936
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src4
             name: default.src4
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5 
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5 
           Partition
             base file name: src5
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -1169,7 +1372,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5
               name default.src5
               numFiles 1
               numPartitions 0
@@ -1179,7 +1382,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386862
+              transient_lastDdlTime 1323309941
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -1190,7 +1393,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src5
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src5
                 name default.src5
                 numFiles 1
                 numPartitions 0
@@ -1200,7 +1403,7 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386862
+                transient_lastDdlTime 1323309941
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src5
             name: default.src5
@@ -1230,7 +1433,7 @@ STAGE PLANS:
               File Output Operator
                 compressed: false
                 GlobalTableId: 0
-                directory: file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10002
+                directory: file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10002
                 NumFilesPerFileSink: 1
                 table:
                     input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -1246,7 +1449,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10002 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -1261,9 +1464,9 @@ STAGE PLANS:
                     type: bigint
       Needs Tagging: false
       Path -> Alias:
-        file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10002 [file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10002]
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10002 [file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10002]
       Path -> Partition:
-        file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10002 
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10002 
           Partition
             base file name: -mr-10002
             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -1299,7 +1502,7 @@ STAGE PLANS:
             File Output Operator
               compressed: false
               GlobalTableId: 0
-              directory: file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10003
+              directory: file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10003
               NumFilesPerFileSink: 1
               table:
                   input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -1315,105 +1518,73 @@ STAGE PLANS:
   Stage: Stage-3
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10003 
-          TableScan
-            GatherStats: false
-            Union
-              Select Operator
-                expressions:
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
+                      type: string
+                sort order: +
+                tag: -1
+                value expressions:
                       expr: _col0
                       type: string
                       expr: _col1
                       type: bigint
-                outputColumnNames: _col0, _col1
-                Reduce Output Operator
-                  key expressions:
-                        expr: _col0
-                        type: string
-                  sort order: +
-                  tag: -1
-                  value expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: bigint
-        null-subquery1-subquery1:s-subquery1-subquery1:src2 
-          TableScan
-            alias: src2
-            GatherStats: false
-            Filter Operator
-              isSamplingPred: false
-              predicate:
-                  expr: (key < 10)
-                  type: boolean
-              Select Operator
-                expressions:
-                      expr: key
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
                       type: string
-                      expr: count
+                sort order: +
+                tag: -1
+                value expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
                       type: bigint
-                outputColumnNames: _col0, _col1
-                Union
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: bigint
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      tag: -1
-                      value expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: bigint
-        null-subquery1-subquery2:s-subquery1-subquery2:src3 
-          TableScan
-            alias: src3
-            GatherStats: false
-            Filter Operator
-              isSamplingPred: false
-              predicate:
-                  expr: (key < 10)
-                  type: boolean
-              Select Operator
-                expressions:
-                      expr: key
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10005 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
+              Reduce Output Operator
+                key expressions:
+                      expr: _col0
                       type: string
-                      expr: count
+                sort order: +
+                tag: -1
+                value expressions:
+                      expr: _col0
+                      type: string
+                      expr: _col1
                       type: bigint
-                outputColumnNames: _col0, _col1
-                Union
-                  Select Operator
-                    expressions:
-                          expr: _col0
-                          type: string
-                          expr: _col1
-                          type: bigint
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      tag: -1
-                      value expressions:
-                            expr: _col0
-                            type: string
-                            expr: _col1
-                            type: bigint
       Needs Tagging: false
       Path -> Alias:
-        file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10003 [file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10003]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2 [null-subquery1-subquery1:s-subquery1-subquery1:src2]
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3 [null-subquery1-subquery2:s-subquery1-subquery2:src3]
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10003 [file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10003]
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10004 [file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10004]
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10005 [file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10005]
       Path -> Partition:
-        file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-mr-10003 
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10003 
           Partition
             base file name: -mr-10003
             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
@@ -1429,7 +1600,97 @@ STAGE PLANS:
                 columns _col0,_col1
                 columns.types string,bigint
                 escape.delim \
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2 
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10004 
+          Partition
+            base file name: -mr-10004
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+        file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10005 
+          Partition
+            base file name: -mr-10005
+            input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+            output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+            properties:
+              columns _col0,_col1
+              columns.types string,bigint
+              escape.delim \
+          
+              input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+              output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+              properties:
+                columns _col0,_col1
+                columns.types string,bigint
+                escape.delim \
+      Reduce Operator Tree:
+        Extract
+          File Output Operator
+            compressed: false
+            GlobalTableId: 0
+            directory: file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-ext-10001
+            NumFilesPerFileSink: 1
+            Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-ext-10001/
+            table:
+                input format: org.apache.hadoop.mapred.TextInputFormat
+                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                properties:
+                  columns _col0,_col1
+                  columns.types string:bigint
+                  escape.delim \
+                  serialization.format 1
+            TotalFiles: 1
+            GatherStats: false
+            MultiFileSpray: false
+
+  Stage: Stage-5
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1-subquery1:s-subquery1-subquery1:src2 
+          TableScan
+            alias: src2
+            GatherStats: false
+            Filter Operator
+              isSamplingPred: false
+              predicate:
+                  expr: (key < 10)
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: key
+                      type: string
+                      expr: count
+                      type: bigint
+                outputColumnNames: _col0, _col1
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10004
+                  NumFilesPerFileSink: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                      properties:
+                        columns _col0,_col1
+                        columns.types string,bigint
+                        escape.delim \
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
+      Needs Tagging: false
+      Path -> Alias:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2 [null-subquery1-subquery1:s-subquery1-subquery1:src2]
+      Path -> Partition:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2 
           Partition
             base file name: src2
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -1440,7 +1701,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2
               name default.src2
               numFiles 1
               numPartitions 0
@@ -1450,7 +1711,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386849
+              transient_lastDdlTime 1323309926
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -1461,7 +1722,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src2
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src2
                 name default.src2
                 numFiles 1
                 numPartitions 0
@@ -1471,11 +1732,50 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386849
+                transient_lastDdlTime 1323309926
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src2
             name: default.src2
-        pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3 
+
+  Stage: Stage-6
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1-subquery2:s-subquery1-subquery2:src3 
+          TableScan
+            alias: src3
+            GatherStats: false
+            Filter Operator
+              isSamplingPred: false
+              predicate:
+                  expr: (key < 10)
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: key
+                      type: string
+                      expr: count
+                      type: bigint
+                outputColumnNames: _col0, _col1
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 0
+                  directory: file:/tmp/njain/hive_2011-12-07_18-06-10_646_288553186490152714/-mr-10005
+                  NumFilesPerFileSink: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                      properties:
+                        columns _col0,_col1
+                        columns.types string,bigint
+                        escape.delim \
+                  TotalFiles: 1
+                  GatherStats: false
+                  MultiFileSpray: false
+      Needs Tagging: false
+      Path -> Alias:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3 [null-subquery1-subquery2:s-subquery1-subquery2:src3]
+      Path -> Partition:
+        pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3 
           Partition
             base file name: src3
             input format: org.apache.hadoop.mapred.TextInputFormat
@@ -1486,7 +1786,7 @@ STAGE PLANS:
               columns.types string:bigint
               file.inputformat org.apache.hadoop.mapred.TextInputFormat
               file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-              location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3
+              location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3
               name default.src3
               numFiles 1
               numPartitions 0
@@ -1496,7 +1796,7 @@ STAGE PLANS:
               serialization.format 1
               serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               totalSize 1791
-              transient_lastDdlTime 1321386854
+              transient_lastDdlTime 1323309930
             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -1507,7 +1807,7 @@ STAGE PLANS:
                 columns.types string:bigint
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location pfile:/data/users/njain/hive_commit1/build/ql/test/data/warehouse/src3
+                location pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/src3
                 name default.src3
                 numFiles 1
                 numPartitions 0
@@ -1517,29 +1817,10 @@ STAGE PLANS:
                 serialization.format 1
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 totalSize 1791
-                transient_lastDdlTime 1321386854
+                transient_lastDdlTime 1323309930
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: default.src3
             name: default.src3
-      Reduce Operator Tree:
-        Extract
-          File Output Operator
-            compressed: false
-            GlobalTableId: 0
-            directory: file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-ext-10001
-            NumFilesPerFileSink: 1
-            Stats Publishing Key Prefix: file:/tmp/njain/hive_2011-11-15_11-54-37_874_388798219643163647/-ext-10001/
-            table:
-                input format: org.apache.hadoop.mapred.TextInputFormat
-                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                properties:
-                  columns _col0,_col1
-                  columns.types string:bigint
-                  escape.delim \
-                  serialization.format 1
-            TotalFiles: 1
-            GatherStats: false
-            MultiFileSpray: false
 
   Stage: Stage-0
     Fetch Operator
@@ -1559,7 +1840,7 @@ PREHOOK: Input: default@src2
 PREHOOK: Input: default@src3
 PREHOOK: Input: default@src4
 PREHOOK: Input: default@src5
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-15_11-54-38_100_4701705389919381994/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-06-10_797_9067066248849265470/-mr-10000
 POSTHOOK: query: select s.key, s.count from (
   select key, count from src2  where key < 10
   union all
@@ -1573,7 +1854,7 @@ POSTHOOK: Input: default@src2
 POSTHOOK: Input: default@src3
 POSTHOOK: Input: default@src4
 POSTHOOK: Input: default@src5
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-15_11-54-38_100_4701705389919381994/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-06-10_797_9067066248849265470/-mr-10000
 0	1
 0	3
 0	3
@@ -1583,8 +1864,8 @@ POSTHOOK: Output: file:/tmp/njain/hive_2011-11-15_11-54-38_100_47017053899193819
 4	1
 4	1
 4	1
-5	1
 5	3
+5	1
 5	3
 8	1
 8	1
diff --git a/ql/src/test/results/clientpositive/union25.q.out b/ql/src/test/results/clientpositive/union25.q.out
new file mode 100644
index 0000000000..d1860efbea
--- /dev/null
+++ b/ql/src/test/results/clientpositive/union25.q.out
@@ -0,0 +1,330 @@
+PREHOOK: query: create table tmp_srcpart like srcpart
+PREHOOK: type: CREATETABLE
+POSTHOOK: query: create table tmp_srcpart like srcpart
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: default@tmp_srcpart
+PREHOOK: query: insert overwrite table tmp_srcpart partition (ds='2008-04-08', hr='11')
+select key, value from srcpart where ds='2008-04-08' and hr='11'
+PREHOOK: type: QUERY
+PREHOOK: Input: default@srcpart@ds=2008-04-08/hr=11
+PREHOOK: Output: default@tmp_srcpart@ds=2008-04-08/hr=11
+POSTHOOK: query: insert overwrite table tmp_srcpart partition (ds='2008-04-08', hr='11')
+select key, value from srcpart where ds='2008-04-08' and hr='11'
+POSTHOOK: type: QUERY
+POSTHOOK: Input: default@srcpart@ds=2008-04-08/hr=11
+POSTHOOK: Output: default@tmp_srcpart@ds=2008-04-08/hr=11
+POSTHOOK: Lineage: tmp_srcpart PARTITION(ds=2008-04-08,hr=11).key SIMPLE [(srcpart)srcpart.FieldSchema(name:key, type:string, comment:default), ]
+POSTHOOK: Lineage: tmp_srcpart PARTITION(ds=2008-04-08,hr=11).value SIMPLE [(srcpart)srcpart.FieldSchema(name:value, type:string, comment:default), ]
+PREHOOK: query: explain
+create table tmp_unionall as
+SELECT count(1) as counts, key, value
+FROM
+(
+  SELECT key, value FROM srcpart a WHERE a.ds='2008-04-08' and a.hr='11'
+
+    UNION ALL
+
+  SELECT key, key as value FROM (
+    SELECT distinct key FROM (
+      SELECT key, value FROM tmp_srcpart a WHERE a.ds='2008-04-08' and a.hr='11'
+        UNION ALL
+      SELECT key, value FROM tmp_srcpart b WHERE b.ds='2008-04-08' and b.hr='11'
+    )t
+  ) master_table
+) a GROUP BY key, value
+PREHOOK: type: CREATETABLE_AS_SELECT
+POSTHOOK: query: explain
+create table tmp_unionall as
+SELECT count(1) as counts, key, value
+FROM
+(
+  SELECT key, value FROM srcpart a WHERE a.ds='2008-04-08' and a.hr='11'
+
+    UNION ALL
+
+  SELECT key, key as value FROM (
+    SELECT distinct key FROM (
+      SELECT key, value FROM tmp_srcpart a WHERE a.ds='2008-04-08' and a.hr='11'
+        UNION ALL
+      SELECT key, value FROM tmp_srcpart b WHERE b.ds='2008-04-08' and b.hr='11'
+    )t
+  ) master_table
+) a GROUP BY key, value
+POSTHOOK: type: CREATETABLE_AS_SELECT
+POSTHOOK: Lineage: tmp_srcpart PARTITION(ds=2008-04-08,hr=11).key SIMPLE [(srcpart)srcpart.FieldSchema(name:key, type:string, comment:default), ]
+POSTHOOK: Lineage: tmp_srcpart PARTITION(ds=2008-04-08,hr=11).value SIMPLE [(srcpart)srcpart.FieldSchema(name:value, type:string, comment:default), ]
+ABSTRACT SYNTAX TREE:
+  (TOK_CREATETABLE (TOK_TABNAME tmp_unionall) TOK_LIKETABLE (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME srcpart) a)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_WHERE (and (= (. (TOK_TABLE_OR_COL a) ds) '2008-04-08') (= (. (TOK_TABLE_OR_COL a) hr) '11'))))) (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME tmp_srcpart) a)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_WHERE (and (= (. (TOK_TABLE_OR_COL a) ds) '2008-04-08') (= (. (TOK_TABLE_OR_COL a) hr) '11'))))) (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME tmp_srcpart) b)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_WHERE (and (= (. (TOK_TABLE_OR_COL b) ds) '2008-04-08') (= (. (TOK_TABLE_OR_COL b) hr) '11')))))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECTDI (TOK_SELEXPR (TOK_TABLE_OR_COL key))))) master_table)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL key) value))))) a)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION count 1) counts) (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_GROUPBY (TOK_TABLE_OR_COL key) (TOK_TABLE_OR_COL value)))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-2 depends on stages: Stage-1, Stage-5
+  Stage-3 depends on stages: Stage-2, Stage-6
+  Stage-0 depends on stages: Stage-3
+  Stage-7 depends on stages: Stage-0
+  Stage-4 depends on stages: Stage-7
+  Stage-5 is a root stage
+  Stage-6 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:a-subquery2:master_table-subquery1:t-subquery1:a 
+          TableScan
+            alias: a
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
+  Stage: Stage-2
+    Map Reduce
+      Alias -> Map Operator Tree:
+        file:/tmp/njain/hive_2011-12-07_21-55-17_940_6667012806736485678/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                mode: hash
+                outputColumnNames: _col0
+                Reduce Output Operator
+                  key expressions:
+                        expr: _col0
+                        type: string
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+        file:/tmp/njain/hive_2011-12-07_21-55-17_940_6667012806736485678/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                mode: hash
+                outputColumnNames: _col0
+                Reduce Output Operator
+                  key expressions:
+                        expr: _col0
+                        type: string
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+      Reduce Operator Tree:
+        Group By Operator
+          bucketGroup: false
+          keys:
+                expr: KEY._col0
+                type: string
+          mode: mergepartial
+          outputColumnNames: _col0
+          Select Operator
+            expressions:
+                  expr: _col0
+                  type: string
+            outputColumnNames: _col0
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        file:/tmp/njain/hive_2011-12-07_21-55-17_940_6667012806736485678/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                      expr: _col1
+                      type: string
+                mode: hash
+                outputColumnNames: _col0, _col1, _col2
+                Reduce Output Operator
+                  key expressions:
+                        expr: _col0
+                        type: string
+                        expr: _col1
+                        type: string
+                  sort order: ++
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                        expr: _col1
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col2
+                        type: bigint
+        file:/tmp/njain/hive_2011-12-07_21-55-17_940_6667012806736485678/-mr-10005 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                      expr: _col1
+                      type: string
+                mode: hash
+                outputColumnNames: _col0, _col1, _col2
+                Reduce Output Operator
+                  key expressions:
+                        expr: _col0
+                        type: string
+                        expr: _col1
+                        type: string
+                  sort order: ++
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                        expr: _col1
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col2
+                        type: bigint
+      Reduce Operator Tree:
+        Group By Operator
+          aggregations:
+                expr: count(VALUE._col0)
+          bucketGroup: false
+          keys:
+                expr: KEY._col0
+                type: string
+                expr: KEY._col1
+                type: string
+          mode: mergepartial
+          outputColumnNames: _col0, _col1, _col2
+          Select Operator
+            expressions:
+                  expr: _col2
+                  type: bigint
+                  expr: _col0
+                  type: string
+                  expr: _col1
+                  type: string
+            outputColumnNames: _col0, _col1, _col2
+            File Output Operator
+              compressed: false
+              GlobalTableId: 1
+              table:
+                  input format: org.apache.hadoop.mapred.TextInputFormat
+                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                  name: default.tmp_unionall
+
+  Stage: Stage-0
+    Move Operator
+      files:
+          hdfs directory: true
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/test/data/warehouse/tmp_unionall
+
+  Stage: Stage-7
+      Create Table Operator:
+        Create Table
+          columns: counts bigint, key string, value string
+          if not exists: false
+          input format: org.apache.hadoop.mapred.TextInputFormat
+          # buckets: -1
+          output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+          name: tmp_unionall
+          isExternal: false
+
+  Stage: Stage-4
+    Stats-Aggr Operator
+
+  Stage: Stage-5
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:a-subquery2:master_table-subquery2:t-subquery2:b 
+          TableScan
+            alias: b
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
+  Stage: Stage-6
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery1:a-subquery1:a 
+          TableScan
+            alias: a
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
+
diff --git a/ql/src/test/results/clientpositive/union3.q.out b/ql/src/test/results/clientpositive/union3.q.out
index 8a6290c10e..f930511bcb 100644
--- a/ql/src/test/results/clientpositive/union3.q.out
+++ b/ql/src/test/results/clientpositive/union3.q.out
@@ -88,62 +88,58 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-00_814_2332491237056487962/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: int
-                outputColumnNames: _col0
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-00_814_2332491237056487962/-mr-10003 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: int
-                outputColumnNames: _col0
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-00_814_2332491237056487962/-mr-10005 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: int
-                outputColumnNames: _col0
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-00_814_2332491237056487962/-mr-10007 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: int
-                outputColumnNames: _col0
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_18-06-27_327_8112398566049944010/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: int
+              outputColumnNames: _col0
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_18-06-27_327_8112398566049944010/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: int
+              outputColumnNames: _col0
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_18-06-27_327_8112398566049944010/-mr-10005 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: int
+              outputColumnNames: _col0
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+        file:/tmp/njain/hive_2011-12-07_18-06-27_327_8112398566049944010/-mr-10007 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: int
+              outputColumnNames: _col0
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
 
   Stage: Stage-3
     Map Reduce
@@ -222,7 +218,7 @@ STAGE PLANS:
   Stage: Stage-5
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-00_814_2332491237056487962/-mr-10004 
+        file:/tmp/njain/hive_2011-12-07_18-06-27_327_8112398566049944010/-mr-10004 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -284,7 +280,7 @@ STAGE PLANS:
   Stage: Stage-7
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-00_814_2332491237056487962/-mr-10006 
+        file:/tmp/njain/hive_2011-12-07_18-06-27_327_8112398566049944010/-mr-10006 
             Reduce Output Operator
               key expressions:
                     expr: _col0
@@ -360,11 +356,11 @@ POSTHOOK: Lineage: union_out.id EXPRESSION []
 PREHOOK: query: select * from union_out cluster by id
 PREHOOK: type: QUERY
 PREHOOK: Input: default@union_out
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-46_186_6136409345520993079/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-06-50_528_7611594880529632821/-mr-10000
 POSTHOOK: query: select * from union_out cluster by id
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@union_out
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-46_186_6136409345520993079/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-06-50_528_7611594880529632821/-mr-10000
 POSTHOOK: Lineage: union_out.id EXPRESSION []
 1
 2
diff --git a/ql/src/test/results/clientpositive/union4.q.out b/ql/src/test/results/clientpositive/union4.q.out
index d1b27fd770..e7e7440d58 100644
--- a/ql/src/test/results/clientpositive/union4.q.out
+++ b/ql/src/test/results/clientpositive/union4.q.out
@@ -78,56 +78,54 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-52_260_5365042429041412127/-mr-10002 
-          TableScan
-            Union
+        file:/tmp/njain/hive_2011-12-07_18-06-54_111_4763380826792190180/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: bigint
+                      expr: UDFToInteger(_col1)
+                      type: int
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: UDFToInteger(_col1)
-                        type: int
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-01-52_260_5365042429041412127/-mr-10004 
-          TableScan
-            Union
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.tmptable
+        file:/tmp/njain/hive_2011-12-07_18-06-54_111_4763380826792190180/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: bigint
+              outputColumnNames: _col0, _col1
               Select Operator
                 expressions:
                       expr: _col0
                       type: string
-                      expr: _col1
-                      type: bigint
+                      expr: UDFToInteger(_col1)
+                      type: int
                 outputColumnNames: _col0, _col1
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: UDFToInteger(_col1)
-                        type: int
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
+                File Output Operator
+                  compressed: false
+                  GlobalTableId: 1
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                      name: default.tmptable
 
   Stage: Stage-6
     Conditional Operator
@@ -136,7 +134,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_11-01-52_260_5365042429041412127/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-06-54_111_4763380826792190180/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -154,7 +152,7 @@ STAGE PLANS:
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/Users/njain/hive/hive2/build/ql/scratchdir/hive_2011-11-11_11-01-52_260_5365042429041412127/-ext-10003 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-06-54_111_4763380826792190180/-ext-10003 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -224,11 +222,11 @@ POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src)s2.null, ]
 PREHOOK: query: select * from tmptable x sort by x.key
 PREHOOK: type: QUERY
 PREHOOK: Input: default@tmptable
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-02-16_767_4088903352518752387/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-07-05_101_8536540235066063542/-mr-10000
 POSTHOOK: query: select * from tmptable x sort by x.key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@tmptable
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-02-16_767_4088903352518752387/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-07-05_101_8536540235066063542/-mr-10000
 POSTHOOK: Lineage: tmptable.key EXPRESSION []
 POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src)s2.null, ]
 tst1	500
diff --git a/ql/src/test/results/clientpositive/union5.q.out b/ql/src/test/results/clientpositive/union5.q.out
index 509d8eabee..52b97f322d 100644
--- a/ql/src/test/results/clientpositive/union5.q.out
+++ b/ql/src/test/results/clientpositive/union5.q.out
@@ -65,64 +65,62 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-02-22_497_2122916937878156980/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
+        file:/tmp/njain/hive_2011-12-07_18-07-08_546_7153871456146014378/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
                       expr: _col0
                       type: string
-                outputColumnNames: _col0
-                Group By Operator
-                  aggregations:
-                        expr: count(1)
-                  bucketGroup: false
-                  keys:
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
-        file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-02-22_497_2122916937878156980/-mr-10003 
-          TableScan
-            Union
-              Select Operator
-                expressions:
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-07-08_546_7153871456146014378/-mr-10003 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
                       expr: _col0
                       type: string
-                outputColumnNames: _col0
-                Group By Operator
-                  aggregations:
-                        expr: count(1)
-                  bucketGroup: false
-                  keys:
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
+                        expr: _col0
+                        type: string
+                  sort order: +
+                  Map-reduce partition columns:
                         expr: _col0
                         type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
@@ -197,12 +195,12 @@ PREHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, count(
                                     select 'tst2' as key, count(1) as value from src s2) unionsrc group by unionsrc.key
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
-PREHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-02-22_619_2544238133674437727/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-07-08_654_7430436781326432428/-mr-10000
 POSTHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, count(1) as value from src s1
                                   UNION  ALL  
                                     select 'tst2' as key, count(1) as value from src s2) unionsrc group by unionsrc.key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@src
-POSTHOOK: Output: file:/var/folders/bZ/bZe+iKfoFTuPoShRd6dy6-tOU9Y/-Tmp-/njain/hive_2011-11-11_11-02-22_619_2544238133674437727/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-07-08_654_7430436781326432428/-mr-10000
 tst1	1
 tst2	1
diff --git a/ql/src/test/results/clientpositive/union6.q.out b/ql/src/test/results/clientpositive/union6.q.out
index 74a1453074..49f571d0b1 100644
--- a/ql/src/test/results/clientpositive/union6.q.out
+++ b/ql/src/test/results/clientpositive/union6.q.out
@@ -26,12 +26,13 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1
+  Stage-2 depends on stages: Stage-1, Stage-7
   Stage-6 depends on stages: Stage-2 , consists of Stage-5, Stage-4
   Stage-5
   Stage-0 depends on stages: Stage-5, Stage-4
   Stage-3 depends on stages: Stage-0
   Stage-4
+  Stage-7 is a root stage
 
 STAGE PLANS:
   Stage: Stage-1
@@ -77,50 +78,40 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-47-53_815_8491202798848345222/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
-                      expr: _col0
-                      type: string
-                      expr: _col1
-                      type: string
-                outputColumnNames: _col0, _col1
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 1
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                      name: default.tmptable
-        null-subquery2:unionsrc-subquery2:s2 
-          TableScan
-            alias: s2
+        file:/tmp/njain/hive_2011-12-07_18-07-18_649_6188665420662165573/-mr-10002 
+          Union
             Select Operator
               expressions:
-                    expr: key
+                    expr: _col0
                     type: string
-                    expr: value
+                    expr: _col1
                     type: string
               outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
-                        expr: _col0
-                        type: string
-                        expr: _col1
-                        type: string
-                  outputColumnNames: _col0, _col1
-                  File Output Operator
-                    compressed: false
-                    GlobalTableId: 1
-                    table:
-                        input format: org.apache.hadoop.mapred.TextInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-                        name: default.tmptable
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.tmptable
+        file:/tmp/njain/hive_2011-12-07_18-07-18_649_6188665420662165573/-mr-10004 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+                    expr: _col1
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 1
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                    name: default.tmptable
 
   Stage: Stage-6
     Conditional Operator
@@ -129,7 +120,7 @@ STAGE PLANS:
     Move Operator
       files:
           hdfs directory: true
-          destination: pfile:/data/users/njain/hive_commit1/build/ql/scratchdir/hive_2011-11-11_18-47-53_815_8491202798848345222/-ext-10000
+          destination: pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-07-18_649_6188665420662165573/-ext-10000
 
   Stage: Stage-0
     Move Operator
@@ -147,7 +138,7 @@ STAGE PLANS:
   Stage: Stage-4
     Map Reduce
       Alias -> Map Operator Tree:
-        pfile:/data/users/njain/hive_commit1/build/ql/scratchdir/hive_2011-11-11_18-47-53_815_8491202798848345222/-ext-10003 
+        pfile:/data/users/njain/hive_commit2/build/ql/scratchdir/hive_2011-12-07_18-07-18_649_6188665420662165573/-ext-10003 
             File Output Operator
               compressed: false
               GlobalTableId: 0
@@ -157,6 +148,26 @@ STAGE PLANS:
                   serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                   name: default.tmptable
 
+  Stage: Stage-7
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+          TableScan
+            alias: s2
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
 
 PREHOOK: query: insert overwrite table tmptable
 select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
@@ -179,11 +190,11 @@ POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src1)s2.FieldSchema
 PREHOOK: query: select * from tmptable x sort by x.key, x.value
 PREHOOK: type: QUERY
 PREHOOK: Input: default@tmptable
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-48-05_864_4380576443171262357/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-07-29_549_8546727158614468431/-mr-10000
 POSTHOOK: query: select * from tmptable x sort by x.key, x.value
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@tmptable
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-48-05_864_4380576443171262357/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-07-29_549_8546727158614468431/-mr-10000
 POSTHOOK: Lineage: tmptable.key EXPRESSION [(src1)s2.FieldSchema(name:key, type:string, comment:default), ]
 POSTHOOK: Lineage: tmptable.value EXPRESSION [(src)s1.null, (src1)s2.FieldSchema(name:value, type:string, comment:default), ]
 	
diff --git a/ql/src/test/results/clientpositive/union7.q.out b/ql/src/test/results/clientpositive/union7.q.out
index 2aaa38ccbe..9d1655f47f 100644
--- a/ql/src/test/results/clientpositive/union7.q.out
+++ b/ql/src/test/results/clientpositive/union7.q.out
@@ -17,7 +17,8 @@ ABSTRACT SYNTAX TREE:
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
-  Stage-2 depends on stages: Stage-1
+  Stage-2 depends on stages: Stage-1, Stage-3
+  Stage-3 is a root stage
   Stage-0 is a root stage
 
 STAGE PLANS:
@@ -64,72 +65,62 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        file:/tmp/njain/hive_2011-11-11_18-48-09_210_8425017124003834085/-mr-10002 
-          TableScan
-            Union
-              Select Operator
-                expressions:
+        file:/tmp/njain/hive_2011-12-07_18-07-33_035_4576758490513690269/-mr-10002 
+          Union
+            Select Operator
+              expressions:
+                    expr: _col0
+                    type: string
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
                       expr: _col0
                       type: string
-                outputColumnNames: _col0
-                Group By Operator
-                  aggregations:
-                        expr: count(1)
-                  bucketGroup: false
-                  keys:
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  mode: hash
-                  outputColumnNames: _col0, _col1
-                  Reduce Output Operator
-                    key expressions:
-                          expr: _col0
-                          type: string
-                    sort order: +
-                    Map-reduce partition columns:
-                          expr: _col0
-                          type: string
-                    tag: -1
-                    value expressions:
-                          expr: _col1
-                          type: bigint
-        null-subquery2:unionsrc-subquery2:s2 
-          TableScan
-            alias: s2
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
+        file:/tmp/njain/hive_2011-12-07_18-07-33_035_4576758490513690269/-mr-10003 
+          Union
             Select Operator
               expressions:
-                    expr: key
-                    type: string
-                    expr: value
+                    expr: _col0
                     type: string
-              outputColumnNames: _col0, _col1
-              Union
-                Select Operator
-                  expressions:
+              outputColumnNames: _col0
+              Group By Operator
+                aggregations:
+                      expr: count(1)
+                bucketGroup: false
+                keys:
+                      expr: _col0
+                      type: string
+                mode: hash
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions:
                         expr: _col0
                         type: string
-                  outputColumnNames: _col0
-                  Group By Operator
-                    aggregations:
-                          expr: count(1)
-                    bucketGroup: false
-                    keys:
-                          expr: _col0
-                          type: string
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Reduce Output Operator
-                      key expressions:
-                            expr: _col0
-                            type: string
-                      sort order: +
-                      Map-reduce partition columns:
-                            expr: _col0
-                            type: string
-                      tag: -1
-                      value expressions:
-                            expr: _col1
-                            type: bigint
+                  sort order: +
+                  Map-reduce partition columns:
+                        expr: _col0
+                        type: string
+                  tag: -1
+                  value expressions:
+                        expr: _col1
+                        type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
@@ -154,6 +145,26 @@ STAGE PLANS:
                   input format: org.apache.hadoop.mapred.TextInputFormat
                   output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
 
+  Stage: Stage-3
+    Map Reduce
+      Alias -> Map Operator Tree:
+        null-subquery2:unionsrc-subquery2:s2 
+          TableScan
+            alias: s2
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+                    expr: value
+                    type: string
+              outputColumnNames: _col0, _col1
+              File Output Operator
+                compressed: false
+                GlobalTableId: 0
+                table:
+                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+
   Stage: Stage-0
     Fetch Operator
       limit: -1
@@ -165,14 +176,14 @@ PREHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, cast(c
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
 PREHOOK: Input: default@src1
-PREHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-48-09_302_258460663317337490/-mr-10000
+PREHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-07-33_143_6816788992095596437/-mr-10000
 POSTHOOK: query: select unionsrc.key, count(1) FROM (select 'tst1' as key, cast(count(1) as string) as value from src s1
                                       UNION  ALL  
                                     select s2.key as key, s2.value as value from src1 s2) unionsrc group by unionsrc.key
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@src
 POSTHOOK: Input: default@src1
-POSTHOOK: Output: file:/tmp/njain/hive_2011-11-11_18-48-09_302_258460663317337490/-mr-10000
+POSTHOOK: Output: file:/tmp/njain/hive_2011-12-07_18-07-33_143_6816788992095596437/-mr-10000
 	10
 128	1
 146	1
