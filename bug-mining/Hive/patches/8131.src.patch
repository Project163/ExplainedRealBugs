diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/reloperators/HiveJoin.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/reloperators/HiveJoin.java
index 16f1a5c411..7ad458e758 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/reloperators/HiveJoin.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/reloperators/HiveJoin.java
@@ -202,11 +202,13 @@ public ImmutableBitSet getSortedInputs() throws CalciteSemanticException {
 
     final RelMetadataQuery mq = this.left.getCluster().getMetadataQuery();
     for (int i=0; i<this.getInputs().size(); i++) {
-      boolean correctOrderFound = RelCollations.contains(
-          mq.collations(this.getInputs().get(i)),
-          joinKeysInChildren.get(i));
-      if (correctOrderFound) {
-        sortedInputsBuilder.set(i);
+      List<RelCollation> collations = mq.collations(this.getInputs().get(i));
+      if (collations != null) {
+        boolean correctOrderFound = RelCollations.contains(
+            collations, joinKeysInChildren.get(i));
+        if (correctOrderFound) {
+          sortedInputsBuilder.set(i);
+        }
       }
     }
     return sortedInputsBuilder.build();
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/RelFieldTrimmer.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/RelFieldTrimmer.java
index 46fd47c7d4..adc090c19f 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/RelFieldTrimmer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/RelFieldTrimmer.java
@@ -190,12 +190,13 @@ protected TrimResult trimChild(
     // Fields that define the collation cannot be discarded.
     final RelMetadataQuery mq = rel.getCluster().getMetadataQuery();
     final ImmutableList<RelCollation> collations = mq.collations(input);
-    for (RelCollation collation : collations) {
-      for (RelFieldCollation fieldCollation : collation.getFieldCollations()) {
-        fieldsUsedBuilder.set(fieldCollation.getFieldIndex());
+    if (collations != null) {
+      for (RelCollation collation : collations) {
+        for (RelFieldCollation fieldCollation : collation.getFieldCollations()) {
+          fieldsUsedBuilder.set(fieldCollation.getFieldIndex());
+        }
       }
     }
-
     // Correlating variables are a means for other relational expressions to use
     // fields.
     for (final CorrelationId correlation : rel.getVariablesSet()) {
