diff --git a/CHANGES.txt b/CHANGES.txt
index 649a752245..5efe9af156 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -185,6 +185,9 @@ Trunk -  Unreleased
 
     HIVE-879. Fix null pointer for empty dir. (Namit Jain via zshao)
 
+    HIVE-878. Update the hash table entry before flushing in Group By
+    hash aggregation. (Zheng Shao via namit)
+
 Release 0.4.0 -  Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
index cc54c09af7..34e70e1aab 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
@@ -542,14 +542,17 @@ private void processHashAggr(Object row, ObjectInspector rowInspector, ArrayList
       newEntryForHashAggr = keysCurrentGroup.add(newDefaultKeys);
     }
 
-    // based on used-specified parameters, check if the hash table needs to be flushed
+    // Update the aggs
+    updateAggregations(aggs, row, rowInspector, true, newEntryForHashAggr, null);
+
+    // We can only flush after the updateAggregations is done, or the potentially new entry "aggs"
+    // can be flushed out of the hash table.
+    
+    // Based on user-specified parameters, check if the hash table needs to be flushed.
     // If the grouping key is not the same as reduction key, flushing can only happen at boundaries
     if ((!groupKeyIsNotReduceKey || firstRowInGroup) && shouldBeFlushed(newKeys)) {
       flush(false);
     }
-
-    // Update the aggs
-    updateAggregations(aggs, row, rowInspector, true, newEntryForHashAggr, null);
   }
 
   // Non-hash aggregation
