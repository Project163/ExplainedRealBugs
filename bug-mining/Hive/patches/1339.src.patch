diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/persistence/MapJoinDoubleKeys.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/persistence/MapJoinDoubleKeys.java
index fc4780e6ff..d7742269aa 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/persistence/MapJoinDoubleKeys.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/persistence/MapJoinDoubleKeys.java
@@ -50,45 +50,44 @@ public MapJoinDoubleKeys(Object obj1, Object obj2) {
     this.obj2 = obj2;
   }
 
+
+
   @Override
-  public boolean equals(Object o) {
-    if (o instanceof MapJoinDoubleKeys) {
-      MapJoinDoubleKeys mObj = (MapJoinDoubleKeys) o;
-      Object key1 = mObj.getObj1();
-      Object key2 = mObj.getObj2();
-
-      if ((obj1 == null) && (key1 == null)) {
-        if ((obj2 == null) && (key2 == null)) {
-          return true;
-        }
-      }
-      if ((obj1 != null) && (key1 != null)) {
-        if (obj1.equals(key1)) {
-          if ((obj2 != null) && (key2 != null)) {
-            if (obj2.equals(key2)) {
-              return true;
-            }
-          }
-        }
-      }
-    }
-    return false;
+  public int hashCode() {
+    final int prime = 31;
+    int result = 1;
+    result = prime * result + ((obj1 == null) ? 0 : obj1.hashCode());
+    result = prime * result + ((obj2 == null) ? 0 : obj2.hashCode());
+    return result;
   }
 
   @Override
-  public int hashCode() {
-    int hashCode = 1;
+  public boolean equals(Object obj) {
+    if (this == obj) {
+      return true;
+    }
+    if (obj == null) {
+      return false;
+    }
+    if (getClass() != obj.getClass()) {
+      return false;
+    }
+    MapJoinDoubleKeys other = (MapJoinDoubleKeys) obj;
     if (obj1 == null) {
-      hashCode = metadataTag;
-    } else {
-      hashCode += (31 + obj1.hashCode());
+      if (other.obj1 != null) {
+        return false;
+      }
+    } else if (!obj1.equals(other.obj1)) {
+      return false;
     }
     if (obj2 == null) {
-      hashCode += metadataTag;
-    } else {
-      hashCode += (31 + obj2.hashCode());
+      if (other.obj2 != null) {
+        return false;
+      }
+    } else if (!obj2.equals(other.obj2)) {
+      return false;
     }
-    return hashCode;
+    return true;
   }
 
   @Override
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/persistence/MapJoinObjectKey.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/persistence/MapJoinObjectKey.java
index 50aa9e95e7..791bb3f725 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/persistence/MapJoinObjectKey.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/persistence/MapJoinObjectKey.java
@@ -22,6 +22,7 @@
 import java.io.ObjectInput;
 import java.io.ObjectOutput;
 import java.util.ArrayList;
+import java.util.Arrays;
 
 import org.apache.hadoop.hive.ql.exec.HashTableSinkOperator;
 import org.apache.hadoop.hive.ql.exec.HashTableSinkOperator.HashTableSinkObjectCtx;
@@ -34,7 +35,7 @@
 /**
  * Map Join Object used for both key.
  */
-public class MapJoinObjectKey  extends AbstractMapJoinKey {
+public class MapJoinObjectKey extends AbstractMapJoinKey {
 
 
   protected transient Object[] obj;
@@ -49,46 +50,29 @@ public MapJoinObjectKey(Object[] obj) {
     this.obj = obj;
   }
 
+
+
   @Override
-  public boolean equals(Object o) {
-    if (o instanceof MapJoinObjectKey) {
-      MapJoinObjectKey mObj = (MapJoinObjectKey) o;
-      Object[] mObjArray = mObj.getObj();
-      if ((obj == null) && (mObjArray == null)) {
-        return true;
-      }
-      if ((obj != null) && (mObjArray != null)) {
-        if (obj.length == mObjArray.length) {
-          for (int i = 0; i < obj.length; i++) {
-            if (obj[i] == null) {
-              return mObjArray[i] == null;
-            }
-            if (!obj[i].equals(mObjArray[i])) {
-              return false;
-            }
-          }
-          return true;
-        }
-      }
-    }
-    return false;
+  public int hashCode() {
+    return Arrays.hashCode(obj);
   }
 
   @Override
-  public int hashCode() {
-    int hashCode;
+  public boolean equals(Object obj) {
+    if (this == obj) {
+      return true;
+    }
     if (obj == null) {
-      hashCode = metadataTag;
-    } else {
-      hashCode = 1;
-
-      for (int i = 0; i < obj.length; i++) {
-        Object o = obj[i];
-        hashCode = 31 * hashCode + (o == null ? 0 : o.hashCode());
-      }
-
+      return false;
+    }
+    if (getClass() != obj.getClass()) {
+      return false;
+    }
+    MapJoinObjectKey other = (MapJoinObjectKey) obj;
+    if (!Arrays.equals(this.obj, other.obj)) {
+      return false;
     }
-    return hashCode;
+    return true;
   }
 
   @Override
@@ -104,9 +88,9 @@ public void readExternal(ObjectInput in) throws IOException,
       ArrayList<Object> list = (ArrayList<Object>) ObjectInspectorUtils.copyToStandardObject(ctx
           .getSerDe().deserialize(val), ctx.getSerDe().getObjectInspector(),
           ObjectInspectorCopyOption.WRITABLE);
-      if(list == null){
+      if (list == null) {
         obj = new ArrayList(0).toArray();
-      }else{
+      } else {
         obj = list.toArray();
       }
 
@@ -148,8 +132,8 @@ public void setObj(Object[] obj) {
   }
 
   @Override
-  public boolean hasAnyNulls(boolean[] nullsafes){
-    if (obj != null && obj.length> 0) {
+  public boolean hasAnyNulls(boolean[] nullsafes) {
+    if (obj != null && obj.length > 0) {
       for (int i = 0; i < obj.length; i++) {
         if (obj[i] == null && (nullsafes == null || !nullsafes[i])) {
           return true;
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/exec/persistence/TestMapJoinKeys.java b/ql/src/test/org/apache/hadoop/hive/ql/exec/persistence/TestMapJoinKeys.java
new file mode 100644
index 0000000000..0c89d7918c
--- /dev/null
+++ b/ql/src/test/org/apache/hadoop/hive/ql/exec/persistence/TestMapJoinKeys.java
@@ -0,0 +1,53 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.hadoop.hive.ql.exec.persistence;
+
+import junit.framework.Assert;
+
+import org.junit.Test;
+
+public class TestMapJoinKeys {
+
+  @Test
+  public void testDoubleKeys() {
+    MapJoinDoubleKeys left = new MapJoinDoubleKeys(148, null);
+    MapJoinDoubleKeys right = new MapJoinDoubleKeys(148, null);
+    Assert.assertEquals(left, right);
+    Assert.assertEquals(left.hashCode(), right.hashCode());
+    left = new MapJoinDoubleKeys(null, 148);
+    right = new MapJoinDoubleKeys(null, 148);
+    Assert.assertEquals(left, right);
+    Assert.assertEquals(left.hashCode(), right.hashCode());
+    left = new MapJoinDoubleKeys(148, null);
+    right = new MapJoinDoubleKeys(149, null);
+    Assert.assertFalse(left.equals(right));
+    Assert.assertFalse(right.equals(left));
+
+  }
+  @Test
+  public void testObjectKeys() {
+    MapJoinObjectKey left = new MapJoinObjectKey(new Object[]{null, "left"});
+    MapJoinObjectKey right = new MapJoinObjectKey(new Object[]{null, "right"});
+    Assert.assertFalse(left.equals(right));
+    Assert.assertFalse(right.equals(left));
+    left = new MapJoinObjectKey(new Object[]{"key", 148, null});
+    right = new MapJoinObjectKey(new Object[]{"key", 148, null});
+    Assert.assertEquals(left, right);
+    Assert.assertEquals(left.hashCode(), right.hashCode());
+  }
+}
diff --git a/ql/src/test/results/clientpositive/join_nullsafe.q.out b/ql/src/test/results/clientpositive/join_nullsafe.q.out
index 2844571448..1831b87bf0 100644
--- a/ql/src/test/results/clientpositive/join_nullsafe.q.out
+++ b/ql/src/test/results/clientpositive/join_nullsafe.q.out
@@ -1032,7 +1032,15 @@ NULL	NULL	NULL	NULL
 NULL	NULL	NULL	NULL
 NULL	NULL	NULL	NULL
 NULL	NULL	NULL	NULL
+NULL	10	NULL	10
+NULL	35	NULL	35
+NULL	110	NULL	110
+NULL	135	NULL	135
+10	NULL	10	NULL
+48	NULL	48	NULL
 100	100	100	100
+110	NULL	110	NULL
+148	NULL	148	NULL
 200	200	200	200
 PREHOOK: query: SELECT /*+ MAPJOIN(a) */ * FROM smb_input1 a RIGHT OUTER JOIN smb_input1 b ON a.key <=> b.key ORDER BY a.key, a.value, b.key, b.value
 PREHOOK: type: QUERY
