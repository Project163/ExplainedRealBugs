diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java
index 663d5ddb39..2874108973 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/BaseSemanticAnalyzer.java
@@ -500,21 +500,55 @@ public static String getTableAlias(ASTNode node) throws SemanticException {
     if (node.getToken().getType() == HiveParser.TOK_PTBLFUNCTION) {
       return unescapeIdentifier(node.getChild(1).getText().toLowerCase());
     }
-    if (node.getChildCount() == 1) {
-      return getUnescapedUnqualifiedTableName((ASTNode) node.getChild(0)).toLowerCase();
-    }
-    for (int i = node.getChildCount() - 1; i >= 0; --i) {
-      Tree child = node.getChild(i);
-      if (child.getType() == HiveParser.TOK_TABNAME) {
-        return getUnescapedUnqualifiedTableName((ASTNode) node.getChild(0)).toLowerCase();
-      } else if (child.getType() == HiveParser.Identifier) {
-        return unescapeIdentifier(child.getText().toLowerCase());
+    String alias = getSimpleTableNameBase(node);
+    return alias != null ? alias.toLowerCase() : null;
+  }
+
+  protected static String getSimpleTableNameBase(ASTNode n) throws SemanticException {
+    switch (n.getType()) {
+    case HiveParser.TOK_TABREF:
+      int aliasIndex = findTabRefIdxs(n)[0];
+      if (aliasIndex != 0) {
+        return n.getChild(aliasIndex).getText(); //the alias
+      }
+      return getSimpleTableNameBase((ASTNode) n.getChild(0));
+    case HiveParser.TOK_TABNAME:
+      if (n.getChildCount() == 2) {
+        //db.table -> return table
+        return n.getChild(1).getText();
       }
+      return n.getChild(0).getText();
+    case HiveParser.TOK_SUBQUERY:
+      return n.getChild(1).getText(); //the alias
+    default:
+      throw raiseWrongType("TOK_TABREF|TOK_TABNAME|TOK_SUBQUERY", n);
     }
+  }
 
-    throw new SemanticException("No table alias or table name found.");
+  protected static IllegalArgumentException raiseWrongType(String expectedTokName, ASTNode n) {
+    return new IllegalArgumentException("Expected " + expectedTokName + "; got " + n.getType());
   }
 
+  protected static int[] findTabRefIdxs(ASTNode tabref) {
+    assert tabref.getType() == HiveParser.TOK_TABREF;
+    int aliasIndex = 0;
+    int propsIndex = -1;
+    int tsampleIndex = -1;
+    int ssampleIndex = -1;
+    for (int index = 1; index < tabref.getChildCount(); index++) {
+      ASTNode ct = (ASTNode) tabref.getChild(index);
+      if (ct.getToken().getType() == HiveParser.TOK_TABLEBUCKETSAMPLE) {
+        tsampleIndex = index;
+      } else if (ct.getToken().getType() == HiveParser.TOK_TABLESPLITSAMPLE) {
+        ssampleIndex = index;
+      } else if (ct.getToken().getType() == HiveParser.TOK_TABLEPROPERTIES) {
+        propsIndex = index;
+      } else {
+        aliasIndex = index;
+      }
+    }
+    return new int[] {aliasIndex, propsIndex, tsampleIndex, ssampleIndex};
+  }
 
   /**
    * Remove the encapsulating "`" pair from the identifier. We allow users to
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/RewriteSemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/RewriteSemanticAnalyzer.java
index 9ced721fe7..4110c8d5e8 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/RewriteSemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/RewriteSemanticAnalyzer.java
@@ -414,27 +414,6 @@ protected String getSimpleTableName(ASTNode n) throws SemanticException {
     return HiveUtils.unparseIdentifier(getSimpleTableNameBase(n), this.conf);
   }
 
-  protected String getSimpleTableNameBase(ASTNode n) throws SemanticException {
-    switch (n.getType()) {
-    case HiveParser.TOK_TABREF:
-      int aliasIndex = findTabRefIdxs(n)[0];
-      if (aliasIndex != 0) {
-        return n.getChild(aliasIndex).getText(); //the alias
-      }
-      return getSimpleTableNameBase((ASTNode) n.getChild(0));
-    case HiveParser.TOK_TABNAME:
-      if (n.getChildCount() == 2) {
-        //db.table -> return table
-        return n.getChild(1).getText();
-      }
-      return n.getChild(0).getText();
-    case HiveParser.TOK_SUBQUERY:
-      return n.getChild(1).getText(); //the alias
-    default:
-      throw raiseWrongType("TOK_TABREF|TOK_TABNAME|TOK_SUBQUERY", n);
-    }
-  }
-
   protected static final class ReparseResult {
     final ASTNode rewrittenTree;
     final Context rewrittenCtx;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
index 3cfb04b1b1..6f7bcf6c0c 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
@@ -1064,27 +1064,6 @@ protected void setAST(ASTNode newAST) {
     this.ast = newAST;
   }
 
-  int[] findTabRefIdxs(ASTNode tabref) {
-    assert tabref.getType() == HiveParser.TOK_TABREF;
-    int aliasIndex = 0;
-    int propsIndex = -1;
-    int tsampleIndex = -1;
-    int ssampleIndex = -1;
-    for (int index = 1; index < tabref.getChildCount(); index++) {
-      ASTNode ct = (ASTNode) tabref.getChild(index);
-      if (ct.getToken().getType() == HiveParser.TOK_TABLEBUCKETSAMPLE) {
-        tsampleIndex = index;
-      } else if (ct.getToken().getType() == HiveParser.TOK_TABLESPLITSAMPLE) {
-        ssampleIndex = index;
-      } else if (ct.getToken().getType() == HiveParser.TOK_TABLEPROPERTIES) {
-        propsIndex = index;
-      } else {
-        aliasIndex = index;
-      }
-    }
-    return new int[] {aliasIndex, propsIndex, tsampleIndex, ssampleIndex};
-  }
-
   private String findSimpleTableName(ASTNode tabref, int aliasIndex) throws SemanticException {
     assert tabref.getType() == HiveParser.TOK_TABREF;
     ASTNode tableTree = (ASTNode) (tabref.getChild(0));
@@ -15225,10 +15204,6 @@ protected String getFullTableNameForSQL(ASTNode n) throws SemanticException {
     }
   }
 
-  static IllegalArgumentException raiseWrongType(String expectedTokName, ASTNode n) {
-    return new IllegalArgumentException("Expected " + expectedTokName + "; got " + n.getType());
-  }
-
   /**
    * Append list of partition columns to Insert statement, i.e. the 1st set of partCol1,partCol2
    * INSERT INTO T PARTITION(partCol1,partCol2...) SELECT col1, ... partCol1,partCol2...
