diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java
index 58ed550f2a..cb010fb9b6 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/TableScanOperator.java
@@ -243,31 +243,28 @@ static public String getOperatorName() {
     return "TS";
   }
 
-  // This 'neededColumnIDs' field is included in this operator class instead of
-  // its desc class.The reason is that 1)tableScanDesc can not be instantiated,
-  // and 2) it will fail some join and union queries if this is added forcibly
-  // into tableScanDesc.
-  // Both neededColumnIDs and neededColumns should never be null.
-  // When neededColumnIDs is an empty list,
-  // it means no needed column (e.g. we do not need any column to evaluate
-  // SELECT count(*) FROM t).
-  List<Integer> neededColumnIDs;
-  List<String> neededColumns;
-
   public void setNeededColumnIDs(List<Integer> orign_columns) {
-    neededColumnIDs = orign_columns;
+    conf.setNeededColumnIDs(orign_columns);
   }
 
   public List<Integer> getNeededColumnIDs() {
-    return neededColumnIDs;
+    return conf.getNeededColumnIDs();
   }
 
   public void setNeededColumns(List<String> columnNames) {
-    neededColumns = columnNames;
+    conf.setNeededColumns(columnNames);
   }
 
   public List<String> getNeededColumns() {
-    return neededColumns;
+    return conf.getNeededColumns();
+  }
+
+  public void setReferencedColumns(List<String> referencedColumns) {
+    conf.setReferencedColumns(referencedColumns);
+  }
+
+  public List<String> getReferencedColumns() {
+    return conf.getReferencedColumns();
   }
 
   @Override
@@ -335,6 +332,7 @@ public Operator<? extends OperatorDesc> clone()
     TableScanOperator ts = (TableScanOperator) super.clone();
     ts.setNeededColumnIDs(new ArrayList<Integer>(getNeededColumnIDs()));
     ts.setNeededColumns(new ArrayList<String>(getNeededColumns()));
+    ts.setReferencedColumns(new ArrayList<String>(getReferencedColumns()));
     return ts;
   }
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
index 6a4dc9b0c9..f1ebd99feb 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
@@ -312,6 +312,7 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx,
           cols);
       List<Integer> neededColumnIds = new ArrayList<Integer>();
       List<String> neededColumnNames = new ArrayList<String>();
+      List<String> referencedColumnNames = new ArrayList<String>();
       RowResolver inputRR = cppCtx.getOpToParseCtxMap().get(scanOp).getRowResolver();
       TableScanDesc desc = scanOp.getConf();
       List<VirtualColumn> virtualCols = desc.getVirtualCols();
@@ -322,11 +323,12 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx,
         cols.add(VirtualColumn.RAWDATASIZE.getName());
       }
 
-      for (int i = 0; i < cols.size(); i++) {
-        String[] tabCol = inputRR.reverseLookup(cols.get(i));
-        if(tabCol == null) {
+      for (String column : cols) {
+        String[] tabCol = inputRR.reverseLookup(column);
+        if (tabCol == null) {
           continue;
         }
+        referencedColumnNames.add(column);
         ColumnInfo colInfo = inputRR.get(tabCol[0], tabCol[1]);
         if (colInfo.getIsVirtualCol()) {
           // part is also a virtual column, but part col should not in this
@@ -340,17 +342,18 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx ctx,
           //no need to pass virtual columns to reader.
           continue;
         }
-        int position = inputRR.getPosition(cols.get(i));
+        int position = inputRR.getPosition(column);
         if (position >= 0) {
           // get the needed columns by id and name
           neededColumnIds.add(position);
-          neededColumnNames.add(cols.get(i));
+          neededColumnNames.add(column);
         }
       }
 
       desc.setVirtualCols(newVirtualCols);
       scanOp.setNeededColumnIDs(neededColumnIds);
       scanOp.setNeededColumns(neededColumnNames);
+      scanOp.setReferencedColumns(referencedColumnNames);
       return null;
     }
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
index 8c4b891276..7f574dc734 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
@@ -147,7 +147,8 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx opProcCtx,
                 .getConfirmedPartitionsForScan(parseInfo);
             if (confirmedPartns.size() > 0) {
               Table source = parseCtx.getQB().getMetaData().getTableForAlias(alias);
-              PrunedPartitionList partList = new PrunedPartitionList(source, confirmedPartns, false);
+              List<String> partCols = GenMapRedUtils.getPartitionColumns(parseInfo);
+              PrunedPartitionList partList = new PrunedPartitionList(source, confirmedPartns, partCols, false);
               GenMapRedUtils.setTaskPlan(currAliasId, currTopOp, currTask, false, ctx, partList);
             } else { // non-partitioned table
               GenMapRedUtils.setTaskPlan(currAliasId, currTopOp, currTask, false, ctx);
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
index f285312bab..77f56c1737 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java
@@ -20,6 +20,7 @@
 
 import java.io.Serializable;
 import java.util.ArrayList;
+import java.util.Collections;
 import java.util.HashMap;
 import java.util.HashSet;
 import java.util.Iterator;
@@ -927,6 +928,7 @@ public static TableScanOperator createTemporaryTableScanOperator(RowSchema rowSc
     }
     tableScanOp.setNeededColumnIDs(neededColumnIds);
     tableScanOp.setNeededColumns(neededColumnNames);
+    tableScanOp.setReferencedColumns(neededColumnNames);
     return tableScanOp;
   }
 
@@ -1747,6 +1749,14 @@ public static Set<Partition> getConfirmedPartitionsForScan(QBParseInfo parseInfo
     return confirmedPartns;
   }
 
+  public static List<String> getPartitionColumns(QBParseInfo parseInfo) {
+    tableSpec tblSpec = parseInfo.getTableSpec();
+    if (tblSpec.tableHandle.isPartitioned()) {
+      return new ArrayList<String>(tblSpec.getPartSpec().keySet());
+    }
+    return Collections.emptyList();
+  }
+
   public static List<Path> getInputPathsForPartialScan(QBParseInfo parseInfo, StringBuffer aggregationKey) 
     throws SemanticException {
     List<Path> inputPaths = new ArrayList<Path>();
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ppr/PartitionPruner.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ppr/PartitionPruner.java
index 6bdf39412d..3c26894d1a 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ppr/PartitionPruner.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ppr/PartitionPruner.java
@@ -212,9 +212,9 @@ static private ExprNodeDesc compactExpr(ExprNodeDesc expr) {
           return isAnd ? children.get(0) : null;
         }
       }
-      return (ExprNodeGenericFuncDesc)expr;
+      return expr;
     } else {
-        throw new IllegalStateException("Unexpected type of ExprNodeDesc: " + expr.getExprString());
+      throw new IllegalStateException("Unexpected type of ExprNodeDesc: " + expr.getExprString());
     }
   }
 
@@ -225,18 +225,23 @@ static private ExprNodeDesc compactExpr(ExprNodeDesc expr) {
    * The expression is only used to prune by partition name, so we have no business with VCs.
    * @param expr original partition pruning expression.
    * @param partCols list of partition columns for the table.
+   * @param referred partition columns referred by expr
    * @return partition pruning expression that only contains partition columns from the list.
    */
-  static private ExprNodeDesc removeNonPartCols(ExprNodeDesc expr, List<String> partCols) {
-    if (expr instanceof ExprNodeColumnDesc
-        && !partCols.contains(((ExprNodeColumnDesc) expr).getColumn())) {
-      // Column doesn't appear to be a partition column for the table.
-      return new ExprNodeConstantDesc(expr.getTypeInfo(), null);
+  static private ExprNodeDesc removeNonPartCols(ExprNodeDesc expr, List<String> partCols,
+      Set<String> referred) {
+    if (expr instanceof ExprNodeColumnDesc) {
+      String column = ((ExprNodeColumnDesc) expr).getColumn();
+      if (!partCols.contains(column)) {
+        // Column doesn't appear to be a partition column for the table.
+        return new ExprNodeConstantDesc(expr.getTypeInfo(), null);
+      }
+      referred.add(column);
     }
     if (expr instanceof ExprNodeGenericFuncDesc) {
       List<ExprNodeDesc> children = expr.getChildren();
       for (int i = 0; i < children.size(); ++i) {
-        children.set(i, removeNonPartCols(children.get(i), partCols));
+        children.set(i, removeNonPartCols(children.get(i), partCols, referred));
       }
     }
     return expr;
@@ -266,7 +271,7 @@ private static PrunedPartitionList getPartitionsFromServer(Table tab,
     try {
       if (!tab.isPartitioned()) {
         // If the table is not partitioned, return everything.
-        return new PrunedPartitionList(tab, getAllPartitions(tab), false);
+        return new PrunedPartitionList(tab, getAllPartitions(tab), null, false);
       }
       LOG.debug("tabname = " + tab.getTableName() + " is partitioned");
 
@@ -279,18 +284,19 @@ private static PrunedPartitionList getPartitionsFromServer(Table tab,
 
       if (prunerExpr == null) {
         // Non-strict mode, and there is no predicates at all - get everything.
-        return new PrunedPartitionList(tab, getAllPartitions(tab), false);
+        return new PrunedPartitionList(tab, getAllPartitions(tab), null, false);
       }
 
+      Set<String> referred = new LinkedHashSet<String>();
       // Replace virtual columns with nulls. See javadoc for details.
-      prunerExpr = removeNonPartCols(prunerExpr, extractPartColNames(tab));
+      prunerExpr = removeNonPartCols(prunerExpr, extractPartColNames(tab), referred);
       // Remove all parts that are not partition columns. See javadoc for details.
       ExprNodeGenericFuncDesc compactExpr = (ExprNodeGenericFuncDesc)compactExpr(prunerExpr.clone());
       String oldFilter = prunerExpr.getExprString();
       if (compactExpr == null) {
         // Non-strict mode, and all the predicates are on non-partition columns - get everything.
         LOG.debug("Filter " + oldFilter + " was null after compacting");
-        return new PrunedPartitionList(tab, getAllPartitions(tab), true);
+        return new PrunedPartitionList(tab, getAllPartitions(tab), null, true);
       }
 
       LOG.debug("Filter w/ compacting: " + compactExpr.getExprString()
@@ -326,6 +332,7 @@ private static PrunedPartitionList getPartitionsFromServer(Table tab,
       // metastore and so some partitions may have no data based on other filters.
       boolean isPruningByExactFilter = oldFilter.equals(compactExpr.getExprString());
       return new PrunedPartitionList(tab, new LinkedHashSet<Partition>(partitions),
+          new ArrayList<String>(referred),
           hasUnknownPartitions || !isPruningByExactFilter);
     } catch (HiveException e) {
       throw e;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/ColumnAccessAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/ColumnAccessAnalyzer.java
index 74b595a197..5e04806db1 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/ColumnAccessAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/ColumnAccessAnalyzer.java
@@ -22,8 +22,8 @@
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
-import org.apache.hadoop.hive.metastore.api.FieldSchema;
 import org.apache.hadoop.hive.ql.exec.TableScanOperator;
+import org.apache.hadoop.hive.ql.metadata.HiveException;
 import org.apache.hadoop.hive.ql.metadata.Table;
 
 public class ColumnAccessAnalyzer {
@@ -44,9 +44,23 @@ public ColumnAccessInfo analyzeColumnAccess() throws SemanticException {
     for (TableScanOperator op : topOps.keySet()) {
       Table table = topOps.get(op);
       String tableName = table.getCompleteName();
-      List<FieldSchema> tableCols = table.getCols();
-      for (int i : op.getNeededColumnIDs()) {
-        columnAccessInfo.add(tableName, tableCols.get(i).getName());
+      List<String> referenced = op.getReferencedColumns();
+      for (String column : referenced) {
+        columnAccessInfo.add(tableName, column);
+      }
+      if (table.isPartitioned()) {
+        PrunedPartitionList parts;
+        try {
+          parts = pGraphContext.getPrunedPartitions(table.getTableName(), op);
+        } catch (HiveException e) {
+          LOG.error(org.apache.hadoop.util.StringUtils.stringifyException(e));
+          throw new SemanticException(e.getMessage(), e);
+        }
+        if (parts.getReferredPartCols() != null) {
+          for (String partKey : parts.getReferredPartCols()) {
+            columnAccessInfo.add(tableName, partKey);
+          }
+        }
       }
     }
     return columnAccessInfo;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/ProcessAnalyzeTable.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/ProcessAnalyzeTable.java
index c26be3cf2a..9fcc1b2a59 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/ProcessAnalyzeTable.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/ProcessAnalyzeTable.java
@@ -28,7 +28,6 @@
 import org.apache.hadoop.fs.Path;
 import org.apache.hadoop.hive.conf.HiveConf;
 import org.apache.hadoop.hive.ql.DriverContext;
-import org.apache.hadoop.hive.ql.ErrorMsg;
 import org.apache.hadoop.hive.ql.exec.TableScanOperator;
 import org.apache.hadoop.hive.ql.exec.Task;
 import org.apache.hadoop.hive.ql.exec.TaskFactory;
@@ -40,12 +39,6 @@
 import org.apache.hadoop.hive.ql.metadata.Partition;
 import org.apache.hadoop.hive.ql.metadata.Table;
 import org.apache.hadoop.hive.ql.optimizer.GenMapRedUtils;
-import org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.tableSpec;
-import org.apache.hadoop.hive.ql.parse.GenTezWork;
-import org.apache.hadoop.hive.ql.parse.ParseContext;
-import org.apache.hadoop.hive.ql.parse.PrunedPartitionList;
-import org.apache.hadoop.hive.ql.parse.QBParseInfo;
-import org.apache.hadoop.hive.ql.parse.SemanticException;
 import org.apache.hadoop.hive.ql.plan.MapWork;
 import org.apache.hadoop.hive.ql.plan.StatsNoJobWork;
 import org.apache.hadoop.hive.ql.plan.TezWork;
@@ -150,7 +143,8 @@ public Object process(Node nd, Stack<Node> stack,
       PrunedPartitionList partitions = null;
       if (confirmedPartns.size() > 0) {
         Table source = queryBlock.getMetaData().getTableForAlias(alias);
-        partitions = new PrunedPartitionList(source, confirmedPartns, false);
+        List<String> partCols = GenMapRedUtils.getPartitionColumns(parseInfo);
+        partitions = new PrunedPartitionList(source, confirmedPartns, partCols, false);
       }
 
       MapWork w = utils.createMapWork(context, tableScan, tezWork, partitions);
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/PrunedPartitionList.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/PrunedPartitionList.java
index d3268ddda4..da2e1e2d8b 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/PrunedPartitionList.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/PrunedPartitionList.java
@@ -36,11 +36,16 @@ public class PrunedPartitionList {
   /** Partitions that either satisfy the partition criteria, or may satisfy it. */
   private Set<Partition> partitions;
 
+  /** partition columns referred by pruner expr */
+  private List<String> referred;
+
   /** Whether there are partitions in the list that may or may not satisfy the criteria. */
   private boolean hasUnknowns;
 
-  public PrunedPartitionList(Table source, Set<Partition> partitions, boolean hasUnknowns) {
+  public PrunedPartitionList(Table source, Set<Partition> partitions, List<String> referred,
+      boolean hasUnknowns) {
     this.source = source;
+    this.referred = referred;
     this.partitions = partitions;
     this.hasUnknowns = hasUnknowns;
   }
@@ -70,4 +75,8 @@ public List<Partition> getNotDeniedPartns() {
   public boolean hasUnknownPartitions() {
     return hasUnknowns;
   }
+
+  public List<String> getReferredPartCols() {
+    return referred;
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/QBParseInfo.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/QBParseInfo.java
index a7cec5d543..a4ba4bdc89 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/QBParseInfo.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/QBParseInfo.java
@@ -531,7 +531,7 @@ public tableSpec getTableSpec(String tName) {
   }
 
   /**
-   * This method is used only for the anlayze command to get the partition specs
+   * This method is used only for the analyze command to get the partition specs
    */
   public tableSpec getTableSpec() {
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java b/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java
index 1642d6faee..699b476582 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/plan/TableScanDesc.java
@@ -23,6 +23,7 @@
 import java.util.List;
 import java.util.Map;
 
+import org.apache.hadoop.hive.ql.exec.PTFUtils;
 import org.apache.hadoop.hive.ql.metadata.VirtualColumn;
 
 /**
@@ -34,6 +35,10 @@
 public class TableScanDesc extends AbstractOperatorDesc {
   private static final long serialVersionUID = 1L;
 
+  static {
+    PTFUtils.makeTransient(TableScanDesc.class, "filterObject", "referencedColumns");
+  }
+
   private String alias;
 
   private List<VirtualColumn> virtualCols;
@@ -64,6 +69,16 @@ public class TableScanDesc extends AbstractOperatorDesc {
   private ExprNodeGenericFuncDesc filterExpr;
   private transient Serializable filterObject;
 
+  // Both neededColumnIDs and neededColumns should never be null.
+  // When neededColumnIDs is an empty list,
+  // it means no needed column (e.g. we do not need any column to evaluate
+  // SELECT count(*) FROM t).
+  private List<Integer> neededColumnIDs;
+  private List<String> neededColumns;
+
+  // all column names referenced including virtual columns. used in ColumnAccessAnalyzer
+  private transient List<String> referencedColumns;
+
   public static final String FILTER_EXPR_CONF_STR =
     "hive.io.filter.expr.serialized";
 
@@ -125,6 +140,30 @@ public void setFilterObject(Serializable filterObject) {
     this.filterObject = filterObject;
   }
 
+  public void setNeededColumnIDs(List<Integer> neededColumnIDs) {
+    this.neededColumnIDs = neededColumnIDs;
+  }
+
+  public List<Integer> getNeededColumnIDs() {
+    return neededColumnIDs;
+  }
+
+  public void setNeededColumns(List<String> neededColumns) {
+    this.neededColumns = neededColumns;
+  }
+
+  public List<String> getNeededColumns() {
+    return neededColumns;
+  }
+
+  public void setReferencedColumns(List<String> referencedColumns) {
+    this.referencedColumns = referencedColumns;
+  }
+
+  public List<String> getReferencedColumns() {
+    return referencedColumns;
+  }
+
   public void setAlias(String alias) {
     this.alias = alias;
   }
diff --git a/ql/src/test/queries/clientpositive/column_access_stats.q b/ql/src/test/queries/clientpositive/column_access_stats.q
index fbf8bba56e..4f434033f6 100644
--- a/ql/src/test/queries/clientpositive/column_access_stats.q
+++ b/ql/src/test/queries/clientpositive/column_access_stats.q
@@ -160,3 +160,8 @@ FROM
 JOIN T3
 ON T3.key = T4.key
 ORDER BY T3.key, T4.key;
+
+-- for partitioned table
+SELECT * FROM srcpart TABLESAMPLE (10 ROWS);
+SELECT key,ds FROM srcpart TABLESAMPLE (10 ROWS) WHERE hr='11';
+SELECT value FROM srcpart TABLESAMPLE (10 ROWS) WHERE ds='2008-04-08';
diff --git a/ql/src/test/results/clientpositive/column_access_stats.q.out b/ql/src/test/results/clientpositive/column_access_stats.q.out
index d0cd19556a..ddb9d13670 100644
--- a/ql/src/test/results/clientpositive/column_access_stats.q.out
+++ b/ql/src/test/results/clientpositive/column_access_stats.q.out
@@ -58,21 +58,21 @@ PREHOOK: type: QUERY
 PREHOOK: Input: default@t4
 #### A masked pattern was here ####
 Table:default@t4
-Columns:key,val
+Columns:key,p,val
 
 PREHOOK: query: SELECT val FROM T4 where p=1
 PREHOOK: type: QUERY
 PREHOOK: Input: default@t4
 #### A masked pattern was here ####
 Table:default@t4
-Columns:val
+Columns:p,val
 
 PREHOOK: query: SELECT p, val FROM T4 where p=1
 PREHOOK: type: QUERY
 PREHOOK: Input: default@t4
 #### A masked pattern was here ####
 Table:default@t4
-Columns:val
+Columns:p,val
 
 PREHOOK: query: -- More complicated select queries
 EXPLAIN SELECT key FROM (SELECT key, val FROM T1) subq1 ORDER BY key
@@ -950,3 +950,63 @@ Columns:key,val
 7	7	17.0
 8	8	46.0
 8	8	46.0
+PREHOOK: query: -- for partitioned table
+SELECT * FROM srcpart TABLESAMPLE (10 ROWS)
+PREHOOK: type: QUERY
+PREHOOK: Input: default@srcpart
+PREHOOK: Input: default@srcpart@ds=2008-04-08/hr=11
+PREHOOK: Input: default@srcpart@ds=2008-04-08/hr=12
+PREHOOK: Input: default@srcpart@ds=2008-04-09/hr=11
+PREHOOK: Input: default@srcpart@ds=2008-04-09/hr=12
+#### A masked pattern was here ####
+Table:default@srcpart
+Columns:ds,hr,key,value
+
+238	val_238	2008-04-08	11
+86	val_86	2008-04-08	11
+311	val_311	2008-04-08	11
+27	val_27	2008-04-08	11
+165	val_165	2008-04-08	11
+409	val_409	2008-04-08	11
+255	val_255	2008-04-08	11
+278	val_278	2008-04-08	11
+98	val_98	2008-04-08	11
+484	val_484	2008-04-08	11
+PREHOOK: query: SELECT key,ds FROM srcpart TABLESAMPLE (10 ROWS) WHERE hr='11'
+PREHOOK: type: QUERY
+PREHOOK: Input: default@srcpart
+PREHOOK: Input: default@srcpart@ds=2008-04-08/hr=11
+PREHOOK: Input: default@srcpart@ds=2008-04-09/hr=11
+#### A masked pattern was here ####
+Table:default@srcpart
+Columns:ds,hr,key
+
+238	2008-04-08
+86	2008-04-08
+311	2008-04-08
+27	2008-04-08
+165	2008-04-08
+409	2008-04-08
+255	2008-04-08
+278	2008-04-08
+98	2008-04-08
+484	2008-04-08
+PREHOOK: query: SELECT value FROM srcpart TABLESAMPLE (10 ROWS) WHERE ds='2008-04-08'
+PREHOOK: type: QUERY
+PREHOOK: Input: default@srcpart
+PREHOOK: Input: default@srcpart@ds=2008-04-08/hr=11
+PREHOOK: Input: default@srcpart@ds=2008-04-08/hr=12
+#### A masked pattern was here ####
+Table:default@srcpart
+Columns:ds,value
+
+val_238
+val_86
+val_311
+val_27
+val_165
+val_409
+val_255
+val_278
+val_98
+val_484
diff --git a/ql/src/test/results/compiler/plan/case_sensitivity.q.xml b/ql/src/test/results/compiler/plan/case_sensitivity.q.xml
index 7de7b4f708..8ed0df690c 100644
--- a/ql/src/test/results/compiler/plan/case_sensitivity.q.xml
+++ b/ql/src/test/results/compiler/plan/case_sensitivity.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_5</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -1052,22 +1056,35 @@
           <void property="alias"> 
            <string>src_thrift</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>2</int> 
+            </void> 
+            <void method="add"> 
+             <int>4</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>lint</string> 
+            </void> 
+            <void method="add"> 
+             <string>lintstring</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>2</int> 
-          </void> 
-          <void method="add"> 
-           <int>4</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>lint</string> 
@@ -1077,9 +1094,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/cast1.q.xml b/ql/src/test/results/compiler/plan/cast1.q.xml
index 41d3e7c85a..b9730c8703 100644
--- a/ql/src/test/results/compiler/plan/cast1.q.xml
+++ b/ql/src/test/results/compiler/plan/cast1.q.xml
@@ -930,28 +930,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/groupby1.q.xml b/ql/src/test/results/compiler/plan/groupby1.q.xml
index 284f0a3f62..ccdcac3826 100755
--- a/ql/src/test/results/compiler/plan/groupby1.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby1.q.xml
@@ -863,22 +863,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -888,9 +901,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/groupby2.q.xml b/ql/src/test/results/compiler/plan/groupby2.q.xml
index c8a178d475..1c7f864fc2 100755
--- a/ql/src/test/results/compiler/plan/groupby2.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby2.q.xml
@@ -954,22 +954,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -979,9 +992,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/groupby3.q.xml b/ql/src/test/results/compiler/plan/groupby3.q.xml
index b88aa68933..4263f22d35 100644
--- a/ql/src/test/results/compiler/plan/groupby3.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby3.q.xml
@@ -1168,28 +1168,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>value</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/groupby4.q.xml b/ql/src/test/results/compiler/plan/groupby4.q.xml
index cb1a99b3ad..c230799229 100644
--- a/ql/src/test/results/compiler/plan/groupby4.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby4.q.xml
@@ -602,28 +602,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/groupby5.q.xml b/ql/src/test/results/compiler/plan/groupby5.q.xml
index 2fb8f203ab..fc9b6866b1 100644
--- a/ql/src/test/results/compiler/plan/groupby5.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby5.q.xml
@@ -715,22 +715,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -740,9 +753,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/groupby6.q.xml b/ql/src/test/results/compiler/plan/groupby6.q.xml
index c2d9a3655f..a7fa37a957 100644
--- a/ql/src/test/results/compiler/plan/groupby6.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby6.q.xml
@@ -602,28 +602,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>value</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input1.q.xml b/ql/src/test/results/compiler/plan/input1.q.xml
index 2cf7a1d783..7dee05b50b 100755
--- a/ql/src/test/results/compiler/plan/input1.q.xml
+++ b/ql/src/test/results/compiler/plan/input1.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_5</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -989,22 +993,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1014,9 +1031,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input2.q.xml b/ql/src/test/results/compiler/plan/input2.q.xml
index 7ecd9034f9..62cd3ed00e 100755
--- a/ql/src/test/results/compiler/plan/input2.q.xml
+++ b/ql/src/test/results/compiler/plan/input2.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_10</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -560,7 +564,7 @@
        <string>Stage-15</string> 
       </void> 
       <void property="listTasks"> 
-       <object id="ArrayList1" class="java.util.ArrayList"> 
+       <object id="ArrayList2" class="java.util.ArrayList"> 
         <void method="add"> 
          <object id="MoveTask3" class="org.apache.hadoop.hive.ql.exec.MoveTask"> 
           <void property="childTasks"> 
@@ -764,31 +768,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList3" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_12</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList3"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema1"/> 
                         </void> 
@@ -1020,7 +1028,7 @@
          <object idref="ListBucketingCtx1"/> 
         </void> 
         <void property="listTasks"> 
-         <object idref="ArrayList1"/> 
+         <object idref="ArrayList2"/> 
         </void> 
        </object> 
       </void> 
@@ -1046,7 +1054,7 @@
        <string>Stage-21</string> 
       </void> 
       <void property="listTasks"> 
-       <object id="ArrayList2" class="java.util.ArrayList"> 
+       <object id="ArrayList4" class="java.util.ArrayList"> 
         <void method="add"> 
          <object id="MoveTask6" class="org.apache.hadoop.hive.ql.exec.MoveTask"> 
           <void property="childTasks"> 
@@ -1258,31 +1266,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList5" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_14</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList5"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema2"/> 
                         </void> 
@@ -1527,7 +1539,7 @@
          <object idref="ListBucketingCtx2"/> 
         </void> 
         <void property="listTasks"> 
-         <object idref="ArrayList2"/> 
+         <object idref="ArrayList4"/> 
         </void> 
        </object> 
       </void> 
@@ -2496,22 +2508,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -2521,9 +2546,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input20.q.xml b/ql/src/test/results/compiler/plan/input20.q.xml
index 7915f38611..91c20a2f00 100644
--- a/ql/src/test/results/compiler/plan/input20.q.xml
+++ b/ql/src/test/results/compiler/plan/input20.q.xml
@@ -693,28 +693,35 @@
           <void property="alias">
            <string>src</string>
           </void>
+          <void property="neededColumnIDs">
+           <object class="java.util.ArrayList">
+            <void method="add">
+             <int>0</int>
+            </void>
+           </object>
+          </void>
+          <void property="neededColumns">
+           <object class="java.util.ArrayList">
+            <void method="add">
+             <string>key</string>
+            </void>
+           </object>
+          </void>
           <void property="virtualCols">
            <object class="java.util.ArrayList"/>
           </void>
          </object>
         </void>
-        <void property="neededColumnIDs">
-         <object class="java.util.ArrayList">
-          <void method="add">
-           <int>0</int>
-          </void>
-         </object>
+        <void property="operatorId">
+         <string>TS_0</string>
         </void>
-        <void property="neededColumns">
+        <void property="referencedColumns">
          <object class="java.util.ArrayList">
           <void method="add">
            <string>key</string>
           </void>
          </object>
         </void>
-        <void property="operatorId">
-         <string>TS_0</string>
-        </void>
         <void property="schema">
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema">
           <void property="signature">
diff --git a/ql/src/test/results/compiler/plan/input3.q.xml b/ql/src/test/results/compiler/plan/input3.q.xml
index 5d3d5a6e68..6342d16fac 100755
--- a/ql/src/test/results/compiler/plan/input3.q.xml
+++ b/ql/src/test/results/compiler/plan/input3.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_13</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -560,7 +564,7 @@
        <string>Stage-16</string> 
       </void> 
       <void property="listTasks"> 
-       <object id="ArrayList1" class="java.util.ArrayList"> 
+       <object id="ArrayList2" class="java.util.ArrayList"> 
         <void method="add"> 
          <object id="MoveTask3" class="org.apache.hadoop.hive.ql.exec.MoveTask"> 
           <void property="childTasks"> 
@@ -764,31 +768,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList3" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_15</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList3"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema1"/> 
                         </void> 
@@ -1079,7 +1087,7 @@
          <object idref="ListBucketingCtx1"/> 
         </void> 
         <void property="listTasks"> 
-         <object idref="ArrayList1"/> 
+         <object idref="ArrayList2"/> 
         </void> 
        </object> 
       </void> 
@@ -1105,7 +1113,7 @@
        <string>Stage-22</string> 
       </void> 
       <void property="listTasks"> 
-       <object id="ArrayList2" class="java.util.ArrayList"> 
+       <object id="ArrayList4" class="java.util.ArrayList"> 
         <void method="add"> 
          <object id="MoveTask6" class="org.apache.hadoop.hive.ql.exec.MoveTask"> 
           <void property="childTasks"> 
@@ -1317,31 +1325,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList5" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_17</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList5"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema2"/> 
                         </void> 
@@ -1649,7 +1661,7 @@
          <object idref="ListBucketingCtx2"/> 
         </void> 
         <void property="listTasks"> 
-         <object idref="ArrayList2"/> 
+         <object idref="ArrayList4"/> 
         </void> 
        </object> 
       </void> 
@@ -1675,7 +1687,7 @@
        <string>Stage-27</string> 
       </void> 
       <void property="listTasks"> 
-       <object id="ArrayList3" class="java.util.ArrayList"> 
+       <object id="ArrayList6" class="java.util.ArrayList"> 
         <void method="add"> 
          <object id="MoveTask9" class="org.apache.hadoop.hive.ql.exec.MoveTask"> 
           <void property="childTasks"> 
@@ -1796,25 +1808,29 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>_col0</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList7" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>_col0</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_19</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList7"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema3"/> 
                         </void> 
@@ -1992,7 +2008,7 @@
          #### A masked pattern was here #### 
         </void> 
         <void property="listTasks"> 
-         <object idref="ArrayList3"/> 
+         <object idref="ArrayList6"/> 
         </void> 
        </object> 
       </void> 
@@ -3203,22 +3219,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -3228,9 +3257,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input4.q.xml b/ql/src/test/results/compiler/plan/input4.q.xml
index 15dd6cc1d0..1bfd84d83f 100755
--- a/ql/src/test/results/compiler/plan/input4.q.xml
+++ b/ql/src/test/results/compiler/plan/input4.q.xml
@@ -833,22 +833,35 @@
           <void property="alias">
            <string>src</string>
           </void>
+          <void property="neededColumnIDs">
+           <object class="java.util.ArrayList">
+            <void method="add">
+             <int>0</int>
+            </void>
+            <void method="add">
+             <int>1</int>
+            </void>
+           </object>
+          </void>
+          <void property="neededColumns">
+           <object class="java.util.ArrayList">
+            <void method="add">
+             <string>key</string>
+            </void>
+            <void method="add">
+             <string>value</string>
+            </void>
+           </object>
+          </void>
           <void property="virtualCols">
            <object class="java.util.ArrayList"/>
           </void>
          </object>
         </void>
-        <void property="neededColumnIDs">
-         <object class="java.util.ArrayList">
-          <void method="add">
-           <int>0</int>
-          </void>
-          <void method="add">
-           <int>1</int>
-          </void>
-         </object>
+        <void property="operatorId">
+         <string>TS_0</string>
         </void>
-        <void property="neededColumns">
+        <void property="referencedColumns">
          <object class="java.util.ArrayList">
           <void method="add">
            <string>key</string>
@@ -858,9 +871,6 @@
           </void>
          </object>
         </void>
-        <void property="operatorId">
-         <string>TS_0</string>
-        </void>
         <void property="schema">
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema">
           <void property="signature">
diff --git a/ql/src/test/results/compiler/plan/input5.q.xml b/ql/src/test/results/compiler/plan/input5.q.xml
index 2f06f1e05e..af6cd5b149 100644
--- a/ql/src/test/results/compiler/plan/input5.q.xml
+++ b/ql/src/test/results/compiler/plan/input5.q.xml
@@ -820,22 +820,35 @@
           <void property="alias">
            <string>src_thrift</string>
           </void>
+          <void property="neededColumnIDs">
+           <object class="java.util.ArrayList">
+            <void method="add">
+             <int>2</int>
+            </void>
+            <void method="add">
+             <int>4</int>
+            </void>
+           </object>
+          </void>
+          <void property="neededColumns">
+           <object class="java.util.ArrayList">
+            <void method="add">
+             <string>lint</string>
+            </void>
+            <void method="add">
+             <string>lintstring</string>
+            </void>
+           </object>
+          </void>
           <void property="virtualCols">
            <object class="java.util.ArrayList"/>
           </void>
          </object>
         </void>
-        <void property="neededColumnIDs">
-         <object class="java.util.ArrayList">
-          <void method="add">
-           <int>2</int>
-          </void>
-          <void method="add">
-           <int>4</int>
-          </void>
-         </object>
+        <void property="operatorId">
+         <string>TS_0</string>
         </void>
-        <void property="neededColumns">
+        <void property="referencedColumns">
          <object class="java.util.ArrayList">
           <void method="add">
            <string>lint</string>
@@ -845,9 +858,6 @@
           </void>
          </object>
         </void>
-        <void property="operatorId">
-         <string>TS_0</string>
-        </void>
         <void property="schema">
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema">
           <void property="signature">
diff --git a/ql/src/test/results/compiler/plan/input6.q.xml b/ql/src/test/results/compiler/plan/input6.q.xml
index a94ee15081..85f090a589 100644
--- a/ql/src/test/results/compiler/plan/input6.q.xml
+++ b/ql/src/test/results/compiler/plan/input6.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_5</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -975,22 +979,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1000,9 +1017,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input7.q.xml b/ql/src/test/results/compiler/plan/input7.q.xml
index 80aac8d52d..61508793d8 100644
--- a/ql/src/test/results/compiler/plan/input7.q.xml
+++ b/ql/src/test/results/compiler/plan/input7.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_3</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -881,28 +885,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input8.q.xml b/ql/src/test/results/compiler/plan/input8.q.xml
index e683312669..7be51ffeaa 100644
--- a/ql/src/test/results/compiler/plan/input8.q.xml
+++ b/ql/src/test/results/compiler/plan/input8.q.xml
@@ -507,28 +507,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input9.q.xml b/ql/src/test/results/compiler/plan/input9.q.xml
index 7935d64504..9b0b51e821 100644
--- a/ql/src/test/results/compiler/plan/input9.q.xml
+++ b/ql/src/test/results/compiler/plan/input9.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_5</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -947,28 +951,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input_part1.q.xml b/ql/src/test/results/compiler/plan/input_part1.q.xml
index f89afe68a1..e876d99445 100644
--- a/ql/src/test/results/compiler/plan/input_part1.q.xml
+++ b/ql/src/test/results/compiler/plan/input_part1.q.xml
@@ -683,34 +683,50 @@
           <void property="alias"> 
            <string>srcpart</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
+        </void> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
-           <int>0</int> 
+           <string>key</string> 
           </void> 
           <void method="add"> 
-           <int>1</int> 
+           <string>value</string> 
           </void> 
-         </object> 
-        </void> 
-        <void property="neededColumns"> 
-         <object class="java.util.ArrayList"> 
           <void method="add"> 
-           <string>key</string> 
+           <string>ds</string> 
           </void> 
           <void method="add"> 
-           <string>value</string> 
+           <string>hr</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input_testsequencefile.q.xml b/ql/src/test/results/compiler/plan/input_testsequencefile.q.xml
index ca08c02ce9..3e59876d00 100644
--- a/ql/src/test/results/compiler/plan/input_testsequencefile.q.xml
+++ b/ql/src/test/results/compiler/plan/input_testsequencefile.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_3</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -827,22 +831,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -852,9 +869,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input_testxpath.q.xml b/ql/src/test/results/compiler/plan/input_testxpath.q.xml
index 2ba0b5eafe..d81da5b513 100644
--- a/ql/src/test/results/compiler/plan/input_testxpath.q.xml
+++ b/ql/src/test/results/compiler/plan/input_testxpath.q.xml
@@ -588,25 +588,41 @@
           <void property="alias"> 
            <string>src_thrift</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>2</int> 
+            </void> 
+            <void method="add"> 
+             <int>4</int> 
+            </void> 
+            <void method="add"> 
+             <int>5</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>lint</string> 
+            </void> 
+            <void method="add"> 
+             <string>lintstring</string> 
+            </void> 
+            <void method="add"> 
+             <string>mstringstring</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>2</int> 
-          </void> 
-          <void method="add"> 
-           <int>4</int> 
-          </void> 
-          <void method="add"> 
-           <int>5</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>lint</string> 
@@ -619,9 +635,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/input_testxpath2.q.xml b/ql/src/test/results/compiler/plan/input_testxpath2.q.xml
index 613752b625..4cff809fad 100644
--- a/ql/src/test/results/compiler/plan/input_testxpath2.q.xml
+++ b/ql/src/test/results/compiler/plan/input_testxpath2.q.xml
@@ -705,25 +705,41 @@
           <void property="alias"> 
            <string>src_thrift</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>2</int> 
+            </void> 
+            <void method="add"> 
+             <int>4</int> 
+            </void> 
+            <void method="add"> 
+             <int>5</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>lint</string> 
+            </void> 
+            <void method="add"> 
+             <string>lintstring</string> 
+            </void> 
+            <void method="add"> 
+             <string>mstringstring</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>2</int> 
-          </void> 
-          <void method="add"> 
-           <int>4</int> 
-          </void> 
-          <void method="add"> 
-           <int>5</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>lint</string> 
@@ -736,9 +752,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/join1.q.xml b/ql/src/test/results/compiler/plan/join1.q.xml
index f5a6123bd9..87da3ee69b 100644
--- a/ql/src/test/results/compiler/plan/join1.q.xml
+++ b/ql/src/test/results/compiler/plan/join1.q.xml
@@ -588,22 +588,35 @@
           <void property="alias"> 
            <string>src2</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -613,9 +626,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -881,28 +891,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_1</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_1</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/join2.q.xml b/ql/src/test/results/compiler/plan/join2.q.xml
index 92292b700b..c071b4cad7 100644
--- a/ql/src/test/results/compiler/plan/join2.q.xml
+++ b/ql/src/test/results/compiler/plan/join2.q.xml
@@ -532,31 +532,35 @@
              </void> 
             </void> 
             <void property="conf"> 
-             <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-            </void> 
-            <void property="neededColumnIDs"> 
-             <object class="java.util.ArrayList"> 
-              <void method="add"> 
-               <int>0</int> 
-              </void> 
-              <void method="add"> 
-               <int>1</int> 
-              </void> 
-             </object> 
-            </void> 
-            <void property="neededColumns"> 
-             <object class="java.util.ArrayList"> 
-              <void method="add"> 
-               <string>_col0</string> 
+             <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+              <void property="neededColumnIDs"> 
+               <object class="java.util.ArrayList"> 
+                <void method="add"> 
+                 <int>0</int> 
+                </void> 
+                <void method="add"> 
+                 <int>1</int> 
+                </void> 
+               </object> 
               </void> 
-              <void method="add"> 
-               <string>_col4</string> 
+              <void property="neededColumns"> 
+               <object id="ArrayList1" class="java.util.ArrayList"> 
+                <void method="add"> 
+                 <string>_col0</string> 
+                </void> 
+                <void method="add"> 
+                 <string>_col4</string> 
+                </void> 
+               </object> 
               </void> 
              </object> 
             </void> 
             <void property="operatorId"> 
              <string>TS_12</string> 
             </void> 
+            <void property="referencedColumns"> 
+             <object idref="ArrayList1"/> 
+            </void> 
             <void property="schema"> 
              <object id="RowSchema0" class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
               <void property="signature"> 
@@ -629,7 +633,7 @@
                   <object class="java.util.ArrayList"/> 
                  </void> 
                  <void property="keyCols"> 
-                  <object id="ArrayList1" class="java.util.ArrayList"> 
+                  <object id="ArrayList2" class="java.util.ArrayList"> 
                    <void method="add"> 
                     <object class="org.apache.hadoop.hive.ql.plan.ExprNodeGenericFuncDesc"> 
                      <void property="children"> 
@@ -720,7 +724,7 @@
                   </object> 
                  </void> 
                  <void property="partitionCols"> 
-                  <object idref="ArrayList1"/> 
+                  <object idref="ArrayList2"/> 
                  </void> 
                  <void property="tag"> 
                   <int>1</int> 
@@ -804,22 +808,35 @@
               <void property="alias"> 
                <string>src3</string> 
               </void> 
+              <void property="neededColumnIDs"> 
+               <object class="java.util.ArrayList"> 
+                <void method="add"> 
+                 <int>0</int> 
+                </void> 
+                <void method="add"> 
+                 <int>1</int> 
+                </void> 
+               </object> 
+              </void> 
+              <void property="neededColumns"> 
+               <object class="java.util.ArrayList"> 
+                <void method="add"> 
+                 <string>key</string> 
+                </void> 
+                <void method="add"> 
+                 <string>value</string> 
+                </void> 
+               </object> 
+              </void> 
               <void property="virtualCols"> 
                <object class="java.util.ArrayList"/> 
               </void> 
              </object> 
             </void> 
-            <void property="neededColumnIDs"> 
-             <object class="java.util.ArrayList"> 
-              <void method="add"> 
-               <int>0</int> 
-              </void> 
-              <void method="add"> 
-               <int>1</int> 
-              </void> 
-             </object> 
+            <void property="operatorId"> 
+             <string>TS_1</string> 
             </void> 
-            <void property="neededColumns"> 
+            <void property="referencedColumns"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
                <string>key</string> 
@@ -829,9 +846,6 @@
               </void> 
              </object> 
             </void> 
-            <void property="operatorId"> 
-             <string>TS_1</string> 
-            </void> 
             <void property="schema"> 
              <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
               <void property="signature"> 
@@ -1722,7 +1736,7 @@
               <object class="java.util.ArrayList"/> 
              </void> 
              <void property="keyCols"> 
-              <object id="ArrayList2" class="java.util.ArrayList"> 
+              <object id="ArrayList3" class="java.util.ArrayList"> 
                <void method="add"> 
                 <object class="org.apache.hadoop.hive.ql.plan.ExprNodeColumnDesc"> 
                  <void property="column"> 
@@ -1792,7 +1806,7 @@
               </object> 
              </void> 
              <void property="partitionCols"> 
-              <object idref="ArrayList2"/> 
+              <object idref="ArrayList3"/> 
              </void> 
              <void property="tag"> 
               <int>1</int> 
@@ -1876,28 +1890,35 @@
           <void property="alias"> 
            <string>src2</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -2008,7 +2029,7 @@
               <object class="java.util.ArrayList"/> 
              </void> 
              <void property="keyCols"> 
-              <object id="ArrayList3" class="java.util.ArrayList"> 
+              <object id="ArrayList4" class="java.util.ArrayList"> 
                <void method="add"> 
                 <object class="org.apache.hadoop.hive.ql.plan.ExprNodeColumnDesc"> 
                  <void property="column"> 
@@ -2078,7 +2099,7 @@
               </object> 
              </void> 
              <void property="partitionCols"> 
-              <object idref="ArrayList3"/> 
+              <object idref="ArrayList4"/> 
              </void> 
              <void property="valueCols"> 
               <object class="java.util.ArrayList"> 
@@ -2159,28 +2180,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_2</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_2</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/join3.q.xml b/ql/src/test/results/compiler/plan/join3.q.xml
index c44132b133..0a2adf7fcf 100644
--- a/ql/src/test/results/compiler/plan/join3.q.xml
+++ b/ql/src/test/results/compiler/plan/join3.q.xml
@@ -615,28 +615,35 @@
           <void property="alias"> 
            <string>src2</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -935,22 +942,35 @@
           <void property="alias"> 
            <string>src3</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_1</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -960,9 +980,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_1</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -1224,28 +1241,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_2</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_2</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/join4.q.xml b/ql/src/test/results/compiler/plan/join4.q.xml
index c7257e828f..acde2b449f 100644
--- a/ql/src/test/results/compiler/plan/join4.q.xml
+++ b/ql/src/test/results/compiler/plan/join4.q.xml
@@ -692,22 +692,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_3</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -717,9 +730,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_3</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -1239,22 +1249,35 @@
           <void property="alias"> 
            <string>src2</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1264,9 +1287,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/join5.q.xml b/ql/src/test/results/compiler/plan/join5.q.xml
index bc626689b0..c9a6c8fb60 100644
--- a/ql/src/test/results/compiler/plan/join5.q.xml
+++ b/ql/src/test/results/compiler/plan/join5.q.xml
@@ -692,22 +692,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_3</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -717,9 +730,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_3</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -1239,22 +1249,35 @@
           <void property="alias"> 
            <string>src2</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1264,9 +1287,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/join6.q.xml b/ql/src/test/results/compiler/plan/join6.q.xml
index 1e1866d40e..8dc1847611 100644
--- a/ql/src/test/results/compiler/plan/join6.q.xml
+++ b/ql/src/test/results/compiler/plan/join6.q.xml
@@ -692,22 +692,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_3</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -717,9 +730,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_3</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -1239,22 +1249,35 @@
           <void property="alias"> 
            <string>src2</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1264,9 +1287,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/join7.q.xml b/ql/src/test/results/compiler/plan/join7.q.xml
index 5f65ddb9f8..f6a4705da2 100644
--- a/ql/src/test/results/compiler/plan/join7.q.xml
+++ b/ql/src/test/results/compiler/plan/join7.q.xml
@@ -757,22 +757,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_6</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -782,9 +795,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_6</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -1304,22 +1314,35 @@
           <void property="alias"> 
            <string>src2</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1329,9 +1352,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -1847,22 +1867,35 @@
           <void property="alias"> 
            <string>src3</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_3</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1872,9 +1905,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_3</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/join8.q.xml b/ql/src/test/results/compiler/plan/join8.q.xml
index bb9ec1fbfe..14aceed4f2 100644
--- a/ql/src/test/results/compiler/plan/join8.q.xml
+++ b/ql/src/test/results/compiler/plan/join8.q.xml
@@ -733,22 +733,35 @@
           <void property="alias"> 
            <string>src1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_3</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -758,9 +771,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_3</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
@@ -1321,22 +1331,35 @@
           <void property="alias"> 
            <string>src2</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1346,9 +1369,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/sample1.q.xml b/ql/src/test/results/compiler/plan/sample1.q.xml
index be97dbe7f7..3aa69c25d0 100644
--- a/ql/src/test/results/compiler/plan/sample1.q.xml
+++ b/ql/src/test/results/compiler/plan/sample1.q.xml
@@ -776,34 +776,50 @@
           <void property="alias"> 
            <string>s</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
+        </void> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
-           <int>0</int> 
+           <string>key</string> 
           </void> 
           <void method="add"> 
-           <int>1</int> 
+           <string>value</string> 
           </void> 
-         </object> 
-        </void> 
-        <void property="neededColumns"> 
-         <object class="java.util.ArrayList"> 
           <void method="add"> 
-           <string>key</string> 
+           <string>ds</string> 
           </void> 
           <void method="add"> 
-           <string>value</string> 
+           <string>hr</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/sample2.q.xml b/ql/src/test/results/compiler/plan/sample2.q.xml
index d12bda410b..5444e75d15 100644
--- a/ql/src/test/results/compiler/plan/sample2.q.xml
+++ b/ql/src/test/results/compiler/plan/sample2.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_4</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -1082,22 +1086,35 @@
           <void property="alias"> 
            <string>s</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1107,9 +1124,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/sample3.q.xml b/ql/src/test/results/compiler/plan/sample3.q.xml
index 01ae0c5e57..20d4bd603c 100644
--- a/ql/src/test/results/compiler/plan/sample3.q.xml
+++ b/ql/src/test/results/compiler/plan/sample3.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_4</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -1092,22 +1096,35 @@
           <void property="alias"> 
            <string>s</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1117,9 +1134,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/sample4.q.xml b/ql/src/test/results/compiler/plan/sample4.q.xml
index d12bda410b..5444e75d15 100644
--- a/ql/src/test/results/compiler/plan/sample4.q.xml
+++ b/ql/src/test/results/compiler/plan/sample4.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_4</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -1082,22 +1086,35 @@
           <void property="alias"> 
            <string>s</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1107,9 +1124,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/sample5.q.xml b/ql/src/test/results/compiler/plan/sample5.q.xml
index e27ac08fe7..cc0b4ad709 100644
--- a/ql/src/test/results/compiler/plan/sample5.q.xml
+++ b/ql/src/test/results/compiler/plan/sample5.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_4</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -1079,22 +1083,35 @@
           <void property="alias"> 
            <string>s</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1104,9 +1121,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/sample6.q.xml b/ql/src/test/results/compiler/plan/sample6.q.xml
index c496604f67..393de6729a 100644
--- a/ql/src/test/results/compiler/plan/sample6.q.xml
+++ b/ql/src/test/results/compiler/plan/sample6.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_4</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -1082,22 +1086,35 @@
           <void property="alias"> 
            <string>s</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1107,9 +1124,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/sample7.q.xml b/ql/src/test/results/compiler/plan/sample7.q.xml
index 0b39977a3b..7f04f45306 100644
--- a/ql/src/test/results/compiler/plan/sample7.q.xml
+++ b/ql/src/test/results/compiler/plan/sample7.q.xml
@@ -219,31 +219,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>key</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>value</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>key</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>value</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_6</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -1127,22 +1131,35 @@
           <void property="alias"> 
            <string>s</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1152,9 +1169,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/subq.q.xml b/ql/src/test/results/compiler/plan/subq.q.xml
index ad6361519f..263810cdb7 100644
--- a/ql/src/test/results/compiler/plan/subq.q.xml
+++ b/ql/src/test/results/compiler/plan/subq.q.xml
@@ -152,31 +152,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>_col0</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>_col1</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>_col0</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>_col1</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_6</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -809,22 +813,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -834,9 +851,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/udf1.q.xml b/ql/src/test/results/compiler/plan/udf1.q.xml
index 3e944ad208..09dbbd80c1 100644
--- a/ql/src/test/results/compiler/plan/udf1.q.xml
+++ b/ql/src/test/results/compiler/plan/udf1.q.xml
@@ -1819,28 +1819,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/udf4.q.xml b/ql/src/test/results/compiler/plan/udf4.q.xml
index 61434ead23..907c4b73c8 100644
--- a/ql/src/test/results/compiler/plan/udf4.q.xml
+++ b/ql/src/test/results/compiler/plan/udf4.q.xml
@@ -1600,20 +1600,23 @@
           <void property="alias"> 
            <string>dest1</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"/> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"/> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"/> 
-        </void> 
-        <void property="neededColumns"> 
-         <object class="java.util.ArrayList"/> 
-        </void> 
         <void property="operatorId"> 
          <string>TS_0</string> 
         </void> 
+        <void property="referencedColumns"> 
+         <object class="java.util.ArrayList"/> 
+        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/udf6.q.xml b/ql/src/test/results/compiler/plan/udf6.q.xml
index c04aabaca4..a510dd3641 100644
--- a/ql/src/test/results/compiler/plan/udf6.q.xml
+++ b/ql/src/test/results/compiler/plan/udf6.q.xml
@@ -457,20 +457,23 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"/> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"/> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"/> 
-        </void> 
-        <void property="neededColumns"> 
-         <object class="java.util.ArrayList"/> 
-        </void> 
         <void property="operatorId"> 
          <string>TS_0</string> 
         </void> 
+        <void property="referencedColumns"> 
+         <object class="java.util.ArrayList"/> 
+        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/udf_case.q.xml b/ql/src/test/results/compiler/plan/udf_case.q.xml
index 40fe4509d5..5d172088be 100644
--- a/ql/src/test/results/compiler/plan/udf_case.q.xml
+++ b/ql/src/test/results/compiler/plan/udf_case.q.xml
@@ -537,20 +537,23 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"/> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"/> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"/> 
-        </void> 
-        <void property="neededColumns"> 
-         <object class="java.util.ArrayList"/> 
-        </void> 
         <void property="operatorId"> 
          <string>TS_0</string> 
         </void> 
+        <void property="referencedColumns"> 
+         <object class="java.util.ArrayList"/> 
+        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/udf_when.q.xml b/ql/src/test/results/compiler/plan/udf_when.q.xml
index 6b73dbd8c5..003bd8428a 100644
--- a/ql/src/test/results/compiler/plan/udf_when.q.xml
+++ b/ql/src/test/results/compiler/plan/udf_when.q.xml
@@ -617,20 +617,23 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"/> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"/> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"/> 
-        </void> 
-        <void property="neededColumns"> 
-         <object class="java.util.ArrayList"/> 
-        </void> 
         <void property="operatorId"> 
          <string>TS_0</string> 
         </void> 
+        <void property="referencedColumns"> 
+         <object class="java.util.ArrayList"/> 
+        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
diff --git a/ql/src/test/results/compiler/plan/union.q.xml b/ql/src/test/results/compiler/plan/union.q.xml
index 34224e08b2..9b46fce338 100644
--- a/ql/src/test/results/compiler/plan/union.q.xml
+++ b/ql/src/test/results/compiler/plan/union.q.xml
@@ -152,31 +152,35 @@
                          </void> 
                         </void> 
                         <void property="conf"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"/> 
-                        </void> 
-                        <void property="neededColumnIDs"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <int>0</int> 
-                          </void> 
-                          <void method="add"> 
-                           <int>1</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void property="neededColumns"> 
-                         <object class="java.util.ArrayList"> 
-                          <void method="add"> 
-                           <string>_col0</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.TableScanDesc"> 
+                          <void property="neededColumnIDs"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <int>0</int> 
+                            </void> 
+                            <void method="add"> 
+                             <int>1</int> 
+                            </void> 
+                           </object> 
                           </void> 
-                          <void method="add"> 
-                           <string>_col1</string> 
+                          <void property="neededColumns"> 
+                           <object id="ArrayList1" class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <string>_col0</string> 
+                            </void> 
+                            <void method="add"> 
+                             <string>_col1</string> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="operatorId"> 
                          <string>TS_11</string> 
                         </void> 
+                        <void property="referencedColumns"> 
+                         <object idref="ArrayList1"/> 
+                        </void> 
                         <void property="schema"> 
                          <object idref="RowSchema0"/> 
                         </void> 
@@ -954,22 +958,35 @@
                             <void property="alias"> 
                              <string>src</string> 
                             </void> 
+                            <void property="neededColumnIDs"> 
+                             <object class="java.util.ArrayList"> 
+                              <void method="add"> 
+                               <int>0</int> 
+                              </void> 
+                              <void method="add"> 
+                               <int>1</int> 
+                              </void> 
+                             </object> 
+                            </void> 
+                            <void property="neededColumns"> 
+                             <object class="java.util.ArrayList"> 
+                              <void method="add"> 
+                               <string>key</string> 
+                              </void> 
+                              <void method="add"> 
+                               <string>value</string> 
+                              </void> 
+                             </object> 
+                            </void> 
                             <void property="virtualCols"> 
                              <object class="java.util.ArrayList"/> 
                             </void> 
                            </object> 
                           </void> 
-                          <void property="neededColumnIDs"> 
-                           <object class="java.util.ArrayList"> 
-                            <void method="add"> 
-                             <int>0</int> 
-                            </void> 
-                            <void method="add"> 
-                             <int>1</int> 
-                            </void> 
-                           </object> 
+                          <void property="operatorId"> 
+                           <string>TS_3</string> 
                           </void> 
-                          <void property="neededColumns"> 
+                          <void property="referencedColumns"> 
                            <object class="java.util.ArrayList"> 
                             <void method="add"> 
                              <string>key</string> 
@@ -979,9 +996,6 @@
                             </void> 
                            </object> 
                           </void> 
-                          <void property="operatorId"> 
-                           <string>TS_3</string> 
-                          </void> 
                           <void property="schema"> 
                            <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
                             <void property="signature"> 
@@ -1374,22 +1388,35 @@
           <void property="alias"> 
            <string>src</string> 
           </void> 
+          <void property="neededColumnIDs"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <int>0</int> 
+            </void> 
+            <void method="add"> 
+             <int>1</int> 
+            </void> 
+           </object> 
+          </void> 
+          <void property="neededColumns"> 
+           <object class="java.util.ArrayList"> 
+            <void method="add"> 
+             <string>key</string> 
+            </void> 
+            <void method="add"> 
+             <string>value</string> 
+            </void> 
+           </object> 
+          </void> 
           <void property="virtualCols"> 
            <object class="java.util.ArrayList"/> 
           </void> 
          </object> 
         </void> 
-        <void property="neededColumnIDs"> 
-         <object class="java.util.ArrayList"> 
-          <void method="add"> 
-           <int>0</int> 
-          </void> 
-          <void method="add"> 
-           <int>1</int> 
-          </void> 
-         </object> 
+        <void property="operatorId"> 
+         <string>TS_0</string> 
         </void> 
-        <void property="neededColumns"> 
+        <void property="referencedColumns"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
            <string>key</string> 
@@ -1399,9 +1426,6 @@
           </void> 
          </object> 
         </void> 
-        <void property="operatorId"> 
-         <string>TS_0</string> 
-        </void> 
         <void property="schema"> 
          <object class="org.apache.hadoop.hive.ql.exec.RowSchema"> 
           <void property="signature"> 
