diff --git a/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java b/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
index ae766f75e5..f167fad0a6 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
@@ -318,15 +318,15 @@ public QTestUtil(String outDir, String logDir, boolean miniMr, String hadoopVer)
   public void shutdown() throws Exception {
     cleanUp();
     setup.tearDown();
-    if (dfs != null) {
-      dfs.shutdown();
-      dfs = null;
-    }
-
     if (mr != null) {
       mr.shutdown();
       mr = null;
     }
+    FileSystem.closeAll();
+    if (dfs != null) {
+      dfs.shutdown();
+      dfs = null;
+    }
   }
 
   public void addFile(String qFile) throws Exception {
