diff --git a/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/utils/MetaStoreServerUtils.java b/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/utils/MetaStoreServerUtils.java
index d4bb8d4702..6a15b089cd 100644
--- a/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/utils/MetaStoreServerUtils.java
+++ b/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/utils/MetaStoreServerUtils.java
@@ -22,9 +22,11 @@
 import java.lang.reflect.InvocationTargetException;
 import java.math.BigDecimal;
 import java.math.BigInteger;
+import java.net.InetAddress;
 import java.net.InetSocketAddress;
 import java.net.ServerSocket;
 import java.net.Socket;
+import java.net.UnknownHostException;
 import java.nio.charset.Charset;
 import java.nio.charset.StandardCharsets;
 import java.security.MessageDigest;
@@ -795,7 +797,15 @@ public static boolean checkUserHasHostProxyPrivileges(String user, Configuration
     Map<String, Collection<String>> proxyHosts = sip.getProxyHosts();
     Collection<String> hostEntries = proxyHosts.get(sip.getProxySuperuserIpConfKey(user));
     MachineList machineList = new MachineList(hostEntries);
-    ipAddress = (ipAddress == null) ? StringUtils.EMPTY : ipAddress;
+    // when schematool or metatool use this, its possible that the saslServer.getRemoteAddress() returns null
+    // use localhost address first to see if it part of hadoop.proxyuser hosts.
+    if (ipAddress == null) {
+      try {
+        ipAddress = InetAddress.getLocalHost().getHostAddress();
+      } catch (UnknownHostException e) {
+        ipAddress = StringUtils.EMPTY;
+      }
+    }
     return machineList.includes(ipAddress);
   }
 
