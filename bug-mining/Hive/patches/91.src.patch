diff --git a/CHANGES.txt b/CHANGES.txt
index 0bb0c88c3f..69e6309fb7 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -55,6 +55,9 @@ Trunk (unreleased changes)
     HIVE-253. Fix to disallow computation of rand() at compilation stage.
     (Raghotham Murthy via namit)
 
+    HIVE-350. Fix wrong order of aggregations in explain plan.
+    (namit)
+
 Release 0.2.0 - Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/QBParseInfo.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/QBParseInfo.java
index 15c3467523..af62c878b6 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/QBParseInfo.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/QBParseInfo.java
@@ -58,7 +58,7 @@ public class QBParseInfo {
   private int outerQueryLimit;
 
   // used by GroupBy
-  private HashMap<String, HashMap<String, ASTNode> > destToAggregationExprs;
+  private LinkedHashMap<String, LinkedHashMap<String, ASTNode> > destToAggregationExprs;
   private HashMap<String, ASTNode> destToDistinctFuncExpr;
 
   @SuppressWarnings("unused")
@@ -76,7 +76,7 @@ public QBParseInfo(String alias, boolean isSubQ) {
     this.destToSortby = new HashMap<String, ASTNode>();
     this.destToLimit = new HashMap<String, Integer>();
     
-    this.destToAggregationExprs = new HashMap<String, HashMap<String, ASTNode> >();
+    this.destToAggregationExprs = new LinkedHashMap<String, LinkedHashMap<String, ASTNode> >();
     this.destToDistinctFuncExpr = new HashMap<String, ASTNode>();
     
     this.alias = alias;
@@ -84,7 +84,7 @@ public QBParseInfo(String alias, boolean isSubQ) {
     this.outerQueryLimit = -1;
   }
 
-  public void setAggregationExprsForClause(String clause, HashMap<String, ASTNode> aggregationTrees) {
+  public void setAggregationExprsForClause(String clause, LinkedHashMap<String, ASTNode> aggregationTrees) {
     this.destToAggregationExprs.put(clause, aggregationTrees);
   }
 
@@ -273,7 +273,7 @@ public boolean isSelectStarQuery() {
        (!destToClusterby.isEmpty()))
       return false;
     
-    Iterator<Map.Entry<String, HashMap<String, ASTNode>>> aggrIter = destToAggregationExprs.entrySet().iterator();
+    Iterator<Map.Entry<String, LinkedHashMap<String, ASTNode>>> aggrIter = destToAggregationExprs.entrySet().iterator();
     while (aggrIter.hasNext()) {
       HashMap<String, ASTNode> h = aggrIter.next().getValue();
       if ((h != null) && (!h.isEmpty()))
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
index c17049184f..0e80506db3 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
@@ -170,11 +170,11 @@ public void doPhase1QBExpr(ASTNode ast, QBExpr qbexpr, String id,
     }
   }
 
-  private HashMap<String, ASTNode> doPhase1GetAggregationsFromSelect(
+  private LinkedHashMap<String, ASTNode> doPhase1GetAggregationsFromSelect(
       ASTNode selExpr) {
     // Iterate over the selects search for aggregation Trees.
     // Use String as keys to eliminate duplicate trees.
-    HashMap<String, ASTNode> aggregationTrees = new HashMap<String, ASTNode>();
+    LinkedHashMap<String, ASTNode> aggregationTrees = new LinkedHashMap<String, ASTNode>();
     for (int i = 0; i < selExpr.getChildCount(); ++i) {
       ASTNode sel = (ASTNode) selExpr.getChild(i).getChild(0);
       doPhase1GetAllAggregations(sel, aggregationTrees);
@@ -348,7 +348,7 @@ public void doPhase1(ASTNode ast, QB qb, Phase1Ctx ctx_1)
       case HiveParser.TOK_SELECT:
         qb.countSel();
         qbp.setSelExprForClause(ctx_1.dest, ast);
-        HashMap<String, ASTNode> aggregations = doPhase1GetAggregationsFromSelect(ast);
+        LinkedHashMap<String, ASTNode> aggregations = doPhase1GetAggregationsFromSelect(ast);
         qbp.setAggregationExprsForClause(ctx_1.dest, aggregations);
         qbp.setDistinctFuncExprForClause(ctx_1.dest,
             doPhase1GetDistinctFuncExpr(aggregations));
diff --git a/ql/src/test/results/clientpositive/groupby2.q.out b/ql/src/test/results/clientpositive/groupby2.q.out
index ec42f2077c..1f281527f4 100644
--- a/ql/src/test/results/clientpositive/groupby2.q.out
+++ b/ql/src/test/results/clientpositive/groupby2.q.out
@@ -27,8 +27,8 @@ STAGE PLANS:
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: sum(UDFToDouble(KEY.1))
                 expr: count(DISTINCT KEY.1)
+                expr: sum(UDFToDouble(KEY.1))
           keys:
                 expr: KEY.0
                 type: string
@@ -44,7 +44,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/suresh/hive_external/build/ql/tmp/1095000566/646137573.10001 
+        /data/users/njain/hive2/hive/build/ql/tmp/458651873/137748425.10001 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -56,14 +56,14 @@ STAGE PLANS:
             tag: -1
             value expressions:
                   expr: 1
-                  type: double
-                  expr: 2
                   type: bigint
+                  expr: 2
+                  type: double
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: sum(VALUE.0)
-                expr: count(VALUE.1)
+                expr: count(VALUE.0)
+                expr: sum(VALUE.1)
           keys:
                 expr: KEY.0
                 type: string
@@ -72,9 +72,9 @@ STAGE PLANS:
             expressions:
                   expr: 0
                   type: string
-                  expr: 2
+                  expr: 1
                   type: bigint
-                  expr: concat(0, UDFToString(1))
+                  expr: concat(0, UDFToString(2))
                   type: string
             File Output Operator
               compressed: false
diff --git a/ql/src/test/results/clientpositive/groupby2_map.q.out b/ql/src/test/results/clientpositive/groupby2_map.q.out
index f7f6b22cf8..52e63d9380 100644
--- a/ql/src/test/results/clientpositive/groupby2_map.q.out
+++ b/ql/src/test/results/clientpositive/groupby2_map.q.out
@@ -12,8 +12,8 @@ STAGE PLANS:
         src 
             Group By Operator
               aggregations:
-                    expr: sum(UDFToDouble(substr(value, 5)))
                     expr: count(DISTINCT substr(value, 5))
+                    expr: sum(UDFToDouble(substr(value, 5)))
               keys:
                     expr: substr(key, 1, 1)
                     type: string
@@ -33,14 +33,14 @@ STAGE PLANS:
                 tag: -1
                 value expressions:
                       expr: 2
-                      type: double
-                      expr: 3
                       type: bigint
+                      expr: 3
+                      type: double
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: sum(VALUE.0)
                 expr: count(DISTINCT KEY.1)
+                expr: sum(VALUE.1)
           keys:
                 expr: KEY.0
                 type: string
@@ -49,9 +49,9 @@ STAGE PLANS:
             expressions:
                   expr: 0
                   type: string
-                  expr: 2
+                  expr: 1
                   type: bigint
-                  expr: concat(0, UDFToString(1))
+                  expr: concat(0, UDFToString(2))
                   type: string
             File Output Operator
               compressed: false
diff --git a/ql/src/test/results/clientpositive/groupby2_map_skew.q.out b/ql/src/test/results/clientpositive/groupby2_map_skew.q.out
index b4af31d457..40a8df3503 100644
--- a/ql/src/test/results/clientpositive/groupby2_map_skew.q.out
+++ b/ql/src/test/results/clientpositive/groupby2_map_skew.q.out
@@ -13,8 +13,8 @@ STAGE PLANS:
         src 
             Group By Operator
               aggregations:
-                    expr: sum(UDFToDouble(substr(value, 5)))
                     expr: count(DISTINCT substr(value, 5))
+                    expr: sum(UDFToDouble(substr(value, 5)))
               keys:
                     expr: substr(key, 1, 1)
                     type: string
@@ -36,14 +36,14 @@ STAGE PLANS:
                 tag: -1
                 value expressions:
                       expr: 2
-                      type: double
-                      expr: 3
                       type: bigint
+                      expr: 3
+                      type: double
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: sum(VALUE.0)
                 expr: count(DISTINCT KEY.1)
+                expr: sum(VALUE.1)
           keys:
                 expr: KEY.0
                 type: string
@@ -59,7 +59,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/njain/hive1/hive/build/ql/tmp/75626022/245324029.10001 
+        /data/users/njain/hive2/hive/build/ql/tmp/76959905/5017405.10001 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -71,14 +71,14 @@ STAGE PLANS:
             tag: -1
             value expressions:
                   expr: 1
-                  type: double
-                  expr: 2
                   type: bigint
+                  expr: 2
+                  type: double
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: sum(VALUE.0)
-                expr: count(VALUE.1)
+                expr: count(VALUE.0)
+                expr: sum(VALUE.1)
           keys:
                 expr: KEY.0
                 type: string
@@ -87,9 +87,9 @@ STAGE PLANS:
             expressions:
                   expr: 0
                   type: string
-                  expr: 2
+                  expr: 1
                   type: bigint
-                  expr: concat(0, UDFToString(1))
+                  expr: concat(0, UDFToString(2))
                   type: string
             File Output Operator
               compressed: false
diff --git a/ql/src/test/results/clientpositive/groupby2_noskew.q.out b/ql/src/test/results/clientpositive/groupby2_noskew.q.out
index e81f5ea27e..c91e1b5af3 100644
--- a/ql/src/test/results/clientpositive/groupby2_noskew.q.out
+++ b/ql/src/test/results/clientpositive/groupby2_noskew.q.out
@@ -24,8 +24,8 @@ STAGE PLANS:
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: sum(UDFToDouble(KEY.1))
                 expr: count(DISTINCT KEY.1)
+                expr: sum(UDFToDouble(KEY.1))
           keys:
                 expr: KEY.0
                 type: string
@@ -34,9 +34,9 @@ STAGE PLANS:
             expressions:
                   expr: 0
                   type: string
-                  expr: 2
+                  expr: 1
                   type: bigint
-                  expr: concat(0, UDFToString(1))
+                  expr: concat(0, UDFToString(2))
                   type: string
             File Output Operator
               compressed: false
diff --git a/ql/src/test/results/clientpositive/groupby3.q.out b/ql/src/test/results/clientpositive/groupby3.q.out
index 2f95543430..d497b9ab7c 100644
--- a/ql/src/test/results/clientpositive/groupby3.q.out
+++ b/ql/src/test/results/clientpositive/groupby3.q.out
@@ -28,10 +28,10 @@ STAGE PLANS:
         Group By Operator
           aggregations:
                 expr: sum(UDFToDouble(KEY.0))
-                expr: max(KEY.0)
+                expr: avg(UDFToDouble(KEY.0))
                 expr: avg(DISTINCT UDFToDouble(KEY.0))
+                expr: max(KEY.0)
                 expr: min(KEY.0)
-                expr: avg(UDFToDouble(KEY.0))
           mode: partial1
           File Output Operator
             compressed: false
@@ -44,7 +44,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/suresh/hive_external/build/ql/tmp/383523376/581113300.10001 
+        /data/users/njain/hive2/hive/build/ql/tmp/513475036/98479737.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
@@ -63,23 +63,23 @@ STAGE PLANS:
         Group By Operator
           aggregations:
                 expr: sum(VALUE.0)
-                expr: max(VALUE.1)
+                expr: avg(VALUE.1)
                 expr: avg(VALUE.2)
-                expr: min(VALUE.3)
-                expr: avg(VALUE.4)
+                expr: max(VALUE.3)
+                expr: min(VALUE.4)
           mode: final
           Select Operator
             expressions:
                   expr: 0
                   type: double
-                  expr: 4
+                  expr: 1
                   type: double
                   expr: 2
                   type: double
-                  expr: 1
-                  type: string
                   expr: 3
                   type: string
+                  expr: 4
+                  type: string
             File Output Operator
               compressed: false
               GlobalTableId: 1
diff --git a/ql/src/test/results/clientpositive/groupby3_map.q.out b/ql/src/test/results/clientpositive/groupby3_map.q.out
index fd2444559b..619a4365f5 100644
--- a/ql/src/test/results/clientpositive/groupby3_map.q.out
+++ b/ql/src/test/results/clientpositive/groupby3_map.q.out
@@ -17,10 +17,10 @@ STAGE PLANS:
               Group By Operator
                 aggregations:
                       expr: sum(UDFToDouble(substr(0, 5)))
-                      expr: max(substr(0, 5))
+                      expr: avg(UDFToDouble(substr(0, 5)))
                       expr: avg(DISTINCT UDFToDouble(substr(0, 5)))
+                      expr: max(substr(0, 5))
                       expr: min(substr(0, 5))
-                      expr: avg(UDFToDouble(substr(0, 5)))
                 keys:
                       expr: substr(0, 5)
                       type: string
@@ -46,23 +46,23 @@ STAGE PLANS:
         Group By Operator
           aggregations:
                 expr: sum(VALUE.0)
-                expr: max(VALUE.1)
+                expr: avg(VALUE.1)
                 expr: avg(DISTINCT UDFToDouble(KEY.0))
-                expr: min(VALUE.3)
-                expr: avg(VALUE.4)
+                expr: max(VALUE.3)
+                expr: min(VALUE.4)
           mode: mergepartial
           Select Operator
             expressions:
                   expr: 0
                   type: double
-                  expr: 4
+                  expr: 1
                   type: double
                   expr: 2
                   type: double
-                  expr: 1
-                  type: string
                   expr: 3
                   type: string
+                  expr: 4
+                  type: string
             File Output Operator
               compressed: false
               GlobalTableId: 1
diff --git a/ql/src/test/results/clientpositive/groupby3_map_skew.q.out b/ql/src/test/results/clientpositive/groupby3_map_skew.q.out
index 64535ae3f8..aee4f31bbc 100644
--- a/ql/src/test/results/clientpositive/groupby3_map_skew.q.out
+++ b/ql/src/test/results/clientpositive/groupby3_map_skew.q.out
@@ -18,10 +18,10 @@ STAGE PLANS:
               Group By Operator
                 aggregations:
                       expr: sum(UDFToDouble(substr(0, 5)))
-                      expr: max(substr(0, 5))
+                      expr: avg(UDFToDouble(substr(0, 5)))
                       expr: avg(DISTINCT UDFToDouble(substr(0, 5)))
+                      expr: max(substr(0, 5))
                       expr: min(substr(0, 5))
-                      expr: avg(UDFToDouble(substr(0, 5)))
                 keys:
                       expr: substr(0, 5)
                       type: string
@@ -50,10 +50,10 @@ STAGE PLANS:
         Group By Operator
           aggregations:
                 expr: sum(VALUE.0)
-                expr: max(VALUE.1)
+                expr: avg(VALUE.1)
                 expr: avg(DISTINCT UDFToDouble(KEY.0))
-                expr: min(VALUE.3)
-                expr: avg(VALUE.4)
+                expr: max(VALUE.3)
+                expr: min(VALUE.4)
           mode: partial2
           File Output Operator
             compressed: false
@@ -66,7 +66,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/njain/hive1/hive/build/ql/tmp/60912787/134510876.10001 
+        /data/users/njain/hive2/hive/build/ql/tmp/189942724/9179609.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
@@ -85,23 +85,23 @@ STAGE PLANS:
         Group By Operator
           aggregations:
                 expr: sum(VALUE.0)
-                expr: max(VALUE.1)
+                expr: avg(VALUE.1)
                 expr: avg(VALUE.2)
-                expr: min(VALUE.3)
-                expr: avg(VALUE.4)
+                expr: max(VALUE.3)
+                expr: min(VALUE.4)
           mode: final
           Select Operator
             expressions:
                   expr: 0
                   type: double
-                  expr: 4
+                  expr: 1
                   type: double
                   expr: 2
                   type: double
-                  expr: 1
-                  type: string
                   expr: 3
                   type: string
+                  expr: 4
+                  type: string
             File Output Operator
               compressed: false
               GlobalTableId: 1
diff --git a/ql/src/test/results/clientpositive/groupby3_noskew.q.out b/ql/src/test/results/clientpositive/groupby3_noskew.q.out
index b203c90a94..9b2f21447f 100644
--- a/ql/src/test/results/clientpositive/groupby3_noskew.q.out
+++ b/ql/src/test/results/clientpositive/groupby3_noskew.q.out
@@ -24,23 +24,23 @@ STAGE PLANS:
         Group By Operator
           aggregations:
                 expr: sum(UDFToDouble(KEY.0))
-                expr: max(KEY.0)
+                expr: avg(UDFToDouble(KEY.0))
                 expr: avg(DISTINCT UDFToDouble(KEY.0))
+                expr: max(KEY.0)
                 expr: min(KEY.0)
-                expr: avg(UDFToDouble(KEY.0))
           mode: complete
           Select Operator
             expressions:
                   expr: 0
                   type: double
-                  expr: 4
+                  expr: 1
                   type: double
                   expr: 2
                   type: double
-                  expr: 1
-                  type: string
                   expr: 3
                   type: string
+                  expr: 4
+                  type: string
             File Output Operator
               compressed: false
               GlobalTableId: 1
diff --git a/ql/src/test/results/clientpositive/udf3.q.out b/ql/src/test/results/clientpositive/udf3.q.out
index c7a4db1eb0..cfb629f0ce 100644
--- a/ql/src/test/results/clientpositive/udf3.q.out
+++ b/ql/src/test/results/clientpositive/udf3.q.out
@@ -13,46 +13,46 @@ STAGE PLANS:
             Select Operator
               Group By Operator
                 aggregations:
-                      expr: max(UDFToInteger(''))
-                      expr: avg(UDFToDouble(UDFToInteger('')))
                       expr: count(UDFToInteger(''))
                       expr: sum(UDFToDouble(UDFToInteger('')))
+                      expr: avg(UDFToDouble(UDFToInteger('')))
                       expr: min(UDFToInteger(''))
+                      expr: max(UDFToInteger(''))
                 mode: hash
                 Reduce Output Operator
                   sort order: 
                   tag: -1
                   value expressions:
                         expr: 0
-                        type: int
+                        type: bigint
                         expr: 1
-                        type: string
+                        type: double
                         expr: 2
-                        type: bigint
+                        type: string
                         expr: 3
-                        type: double
+                        type: int
                         expr: 4
                         type: int
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: max(VALUE.0)
-                expr: avg(VALUE.1)
-                expr: count(VALUE.2)
-                expr: sum(VALUE.3)
-                expr: min(VALUE.4)
+                expr: count(VALUE.0)
+                expr: sum(VALUE.1)
+                expr: avg(VALUE.2)
+                expr: min(VALUE.3)
+                expr: max(VALUE.4)
           mode: mergepartial
           Select Operator
             expressions:
-                  expr: 2
+                  expr: 0
                   type: bigint
-                  expr: 3
-                  type: double
                   expr: 1
                   type: double
-                  expr: 4
+                  expr: 2
+                  type: double
+                  expr: 3
                   type: int
-                  expr: 0
+                  expr: 4
                   type: int
             File Output Operator
               compressed: false
diff --git a/ql/src/test/results/clientpositive/udf8.q.out b/ql/src/test/results/clientpositive/udf8.q.out
index a4cfb0fa85..e24af78d5f 100644
--- a/ql/src/test/results/clientpositive/udf8.q.out
+++ b/ql/src/test/results/clientpositive/udf8.q.out
@@ -12,34 +12,34 @@ STAGE PLANS:
         dest1 
             Group By Operator
               aggregations:
+                    expr: avg(UDFToDouble(c1))
                     expr: sum(UDFToDouble(c1))
                     expr: count(c1)
-                    expr: avg(UDFToDouble(c1))
               mode: hash
               Reduce Output Operator
                 sort order: 
                 tag: -1
                 value expressions:
                       expr: 0
-                      type: double
+                      type: string
                       expr: 1
-                      type: bigint
+                      type: double
                       expr: 2
-                      type: string
+                      type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: sum(VALUE.0)
-                expr: count(VALUE.1)
-                expr: avg(VALUE.2)
+                expr: avg(VALUE.0)
+                expr: sum(VALUE.1)
+                expr: count(VALUE.2)
           mode: mergepartial
           Select Operator
             expressions:
-                  expr: 2
-                  type: double
                   expr: 0
                   type: double
                   expr: 1
+                  type: double
+                  expr: 2
                   type: bigint
             File Output Operator
               compressed: false
diff --git a/ql/src/test/results/compiler/plan/groupby2.q.xml b/ql/src/test/results/compiler/plan/groupby2.q.xml
index 97f2063b82..23d754fb13 100755
--- a/ql/src/test/results/compiler/plan/groupby2.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby2.q.xml
@@ -105,7 +105,7 @@
                       <void property="typeInfo"> 
                        <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                         <void property="primitiveClass"> 
-                         <class>java.lang.Double</class> 
+                         <class>java.lang.Long</class> 
                         </void> 
                        </object> 
                       </void> 
@@ -119,7 +119,7 @@
                       <void property="typeInfo"> 
                        <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                         <void property="primitiveClass"> 
-                         <class>java.lang.Long</class> 
+                         <class>java.lang.Double</class> 
                         </void> 
                        </object> 
                       </void> 
@@ -146,7 +146,7 @@
                       </void> 
                       <void method="put"> 
                        <string>serialization.ddl</string> 
-                       <string>struct binary_table { double reducesinkvalue0, i64 reducesinkvalue1}</string> 
+                       <string>struct binary_table { i64 reducesinkvalue0, double reducesinkvalue1}</string> 
                       </void> 
                       <void method="put"> 
                        <string>serialization.format</string> 
@@ -234,6 +234,71 @@
               </void> 
               <void property="aggregators"> 
                <object class="java.util.ArrayList"> 
+                <void method="add"> 
+                 <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
+                  <void property="aggregationClass"> 
+                   <class>org.apache.hadoop.hive.ql.udf.UDAFCount</class> 
+                  </void> 
+                  <void property="distinct"> 
+                   <boolean>true</boolean> 
+                  </void> 
+                  <void property="parameters"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                      <void property="UDFClass"> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDFSubstr</class> 
+                      </void> 
+                      <void property="UDFMethod"> 
+                       <object class="org.apache.hadoop.hive.ql.udf.UDFSubstr" method="getMethod"> 
+                        <string>evaluate</string> 
+                        <array class="java.lang.Class" length="2"> 
+                         <void index="0"> 
+                          <class>java.lang.String</class> 
+                         </void> 
+                         <void index="1"> 
+                          <class>java.lang.Integer</class> 
+                         </void> 
+                        </array> 
+                       </object> 
+                      </void> 
+                      <void property="children"> 
+                       <object class="java.util.ArrayList"> 
+                        <void method="add"> 
+                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                          <void property="column"> 
+                           <string>value</string> 
+                          </void> 
+                          <void property="typeInfo"> 
+                           <object idref="PrimitiveTypeInfo0"/> 
+                          </void> 
+                         </object> 
+                        </void> 
+                        <void method="add"> 
+                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                          <void property="typeInfo"> 
+                           <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                            <void property="primitiveClass"> 
+                             <class>java.lang.Integer</class> 
+                            </void> 
+                           </object> 
+                          </void> 
+                          <void property="value"> 
+                           <int>5</int> 
+                          </void> 
+                         </object> 
+                        </void> 
+                       </object> 
+                      </void> 
+                      <void property="typeInfo"> 
+                       <object idref="PrimitiveTypeInfo0"/> 
+                      </void> 
+                     </object> 
+                    </void> 
+                   </object> 
+                  </void> 
+                 </object> 
+                </void> 
                 <void method="add"> 
                  <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                   <void property="aggregationClass"> 
@@ -291,11 +356,7 @@
                             <void method="add"> 
                              <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                               <void property="typeInfo"> 
-                               <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                                <void property="primitiveClass"> 
-                                 <class>java.lang.Integer</class> 
-                                </void> 
-                               </object> 
+                               <object idref="PrimitiveTypeInfo3"/> 
                               </void> 
                               <void property="value"> 
                                <int>5</int> 
@@ -312,68 +373,7 @@
                        </object> 
                       </void> 
                       <void property="typeInfo"> 
-                       <object idref="PrimitiveTypeInfo1"/> 
-                      </void> 
-                     </object> 
-                    </void> 
-                   </object> 
-                  </void> 
-                 </object> 
-                </void> 
-                <void method="add"> 
-                 <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
-                  <void property="aggregationClass"> 
-                   <class>org.apache.hadoop.hive.ql.udf.UDAFCount</class> 
-                  </void> 
-                  <void property="distinct"> 
-                   <boolean>true</boolean> 
-                  </void> 
-                  <void property="parameters"> 
-                   <object class="java.util.ArrayList"> 
-                    <void method="add"> 
-                     <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
-                      <void property="UDFClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDFSubstr</class> 
-                      </void> 
-                      <void property="UDFMethod"> 
-                       <object class="org.apache.hadoop.hive.ql.udf.UDFSubstr" method="getMethod"> 
-                        <string>evaluate</string> 
-                        <array class="java.lang.Class" length="2"> 
-                         <void index="0"> 
-                          <class>java.lang.String</class> 
-                         </void> 
-                         <void index="1"> 
-                          <class>java.lang.Integer</class> 
-                         </void> 
-                        </array> 
-                       </object> 
-                      </void> 
-                      <void property="children"> 
-                       <object class="java.util.ArrayList"> 
-                        <void method="add"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                          <void property="column"> 
-                           <string>value</string> 
-                          </void> 
-                          <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
-                          </void> 
-                         </object> 
-                        </void> 
-                        <void method="add"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                          <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo3"/> 
-                          </void> 
-                          <void property="value"> 
-                           <int>5</int> 
-                          </void> 
-                         </object> 
-                        </void> 
-                       </object> 
-                      </void> 
-                      <void property="typeInfo"> 
-                       <object idref="PrimitiveTypeInfo0"/> 
+                       <object idref="PrimitiveTypeInfo2"/> 
                       </void> 
                      </object> 
                     </void> 
@@ -617,7 +617,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -629,7 +629,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -685,7 +685,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
@@ -711,7 +711,7 @@
               <void property="conf"> 
                <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                 <void property="dirName"> 
-                 <string>/data/users/njain/hive1/hive/ql/../build/ql/tmp/10857281/717275265.10001.insclause-0</string> 
+                 <string>/data/users/njain/hive2/hive/ql/../build/ql/tmp/86661890/270948052.10001.insclause-0</string> 
                 </void> 
                 <void property="tableInfo"> 
                  <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -770,7 +770,7 @@
                      <string>1</string> 
                     </void> 
                     <void property="type"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -809,10 +809,10 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                 <void property="column"> 
-                 <string>2</string> 
+                 <string>1</string> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo1"/> 
                 </void> 
                </object> 
               </void> 
@@ -866,10 +866,10 @@
                       <void method="add"> 
                        <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                         <void property="column"> 
-                         <string>1</string> 
+                         <string>2</string> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo2"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -917,10 +917,10 @@
         <void property="aggMethods"> 
          <object class="java.util.ArrayList"> 
           <void method="add"> 
-           <string>merge</string> 
+           <string>iterate</string> 
           </void> 
           <void method="add"> 
-           <string>iterate</string> 
+           <string>merge</string> 
           </void> 
          </object> 
         </void> 
@@ -929,17 +929,20 @@
           <void method="add"> 
            <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
             <void property="aggregationClass"> 
-             <class>org.apache.hadoop.hive.ql.udf.UDAFSum</class> 
+             <class>org.apache.hadoop.hive.ql.udf.UDAFCount</class> 
+            </void> 
+            <void property="distinct"> 
+             <boolean>true</boolean> 
             </void> 
             <void property="parameters"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                 <void property="column"> 
-                 <string>VALUE.0</string> 
+                 <string>KEY.1</string> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo1"/> 
+                 <object idref="PrimitiveTypeInfo0"/> 
                 </void> 
                </object> 
               </void> 
@@ -950,20 +953,17 @@
           <void method="add"> 
            <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
             <void property="aggregationClass"> 
-             <class>org.apache.hadoop.hive.ql.udf.UDAFCount</class> 
-            </void> 
-            <void property="distinct"> 
-             <boolean>true</boolean> 
+             <class>org.apache.hadoop.hive.ql.udf.UDAFSum</class> 
             </void> 
             <void property="parameters"> 
              <object class="java.util.ArrayList"> 
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                 <void property="column"> 
-                 <string>KEY.1</string> 
+                 <string>VALUE.1</string> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo0"/> 
+                 <object idref="PrimitiveTypeInfo2"/> 
                 </void> 
                </object> 
               </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby3.q.xml b/ql/src/test/results/compiler/plan/groupby3.q.xml
index 08cd458db5..21d49527f7 100644
--- a/ql/src/test/results/compiler/plan/groupby3.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby3.q.xml
@@ -368,54 +368,78 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
                       </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
                         <void method="add"> 
                          <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
                           <void property="UDFClass"> 
-                           <class>org.apache.hadoop.hive.ql.udf.UDFSubstr</class> 
+                           <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
                           </void> 
                           <void property="UDFMethod"> 
-                           <object class="org.apache.hadoop.hive.ql.udf.UDFSubstr" method="getMethod"> 
+                           <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
                             <string>evaluate</string> 
-                            <array class="java.lang.Class" length="2"> 
+                            <array class="java.lang.Class" length="1"> 
                              <void index="0"> 
                               <class>java.lang.String</class> 
                              </void> 
-                             <void index="1"> 
-                              <class>java.lang.Integer</class> 
-                             </void> 
                             </array> 
                            </object> 
                           </void> 
                           <void property="children"> 
                            <object class="java.util.ArrayList"> 
                             <void method="add"> 
-                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                              <void property="column"> 
-                               <string>0</string> 
+                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                              <void property="UDFClass"> 
+                               <class>org.apache.hadoop.hive.ql.udf.UDFSubstr</class> 
                               </void> 
-                              <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
+                              <void property="UDFMethod"> 
+                               <object class="org.apache.hadoop.hive.ql.udf.UDFSubstr" method="getMethod"> 
+                                <string>evaluate</string> 
+                                <array class="java.lang.Class" length="2"> 
+                                 <void index="0"> 
+                                  <class>java.lang.String</class> 
+                                 </void> 
+                                 <void index="1"> 
+                                  <class>java.lang.Integer</class> 
+                                 </void> 
+                                </array> 
+                               </object> 
                               </void> 
-                             </object> 
-                            </void> 
-                            <void method="add"> 
-                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                              <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo2"/> 
+                              <void property="children"> 
+                               <object class="java.util.ArrayList"> 
+                                <void method="add"> 
+                                 <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                                  <void property="column"> 
+                                   <string>0</string> 
+                                  </void> 
+                                  <void property="typeInfo"> 
+                                   <object idref="PrimitiveTypeInfo0"/> 
+                                  </void> 
+                                 </object> 
+                                </void> 
+                                <void method="add"> 
+                                 <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                                  <void property="typeInfo"> 
+                                   <object idref="PrimitiveTypeInfo2"/> 
+                                  </void> 
+                                  <void property="value"> 
+                                   <int>5</int> 
+                                  </void> 
+                                 </object> 
+                                </void> 
+                               </object> 
                               </void> 
-                              <void property="value"> 
-                               <int>5</int> 
+                              <void property="typeInfo"> 
+                               <object idref="PrimitiveTypeInfo0"/> 
                               </void> 
                              </object> 
                             </void> 
                            </object> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
+                           <object idref="PrimitiveTypeInfo1"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -511,7 +535,7 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFMin$MinStringEvaluator</class> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
                       </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
@@ -569,78 +593,54 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFMin$MinStringEvaluator</class> 
                       </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
                         <void method="add"> 
                          <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
                           <void property="UDFClass"> 
-                           <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                           <class>org.apache.hadoop.hive.ql.udf.UDFSubstr</class> 
                           </void> 
                           <void property="UDFMethod"> 
-                           <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                           <object class="org.apache.hadoop.hive.ql.udf.UDFSubstr" method="getMethod"> 
                             <string>evaluate</string> 
-                            <array class="java.lang.Class" length="1"> 
+                            <array class="java.lang.Class" length="2"> 
                              <void index="0"> 
                               <class>java.lang.String</class> 
                              </void> 
+                             <void index="1"> 
+                              <class>java.lang.Integer</class> 
+                             </void> 
                             </array> 
                            </object> 
                           </void> 
                           <void property="children"> 
                            <object class="java.util.ArrayList"> 
                             <void method="add"> 
-                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
-                              <void property="UDFClass"> 
-                               <class>org.apache.hadoop.hive.ql.udf.UDFSubstr</class> 
-                              </void> 
-                              <void property="UDFMethod"> 
-                               <object class="org.apache.hadoop.hive.ql.udf.UDFSubstr" method="getMethod"> 
-                                <string>evaluate</string> 
-                                <array class="java.lang.Class" length="2"> 
-                                 <void index="0"> 
-                                  <class>java.lang.String</class> 
-                                 </void> 
-                                 <void index="1"> 
-                                  <class>java.lang.Integer</class> 
-                                 </void> 
-                                </array> 
-                               </object> 
-                              </void> 
-                              <void property="children"> 
-                               <object class="java.util.ArrayList"> 
-                                <void method="add"> 
-                                 <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                                  <void property="column"> 
-                                   <string>0</string> 
-                                  </void> 
-                                  <void property="typeInfo"> 
-                                   <object idref="PrimitiveTypeInfo0"/> 
-                                  </void> 
-                                 </object> 
-                                </void> 
-                                <void method="add"> 
-                                 <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                                  <void property="typeInfo"> 
-                                   <object idref="PrimitiveTypeInfo2"/> 
-                                  </void> 
-                                  <void property="value"> 
-                                   <int>5</int> 
-                                  </void> 
-                                 </object> 
-                                </void> 
-                               </object> 
+                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                              <void property="column"> 
+                               <string>0</string> 
                               </void> 
                               <void property="typeInfo"> 
                                <object idref="PrimitiveTypeInfo0"/> 
                               </void> 
                              </object> 
                             </void> 
+                            <void method="add"> 
+                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                              <void property="typeInfo"> 
+                               <object idref="PrimitiveTypeInfo2"/> 
+                              </void> 
+                              <void property="value"> 
+                               <int>5</int> 
+                              </void> 
+                             </object> 
+                            </void> 
                            </object> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -903,7 +903,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -915,7 +915,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -971,7 +971,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/njain/hive1/hive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/njain/hive2/hive/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
@@ -997,7 +997,7 @@
               <void property="conf"> 
                <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                 <void property="dirName"> 
-                 <string>/data/users/njain/hive1/hive/ql/../build/ql/tmp/150776966.10001.insclause-0</string> 
+                 <string>/data/users/njain/hive2/hive/ql/../build/ql/tmp/96733497.10001.insclause-0</string> 
                 </void> 
                 <void property="tableInfo"> 
                  <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -1115,7 +1115,7 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                 <void property="column"> 
-                 <string>4</string> 
+                 <string>1</string> 
                 </void> 
                 <void property="typeInfo"> 
                  <object idref="PrimitiveTypeInfo1"/> 
@@ -1135,7 +1135,7 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                 <void property="column"> 
-                 <string>1</string> 
+                 <string>3</string> 
                 </void> 
                 <void property="typeInfo"> 
                  <object idref="PrimitiveTypeInfo0"/> 
@@ -1145,7 +1145,7 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                 <void property="column"> 
-                 <string>3</string> 
+                 <string>4</string> 
                 </void> 
                 <void property="typeInfo"> 
                  <object idref="PrimitiveTypeInfo0"/> 
@@ -1224,7 +1224,7 @@
           <void method="add"> 
            <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
             <void property="aggregationClass"> 
-             <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
+             <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
             </void> 
             <void property="parameters"> 
              <object class="java.util.ArrayList"> 
@@ -1293,7 +1293,7 @@
           <void method="add"> 
            <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
             <void property="aggregationClass"> 
-             <class>org.apache.hadoop.hive.ql.udf.UDAFMin$MinStringEvaluator</class> 
+             <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
             </void> 
             <void property="parameters"> 
              <object class="java.util.ArrayList"> 
@@ -1314,7 +1314,7 @@
           <void method="add"> 
            <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
             <void property="aggregationClass"> 
-             <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
+             <class>org.apache.hadoop.hive.ql.udf.UDAFMin$MinStringEvaluator</class> 
             </void> 
             <void property="parameters"> 
              <object class="java.util.ArrayList"> 
@@ -1393,7 +1393,7 @@
              <string>1</string> 
             </void> 
             <void property="type"> 
-             <object idref="PrimitiveTypeInfo0"/> 
+             <object idref="PrimitiveTypeInfo1"/> 
             </void> 
            </object> 
           </void> 
@@ -1423,7 +1423,7 @@
              <string>4</string> 
             </void> 
             <void property="type"> 
-             <object idref="PrimitiveTypeInfo1"/> 
+             <object idref="PrimitiveTypeInfo0"/> 
             </void> 
            </object> 
           </void> 
