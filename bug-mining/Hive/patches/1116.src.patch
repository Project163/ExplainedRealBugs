diff --git a/ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java b/ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java
index 8d4e93ba57..23cdfc2ab3 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java
@@ -23,6 +23,7 @@
 import java.util.ArrayList;
 import java.util.Calendar;
 import java.util.Collection;
+import java.util.Collections;
 import java.util.GregorianCalendar;
 import java.util.HashMap;
 import java.util.HashSet;
@@ -32,6 +33,7 @@
 import java.util.Queue;
 import java.util.Set;
 import java.util.UUID;
+import java.util.concurrent.ConcurrentHashMap;
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
@@ -91,9 +93,12 @@ public class QueryPlan implements Serializable {
 
   private String queryId;
   private org.apache.hadoop.hive.ql.plan.api.Query query;
-  private HashMap<String, HashMap<String, Long>> counters;
-  private HashSet<String> done;
-  private HashSet<String> started;
+  private final Map<String, Map<String, Long>> counters =
+      new ConcurrentHashMap<String, Map<String, Long>>();
+  private final Set<String> done = Collections.newSetFromMap(new
+      ConcurrentHashMap<String, Boolean>());
+  private final Set<String> started = Collections.newSetFromMap(new
+      ConcurrentHashMap<String, Boolean>());
 
   private QueryProperties queryProperties;
 
@@ -122,9 +127,6 @@ public QueryPlan(String queryString, BaseSemanticAnalyzer sem, Long startTime) {
     query = new org.apache.hadoop.hive.ql.plan.api.Query();
     query.setQueryId(queryId);
     query.putToQueryAttributes("queryString", this.queryString);
-    counters = new HashMap<String, HashMap<String, Long>>();
-    done = new HashSet<String>();
-    started = new HashSet<String>();
     queryProperties = sem.getQueryProperties();
     queryStartTime = startTime;
   }
@@ -309,6 +311,9 @@ private void updateCountersInQueryPlan() {
     if (query.getStageList() != null) {
       for (org.apache.hadoop.hive.ql.plan.api.Stage stage : query
           .getStageList()) {
+        if (stage.getStageId() == null) {
+          continue;
+        }
         stage.setStarted(started.contains(stage.getStageId()));
         stage.setStageCounters(counters.get(stage.getStageId()));
         stage.setDone(done.contains(stage.getStageId()));
@@ -358,7 +363,9 @@ private void extractCounters() throws IOException {
           }
         }
       }
-
+      if (task.getId() == null) {
+        continue;
+      }
       if (started.contains(task.getId()) && done.contains(task.getId())) {
         continue;
       }
@@ -416,7 +423,10 @@ private void extractOperatorCounters(
     while (opsToVisit.size() != 0) {
       Operator<? extends OperatorDesc> op = opsToVisit.remove();
       opsVisited.add(op);
-      counters.put(op.getOperatorId(), op.getCounters());
+      Map<String,Long> ctrs = op.getCounters();
+      if (ctrs != null) {
+        counters.put(op.getOperatorId(), op.getCounters());
+      }
       if (op.getDone()) {
         done.add(op.getOperatorId());
       }
@@ -656,11 +666,11 @@ public void setDone() {
     done.add(queryId);
   }
 
-  public HashSet<String> getStarted() {
+  public Set<String> getStarted() {
     return started;
   }
 
-  public HashSet<String> getDone() {
+  public Set<String> getDone() {
     return done;
   }
 
@@ -724,26 +734,14 @@ public void setQuery(org.apache.hadoop.hive.ql.plan.api.Query query) {
     this.query = query;
   }
 
-  public HashMap<String, HashMap<String, Long>> getCounters() {
+  public Map<String, Map<String, Long>> getCounters() {
     return counters;
   }
 
-  public void setCounters(HashMap<String, HashMap<String, Long>> counters) {
-    this.counters = counters;
-  }
-
   public void setQueryId(String queryId) {
     this.queryId = queryId;
   }
 
-  public void setDone(HashSet<String> done) {
-    this.done = done;
-  }
-
-  public void setStarted(HashSet<String> started) {
-    this.started = started;
-  }
-
   /**
    * Gets the lineage information.
    *
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/history/HiveHistory.java b/ql/src/java/org/apache/hadoop/hive/ql/history/HiveHistory.java
index 7e80c2d6bd..bfd0a83642 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/history/HiveHistory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/history/HiveHistory.java
@@ -490,12 +490,16 @@ public void progressTask(String queryId, Task<? extends Serializable> task) {
   /**
    * write out counters.
    */
-  static Map<String, String> ctrmap = null;
+  static ThreadLocal<Map<String,String>> ctrMapFactory =
+      new ThreadLocal<Map<String, String>>() {
+        @Override
+        protected Map<String,String> initialValue() {
+          return new HashMap<String,String>();
+        }
+      };
 
   public void logPlanProgress(QueryPlan plan) throws IOException {
-    if (ctrmap == null) {
-      ctrmap = new HashMap<String, String>();
-    }
+    Map<String,String> ctrmap = ctrMapFactory.get();
     ctrmap.put("plan", plan.toString());
     log(RecordTypes.Counters, ctrmap);
   }
diff --git a/serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/TypeInfoUtils.java b/serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/TypeInfoUtils.java
index af6821799f..84e0b2e207 100644
--- a/serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/TypeInfoUtils.java
+++ b/serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/TypeInfoUtils.java
@@ -22,6 +22,7 @@
 import java.lang.reflect.Method;
 import java.lang.reflect.ParameterizedType;
 import java.lang.reflect.Type;
+import java.util.concurrent.ConcurrentHashMap;
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
@@ -400,8 +401,8 @@ private TypeInfo parseType() {
 
   }
 
-  static HashMap<TypeInfo, ObjectInspector> cachedStandardObjectInspector =
-      new HashMap<TypeInfo, ObjectInspector>();
+  static Map<TypeInfo, ObjectInspector> cachedStandardObjectInspector =
+      new ConcurrentHashMap<TypeInfo, ObjectInspector>();
 
   /**
    * Returns the standard object inspector that can be used to translate an
@@ -477,8 +478,8 @@ public static ObjectInspector getStandardWritableObjectInspectorFromTypeInfo(
     return result;
   }
 
-  static HashMap<TypeInfo, ObjectInspector> cachedStandardJavaObjectInspector =
-      new HashMap<TypeInfo, ObjectInspector>();
+  static Map<TypeInfo, ObjectInspector> cachedStandardJavaObjectInspector =
+      new ConcurrentHashMap<TypeInfo, ObjectInspector>();
 
   /**
    * Returns the standard object inspector that can be used to translate an
