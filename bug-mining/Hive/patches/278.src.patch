diff --git a/CHANGES.txt b/CHANGES.txt
index 252086bf84..6323032a29 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -222,6 +222,9 @@ Trunk -  Unreleased
 
     HIVE-905. Smallint not working for typedbyteserde. (Namit Jain via zshao)
 
+    HIVE-840. No error if user specifies multiple columns of same name as
+    output (He Yongqiang via namit)
+
 Release 0.4.0 -  Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java
index 48840bbc4e..15430007d4 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/ErrorMsg.java
@@ -104,7 +104,8 @@ public enum ErrorMsg {
   CTAS_PARCOL_COEXISTENCE("CREATE-TABLE-AS-SELECT does not support partitioning in the target table."),
   CTAS_MULTI_LOADFILE("CREATE-TABLE-AS-SELECT results in multiple file load."),
   CTAS_EXTTBL_COEXISTENCE("CREATE-TABLE-AS-SELECT cannot create external table."),
-  TABLE_ALREADY_EXISTS("Table already exists:", "42S02");
+  TABLE_ALREADY_EXISTS("Table already exists:", "42S02"),
+  COLUMN_ALIAS_ALREADY_EXISTS("Column alias already exists:", "42S02");
   
   private String mesg;
   private String SQLState;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
index fb9a744439..ff7caed215 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
@@ -1089,6 +1089,12 @@ else if (child.getType() == HiveParser.TOK_SERDEPROPS) {
     return null;
   }
 
+  private void failIfColAliasExists(Set<String> nameSet, String name) throws SemanticException {
+    if(nameSet.contains(name))
+      throw new SemanticException(ErrorMsg.COLUMN_ALIAS_ALREADY_EXISTS.getMsg(name));
+    nameSet.add(name);
+  }
+
   @SuppressWarnings("nls")
   private Operator genScriptPlan(ASTNode trfm, QB qb,
       Operator input) throws SemanticException {
@@ -1120,16 +1126,21 @@ else if (outCols.getType() == HiveParser.TOK_TABCOLLIST)
       ASTNode collist = (ASTNode) trfm.getChild(outputColsNum);
       int ccount = collist.getChildCount();
 
+      Set<String> colAliasNamesDuplicateCheck = new HashSet<String>();
       if (outputColNames) {
         for (int i=0; i < ccount; ++i) {
-          outputCols.add(new ColumnInfo(unescapeIdentifier(((ASTNode)collist.getChild(i)).getText()), TypeInfoFactory.stringTypeInfo, null, false));
+          String colAlias = unescapeIdentifier(((ASTNode)collist.getChild(i)).getText());
+          failIfColAliasExists(colAliasNamesDuplicateCheck, colAlias);
+          outputCols.add(new ColumnInfo(colAlias, TypeInfoFactory.stringTypeInfo, null, false));
         }
       }
       else {
         for (int i=0; i < ccount; ++i) {
           ASTNode child = (ASTNode) collist.getChild(i);
           assert child.getType() == HiveParser.TOK_TABCOL;
-          outputCols.add(new ColumnInfo(unescapeIdentifier(((ASTNode)child.getChild(0)).getText()),
+          String colAlias = unescapeIdentifier(((ASTNode)child.getChild(0)).getText());
+          failIfColAliasExists(colAliasNamesDuplicateCheck, colAlias);
+          outputCols.add(new ColumnInfo(colAlias,
                                         TypeInfoUtils.getTypeInfoFromTypeString(DDLSemanticAnalyzer.getTypeName(((ASTNode)child.getChild(1)).getType())), null, false));
         }
       }
diff --git a/ql/src/test/queries/clientnegative/duplicate_alias_in_transform.q b/ql/src/test/queries/clientnegative/duplicate_alias_in_transform.q
new file mode 100644
index 0000000000..b2e8567f09
--- /dev/null
+++ b/ql/src/test/queries/clientnegative/duplicate_alias_in_transform.q
@@ -0,0 +1 @@
+FROM src SELECT TRANSFORM (key, value) USING "awk -F'\001' '{print $0}'" AS (foo, foo);
\ No newline at end of file
diff --git a/ql/src/test/queries/clientnegative/duplicate_alias_in_transform_schema.q b/ql/src/test/queries/clientnegative/duplicate_alias_in_transform_schema.q
new file mode 100644
index 0000000000..dabbc351bc
--- /dev/null
+++ b/ql/src/test/queries/clientnegative/duplicate_alias_in_transform_schema.q
@@ -0,0 +1 @@
+FROM src SELECT TRANSFORM (key, value) USING "awk -F'\001' '{print $0}'" AS (foo STRING, foo STRING);
\ No newline at end of file
diff --git a/ql/src/test/results/clientnegative/duplicate_alias_in_transform.q.out b/ql/src/test/results/clientnegative/duplicate_alias_in_transform.q.out
new file mode 100644
index 0000000000..fd672db2a7
--- /dev/null
+++ b/ql/src/test/results/clientnegative/duplicate_alias_in_transform.q.out
@@ -0,0 +1 @@
+FAILED: Error in semantic analysis: Column alias already exists: foo
diff --git a/ql/src/test/results/clientnegative/duplicate_alias_in_transform_schema.q.out b/ql/src/test/results/clientnegative/duplicate_alias_in_transform_schema.q.out
new file mode 100644
index 0000000000..fd672db2a7
--- /dev/null
+++ b/ql/src/test/results/clientnegative/duplicate_alias_in_transform_schema.q.out
@@ -0,0 +1 @@
+FAILED: Error in semantic analysis: Column alias already exists: foo
