{"url":"https://api.github.com/repos/Unitech/pm2/issues/543","repository_url":"https://api.github.com/repos/Unitech/pm2","labels_url":"https://api.github.com/repos/Unitech/pm2/issues/543/labels{/name}","comments_url":"https://api.github.com/repos/Unitech/pm2/issues/543/comments","events_url":"https://api.github.com/repos/Unitech/pm2/issues/543/events","html_url":"https://github.com/Unitech/pm2/issues/543","id":36874020,"node_id":"MDU6SXNzdWUzNjg3NDAyMA==","number":543,"title":"ubuntu init script not working","user":{"login":"denouche","id":3081451,"node_id":"MDQ6VXNlcjMwODE0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/3081451?v=4","gravatar_id":"","url":"https://api.github.com/users/denouche","html_url":"https://github.com/denouche","followers_url":"https://api.github.com/users/denouche/followers","following_url":"https://api.github.com/users/denouche/following{/other_user}","gists_url":"https://api.github.com/users/denouche/gists{/gist_id}","starred_url":"https://api.github.com/users/denouche/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/denouche/subscriptions","organizations_url":"https://api.github.com/users/denouche/orgs","repos_url":"https://api.github.com/users/denouche/repos","events_url":"https://api.github.com/users/denouche/events{/privacy}","received_events_url":"https://api.github.com/users/denouche/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":40425958,"node_id":"MDU6TGFiZWw0MDQyNTk1OA==","url":"https://api.github.com/repos/Unitech/pm2/labels/T:%20Bug","name":"T: Bug","color":"d93f0b","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-07-01T09:01:18Z","updated_at":"2014-07-02T22:51:28Z","closed_at":"2014-07-02T22:51:28Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi\n\nI tried to make my node application resurrect on boot, but using regular way is not working.\nI'm on a debian 7, node v0.10.29, pm2 v0.9.1\n\nI create a specific user for my node applications (called node)\nI just runned as specified in the documentation:\n`pm2 startup ubuntu -u node`\n\nAfter that, with my sudo user, when I call the following command I obtain the error:\n\n```\n$ sudo service pm2-init.sh start\nStarting pm2\n/home/node/programs/node-v0.10.29-linux-x64/lib/node_modules/pm2/bin/pm2: 4: exec: : Permission denied\n```\n\n(the rights are ok, and running `pm2 resurrect` directly logged as `node` run fine)\n\nAfter debugging, it appears that `$PATH` is not correctly setted, so in the file `/home/node/programs/node-v0.10.29-linux-x64/lib/node_modules/pm2/bin/pm2` at line 4:\n\n```\n':' //; [ -f ~/.pm2/custom_options.sh ] && . ~/.pm2/custom_options.sh || : ; exec \"`command -v node || command -v nodejs`\" $PM2_NODE_OPTIONS \"$0\" \"$@\"\n```\n\nThe part `command -v node || command -v nodejs` just give an empty string.\n\nSo why ? \nIn the file `pm2/lib/scripts/pm2-init.sh` at line 27:\n`sudo -Ei -u $USER PATH=$PATH $*`\nThere is the  `-i` option, which from the sudo manual:\n`The security policy shall initialize the environment to a minimal set of variables`\n\nMaybe I'm wrong, but removing the `-i` flag resolved my problem.\n","closed_by":{"login":"soyuka","id":1321971,"node_id":"MDQ6VXNlcjEzMjE5NzE=","avatar_url":"https://avatars.githubusercontent.com/u/1321971?v=4","gravatar_id":"","url":"https://api.github.com/users/soyuka","html_url":"https://github.com/soyuka","followers_url":"https://api.github.com/users/soyuka/followers","following_url":"https://api.github.com/users/soyuka/following{/other_user}","gists_url":"https://api.github.com/users/soyuka/gists{/gist_id}","starred_url":"https://api.github.com/users/soyuka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/soyuka/subscriptions","organizations_url":"https://api.github.com/users/soyuka/orgs","repos_url":"https://api.github.com/users/soyuka/repos","events_url":"https://api.github.com/users/soyuka/events{/privacy}","received_events_url":"https://api.github.com/users/soyuka/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Unitech/pm2/issues/543/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Unitech/pm2/issues/543/timeline","performed_via_github_app":null,"state_reason":"completed"}