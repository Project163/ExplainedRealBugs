{"url":"https://api.github.com/repos/Unitech/pm2/issues/1391","repository_url":"https://api.github.com/repos/Unitech/pm2","labels_url":"https://api.github.com/repos/Unitech/pm2/issues/1391/labels{/name}","comments_url":"https://api.github.com/repos/Unitech/pm2/issues/1391/comments","events_url":"https://api.github.com/repos/Unitech/pm2/issues/1391/events","html_url":"https://github.com/Unitech/pm2/issues/1391","id":91144447,"node_id":"MDU6SXNzdWU5MTE0NDQ0Nw==","number":1391,"title":"child_process.execSync() in cluster mode crashes pm2 logs","user":{"login":"xiaody","id":1246451,"node_id":"MDQ6VXNlcjEyNDY0NTE=","avatar_url":"https://avatars.githubusercontent.com/u/1246451?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaody","html_url":"https://github.com/xiaody","followers_url":"https://api.github.com/users/xiaody/followers","following_url":"https://api.github.com/users/xiaody/following{/other_user}","gists_url":"https://api.github.com/users/xiaody/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaody/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaody/subscriptions","organizations_url":"https://api.github.com/users/xiaody/orgs","repos_url":"https://api.github.com/users/xiaody/repos","events_url":"https://api.github.com/users/xiaody/events{/privacy}","received_events_url":"https://api.github.com/users/xiaody/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":40425958,"node_id":"MDU6TGFiZWw0MDQyNTk1OA==","url":"https://api.github.com/repos/Unitech/pm2/labels/T:%20Bug","name":"T: Bug","color":"d93f0b","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-06-26T03:46:04Z","updated_at":"2015-06-26T10:41:53Z","closed_at":"2015-06-26T10:41:53Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm on OSX 10.10.3 and using io.js v2.3.1 and pm2@0.14.2\n\nReproduce:\n`pm2 --no-daemon start test.json`\n\nThe config file `test.json`:\n\n``` json\n{\n  \"apps\" : [{\n    \"name\"               : \"test\",\n    \"script\"             : \"tmp/test.js\",\n    \"exec_interpreter\"   : \"node\",\n    \"exec_mode\"          : \"cluster_mode\",\n    \"instances\"          : 1\n  }]\n}\n```\n\nThe app `tmp/test.js`:\n\n``` js\n'use strict'\nsetInterval(function () {\n    console.log('run `echo`')\n    require('child_process').execSync('echo')\n}, 200)\n```\n\nThe output:\n\n```\n➜  paidui git:(master) ✗ pm2 --no-daemon start test.json\npm2 launched in no-daemon mode (you can add DEBUG=\"*\" env variable to get more messages)\n2015-06-26 11:42:07: [PM2][WORKER] Started with refreshing interval: 30000\n2015-06-26 11:42:07: [[[[ PM2/God daemon launched ]]]]\n2015-06-26 11:42:07: BUS system [READY] on port /Users/xiaody/.pm2/pub.sock\n2015-06-26 11:42:07: RPC interface [READY] on port /Users/xiaody/.pm2/rpc.sock\n2015-06-26 11:42:07: Starting execution sequence in -cluster mode- for app name:test id:0\n2015-06-26 11:42:07: App name:test id:0 online\n2015-06-26 11:42:07: [PM2] Process launched\n2015-06-26 11:42:07: ┌──────────┬────┬─────────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐\n│ App name │ id │ mode    │ pid   │ status │ restart │ uptime │ memory      │ watching │\n├──────────┼────┼─────────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤\n│ test     │ 0  │ cluster │ 70723 │ online │ 0       │ 0s     │ 20.816 MB   │ disabled │\n└──────────┴────┴─────────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘\n2015-06-26 11:42:07:  Use `pm2 show <id|name>` to get more details about an app\n2015-06-26 11:42:07: --no-daemon option enabled = do not exit pm2 CLI\n2015-06-26 11:42:07: PM2 daemon PID = 70710\n2015-06-26 11:42:07: [PM2] Tailing last 1 lines for [all] processes\n\nPM2: 2015-06-26 11:42:07: 2015-06-26 11:41:54: PUB socket closed\n\ntest-0 (err): 2015-06-26 11:42:07: IPC channel with master closed\n\ntest-0 (out): 2015-06-26 11:42:07: run `echo`\n\n2015-06-26 11:42:07: [PM2] Streaming realtime logs for [all] processes\n\ntest-0 run `echo`\ntest-0 net.js:614\n    throw new TypeError('invalid data');\n          ^\nTypeError: invalid data\n    at WriteStream.Socket.write (net.js:614:11)\n    at Parser.<anonymous> (/usr/local/lib/node_modules/pm2/lib/Log.js:96:22)\n    at Parser.<anonymous> (/usr/local/lib/node_modules/pm2/node_modules/pm2-axon/lib/sockets/sub-emitter.js:52:19)\n    at emitOne (events.js:77:13)\n    at Parser.emit (events.js:169:7)\n    at Parser._write (/usr/local/lib/node_modules/pm2/node_modules/pm2-axon/node_modules/amp/lib/stream.js:91:16)\n    at doWrite (_stream_writable.js:291:12)\n    at writeOrBuffer (_stream_writable.js:277:5)\n    at Parser.Writable.write (_stream_writable.js:206:11)\n    at Socket.ondata (_stream_readable.js:521:20)\n➜  paidui git:(master) ✗\n```\n","closed_by":{"login":"jshkurti","id":7647602,"node_id":"MDQ6VXNlcjc2NDc2MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7647602?v=4","gravatar_id":"","url":"https://api.github.com/users/jshkurti","html_url":"https://github.com/jshkurti","followers_url":"https://api.github.com/users/jshkurti/followers","following_url":"https://api.github.com/users/jshkurti/following{/other_user}","gists_url":"https://api.github.com/users/jshkurti/gists{/gist_id}","starred_url":"https://api.github.com/users/jshkurti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jshkurti/subscriptions","organizations_url":"https://api.github.com/users/jshkurti/orgs","repos_url":"https://api.github.com/users/jshkurti/repos","events_url":"https://api.github.com/users/jshkurti/events{/privacy}","received_events_url":"https://api.github.com/users/jshkurti/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Unitech/pm2/issues/1391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Unitech/pm2/issues/1391/timeline","performed_via_github_app":null,"state_reason":"completed"}