{"url":"https://api.github.com/repos/yewstack/yew/issues/2206","repository_url":"https://api.github.com/repos/yewstack/yew","labels_url":"https://api.github.com/repos/yewstack/yew/issues/2206/labels{/name}","comments_url":"https://api.github.com/repos/yewstack/yew/issues/2206/comments","events_url":"https://api.github.com/repos/yewstack/yew/issues/2206/events","html_url":"https://github.com/yewstack/yew/issues/2206","id":1064985266,"node_id":"I_kwDOBtKdYc4_emKy","number":2206,"title":"NodeRef unexpectedly reset when DOM structure changes in view()","user":{"login":"Follpvosten","id":22855787,"node_id":"MDQ6VXNlcjIyODU1Nzg3","avatar_url":"https://avatars.githubusercontent.com/u/22855787?v=4","gravatar_id":"","url":"https://api.github.com/users/Follpvosten","html_url":"https://github.com/Follpvosten","followers_url":"https://api.github.com/users/Follpvosten/followers","following_url":"https://api.github.com/users/Follpvosten/following{/other_user}","gists_url":"https://api.github.com/users/Follpvosten/gists{/gist_id}","starred_url":"https://api.github.com/users/Follpvosten/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Follpvosten/subscriptions","organizations_url":"https://api.github.com/users/Follpvosten/orgs","repos_url":"https://api.github.com/users/Follpvosten/repos","events_url":"https://api.github.com/users/Follpvosten/events{/privacy}","received_events_url":"https://api.github.com/users/Follpvosten/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":792840709,"node_id":"MDU6TGFiZWw3OTI4NDA3MDk=","url":"https://api.github.com/repos/yewstack/yew/labels/bug","name":"bug","color":"75ad20","default":true,"description":""},{"id":3372244112,"node_id":"MDU6TGFiZWwzMzcyMjQ0MTEy","url":"https://api.github.com/repos/yewstack/yew/labels/A-yew","name":"A-yew","color":"FBCA04","default":false,"description":"Area: The main yew crate"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-11-27T11:11:36Z","updated_at":"2021-12-20T09:45:41Z","closed_at":"2021-12-20T09:45:41Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Problem**\r\nAfter upgrading to 0.18, one of my components broke in a subtle way: It contains an input that's supposed to autofocus unless the user explicitly unfocuses it. The input element has a NodeRef attached, allowing me to call `.focus()` on the element. Preceding the input is a variable amount of other elements.\r\n\r\nThis worked fine in yew 0.17, however in 0.18 (and also on master), it no longer does: If the amount of elements preceding the input changes, the NodeRef gets invalidated.\r\n\r\nBased on trying random stuffâ„¢, I've arrived at the conclusion that this is what happens:\r\n1. After the `view()` method returns the input at a different position, its Node is assigned to the NodeRef.\r\n2. Next, the old Node gets dropped, but it still has a reference to the NodeRef, so it resets the NodeRef to the empty state.\r\n3. Leading to: In the `rendered()` method, you don't have access to the Node anymore.\r\n\r\n**Steps To Reproduce**\r\nSteps to reproduce the behavior: I have written a project demonstrating the issue (based on current master, runnable with `trunk serve`): https://github.com/Follpvosten/yew-noderef-problem\r\nCheck the console output to see how the NodeRef changes after the first event, and then never changes again with subsequent events.\r\nIt also includes instructions in comments on how to apply a workaround and how to verify that it doesn't happen when the amount of elements doesn't change. It demonstrates the problem using my usecase: Attempting to force focus on an input.\r\n\r\nIn words: Basically, create a component with a variable amount of elements before an element that has a NodeRef attached. The NodeRef will break when the amount of elements changes.\r\n\r\n**Expected behavior**\r\nI'd expect the NodeRef to not be reset and be usable in `rendered()` in this case.\r\n\r\n**Environment:**\r\n - Yew version: v0.18 and up, including master\r\n - Rust version: 1.56.1","closed_by":{"login":"ranile","id":47357913,"node_id":"MDQ6VXNlcjQ3MzU3OTEz","avatar_url":"https://avatars.githubusercontent.com/u/47357913?v=4","gravatar_id":"","url":"https://api.github.com/users/ranile","html_url":"https://github.com/ranile","followers_url":"https://api.github.com/users/ranile/followers","following_url":"https://api.github.com/users/ranile/following{/other_user}","gists_url":"https://api.github.com/users/ranile/gists{/gist_id}","starred_url":"https://api.github.com/users/ranile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranile/subscriptions","organizations_url":"https://api.github.com/users/ranile/orgs","repos_url":"https://api.github.com/users/ranile/repos","events_url":"https://api.github.com/users/ranile/events{/privacy}","received_events_url":"https://api.github.com/users/ranile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yewstack/yew/issues/2206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yewstack/yew/issues/2206/timeline","performed_via_github_app":null,"state_reason":"completed"}