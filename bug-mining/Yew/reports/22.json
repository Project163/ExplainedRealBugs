{"url":"https://api.github.com/repos/yewstack/yew/issues/2185","repository_url":"https://api.github.com/repos/yewstack/yew","labels_url":"https://api.github.com/repos/yewstack/yew/issues/2185/labels{/name}","comments_url":"https://api.github.com/repos/yewstack/yew/issues/2185/comments","events_url":"https://api.github.com/repos/yewstack/yew/issues/2185/events","html_url":"https://github.com/yewstack/yew/issues/2185","id":1060900127,"node_id":"I_kwDOBtKdYc4_PA0f","number":2185,"title":"Event propagation cancellation check happens too early?","user":{"login":"rjmac","id":753700,"node_id":"MDQ6VXNlcjc1MzcwMA==","avatar_url":"https://avatars.githubusercontent.com/u/753700?v=4","gravatar_id":"","url":"https://api.github.com/users/rjmac","html_url":"https://github.com/rjmac","followers_url":"https://api.github.com/users/rjmac/followers","following_url":"https://api.github.com/users/rjmac/following{/other_user}","gists_url":"https://api.github.com/users/rjmac/gists{/gist_id}","starred_url":"https://api.github.com/users/rjmac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjmac/subscriptions","organizations_url":"https://api.github.com/users/rjmac/orgs","repos_url":"https://api.github.com/users/rjmac/repos","events_url":"https://api.github.com/users/rjmac/events{/privacy}","received_events_url":"https://api.github.com/users/rjmac/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":792840709,"node_id":"MDU6TGFiZWw3OTI4NDA3MDk=","url":"https://api.github.com/repos/yewstack/yew/labels/bug","name":"bug","color":"75ad20","default":true,"description":""},{"id":3372244112,"node_id":"MDU6TGFiZWwzMzcyMjQ0MTEy","url":"https://api.github.com/repos/yewstack/yew/labels/A-yew","name":"A-yew","color":"FBCA04","default":false,"description":"Area: The main yew crate"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-11-23T07:06:19Z","updated_at":"2021-11-23T20:38:33Z","closed_at":"2021-11-23T20:38:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Problem**\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\nI think the check for event propagation cancellation happens too early.  In particular, I think that\r\n\r\n```rust\r\n        if unsafe { BUBBLE_EVENTS } && !event.cancel_bubble() {\r\n            let mut el = target;\r\n            loop {\r\n                el = match el.parent_element() {\r\n```\r\n\r\nought to be\r\n\r\n```rust\r\n        if unsafe { BUBBLE_EVENTS } {\r\n            let mut el = target;\r\n            while !event.cancel_bubble() {\r\n                el = match el.parent_element() {\r\n```\r\n\r\n**Steps To Reproduce**\r\n\r\nUsing this simple program:\r\n```rust\r\nuse yew::prelude::*;\r\nuse gloo_console::log;\r\n\r\nstruct Demo;\r\n\r\npub enum Msg {\r\n  OuterClicked(MouseEvent),\r\n  InnerClicked(MouseEvent)\r\n}\r\n\r\nimpl Component for Demo {\r\n    type Properties = ();\r\n    type Message = Msg;\r\n\r\n    fn create(_ctx: &Context<Self>) -> Self {\r\n        Self\r\n    }\r\n\r\n    fn update(&mut self, _ctx: &Context<Self>, msg: Self::Message) -> bool {\r\n        match msg {\r\n            Msg::OuterClicked(_) => {\r\n                log!(\"Outer clicked\");\r\n                false\r\n            }\r\n            Msg::InnerClicked(ev) => {\r\n                ev.stop_propagation();\r\n                log!(\"Inner clicked\");\r\n                false\r\n            }\r\n        }\r\n    }\r\n\r\n    fn view(&self, ctx: &Context<Self>) -> Html {\r\n        html!{\r\n            <div onclick={ctx.link().callback(Msg::OuterClicked)}>\r\n                <div onclick={ctx.link().callback(Msg::InnerClicked)}>\r\n                    {\"Some text\"}\r\n                    <div>{\"And then a nested div\"}</div>\r\n                 </div>\r\n            </div>\r\n        }\r\n    }\r\n}\r\n\r\nfn main() {\r\n    ::yew::start_app::<Demo>();\r\n}\r\n```\r\n1. Click on \"Some text\".  Observe it logs \"Inner clicked\".\r\n2. Click on \"And then a nested div\".  Observe it logs _both_ \"Inner clicked\" and \"Outer clicked\".\r\n2. Change yew's code as described at the top.\r\n4. Now clicking \"And then a nested div\" logs only \"Inner clicked\".\r\n\r\n**Expected behavior**\r\nPropagation should be cancelled even if the listener is not attached to the innermost element of the DOM element to which the event was first delivered.\r\n\r\n\r\n**Environment:**\r\n - Yew version: master\r\n - Rust version: 1.56.1\r\n - Target, if relevant: wasm32-unknown-emscripten (probably not relevant)\r\n - Build tool, if relevant: trunk (proably not relevant)\r\n - OS, if relevant: Linux (probably not relevant)\r\n - Browser and version, if relevant: Firefox 94.0.2\r\n\r\n**Questionnaire**\r\n<!-- Developing Yew is a community effort! -->\r\n<!-- If you feel up to the challenge, please check one of the boxes below: -->\r\n- [ ] I'm interested in fixing this myself but don't know where to start\r\n- [X] I would like to fix and I have a solution\r\n- [ ] I don't have time to fix this right now, but maybe later\r\n\r\nIf you the maintainers like the fix described at the top I can turn this into a pull request.  Or you can do it if you'd rather avoid a roundtrip.  Alternately, if this isn't the right change and you can describe how it's wrong, I can create a PR with the right change instead.","closed_by":{"login":"voidpumpkin","id":32368314,"node_id":"MDQ6VXNlcjMyMzY4MzE0","avatar_url":"https://avatars.githubusercontent.com/u/32368314?v=4","gravatar_id":"","url":"https://api.github.com/users/voidpumpkin","html_url":"https://github.com/voidpumpkin","followers_url":"https://api.github.com/users/voidpumpkin/followers","following_url":"https://api.github.com/users/voidpumpkin/following{/other_user}","gists_url":"https://api.github.com/users/voidpumpkin/gists{/gist_id}","starred_url":"https://api.github.com/users/voidpumpkin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/voidpumpkin/subscriptions","organizations_url":"https://api.github.com/users/voidpumpkin/orgs","repos_url":"https://api.github.com/users/voidpumpkin/repos","events_url":"https://api.github.com/users/voidpumpkin/events{/privacy}","received_events_url":"https://api.github.com/users/voidpumpkin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yewstack/yew/issues/2185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yewstack/yew/issues/2185/timeline","performed_via_github_app":null,"state_reason":"completed"}