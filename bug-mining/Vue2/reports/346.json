{"url":"https://api.github.com/repos/vuejs/vue/issues/8740","repository_url":"https://api.github.com/repos/vuejs/vue","labels_url":"https://api.github.com/repos/vuejs/vue/issues/8740/labels{/name}","comments_url":"https://api.github.com/repos/vuejs/vue/issues/8740/comments","events_url":"https://api.github.com/repos/vuejs/vue/issues/8740/events","html_url":"https://github.com/vuejs/vue/issues/8740","id":356028194,"node_id":"MDU6SXNzdWUzNTYwMjgxOTQ=","number":8740,"title":"Memory Leak When Using Async Components","user":{"login":"mattlavallee","id":1207606,"node_id":"MDQ6VXNlcjEyMDc2MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1207606?v=4","gravatar_id":"","url":"https://api.github.com/users/mattlavallee","html_url":"https://github.com/mattlavallee","followers_url":"https://api.github.com/users/mattlavallee/followers","following_url":"https://api.github.com/users/mattlavallee/following{/other_user}","gists_url":"https://api.github.com/users/mattlavallee/gists{/gist_id}","starred_url":"https://api.github.com/users/mattlavallee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattlavallee/subscriptions","organizations_url":"https://api.github.com/users/mattlavallee/orgs","repos_url":"https://api.github.com/users/mattlavallee/repos","events_url":"https://api.github.com/users/mattlavallee/events{/privacy}","received_events_url":"https://api.github.com/users/mattlavallee/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":49750488,"node_id":"MDU6TGFiZWw0OTc1MDQ4OA==","url":"https://api.github.com/repos/vuejs/vue/labels/bug","name":"bug","color":"b60205","default":true,"description":null},{"id":863458406,"node_id":"MDU6TGFiZWw4NjM0NTg0MDY=","url":"https://api.github.com/repos/vuejs/vue/labels/has%20PR","name":"has PR","color":"5319e7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-08-31T15:32:40Z","updated_at":"2018-11-30T22:36:29Z","closed_at":"2018-11-30T22:36:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Version\r\n2.5.17\r\n\r\n### Reproduction link\r\n[https://codesandbox.io/s/4k43rylw0](https://codesandbox.io/s/4k43rylw0)\r\n\r\n\r\n\r\n\r\n\r\n### Steps to reproduce\r\n1. Load the reproducer and take a memory heap snapshot. Searching the heap you will find 4 VueComponents (App, Container, Child, Async Child)\r\n![image](https://user-images.githubusercontent.com/1207606/44921752-6c6e0900-ad11-11e8-81e9-6751416a49ff.png)\r\n\r\n2. Click the Destroy button. This toggles a v-if which will remove Child component and thus AsyncChild component as well.\r\n3. At this point, the page is updated as expected\r\n4. Take another memory heap snapshot. Search the heap again for \"VueComponent\" and you will see that 4 VueComponents still exist\r\n![image](https://user-images.githubusercontent.com/1207606/44921772-7a238e80-ad11-11e8-9215-c6ca2bd14706.png)\r\n![image](https://user-images.githubusercontent.com/1207606/44921791-8a3b6e00-ad11-11e8-82d9-a52d4f9c0e52.png)\r\n\r\n\r\n### What is expected?\r\nAfter destroying Child component, the component and it's asynchronously loaded child component should be destroyed and the memory freed up.\r\n\r\n### What is actually happening?\r\nVue is holding on to a context reference which is preventing these components from being garbage collected\r\n\r\n---\r\nThis is happening due to the resolve-async-component logic located here: https://github.com/vuejs/vue/blob/52719ccab8fccffbdf497b96d3731dc86f04c1ce/src/core/vdom/helpers/resolve-async-component.js#L57-L68\r\n\r\nIn the forceRender function on line 64, after calling $forceUpdate, the contexts array should be cleared to free up those references so that the components will be able to be garbage collected at a later point in time\r\n\r\n<!-- generated by vue-issues. DO NOT REMOVE -->","closed_by":{"login":"yyx990803","id":499550,"node_id":"MDQ6VXNlcjQ5OTU1MA==","avatar_url":"https://avatars.githubusercontent.com/u/499550?v=4","gravatar_id":"","url":"https://api.github.com/users/yyx990803","html_url":"https://github.com/yyx990803","followers_url":"https://api.github.com/users/yyx990803/followers","following_url":"https://api.github.com/users/yyx990803/following{/other_user}","gists_url":"https://api.github.com/users/yyx990803/gists{/gist_id}","starred_url":"https://api.github.com/users/yyx990803/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyx990803/subscriptions","organizations_url":"https://api.github.com/users/yyx990803/orgs","repos_url":"https://api.github.com/users/yyx990803/repos","events_url":"https://api.github.com/users/yyx990803/events{/privacy}","received_events_url":"https://api.github.com/users/yyx990803/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vuejs/vue/issues/8740/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vuejs/vue/issues/8740/timeline","performed_via_github_app":null,"state_reason":"completed"}