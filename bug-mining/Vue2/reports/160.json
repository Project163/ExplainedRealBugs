{"url":"https://api.github.com/repos/vuejs/vue/issues/4767","repository_url":"https://api.github.com/repos/vuejs/vue","labels_url":"https://api.github.com/repos/vuejs/vue/issues/4767/labels{/name}","comments_url":"https://api.github.com/repos/vuejs/vue/issues/4767/comments","events_url":"https://api.github.com/repos/vuejs/vue/issues/4767/events","html_url":"https://github.com/vuejs/vue/issues/4767","id":202385145,"node_id":"MDU6SXNzdWUyMDIzODUxNDU=","number":4767,"title":"Extend options should not be confused with the super options","user":{"login":"z-ZYS-s","id":10347453,"node_id":"MDQ6VXNlcjEwMzQ3NDUz","avatar_url":"https://avatars.githubusercontent.com/u/10347453?v=4","gravatar_id":"","url":"https://api.github.com/users/z-ZYS-s","html_url":"https://github.com/z-ZYS-s","followers_url":"https://api.github.com/users/z-ZYS-s/followers","following_url":"https://api.github.com/users/z-ZYS-s/following{/other_user}","gists_url":"https://api.github.com/users/z-ZYS-s/gists{/gist_id}","starred_url":"https://api.github.com/users/z-ZYS-s/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/z-ZYS-s/subscriptions","organizations_url":"https://api.github.com/users/z-ZYS-s/orgs","repos_url":"https://api.github.com/users/z-ZYS-s/repos","events_url":"https://api.github.com/users/z-ZYS-s/events{/privacy}","received_events_url":"https://api.github.com/users/z-ZYS-s/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":49750488,"node_id":"MDU6TGFiZWw0OTc1MDQ4OA==","url":"https://api.github.com/repos/vuejs/vue/labels/bug","name":"bug","color":"b60205","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2017-01-22T14:08:40Z","updated_at":"2017-01-22T18:01:10Z","closed_at":"2017-01-22T18:01:10Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"A simple case:\r\n```javascript\r\nconst Base = Vue.extend({\r\n  computed: {\r\n    a () { return 'aa' }\r\n  }\r\n})\r\nconst Sub = Base.extend()\r\nSub.options.computed.b = () => 'bb'\r\n\r\nconsole.log(Base.options.computed.b()) // 'bb'\r\nconsole.log(Base.options.computed === Sub.options.computed) // true\r\n```\r\n\r\nThe reason has been found, in **line 181**, `vue/src/core/util/options.js`\r\n```javascript\r\nstrats.props =\r\nstrats.methods =\r\nstrats.computed = function (parentVal: ?Object, childVal: ?Object): ?Object {\r\n  if (!childVal) return parentVal\r\n```\r\nIt just return the parent object. Maybe it should be replaced by code like this\r\n```\r\nstrats.props =\r\nstrats.methods =\r\nstrats.computed = function (parentVal: ?Object, childVal: ?Object): ?Object {\r\n  if (!childVal) return extend({}, parentVal)\r\n```\r\n\r\nThere is a same problem for `strats.watch` in **line 158**.\r\nThere is no need to change `strats.data` in **line 69** because the type is `function`.\r\n\r\nI'd like to submit a PR but I'm not familiar with the code, like that `props` could be a Array so more things should be done after `extend({}, parentVal)...\r\n\r\nHope someone can fix this bug, Thanks!\r\n\r\n------\r\n\r\nActually, it is not commonly used to set `Sub.options.computed` directly, but I met this bug when using vue-loader with css module. For example:\r\n\r\nbase.vue\r\n```vue\r\n<template>\r\n<div :class=\"$style.base\">base<div>\r\n</template>\r\n<script>\r\nimport Vue from 'vue';\r\n\r\nexport default Vue.extend({\r\n  name: 'my-base',\r\n});\r\n</script>\r\n<style module>\r\n.base {\r\n  color: red;\r\n}\r\n</style>\r\n```\r\n\r\nsub.vue\r\n```vue\r\n<template>\r\n<div :class=\"$style.sub\">sub<div>\r\n</template>\r\n<script>\r\nimport Base from './base.vue';\r\n\r\nexport default Vue.extend({\r\n  name: 'my-sub',\r\n});\r\n</script>\r\n<style module>\r\n.sub {\r\n  color: blue;\r\n}\r\n</style>\r\n```\r\n\r\nAnd finally, you will find that the computed property `$style` of `<my-base>` has been replaced by the one of `<my-sub>`. They share the same `$style` in fact.\r\n\r\nThe following lines using options directly are in vue-loader:\r\n- `__vue_options__ = __vue_options__.options` in **line 254**, `vue-loader/lib/loader.js`\r\n- `__vue_options__.computed[key] = function () { return module }` in **line 285**\r\n\r\nAnd with the mentioned bug above in vue cause the final problem.","closed_by":{"login":"yyx990803","id":499550,"node_id":"MDQ6VXNlcjQ5OTU1MA==","avatar_url":"https://avatars.githubusercontent.com/u/499550?v=4","gravatar_id":"","url":"https://api.github.com/users/yyx990803","html_url":"https://github.com/yyx990803","followers_url":"https://api.github.com/users/yyx990803/followers","following_url":"https://api.github.com/users/yyx990803/following{/other_user}","gists_url":"https://api.github.com/users/yyx990803/gists{/gist_id}","starred_url":"https://api.github.com/users/yyx990803/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyx990803/subscriptions","organizations_url":"https://api.github.com/users/yyx990803/orgs","repos_url":"https://api.github.com/users/yyx990803/repos","events_url":"https://api.github.com/users/yyx990803/events{/privacy}","received_events_url":"https://api.github.com/users/yyx990803/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vuejs/vue/issues/4767/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vuejs/vue/issues/4767/timeline","performed_via_github_app":null,"state_reason":"completed"}