{"url":"https://api.github.com/repos/vuejs/vue/issues/9632","repository_url":"https://api.github.com/repos/vuejs/vue","labels_url":"https://api.github.com/repos/vuejs/vue/issues/9632/labels{/name}","comments_url":"https://api.github.com/repos/vuejs/vue/issues/9632/comments","events_url":"https://api.github.com/repos/vuejs/vue/issues/9632/events","html_url":"https://github.com/vuejs/vue/issues/9632","id":417618881,"node_id":"MDU6SXNzdWU0MTc2MTg4ODE=","number":9632,"title":"Exception in IE 9 due to unsupported High Resolution Time API / getNow race-condition","user":{"login":"felixbuenemann","id":909587,"node_id":"MDQ6VXNlcjkwOTU4Nw==","avatar_url":"https://avatars.githubusercontent.com/u/909587?v=4","gravatar_id":"","url":"https://api.github.com/users/felixbuenemann","html_url":"https://github.com/felixbuenemann","followers_url":"https://api.github.com/users/felixbuenemann/followers","following_url":"https://api.github.com/users/felixbuenemann/following{/other_user}","gists_url":"https://api.github.com/users/felixbuenemann/gists{/gist_id}","starred_url":"https://api.github.com/users/felixbuenemann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixbuenemann/subscriptions","organizations_url":"https://api.github.com/users/felixbuenemann/orgs","repos_url":"https://api.github.com/users/felixbuenemann/repos","events_url":"https://api.github.com/users/felixbuenemann/events{/privacy}","received_events_url":"https://api.github.com/users/felixbuenemann/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224019885,"node_id":"MDU6TGFiZWwyMjQwMTk4ODU=","url":"https://api.github.com/repos/vuejs/vue/labels/regression","name":"regression","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-03-06T04:35:29Z","updated_at":"2019-03-10T04:03:47Z","closed_at":"2019-03-08T17:04:41Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Version\r\n2.6.8\r\n\r\n### Reproduction link\r\n[https://jsfiddle.net/re08ag7z/](https://jsfiddle.net/re08ag7z/)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n### Steps to reproduce\r\nWhen Vue.js is used in IE 9 (or IE 10/11 in IE 9 Emulation Mode), it sometimes crashes with an exception:\r\n\r\n> [Vue warn]: Error in nextTick: \"TypeError: Object doesn't support property or method 'now'\"\r\n\r\nThis seems to be due to the usage of `performance.now()` which is not supported in IE 9, see:\r\n\r\nhttps://caniuse.com/#feat=high-resolution-time\r\n\r\n### What is expected?\r\nIt should not crash, since IE 9 is a supported browser for Vue 2.x.\r\n\r\n### What is actually happening?\r\nIt crashes sometimes and sometimes it works.\r\n\r\n---\r\nI think the problem is a race-condition in the detection code of [getNow](https://github.com/vuejs/vue/blob/v2.6.8/src/core/observer/scheduler.js#L44):\r\n\r\n```javascript\r\nvar getNow = Date.now;\r\nif (inBrowser && getNow() > document.createEvent('Event').timeStamp) {\r\n  getNow = function () { return performance.now(); };\r\n}\r\n```\r\n\r\nIt looks like if `document.createEvent('Event').timeStamp` returns a unix timestamp, the result of this check is unpredictable, and is sometimes true and sometimes false.\r\n\r\nRunning the following in the IE 11 console when in IE 9 emulation mode sometimes returns true and sometimes false:\r\n\r\n```javascript\r\nDate.now() > document.createEvent('Event').timeStamp\r\n```\r\n\r\nThis check can also fail in IE 11 in IE 10 emulation mode, so it probably affects IE 10 as well.\r\n\r\nA possible workaround would be to check for something like `getNow() > document.createEvent('Event').timeStamp   1000`, though that still seems a bit brittle.\r\n\r\nIn my testing in a Windows 10 VM, the difference for `Date.now() - document.createEvent('Event').timeStamp` was usually  /- 2 ms, but sometimes I also got larger offsets, like Date.now() around 22 ms larger than timeStamp.\r\n\r\nThis problem could also be influenced by clock correction, when NTP or the VM host corrects the guest time between calls.\r\n\r\nGenerally comparisons of realtime clocks in computers is error prone and only monotonic timers should be trusted, which is probably one of the reasons why `performance.now()` was createdâ€¦\r\n\r\n<!-- generated by vue-issues. DO NOT REMOVE -->","closed_by":{"login":"yyx990803","id":499550,"node_id":"MDQ6VXNlcjQ5OTU1MA==","avatar_url":"https://avatars.githubusercontent.com/u/499550?v=4","gravatar_id":"","url":"https://api.github.com/users/yyx990803","html_url":"https://github.com/yyx990803","followers_url":"https://api.github.com/users/yyx990803/followers","following_url":"https://api.github.com/users/yyx990803/following{/other_user}","gists_url":"https://api.github.com/users/yyx990803/gists{/gist_id}","starred_url":"https://api.github.com/users/yyx990803/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyx990803/subscriptions","organizations_url":"https://api.github.com/users/yyx990803/orgs","repos_url":"https://api.github.com/users/yyx990803/repos","events_url":"https://api.github.com/users/yyx990803/events{/privacy}","received_events_url":"https://api.github.com/users/yyx990803/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vuejs/vue/issues/9632/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vuejs/vue/issues/9632/timeline","performed_via_github_app":null,"state_reason":"completed"}