diff --git a/src/core/vdom/patch.js b/src/core/vdom/patch.js
index 1a8c4a10..aac33dc4 100644
--- a/src/core/vdom/patch.js
+++ b/src/core/vdom/patch.js
@@ -260,9 +260,14 @@ export function createPatchFunction (backend) {
   // of going through the normal attribute patching process.
   function setScope (vnode) {
     let i
-    if (isDef(i = vnode.context) && isDef(i = i.$options._scopeId)) {
-      nodeOps.setAttribute(vnode.elm, i, '')
+    let ancestor = vnode
+    while (ancestor) {
+      if (isDef(i = ancestor.context) && isDef(i = i.$options._scopeId)) {
+        nodeOps.setAttribute(vnode.elm, i, '')
+      }
+      ancestor = ancestor.parent
     }
+    // for slot content they should also get the scopeId from the host instance.
     if (isDef(i = activeInstance) &&
         i !== vnode.context &&
         isDef(i = i.$options._scopeId)) {
diff --git a/test/unit/features/options/_scopeId.spec.js b/test/unit/features/options/_scopeId.spec.js
index eafe38d2..a01327a5 100644
--- a/test/unit/features/options/_scopeId.spec.js
+++ b/test/unit/features/options/_scopeId.spec.js
@@ -40,4 +40,32 @@ describe('Options _scopeId', () => {
     expect(vm.$el.children[0].children[0].hasAttribute('foo')).toBe(true)
     expect(vm.$el.children[0].children[0].hasAttribute('bar')).toBe(true)
   })
+
+  // #4774
+  it('should not discard parent scopeId when component root element is replaced', done => {
+    const vm = new Vue({
+      _scopeId: 'data-1',
+      template: `<div><child ref="child" /></div>`,
+      components: {
+        child: {
+          _scopeId: 'data-2',
+          data: () => ({ show: true }),
+          template: '<div v-if="show"></div>'
+        }
+      }
+    }).$mount()
+
+    const child = vm.$refs.child
+
+    expect(child.$el.hasAttribute('data-1')).toBe(true)
+    expect(child.$el.hasAttribute('data-2')).toBe(true)
+
+    child.show = false
+    waitForUpdate(() => {
+      child.show = true
+    }).then(() => {
+      expect(child.$el.hasAttribute('data-1')).toBe(true)
+      expect(child.$el.hasAttribute('data-2')).toBe(true)
+    }).then(done)
+  })
 })
