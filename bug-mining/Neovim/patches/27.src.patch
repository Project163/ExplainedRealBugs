diff --git a/src/nvim/generators/gen_api_dispatch.lua b/src/nvim/generators/gen_api_dispatch.lua
index 8ad5858c12..62c99ce082 100644
--- a/src/nvim/generators/gen_api_dispatch.lua
+++ b/src/nvim/generators/gen_api_dispatch.lua
@@ -260,7 +260,11 @@ fixdict(1 + #version)
 for _, item in ipairs(version) do
   -- NB: all items are mandatory. But any error will be less confusing
   -- with placeholder vim.NIL (than invalid mpack data)
-  put(item[1], item[2] or vim.NIL)
+  local val = item[2]
+  if val == nil then
+    val = vim.NIL
+  end
+  put(item[1], val)
 end
 put('build', version_build)
 
diff --git a/src/nvim/generators/nvim_version.lua.in b/src/nvim/generators/nvim_version.lua.in
index d0dbf77922..c29141fc68 100644
--- a/src/nvim/generators/nvim_version.lua.in
+++ b/src/nvim/generators/nvim_version.lua.in
@@ -2,7 +2,7 @@ return {
   {"major", ${NVIM_VERSION_MAJOR}},
   {"minor", ${NVIM_VERSION_MINOR}},
   {"patch", ${NVIM_VERSION_PATCH}},
-  {"prerelease", "$NVIM_VERSION_PRERELEASE" ~= ""},
+  {"prerelease", "${NVIM_VERSION_PRERELEASE}" ~= ""},
   {"api_level", ${NVIM_API_LEVEL}},
   {"api_compatible", ${NVIM_API_LEVEL_COMPAT}},
   {"api_prerelease", ${NVIM_API_PRERELEASE}},
