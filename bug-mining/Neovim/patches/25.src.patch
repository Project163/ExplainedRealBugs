diff --git a/runtime/lua/vim/lsp/inlay_hint.lua b/runtime/lua/vim/lsp/inlay_hint.lua
index c6be54e65f..d983357a2c 100644
--- a/runtime/lua/vim/lsp/inlay_hint.lua
+++ b/runtime/lua/vim/lsp/inlay_hint.lua
@@ -429,7 +429,7 @@ function M.enable(enable, filter)
 
   if filter.bufnr == nil then
     globalstate.enabled = enable
-    for bufnr, _ in pairs(bufstates) do
+    for _, bufnr in ipairs(api.nvim_list_bufs()) do
       if api.nvim_buf_is_loaded(bufnr) then
         if enable == false then
           _disable(bufnr)
