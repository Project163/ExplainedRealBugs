{"url":"https://api.github.com/repos/neovim/neovim/issues/28287","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/28287/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/28287/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/28287/events","html_url":"https://github.com/neovim/neovim/issues/28287","id":2238792889,"node_id":"I_kwDOAPphoM6FcUS5","number":28287,"title":"When applying a macro in visual mode, the visual selection is lost","user":{"login":"yorickpeterse","id":86065,"node_id":"MDQ6VXNlcjg2MDY1","avatar_url":"https://avatars.githubusercontent.com/u/86065?v=4","gravatar_id":"","url":"https://api.github.com/users/yorickpeterse","html_url":"https://github.com/yorickpeterse","followers_url":"https://api.github.com/users/yorickpeterse/followers","following_url":"https://api.github.com/users/yorickpeterse/following{/other_user}","gists_url":"https://api.github.com/users/yorickpeterse/gists{/gist_id}","starred_url":"https://api.github.com/users/yorickpeterse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yorickpeterse/subscriptions","organizations_url":"https://api.github.com/users/yorickpeterse/orgs","repos_url":"https://api.github.com/users/yorickpeterse/repos","events_url":"https://api.github.com/users/yorickpeterse/events{/privacy}","received_events_url":"https://api.github.com/users/yorickpeterse/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":103777064,"node_id":"MDU6TGFiZWwxMDM3NzcwNjQ=","url":"https://api.github.com/repos/neovim/neovim/labels/defaults","name":"defaults","color":"c5def5","default":false,"description":"Nvim defaults for options, colorscheme/theme, autocmds/events, etc."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/neovim/neovim/milestones/36","html_url":"https://github.com/neovim/neovim/milestone/36","labels_url":"https://api.github.com/repos/neovim/neovim/milestones/36/labels","id":8997654,"node_id":"MI_kwDOAPphoM4AiUsW","number":36,"title":"0.10","description":"","creator":{"login":"bfredl","id":1363104,"node_id":"MDQ6VXNlcjEzNjMxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1363104?v=4","gravatar_id":"","url":"https://api.github.com/users/bfredl","html_url":"https://github.com/bfredl","followers_url":"https://api.github.com/users/bfredl/followers","following_url":"https://api.github.com/users/bfredl/following{/other_user}","gists_url":"https://api.github.com/users/bfredl/gists{/gist_id}","starred_url":"https://api.github.com/users/bfredl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bfredl/subscriptions","organizations_url":"https://api.github.com/users/bfredl/orgs","repos_url":"https://api.github.com/users/bfredl/repos","events_url":"https://api.github.com/users/bfredl/events{/privacy}","received_events_url":"https://api.github.com/users/bfredl/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":440,"state":"closed","created_at":"2023-02-02T14:11:43Z","updated_at":"2025-01-05T13:24:13Z","due_on":"2024-05-12T07:00:00Z","closed_at":"2024-05-16T14:11:42Z"},"comments":5,"created_at":"2024-04-11T23:57:59Z","updated_at":"2024-04-14T23:15:02Z","closed_at":"2024-04-14T19:43:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\n\nWhen applying a macro while in visual mode, the macro _is_ applied but in doing so the visual selection is lost, almost as if applying the macro forces NeoVim into normal mode first. This makes it impossible to use macros for recording jumps (e.g. \"jump to the next `)`\") and then apply those to a visual selection.\n\n### Steps to reproduce\n\nThis reproduces with `nvim --clean`. First, create the file `test.txt` with these contents:\r\n\r\n```\r\nfoo(100, 200, 300)\r\nfoo(100000, 200000, 300000)\r\nfoo(1, 2, 3)\r\n```\r\n\r\nThen run `nvim --clean test.txt`. Perform the following steps:\r\n\r\n1. Place the cursor on the first `f` (the default)\r\n2. Press `v` to enter visual mode, followed by `e` to select the first `foo`\r\n3. Press `qq` to record a macro in the `q` register\r\n4. Press `t)` to jump to the last character before the `)`, note that the visual selection is extended\r\n5. Press `q` to stop recording the macro\r\n6. Exit visual mode\r\n7. Move to `f` on line 2, press `v` to enter visual mode and `e` to select `foo`\r\n8. Press `@q` and observe that while the jump _is_ performed, the visual selection is lost\r\n\r\nThis can be observed in this recording:\r\n\r\n[Screencast from 2024-04-12 01-51-34.webm](https://github.com/neovim/neovim/assets/86065/2ff561d7-4877-4459-8afc-729da7b37c4a)\n\n### Expected behavior\n\nThe visual selection is retained.\n\n### Neovim version (nvim -v)\n\naa56370f\n\n### Vim (not Nvim) behaves the same?\n\nNo, it (9.1.264) behaves as expected\n\n### Operating system/version\n\nFedora 39\n\n### Terminal name/version\n\nGhostty\n\n### $TERM environment variable\n\nxterm-ghostty\n\n### Installation\n\nGit","closed_by":{"login":"zeertzjq","id":35768171,"node_id":"MDQ6VXNlcjM1NzY4MTcx","avatar_url":"https://avatars.githubusercontent.com/u/35768171?v=4","gravatar_id":"","url":"https://api.github.com/users/zeertzjq","html_url":"https://github.com/zeertzjq","followers_url":"https://api.github.com/users/zeertzjq/followers","following_url":"https://api.github.com/users/zeertzjq/following{/other_user}","gists_url":"https://api.github.com/users/zeertzjq/gists{/gist_id}","starred_url":"https://api.github.com/users/zeertzjq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zeertzjq/subscriptions","organizations_url":"https://api.github.com/users/zeertzjq/orgs","repos_url":"https://api.github.com/users/zeertzjq/repos","events_url":"https://api.github.com/users/zeertzjq/events{/privacy}","received_events_url":"https://api.github.com/users/zeertzjq/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/28287/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/28287/timeline","performed_via_github_app":null,"state_reason":"completed"}