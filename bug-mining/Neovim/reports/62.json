{"url":"https://api.github.com/repos/neovim/neovim/issues/33277","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/33277/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/33277/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/33277/events","html_url":"https://github.com/neovim/neovim/issues/33277","id":2967626165,"node_id":"I_kwDOAPphoM6w4mG1","number":33277,"title":"Treesitter: parse error \"attempt to yield across C-call boundary\"","user":{"login":"swarn","id":926528,"node_id":"MDQ6VXNlcjkyNjUyOA==","avatar_url":"https://avatars.githubusercontent.com/u/926528?v=4","gravatar_id":"","url":"https://api.github.com/users/swarn","html_url":"https://github.com/swarn","followers_url":"https://api.github.com/users/swarn/followers","following_url":"https://api.github.com/users/swarn/following{/other_user}","gists_url":"https://api.github.com/users/swarn/gists{/gist_id}","starred_url":"https://api.github.com/users/swarn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swarn/subscriptions","organizations_url":"https://api.github.com/users/swarn/orgs","repos_url":"https://api.github.com/users/swarn/repos","events_url":"https://api.github.com/users/swarn/events{/privacy}","received_events_url":"https://api.github.com/users/swarn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":619474658,"node_id":"MDU6TGFiZWw2MTk0NzQ2NTg=","url":"https://api.github.com/repos/neovim/neovim/labels/bug-regression","name":"bug-regression","color":"f9d0c4","default":false,"description":"wrong behavior that was introduced in a previous commit (please bisect)"},{"id":1481421490,"node_id":"MDU6TGFiZWwxNDgxNDIxNDkw","url":"https://api.github.com/repos/neovim/neovim/labels/has:bisected","name":"has:bisected","color":"0E8A16","default":false,"description":"issue has been tracked to a specific commit"},{"id":1799626557,"node_id":"MDU6TGFiZWwxNzk5NjI2NTU3","url":"https://api.github.com/repos/neovim/neovim/labels/treesitter","name":"treesitter","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/neovim/neovim/milestones/43","html_url":"https://github.com/neovim/neovim/milestone/43","labels_url":"https://api.github.com/repos/neovim/neovim/milestones/43/labels","id":11063573,"node_id":"MI_kwDOAPphoM4AqNEV","number":43,"title":"0.12","description":"","creator":{"login":"justinmk","id":1359421,"node_id":"MDQ6VXNlcjEzNTk0MjE=","avatar_url":"https://avatars.githubusercontent.com/u/1359421?v=4","gravatar_id":"","url":"https://api.github.com/users/justinmk","html_url":"https://github.com/justinmk","followers_url":"https://api.github.com/users/justinmk/followers","following_url":"https://api.github.com/users/justinmk/following{/other_user}","gists_url":"https://api.github.com/users/justinmk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinmk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinmk/subscriptions","organizations_url":"https://api.github.com/users/justinmk/orgs","repos_url":"https://api.github.com/users/justinmk/repos","events_url":"https://api.github.com/users/justinmk/events{/privacy}","received_events_url":"https://api.github.com/users/justinmk/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":80,"closed_issues":146,"state":"open","created_at":"2024-05-16T14:11:54Z","updated_at":"2025-11-10T00:49:26Z","due_on":"2025-12-25T08:00:00Z","closed_at":null},"comments":12,"created_at":"2025-04-02T21:51:10Z","updated_at":"2025-04-12T22:51:31Z","closed_at":"2025-04-12T22:51:31Z","author_association":"CONTRIBUTOR","type":{"id":597163,"node_id":"IT_kwDOAGK_Pc4ACRyr","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T10:10:19Z","updated_at":"2024-07-26T10:12:30Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\n\nOpening a largish markdown file gives the following error:\n```\nError executing vim.schedule lua callback: ...r/share/nvim/runtime/lua/vim/treesitter/languagetree.\nlua:406: attempt to yield across C-call boundary\nstack traceback:\n        [C]: in function 'yield'\n        ...r/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:406: in function '_parse_region\ns'\n        ...r/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:618: in function '_parse'\n        ...r/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:585: in function 'parse'\n        ...issue/nvim_issue/2//lua/render-markdown/core/context.lua:192: in function 'callback'\n        ...issue/nvim_issue/2//lua/render-markdown/core/context.lua:214: in function 'for_each'\n        ...issue/nvim_issue/2//lua/render-markdown/core/context.lua:191: in function 'parse'\n        ...t/ts_issue/nvim_issue/2//lua/render-markdown/core/ui.lua:202: in function 'parse_buffer'\n\n        ...t/ts_issue/nvim_issue/2//lua/render-markdown/core/ui.lua:139: in function 'run_update'\n        ...t/ts_issue/nvim_issue/2//lua/render-markdown/core/ui.lua:91: in function <...t/ts_issue/\nnvim_issue/2//lua/render-markdown/core/ui.lua:90>\n```\n\nSometimes but not always, you also get the following error:\n```\nError in decoration provider \"conceal_line\" (ns=nvim.treesitter.highlighter):\nError executing lua: ...r/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:406: attempt to yi\neld across C-call boundary\nstack traceback:\n        [C]: in function 'yield'\n        ...r/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:406: in function '_parse_region\ns'\n        ...r/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:618: in function '_parse'\n        ...r/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:585: in function 'parse'\n        ...er/share/nvim/runtime/lua/vim/treesitter/highlighter.lua:439: in function <...er/share/n\nvim/runtime/lua/vim/treesitter/highlighter.lua:431>\n```\n\nWhile this is coming from the `render-markdown` plugin, I think it's only because that plugin is exercising the `parse` function so much. This was mentioned  in MeanderingProgrammer/render-markdown.nvim#387.\n\n### Steps to reproduce\n\n```\nnvim --clean -u minimal.lua parser.md\n```\n\nminimal.lua\n```lua\nfor name, url in pairs {\n  \"https://github.com/nvim-treesitter/nvim-treesitter\",\n  \"https://github.com/MeanderingProgrammer/render-markdown.nvim\",\n} do\n  local install_path = vim.fn.fnamemodify(\"nvim_issue/\" .. name, \":p\")\n  if vim.fn.isdirectory(install_path) == 0 then\n    vim.fn.system { \"git\", \"clone\", \"--depth=1\", url, install_path }\n  end\n  vim.opt.runtimepath:append(install_path)\nend\n\nrequire(\"nvim-treesitter.configs\").setup {\n  highlight = { enable = true }\n}\n\nrequire(\"render-markdown\").setup {}\n```\n\n[parser.md](https://github.com/user-attachments/files/19576040/parser.md)\n\n### Expected behavior\n\nNo error\n\n### Nvim version (nvim -v)\n\nNVIM v0.12.0-dev-71+g0b61bc8982 Build type: RelWithDebInfo LuaJIT 2.1.1741730670\n\n### Vim (not Nvim) behaves the same?\n\nno\n\n### Operating system/version\n\nmacOS 15.3\n\n### Terminal name/version\n\nghostty\n\n### $TERM environment variable\n\nxterm-ghostty\n\n### Installation\n\nbuild from repro","closed_by":{"login":"justinmk","id":1359421,"node_id":"MDQ6VXNlcjEzNTk0MjE=","avatar_url":"https://avatars.githubusercontent.com/u/1359421?v=4","gravatar_id":"","url":"https://api.github.com/users/justinmk","html_url":"https://github.com/justinmk","followers_url":"https://api.github.com/users/justinmk/followers","following_url":"https://api.github.com/users/justinmk/following{/other_user}","gists_url":"https://api.github.com/users/justinmk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinmk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinmk/subscriptions","organizations_url":"https://api.github.com/users/justinmk/orgs","repos_url":"https://api.github.com/users/justinmk/repos","events_url":"https://api.github.com/users/justinmk/events{/privacy}","received_events_url":"https://api.github.com/users/justinmk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/33277/reactions","total_count":8,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/33277/timeline","performed_via_github_app":null,"state_reason":"completed"}