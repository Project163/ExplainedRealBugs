{"url":"https://api.github.com/repos/neovim/neovim/issues/27318","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/27318/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/27318/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/27318/events","html_url":"https://github.com/neovim/neovim/issues/27318","id":2116227977,"node_id":"I_kwDOAPphoM5-IxOJ","number":27318,"title":"LSP: Code action ranges broken in neovim > `0.7`","user":{"login":"keithfancher","id":132365,"node_id":"MDQ6VXNlcjEzMjM2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/132365?v=4","gravatar_id":"","url":"https://api.github.com/users/keithfancher","html_url":"https://github.com/keithfancher","followers_url":"https://api.github.com/users/keithfancher/followers","following_url":"https://api.github.com/users/keithfancher/following{/other_user}","gists_url":"https://api.github.com/users/keithfancher/gists{/gist_id}","starred_url":"https://api.github.com/users/keithfancher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keithfancher/subscriptions","organizations_url":"https://api.github.com/users/keithfancher/orgs","repos_url":"https://api.github.com/users/keithfancher/repos","events_url":"https://api.github.com/users/keithfancher/events{/privacy}","received_events_url":"https://api.github.com/users/keithfancher/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":662566370,"node_id":"MDU6TGFiZWw2NjI1NjYzNzA=","url":"https://api.github.com/repos/neovim/neovim/labels/lsp","name":"lsp","color":"c5def5","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2024-02-03T04:49:12Z","updated_at":"2024-03-06T11:12:42Z","closed_at":"2024-03-06T11:12:42Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\n\nPlease see related haskell-language-server issue:  https://github.com/haskell/haskell-language-server/issues/3857\r\n\r\nThe HLS \"Remove redundant imports\" code action stopped appearing after neovim `0.7`. It appears that neovim might be making malformed requests to the language server?\r\n\r\nThe code action works in neovim `0.7`, but is broken in neovim `0.9.x`. The code action works as expected in VS Code, which suggests it is in fact an issue with neovim rather than the haskell language server.\r\n\r\nFollowing are the contents of the requests for neovim `0.7` and `0.9`:\r\n\r\n**neovim 0.7**\r\n```\r\n[DEBUG][2023-10-31 14:31:44] .../vim/lsp/rpc.lua:347\t\"rpc.send\"\t{  id = 2,  jsonrpc = \"2.0\",  method = \"textDocument/codeAction\",  params = {    context = {      diagnostics = { {          code = \"-Wunused-imports\",          message = \"The import of ‘generateDebugUI’\\nfrom module ‘DebugInfoScreen’ is redundant\",          range = {            end = {              character = 53,              line = 8            },            start = {              character = 38,              line = 8            }          },          severity = 2,          source = \"typecheck\",          tags = { 1 }        } }    },    range = {      end = <1>{        character = 0,        line = 8      },      start = <table 1>    },    textDocument = {      uri = \"file:///Users/axis/dev/ultimate/src/Program/IODriver.hs\"    }  }}\r\n```\r\n\r\n**neovim 0.9**\r\n```\r\n[DEBUG][2023-10-31 14:45:44] .../vim/lsp/rpc.lua:284\t\"rpc.send\"\t{  id = 9,  jsonrpc = \"2.0\",  method = \"textDocument/codeAction\",  params = {    context = {      diagnostics = { {          code = \"-Wunused-imports\",          message = \"The import of ‘generateDebugUI’\\nfrom module ‘DebugInfoScreen’ is redundant\",          range = {            [\"end\"] = {              character = 53,              line = 8            },            start = {              character = 38,              line = 8            }          },          severity = 2,          source = \"typecheck\"        } },      triggerKind = 1    },    range = {      [\"end\"] = <1>{        character = 5,        line = 8      },      start = <table 1>    },    textDocument = {      uri = \"file:///Users/axis/dev/ultimate/src/Program/IODriver.hs\"    }  }}\r\n```\r\n----\r\n\r\nThe diff of these two boils down to:\r\n\r\n**0.7:**\r\n```\r\nrange = {      end = <1>{        character = 0,        line = 8      },      start = <table 1>   }\r\n```\r\n\r\n**0.9:**\r\n```\r\nrange = {      [\"end\"] = <1>{        character = 5,        line = 8      },      start = <table 1>    }\r\n```\r\n\r\nNote the `[\"end\"] = ` bit, seems like the JSON might be wonky?\n\n### Steps to reproduce\n\nOpen a Haskell file using neovim 0.9.x and the haskell-language-server. Add a redundant import. Ask for code actions on this line.\n\n### Expected behavior\n\nThere is a code action to 'Remove import' and 'Remove all redundant imports', as well as 'Disable 'unused-imports' warnings'\n\n### Neovim version (nvim -v)\n\nNVIM v0.9.5 Build type: Release LuaJIT 2.1.1692716794\n\n### Vim (not Nvim) behaves the same?\n\nn/a\n\n### Operating system/version\n\nPopOS 22.04\n\n### Terminal name/version\n\ngnome-terminal\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nappimage","closed_by":{"login":"lewis6991","id":7904185,"node_id":"MDQ6VXNlcjc5MDQxODU=","avatar_url":"https://avatars.githubusercontent.com/u/7904185?v=4","gravatar_id":"","url":"https://api.github.com/users/lewis6991","html_url":"https://github.com/lewis6991","followers_url":"https://api.github.com/users/lewis6991/followers","following_url":"https://api.github.com/users/lewis6991/following{/other_user}","gists_url":"https://api.github.com/users/lewis6991/gists{/gist_id}","starred_url":"https://api.github.com/users/lewis6991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lewis6991/subscriptions","organizations_url":"https://api.github.com/users/lewis6991/orgs","repos_url":"https://api.github.com/users/lewis6991/repos","events_url":"https://api.github.com/users/lewis6991/events{/privacy}","received_events_url":"https://api.github.com/users/lewis6991/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/27318/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/27318/timeline","performed_via_github_app":null,"state_reason":"completed"}