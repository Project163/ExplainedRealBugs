{"url":"https://api.github.com/repos/neovim/neovim/issues/27046","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/27046/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/27046/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/27046/events","html_url":"https://github.com/neovim/neovim/issues/27046","id":2084427221,"node_id":"I_kwDOAPphoM58PdXV","number":27046,"title":"Assertion `buf->b_signcols.count[width - 1] >= 0` failed","user":{"login":"przepompownia","id":11404453,"node_id":"MDQ6VXNlcjExNDA0NDUz","avatar_url":"https://avatars.githubusercontent.com/u/11404453?v=4","gravatar_id":"","url":"https://api.github.com/users/przepompownia","html_url":"https://github.com/przepompownia","followers_url":"https://api.github.com/users/przepompownia/followers","following_url":"https://api.github.com/users/przepompownia/following{/other_user}","gists_url":"https://api.github.com/users/przepompownia/gists{/gist_id}","starred_url":"https://api.github.com/users/przepompownia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/przepompownia/subscriptions","organizations_url":"https://api.github.com/users/przepompownia/orgs","repos_url":"https://api.github.com/users/przepompownia/repos","events_url":"https://api.github.com/users/przepompownia/events{/privacy}","received_events_url":"https://api.github.com/users/przepompownia/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":435854079,"node_id":"MDU6TGFiZWw0MzU4NTQwNzk=","url":"https://api.github.com/repos/neovim/neovim/labels/has:backtrace","name":"has:backtrace","color":"0E8A16","default":false,"description":"issue contains a stacktrace/ASAN log"},{"id":435854234,"node_id":"MDU6TGFiZWw0MzU4NTQyMzQ=","url":"https://api.github.com/repos/neovim/neovim/labels/bug-crash","name":"bug-crash","color":"F9D0C4","default":false,"description":"issue reporting a crash or segfault"},{"id":1680119719,"node_id":"MDU6TGFiZWwxNjgwMTE5NzE5","url":"https://api.github.com/repos/neovim/neovim/labels/marks","name":"marks","color":"c5def5","default":false,"description":"marks, extmarks, decorations, virtual text"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/neovim/neovim/milestones/36","html_url":"https://github.com/neovim/neovim/milestone/36","labels_url":"https://api.github.com/repos/neovim/neovim/milestones/36/labels","id":8997654,"node_id":"MI_kwDOAPphoM4AiUsW","number":36,"title":"0.10","description":"","creator":{"login":"bfredl","id":1363104,"node_id":"MDQ6VXNlcjEzNjMxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1363104?v=4","gravatar_id":"","url":"https://api.github.com/users/bfredl","html_url":"https://github.com/bfredl","followers_url":"https://api.github.com/users/bfredl/followers","following_url":"https://api.github.com/users/bfredl/following{/other_user}","gists_url":"https://api.github.com/users/bfredl/gists{/gist_id}","starred_url":"https://api.github.com/users/bfredl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bfredl/subscriptions","organizations_url":"https://api.github.com/users/bfredl/orgs","repos_url":"https://api.github.com/users/bfredl/repos","events_url":"https://api.github.com/users/bfredl/events{/privacy}","received_events_url":"https://api.github.com/users/bfredl/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":440,"state":"closed","created_at":"2023-02-02T14:11:43Z","updated_at":"2025-01-05T13:24:13Z","due_on":"2024-05-12T07:00:00Z","closed_at":"2024-05-16T14:11:42Z"},"comments":36,"created_at":"2024-01-16T16:50:20Z","updated_at":"2025-06-18T12:43:26Z","closed_at":"2024-02-23T12:37:12Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\r\n\r\nFrom few days I get crashes when updating the buffer e.g. undo. \r\n\r\n```cpp\r\n#0  __pthread_kill_implementation (threadid=<optimized out>, signo=signo@entry=6, no_tid=no_tid@entry=0) at ./nptl/pthread_kill.c:44\r\n#1  0x00007fea9eef315f in __pthread_kill_internal (signo=6, threadid=<optimized out>) at ./nptl/pthread_kill.c:78\r\n#2  0x00007fea9eea5472 in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26\r\n#3  0x00007fea9ee8f4b2 in __GI_abort () at ./stdlib/abort.c:79\r\n#4  0x00007fea9ee8f3d5 in __assert_fail_base (fmt=0x7fea9f003dc8 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\", assertion=assertion@entry=0x5565767fe960 \"buf->b_signcols.count[width - 1] >= 0\",\r\n    file=file@entry=0x5565767fe748 \".../src/nvim/decoration.c\", line=line@entry=848, function=function@entry=0x55657679f310 <__PRETTY_FUNCTION__.1.lto_priv.8> \"buf_signcols_count_range\") at ./assert/assert.c:92\r\n#5  0x00007fea9ee9e3a2 in __assert_fail (assertion=assertion@entry=0x5565767fe960 \"buf->b_signcols.count[width - 1] >= 0\", file=file@entry=0x5565767fe748 \".../src/nvim/decoration.c\", line=line@entry=848,\r\n    function=function@entry=0x55657679f310 <__PRETTY_FUNCTION__.1.lto_priv.8> \"buf_signcols_count_range\") at ./assert/assert.c:101\r\n#6  0x00005565764923be in buf_signcols_count_range (buf=0x55657a5cb7f0, row1=20, row2=20, add=-1, clear=kFalse) at .../src/nvim/decoration.c:848\r\n#7  0x000055657648f9c0 in buf_remove_decor_sh (buf=buf@entry=0x55657a5cb7f0, row1=row1@entry=20, row2=row2@entry=20, sh=sh@entry=0x556578824ac0) at .../src/nvim/decoration.c:258\r\n#8  0x000055657648fa46 in buf_decor_remove (buf=0x55657a5cb7f0, row1=20, row2=20, decor=..., free=true) at .../src/nvim/decoration.c:227\r\n#9  0x0000556576516e98 in extmark_del (buf=buf@entry=0x55657a5cb7f0, itr=itr@entry=0x7fff47f5d040, key=..., restore=restore@entry=true) at .../src/nvim/extmark.c:153\r\n#10 0x0000556576517558 in extmark_clear (buf=0x55657a5cb7f0, ns_id=53, l_row=0, l_col=<optimized out>, u_row=2147483646, u_col=2147483647) at .../src/nvim/extmark.c:189\r\n#11 0x0000556576444f04 in nvim_buf_clear_namespace (buffer=<optimized out>, ns_id=53, line_start=0, line_end=2147483647, err=0x7fff47f5d190) at .../src/nvim/api/extmark.c:973\r\n#12 0x0000556576429c02 in nlua_api_nvim_buf_clear_namespace (lstate=0x7fea8a4ac5f0) at .../build/src/nvim/auto/lua_api_c_bindings.generated.c:2922\r\n#13 0x0000556576726ed6 in lj_BC_FUNCC ()\r\n#14 0x0000556576727d32 in lj_ff_coroutine_resume ()\r\n#15 0x00005565767132a5 in lua_pcall (L=L@entry=0x7fea9ee47380, nargs=nargs@entry=0, nresults=nresults@entry=0, errfunc=errfunc@entry=-2) at lj_api.c:1121\r\n#16 0x000055657654d077 in nlua_pcall (lstate=lstate@entry=0x7fea9ee47380, nargs=nargs@entry=0, nresults=nresults@entry=0) at .../src/nvim/lua/executor.c:172\r\n#17 0x0000556576550cbc in nlua_schedule_event (argv=<optimized out>) at .../src/nvim/lua/executor.c:367\r\n#18 0x0000556576639898 in state_handle_k_event () at .../src/nvim/state.c:119\r\n#19 0x00005565765a1c99 in nv_event (cap=0x7fff47f5d460) at .../src/nvim/normal.c:6613\r\n#20 0x000055657659d9d1 in normal_execute (state=0x7fff47f5d3f0, key=<optimized out>) at .../src/nvim/normal.c:1227\r\n#21 0x000055657663973b in state_enter (s=0x7fff47f5d3f0) at .../src/nvim/state.c:101\r\n#22 0x000055657659735d in normal_enter (cmdwin=<optimized out>, noexmode=<optimized out>) at .../src/nvim/normal.c:516\r\n#23 0x00005565765601bd in main (argc=2, argv=<optimized out>) at .../src/nvim/main.c:651\r\n```\r\n\r\n@luukvbaal it looks like from https://github.com/neovim/neovim/commit/967c7abde3c6fa3210a4920a5848a54dc913d851#diff-6e7593afe2030cd8628b9a5a900e49accd4a9d7f3ff4b73ee022f06b4bd0f237R848\r\n\r\n### Steps to reproduce\r\n\r\nAt the moment I have no idea how to reproduce this bug. I use statuscol nvim on branch 0.10 with \r\n```lua\r\nlocal builtin = require('statuscol.builtin')\r\nrequire('statuscol').setup({\r\n  relculright = true,\r\n  segments = {\r\n    {\r\n      text = {builtin.foldfunc},\r\n      condition = {true},\r\n      click = 'v:lua.ScFa',\r\n    },\r\n    {\r\n      sign = {namespace = {'gitsigns*'}, maxwidth = 1, colwidth = 1, auto = true},\r\n      click = 'v:lua.ScSa',\r\n    },\r\n    {\r\n      sign = {namespace = {'arctgx.diagnostic.signs/diagnostic/signs'}, maxwidth = 2, colwidth = 2, auto = true},\r\n      click = 'v:lua.ScSa'\r\n    },\r\n    {\r\n      sign = {name = {'Dap.*'}, maxwidth = 2, colwidth = 2, auto = true},\r\n      click = 'v:lua.ScLa'\r\n    },\r\n    {\r\n      sign = {name = {'.*'}, maxwidth = 1, colwidth = 1, auto = true},\r\n      click = 'v:lua.ScSa'\r\n    },\r\n    {text = {builtin.lnumfunc, ' '}, click = 'v:lua.ScLa',},\r\n  },\r\n  ft_ignore = {\r\n    'NvimTree',\r\n  },\r\n})\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo crash\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-2104+gfd2ed024c\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\n-\r\n\r\n### Operating system/version\r\n\r\nDebian Sid\r\n\r\n### Terminal name/version\r\n\r\nalacritty 0.13.1\r\n\r\n### $TERM environment variable\r\n\r\nalacritty\r\n\r\n### Installation\r\n\r\nfrom repo","closed_by":{"login":"bfredl","id":1363104,"node_id":"MDQ6VXNlcjEzNjMxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1363104?v=4","gravatar_id":"","url":"https://api.github.com/users/bfredl","html_url":"https://github.com/bfredl","followers_url":"https://api.github.com/users/bfredl/followers","following_url":"https://api.github.com/users/bfredl/following{/other_user}","gists_url":"https://api.github.com/users/bfredl/gists{/gist_id}","starred_url":"https://api.github.com/users/bfredl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bfredl/subscriptions","organizations_url":"https://api.github.com/users/bfredl/orgs","repos_url":"https://api.github.com/users/bfredl/repos","events_url":"https://api.github.com/users/bfredl/events{/privacy}","received_events_url":"https://api.github.com/users/bfredl/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/27046/reactions","total_count":6,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":2},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/27046/timeline","performed_via_github_app":null,"state_reason":"completed"}