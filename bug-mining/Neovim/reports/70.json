{"url":"https://api.github.com/repos/neovim/neovim/issues/33749","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/33749/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/33749/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/33749/events","html_url":"https://github.com/neovim/neovim/issues/33749","id":3034178348,"node_id":"I_kwDOAPphoM602eMs","number":33749,"title":"Heap corruption crash (scrolling invalid grid)","user":{"login":"AThePeanut4","id":49614525,"node_id":"MDQ6VXNlcjQ5NjE0NTI1","avatar_url":"https://avatars.githubusercontent.com/u/49614525?v=4","gravatar_id":"","url":"https://api.github.com/users/AThePeanut4","html_url":"https://github.com/AThePeanut4","followers_url":"https://api.github.com/users/AThePeanut4/followers","following_url":"https://api.github.com/users/AThePeanut4/following{/other_user}","gists_url":"https://api.github.com/users/AThePeanut4/gists{/gist_id}","starred_url":"https://api.github.com/users/AThePeanut4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AThePeanut4/subscriptions","organizations_url":"https://api.github.com/users/AThePeanut4/orgs","repos_url":"https://api.github.com/users/AThePeanut4/repos","events_url":"https://api.github.com/users/AThePeanut4/events{/privacy}","received_events_url":"https://api.github.com/users/AThePeanut4/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":619474658,"node_id":"MDU6TGFiZWw2MTk0NzQ2NTg=","url":"https://api.github.com/repos/neovim/neovim/labels/bug-regression","name":"bug-regression","color":"f9d0c4","default":false,"description":"wrong behavior that was introduced in a previous commit (please bisect)"},{"id":1481421490,"node_id":"MDU6TGFiZWwxNDgxNDIxNDkw","url":"https://api.github.com/repos/neovim/neovim/labels/has:bisected","name":"has:bisected","color":"0E8A16","default":false,"description":"issue has been tracked to a specific commit"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2025-05-01T16:06:34Z","updated_at":"2025-05-05T09:20:15Z","closed_at":"2025-05-05T09:20:15Z","author_association":"CONTRIBUTOR","type":{"id":597163,"node_id":"IT_kwDOAGK_Pc4ACRyr","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T10:10:19Z","updated_at":"2024-07-26T10:12:30Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\n\nAfter opening a floating window using a hover plugin I'm working on, Neovim just crashes with what looks like an error message before the screen is cleared completely. After triggering the crash under LLDB, I get a \"malloc: Heap corruption detected, free list is damaged at 0x600001104ef0\" error.\n\nSometimes the floating window appears and then nvim crashes shortly afterwards, and sometimes it crashes basically immediately and the window doesn't show up at all.\n\n### Steps to reproduce\n\nI am able to trigger the crash consistently using my own config and plugins and everything, but I have no idea where to begin trying to figure out minimal reproduction steps.\n\nPossibly relevant context is that I just added support for using `man.lua` to show manpages in my plugin's hover window, the crashes are only happening when using that functionality.\n\nI have been able to bisect the first bad commit to bd413a2f55be7db4e4d9b821758580f59b5cc01e, ping @bfredl \n\nThe LLDB output is attached below, including a backtrace, for what it's worth. I'm happy to provide a core dump or sit through with whoever and debug, just let me know.\n\n[lldb.txt](https://github.com/user-attachments/files/20001758/lldb.txt)\n\n### Expected behavior\n\nNo crash :|\n\n### Nvim version (nvim -v)\n\nv0.12.0-dev-267+gd1fed989f2\n\n### Vim (not Nvim) behaves the same?\n\nNot sure how to test this, but probably not\n\n### Operating system/version\n\nmacOS 15.4.1\n\n### Terminal name/version\n\nAlacritty 0.15.1\n\n### $TERM environment variable\n\nalacritty\n\n### Installation\n\nBuild from repo (but also happens with my normal homebrew --HEAD install)","closed_by":{"login":"bfredl","id":1363104,"node_id":"MDQ6VXNlcjEzNjMxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1363104?v=4","gravatar_id":"","url":"https://api.github.com/users/bfredl","html_url":"https://github.com/bfredl","followers_url":"https://api.github.com/users/bfredl/followers","following_url":"https://api.github.com/users/bfredl/following{/other_user}","gists_url":"https://api.github.com/users/bfredl/gists{/gist_id}","starred_url":"https://api.github.com/users/bfredl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bfredl/subscriptions","organizations_url":"https://api.github.com/users/bfredl/orgs","repos_url":"https://api.github.com/users/bfredl/repos","events_url":"https://api.github.com/users/bfredl/events{/privacy}","received_events_url":"https://api.github.com/users/bfredl/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/33749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/33749/timeline","performed_via_github_app":null,"state_reason":"completed"}