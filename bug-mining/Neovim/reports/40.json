{"url":"https://api.github.com/repos/neovim/neovim/issues/30400","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/30400/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/30400/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/30400/events","html_url":"https://github.com/neovim/neovim/issues/30400","id":2528941279,"node_id":"I_kwDOAPphoM6WvJTf","number":30400,"title":"SIGSEGV when case-folding invalid char","user":{"login":"glacambre","id":11534587,"node_id":"MDQ6VXNlcjExNTM0NTg3","avatar_url":"https://avatars.githubusercontent.com/u/11534587?v=4","gravatar_id":"","url":"https://api.github.com/users/glacambre","html_url":"https://github.com/glacambre","followers_url":"https://api.github.com/users/glacambre/followers","following_url":"https://api.github.com/users/glacambre/following{/other_user}","gists_url":"https://api.github.com/users/glacambre/gists{/gist_id}","starred_url":"https://api.github.com/users/glacambre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glacambre/subscriptions","organizations_url":"https://api.github.com/users/glacambre/orgs","repos_url":"https://api.github.com/users/glacambre/repos","events_url":"https://api.github.com/users/glacambre/events{/privacy}","received_events_url":"https://api.github.com/users/glacambre/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":298863445,"node_id":"MDU6TGFiZWwyOTg4NjM0NDU=","url":"https://api.github.com/repos/neovim/neovim/labels/needs:repro","name":"needs:repro","color":"FBCA04","default":false,"description":"We need minimal steps to reproduce the issue"},{"id":435854079,"node_id":"MDU6TGFiZWw0MzU4NTQwNzk=","url":"https://api.github.com/repos/neovim/neovim/labels/has:backtrace","name":"has:backtrace","color":"0E8A16","default":false,"description":"issue contains a stacktrace/ASAN log"},{"id":435854234,"node_id":"MDU6TGFiZWw0MzU4NTQyMzQ=","url":"https://api.github.com/repos/neovim/neovim/labels/bug-crash","name":"bug-crash","color":"F9D0C4","default":false,"description":"issue reporting a crash or segfault"},{"id":2882115256,"node_id":"MDU6TGFiZWwyODgyMTE1MjU2","url":"https://api.github.com/repos/neovim/neovim/labels/unicode%20%20%F0%9F%92%A9","name":"unicode  ðŸ’©","color":"c5def5","default":false,"description":"(multibyte) unicode characters"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/neovim/neovim/milestones/41","html_url":"https://github.com/neovim/neovim/milestone/41","labels_url":"https://api.github.com/repos/neovim/neovim/milestones/41/labels","id":10283236,"node_id":"MI_kwDOAPphoM4AnOjk","number":41,"title":"0.11","description":"","creator":{"login":"justinmk","id":1359421,"node_id":"MDQ6VXNlcjEzNTk0MjE=","avatar_url":"https://avatars.githubusercontent.com/u/1359421?v=4","gravatar_id":"","url":"https://api.github.com/users/justinmk","html_url":"https://github.com/justinmk","followers_url":"https://api.github.com/users/justinmk/followers","following_url":"https://api.github.com/users/justinmk/following{/other_user}","gists_url":"https://api.github.com/users/justinmk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinmk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinmk/subscriptions","organizations_url":"https://api.github.com/users/justinmk/orgs","repos_url":"https://api.github.com/users/justinmk/repos","events_url":"https://api.github.com/users/justinmk/events{/privacy}","received_events_url":"https://api.github.com/users/justinmk/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":282,"state":"closed","created_at":"2023-12-07T23:09:35Z","updated_at":"2025-08-11T15:17:16Z","due_on":"2025-03-30T07:00:00Z","closed_at":"2025-03-26T14:28:55Z"},"comments":5,"created_at":"2024-09-16T16:35:53Z","updated_at":"2024-10-03T17:00:51Z","closed_at":"2024-09-29T09:03:37Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\r\n\r\nNeovim reliably segfaults while attempting to draw a window for the first time.\r\n\r\n### Steps to reproduce\r\n\r\nI have been unable to create a minimal reproducer for now. The crash seems to rely on both my config and vim-polyglot and AFAICT only requires running `:TOhtml` on a file with zsh syntax highlighting to reproduce. I will keep attempting to build a reproducer, if I can't fix it myself.\r\n\r\n### Expected behavior\r\n\r\nNo crash.\r\n\r\n\r\n### Additional information\r\nBacktrace:\r\n```\r\n0x000055f26b256338 in utf_ptr2char (p_in=0x0) at /home/me/prog/neovim/src/nvim/mbyte.c:673\r\n673       uint32_t const v0 = p[0];\r\n(ins)(gdb) bt\r\n#0  0x000055f26b256338 in utf_ptr2char (p_in=0x0) at /home/me/prog/neovim/src/nvim/mbyte.c:673\r\n#1  0x000055f26b257613 in utf_fold (a=55296) at /home/me/prog/neovim/src/nvim/mbyte.c:1314\r\n#2  0x000055f26b31686c in nfa_regmatch (prog=0x55f27cc8e770, start=0x55f27cc8eba8, \r\n    submatch=0x7fff2dfe3230, m=0x7fff2dfe3390) at /home/me/prog/neovim/src/nvim/regexp.c:14810\r\n#3  0x000055f26b318c4a in nfa_regtry (prog=0x55f27cc8e770, col=24, tm=0x7fff2dfe5200, \r\n    timed_out=0x7fff2dfe36f8) at /home/me/prog/neovim/src/nvim/regexp.c:15535\r\n#4  0x000055f26b319431 in nfa_regexec_both (\r\n    line=0x55f27cc2375f \"body {background-color: #ffffff; color: #4e4e4e}\", startcol=4, \r\n    tm=0x7fff2dfe5200, timed_out=0x7fff2dfe36f8) at /home/me/prog/neovim/src/nvim/regexp.c:15720\r\n#5  0x000055f26b3198a5 in nfa_regexec_multi (rmp=0x7fff2dfe3810, win=0x55f27c7b5aa0, buf=0x55f27cc1d780, \r\n    lnum=9, col=4, tm=0x7fff2dfe5200, timed_out=0x7fff2dfe36f8)\r\n    at /home/me/prog/neovim/src/nvim/regexp.c:15926\r\n#6  0x000055f26b31a138 in vim_regexec_multi (rmp=0x7fff2dfe3810, win=0x55f27c7b5aa0, buf=0x55f27cc1d780, \r\n    lnum=9, col=4, tm=0x7fff2dfe5200, timed_out=0x7fff2dfe36f8)\r\n    at /home/me/prog/neovim/src/nvim/regexp.c:16201\r\n#7  0x000055f26b379af4 in syn_regexec (rmp=0x7fff2dfe3810, lnum=9, col=4, st=0x55f27cddbdb0)\r\n    at /home/me/prog/neovim/src/nvim/syntax.c:2683\r\n#8  0x000055f26b3776ec in syn_current_attr (syncing=false, displaying=true, can_spell=0x0, \r\n    keep_state=false) at /home/me/prog/neovim/src/nvim/syntax.c:1665\r\n#9  0x000055f26b376f06 in get_syntax_attr (col=4, can_spell=0x0, keep_state=false)\r\n    at /home/me/prog/neovim/src/nvim/syntax.c:1465\r\n#10 0x000055f26b10168b in win_line (wp=0x55f27c7b5aa0, lnum=9, startrow=8, endrow=13, col_rows=0, \r\n    spv=0x7fff2dfe5240, \r\n    foldinfo={fi_lnum = 426209280, fi_level = 0, fi_low_level = 1801804264, fi_lines = 0})\r\n    at /home/me/prog/neovim/src/nvim/drawline.c:1970\r\n#11 0x000055f26b10a5ed in win_update (wp=0x55f27c7b5aa0)\r\n    at /home/me/prog/neovim/src/nvim/drawscreen.c:2249\r\n#12 0x000055f26b105ca6 in update_screen () at /home/me/prog/neovim/src/nvim/drawscreen.c:639\r\n#13 0x000055f26b2888fb in normal_redraw (s=0x7fff2dfe53e0) at /home/me/prog/neovim/src/nvim/normal.c:1355\r\n#14 0x000055f26b288b87 in normal_check (state=0x7fff2dfe53e0)\r\n    at /home/me/prog/neovim/src/nvim/normal.c:1457\r\n#15 0x000055f26b365add in state_enter (s=0x7fff2dfe53e0) at /home/me/prog/neovim/src/nvim/state.c:40\r\n#16 0x000055f26b286760 in normal_enter (cmdwin=false, noexmode=false)\r\n    at /home/me/prog/neovim/src/nvim/normal.c:520\r\n#17 0x000055f26b22b3da in main (argc=4, argv=0x7fff2dfe57c8) at /home/me/prog/neovim/src/nvim/main.c:661\r\n```\r\nAfter bisecting, 328ea02eb7dec32286ae6c691ecef71d988c905b / https://github.com/neovim/neovim/pull/29628 is the first bad commit.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nmaster/a0d8c2b\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nN/A\r\n\r\n### Operating system/version\r\n\r\nLinux r4 6.10.7-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.10.7-1 (2024-08-31) x86_64 GNU/Linux\r\n\r\n### Terminal name/version\r\n\r\nkitty 0.36.1 created by Kovid Goyal\r\n\r\n### $TERM environment variable\r\n\r\nxterm-kitty\r\n\r\n### Installation\r\n\r\nbuilt from source/appimage","closed_by":{"login":"bfredl","id":1363104,"node_id":"MDQ6VXNlcjEzNjMxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1363104?v=4","gravatar_id":"","url":"https://api.github.com/users/bfredl","html_url":"https://github.com/bfredl","followers_url":"https://api.github.com/users/bfredl/followers","following_url":"https://api.github.com/users/bfredl/following{/other_user}","gists_url":"https://api.github.com/users/bfredl/gists{/gist_id}","starred_url":"https://api.github.com/users/bfredl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bfredl/subscriptions","organizations_url":"https://api.github.com/users/bfredl/orgs","repos_url":"https://api.github.com/users/bfredl/repos","events_url":"https://api.github.com/users/bfredl/events{/privacy}","received_events_url":"https://api.github.com/users/bfredl/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/30400/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/30400/timeline","performed_via_github_app":null,"state_reason":"completed"}