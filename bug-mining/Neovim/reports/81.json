{"url":"https://api.github.com/repos/neovim/neovim/issues/31453","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/31453/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/31453/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/31453/events","html_url":"https://github.com/neovim/neovim/issues/31453","id":2719248324,"node_id":"I_kwDOAPphoM6iFG_E","number":31453,"title":"LSP: need a strategy for handling stateful data","user":{"login":"ofseed","id":61115159,"node_id":"MDQ6VXNlcjYxMTE1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/61115159?v=4","gravatar_id":"","url":"https://api.github.com/users/ofseed","html_url":"https://github.com/ofseed","followers_url":"https://api.github.com/users/ofseed/followers","following_url":"https://api.github.com/users/ofseed/following{/other_user}","gists_url":"https://api.github.com/users/ofseed/gists{/gist_id}","starred_url":"https://api.github.com/users/ofseed/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ofseed/subscriptions","organizations_url":"https://api.github.com/users/ofseed/orgs","repos_url":"https://api.github.com/users/ofseed/repos","events_url":"https://api.github.com/users/ofseed/events{/privacy}","received_events_url":"https://api.github.com/users/ofseed/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":662566370,"node_id":"MDU6TGFiZWw2NjI1NjYzNzA=","url":"https://api.github.com/repos/neovim/neovim/labels/lsp","name":"lsp","color":"c5def5","default":false,"description":null},{"id":834483397,"node_id":"MDU6TGFiZWw4MzQ0ODMzOTc=","url":"https://api.github.com/repos/neovim/neovim/labels/gsoc","name":"gsoc","color":"F3A62E","default":false,"description":"community: Google Summer of Code project"},{"id":4457150369,"node_id":"LA_kwDOAPphoM8AAAABCaq3oQ","url":"https://api.github.com/repos/neovim/neovim/labels/architecture","name":"architecture","color":"C5DEF5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/neovim/neovim/milestones/6","html_url":"https://github.com/neovim/neovim/milestone/6","labels_url":"https://api.github.com/repos/neovim/neovim/milestones/6/labels","id":655037,"node_id":"MDk6TWlsZXN0b25lNjU1MDM3","number":6,"title":"backlog","description":"Low priority items. We plan to work on this but don't have a target date.","creator":{"login":"justinmk","id":1359421,"node_id":"MDQ6VXNlcjEzNTk0MjE=","avatar_url":"https://avatars.githubusercontent.com/u/1359421?v=4","gravatar_id":"","url":"https://api.github.com/users/justinmk","html_url":"https://github.com/justinmk","followers_url":"https://api.github.com/users/justinmk/followers","following_url":"https://api.github.com/users/justinmk/following{/other_user}","gists_url":"https://api.github.com/users/justinmk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinmk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinmk/subscriptions","organizations_url":"https://api.github.com/users/justinmk/orgs","repos_url":"https://api.github.com/users/justinmk/repos","events_url":"https://api.github.com/users/justinmk/events{/privacy}","received_events_url":"https://api.github.com/users/justinmk/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":637,"closed_issues":749,"state":"open","created_at":"2014-05-10T20:43:04Z","updated_at":"2025-11-04T00:12:22Z","due_on":null,"closed_at":null},"comments":10,"created_at":"2024-12-05T03:54:15Z","updated_at":"2025-07-07T03:51:56Z","closed_at":"2025-07-07T03:51:31Z","author_association":"CONTRIBUTOR","type":{"id":597167,"node_id":"IT_kwDOAGK_Pc4ACRyv","name":"Enhancement","description":"A request, idea, or new functionality","color":"blue","created_at":"2024-01-25T10:10:19Z","updated_at":"2024-07-26T10:12:30Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\n\nSome LSP request responses need to be retained after processing the results, such as:\n\n- `textDocument/foldingRange` needs to retain state for closing a specific `foldingRangeKind`. For neovim, folding information must be cached.\n- `textDocument/inlayHint` and `textDocument/codeLens` require maintaining state for subsequent requests like `resolve`.\n- `textDocument/documentHighlight` could retain state to enable forward/backward navigation.\n\n### Expected behavior\n\nImplement an internal-only module dedicated to handling these stateful data, by:\n\n- Creating `bufstate` and corresponding callback functions when a buffer has a client that supports the relevant methods.\n- Destroying `bufstate` and corresponding callback functions when no clients in the buffer support the relevant methods.\n\nUse this module for the methods mentioned above to avoid relying on nil-checks (which might mask bugs) and automatically creating tables via metatable methods (which can be difficult to debug).\n\nThe `bufstate` should only contain results directly obtained from the server (e.g., `lsp.foldingRange[]`, `lsp.InlayHint[]`) and derived information (e.g.,  computed caches or whether they are applied). It should not store user-managed settings (e.g., `enabled`).","closed_by":{"login":"justinmk","id":1359421,"node_id":"MDQ6VXNlcjEzNTk0MjE=","avatar_url":"https://avatars.githubusercontent.com/u/1359421?v=4","gravatar_id":"","url":"https://api.github.com/users/justinmk","html_url":"https://github.com/justinmk","followers_url":"https://api.github.com/users/justinmk/followers","following_url":"https://api.github.com/users/justinmk/following{/other_user}","gists_url":"https://api.github.com/users/justinmk/gists{/gist_id}","starred_url":"https://api.github.com/users/justinmk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinmk/subscriptions","organizations_url":"https://api.github.com/users/justinmk/orgs","repos_url":"https://api.github.com/users/justinmk/repos","events_url":"https://api.github.com/users/justinmk/events{/privacy}","received_events_url":"https://api.github.com/users/justinmk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/31453/reactions","total_count":4,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":4},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/31453/timeline","performed_via_github_app":null,"state_reason":"completed"}