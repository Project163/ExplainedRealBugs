{"url":"https://api.github.com/repos/neovim/neovim/issues/27895","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/27895/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/27895/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/27895/events","html_url":"https://github.com/neovim/neovim/issues/27895","id":2190513304,"node_id":"I_kwDOAPphoM6CkJSY","number":27895,"title":"Tree-sitter highlighting no longer takes query range/specificity into account","user":{"login":"amaanq","id":29718261,"node_id":"MDQ6VXNlcjI5NzE4MjYx","avatar_url":"https://avatars.githubusercontent.com/u/29718261?v=4","gravatar_id":"","url":"https://api.github.com/users/amaanq","html_url":"https://github.com/amaanq","followers_url":"https://api.github.com/users/amaanq/followers","following_url":"https://api.github.com/users/amaanq/following{/other_user}","gists_url":"https://api.github.com/users/amaanq/gists{/gist_id}","starred_url":"https://api.github.com/users/amaanq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaanq/subscriptions","organizations_url":"https://api.github.com/users/amaanq/orgs","repos_url":"https://api.github.com/users/amaanq/repos","events_url":"https://api.github.com/users/amaanq/events{/privacy}","received_events_url":"https://api.github.com/users/amaanq/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":619474658,"node_id":"MDU6TGFiZWw2MTk0NzQ2NTg=","url":"https://api.github.com/repos/neovim/neovim/labels/bug-regression","name":"bug-regression","color":"f9d0c4","default":false,"description":"wrong behavior that was introduced in a previous commit (please bisect)"},{"id":1481421490,"node_id":"MDU6TGFiZWwxNDgxNDIxNDkw","url":"https://api.github.com/repos/neovim/neovim/labels/has:bisected","name":"has:bisected","color":"0E8A16","default":false,"description":"issue has been tracked to a specific commit"},{"id":1799626557,"node_id":"MDU6TGFiZWwxNzk5NjI2NTU3","url":"https://api.github.com/repos/neovim/neovim/labels/treesitter","name":"treesitter","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"gpanders","id":8965202,"node_id":"MDQ6VXNlcjg5NjUyMDI=","avatar_url":"https://avatars.githubusercontent.com/u/8965202?v=4","gravatar_id":"","url":"https://api.github.com/users/gpanders","html_url":"https://github.com/gpanders","followers_url":"https://api.github.com/users/gpanders/followers","following_url":"https://api.github.com/users/gpanders/following{/other_user}","gists_url":"https://api.github.com/users/gpanders/gists{/gist_id}","starred_url":"https://api.github.com/users/gpanders/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpanders/subscriptions","organizations_url":"https://api.github.com/users/gpanders/orgs","repos_url":"https://api.github.com/users/gpanders/repos","events_url":"https://api.github.com/users/gpanders/events{/privacy}","received_events_url":"https://api.github.com/users/gpanders/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"lewis6991","id":7904185,"node_id":"MDQ6VXNlcjc5MDQxODU=","avatar_url":"https://avatars.githubusercontent.com/u/7904185?v=4","gravatar_id":"","url":"https://api.github.com/users/lewis6991","html_url":"https://github.com/lewis6991","followers_url":"https://api.github.com/users/lewis6991/followers","following_url":"https://api.github.com/users/lewis6991/following{/other_user}","gists_url":"https://api.github.com/users/lewis6991/gists{/gist_id}","starred_url":"https://api.github.com/users/lewis6991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lewis6991/subscriptions","organizations_url":"https://api.github.com/users/lewis6991/orgs","repos_url":"https://api.github.com/users/lewis6991/repos","events_url":"https://api.github.com/users/lewis6991/events{/privacy}","received_events_url":"https://api.github.com/users/lewis6991/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"gpanders","id":8965202,"node_id":"MDQ6VXNlcjg5NjUyMDI=","avatar_url":"https://avatars.githubusercontent.com/u/8965202?v=4","gravatar_id":"","url":"https://api.github.com/users/gpanders","html_url":"https://github.com/gpanders","followers_url":"https://api.github.com/users/gpanders/followers","following_url":"https://api.github.com/users/gpanders/following{/other_user}","gists_url":"https://api.github.com/users/gpanders/gists{/gist_id}","starred_url":"https://api.github.com/users/gpanders/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpanders/subscriptions","organizations_url":"https://api.github.com/users/gpanders/orgs","repos_url":"https://api.github.com/users/gpanders/repos","events_url":"https://api.github.com/users/gpanders/events{/privacy}","received_events_url":"https://api.github.com/users/gpanders/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/neovim/neovim/milestones/36","html_url":"https://github.com/neovim/neovim/milestone/36","labels_url":"https://api.github.com/repos/neovim/neovim/milestones/36/labels","id":8997654,"node_id":"MI_kwDOAPphoM4AiUsW","number":36,"title":"0.10","description":"","creator":{"login":"bfredl","id":1363104,"node_id":"MDQ6VXNlcjEzNjMxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1363104?v=4","gravatar_id":"","url":"https://api.github.com/users/bfredl","html_url":"https://github.com/bfredl","followers_url":"https://api.github.com/users/bfredl/followers","following_url":"https://api.github.com/users/bfredl/following{/other_user}","gists_url":"https://api.github.com/users/bfredl/gists{/gist_id}","starred_url":"https://api.github.com/users/bfredl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bfredl/subscriptions","organizations_url":"https://api.github.com/users/bfredl/orgs","repos_url":"https://api.github.com/users/bfredl/repos","events_url":"https://api.github.com/users/bfredl/events{/privacy}","received_events_url":"https://api.github.com/users/bfredl/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":440,"state":"closed","created_at":"2023-02-02T14:11:43Z","updated_at":"2025-01-05T13:24:13Z","due_on":"2024-05-12T07:00:00Z","closed_at":"2024-05-16T14:11:42Z"},"comments":8,"created_at":"2024-03-17T07:01:18Z","updated_at":"2024-03-17T20:37:17Z","closed_at":"2024-03-17T20:37:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\n\nBefore https://github.com/neovim/neovim/pull/27132, queries where a more specific capture appeared earlier than a less specific capture later on used to have a higher precedence, but now that is no longer the case, which is a pretty breaking change really, since I've taken into account specificity of a capture plenty of times when writing queries (especially highlights) for nvim-treesitter. Highlights in certain circumstances will appear off now as a result. I understand this wasn't really documented/obvious, but it was a convenient feature to use.\n\n### Steps to reproduce\n\nconfig:\r\n\r\n```lua\r\nvim.api.nvim_create_autocmd(\"FileType\", {\r\n\tpattern = { \"c\" },\r\n\tcallback = function(args)\r\n\t\tvim.treesitter.start()\r\n\tend,\r\n})\r\n\r\nvim.cmd(\"highlight! @variable.parameter gui=bold guifg=#ff0000 guibg=NONE\")\r\nvim.cmd(\"highlight! @operator gui=bold guifg=#00ff00 guibg=NONE\")\r\n```\r\n\r\n```sh\r\nnvim --clean -u minimal.lua test.c\r\n```\r\n\r\nwrite `void foo(int *bar)`\r\n\r\nNotice that `*` is highlighted the same as `a` because the `@variable.parameter` capture captures the whole `pointer_declarator` node, but the earlier `@operator` capture for `*` ideally would have a higher priority than this\n\n### Expected behavior\n\nI'd expect `*` to be highlighted with `@operator`, not `@variable.parameter`, a possible solution could be to account for the size of the node when applying captures.\r\n\r\nIt'd also be fine to just not consider specificity anymore, that's totally fine but some queries need to be reworked then (e.g. some of C's highlights) and this should be documented to avoid further confusion\n\n### Neovim version (nvim -v)\n\nv0.10.0-dev-2619+gc52dfb6e8\n\n### Vim (not Nvim) behaves the same?\n\nno (no treesitter)\n\n### Operating system/version\n\nArch Linux 6.7.9-zen1-1\n\n### Terminal name/version\n\nkitty 0.32.2\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nbuilt from source","closed_by":{"login":"lewis6991","id":7904185,"node_id":"MDQ6VXNlcjc5MDQxODU=","avatar_url":"https://avatars.githubusercontent.com/u/7904185?v=4","gravatar_id":"","url":"https://api.github.com/users/lewis6991","html_url":"https://github.com/lewis6991","followers_url":"https://api.github.com/users/lewis6991/followers","following_url":"https://api.github.com/users/lewis6991/following{/other_user}","gists_url":"https://api.github.com/users/lewis6991/gists{/gist_id}","starred_url":"https://api.github.com/users/lewis6991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lewis6991/subscriptions","organizations_url":"https://api.github.com/users/lewis6991/orgs","repos_url":"https://api.github.com/users/lewis6991/repos","events_url":"https://api.github.com/users/lewis6991/events{/privacy}","received_events_url":"https://api.github.com/users/lewis6991/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/27895/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/27895/timeline","performed_via_github_app":null,"state_reason":"completed"}