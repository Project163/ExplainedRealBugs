{"url":"https://api.github.com/repos/neovim/neovim/issues/27669","repository_url":"https://api.github.com/repos/neovim/neovim","labels_url":"https://api.github.com/repos/neovim/neovim/issues/27669/labels{/name}","comments_url":"https://api.github.com/repos/neovim/neovim/issues/27669/comments","events_url":"https://api.github.com/repos/neovim/neovim/issues/27669/events","html_url":"https://github.com/neovim/neovim/issues/27669","id":2160685268,"node_id":"I_kwDOAPphoM6AyXDU","number":27669,"title":"853f647 breaks textDocument.completion.completionItemKind.valueSet (at least for gopls)","user":{"login":"wilriker","id":886200,"node_id":"MDQ6VXNlcjg4NjIwMA==","avatar_url":"https://avatars.githubusercontent.com/u/886200?v=4","gravatar_id":"","url":"https://api.github.com/users/wilriker","html_url":"https://github.com/wilriker","followers_url":"https://api.github.com/users/wilriker/followers","following_url":"https://api.github.com/users/wilriker/following{/other_user}","gists_url":"https://api.github.com/users/wilriker/gists{/gist_id}","starred_url":"https://api.github.com/users/wilriker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wilriker/subscriptions","organizations_url":"https://api.github.com/users/wilriker/orgs","repos_url":"https://api.github.com/users/wilriker/repos","events_url":"https://api.github.com/users/wilriker/events{/privacy}","received_events_url":"https://api.github.com/users/wilriker/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":619474658,"node_id":"MDU6TGFiZWw2MTk0NzQ2NTg=","url":"https://api.github.com/repos/neovim/neovim/labels/bug-regression","name":"bug-regression","color":"f9d0c4","default":false,"description":"wrong behavior that was introduced in a previous commit (please bisect)"},{"id":662566370,"node_id":"MDU6TGFiZWw2NjI1NjYzNzA=","url":"https://api.github.com/repos/neovim/neovim/labels/lsp","name":"lsp","color":"c5def5","default":false,"description":null},{"id":1481421490,"node_id":"MDU6TGFiZWwxNDgxNDIxNDkw","url":"https://api.github.com/repos/neovim/neovim/labels/has:bisected","name":"has:bisected","color":"0E8A16","default":false,"description":"issue has been tracked to a specific commit"}],"state":"closed","locked":false,"assignee":{"login":"MariaSolOs","id":62502207,"node_id":"MDQ6VXNlcjYyNTAyMjA3","avatar_url":"https://avatars.githubusercontent.com/u/62502207?v=4","gravatar_id":"","url":"https://api.github.com/users/MariaSolOs","html_url":"https://github.com/MariaSolOs","followers_url":"https://api.github.com/users/MariaSolOs/followers","following_url":"https://api.github.com/users/MariaSolOs/following{/other_user}","gists_url":"https://api.github.com/users/MariaSolOs/gists{/gist_id}","starred_url":"https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MariaSolOs/subscriptions","organizations_url":"https://api.github.com/users/MariaSolOs/orgs","repos_url":"https://api.github.com/users/MariaSolOs/repos","events_url":"https://api.github.com/users/MariaSolOs/events{/privacy}","received_events_url":"https://api.github.com/users/MariaSolOs/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"MariaSolOs","id":62502207,"node_id":"MDQ6VXNlcjYyNTAyMjA3","avatar_url":"https://avatars.githubusercontent.com/u/62502207?v=4","gravatar_id":"","url":"https://api.github.com/users/MariaSolOs","html_url":"https://github.com/MariaSolOs","followers_url":"https://api.github.com/users/MariaSolOs/followers","following_url":"https://api.github.com/users/MariaSolOs/following{/other_user}","gists_url":"https://api.github.com/users/MariaSolOs/gists{/gist_id}","starred_url":"https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MariaSolOs/subscriptions","organizations_url":"https://api.github.com/users/MariaSolOs/orgs","repos_url":"https://api.github.com/users/MariaSolOs/repos","events_url":"https://api.github.com/users/MariaSolOs/events{/privacy}","received_events_url":"https://api.github.com/users/MariaSolOs/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2024-02-29T08:24:15Z","updated_at":"2024-02-29T10:37:32Z","closed_at":"2024-02-29T10:37:32Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Problem\r\n\r\nCommit 853f647 refactors how the values for `textDocument.completion.completionItemKind.valueSet` are calculated. Before this commit the value was\r\n```\r\nvalueSet = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25 }\r\n```\r\ni.e. a simple array. With this commit it changed into a complex type:\r\n```\r\nvalueSet = { { 1, \"Text\",\r\n  <metatable> = <1>{}\r\n}, { 2, \"Method\",\r\n  <metatable> = <table 1>\r\n}, { 3, \"Function\",\r\n  <metatable> = <table 1>\r\n}, { 4, \"Constructor\",\r\n  <metatable> = <table 1>\r\n}, { 5, \"Field\",\r\n  <metatable> = <table 1>\r\n}, { 6, \"Variable\",\r\n  <metatable> = <table 1>\r\n}, { 7, \"Class\",\r\n  <metatable> = <table 1>\r\n}, { 8, \"Interface\",\r\n  <metatable> = <table 1>\r\n}, { 9, \"Module\",\r\n  <metatable> = <table 1>\r\n}, { 10, \"Property\",\r\n  <metatable> = <table 1>\r\n}, { 11, \"Unit\",\r\n  <metatable> = <table 1>\r\n}, { 12, \"Value\",\r\n  <metatable> = <table 1>\r\n}, { 13, \"Enum\",\r\n  <metatable> = <table 1>\r\n}, { 14, \"Keyword\",\r\n  <metatable> = <table 1>\r\n}, { 15, \"Snippet\",\r\n  <metatable> = <table 1>\r\n}, { 16, \"Color\",\r\n  <metatable> = <table 1>\r\n}, { 17, \"File\",\r\n  <metatable> = <table 1>\r\n}, { 18, \"Reference\",\r\n  <metatable> = <table 1>\r\n}, { 19, \"Folder\",\r\n  <metatable> = <table 1>\r\n}, { 20, \"EnumMember\",\r\n  <metatable> = <table 1>\r\n}, { 21, \"Constant\",\r\n  <metatable> = <table 1>\r\n}, { 22, \"Struct\",\r\n  <metatable> = <table 1>\r\n}, { 23, \"Event\",\r\n  <metatable> = <table 1>\r\n}, { 24, \"Operator\",\r\n  <metatable> = <table 1>\r\n}, { 25, \"TypeParameter\",\r\n  <metatable> = <table 1>\r\n} }\r\n```\r\nand when sending this to `gopls` it will respond with\r\n```\r\nRPC[Error] code_name = ParseError, message = \"JSON RPC parse error: json: cannot unmarshal array into Go struct field\r\n ClientSymbolKindOptions.capabilities.workspace.symbol.symbolKind.valueSet of type protocol.SymbolKind\r\n```\r\n\r\nP.S.: This most likely also affects the other `valueSet` elements that use the new `get_value_set()` function but `gopls` will stop on the first error from the top.\r\n\r\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\r\n\r\n```lua\r\nlocal pattern = \"go\"\r\nlocal cmd = { \"gopls\" }\r\n-- Add files/folders here that indicate the root of a project\r\nlocal root_markers = { \".git\", \".editorconfig\" }\r\n-- Change to table with settings if required\r\nlocal settings = vim.empty_dict()\r\n\r\nvim.api.nvim_create_autocmd(\"FileType\", {\r\n\tpattern = pattern,\r\n\tcallback = function(args)\r\n\t\tlocal match = vim.fs.find(root_markers, { path = args.file, upward = true })[1]\r\n\t\tlocal root_dir = match and vim.fn.fnamemodify(match, \":p:h\") or nil\r\n\t\tvim.lsp.start({\r\n\t\t\tname = \"gopls\",\r\n\t\t\tcmd = cmd,\r\n\t\t\troot_dir = root_dir,\r\n\t\t\tsettings = settings,\r\n\t\t})\r\n\tend,\r\n})\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe language server should not complain about values sent to it and start regularly.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nv0.10.0-dev-2480+g0eaae1bc0\r\n\r\n### Language server name/version\r\n\r\ngopls 0.15.1\r\n\r\n### Operating system/version\r\n\r\nArch Linux\r\n\r\n### Log file\r\n\r\n_No response_","closed_by":{"login":"clason","id":2361214,"node_id":"MDQ6VXNlcjIzNjEyMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/2361214?v=4","gravatar_id":"","url":"https://api.github.com/users/clason","html_url":"https://github.com/clason","followers_url":"https://api.github.com/users/clason/followers","following_url":"https://api.github.com/users/clason/following{/other_user}","gists_url":"https://api.github.com/users/clason/gists{/gist_id}","starred_url":"https://api.github.com/users/clason/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clason/subscriptions","organizations_url":"https://api.github.com/users/clason/orgs","repos_url":"https://api.github.com/users/clason/repos","events_url":"https://api.github.com/users/clason/events{/privacy}","received_events_url":"https://api.github.com/users/clason/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/neovim/neovim/issues/27669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/neovim/neovim/issues/27669/timeline","performed_via_github_app":null,"state_reason":"completed"}