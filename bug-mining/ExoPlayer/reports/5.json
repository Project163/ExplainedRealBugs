{"url":"https://api.github.com/repos/google/ExoPlayer/issues/5125","repository_url":"https://api.github.com/repos/google/ExoPlayer","labels_url":"https://api.github.com/repos/google/ExoPlayer/issues/5125/labels{/name}","comments_url":"https://api.github.com/repos/google/ExoPlayer/issues/5125/comments","events_url":"https://api.github.com/repos/google/ExoPlayer/issues/5125/events","html_url":"https://github.com/google/ExoPlayer/issues/5125","id":382587961,"node_id":"MDU6SXNzdWUzODI1ODc5NjE=","number":5125,"title":"[PR offer] Always call onCompletion in ConcatenatingMediaSource.moveMediaSource","user":{"login":"BrainCrumbz","id":3185573,"node_id":"MDQ6VXNlcjMxODU1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3185573?v=4","gravatar_id":"","url":"https://api.github.com/users/BrainCrumbz","html_url":"https://github.com/BrainCrumbz","followers_url":"https://api.github.com/users/BrainCrumbz/followers","following_url":"https://api.github.com/users/BrainCrumbz/following{/other_user}","gists_url":"https://api.github.com/users/BrainCrumbz/gists{/gist_id}","starred_url":"https://api.github.com/users/BrainCrumbz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BrainCrumbz/subscriptions","organizations_url":"https://api.github.com/users/BrainCrumbz/orgs","repos_url":"https://api.github.com/users/BrainCrumbz/repos","events_url":"https://api.github.com/users/BrainCrumbz/events{/privacy}","received_events_url":"https://api.github.com/users/BrainCrumbz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106814989,"node_id":"MDU6TGFiZWwxMDY4MTQ5ODk=","url":"https://api.github.com/repos/google/ExoPlayer/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":true,"assignee":{"login":"tonihei","id":26897506,"node_id":"MDQ6VXNlcjI2ODk3NTA2","avatar_url":"https://avatars.githubusercontent.com/u/26897506?v=4","gravatar_id":"","url":"https://api.github.com/users/tonihei","html_url":"https://github.com/tonihei","followers_url":"https://api.github.com/users/tonihei/followers","following_url":"https://api.github.com/users/tonihei/following{/other_user}","gists_url":"https://api.github.com/users/tonihei/gists{/gist_id}","starred_url":"https://api.github.com/users/tonihei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonihei/subscriptions","organizations_url":"https://api.github.com/users/tonihei/orgs","repos_url":"https://api.github.com/users/tonihei/repos","events_url":"https://api.github.com/users/tonihei/events{/privacy}","received_events_url":"https://api.github.com/users/tonihei/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"tonihei","id":26897506,"node_id":"MDQ6VXNlcjI2ODk3NTA2","avatar_url":"https://avatars.githubusercontent.com/u/26897506?v=4","gravatar_id":"","url":"https://api.github.com/users/tonihei","html_url":"https://github.com/tonihei","followers_url":"https://api.github.com/users/tonihei/followers","following_url":"https://api.github.com/users/tonihei/following{/other_user}","gists_url":"https://api.github.com/users/tonihei/gists{/gist_id}","starred_url":"https://api.github.com/users/tonihei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonihei/subscriptions","organizations_url":"https://api.github.com/users/tonihei/orgs","repos_url":"https://api.github.com/users/tonihei/repos","events_url":"https://api.github.com/users/tonihei/events{/privacy}","received_events_url":"https://api.github.com/users/tonihei/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-11-20T10:08:27Z","updated_at":"2019-05-16T13:02:37Z","closed_at":"2018-11-23T12:50:17Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nBefore filing an issue:\r\n-----------------------\r\n- Search existing issues, including issues that are closed.\r\n- Consult our FAQs, supported devices and supported formats pages. These can be\r\n  found at https://google.github.io/ExoPlayer/.\r\n- Rule out issues in your own code. A good way to do this is to try and\r\n  reproduce the issue in the ExoPlayer demo app.\r\n- This issue tracker is intended for bugs, feature requests and ExoPlayer\r\n  specific questions. If you're asking a general Android development question,\r\n  please do so on Stack Overflow.\r\n\r\nWhen reporting a bug:\r\n-----------------------\r\nFill out the sections below, leaving the headers but replacing the content. If\r\nyou're unable to provide certain information, please explain why in the relevant\r\nsection. We may close issues if they do not include sufficient information.\r\n-->\r\n\r\n### Issue description\r\nIn `moveMediaSource` method in `ConcatenatingMediaSource` class, [at this line](https://github.com/google/ExoPlayer/blob/r2.9.0/library/core/src/main/java/com/google/android/exoplayer2/source/ConcatenatingMediaSource.java#L365), when there's actually no source to move (current and new index are the same), the `onCompletion` action is **not** invoked:\r\n\r\n```java\r\nif (currentIndex == newIndex) {\r\n    return;\r\n}\r\n```\r\n\r\nThat is somehow a different behavior than e.g. `removeMediaSourceRange`, where completion callback is invoked right away when there's nothing to remove.\r\n\r\nAlso, that forces callers to always check for this special scenario, basically requiring a wrapper around this specific operation.\r\n\r\nWould you consider a PR changing `moveMediaSource` behavior, so that it always calls completion callback?\r\n\r\nWe understand this can be considered a breaking change in API, as client code in its own logic may rely on this *missing invocation*. Maybe you could make the new behavior as an opt-in, like an additional method signature on `ConcatenatingMediaSource`, e.g. `moveMediaSource(int currentIndex, int newIndex, @Nullable Runnable actionOnCompletion, bool alwaysComplete)`.\r\n\r\nThanks for your attention\r\n\r\n### Reproduction steps\r\nNot Applicable\r\n\r\n### Link to test content\r\nNot Applicable\r\n\r\n### Version of ExoPlayer being used\r\n2.9.0\r\n\r\n### Device(s) and version(s) of Android being used\r\nNot Applicable\r\n\r\n### A full bug report captured from the device\r\nNot Applicable\r\n","closed_by":{"login":"ojw28","id":7881572,"node_id":"MDQ6VXNlcjc4ODE1NzI=","avatar_url":"https://avatars.githubusercontent.com/u/7881572?v=4","gravatar_id":"","url":"https://api.github.com/users/ojw28","html_url":"https://github.com/ojw28","followers_url":"https://api.github.com/users/ojw28/followers","following_url":"https://api.github.com/users/ojw28/following{/other_user}","gists_url":"https://api.github.com/users/ojw28/gists{/gist_id}","starred_url":"https://api.github.com/users/ojw28/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ojw28/subscriptions","organizations_url":"https://api.github.com/users/ojw28/orgs","repos_url":"https://api.github.com/users/ojw28/repos","events_url":"https://api.github.com/users/ojw28/events{/privacy}","received_events_url":"https://api.github.com/users/ojw28/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google/ExoPlayer/issues/5125/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google/ExoPlayer/issues/5125/timeline","performed_via_github_app":null,"state_reason":"completed"}