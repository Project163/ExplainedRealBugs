{"url":"https://api.github.com/repos/google/ExoPlayer/issues/7181","repository_url":"https://api.github.com/repos/google/ExoPlayer","labels_url":"https://api.github.com/repos/google/ExoPlayer/issues/7181/labels{/name}","comments_url":"https://api.github.com/repos/google/ExoPlayer/issues/7181/comments","events_url":"https://api.github.com/repos/google/ExoPlayer/issues/7181/events","html_url":"https://github.com/google/ExoPlayer/issues/7181","id":593605913,"node_id":"MDU6SXNzdWU1OTM2MDU5MTM=","number":7181,"title":"CEA-608 caption stuck on screen for several minutes","user":{"login":"sneelavara","id":59985419,"node_id":"MDQ6VXNlcjU5OTg1NDE5","avatar_url":"https://avatars.githubusercontent.com/u/59985419?v=4","gravatar_id":"","url":"https://api.github.com/users/sneelavara","html_url":"https://github.com/sneelavara","followers_url":"https://api.github.com/users/sneelavara/followers","following_url":"https://api.github.com/users/sneelavara/following{/other_user}","gists_url":"https://api.github.com/users/sneelavara/gists{/gist_id}","starred_url":"https://api.github.com/users/sneelavara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sneelavara/subscriptions","organizations_url":"https://api.github.com/users/sneelavara/orgs","repos_url":"https://api.github.com/users/sneelavara/repos","events_url":"https://api.github.com/users/sneelavara/events{/privacy}","received_events_url":"https://api.github.com/users/sneelavara/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106814991,"node_id":"MDU6TGFiZWwxMDY4MTQ5OTE=","url":"https://api.github.com/repos/google/ExoPlayer/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":true,"assignee":{"login":"icbaker","id":1279752,"node_id":"MDQ6VXNlcjEyNzk3NTI=","avatar_url":"https://avatars.githubusercontent.com/u/1279752?v=4","gravatar_id":"","url":"https://api.github.com/users/icbaker","html_url":"https://github.com/icbaker","followers_url":"https://api.github.com/users/icbaker/followers","following_url":"https://api.github.com/users/icbaker/following{/other_user}","gists_url":"https://api.github.com/users/icbaker/gists{/gist_id}","starred_url":"https://api.github.com/users/icbaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icbaker/subscriptions","organizations_url":"https://api.github.com/users/icbaker/orgs","repos_url":"https://api.github.com/users/icbaker/repos","events_url":"https://api.github.com/users/icbaker/events{/privacy}","received_events_url":"https://api.github.com/users/icbaker/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"icbaker","id":1279752,"node_id":"MDQ6VXNlcjEyNzk3NTI=","avatar_url":"https://avatars.githubusercontent.com/u/1279752?v=4","gravatar_id":"","url":"https://api.github.com/users/icbaker","html_url":"https://github.com/icbaker","followers_url":"https://api.github.com/users/icbaker/followers","following_url":"https://api.github.com/users/icbaker/following{/other_user}","gists_url":"https://api.github.com/users/icbaker/gists{/gist_id}","starred_url":"https://api.github.com/users/icbaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icbaker/subscriptions","organizations_url":"https://api.github.com/users/icbaker/orgs","repos_url":"https://api.github.com/users/icbaker/repos","events_url":"https://api.github.com/users/icbaker/events{/privacy}","received_events_url":"https://api.github.com/users/icbaker/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2020-04-03T19:53:46Z","updated_at":"2020-06-27T01:04:16Z","closed_at":"2020-04-27T11:02:30Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Issue description\r\n\r\n#### Summary \r\nCEA-608 caption stuck on screen for several minutes (mostly  during commercial breaks)\r\n\r\n#### Root Cause\r\nOn certain Live TV channels the Caption from Live TV program stays on screen throughout the commercial. The commercials in such case don’t have the caption. But the the outdated caption from the program stays on screen.\r\n \r\nThe root cause is that the caption provider is not inserting the control words such as End_Of_Caption(EOC 14 2F), Erase_Displayed_Memory(EDM 14 2C), Eras_NonDisplay_Memory(ENM 14 2E) on CEA-608 caption services. Since the commercials don’t have caption, the previously displayed captions are not erased. \r\n \r\nCEA-608 spec Annex C.9 recommends Automatic Caption Erasure (Preferred).  FCC rules describe events, other than reception of commands intended to erase, which trigger the erasure of caption display and memory. These include the viewer switching receiver channel, data channel, or the selected field; loss of valid data; or the viewer selecting a non-captioning receiver function. \r\nCEA-608 Annex C.9 prefers If no data are received for the selected caption channel within a given time, the decoder should automatically erase the caption. Such erasure may supersede the intentions of the caption service providers and institute one maximum display time for all captioning services. If such a timeout is deemed necessary, however, the time limit should be no less than 16 seconds.\r\n\r\n### Proposed Solution\r\nPull request is in progress.  We propose adding a check in [Decoder.dequeueOutputBuffer()](https://github.com/google/ExoPlayer/blob/49910fe72579c4e55e14b47b0cf3d3ced9474219/library/core/src/main/java/com/google/android/exoplayer2/text/cea/CeaDecoder.java#L91) that will track the time since the last erasure control word was processed and if it exceeds the 16 second time out, generate an erasure sequence (Cue?)\r\n\r\n### Reproduction steps\r\nUsing the sample HLS stream, play to the first commercial break 30 seconds into the stream. Observe the caption \"A Nationwide ...\" stays on the screen during the entire ad series\r\n\r\n### Link to test content\r\n\r\nContent is broadcast from cable, so link was sent to exoplayer dev email\r\n\r\n### A full bug report captured from the device\r\nN/A\r\n\r\n### Version of ExoPlayer being used\r\n2.11.4 \r\n\r\n### Device(s) and version(s) of Android being used\r\nTested and reproduced on Arris and Amino AndroidTV devices running Android Pie.  Reproduction is 100%.","closed_by":{"login":"icbaker","id":1279752,"node_id":"MDQ6VXNlcjEyNzk3NTI=","avatar_url":"https://avatars.githubusercontent.com/u/1279752?v=4","gravatar_id":"","url":"https://api.github.com/users/icbaker","html_url":"https://github.com/icbaker","followers_url":"https://api.github.com/users/icbaker/followers","following_url":"https://api.github.com/users/icbaker/following{/other_user}","gists_url":"https://api.github.com/users/icbaker/gists{/gist_id}","starred_url":"https://api.github.com/users/icbaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icbaker/subscriptions","organizations_url":"https://api.github.com/users/icbaker/orgs","repos_url":"https://api.github.com/users/icbaker/repos","events_url":"https://api.github.com/users/icbaker/events{/privacy}","received_events_url":"https://api.github.com/users/icbaker/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google/ExoPlayer/issues/7181/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google/ExoPlayer/issues/7181/timeline","performed_via_github_app":null,"state_reason":"completed"}