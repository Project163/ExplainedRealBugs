{"url":"https://api.github.com/repos/google/ExoPlayer/issues/11050","repository_url":"https://api.github.com/repos/google/ExoPlayer","labels_url":"https://api.github.com/repos/google/ExoPlayer/issues/11050/labels{/name}","comments_url":"https://api.github.com/repos/google/ExoPlayer/issues/11050/comments","events_url":"https://api.github.com/repos/google/ExoPlayer/issues/11050/events","html_url":"https://github.com/google/ExoPlayer/issues/11050","id":1618126556,"node_id":"I_kwDOAT2ozs5gcqbc","number":11050,"title":"Seek to default live does not restore idealTargetLiveOffset","user":{"login":"stevemayhew","id":398072,"node_id":"MDQ6VXNlcjM5ODA3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/398072?v=4","gravatar_id":"","url":"https://api.github.com/users/stevemayhew","html_url":"https://github.com/stevemayhew","followers_url":"https://api.github.com/users/stevemayhew/followers","following_url":"https://api.github.com/users/stevemayhew/following{/other_user}","gists_url":"https://api.github.com/users/stevemayhew/gists{/gist_id}","starred_url":"https://api.github.com/users/stevemayhew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevemayhew/subscriptions","organizations_url":"https://api.github.com/users/stevemayhew/orgs","repos_url":"https://api.github.com/users/stevemayhew/repos","events_url":"https://api.github.com/users/stevemayhew/events{/privacy}","received_events_url":"https://api.github.com/users/stevemayhew/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106814989,"node_id":"MDU6TGFiZWwxMDY4MTQ5ODk=","url":"https://api.github.com/repos/google/ExoPlayer/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":true,"assignee":{"login":"marcbaechinger","id":584321,"node_id":"MDQ6VXNlcjU4NDMyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/584321?v=4","gravatar_id":"","url":"https://api.github.com/users/marcbaechinger","html_url":"https://github.com/marcbaechinger","followers_url":"https://api.github.com/users/marcbaechinger/followers","following_url":"https://api.github.com/users/marcbaechinger/following{/other_user}","gists_url":"https://api.github.com/users/marcbaechinger/gists{/gist_id}","starred_url":"https://api.github.com/users/marcbaechinger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcbaechinger/subscriptions","organizations_url":"https://api.github.com/users/marcbaechinger/orgs","repos_url":"https://api.github.com/users/marcbaechinger/repos","events_url":"https://api.github.com/users/marcbaechinger/events{/privacy}","received_events_url":"https://api.github.com/users/marcbaechinger/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"marcbaechinger","id":584321,"node_id":"MDQ6VXNlcjU4NDMyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/584321?v=4","gravatar_id":"","url":"https://api.github.com/users/marcbaechinger","html_url":"https://github.com/marcbaechinger","followers_url":"https://api.github.com/users/marcbaechinger/followers","following_url":"https://api.github.com/users/marcbaechinger/following{/other_user}","gists_url":"https://api.github.com/users/marcbaechinger/gists{/gist_id}","starred_url":"https://api.github.com/users/marcbaechinger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcbaechinger/subscriptions","organizations_url":"https://api.github.com/users/marcbaechinger/orgs","repos_url":"https://api.github.com/users/marcbaechinger/repos","events_url":"https://api.github.com/users/marcbaechinger/events{/privacy}","received_events_url":"https://api.github.com/users/marcbaechinger/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2023-03-09T23:14:23Z","updated_at":"2023-10-07T01:04:54Z","closed_at":"2023-08-07T17:04:42Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### ExoPlayer Version\n\n2.18.4\n\n### Devices that reproduce the issue\n\n* SEI500 SEI Robotics (AmLogic SoC STB) running Android 29\r\n* Probably everything else with AAC audio\n\n### Devices that do not reproduce the issue\n\nNone I'm aware of.\n\n### Reproducible in the demo app?\n\nYes\n\n### Reproduction steps\n\n1. Play live stream with non-default `LiveConfiguration`\r\n2. Seek back (jump back 5 button) a few times, notice `setTargetLiveOffsetOverrideUs()` is called to move the target (not sure why this is a feature, IMO live adjustment should shut off here until seek back to live edge)\r\n3. call `seekTo(C.TIME_UNSET)` (from the UI play next button with no next item will do this.\n\n### Expected result\n\nLive adjustment resumes (continues) using the original target set on playback startup (`mediaConfigurationTargetLiveOffsetUs`)\n\n### Actual result\n\nPlayback seeks to the live edge, but Live adjustment desperately tries to move **back** to the last non default seek.\r\n\r\nLogging shows clearly what is happening:\r\n\r\nStep 1 - normal startup and live adjustment\r\n\r\n````\r\n03-09 14:47:30.744 20204 20204 I ExoPlayerImpl: Init c9a8d43 [ExoPlayerLib/2.18.3] [SEI500RCN, Pyxis-RCN, SEI Robotics, 29]\r\n03-09 14:47:31.665 20204 21891 D DefaultLivePlaybackSpeedControl: setLiveConfiguration(LiveConfiguration - min/max speed: 0.9/1.1 targetOffset: 33284) - updated\r\n03-09 14:47:33.414 20204 21891 D DefaultLivePlaybackSpeedControl: adjusting offset, speed: 1.1 liveOffsetUs: 38107723 currentTargetLiveOffsetUs: 33284000 idealTargetLiveOffsetUs: 33284000 smoothedMinPossibleLiveOffsetUs: 32112240\r\n````\r\n\r\nStep 2 - three back button presses jump back 15 seconds total, override is called (`setTargetLiveOffsetOverrideUs()`)\r\n\r\n````\r\n03-09 14:48:02.377 20204 21891 D ExoPlayerImplInternal: seekToInternal() - timeline empty: false  seekPosition.windowPositionUs: 3575642000\r\n03-09 14:48:02.378 20204 21891 D ExoPlayerImplInternal: resolvedSeekPosition periodUid: Pair{java.lang.Object@9be3c3e java.lang.Object@c575286} resolvedContentPositionUs: 3599666000\r\n03-09 14:48:02.379 20204 21891 D ExoPlayerImplInternal: before seekToPeriodPosition() - newPeriodPositionUs: 3599666000 seekTargetWindow.defaultPositionUs: 3573570000 playbackInfo.positionUs 3604666116 requestedContentPositionUs: 3599666000\r\n03-09 14:48:02.430 20204 21891 D DefaultLivePlaybackSpeedControl: setTargetLiveOffsetOverrideUs(41042000)\r\n03-09 14:48:03.035 20204 21891 D ExoPlayerImplInternal: seekToInternal() - timeline empty: false  seekPosition.windowPositionUs: 3564636000\r\n03-09 14:48:03.035 20204 21891 D ExoPlayerImplInternal: resolvedSeekPosition periodUid: Pair{java.lang.Object@9be3c3e java.lang.Object@c575286} resolvedContentPositionUs: 3594666000\r\n03-09 14:48:03.036 20204 21891 D ExoPlayerImplInternal: before seekToPeriodPosition() - newPeriodPositionUs: 3594666000 seekTargetWindow.defaultPositionUs: 3573570000 playbackInfo.positionUs 3599666000 requestedContentPositionUs: 3594666000\r\n03-09 14:48:03.085 20204 21891 D DefaultLivePlaybackSpeedControl: setTargetLiveOffsetOverrideUs(46697000)\r\n03-09 14:48:03.832 20204 21891 D ExoPlayerImplInternal: seekToInternal() - timeline empty: false  seekPosition.windowPositionUs: 3559636000\r\n03-09 14:48:03.832 20204 21891 D ExoPlayerImplInternal: resolvedSeekPosition periodUid: Pair{java.lang.Object@9be3c3e java.lang.Object@c575286} resolvedContentPositionUs: 3589666000\r\n03-09 14:48:03.832 20204 21891 D ExoPlayerImplInternal: before seekToPeriodPosition() - newPeriodPositionUs: 3589666000 seekTargetWindow.defaultPositionUs: 3573570000 playbackInfo.positionUs 3594666000 requestedContentPositionUs: 3589666000\r\n03-09 14:48:03.865 20204 21891 D DefaultLivePlaybackSpeedControl: setTargetLiveOffsetOverrideUs(52477000)\r\n03-09 14:48:05.323 20204 21891 D DefaultLivePlaybackSpeedControl: adjusting offset, speed: 1.1 liveOffsetUs: 53930908 currentTargetLiveOffsetUs: 52477000 idealTargetLiveOffsetUs: 52477000 smoothedMinPossibleLiveOffsetUs: 48192019\r\n03-09 14:48:06.328 20204 21891 D DefaultLivePlaybackSpeedControl: adjusting offset, speed: 1.1 liveOffsetUs: 53941958 currentTargetLiveOffsetUs: 52477000 idealTargetLiveOffsetUs: 52477000 smoothedMinPossibleLiveOffsetUs: 47873236\r\n\r\n````\r\n\r\nStep 3 - seek default is executed (prepare() will do this as well), notice `setTargetLiveOffsetOverrideUs(C.TIME_UNSET)` is **not called** so adjustment reverses trying (incorrectly) to slow down to the old seek position\r\n\r\n````\r\n03-09 14:48:18.337 20204 21891 D ExoPlayerImplInternal: seekToInternal() - timeline empty: false  seekPosition.windowPositionUs: -9223372036854775807\r\n03-09 14:48:18.337 20204 21891 D ExoPlayerImplInternal: resolvedSeekPosition periodUid: Pair{java.lang.Object@9be3c3e java.lang.Object@c575286} resolvedContentPositionUs: 3621618011\r\n03-09 14:48:18.338 20204 21891 D ExoPlayerImplInternal: before seekToPeriodPosition() - newPeriodPositionUs: 3621618011 seekTargetWindow.defaultPositionUs: 3579576000 playbackInfo.positionUs 3603559763 requestedContentPositionUs: -9223372036854775807\r\n03-09 14:48:19.126 20204 21891 D DefaultLivePlaybackSpeedControl: adjusting offset, speed: 0.9 liveOffsetUs: 35776574 currentTargetLiveOffsetUs: 52745177 idealTargetLiveOffsetUs: 52477000 smoothedMinPossibleLiveOffsetUs: 28691196\r\n````\r\n\n\n### Media\n\nWill send a live test stream to the developer email.\n\n### Bug Report\n\n- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","closed_by":{"login":"stevemayhew","id":398072,"node_id":"MDQ6VXNlcjM5ODA3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/398072?v=4","gravatar_id":"","url":"https://api.github.com/users/stevemayhew","html_url":"https://github.com/stevemayhew","followers_url":"https://api.github.com/users/stevemayhew/followers","following_url":"https://api.github.com/users/stevemayhew/following{/other_user}","gists_url":"https://api.github.com/users/stevemayhew/gists{/gist_id}","starred_url":"https://api.github.com/users/stevemayhew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevemayhew/subscriptions","organizations_url":"https://api.github.com/users/stevemayhew/orgs","repos_url":"https://api.github.com/users/stevemayhew/repos","events_url":"https://api.github.com/users/stevemayhew/events{/privacy}","received_events_url":"https://api.github.com/users/stevemayhew/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google/ExoPlayer/issues/11050/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google/ExoPlayer/issues/11050/timeline","performed_via_github_app":null,"state_reason":"completed"}