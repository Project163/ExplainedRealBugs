[{"id":5620697439,"node_id":"LE_lADOAzqMt84-08ubzwAAAAFPBQlf","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5620697439","actor":{"login":"pnevyk","id":2601371,"node_id":"MDQ6VXNlcjI2MDEzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/2601371?v=4","gravatar_id":"","url":"https://api.github.com/users/pnevyk","html_url":"https://github.com/pnevyk","followers_url":"https://api.github.com/users/pnevyk/followers","following_url":"https://api.github.com/users/pnevyk/following{/other_user}","gists_url":"https://api.github.com/users/pnevyk/gists{/gist_id}","starred_url":"https://api.github.com/users/pnevyk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pnevyk/subscriptions","organizations_url":"https://api.github.com/users/pnevyk/orgs","repos_url":"https://api.github.com/users/pnevyk/repos","events_url":"https://api.github.com/users/pnevyk/events{/privacy}","received_events_url":"https://api.github.com/users/pnevyk/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-11-15T20:23:29Z","label":{"name":"triage","color":"f9d0c4"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/969294225","html_url":"https://github.com/rwf2/Rocket/issues/1987#issuecomment-969294225","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1987","id":969294225,"node_id":"IC_kwDOAzqMt845xkGR","user":{"login":"pnevyk","id":2601371,"node_id":"MDQ6VXNlcjI2MDEzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/2601371?v=4","gravatar_id":"","url":"https://api.github.com/users/pnevyk","html_url":"https://github.com/pnevyk","followers_url":"https://api.github.com/users/pnevyk/followers","following_url":"https://api.github.com/users/pnevyk/following{/other_user}","gists_url":"https://api.github.com/users/pnevyk/gists{/gist_id}","starred_url":"https://api.github.com/users/pnevyk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pnevyk/subscriptions","organizations_url":"https://api.github.com/users/pnevyk/orgs","repos_url":"https://api.github.com/users/pnevyk/repos","events_url":"https://api.github.com/users/pnevyk/events{/privacy}","received_events_url":"https://api.github.com/users/pnevyk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-15T20:30:20Z","updated_at":"2021-11-15T20:30:20Z","body":"I have no familiarity with Rocket codebase, but with some pointers and advice, I can give fixing it a try, if it is confirmed as a bug.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/969294225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pnevyk","id":2601371,"node_id":"MDQ6VXNlcjI2MDEzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/2601371?v=4","gravatar_id":"","url":"https://api.github.com/users/pnevyk","html_url":"https://github.com/pnevyk","followers_url":"https://api.github.com/users/pnevyk/followers","following_url":"https://api.github.com/users/pnevyk/following{/other_user}","gists_url":"https://api.github.com/users/pnevyk/gists{/gist_id}","starred_url":"https://api.github.com/users/pnevyk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pnevyk/subscriptions","organizations_url":"https://api.github.com/users/pnevyk/orgs","repos_url":"https://api.github.com/users/pnevyk/repos","events_url":"https://api.github.com/users/pnevyk/events{/privacy}","received_events_url":"https://api.github.com/users/pnevyk/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6213516260,"node_id":"UNLE_lADOAzqMt84-08ubzwAAAAFyWrvk","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/6213516260","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2022-03-09T22:39:26Z","label":{"name":"triage","color":"f9d0c4"},"performed_via_github_app":null},{"id":6213516263,"node_id":"LE_lADOAzqMt84-08ubzwAAAAFyWrvn","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/6213516263","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-03-09T22:39:26Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1063450907","html_url":"https://github.com/rwf2/Rocket/issues/1987#issuecomment-1063450907","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1987","id":1063450907,"node_id":"IC_kwDOAzqMt84_Yvkb","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T22:39:32Z","updated_at":"2022-03-09T22:39:32Z","body":"Confirmed. Working on a fix now.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1063450907/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1063471488","html_url":"https://github.com/rwf2/Rocket/issues/1987#issuecomment-1063471488","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1987","id":1063471488,"node_id":"IC_kwDOAzqMt84_Y0mA","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T23:10:56Z","updated_at":"2022-03-09T23:20:52Z","body":"This bug occurs because of an interaction with `local_cache!()`. Namely, we have:\r\n\r\n```rust\r\n#[crate::async_trait]\r\nimpl<'r> FromData<'r> for Capped<&'r str> {\r\n    type Error = std::io::Error;\r\n\r\n    async fn from_data(req: &'r Request<'_>, data: Data<'r>) -> Outcome<'r, Self> {\r\n        let capped = try_outcome!(<Capped<String>>::from_data(req, data).await);\r\n        let string = capped.map(|s| local_cache!(req, s).as_str());\r\n        Success(string)\r\n    }\r\n}\r\n```\r\n\r\nIn this bug, the above implementation is called _twice_, once for each `&'r str` field. The field's `Data` is read and then stored into local cache. This way, the string can be retrieved with an `'r` lifetime. Local-cache is type-based, so at-most one value of a given type can be stored in the cache per request. The `local_cache!()` macro exists to create a locally anonymous type to prevent type conflicts, but that type is created once at compile-time per use. As a result, in the second invocation of this `from_data`, instead of storing a new string in local cache, we simply retrieve the existing string.\r\n\r\nThis means that a similar bug exists for other types such as `&'r RawStr` and in other contexts. Effectively all instances of calls to `local_cache!()` which produce a reference intended to be unique per invocation are incorrect.\r\n\r\nI'm working on an extension to local cache to resolve this kind of issue. Once implemented, the extension can be applied to this method, resolving this issue. I'll also audit the entire codebase for other calls to `local_cache!()` which may be incorrect.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1063471488/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6451236875,"node_id":"CE_lADOAzqMt84-08ubzwAAAAGAhhAL","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/6451236875","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"1b37d571c276e118a334d92513be745d7b9b220c","commit_url":"https://api.github.com/repos/rwf2/Rocket/commits/1b37d571c276e118a334d92513be745d7b9b220c","created_at":"2022-04-19T01:14:38Z","state_reason":null,"performed_via_github_app":null},{"id":11603836533,"node_id":"REFE_lADOAzqMt84-08ubzwAAAAKzpH51","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/11603836533","actor":{"login":"pull[bot]","id":39814207,"node_id":"MDM6Qm90Mzk4MTQyMDc=","avatar_url":"https://avatars.githubusercontent.com/in/12910?v=4","gravatar_id":"","url":"https://api.github.com/users/pull%5Bbot%5D","html_url":"https://github.com/apps/pull","followers_url":"https://api.github.com/users/pull%5Bbot%5D/followers","following_url":"https://api.github.com/users/pull%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/pull%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/pull%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pull%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/pull%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/pull%5Bbot%5D/repos","events_url":"https://api.github.com/users/pull%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/pull%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1b37d571c276e118a334d92513be745d7b9b220c","commit_url":"https://api.github.com/repos/Necmttn/Rocket/commits/1b37d571c276e118a334d92513be745d7b9b220c","created_at":"2024-01-26T01:03:07Z","performed_via_github_app":null}]