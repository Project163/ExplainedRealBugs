[{"id":3376788119,"node_id":"MDEyOkxhYmVsZWRFdmVudDMzNzY3ODgxMTk=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3376788119","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-05-27T07:34:17Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":3376934867,"node_id":"MDExOkNsb3NlZEV2ZW50MzM3NjkzNDg2Nw==","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3376934867","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"b8f9011c04f104bb4a20f44e5bce31a1e9b46e64","commit_url":"https://api.github.com/repos/rwf2/Rocket/commits/b8f9011c04f104bb4a20f44e5bce31a1e9b46e64","created_at":"2020-05-27T08:13:51Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/634511404","html_url":"https://github.com/rwf2/Rocket/issues/1312#issuecomment-634511404","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1312","id":634511404,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNDUxMTQwNA==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-05-27T08:29:02Z","updated_at":"2020-05-27T08:32:35Z","body":"Absolutely fantastic find. I can confirm that this is, indeed, a soundness bug. The use of `unsafe` in `LocalRequest` is, by far, the most worrisome.\r\n\r\n> The comment justifies that it is safe to have LocalRequest and LocalResponse which share the same Request pointer because modification from LocalRequest is not observable from LocalResponse. However, LocalRequest's Clone implementation allows to create two LocalRequest that share the same Request raw pointer, which was not part of the justification:\r\n\r\nThis \"proof\" was written and argued on an earlier version of `LocalRequest` in which the `Clone` implementation did not exist. Previously, we had `cloned_dispatch`, which operated correctly: https://github.com/SergioBenitez/Rocket/commit/56c6a96f6a94ab844a0f571c303d741c7ec668d3#diff-108b840beda9b69a05bed320c98f260bL342-L364.\r\n\r\nThe fragility of this and other unsafe-soundness proofs in Rocket are that they are not machine checked. I had taken great care when writing the proof originally to check that it was correct, but future changes to the code are not subject to any machine-checked scrutiny, and recalling all cases in the original proof structure in response to a code change is a difficult proposition. As evidenced here, we clearly need to do better.\r\n\r\n> ## Is this a security bug?\r\n> Considering that\r\n> \r\n> 1. LocalRequest is intended to be used for testing\r\n> 2. The exact pattern to trigger the bug is unlikely to happen in the wild\r\n> \r\n> I believe the security impact of this bug is minimal. I think It is still worthwhile to file a RustSec advisory after the bug confirmation [considering the people who want to be notified about unsound APIs](https://www.reddit.com/r/rust/comments/gidtpe/security_advisories_for_april_2020_rustqlite_os/).\r\n\r\nI am happy to have a `RustSec` advisory filed. \r\n\r\n> I think it is also possible to fix Clone to clone the internal Request [...].\r\n\r\nThis is the approach I've taken in fixing this particular issue.\r\n\r\n> ## Possible Fixes\r\n> I believe LocalRequest can be redesigned without breaking LocalRequest API with safe alternatives such as [get_mut()](https://doc.rust-lang.org/std/rc/struct.Rc.html#method.get_mut) or [make_mut()](https://doc.rust-lang.org/std/rc/struct.Rc.html#method.make_mut).\r\n\r\nThis is the approach I'd _like_ to take. I am not sure if the safe `Rc` APIs are enough to implement the existing `LocalRequest/Response` API. While `get_mut` and `make_mut` solve one part of the puzzle, you'll note that we also use `unsafe` to \"extend\" the lifetime of a `Request`. Given that we make no use of this extension, such an extension is safe, but I do not know how to circumvent the need to do this, nor do I know of a way to emulate this in safe code. I am happy to pay a performance cost to remove `unsafe` in `LocalRequest`, and I'd be happy for any ideas in this direction.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/634511404/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3386329836,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMzODYzMjk4MzY=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3386329836","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"89150f9b812864272e9a36bfad4fa5c21b814798","commit_url":"https://api.github.com/repos/rwf2/Rocket/commits/89150f9b812864272e9a36bfad4fa5c21b814798","created_at":"2020-05-29T09:11:01Z","performed_via_github_app":null},{"actor":{"login":"Qwaz","id":5073807,"node_id":"MDQ6VXNlcjUwNzM4MDc=","avatar_url":"https://avatars.githubusercontent.com/u/5073807?v=4","gravatar_id":"","url":"https://api.github.com/users/Qwaz","html_url":"https://github.com/Qwaz","followers_url":"https://api.github.com/users/Qwaz/followers","following_url":"https://api.github.com/users/Qwaz/following{/other_user}","gists_url":"https://api.github.com/users/Qwaz/gists{/gist_id}","starred_url":"https://api.github.com/users/Qwaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Qwaz/subscriptions","organizations_url":"https://api.github.com/users/Qwaz/orgs","repos_url":"https://api.github.com/users/Qwaz/repos","events_url":"https://api.github.com/users/Qwaz/events{/privacy}","received_events_url":"https://api.github.com/users/Qwaz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-01T05:25:04Z","updated_at":"2020-06-01T05:25:04Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1319","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/1319/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/1319/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/1319/events","html_url":"https://github.com/rwf2/Rocket/issues/1319","id":628161737,"node_id":"MDU6SXNzdWU2MjgxNjE3Mzc=","number":1319,"title":"Further soundness issue in LocalRequest/LocalResponse","user":{"login":"Qwaz","id":5073807,"node_id":"MDQ6VXNlcjUwNzM4MDc=","avatar_url":"https://avatars.githubusercontent.com/u/5073807?v=4","gravatar_id":"","url":"https://api.github.com/users/Qwaz","html_url":"https://github.com/Qwaz","followers_url":"https://api.github.com/users/Qwaz/followers","following_url":"https://api.github.com/users/Qwaz/following{/other_user}","gists_url":"https://api.github.com/users/Qwaz/gists{/gist_id}","starred_url":"https://api.github.com/users/Qwaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Qwaz/subscriptions","organizations_url":"https://api.github.com/users/Qwaz/orgs","repos_url":"https://api.github.com/users/Qwaz/repos","events_url":"https://api.github.com/users/Qwaz/events{/privacy}","received_events_url":"https://api.github.com/users/Qwaz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":615883980,"node_id":"MDU6TGFiZWw2MTU4ODM5ODA=","url":"https://api.github.com/repos/rwf2/Rocket/labels/triage","name":"triage","color":"FBCA04","default":false,"description":"A bug report being investigated"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-06-01T05:25:03Z","updated_at":"2020-07-22T08:20:36Z","closed_at":"2020-07-22T08:20:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":54168759,"node_id":"MDEwOlJlcG9zaXRvcnk1NDE2ODc1OQ==","name":"Rocket","full_name":"rwf2/Rocket","private":false,"owner":{"login":"rwf2","id":106361765,"node_id":"O_kgDOBlbzpQ","avatar_url":"https://avatars.githubusercontent.com/u/106361765?v=4","gravatar_id":"","url":"https://api.github.com/users/rwf2","html_url":"https://github.com/rwf2","followers_url":"https://api.github.com/users/rwf2/followers","following_url":"https://api.github.com/users/rwf2/following{/other_user}","gists_url":"https://api.github.com/users/rwf2/gists{/gist_id}","starred_url":"https://api.github.com/users/rwf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rwf2/subscriptions","organizations_url":"https://api.github.com/users/rwf2/orgs","repos_url":"https://api.github.com/users/rwf2/repos","events_url":"https://api.github.com/users/rwf2/events{/privacy}","received_events_url":"https://api.github.com/users/rwf2/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rwf2/Rocket","description":"A web framework for Rust.","fork":false,"url":"https://api.github.com/repos/rwf2/Rocket","forks_url":"https://api.github.com/repos/rwf2/Rocket/forks","keys_url":"https://api.github.com/repos/rwf2/Rocket/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rwf2/Rocket/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rwf2/Rocket/teams","hooks_url":"https://api.github.com/repos/rwf2/Rocket/hooks","issue_events_url":"https://api.github.com/repos/rwf2/Rocket/issues/events{/number}","events_url":"https://api.github.com/repos/rwf2/Rocket/events","assignees_url":"https://api.github.com/repos/rwf2/Rocket/assignees{/user}","branches_url":"https://api.github.com/repos/rwf2/Rocket/branches{/branch}","tags_url":"https://api.github.com/repos/rwf2/Rocket/tags","blobs_url":"https://api.github.com/repos/rwf2/Rocket/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rwf2/Rocket/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rwf2/Rocket/git/refs{/sha}","trees_url":"https://api.github.com/repos/rwf2/Rocket/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rwf2/Rocket/statuses/{sha}","languages_url":"https://api.github.com/repos/rwf2/Rocket/languages","stargazers_url":"https://api.github.com/repos/rwf2/Rocket/stargazers","contributors_url":"https://api.github.com/repos/rwf2/Rocket/contributors","subscribers_url":"https://api.github.com/repos/rwf2/Rocket/subscribers","subscription_url":"https://api.github.com/repos/rwf2/Rocket/subscription","commits_url":"https://api.github.com/repos/rwf2/Rocket/commits{/sha}","git_commits_url":"https://api.github.com/repos/rwf2/Rocket/git/commits{/sha}","comments_url":"https://api.github.com/repos/rwf2/Rocket/comments{/number}","issue_comment_url":"https://api.github.com/repos/rwf2/Rocket/issues/comments{/number}","contents_url":"https://api.github.com/repos/rwf2/Rocket/contents/{+path}","compare_url":"https://api.github.com/repos/rwf2/Rocket/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rwf2/Rocket/merges","archive_url":"https://api.github.com/repos/rwf2/Rocket/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rwf2/Rocket/downloads","issues_url":"https://api.github.com/repos/rwf2/Rocket/issues{/number}","pulls_url":"https://api.github.com/repos/rwf2/Rocket/pulls{/number}","milestones_url":"https://api.github.com/repos/rwf2/Rocket/milestones{/number}","notifications_url":"https://api.github.com/repos/rwf2/Rocket/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rwf2/Rocket/labels{/name}","releases_url":"https://api.github.com/repos/rwf2/Rocket/releases{/id}","deployments_url":"https://api.github.com/repos/rwf2/Rocket/deployments","created_at":"2016-03-18T02:50:18Z","updated_at":"2025-11-09T18:27:08Z","pushed_at":"2025-10-01T04:53:46Z","git_url":"git://github.com/rwf2/Rocket.git","ssh_url":"git@github.com:rwf2/Rocket.git","clone_url":"https://github.com/rwf2/Rocket.git","svn_url":"https://github.com/rwf2/Rocket","homepage":"https://rocket.rs","size":8445,"stargazers_count":25480,"watchers_count":25480,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":1614,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":84,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["framework","rocket","rust","web","web-development","web-framework"],"visibility":"public","forks":1614,"open_issues":84,"watchers":25480,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Continued from #1312, Rocket v0.4.5.\r\n\r\n> Given that we make no use of this extension, such an extension is safe\r\n\r\nI looked into the code again to see if the same APIs can be kept while removing the unsafe code. The more I look into the code, the more I believe we can't achieve the goal because the creation of `LocalResponse<'c>` is inherently unsound.\r\n\r\nWhen handling requests, Rocket's `dispatch()` method takes `&'r mut Request<'s>` and generates `Response<'r>`. That is, `Response` instance is allowed to depend on values which live as long as `Request` instance.\r\n\r\nWhen dispatching a request from `LocalRequest`, we create a `LocalResponse<'c>` from `LocalRequest<'c>` by extending the lifetime of `LocalRequest` reference behind `Rc` smart pointer to `'c` with unsafe method. Here, `'c` is the lifetime of `Client` instance (if I'm not misunderstanding anything).\r\n\r\nThis extension could be dangerous if the following conditions are true:\r\n1. The actual lifetime of `Request` is shorter than the lifetime of `Client`.\r\n2. A value that comes from `Request` is accessible after `Request` is dropped because it is annotated as `'c`.\r\n\r\n`LocalResponse` tries to prevent this situation by holding `Rc<Request<'c>>` with `Response<'c>`. However, this is not enough to prevent such scenarios to happen. I don't have a concrete proof of concept code like the one I attached in #1312 yet, but I believe the following code can pass Rust compiler's type check while performing use-after-free. Could you check the scenarios and share your thoughts?\r\n\r\n## A body with custom `Drop` implementation\r\n\r\nAccording to [RFC 1857](https://github.com/rust-lang/rfcs/blob/master/text/1857-stabilize-drop-order.md), fields of structs are dropped in the same order as they are declared. It means that when dropping `LocalResponse`, `_request: Rc<Request<'c>>` is dropped before `response: Response<'c>`. If `body` field of `Response`, which has a type of `Option<Body<Box<dyn io::Read + 'c>>>`, contains a trait object with custom drop implementation, that drop implementation can trigger use-after-free if it accesses values that come from the original request.\r\n\r\n## `Response::take_body()`\r\n\r\n`Response::take_body()` returns `Option<Body<Box<dyn Read + 'c>>>`. If we create `LocalResponse`, save the result of `take_body()`, and drop `LocalRequest` and `LocalResponse`, the underlying `Request` object is dropped but we still have access to the result of `take_body()` since it is annotated as `'c`. Use-after-free can be triggered if this body object depend on values from `Request` instance.","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/1319/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":3489899635,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM0ODk4OTk2MzU=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3489899635","actor":{"login":"Qwaz","id":5073807,"node_id":"MDQ6VXNlcjUwNzM4MDc=","avatar_url":"https://avatars.githubusercontent.com/u/5073807?v=4","gravatar_id":"","url":"https://api.github.com/users/Qwaz","html_url":"https://github.com/Qwaz","followers_url":"https://api.github.com/users/Qwaz/followers","following_url":"https://api.github.com/users/Qwaz/following{/other_user}","gists_url":"https://api.github.com/users/Qwaz/gists{/gist_id}","starred_url":"https://api.github.com/users/Qwaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Qwaz/subscriptions","organizations_url":"https://api.github.com/users/Qwaz/orgs","repos_url":"https://api.github.com/users/Qwaz/repos","events_url":"https://api.github.com/users/Qwaz/events{/privacy}","received_events_url":"https://api.github.com/users/Qwaz/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"226a6d6dad7b8dd1d5177cc41bb167dff342232e","commit_url":"https://api.github.com/repos/Qwaz/advisory-db/commits/226a6d6dad7b8dd1d5177cc41bb167dff342232e","created_at":"2020-06-28T05:09:38Z","performed_via_github_app":null},{"actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-28T17:18:55Z","updated_at":"2020-06-28T17:18:55Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1346","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/1346/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/1346/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/1346/events","html_url":"https://github.com/rwf2/Rocket/pull/1346","id":639285980,"node_id":"MDExOlB1bGxSZXF1ZXN0NDM0OTA2Nzg0","number":1346,"title":"async: blocking client API","user":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":763868037,"node_id":"MDU6TGFiZWw3NjM4NjgwMzc=","url":"https://api.github.com/repos/rwf2/Rocket/labels/pr:%20merged","name":"pr: merged","color":"5319E7","default":false,"description":"This pull request was merged manually."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2020-06-16T00:41:48Z","updated_at":"2021-07-22T19:01:14Z","closed_at":"2020-07-10T11:46:27Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":54168759,"node_id":"MDEwOlJlcG9zaXRvcnk1NDE2ODc1OQ==","name":"Rocket","full_name":"rwf2/Rocket","private":false,"owner":{"login":"rwf2","id":106361765,"node_id":"O_kgDOBlbzpQ","avatar_url":"https://avatars.githubusercontent.com/u/106361765?v=4","gravatar_id":"","url":"https://api.github.com/users/rwf2","html_url":"https://github.com/rwf2","followers_url":"https://api.github.com/users/rwf2/followers","following_url":"https://api.github.com/users/rwf2/following{/other_user}","gists_url":"https://api.github.com/users/rwf2/gists{/gist_id}","starred_url":"https://api.github.com/users/rwf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rwf2/subscriptions","organizations_url":"https://api.github.com/users/rwf2/orgs","repos_url":"https://api.github.com/users/rwf2/repos","events_url":"https://api.github.com/users/rwf2/events{/privacy}","received_events_url":"https://api.github.com/users/rwf2/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rwf2/Rocket","description":"A web framework for Rust.","fork":false,"url":"https://api.github.com/repos/rwf2/Rocket","forks_url":"https://api.github.com/repos/rwf2/Rocket/forks","keys_url":"https://api.github.com/repos/rwf2/Rocket/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rwf2/Rocket/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rwf2/Rocket/teams","hooks_url":"https://api.github.com/repos/rwf2/Rocket/hooks","issue_events_url":"https://api.github.com/repos/rwf2/Rocket/issues/events{/number}","events_url":"https://api.github.com/repos/rwf2/Rocket/events","assignees_url":"https://api.github.com/repos/rwf2/Rocket/assignees{/user}","branches_url":"https://api.github.com/repos/rwf2/Rocket/branches{/branch}","tags_url":"https://api.github.com/repos/rwf2/Rocket/tags","blobs_url":"https://api.github.com/repos/rwf2/Rocket/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rwf2/Rocket/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rwf2/Rocket/git/refs{/sha}","trees_url":"https://api.github.com/repos/rwf2/Rocket/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rwf2/Rocket/statuses/{sha}","languages_url":"https://api.github.com/repos/rwf2/Rocket/languages","stargazers_url":"https://api.github.com/repos/rwf2/Rocket/stargazers","contributors_url":"https://api.github.com/repos/rwf2/Rocket/contributors","subscribers_url":"https://api.github.com/repos/rwf2/Rocket/subscribers","subscription_url":"https://api.github.com/repos/rwf2/Rocket/subscription","commits_url":"https://api.github.com/repos/rwf2/Rocket/commits{/sha}","git_commits_url":"https://api.github.com/repos/rwf2/Rocket/git/commits{/sha}","comments_url":"https://api.github.com/repos/rwf2/Rocket/comments{/number}","issue_comment_url":"https://api.github.com/repos/rwf2/Rocket/issues/comments{/number}","contents_url":"https://api.github.com/repos/rwf2/Rocket/contents/{+path}","compare_url":"https://api.github.com/repos/rwf2/Rocket/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rwf2/Rocket/merges","archive_url":"https://api.github.com/repos/rwf2/Rocket/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rwf2/Rocket/downloads","issues_url":"https://api.github.com/repos/rwf2/Rocket/issues{/number}","pulls_url":"https://api.github.com/repos/rwf2/Rocket/pulls{/number}","milestones_url":"https://api.github.com/repos/rwf2/Rocket/milestones{/number}","notifications_url":"https://api.github.com/repos/rwf2/Rocket/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rwf2/Rocket/labels{/name}","releases_url":"https://api.github.com/repos/rwf2/Rocket/releases{/id}","deployments_url":"https://api.github.com/repos/rwf2/Rocket/deployments","created_at":"2016-03-18T02:50:18Z","updated_at":"2025-11-09T18:27:08Z","pushed_at":"2025-10-01T04:53:46Z","git_url":"git://github.com/rwf2/Rocket.git","ssh_url":"git@github.com:rwf2/Rocket.git","clone_url":"https://github.com/rwf2/Rocket.git","svn_url":"https://github.com/rwf2/Rocket","homepage":"https://rocket.rs","size":8445,"stargazers_count":25480,"watchers_count":25480,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":1614,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":84,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["framework","rocket","rust","web","web-development","web-framework"],"visibility":"public","forks":1614,"open_issues":84,"watchers":25480,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rwf2/Rocket/pulls/1346","html_url":"https://github.com/rwf2/Rocket/pull/1346","diff_url":"https://github.com/rwf2/Rocket/pull/1346.diff","patch_url":"https://github.com/rwf2/Rocket/pull/1346.patch","merged_at":null},"body":"Adds a blocking variant of the APIs in `rocket::local::` which is more convenient to use in testing. Most tests are currently `async` only because the API is, and the use of `#[rocket::async_test]` and `.await`s sprinkled throughout is just ceremony.\r\n\r\nAn alternative approach could be to support only a blocking API and keep the `async` bits internal-only, but since requests can and will be executed concurrently in a live server I felt uncomfortable imposing this restriction. I believe that the `async`-capable test harness can be useful for simulating routes under load (e.g. interactions with databases or external APIs) without needing an HTTP client test harness.\r\n\r\n## Implementation Overview\r\n\r\nThe blocking `Client` spawns a single background thread on construction. This thread runs a single-threaded `tokio` `Runtime`, and waits for a signal that the associated `Client` has been dropped. Methods on the blocking `Client`, `LocalRequest`, and `LocalResponse` use the runtime's `Handle::block_on` method to expose a synchronous API on top of the existing asynchronous `Client`. This is similar to the [blocking API for `reqwest`](https://docs.rs/reqwest/0.10.6/reqwest/blocking/index.html), but it takes advantage of the recently added `Handle::block_on` method in `tokio` to avoid an additional channel for communication to/from the runtime.\r\n\r\nMethod signatures and documentation are simply copied from the blocking to the non-blocking version, and method bodies have been replaced with `client.block_on()` as necessary. Due to the large amount of similarity, `diff -u client.rs blocking/client.rs` will be useful for reviewing this.\r\n\r\n## Todo\r\n* [x] Currently, all documentation is copied directly from the existing API. This raises two new issues:\r\n  * [x] Where to highlight the differences, and where to leave documentation identical.\r\n  * [x] How to keep these in sync in the future.\r\n* [x] Add explanations and examples to the guide-level documentation.","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1346/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/1346/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"actor":{"login":"Qwaz","id":5073807,"node_id":"MDQ6VXNlcjUwNzM4MDc=","avatar_url":"https://avatars.githubusercontent.com/u/5073807?v=4","gravatar_id":"","url":"https://api.github.com/users/Qwaz","html_url":"https://github.com/Qwaz","followers_url":"https://api.github.com/users/Qwaz/followers","following_url":"https://api.github.com/users/Qwaz/following{/other_user}","gists_url":"https://api.github.com/users/Qwaz/gists{/gist_id}","starred_url":"https://api.github.com/users/Qwaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Qwaz/subscriptions","organizations_url":"https://api.github.com/users/Qwaz/orgs","repos_url":"https://api.github.com/users/Qwaz/repos","events_url":"https://api.github.com/users/Qwaz/events{/privacy}","received_events_url":"https://api.github.com/users/Qwaz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T05:34:01Z","updated_at":"2020-06-29T05:34:01Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rustsec/advisory-db/issues/320","repository_url":"https://api.github.com/repos/rustsec/advisory-db","labels_url":"https://api.github.com/repos/rustsec/advisory-db/issues/320/labels{/name}","comments_url":"https://api.github.com/repos/rustsec/advisory-db/issues/320/comments","events_url":"https://api.github.com/repos/rustsec/advisory-db/issues/320/events","html_url":"https://github.com/rustsec/advisory-db/pull/320","id":647125733,"node_id":"MDExOlB1bGxSZXF1ZXN0NDQxMjA2MDgx","number":320,"title":"Informational advisory for SergioBenitez/Rocket#1312","user":{"login":"Qwaz","id":5073807,"node_id":"MDQ6VXNlcjUwNzM4MDc=","avatar_url":"https://avatars.githubusercontent.com/u/5073807?v=4","gravatar_id":"","url":"https://api.github.com/users/Qwaz","html_url":"https://github.com/Qwaz","followers_url":"https://api.github.com/users/Qwaz/followers","following_url":"https://api.github.com/users/Qwaz/following{/other_user}","gists_url":"https://api.github.com/users/Qwaz/gists{/gist_id}","starred_url":"https://api.github.com/users/Qwaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Qwaz/subscriptions","organizations_url":"https://api.github.com/users/Qwaz/orgs","repos_url":"https://api.github.com/users/Qwaz/repos","events_url":"https://api.github.com/users/Qwaz/events{/privacy}","received_events_url":"https://api.github.com/users/Qwaz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-06-29T05:34:01Z","updated_at":"2020-08-20T00:14:51Z","closed_at":"2020-08-14T15:40:21Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":83153561,"node_id":"MDEwOlJlcG9zaXRvcnk4MzE1MzU2MQ==","name":"advisory-db","full_name":"rustsec/advisory-db","private":false,"owner":{"login":"rustsec","id":25397242,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI1Mzk3MjQy","avatar_url":"https://avatars.githubusercontent.com/u/25397242?v=4","gravatar_id":"","url":"https://api.github.com/users/rustsec","html_url":"https://github.com/rustsec","followers_url":"https://api.github.com/users/rustsec/followers","following_url":"https://api.github.com/users/rustsec/following{/other_user}","gists_url":"https://api.github.com/users/rustsec/gists{/gist_id}","starred_url":"https://api.github.com/users/rustsec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rustsec/subscriptions","organizations_url":"https://api.github.com/users/rustsec/orgs","repos_url":"https://api.github.com/users/rustsec/repos","events_url":"https://api.github.com/users/rustsec/events{/privacy}","received_events_url":"https://api.github.com/users/rustsec/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rustsec/advisory-db","description":"Security advisory database for Rust crates published through crates.io","fork":false,"url":"https://api.github.com/repos/rustsec/advisory-db","forks_url":"https://api.github.com/repos/rustsec/advisory-db/forks","keys_url":"https://api.github.com/repos/rustsec/advisory-db/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rustsec/advisory-db/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rustsec/advisory-db/teams","hooks_url":"https://api.github.com/repos/rustsec/advisory-db/hooks","issue_events_url":"https://api.github.com/repos/rustsec/advisory-db/issues/events{/number}","events_url":"https://api.github.com/repos/rustsec/advisory-db/events","assignees_url":"https://api.github.com/repos/rustsec/advisory-db/assignees{/user}","branches_url":"https://api.github.com/repos/rustsec/advisory-db/branches{/branch}","tags_url":"https://api.github.com/repos/rustsec/advisory-db/tags","blobs_url":"https://api.github.com/repos/rustsec/advisory-db/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rustsec/advisory-db/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rustsec/advisory-db/git/refs{/sha}","trees_url":"https://api.github.com/repos/rustsec/advisory-db/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rustsec/advisory-db/statuses/{sha}","languages_url":"https://api.github.com/repos/rustsec/advisory-db/languages","stargazers_url":"https://api.github.com/repos/rustsec/advisory-db/stargazers","contributors_url":"https://api.github.com/repos/rustsec/advisory-db/contributors","subscribers_url":"https://api.github.com/repos/rustsec/advisory-db/subscribers","subscription_url":"https://api.github.com/repos/rustsec/advisory-db/subscription","commits_url":"https://api.github.com/repos/rustsec/advisory-db/commits{/sha}","git_commits_url":"https://api.github.com/repos/rustsec/advisory-db/git/commits{/sha}","comments_url":"https://api.github.com/repos/rustsec/advisory-db/comments{/number}","issue_comment_url":"https://api.github.com/repos/rustsec/advisory-db/issues/comments{/number}","contents_url":"https://api.github.com/repos/rustsec/advisory-db/contents/{+path}","compare_url":"https://api.github.com/repos/rustsec/advisory-db/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rustsec/advisory-db/merges","archive_url":"https://api.github.com/repos/rustsec/advisory-db/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rustsec/advisory-db/downloads","issues_url":"https://api.github.com/repos/rustsec/advisory-db/issues{/number}","pulls_url":"https://api.github.com/repos/rustsec/advisory-db/pulls{/number}","milestones_url":"https://api.github.com/repos/rustsec/advisory-db/milestones{/number}","notifications_url":"https://api.github.com/repos/rustsec/advisory-db/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rustsec/advisory-db/labels{/name}","releases_url":"https://api.github.com/repos/rustsec/advisory-db/releases{/id}","deployments_url":"https://api.github.com/repos/rustsec/advisory-db/deployments","created_at":"2017-02-25T18:38:08Z","updated_at":"2025-11-04T06:10:26Z","pushed_at":"2025-11-05T02:53:33Z","git_url":"git://github.com/rustsec/advisory-db.git","ssh_url":"git@github.com:rustsec/advisory-db.git","clone_url":"https://github.com/rustsec/advisory-db.git","svn_url":"https://github.com/rustsec/advisory-db","homepage":"https://rustsec.org","size":23581,"stargazers_count":1041,"watchers_count":1041,"language":null,"has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":407,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":78,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["rust","security","security-advisories","security-audit","vulnerabilities"],"visibility":"public","forks":407,"open_issues":78,"watchers":1041,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rustsec/advisory-db/pulls/320","html_url":"https://github.com/rustsec/advisory-db/pull/320","diff_url":"https://github.com/rustsec/advisory-db/pull/320.diff","patch_url":"https://github.com/rustsec/advisory-db/pull/320.patch","merged_at":"2020-08-14T15:40:21Z"},"body":"The affected version of `rocket` contains a `Clone` trait implementation of `LocalRequest` that reuses the pointer to inner `Request` object. This causes data race in rare combinations of APIs if the original and the cloned objects are modified at the same time.\r\n\r\nhttps://github.com/SergioBenitez/Rocket/issues/1312","reactions":{"url":"https://api.github.com/repos/rustsec/advisory-db/issues/320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rustsec/advisory-db/issues/320/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":3656741665,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2NTY3NDE2NjU=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3656741665","actor":{"login":"Shnatsel","id":291257,"node_id":"MDQ6VXNlcjI5MTI1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/291257?v=4","gravatar_id":"","url":"https://api.github.com/users/Shnatsel","html_url":"https://github.com/Shnatsel","followers_url":"https://api.github.com/users/Shnatsel/followers","following_url":"https://api.github.com/users/Shnatsel/following{/other_user}","gists_url":"https://api.github.com/users/Shnatsel/gists{/gist_id}","starred_url":"https://api.github.com/users/Shnatsel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Shnatsel/subscriptions","organizations_url":"https://api.github.com/users/Shnatsel/orgs","repos_url":"https://api.github.com/users/Shnatsel/repos","events_url":"https://api.github.com/users/Shnatsel/events{/privacy}","received_events_url":"https://api.github.com/users/Shnatsel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1b673b14ea8b0d5b1d8ab39281cf0ae1ec4bf72d","commit_url":"https://api.github.com/repos/rustsec/advisory-db/commits/1b673b14ea8b0d5b1d8ab39281cf0ae1ec4bf72d","created_at":"2020-08-14T15:40:23Z","performed_via_github_app":null},{"id":13766682775,"node_id":"REFE_lADOAzqMt84lRtB4zwAAAAM0juiX","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/13766682775","actor":{"login":"Eijebong","id":3650385,"node_id":"MDQ6VXNlcjM2NTAzODU=","avatar_url":"https://avatars.githubusercontent.com/u/3650385?v=4","gravatar_id":"","url":"https://api.github.com/users/Eijebong","html_url":"https://github.com/Eijebong","followers_url":"https://api.github.com/users/Eijebong/followers","following_url":"https://api.github.com/users/Eijebong/following{/other_user}","gists_url":"https://api.github.com/users/Eijebong/gists{/gist_id}","starred_url":"https://api.github.com/users/Eijebong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eijebong/subscriptions","organizations_url":"https://api.github.com/users/Eijebong/orgs","repos_url":"https://api.github.com/users/Eijebong/repos","events_url":"https://api.github.com/users/Eijebong/events{/privacy}","received_events_url":"https://api.github.com/users/Eijebong/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b8f9011c04f104bb4a20f44e5bce31a1e9b46e64","commit_url":"https://api.github.com/repos/Eijebong/Rocket/commits/b8f9011c04f104bb4a20f44e5bce31a1e9b46e64","created_at":"2024-08-05T16:10:40Z","performed_via_github_app":null}]