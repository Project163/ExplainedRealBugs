{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1695","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/1695/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/1695/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/1695/events","html_url":"https://github.com/rwf2/Rocket/issues/1695","id":919878319,"node_id":"MDU6SXNzdWU5MTk4NzgzMTk=","number":1695,"title":"FromFormField::from_data forward to from_value, or something","user":{"login":"ijackson","id":2090772,"node_id":"MDQ6VXNlcjIwOTA3NzI=","avatar_url":"https://avatars.githubusercontent.com/u/2090772?v=4","gravatar_id":"","url":"https://api.github.com/users/ijackson","html_url":"https://github.com/ijackson","followers_url":"https://api.github.com/users/ijackson/followers","following_url":"https://api.github.com/users/ijackson/following{/other_user}","gists_url":"https://api.github.com/users/ijackson/gists{/gist_id}","starred_url":"https://api.github.com/users/ijackson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ijackson/subscriptions","organizations_url":"https://api.github.com/users/ijackson/orgs","repos_url":"https://api.github.com/users/ijackson/repos","events_url":"https://api.github.com/users/ijackson/events{/privacy}","received_events_url":"https://api.github.com/users/ijackson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":28,"created_at":"2021-06-13T20:45:58Z","updated_at":"2021-07-04T10:44:52Z","closed_at":"2021-06-29T11:56:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi.  I'm upgrading one of my applications from Rocket 0.4 to 0.5.  I have an observation and a feature/change request regarding `FromFormField`.\r\n\r\nThere are a good set of provided implementations of `FromFormField`.  There is of course the option to implement the trait by hand.  There is also the option to derive it for nested parameters.  But I use newtypes heavily to make my program typesafe and clearer internally.\r\n\r\nImplementing `FromFormField` for a newtype wrapper around a small string or integer (or other similar small type) is quite inconvenient.  Chiefly, the problem is the need to provide an implementation of `from_data`.  Even if the implementation is no more than read into a string, and feed that to a string parser, the amount of boilerplate is considerable.\r\n\r\nOr to put it another way, there is a gap between the very cooked provided implementations, and the very manual direct impl.  I think that gap consists of types which are parseable from strings (probably, smallish ones).\r\n\r\nI would like a more convenient way to define such a `FromFormField` impl.  As a success criterion, it ought to make it easy to implement `FromFormField` for any type which is `FromStr`.  (But not *all* `FromStr` should be `FromFormField`, and possibly the `FromFormField` might be different to the `FromStr` - that should be up to the type's author.)\r\n\r\nI have two suggestions for how to achieve this.  You may have a better idea.\r\n\r\n 1. Have the default `from_data` read the data to a string, and forward to `from_value`, rather than erroring.  (Probably a smaller data limit would be a good idea.)\r\n\r\n 2. Some kind of macro to generate a `from_data` impl.\r\n\r\nOf these I think 1 is probably best.\r\n\r\nTo give you a flavour of what I am looking to improve, here is a fragment from in my proto-Rocket-0.5 branch right now (lightly edited, and it doesn't typecheck right now...):\r\n```\r\nimpl<'i,Id> InstanceAccess<'i,Id>\r\n  where Id: AccessId,\r\n        form::Error: From<Id::Error>\r\n{\r\n  #[throws(form::Error<'i>)]\r\n  fn from_str(s: &'i str) -> Self {\r\n    /* actual code for generating an InstanceAccess from a string elided */\r\n  }\r\n}\r\n\r\nimpl<'v, Id> FromFormField<'v> for InstanceAccess<'v, Id>\r\n  where Id: AccessId,\r\n        form::Error: From<Id::Error>\r\n{\r\n  fn from_value(field: ValueField<'v>) -> Result<Self, form::Error<'v>> {\r\n    InstanceAccess::from_str(FromFormField::from_value(field)?)?\r\n  }\r\n\r\n  fn from_data<'life0, 'async_trait>(\r\n    field: DataField<'v, 'life0>\r\n  ) -> Pin<Box<dyn Future<Output = form::Result<'v, Self>> + Send + 'async_trait>>\r\n  where\r\n    'v: 'async_trait,\r\n   'life0: 'async_trait,\r\n    Self: 'async_trait,\r\n  {\r\n    InstanceAccess::from_str(FromFormField::from_data(field).await?)?\r\n  }\r\n}\r\n```","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1695/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/1695/timeline","performed_via_github_app":null,"state_reason":"completed"}