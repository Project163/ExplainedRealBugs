{"url":"https://api.github.com/repos/rwf2/Rocket/issues/2209","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/2209/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/2209/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/2209/events","html_url":"https://github.com/rwf2/Rocket/issues/2209","id":1251898240,"node_id":"I_kwDOAzqMt85KnnOA","number":2209,"title":"Add support for diesel 2.0.0","user":{"login":"CuriousCI","id":40034429,"node_id":"MDQ6VXNlcjQwMDM0NDI5","avatar_url":"https://avatars.githubusercontent.com/u/40034429?v=4","gravatar_id":"","url":"https://api.github.com/users/CuriousCI","html_url":"https://github.com/CuriousCI","followers_url":"https://api.github.com/users/CuriousCI/followers","following_url":"https://api.github.com/users/CuriousCI/following{/other_user}","gists_url":"https://api.github.com/users/CuriousCI/gists{/gist_id}","starred_url":"https://api.github.com/users/CuriousCI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CuriousCI/subscriptions","organizations_url":"https://api.github.com/users/CuriousCI/orgs","repos_url":"https://api.github.com/users/CuriousCI/repos","events_url":"https://api.github.com/users/CuriousCI/events{/privacy}","received_events_url":"https://api.github.com/users/CuriousCI/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":758540633,"node_id":"MDU6TGFiZWw3NTg1NDA2MzM=","url":"https://api.github.com/repos/rwf2/Rocket/labels/suggestion","name":"suggestion","color":"5319E7","default":false,"description":"A suggestion to change functionality"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-05-29T14:03:11Z","updated_at":"2022-09-18T08:47:06Z","closed_at":"2022-09-18T08:47:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Existing Functionality**\r\n\r\n`rocket_sync_db_pools` currently relies on `diesel 1.4`, which is going [out of support](https://github.com/diesel-rs/diesel/issues/2348#issuecomment-1140445903), and it's currently giving some problems with `uuid 1.0.0`.\r\n\r\n- `diesel 1.4` supports up to `uuid 0.8` and rocket `0.5.0-rc` has functionalities for `uuid 1.0`, creating a conflict: if I want to use `uuid::Uuid` in the models, I must use version 0.8, but, if I want a uuid in a route, I must use `rocket::serde::uuid::Uuid`, which isn't compatible with the diesel implementation. To handle this problem, I downgraded the uuid version to 0.8, and created a conversion function:\r\n\r\n```rust\r\npub fn to_uuid(id: rocket::serde::uuid::Uuid) -> Result<uuid::Uuid, uuid::Error> {\r\n    Uuid::parse_str(id.to_string().as_str())\r\n}\r\n```\r\n\r\nWhich means I must manually use it everytime I want to use a Uuid in a request_:\r\n\r\n```rust\r\n#[get(\"/<id>\")]\r\npub async fn get_id(id: rocket::serde::uuid::Uuid, db: Db) -> Json<User> {\r\n    let id = to_uuid(id).unwrap();\r\n    \r\n    ...\r\n}\r\n```\r\n- It also means that I have to handle 2 Uuids in my code, which can be confusing in some parts.\r\n- The other problem is that the `1.4.x` won't be supported anymore, so it would be really useful to transition to `2.0.0` as soon as it's ready.\r\n- The current version is missing some of the [new functionalities](https://github.com/diesel-rs/diesel/releases/tag/v2.0.0-rc0) like group by, table aliasing, \"Selectable\" trait, union, intersect and except.\r\n\r\nA clear and concise description of existing functionality and why it is insufficient. Examples:\r\n\r\n**Suggested Changes**\r\n\r\nI still haven't looked at the code to find a solution, and it would still be too soon to upgrade to the new version, as it's not fully ready yet.\r\n\r\n**Alternatives Considered**\r\n\r\nI've tried to implement the `Poolable` trait for `diesel 2.0.0`'s `PgConnection` inside my project, but it's really complex, as I can't directly implement the trait to `diesel::PgConnection` due to the [orphan rule](https://doc.rust-lang.org/book/ch19-03-advanced-traits.html?highlight=orphan#using-the-newtype-pattern-to-implement-external-traits-on-external-types).\r\n\r\n I can implement `Poolable` only if I wrap diesel::PgConnection with a custom struct\r\n```rust\r\npub struct Connection(diesel::PgConnection); \r\n```\r\n\r\nBut I manually have to implement a custom manager, and all the other traits `diesel:PgConnection` uses.\r\n```rust\r\nimpl Poolable for Connection {\r\n    type Manager = ....;\r\n    ...\r\n}\r\n```\r\n\r\n**Additional Context**\r\n\r\n`diesel 2.0.0` it's still not ready, I suggest waiting  before trying to implement anything. I would also be glad to hear some suggestions, or the problems this feature can create.\r\n","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/2209/reactions","total_count":4,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/2209/timeline","performed_via_github_app":null,"state_reason":"completed"}