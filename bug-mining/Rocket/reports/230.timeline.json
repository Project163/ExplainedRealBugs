[{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/860297117","html_url":"https://github.com/rwf2/Rocket/issues/1694#issuecomment-860297117","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1694","id":860297117,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDI5NzExNw==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-14T00:38:37Z","updated_at":"2021-06-14T00:48:03Z","body":"> I wonder if `ErroKind` ought to be marked `#[non_exhaustive]` for future-proofing.\r\n\r\nThis sounds like a good idea. I'm all for it.\r\n\r\n> (Please forgive me if I have missed a way to do this; I looked in the api docs for `form::Error` and `FromFormField` and also the relevant-seeming sections of the guide, searching both for \"form\" and \"error\".)\r\n\r\nThanks for looking at the docs. You're right that it's not possible to set an arbitrary status code today in a `FromForm` for custom errors. Built-in errors have a status code associated with them, however. You can also easily do this in a handler:\r\n\r\n```rust\r\n#[derive(FromForm)]\r\nstruct Foo<'r> {\r\n    field: form::Result<'r, T>\r\n}\r\n\r\n#[post(\"/\", data = \"<form>\")]\r\nfn post(form: Form<Foo<'_>>) -> (Status, T) {\r\n    if form.field.is_err() {\r\n        return (Status::NotFound, T);\r\n    }\r\n\r\n    ...\r\n}\r\n```\r\n\r\nIf you have a responder than implements `From<form::Errors<'r>>`, you can, of course, do:\r\n\r\n```rust\r\n#[post(\"/\", data = \"<form>\")]\r\nfn post(form: Form<Foo<'_>>) -> Result<T, ErrorResponder> {\r\n    let form = form.into_inner();\r\n    let field = form.field?;\r\n    ...\r\n}\r\n```\r\n\r\n> I think the best fix is probably to add a new variant to `ErrorKind`, or to expand `Custom`, something like this:\r\n\r\nLet's say that your `MyType` fails and wants to set a status code of `404` (this is likely semantically wrong, but let's ignore that for now). Additionally, another field fails and wants to set a status code of `413`. Which status code should be set in the response?\r\n\r\nThe current algorithm is to set the `max(all_status_codes)`. This means that the `404` would be lost. If you want to guarantee that the handler returns a specific status code, I see no other solution than for the handler to do something like the two above solutions.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/860297117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/860611017","html_url":"https://github.com/rwf2/Rocket/issues/1694#issuecomment-860611017","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1694","id":860611017,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDYxMTAxNw==","user":{"login":"ijackson","id":2090772,"node_id":"MDQ6VXNlcjIwOTA3NzI=","avatar_url":"https://avatars.githubusercontent.com/u/2090772?v=4","gravatar_id":"","url":"https://api.github.com/users/ijackson","html_url":"https://github.com/ijackson","followers_url":"https://api.github.com/users/ijackson/followers","following_url":"https://api.github.com/users/ijackson/following{/other_user}","gists_url":"https://api.github.com/users/ijackson/gists{/gist_id}","starred_url":"https://api.github.com/users/ijackson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ijackson/subscriptions","organizations_url":"https://api.github.com/users/ijackson/orgs","repos_url":"https://api.github.com/users/ijackson/repos","events_url":"https://api.github.com/users/ijackson/events{/privacy}","received_events_url":"https://api.github.com/users/ijackson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-14T11:28:05Z","updated_at":"2021-06-14T11:28:05Z","body":"> > I wonder if `ErroKind` ought to be marked `#[non_exhaustive]` for future-proofing.\r\n> \r\n> This sounds like a good idea. I'm all for it.\r\n\r\nCool.  I will send a merge request.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/860611017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ijackson","id":2090772,"node_id":"MDQ6VXNlcjIwOTA3NzI=","avatar_url":"https://avatars.githubusercontent.com/u/2090772?v=4","gravatar_id":"","url":"https://api.github.com/users/ijackson","html_url":"https://github.com/ijackson","followers_url":"https://api.github.com/users/ijackson/followers","following_url":"https://api.github.com/users/ijackson/following{/other_user}","gists_url":"https://api.github.com/users/ijackson/gists{/gist_id}","starred_url":"https://api.github.com/users/ijackson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ijackson/subscriptions","organizations_url":"https://api.github.com/users/ijackson/orgs","repos_url":"https://api.github.com/users/ijackson/repos","events_url":"https://api.github.com/users/ijackson/events{/privacy}","received_events_url":"https://api.github.com/users/ijackson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/860618110","html_url":"https://github.com/rwf2/Rocket/issues/1694#issuecomment-860618110","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1694","id":860618110,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDYxODExMA==","user":{"login":"ijackson","id":2090772,"node_id":"MDQ6VXNlcjIwOTA3NzI=","avatar_url":"https://avatars.githubusercontent.com/u/2090772?v=4","gravatar_id":"","url":"https://api.github.com/users/ijackson","html_url":"https://github.com/ijackson","followers_url":"https://api.github.com/users/ijackson/followers","following_url":"https://api.github.com/users/ijackson/following{/other_user}","gists_url":"https://api.github.com/users/ijackson/gists{/gist_id}","starred_url":"https://api.github.com/users/ijackson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ijackson/subscriptions","organizations_url":"https://api.github.com/users/ijackson/orgs","repos_url":"https://api.github.com/users/ijackson/repos","events_url":"https://api.github.com/users/ijackson/events{/privacy}","received_events_url":"https://api.github.com/users/ijackson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-14T11:41:28Z","updated_at":"2021-06-14T11:41:28Z","body":"> ```rust\r\n> #[derive(FromForm)]\r\n> struct Foo<'r> {\r\n>     field: form::Result<'r, T>\r\n> ```\r\n\r\nThanks for this helpful suggestion.  I hadn't thought of this approach, I think because I had forgotten about the impls on `Result.`\r\n\r\nI still think it would be helpful to extend `ErrorKind`.  In particular, the `field: Result` approach pushes more of the error handling logic into the handler, and binds it to the field rather than the type.  That's tolerable but suboptimal, to my taste at least.\r\n\r\n> > I think the best fix is probably to add a new variant to `ErrorKind`, or to expand `Custom`, something like this:\r\n> \r\n> Let's say that your `MyType` fails and wants to set a status code of `404` (this is likely semantically wrong, but let's ignore that for now). Additionally, another field fails and wants to set a status code of `413`. Which status code should be set in the response?\r\n\r\nGood question.\r\n\r\nIn my application, for all of the handlers that would be affected, the answer is either (i) there is only one field or (ii) if there are several errors, we don't care which is returned.\r\n\r\n> The current algorithm is to set the `max(all_status_codes)`. This means that the `404` would be lost. If you want to guarantee that the handler returns a specific status code, I see no other solution than for the handler to do something like the two above solutions.\r\n\r\nRight.\r\n\r\nI think this issue ought to be addressed in documentation, probably the documentation for the `ErrorKind`s that contain a `Status`.\r\n\r\nGiven what you say, ISTM that you probably don't want `Custom` to always carry a `Status`.\r\n\r\nHaving slept on it, my application would like to be able to save a box in this case.  So I think I would now like to suggest:\r\n\r\n```\r\n enum ErrorKind {\r\n+    CustomStatus(Status, Option<Box<dyn Error + Send + 'static>>),\r\n```\r\n\r\nwith appropriate docs including discussion about indeterminacy of the http status in the case of multiple field parsing errors.  The docs could suggest the use of `Result`, too, if finer control is needed.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/860618110/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ijackson","id":2090772,"node_id":"MDQ6VXNlcjIwOTA3NzI=","avatar_url":"https://avatars.githubusercontent.com/u/2090772?v=4","gravatar_id":"","url":"https://api.github.com/users/ijackson","html_url":"https://github.com/ijackson","followers_url":"https://api.github.com/users/ijackson/followers","following_url":"https://api.github.com/users/ijackson/following{/other_user}","gists_url":"https://api.github.com/users/ijackson/gists{/gist_id}","starred_url":"https://api.github.com/users/ijackson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ijackson/subscriptions","organizations_url":"https://api.github.com/users/ijackson/orgs","repos_url":"https://api.github.com/users/ijackson/repos","events_url":"https://api.github.com/users/ijackson/events{/privacy}","received_events_url":"https://api.github.com/users/ijackson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4943456630,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ5NDM0NTY2MzA=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/4943456630","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-06-27T01:35:01Z","label":{"name":"enhancement","color":"84b6eb"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1229188864","html_url":"https://github.com/rwf2/Rocket/issues/1694#issuecomment-1229188864","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1694","id":1229188864,"node_id":"IC_kwDOAzqMt85JQ-8A","user":{"login":"raymclee","id":13248694,"node_id":"MDQ6VXNlcjEzMjQ4Njk0","avatar_url":"https://avatars.githubusercontent.com/u/13248694?v=4","gravatar_id":"","url":"https://api.github.com/users/raymclee","html_url":"https://github.com/raymclee","followers_url":"https://api.github.com/users/raymclee/followers","following_url":"https://api.github.com/users/raymclee/following{/other_user}","gists_url":"https://api.github.com/users/raymclee/gists{/gist_id}","starred_url":"https://api.github.com/users/raymclee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raymclee/subscriptions","organizations_url":"https://api.github.com/users/raymclee/orgs","repos_url":"https://api.github.com/users/raymclee/repos","events_url":"https://api.github.com/users/raymclee/events{/privacy}","received_events_url":"https://api.github.com/users/raymclee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-27T13:01:37Z","updated_at":"2022-08-27T13:01:37Z","body":"I'm using FromForm for get request. and validating the range of the query params.\r\nwhen the validate function return error it just go other next route and return 404. \r\nThe validate error message is logged to console.\r\nIs there a way to catch the error message to show to the user?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1229188864/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"raymclee","id":13248694,"node_id":"MDQ6VXNlcjEzMjQ4Njk0","avatar_url":"https://avatars.githubusercontent.com/u/13248694?v=4","gravatar_id":"","url":"https://api.github.com/users/raymclee","html_url":"https://github.com/raymclee","followers_url":"https://api.github.com/users/raymclee/followers","following_url":"https://api.github.com/users/raymclee/following{/other_user}","gists_url":"https://api.github.com/users/raymclee/gists{/gist_id}","starred_url":"https://api.github.com/users/raymclee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raymclee/subscriptions","organizations_url":"https://api.github.com/users/raymclee/orgs","repos_url":"https://api.github.com/users/raymclee/repos","events_url":"https://api.github.com/users/raymclee/events{/privacy}","received_events_url":"https://api.github.com/users/raymclee/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1492428258","html_url":"https://github.com/rwf2/Rocket/issues/1694#issuecomment-1492428258","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1694","id":1492428258,"node_id":"IC_kwDOAzqMt85Y9KXi","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-31T18:36:22Z","updated_at":"2023-03-31T18:36:22Z","body":"> Is there a way to catch the error message to show to the user?\r\n\r\nYes. Use `form::Result<Form<T>>` instead of just `Form<T>`. Or use a `Result` for each field. Or `Option` if you don't care about what happened and just want to know something went wrong.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1492428258/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8937474250,"node_id":"CE_lADOAzqMt84205PTzwAAAAIUtwjK","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/8937474250","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"03433c10ea77ffc3e1a89821063f8643efdf9a1f","commit_url":"https://api.github.com/repos/rwf2/Rocket/commits/03433c10ea77ffc3e1a89821063f8643efdf9a1f","created_at":"2023-04-05T17:02:09Z","state_reason":null,"performed_via_github_app":null},{"id":11603836841,"node_id":"REFE_lADOAzqMt84205PTzwAAAAKzpH-p","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/11603836841","actor":{"login":"pull[bot]","id":39814207,"node_id":"MDM6Qm90Mzk4MTQyMDc=","avatar_url":"https://avatars.githubusercontent.com/in/12910?v=4","gravatar_id":"","url":"https://api.github.com/users/pull%5Bbot%5D","html_url":"https://github.com/apps/pull","followers_url":"https://api.github.com/users/pull%5Bbot%5D/followers","following_url":"https://api.github.com/users/pull%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/pull%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/pull%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pull%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/pull%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/pull%5Bbot%5D/repos","events_url":"https://api.github.com/users/pull%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/pull%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"03433c10ea77ffc3e1a89821063f8643efdf9a1f","commit_url":"https://api.github.com/repos/Necmttn/Rocket/commits/03433c10ea77ffc3e1a89821063f8643efdf9a1f","created_at":"2024-01-26T01:03:11Z","performed_via_github_app":null}]