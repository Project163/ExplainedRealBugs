[{"id":5174236541,"node_id":"MDEyOkxhYmVsZWRFdmVudDUxNzQyMzY1NDE=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5174236541","actor":{"login":"ZoeyR","id":8010244,"node_id":"MDQ6VXNlcjgwMTAyNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/8010244?v=4","gravatar_id":"","url":"https://api.github.com/users/ZoeyR","html_url":"https://github.com/ZoeyR","followers_url":"https://api.github.com/users/ZoeyR/followers","following_url":"https://api.github.com/users/ZoeyR/following{/other_user}","gists_url":"https://api.github.com/users/ZoeyR/gists{/gist_id}","starred_url":"https://api.github.com/users/ZoeyR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZoeyR/subscriptions","organizations_url":"https://api.github.com/users/ZoeyR/orgs","repos_url":"https://api.github.com/users/ZoeyR/repos","events_url":"https://api.github.com/users/ZoeyR/events{/privacy}","received_events_url":"https://api.github.com/users/ZoeyR/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-08-18T11:29:32Z","label":{"name":"triage","color":"f9d0c4"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/901049993","html_url":"https://github.com/rwf2/Rocket/issues/1831#issuecomment-901049993","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1831","id":901049993,"node_id":"IC_kwDOAzqMt841tO6J","user":{"login":"a-nickol","id":10565211,"node_id":"MDQ6VXNlcjEwNTY1MjEx","avatar_url":"https://avatars.githubusercontent.com/u/10565211?v=4","gravatar_id":"","url":"https://api.github.com/users/a-nickol","html_url":"https://github.com/a-nickol","followers_url":"https://api.github.com/users/a-nickol/followers","following_url":"https://api.github.com/users/a-nickol/following{/other_user}","gists_url":"https://api.github.com/users/a-nickol/gists{/gist_id}","starred_url":"https://api.github.com/users/a-nickol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a-nickol/subscriptions","organizations_url":"https://api.github.com/users/a-nickol/orgs","repos_url":"https://api.github.com/users/a-nickol/repos","events_url":"https://api.github.com/users/a-nickol/events{/privacy}","received_events_url":"https://api.github.com/users/a-nickol/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-18T11:53:15Z","updated_at":"2021-08-18T11:54:18Z","body":"The `panic!` error message  comes from a `debug_assert!` which validates that the URL is valid. \r\n\r\nIn a production build this assert is skipped and a 404 error screen is shown. \r\n\r\nMaybe it would be better not to use an assert, but give more details what the problem is in debug-mode, using an additional error message and just proceed like in production-mode? ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/901049993/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"a-nickol","id":10565211,"node_id":"MDQ6VXNlcjEwNTY1MjEx","avatar_url":"https://avatars.githubusercontent.com/u/10565211?v=4","gravatar_id":"","url":"https://api.github.com/users/a-nickol","html_url":"https://github.com/a-nickol","followers_url":"https://api.github.com/users/a-nickol/followers","following_url":"https://api.github.com/users/a-nickol/following{/other_user}","gists_url":"https://api.github.com/users/a-nickol/gists{/gist_id}","starred_url":"https://api.github.com/users/a-nickol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a-nickol/subscriptions","organizations_url":"https://api.github.com/users/a-nickol/orgs","repos_url":"https://api.github.com/users/a-nickol/repos","events_url":"https://api.github.com/users/a-nickol/events{/privacy}","received_events_url":"https://api.github.com/users/a-nickol/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/901053454","html_url":"https://github.com/rwf2/Rocket/issues/1831#issuecomment-901053454","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1831","id":901053454,"node_id":"IC_kwDOAzqMt841tPwO","user":{"login":"ZoeyR","id":8010244,"node_id":"MDQ6VXNlcjgwMTAyNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/8010244?v=4","gravatar_id":"","url":"https://api.github.com/users/ZoeyR","html_url":"https://github.com/ZoeyR","followers_url":"https://api.github.com/users/ZoeyR/followers","following_url":"https://api.github.com/users/ZoeyR/following{/other_user}","gists_url":"https://api.github.com/users/ZoeyR/gists{/gist_id}","starred_url":"https://api.github.com/users/ZoeyR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZoeyR/subscriptions","organizations_url":"https://api.github.com/users/ZoeyR/orgs","repos_url":"https://api.github.com/users/ZoeyR/repos","events_url":"https://api.github.com/users/ZoeyR/events{/privacy}","received_events_url":"https://api.github.com/users/ZoeyR/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-18T11:59:27Z","updated_at":"2021-08-18T11:59:27Z","body":"Even debug asserts indicate that some assumption is made in the code, and since that assert is failing it indicates that an assumption is wrong. There is this comment near the assertion:\r\n```rust\r\n// In debug, make sure we agree with Hyper. Otherwise, cross our fingers\r\n// and trust that it only gives us valid URIs like it's supposed to.\r\n```\r\nI don't think we should be \"crossing our fingers\" for production.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/901053454/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ZoeyR","id":8010244,"node_id":"MDQ6VXNlcjgwMTAyNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/8010244?v=4","gravatar_id":"","url":"https://api.github.com/users/ZoeyR","html_url":"https://github.com/ZoeyR","followers_url":"https://api.github.com/users/ZoeyR/followers","following_url":"https://api.github.com/users/ZoeyR/following{/other_user}","gists_url":"https://api.github.com/users/ZoeyR/gists{/gist_id}","starred_url":"https://api.github.com/users/ZoeyR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZoeyR/subscriptions","organizations_url":"https://api.github.com/users/ZoeyR/orgs","repos_url":"https://api.github.com/users/ZoeyR/repos","events_url":"https://api.github.com/users/ZoeyR/events{/privacy}","received_events_url":"https://api.github.com/users/ZoeyR/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/901301138","html_url":"https://github.com/rwf2/Rocket/issues/1831#issuecomment-901301138","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1831","id":901301138,"node_id":"IC_kwDOAzqMt841uMOS","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-18T17:35:40Z","updated_at":"2021-08-18T17:35:40Z","body":"`/[` is not a valid target URI. This is a bug in hyper that's being detected by Rocket. I'm certain that there are many more like this.\r\n\r\nDespite its claims, hyper's correctness is an ongoing challenge for Rocket (see #17) which will likely see us moving away from hyper before a 1.0 release. Rocket works around such issues where it can; this is one such case. We implement our own URI parser because we don't trust hyper's. What you're seeing is a failing cross-validation check that was put in place to detect disagreements between hyper and Rocket. In this case, Hyper is wrong.\r\n\r\n> Even debug asserts indicate that some assumption is made in the code, and since that assert is failing it indicates that an assumption is wrong.\r\n\r\nThis isn't a precise enough analysis of what's going on with this `debug_assert!`, the details of which I've already commented on above. It isn't so much that an assumption is wrong - this particular failure isn't going to lead to any issues downstream - but that we've caught a bug in hyper.\r\n\r\n> I don't think we should be \"crossing our fingers\" for production.\r\n\r\nThis comment should be taken tongue-in-cheek, not literally. We take security seriously (hence why we have our own, heavily tested, URI parser), so this \"crossing our fingers\" is an allusion to the fact that we _know_ hyper may be wrong but that even if it is, it's extremely unlikely to cause issues in this case. We'd still like to detect them. After all, if hyper is [_really_ wrong](https://github.com/hyperium/hyper/issues?q=is%3Aissue+is%3Aopen+label%3AS-bug), you're liable to have lots of issues that Rocket simply can't ever hope to work-around while keeping hyper around.\r\n\r\nIn all, I see a few paths forward:\r\n\r\n  1. Close this issue, open one in `hyper`. Perhaps add a message to the debug assert explaining the assertion.\r\n  2. Always check to see if Rocket believes the URI is valid. If it isn't, return a 400. This has a performance penalty, of course.\r\n  3. Do nothing.\r\n\r\nI'm inclined to go with 1.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/901301138/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5176255748,"node_id":"MDE0OlVubGFiZWxlZEV2ZW50NTE3NjI1NTc0OA==","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5176255748","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2021-08-18T17:36:01Z","label":{"name":"triage","color":"f9d0c4"},"performed_via_github_app":null},{"id":5176255752,"node_id":"MDEyOkxhYmVsZWRFdmVudDUxNzYyNTU3NTI=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5176255752","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-08-18T17:36:01Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":5176255754,"node_id":"MDEyOkxhYmVsZWRFdmVudDUxNzYyNTU3NTQ=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5176255754","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-08-18T17:36:01Z","label":{"name":"upstream","color":"0052cc"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/901762378","html_url":"https://github.com/rwf2/Rocket/issues/1831#issuecomment-901762378","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1831","id":901762378,"node_id":"IC_kwDOAzqMt841v81K","user":{"login":"ZoeyR","id":8010244,"node_id":"MDQ6VXNlcjgwMTAyNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/8010244?v=4","gravatar_id":"","url":"https://api.github.com/users/ZoeyR","html_url":"https://github.com/ZoeyR","followers_url":"https://api.github.com/users/ZoeyR/followers","following_url":"https://api.github.com/users/ZoeyR/following{/other_user}","gists_url":"https://api.github.com/users/ZoeyR/gists{/gist_id}","starred_url":"https://api.github.com/users/ZoeyR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZoeyR/subscriptions","organizations_url":"https://api.github.com/users/ZoeyR/orgs","repos_url":"https://api.github.com/users/ZoeyR/repos","events_url":"https://api.github.com/users/ZoeyR/events{/privacy}","received_events_url":"https://api.github.com/users/ZoeyR/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-19T09:33:19Z","updated_at":"2021-08-19T09:33:19Z","body":"I'm wondering if there is some disagreement with the whatwg URL spec and the current reality of what is allowed. I did some testing of what characters browsers will automatically percent-encode, and what they wont. It seems that chromium, firefox, and internet explorer all consider `[` to not need percent encoding, even though its not allowed in the whatwg spec. I also found via https://github.com/seanmonstar/reqwest/issues/442 that it is apparently not unheard of for URL proxies to include `^` in their URL. Perhaps rocket needs to relax its allowed characters?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/901762378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ZoeyR","id":8010244,"node_id":"MDQ6VXNlcjgwMTAyNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/8010244?v=4","gravatar_id":"","url":"https://api.github.com/users/ZoeyR","html_url":"https://github.com/ZoeyR","followers_url":"https://api.github.com/users/ZoeyR/followers","following_url":"https://api.github.com/users/ZoeyR/following{/other_user}","gists_url":"https://api.github.com/users/ZoeyR/gists{/gist_id}","starred_url":"https://api.github.com/users/ZoeyR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZoeyR/subscriptions","organizations_url":"https://api.github.com/users/ZoeyR/orgs","repos_url":"https://api.github.com/users/ZoeyR/repos","events_url":"https://api.github.com/users/ZoeyR/events{/privacy}","received_events_url":"https://api.github.com/users/ZoeyR/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/902348471","html_url":"https://github.com/rwf2/Rocket/issues/1831#issuecomment-902348471","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1831","id":902348471,"node_id":"IC_kwDOAzqMt841yL63","user":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-20T00:49:18Z","updated_at":"2021-08-20T00:49:18Z","body":"> I'm wondering if there is some disagreement with the whatwg URL spec and the current reality of what is allowed.\r\n\r\nYes, this is the case with several major browsers - and it turns out there is an open issue about `[` and some other characters in the WHATWG URL repo: https://github.com/whatwg/url/issues/379 . Firefox actually changed this on purpose 6 years ago because it was the only browser that *was* encoding them, for the sake of consistency: <https://bugzilla.mozilla.org/show_bug.cgi?id=1163028>.\r\n\r\n> Perhaps rocket needs to relax its allowed characters?\r\n\r\nYeah, maybe. It's really unfortunate that it's not possible to validate input against any of the current specifications and also be compatible with the behavior of major browsers. In principle I expect at least WHATWG to eventually match up with browsers, but I don't see a lot of recent interest/progress on this particular point.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/902348471/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"IniterWorker","id":7583643,"node_id":"MDQ6VXNlcjc1ODM2NDM=","avatar_url":"https://avatars.githubusercontent.com/u/7583643?v=4","gravatar_id":"","url":"https://api.github.com/users/IniterWorker","html_url":"https://github.com/IniterWorker","followers_url":"https://api.github.com/users/IniterWorker/followers","following_url":"https://api.github.com/users/IniterWorker/following{/other_user}","gists_url":"https://api.github.com/users/IniterWorker/gists{/gist_id}","starred_url":"https://api.github.com/users/IniterWorker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IniterWorker/subscriptions","organizations_url":"https://api.github.com/users/IniterWorker/orgs","repos_url":"https://api.github.com/users/IniterWorker/repos","events_url":"https://api.github.com/users/IniterWorker/events{/privacy}","received_events_url":"https://api.github.com/users/IniterWorker/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-19T02:14:53Z","updated_at":"2021-12-19T02:14:53Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1994","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/1994/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/1994/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/1994/events","html_url":"https://github.com/rwf2/Rocket/issues/1994","id":1064434751,"node_id":"I_kwDOAzqMt84_cfw_","number":1994,"title":"Malformed HTTP/2 may cause 'assertion failed'","user":{"login":"heikki-heikkila","id":95013865,"node_id":"U_kgDOBanL6Q","avatar_url":"https://avatars.githubusercontent.com/u/95013865?v=4","gravatar_id":"","url":"https://api.github.com/users/heikki-heikkila","html_url":"https://github.com/heikki-heikkila","followers_url":"https://api.github.com/users/heikki-heikkila/followers","following_url":"https://api.github.com/users/heikki-heikkila/following{/other_user}","gists_url":"https://api.github.com/users/heikki-heikkila/gists{/gist_id}","starred_url":"https://api.github.com/users/heikki-heikkila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/heikki-heikkila/subscriptions","organizations_url":"https://api.github.com/users/heikki-heikkila/orgs","repos_url":"https://api.github.com/users/heikki-heikkila/repos","events_url":"https://api.github.com/users/heikki-heikkila/events{/privacy}","received_events_url":"https://api.github.com/users/heikki-heikkila/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":343542064,"node_id":"MDU6TGFiZWwzNDM1NDIwNjQ=","url":"https://api.github.com/repos/rwf2/Rocket/labels/bug","name":"bug","color":"B60205","default":true,"description":"Deviation from the specification or expected behavior"},{"id":567172509,"node_id":"MDU6TGFiZWw1NjcxNzI1MDk=","url":"https://api.github.com/repos/rwf2/Rocket/labels/upstream","name":"upstream","color":"cfd3d7","default":false,"description":"An unresolvable issue: an upstream dependency bug"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2021-11-26T12:43:55Z","updated_at":"2022-04-28T02:38:27Z","closed_at":"2022-04-28T02:38:26Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":54168759,"node_id":"MDEwOlJlcG9zaXRvcnk1NDE2ODc1OQ==","name":"Rocket","full_name":"rwf2/Rocket","private":false,"owner":{"login":"rwf2","id":106361765,"node_id":"O_kgDOBlbzpQ","avatar_url":"https://avatars.githubusercontent.com/u/106361765?v=4","gravatar_id":"","url":"https://api.github.com/users/rwf2","html_url":"https://github.com/rwf2","followers_url":"https://api.github.com/users/rwf2/followers","following_url":"https://api.github.com/users/rwf2/following{/other_user}","gists_url":"https://api.github.com/users/rwf2/gists{/gist_id}","starred_url":"https://api.github.com/users/rwf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rwf2/subscriptions","organizations_url":"https://api.github.com/users/rwf2/orgs","repos_url":"https://api.github.com/users/rwf2/repos","events_url":"https://api.github.com/users/rwf2/events{/privacy}","received_events_url":"https://api.github.com/users/rwf2/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rwf2/Rocket","description":"A web framework for Rust.","fork":false,"url":"https://api.github.com/repos/rwf2/Rocket","forks_url":"https://api.github.com/repos/rwf2/Rocket/forks","keys_url":"https://api.github.com/repos/rwf2/Rocket/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rwf2/Rocket/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rwf2/Rocket/teams","hooks_url":"https://api.github.com/repos/rwf2/Rocket/hooks","issue_events_url":"https://api.github.com/repos/rwf2/Rocket/issues/events{/number}","events_url":"https://api.github.com/repos/rwf2/Rocket/events","assignees_url":"https://api.github.com/repos/rwf2/Rocket/assignees{/user}","branches_url":"https://api.github.com/repos/rwf2/Rocket/branches{/branch}","tags_url":"https://api.github.com/repos/rwf2/Rocket/tags","blobs_url":"https://api.github.com/repos/rwf2/Rocket/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rwf2/Rocket/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rwf2/Rocket/git/refs{/sha}","trees_url":"https://api.github.com/repos/rwf2/Rocket/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rwf2/Rocket/statuses/{sha}","languages_url":"https://api.github.com/repos/rwf2/Rocket/languages","stargazers_url":"https://api.github.com/repos/rwf2/Rocket/stargazers","contributors_url":"https://api.github.com/repos/rwf2/Rocket/contributors","subscribers_url":"https://api.github.com/repos/rwf2/Rocket/subscribers","subscription_url":"https://api.github.com/repos/rwf2/Rocket/subscription","commits_url":"https://api.github.com/repos/rwf2/Rocket/commits{/sha}","git_commits_url":"https://api.github.com/repos/rwf2/Rocket/git/commits{/sha}","comments_url":"https://api.github.com/repos/rwf2/Rocket/comments{/number}","issue_comment_url":"https://api.github.com/repos/rwf2/Rocket/issues/comments{/number}","contents_url":"https://api.github.com/repos/rwf2/Rocket/contents/{+path}","compare_url":"https://api.github.com/repos/rwf2/Rocket/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rwf2/Rocket/merges","archive_url":"https://api.github.com/repos/rwf2/Rocket/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rwf2/Rocket/downloads","issues_url":"https://api.github.com/repos/rwf2/Rocket/issues{/number}","pulls_url":"https://api.github.com/repos/rwf2/Rocket/pulls{/number}","milestones_url":"https://api.github.com/repos/rwf2/Rocket/milestones{/number}","notifications_url":"https://api.github.com/repos/rwf2/Rocket/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rwf2/Rocket/labels{/name}","releases_url":"https://api.github.com/repos/rwf2/Rocket/releases{/id}","deployments_url":"https://api.github.com/repos/rwf2/Rocket/deployments","created_at":"2016-03-18T02:50:18Z","updated_at":"2025-11-09T18:27:08Z","pushed_at":"2025-10-01T04:53:46Z","git_url":"git://github.com/rwf2/Rocket.git","ssh_url":"git@github.com:rwf2/Rocket.git","clone_url":"https://github.com/rwf2/Rocket.git","svn_url":"https://github.com/rwf2/Rocket","homepage":"https://rocket.rs","size":8445,"stargazers_count":25480,"watchers_count":25480,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":1614,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":84,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["framework","rocket","rust","web","web-development","web-framework"],"visibility":"public","forks":1614,"open_issues":84,"watchers":25480,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"\r\n**Description**\r\n\r\nWith a certain malformed HTTP request, a HTTP server that runs Rocket will panic with 'assertion failed' (details below).  The whole HTTP server does not crash, however; the server SW catches the panic and keeps running.\r\n\r\nThis should be seen as a bug, because 'assertion failed' should never happen in production software.\r\n\r\n**To Reproduce**\r\n\r\nThe issue can be reproduced in a crate with three files, src/server.rs, src/client.rs and Cargo.toml, as follows.  See instructions after the file listings.\r\n\r\n// server.rs\r\n// A very simple textbook server\r\n\r\n// Instructions for use:\r\n// Run \"cargo run --bin http_server\" in one command window.  The HTTP\r\n// server starts and waits for requests.\r\n// In another command window, run \"cargo run --bin http_client\".  The client\r\n// should send one query to the server and print the outcome.\r\n\r\n// The server runs in debug mode and prints useful diagnostics to the\r\n// terminal screen.\r\n\r\n#[macro_use] extern crate rocket;\r\n\r\n#[get(\"/world\")]\r\nfn world() -> &'static str {\r\n    \"Hello, world!\"\r\n}\r\n\r\n#[launch]\r\nfn rocket() -> _ {\r\n    rocket::build().mount(\"/hello\", routes![world])\r\n}\r\n// end of file server.rs\r\n\r\n// client.rs\r\n// A very simple HTTP client that produces an invalid HTTP request.\r\n// In \"path and query\", where slash '/' is supposed to be a separator,\r\n// we do erroneous percent encoding \"/\" -> \"%2F\", just to see what the\r\n// HTTP server does.\r\n\r\n// Instructions for use:\r\n// Run \"cargo run --bin http_server\" in one command window.  The HTTP\r\n// server starts and waits for requests.\r\n// In another command window, run \"cargo run --bin http_client\".  The client\r\n// should send one query to the server and print the outcome.\r\n\r\n#[tokio::main]\r\n\r\nasync fn main() {\r\n\r\n    // create the http client system\r\n    let client : hyper::Client<hyper::client::connect::HttpConnector> =\r\n                    hyper::Client::builder()\r\n                      .http2_only(true)\r\n                      .build_http();\r\n\r\n    let uri = if let Ok(x)=\r\n                            http::uri::Builder::new()\r\n                                .scheme(\"http\")\r\n                                .authority(\"127.0.0.1:8000\")\r\n                                 // the correct string would be\r\n                                 // \"/hello/world\":\r\n                                .path_and_query(\"%2Fhello%2Fworld\")\r\n                                .build()\r\n              { x } else { return; };\r\n\r\n    let req : http::request::Request<hyper::body::Body> =\r\n              if let Ok(x) =\r\n                            hyper::Request::builder()\r\n                                .method(http::method::Method::GET)\r\n                                .uri(uri)\r\n                                .body(hyper::body::Body::from(\"\"))\r\n              { x } else { return; };\r\n\r\n    match client.clone().request(req).await {\r\n        Ok(x) => {\r\n            println!(\"Success {:?}\", x);\r\n        }\r\n        Err(e) => {\r\n            println!(\"Failure {:?}\", e);\r\n        }\r\n    }\r\n}\r\n// end of file client.rs\r\n\r\n# Cargo.toml\r\n[package]\r\nname = \"http_panic_test\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\nauthors = [\"H. Heikkil√§\"]\r\ndescription = \"Test panic condition in Rocket HTTP server\"\r\n\r\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\r\n\r\n[dependencies]\r\nhttp = \"0.2.5\"\r\nmac_address = \"1.1.2\"\r\nrocket = \"0.5.0-rc.1\"\r\nfutures = \"0.3\"\r\nhyper = { version = \"0.14.13\", features = [\r\n            \"http2\", \"server\", \"client\", \"tcp\" ] }\r\ntokio = { version = \"1.12.0\", features = [\r\n            \"sync\", \"rt\", \"net\", \"time\"  ] }\r\n\r\n[[bin]]\r\nname = \"http_server\"\r\npath = \"src/server.rs\"\r\n\r\n[[bin]]\r\nname = \"http_client\"\r\npath = \"src/client.rs\"\r\n\r\n# end of Cargo.toml\r\n\r\nInstructions for reproducing the issue:\r\n\r\n1. Set up a cargo crate with files ./src/server.rs, ./src/client.rs and ./Cargo.toml\r\n\r\n2. Build SW as usual:  cargo build\r\n\r\n3. Open one command window and do \"cargo run --bin http_server\".  This starts an HTTP server, which starts waiting for requests.  (The server reserves socket address 128.0.0.1:8000.)\r\n\r\n4. Open another command window and do \"cargo run --bin http_client\".  This runs an HTTP client, which sends one request towards the HTTP server.\r\n\r\n5. In the HTTP server window, a message like the following is seen:\r\n\r\nthread 'rocket-worker-thread' panicked at 'assertion failed: Origin::parse(uri.as_str()).is_ok()', . . . cache/registry/src/github.com-1ecc6299db9ec823/rocket-0.5.0-rc.1/src/request/request.rs:846:9\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\n**Expected Behavior**\r\n\r\nI expect that HTTP servers are robust, so that 'assertion failed' never happens, even if the HTTP request message is malformed or perhaps even malicious.  (Admittedly, the HTTP server catches the assertion gracefully.)\r\n\r\n**Environment:**\r\n\r\n - OS Distribution and Kernel: Linux ubuntu-14-04\r\n - Rocket Version: 0.5.0-rc.1\r\n\r\n**Additional Context**\r\n\r\nI discovered this behaviour by chance.  I was doing percent encoding to HTTP request in client SW -- which is required in some cases -- but erroneously applied percent encoding to the slash separators.","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1994/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/1994/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1059677192","html_url":"https://github.com/rwf2/Rocket/issues/1831#issuecomment-1059677192","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1831","id":1059677192,"node_id":"IC_kwDOAzqMt84_KWQI","user":{"login":"ta32","id":26617779,"node_id":"MDQ6VXNlcjI2NjE3Nzc5","avatar_url":"https://avatars.githubusercontent.com/u/26617779?v=4","gravatar_id":"","url":"https://api.github.com/users/ta32","html_url":"https://github.com/ta32","followers_url":"https://api.github.com/users/ta32/followers","following_url":"https://api.github.com/users/ta32/following{/other_user}","gists_url":"https://api.github.com/users/ta32/gists{/gist_id}","starred_url":"https://api.github.com/users/ta32/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ta32/subscriptions","organizations_url":"https://api.github.com/users/ta32/orgs","repos_url":"https://api.github.com/users/ta32/repos","events_url":"https://api.github.com/users/ta32/events{/privacy}","received_events_url":"https://api.github.com/users/ta32/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-05T03:54:05Z","updated_at":"2022-03-05T03:54:40Z","body":"I was implementing a web proxy server for a website and my app was crashing in debug mode because one of the request has '[' in it. However it works on my browser and in release mode. \r\n\r\nIs it ok to remove the debug assert and replace it with a warn or error log instead? ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1059677192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ta32","id":26617779,"node_id":"MDQ6VXNlcjI2NjE3Nzc5","avatar_url":"https://avatars.githubusercontent.com/u/26617779?v=4","gravatar_id":"","url":"https://api.github.com/users/ta32","html_url":"https://github.com/ta32","followers_url":"https://api.github.com/users/ta32/followers","following_url":"https://api.github.com/users/ta32/following{/other_user}","gists_url":"https://api.github.com/users/ta32/gists{/gist_id}","starred_url":"https://api.github.com/users/ta32/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ta32/subscriptions","organizations_url":"https://api.github.com/users/ta32/orgs","repos_url":"https://api.github.com/users/ta32/repos","events_url":"https://api.github.com/users/ta32/events{/privacy}","received_events_url":"https://api.github.com/users/ta32/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6511449832,"node_id":"RTE_lADOAzqMt846B2u2zwAAAAGEHNbo","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/6511449832","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2022-04-28T02:37:52Z","rename":{"from":"Worker thread panic when visiting http://localhost:8000/[","to":"Debug assertion panics due to invalid URIs from upstream Hyper"},"performed_via_github_app":null},{"id":6545426843,"node_id":"MIE_lADOAzqMt846B2u2zwAAAAGGI0mb","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/6545426843","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2022-05-04T01:52:30Z","milestone":{"title":"0.5.0"},"performed_via_github_app":null},{"id":6550188634,"node_id":"CE_lADOAzqMt846B2u2zwAAAAGGa_Ja","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/6550188634","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"1586ef95721322936c80203411689a63877caf14","commit_url":"https://api.github.com/repos/rwf2/Rocket/commits/1586ef95721322936c80203411689a63877caf14","created_at":"2022-05-04T16:44:38Z","state_reason":null,"performed_via_github_app":null},{"id":11603836600,"node_id":"REFE_lADOAzqMt846B2u2zwAAAAKzpH64","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/11603836600","actor":{"login":"pull[bot]","id":39814207,"node_id":"MDM6Qm90Mzk4MTQyMDc=","avatar_url":"https://avatars.githubusercontent.com/in/12910?v=4","gravatar_id":"","url":"https://api.github.com/users/pull%5Bbot%5D","html_url":"https://github.com/apps/pull","followers_url":"https://api.github.com/users/pull%5Bbot%5D/followers","following_url":"https://api.github.com/users/pull%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/pull%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/pull%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pull%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/pull%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/pull%5Bbot%5D/repos","events_url":"https://api.github.com/users/pull%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/pull%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1586ef95721322936c80203411689a63877caf14","commit_url":"https://api.github.com/repos/Necmttn/Rocket/commits/1586ef95721322936c80203411689a63877caf14","created_at":"2024-01-26T01:03:08Z","performed_via_github_app":null}]