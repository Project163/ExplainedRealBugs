{"url":"https://api.github.com/repos/rwf2/Rocket/issues/2731","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/2731/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/2731/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/2731/events","html_url":"https://github.com/rwf2/Rocket/issues/2731","id":2143164324,"node_id":"I_kwDOAzqMt85_vhek","number":2731,"title":"Allow routes that match any method","user":{"login":"palant","id":374261,"node_id":"MDQ6VXNlcjM3NDI2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/374261?v=4","gravatar_id":"","url":"https://api.github.com/users/palant","html_url":"https://github.com/palant","followers_url":"https://api.github.com/users/palant/followers","following_url":"https://api.github.com/users/palant/following{/other_user}","gists_url":"https://api.github.com/users/palant/gists{/gist_id}","starred_url":"https://api.github.com/users/palant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/palant/subscriptions","organizations_url":"https://api.github.com/users/palant/orgs","repos_url":"https://api.github.com/users/palant/repos","events_url":"https://api.github.com/users/palant/events{/privacy}","received_events_url":"https://api.github.com/users/palant/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":442152232,"node_id":"MDU6TGFiZWw0NDIxNTIyMzI=","url":"https://api.github.com/repos/rwf2/Rocket/labels/request","name":"request","color":"5319E7","default":false,"description":"Request for new functionality"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2024-02-19T21:26:07Z","updated_at":"2024-08-24T11:13:44Z","closed_at":"2024-08-24T11:13:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What's missing?\n\nThere are some scenarios which currently require cloning a route multiple times to make sure each and every method is accepted. For me these scenarios are at the very least:\r\n\r\n* HTTP -> HTTPS redirector\r\n* Proxying requests to another server (not redirecting because it isn’t accessible from the web)\r\n* Internal redirects (modifying a request and dispatching it, making sure it’s processed elsewhere in the app)\n\n### Ideal Solution\n\nFrom the look of it, the following changes should suffice:\r\n\r\n* Change type of `Route::method` into `MethodSet`, an alias for `enumset<Method>`. This should allow most of the existing code to work without changes.\r\n* Add `#[any(…)]` attribute macro – essentially identical to `#[get(…)]` but setting `Route::method` to `MethodSet::all()`.\r\n* Modify `#[route(…)]` attribute macro to accept multiple methods: `#[route(GET | POST, …)]`.\r\n* Modify `#[route(…)]` attribute macro to accept the special keyword `ANY` as method parameter meaning `MethodSet::all()`. An alternative approach would making the method optional here and default to `MethodSet::all()` but personally I’d rather have things explicit.\r\n* Modify `Route::matches()` implementation, this change is trivial. From what I can tell, Rocket doesn’t optimize route matching, so the only changes required otherwise should be some logging code.\r\n\r\nI should be able to create a PR if this approach is approved.\n\n### Why can't this be implemented outside of Rocket?\n\nCreating attribute macros to mimic those built into Rocket would require considerable complexity (duplication of logic). Also, it would still require creating an excessive number of routes in this scenario.\n\n### Are there workarounds usable today?\n\nThis limitation can certainly be worked around, see redirector in the TLS example in this repository. The work-around there is heavy on boilerplate however instead of using the usual descriptive approach of Rocket.\r\n\r\nMy work-around does slightly better:\r\n\r\n```rust\r\n#[rocket::get(\"/<_..>\")]\r\nasync fn redirect(\r\n    config: &State<Config>,\r\n    host: &Host<'_>,\r\n    uri: &Origin<'_>,\r\n) -> Result<Redirect, Status> {\r\n    …\r\n}\r\n\r\nlet redirects = [Get, Put, Post, Delete, Options, Head, Trace, Connect, Patch]\r\n    .into_iter()\r\n    .map(|m| {\r\n        let mut route: Route = rocket::routes![redirect].remove(0);\r\n        route.method = m;\r\n        route\r\n    })\r\n    .collect::<Vec<_>>();\r\n```\r\n\r\nHowever, this still creates nine routes instead of one. If nothing else, this has an impact on performance.\r\n\r\nAlso, this *looks* like a route for the GET method, simply because I have to specify some method. This makes code harder to read, the intent behind this route is no longer obvious on the first glance and has to be deduced from context.\n\n### Alternative Solutions\n\nRather than working with sets of methods, it would be possible to define a special `Any` method. The result would be largely the same, only without routes supporting a subset of all methods.\n\n### Additional Context\n\n_No response_\n\n### System Checks\n\n- [X] I do not believe that this feature can or should be implemented outside of Rocket.\n- [X] I was unable to find a previous request for this feature.","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/2731/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/2731/timeline","performed_via_github_app":null,"state_reason":"completed"}