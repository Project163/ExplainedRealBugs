{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1117","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/1117/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/1117/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/1117/events","html_url":"https://github.com/rwf2/Rocket/issues/1117","id":489344960,"node_id":"MDU6SXNzdWU0ODkzNDQ5NjA=","number":1117,"title":"Tracking Issue for Asynchronous Database Pool Support","user":{"login":"githubaccount624","id":20170894,"node_id":"MDQ6VXNlcjIwMTcwODk0","avatar_url":"https://avatars.githubusercontent.com/u/20170894?v=4","gravatar_id":"","url":"https://api.github.com/users/githubaccount624","html_url":"https://github.com/githubaccount624","followers_url":"https://api.github.com/users/githubaccount624/followers","following_url":"https://api.github.com/users/githubaccount624/following{/other_user}","gists_url":"https://api.github.com/users/githubaccount624/gists{/gist_id}","starred_url":"https://api.github.com/users/githubaccount624/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/githubaccount624/subscriptions","organizations_url":"https://api.github.com/users/githubaccount624/orgs","repos_url":"https://api.github.com/users/githubaccount624/repos","events_url":"https://api.github.com/users/githubaccount624/events{/privacy}","received_events_url":"https://api.github.com/users/githubaccount624/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":442152232,"node_id":"MDU6TGFiZWw0NDIxNTIyMzI=","url":"https://api.github.com/repos/rwf2/Rocket/labels/request","name":"request","color":"5319E7","default":false,"description":"Request for new functionality"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":23,"created_at":"2019-09-04T19:16:10Z","updated_at":"2021-07-18T21:10:35Z","closed_at":"2021-07-18T21:10:35Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Why?\r\n\r\nCreating a database connection can be an expensive operation. Connection pools can alleviate this and serve as an important performance optimization for web servers. The current connection pool in Rocket is synchronous. It would be desirable to have support for an asynchronous connection pool in the up-and-coming async Rocket.\r\n\r\n## How?\r\n\r\njebrosen elaborates in [this issue reply](https://github.com/SergioBenitez/Rocket/issues/1065#issuecomment-518480660). One of the main blockers is that Rocket and the database engine should first run within the same runtime (tokio 0.1 or tokio 0.2). This seems partially resolved as the async branch of [tokio-postgres](https://github.com/sfackler/rust-postgres/tree/std-futures/tokio-postgres) and [Rocket](https://github.com/SergioBenitez/Rocket/tree/async) are both currently using `tokio=0.2.0-alpha.4`.\r\n\r\nJeb's second point is that `connect` may be an asynchronous operation and whether or not `FromRequest` should return a `Future`. Connecting to a database can sometimes take 50+ milliseconds and `tokio-postgres` has already made `connect` an asynchronous operation, so it seems like a safe bet to accommodate this fact.\r\n\r\nI'll just paste the rest of Jeb's minimum required tasks for reference:\r\n\r\n> * Create a connection pool with tokio-postgres and/or bb8 and put it in managed state. This should tell us if on_attach and on_launch need to be async-capable.\r\n> * Create a request guard type wrapping a connection (or a future that will resolve to a connection). This and the previous bullet point together are more or less what the guide demonstrated for databases in Rocket 0.3 before we had rocket_contrib::databases.\r\n> * Use said connection via the request guard within a route to query/alter the database. This should work fine, because routes can now be async fn.\r\n> * Test, figure out, and document cross-runtime compatibility (or lack thereof). That is, a definitive statement in the form of \"Rocket uses tokio 0.2, so your database futures have to as well\" if that's the case. Alternatively, maybe we could find a proof of concept of running two runtimes - tokio 0.2 (for rocket) alongside tokio 0.1 (for tokio-postgres) with some kind of message passing between them. I leave this intentionally vague because it's an annoying solution to an annoying problem and someone other than I will probably think of a better idea.","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/1117/timeline","performed_via_github_app":null,"state_reason":"completed"}