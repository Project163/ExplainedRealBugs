[{"id":5863320225,"node_id":"LE_lADOAzqMt85BaVj_zwAAAAFdeyqh","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5863320225","actor":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-01-10T03:38:57Z","label":{"name":"triage","color":"f9d0c4"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008704133","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1008704133","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1008704133,"node_id":"IC_kwDOAzqMt848H5qF","user":{"login":"somehowchris","id":38954618,"node_id":"MDQ6VXNlcjM4OTU0NjE4","avatar_url":"https://avatars.githubusercontent.com/u/38954618?v=4","gravatar_id":"","url":"https://api.github.com/users/somehowchris","html_url":"https://github.com/somehowchris","followers_url":"https://api.github.com/users/somehowchris/followers","following_url":"https://api.github.com/users/somehowchris/following{/other_user}","gists_url":"https://api.github.com/users/somehowchris/gists{/gist_id}","starred_url":"https://api.github.com/users/somehowchris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somehowchris/subscriptions","organizations_url":"https://api.github.com/users/somehowchris/orgs","repos_url":"https://api.github.com/users/somehowchris/repos","events_url":"https://api.github.com/users/somehowchris/events{/privacy}","received_events_url":"https://api.github.com/users/somehowchris/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T09:54:45Z","updated_at":"2022-01-10T09:54:45Z","body":"Did you run that as debug or release?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008704133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"somehowchris","id":38954618,"node_id":"MDQ6VXNlcjM4OTU0NjE4","avatar_url":"https://avatars.githubusercontent.com/u/38954618?v=4","gravatar_id":"","url":"https://api.github.com/users/somehowchris","html_url":"https://github.com/somehowchris","followers_url":"https://api.github.com/users/somehowchris/followers","following_url":"https://api.github.com/users/somehowchris/following{/other_user}","gists_url":"https://api.github.com/users/somehowchris/gists{/gist_id}","starred_url":"https://api.github.com/users/somehowchris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somehowchris/subscriptions","organizations_url":"https://api.github.com/users/somehowchris/orgs","repos_url":"https://api.github.com/users/somehowchris/repos","events_url":"https://api.github.com/users/somehowchris/events{/privacy}","received_events_url":"https://api.github.com/users/somehowchris/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008731653","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1008731653","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1008731653,"node_id":"IC_kwDOAzqMt848IAYF","user":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T10:27:29Z","updated_at":"2022-01-10T10:27:40Z","body":"I have to admit these numbers were run in debug but the original issue surfaced in production\r\n\r\nThe 40ms spike at 4097 bytes remains if anything it's even more pronounced since the larger requests did speed up.\r\ni also found out that the speed recovers instantly at 8430 bytes\r\n\r\n```bash\r\nfor b in 4096 4097 8429 8430 10000 40960 409600 4096000;do; for n in 1 10 100;do \\\r\n  echo -n \"b=$b n=$n \"; httperf --server localhost --port 8000 \\\r\n  --uri /$b  --num-calls $n | grep \"ms/req\"; done; done\r\n```\r\n\r\n|  bytes | [ms/req] n=1 | 10 | 100 |\r\n| -----------: | ---: | ----: | ---: |\r\n| 4096       | 0.8 | 0.6 | 0.1 |\r\n| 4097       | 0.3 |  **37.4** | **40.6**  |\r\n| 8429       | 0.3 | **37.8** | **40.8** |\r\n| 8430       | 0.3 | 4.3 | 3.0 |\r\n| 10000     | 0.4 |  4.3 | 2.6  |\r\n| 40960     | 0.3 | 0.2 | 3.9 |\r\n| 409600   | 1.4 | 17.5 | 10.6 |\r\n| 4096000 | 11.9 | 18.8 | 24.2 |\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008731653/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008743733","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1008743733","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1008743733,"node_id":"IC_kwDOAzqMt848IDU1","user":{"login":"somehowchris","id":38954618,"node_id":"MDQ6VXNlcjM4OTU0NjE4","avatar_url":"https://avatars.githubusercontent.com/u/38954618?v=4","gravatar_id":"","url":"https://api.github.com/users/somehowchris","html_url":"https://github.com/somehowchris","followers_url":"https://api.github.com/users/somehowchris/followers","following_url":"https://api.github.com/users/somehowchris/following{/other_user}","gists_url":"https://api.github.com/users/somehowchris/gists{/gist_id}","starred_url":"https://api.github.com/users/somehowchris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somehowchris/subscriptions","organizations_url":"https://api.github.com/users/somehowchris/orgs","repos_url":"https://api.github.com/users/somehowchris/repos","events_url":"https://api.github.com/users/somehowchris/events{/privacy}","received_events_url":"https://api.github.com/users/somehowchris/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T10:42:03Z","updated_at":"2022-01-10T10:42:03Z","body":"Ok well same for optimized releases, may I ask, have you run any perf benchmarks? just to see if it has something to do with mem preasure/cpu overhead","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008743733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"somehowchris","id":38954618,"node_id":"MDQ6VXNlcjM4OTU0NjE4","avatar_url":"https://avatars.githubusercontent.com/u/38954618?v=4","gravatar_id":"","url":"https://api.github.com/users/somehowchris","html_url":"https://github.com/somehowchris","followers_url":"https://api.github.com/users/somehowchris/followers","following_url":"https://api.github.com/users/somehowchris/following{/other_user}","gists_url":"https://api.github.com/users/somehowchris/gists{/gist_id}","starred_url":"https://api.github.com/users/somehowchris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somehowchris/subscriptions","organizations_url":"https://api.github.com/users/somehowchris/orgs","repos_url":"https://api.github.com/users/somehowchris/repos","events_url":"https://api.github.com/users/somehowchris/events{/privacy}","received_events_url":"https://api.github.com/users/somehowchris/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008859416","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1008859416","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1008859416,"node_id":"IC_kwDOAzqMt848IfkY","user":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T13:10:28Z","updated_at":"2022-01-10T13:10:28Z","body":"Running with 1 worker is the same. \r\nI didn't see any obvious differences in `cargo flamegraph` / `hotspot` for 4096 and 4097 bytes but it's complaining that the sample rate is too low.\r\n\r\nAlways allocating the same amount has still the same result\r\n\r\n```rust\r\n#[get(\"/<size>\")]\r\nfn size(size: usize) -> String {\r\n    let mut s = String::with_capacity(4_000_000);\r\n    if size == 4096 {\r\n            s += \" \";\r\n    }\r\n    for _ in 0..size {\r\n        s += \" \";\r\n    }\r\n    if size == 4096 {\r\n        s.truncate(size);\r\n    }\r\n    s\r\n}\r\n```\r\n\r\nas has returning a `&'static str` with manually pasted content of the correct size","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008859416/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008934787","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1008934787","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1008934787,"node_id":"IC_kwDOAzqMt848Ix-D","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T14:37:44Z","updated_at":"2022-01-10T14:37:44Z","body":"@ssendev Don't I get the point or this code is for sure slower with 4096 than any other size... ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1008934787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5866452680,"node_id":"MEE_lADOAzqMt85BaVj_zwAAAAFdqvbI","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5866452680","actor":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-10T14:37:44Z","performed_via_github_app":null},{"id":5866452687,"node_id":"SE_lADOAzqMt85BaVj_zwAAAAFdqvbP","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5866452687","actor":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-10T14:37:44Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009033968","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009033968","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009033968,"node_id":"IC_kwDOAzqMt848JKLw","user":{"login":"somehowchris","id":38954618,"node_id":"MDQ6VXNlcjM4OTU0NjE4","avatar_url":"https://avatars.githubusercontent.com/u/38954618?v=4","gravatar_id":"","url":"https://api.github.com/users/somehowchris","html_url":"https://github.com/somehowchris","followers_url":"https://api.github.com/users/somehowchris/followers","following_url":"https://api.github.com/users/somehowchris/following{/other_user}","gists_url":"https://api.github.com/users/somehowchris/gists{/gist_id}","starred_url":"https://api.github.com/users/somehowchris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somehowchris/subscriptions","organizations_url":"https://api.github.com/users/somehowchris/orgs","repos_url":"https://api.github.com/users/somehowchris/repos","events_url":"https://api.github.com/users/somehowchris/events{/privacy}","received_events_url":"https://api.github.com/users/somehowchris/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T16:10:33Z","updated_at":"2022-01-10T16:10:45Z","body":"I may have identified the problem. Since Sergio is kinda off until mid this year for personal reasons I have created a fork to work on. Well at least using the script with httperf provided by you I couldnâ€˜t notice delays anymore\r\n\r\n```toml\r\n[dependencies]\r\nrocket = { git = \"https://github.com/somehowchris/Rocket\", tag = \"0.5.0-patch.1\"}\r\n```\r\n> Includes the fix\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009033968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"somehowchris","id":38954618,"node_id":"MDQ6VXNlcjM4OTU0NjE4","avatar_url":"https://avatars.githubusercontent.com/u/38954618?v=4","gravatar_id":"","url":"https://api.github.com/users/somehowchris","html_url":"https://github.com/somehowchris","followers_url":"https://api.github.com/users/somehowchris/followers","following_url":"https://api.github.com/users/somehowchris/following{/other_user}","gists_url":"https://api.github.com/users/somehowchris/gists{/gist_id}","starred_url":"https://api.github.com/users/somehowchris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somehowchris/subscriptions","organizations_url":"https://api.github.com/users/somehowchris/orgs","repos_url":"https://api.github.com/users/somehowchris/repos","events_url":"https://api.github.com/users/somehowchris/events{/privacy}","received_events_url":"https://api.github.com/users/somehowchris/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009064406","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009064406","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009064406,"node_id":"IC_kwDOAzqMt848JRnW","user":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T16:29:55Z","updated_at":"2022-01-10T16:29:55Z","body":"@kolbma \r\n\r\nYes there is a sharp cliff above 4096.\r\n**every time**  it can already be observed with --num-calls 2 though then it's only 20ms with 10 it's grown to 37ms and won't go much above 40 even with 1000. But when using 4096 bytes 100000 calls round to 0.0ms/req (20503.9 req/s)\r\n\r\n```shell\r\ntime httperf --server localhost --port 8000 --uri /4096  --num-calls 100000\r\nreal\t4,958\r\nuser\t2,976\r\nsys\t1,541\r\nmaxmem\t8 MB\r\nfaults\t0\r\n```\r\n\r\n```shell\r\ntime httperf --server localhost --port 8000 --uri /4097  --num-calls 1000\r\nreal\t40,996\r\nuser\t33,519\r\nsys\t7,286\r\nmaxmem\t8 MB\r\nfaults\t0\r\n```\r\n\r\nand requests stay slow until a size of 8429 where there is another cliff and response times return from ~40ms to 1.7ms\r\n\r\n```shell\r\ntime httperf --server localhost --port 8000 --uri /8429  --num-calls 1000\r\nreal\t41,005\r\nuser\t33,381\r\nsys\t7,468\r\nmaxmem\t8 MB\r\nfaults\t0\r\n```\r\n\r\n```shell\r\ntime httperf --server localhost --port 8000 --uri /8430  --num-calls 10000\r\nreal\t16,524\r\nuser\t13,117\r\nsys\t3,224\r\nmaxmem\t8 MB\r\nfaults\t0\r\n```\r\n\r\nbeware the changing `--num-calls` to keep total runtime in check\r\n\r\n\r\n@somehowchris \r\nI tried your branch but can't see any difference. Though there is only one commit updating dependencies was there supposed to be another one?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009064406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5867237672,"node_id":"MEE_lADOAzqMt85BaVj_zwAAAAFdtvEo","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5867237672","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-10T16:29:55Z","performed_via_github_app":null},{"id":5867237679,"node_id":"SE_lADOAzqMt85BaVj_zwAAAAFdtvEv","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5867237679","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-10T16:29:55Z","performed_via_github_app":null},{"id":5867237687,"node_id":"MEE_lADOAzqMt85BaVj_zwAAAAFdtvE3","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5867237687","actor":{"login":"somehowchris","id":38954618,"node_id":"MDQ6VXNlcjM4OTU0NjE4","avatar_url":"https://avatars.githubusercontent.com/u/38954618?v=4","gravatar_id":"","url":"https://api.github.com/users/somehowchris","html_url":"https://github.com/somehowchris","followers_url":"https://api.github.com/users/somehowchris/followers","following_url":"https://api.github.com/users/somehowchris/following{/other_user}","gists_url":"https://api.github.com/users/somehowchris/gists{/gist_id}","starred_url":"https://api.github.com/users/somehowchris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somehowchris/subscriptions","organizations_url":"https://api.github.com/users/somehowchris/orgs","repos_url":"https://api.github.com/users/somehowchris/repos","events_url":"https://api.github.com/users/somehowchris/events{/privacy}","received_events_url":"https://api.github.com/users/somehowchris/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-10T16:29:55Z","performed_via_github_app":null},{"id":5867237690,"node_id":"SE_lADOAzqMt85BaVj_zwAAAAFdtvE6","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5867237690","actor":{"login":"somehowchris","id":38954618,"node_id":"MDQ6VXNlcjM4OTU0NjE4","avatar_url":"https://avatars.githubusercontent.com/u/38954618?v=4","gravatar_id":"","url":"https://api.github.com/users/somehowchris","html_url":"https://github.com/somehowchris","followers_url":"https://api.github.com/users/somehowchris/followers","following_url":"https://api.github.com/users/somehowchris/following{/other_user}","gists_url":"https://api.github.com/users/somehowchris/gists{/gist_id}","starred_url":"https://api.github.com/users/somehowchris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somehowchris/subscriptions","organizations_url":"https://api.github.com/users/somehowchris/orgs","repos_url":"https://api.github.com/users/somehowchris/repos","events_url":"https://api.github.com/users/somehowchris/events{/privacy}","received_events_url":"https://api.github.com/users/somehowchris/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-10T16:29:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009419778","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009419778","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009419778,"node_id":"IC_kwDOAzqMt848KoYC","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T22:43:28Z","updated_at":"2022-01-10T22:43:28Z","body":"I've put it up here https://github.com/kolbma/rocket-issue-2062 with modification to \r\n```\r\n#[get(\"/<size>\")]\r\nfn size(size: usize) -> &'static str {\r\n```\r\n\r\nBut I see there some more slow requests... Have a look at the n=2... also these are not constant slow in relation to content size...  \r\n\r\nHave you tried a different benchmark tool?\r\n\r\n```\r\nb=4096 n=1 Request rate: 1677.7 req/s (0.6 ms/req)\r\nb=4096 n=2 Request rate: 1212.1 req/s (0.8 ms/req)\r\nb=4096 n=10 Request rate: 2947.3 req/s (0.3 ms/req)\r\nb=4096 n=100 Request rate: 4558.9 req/s (0.2 ms/req)\r\nb=4097 n=1 Request rate: 1127.5 req/s (0.9 ms/req)\r\nb=4097 n=2 Request rate: 45.0 req/s (22.2 ms/req)\r\nb=4097 n=10 Request rate: 25.4 req/s (39.3 ms/req)\r\nb=4097 n=100 Request rate: 23.0 req/s (43.6 ms/req)\r\nb=8429 n=1 Request rate: 871.1 req/s (1.1 ms/req)\r\nb=8429 n=2 Request rate: 45.2 req/s (22.1 ms/req)\r\nb=8429 n=10 Request rate: 25.2 req/s (39.6 ms/req)\r\nb=8429 n=100 Request rate: 23.0 req/s (43.6 ms/req)\r\nb=8430 n=1 Request rate: 871.1 req/s (1.1 ms/req)\r\nb=8430 n=2 Request rate: 1769.7 req/s (0.6 ms/req)\r\nb=8430 n=10 Request rate: 202.8 req/s (4.9 ms/req)\r\nb=8430 n=100 Request rate: 389.8 req/s (2.6 ms/req)\r\nb=10000 n=1 Request rate: 1672.4 req/s (0.6 ms/req)\r\nb=10000 n=2 Request rate: 45.8 req/s (21.8 ms/req)\r\nb=10000 n=10 Request rate: 214.8 req/s (4.7 ms/req)\r\nb=10000 n=100 Request rate: 389.8 req/s (2.6 ms/req)\r\nb=40960 n=1 Request rate: 1101.4 req/s (0.9 ms/req)\r\nb=40960 n=2 Request rate: 22.6 req/s (44.2 ms/req)\r\nb=40960 n=10 Request rate: 915.4 req/s (1.1 ms/req)\r\nb=40960 n=100 Request rate: 1080.8 req/s (0.9 ms/req)\r\nb=409600 n=1 Request rate: 225.6 req/s (4.4 ms/req)\r\nb=409600 n=2 Request rate: 231.9 req/s (4.3 ms/req)\r\nb=409600 n=10 Request rate: 77.9 req/s (12.8 ms/req)\r\nb=409600 n=100 Request rate: 185.4 req/s (5.4 ms/req)\r\nb=4096000 n=1 Request rate: 12.7 req/s (78.7 ms/req)\r\nb=4096000 n=2 Request rate: 29.3 req/s (34.1 ms/req)\r\nb=4096000 n=10 Request rate: 30.1 req/s (33.2 ms/req)\r\nb=4096000 n=100 Request rate: 25.0 req/s (40.0 ms/req)\r\n```\r\n\r\nAnother...\r\n```\r\nb=4096 n=1 Request rate: 1181.8 req/s (0.8 ms/req)\r\nb=4096 n=2 Request rate: 1167.5 req/s (0.9 ms/req)\r\nb=4096 n=10 Request rate: 2947.1 req/s (0.3 ms/req)\r\nb=4096 n=100 Request rate: 3472.5 req/s (0.3 ms/req)\r\nb=4097 n=1 Request rate: 1519.7 req/s (0.7 ms/req)\r\nb=4097 n=2 Request rate: 43.1 req/s (23.2 ms/req)\r\nb=4097 n=10 Request rate: 25.1 req/s (39.8 ms/req)\r\nb=4097 n=100 Request rate: 23.0 req/s (43.5 ms/req)\r\nb=8429 n=1 Request rate: 811.6 req/s (1.2 ms/req)\r\nb=8429 n=2 Request rate: 45.9 req/s (21.8 ms/req)\r\nb=8429 n=10 Request rate: 25.2 req/s (39.6 ms/req)\r\nb=8429 n=100 Request rate: 23.0 req/s (43.6 ms/req)\r\nb=8430 n=1 Request rate: 1356.9 req/s (0.7 ms/req)\r\nb=8430 n=2 Request rate: 48.7 req/s (20.5 ms/req)\r\nb=8430 n=10 Request rate: 225.9 req/s (4.4 ms/req)\r\nb=8430 n=100 Request rate: 473.5 req/s (2.1 ms/req)\r\nb=10000 n=1 Request rate: 944.2 req/s (1.1 ms/req)\r\nb=10000 n=2 Request rate: 47.9 req/s (20.9 ms/req)\r\nb=10000 n=10 Request rate: 223.8 req/s (4.5 ms/req)\r\nb=10000 n=100 Request rate: 394.1 req/s (2.5 ms/req)\r\nb=40960 n=1 Request rate: 1128.7 req/s (0.9 ms/req)\r\nb=40960 n=2 Request rate: 1109.9 req/s (0.9 ms/req)\r\nb=40960 n=10 Request rate: 110.9 req/s (9.0 ms/req)\r\nb=40960 n=100 Request rate: 692.7 req/s (1.4 ms/req)\r\nb=409600 n=1 Request rate: 229.7 req/s (4.4 ms/req)\r\nb=409600 n=2 Request rate: 266.6 req/s (3.8 ms/req)\r\nb=409600 n=10 Request rate: 120.6 req/s (8.3 ms/req)\r\nb=409600 n=100 Request rate: 224.9 req/s (4.4 ms/req)\r\nb=4096000 n=1 Request rate: 12.6 req/s (79.4 ms/req)\r\nb=4096000 n=2 Request rate: 27.6 req/s (36.2 ms/req)\r\nb=4096000 n=10 Request rate: 24.1 req/s (41.5 ms/req)\r\nb=4096000 n=100 Request rate: 26.8 req/s (37.3 ms/req)\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009419778/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009451881","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009451881","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009451881,"node_id":"IC_kwDOAzqMt848KwNp","user":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T23:24:12Z","updated_at":"2022-01-10T23:24:12Z","body":"That the slowdowns aren't linearly correlated to content size is what makes this strange. The sharp edge at 4KiB makes me think it's some buffer that causes scheduling issues.\r\n\r\ni just tried Apache bench `ab -k -c 1 -n 100 http://localhost:8000/4097` and here the problem only occurs if `-k` (KeepAlive) is present","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009451881/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009464021","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009464021","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009464021,"node_id":"IC_kwDOAzqMt848KzLV","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T23:49:20Z","updated_at":"2022-01-10T23:49:20Z","body":"I've tried wrk... the 1st value is average... you see also the breakdown with 4097 and the raise with 8430...\r\n\r\n```\r\nb=4096 n=1\t\t    Req/Sec     4.90k   192.57     5.11k    83.33%\r\nb=4096 n=2\t\t    Req/Sec     4.38k   250.42     4.98k    72.13%\r\nb=4096 n=10\t\t    Req/Sec     1.54k    95.76     1.99k    87.66%\r\nb=4096 n=100\t\t    Req/Sec   151.30     27.81   555.00     89.34%\r\nb=4097 n=1\t\t    Req/Sec    26.97     18.93   121.00     93.33%\r\nb=4097 n=2\t\t    Req/Sec    27.03     19.32   128.00     93.33%\r\nb=4097 n=10\t\t    Req/Sec    26.67     18.68   121.00     93.33%\r\nb=4097 n=100\t\t    Req/Sec    25.75     14.92   141.00     92.66%\r\nb=8429 n=1\t\t    Req/Sec    23.27      5.45    40.00     70.00%\r\nb=8429 n=2\t\t    Req/Sec    23.25      5.48    40.00     70.00%\r\nb=8429 n=10\t\t    Req/Sec    23.02      5.36    40.00     72.00%\r\nb=8429 n=100\t\t    Req/Sec    22.50      4.74    40.00     76.76%\r\nb=8430 n=1\t\t    Req/Sec   424.20    131.67   730.00     70.00%\r\nb=8430 n=2\t\t    Req/Sec   480.78    160.94   830.00     71.67%\r\nb=8430 n=10\t\t    Req/Sec   330.81    104.48   760.00     70.86%\r\nb=8430 n=100\t\t    Req/Sec    87.55     66.76   535.00     87.71%\r\nb=10000 n=1\t\t    Req/Sec   323.00    123.98   636.00     73.33%\r\nb=10000 n=2\t\t    Req/Sec   422.53    132.79     0.90k    70.00%\r\nb=10000 n=10\t\t    Req/Sec   399.53    117.16   820.00     71.71%\r\nb=10000 n=100\t\t    Req/Sec    88.93     63.40   690.00     88.01%\r\nb=40960 n=1\t\t    Req/Sec    59.53     35.75   160.00     70.00%\r\nb=40960 n=2\t\t    Req/Sec    54.45     32.91   171.00     70.00%\r\nb=40960 n=10\t\t    Req/Sec    40.58     29.48   191.00     88.20%\r\nb=40960 n=100\t\t    Req/Sec    55.47     42.02   350.00     82.38%\r\nb=409600 n=1\t\t    Req/Sec    46.67     14.70    80.00     66.67%\r\nb=409600 n=2\t\t    Req/Sec    40.80     15.40    80.00     73.33%\r\nb=409600 n=10\t\t    Req/Sec    28.17      9.88    70.00     80.86%\r\nb=409600 n=100\t\t    Req/Sec    10.33      3.80    60.00     78.97%\r\nb=4096000 n=1\t\t    Req/Sec    18.67      6.81    30.00     53.33%\r\nb=4096000 n=2\t\t    Req/Sec    19.48      6.49    30.00     59.02%\r\nb=4096000 n=10\t\t    Req/Sec    11.20      3.98    20.00     77.78%\r\nb=4096000 n=100\t\t    Req/Sec     1.29      1.99    20.00     93.33%\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009464021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009495383","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009495383","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009495383,"node_id":"IC_kwDOAzqMt848K61X","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T00:55:35Z","updated_at":"2022-01-11T00:55:35Z","body":"> That the slowdowns aren't linearly correlated to content size is what makes this strange. The sharp edge at 4KiB makes me think it's some buffer that causes scheduling issues.\r\n\r\nThis is the default chunk size in Rocket. But the window to 8430 is strange.  \r\nhttps://github.com/SergioBenitez/Rocket/blob/8cae077ba1d54b92cdef3e171a730b819d5eeb8e/core/lib/src/response/body.rs#L108","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009495383/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009529929","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009529929","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009529929,"node_id":"IC_kwDOAzqMt848LDRJ","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T01:58:08Z","updated_at":"2022-01-11T01:58:08Z","body":"If you change `DEFAULT_MAX_CHUNK` the window moves. So let's say you set it to 8430, the break down starts with 8431.  \r\nCan't see any special handling of this in Rocket code. This is based on hyper and h2. But I've already updated both crates to latest version without change.  \r\nI'll check this further out after some sleep...","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009529929/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009924935","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009924935","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009924935,"node_id":"IC_kwDOAzqMt848MjtH","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T12:38:07Z","updated_at":"2022-01-11T12:38:07Z","body":"It doesn't work correctly after 8430 bytes count also!\r\n\r\nLook at the Net I/O output of httperf. This is much too slow.  \r\n```\r\nfor b in 4060 4096 4097 8192 8430 12288 12500 ; do \r\n    echo -n \"$b:  \"\r\n    httperf  --server localhost --port 8000 --uri /$b --num-calls 10 --num-conns 10 | grep \"Net I\" \r\ndone\r\n```\r\nWith 3x max_chunk_size == 12288 bytes it is fast like with 4096 bytes and because of bigger \"file\" more effective in Net I/O.\r\n\r\n    4060:  Net I/O: 1409.4 KB/s (11.5*10^6 bps)\r\n    4096:  Net I/O: 1361.7 KB/s (11.2*10^6 bps)\r\n    4097:  Net I/O: 106.9 KB/s (0.9*10^6 bps)\r\n    8192:  Net I/O: 207.2 KB/s (1.7*10^6 bps)\r\n    8430:  Net I/O: 529.2 KB/s (4.3*10^6 bps)\r\n    12288:  Net I/O: 2553.8 KB/s (20.9*10^6 bps)\r\n    12500:  Net I/O: 836.6 KB/s (6.9*10^6 bps)\r\n\r\nIs there anything wrong with this? \r\nhttps://github.com/SergioBenitez/Rocket/blob/8cae077ba1d54b92cdef3e171a730b819d5eeb8e/core/lib/src/ext.rs#L117\r\n\r\nAnyone an idea why it starts to become faster again after the additional 4334 bytes (4096 + 4334 = 8430)?  \r\nOr any other idea what might be the cause?\r\n\r\nI see there some more not really explainable differences in speed. Looks like there is some race condition and blocking.  \r\nHow do you trace the polling of tokio crate?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009924935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009941096","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1009941096","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1009941096,"node_id":"IC_kwDOAzqMt848Mnpo","user":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T13:00:02Z","updated_at":"2022-01-11T13:00:02Z","body":"https://github.com/tokio-rs/console advertises itself as capable of it\r\n\r\nThe fact that the delay is 40ms also made me think of this https://vorner.github.io/2020/11/06/40-ms-bug.html","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1009941096/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ssendev","id":450793,"node_id":"MDQ6VXNlcjQ1MDc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/450793?v=4","gravatar_id":"","url":"https://api.github.com/users/ssendev","html_url":"https://github.com/ssendev","followers_url":"https://api.github.com/users/ssendev/followers","following_url":"https://api.github.com/users/ssendev/following{/other_user}","gists_url":"https://api.github.com/users/ssendev/gists{/gist_id}","starred_url":"https://api.github.com/users/ssendev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssendev/subscriptions","organizations_url":"https://api.github.com/users/ssendev/orgs","repos_url":"https://api.github.com/users/ssendev/repos","events_url":"https://api.github.com/users/ssendev/events{/privacy}","received_events_url":"https://api.github.com/users/ssendev/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1010123879","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1010123879","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1010123879,"node_id":"IC_kwDOAzqMt848NURn","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T16:15:51Z","updated_at":"2022-01-11T16:15:51Z","body":"[http1_writev](https://docs.rs/hyper/latest/hyper/server/struct.Builder.html#method.http1_writev) disabled doesn't make a difference.  \r\n\r\nI've setup in the meantime some code for bare hyper which has the same functionality to respond to `GET /<size>`.   \r\nNo problem in hyper.\r\n\r\n* hyper.sh port 3000 calls: 500 conns: 1\r\n    4097:  Net I/O: 23718.9 KB/s (194.3*10^6 bps)\r\n    4097:  Request rate: 5727.0 req/s (0.2 ms/req)\r\n\r\nI'm thinking about how the __keep_alive__ suits in the situation with different __byte counts__.\r\nBecause it happens only when reusing the connection with e.g. 500 GET requests.\r\n\r\n4096 ok...  \r\n* rocket.sh port 8000 calls: 500 conns: 1\r\n    4096:  Net I/O: 19174.5 KB/s (157.1*10^6 bps)\r\n    4096:  Request rate: 4463.5 req/s (0.2 ms/req)\r\n\r\n4097 slow....\r\n* rocket.sh port 8000 calls: 500 conns: 1\r\n    4097:  Net I/O: 97.8 KB/s (0.8*10^6 bps)\r\n    4097:  Request rate: 22.8 req/s (43.9 ms/req)\r\n\r\nCreating 500 connections for each 1 GET request is ok...\r\n\r\n* rocket.sh port 8000 calls: 1 conns: 500\r\n    4097:  Net I/O: 7457.8 KB/s (61.1*10^6 bps)\r\n    4097:  Request rate: 1735.6 req/s (0.6 ms/req)\r\n\r\nBut 250 connections each reused for a 2nd concurrent GET is a bottleneck...\r\n\r\n* rocket.sh port 8000 calls: 250 conns: 2\r\n    4097:  Net I/O: 98.1 KB/s (0.8*10^6 bps)\r\n    4097:  Request rate: 22.8 req/s (43.8 ms/req)\r\n\r\nThere should be more req/s than with calls: 500 conns: 1, because there is lesser TCP connection overhead.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1010123879/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1010368365","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1010368365","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1010368365,"node_id":"IC_kwDOAzqMt848OP9t","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T21:19:39Z","updated_at":"2022-01-11T21:19:39Z","body":"So the time is lost in the concurrent call of\r\n\r\nhttps://github.com/SergioBenitez/Rocket/blob/8cae077ba1d54b92cdef3e171a730b819d5eeb8e/core/lib/src/server.rs#L280\r\n\r\nIn my debug build and a connection with 2 requests, there is waited for one request about 290 milliseconds. The other request is about 2 or 3 milliseconds.\r\n\r\nThe `handle` function \r\nhttps://github.com/SergioBenitez/Rocket/blob/8cae077ba1d54b92cdef3e171a730b819d5eeb8e/core/lib/src/server.rs#L23\r\nI've stripped to...\r\n```\r\nSome(run().await)\r\n```\r\nto remove temporarily the unwinding stuff. \r\nAnd the String handler itself is no culprit. It runs about 100 microseconds.\r\n\r\nIn the blackbox part called by `route.handler.handle(request, data)` a lot of future pinning and unsafe memory handling whith a lot of safety info (the caller of method/function would need to make sure a requirement is fulfilled) is called to handle the async.  \r\nNeed to see what is done by the codegen of Rocket there.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1010368365/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1011247208","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1011247208","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1011247208,"node_id":"IC_kwDOAzqMt848Rmho","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T16:48:27Z","updated_at":"2022-01-12T16:48:27Z","body":"After all the code inspection and code timings... I don't believe anylonger there is an issue in Rocket...\r\n\r\nIf you check the network traffic and its timing, you'll see for 2 requests in one __keep-alive__ connection with content length __4096__\r\n\r\n![4096_calls2_conns1](https://user-images.githubusercontent.com/5228369/149154251-508cbba4-d731-41f7-87df-71772aa93b35.png)\r\n\r\nAnd for 2 requests in one __keep-alive__ connection with content length __4097__\r\n\r\n![4097_calls2_conns1](https://user-images.githubusercontent.com/5228369/149154245-1c3e6214-1cef-494d-9727-1f8b263027c2.png)\r\n\r\nThe data inclusive proto overhead 4399 bytes is sent by Rocket server __always__ quickly after the GET request.  \r\n\r\nFor content length __4096__ there is a single TCP segment, while for __4097__ there is a 2nd.  \r\nThere might be the cause in the async handling between Rocket with its `max_chunk_size` and sending data via Hyper.  \r\nJust using Hyper directly, this is handled differently and it pushes the data also in a single TCP segment like with 4096 bytes.  \r\nBut this is both ok.\r\n\r\nBack to whats going on...  \r\nYou see in the bottom image that __frame 13__ is sent over __44ms behind frame 12__. So the server at port 8000 is waiting for the ACK from the client, which is here httperf.  \r\nThe data has been seen by httperf more or less beamed in because the long awaited ACK has the same timestamp in echo (not on images).\r\nLooks like the benchmark tools doesn't handle __keep-alive__ correctly.  \r\nWhile the first request is ACKed correctly, it seems it waits for more data if there are multiple segments to fill up its own buffer. Although it could ACK the already received data.  \r\nFor confirmation you can also set argument `--recv-buffer` to e.g. 1 and there is no slow down because of waiting on ACK.  \r\nWhat the value is exactly you set here, I don't know. If you set it too high (13000, 12000 is ok) I think it switches to default and the ACK won't work again.  \r\nBut `httperf --recv-buffer 9000 --server localhost --port 8000 --uri /4097 --num-calls 2 --num-conns 1` works to get similar assembled frames like without the option, but correctly fast ACKed...\r\n\r\n![4097_calls2_conns1_recv-buffer-9000](https://user-images.githubusercontent.com/5228369/149176246-8eead2db-1a3f-4978-bfd3-58e04c48ac1b.png)\r\n\r\n* rocket.sh port 8000 calls: 1000 conns: 10\r\n    4096:  Net I/O: 1396.7 KB/s (11.4*10^6 bps)\r\n    4096:  Request rate: 325.1 req/s (3.1 ms/req)\r\n\r\n* rocket.sh port 8000 calls: 1000 conns: 10\r\n    4097:  Net I/O: 1332.6 KB/s (10.9*10^6 bps)\r\n    4097:  Request rate: 310.1 req/s (3.2 ms/req)\r\n\r\nWith bigger byte counts there is still a problem with the tool...  \r\nFor curiosity same __calls 4 conns 1__ sometimes slow but also fast...  \r\n\r\n* rocket.sh port 8000 calls: 4 conns: 1\r\n    8430:  Net I/O: 546.2 KB/s (4.5*10^6 bps)\r\n    8430:  Request rate: 64.0 req/s (15.6 ms/req)\r\n\r\n* rocket.sh port 8000 calls: 4 conns: 1\r\n    8430:  Net I/O: 2247.0 KB/s (18.4*10^6 bps)\r\n    8430:  Request rate: 263.5 req/s (3.8 ms/req)\r\n\r\nWith only __3 calls__ it is always fast. With __5 calls__ it is always slow.  \r\n\r\nProblem is the same like above... if it is slow, over 44ms wait for ACK the received data.  \r\nBut not already the 2nd request, here sometime the 4th but always the 5th.  \r\nWith bytecount 8000 and recv-buffer 12000 it is always fast again...\r\n\r\n* rocket.sh port 8000 calls: 1000 conns: 10\r\n    8000:  Net I/O: 2169.0 KB/s (17.8*10^6 bps)\r\n    8000:  Request rate: 267.5 req/s (3.7 ms/req)\r\n\r\nAll calls against debug build with timing output, so much slower as a release build of Rocket.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1011247208/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T16:58:41Z","updated_at":"2022-01-12T16:58:41Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/httperf/httperf/issues/78","repository_url":"https://api.github.com/repos/httperf/httperf","labels_url":"https://api.github.com/repos/httperf/httperf/issues/78/labels{/name}","comments_url":"https://api.github.com/repos/httperf/httperf/issues/78/comments","events_url":"https://api.github.com/repos/httperf/httperf/issues/78/events","html_url":"https://github.com/httperf/httperf/issues/78","id":1100575326,"node_id":"I_kwDOAespnc5BmXJe","number":78,"title":"Requests in Keep-Alive connections are not ACKed correctly","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-01-12T16:58:41Z","updated_at":"2022-01-12T16:58:41Z","closed_at":null,"author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":32188829,"node_id":"MDEwOlJlcG9zaXRvcnkzMjE4ODgyOQ==","name":"httperf","full_name":"httperf/httperf","private":false,"owner":{"login":"httperf","id":11468448,"node_id":"MDEyOk9yZ2FuaXphdGlvbjExNDY4NDQ4","avatar_url":"https://avatars.githubusercontent.com/u/11468448?v=4","gravatar_id":"","url":"https://api.github.com/users/httperf","html_url":"https://github.com/httperf","followers_url":"https://api.github.com/users/httperf/followers","following_url":"https://api.github.com/users/httperf/following{/other_user}","gists_url":"https://api.github.com/users/httperf/gists{/gist_id}","starred_url":"https://api.github.com/users/httperf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/httperf/subscriptions","organizations_url":"https://api.github.com/users/httperf/orgs","repos_url":"https://api.github.com/users/httperf/repos","events_url":"https://api.github.com/users/httperf/events{/privacy}","received_events_url":"https://api.github.com/users/httperf/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/httperf/httperf","description":"The httperf HTTP load generator","fork":false,"url":"https://api.github.com/repos/httperf/httperf","forks_url":"https://api.github.com/repos/httperf/httperf/forks","keys_url":"https://api.github.com/repos/httperf/httperf/keys{/key_id}","collaborators_url":"https://api.github.com/repos/httperf/httperf/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/httperf/httperf/teams","hooks_url":"https://api.github.com/repos/httperf/httperf/hooks","issue_events_url":"https://api.github.com/repos/httperf/httperf/issues/events{/number}","events_url":"https://api.github.com/repos/httperf/httperf/events","assignees_url":"https://api.github.com/repos/httperf/httperf/assignees{/user}","branches_url":"https://api.github.com/repos/httperf/httperf/branches{/branch}","tags_url":"https://api.github.com/repos/httperf/httperf/tags","blobs_url":"https://api.github.com/repos/httperf/httperf/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/httperf/httperf/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/httperf/httperf/git/refs{/sha}","trees_url":"https://api.github.com/repos/httperf/httperf/git/trees{/sha}","statuses_url":"https://api.github.com/repos/httperf/httperf/statuses/{sha}","languages_url":"https://api.github.com/repos/httperf/httperf/languages","stargazers_url":"https://api.github.com/repos/httperf/httperf/stargazers","contributors_url":"https://api.github.com/repos/httperf/httperf/contributors","subscribers_url":"https://api.github.com/repos/httperf/httperf/subscribers","subscription_url":"https://api.github.com/repos/httperf/httperf/subscription","commits_url":"https://api.github.com/repos/httperf/httperf/commits{/sha}","git_commits_url":"https://api.github.com/repos/httperf/httperf/git/commits{/sha}","comments_url":"https://api.github.com/repos/httperf/httperf/comments{/number}","issue_comment_url":"https://api.github.com/repos/httperf/httperf/issues/comments{/number}","contents_url":"https://api.github.com/repos/httperf/httperf/contents/{+path}","compare_url":"https://api.github.com/repos/httperf/httperf/compare/{base}...{head}","merges_url":"https://api.github.com/repos/httperf/httperf/merges","archive_url":"https://api.github.com/repos/httperf/httperf/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/httperf/httperf/downloads","issues_url":"https://api.github.com/repos/httperf/httperf/issues{/number}","pulls_url":"https://api.github.com/repos/httperf/httperf/pulls{/number}","milestones_url":"https://api.github.com/repos/httperf/httperf/milestones{/number}","notifications_url":"https://api.github.com/repos/httperf/httperf/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/httperf/httperf/labels{/name}","releases_url":"https://api.github.com/repos/httperf/httperf/releases{/id}","deployments_url":"https://api.github.com/repos/httperf/httperf/deployments","created_at":"2015-03-14T00:41:34Z","updated_at":"2025-10-15T07:40:47Z","pushed_at":"2022-04-20T11:35:50Z","git_url":"git://github.com/httperf/httperf.git","ssh_url":"git@github.com:httperf/httperf.git","clone_url":"https://github.com/httperf/httperf.git","svn_url":"https://github.com/httperf/httperf","homepage":"","size":546,"stargazers_count":1014,"watchers_count":1014,"language":"C","has_issues":true,"has_projects":true,"has_downloads":false,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":152,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":54,"license":{"key":"gpl-2.0","name":"GNU General Public License v2.0","spdx_id":"GPL-2.0","url":"https://api.github.com/licenses/gpl-2.0","node_id":"MDc6TGljZW5zZTg="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":152,"open_issues":54,"watchers":1014,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I've searched for keep-alive issues, but there is none, so might still not be fixed since my Linux distribution version httperf 0.9.1...\r\n\r\nPlease have a look at my comment here...  \r\nhttps://github.com/SergioBenitez/Rocket/issues/2062#issuecomment-1011247208\r\n\r\nTo summarize: In httperf it depends on the receive-buffer size how and when received data segments in a keep-alive session are ACKed. And mostly this is buggy and just waits around. But please see above comment for examples and explanation.","reactions":{"url":"https://api.github.com/repos/httperf/httperf/issues/78/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/httperf/httperf/issues/78/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T17:22:46Z","updated_at":"2022-01-12T17:22:46Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/wg/wrk/issues/488","repository_url":"https://api.github.com/repos/wg/wrk","labels_url":"https://api.github.com/repos/wg/wrk/issues/488/labels{/name}","comments_url":"https://api.github.com/repos/wg/wrk/issues/488/comments","events_url":"https://api.github.com/repos/wg/wrk/issues/488/events","html_url":"https://github.com/wg/wrk/issues/488","id":1100600233,"node_id":"I_kwDOADmXeM5BmdOp","number":488,"title":"Requests in Keep-Alive connections are not ACKed correctly","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-01-12T17:22:46Z","updated_at":"2024-01-13T21:46:57Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3774328,"node_id":"MDEwOlJlcG9zaXRvcnkzNzc0MzI4","name":"wrk","full_name":"wg/wrk","private":false,"owner":{"login":"wg","id":94529,"node_id":"MDQ6VXNlcjk0NTI5","avatar_url":"https://avatars.githubusercontent.com/u/94529?v=4","gravatar_id":"","url":"https://api.github.com/users/wg","html_url":"https://github.com/wg","followers_url":"https://api.github.com/users/wg/followers","following_url":"https://api.github.com/users/wg/following{/other_user}","gists_url":"https://api.github.com/users/wg/gists{/gist_id}","starred_url":"https://api.github.com/users/wg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wg/subscriptions","organizations_url":"https://api.github.com/users/wg/orgs","repos_url":"https://api.github.com/users/wg/repos","events_url":"https://api.github.com/users/wg/events{/privacy}","received_events_url":"https://api.github.com/users/wg/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/wg/wrk","description":"Modern HTTP benchmarking tool","fork":false,"url":"https://api.github.com/repos/wg/wrk","forks_url":"https://api.github.com/repos/wg/wrk/forks","keys_url":"https://api.github.com/repos/wg/wrk/keys{/key_id}","collaborators_url":"https://api.github.com/repos/wg/wrk/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/wg/wrk/teams","hooks_url":"https://api.github.com/repos/wg/wrk/hooks","issue_events_url":"https://api.github.com/repos/wg/wrk/issues/events{/number}","events_url":"https://api.github.com/repos/wg/wrk/events","assignees_url":"https://api.github.com/repos/wg/wrk/assignees{/user}","branches_url":"https://api.github.com/repos/wg/wrk/branches{/branch}","tags_url":"https://api.github.com/repos/wg/wrk/tags","blobs_url":"https://api.github.com/repos/wg/wrk/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/wg/wrk/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/wg/wrk/git/refs{/sha}","trees_url":"https://api.github.com/repos/wg/wrk/git/trees{/sha}","statuses_url":"https://api.github.com/repos/wg/wrk/statuses/{sha}","languages_url":"https://api.github.com/repos/wg/wrk/languages","stargazers_url":"https://api.github.com/repos/wg/wrk/stargazers","contributors_url":"https://api.github.com/repos/wg/wrk/contributors","subscribers_url":"https://api.github.com/repos/wg/wrk/subscribers","subscription_url":"https://api.github.com/repos/wg/wrk/subscription","commits_url":"https://api.github.com/repos/wg/wrk/commits{/sha}","git_commits_url":"https://api.github.com/repos/wg/wrk/git/commits{/sha}","comments_url":"https://api.github.com/repos/wg/wrk/comments{/number}","issue_comment_url":"https://api.github.com/repos/wg/wrk/issues/comments{/number}","contents_url":"https://api.github.com/repos/wg/wrk/contents/{+path}","compare_url":"https://api.github.com/repos/wg/wrk/compare/{base}...{head}","merges_url":"https://api.github.com/repos/wg/wrk/merges","archive_url":"https://api.github.com/repos/wg/wrk/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/wg/wrk/downloads","issues_url":"https://api.github.com/repos/wg/wrk/issues{/number}","pulls_url":"https://api.github.com/repos/wg/wrk/pulls{/number}","milestones_url":"https://api.github.com/repos/wg/wrk/milestones{/number}","notifications_url":"https://api.github.com/repos/wg/wrk/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/wg/wrk/labels{/name}","releases_url":"https://api.github.com/repos/wg/wrk/releases{/id}","deployments_url":"https://api.github.com/repos/wg/wrk/deployments","created_at":"2012-03-20T11:12:28Z","updated_at":"2025-11-09T14:23:44Z","pushed_at":"2023-12-30T10:33:51Z","git_url":"git://github.com/wg/wrk.git","ssh_url":"git@github.com:wg/wrk.git","clone_url":"https://github.com/wg/wrk.git","svn_url":"https://github.com/wg/wrk","homepage":"","size":38743,"stargazers_count":39739,"watchers_count":39739,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":202,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":3025,"open_issues":202,"watchers":39739,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"My wrk is from Linux distribution and RPM has version 4.0.2 `wrk --version` just ouputs the help.\r\n\r\nPlease have a look at my comment here...  \r\nhttps://github.com/SergioBenitez/Rocket/issues/2062#issuecomment-1011247208\r\n\r\nTo summarize: When the server has enabled keep-alive http1.1 after some requests in the connection wrk ACKs the received data with over 40ms delay.\r\n\r\nIn this image the 1st marked ACK (which is for the 3rd request in connection) is without delay, any later is with delay.  \r\nwrk got called with `wrk -c 2 -t 2 <url>`\r\n\r\n![wrk_c2_t2_4097](https://user-images.githubusercontent.com/5228369/149189737-d5367f02-6c34-467d-b462-fc47df6adaae.png)\r\n","reactions":{"url":"https://api.github.com/repos/wg/wrk/issues/488/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/wg/wrk/issues/488/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1018447754","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1018447754","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1018447754,"node_id":"IC_kwDOAzqMt848tEeK","user":{"login":"rbtcollins","id":499678,"node_id":"MDQ6VXNlcjQ5OTY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/499678?v=4","gravatar_id":"","url":"https://api.github.com/users/rbtcollins","html_url":"https://github.com/rbtcollins","followers_url":"https://api.github.com/users/rbtcollins/followers","following_url":"https://api.github.com/users/rbtcollins/following{/other_user}","gists_url":"https://api.github.com/users/rbtcollins/gists{/gist_id}","starred_url":"https://api.github.com/users/rbtcollins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rbtcollins/subscriptions","organizations_url":"https://api.github.com/users/rbtcollins/orgs","repos_url":"https://api.github.com/users/rbtcollins/repos","events_url":"https://api.github.com/users/rbtcollins/events{/privacy}","received_events_url":"https://api.github.com/users/rbtcollins/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-21T12:06:02Z","updated_at":"2022-01-21T12:06:02Z","body":"@kolbma thats the 40ms bug that vorner wrote up\r\n\r\n - if you set tcp_nodelay on the socket, the full response will reach the client without waiting for an ACK.\r\nOR\r\n- disabling delayed acks requires a per-recv() call, which is tedious, and disabling that is usually a problem anyway. \r\n\r\nThe issue here is the combination of small content *and* multiple packets. The writev setting having no effect may just mean that a similar thing is having a writev impact. I suggest a strace: if the syscalls being made by rocket apps split headers and body for small content this problem will occur.\r\n\r\nSee https://en.wikipedia.org/wiki/Nagle%27s_algorithm and https://datatracker.ietf.org/doc/html/draft-minshall-nagle\r\n\r\nThe answer is to ensure that userspace - rocket - always writes either a complete response, or at least a packet worth of data.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1018447754/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rbtcollins","id":499678,"node_id":"MDQ6VXNlcjQ5OTY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/499678?v=4","gravatar_id":"","url":"https://api.github.com/users/rbtcollins","html_url":"https://github.com/rbtcollins","followers_url":"https://api.github.com/users/rbtcollins/followers","following_url":"https://api.github.com/users/rbtcollins/following{/other_user}","gists_url":"https://api.github.com/users/rbtcollins/gists{/gist_id}","starred_url":"https://api.github.com/users/rbtcollins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rbtcollins/subscriptions","organizations_url":"https://api.github.com/users/rbtcollins/orgs","repos_url":"https://api.github.com/users/rbtcollins/repos","events_url":"https://api.github.com/users/rbtcollins/events{/privacy}","received_events_url":"https://api.github.com/users/rbtcollins/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5931689414,"node_id":"MEE_lADOAzqMt85BaVj_zwAAAAFhjmXG","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5931689414","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-21T12:06:03Z","performed_via_github_app":null},{"id":5931689424,"node_id":"SE_lADOAzqMt85BaVj_zwAAAAFhjmXQ","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/5931689424","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-21T12:06:03Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1019386184","html_url":"https://github.com/rwf2/Rocket/issues/2062#issuecomment-1019386184","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/2062","id":1019386184,"node_id":"IC_kwDOAzqMt848wplI","user":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-23T00:50:47Z","updated_at":"2022-01-23T00:50:47Z","body":"@rbtcollins PR welcome!\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/1019386184/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kolbma","id":5228369,"node_id":"MDQ6VXNlcjUyMjgzNjk=","avatar_url":"https://avatars.githubusercontent.com/u/5228369?v=4","gravatar_id":"","url":"https://api.github.com/users/kolbma","html_url":"https://github.com/kolbma","followers_url":"https://api.github.com/users/kolbma/followers","following_url":"https://api.github.com/users/kolbma/following{/other_user}","gists_url":"https://api.github.com/users/kolbma/gists{/gist_id}","starred_url":"https://api.github.com/users/kolbma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kolbma/subscriptions","organizations_url":"https://api.github.com/users/kolbma/orgs","repos_url":"https://api.github.com/users/kolbma/repos","events_url":"https://api.github.com/users/kolbma/events{/privacy}","received_events_url":"https://api.github.com/users/kolbma/received_events","type":"User","user_view_type":"public","site_admin":false}}]