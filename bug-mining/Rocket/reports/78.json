{"url":"https://api.github.com/repos/rwf2/Rocket/issues/386","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/386/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/386/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/386/events","html_url":"https://github.com/rwf2/Rocket/issues/386","id":250183567,"node_id":"MDU6SXNzdWUyNTAxODM1Njc=","number":386,"title":"Failure to write response for request with a data file to route with a request guard that returns an Outcome::Failure","user":{"login":"geauxvirtual","id":1395030,"node_id":"MDQ6VXNlcjEzOTUwMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1395030?v=4","gravatar_id":"","url":"https://api.github.com/users/geauxvirtual","html_url":"https://github.com/geauxvirtual","followers_url":"https://api.github.com/users/geauxvirtual/followers","following_url":"https://api.github.com/users/geauxvirtual/following{/other_user}","gists_url":"https://api.github.com/users/geauxvirtual/gists{/gist_id}","starred_url":"https://api.github.com/users/geauxvirtual/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geauxvirtual/subscriptions","organizations_url":"https://api.github.com/users/geauxvirtual/orgs","repos_url":"https://api.github.com/users/geauxvirtual/repos","events_url":"https://api.github.com/users/geauxvirtual/events{/privacy}","received_events_url":"https://api.github.com/users/geauxvirtual/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":343542075,"node_id":"MDU6TGFiZWwzNDM1NDIwNzU=","url":"https://api.github.com/repos/rwf2/Rocket/labels/question","name":"question","color":"D61CBC","default":true,"description":"A question (converts to discussion)"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-08-14T23:39:49Z","updated_at":"2018-08-12T06:35:13Z","closed_at":"2018-08-12T06:35:13Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Rocket version 0.3.1 (also seen with Rocket 0.3.0).\r\n\r\nMac OS X 10.12.6\r\n\r\nI have request guard in place on select routes for user authentication. I also have a route that has a data guard which accepts a data file from a multipart form input. If the request to this route does not include an authorization header along with the data file, I would expect the user to receive the Outcome::Failure defined in the request guard. Instead, what I'm seeing on the console is:\r\n\r\n<img width=\"738\" alt=\"screen shot 2017-08-14 at 3 50 34 pm\" src=\"https://user-images.githubusercontent.com/1395030/29295262-60069730-8108-11e7-8f56-bc6ee94142ab.png\">\r\n\r\nAnd the user sees:\r\n\r\n<img width=\"699\" alt=\"screen shot 2017-08-14 at 3 54 17 pm\" src=\"https://user-images.githubusercontent.com/1395030/29295370-f4f05066-8108-11e7-891a-5d748cc163de.png\">\r\n\r\nI've written a small example that duplicates what I was seeing in my code, included below. Sending a POST request to this route with a file will result in the error seen above. I would say typical file sizes that my application could see would range from 2 to 200KBs.\r\n\r\n\r\nExample curl request:\r\n`curl -X POST http://localhost:8000/ -F 'file=@somefile'`\r\n\r\nExample Rocket server with route\r\n```rust\r\n#![feature(plugin)]\r\n#![plugin(rocket_codegen)]\r\n\r\nextern crate rocket;\r\n\r\nuse rocket::{Request, Outcome};\r\nuse rocket::request::{self, FromRequest};\r\nuse rocket::http::Status;\r\n\r\npub struct Guard(pub String);\r\n\r\nimpl<'a, 'r> FromRequest<'a, 'r> for Guard {\r\n    type Error = ();\r\n\r\n    fn from_request(request: &'a Request<'r>) -> request::Outcome<Guard, ()> {\r\n        Outcome::Failure((Status::Unauthorized, ()))\r\n    }\r\n}\r\n\r\n#[post(\"/\")]\r\nfn index(guard: Guard) -> &'static str {\r\n    \"Hello World!\"\r\n}\r\n\r\nfn main() {\r\n    rocket::ignite()\r\n        .mount(\"/\", routes![index])\r\n        .launch();\r\n}\r\n```\r\n","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/386/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/386/timeline","performed_via_github_app":null,"state_reason":"completed"}