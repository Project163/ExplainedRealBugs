{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1884","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/1884/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/1884/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/1884/events","html_url":"https://github.com/rwf2/Rocket/issues/1884","id":990060598,"node_id":"MDU6SXNzdWU5OTAwNjA1OTg=","number":1884,"title":"Get access to database connection pool","user":{"login":"threema-danilo","id":78751145,"node_id":"MDQ6VXNlcjc4NzUxMTQ1","avatar_url":"https://avatars.githubusercontent.com/u/78751145?v=4","gravatar_id":"","url":"https://api.github.com/users/threema-danilo","html_url":"https://github.com/threema-danilo","followers_url":"https://api.github.com/users/threema-danilo/followers","following_url":"https://api.github.com/users/threema-danilo/following{/other_user}","gists_url":"https://api.github.com/users/threema-danilo/gists{/gist_id}","starred_url":"https://api.github.com/users/threema-danilo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/threema-danilo/subscriptions","organizations_url":"https://api.github.com/users/threema-danilo/orgs","repos_url":"https://api.github.com/users/threema-danilo/repos","events_url":"https://api.github.com/users/threema-danilo/events{/privacy}","received_events_url":"https://api.github.com/users/threema-danilo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":442152232,"node_id":"MDU6TGFiZWw0NDIxNTIyMzI=","url":"https://api.github.com/repos/rwf2/Rocket/labels/request","name":"request","color":"5319E7","default":false,"description":"Request for new functionality"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2021-09-07T14:42:10Z","updated_at":"2022-05-24T23:50:46Z","closed_at":"2022-05-24T23:50:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Is your feature request motivated by a concrete problem? Please describe.**\r\n\r\nI handle requests that trigger the processing of long-running tasks in the background. These tasks are executed in the context of a thread pool (let's call it the worker thread).\r\n\r\nBecause the worker thread needs access to the database, and potentially to multiple connections (due to further parallelization of tasks), the API currently expects that a reference to the database connection pool is passed in.\r\n\r\nWhen using the `rocket_sync_db_pools` crate, I can create a database and use that through the request guard. However, from what I can tell by reading the source code, that request guard only gets access to a single connection and does not expose the connection pool itself. And the connection (at least in the case of `diesel::PgConnection`) is not cloneable.\r\n\r\n**Why this feature can't or shouldn't live outside of Rocket**\r\n\r\nAs long as the connection pool is not exposed in any way, there cannot be any solution outside of `rocket_sync_db_pools` (unless a completely separate solution is written).\r\n\r\n**Ideal Solution**\r\n\r\nIdeally the `#[database(...)]`-annotated struct that wraps the connection would get an automatically implemented method `fn get_pool(&self) -> P` which returns a reference to the database connection pool.\r\n\r\n**Alternatives Considered**\r\n\r\nI could create a second, completely independent database connection and pass that into the handlers using `&RocketState<MyPool>`. However, that seems hacky.","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1884/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/1884/timeline","performed_via_github_app":null,"state_reason":"completed"}