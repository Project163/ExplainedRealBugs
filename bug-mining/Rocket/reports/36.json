{"url":"https://api.github.com/repos/rwf2/Rocket/issues/299","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/299/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/299/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/299/events","html_url":"https://github.com/rwf2/Rocket/issues/299","id":231341060,"node_id":"MDU6SXNzdWUyMzEzNDEwNjA=","number":299,"title":"Issue with cmd on Windows 7","user":{"login":"guangie88","id":557766,"node_id":"MDQ6VXNlcjU1Nzc2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/557766?v=4","gravatar_id":"","url":"https://api.github.com/users/guangie88","html_url":"https://github.com/guangie88","followers_url":"https://api.github.com/users/guangie88/followers","following_url":"https://api.github.com/users/guangie88/following{/other_user}","gists_url":"https://api.github.com/users/guangie88/gists{/gist_id}","starred_url":"https://api.github.com/users/guangie88/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guangie88/subscriptions","organizations_url":"https://api.github.com/users/guangie88/orgs","repos_url":"https://api.github.com/users/guangie88/repos","events_url":"https://api.github.com/users/guangie88/events{/privacy}","received_events_url":"https://api.github.com/users/guangie88/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":343542064,"node_id":"MDU6TGFiZWwzNDM1NDIwNjQ=","url":"https://api.github.com/repos/rwf2/Rocket/labels/bug","name":"bug","color":"B60205","default":true,"description":"Deviation from the specification or expected behavior"},{"id":567172509,"node_id":"MDU6TGFiZWw1NjcxNzI1MDk=","url":"https://api.github.com/repos/rwf2/Rocket/labels/upstream","name":"upstream","color":"cfd3d7","default":false,"description":"An unresolvable issue: an upstream dependency bug"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2017-05-25T13:34:10Z","updated_at":"2017-06-02T12:04:26Z","closed_at":"2017-06-02T05:13:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi, thanks very much for your work! Rocket is really easy to get started for doing web service.\r\n\r\nRecently I have encountered an issue while exposing some HTTP endpoint to perform a std::process::Command call, and this only happens on Windows 7 x64 / Windows Server 2008 x64. The exit code, stdout and stderr from the Command output are fine until a certain number of invokes from the HTTP client, and subsequently, the exit code becomes consistently erroneous.\r\n\r\nThe above issue does not occur on Windows 8.1 x64, Windows 10 x64 and also not on Linux distribution builds. As the executable was built statically on Windows, the executable built on Windows 7 could be run on other Windows versions without issue, but strangely not on Windows 7. I have also tried building on Windows 10 and run on Windows 7, but the issue still occurs.\r\n\r\nI have created a simple example using Rocket + Command (see link below) to demonstrate the issue. The program will expose the endpoint and let the self contained HTTP client execute the endpoint for 50 times to perform echo command. In my case, the issue occurs at around the 32nd iteration and onwards on Windows 7, where the exit code is no longer 0 and stdout is no longer correct.\r\n\r\nFor comparison, I have also created another example using Rouille (another link below) for comparison. The build works on all Windows versions.\r\n\r\nI am not sure if it is really an issue with Rocket, or it could be an issue with Windows 7 instead. My original post at Rust forum: [https://users.rust-lang.org/t/strange-crash-in-std-process-command-on-windows-7/10834](https://users.rust-lang.org/t/strange-crash-in-std-process-command-on-windows-7/10834) has more details and about my attempts at trying to find the cause of the issue.\r\n\r\n# Additional Details\r\n- Rocket Version: 0.2.6\r\n- Operating System: Windows 7 SP1 x64 / Windows Server 2008 R2 x64 (other OSs seem to work fine, including Ubuntu)\r\n- Build Used: rustc + Cargo nightly, MSVC Build Tools 2015, static link flags added (i.e. rustflags = [\"-Z\", \"unstable-options\", \"-C\", \"target-feature=+crt-static\"])\r\n\r\n## Rocket + Command (issue)\r\n[https://github.com/guangie88/rocket_cmd_bug](https://github.com/guangie88/rocket_cmd_bug)\r\n\r\nShould observe the issue by building and running without any arguments. The stdout log should display erroneous exit code at around 32nd iteration and onwards, only on Windows 7 / Windows Server 2008 R2. Should work fine for all newer Windows versions and also on Linux builds.\r\n\r\n## Rouille + Command variant (for comparison)\r\n[https://github.com/guangie88/rouille_cmd_ok](https://github.com/guangie88/rouille_cmd_ok)\r\n\r\nAlso can build and run without any arguments. The exit code and stdout in each entry should be 0 and 'hello' respectively.\r\n","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/299/timeline","performed_via_github_app":null,"state_reason":"completed"}