{"url":"https://api.github.com/repos/rwf2/Rocket/issues/2262","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/2262/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/2262/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/2262/events","html_url":"https://github.com/rwf2/Rocket/issues/2262","id":1299228666,"node_id":"I_kwDOAzqMt85NcKf6","number":2262,"title":"Support marking handler functions as deprecated","user":{"login":"matt-phylum","id":104793263,"node_id":"U_kgDOBj8Erw","avatar_url":"https://avatars.githubusercontent.com/u/104793263?v=4","gravatar_id":"","url":"https://api.github.com/users/matt-phylum","html_url":"https://github.com/matt-phylum","followers_url":"https://api.github.com/users/matt-phylum/followers","following_url":"https://api.github.com/users/matt-phylum/following{/other_user}","gists_url":"https://api.github.com/users/matt-phylum/gists{/gist_id}","starred_url":"https://api.github.com/users/matt-phylum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matt-phylum/subscriptions","organizations_url":"https://api.github.com/users/matt-phylum/orgs","repos_url":"https://api.github.com/users/matt-phylum/repos","events_url":"https://api.github.com/users/matt-phylum/events{/privacy}","received_events_url":"https://api.github.com/users/matt-phylum/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":758540633,"node_id":"MDU6TGFiZWw3NTg1NDA2MzM=","url":"https://api.github.com/repos/rwf2/Rocket/labels/suggestion","name":"suggestion","color":"5319E7","default":false,"description":"A suggestion to change functionality"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-07-08T16:29:11Z","updated_at":"2023-04-05T18:24:50Z","closed_at":"2023-04-05T18:24:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Existing Functionality**\r\n\r\nThe following code generates a warning about using a deprecated function.\r\n\r\n```rust\r\nuse rocket::{get, Build, Rocket, routes};\r\n\r\n#[get(\"/\")]\r\n#[deprecated]\r\nfn handler_without_docs() -> &'static str {\r\n    \"ok\"\r\n}\r\n\r\n#[rocket::launch]\r\n#[allow(deprecated)]\r\nfn launch() -> Rocket<Build> {\r\n    rocket::build()\r\n        .mount(\"/\", routes![handler_without_docs])\r\n}\r\n```\r\n\r\nThe deprecation warning is emitted on line 5 where the function is declared. This appears to be because Rocket's code generation is producing a type which has a function that calls the handler. This doesn't seem useful. The warning is emitted whenever a deprecated handler exists, whether it's used or not.\r\n\r\nAnnoyingly, adding `#[allow(deprecated)]` to the handler function has no effect on this warning. That allows the handler function to call deprecated functions, but has no effect on the generated struct calling the function.\r\n\r\nFor contrast, the following code does _not_ generate a warning about using a deprecated function even though it looks like it should.\r\n\r\n```rust\r\nuse rocket::{get, Build, Rocket, routes};\r\n\r\n#[allow(deprecated)]\r\nmod handlers {\r\n    use super::*;\r\n\r\n    #[get(\"/\")]\r\n    #[deprecated]\r\n    pub fn handler_without_docs() -> &'static str {\r\n        \"ok\"\r\n    }\r\n}\r\n\r\n#[rocket::launch]\r\nfn launch() -> Rocket<Build> {\r\n    rocket::build()\r\n        .mount(\"/\", routes![handlers::handler_without_docs])\r\n}\r\n```\r\n\r\n**Suggested Changes**\r\n\r\nWhen `#[get]` or similar is used on a deprecated function,\r\n1. the generated struct has `#[allow(deprecated)]` where it uses the handler function so a warning is not emitted where the function is declared.\r\n2. the generated struct may have `#[deprecated]` itself, such that mounting the route generates a deprecated warning. I'm not sure if this is useful, but it seems like an expected behavior since the user is using the struct as if it were the function and the function is deprecated.\r\n\r\n**Additional Context**\r\n\r\nThis would allow crates like `rocket_okapi` to use the `#[deprecated]` attribute for setting the `deprecated` property on the API spec.","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/2262/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/2262/timeline","performed_via_github_app":null,"state_reason":"completed"}