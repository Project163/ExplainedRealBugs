[{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/721836518","html_url":"https://github.com/rwf2/Rocket/issues/1466#issuecomment-721836518","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1466","id":721836518,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMTgzNjUxOA==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-04T16:30:55Z","updated_at":"2020-11-04T16:30:55Z","body":"Can you try this with the latest version from master? Does this reproduce?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/721836518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/721923148","html_url":"https://github.com/rwf2/Rocket/issues/1466#issuecomment-721923148","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1466","id":721923148,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMTkyMzE0OA==","user":{"login":"knutin","id":364484,"node_id":"MDQ6VXNlcjM2NDQ4NA==","avatar_url":"https://avatars.githubusercontent.com/u/364484?v=4","gravatar_id":"","url":"https://api.github.com/users/knutin","html_url":"https://github.com/knutin","followers_url":"https://api.github.com/users/knutin/followers","following_url":"https://api.github.com/users/knutin/following{/other_user}","gists_url":"https://api.github.com/users/knutin/gists{/gist_id}","starred_url":"https://api.github.com/users/knutin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/knutin/subscriptions","organizations_url":"https://api.github.com/users/knutin/orgs","repos_url":"https://api.github.com/users/knutin/repos","events_url":"https://api.github.com/users/knutin/events{/privacy}","received_events_url":"https://api.github.com/users/knutin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-04T19:16:33Z","updated_at":"2020-11-04T19:16:33Z","body":"Thanks for the quick reply!\r\n\r\nI should have been more clear. I see the issue with the latest commit from master (2f98299272a2a196a3d053918ebd542e03abfc70).","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/721923148/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"knutin","id":364484,"node_id":"MDQ6VXNlcjM2NDQ4NA==","avatar_url":"https://avatars.githubusercontent.com/u/364484?v=4","gravatar_id":"","url":"https://api.github.com/users/knutin","html_url":"https://github.com/knutin","followers_url":"https://api.github.com/users/knutin/followers","following_url":"https://api.github.com/users/knutin/following{/other_user}","gists_url":"https://api.github.com/users/knutin/gists{/gist_id}","starred_url":"https://api.github.com/users/knutin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/knutin/subscriptions","organizations_url":"https://api.github.com/users/knutin/orgs","repos_url":"https://api.github.com/users/knutin/repos","events_url":"https://api.github.com/users/knutin/events{/privacy}","received_events_url":"https://api.github.com/users/knutin/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3959540361,"node_id":"MDEyOkxhYmVsZWRFdmVudDM5NTk1NDAzNjE=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3959540361","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-11-04T21:23:59Z","label":{"name":"triage","color":"f9d0c4"},"performed_via_github_app":null},{"id":3959545651,"node_id":"MDEyOkxhYmVsZWRFdmVudDM5NTk1NDU2NTE=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3959545651","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-11-04T21:25:39Z","label":{"name":"deficiency","color":"fc2929"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/721992926","html_url":"https://github.com/rwf2/Rocket/issues/1466#issuecomment-721992926","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1466","id":721992926,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMTk5MjkyNg==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-04T21:48:01Z","updated_at":"2020-11-04T21:48:01Z","body":"Thanks for the quick reply! I was able to reproduce this locally. This is the minimal reproducing example:\r\n\r\n```rust\r\n#[rocket_contrib::database(\"hello\")]\r\npub struct HelloDb(rocket_contrib::databases::postgres::Client);\r\n\r\n#[rocket::launch]\r\nfn web() -> _ {\r\n    rocket::ignite().attach(HelloDb::fairing())\r\n}\r\n```\r\n\r\nRun, then kill with `ctrl-c`.\r\n\r\nThe issue occurs on `Drop`. Here's a backtrace for posterity:\r\n\r\n<details>\r\n <summary>Backtrace</summary>\r\n\r\n```sh\r\n> RUST_BACKTRACE=1 cargo run\r\nðŸ”§ Configured for debug.\r\n    => address: 127.0.0.1\r\n    => port: 8000\r\n    => workers: 64\r\n    => log level: normal\r\n    => secret key: [zero]\r\n    => limits: forms = 32KiB\r\n    => cli colors: true\r\n    => keep-alive: 5s\r\n    => tls: disabled\r\nðŸš€ Rocket has launched from http://127.0.0.1:8000\r\n^CServer shutdown requested, waiting for all pending requests to finish.\r\nthread 'main' panicked at 'Cannot drop a runtime in a context where blocking is not allowed. This happens when a runtime is dropped from within an asynchronous context.', /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/blocking/shutdown.rs:49:21\r\nstack backtrace:\r\n   0: std::panicking::begin_panic\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/panicking.rs:521:12\r\n   1: tokio::runtime::blocking::shutdown::Receiver::wait\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/blocking/shutdown.rs:49:21\r\n   2: tokio::runtime::blocking::pool::BlockingPool::shutdown\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/blocking/pool.rs:132:9\r\n   3: <tokio::runtime::blocking::pool::BlockingPool as core::ops::drop::Drop>::drop\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/blocking/pool.rs:138:9\r\n   4: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n   5: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n   6: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n   7: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n   8: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n   9: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  10: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  11: <alloc::vec::Vec<T> as core::ops::drop::Drop>::drop\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/vec.rs:2597:13\r\n  12: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  13: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  14: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  15: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  16: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  17: alloc::sync::Arc<T>::drop_slow\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/sync.rs:951:18\r\n  18: <alloc::sync::Arc<T> as core::ops::drop::Drop>::drop\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/sync.rs:1471:13\r\n  19: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  20: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  21: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  22: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  23: core::mem::drop\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/mem/mod.rs:882:24\r\n  24: <state::container::AnyObject as core::ops::drop::Drop>::drop\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/state-0.4.2/src/container.rs:125:13\r\n  25: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  26: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  27: core::ptr::mut_ptr::<impl *mut T>::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mut_ptr.rs:963:18\r\n  28: hashbrown::raw::Bucket<T>::drop\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/hashbrown-0.9.0/src/raw/mod.rs:334:9\r\n  29: <hashbrown::raw::RawTable<T> as core::ops::drop::Drop>::drop\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/hashbrown-0.9.0/src/raw/mod.rs:1325:25\r\n  30: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  31: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  32: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  33: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  34: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  35: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  36: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  37: alloc::sync::Arc<T>::drop_slow\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/sync.rs:951:18\r\n  38: <alloc::sync::Arc<T> as core::ops::drop::Drop>::drop\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/sync.rs:1471:13\r\n  39: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  40: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  41: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/c\r\nore/src/ptr/mod.rs:175:1\r\n  42: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  43: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  44: core::ptr::drop_in_place\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mod.rs:175:1\r\n  45: core::pin::Pin<P>::set\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/pin.rs:649:9\r\n  46: <hyper::server::shutdown::Graceful<I,S,F,E> as core::future::future::Future>::poll\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/hyper-0.13.9/src/server/shutdown.rs:86:13\r\n  47: rocket::server::<impl rocket::rocket::Rocket>::listen_on::{{closure}}\r\n             at /home/user/.cargo/git/checkouts/rocket-8bf16d9ca7e90bdc/007c4b0/core/lib/src/server.rs:383:9\r\n  48: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/future/mod.rs:80:19\r\n  49: <core::pin::Pin<P> as core::future::future::Future>::poll\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/future/future.rs:119:9\r\n  50: rocket::rocket::Rocket::launch::{{closure}}\r\n             at /home/user/.cargo/git/checkouts/rocket-8bf16d9ca7e90bdc/007c4b0/core/lib/src/rocket.rs:553:17\r\n  51: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/future/mod.rs:80:19\r\n  52: rocket_test_bug::main::{{closure}}\r\n             at ./src/main.rs:14:5\r\n  53: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/future/mod.rs:80:19\r\n  54: tokio::runtime::enter::Enter::block_on::{{closure}}\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/enter.rs:160:58\r\n  55: tokio::coop::with_budget::{{closure}}\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/coop.rs:127:9\r\n  56: std::thread::local::LocalKey<T>::try_with\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/thread/local.rs:272:16\r\n  57: std::thread::local::LocalKey<T>::with\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/thread/local.rs:248:9\r\n  58: tokio::coop::with_budget\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/coop.rs:120:5\r\n  59: tokio::coop::budget\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/coop.rs:96:5\r\n  60: tokio::runtime::enter::Enter::block_on\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/enter.rs:160:35\r\n  61: tokio::runtime::thread_pool::ThreadPool::block_on\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/thread_pool/mod.rs:82:9\r\n  62: tokio::runtime::Runtime::block_on::{{closure}}\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/mod.rs:446:39\r\n  63: tokio::runtime::context::enter\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/context.rs:72:5\r\n  64: tokio::runtime::handle::Handle::enter\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/handle.rs:76:9\r\n  65: tokio::runtime::Runtime::block_on\r\n             at /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.2.22/src/runtime/mod.rs:441:9\r\n  66: rocket::async_main\r\n             at /home/user/.cargo/git/checkouts/rocket-8bf16d9ca7e90bdc/007c4b0/core/lib/src/lib.rs:181:5\r\n  67: rocket_test_bug::main\r\n             at ./src/main.rs:13:17\r\n  68: core::ops::function::FnOnce::call_once\r\n             at /home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ops/function.rs:227:5\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```\r\n</details>\r\n\r\nThe only recent change to how fairings are handled was made in https://github.com/SergioBenitez/Rocket/commit/ec9b5816a8bb17c85037e5319c1f7d5f2c5e0385. The commit prior to this is https://github.com/SergioBenitez/Rocket/commit/491b229582e1257994e36209669e7dccb79e695a. The issue still occurs on this commit, however. Going even further back, we also find that the issue remains. Thus, this issue either existed for quite some time or was introduced by a change in `postgres`.\r\n\r\nThis issue _does not_ occur with `sqlite`, which is the only database we run during tests.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/721992926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/722008413","html_url":"https://github.com/rwf2/Rocket/issues/1466#issuecomment-722008413","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1466","id":722008413,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMjAwODQxMw==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-04T22:25:53Z","updated_at":"2020-11-04T22:36:30Z","body":"Okay, here's what's happening:\r\n\r\n  1. Rocket stores a `postgres::Client` in managed state as part of the postgres connection pool.\r\n  2. The pool is dropped when the server is finished, which happens at the end of tests or on shutdown.\r\n  3. This drops `Client`, which internally includes a [`Connection`](https://github.com/sfackler/rust-postgres/blob/170c5a5e13230a2c7696362be12476079bc5d282/postgres/src/client.rs#L12), which itself contains a [`Runtime`](https://github.com/sfackler/rust-postgres/blob/170c5a5e13230a2c7696362be12476079bc5d282/postgres/src/connection.rs#L15), and thus `Runtime` is dropped.\r\n  4. Since we're in an `async` context, `tokio` panics.\r\n\r\nIn effect, `postgres` is internally asynchronous but presents a synchronous API, storing a `Runtime`, which gets dropped while inside of Rocket's `Runtime`, which `tokio` considers illegal. In other words, `postgres` has not accounted for being used in an `async` context, and Rocket does not expect managed state to spawn their own `Runtime`.\r\n\r\nThis issue does not prevent starting or running an application that uses `postgres`, it simply inhibits a proper shutdown.\r\n\r\nI see a few viable paths forward:\r\n  1. Raise an issue with `postgres`, where [`shutdown_background()`](https://docs.rs/tokio/0.2.22/tokio/runtime/struct.Runtime.html#method.shutdown_background) can be used to resolve this issue, though this may not be tenable for `postgres`.\r\n  2. Drop support for `postgres` in `rocket_contrib`, prioritizing #1117 \r\n  3. Workaround managed state that starts its own runtime, perhaps by delaying their `Drop` until _after_ the Rocket `Runtime` is dropped.\r\n\r\n@jebrosen Would be curious if you have any thoughts here.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/722008413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3959724507,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mzk1OTcyNDUwNw==","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3959724507","actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-04T22:25:53Z","performed_via_github_app":null},{"id":3959724510,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5NTk3MjQ1MTA=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3959724510","actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-04T22:25:53Z","performed_via_github_app":null},{"id":3959724812,"node_id":"MDE0OlVubGFiZWxlZEV2ZW50Mzk1OTcyNDgxMg==","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3959724812","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2020-11-04T22:25:59Z","label":{"name":"triage","color":"f9d0c4"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/722012159","html_url":"https://github.com/rwf2/Rocket/issues/1466#issuecomment-722012159","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1466","id":722012159,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMjAxMjE1OQ==","user":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-04T22:36:04Z","updated_at":"2020-11-04T22:36:04Z","body":"2 seems reasonable, although mildly disappointing (did you mean to link to #1117 ?). For many projects, `postgres` -> `tokio_postgres` may even be a more straightforward and less error-prone transition to make than `postgres` -> `wrap run() calls around synchronous postgres`.\r\n\r\nAs a modification of 3, or perhaps an option 4, we might be able to use `spawn_blocking` or `thread::spawn` inside `impl<K, C> Drop for ConnectionPool<K, C>`, similarly to how it's already done with `Connection`.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/722012159/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/722013011","html_url":"https://github.com/rwf2/Rocket/issues/1466#issuecomment-722013011","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1466","id":722013011,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMjAxMzAxMQ==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-04T22:38:29Z","updated_at":"2020-11-04T22:38:29Z","body":"> 2 seems reasonable, although mildly disappointing (did you mean to link to #1117 ?). For many projects, `postgres` -> `tokio_postgres` may even be a more straightforward and less error-prone transition to make than `postgres` -> `wrap run() calls around synchronous postgres`.\r\n\r\nIndeed, and agreed.\r\n\r\n> As a modification of 3, or perhaps an option 4, we might be able to use `spawn_blocking` or `thread::spawn` inside `impl<K, C> Drop for ConnectionPool<K, C>`, similarly to how it's already done with `Connection`.\r\n\r\nIf it works, I'd be happy with this as a stop-gap solution until #1117 is resolved; I think it's important that we have an ergonomic, out-of-the-box solution for `postgres`. As a means of testing this, we can create a fake `Poolable` type that contains a `Runtime`.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/722013011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3959816515,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQzOTU5ODE2NTE1","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3959816515","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2020-11-04T23:01:15Z","assignee":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/722020876","html_url":"https://github.com/rwf2/Rocket/issues/1466#issuecomment-722020876","issue_url":"https://api.github.com/repos/rwf2/Rocket/issues/1466","id":722020876,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMjAyMDg3Ng==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-04T23:01:32Z","updated_at":"2020-11-04T23:01:32Z","body":"@jebrosen I'm assigning you to this. If you don't have the bandwidth, feel free to flip it right back at me.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/comments/722020876/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3959817277,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mzk1OTgxNzI3Nw==","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3959817277","actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-11-04T23:01:32Z","performed_via_github_app":null},{"id":3959817281,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5NTk4MTcyODE=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3959817281","actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-11-04T23:01:32Z","performed_via_github_app":null},{"id":3960465672,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM5NjA0NjU2NzI=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3960465672","actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"d38cc8766b36e193ca197e08616b435a3a221712","commit_url":"https://api.github.com/repos/jebrosen/Rocket/commits/d38cc8766b36e193ca197e08616b435a3a221712","created_at":"2020-11-05T04:16:40Z","performed_via_github_app":null},{"actor":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-05T04:19:58Z","updated_at":"2020-11-05T04:19:58Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1467","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/1467/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/1467/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/1467/events","html_url":"https://github.com/rwf2/Rocket/pull/1467","id":736598186,"node_id":"MDExOlB1bGxSZXF1ZXN0NTE1NzgyNzg4","number":1467,"title":"Drop synchronous connection pools on a blocking task.","user":{"login":"jebrosen","id":7102588,"node_id":"MDQ6VXNlcjcxMDI1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7102588?v=4","gravatar_id":"","url":"https://api.github.com/users/jebrosen","html_url":"https://github.com/jebrosen","followers_url":"https://api.github.com/users/jebrosen/followers","following_url":"https://api.github.com/users/jebrosen/following{/other_user}","gists_url":"https://api.github.com/users/jebrosen/gists{/gist_id}","starred_url":"https://api.github.com/users/jebrosen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jebrosen/subscriptions","organizations_url":"https://api.github.com/users/jebrosen/orgs","repos_url":"https://api.github.com/users/jebrosen/repos","events_url":"https://api.github.com/users/jebrosen/events{/privacy}","received_events_url":"https://api.github.com/users/jebrosen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-11-05T04:19:58Z","updated_at":"2020-11-23T01:03:43Z","closed_at":"2020-11-05T22:44:07Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":54168759,"node_id":"MDEwOlJlcG9zaXRvcnk1NDE2ODc1OQ==","name":"Rocket","full_name":"rwf2/Rocket","private":false,"owner":{"login":"rwf2","id":106361765,"node_id":"O_kgDOBlbzpQ","avatar_url":"https://avatars.githubusercontent.com/u/106361765?v=4","gravatar_id":"","url":"https://api.github.com/users/rwf2","html_url":"https://github.com/rwf2","followers_url":"https://api.github.com/users/rwf2/followers","following_url":"https://api.github.com/users/rwf2/following{/other_user}","gists_url":"https://api.github.com/users/rwf2/gists{/gist_id}","starred_url":"https://api.github.com/users/rwf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rwf2/subscriptions","organizations_url":"https://api.github.com/users/rwf2/orgs","repos_url":"https://api.github.com/users/rwf2/repos","events_url":"https://api.github.com/users/rwf2/events{/privacy}","received_events_url":"https://api.github.com/users/rwf2/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rwf2/Rocket","description":"A web framework for Rust.","fork":false,"url":"https://api.github.com/repos/rwf2/Rocket","forks_url":"https://api.github.com/repos/rwf2/Rocket/forks","keys_url":"https://api.github.com/repos/rwf2/Rocket/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rwf2/Rocket/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rwf2/Rocket/teams","hooks_url":"https://api.github.com/repos/rwf2/Rocket/hooks","issue_events_url":"https://api.github.com/repos/rwf2/Rocket/issues/events{/number}","events_url":"https://api.github.com/repos/rwf2/Rocket/events","assignees_url":"https://api.github.com/repos/rwf2/Rocket/assignees{/user}","branches_url":"https://api.github.com/repos/rwf2/Rocket/branches{/branch}","tags_url":"https://api.github.com/repos/rwf2/Rocket/tags","blobs_url":"https://api.github.com/repos/rwf2/Rocket/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rwf2/Rocket/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rwf2/Rocket/git/refs{/sha}","trees_url":"https://api.github.com/repos/rwf2/Rocket/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rwf2/Rocket/statuses/{sha}","languages_url":"https://api.github.com/repos/rwf2/Rocket/languages","stargazers_url":"https://api.github.com/repos/rwf2/Rocket/stargazers","contributors_url":"https://api.github.com/repos/rwf2/Rocket/contributors","subscribers_url":"https://api.github.com/repos/rwf2/Rocket/subscribers","subscription_url":"https://api.github.com/repos/rwf2/Rocket/subscription","commits_url":"https://api.github.com/repos/rwf2/Rocket/commits{/sha}","git_commits_url":"https://api.github.com/repos/rwf2/Rocket/git/commits{/sha}","comments_url":"https://api.github.com/repos/rwf2/Rocket/comments{/number}","issue_comment_url":"https://api.github.com/repos/rwf2/Rocket/issues/comments{/number}","contents_url":"https://api.github.com/repos/rwf2/Rocket/contents/{+path}","compare_url":"https://api.github.com/repos/rwf2/Rocket/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rwf2/Rocket/merges","archive_url":"https://api.github.com/repos/rwf2/Rocket/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rwf2/Rocket/downloads","issues_url":"https://api.github.com/repos/rwf2/Rocket/issues{/number}","pulls_url":"https://api.github.com/repos/rwf2/Rocket/pulls{/number}","milestones_url":"https://api.github.com/repos/rwf2/Rocket/milestones{/number}","notifications_url":"https://api.github.com/repos/rwf2/Rocket/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rwf2/Rocket/labels{/name}","releases_url":"https://api.github.com/repos/rwf2/Rocket/releases{/id}","deployments_url":"https://api.github.com/repos/rwf2/Rocket/deployments","created_at":"2016-03-18T02:50:18Z","updated_at":"2025-11-09T18:27:08Z","pushed_at":"2025-10-01T04:53:46Z","git_url":"git://github.com/rwf2/Rocket.git","ssh_url":"git@github.com:rwf2/Rocket.git","clone_url":"https://github.com/rwf2/Rocket.git","svn_url":"https://github.com/rwf2/Rocket","homepage":"https://rocket.rs","size":8445,"stargazers_count":25480,"watchers_count":25480,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":1614,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":84,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["framework","rocket","rust","web","web-development","web-framework"],"visibility":"public","forks":1614,"open_issues":84,"watchers":25480,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rwf2/Rocket/pulls/1467","html_url":"https://github.com/rwf2/Rocket/pull/1467","diff_url":"https://github.com/rwf2/Rocket/pull/1467.diff","patch_url":"https://github.com/rwf2/Rocket/pull/1467.patch","merged_at":"2020-11-05T22:44:07Z"},"body":"This was already done for the connections, but some connection pools might also do synchronous/blocking work on Drop. In particular, dropping a `Runtime` explicitly checks for this situation and panics.\r\n\r\nFixes #1466.","reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/1467/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/1467/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":3961068334,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM5NjEwNjgzMzQ=","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3961068334","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c6298b9e11a7bd78fc947a5f0f647758efa6a6fc","commit_url":"https://api.github.com/repos/jebrosen/Rocket/commits/c6298b9e11a7bd78fc947a5f0f647758efa6a6fc","created_at":"2020-11-05T08:07:47Z","performed_via_github_app":null},{"id":3964708877,"node_id":"MDExOkNsb3NlZEV2ZW50Mzk2NDcwODg3Nw==","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3964708877","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"c6298b9e11a7bd78fc947a5f0f647758efa6a6fc","commit_url":"https://api.github.com/repos/rwf2/Rocket/commits/c6298b9e11a7bd78fc947a5f0f647758efa6a6fc","created_at":"2020-11-05T22:44:07Z","state_reason":null,"performed_via_github_app":null},{"id":3964708885,"node_id":"MDExOkNsb3NlZEV2ZW50Mzk2NDcwODg4NQ==","url":"https://api.github.com/repos/rwf2/Rocket/issues/events/3964708885","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-11-05T22:44:07Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"mikolajsnioch","id":22744577,"node_id":"MDQ6VXNlcjIyNzQ0NTc3","avatar_url":"https://avatars.githubusercontent.com/u/22744577?v=4","gravatar_id":"","url":"https://api.github.com/users/mikolajsnioch","html_url":"https://github.com/mikolajsnioch","followers_url":"https://api.github.com/users/mikolajsnioch/followers","following_url":"https://api.github.com/users/mikolajsnioch/following{/other_user}","gists_url":"https://api.github.com/users/mikolajsnioch/gists{/gist_id}","starred_url":"https://api.github.com/users/mikolajsnioch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikolajsnioch/subscriptions","organizations_url":"https://api.github.com/users/mikolajsnioch/orgs","repos_url":"https://api.github.com/users/mikolajsnioch/repos","events_url":"https://api.github.com/users/mikolajsnioch/events{/privacy}","received_events_url":"https://api.github.com/users/mikolajsnioch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-31T14:06:36Z","updated_at":"2021-10-31T14:06:36Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues/161","repository_url":"https://api.github.com/repos/suharev7/clickhouse-rs","labels_url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues/161/labels{/name}","comments_url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues/161/comments","events_url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues/161/events","html_url":"https://github.com/suharev7/clickhouse-rs/issues/161","id":1040479784,"node_id":"I_kwDOCXrme84-BHYo","number":161,"title":"Using Clickhouse-rs in async context throws exceptions on shutdown","user":{"login":"mikolajsnioch","id":22744577,"node_id":"MDQ6VXNlcjIyNzQ0NTc3","avatar_url":"https://avatars.githubusercontent.com/u/22744577?v=4","gravatar_id":"","url":"https://api.github.com/users/mikolajsnioch","html_url":"https://github.com/mikolajsnioch","followers_url":"https://api.github.com/users/mikolajsnioch/followers","following_url":"https://api.github.com/users/mikolajsnioch/following{/other_user}","gists_url":"https://api.github.com/users/mikolajsnioch/gists{/gist_id}","starred_url":"https://api.github.com/users/mikolajsnioch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikolajsnioch/subscriptions","organizations_url":"https://api.github.com/users/mikolajsnioch/orgs","repos_url":"https://api.github.com/users/mikolajsnioch/repos","events_url":"https://api.github.com/users/mikolajsnioch/events{/privacy}","received_events_url":"https://api.github.com/users/mikolajsnioch/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-10-31T14:06:36Z","updated_at":"2021-10-31T22:38:52Z","closed_at":"2021-10-31T22:38:52Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":159049339,"node_id":"MDEwOlJlcG9zaXRvcnkxNTkwNDkzMzk=","name":"clickhouse-rs","full_name":"suharev7/clickhouse-rs","private":false,"owner":{"login":"suharev7","id":3521869,"node_id":"MDQ6VXNlcjM1MjE4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/3521869?v=4","gravatar_id":"","url":"https://api.github.com/users/suharev7","html_url":"https://github.com/suharev7","followers_url":"https://api.github.com/users/suharev7/followers","following_url":"https://api.github.com/users/suharev7/following{/other_user}","gists_url":"https://api.github.com/users/suharev7/gists{/gist_id}","starred_url":"https://api.github.com/users/suharev7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/suharev7/subscriptions","organizations_url":"https://api.github.com/users/suharev7/orgs","repos_url":"https://api.github.com/users/suharev7/repos","events_url":"https://api.github.com/users/suharev7/events{/privacy}","received_events_url":"https://api.github.com/users/suharev7/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/suharev7/clickhouse-rs","description":"Asynchronous ClickHouse client library for Rust programming language.","fork":false,"url":"https://api.github.com/repos/suharev7/clickhouse-rs","forks_url":"https://api.github.com/repos/suharev7/clickhouse-rs/forks","keys_url":"https://api.github.com/repos/suharev7/clickhouse-rs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/suharev7/clickhouse-rs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/suharev7/clickhouse-rs/teams","hooks_url":"https://api.github.com/repos/suharev7/clickhouse-rs/hooks","issue_events_url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues/events{/number}","events_url":"https://api.github.com/repos/suharev7/clickhouse-rs/events","assignees_url":"https://api.github.com/repos/suharev7/clickhouse-rs/assignees{/user}","branches_url":"https://api.github.com/repos/suharev7/clickhouse-rs/branches{/branch}","tags_url":"https://api.github.com/repos/suharev7/clickhouse-rs/tags","blobs_url":"https://api.github.com/repos/suharev7/clickhouse-rs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/suharev7/clickhouse-rs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/suharev7/clickhouse-rs/git/refs{/sha}","trees_url":"https://api.github.com/repos/suharev7/clickhouse-rs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/suharev7/clickhouse-rs/statuses/{sha}","languages_url":"https://api.github.com/repos/suharev7/clickhouse-rs/languages","stargazers_url":"https://api.github.com/repos/suharev7/clickhouse-rs/stargazers","contributors_url":"https://api.github.com/repos/suharev7/clickhouse-rs/contributors","subscribers_url":"https://api.github.com/repos/suharev7/clickhouse-rs/subscribers","subscription_url":"https://api.github.com/repos/suharev7/clickhouse-rs/subscription","commits_url":"https://api.github.com/repos/suharev7/clickhouse-rs/commits{/sha}","git_commits_url":"https://api.github.com/repos/suharev7/clickhouse-rs/git/commits{/sha}","comments_url":"https://api.github.com/repos/suharev7/clickhouse-rs/comments{/number}","issue_comment_url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues/comments{/number}","contents_url":"https://api.github.com/repos/suharev7/clickhouse-rs/contents/{+path}","compare_url":"https://api.github.com/repos/suharev7/clickhouse-rs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/suharev7/clickhouse-rs/merges","archive_url":"https://api.github.com/repos/suharev7/clickhouse-rs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/suharev7/clickhouse-rs/downloads","issues_url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues{/number}","pulls_url":"https://api.github.com/repos/suharev7/clickhouse-rs/pulls{/number}","milestones_url":"https://api.github.com/repos/suharev7/clickhouse-rs/milestones{/number}","notifications_url":"https://api.github.com/repos/suharev7/clickhouse-rs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/suharev7/clickhouse-rs/labels{/name}","releases_url":"https://api.github.com/repos/suharev7/clickhouse-rs/releases{/id}","deployments_url":"https://api.github.com/repos/suharev7/clickhouse-rs/deployments","created_at":"2018-11-25T16:03:52Z","updated_at":"2025-11-03T19:24:02Z","pushed_at":"2024-07-16T18:33:44Z","git_url":"git://github.com/suharev7/clickhouse-rs.git","ssh_url":"git@github.com:suharev7/clickhouse-rs.git","clone_url":"https://github.com/suharev7/clickhouse-rs.git","svn_url":"https://github.com/suharev7/clickhouse-rs","homepage":"","size":815,"stargazers_count":339,"watchers_count":339,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":125,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":63,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["clickhouse","clickhouse-client","rust","tokio"],"visibility":"public","forks":125,"open_issues":63,"watchers":339,"default_branch":"async-await","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I am using clickhouse-rs in a gui application. It works as expected until I try to close the program. When I do, I get an exception for each ClientHandle that was created:\r\n\r\n`Cannot drop a runtime in a context where blocking is not allowed. This happens when a runtime is dropped from within an asynchronous context.`\r\n\r\nI reviewed the stack trace and with some web search found that this issue has happened before with other crates. First the relevant part of the stack trace (full stack trace at the bottom):\r\n```\r\n 13:     0x562f0dc6cc89 - std::panicking::begin_panic::ha46902d46371d310\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:541:12\r\n  14:     0x562f0dc0e43f - tokio::runtime::blocking::shutdown::Receiver::wait::h936f598116b25343\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.12.0/src/runtime/blocking/shutdown.rs:51:21\r\n  15:     0x562f0dbea27a - tokio::runtime::blocking::pool::BlockingPool::shutdown::h8ff67935fe502e92\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.12.0/src/runtime/blocking/pool.rs:145:12\r\n```\r\n\r\nThis Rocket issue has a stack trace with identical part as quoted and it seems to me it is the same problem as the one I am experiencing: https://github.com/SergioBenitez/Rocket/issues/1466 . This comment in particular should be helpful: https://github.com/SergioBenitez/Rocket/issues/1466#issuecomment-722008413\r\n\r\nMy Cargo.toml has this: `clickhouse-rs = { git = \"https://github.com/suharev7/clickhouse-rs\" }`\r\n\r\nFull Stack Trace:\r\n```\r\nstack backtrace:\r\n   0:     0x562f0dca4010 - std::backtrace_rs::backtrace::libunwind::trace::h34055254b57d8e79\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/../../backtrace/src/backtrace/libunwind.rs:90:5\r\n   1:     0x562f0dca4010 - std::backtrace_rs::backtrace::trace_unsynchronized::h8f1e3fbd9afff6ec\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:     0x562f0dca4010 - std::sys_common::backtrace::_print_fmt::h3a99a796b770c360\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:67:5\r\n   3:     0x562f0dca4010 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h32d1f94a80615d18\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:46:22\r\n   4:     0x562f0dcc711c - core::fmt::write::h306731c068f7162c\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/fmt/mod.rs:1110:17\r\n   5:     0x562f0dc9e765 - std::io::Write::write_fmt::hd2fa90334eee2a21\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/io/mod.rs:1588:15\r\n   6:     0x562f0dca625b - std::sys_common::backtrace::_print::h5abaa2601a852287\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:49:5\r\n   7:     0x562f0dca625b - std::sys_common::backtrace::print::h8d81445442bb638f\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:36:9\r\n   8:     0x562f0dca625b - std::panicking::default_hook::{{closure}}::hcfe804496a9fa747\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:208:50\r\n   9:     0x562f0dca5d31 - std::panicking::default_hook::hbea8e3ccf2ba8901\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:225:9\r\n  10:     0x562f0dca6924 - std::panicking::rust_panic_with_hook::h7ee9e1a2d0f8975a\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:622:17\r\n  11:     0x562f0dc6cd53 - std::panicking::begin_panic::{{closure}}::hd4eb21342d44c021\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:542:9\r\n  12:     0x562f0dc6ad79 - std::sys_common::backtrace::__rust_end_short_backtrace::h9eaf511fbe9e3435\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:141:18\r\n  13:     0x562f0dc6cc89 - std::panicking::begin_panic::ha46902d46371d310\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:541:12\r\n  14:     0x562f0dc0e43f - tokio::runtime::blocking::shutdown::Receiver::wait::h936f598116b25343\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.12.0/src/runtime/blocking/shutdown.rs:51:21\r\n  15:     0x562f0dbea27a - tokio::runtime::blocking::pool::BlockingPool::shutdown::h8ff67935fe502e92\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.12.0/src/runtime/blocking/pool.rs:145:12\r\n  16:     0x562f0dbea7bc - <tokio::runtime::blocking::pool::BlockingPool as core::ops::drop::Drop>::drop::h8874b5990f5d8c8b\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.12.0/src/runtime/blocking/pool.rs:162:9\r\n  17:     0x562f0dbf6717 - core::ptr::drop_in_place<tokio::runtime::blocking::pool::BlockingPool>::he6b7d104b7012f54\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/ptr/mod.rs:192:1\r\n  18:     0x562f0dbf51da - core::ptr::drop_in_place<tokio::runtime::Runtime>::h194b4ea87d98392f\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/ptr/mod.rs:192:1\r\n  19:     0x562f0d1898fb - core::ptr::drop_in_place<iced::executor::platform::Default>::h1dc7da28f895166c\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/ptr/mod.rs:192:1\r\n  20:     0x562f0d187273 - core::ptr::drop_in_place<iced_futures::runtime::Runtime<iced_native::hasher::Hasher,(iced_native::event::Event,iced_native::event::Status),iced::executor::platform::Default,iced_winit::proxy::Proxy<shamancharts::gui::Message>,shamancharts::gui::Message>>::h037f2145db12255d\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/ptr/mod.rs:192:1\r\n  21:     0x562f0d057bb4 - iced_glutin::application::run_instance::{{closure}}::h7b41be065ecd89cf\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/iced_glutin-0.2.0/src/application.rs:152:1\r\n  22:     0x562f0d1dc81b - <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll::h87e6c07b9d709973\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/future/mod.rs:80:19\r\n  23:     0x562f0d059525 - iced_glutin::application::run::{{closure}}::hafad2ead72816c1c\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/iced_glutin-0.2.0/src/application.rs:129:24\r\n  24:     0x562f0d07ea47 - winit::platform_impl::platform::sticky_exit_callback::h711cb15aaf3950ea\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/winit-0.24.0/src/platform_impl/linux/mod.rs:736:5\r\n  25:     0x562f0d148e75 - winit::platform_impl::platform::wayland::event_loop::EventLoop<T>::run_return::h1562a4a17cf9624b\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/winit-0.24.0/src/platform_impl/linux/wayland/event_loop/mod.rs:323:21\r\n  26:     0x562f0d14cb74 - winit::platform_impl::platform::wayland::event_loop::EventLoop<T>::run::h32d16db522d92f9c\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/winit-0.24.0/src/platform_impl/linux/wayland/event_loop/mod.rs:191:9\r\n  27:     0x562f0d07e879 - winit::platform_impl::platform::EventLoop<T>::run::hbf8112fd6f899dc0\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/winit-0.24.0/src/platform_impl/linux/mod.rs:652:56\r\n  28:     0x562f0d120c66 - winit::event_loop::EventLoop<T>::run::hc37b6b5378b56152\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/winit-0.24.0/src/event_loop.rs:154:9\r\n  29:     0x562f0d0590cb - iced_glutin::application::run::h037a82d448df2ce1\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/iced_glutin-0.2.0/src/application.rs:104:5\r\n  30:     0x562f0d0b32f6 - iced::application::Application::run::hfca1acc51af9aa6c\r\n                               at /home/mks/.cargo/registry/src/github.com-1ecc6299db9ec823/iced-0.3.0/src/application.rs:219:16\r\n  31:     0x562f0d103561 - shamancharts::main::{{closure}}::h7c39bf1d3ab03c6b\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues/161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/suharev7/clickhouse-rs/issues/161/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]