{"url":"https://api.github.com/repos/rwf2/Rocket/issues/808","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/808/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/808/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/808/events","html_url":"https://github.com/rwf2/Rocket/issues/808","id":376490777,"node_id":"MDU6SXNzdWUzNzY0OTA3Nzc=","number":808,"title":"behavior of Uri::percent_encode seems incompatibile with uri parsing  in 0.4-rc","user":{"login":"macpp","id":24246407,"node_id":"MDQ6VXNlcjI0MjQ2NDA3","avatar_url":"https://avatars.githubusercontent.com/u/24246407?v=4","gravatar_id":"","url":"https://api.github.com/users/macpp","html_url":"https://github.com/macpp","followers_url":"https://api.github.com/users/macpp/followers","following_url":"https://api.github.com/users/macpp/following{/other_user}","gists_url":"https://api.github.com/users/macpp/gists{/gist_id}","starred_url":"https://api.github.com/users/macpp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/macpp/subscriptions","organizations_url":"https://api.github.com/users/macpp/orgs","repos_url":"https://api.github.com/users/macpp/repos","events_url":"https://api.github.com/users/macpp/events{/privacy}","received_events_url":"https://api.github.com/users/macpp/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":343542064,"node_id":"MDU6TGFiZWwzNDM1NDIwNjQ=","url":"https://api.github.com/repos/rwf2/Rocket/labels/bug","name":"bug","color":"B60205","default":true,"description":"Deviation from the specification or expected behavior"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-11-01T17:27:30Z","updated_at":"2018-11-02T07:14:21Z","closed_at":"2018-11-02T07:14:21Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"i have following example build using rocket v0.3.17 :\r\n```rust \r\n#![feature(plugin)]\r\n#![plugin(rocket_codegen)]\r\nextern crate rocket;\r\nuse rocket::response::Redirect;\r\nuse rocket::http::uri::URI;\r\n\r\n#[get(\"/hello/<name>\")]\r\nfn hello(name: String) -> String {\r\n    format!(\"Hello, {} !\", name)\r\n}\r\n#[get(\"/\")]\r\nfn redirect() -> Redirect {\r\n    let name = \"John[]|\\\\\";\r\n    Redirect::to(&format!(\"/hello/{}\", URI::percent_encode(name)))\r\n}\r\n\r\nfn main() {\r\n    rocket::ignite().mount(\"/\", routes![hello, redirect]).launch();\r\n}\r\n```\r\nbrowsing localhost:8000 simply results in redirect and  seeing `Hello, John[]| !`\r\ni tried to migrate it to rocket 0.4-rc (i hope that this migration is not messed up) :\r\n```rust\r\n#![feature(proc_macro_hygiene, decl_macro)]\r\n#[macro_use]\r\nextern crate rocket;\r\nuse rocket::response::Redirect;\r\nuse rocket::http::uri::Uri;\r\n\r\n#[get(\"/hello/<name>\")]\r\nfn hello(name: String) -> String {\r\n    format!(\"Hello, {} !\", name)\r\n}\r\n#[get(\"/\")]\r\nfn redirect() -> Redirect {\r\n    let name = \"John[]|\\\\\";\r\n    Redirect::to(format!(\"/hello/{}\", Uri::percent_encode(name)))\r\n}\r\nfn main() {\r\n    rocket::ignite().mount(\"/\", routes![hello, redirect]).launch();\r\n}\r\n```\r\nthis time, browsing localhost:8000 results in Internal server error, and no redirect. This seems incorrect. \r\nconsole output :\r\n```\r\n    => Matched: GET / (redirect)\r\nError: Invalid URI used for redirect.\r\n    => Outcome: Failure\r\n    => Warning: Responding with 500 Internal Server Error catcher.\r\n```\r\nadditionaly, if i try browse `http://localhost:8000/hello/John[]|` directly i get \r\n```\r\n400: Bad Request\r\nThe request could not be understood by the server due to malformed syntax.\r\n```\r\n console output: \r\n```\r\nError: Bad incoming request: expected EOF but found '[' at index 11\r\n    => Warning: Responding with 400 Bad Request catcher.\r\n```\r\nthis (calling /hello without encoding `John[]|`)  worked in v0.3.17\r\n\r\ni checked rocket's source code, and it seems that percent_encode doesn't encode following symbols : `[` , `]` , `|`, `\\`. It seems that in v0.4-rc  any of this symbols causes some kind of uri parsing error. \r\n\r\nad-hoc solution to this problem is using extended encode set:\r\n```rust\r\npercent_encoding::define_encode_set! (\r\n    pub EXTENDED_ENCODING_SET = [percent_encoding::PATH_SEGMENT_ENCODE_SET] | {'[', ']' ,'|' , '\\\\'  }\r\n);\r\npub fn encode_uri(to_encode: &str) -> String {\r\n    percent_encoding::utf8_percent_encode(to_encode, EXTENDED_ENCODING_SET).to_string()\r\n}\r\n```\r\nwith this encoding set, exaple works again. I have no information about any other symbol that causes this problem, but there can be more.\r\n\r\nThis problem seems like mismatch between uri parsing and current encoding set in Uri::percent_encode.\r\n\r\nAnyway, thank you for developing rocket. I really like this framework !\r\n\r\n**Update:**\r\nI also tried to use uri! macro :\r\n```rust\r\nRedirect::to(uri!(hello: name = \"John[]|\\\\\"))\r\n```\r\nwith uri! macro Redirect works, but /hello still fails with \r\n```\r\nError: Bad incoming request: expected EOF but found '[' at index 11\r\n    => Warning: Responding with 400 Bad Request catcher.\r\n```\r\n","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/808/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/808/timeline","performed_via_github_app":null,"state_reason":"completed"}