{"url":"https://api.github.com/repos/rwf2/Rocket/issues/772","repository_url":"https://api.github.com/repos/rwf2/Rocket","labels_url":"https://api.github.com/repos/rwf2/Rocket/issues/772/labels{/name}","comments_url":"https://api.github.com/repos/rwf2/Rocket/issues/772/comments","events_url":"https://api.github.com/repos/rwf2/Rocket/issues/772/events","html_url":"https://github.com/rwf2/Rocket/issues/772","id":359229412,"node_id":"MDU6SXNzdWUzNTkyMjk0MTI=","number":772,"title":"Return invalid JSON String when JSON fails to parse","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":343542068,"node_id":"MDU6TGFiZWwzNDM1NDIwNjg=","url":"https://api.github.com/repos/rwf2/Rocket/labels/enhancement","name":"enhancement","color":"5319E7","default":true,"description":"A minor feature request"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rwf2/Rocket/milestones/5","html_url":"https://github.com/rwf2/Rocket/milestone/5","labels_url":"https://api.github.com/repos/rwf2/Rocket/milestones/5/labels","id":2216546,"node_id":"MDk6TWlsZXN0b25lMjIxNjU0Ng==","number":5,"title":"0.4.0","description":null,"creator":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":24,"state":"closed","created_at":"2016-12-27T08:21:17Z","updated_at":"2019-07-25T23:19:38Z","due_on":null,"closed_at":"2019-07-25T23:19:38Z"},"comments":0,"created_at":"2018-09-11T21:23:07Z","updated_at":"2018-09-19T02:07:47Z","closed_at":"2018-09-19T02:07:47Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is an extraction of a comment from https://github.com/SergioBenitez/Rocket/pull/762.\r\n\r\nIn short: Rocket's `Json` data guard should return the invalid JSON `String` when it fails to parse as JSON.\r\n\r\n> When receiving a webhook or other types of API requests, often times the contract is unclear, or the deviation from the contract can be hard to diagnose without the raw JSON body which was actually sent.\r\n\r\nWhy don't we simply change the existing `FromData` impl for `Json` so that it also returns the `String` in the error case? Something like:\r\n\r\n```rust\r\n#[derive(Clone, PartialEq, etc..)]\r\npub enum JsonError {\r\n    /// An I/O error occurred while reading the incoming request data.\r\n    Io(io::Error),\r\n    /// The client's data was received successfully but failed to parse as valid JSON. The\r\n    /// `String` value in `.0` is the raw data received from the user, while the `SerdeError`\r\n    /// in `.1` is the deserialization error.\r\n    InvalidJson(String, SerdeError),\r\n}\r\n\r\nimpl<T: DeserializeOwned> FromData for Json<T> {\r\n    type Error = JsonError;\r\n    \r\n    ...\r\n}\r\n```\r\n\r\nThen you can simply use `Result` in a handler as today, but with more information:\r\n\r\n```rust\r\n#[post(\"/\", data = \"<json>\")]\r\nfn handler(json: Result<Json<MyValue>, JsonError>) {\r\n    match json {\r\n        Ok(value) => println!(\"The value: {:?}\", value),\r\n        Err(JsonError::Io(e)) => println!(\"I/O Error: {:?}\", e),\r\n        Err(JsonError::InvalidJson(raw, e)) => println!(\"{:?} is not valid JSON: {:?}\", raw, e),\r\n    }\r\n}\r\n```\r\n","closed_by":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rwf2/Rocket/issues/772/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rwf2/Rocket/issues/772/timeline","performed_via_github_app":null,"state_reason":"completed"}