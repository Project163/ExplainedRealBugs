diff --git a/test/EFCore.Analyzers.Tests/Utilities/CSharpAnalyzerVerifier.cs b/test/EFCore.Analyzers.Tests/TestUtilities/CSharpAnalyzerVerifier.cs
similarity index 97%
rename from test/EFCore.Analyzers.Tests/Utilities/CSharpAnalyzerVerifier.cs
rename to test/EFCore.Analyzers.Tests/TestUtilities/CSharpAnalyzerVerifier.cs
index 98a607c35f..58699a7549 100644
--- a/test/EFCore.Analyzers.Tests/Utilities/CSharpAnalyzerVerifier.cs
+++ b/test/EFCore.Analyzers.Tests/TestUtilities/CSharpAnalyzerVerifier.cs
@@ -12,7 +12,7 @@
 using Microsoft.Extensions.DependencyModel;
 using CompilationOptions = Microsoft.CodeAnalysis.CompilationOptions;
 
-namespace Microsoft.EntityFrameworkCore.Utilities;
+namespace Microsoft.EntityFrameworkCore.TestUtilities;
 
 public static class CSharpAnalyzerVerifier<TAnalyzer>
     where TAnalyzer : DiagnosticAnalyzer, new()
diff --git a/test/EFCore.Analyzers.Tests/Utilities/CSharpCodeFixVerifier.cs b/test/EFCore.Analyzers.Tests/TestUtilities/CSharpCodeFixVerifier.cs
similarity index 97%
rename from test/EFCore.Analyzers.Tests/Utilities/CSharpCodeFixVerifier.cs
rename to test/EFCore.Analyzers.Tests/TestUtilities/CSharpCodeFixVerifier.cs
index b726900388..91db7a206f 100644
--- a/test/EFCore.Analyzers.Tests/Utilities/CSharpCodeFixVerifier.cs
+++ b/test/EFCore.Analyzers.Tests/TestUtilities/CSharpCodeFixVerifier.cs
@@ -11,7 +11,7 @@
 using Microsoft.CodeAnalysis.Testing.Verifiers;
 using Microsoft.Extensions.DependencyModel;
 
-namespace Microsoft.EntityFrameworkCore.Utilities;
+namespace Microsoft.EntityFrameworkCore.TestUtilities;
 
 public static class CSharpCodeFixVerifier<TAnalyzer, TCodeFix>
     where TAnalyzer : DiagnosticAnalyzer, new()
diff --git a/test/EFCore.AspNet.Specification.Tests/EntityTypeMapping.cs b/test/EFCore.AspNet.Specification.Tests/TestUtilities/EntityTypeMapping.cs
similarity index 98%
rename from test/EFCore.AspNet.Specification.Tests/EntityTypeMapping.cs
rename to test/EFCore.AspNet.Specification.Tests/TestUtilities/EntityTypeMapping.cs
index 9d3099e593..84c3c649fb 100644
--- a/test/EFCore.AspNet.Specification.Tests/EntityTypeMapping.cs
+++ b/test/EFCore.AspNet.Specification.Tests/TestUtilities/EntityTypeMapping.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.TestUtilities;
 
 public class EntityTypeMapping
 {
diff --git a/test/EFCore.AspNet.Specification.Tests/FakeLogger.cs b/test/EFCore.AspNet.Specification.Tests/TestUtilities/FakeLogger.cs
similarity index 90%
rename from test/EFCore.AspNet.Specification.Tests/FakeLogger.cs
rename to test/EFCore.AspNet.Specification.Tests/TestUtilities/FakeLogger.cs
index 76886dbad5..670ab04427 100644
--- a/test/EFCore.AspNet.Specification.Tests/FakeLogger.cs
+++ b/test/EFCore.AspNet.Specification.Tests/TestUtilities/FakeLogger.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.TestUtilities;
 
 public class FakeLogger<T> : ILogger<T>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/BuiltInDataTypesCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/BuiltInDataTypesCosmosTest.cs
index c614e65ac4..e5e16bec7e 100644
--- a/test/EFCore.Cosmos.FunctionalTests/BuiltInDataTypesCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/BuiltInDataTypesCosmosTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.Metadata.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class BuiltInDataTypesCosmosTest : BuiltInDataTypesTestBase<BuiltInDataTypesCosmosTest.BuiltInDataTypesCosmosFixture>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/ConcurrencyDetectorDisabledCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/ConcurrencyDetectorDisabledCosmosTest.cs
index 64600ee488..82091087b2 100644
--- a/test/EFCore.Cosmos.FunctionalTests/ConcurrencyDetectorDisabledCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/ConcurrencyDetectorDisabledCosmosTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class ConcurrencyDetectorDisabledCosmosTest : ConcurrencyDetectorDisabledTestBase<
     ConcurrencyDetectorDisabledCosmosTest.ConcurrencyDetectorCosmosFixture>
diff --git a/test/EFCore.Cosmos.FunctionalTests/ConcurrencyDetectorEnabledCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/ConcurrencyDetectorEnabledCosmosTest.cs
index 3fdd1eb0e2..186e18b5aa 100644
--- a/test/EFCore.Cosmos.FunctionalTests/ConcurrencyDetectorEnabledCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/ConcurrencyDetectorEnabledCosmosTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class ConcurrencyDetectorEnabledCosmosTest : ConcurrencyDetectorEnabledTestBase<
     ConcurrencyDetectorEnabledCosmosTest.ConcurrencyDetectorCosmosFixture>
diff --git a/test/EFCore.Cosmos.FunctionalTests/ConfigPatternsCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/ConfigPatternsCosmosTest.cs
index daaa5d8b6f..7c5743fe1d 100644
--- a/test/EFCore.Cosmos.FunctionalTests/ConfigPatternsCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/ConfigPatternsCosmosTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.Azure.Cosmos;
 
 // ReSharper disable UnusedAutoPropertyAccessor.Local
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class ConfigPatternsCosmosTest : IClassFixture<ConfigPatternsCosmosTest.CosmosFixture>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/ConnectionSpecificationTest.cs b/test/EFCore.Cosmos.FunctionalTests/ConnectionSpecificationTest.cs
index 2af29c8abb..61191e85c2 100644
--- a/test/EFCore.Cosmos.FunctionalTests/ConnectionSpecificationTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/ConnectionSpecificationTest.cs
@@ -4,7 +4,7 @@
 using Azure.Core;
 using Microsoft.EntityFrameworkCore.Cosmos.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class ConnectionSpecificationTest
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/CosmosApiConsistencyTest.cs b/test/EFCore.Cosmos.FunctionalTests/CosmosApiConsistencyTest.cs
index 715f8ef9eb..4ce47ae1b8 100644
--- a/test/EFCore.Cosmos.FunctionalTests/CosmosApiConsistencyTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/CosmosApiConsistencyTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.Cosmos.Storage.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class CosmosApiConsistencyTest : ApiConsistencyTestBase<CosmosApiConsistencyTest.CosmosApiConsistencyFixture>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/CosmosConcurrencyTest.cs b/test/EFCore.Cosmos.FunctionalTests/CosmosConcurrencyTest.cs
index d4a68960e3..95bb2239c0 100644
--- a/test/EFCore.Cosmos.FunctionalTests/CosmosConcurrencyTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/CosmosConcurrencyTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class CosmosConcurrencyTest : IClassFixture<CosmosConcurrencyTest.CosmosFixture>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/CustomConvertersCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/CustomConvertersCosmosTest.cs
index bba359542b..2fd9bf38d1 100644
--- a/test/EFCore.Cosmos.FunctionalTests/CustomConvertersCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/CustomConvertersCosmosTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.Metadata.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class CustomConvertersCosmosTest : CustomConvertersTestBase<CustomConvertersCosmosTest.CustomConvertersCosmosFixture>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/EFCore.Cosmos.FunctionalTests.csproj b/test/EFCore.Cosmos.FunctionalTests/EFCore.Cosmos.FunctionalTests.csproj
index 8e2607a224..edc57ccc7e 100644
--- a/test/EFCore.Cosmos.FunctionalTests/EFCore.Cosmos.FunctionalTests.csproj
+++ b/test/EFCore.Cosmos.FunctionalTests/EFCore.Cosmos.FunctionalTests.csproj
@@ -59,4 +59,8 @@
     <PackageReference Include="Azure.Identity" Version="1.10.3" />
   </ItemGroup>
 
+  <ItemGroup>
+    <Folder Include="Internal\" />
+  </ItemGroup>
+
 </Project>
diff --git a/test/EFCore.Cosmos.FunctionalTests/EmbeddedDocumentsTest.cs b/test/EFCore.Cosmos.FunctionalTests/EmbeddedDocumentsTest.cs
index eaa6a81215..eac7800712 100644
--- a/test/EFCore.Cosmos.FunctionalTests/EmbeddedDocumentsTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/EmbeddedDocumentsTest.cs
@@ -6,7 +6,7 @@
 using Newtonsoft.Json.Linq;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class EmbeddedDocumentsTest : IClassFixture<EmbeddedDocumentsTest.CosmosFixture>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/EndToEndCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/EndToEndCosmosTest.cs
index 3013f0c61b..95b8992ea2 100644
--- a/test/EFCore.Cosmos.FunctionalTests/EndToEndCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/EndToEndCosmosTest.cs
@@ -8,7 +8,7 @@
 using Newtonsoft.Json.Linq;
 
 // ReSharper disable UnusedMember.Local
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class EndToEndCosmosTest : IClassFixture<EndToEndCosmosTest.CosmosFixture>
 {
@@ -627,6 +627,92 @@ public async Task Can_add_update_delete_with_dateTime_string_end_to_end_async()
             Assert.Empty(await context.Set<Customer>().ToListAsync());
         }
     }
+    [ConditionalFact]
+    public async Task Entities_with_null_PK_can_be_added_with_normal_use_of_DbContext_methods_and_have_id_shadow_value_and_PK_created()
+    {
+        await using var testDatabase = CosmosTestStore.Create("IdentifierShadowValuePresenceTest");
+        using var context = new IdentifierShadowValuePresenceTestContext(testDatabase);
+
+        var item = new GItem();
+
+        Assert.Null(item.Id);
+
+        var entry = await context.AddAsync(item);
+
+        var id = entry.Property("__id").CurrentValue;
+
+        Assert.NotNull(item.Id);
+        Assert.NotNull(id);
+
+        Assert.Equal($"GItem|{item.Id}", id);
+        Assert.Equal(EntityState.Added, entry.State);
+    }
+
+    [ConditionalFact]
+    public async Task
+        Entities_can_be_tracked_with_normal_use_of_DbContext_methods_and_have_correct_resultant_state_and_id_shadow_value()
+    {
+        await using var testDatabase = CosmosTestStore.Create("IdentifierShadowValuePresenceTest");
+        using var context = new IdentifierShadowValuePresenceTestContext(testDatabase);
+
+        var item = new Item { Id = 1337 };
+        var entry = context.Attach(item);
+
+        Assert.Equal($"Item|{item.Id}", entry.Property("__id").CurrentValue);
+        Assert.Equal(EntityState.Unchanged, entry.State);
+
+        entry.State = EntityState.Detached;
+        entry = context.Update(item = new Item { Id = 71 });
+
+        Assert.Equal($"Item|{item.Id}", entry.Property("__id").CurrentValue);
+        Assert.Equal(EntityState.Modified, entry.State);
+
+        entry.State = EntityState.Detached;
+        entry = context.Remove(item = new Item { Id = 33 });
+
+        Assert.Equal($"Item|{item.Id}", entry.Property("__id").CurrentValue);
+        Assert.Equal(EntityState.Deleted, entry.State);
+    }
+
+    protected class IdentifierShadowValuePresenceTestContext : DbContext
+    {
+        private readonly string _connectionUri;
+        private readonly string _authToken;
+        private readonly string _name;
+
+        public IdentifierShadowValuePresenceTestContext(CosmosTestStore testStore)
+        {
+            _connectionUri = testStore.ConnectionUri;
+            _authToken = testStore.AuthToken;
+            _name = testStore.Name;
+        }
+
+        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
+            => optionsBuilder
+                .UseCosmos(
+                    _connectionUri,
+                    _authToken,
+                    _name,
+                    b => b.ApplyConfiguration());
+
+        protected override void OnModelCreating(ModelBuilder modelBuilder)
+        {
+        }
+
+        public DbSet<GItem> GItems { get; set; }
+
+        public DbSet<Item> Items { get; set; }
+    }
+
+    protected class GItem
+    {
+        public Guid? Id { get; set; }
+    }
+
+    protected class Item
+    {
+        public int Id { get; set; }
+    }
 
     [ConditionalFact]
     public async Task Can_add_update_delete_with_collections()
diff --git a/test/EFCore.Cosmos.FunctionalTests/F1CosmosFixture.cs b/test/EFCore.Cosmos.FunctionalTests/F1CosmosFixture.cs
index 3e2668bb36..c2fa92a119 100644
--- a/test/EFCore.Cosmos.FunctionalTests/F1CosmosFixture.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/F1CosmosFixture.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.TestModels.ConcurrencyModel;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class F1CosmosFixture<TRowVersion> : F1FixtureBase<TRowVersion>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/Internal/IdentifierShadowValuePresenceTest.cs b/test/EFCore.Cosmos.FunctionalTests/Internal/IdentifierShadowValuePresenceTest.cs
deleted file mode 100644
index 972e90451a..0000000000
--- a/test/EFCore.Cosmos.FunctionalTests/Internal/IdentifierShadowValuePresenceTest.cs
+++ /dev/null
@@ -1,94 +0,0 @@
-﻿// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-namespace Microsoft.EntityFrameworkCore.Internal;
-
-public class IdentifierShadowValuePresenceTest
-{
-    [ConditionalFact]
-    public async Task Entities_with_null_PK_can_be_added_with_normal_use_of_DbContext_methods_and_have_id_shadow_value_and_PK_created()
-    {
-        await using var testDatabase = CosmosTestStore.Create("IdentifierShadowValuePresenceTest");
-        using var context = new IdentifierShadowValuePresenceTestContext(testDatabase);
-
-        var item = new GItem();
-
-        Assert.Null(item.Id);
-
-        var entry = await context.AddAsync(item);
-
-        var id = entry.Property("__id").CurrentValue;
-
-        Assert.NotNull(item.Id);
-        Assert.NotNull(id);
-
-        Assert.Equal($"GItem|{item.Id}", id);
-        Assert.Equal(EntityState.Added, entry.State);
-    }
-
-    [ConditionalFact]
-    public async Task
-        Entities_can_be_tracked_with_normal_use_of_DbContext_methods_and_have_correct_resultant_state_and_id_shadow_value()
-    {
-        await using var testDatabase = CosmosTestStore.Create("IdentifierShadowValuePresenceTest");
-        using var context = new IdentifierShadowValuePresenceTestContext(testDatabase);
-
-        var item = new Item { Id = 1337 };
-        var entry = context.Attach(item);
-
-        Assert.Equal($"Item|{item.Id}", entry.Property("__id").CurrentValue);
-        Assert.Equal(EntityState.Unchanged, entry.State);
-
-        entry.State = EntityState.Detached;
-        entry = context.Update(item = new Item { Id = 71 });
-
-        Assert.Equal($"Item|{item.Id}", entry.Property("__id").CurrentValue);
-        Assert.Equal(EntityState.Modified, entry.State);
-
-        entry.State = EntityState.Detached;
-        entry = context.Remove(item = new Item { Id = 33 });
-
-        Assert.Equal($"Item|{item.Id}", entry.Property("__id").CurrentValue);
-        Assert.Equal(EntityState.Deleted, entry.State);
-    }
-}
-
-public class IdentifierShadowValuePresenceTestContext : DbContext
-{
-    private readonly string _connectionUri;
-    private readonly string _authToken;
-    private readonly string _name;
-
-    public IdentifierShadowValuePresenceTestContext(CosmosTestStore testStore)
-    {
-        _connectionUri = testStore.ConnectionUri;
-        _authToken = testStore.AuthToken;
-        _name = testStore.Name;
-    }
-
-    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
-        => optionsBuilder
-            .UseCosmos(
-                _connectionUri,
-                _authToken,
-                _name,
-                b => b.ApplyConfiguration());
-
-    protected override void OnModelCreating(ModelBuilder modelBuilder)
-    {
-    }
-
-    public DbSet<GItem> GItems { get; set; }
-
-    public DbSet<Item> Items { get; set; }
-}
-
-public class GItem
-{
-    public Guid? Id { get; set; }
-}
-
-public class Item
-{
-    public int Id { get; set; }
-}
diff --git a/test/EFCore.Cosmos.FunctionalTests/JsonTypesCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/JsonTypesCosmosTest.cs
index 9b2865aa28..ba36e5ca5e 100644
--- a/test/EFCore.Cosmos.FunctionalTests/JsonTypesCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/JsonTypesCosmosTest.cs
@@ -5,7 +5,7 @@
 
 using Xunit.Sdk;
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class JsonTypesCosmosTest : JsonTypesTestBase
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/KeysWithConvertersCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/KeysWithConvertersCosmosTest.cs
index 598db5758b..cc8b27c7fe 100644
--- a/test/EFCore.Cosmos.FunctionalTests/KeysWithConvertersCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/KeysWithConvertersCosmosTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class KeysWithConvertersCosmosTest : KeysWithConvertersTestBase<KeysWithConvertersCosmosTest.KeysWithConvertersCosmosFixture>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/MaterializationInterceptionCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/MaterializationInterceptionCosmosTest.cs
index 5558289adb..2a946ff3ba 100644
--- a/test/EFCore.Cosmos.FunctionalTests/MaterializationInterceptionCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/MaterializationInterceptionCosmosTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class MaterializationInterceptionCosmosTest :
     MaterializationInterceptionTestBase<MaterializationInterceptionCosmosTest.CosmosLibraryContext>,
diff --git a/test/EFCore.Cosmos.FunctionalTests/OptimisticConcurrencyCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/OptimisticConcurrencyCosmosTest.cs
index 705db8e455..7dff3bf10f 100644
--- a/test/EFCore.Cosmos.FunctionalTests/OptimisticConcurrencyCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/OptimisticConcurrencyCosmosTest.cs
@@ -3,7 +3,7 @@
 
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class OptimisticConcurrencyCosmosTest : OptimisticConcurrencyTestBase<F1CosmosFixture<byte[]>, byte[]>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/OverzealousInitializationCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/OverzealousInitializationCosmosTest.cs
index 1d1b282873..23421b0c4b 100644
--- a/test/EFCore.Cosmos.FunctionalTests/OverzealousInitializationCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/OverzealousInitializationCosmosTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class OverzealousInitializationCosmosTest
     : OverzealousInitializationTestBase<OverzealousInitializationCosmosTest.OverzealousInitializationCosmosFixture>
diff --git a/test/EFCore.Cosmos.FunctionalTests/PartitionKeyTest.cs b/test/EFCore.Cosmos.FunctionalTests/PartitionKeyTest.cs
index c988bf415e..4d307249f4 100644
--- a/test/EFCore.Cosmos.FunctionalTests/PartitionKeyTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/PartitionKeyTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class PartitionKeyTest : IClassFixture<PartitionKeyTest.CosmosPartitionKeyFixture>
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/QueryExpressionInterceptionWithDiagnosticsCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/QueryExpressionInterceptionWithDiagnosticsCosmosTest.cs
index 5745ec6424..082ce6d0ec 100644
--- a/test/EFCore.Cosmos.FunctionalTests/QueryExpressionInterceptionWithDiagnosticsCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/QueryExpressionInterceptionWithDiagnosticsCosmosTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class QueryExpressionInterceptionWithDiagnosticsCosmosTest
     : QueryExpressionInterceptionTestBase,
diff --git a/test/EFCore.Cosmos.FunctionalTests/ReloadTest.cs b/test/EFCore.Cosmos.FunctionalTests/ReloadTest.cs
index 979285470c..01788c2031 100644
--- a/test/EFCore.Cosmos.FunctionalTests/ReloadTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/ReloadTest.cs
@@ -3,7 +3,7 @@
 
 using Newtonsoft.Json.Linq;
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class ReloadTest
 {
diff --git a/test/EFCore.Cosmos.FunctionalTests/Internal/CosmosDatabaseCreatorTest.cs b/test/EFCore.Cosmos.FunctionalTests/Storage/CosmosDatabaseCreatorTest.cs
similarity index 97%
rename from test/EFCore.Cosmos.FunctionalTests/Internal/CosmosDatabaseCreatorTest.cs
rename to test/EFCore.Cosmos.FunctionalTests/Storage/CosmosDatabaseCreatorTest.cs
index df1a1dcc53..f97302bbd3 100644
--- a/test/EFCore.Cosmos.FunctionalTests/Internal/CosmosDatabaseCreatorTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/Storage/CosmosDatabaseCreatorTest.cs
@@ -1,14 +1,14 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos.Storage.Internal;
+namespace Microsoft.EntityFrameworkCore.Storage;
 
 public class CosmosDatabaseCreatorTest
 {
     public static IEnumerable<object[]> IsAsyncData = new[]
     {
         new object[] { true },
-        //new object[] { false }
+        new object[] { false }
     };
 
     [ConditionalTheory]
diff --git a/test/EFCore.Cosmos.FunctionalTests/ValueConvertersEndToEndCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/ValueConvertersEndToEndCosmosTest.cs
index 1cf2749bf9..e0883ca4d9 100644
--- a/test/EFCore.Cosmos.FunctionalTests/ValueConvertersEndToEndCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/ValueConvertersEndToEndCosmosTest.cs
@@ -3,7 +3,7 @@
 
 #nullable enable
 
-namespace Microsoft.EntityFrameworkCore.Cosmos;
+namespace Microsoft.EntityFrameworkCore;
 
 public class ValueConvertersEndToEndCosmosTest
     : ValueConvertersEndToEndTestBase<ValueConvertersEndToEndCosmosTest.ValueConvertersEndToEndCosmosFixture>
diff --git a/test/EFCore.Cosmos.Tests/CosmosEventIdTest.cs b/test/EFCore.Cosmos.Tests/Diagnostics/CosmosEventIdTest.cs
similarity index 94%
rename from test/EFCore.Cosmos.Tests/CosmosEventIdTest.cs
rename to test/EFCore.Cosmos.Tests/Diagnostics/CosmosEventIdTest.cs
index 979ffc3257..847c3b37bf 100644
--- a/test/EFCore.Cosmos.Tests/CosmosEventIdTest.cs
+++ b/test/EFCore.Cosmos.Tests/Diagnostics/CosmosEventIdTest.cs
@@ -5,7 +5,7 @@
 using Microsoft.EntityFrameworkCore.Cosmos.Storage.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Cosmos.Diagnostics;
 
 public class CosmosEventIdTest : EventIdTestBase
 {
diff --git a/test/EFCore.Cosmos.Tests/Metadata/CosmosBuilderExtensionsTest.cs b/test/EFCore.Cosmos.Tests/Extensions/CosmosBuilderExtensionsTest.cs
similarity index 99%
rename from test/EFCore.Cosmos.Tests/Metadata/CosmosBuilderExtensionsTest.cs
rename to test/EFCore.Cosmos.Tests/Extensions/CosmosBuilderExtensionsTest.cs
index cd6156b172..d022cb7f91 100644
--- a/test/EFCore.Cosmos.Tests/Metadata/CosmosBuilderExtensionsTest.cs
+++ b/test/EFCore.Cosmos.Tests/Extensions/CosmosBuilderExtensionsTest.cs
@@ -3,7 +3,7 @@
 
 // ReSharper disable once CheckNamespace
 
-namespace Microsoft.EntityFrameworkCore.Metadata;
+namespace Microsoft.EntityFrameworkCore.Cosmos;
 
 public class CosmosBuilderExtensionsTest
 {
diff --git a/test/EFCore.Cosmos.Tests/Metadata/CosmosMetadataExtensionsTest.cs b/test/EFCore.Cosmos.Tests/Extensions/CosmosMetadataExtensionsTest.cs
similarity index 98%
rename from test/EFCore.Cosmos.Tests/Metadata/CosmosMetadataExtensionsTest.cs
rename to test/EFCore.Cosmos.Tests/Extensions/CosmosMetadataExtensionsTest.cs
index 91f3956036..49bad673be 100644
--- a/test/EFCore.Cosmos.Tests/Metadata/CosmosMetadataExtensionsTest.cs
+++ b/test/EFCore.Cosmos.Tests/Extensions/CosmosMetadataExtensionsTest.cs
@@ -3,7 +3,7 @@
 
 // ReSharper disable once CheckNamespace
 
-namespace Microsoft.EntityFrameworkCore.Metadata;
+namespace Microsoft.EntityFrameworkCore.Cosmos;
 
 public class CosmosMetadataExtensionsTest
 {
diff --git a/test/EFCore.Cosmos.Tests/Infrastructure/CosmosTransactionManagerTest.cs b/test/EFCore.Cosmos.Tests/Storage/CosmosTransactionManagerTest.cs
similarity index 97%
rename from test/EFCore.Cosmos.Tests/Infrastructure/CosmosTransactionManagerTest.cs
rename to test/EFCore.Cosmos.Tests/Storage/CosmosTransactionManagerTest.cs
index a00fbce6e1..9bf0f27e56 100644
--- a/test/EFCore.Cosmos.Tests/Infrastructure/CosmosTransactionManagerTest.cs
+++ b/test/EFCore.Cosmos.Tests/Storage/CosmosTransactionManagerTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.Cosmos.Internal;
 using Microsoft.EntityFrameworkCore.Cosmos.Storage.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Infrastructure;
+namespace Microsoft.EntityFrameworkCore.Cosmos.Storage;
 
 public class CosmosTransactionManagerTest
 {
diff --git a/test/EFCore.Cosmos.Tests/ValueGenerator/Internal/IdValueGeneratorTest.cs b/test/EFCore.Cosmos.Tests/ValueGeneration/IdValueGeneratorTest.cs
similarity index 95%
rename from test/EFCore.Cosmos.Tests/ValueGenerator/Internal/IdValueGeneratorTest.cs
rename to test/EFCore.Cosmos.Tests/ValueGeneration/IdValueGeneratorTest.cs
index 6491fd0ed2..b9aa46eb7b 100644
--- a/test/EFCore.Cosmos.Tests/ValueGenerator/Internal/IdValueGeneratorTest.cs
+++ b/test/EFCore.Cosmos.Tests/ValueGeneration/IdValueGeneratorTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Cosmos.ValueGenerator.Internal;
+namespace Microsoft.EntityFrameworkCore.Cosmos.ValueGeneration;
 
 public class IdValueGeneratorTest
 {
@@ -120,10 +120,10 @@ public BytesStruct(byte[] value)
         public byte[] Value { get; }
 
         public bool Equals(BytesStruct other)
-            => (Value == null
-                    && other.Value == null)
-                || (other.Value != null
-                    && Value?.SequenceEqual(other.Value) == true);
+            => Value == null
+                    && other.Value == null
+                || other.Value != null
+                    && Value?.SequenceEqual(other.Value) == true;
 
         public override int GetHashCode()
         {
diff --git a/test/EFCore.Design.Tests/DesignExceptionTest.cs b/test/EFCore.Design.Tests/Design/OperationExceptionTest.cs
similarity index 89%
rename from test/EFCore.Design.Tests/DesignExceptionTest.cs
rename to test/EFCore.Design.Tests/Design/OperationExceptionTest.cs
index 717d6a5e6f..3a0deeb659 100644
--- a/test/EFCore.Design.Tests/DesignExceptionTest.cs
+++ b/test/EFCore.Design.Tests/Design/OperationExceptionTest.cs
@@ -1,9 +1,9 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Design;
 
-public class DesignExceptionTest
+public class OperationExceptionTest
 {
     [ConditionalFact]
     public void OperationException_exposes_public_empty_constructor()
diff --git a/test/EFCore.Design.Tests/Design/DesignTimeFlagTest.cs b/test/EFCore.Design.Tests/DesignTimeFlagTest.cs
similarity index 97%
rename from test/EFCore.Design.Tests/Design/DesignTimeFlagTest.cs
rename to test/EFCore.Design.Tests/DesignTimeFlagTest.cs
index 08a778b51e..40d8289504 100644
--- a/test/EFCore.Design.Tests/Design/DesignTimeFlagTest.cs
+++ b/test/EFCore.Design.Tests/DesignTimeFlagTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Design;
+namespace Microsoft.EntityFrameworkCore;
 
 // The tests interact with global state and should never be run in parallel
 [Collection("DesignTimeFlagTest")]
diff --git a/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingMetadataExtensionsTest.cs b/test/EFCore.Design.Tests/Extensions/ScaffoldingMetadataExtensionsTest.cs
similarity index 94%
rename from test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingMetadataExtensionsTest.cs
rename to test/EFCore.Design.Tests/Extensions/ScaffoldingMetadataExtensionsTest.cs
index fe7a521ca0..c646a5f753 100644
--- a/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingMetadataExtensionsTest.cs
+++ b/test/EFCore.Design.Tests/Extensions/ScaffoldingMetadataExtensionsTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.Metadata.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Extensions;
 
 public class ScaffoldingMetadataExtensionsTest
 {
diff --git a/test/EFCore.Design.Tests/Migrations/ModelSnapshotSqlServerTest.cs b/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.ModelSnapshot.cs
similarity index 89%
rename from test/EFCore.Design.Tests/Migrations/ModelSnapshotSqlServerTest.cs
rename to test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.ModelSnapshot.cs
index f79aef83b4..854d474921 100644
--- a/test/EFCore.Design.Tests/Migrations/ModelSnapshotSqlServerTest.cs
+++ b/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.ModelSnapshot.cs
@@ -3,6 +3,7 @@
 
 using System.ComponentModel.DataAnnotations;
 using System.ComponentModel.DataAnnotations.Schema;
+using System.Text.RegularExpressions;
 using Microsoft.EntityFrameworkCore.Design.Internal;
 using Microsoft.EntityFrameworkCore.Metadata.Internal;
 using Microsoft.EntityFrameworkCore.Migrations.Internal;
@@ -18,10 +19,252 @@
 // ReSharper disable ClassNeverInstantiated.Local
 // ReSharper disable UnusedMember.Local
 // ReSharper disable UnusedTypeParameter
-namespace Microsoft.EntityFrameworkCore.Migrations;
+namespace Microsoft.EntityFrameworkCore.Migrations.Design;
 
-public class ModelSnapshotSqlServerTest
+public partial class CSharpMigrationsGeneratorTest
 {
+
+    [ConditionalFact]
+    public void Snapshots_compile()
+    {
+        var generator = CreateMigrationsCodeGenerator();
+
+        var modelBuilder = FakeRelationalTestHelpers.Instance.CreateConventionBuilder();
+        modelBuilder.Model.RemoveAnnotation(CoreAnnotationNames.ProductVersion);
+        modelBuilder.Entity<EntityWithConstructorBinding>(
+            x =>
+            {
+                x.Property(e => e.Id);
+
+                x.Property<Guid>("PropertyWithValueGenerator").HasValueGenerator<GuidValueGenerator>();
+            });
+        modelBuilder.HasDbFunction(() => MyDbFunction());
+
+        var model = modelBuilder.Model;
+        model["Some:EnumValue"] = RegexOptions.Multiline;
+
+        var entityType = model.AddEntityType("Cheese");
+        var property1 = entityType.AddProperty("Pickle", typeof(StringBuilder));
+        property1.SetValueConverter(
+            new ValueConverter<StringBuilder, string>(
+                v => v.ToString(), v => new StringBuilder(v), new ConverterMappingHints(size: 10)));
+
+        var property2 = entityType.AddProperty("Ham", typeof(RawEnum));
+        property2.SetValueConverter(
+            new ValueConverter<RawEnum, string>(
+                v => v.ToString(), v => (RawEnum)Enum.Parse(typeof(RawEnum), v), new ConverterMappingHints(size: 10)));
+
+        entityType.SetPrimaryKey(property2);
+
+        var finalizedModel = modelBuilder.FinalizeModel(designTime: true);
+
+        var modelSnapshotCode = generator.GenerateSnapshot(
+            "MyNamespace",
+            typeof(MyContext),
+            "MySnapshot",
+            finalizedModel);
+        Assert.Equal(
+            """
+// <auto-generated />
+using System;
+using System.Text.RegularExpressions;
+using Microsoft.EntityFrameworkCore;
+using Microsoft.EntityFrameworkCore.Infrastructure;
+using Microsoft.EntityFrameworkCore.Migrations.Design;
+using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
+
+#nullable disable
+
+namespace MyNamespace
+{
+    [DbContext(typeof(CSharpMigrationsGeneratorTest.MyContext))]
+    partial class MySnapshot : ModelSnapshot
+    {
+        protected override void BuildModel(ModelBuilder modelBuilder)
+        {
+#pragma warning disable 612, 618
+            modelBuilder.HasAnnotation("Some:EnumValue", RegexOptions.Multiline);
+
+            modelBuilder.Entity("Cheese", b =>
+                {
+                    b.Property<string>("Ham")
+                        .HasColumnType("just_string(10)");
+
+                    b.Property<string>("Pickle")
+                        .HasColumnType("just_string(10)");
+
+                    b.HasKey("Ham");
+
+                    b.ToTable("Cheese");
+                });
+
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithConstructorBinding", b =>
+                {
+                    b.Property<int>("Id")
+                        .ValueGeneratedOnAdd()
+                        .HasColumnType("default_int_mapping");
+
+                    b.Property<Guid>("PropertyWithValueGenerator")
+                        .HasColumnType("default_guid_mapping");
+
+                    b.HasKey("Id");
+
+                    b.ToTable("EntityWithConstructorBinding");
+                });
+#pragma warning restore 612, 618
+        }
+    }
+}
+
+""", modelSnapshotCode, ignoreLineEndingDifferences: true);
+
+        var snapshot = CompileModelSnapshot(modelSnapshotCode, "MyNamespace.MySnapshot");
+        Assert.Equal(2, snapshot.Model.GetEntityTypes().Count());
+    }
+
+    [ConditionalFact]
+    public void Snapshot_with_default_values_are_round_tripped()
+    {
+        var generator = CreateMigrationsCodeGenerator();
+
+        var modelBuilder = FakeRelationalTestHelpers.Instance.CreateConventionBuilder();
+        modelBuilder.Entity<EntityWithEveryPrimitive>(
+            eb =>
+            {
+                eb.Property(e => e.Boolean).HasDefaultValue(false);
+                eb.Property(e => e.Byte).HasDefaultValue(byte.MinValue);
+                eb.Property(e => e.ByteArray).HasDefaultValue(new byte[] { 0 });
+                eb.Property(e => e.Char).HasDefaultValue('0');
+                eb.Property(e => e.DateTime).HasDefaultValue(DateTime.MinValue);
+                eb.Property(e => e.DateTimeOffset).HasDefaultValue(DateTimeOffset.MinValue);
+                eb.Property(e => e.Decimal).HasDefaultValue(decimal.MinValue);
+                eb.Property(e => e.Double).HasDefaultValue(double.MinValue); //double.NegativeInfinity
+                eb.Property(e => e.Enum).HasDefaultValue(Enum1.Default);
+                eb.Property(e => e.NullableEnum).HasDefaultValue(Enum1.Default).HasConversion<string>();
+                eb.Property(e => e.Guid).HasDefaultValue(Guid.NewGuid());
+                eb.Property(e => e.Int16).HasDefaultValue(short.MaxValue);
+                eb.Property(e => e.Int32).HasDefaultValue(int.MaxValue);
+                eb.Property(e => e.Int64).HasDefaultValue(long.MaxValue);
+                eb.Property(e => e.Single).HasDefaultValue(float.Epsilon);
+                eb.Property(e => e.SByte).HasDefaultValue(sbyte.MinValue);
+                eb.Property(e => e.String).HasDefaultValue("'\"'@\r\\\n");
+                eb.Property(e => e.TimeSpan).HasDefaultValue(TimeSpan.MaxValue);
+                eb.Property(e => e.UInt16).HasDefaultValue(ushort.MinValue);
+                eb.Property(e => e.UInt32).HasDefaultValue(uint.MinValue);
+                eb.Property(e => e.UInt64).HasDefaultValue(ulong.MinValue);
+                eb.Property(e => e.NullableBoolean).HasDefaultValue(true);
+                eb.Property(e => e.NullableByte).HasDefaultValue(byte.MaxValue);
+                eb.Property(e => e.NullableChar).HasDefaultValue('\'');
+                eb.Property(e => e.NullableDateTime).HasDefaultValue(DateTime.MaxValue);
+                eb.Property(e => e.NullableDateTimeOffset).HasDefaultValue(DateTimeOffset.MaxValue);
+                eb.Property(e => e.NullableDecimal).HasDefaultValue(decimal.MaxValue);
+                eb.Property(e => e.NullableDouble).HasDefaultValue(0.6822871999174);
+                eb.Property(e => e.NullableEnum).HasDefaultValue(Enum1.One | Enum1.Two);
+                eb.Property(e => e.NullableStringEnum).HasDefaultValue(Enum1.One).HasConversion<string>();
+                eb.Property(e => e.NullableGuid).HasDefaultValue(new Guid());
+                eb.Property(e => e.NullableInt16).HasDefaultValue(short.MinValue);
+                eb.Property(e => e.NullableInt32).HasDefaultValue(int.MinValue);
+                eb.Property(e => e.NullableInt64).HasDefaultValue(long.MinValue);
+                eb.Property(e => e.NullableSingle).HasDefaultValue(0.3333333f);
+                eb.Property(e => e.NullableSByte).HasDefaultValue(sbyte.MinValue);
+                eb.Property(e => e.NullableTimeSpan).HasDefaultValue(TimeSpan.MinValue.Add(new TimeSpan()));
+                eb.Property(e => e.NullableUInt16).HasDefaultValue(ushort.MaxValue);
+                eb.Property(e => e.NullableUInt32).HasDefaultValue(uint.MaxValue);
+                eb.Property(e => e.NullableUInt64).HasDefaultValue(ulong.MaxValue);
+
+                eb.HasKey(e => e.Boolean);
+            });
+
+        var finalizedModel = modelBuilder.FinalizeModel(designTime: true);
+
+        var modelSnapshotCode = generator.GenerateSnapshot(
+            "MyNamespace",
+            typeof(MyContext),
+            "MySnapshot",
+            finalizedModel);
+
+        var snapshot = CompileModelSnapshot(modelSnapshotCode, "MyNamespace.MySnapshot");
+        var entityType = snapshot.Model.GetEntityTypes().Single();
+        Assert.Equal(typeof(EntityWithEveryPrimitive).FullName + " (Dictionary<string, object>)", entityType.DisplayName());
+
+        foreach (var property in modelBuilder.Model.GetEntityTypes().Single().GetProperties())
+        {
+            var expected = property.GetDefaultValue();
+            var actual = entityType.FindProperty(property.Name).GetDefaultValue();
+
+            if (actual != null
+                && expected != null)
+            {
+                if (expected.GetType().IsEnum)
+                {
+                    actual = actual is string actualString
+                        ? Enum.Parse(expected.GetType(), actualString)
+                        : Enum.ToObject(expected.GetType(), actual);
+                }
+
+                if (actual.GetType() != expected.GetType())
+                {
+                    actual = Convert.ChangeType(actual, expected.GetType());
+                }
+            }
+
+            Assert.Equal(expected, actual);
+        }
+    }
+
+    private class EntityWithEveryPrimitive
+    {
+        public bool Boolean { get; set; }
+        public byte Byte { get; set; }
+        public byte[] ByteArray { get; set; }
+        public char Char { get; set; }
+        public DateTime DateTime { get; set; }
+        public DateTimeOffset DateTimeOffset { get; set; }
+        public decimal Decimal { get; set; }
+        public double Double { get; set; }
+        public Enum1 Enum { get; set; }
+        public Enum1 StringEnum { get; set; }
+        public Guid Guid { get; set; }
+        public short Int16 { get; set; }
+        public int Int32 { get; set; }
+        public long Int64 { get; set; }
+        public bool? NullableBoolean { get; set; }
+        public byte? NullableByte { get; set; }
+        public char? NullableChar { get; set; }
+        public DateTime? NullableDateTime { get; set; }
+        public DateTimeOffset? NullableDateTimeOffset { get; set; }
+        public decimal? NullableDecimal { get; set; }
+        public double? NullableDouble { get; set; }
+        public Enum1? NullableEnum { get; set; }
+        public Enum1? NullableStringEnum { get; set; }
+        public Guid? NullableGuid { get; set; }
+        public short? NullableInt16 { get; set; }
+        public int? NullableInt32 { get; set; }
+        public long? NullableInt64 { get; set; }
+        public sbyte? NullableSByte { get; set; }
+        public float? NullableSingle { get; set; }
+        public TimeSpan? NullableTimeSpan { get; set; }
+        public ushort? NullableUInt16 { get; set; }
+        public uint? NullableUInt32 { get; set; }
+        public ulong? NullableUInt64 { get; set; }
+        public int PrivateSetter { get; private set; }
+        public sbyte SByte { get; set; }
+        public float Single { get; set; }
+        public string String { get; set; }
+        public TimeSpan TimeSpan { get; set; }
+        public ushort UInt16 { get; set; }
+        public uint UInt32 { get; set; }
+        public ulong UInt64 { get; set; }
+    }
+
+    [Flags]
+    public enum Enum1
+    {
+        Default = 0,
+        One = 1,
+        Two = 2
+    }
+
     private class EntityWithManyProperties
     {
         public int Id { get; set; }
@@ -417,7 +660,7 @@ public virtual void Model_Fluent_APIs_are_properly_generated()
             modelBuilder.HasSequence("EntityFrameworkHiLoSequence")
                 .IncrementsBy(10);
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -457,7 +700,7 @@ public virtual void Model_fluent_APIs_for_sequence_key_are_properly_generated()
 
             modelBuilder.HasSequence("EntityWithOnePropertySequence");
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -514,7 +757,7 @@ public virtual void Entities_are_stored_in_model_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -527,7 +770,7 @@ public virtual void Entities_are_stored_in_model_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -549,9 +792,9 @@ public virtual void Entities_are_stored_in_model_snapshot()
                 Assert.Collection(
                     o.GetEntityTypes(),
                     t => Assert.Equal(
-                        "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", t.Name),
+                        "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", t.Name),
                     t => Assert.Equal(
-                        "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", t.Name));
+                        "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", t.Name));
             });
 
     [ConditionalFact]
@@ -567,7 +810,7 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPT()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AbstractBase", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AbstractBase", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -582,16 +825,16 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPT()
                     b.UseTptMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AbstractBase");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AbstractBase");
 
                     b.ToTable("BaseEntity", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -599,11 +842,11 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPT()
                     b.ToTable("DerivedEntity", "foo");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", null)
                         .WithOne()
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", "Id")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", "Id")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
                 });
@@ -613,15 +856,15 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPT()
                 Assert.Equal(5, model.GetAnnotations().Count());
                 Assert.Equal(3, model.GetEntityTypes().Count());
 
-                var abstractBase = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AbstractBase");
+                var abstractBase = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AbstractBase");
                 Assert.Equal("AbstractBase", abstractBase.GetTableName());
                 Assert.Equal("TPT", abstractBase.GetMappingStrategy());
 
-                var baseType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                var baseType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
                 Assert.Equal("BaseEntity", baseType.GetTableName());
                 Assert.Equal("DefaultSchema", baseType.GetSchema());
 
-                var derived = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity");
+                var derived = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity");
                 Assert.Equal("DerivedEntity", derived.GetTableName());
                 Assert.Equal("foo", derived.GetSchema());
             });
@@ -638,7 +881,7 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPT_with_one_exclu
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -657,9 +900,9 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPT_with_one_exclu
                     b.UseTptMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -670,11 +913,11 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPT_with_one_exclu
                         });
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", null)
                         .WithOne()
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", "Id")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", "Id")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
                 });
@@ -685,7 +928,7 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPT_with_one_exclu
 
                 Assert.Equal(
                     "DerivedEntity",
-                    o.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity")
+                    o.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity")
                         .GetTableName());
             });
 
@@ -696,7 +939,7 @@ public void Views_are_stored_in_the_model_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -719,7 +962,7 @@ public void Views_with_schemas_are_stored_in_the_model_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -753,7 +996,7 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPC()
                 + """
             modelBuilder.HasSequence("AbstractBaseSequence");
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AbstractBase", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AbstractBase", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -769,16 +1012,16 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPC()
                     b.UseTpcMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AbstractBase");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AbstractBase");
 
                     b.ToTable("BaseEntity", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -793,16 +1036,16 @@ public virtual void Entities_are_stored_in_model_snapshot_for_TPC()
                 Assert.Equal(6, model.GetAnnotations().Count());
                 Assert.Equal(3, model.GetEntityTypes().Count());
 
-                var abstractBase = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AbstractBase");
+                var abstractBase = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AbstractBase");
                 Assert.Null(abstractBase.GetTableName());
                 Assert.Null(abstractBase.GetViewName());
                 Assert.Equal("TPC", abstractBase.GetMappingStrategy());
 
-                var baseType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                var baseType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
                 Assert.Equal("BaseEntity", baseType.GetTableName());
                 Assert.Null(baseType.GetViewName());
 
-                var derived = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity");
+                var derived = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity");
                 Assert.Equal("DerivedEntity", derived.GetTableName());
                 Assert.Equal("DerivedView", derived.GetViewName());
             });
@@ -859,7 +1102,7 @@ protected override void BuildModel(ModelBuilder modelBuilder)
                     b.ToTable("HumanPet", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Animal", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Animal", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -878,9 +1121,9 @@ protected override void BuildModel(ModelBuilder modelBuilder)
                     b.UseTpcMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Human", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Human", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Animal");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Animal");
 
                     b.Property<int?>("FavoriteAnimalId")
                         .HasColumnType("int");
@@ -890,9 +1133,9 @@ protected override void BuildModel(ModelBuilder modelBuilder)
                     b.ToTable("Human", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Pet", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Pet", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Animal");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Animal");
 
                     b.Property<string>("Vet")
                         .HasColumnType("nvarchar(max)");
@@ -900,9 +1143,9 @@ protected override void BuildModel(ModelBuilder modelBuilder)
                     b.ToTable((string)null);
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Cat", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Cat", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Pet");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Pet");
 
                     b.Property<string>("EducationLevel")
                         .HasColumnType("nvarchar(max)");
@@ -910,9 +1153,9 @@ protected override void BuildModel(ModelBuilder modelBuilder)
                     b.ToTable("Cat", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Dog", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Dog", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Pet");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Pet");
 
                     b.Property<string>("FavoriteToy")
                         .HasColumnType("nvarchar(max)");
@@ -922,22 +1165,22 @@ protected override void BuildModel(ModelBuilder modelBuilder)
 
             modelBuilder.Entity("HumanPet", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Human", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Human", null)
                         .WithMany()
                         .HasForeignKey("HumansId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Pet", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Pet", null)
                         .WithMany()
                         .HasForeignKey("PetsId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Human", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Human", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Animal", "FavoriteAnimal")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Animal", "FavoriteAnimal")
                         .WithMany()
                         .HasForeignKey("FavoriteAnimalId");
 
@@ -954,24 +1197,24 @@ protected override void BuildModel(ModelBuilder modelBuilder)
                 Assert.Equal(6, model.GetAnnotations().Count());
                 Assert.Equal(6, model.GetEntityTypes().Count());
 
-                var animalType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Animal");
+                var animalType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Animal");
                 Assert.Null(animalType.GetTableName());
                 Assert.Null(animalType.GetViewName());
                 Assert.Equal("TPC", animalType.GetMappingStrategy());
 
-                var petType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Pet");
+                var petType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Pet");
                 Assert.Null(petType.GetTableName());
                 Assert.Null(petType.GetViewName());
 
-                var catType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Cat");
+                var catType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Cat");
                 Assert.Equal("Cat", catType.GetTableName());
                 Assert.Null(catType.GetViewName());
 
-                var dogType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Dog");
+                var dogType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Dog");
                 Assert.Equal("Dog", dogType.GetTableName());
                 Assert.Null(dogType.GetViewName());
 
-                var humanType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Human");
+                var humanType = model.FindEntityType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Human");
                 Assert.Equal("Human", humanType.GetTableName());
                 Assert.Null(humanType.GetViewName());
 
@@ -1045,7 +1288,7 @@ public virtual void Entity_splitting_is_stored_in_snapshot_with_tables()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -1083,15 +1326,15 @@ public virtual void Entity_splitting_is_stored_in_snapshot_with_tables()
                     b.HasAnnotation("SqlServer:UseSqlOutputClause", false);
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order", null)
                         .WithOne()
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order", "Id")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order", "Id")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderDetails", "OrderBillingDetails", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderDetails", "OrderBillingDetails", b1 =>
                         {
                             b1.Property<int>("OrderId")
                                 .HasColumnType("int");
@@ -1116,13 +1359,13 @@ public virtual void Entity_splitting_is_stored_in_snapshot_with_tables()
                             b1.WithOwner()
                                 .HasForeignKey("OrderId");
 
-                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order.OrderBillingDetails#Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderDetails", null)
+                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order.OrderBillingDetails#Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderDetails", null)
                                 .WithOne()
-                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order.OrderBillingDetails#Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderDetails", "OrderId")
+                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order.OrderBillingDetails#Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderDetails", "OrderId")
                                 .OnDelete(DeleteBehavior.Cascade)
                                 .IsRequired();
 
-                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+StreetAddress", "StreetAddress", b2 =>
+                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+StreetAddress", "StreetAddress", b2 =>
                                 {
                                     b2.Property<int>("OrderDetailsOrderId")
                                         .HasColumnType("int");
@@ -1141,7 +1384,7 @@ public virtual void Entity_splitting_is_stored_in_snapshot_with_tables()
                             b1.Navigation("StreetAddress");
                         });
 
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderDetails", "OrderShippingDetails", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderDetails", "OrderShippingDetails", b1 =>
                         {
                             b1.Property<int>("OrderId")
                                 .HasColumnType("int");
@@ -1165,13 +1408,13 @@ public virtual void Entity_splitting_is_stored_in_snapshot_with_tables()
                             b1.WithOwner()
                                 .HasForeignKey("OrderId");
 
-                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order.OrderShippingDetails#Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderDetails", null)
+                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order.OrderShippingDetails#Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderDetails", null)
                                 .WithOne()
-                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order.OrderShippingDetails#Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderDetails", "OrderId")
+                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order.OrderShippingDetails#Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderDetails", "OrderId")
                                 .OnDelete(DeleteBehavior.Cascade)
                                 .IsRequired();
 
-                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+StreetAddress", "StreetAddress", b2 =>
+                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+StreetAddress", "StreetAddress", b2 =>
                                 {
                                     b2.Property<int>("OrderDetailsOrderId")
                                         .HasColumnType("int");
@@ -1313,7 +1556,7 @@ public virtual void Entity_splitting_is_stored_in_snapshot_with_views()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -1336,9 +1579,9 @@ public virtual void Entity_splitting_is_stored_in_snapshot_with_views()
                         });
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithTwoProperties", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithTwoProperties", b1 =>
                         {
                             b1.Property<int>("Id")
                                 .HasColumnType("int");
@@ -1412,7 +1655,7 @@ public void Unmapped_entity_types_are_stored_in_the_model_snapshot()
 
             SqlServerModelBuilderExtensions.UseIdentityColumns(modelBuilder);
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -1442,7 +1685,7 @@ public void TVF_types_are_stored_in_the_model_snapshot()
             builder =>
             {
                 builder.HasDbFunction(
-                    typeof(ModelSnapshotSqlServerTest).GetMethod(
+                    typeof(CSharpMigrationsGeneratorTest).GetMethod(
                         nameof(GetCountByYear),
                         BindingFlags.NonPublic | BindingFlags.Static));
 
@@ -1451,7 +1694,7 @@ public void TVF_types_are_stored_in_the_model_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestKeylessType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestKeylessType", b =>
                 {
                     b.Property<string>("Something")
                         .HasColumnType("nvarchar(max)");
@@ -1479,7 +1722,7 @@ public void Entity_types_mapped_to_functions_are_stored_in_the_model_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestKeylessType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestKeylessType", b =>
                 {
                     b.Property<string>("Something")
                         .HasColumnType("nvarchar(max)");
@@ -1498,7 +1741,7 @@ public void Entity_types_mapped_to_queries_are_stored_in_the_model_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -1602,7 +1845,7 @@ public virtual void CheckConstraint_is_stored_in_snapshot_as_fluent_api()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -1642,7 +1885,7 @@ public virtual void CheckConstraint_is_only_stored_in_snapshot_once_for_TPH()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -1664,9 +1907,9 @@ public virtual void CheckConstraint_is_only_stored_in_snapshot_once_for_TPH()
                     b.UseTphMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -1697,7 +1940,7 @@ public virtual void Trigger_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -1742,7 +1985,7 @@ public virtual void Triggers_and_ExcludeFromMigrations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -1913,7 +2156,7 @@ public virtual void EntityType_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -1945,7 +2188,7 @@ public virtual void EntityType_Fluent_APIs_are_properly_generated()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -1975,7 +2218,7 @@ public virtual void BaseType_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -1997,9 +2240,9 @@ public virtual void BaseType_is_stored_in_snapshot()
                     b.UseTphMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AnotherDerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AnotherDerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Title")
                         .HasColumnType("nvarchar(max)");
@@ -2007,9 +2250,9 @@ public virtual void BaseType_is_stored_in_snapshot()
                     b.HasDiscriminator().HasValue("AnotherDerivedEntity");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -2023,9 +2266,9 @@ public virtual void BaseType_is_stored_in_snapshot()
                 Assert.Collection(
                     o.GetEntityTypes(),
                     t => Assert.Equal(
-                        "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AnotherDerivedEntity", t.Name),
-                    t => Assert.Equal("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", t.Name),
-                    t => Assert.Equal("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", t.Name)
+                        "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AnotherDerivedEntity", t.Name),
+                    t => Assert.Equal("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", t.Name),
+                    t => Assert.Equal("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", t.Name)
                 );
             });
 
@@ -2046,7 +2289,7 @@ public virtual void Discriminator_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2068,9 +2311,9 @@ public virtual void Discriminator_annotations_are_stored_in_snapshot()
                     b.UseTphMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AnotherDerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AnotherDerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Title")
                         .HasColumnType("nvarchar(max)");
@@ -2078,9 +2321,9 @@ public virtual void Discriminator_annotations_are_stored_in_snapshot()
                     b.HasDiscriminator().HasValue("AnotherDerivedEntity");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -2123,7 +2366,7 @@ public virtual void Converted_discriminator_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntityWithStructDiscriminator", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntityWithStructDiscriminator", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2144,9 +2387,9 @@ public virtual void Converted_discriminator_annotations_are_stored_in_snapshot()
                     b.UseTphMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+AnotherDerivedEntityWithStructDiscriminator", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+AnotherDerivedEntityWithStructDiscriminator", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntityWithStructDiscriminator");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntityWithStructDiscriminator");
 
                     b.Property<string>("Title")
                         .HasColumnType("nvarchar(max)");
@@ -2154,9 +2397,9 @@ public virtual void Converted_discriminator_annotations_are_stored_in_snapshot()
                     b.HasDiscriminator().HasValue("Another");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntityWithStructDiscriminator", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntityWithStructDiscriminator", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntityWithStructDiscriminator");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntityWithStructDiscriminator");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -2194,7 +2437,7 @@ public virtual void Properties_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2232,7 +2475,7 @@ public virtual void Primary_key_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -2262,7 +2505,7 @@ public void HasNoKey_is_handled()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -2274,7 +2517,7 @@ public void HasNoKey_is_handled()
             {
                 var entityType = Assert.Single(o.GetEntityTypes());
                 Assert.Equal(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", entityType.Name);
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", entityType.Name);
                 Assert.Null(entityType.FindPrimaryKey());
             });
 
@@ -2290,7 +2533,7 @@ public virtual void Alternate_keys_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2328,7 +2571,7 @@ public virtual void Indexes_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2364,7 +2607,7 @@ public virtual void Indexes_are_stored_in_snapshot_including_composite_index()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2405,7 +2648,7 @@ public virtual void Foreign_keys_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2418,7 +2661,7 @@ public virtual void Foreign_keys_are_stored_in_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2437,18 +2680,18 @@ public virtual void Foreign_keys_are_stored_in_snapshot()
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                         .WithOne("EntityWithTwoProperties")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "AlternateId")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "AlternateId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
                     b.Navigation("EntityWithOneProperty");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Navigation("EntityWithTwoProperties");
                 });
@@ -2494,7 +2737,7 @@ public virtual void Many_to_many_join_table_stored_in_snapshot()
                     b.ToTable("ManyToManyLeftManyToManyRight", "schema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyLeft", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyLeft", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2510,7 +2753,7 @@ public virtual void Many_to_many_join_table_stored_in_snapshot()
                     b.ToTable("ManyToManyLeft", "schema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyRight", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyRight", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2528,13 +2771,13 @@ public virtual void Many_to_many_join_table_stored_in_snapshot()
 
             modelBuilder.Entity("ManyToManyLeftManyToManyRight", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyLeft", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyLeft", null)
                         .WithMany()
                         .HasForeignKey("LeftsId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyRight", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyRight", null)
                         .WithMany()
                         .HasForeignKey("RightsId")
                         .OnDelete(DeleteBehavior.Cascade)
@@ -2572,7 +2815,7 @@ public virtual void Many_to_many_join_table_stored_in_snapshot()
                     fk =>
                     {
                         Assert.Equal(
-                            "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyLeft",
+                            "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyLeft",
                             fk.PrincipalEntityType.Name);
                         Assert.Collection(
                             fk.PrincipalKey.Properties,
@@ -2590,7 +2833,7 @@ public virtual void Many_to_many_join_table_stored_in_snapshot()
                     fk =>
                     {
                         Assert.Equal(
-                            "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyRight",
+                            "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyRight",
                             fk.PrincipalEntityType.Name);
                         Assert.Collection(
                             fk.PrincipalKey.Properties,
@@ -2639,7 +2882,7 @@ public virtual void Can_override_table_name_for_many_to_many_join_table_stored_i
                     b.ToTable("MyJoinTable", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyLeft", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyLeft", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2655,7 +2898,7 @@ public virtual void Can_override_table_name_for_many_to_many_join_table_stored_i
                     b.ToTable("ManyToManyLeft", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyRight", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyRight", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2673,13 +2916,13 @@ public virtual void Can_override_table_name_for_many_to_many_join_table_stored_i
 
             modelBuilder.Entity("ManyToManyLeftManyToManyRight", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyLeft", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyLeft", null)
                         .WithMany()
                         .HasForeignKey("LeftsId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyRight", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyRight", null)
                         .WithMany()
                         .HasForeignKey("RightsId")
                         .OnDelete(DeleteBehavior.Cascade)
@@ -2720,7 +2963,7 @@ public virtual void Can_override_table_name_for_many_to_many_join_table_stored_i
                     fk =>
                     {
                         Assert.Equal(
-                            "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyLeft",
+                            "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyLeft",
                             fk.PrincipalEntityType.Name);
                         Assert.Collection(
                             fk.PrincipalKey.Properties,
@@ -2738,7 +2981,7 @@ public virtual void Can_override_table_name_for_many_to_many_join_table_stored_i
                     fk =>
                     {
                         Assert.Equal(
-                            "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+ManyToManyRight",
+                            "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+ManyToManyRight",
                             fk.PrincipalEntityType.Name);
                         Assert.Collection(
                             fk.PrincipalKey.Properties,
@@ -2770,7 +3013,7 @@ public virtual void TableName_preserved_when_generic()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithGenericKey<System.Guid>", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithGenericKey<System.Guid>", b =>
                 {
                     b.Property<Guid>("Id")
                         .ValueGeneratedOnAdd()
@@ -2814,7 +3057,7 @@ public virtual void Shared_columns_are_stored_in_the_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2832,7 +3075,7 @@ public virtual void Shared_columns_are_stored_in_the_snapshot()
                     b.ToTable("EntityWithProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -2847,18 +3090,18 @@ public virtual void Shared_columns_are_stored_in_the_snapshot()
                     b.ToTable("EntityWithProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                         .WithOne("EntityWithTwoProperties")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "Id")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "Id")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
                     b.Navigation("EntityWithOneProperty");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Navigation("EntityWithTwoProperties");
                 });
@@ -2885,7 +3128,7 @@ public virtual void PrimaryKey_name_preserved_when_generic()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithGenericKey<System.Guid>", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithGenericKey<System.Guid>", b =>
                 {
                     b.Property<Guid>("Id")
                         .ValueGeneratedOnAdd()
@@ -2924,7 +3167,7 @@ public virtual void AlternateKey_name_preserved_when_generic()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithGenericProperty<System.Guid>", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithGenericProperty<System.Guid>", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2962,7 +3205,7 @@ public virtual void Discriminator_of_enum()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithEnumType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithEnumType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -2994,7 +3237,7 @@ public virtual void Discriminator_of_enum_to_string()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithEnumType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithEnumType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3034,7 +3277,7 @@ public virtual void Temporal_table_information_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3074,7 +3317,7 @@ public virtual void Temporal_table_information_is_stored_in_snapshot()
             o =>
             {
                 var temporalEntity = o.FindEntityType(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty");
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty");
                 var annotations = temporalEntity.GetAnnotations().ToList();
 
                 Assert.Equal(7, annotations.Count);
@@ -3096,7 +3339,7 @@ public virtual void Temporal_table_information_is_stored_in_snapshot_minimal_set
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3136,7 +3379,7 @@ public virtual void Temporal_table_information_is_stored_in_snapshot_minimal_set
             o =>
             {
                 var temporalEntity = o.FindEntityType(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty");
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty");
                 var annotations = temporalEntity.GetAnnotations().ToList();
 
                 Assert.Equal(7, annotations.Count);
@@ -3194,7 +3437,7 @@ public virtual void Owned_types_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3214,7 +3457,7 @@ public virtual void Owned_types_are_stored_in_snapshot()
                         });
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", b =>
                 {
                     b.Property<string>("Id")
                         .HasColumnType("nvarchar(450)");
@@ -3224,9 +3467,9 @@ public virtual void Owned_types_are_stored_in_snapshot()
                     b.ToTable("EntityWithStringKey", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithTwoProperties", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithTwoProperties", b1 =>
                         {
                             b1.Property<int>("AlternateId")
                                 .HasColumnType("int");
@@ -3254,9 +3497,9 @@ public virtual void Owned_types_are_stored_in_snapshot()
                                 .HasForeignKey("AlternateId")
                                 .HasConstraintName("FK_Custom");
 
-                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", "EntityWithStringKey")
+                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", "EntityWithStringKey")
                                 .WithOne()
-                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty.EntityWithTwoProperties#Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithStringKeyId");
+                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty.EntityWithTwoProperties#Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithStringKeyId");
 
                             b1.Navigation("EntityWithOneProperty");
 
@@ -3273,9 +3516,9 @@ public virtual void Owned_types_are_stored_in_snapshot()
                     b.Navigation("EntityWithTwoProperties");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", b =>
                 {
-                    b.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", "Properties", b1 =>
+                    b.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", "Properties", b1 =>
                         {
                             b1.Property<int>("Id")
                                 .ValueGeneratedOnAdd()
@@ -3303,9 +3546,9 @@ public virtual void Owned_types_are_stored_in_snapshot()
 
                             b1.ToTable("EntityWithStringProperty", "DefaultSchema");
 
-                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                                 .WithOne()
-                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey.Properties#Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", "EntityWithOnePropertyId");
+                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey.Properties#Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", "EntityWithOnePropertyId");
 
                             b1.WithOwner()
                                 .HasForeignKey("EntityWithStringKeyId");
@@ -3423,7 +3666,7 @@ public virtual void Owned_types_are_stored_in_snapshot_when_excluded()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3446,7 +3689,7 @@ public virtual void Owned_types_are_stored_in_snapshot_when_excluded()
                         });
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", b =>
                 {
                     b.Property<string>("Id")
                         .HasColumnType("nvarchar(450)");
@@ -3459,9 +3702,9 @@ public virtual void Owned_types_are_stored_in_snapshot_when_excluded()
                         });
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithTwoProperties", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithTwoProperties", b1 =>
                         {
                             b1.Property<int>("AlternateId")
                                 .HasColumnType("int");
@@ -3487,9 +3730,9 @@ public virtual void Owned_types_are_stored_in_snapshot_when_excluded()
                                 .HasForeignKey("AlternateId")
                                 .HasConstraintName("FK_Custom");
 
-                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", "EntityWithStringKey")
+                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", "EntityWithStringKey")
                                 .WithOne()
-                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty.EntityWithTwoProperties#Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithStringKeyId");
+                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty.EntityWithTwoProperties#Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithStringKeyId");
 
                             b1.Navigation("EntityWithOneProperty");
 
@@ -3506,9 +3749,9 @@ public virtual void Owned_types_are_stored_in_snapshot_when_excluded()
                     b.Navigation("EntityWithTwoProperties");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", b =>
                 {
-                    b.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", "Properties", b1 =>
+                    b.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", "Properties", b1 =>
                         {
                             b1.Property<int>("Id")
                                 .ValueGeneratedOnAdd()
@@ -3539,9 +3782,9 @@ public virtual void Owned_types_are_stored_in_snapshot_when_excluded()
                                     t.ExcludeFromMigrations();
                                 });
 
-                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                            b1.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                                 .WithOne()
-                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey.Properties#Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", "EntityWithOnePropertyId");
+                                .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey.Properties#Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", "EntityWithOnePropertyId");
 
                             b1.WithOwner()
                                 .HasForeignKey("EntityWithStringKeyId");
@@ -3621,7 +3864,7 @@ public virtual void Shared_owned_types_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3634,9 +3877,9 @@ public virtual void Shared_owned_types_are_stored_in_snapshot()
                     b.ToTable("Order", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+Order", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+Order", b =>
                 {
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderDetails", "OrderBillingDetails", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderDetails", "OrderBillingDetails", b1 =>
                         {
                             b1.Property<int>("OrderId")
                                 .HasColumnType("int");
@@ -3648,7 +3891,7 @@ public virtual void Shared_owned_types_are_stored_in_snapshot()
                             b1.WithOwner()
                                 .HasForeignKey("OrderId");
 
-                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+StreetAddress", "StreetAddress", b2 =>
+                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+StreetAddress", "StreetAddress", b2 =>
                                 {
                                     b2.Property<int>("OrderDetailsOrderId")
                                         .HasColumnType("int");
@@ -3667,7 +3910,7 @@ public virtual void Shared_owned_types_are_stored_in_snapshot()
                             b1.Navigation("StreetAddress");
                         });
 
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderDetails", "OrderShippingDetails", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderDetails", "OrderShippingDetails", b1 =>
                         {
                             b1.Property<int>("OrderId")
                                 .HasColumnType("int");
@@ -3679,7 +3922,7 @@ public virtual void Shared_owned_types_are_stored_in_snapshot()
                             b1.WithOwner()
                                 .HasForeignKey("OrderId");
 
-                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+StreetAddress", "StreetAddress", b2 =>
+                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+StreetAddress", "StreetAddress", b2 =>
                                 {
                                     b2.Property<int>("OrderDetailsOrderId")
                                         .HasColumnType("int");
@@ -3698,7 +3941,7 @@ public virtual void Shared_owned_types_are_stored_in_snapshot()
                             b1.Navigation("StreetAddress");
                         });
 
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+OrderInfo", "OrderInfo", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+OrderInfo", "OrderInfo", b1 =>
                         {
                             b1.Property<int>("OrderId")
                                 .HasColumnType("int");
@@ -3710,7 +3953,7 @@ public virtual void Shared_owned_types_are_stored_in_snapshot()
                             b1.WithOwner()
                                 .HasForeignKey("OrderId");
 
-                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+StreetAddress", "StreetAddress", b2 =>
+                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+StreetAddress", "StreetAddress", b2 =>
                                 {
                                     b2.Property<int>("OrderInfoOrderId")
                                         .HasColumnType("int");
@@ -3797,7 +4040,7 @@ protected override void BuildModel(ModelBuilder modelBuilder)
 
             SqlServerModelBuilderExtensions.UseIdentityColumns(modelBuilder);
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwner", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwner", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3810,9 +4053,9 @@ protected override void BuildModel(ModelBuilder modelBuilder)
                     b.ToTable("TestOwner", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwner", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwner", b =>
                 {
-                    b.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwnee", "OwnedEntities", b1 =>
+                    b.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwnee", "OwnedEntities", b1 =>
                         {
                             b1.Property<int>("TestOwnerId")
                                 .HasColumnType("int");
@@ -3845,9 +4088,9 @@ protected override void BuildModel(ModelBuilder modelBuilder)
             {
                 Assert.Equal(2, model.GetEntityTypes().Count());
                 var testOwner = model.FindEntityType(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwner");
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwner");
                 var testOwnee = model.FindEntityType(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwnee", "OwnedEntities", testOwner);
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwnee", "OwnedEntities", testOwner);
                 Assert.Equal("OwnedView", testOwnee.GetViewName());
             });
 
@@ -3885,7 +4128,7 @@ protected override void BuildModel(ModelBuilder modelBuilder)
 
             SqlServerModelBuilderExtensions.UseIdentityColumns(modelBuilder);
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwner", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwner", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3898,9 +4141,9 @@ protected override void BuildModel(ModelBuilder modelBuilder)
                     b.ToTable("TestOwner", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwner", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwner", b =>
                 {
-                    b.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwnee", "OwnedEntities", b1 =>
+                    b.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwnee", "OwnedEntities", b1 =>
                         {
                             b1.Property<int>("TestOwnerId")
                                 .HasColumnType("int");
@@ -3937,9 +4180,9 @@ protected override void BuildModel(ModelBuilder modelBuilder)
             {
                 Assert.Equal(2, model.GetEntityTypes().Count());
                 var testOwner = model.FindEntityType(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwner");
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwner");
                 var testOwnee = model.FindEntityType(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+TestOwnee", "OwnedEntities", testOwner);
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+TestOwnee", "OwnedEntities", testOwner);
                 Assert.NotNull(testOwnee.FindCheckConstraint("CK_TestOwnee_TestEnum_Enum_Constraint"));
             });
 
@@ -3972,7 +4215,7 @@ public virtual void Owned_types_mapped_to_json_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -3986,9 +4229,9 @@ public virtual void Owned_types_mapped_to_json_are_stored_in_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
-                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithTwoProperties", b1 =>
+                    b.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithTwoProperties", b1 =>
                         {
                             b1.Property<int>("EntityWithOnePropertyId")
                                 .HasColumnType("int");
@@ -4006,7 +4249,7 @@ public virtual void Owned_types_mapped_to_json_are_stored_in_snapshot()
                             b1.WithOwner("EntityWithOneProperty")
                                 .HasForeignKey("EntityWithOnePropertyId");
 
-                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", "EntityWithStringKey", b2 =>
+                            b1.OwnsOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", "EntityWithStringKey", b2 =>
                                 {
                                     b2.Property<int>("EntityWithTwoPropertiesEntityWithOnePropertyId")
                                         .HasColumnType("int");
@@ -4018,7 +4261,7 @@ public virtual void Owned_types_mapped_to_json_are_stored_in_snapshot()
                                     b2.WithOwner()
                                         .HasForeignKey("EntityWithTwoPropertiesEntityWithOnePropertyId");
 
-                                    b2.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", "Properties", b3 =>
+                                    b2.OwnsMany("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", "Properties", b3 =>
                                         {
                                             b3.Property<int>("EntityWithStringKeyEntityWithTwoPropertiesEntityWithOnePropertyId")
                                                 .HasColumnType("int");
@@ -4149,7 +4392,7 @@ public virtual void Property_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4177,7 +4420,7 @@ public virtual void Custom_value_generator_is_ignored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4200,7 +4443,7 @@ public virtual void Property_isNullable_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4230,7 +4473,7 @@ public virtual void Property_ValueGenerated_value_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4263,7 +4506,7 @@ public virtual void Property_ValueGenerated_non_identity()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithEnumType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithEnumType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4297,7 +4540,7 @@ public virtual void Property_maxLength_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4323,7 +4566,7 @@ public virtual void Property_maximum_maxLength_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4349,7 +4592,7 @@ public virtual void Property_unicodeness_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4375,7 +4618,7 @@ public virtual void Property_fixedlengthness_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4405,7 +4648,7 @@ public virtual void Property_precision_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithDecimalProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithDecimalProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4439,7 +4682,7 @@ public virtual void Property_precision_and_scale_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithDecimalProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithDecimalProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4477,7 +4720,7 @@ public virtual void Many_facets_chained_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4515,7 +4758,7 @@ public virtual void Property_concurrencyToken_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4545,7 +4788,7 @@ public virtual void Property_column_name_annotation_is_stored_in_snapshot_as_flu
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4578,7 +4821,7 @@ public virtual void Property_column_name_is_stored_in_snapshot_when_DefaultColum
 
             SqlServerModelBuilderExtensions.UseIdentityColumns(modelBuilder);
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BarBase", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BarBase", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4600,7 +4843,7 @@ public virtual void Property_column_name_is_stored_in_snapshot_when_DefaultColum
                     b.UseTphMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+FooExtension<Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BarA>", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+FooExtension<Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BarA>", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4613,9 +4856,9 @@ public virtual void Property_column_name_is_stored_in_snapshot_when_DefaultColum
                     b.ToTable("FooExtension<BarA>", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BarA", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BarA", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BarBase");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BarBase");
 
                     b.Property<int?>("FooExtensionId")
                         .HasColumnType("int")
@@ -4628,14 +4871,14 @@ public virtual void Property_column_name_is_stored_in_snapshot_when_DefaultColum
                     b.HasDiscriminator().HasValue("BarA");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BarA", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BarA", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+FooExtension<Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BarA>", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+FooExtension<Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BarA>", null)
                         .WithOne("Bar")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BarA", "FooExtensionId");
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BarA", "FooExtensionId");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+FooExtension<Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BarA>", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+FooExtension<Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BarA>", b =>
                 {
                     b.Navigation("Bar");
                 });
@@ -4661,7 +4904,7 @@ public virtual void Property_column_name_on_specific_table_is_stored_in_snapshot
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4683,9 +4926,9 @@ public virtual void Property_column_name_on_specific_table_is_stored_in_snapshot
                     b.UseTphMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -4693,9 +4936,9 @@ public virtual void Property_column_name_on_specific_table_is_stored_in_snapshot
                     b.HasDiscriminator().HasValue("DerivedEntity");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DuplicateDerivedEntity", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DuplicateDerivedEntity", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity");
 
                     b.Property<string>("Name")
                         .HasColumnType("nvarchar(max)");
@@ -4714,12 +4957,12 @@ public virtual void Property_column_name_on_specific_table_is_stored_in_snapshot
                 Assert.Equal(3, o.GetEntityTypes().Count());
                 Assert.Collection(
                     o.GetEntityTypes(),
-                    t => Assert.Equal("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseEntity", t.Name),
-                    t => Assert.Equal("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedEntity", t.Name),
+                    t => Assert.Equal("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseEntity", t.Name),
+                    t => Assert.Equal("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedEntity", t.Name),
                     t =>
                     {
                         Assert.Equal(
-                            "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DuplicateDerivedEntity", t.Name);
+                            "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DuplicateDerivedEntity", t.Name);
                         Assert.Equal(
                             "DuplicateDerivedEntity_Name",
                             t.FindProperty(nameof(DuplicateDerivedEntity.Name))
@@ -4739,7 +4982,7 @@ public virtual void Property_column_type_annotation_is_stored_in_snapshot_as_flu
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4768,7 +5011,7 @@ public virtual void Property_default_value_annotation_is_stored_in_snapshot_as_f
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4799,7 +5042,7 @@ public virtual void Property_default_value_annotation_is_stored_in_snapshot_as_f
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4831,7 +5074,7 @@ public virtual void Property_default_value_sql_annotation_is_stored_in_snapshot_
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4862,7 +5105,7 @@ public virtual void Property_default_value_sql_annotation_is_stored_in_snapshot_
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4893,7 +5136,7 @@ public virtual void Property_computed_column_sql_annotation_is_stored_in_snapsho
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4924,7 +5167,7 @@ public virtual void Property_computed_column_sql_stored_annotation_is_stored_in_
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4959,7 +5202,7 @@ public virtual void Property_computed_column_sql_annotation_is_stored_in_snapsho
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -4986,7 +5229,7 @@ public virtual void Property_default_value_of_enum_type_is_stored_in_snapshot_wi
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithEnumType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithEnumType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5020,7 +5263,7 @@ public virtual void Property_enum_type_is_stored_in_snapshot_with_custom_convers
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithEnumType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithEnumType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5061,7 +5304,7 @@ public virtual void Property_of_nullable_enum()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithNullableEnumType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithNullableEnumType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5087,7 +5330,7 @@ public virtual void Property_of_enum_to_nullable()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithEnumType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithEnumType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5112,7 +5355,7 @@ public virtual void Property_of_nullable_enum_to_string()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithNullableEnumType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithNullableEnumType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5142,7 +5385,7 @@ public virtual void Property_multiple_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5379,7 +5622,7 @@ public virtual void Property_column_order_annotation_is_stored_in_snapshot_as_fl
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5424,7 +5667,7 @@ public virtual void SQLServer_property_legacy_identity_seed_int_annotation()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5468,7 +5711,7 @@ public virtual void Complex_properties_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5476,7 +5719,7 @@ public virtual void Complex_properties_are_stored_in_snapshot()
 
                     SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));
 
-                    b.ComplexProperty<Dictionary<string, object>>("EntityWithTwoProperties", "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties", b1 =>
+                    b.ComplexProperty<Dictionary<string, object>>("EntityWithTwoProperties", "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties", b1 =>
                         {
                             b1.IsRequired();
 
@@ -5487,7 +5730,7 @@ public virtual void Complex_properties_are_stored_in_snapshot()
                             b1.Property<int>("Id")
                                 .HasColumnType("int");
 
-                            b1.ComplexProperty<Dictionary<string, object>>("EntityWithStringKey", "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties.EntityWithStringKey#EntityWithStringKey", b2 =>
+                            b1.ComplexProperty<Dictionary<string, object>>("EntityWithStringKey", "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties.EntityWithStringKey#EntityWithStringKey", b2 =>
                                 {
                                     b2.IsRequired();
 
@@ -5515,7 +5758,7 @@ public virtual void Complex_properties_are_stored_in_snapshot()
                 Assert.False(complexProperty.IsNullable);
                 var complexType = complexProperty.ComplexType;
                 Assert.Equal(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties",
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties",
                     complexType.Name);
                 Assert.Equal("EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties", complexType.DisplayName());
                 Assert.Equal(nameof(EntityWithOneProperty), complexType.GetTableName());
@@ -5529,7 +5772,7 @@ public virtual void Complex_properties_are_stored_in_snapshot()
                 Assert.False(nestedComplexProperty.IsNullable);
                 var nestedComplexType = nestedComplexProperty.ComplexType;
                 Assert.Equal(
-                    "Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties.EntityWithStringKey#EntityWithStringKey",
+                    "Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties.EntityWithStringKey#EntityWithStringKey",
                     nestedComplexType.Name);
                 Assert.Equal(
                     "EntityWithOneProperty.EntityWithTwoProperties#EntityWithTwoProperties.EntityWithStringKey#EntityWithStringKey",
@@ -5555,7 +5798,7 @@ public virtual void Key_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5588,7 +5831,7 @@ public virtual void Key_Fluent_APIs_are_properly_generated()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5616,7 +5859,7 @@ public virtual void Key_name_annotation_is_stored_in_snapshot_as_fluent_api()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5650,7 +5893,7 @@ public virtual void Key_multiple_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5694,7 +5937,7 @@ public virtual void Index_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5726,7 +5969,7 @@ public virtual void Index_Fluent_APIs_are_properly_generated()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5759,7 +6002,7 @@ public virtual void Index_IsUnique_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5832,7 +6075,7 @@ public virtual void Index_IsDescending_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithThreeProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithThreeProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5901,7 +6144,7 @@ public virtual void Index_database_name_annotation_is_stored_in_snapshot_as_flue
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5939,7 +6182,7 @@ public virtual void Index_filter_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -5974,7 +6217,7 @@ public virtual void Index_multiple_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6016,7 +6259,7 @@ public virtual void Index_with_default_constraint_name_exceeding_max()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6046,7 +6289,7 @@ public virtual void IndexAttribute_causes_column_to_have_key_or_index_column_len
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithIndexAttribute", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithIndexAttribute", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6089,7 +6332,7 @@ public virtual void IndexAttribute_name_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithNamedIndexAttribute", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithNamedIndexAttribute", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6136,7 +6379,7 @@ public virtual void IndexAttribute_IsUnique_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithUniqueIndexAttribute", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithUniqueIndexAttribute", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6189,7 +6432,7 @@ public virtual void IndexAttribute_IncludeProperties_generated_without_fluent_ap
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6226,7 +6469,7 @@ public virtual void IndexAttribute_HasFillFactor_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6263,7 +6506,7 @@ public virtual void IndexAttribute_UseDataCompression_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6300,7 +6543,7 @@ public virtual void IndexAttribute_SortInTempDb_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6344,7 +6587,7 @@ public virtual void ForeignKey_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6357,7 +6600,7 @@ public virtual void ForeignKey_annotations_are_stored_in_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6376,11 +6619,11 @@ public virtual void ForeignKey_annotations_are_stored_in_snapshot()
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                         .WithOne("EntityWithTwoProperties")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "AlternateId")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "AlternateId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired()
                         .HasAnnotation("AnnotationName", "AnnotationValue");
@@ -6388,7 +6631,7 @@ public virtual void ForeignKey_annotations_are_stored_in_snapshot()
                     b.Navigation("EntityWithOneProperty");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Navigation("EntityWithTwoProperties");
                 });
@@ -6411,7 +6654,7 @@ public virtual void ForeignKey_isRequired_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", b =>
                 {
                     b.Property<string>("Id")
                         .HasColumnType("nvarchar(450)");
@@ -6421,7 +6664,7 @@ public virtual void ForeignKey_isRequired_is_stored_in_snapshot()
                     b.ToTable("EntityWithStringKey", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6441,11 +6684,11 @@ public virtual void ForeignKey_isRequired_is_stored_in_snapshot()
                     b.ToTable("EntityWithStringProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", null)
                         .WithOne()
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", "Name")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", "Name")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
                 });
@@ -6465,7 +6708,7 @@ public virtual void ForeignKey_isUnique_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", b =>
                 {
                     b.Property<string>("Id")
                         .HasColumnType("nvarchar(450)");
@@ -6475,7 +6718,7 @@ public virtual void ForeignKey_isUnique_is_stored_in_snapshot()
                     b.ToTable("EntityWithStringKey", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6493,14 +6736,14 @@ public virtual void ForeignKey_isUnique_is_stored_in_snapshot()
                     b.ToTable("EntityWithStringProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", null)
                         .WithMany("Properties")
                         .HasForeignKey("Name");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringKey", b =>
                 {
                     b.Navigation("Properties");
                 });
@@ -6521,7 +6764,7 @@ public virtual void ForeignKey_with_non_primary_principal_is_stored_in_snapshot(
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringAlternateKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringAlternateKey", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6538,7 +6781,7 @@ public virtual void ForeignKey_with_non_primary_principal_is_stored_in_snapshot(
                     b.ToTable("EntityWithStringAlternateKey", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6556,15 +6799,15 @@ public virtual void ForeignKey_with_non_primary_principal_is_stored_in_snapshot(
                     b.ToTable("EntityWithStringProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringProperty", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringAlternateKey", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringAlternateKey", null)
                         .WithMany("Properties")
                         .HasForeignKey("Name")
                         .HasPrincipalKey("AlternateId");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithStringAlternateKey", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithStringAlternateKey", b =>
                 {
                     b.Navigation("Properties");
                 });
@@ -6585,7 +6828,7 @@ public virtual void ForeignKey_deleteBehavior_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -6595,7 +6838,7 @@ public virtual void ForeignKey_deleteBehavior_is_stored_in_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6611,9 +6854,9 @@ public virtual void ForeignKey_deleteBehavior_is_stored_in_snapshot()
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithTwoProperties")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithTwoProperties")
                         .WithMany()
                         .HasForeignKey("Id")
                         .OnDelete(DeleteBehavior.Cascade)
@@ -6638,7 +6881,7 @@ public virtual void ForeignKey_deleteBehavior_is_stored_in_snapshot_for_one_to_o
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -6648,7 +6891,7 @@ public virtual void ForeignKey_deleteBehavior_is_stored_in_snapshot_for_one_to_o
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6664,18 +6907,18 @@ public virtual void ForeignKey_deleteBehavior_is_stored_in_snapshot_for_one_to_o
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithTwoProperties")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithTwoProperties")
                         .WithOne("EntityWithOneProperty")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "Id")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "Id")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
                     b.Navigation("EntityWithTwoProperties");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Navigation("EntityWithOneProperty");
                 });
@@ -6699,7 +6942,7 @@ public virtual void ForeignKey_name_preserved_when_generic()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithGenericKey<System.Guid>", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithGenericKey<System.Guid>", b =>
                 {
                     b.Property<Guid>("Id")
                         .ValueGeneratedOnAdd()
@@ -6710,7 +6953,7 @@ public virtual void ForeignKey_name_preserved_when_generic()
                     b.ToTable("EntityWithGenericKey<Guid>", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithGenericProperty<System.Guid>", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithGenericProperty<System.Guid>", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6728,9 +6971,9 @@ public virtual void ForeignKey_name_preserved_when_generic()
                     b.ToTable("EntityWithGenericProperty<Guid>", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithGenericProperty<System.Guid>", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithGenericProperty<System.Guid>", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithGenericKey<System.Guid>", null)
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithGenericKey<System.Guid>", null)
                         .WithMany()
                         .HasForeignKey("Property")
                         .OnDelete(DeleteBehavior.Cascade)
@@ -6779,7 +7022,7 @@ public virtual void ForeignKey_constraint_name_is_stored_in_snapshot_as_fluent_a
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6792,7 +7035,7 @@ public virtual void ForeignKey_constraint_name_is_stored_in_snapshot_as_fluent_a
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6811,11 +7054,11 @@ public virtual void ForeignKey_constraint_name_is_stored_in_snapshot_as_fluent_a
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                         .WithOne("EntityWithTwoProperties")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "AlternateId")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "AlternateId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired()
                         .HasConstraintName("Constraint");
@@ -6823,7 +7066,7 @@ public virtual void ForeignKey_constraint_name_is_stored_in_snapshot_as_fluent_a
                     b.Navigation("EntityWithOneProperty");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Navigation("EntityWithTwoProperties");
                 });
@@ -6846,7 +7089,7 @@ public virtual void ForeignKey_multiple_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6859,7 +7102,7 @@ public virtual void ForeignKey_multiple_annotations_are_stored_in_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6878,11 +7121,11 @@ public virtual void ForeignKey_multiple_annotations_are_stored_in_snapshot()
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                         .WithOne("EntityWithTwoProperties")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "AlternateId")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "AlternateId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired()
                         .HasConstraintName("Constraint")
@@ -6891,7 +7134,7 @@ public virtual void ForeignKey_multiple_annotations_are_stored_in_snapshot()
                     b.Navigation("EntityWithOneProperty");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Navigation("EntityWithTwoProperties");
                 });
@@ -6916,7 +7159,7 @@ public virtual void Do_not_generate_entity_type_builder_again_if_no_foreign_key_
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseType", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6943,7 +7186,7 @@ public virtual void Do_not_generate_entity_type_builder_again_if_no_foreign_key_
                     b.UseTphMappingStrategy();
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -6956,16 +7199,16 @@ public virtual void Do_not_generate_entity_type_builder_again_if_no_foreign_key_
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+DerivedType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+DerivedType", b =>
                 {
-                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseType");
+                    b.HasBaseType("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseType");
 
                     b.HasDiscriminator().HasValue("DerivedType");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+BaseType", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+BaseType", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "Navigation")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "Navigation")
                         .WithMany()
                         .HasForeignKey("NavigationId");
 
@@ -6988,7 +7231,7 @@ public virtual void ForeignKey_principal_key_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -6998,7 +7241,7 @@ public virtual void ForeignKey_principal_key_is_stored_in_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -7014,19 +7257,19 @@ public virtual void ForeignKey_principal_key_is_stored_in_snapshot()
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithTwoProperties")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithTwoProperties")
                         .WithOne("EntityWithOneProperty")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "Id")
-                        .HasPrincipalKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "AlternateId")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "Id")
+                        .HasPrincipalKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "AlternateId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
                     b.Navigation("EntityWithTwoProperties");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Navigation("EntityWithOneProperty");
                 });
@@ -7053,7 +7296,7 @@ public virtual void ForeignKey_principal_key_with_non_default_name_is_stored_in_
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .HasColumnType("int");
@@ -7063,7 +7306,7 @@ public virtual void ForeignKey_principal_key_with_non_default_name_is_stored_in_
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -7082,19 +7325,19 @@ public virtual void ForeignKey_principal_key_with_non_default_name_is_stored_in_
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "EntityWithTwoProperties")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "EntityWithTwoProperties")
                         .WithOne("EntityWithOneProperty")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "Id")
-                        .HasPrincipalKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "AlternateId")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "Id")
+                        .HasPrincipalKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "AlternateId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
                     b.Navigation("EntityWithTwoProperties");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Navigation("EntityWithOneProperty");
                 });
@@ -7127,7 +7370,7 @@ public virtual void Navigation_annotations_are_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -7140,7 +7383,7 @@ public virtual void Navigation_annotations_are_stored_in_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -7159,11 +7402,11 @@ public virtual void Navigation_annotations_are_stored_in_snapshot()
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                         .WithOne("EntityWithTwoProperties")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "AlternateId")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "AlternateId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
@@ -7171,7 +7414,7 @@ public virtual void Navigation_annotations_are_stored_in_snapshot()
                         .HasAnnotation("AnnotationName", "AnnotationValue");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Navigation("EntityWithTwoProperties");
                 });
@@ -7195,7 +7438,7 @@ public virtual void Navigation_isRequired_is_stored_in_snapshot()
             AddBoilerPlate(
                 GetHeading()
                 + """
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -7208,7 +7451,7 @@ public virtual void Navigation_isRequired_is_stored_in_snapshot()
                     b.ToTable("EntityWithOneProperty", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -7227,18 +7470,18 @@ public virtual void Navigation_isRequired_is_stored_in_snapshot()
                     b.ToTable("EntityWithTwoProperties", "DefaultSchema");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", b =>
                 {
-                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", "EntityWithOneProperty")
+                    b.HasOne("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", "EntityWithOneProperty")
                         .WithOne("EntityWithTwoProperties")
-                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithTwoProperties", "AlternateId")
+                        .HasForeignKey("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithTwoProperties", "AlternateId")
                         .OnDelete(DeleteBehavior.Cascade)
                         .IsRequired();
 
                     b.Navigation("EntityWithOneProperty");
                 });
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithOneProperty", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithOneProperty", b =>
                 {
                     b.Navigation("EntityWithTwoProperties")
                         .IsRequired();
@@ -7274,7 +7517,8 @@ static List<IProperty> getAllProperties(IModel model)
         };
 
         var multiPoint = new MultiPoint(
-            new[] { new Point(1.1, 2.2), new Point(2.2, 2.2), new Point(2.2, 1.1) }) { SRID = 4326 };
+            new[] { new Point(1.1, 2.2), new Point(2.2, 2.2), new Point(2.2, 1.1) })
+        { SRID = 4326 };
 
         var polygon1 = new Polygon(
             new LinearRing(
@@ -7293,10 +7537,12 @@ static List<IProperty> getAllProperties(IModel model)
         var point1 = new Point(1.1, 2.2, 3.3) { SRID = 4326 };
 
         var multiLineString = new MultiLineString(
-            new[] { lineString1, lineString2 }) { SRID = 4326 };
+            new[] { lineString1, lineString2 })
+        { SRID = 4326 };
 
         var multiPolygon = new MultiPolygon(
-            new[] { polygon2, polygon1 }) { SRID = 4326 };
+            new[] { polygon2, polygon1 })
+        { SRID = 4326 };
 
         var geometryCollection = new GeometryCollection(
             new Geometry[] { lineString1, lineString2, multiPoint, polygon1, polygon2, point1, multiLineString, multiPolygon })
@@ -7421,7 +7667,7 @@ protected override void BuildModel(ModelBuilder modelBuilder)
 
             SqlServerModelBuilderExtensions.UseIdentityColumns(modelBuilder);
 
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.ModelSnapshotSqlServerTest+EntityWithManyProperties", b =>
+            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithManyProperties", b =>
                 {
                     b.Property<int>("Id")
                         .ValueGeneratedOnAdd()
@@ -7812,6 +8058,7 @@ protected virtual ICollection<BuildReference> GetReferences()
             BuildReference.ByName("Microsoft.EntityFrameworkCore.Abstractions"),
             BuildReference.ByName("Microsoft.EntityFrameworkCore.Relational"),
             BuildReference.ByName("Microsoft.EntityFrameworkCore.SqlServer"),
+            BuildReference.ByName("Microsoft.EntityFrameworkCore.Design.Tests"),
             BuildReference.ByName("NetTopologySuite")
         };
 
@@ -7901,9 +8148,9 @@ protected IModel BuildModelFromSnapshotSource(string code)
         }
 
         var assembly = build.BuildInMemory();
-        var factoryType = assembly.GetType("RootNamespace.Snapshot");
+        var snapshotType = assembly.GetType("RootNamespace.Snapshot");
 
-        var buildModelMethod = factoryType.GetMethod(
+        var buildModelMethod = snapshotType.GetMethod(
             "BuildModel",
             BindingFlags.Instance | BindingFlags.NonPublic,
             null,
@@ -7914,7 +8161,7 @@ protected IModel BuildModelFromSnapshotSource(string code)
         builder.Model.RemoveAnnotation(CoreAnnotationNames.ProductVersion);
 
         buildModelMethod.Invoke(
-            Activator.CreateInstance(factoryType),
+            Activator.CreateInstance(snapshotType),
             new object[] { builder });
 
         var services = TestHelpers.CreateContextServices(new ServiceCollection().AddEntityFrameworkSqlServerNetTopologySuite());
diff --git a/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.cs b/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.cs
index 9562b6d707..f6c3196a6f 100644
--- a/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.cs
+++ b/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.cs
@@ -14,7 +14,7 @@
 // ReSharper disable UnusedMember.Local
 namespace Microsoft.EntityFrameworkCore.Migrations.Design;
 
-public class CSharpMigrationsGeneratorTest
+public partial class CSharpMigrationsGeneratorTest
 {
     private static readonly string _nl = Environment.NewLine;
     private static readonly string _toTable = _nl + @"entityTypeBuilder.ToTable(""WithAnnotations"")";
@@ -727,259 +727,14 @@ public EntityWithConstructorBinding(int id)
         public int Id { get; }
     }
 
-    [ConditionalFact]
-    public void Snapshots_compile()
-    {
-        var generator = CreateMigrationsCodeGenerator();
-
-        var modelBuilder = FakeRelationalTestHelpers.Instance.CreateConventionBuilder();
-        modelBuilder.Model.RemoveAnnotation(CoreAnnotationNames.ProductVersion);
-        modelBuilder.Entity<EntityWithConstructorBinding>(
-            x =>
-            {
-                x.Property(e => e.Id);
-
-                x.Property<Guid>("PropertyWithValueGenerator").HasValueGenerator<GuidValueGenerator>();
-            });
-        modelBuilder.HasDbFunction(() => MyDbFunction());
-
-        var model = modelBuilder.Model;
-        model["Some:EnumValue"] = RegexOptions.Multiline;
-
-        var entityType = model.AddEntityType("Cheese");
-        var property1 = entityType.AddProperty("Pickle", typeof(StringBuilder));
-        property1.SetValueConverter(
-            new ValueConverter<StringBuilder, string>(
-                v => v.ToString(), v => new StringBuilder(v), new ConverterMappingHints(size: 10)));
-
-        var property2 = entityType.AddProperty("Ham", typeof(RawEnum));
-        property2.SetValueConverter(
-            new ValueConverter<RawEnum, string>(
-                v => v.ToString(), v => (RawEnum)Enum.Parse(typeof(RawEnum), v), new ConverterMappingHints(size: 10)));
-
-        entityType.SetPrimaryKey(property2);
-
-        var finalizedModel = modelBuilder.FinalizeModel(designTime: true);
-
-        var modelSnapshotCode = generator.GenerateSnapshot(
-            "MyNamespace",
-            typeof(MyContext),
-            "MySnapshot",
-            finalizedModel);
-        Assert.Equal(
-            """
-// <auto-generated />
-using System;
-using System.Text.RegularExpressions;
-using Microsoft.EntityFrameworkCore;
-using Microsoft.EntityFrameworkCore.Infrastructure;
-using Microsoft.EntityFrameworkCore.Migrations.Design;
-using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
-
-#nullable disable
-
-namespace MyNamespace
-{
-    [DbContext(typeof(CSharpMigrationsGeneratorTest.MyContext))]
-    partial class MySnapshot : ModelSnapshot
-    {
-        protected override void BuildModel(ModelBuilder modelBuilder)
-        {
-#pragma warning disable 612, 618
-            modelBuilder.HasAnnotation("Some:EnumValue", RegexOptions.Multiline);
-
-            modelBuilder.Entity("Cheese", b =>
-                {
-                    b.Property<string>("Ham")
-                        .HasColumnType("just_string(10)");
-
-                    b.Property<string>("Pickle")
-                        .HasColumnType("just_string(10)");
-
-                    b.HasKey("Ham");
-
-                    b.ToTable("Cheese");
-                });
-
-            modelBuilder.Entity("Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGeneratorTest+EntityWithConstructorBinding", b =>
-                {
-                    b.Property<int>("Id")
-                        .ValueGeneratedOnAdd()
-                        .HasColumnType("default_int_mapping");
-
-                    b.Property<Guid>("PropertyWithValueGenerator")
-                        .HasColumnType("default_guid_mapping");
-
-                    b.HasKey("Id");
-
-                    b.ToTable("EntityWithConstructorBinding");
-                });
-#pragma warning restore 612, 618
-        }
-    }
-}
-
-""", modelSnapshotCode, ignoreLineEndingDifferences: true);
-
-        var snapshot = CompileModelSnapshot(modelSnapshotCode, "MyNamespace.MySnapshot");
-        Assert.Equal(2, snapshot.Model.GetEntityTypes().Count());
-    }
-
-    [ConditionalFact]
-    public void Snapshot_with_default_values_are_round_tripped()
+    private ModelSnapshot CompileModelSnapshot(string code, string modelSnapshotTypeName)
     {
-        var generator = CreateMigrationsCodeGenerator();
-
-        var modelBuilder = FakeRelationalTestHelpers.Instance.CreateConventionBuilder();
-        modelBuilder.Entity<EntityWithEveryPrimitive>(
-            eb =>
-            {
-                eb.Property(e => e.Boolean).HasDefaultValue(false);
-                eb.Property(e => e.Byte).HasDefaultValue(byte.MinValue);
-                eb.Property(e => e.ByteArray).HasDefaultValue(new byte[] { 0 });
-                eb.Property(e => e.Char).HasDefaultValue('0');
-                eb.Property(e => e.DateTime).HasDefaultValue(DateTime.MinValue);
-                eb.Property(e => e.DateTimeOffset).HasDefaultValue(DateTimeOffset.MinValue);
-                eb.Property(e => e.Decimal).HasDefaultValue(decimal.MinValue);
-                eb.Property(e => e.Double).HasDefaultValue(double.MinValue); //double.NegativeInfinity
-                eb.Property(e => e.Enum).HasDefaultValue(Enum1.Default);
-                eb.Property(e => e.NullableEnum).HasDefaultValue(Enum1.Default).HasConversion<string>();
-                eb.Property(e => e.Guid).HasDefaultValue(Guid.NewGuid());
-                eb.Property(e => e.Int16).HasDefaultValue(short.MaxValue);
-                eb.Property(e => e.Int32).HasDefaultValue(int.MaxValue);
-                eb.Property(e => e.Int64).HasDefaultValue(long.MaxValue);
-                eb.Property(e => e.Single).HasDefaultValue(float.Epsilon);
-                eb.Property(e => e.SByte).HasDefaultValue(sbyte.MinValue);
-                eb.Property(e => e.String).HasDefaultValue("'\"'@\r\\\n");
-                eb.Property(e => e.TimeSpan).HasDefaultValue(TimeSpan.MaxValue);
-                eb.Property(e => e.UInt16).HasDefaultValue(ushort.MinValue);
-                eb.Property(e => e.UInt32).HasDefaultValue(uint.MinValue);
-                eb.Property(e => e.UInt64).HasDefaultValue(ulong.MinValue);
-                eb.Property(e => e.NullableBoolean).HasDefaultValue(true);
-                eb.Property(e => e.NullableByte).HasDefaultValue(byte.MaxValue);
-                eb.Property(e => e.NullableChar).HasDefaultValue('\'');
-                eb.Property(e => e.NullableDateTime).HasDefaultValue(DateTime.MaxValue);
-                eb.Property(e => e.NullableDateTimeOffset).HasDefaultValue(DateTimeOffset.MaxValue);
-                eb.Property(e => e.NullableDecimal).HasDefaultValue(decimal.MaxValue);
-                eb.Property(e => e.NullableDouble).HasDefaultValue(0.6822871999174);
-                eb.Property(e => e.NullableEnum).HasDefaultValue(Enum1.One | Enum1.Two);
-                eb.Property(e => e.NullableStringEnum).HasDefaultValue(Enum1.One).HasConversion<string>();
-                eb.Property(e => e.NullableGuid).HasDefaultValue(new Guid());
-                eb.Property(e => e.NullableInt16).HasDefaultValue(short.MinValue);
-                eb.Property(e => e.NullableInt32).HasDefaultValue(int.MinValue);
-                eb.Property(e => e.NullableInt64).HasDefaultValue(long.MinValue);
-                eb.Property(e => e.NullableSingle).HasDefaultValue(0.3333333f);
-                eb.Property(e => e.NullableSByte).HasDefaultValue(sbyte.MinValue);
-                eb.Property(e => e.NullableTimeSpan).HasDefaultValue(TimeSpan.MinValue.Add(new TimeSpan()));
-                eb.Property(e => e.NullableUInt16).HasDefaultValue(ushort.MaxValue);
-                eb.Property(e => e.NullableUInt32).HasDefaultValue(uint.MaxValue);
-                eb.Property(e => e.NullableUInt64).HasDefaultValue(ulong.MaxValue);
-
-                eb.HasKey(e => e.Boolean);
-            });
+        var build = new BuildSource { Sources = { { "Snapshot.cs", code } } };
 
-        var finalizedModel = modelBuilder.FinalizeModel(designTime: true);
-
-        var modelSnapshotCode = generator.GenerateSnapshot(
-            "MyNamespace",
-            typeof(MyContext),
-            "MySnapshot",
-            finalizedModel);
-
-        var snapshot = CompileModelSnapshot(modelSnapshotCode, "MyNamespace.MySnapshot");
-        var entityType = snapshot.Model.GetEntityTypes().Single();
-        Assert.Equal(typeof(EntityWithEveryPrimitive).FullName + " (Dictionary<string, object>)", entityType.DisplayName());
-
-        foreach (var property in modelBuilder.Model.GetEntityTypes().Single().GetProperties())
+        foreach (var buildReference in GetReferences())
         {
-            var expected = property.GetDefaultValue();
-            var actual = entityType.FindProperty(property.Name).GetDefaultValue();
-
-            if (actual != null
-                && expected != null)
-            {
-                if (expected.GetType().IsEnum)
-                {
-                    actual = actual is string actualString
-                        ? Enum.Parse(expected.GetType(), actualString)
-                        : Enum.ToObject(expected.GetType(), actual);
-                }
-
-                if (actual.GetType() != expected.GetType())
-                {
-                    actual = Convert.ChangeType(actual, expected.GetType());
-                }
-            }
-
-            Assert.Equal(expected, actual);
+            build.References.Add(buildReference);
         }
-    }
-
-    private class EntityWithEveryPrimitive
-    {
-        public bool Boolean { get; set; }
-        public byte Byte { get; set; }
-        public byte[] ByteArray { get; set; }
-        public char Char { get; set; }
-        public DateTime DateTime { get; set; }
-        public DateTimeOffset DateTimeOffset { get; set; }
-        public decimal Decimal { get; set; }
-        public double Double { get; set; }
-        public Enum1 Enum { get; set; }
-        public Enum1 StringEnum { get; set; }
-        public Guid Guid { get; set; }
-        public short Int16 { get; set; }
-        public int Int32 { get; set; }
-        public long Int64 { get; set; }
-        public bool? NullableBoolean { get; set; }
-        public byte? NullableByte { get; set; }
-        public char? NullableChar { get; set; }
-        public DateTime? NullableDateTime { get; set; }
-        public DateTimeOffset? NullableDateTimeOffset { get; set; }
-        public decimal? NullableDecimal { get; set; }
-        public double? NullableDouble { get; set; }
-        public Enum1? NullableEnum { get; set; }
-        public Enum1? NullableStringEnum { get; set; }
-        public Guid? NullableGuid { get; set; }
-        public short? NullableInt16 { get; set; }
-        public int? NullableInt32 { get; set; }
-        public long? NullableInt64 { get; set; }
-        public sbyte? NullableSByte { get; set; }
-        public float? NullableSingle { get; set; }
-        public TimeSpan? NullableTimeSpan { get; set; }
-        public ushort? NullableUInt16 { get; set; }
-        public uint? NullableUInt32 { get; set; }
-        public ulong? NullableUInt64 { get; set; }
-        public int PrivateSetter { get; private set; }
-        public sbyte SByte { get; set; }
-        public float Single { get; set; }
-        public string String { get; set; }
-        public TimeSpan TimeSpan { get; set; }
-        public ushort UInt16 { get; set; }
-        public uint UInt32 { get; set; }
-        public ulong UInt64 { get; set; }
-    }
-
-    [Flags]
-    public enum Enum1
-    {
-        Default = 0,
-        One = 1,
-        Two = 2
-    }
-
-    private ModelSnapshot CompileModelSnapshot(string modelSnapshotCode, string modelSnapshotTypeName)
-    {
-        var build = new BuildSource
-        {
-            References =
-            {
-                BuildReference.ByName("Microsoft.EntityFrameworkCore.Design.Tests"),
-                BuildReference.ByName("Microsoft.EntityFrameworkCore"),
-                BuildReference.ByName("Microsoft.EntityFrameworkCore.Relational")
-            },
-            Sources = { { "MigrationSnapshot.cs", modelSnapshotCode } }
-        };
 
         var assembly = build.BuildInMemory();
 
diff --git a/test/EFCore.Design.Tests/Scaffolding/Internal/CSharpNamerTest.cs b/test/EFCore.Design.Tests/Scaffolding/Internal/CSharpNamerTest.cs
index 735af77265..96f03bd0db 100644
--- a/test/EFCore.Design.Tests/Scaffolding/Internal/CSharpNamerTest.cs
+++ b/test/EFCore.Design.Tests/Scaffolding/Internal/CSharpNamerTest.cs
@@ -2,9 +2,8 @@
 // The .NET Foundation licenses this file to you under the MIT license.
 
 using Microsoft.EntityFrameworkCore.Design.Internal;
-using Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 
 public class CSharpNamerTest
 {
diff --git a/test/EFCore.Design.Tests/Scaffolding/Internal/CSharpUniqueNamerTest.cs b/test/EFCore.Design.Tests/Scaffolding/Internal/CSharpUniqueNamerTest.cs
index 18a7e9472c..6188385312 100644
--- a/test/EFCore.Design.Tests/Scaffolding/Internal/CSharpUniqueNamerTest.cs
+++ b/test/EFCore.Design.Tests/Scaffolding/Internal/CSharpUniqueNamerTest.cs
@@ -2,10 +2,9 @@
 // The .NET Foundation licenses this file to you under the MIT license.
 
 using Microsoft.EntityFrameworkCore.Design.Internal;
-using Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 using Microsoft.EntityFrameworkCore.Scaffolding.Metadata;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 
 public class CSharpUniqueNamerTest
 {
diff --git a/test/EFCore.Design.Tests/Scaffolding/Internal/CandidateNamingServiceTest.cs b/test/EFCore.Design.Tests/Scaffolding/Internal/CandidateNamingServiceTest.cs
index 6f7d503721..5cffbade62 100644
--- a/test/EFCore.Design.Tests/Scaffolding/Internal/CandidateNamingServiceTest.cs
+++ b/test/EFCore.Design.Tests/Scaffolding/Internal/CandidateNamingServiceTest.cs
@@ -1,10 +1,9 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-using Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 using Microsoft.EntityFrameworkCore.Scaffolding.Metadata;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 
 public class CandidateNamingServiceTest
 {
diff --git a/test/EFCore.Design.Tests/Scaffolding/Internal/HumanizerPluralizerTest.cs b/test/EFCore.Design.Tests/Scaffolding/Internal/HumanizerPluralizerTest.cs
index a7ecf71803..c78e3fd83a 100644
--- a/test/EFCore.Design.Tests/Scaffolding/Internal/HumanizerPluralizerTest.cs
+++ b/test/EFCore.Design.Tests/Scaffolding/Internal/HumanizerPluralizerTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.Design.Internal;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 
 public class HumanizerPluralizerTest
 {
diff --git a/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingTypeMapperSqlServerTest.cs b/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingTypeMapperSqlServerTest.cs
index 57fe5a87e2..d8f2fdce4b 100644
--- a/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingTypeMapperSqlServerTest.cs
+++ b/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingTypeMapperSqlServerTest.cs
@@ -6,7 +6,7 @@
 
 // ReSharper disable CheckNamespace
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 
 public class ScaffoldingTypeMapperSqlServerTest
 {
diff --git a/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingTypeMapperSqliteTest.cs b/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingTypeMapperSqliteTest.cs
index fc81cd865e..202dc23dac 100644
--- a/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingTypeMapperSqliteTest.cs
+++ b/test/EFCore.Design.Tests/Scaffolding/Internal/ScaffoldingTypeMapperSqliteTest.cs
@@ -1,10 +1,9 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-using Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 using Microsoft.EntityFrameworkCore.Sqlite.Storage.Internal;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 
 public class ScaffoldingTypeMapperSqliteTest
 {
diff --git a/test/EFCore.InMemory.Tests/InMemoryEventIdTest.cs b/test/EFCore.InMemory.Tests/Diagnostics/InMemoryEventIdTest.cs
similarity index 93%
rename from test/EFCore.InMemory.Tests/InMemoryEventIdTest.cs
rename to test/EFCore.InMemory.Tests/Diagnostics/InMemoryEventIdTest.cs
index e6b21125e7..aef89c4cde 100644
--- a/test/EFCore.InMemory.Tests/InMemoryEventIdTest.cs
+++ b/test/EFCore.InMemory.Tests/Diagnostics/InMemoryEventIdTest.cs
@@ -5,7 +5,7 @@
 using Microsoft.EntityFrameworkCore.InMemory.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Diagnostics;
 
 public class InMemoryEventIdTest : EventIdTestBase
 {
diff --git a/test/EFCore.InMemory.Tests/InMemoryDatabaseFacadeTest.cs b/test/EFCore.InMemory.Tests/Extensions/InMemoryDatabaseFacadeExtensionsTest.cs
similarity index 93%
rename from test/EFCore.InMemory.Tests/InMemoryDatabaseFacadeTest.cs
rename to test/EFCore.InMemory.Tests/Extensions/InMemoryDatabaseFacadeExtensionsTest.cs
index a4019bcfae..f35ccde29a 100644
--- a/test/EFCore.InMemory.Tests/InMemoryDatabaseFacadeTest.cs
+++ b/test/EFCore.InMemory.Tests/Extensions/InMemoryDatabaseFacadeExtensionsTest.cs
@@ -3,7 +3,7 @@
 
 namespace Microsoft.EntityFrameworkCore;
 
-public class InMemoryDatabaseFacadeTest
+public class InMemoryDatabaseFacadeExtensionsTest
 {
     [ConditionalFact]
     public void IsInMemory_when_using_in_memory()
diff --git a/test/EFCore.InMemory.Tests/InMemoryOptionsExtensionTest.cs b/test/EFCore.InMemory.Tests/Infrastructure/InMemoryOptionsExtensionTest.cs
similarity index 93%
rename from test/EFCore.InMemory.Tests/InMemoryOptionsExtensionTest.cs
rename to test/EFCore.InMemory.Tests/Infrastructure/InMemoryOptionsExtensionTest.cs
index ca5a4dd0bd..2b1e4a197d 100644
--- a/test/EFCore.InMemory.Tests/InMemoryOptionsExtensionTest.cs
+++ b/test/EFCore.InMemory.Tests/Infrastructure/InMemoryOptionsExtensionTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.InMemory.Infrastructure.Internal;
 using Microsoft.EntityFrameworkCore.InMemory.Storage.Internal;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Infrastructure;
 
 public class InMemoryOptionsExtensionTest
 {
diff --git a/test/EFCore.InMemory.Tests/InMemoryDatabaseCreatorTest.cs b/test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseCreatorTest.cs
similarity index 98%
rename from test/EFCore.InMemory.Tests/InMemoryDatabaseCreatorTest.cs
rename to test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseCreatorTest.cs
index e88fdeedce..6b4fb66192 100644
--- a/test/EFCore.InMemory.Tests/InMemoryDatabaseCreatorTest.cs
+++ b/test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseCreatorTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.InMemory.Storage.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Storage;
 
 public class InMemoryDatabaseCreatorTest
 {
diff --git a/test/EFCore.InMemory.Tests/InMemoryDatabaseProviderTest.cs b/test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseProviderTest.cs
similarity index 96%
rename from test/EFCore.InMemory.Tests/InMemoryDatabaseProviderTest.cs
rename to test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseProviderTest.cs
index a7d6d306d0..47f2c42717 100644
--- a/test/EFCore.InMemory.Tests/InMemoryDatabaseProviderTest.cs
+++ b/test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseProviderTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.InMemory.Infrastructure.Internal;
 using Microsoft.EntityFrameworkCore.InMemory.Storage.Internal;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Storage;
 
 public class InMemoryDatabaseProviderTest
 {
diff --git a/test/EFCore.InMemory.Tests/InMemoryDatabaseTest.cs b/test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseTest.cs
similarity index 99%
rename from test/EFCore.InMemory.Tests/InMemoryDatabaseTest.cs
rename to test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseTest.cs
index 922ac20730..16921405f9 100644
--- a/test/EFCore.InMemory.Tests/InMemoryDatabaseTest.cs
+++ b/test/EFCore.InMemory.Tests/Storage/InMemoryDatabaseTest.cs
@@ -8,7 +8,7 @@
 
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Storage;
 
 public class InMemoryDatabaseTest
 {
diff --git a/test/EFCore.InMemory.Tests/InMemoryTransactionManagerTest.cs b/test/EFCore.InMemory.Tests/Storage/InMemoryTransactionManagerTest.cs
similarity index 99%
rename from test/EFCore.InMemory.Tests/InMemoryTransactionManagerTest.cs
rename to test/EFCore.InMemory.Tests/Storage/InMemoryTransactionManagerTest.cs
index cd11504f92..7e17753ba7 100644
--- a/test/EFCore.InMemory.Tests/InMemoryTransactionManagerTest.cs
+++ b/test/EFCore.InMemory.Tests/Storage/InMemoryTransactionManagerTest.cs
@@ -8,7 +8,7 @@
 using Microsoft.EntityFrameworkCore.InMemory.Storage.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Storage;
 
 public class InMemoryTransactionManagerTest
 {
diff --git a/test/EFCore.InMemory.Tests/InMemoryIntegerValueGeneratorTest.cs b/test/EFCore.InMemory.Tests/ValueGeneration/InMemoryIntegerValueGeneratorTest.cs
similarity index 91%
rename from test/EFCore.InMemory.Tests/InMemoryIntegerValueGeneratorTest.cs
rename to test/EFCore.InMemory.Tests/ValueGeneration/InMemoryIntegerValueGeneratorTest.cs
index 79aa24dbad..b9cef3f4be 100644
--- a/test/EFCore.InMemory.Tests/InMemoryIntegerValueGeneratorTest.cs
+++ b/test/EFCore.InMemory.Tests/ValueGeneration/InMemoryIntegerValueGeneratorTest.cs
@@ -1,9 +1,13 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
+
+// Licensed to the .NET Foundation under one or more agreements.
+// The .NET Foundation licenses this file to you under the MIT license.
+
 using Microsoft.EntityFrameworkCore.InMemory.ValueGeneration.Internal;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.ValueGeneration;
 
 public class InMemoryIntegerValueGeneratorTest
 {
diff --git a/test/EFCore.InMemory.Tests/InMemoryValueGeneratorSelectorTest.cs b/test/EFCore.InMemory.Tests/ValueGeneration/InMemoryValueGeneratorSelectorTest.cs
similarity index 99%
rename from test/EFCore.InMemory.Tests/InMemoryValueGeneratorSelectorTest.cs
rename to test/EFCore.InMemory.Tests/ValueGeneration/InMemoryValueGeneratorSelectorTest.cs
index cd2b8c4b3e..1892770c39 100644
--- a/test/EFCore.InMemory.Tests/InMemoryValueGeneratorSelectorTest.cs
+++ b/test/EFCore.InMemory.Tests/ValueGeneration/InMemoryValueGeneratorSelectorTest.cs
@@ -5,7 +5,7 @@
 
 // ReSharper disable ClassNeverInstantiated.Local
 // ReSharper disable UnusedMember.Local
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.ValueGeneration;
 
 public class InMemoryValueGeneratorSelectorTest
 {
diff --git a/test/EFCore.OData.FunctionalTests/TestAssembly.cs b/test/EFCore.OData.FunctionalTests/TestAssembly.cs
deleted file mode 100644
index 13c2b56f3e..0000000000
--- a/test/EFCore.OData.FunctionalTests/TestAssembly.cs
+++ /dev/null
@@ -1,17 +0,0 @@
-﻿// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-namespace Microsoft.EntityFrameworkCore;
-
-internal sealed class TestAssembly : Assembly
-{
-    private readonly Type[] _types;
-
-    public TestAssembly(params Type[] types)
-    {
-        _types = types;
-    }
-
-    public override Type[] GetTypes()
-        => _types;
-}
diff --git a/test/EFCore.Relational.Specification.Tests/UpdatesRelationalTestBase.cs b/test/EFCore.Relational.Specification.Tests/Update/UpdatesRelationalTestBase.cs
similarity index 98%
rename from test/EFCore.Relational.Specification.Tests/UpdatesRelationalTestBase.cs
rename to test/EFCore.Relational.Specification.Tests/Update/UpdatesRelationalTestBase.cs
index d11a049d24..2574919fb3 100644
--- a/test/EFCore.Relational.Specification.Tests/UpdatesRelationalTestBase.cs
+++ b/test/EFCore.Relational.Specification.Tests/Update/UpdatesRelationalTestBase.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.TestModels.UpdatesModel;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Update;
 
 public abstract class UpdatesRelationalTestBase<TFixture> : UpdatesTestBase<TFixture>
     where TFixture : UpdatesRelationalTestBase<TFixture>.UpdatesRelationalFixture
@@ -115,7 +115,8 @@ public virtual void Can_use_shared_columns_with_conversion()
             {
                 var person = new Person("1", null)
                 {
-                    Address = new Address { Country = Country.Eswatini, City = "Bulembu" }, Country = "Eswatini"
+                    Address = new Address { Country = Country.Eswatini, City = "Bulembu" },
+                    Country = "Eswatini"
                 };
 
                 context.Add(person);
diff --git a/test/EFCore.Relational.Tests/Utilities/DbParameterCollectionExtensionsTest.cs b/test/EFCore.Relational.Tests/Extensions/DbParameterCollectionExtensionsTest.cs
similarity index 99%
rename from test/EFCore.Relational.Tests/Utilities/DbParameterCollectionExtensionsTest.cs
rename to test/EFCore.Relational.Tests/Extensions/DbParameterCollectionExtensionsTest.cs
index 28a39c9ace..37238c0813 100644
--- a/test/EFCore.Relational.Tests/Utilities/DbParameterCollectionExtensionsTest.cs
+++ b/test/EFCore.Relational.Tests/Extensions/DbParameterCollectionExtensionsTest.cs
@@ -4,7 +4,7 @@
 using System.Data;
 using Microsoft.EntityFrameworkCore.Storage.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore;
 
 public class DbParameterCollectionExtensionsTest
 {
diff --git a/test/EFCore.Relational.Tests/Metadata/RelationalBuilderExtensionsTest.cs b/test/EFCore.Relational.Tests/Extensions/RelationalBuilderExtensionsTest.cs
similarity index 99%
rename from test/EFCore.Relational.Tests/Metadata/RelationalBuilderExtensionsTest.cs
rename to test/EFCore.Relational.Tests/Extensions/RelationalBuilderExtensionsTest.cs
index a30ba4b6fa..9119c45a2a 100644
--- a/test/EFCore.Relational.Tests/Metadata/RelationalBuilderExtensionsTest.cs
+++ b/test/EFCore.Relational.Tests/Extensions/RelationalBuilderExtensionsTest.cs
@@ -5,7 +5,7 @@
 
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore.Metadata;
+namespace Microsoft.EntityFrameworkCore;
 
 public class RelationalBuilderExtensionsTest
 {
diff --git a/test/EFCore.Relational.Tests/RelationalDatabaseFacadeExtensionsTest.cs b/test/EFCore.Relational.Tests/Extensions/RelationalDatabaseFacadeExtensionsTest.cs
similarity index 60%
rename from test/EFCore.Relational.Tests/RelationalDatabaseFacadeExtensionsTest.cs
rename to test/EFCore.Relational.Tests/Extensions/RelationalDatabaseFacadeExtensionsTest.cs
index 0111e0c078..c2036ec4c3 100644
--- a/test/EFCore.Relational.Tests/RelationalDatabaseFacadeExtensionsTest.cs
+++ b/test/EFCore.Relational.Tests/Extensions/RelationalDatabaseFacadeExtensionsTest.cs
@@ -394,4 +394,285 @@ public async Task GetPendingMigrations_works(bool async)
                 ? await context.Database.GetPendingMigrationsAsync()
                 : context.Database.GetPendingMigrations());
     }
+
+    [ConditionalTheory]
+    [InlineData(false, false)]
+    [InlineData(true, false)]
+    [InlineData(true, true)]
+    public async Task Can_pass_no_params(bool async, bool cancellation)
+    {
+        using var context = new ThudContext();
+        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
+
+        if (async)
+        {
+            if (cancellation)
+            {
+                var cancellationToken = new CancellationToken();
+                await context.Database.ExecuteSqlRawAsync("<Some query>", cancellationToken);
+            }
+            else
+            {
+                await context.Database.ExecuteSqlRawAsync("<Some query>");
+            }
+        }
+        else
+        {
+            context.Database.ExecuteSqlRaw("<Some query>");
+        }
+
+        Assert.Equal("<Some query>", commandBuilder.Sql);
+        Assert.Equal(new List<object>(), commandBuilder.Parameters);
+    }
+
+    [ConditionalTheory]
+    [InlineData(false, false)]
+    [InlineData(true, false)]
+    [InlineData(true, true)]
+    public async Task Can_pass_array_of_int_params_as_object(bool async, bool cancellation)
+    {
+        using var context = new ThudContext();
+        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
+
+        if (async)
+        {
+            if (cancellation)
+            {
+                var cancellationToken = new CancellationToken();
+                await context.Database.ExecuteSqlRawAsync("<Some query>", new object[] { 1, 2 }, cancellationToken);
+            }
+            else
+            {
+                await context.Database.ExecuteSqlRawAsync("<Some query>", 1, 2);
+            }
+        }
+        else
+        {
+            context.Database.ExecuteSqlRaw("<Some query>", 1, 2);
+        }
+
+        Assert.Equal("<Some query>", commandBuilder.Sql);
+        Assert.Equal(
+            new List<object> { 1, 2 }, commandBuilder.Parameters);
+    }
+
+    [ConditionalTheory]
+    [InlineData(false)]
+    [InlineData(true)]
+    public async Task Can_pass_ints_as_params(bool async)
+    {
+        using var context = new ThudContext();
+        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
+
+        if (async)
+        {
+            await context.Database.ExecuteSqlRawAsync("<Some query>", 1, 2);
+        }
+        else
+        {
+            context.Database.ExecuteSqlRaw("<Some query>", 1, 2);
+        }
+
+        Assert.Equal("<Some query>", commandBuilder.Sql);
+        Assert.Equal(
+            new List<object> { 1, 2 }, commandBuilder.Parameters);
+    }
+
+    [ConditionalTheory]
+    [InlineData(false, false)]
+    [InlineData(true, false)]
+    [InlineData(true, true)]
+    public async Task Can_pass_mixed_array_of_params(bool async, bool cancellation)
+    {
+        using var context = new ThudContext();
+        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
+
+        if (async)
+        {
+            if (cancellation)
+            {
+                var cancellationToken = new CancellationToken();
+                await context.Database.ExecuteSqlRawAsync("<Some query>", new object[] { 1, "Cheese" }, cancellationToken);
+            }
+            else
+            {
+                await context.Database.ExecuteSqlRawAsync("<Some query>", 1, "Cheese");
+            }
+        }
+        else
+        {
+            context.Database.ExecuteSqlRaw("<Some query>", 1, "Cheese");
+        }
+
+        Assert.Equal("<Some query>", commandBuilder.Sql);
+        Assert.Equal(
+            new List<object> { 1, "Cheese" }, commandBuilder.Parameters);
+    }
+
+    [ConditionalTheory]
+    [InlineData(false, false)]
+    [InlineData(true, false)]
+    [InlineData(true, true)]
+    public async Task Can_pass_list_of_int_params_as_object(bool async, bool cancellation)
+    {
+        using var context = new ThudContext();
+        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
+
+        if (async)
+        {
+            if (cancellation)
+            {
+                var cancellationToken = new CancellationToken();
+                await context.Database.ExecuteSqlRawAsync(
+                    "<Some query>", new List<object> { 1, 2 }, cancellationToken);
+            }
+            else
+            {
+                await context.Database.ExecuteSqlRawAsync(
+                    "<Some query>", new List<object> { 1, 2 });
+            }
+        }
+        else
+        {
+            context.Database.ExecuteSqlRaw(
+                "<Some query>", new List<object> { 1, 2 });
+        }
+
+        Assert.Equal("<Some query>", commandBuilder.Sql);
+        Assert.Equal(
+            new List<object> { 1, 2 }, commandBuilder.Parameters);
+    }
+
+    [ConditionalTheory]
+    [InlineData(false, false)]
+    [InlineData(true, false)]
+    [InlineData(true, true)]
+    public async Task Can_pass_mixed_list_of_params(bool async, bool cancellation)
+    {
+        using var context = new ThudContext();
+        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
+
+        if (async)
+        {
+            if (cancellation)
+            {
+                var cancellationToken = new CancellationToken();
+                await context.Database.ExecuteSqlRawAsync(
+                    "<Some query>", new List<object> { 1, "Pickle" }, cancellationToken);
+            }
+            else
+            {
+                await context.Database.ExecuteSqlRawAsync(
+                    "<Some query>", new List<object> { 1, "Pickle" });
+            }
+        }
+        else
+        {
+            context.Database.ExecuteSqlRaw(
+                "<Some query>", new List<object> { 1, "Pickle" });
+        }
+
+        Assert.Equal("<Some query>", commandBuilder.Sql);
+        Assert.Equal(
+            new List<object> { 1, "Pickle" }, commandBuilder.Parameters);
+    }
+
+    [ConditionalTheory]
+    [InlineData(false, false)]
+    [InlineData(true, false)]
+    [InlineData(true, true)]
+    public async Task Can_pass_single_int_as_object(bool async, bool cancellation)
+    {
+        using var context = new ThudContext();
+        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
+
+        if (async)
+        {
+            if (cancellation)
+            {
+                var cancellationToken = new CancellationToken();
+                await context.Database.ExecuteSqlRawAsync("<Some query>", new object[] { 1 }, cancellationToken);
+            }
+            else
+            {
+                await context.Database.ExecuteSqlRawAsync("<Some query>", 1);
+            }
+        }
+        else
+        {
+            context.Database.ExecuteSqlRaw("<Some query>", 1);
+        }
+
+        Assert.Equal("<Some query>", commandBuilder.Sql);
+        Assert.Equal(
+            new List<object> { 1 }, commandBuilder.Parameters);
+    }
+
+    [ConditionalTheory]
+    [InlineData(false, false)]
+    [InlineData(true, false)]
+    [InlineData(true, true)]
+    public async Task Can_pass_single_string(bool async, bool cancellation)
+    {
+        using var context = new ThudContext();
+        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
+
+        if (async)
+        {
+            if (cancellation)
+            {
+                var cancellationToken = new CancellationToken();
+                await context.Database.ExecuteSqlRawAsync("<Some query>", new[] { "Branston" }, cancellationToken);
+            }
+            else
+            {
+                await context.Database.ExecuteSqlRawAsync("<Some query>", "Branston");
+            }
+        }
+        else
+        {
+            context.Database.ExecuteSqlRaw("<Some query>", "Branston");
+        }
+
+        Assert.Equal("<Some query>", commandBuilder.Sql);
+        Assert.Equal(
+            new List<object> { "Branston" }, commandBuilder.Parameters);
+    }
+
+    private class ThudContext : DbContext
+    {
+        public ThudContext()
+            : base(
+                FakeRelationalTestHelpers.Instance.CreateOptions(
+                    FakeRelationalTestHelpers.Instance.CreateServiceProvider(
+                        new ServiceCollection()
+                            .AddScoped<IRawSqlCommandBuilder, TestRawSqlCommandBuilder>())))
+        {
+        }
+    }
+
+    private class TestRawSqlCommandBuilder : IRawSqlCommandBuilder
+    {
+        private readonly IRelationalCommandBuilderFactory _commandBuilderFactory;
+
+        public TestRawSqlCommandBuilder(
+            IRelationalCommandBuilderFactory relationalCommandBuilderFactory)
+        {
+            _commandBuilderFactory = relationalCommandBuilderFactory;
+        }
+
+        public string Sql { get; private set; }
+        public IEnumerable<object> Parameters { get; private set; }
+
+        public IRelationalCommand Build(string sql)
+            => throw new NotImplementedException();
+
+        public RawSqlCommand Build(string sql, IEnumerable<object> parameters)
+        {
+            Sql = sql;
+            Parameters = parameters;
+
+            return new RawSqlCommand(_commandBuilderFactory.Create().Build(), new Dictionary<string, object>());
+        }
+    }
 }
diff --git a/test/EFCore.Relational.Tests/Metadata/RelationalIndexTest.cs b/test/EFCore.Relational.Tests/Extensions/RelationalIndexExtensionsTest.cs
similarity index 98%
rename from test/EFCore.Relational.Tests/Metadata/RelationalIndexTest.cs
rename to test/EFCore.Relational.Tests/Extensions/RelationalIndexExtensionsTest.cs
index 164ee26a20..045a37dc1c 100644
--- a/test/EFCore.Relational.Tests/Metadata/RelationalIndexTest.cs
+++ b/test/EFCore.Relational.Tests/Extensions/RelationalIndexExtensionsTest.cs
@@ -5,7 +5,7 @@
 
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore.Metadata;
+namespace Microsoft.EntityFrameworkCore;
 
 public class RelationalIndexExtensionsTest
 {
diff --git a/test/EFCore.Relational.Tests/Metadata/RelationalMetadataExtensionsTest.cs b/test/EFCore.Relational.Tests/Extensions/RelationalMetadataExtensionsTest.cs
similarity index 99%
rename from test/EFCore.Relational.Tests/Metadata/RelationalMetadataExtensionsTest.cs
rename to test/EFCore.Relational.Tests/Extensions/RelationalMetadataExtensionsTest.cs
index 52da907229..8dab127f2a 100644
--- a/test/EFCore.Relational.Tests/Metadata/RelationalMetadataExtensionsTest.cs
+++ b/test/EFCore.Relational.Tests/Extensions/RelationalMetadataExtensionsTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Metadata;
+namespace Microsoft.EntityFrameworkCore;
 
 public class RelationalMetadataExtensionsTest
 {
diff --git a/test/EFCore.Relational.Tests/Storage/RelationalTransactionExtensionsTest.cs b/test/EFCore.Relational.Tests/Extensions/RelationalTransactionExtensionsTest.cs
similarity index 98%
rename from test/EFCore.Relational.Tests/Storage/RelationalTransactionExtensionsTest.cs
rename to test/EFCore.Relational.Tests/Extensions/RelationalTransactionExtensionsTest.cs
index d8c2811154..bb609b4ea2 100644
--- a/test/EFCore.Relational.Tests/Storage/RelationalTransactionExtensionsTest.cs
+++ b/test/EFCore.Relational.Tests/Extensions/RelationalTransactionExtensionsTest.cs
@@ -5,7 +5,7 @@
 using Microsoft.EntityFrameworkCore.TestUtilities.FakeProvider;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore;
 
 public class RelationalTransactionExtensionsTest
 {
diff --git a/test/EFCore.Relational.Tests/RelationalEventIdTest.cs b/test/EFCore.Relational.Tests/Infrastructure/RelationalEventIdTest.cs
similarity index 99%
rename from test/EFCore.Relational.Tests/RelationalEventIdTest.cs
rename to test/EFCore.Relational.Tests/Infrastructure/RelationalEventIdTest.cs
index 119833c34d..4c5315f619 100644
--- a/test/EFCore.Relational.Tests/RelationalEventIdTest.cs
+++ b/test/EFCore.Relational.Tests/Infrastructure/RelationalEventIdTest.cs
@@ -12,7 +12,7 @@
 using IsolationLevel = System.Data.IsolationLevel;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Infrastructure;
 
 public class RelationalEventIdTest : EventIdTestBase
 {
diff --git a/test/EFCore.Relational.Tests/RelationalOptionsExtensionTest.cs b/test/EFCore.Relational.Tests/Infrastructure/RelationalOptionsExtensionTest.cs
similarity index 98%
rename from test/EFCore.Relational.Tests/RelationalOptionsExtensionTest.cs
rename to test/EFCore.Relational.Tests/Infrastructure/RelationalOptionsExtensionTest.cs
index fd926062f2..25ccfc38de 100644
--- a/test/EFCore.Relational.Tests/RelationalOptionsExtensionTest.cs
+++ b/test/EFCore.Relational.Tests/Infrastructure/RelationalOptionsExtensionTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.TestUtilities.FakeProvider;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Infrastructure;
 
 public class RelationalOptionsExtensionTest
 {
diff --git a/test/EFCore.Relational.Tests/Metadata/DbFunctionMetadataTests.cs b/test/EFCore.Relational.Tests/Metadata/DbFunctionTest.cs
similarity index 99%
rename from test/EFCore.Relational.Tests/Metadata/DbFunctionMetadataTests.cs
rename to test/EFCore.Relational.Tests/Metadata/DbFunctionTest.cs
index f61785571d..6a1680f235 100644
--- a/test/EFCore.Relational.Tests/Metadata/DbFunctionMetadataTests.cs
+++ b/test/EFCore.Relational.Tests/Metadata/DbFunctionTest.cs
@@ -10,7 +10,7 @@
 #pragma warning disable RCS1102 // Make class static.
 namespace Microsoft.EntityFrameworkCore.Metadata;
 
-public class DbFunctionMetadataTests
+public class DbFunctionTest
 {
     protected class Foo
     {
diff --git a/test/EFCore.Relational.Tests/Storage/RelationalDatabaseFacadeExtensionsTest.cs b/test/EFCore.Relational.Tests/Storage/RelationalDatabaseFacadeExtensionsTest.cs
deleted file mode 100644
index 677513f7a7..0000000000
--- a/test/EFCore.Relational.Tests/Storage/RelationalDatabaseFacadeExtensionsTest.cs
+++ /dev/null
@@ -1,288 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-namespace Microsoft.EntityFrameworkCore.Storage;
-
-public class RelationalDatabaseFacadeExtensionsTest
-{
-    [ConditionalTheory]
-    [InlineData(false, false)]
-    [InlineData(true, false)]
-    [InlineData(true, true)]
-    public async Task Can_pass_no_params(bool async, bool cancellation)
-    {
-        using var context = new ThudContext();
-        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
-
-        if (async)
-        {
-            if (cancellation)
-            {
-                var cancellationToken = new CancellationToken();
-                await context.Database.ExecuteSqlRawAsync("<Some query>", cancellationToken);
-            }
-            else
-            {
-                await context.Database.ExecuteSqlRawAsync("<Some query>");
-            }
-        }
-        else
-        {
-            context.Database.ExecuteSqlRaw("<Some query>");
-        }
-
-        Assert.Equal("<Some query>", commandBuilder.Sql);
-        Assert.Equal(new List<object>(), commandBuilder.Parameters);
-    }
-
-    [ConditionalTheory]
-    [InlineData(false, false)]
-    [InlineData(true, false)]
-    [InlineData(true, true)]
-    public async Task Can_pass_array_of_int_params_as_object(bool async, bool cancellation)
-    {
-        using var context = new ThudContext();
-        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
-
-        if (async)
-        {
-            if (cancellation)
-            {
-                var cancellationToken = new CancellationToken();
-                await context.Database.ExecuteSqlRawAsync("<Some query>", new object[] { 1, 2 }, cancellationToken);
-            }
-            else
-            {
-                await context.Database.ExecuteSqlRawAsync("<Some query>", 1, 2);
-            }
-        }
-        else
-        {
-            context.Database.ExecuteSqlRaw("<Some query>", 1, 2);
-        }
-
-        Assert.Equal("<Some query>", commandBuilder.Sql);
-        Assert.Equal(
-            new List<object> { 1, 2 }, commandBuilder.Parameters);
-    }
-
-    [ConditionalTheory]
-    [InlineData(false)]
-    [InlineData(true)]
-    public async Task Can_pass_ints_as_params(bool async)
-    {
-        using var context = new ThudContext();
-        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
-
-        if (async)
-        {
-            await context.Database.ExecuteSqlRawAsync("<Some query>", 1, 2);
-        }
-        else
-        {
-            context.Database.ExecuteSqlRaw("<Some query>", 1, 2);
-        }
-
-        Assert.Equal("<Some query>", commandBuilder.Sql);
-        Assert.Equal(
-            new List<object> { 1, 2 }, commandBuilder.Parameters);
-    }
-
-    [ConditionalTheory]
-    [InlineData(false, false)]
-    [InlineData(true, false)]
-    [InlineData(true, true)]
-    public async Task Can_pass_mixed_array_of_params(bool async, bool cancellation)
-    {
-        using var context = new ThudContext();
-        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
-
-        if (async)
-        {
-            if (cancellation)
-            {
-                var cancellationToken = new CancellationToken();
-                await context.Database.ExecuteSqlRawAsync("<Some query>", new object[] { 1, "Cheese" }, cancellationToken);
-            }
-            else
-            {
-                await context.Database.ExecuteSqlRawAsync("<Some query>", 1, "Cheese");
-            }
-        }
-        else
-        {
-            context.Database.ExecuteSqlRaw("<Some query>", 1, "Cheese");
-        }
-
-        Assert.Equal("<Some query>", commandBuilder.Sql);
-        Assert.Equal(
-            new List<object> { 1, "Cheese" }, commandBuilder.Parameters);
-    }
-
-    [ConditionalTheory]
-    [InlineData(false, false)]
-    [InlineData(true, false)]
-    [InlineData(true, true)]
-    public async Task Can_pass_list_of_int_params_as_object(bool async, bool cancellation)
-    {
-        using var context = new ThudContext();
-        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
-
-        if (async)
-        {
-            if (cancellation)
-            {
-                var cancellationToken = new CancellationToken();
-                await context.Database.ExecuteSqlRawAsync(
-                    "<Some query>", new List<object> { 1, 2 }, cancellationToken);
-            }
-            else
-            {
-                await context.Database.ExecuteSqlRawAsync(
-                    "<Some query>", new List<object> { 1, 2 });
-            }
-        }
-        else
-        {
-            context.Database.ExecuteSqlRaw(
-                "<Some query>", new List<object> { 1, 2 });
-        }
-
-        Assert.Equal("<Some query>", commandBuilder.Sql);
-        Assert.Equal(
-            new List<object> { 1, 2 }, commandBuilder.Parameters);
-    }
-
-    [ConditionalTheory]
-    [InlineData(false, false)]
-    [InlineData(true, false)]
-    [InlineData(true, true)]
-    public async Task Can_pass_mixed_list_of_params(bool async, bool cancellation)
-    {
-        using var context = new ThudContext();
-        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
-
-        if (async)
-        {
-            if (cancellation)
-            {
-                var cancellationToken = new CancellationToken();
-                await context.Database.ExecuteSqlRawAsync(
-                    "<Some query>", new List<object> { 1, "Pickle" }, cancellationToken);
-            }
-            else
-            {
-                await context.Database.ExecuteSqlRawAsync(
-                    "<Some query>", new List<object> { 1, "Pickle" });
-            }
-        }
-        else
-        {
-            context.Database.ExecuteSqlRaw(
-                "<Some query>", new List<object> { 1, "Pickle" });
-        }
-
-        Assert.Equal("<Some query>", commandBuilder.Sql);
-        Assert.Equal(
-            new List<object> { 1, "Pickle" }, commandBuilder.Parameters);
-    }
-
-    [ConditionalTheory]
-    [InlineData(false, false)]
-    [InlineData(true, false)]
-    [InlineData(true, true)]
-    public async Task Can_pass_single_int_as_object(bool async, bool cancellation)
-    {
-        using var context = new ThudContext();
-        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
-
-        if (async)
-        {
-            if (cancellation)
-            {
-                var cancellationToken = new CancellationToken();
-                await context.Database.ExecuteSqlRawAsync("<Some query>", new object[] { 1 }, cancellationToken);
-            }
-            else
-            {
-                await context.Database.ExecuteSqlRawAsync("<Some query>", 1);
-            }
-        }
-        else
-        {
-            context.Database.ExecuteSqlRaw("<Some query>", 1);
-        }
-
-        Assert.Equal("<Some query>", commandBuilder.Sql);
-        Assert.Equal(
-            new List<object> { 1 }, commandBuilder.Parameters);
-    }
-
-    [ConditionalTheory]
-    [InlineData(false, false)]
-    [InlineData(true, false)]
-    [InlineData(true, true)]
-    public async Task Can_pass_single_string(bool async, bool cancellation)
-    {
-        using var context = new ThudContext();
-        var commandBuilder = (TestRawSqlCommandBuilder)context.GetService<IRawSqlCommandBuilder>();
-
-        if (async)
-        {
-            if (cancellation)
-            {
-                var cancellationToken = new CancellationToken();
-                await context.Database.ExecuteSqlRawAsync("<Some query>", new[] { "Branston" }, cancellationToken);
-            }
-            else
-            {
-                await context.Database.ExecuteSqlRawAsync("<Some query>", "Branston");
-            }
-        }
-        else
-        {
-            context.Database.ExecuteSqlRaw("<Some query>", "Branston");
-        }
-
-        Assert.Equal("<Some query>", commandBuilder.Sql);
-        Assert.Equal(
-            new List<object> { "Branston" }, commandBuilder.Parameters);
-    }
-
-    private class ThudContext : DbContext
-    {
-        public ThudContext()
-            : base(
-                FakeRelationalTestHelpers.Instance.CreateOptions(
-                    FakeRelationalTestHelpers.Instance.CreateServiceProvider(
-                        new ServiceCollection()
-                            .AddScoped<IRawSqlCommandBuilder, TestRawSqlCommandBuilder>())))
-        {
-        }
-    }
-
-    private class TestRawSqlCommandBuilder : IRawSqlCommandBuilder
-    {
-        private readonly IRelationalCommandBuilderFactory _commandBuilderFactory;
-
-        public TestRawSqlCommandBuilder(
-            IRelationalCommandBuilderFactory relationalCommandBuilderFactory)
-        {
-            _commandBuilderFactory = relationalCommandBuilderFactory;
-        }
-
-        public string Sql { get; private set; }
-        public IEnumerable<object> Parameters { get; private set; }
-
-        public IRelationalCommand Build(string sql)
-            => throw new NotImplementedException();
-
-        public RawSqlCommand Build(string sql, IEnumerable<object> parameters)
-        {
-            Sql = sql;
-            Parameters = parameters;
-
-            return new RawSqlCommand(_commandBuilderFactory.Create().Build(), new Dictionary<string, object>());
-        }
-    }
-}
diff --git a/test/EFCore.Relational.Tests/Storage/RelationalTypeMapperTest.cs b/test/EFCore.Relational.Tests/Storage/RelationalTypeMappingSourceTest.cs
similarity index 99%
rename from test/EFCore.Relational.Tests/Storage/RelationalTypeMapperTest.cs
rename to test/EFCore.Relational.Tests/Storage/RelationalTypeMappingSourceTest.cs
index 387f89697a..c7527f2fcb 100644
--- a/test/EFCore.Relational.Tests/Storage/RelationalTypeMapperTest.cs
+++ b/test/EFCore.Relational.Tests/Storage/RelationalTypeMappingSourceTest.cs
@@ -5,7 +5,7 @@
 
 namespace Microsoft.EntityFrameworkCore.Storage;
 
-public class RelationalTypeMapperTest : RelationalTypeMapperTestBase
+public class RelationalTypeMappingSourceTest : RelationalTypeMappingSourceTestBase
 {
     [ConditionalFact]
     public void Does_simple_mapping_from_CLR_type()
diff --git a/test/EFCore.Relational.Tests/Storage/RelationalTypeMapperTestBase.cs b/test/EFCore.Relational.Tests/Storage/RelationalTypeMappingSourceTestBase.cs
similarity index 99%
rename from test/EFCore.Relational.Tests/Storage/RelationalTypeMapperTestBase.cs
rename to test/EFCore.Relational.Tests/Storage/RelationalTypeMappingSourceTestBase.cs
index 50021f8ba0..757de62cef 100644
--- a/test/EFCore.Relational.Tests/Storage/RelationalTypeMapperTestBase.cs
+++ b/test/EFCore.Relational.Tests/Storage/RelationalTypeMappingSourceTestBase.cs
@@ -3,7 +3,7 @@
 
 namespace Microsoft.EntityFrameworkCore.Storage;
 
-public abstract class RelationalTypeMapperTestBase
+public abstract class RelationalTypeMappingSourceTestBase
 {
     protected IMutableEntityType CreateEntityType<TEntity>()
     {
diff --git a/test/EFCore.Relational.Tests/Metadata/TestDbFunctions.cs b/test/EFCore.Relational.Tests/TestUtilities/TestDbFunctions.cs
similarity index 83%
rename from test/EFCore.Relational.Tests/Metadata/TestDbFunctions.cs
rename to test/EFCore.Relational.Tests/TestUtilities/TestDbFunctions.cs
index 2590e44819..a71cc44607 100644
--- a/test/EFCore.Relational.Tests/Metadata/TestDbFunctions.cs
+++ b/test/EFCore.Relational.Tests/TestUtilities/TestDbFunctions.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Metadata;
+namespace Microsoft.EntityFrameworkCore.TestUtilities;
 
 public static class TestDbFunctions
 {
diff --git a/test/EFCore.Specification.Tests/UpdatesTestBase.cs b/test/EFCore.Specification.Tests/Update/UpdatesTestBase.cs
similarity index 99%
rename from test/EFCore.Specification.Tests/UpdatesTestBase.cs
rename to test/EFCore.Specification.Tests/Update/UpdatesTestBase.cs
index 388964af6c..c62c2c2990 100644
--- a/test/EFCore.Specification.Tests/UpdatesTestBase.cs
+++ b/test/EFCore.Specification.Tests/Update/UpdatesTestBase.cs
@@ -7,7 +7,7 @@
 using Microsoft.EntityFrameworkCore.TestModels.UpdatesModel;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Update;
 
 public abstract class UpdatesTestBase<TFixture> : IClassFixture<TFixture>
     where TFixture : UpdatesTestBase<TFixture>.UpdatesFixtureBase
@@ -432,7 +432,8 @@ public virtual void Can_change_enums_with_conversion()
             {
                 var person = new Person("1", null)
                 {
-                    Address = new Address { Country = Country.Eswatini, City = "Bulembu" }, Country = "Eswatini"
+                    Address = new Address { Country = Country.Eswatini, City = "Bulembu" },
+                    Country = "Eswatini"
                 };
 
                 context.Add(person);
@@ -510,7 +511,8 @@ public virtual void Remove_partial_on_concurrency_token_original_value_mismatch_
                 context.Products.Remove(
                     new Product
                     {
-                        Id = productId, Price = 3.49M // Not the same as the value stored in the database
+                        Id = productId,
+                        Price = 3.49M // Not the same as the value stored in the database
                     });
 
                 Assert.Equal(
diff --git a/test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTPCTest.cs b/test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTPCTest.cs
similarity index 98%
rename from test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTPCTest.cs
rename to test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTPCTest.cs
index 6a30451d9f..aeda9d63e4 100644
--- a/test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTPCTest.cs
+++ b/test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTPCTest.cs
@@ -5,7 +5,7 @@
 
 using Microsoft.EntityFrameworkCore.TestModels.UpdatesModel;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Update;
 
 public class UpdatesSqlServerTPCTest : UpdatesSqlServerTestBase<UpdatesSqlServerTPCTest.UpdatesSqlServerTPCFixture>
 {
diff --git a/test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTPTTest.cs b/test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTPTTest.cs
similarity index 98%
rename from test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTPTTest.cs
rename to test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTPTTest.cs
index b06c3a8e31..2d016de9ad 100644
--- a/test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTPTTest.cs
+++ b/test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTPTTest.cs
@@ -5,7 +5,7 @@
 
 using Microsoft.EntityFrameworkCore.TestModels.UpdatesModel;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Update;
 
 public class UpdatesSqlServerTPTTest : UpdatesSqlServerTestBase<UpdatesSqlServerTPTTest.UpdatesSqlServerTPTFixture>
 {
diff --git a/test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTest.cs b/test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTest.cs
similarity index 98%
rename from test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTest.cs
rename to test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTest.cs
index 95e4dfe965..811de6a981 100644
--- a/test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTest.cs
+++ b/test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTest.cs
@@ -3,7 +3,7 @@
 
 #nullable enable
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Update;
 
 public class UpdatesSqlServerTest : UpdatesSqlServerTestBase<UpdatesSqlServerTest.UpdatesSqlServerFixture>
 {
diff --git a/test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTestBase.cs b/test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTestBase.cs
similarity index 99%
rename from test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTestBase.cs
rename to test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTestBase.cs
index d5dc8e96d2..be5ef3865c 100644
--- a/test/EFCore.SqlServer.FunctionalTests/UpdatesSqlServerTestBase.cs
+++ b/test/EFCore.SqlServer.FunctionalTests/Update/UpdatesSqlServerTestBase.cs
@@ -5,7 +5,7 @@
 
 using Microsoft.EntityFrameworkCore.TestModels.UpdatesModel;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Update;
 
 public abstract class UpdatesSqlServerTestBase<TFixture> : UpdatesRelationalTestBase<TFixture>
     where TFixture : UpdatesSqlServerTestBase<TFixture>.UpdatesSqlServerFixtureBase
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/MigrationTests.cs b/test/EFCore.SqlServer.HierarchyId.Tests/MigrationTests.cs
index 6864d82fe6..2829cd674b 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/MigrationTests.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/MigrationTests.cs
@@ -5,7 +5,7 @@
 using Microsoft.EntityFrameworkCore.Design;
 using Microsoft.EntityFrameworkCore.Design.Internal;
 using Microsoft.EntityFrameworkCore.Migrations.Design;
-using Microsoft.EntityFrameworkCore.SqlServer.Test.Models.Migrations;
+using Microsoft.EntityFrameworkCore.SqlServer.TestModels.Migrations;
 using Microsoft.Extensions.DependencyInjection;
 using Xunit;
 
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/QueryTests.cs b/test/EFCore.SqlServer.HierarchyId.Tests/QueryTests.cs
index 833e23d117..8fd14580b8 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/QueryTests.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/QueryTests.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-using Microsoft.EntityFrameworkCore.SqlServer.Test.Models;
+using Microsoft.EntityFrameworkCore.SqlServer.TestModels;
 using Microsoft.EntityFrameworkCore.TestUtilities;
 using Xunit;
 
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/RelationalScaffoldingModelFactoryTest.cs b/test/EFCore.SqlServer.HierarchyId.Tests/RelationalScaffoldingModelFactoryTest.cs
index 543499cbf6..927b9cadcb 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/RelationalScaffoldingModelFactoryTest.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/RelationalScaffoldingModelFactoryTest.cs
@@ -5,6 +5,7 @@
 using Microsoft.EntityFrameworkCore.Metadata.Internal;
 using Microsoft.EntityFrameworkCore.Scaffolding;
 using Microsoft.EntityFrameworkCore.Scaffolding.Metadata;
+using Microsoft.EntityFrameworkCore.SqlServer.TestUtilities;
 using Microsoft.EntityFrameworkCore.TestUtilities;
 using Microsoft.Extensions.DependencyInjection;
 using Xunit;
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/AbrahamicContext.cs b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/AbrahamicContext.cs
similarity index 99%
rename from test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/AbrahamicContext.cs
rename to test/EFCore.SqlServer.HierarchyId.Tests/TestModels/AbrahamicContext.cs
index 5a63392b9c..4042c02f74 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/AbrahamicContext.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/AbrahamicContext.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.TestUtilities;
 
-namespace Microsoft.EntityFrameworkCore.SqlServer.Test.Models;
+namespace Microsoft.EntityFrameworkCore.SqlServer.TestModels;
 
 internal class AbrahamicContext : DbContext
 {
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/ConvertedPatriarch.cs b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/ConvertedPatriarch.cs
similarity index 82%
rename from test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/ConvertedPatriarch.cs
rename to test/EFCore.SqlServer.HierarchyId.Tests/TestModels/ConvertedPatriarch.cs
index a7c449612d..a333e3676c 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/ConvertedPatriarch.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/ConvertedPatriarch.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.SqlServer.Test.Models;
+namespace Microsoft.EntityFrameworkCore.SqlServer.TestModels;
 
 internal class ConvertedPatriarch
 {
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/AnonymousArraySeedContext.cs b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/AnonymousArraySeedContext.cs
similarity index 99%
rename from test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/AnonymousArraySeedContext.cs
rename to test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/AnonymousArraySeedContext.cs
index e1df809f55..ca0c571e39 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/AnonymousArraySeedContext.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/AnonymousArraySeedContext.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.SqlServer.Test.Models.Migrations;
+namespace Microsoft.EntityFrameworkCore.SqlServer.TestModels.Migrations;
 
 internal sealed class AnonymousArraySeedContext : MigrationContext<Patriarch, ConvertedPatriarch>
 {
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/MigrationContext.cs b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/MigrationContext.cs
similarity index 96%
rename from test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/MigrationContext.cs
rename to test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/MigrationContext.cs
index 442b86efed..08d338de11 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/MigrationContext.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/MigrationContext.cs
@@ -5,7 +5,7 @@
 using Microsoft.EntityFrameworkCore.Metadata.Internal;
 using Microsoft.EntityFrameworkCore.SqlServer.Metadata.Internal;
 
-namespace Microsoft.EntityFrameworkCore.SqlServer.Test.Models.Migrations;
+namespace Microsoft.EntityFrameworkCore.SqlServer.TestModels.Migrations;
 
 internal abstract class MigrationContext<TEntity1, TEntity2> : DbContext
     where TEntity1 : class
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/TypedArraySeedContext.cs b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/TypedArraySeedContext.cs
similarity index 98%
rename from test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/TypedArraySeedContext.cs
rename to test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/TypedArraySeedContext.cs
index a2f31186b9..f31fe760df 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Migrations/TypedArraySeedContext.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Migrations/TypedArraySeedContext.cs
@@ -1,7 +1,9 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.SqlServer.Test.Models.Migrations;
+using Microsoft.EntityFrameworkCore.SqlServer.TestModels;
+
+namespace Microsoft.EntityFrameworkCore.SqlServer.TestModels.Migrations;
 
 internal sealed class TypedArraySeedContext : MigrationContext<Patriarch, ConvertedPatriarch>
 {
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Patriarch.cs b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Patriarch.cs
similarity index 79%
rename from test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Patriarch.cs
rename to test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Patriarch.cs
index 080d4c3e44..b677e49557 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Models/Patriarch.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/TestModels/Patriarch.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.SqlServer.Test.Models;
+namespace Microsoft.EntityFrameworkCore.SqlServer.TestModels;
 
 internal class Patriarch
 {
diff --git a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Utilities/FakeScaffoldingModelFactory.cs b/test/EFCore.SqlServer.HierarchyId.Tests/TestUtilities/FakeScaffoldingModelFactory.cs
similarity index 98%
rename from test/EFCore.SqlServer.HierarchyId.Tests/Test/Utilities/FakeScaffoldingModelFactory.cs
rename to test/EFCore.SqlServer.HierarchyId.Tests/TestUtilities/FakeScaffoldingModelFactory.cs
index 55c118a8cc..ff91a9a596 100644
--- a/test/EFCore.SqlServer.HierarchyId.Tests/Test/Utilities/FakeScaffoldingModelFactory.cs
+++ b/test/EFCore.SqlServer.HierarchyId.Tests/TestUtilities/FakeScaffoldingModelFactory.cs
@@ -9,7 +9,7 @@
 using Microsoft.EntityFrameworkCore.Scaffolding.Internal;
 using Microsoft.EntityFrameworkCore.Scaffolding.Metadata;
 
-namespace Microsoft.EntityFrameworkCore.TestUtilities;
+namespace Microsoft.EntityFrameworkCore.SqlServer.TestUtilities;
 
 public class FakeScaffoldingModelFactory : RelationalScaffoldingModelFactory
 {
diff --git a/test/EFCore.SqlServer.Tests/CommandConfigurationTests.cs b/test/EFCore.SqlServer.Tests/CommandConfigurationTests.cs
deleted file mode 100644
index 86c8faaba2..0000000000
--- a/test/EFCore.SqlServer.Tests/CommandConfigurationTests.cs
+++ /dev/null
@@ -1,80 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-using Microsoft.EntityFrameworkCore.TestUtilities.FakeProvider;
-
-#pragma warning disable RCS1102 // Make class static.
-namespace Microsoft.EntityFrameworkCore;
-
-public class CommandConfigurationTests
-{
-    public class CommandTimeout
-    {
-        [ConditionalFact]
-        public void Default_value_for_CommandTimeout_is_null_and_can_be_changed_including_setting_to_null()
-        {
-            using var context = new TimeoutContext();
-            Assert.Null(context.Database.GetCommandTimeout());
-
-            context.Database.SetCommandTimeout(77);
-            Assert.Equal(77, context.Database.GetCommandTimeout());
-
-            context.Database.SetCommandTimeout(null);
-            Assert.Null(context.Database.GetCommandTimeout());
-
-            context.Database.SetCommandTimeout(TimeSpan.FromSeconds(66));
-            Assert.Equal(66, context.Database.GetCommandTimeout());
-        }
-
-        [ConditionalFact]
-        public void Setting_CommandTimeout_to_infinite_sets_to_zero()
-        {
-            using var context = new TimeoutContext();
-
-            context.Database.SetCommandTimeout(Timeout.InfiniteTimeSpan);
-            Assert.Equal(0, context.Database.GetCommandTimeout());
-        }
-
-        [ConditionalFact]
-        public void Setting_CommandTimeout_to_negative_value_throws()
-        {
-            Assert.Throws<InvalidOperationException>(
-                () => new DbContextOptionsBuilder().UseSqlServer(
-                    "No=LoveyDovey",
-                    b => b.CommandTimeout(-55)));
-
-            using var context = new TimeoutContext();
-            Assert.Null(context.Database.GetCommandTimeout());
-
-            Assert.Throws<ArgumentException>(
-                () => context.Database.SetCommandTimeout(-3));
-            Assert.Throws<ArgumentException>(
-                () => context.Database.SetCommandTimeout(TimeSpan.FromSeconds(-3)));
-
-            Assert.Throws<ArgumentException>(
-                () => context.Database.SetCommandTimeout(-99));
-            Assert.Throws<ArgumentException>(
-                () => context.Database.SetCommandTimeout(TimeSpan.FromSeconds(-99)));
-
-            Assert.Throws<ArgumentException>(
-                () => context.Database.SetCommandTimeout(TimeSpan.FromSeconds(uint.MaxValue)));
-        }
-
-        public class TimeoutContext : DbContext
-        {
-            public TimeoutContext()
-            {
-            }
-
-            public TimeoutContext(int? commandTimeout)
-            {
-                Database.SetCommandTimeout(commandTimeout);
-            }
-
-            protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
-                => optionsBuilder
-                    .UseInternalServiceProvider(SqlServerFixture.DefaultServiceProvider)
-                    .UseSqlServer(new FakeDbConnection("A=B"));
-        }
-    }
-}
diff --git a/test/EFCore.SqlServer.Tests/SqlServerEventIdTest.cs b/test/EFCore.SqlServer.Tests/Diagnostics/SqlServerEventIdTest.cs
similarity index 96%
rename from test/EFCore.SqlServer.Tests/SqlServerEventIdTest.cs
rename to test/EFCore.SqlServer.Tests/Diagnostics/SqlServerEventIdTest.cs
index 93f80a4d55..58ecf35c6c 100644
--- a/test/EFCore.SqlServer.Tests/SqlServerEventIdTest.cs
+++ b/test/EFCore.SqlServer.Tests/Diagnostics/SqlServerEventIdTest.cs
@@ -6,7 +6,7 @@
 using Microsoft.EntityFrameworkCore.SqlServer.Extensions.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Diagnostics;
 
 public class SqlServerEventIdTest : EventIdTestBase
 {
diff --git a/test/EFCore.SqlServer.Tests/SqlServerDatabaseFacadeTest.cs b/test/EFCore.SqlServer.Tests/Extensions/SqlServerDatabaseFacadeExtensionsTest.cs
similarity index 64%
rename from test/EFCore.SqlServer.Tests/SqlServerDatabaseFacadeTest.cs
rename to test/EFCore.SqlServer.Tests/Extensions/SqlServerDatabaseFacadeExtensionsTest.cs
index a3ff2f8e33..b9c4a608fd 100644
--- a/test/EFCore.SqlServer.Tests/SqlServerDatabaseFacadeTest.cs
+++ b/test/EFCore.SqlServer.Tests/Extensions/SqlServerDatabaseFacadeExtensionsTest.cs
@@ -1,10 +1,106 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
+using Microsoft.EntityFrameworkCore.SqlServer.Infrastructure.Internal;
+using Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal;
+using Microsoft.EntityFrameworkCore.TestUtilities.FakeProvider;
+
 namespace Microsoft.EntityFrameworkCore;
 
-public class SqlServerDatabaseFacadeTest
+public class SqlServerDatabaseFacadeExtensionsTest
 {
+    [ConditionalFact]
+    public void Returns_appropriate_name()
+        => Assert.Equal(
+            typeof(SqlServerConnection).Assembly.GetName().Name,
+            new DatabaseProvider<SqlServerOptionsExtension>(new DatabaseProviderDependencies()).Name);
+
+    [ConditionalFact]
+    public void Is_configured_when_configuration_contains_associated_extension()
+    {
+        var optionsBuilder = new DbContextOptionsBuilder();
+        optionsBuilder.UseSqlServer("Database=Crunchie");
+
+        Assert.True(
+            new DatabaseProvider<SqlServerOptionsExtension>(new DatabaseProviderDependencies()).IsConfigured(optionsBuilder.Options));
+    }
+
+    [ConditionalFact]
+    public void Is_not_configured_when_configuration_does_not_contain_associated_extension()
+    {
+        var optionsBuilder = new DbContextOptionsBuilder();
+
+        Assert.False(
+            new DatabaseProvider<SqlServerOptionsExtension>(new DatabaseProviderDependencies()).IsConfigured(optionsBuilder.Options));
+    }
+
+    [ConditionalFact]
+    public void Default_value_for_CommandTimeout_is_null_and_can_be_changed_including_setting_to_null()
+    {
+        using var context = new TimeoutContext();
+        Assert.Null(context.Database.GetCommandTimeout());
+
+        context.Database.SetCommandTimeout(77);
+        Assert.Equal(77, context.Database.GetCommandTimeout());
+
+        context.Database.SetCommandTimeout(null);
+        Assert.Null(context.Database.GetCommandTimeout());
+
+        context.Database.SetCommandTimeout(TimeSpan.FromSeconds(66));
+        Assert.Equal(66, context.Database.GetCommandTimeout());
+    }
+
+    [ConditionalFact]
+    public void Setting_CommandTimeout_to_infinite_sets_to_zero()
+    {
+        using var context = new TimeoutContext();
+
+        context.Database.SetCommandTimeout(Timeout.InfiniteTimeSpan);
+        Assert.Equal(0, context.Database.GetCommandTimeout());
+    }
+
+    [ConditionalFact]
+    public void Setting_CommandTimeout_to_negative_value_throws()
+    {
+        Assert.Throws<InvalidOperationException>(
+            () => new DbContextOptionsBuilder().UseSqlServer(
+                "No=LoveyDovey",
+                b => b.CommandTimeout(-55)));
+
+        using var context = new TimeoutContext();
+        Assert.Null(context.Database.GetCommandTimeout());
+
+        Assert.Throws<ArgumentException>(
+            () => context.Database.SetCommandTimeout(-3));
+        Assert.Throws<ArgumentException>(
+            () => context.Database.SetCommandTimeout(TimeSpan.FromSeconds(-3)));
+
+        Assert.Throws<ArgumentException>(
+            () => context.Database.SetCommandTimeout(-99));
+        Assert.Throws<ArgumentException>(
+            () => context.Database.SetCommandTimeout(TimeSpan.FromSeconds(-99)));
+
+        Assert.Throws<ArgumentException>(
+            () => context.Database.SetCommandTimeout(TimeSpan.FromSeconds(uint.MaxValue)));
+    }
+
+    public class TimeoutContext : DbContext
+    {
+        public TimeoutContext()
+        {
+        }
+
+        public TimeoutContext(int? commandTimeout)
+        {
+            Database.SetCommandTimeout(commandTimeout);
+        }
+
+        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
+            => optionsBuilder
+                .UseInternalServiceProvider(SqlServerFixture.DefaultServiceProvider)
+                .UseSqlServer(new FakeDbConnection("A=B"));
+    }
+
     [ConditionalFact]
     public void IsSqlServer_when_using_OnConfiguring()
     {
diff --git a/test/EFCore.SqlServer.Tests/SqlServerDbContextOptionsExtensionsTest.cs b/test/EFCore.SqlServer.Tests/Extensions/SqlServerDbContextOptionsExtensionsTest.cs
similarity index 100%
rename from test/EFCore.SqlServer.Tests/SqlServerDbContextOptionsExtensionsTest.cs
rename to test/EFCore.SqlServer.Tests/Extensions/SqlServerDbContextOptionsExtensionsTest.cs
diff --git a/test/EFCore.SqlServer.Tests/SqlServerMigrationBuilderTest.cs b/test/EFCore.SqlServer.Tests/Migrations/SqlServerMigrationBuilderTest.cs
similarity index 92%
rename from test/EFCore.SqlServer.Tests/SqlServerMigrationBuilderTest.cs
rename to test/EFCore.SqlServer.Tests/Migrations/SqlServerMigrationBuilderTest.cs
index 3b0b3a26e7..92a48ab46a 100644
--- a/test/EFCore.SqlServer.Tests/SqlServerMigrationBuilderTest.cs
+++ b/test/EFCore.SqlServer.Tests/Migrations/SqlServerMigrationBuilderTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.SqlServer.Tests;
+namespace Microsoft.EntityFrameworkCore.Migrations;
 
 public class SqlServerMigrationBuilderTest
 {
diff --git a/test/EFCore.SqlServer.Tests/SqlServerDatabaseSourceTest.cs b/test/EFCore.SqlServer.Tests/SqlServerDatabaseSourceTest.cs
deleted file mode 100644
index 266eb9c1c5..0000000000
--- a/test/EFCore.SqlServer.Tests/SqlServerDatabaseSourceTest.cs
+++ /dev/null
@@ -1,35 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-using Microsoft.EntityFrameworkCore.SqlServer.Infrastructure.Internal;
-using Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal;
-
-namespace Microsoft.EntityFrameworkCore;
-
-public class SqlServerDatabaseSourceTest
-{
-    [ConditionalFact]
-    public void Returns_appropriate_name()
-        => Assert.Equal(
-            typeof(SqlServerConnection).Assembly.GetName().Name,
-            new DatabaseProvider<SqlServerOptionsExtension>(new DatabaseProviderDependencies()).Name);
-
-    [ConditionalFact]
-    public void Is_configured_when_configuration_contains_associated_extension()
-    {
-        var optionsBuilder = new DbContextOptionsBuilder();
-        optionsBuilder.UseSqlServer("Database=Crunchie");
-
-        Assert.True(
-            new DatabaseProvider<SqlServerOptionsExtension>(new DatabaseProviderDependencies()).IsConfigured(optionsBuilder.Options));
-    }
-
-    [ConditionalFact]
-    public void Is_not_configured_when_configuration_does_not_contain_associated_extension()
-    {
-        var optionsBuilder = new DbContextOptionsBuilder();
-
-        Assert.False(
-            new DatabaseProvider<SqlServerOptionsExtension>(new DatabaseProviderDependencies()).IsConfigured(optionsBuilder.Options));
-    }
-}
diff --git a/test/EFCore.SqlServer.Tests/SqlServerConnectionTest.cs b/test/EFCore.SqlServer.Tests/Storage/Internal/SqlServerConnectionTest.cs
similarity index 97%
rename from test/EFCore.SqlServer.Tests/SqlServerConnectionTest.cs
rename to test/EFCore.SqlServer.Tests/Storage/Internal/SqlServerConnectionTest.cs
index 28350ae6e3..0834926172 100644
--- a/test/EFCore.SqlServer.Tests/SqlServerConnectionTest.cs
+++ b/test/EFCore.SqlServer.Tests/Storage/Internal/SqlServerConnectionTest.cs
@@ -6,10 +6,9 @@
 using Microsoft.EntityFrameworkCore.Infrastructure.Internal;
 using Microsoft.EntityFrameworkCore.SqlServer.Diagnostics.Internal;
 using Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal;
-using Microsoft.EntityFrameworkCore.Storage.Internal;
 using Microsoft.EntityFrameworkCore.TestUtilities.FakeProvider;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Storage.Internal;
 
 public class SqlServerConnectionTest
 {
diff --git a/test/EFCore.SqlServer.Tests/SqlServerDatabaseCreatorTest.cs b/test/EFCore.SqlServer.Tests/Storage/Internal/SqlServerDatabaseCreatorTest.cs
similarity index 99%
rename from test/EFCore.SqlServer.Tests/SqlServerDatabaseCreatorTest.cs
rename to test/EFCore.SqlServer.Tests/Storage/Internal/SqlServerDatabaseCreatorTest.cs
index a5a9ed19b7..16b489b93b 100644
--- a/test/EFCore.SqlServer.Tests/SqlServerDatabaseCreatorTest.cs
+++ b/test/EFCore.SqlServer.Tests/Storage/Internal/SqlServerDatabaseCreatorTest.cs
@@ -3,13 +3,12 @@
 
 using Microsoft.Data.SqlClient;
 using Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal;
-using Microsoft.EntityFrameworkCore.Storage.Internal;
 
 // ReSharper disable UnassignedGetOnlyAutoProperty
 
 // ReSharper disable ClassNeverInstantiated.Local
 // ReSharper disable MemberCanBePrivate.Local
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Storage.Internal;
 
 public class SqlServerDatabaseCreatorTest
 {
diff --git a/test/EFCore.SqlServer.Tests/Storage/SqlServerTypeMappingSourceTest.cs b/test/EFCore.SqlServer.Tests/Storage/SqlServerTypeMappingSourceTest.cs
index 79f4d5be3c..c2906305b5 100644
--- a/test/EFCore.SqlServer.Tests/Storage/SqlServerTypeMappingSourceTest.cs
+++ b/test/EFCore.SqlServer.Tests/Storage/SqlServerTypeMappingSourceTest.cs
@@ -8,7 +8,7 @@
 // ReSharper disable InconsistentNaming
 namespace Microsoft.EntityFrameworkCore;
 
-public class SqlServerTypeMappingSourceTest : RelationalTypeMapperTestBase
+public class SqlServerTypeMappingSourceTest : RelationalTypeMappingSourceTestBase
 {
     [ConditionalTheory]
     [InlineData(typeof(int), "int", DbType.Int32)]
diff --git a/test/EFCore.SqlServer.Tests/SqlServerSequenceValueGeneratorTest.cs b/test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerSequenceValueGeneratorTest.cs
similarity index 99%
rename from test/EFCore.SqlServer.Tests/SqlServerSequenceValueGeneratorTest.cs
rename to test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerSequenceValueGeneratorTest.cs
index 0ec2a34b3a..09970f8e72 100644
--- a/test/EFCore.SqlServer.Tests/SqlServerSequenceValueGeneratorTest.cs
+++ b/test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerSequenceValueGeneratorTest.cs
@@ -8,7 +8,7 @@
 using Microsoft.EntityFrameworkCore.SqlServer.ValueGeneration.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.ValueGeneration;
 
 public class SqlServerSequenceValueGeneratorTest
 {
diff --git a/test/EFCore.SqlServer.Tests/SqlServerValueGeneratorCacheTest.cs b/test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerValueGeneratorCacheTest.cs
similarity index 99%
rename from test/EFCore.SqlServer.Tests/SqlServerValueGeneratorCacheTest.cs
rename to test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerValueGeneratorCacheTest.cs
index 6abaca2933..a13ffa8be3 100644
--- a/test/EFCore.SqlServer.Tests/SqlServerValueGeneratorCacheTest.cs
+++ b/test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerValueGeneratorCacheTest.cs
@@ -7,7 +7,7 @@
 using Microsoft.EntityFrameworkCore.ValueGeneration.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.ValueGeneration;
 
 public class SqlServerValueGeneratorCacheTest
 {
diff --git a/test/EFCore.SqlServer.Tests/SqlServerValueGeneratorSelectorTest.cs b/test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerValueGeneratorSelectorTest.cs
similarity index 99%
rename from test/EFCore.SqlServer.Tests/SqlServerValueGeneratorSelectorTest.cs
rename to test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerValueGeneratorSelectorTest.cs
index 2edf4651e2..0edf9d855e 100644
--- a/test/EFCore.SqlServer.Tests/SqlServerValueGeneratorSelectorTest.cs
+++ b/test/EFCore.SqlServer.Tests/ValueGeneration/SqlServerValueGeneratorSelectorTest.cs
@@ -6,7 +6,7 @@
 using Microsoft.EntityFrameworkCore.ValueGeneration.Internal;
 
 // ReSharper disable UnusedMember.Local
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.ValueGeneration;
 
 public class SqlServerValueGeneratorSelectorTest
 {
diff --git a/test/EFCore.Sqlite.FunctionalTests/UpdatesSqliteTest.cs b/test/EFCore.Sqlite.FunctionalTests/Update/UpdatesSqliteTest.cs
similarity index 97%
rename from test/EFCore.Sqlite.FunctionalTests/UpdatesSqliteTest.cs
rename to test/EFCore.Sqlite.FunctionalTests/Update/UpdatesSqliteTest.cs
index 55f8be1a89..ef0118a212 100644
--- a/test/EFCore.Sqlite.FunctionalTests/UpdatesSqliteTest.cs
+++ b/test/EFCore.Sqlite.FunctionalTests/Update/UpdatesSqliteTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.TestModels.UpdatesModel;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Update;
 
 public class UpdatesSqliteTest : UpdatesRelationalTestBase<UpdatesSqliteTest.UpdatesSqliteFixture>
 {
diff --git a/test/EFCore.Sqlite.Tests/SqliteEventIdTest.cs b/test/EFCore.Sqlite.Tests/Diagnostics/SqliteEventIdTest.cs
similarity index 97%
rename from test/EFCore.Sqlite.Tests/SqliteEventIdTest.cs
rename to test/EFCore.Sqlite.Tests/Diagnostics/SqliteEventIdTest.cs
index ae56dd3778..45a20755f1 100644
--- a/test/EFCore.Sqlite.Tests/SqliteEventIdTest.cs
+++ b/test/EFCore.Sqlite.Tests/Diagnostics/SqliteEventIdTest.cs
@@ -6,7 +6,7 @@
 using Microsoft.EntityFrameworkCore.Sqlite.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Diagnostics;
 
 public class SqliteEventIdTest : EventIdTestBase
 {
diff --git a/test/EFCore.Sqlite.Tests/SqliteDatabaseFacadeTest.cs b/test/EFCore.Sqlite.Tests/Extensions/SqliteDatabaseFacadeExtensionsTest.cs
similarity index 96%
rename from test/EFCore.Sqlite.Tests/SqliteDatabaseFacadeTest.cs
rename to test/EFCore.Sqlite.Tests/Extensions/SqliteDatabaseFacadeExtensionsTest.cs
index 85170d49d7..be249c6afb 100644
--- a/test/EFCore.Sqlite.Tests/SqliteDatabaseFacadeTest.cs
+++ b/test/EFCore.Sqlite.Tests/Extensions/SqliteDatabaseFacadeExtensionsTest.cs
@@ -3,7 +3,7 @@
 
 namespace Microsoft.EntityFrameworkCore;
 
-public class SqliteDatabaseFacadeTest
+public class SqliteDatabaseFacadeExtensionsTest
 {
     [ConditionalFact]
     public void IsSqlite_when_using_SQLite()
diff --git a/test/EFCore.Sqlite.Tests/SqliteDbContextOptionsBuilderExtensionsTest.cs b/test/EFCore.Sqlite.Tests/Extensions/SqliteDbContextOptionsBuilderExtensionsTest.cs
similarity index 100%
rename from test/EFCore.Sqlite.Tests/SqliteDbContextOptionsBuilderExtensionsTest.cs
rename to test/EFCore.Sqlite.Tests/Extensions/SqliteDbContextOptionsBuilderExtensionsTest.cs
diff --git a/test/EFCore.Sqlite.Tests/Metadata/SqliteMetadataExtensionsTest.cs b/test/EFCore.Sqlite.Tests/Extensions/SqliteMetadataExtensionsTest.cs
similarity index 93%
rename from test/EFCore.Sqlite.Tests/Metadata/SqliteMetadataExtensionsTest.cs
rename to test/EFCore.Sqlite.Tests/Extensions/SqliteMetadataExtensionsTest.cs
index a98d84644a..504dc4c171 100644
--- a/test/EFCore.Sqlite.Tests/Metadata/SqliteMetadataExtensionsTest.cs
+++ b/test/EFCore.Sqlite.Tests/Extensions/SqliteMetadataExtensionsTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Metadata;
+namespace Microsoft.EntityFrameworkCore;
 
 public class SqliteMetadataExtensionsTest
 {
diff --git a/test/EFCore.Sqlite.Tests/Storage/SqliteTypeMappingSourceTest.cs b/test/EFCore.Sqlite.Tests/Storage/SqliteTypeMappingSourceTest.cs
index cfcae1ae40..898a7b5804 100644
--- a/test/EFCore.Sqlite.Tests/Storage/SqliteTypeMappingSourceTest.cs
+++ b/test/EFCore.Sqlite.Tests/Storage/SqliteTypeMappingSourceTest.cs
@@ -8,7 +8,7 @@
 // ReSharper disable InconsistentNaming
 namespace Microsoft.EntityFrameworkCore;
 
-public class SqliteTypeMappingSourceTest : RelationalTypeMapperTestBase
+public class SqliteTypeMappingSourceTest : RelationalTypeMappingSourceTestBase
 {
     [ConditionalTheory]
     [InlineData("INTEGER", typeof(byte), DbType.Byte)]
diff --git a/test/EFCore.Tests/ChangeTracking/AggregatesTest.cs b/test/EFCore.Tests/ChangeTracking/GraphTrackingTest.cs
similarity index 99%
rename from test/EFCore.Tests/ChangeTracking/AggregatesTest.cs
rename to test/EFCore.Tests/ChangeTracking/GraphTrackingTest.cs
index 35478af840..42d82cb22f 100644
--- a/test/EFCore.Tests/ChangeTracking/AggregatesTest.cs
+++ b/test/EFCore.Tests/ChangeTracking/GraphTrackingTest.cs
@@ -3,7 +3,7 @@
 
 namespace Microsoft.EntityFrameworkCore.ChangeTracking;
 
-public class AggregatesTest
+public class GraphTrackingTest
 {
     [ConditionalFact]
     public void Can_add_aggregate()
diff --git a/test/EFCore.Tests/Storage/ValueComparerTest.cs b/test/EFCore.Tests/ChangeTracking/ValueComparerTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/ValueComparerTest.cs
rename to test/EFCore.Tests/ChangeTracking/ValueComparerTest.cs
index 548017539f..bc6eb2ef3e 100644
--- a/test/EFCore.Tests/Storage/ValueComparerTest.cs
+++ b/test/EFCore.Tests/ChangeTracking/ValueComparerTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.ChangeTracking;
 
 public class ValueComparerTest
 {
diff --git a/test/EFCore.Tests/ContextConfigurationTest.cs b/test/EFCore.Tests/ContextConfigurationTest.cs
deleted file mode 100644
index b15270226b..0000000000
--- a/test/EFCore.Tests/ContextConfigurationTest.cs
+++ /dev/null
@@ -1,105 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-using Microsoft.EntityFrameworkCore.ChangeTracking.Internal;
-using Microsoft.EntityFrameworkCore.Internal;
-
-namespace Microsoft.EntityFrameworkCore;
-
-public class ContextConfigurationTest
-{
-    [ConditionalFact]
-    public void Requesting_a_singleton_always_returns_same_instance()
-    {
-        var provider = InMemoryTestHelpers.Instance.CreateServiceProvider();
-        var contextServices1 = InMemoryTestHelpers.Instance.CreateContextServices(provider);
-        var contextServices2 = InMemoryTestHelpers.Instance.CreateContextServices(provider);
-
-        Assert.Same(contextServices1.GetRequiredService<IDbSetSource>(), contextServices2.GetRequiredService<IDbSetSource>());
-    }
-
-    [ConditionalFact]
-    public void Requesting_a_scoped_service_always_returns_same_instance_in_scope()
-    {
-        var provider = InMemoryTestHelpers.Instance.CreateServiceProvider();
-        var contextServices = InMemoryTestHelpers.Instance.CreateContextServices(provider);
-
-        Assert.Same(contextServices.GetRequiredService<IStateManager>(), contextServices.GetRequiredService<IStateManager>());
-    }
-
-    [ConditionalFact]
-    public void Requesting_a_scoped_service_always_returns_a_different_instance_in_a_different_scope()
-    {
-        var provider = InMemoryTestHelpers.Instance.CreateServiceProvider();
-        var contextServices1 = InMemoryTestHelpers.Instance.CreateContextServices(provider);
-        var contextServices2 = InMemoryTestHelpers.Instance.CreateContextServices(provider);
-
-        Assert.NotSame(contextServices1.GetRequiredService<IStateManager>(), contextServices2.GetRequiredService<IStateManager>());
-    }
-
-    [ConditionalFact]
-    public void Scoped_provider_services_can_be_obtained_from_configuration()
-    {
-        var serviceProvider = InMemoryTestHelpers.Instance.CreateServiceProvider();
-
-        IDatabase database;
-        IDatabaseCreator creator;
-
-        using (var context = new GiddyupContext(serviceProvider))
-        {
-            database = context.GetService<IDatabase>();
-            creator = context.GetService<IDatabaseCreator>();
-
-            Assert.Same(database, context.GetService<IDatabase>());
-            Assert.Same(creator, context.GetService<IDatabaseCreator>());
-        }
-
-        using (var context = new GiddyupContext(serviceProvider))
-        {
-            Assert.NotSame(database, context.GetService<IDatabase>());
-            Assert.NotSame(creator, context.GetService<IDatabaseCreator>());
-        }
-    }
-
-    [ConditionalFact]
-    public void Scoped_provider_services_can_be_obtained_from_configuration_with_implicit_service_provider()
-    {
-        IDatabase database;
-        IDatabaseCreator creator;
-
-        using (var context = new GiddyupContext())
-        {
-            database = context.GetService<IDatabase>();
-            creator = context.GetService<IDatabaseCreator>();
-
-            Assert.Same(database, context.GetService<IDatabase>());
-            Assert.Same(creator, context.GetService<IDatabaseCreator>());
-        }
-
-        using (var context = new GiddyupContext())
-        {
-            Assert.NotSame(database, context.GetService<IDatabase>());
-            Assert.NotSame(creator, context.GetService<IDatabaseCreator>());
-        }
-    }
-
-    private class GiddyupContext : DbContext
-    {
-        private readonly IServiceProvider _serviceProvider;
-
-        public GiddyupContext()
-        {
-        }
-
-        public GiddyupContext(IServiceProvider serviceProvider)
-        {
-            _serviceProvider = serviceProvider;
-        }
-
-        protected internal override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
-            => optionsBuilder
-                .UseInMemoryDatabase(Guid.NewGuid().ToString())
-                .EnableServiceProviderCaching(false)
-                .UseInternalServiceProvider(_serviceProvider);
-    }
-}
diff --git a/test/EFCore.Tests/DbContextServicesTest.cs b/test/EFCore.Tests/DbContextTest.Services.cs
similarity index 97%
rename from test/EFCore.Tests/DbContextServicesTest.cs
rename to test/EFCore.Tests/DbContextTest.Services.cs
index 5ae9632cca..1a584a0a29 100644
--- a/test/EFCore.Tests/DbContextServicesTest.cs
+++ b/test/EFCore.Tests/DbContextTest.Services.cs
@@ -9,9 +9,11 @@
 using Microsoft.EntityFrameworkCore.InMemory.Infrastructure.Internal;
 using Microsoft.EntityFrameworkCore.InMemory.Storage.Internal;
 using Microsoft.EntityFrameworkCore.InMemory.ValueGeneration.Internal;
+using Microsoft.EntityFrameworkCore.Internal;
 using Microsoft.EntityFrameworkCore.Metadata.Internal;
 using Microsoft.EntityFrameworkCore.Query.Internal;
 using Microsoft.Extensions.Caching.Memory;
+using Microsoft.Extensions.DependencyInjection;
 
 // ReSharper disable ClassNeverInstantiated.Local
 // ReSharper disable UnusedMember.Local
@@ -565,6 +567,93 @@ public void Each_context_gets_new_scoped_services_with_implicit_services_and_exp
             }
         }
 
+        [ConditionalFact]
+        public void Scoped_provider_services_can_be_obtained_from_configuration()
+        {
+            var serviceProvider = InMemoryTestHelpers.Instance.CreateServiceProvider();
+
+            var options = new DbContextOptionsBuilder().UseInternalServiceProvider(serviceProvider)
+                .EnableServiceProviderCaching(false)
+                .UseInMemoryDatabase(Guid.NewGuid().ToString())
+                .ConfigureWarnings(w => w.Default(WarningBehavior.Throw))
+                .Options;
+
+            IDatabase database;
+            IDatabaseCreator creator;
+
+            using (var context = new DbContext(options))
+            {
+                database = context.GetService<IDatabase>();
+                creator = context.GetService<IDatabaseCreator>();
+
+                Assert.Same(database, context.GetService<IDatabase>());
+                Assert.Same(creator, context.GetService<IDatabaseCreator>());
+            }
+
+            using (var context = new DbContext(options))
+            {
+                Assert.NotSame(database, context.GetService<IDatabase>());
+                Assert.NotSame(creator, context.GetService<IDatabaseCreator>());
+            }
+        }
+
+        [ConditionalFact]
+        public void Scoped_provider_services_can_be_obtained_from_configuration_with_implicit_service_provider()
+        {
+            var options = new DbContextOptionsBuilder().UseInternalServiceProvider(null)
+                .EnableServiceProviderCaching(false)
+                .UseInMemoryDatabase(Guid.NewGuid().ToString())
+                .ConfigureWarnings(w => w.Default(WarningBehavior.Throw))
+                .Options;
+
+            IDatabase database;
+            IDatabaseCreator creator;
+
+            using (var context = new DbContext(options))
+            {
+                database = context.GetService<IDatabase>();
+                creator = context.GetService<IDatabaseCreator>();
+
+                Assert.Same(database, context.GetService<IDatabase>());
+                Assert.Same(creator, context.GetService<IDatabaseCreator>());
+            }
+
+            using (var context = new DbContext(options))
+            {
+                Assert.NotSame(database, context.GetService<IDatabase>());
+                Assert.NotSame(creator, context.GetService<IDatabaseCreator>());
+            }
+        }
+
+        [ConditionalFact]
+        public void Requesting_a_singleton_always_returns_same_instance()
+        {
+            var provider = InMemoryTestHelpers.Instance.CreateServiceProvider();
+            var contextServices1 = InMemoryTestHelpers.Instance.CreateContextServices(provider);
+            var contextServices2 = InMemoryTestHelpers.Instance.CreateContextServices(provider);
+
+            Assert.Same(contextServices1.GetRequiredService<IDbSetSource>(), contextServices2.GetRequiredService<IDbSetSource>());
+        }
+
+        [ConditionalFact]
+        public void Requesting_a_scoped_service_always_returns_same_instance_in_scope()
+        {
+            var provider = InMemoryTestHelpers.Instance.CreateServiceProvider();
+            var contextServices = InMemoryTestHelpers.Instance.CreateContextServices(provider);
+
+            Assert.Same(contextServices.GetRequiredService<IStateManager>(), contextServices.GetRequiredService<IStateManager>());
+        }
+
+        [ConditionalFact]
+        public void Requesting_a_scoped_service_always_returns_a_different_instance_in_a_different_scope()
+        {
+            var provider = InMemoryTestHelpers.Instance.CreateServiceProvider();
+            var contextServices1 = InMemoryTestHelpers.Instance.CreateContextServices(provider);
+            var contextServices2 = InMemoryTestHelpers.Instance.CreateContextServices(provider);
+
+            Assert.NotSame(contextServices1.GetRequiredService<IStateManager>(), contextServices2.GetRequiredService<IStateManager>());
+        }
+
         [ConditionalFact]
         public void Default_services_are_registered_when_parameterless_constructor_used()
         {
diff --git a/test/EFCore.Tests/DbContextTrackingTest.cs b/test/EFCore.Tests/DbContextTest.Tracking.cs
similarity index 100%
rename from test/EFCore.Tests/DbContextTrackingTest.cs
rename to test/EFCore.Tests/DbContextTest.Tracking.cs
diff --git a/test/EFCore.Tests/Infrastructure/CoreEventIdTest.cs b/test/EFCore.Tests/Diagnostics/CoreEventIdTest.cs
similarity index 99%
rename from test/EFCore.Tests/Infrastructure/CoreEventIdTest.cs
rename to test/EFCore.Tests/Diagnostics/CoreEventIdTest.cs
index 636665378b..a73e08f2a5 100644
--- a/test/EFCore.Tests/Infrastructure/CoreEventIdTest.cs
+++ b/test/EFCore.Tests/Diagnostics/CoreEventIdTest.cs
@@ -5,7 +5,7 @@
 using Microsoft.EntityFrameworkCore.Metadata.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore.Infrastructure;
+namespace Microsoft.EntityFrameworkCore.Diagnostics;
 
 public class CoreEventIdTest : EventIdTestBase
 {
diff --git a/test/EFCore.Tests/InterceptionResultTest.cs b/test/EFCore.Tests/Diagnostics/InterceptionResultTest.cs
similarity index 89%
rename from test/EFCore.Tests/InterceptionResultTest.cs
rename to test/EFCore.Tests/Diagnostics/InterceptionResultTest.cs
index 65e0819689..be7a015011 100644
--- a/test/EFCore.Tests/InterceptionResultTest.cs
+++ b/test/EFCore.Tests/Diagnostics/InterceptionResultTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Diagnostics;
 
 public class InterceptionResultTest
 {
diff --git a/test/EFCore.Tests/EFTest.cs b/test/EFCore.Tests/EFTest.cs
index 94db63429c..1deb276065 100644
--- a/test/EFCore.Tests/EFTest.cs
+++ b/test/EFCore.Tests/EFTest.cs
@@ -10,4 +10,73 @@ public void Property_throws_when_invoked_outside_of_query()
         => Assert.Equal(
             CoreStrings.PropertyMethodInvoked,
             Assert.Throws<InvalidOperationException>(() => EF.Property<object>(new object(), "")).Message);
+
+    [ConditionalFact]
+    public void CompiledQuery_throws_when_used_with_different_models()
+    {
+        using var context1 = new SwitchContext();
+        using var context2 = new SwitchContext();
+
+        var query = EF.CompileQuery((SwitchContext c, Bar p1) => c.Foos.Where(e => e.Bars.Contains(p1)));
+
+        _ = query(context1, new Bar()).ToList();
+        _ = query(context1, new Bar()).ToList();
+
+        Assert.Equal(
+            CoreStrings.CompiledQueryDifferentModel("(c, p1) => c.Foos .Where(e => e.Bars.Contains(p1))"),
+            Assert.Throws<InvalidOperationException>(
+                    () => query(context2, new Bar()).ToList())
+                .Message.Replace("\r", "").Replace("\n", ""), ignoreWhiteSpaceDifferences: true);
+
+        _ = query(context1, new Bar()).ToList();
+    }
+
+    [ConditionalFact]
+    public async Task CompiledQueryAsync_throws_when_used_with_different_models()
+    {
+        using var context1 = new SwitchContext();
+        using var context2 = new SwitchContext();
+
+        var query = EF.CompileAsyncQuery((SwitchContext c) => c.Foos);
+
+        _ = await query(context1).ToListAsync();
+        _ = await query(context1).ToListAsync();
+
+        Assert.Equal(
+            CoreStrings.CompiledQueryDifferentModel("c => c.Foos"),
+            (await Assert.ThrowsAsync<InvalidOperationException>(
+                () => query(context2).ToListAsync())).Message);
+
+        _ = await query(context1).ToListAsync();
+    }
+
+    private class Foo
+    {
+        public int Id { get; set; }
+        public List<Bar> Bars { get; } = new();
+    }
+
+    private class Bar
+    {
+        public int Id { get; set; }
+    }
+
+    private class SwitchContext : DbContext
+    {
+        public DbSet<Foo> Foos
+            => Set<Foo>();
+
+        protected internal override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
+            => optionsBuilder
+                .UseInMemoryDatabase(nameof(SwitchContext))
+                .ReplaceService<IModelCacheKeyFactory, DegenerateCacheKeyFactory>();
+    }
+
+    private class DegenerateCacheKeyFactory : IModelCacheKeyFactory
+    {
+        private static int _value;
+
+        public object Create(DbContext context, bool designTime)
+            => _value++;
+    }
 }
diff --git a/test/EFCore.Tests/Utilities/EnumerableExtensionsTest.cs b/test/EFCore.Tests/Extensions/EnumerableExtensionsTest.cs
similarity index 97%
rename from test/EFCore.Tests/Utilities/EnumerableExtensionsTest.cs
rename to test/EFCore.Tests/Extensions/EnumerableExtensionsTest.cs
index 3674245655..63837aaaef 100644
--- a/test/EFCore.Tests/Utilities/EnumerableExtensionsTest.cs
+++ b/test/EFCore.Tests/Extensions/EnumerableExtensionsTest.cs
@@ -3,7 +3,7 @@
 
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore.Utilities;
+namespace Microsoft.EntityFrameworkCore;
 
 public class EnumerableExtensionsTest
 {
diff --git a/test/EFCore.Tests/Utilities/ExpressionExtensionsTest.cs b/test/EFCore.Tests/Extensions/ExpressionExtensionsTest.cs
similarity index 99%
rename from test/EFCore.Tests/Utilities/ExpressionExtensionsTest.cs
rename to test/EFCore.Tests/Extensions/ExpressionExtensionsTest.cs
index 8d22f37c1a..af6806c5fd 100644
--- a/test/EFCore.Tests/Utilities/ExpressionExtensionsTest.cs
+++ b/test/EFCore.Tests/Extensions/ExpressionExtensionsTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.ModelBuilding;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore.Utilities;
+namespace Microsoft.EntityFrameworkCore;
 
 public class ExpressionExtensionsTest
 {
diff --git a/test/EFCore.Tests/Utilities/PropertyInfoExtensionsTest.cs b/test/EFCore.Tests/Extensions/PropertyInfoExtensionsTest.cs
similarity index 97%
rename from test/EFCore.Tests/Utilities/PropertyInfoExtensionsTest.cs
rename to test/EFCore.Tests/Extensions/PropertyInfoExtensionsTest.cs
index 4fc1aa72d8..c4d16a4e67 100644
--- a/test/EFCore.Tests/Utilities/PropertyInfoExtensionsTest.cs
+++ b/test/EFCore.Tests/Extensions/PropertyInfoExtensionsTest.cs
@@ -3,7 +3,7 @@
 
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore.Utilities;
+namespace Microsoft.EntityFrameworkCore;
 
 public class PropertyInfoExtensionsTest
 {
diff --git a/test/EFCore.Tests/Utilities/StringBuilderExtensionsTest.cs b/test/EFCore.Tests/Extensions/StringBuilderExtensionsTest.cs
similarity index 93%
rename from test/EFCore.Tests/Utilities/StringBuilderExtensionsTest.cs
rename to test/EFCore.Tests/Extensions/StringBuilderExtensionsTest.cs
index 5e005c1756..511dda76f9 100644
--- a/test/EFCore.Tests/Utilities/StringBuilderExtensionsTest.cs
+++ b/test/EFCore.Tests/Extensions/StringBuilderExtensionsTest.cs
@@ -3,7 +3,7 @@
 
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore.Utilities;
+namespace Microsoft.EntityFrameworkCore;
 
 public class StringBuilderExtensionsTest
 {
diff --git a/test/EFCore.Tests/Utilities/TypeExtensionsTest.cs b/test/EFCore.Tests/Extensions/TypeExtensionsTest.cs
similarity index 67%
rename from test/EFCore.Tests/Utilities/TypeExtensionsTest.cs
rename to test/EFCore.Tests/Extensions/TypeExtensionsTest.cs
index f4b1c83865..9a862a89ea 100644
--- a/test/EFCore.Tests/Utilities/TypeExtensionsTest.cs
+++ b/test/EFCore.Tests/Extensions/TypeExtensionsTest.cs
@@ -1,11 +1,11 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
+// ReSharper disable InconsistentNaming
+
 using System.Collections;
 using System.Collections.ObjectModel;
-
-// ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore.Utilities;
+namespace Microsoft.EntityFrameworkCore;
 
 public class TypeExtensionsTest
 {
@@ -451,25 +451,235 @@ public void GetNamespaces_works()
         Assert.Equal(new[] { "System" }, typeof(Guid).GetNamespaces().ToArray());
         Assert.Equal(new[] { "System.Collections.Generic", "System" }, typeof(List<Guid>).GetNamespaces().ToArray());
 
-        Assert.Equal(new[] { "Microsoft.EntityFrameworkCore.Utilities" }, typeof(A).GetNamespaces().ToArray());
+        Assert.Equal(new[] { "Microsoft.EntityFrameworkCore" }, typeof(A).GetNamespaces().ToArray());
         Assert.Equal(
-            new[] { "System.Collections.Generic", "Microsoft.EntityFrameworkCore.Utilities" },
+            new[] { "System.Collections.Generic", "Microsoft.EntityFrameworkCore" },
             typeof(List<A>).GetNamespaces().ToArray());
         Assert.Equal(
-            new[] { "System.Collections.Generic", "System", "System.Collections.Generic", "Microsoft.EntityFrameworkCore.Utilities" },
+            new[] { "System.Collections.Generic", "System", "System.Collections.Generic", "Microsoft.EntityFrameworkCore" },
             typeof(Dictionary<Version, List<A>>).GetNamespaces().ToArray());
 
-        Assert.Equal(new[] { "Microsoft.EntityFrameworkCore.Utilities", "System" }, typeof(Outer<Guid>).GetNamespaces().ToArray());
+        Assert.Equal(new[] { "Microsoft.EntityFrameworkCore", "System" }, typeof(Outer<Guid>).GetNamespaces().ToArray());
         Assert.Equal(
-            new[] { "Microsoft.EntityFrameworkCore.Utilities", "System.Collections.Generic", "System" },
+            new[] { "Microsoft.EntityFrameworkCore", "System.Collections.Generic", "System" },
             typeof(Outer<List<Guid>>).GetNamespaces().ToArray());
     }
 
-    private class Outer<T>
+    [ConditionalTheory]
+    // Predefined Types
+    [InlineData(typeof(int), "int")]
+    [InlineData(typeof(List<int>), "System.Collections.Generic.List<int>")]
+    [InlineData(typeof(Dictionary<int, string>), "System.Collections.Generic.Dictionary<int, string>")]
+    [InlineData(
+        typeof(Dictionary<int, List<string>>), "System.Collections.Generic.Dictionary<int, System.Collections.Generic.List<string>>")]
+    [InlineData(typeof(List<List<string>>), "System.Collections.Generic.List<System.Collections.Generic.List<string>>")]
+    // Classes inside NonGeneric class
+    [InlineData(
+        typeof(A),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+A")]
+    [InlineData(
+        typeof(B<int>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+B<int>")]
+    [InlineData(
+        typeof(C<int, string>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+C<int, string>")]
+    [InlineData(
+        typeof(B<B<string>>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+B<Microsoft.EntityFrameworkCore.TypeExtensionsTest+B<string>>")]
+    [InlineData(
+        typeof(C<int, B<string>>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+C<int, Microsoft.EntityFrameworkCore.TypeExtensionsTest+B<string>>")]
+    // Classes inside Generic class
+    [InlineData(
+        typeof(Outer<int>.D),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+Outer<int>+D")]
+    [InlineData(
+        typeof(Outer<int>.E<int>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+Outer<int>+E<int>")]
+    [InlineData(
+        typeof(Outer<int>.F<int, string>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+Outer<int>+F<int, string>")]
+    [InlineData(
+        typeof(Level1<int>.Level2<bool>.Level3<int>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+Level1<int>+Level2<bool>+Level3<int>")]
+    [InlineData(
+        typeof(Outer<int>.E<Outer<int>.E<string>>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+Outer<int>+E<Microsoft.EntityFrameworkCore.TypeExtensionsTest+Outer<int>+E<string>>")]
+    [InlineData(
+        typeof(Outer<int>.F<int, Outer<int>.E<string>>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+Outer<int>+F<int, Microsoft.EntityFrameworkCore.TypeExtensionsTest+Outer<int>+E<string>>")]
+    [InlineData(
+        typeof(OuterGeneric<int>.InnerNonGeneric.InnerGeneric<int, string>.InnerGenericLeafNode<bool>),
+        "Microsoft.EntityFrameworkCore.TypeExtensionsTest+OuterGeneric<int>+InnerNonGeneric+InnerGeneric<int, string>+InnerGenericLeafNode<bool>")]
+    public void Can_pretty_print_CLR_full_name(Type type, string expected)
+        => Assert.Equal(expected, type.DisplayName());
+
+    [ConditionalTheory]
+    // Predefined Types
+    [InlineData(typeof(int), "int")]
+    [InlineData(typeof(List<int>), "List<int>")]
+    [InlineData(typeof(Dictionary<int, string>), "Dictionary<int, string>")]
+    [InlineData(typeof(Dictionary<int, List<string>>), "Dictionary<int, List<string>>")]
+    [InlineData(typeof(List<List<string>>), "List<List<string>>")]
+    // Classes inside NonGeneric class
+    [InlineData(typeof(A), "A")]
+    [InlineData(typeof(B<int>), "B<int>")]
+    [InlineData(typeof(C<int, string>), "C<int, string>")]
+    [InlineData(typeof(C<int, B<string>>), "C<int, B<string>>")]
+    [InlineData(typeof(B<B<string>>), "B<B<string>>")]
+    // Classes inside Generic class
+    [InlineData(typeof(Outer<int>.D), "D")]
+    [InlineData(typeof(Outer<int>.E<int>), "E<int>")]
+    [InlineData(typeof(Outer<int>.F<int, string>), "F<int, string>")]
+    [InlineData(typeof(Outer<int>.F<int, Outer<int>.E<string>>), "F<int, E<string>>")]
+    [InlineData(typeof(Outer<int>.E<Outer<int>.E<string>>), "E<E<string>>")]
+    [InlineData(
+        typeof(OuterGeneric<int>.InnerNonGeneric.InnerGeneric<int, string>.InnerGenericLeafNode<bool>), "InnerGenericLeafNode<bool>")]
+    public void Can_pretty_print_CLR_name(Type type, string expected)
+        => Assert.Equal(expected, type.ShortDisplayName());
+
+    [ConditionalTheory]
+    [InlineData(typeof(bool), "bool")]
+    [InlineData(typeof(byte), "byte")]
+    [InlineData(typeof(char), "char")]
+    [InlineData(typeof(decimal), "decimal")]
+    [InlineData(typeof(double), "double")]
+    [InlineData(typeof(float), "float")]
+    [InlineData(typeof(int), "int")]
+    [InlineData(typeof(long), "long")]
+    [InlineData(typeof(object), "object")]
+    [InlineData(typeof(sbyte), "sbyte")]
+    [InlineData(typeof(short), "short")]
+    [InlineData(typeof(string), "string")]
+    [InlineData(typeof(uint), "uint")]
+    [InlineData(typeof(ulong), "ulong")]
+    [InlineData(typeof(ushort), "ushort")]
+    [InlineData(typeof(void), "void")]
+    public void Returns_common_name_for_built_in_types(Type type, string expected)
+        => Assert.Equal(expected, type.DisplayName());
+
+    [ConditionalTheory]
+    [InlineData(typeof(int[]), true, "int[]")]
+    [InlineData(typeof(string[][]), true, "string[][]")]
+    [InlineData(typeof(int[,]), true, "int[,]")]
+    [InlineData(typeof(bool[,,,]), true, "bool[,,,]")]
+    [InlineData(typeof(A[,][,,]), true, "Microsoft.EntityFrameworkCore.TypeExtensionsTest+A[,][,,]")]
+    [InlineData(typeof(List<int[,][,,]>), true, "System.Collections.Generic.List<int[,][,,]>")]
+    [InlineData(typeof(List<int[,,][,]>[,][,,]), false, "List<int[,,][,]>[,][,,]")]
+    public void Can_pretty_print_array_name(Type type, bool fullName, string expected)
+        => Assert.Equal(expected, type.DisplayName(fullName));
+
+    public static TheoryData OpenGenericsTestData { get; } = CreateOpenGenericsTestData();
+
+    public static TheoryData CreateOpenGenericsTestData()
+    {
+        var openDictionaryType = typeof(Dictionary<,>);
+        var genArgsDictionary = openDictionaryType.GetGenericArguments();
+        genArgsDictionary[0] = typeof(B<>);
+        var closedDictionaryType = openDictionaryType.MakeGenericType(genArgsDictionary);
+        var openLevelType = typeof(Level1<>.Level2<>.Level3<>);
+        var genArgsLevel = openLevelType.GetGenericArguments();
+        genArgsLevel[1] = typeof(string);
+        var closedLevelType = openLevelType.MakeGenericType(genArgsLevel);
+        var openInnerType = typeof(OuterGeneric<>.InnerNonGeneric.InnerGeneric<,>.InnerGenericLeafNode<>);
+        var genArgsInnerType = openInnerType.GetGenericArguments();
+        genArgsInnerType[3] = typeof(bool);
+        var closedInnerType = openInnerType.MakeGenericType(genArgsInnerType);
+        return new TheoryData<Type, bool, string>
+        {
+            { typeof(List<>), false, "List<>" },
+            { typeof(Dictionary<,>), false, "Dictionary<,>" },
+            { typeof(List<>), true, "System.Collections.Generic.List<>" },
+            { typeof(Dictionary<,>), true, "System.Collections.Generic.Dictionary<,>" },
+            {
+                typeof(Level1<>.Level2<>.Level3<>), true,
+                "Microsoft.EntityFrameworkCore.TypeExtensionsTest+Level1<>+Level2<>+Level3<>"
+            },
+            { typeof(PartiallyClosedGeneric<>).BaseType, true, "Microsoft.EntityFrameworkCore.TypeExtensionsTest+C<, int>" },
+            {
+                typeof(OuterGeneric<>.InnerNonGeneric.InnerGeneric<,>.InnerGenericLeafNode<>), true,
+                "Microsoft.EntityFrameworkCore.TypeExtensionsTest+OuterGeneric<>+InnerNonGeneric+InnerGeneric<,>+InnerGenericLeafNode<>"
+            },
+            {
+                closedDictionaryType, true,
+                "System.Collections.Generic.Dictionary<Microsoft.EntityFrameworkCore.TypeExtensionsTest+B<>,>"
+            },
+            { closedLevelType, true, "Microsoft.EntityFrameworkCore.TypeExtensionsTest+Level1<>+Level2<string>+Level3<>" },
+            {
+                closedInnerType, true,
+                "Microsoft.EntityFrameworkCore.TypeExtensionsTest+OuterGeneric<>+InnerNonGeneric+InnerGeneric<,>+InnerGenericLeafNode<bool>"
+            }
+        };
+    }
+
+    [ConditionalFact]
+    public void Can_pretty_print_open_generics()
     {
+        foreach (var testData in OpenGenericsTestData)
+        {
+            var type = (Type)testData[0];
+            var fullName = (bool)testData[1];
+            var expected = (string)testData[2];
+
+            Assert.Equal(expected, type.DisplayName(fullName));
+        }
     }
 
     private class A
     {
     }
+
+    private class B<T>
+    {
+    }
+
+    private class C<T1, T2>
+    {
+    }
+
+    private class PartiallyClosedGeneric<T> : C<T, int>
+    {
+    }
+
+    private static class Outer<T>
+    {
+        public class D
+        {
+        }
+
+        public class E<T1>
+        {
+        }
+
+        public class F<T1, T2>
+        {
+        }
+    }
+
+    private static class OuterGeneric<T1>
+    {
+        public static class InnerNonGeneric
+        {
+            public static class InnerGeneric<T2, T3>
+            {
+                public class InnerGenericLeafNode<T4>
+                {
+                }
+
+                public class InnerLeafNode
+                {
+                }
+            }
+        }
+    }
+
+    private static class Level1<T1>
+    {
+        public static class Level2<T2>
+        {
+            public class Level3<T3>
+            {
+            }
+        }
+    }
 }
diff --git a/test/EFCore.Tests/DatabaseFacadeTest.cs b/test/EFCore.Tests/Infrastructure/DatabaseFacadeTest.cs
similarity index 99%
rename from test/EFCore.Tests/DatabaseFacadeTest.cs
rename to test/EFCore.Tests/Infrastructure/DatabaseFacadeTest.cs
index 8e39faa033..df54f12301 100644
--- a/test/EFCore.Tests/DatabaseFacadeTest.cs
+++ b/test/EFCore.Tests/Infrastructure/DatabaseFacadeTest.cs
@@ -3,7 +3,7 @@
 
 using System.Transactions;
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Infrastructure;
 
 public class DatabaseFacadeTest
 {
diff --git a/test/EFCore.Tests/EntitySetFinderTest.cs b/test/EFCore.Tests/Infrastructure/DbSetFinderTest.cs
similarity index 97%
rename from test/EFCore.Tests/EntitySetFinderTest.cs
rename to test/EFCore.Tests/Infrastructure/DbSetFinderTest.cs
index a146086155..84029e8782 100644
--- a/test/EFCore.Tests/EntitySetFinderTest.cs
+++ b/test/EFCore.Tests/Infrastructure/DbSetFinderTest.cs
@@ -4,7 +4,7 @@
 using Microsoft.EntityFrameworkCore.Infrastructure.Internal;
 
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Infrastructure;
 
 public class DbSetFinderTest
 {
diff --git a/test/EFCore.Tests/EventSourceTest.cs b/test/EFCore.Tests/Infrastructure/EventSourceTest.cs
similarity index 99%
rename from test/EFCore.Tests/EventSourceTest.cs
rename to test/EFCore.Tests/Infrastructure/EventSourceTest.cs
index c05b9b72fa..74a3c007da 100644
--- a/test/EFCore.Tests/EventSourceTest.cs
+++ b/test/EFCore.Tests/Infrastructure/EventSourceTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Infrastructure;
 
 // The tests interact with global state and should never be run in parallel
 [Collection("EventSourceTest")]
diff --git a/test/EFCore.Tests/Utilities/IndentedStringBuilderTest.cs b/test/EFCore.Tests/Infrastructure/IndentedStringBuilderTest.cs
similarity index 99%
rename from test/EFCore.Tests/Utilities/IndentedStringBuilderTest.cs
rename to test/EFCore.Tests/Infrastructure/IndentedStringBuilderTest.cs
index 53dc2d2fa8..68fda72497 100644
--- a/test/EFCore.Tests/Utilities/IndentedStringBuilderTest.cs
+++ b/test/EFCore.Tests/Infrastructure/IndentedStringBuilderTest.cs
@@ -3,7 +3,7 @@
 
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore.Utilities;
+namespace Microsoft.EntityFrameworkCore.Infrastructure;
 
 public class IndentedStringBuilderTest
 {
diff --git a/test/EFCore.Tests/ModelSourceTest.cs b/test/EFCore.Tests/Infrastructure/ModelSourceTest.cs
similarity index 99%
rename from test/EFCore.Tests/ModelSourceTest.cs
rename to test/EFCore.Tests/Infrastructure/ModelSourceTest.cs
index 0704d9beb8..65cb9da5ef 100644
--- a/test/EFCore.Tests/ModelSourceTest.cs
+++ b/test/EFCore.Tests/Infrastructure/ModelSourceTest.cs
@@ -6,7 +6,7 @@
 
 // ReSharper disable UnusedMember.Local
 // ReSharper disable InconsistentNaming
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Infrastructure;
 
 public class ModelSourceTest
 {
diff --git a/test/EFCore.Tests/Infrastructure/LoggerCategoryTest.cs b/test/EFCore.Tests/LoggerCategoryTest.cs
similarity index 97%
rename from test/EFCore.Tests/Infrastructure/LoggerCategoryTest.cs
rename to test/EFCore.Tests/LoggerCategoryTest.cs
index 92a63fa71c..b0f23a5630 100644
--- a/test/EFCore.Tests/Infrastructure/LoggerCategoryTest.cs
+++ b/test/EFCore.Tests/LoggerCategoryTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Infrastructure;
+namespace Microsoft.EntityFrameworkCore;
 
 public class DbLoggerCategoryTest
 {
diff --git a/test/EFCore.Tests/Metadata/MetadataBuilderTest.cs b/test/EFCore.Tests/Metadata/Builders/MetadataBuilderTest.cs
similarity index 91%
rename from test/EFCore.Tests/Metadata/MetadataBuilderTest.cs
rename to test/EFCore.Tests/Metadata/Builders/MetadataBuilderTest.cs
index 55c177ad01..711bcead18 100644
--- a/test/EFCore.Tests/Metadata/MetadataBuilderTest.cs
+++ b/test/EFCore.Tests/Metadata/Builders/MetadataBuilderTest.cs
@@ -6,12 +6,12 @@
 // ReSharper disable UnusedAutoPropertyAccessor.Local
 // ReSharper disable InconsistentNaming
 
-namespace Microsoft.EntityFrameworkCore.Metadata;
+namespace Microsoft.EntityFrameworkCore.Metadata.Builders;
 
 public class MetadataBuilderTest
 {
     [ConditionalFact]
-    public void Can_write_convention_model_builder_extension()
+    public void Can_write_model_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -28,7 +28,7 @@ public void Can_write_convention_model_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_entity_builder_extension()
+    public void Can_write_entity_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -47,7 +47,7 @@ public void Can_write_convention_entity_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_entity_builder_extension_and_use_with_generic_builder()
+    public void Can_write_entity_builder_extension_and_use_with_generic_builder()
     {
         var builder = CreateModelBuilder();
 
@@ -66,7 +66,7 @@ public void Can_write_convention_entity_builder_extension_and_use_with_generic_b
     }
 
     [ConditionalFact]
-    public void Can_write_generic_convention_entity_builder_extension()
+    public void Can_write_generic_entity_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -85,7 +85,7 @@ public void Can_write_generic_convention_entity_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_key_builder_extension()
+    public void Can_write_key_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -105,7 +105,7 @@ public void Can_write_convention_key_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_property_builder_extension()
+    public void Can_write_property_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -125,7 +125,7 @@ public void Can_write_convention_property_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_index_builder_extension()
+    public void Can_write_index_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -145,7 +145,7 @@ public void Can_write_convention_index_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_one_to_many_builder_extension()
+    public void Can_write_one_to_many_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -166,7 +166,7 @@ public void Can_write_convention_one_to_many_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_many_to_one_builder_extension()
+    public void Can_write_many_to_one_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -187,7 +187,7 @@ public void Can_write_convention_many_to_one_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_one_to_one_builder_extension()
+    public void Can_write_one_to_one_builder_extension()
     {
         var builder = CreateModelBuilder();
 
@@ -209,7 +209,7 @@ public void Can_write_convention_one_to_one_builder_extension()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_model_builder_extension_with_common_name()
+    public void Can_write_model_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -226,7 +226,7 @@ public void Can_write_convention_model_builder_extension_with_common_name()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_entity_builder_extension_with_common_name()
+    public void Can_write_entity_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -245,7 +245,7 @@ public void Can_write_convention_entity_builder_extension_with_common_name()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_entity_builder_extension_and_use_with_generic_builder_with_common_name()
+    public void Can_write_entity_builder_extension_and_use_with_generic_builder_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -264,7 +264,7 @@ public void Can_write_convention_entity_builder_extension_and_use_with_generic_b
     }
 
     [ConditionalFact]
-    public void Can_write_generic_convention_entity_builder_extension_with_common_name()
+    public void Can_write_generic_entity_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -283,7 +283,7 @@ public void Can_write_generic_convention_entity_builder_extension_with_common_na
     }
 
     [ConditionalFact]
-    public void Can_write_convention_key_builder_extension_with_common_name()
+    public void Can_write_key_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -303,7 +303,7 @@ public void Can_write_convention_key_builder_extension_with_common_name()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_property_builder_extension_with_common_name()
+    public void Can_write_property_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -323,7 +323,7 @@ public void Can_write_convention_property_builder_extension_with_common_name()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_index_builder_extension_with_common_name()
+    public void Can_write_index_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -343,7 +343,7 @@ public void Can_write_convention_index_builder_extension_with_common_name()
     }
 
     [ConditionalFact]
-    public void Can_write_convention_one_to_many_builder_extension_with_common_name()
+    public void Can_write_one_to_many_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -364,7 +364,7 @@ public void Can_write_convention_one_to_many_builder_extension_with_common_name(
     }
 
     [ConditionalFact]
-    public void Can_write_convention_many_to_one_builder_extension_with_common_name()
+    public void Can_write_many_to_one_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
@@ -385,7 +385,7 @@ public void Can_write_convention_many_to_one_builder_extension_with_common_name(
     }
 
     [ConditionalFact]
-    public void Can_write_convention_one_to_one_builder_extension_with_common_name()
+    public void Can_write_one_to_one_builder_extension_with_common_name()
     {
         var builder = CreateModelBuilder();
 
diff --git a/test/EFCore.Tests/Metadata/EntityTypeExtensionsTest.cs b/test/EFCore.Tests/Metadata/EntityTypeExtensionsTest.cs
deleted file mode 100644
index b5efa96845..0000000000
--- a/test/EFCore.Tests/Metadata/EntityTypeExtensionsTest.cs
+++ /dev/null
@@ -1,191 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-using Microsoft.EntityFrameworkCore.Metadata.Internal;
-
-namespace Microsoft.EntityFrameworkCore.Metadata;
-
-public class EntityTypeExtensionsTest
-{
-    [ConditionalFact]
-    public void Can_get_all_properties_and_navigations()
-    {
-        var entityType = CreateModel().AddEntityType(nameof(SelfRef));
-        var pk = entityType.SetPrimaryKey(entityType.AddProperty(nameof(SelfRef.Id), typeof(int)));
-        var fkProp = entityType.AddProperty(nameof(SelfRef.SelfRefId), typeof(int?));
-
-        var fk = entityType.AddForeignKey(new[] { fkProp }, pk, entityType);
-        fk.IsUnique = true;
-        var dependentToPrincipal = fk.SetDependentToPrincipal(nameof(SelfRef.SelfRefPrincipal));
-        var principalToDependent = fk.SetPrincipalToDependent(nameof(SelfRef.SelfRefDependent));
-
-        Assert.Equal(
-            new IReadOnlyPropertyBase[] { pk.Properties.Single(), fkProp, principalToDependent, dependentToPrincipal },
-            ((IRuntimeEntityType)entityType).GetSnapshottableMembers().ToArray());
-    }
-
-    [ConditionalFact]
-    public void Can_get_referencing_foreign_keys()
-    {
-        var entityType = CreateModel().AddEntityType("Customer");
-        var idProperty = entityType.AddProperty("id", typeof(int));
-        var fkProperty = entityType.AddProperty("fk", typeof(int));
-        var fk = entityType.AddForeignKey(fkProperty, entityType.SetPrimaryKey(idProperty), entityType);
-
-        Assert.Same(fk, entityType.GetReferencingForeignKeys().Single());
-    }
-
-    [ConditionalFact]
-    public void Can_get_root_type()
-    {
-        var model = CreateModel();
-        var a = model.AddEntityType("A");
-        var b = model.AddEntityType("B");
-        var c = model.AddEntityType("C");
-        b.BaseType = a;
-        c.BaseType = b;
-
-        Assert.Same(a, a.GetRootType());
-        Assert.Same(a, b.GetRootType());
-        Assert.Same(a, c.GetRootType());
-    }
-
-    [ConditionalFact]
-    public void Can_get_derived_types()
-    {
-        var model = CreateModel();
-        var a = model.AddEntityType("A");
-        var b = model.AddEntityType("B");
-        var c = model.AddEntityType("C");
-        var d = model.AddEntityType("D");
-        b.BaseType = a;
-        c.BaseType = b;
-        d.BaseType = a;
-
-        Assert.Equal(new[] { b, d, c }, a.GetDerivedTypes().ToArray());
-        Assert.Equal(new[] { c }, b.GetDerivedTypes().ToArray());
-        Assert.Equal(new[] { b, d }, a.GetDirectlyDerivedTypes().ToArray());
-    }
-
-    [ConditionalFact]
-    public void Can_determine_whether_IsAssignableFrom()
-    {
-        var model = CreateModel();
-        var a = model.AddEntityType("A");
-        var b = model.AddEntityType("B");
-        var c = model.AddEntityType("C");
-        var d = model.AddEntityType("D");
-        b.BaseType = a;
-        c.BaseType = b;
-        d.BaseType = a;
-
-        Assert.True(a.IsAssignableFrom(a));
-        Assert.True(a.IsAssignableFrom(b));
-        Assert.True(a.IsAssignableFrom(c));
-        Assert.False(b.IsAssignableFrom(a));
-        Assert.False(c.IsAssignableFrom(a));
-        Assert.False(b.IsAssignableFrom(d));
-    }
-
-    [ConditionalFact]
-    public void Can_get_proper_table_name_for_generic_entityType()
-    {
-        var entityType = CreateModel().AddEntityType(typeof(A<int>));
-
-        Assert.Equal(
-            "A<int>",
-            entityType.DisplayName());
-    }
-
-    [ConditionalFact]
-    public void Setting_discriminator_on_non_root_type_throws()
-    {
-        var modelBuilder = new ModelBuilder();
-
-        var entityType = modelBuilder
-            .Entity<Customer>()
-            .Metadata;
-        var property = entityType.AddProperty("D", typeof(string));
-
-        var derivedType = modelBuilder
-            .Entity<SpecialCustomer>()
-            .Metadata;
-        derivedType.BaseType = entityType;
-
-        Assert.Equal(
-            CoreStrings.DiscriminatorPropertyMustBeOnRoot(nameof(SpecialCustomer)),
-            Assert.Throws<InvalidOperationException>(() => derivedType.SetDiscriminatorProperty(property)).Message);
-    }
-
-    [ConditionalFact]
-    public void Setting_discriminator_from_different_entity_type_throws()
-    {
-        var modelBuilder = new ModelBuilder();
-
-        var entityType = modelBuilder
-            .Entity<Customer>()
-            .Metadata;
-
-        var otherType = modelBuilder
-            .Entity<SpecialCustomer>()
-            .Metadata;
-
-        var property = entityType.AddProperty("D", typeof(string));
-
-        Assert.Equal(
-            CoreStrings.DiscriminatorPropertyNotFound("D", nameof(SpecialCustomer)),
-            Assert.Throws<InvalidOperationException>(() => otherType.SetDiscriminatorProperty(property)).Message);
-    }
-
-    [ConditionalFact]
-    public void Can_get_and_set_discriminator_value()
-    {
-        var modelBuilder = new ModelBuilder();
-
-        var entityType = modelBuilder
-            .Entity<Customer>()
-            .Metadata;
-
-        var property = entityType.AddProperty("D", typeof(string));
-        entityType.SetDiscriminatorProperty(property);
-
-        Assert.Null(entityType.GetDiscriminatorValue());
-
-        entityType.SetDiscriminatorValue("V");
-
-        Assert.Equal("V", entityType.GetDiscriminatorValue());
-
-        entityType.SetDiscriminatorValue(null);
-
-        Assert.Null(entityType.GetDiscriminatorValue());
-    }
-
-    private static IMutableModel CreateModel()
-        => new Model();
-
-    private class A<T>
-    {
-    }
-
-    private class SelfRef
-    {
-        public static readonly PropertyInfo IdProperty = typeof(SelfRef).GetProperty("Id");
-        public static readonly PropertyInfo SelfRefIdProperty = typeof(SelfRef).GetProperty("SelfRefId");
-
-        public int Id { get; set; }
-        public SelfRef SelfRefPrincipal { get; set; }
-        public SelfRef SelfRefDependent { get; set; }
-        public int? SelfRefId { get; set; }
-    }
-
-    private class Customer
-    {
-        public int Id { get; set; }
-        public string Name { get; set; }
-        public Guid AlternateId { get; set; }
-    }
-
-    private class SpecialCustomer : Customer
-    {
-    }
-}
diff --git a/test/EFCore.Tests/Metadata/Internal/EntityTypeTest.BaseType.cs b/test/EFCore.Tests/Metadata/Internal/EntityTypeTest.BaseType.cs
index 99258b77aa..93b5fd90a9 100644
--- a/test/EFCore.Tests/Metadata/Internal/EntityTypeTest.BaseType.cs
+++ b/test/EFCore.Tests/Metadata/Internal/EntityTypeTest.BaseType.cs
@@ -95,6 +95,136 @@ public void Setting_not_assignable_base_should_throw()
             Assert.Throws<InvalidOperationException>(() => a.BaseType = b).Message);
     }
 
+    [ConditionalFact]
+    public void Setting_base_type_for_owned_throws()
+    {
+        var model = CreateModel();
+        var baseType = model.AddEntityType(typeof(BaseType));
+        var entityType = model.AddOwnedEntityType(typeof(Customer));
+
+        Assert.Equal(
+            CoreStrings.DerivedEntityOwnershipMismatch(
+                nameof(BaseType), nameof(Customer), nameof(Customer), nameof(BaseType)),
+            Assert.Throws<InvalidOperationException>(
+                    () => entityType.BaseType = baseType)
+                .Message);
+    }
+
+    [ConditionalFact]
+    public void Can_get_root_type()
+    {
+        var model = CreateEmptyModel();
+        var a = model.AddEntityType("A");
+        var b = model.AddEntityType("B");
+        var c = model.AddEntityType("C");
+        b.BaseType = a;
+        c.BaseType = b;
+
+        Assert.Same(a, a.GetRootType());
+        Assert.Same(a, b.GetRootType());
+        Assert.Same(a, c.GetRootType());
+    }
+
+    [ConditionalFact]
+    public void Can_get_derived_types()
+    {
+        var model = CreateEmptyModel();
+        var a = model.AddEntityType("A");
+        var b = model.AddEntityType("B");
+        var c = model.AddEntityType("C");
+        var d = model.AddEntityType("D");
+        b.BaseType = a;
+        c.BaseType = b;
+        d.BaseType = a;
+
+        Assert.Equal(new[] { b, d, c }, a.GetDerivedTypes().ToArray());
+        Assert.Equal(new[] { c }, b.GetDerivedTypes().ToArray());
+        Assert.Equal(new[] { b, d }, a.GetDirectlyDerivedTypes().ToArray());
+    }
+
+    [ConditionalFact]
+    public void Can_determine_whether_IsAssignableFrom()
+    {
+        var model = CreateEmptyModel();
+        var a = model.AddEntityType("A");
+        var b = model.AddEntityType("B");
+        var c = model.AddEntityType("C");
+        var d = model.AddEntityType("D");
+        b.BaseType = a;
+        c.BaseType = b;
+        d.BaseType = a;
+
+        Assert.True(a.IsAssignableFrom(a));
+        Assert.True(a.IsAssignableFrom(b));
+        Assert.True(a.IsAssignableFrom(c));
+        Assert.False(b.IsAssignableFrom(a));
+        Assert.False(c.IsAssignableFrom(a));
+        Assert.False(b.IsAssignableFrom(d));
+    }
+
+    [ConditionalFact]
+    public void Setting_discriminator_on_non_root_type_throws()
+    {
+        var modelBuilder = new ModelBuilder();
+
+        var entityType = modelBuilder
+            .Entity<Customer>()
+            .Metadata;
+        var property = entityType.AddProperty("D", typeof(string));
+
+        var derivedType = modelBuilder
+            .Entity<SpecialCustomer>()
+            .Metadata;
+        derivedType.BaseType = entityType;
+
+        Assert.Equal(
+            CoreStrings.DiscriminatorPropertyMustBeOnRoot(nameof(SpecialCustomer)),
+            Assert.Throws<InvalidOperationException>(() => derivedType.SetDiscriminatorProperty(property)).Message);
+    }
+
+    [ConditionalFact]
+    public void Setting_discriminator_from_different_entity_type_throws()
+    {
+        var modelBuilder = new ModelBuilder();
+
+        var entityType = modelBuilder
+            .Entity<Customer>()
+            .Metadata;
+
+        var otherType = modelBuilder
+            .Entity<SpecialCustomer>()
+            .Metadata;
+
+        var property = entityType.AddProperty("D", typeof(string));
+
+        Assert.Equal(
+            CoreStrings.DiscriminatorPropertyNotFound("D", nameof(SpecialCustomer)),
+            Assert.Throws<InvalidOperationException>(() => otherType.SetDiscriminatorProperty(property)).Message);
+    }
+
+    [ConditionalFact]
+    public void Can_get_and_set_discriminator_value()
+    {
+        var modelBuilder = new ModelBuilder();
+
+        var entityType = modelBuilder
+            .Entity<Customer>()
+            .Metadata;
+
+        var property = entityType.AddProperty("D", typeof(string));
+        entityType.SetDiscriminatorProperty(property);
+
+        Assert.Null(entityType.GetDiscriminatorValue());
+
+        entityType.SetDiscriminatorValue("V");
+
+        Assert.Equal("V", entityType.GetDiscriminatorValue());
+
+        entityType.SetDiscriminatorValue(null);
+
+        Assert.Null(entityType.GetDiscriminatorValue());
+    }
+
     [ConditionalFact]
     public void Properties_on_base_type_should_be_inherited()
     {
@@ -171,6 +301,23 @@ public void Properties_added_to_base_type_should_be_inherited()
         Assert.Equal(new[] { 0, 1, 2, 3 }, c.GetProperties().Select(p => p.GetIndex()));
     }
 
+    [ConditionalFact]
+    public void Properties_on_base_type_are_listed_before_derived_properties()
+    {
+        var model = CreateModel();
+
+        var parentType = model.AddEntityType("Parent");
+        var property2 = parentType.AddProperty("D", typeof(int));
+        var property1 = parentType.AddProperty("C", typeof(int));
+
+        var childType = model.AddEntityType("Child");
+        var property4 = childType.AddProperty("B", typeof(int));
+        var property3 = childType.AddProperty("A", typeof(int));
+        childType.BaseType = parentType;
+
+        Assert.Equal(new[] { property1, property2, property3, property4 }, childType.GetProperties());
+    }
+
     [ConditionalFact]
     public void Properties_should_be_updated_when_base_type_changes()
     {
@@ -911,6 +1058,31 @@ public void ForeignKeys_should_be_updated_when_base_type_changes()
             specialOrderType.GetForeignKeys().Select(fk => fk.Properties.Select(p => p.Name).ToArray()).ToArray());
     }
 
+    [ConditionalFact]
+    public void Can_add_a_foreign_key_targeting_different_entity_type()
+    {
+        var model = CreateModel();
+        var baseType = model.AddEntityType(typeof(BaseType));
+        var customerType = model.AddEntityType(typeof(Customer));
+        customerType.BaseType = baseType;
+        var customerKey1 = baseType.AddKey(baseType.AddProperty(Customer.IdProperty));
+        var orderType = model.AddEntityType(typeof(Order));
+        var customerFkProperty = orderType.AddProperty(Order.CustomerIdProperty);
+
+        var fk1 = orderType.AddForeignKey(customerFkProperty, customerKey1, baseType);
+
+        Assert.NotNull(fk1);
+        Assert.Same(fk1, orderType.FindForeignKeys(customerFkProperty).Single());
+        Assert.Same(fk1, orderType.FindForeignKey(customerFkProperty, customerKey1, baseType));
+        Assert.Same(fk1, orderType.GetForeignKeys().Single());
+
+        var fk2 = orderType.AddForeignKey(customerFkProperty, customerKey1, customerType);
+
+        Assert.Equal(2, orderType.FindForeignKeys(customerFkProperty).Count());
+        Assert.Same(fk2, orderType.FindForeignKey(customerFkProperty, customerKey1, customerType));
+        Assert.Equal(new[] { fk1, fk2 }, orderType.GetForeignKeys().ToArray());
+    }
+
     [ConditionalFact]
     public void Adding_foreignKey_throws_when_parent_type_has_foreignKey_on_same_properties()
     {
@@ -1021,6 +1193,52 @@ public void Adding_foreignKey_throws_when_grandchild_type_has_foreignKey_on_same
                 () => orderType.AddForeignKey(foreignKeyProperty, customerKey, customerType)).Message);
     }
 
+    [ConditionalFact]
+    public void Can_add_a_key_if_any_properties_are_part_of_derived_foreign_key()
+    {
+        var model = CreateModel();
+        var baseType = model.AddEntityType(typeof(BaseType));
+        var idProperty = baseType.AddProperty(Customer.IdProperty);
+        var fkProperty = baseType.AddProperty("fk", typeof(int));
+        var key = baseType.AddKey(new[] { idProperty });
+        var entityType = model.AddEntityType(typeof(Customer));
+        entityType.BaseType = baseType;
+        entityType.AddForeignKey(new[] { fkProperty }, key, entityType);
+
+        Assert.NotNull(baseType.AddKey(new[] { fkProperty }));
+    }
+
+    [ConditionalFact]
+    public void Can_add_a_foreign_key_if_any_properties_are_part_of_inherited_key()
+    {
+        var model = CreateModel();
+        var baseType = model.AddEntityType(typeof(BaseType));
+        var idProperty = baseType.AddProperty(Customer.IdProperty);
+        var idProperty2 = baseType.AddProperty("id2", typeof(int));
+        var key = baseType.AddKey(new[] { idProperty, idProperty2 });
+        var entityType = model.AddEntityType(typeof(Customer));
+        entityType.BaseType = baseType;
+        var fkProperty = entityType.AddProperty("fk", typeof(int));
+
+        Assert.NotNull(entityType.AddForeignKey(new[] { fkProperty, idProperty }, key, entityType));
+    }
+
+    [ConditionalFact]
+    public void Can_add_a_foreign_key_if_any_properties_are_part_of_inherited_key_with_value_generation()
+    {
+        var model = CreateModel();
+        var baseType = model.AddEntityType(typeof(BaseType));
+        var idProperty = baseType.AddProperty(Customer.IdProperty);
+        idProperty.ValueGenerated = ValueGenerated.OnAdd;
+        var idProperty2 = baseType.AddProperty("id2", typeof(int));
+        var key = baseType.AddKey(new[] { idProperty, idProperty2 });
+        var entityType = model.AddEntityType(typeof(Customer));
+        entityType.BaseType = baseType;
+        var fkProperty = entityType.AddProperty("fk", typeof(int));
+
+        Assert.NotNull(entityType.AddForeignKey(new[] { fkProperty, idProperty }, key, entityType));
+    }
+
     [ConditionalFact]
     public void Index_on_base_type_should_be_inherited()
     {
diff --git a/test/EFCore.Tests/Metadata/Internal/EntityTypeTest.cs b/test/EFCore.Tests/Metadata/Internal/EntityTypeTest.cs
index 349286f145..d122d420fc 100644
--- a/test/EFCore.Tests/Metadata/Internal/EntityTypeTest.cs
+++ b/test/EFCore.Tests/Metadata/Internal/EntityTypeTest.cs
@@ -125,6 +125,16 @@ public void Name_is_prettified_CLR_full_name()
             CreateModel().AddEntityType(typeof(List<Customer>)).Name);
     }
 
+    [ConditionalFact]
+    public void Can_get_proper_table_name_for_generic_entityType()
+    {
+        var entityType = CreateEmptyModel().AddEntityType(typeof(A<int>));
+
+        Assert.Equal(
+            "A<int>",
+            entityType.DisplayName());
+    }
+
     [ConditionalFact]
     public void Invalid_filter_expressions_throws()
     {
@@ -370,21 +380,6 @@ public void Adding_a_key_throws_if_same_as_primary()
             Assert.Throws<InvalidOperationException>(() => entityType.AddKey(new[] { idProperty, nameProperty })).Message);
     }
 
-    [ConditionalFact]
-    public void Can_add_a_key_if_any_properties_are_part_of_derived_foreign_key()
-    {
-        var model = CreateModel();
-        var baseType = model.AddEntityType(typeof(BaseType));
-        var idProperty = baseType.AddProperty(Customer.IdProperty);
-        var fkProperty = baseType.AddProperty("fk", typeof(int));
-        var key = baseType.AddKey(new[] { idProperty });
-        var entityType = model.AddEntityType(typeof(Customer));
-        entityType.BaseType = baseType;
-        entityType.AddForeignKey(new[] { fkProperty }, key, entityType);
-
-        Assert.NotNull(baseType.AddKey(new[] { fkProperty }));
-    }
-
     [ConditionalFact]
     public void Can_remove_keys()
     {
@@ -605,30 +600,6 @@ public void Can_add_a_foreign_key_targeting_different_key()
         Assert.Equal(new[] { fk2, fk1 }, orderType.GetForeignKeys().ToArray());
     }
 
-    [ConditionalFact]
-    public void Can_add_a_foreign_key_targeting_different_entity_type()
-    {
-        var model = CreateModel();
-        var baseType = model.AddEntityType(typeof(BaseType));
-        var customerType = model.AddEntityType(typeof(Customer));
-        customerType.BaseType = baseType;
-        var customerKey1 = baseType.AddKey(baseType.AddProperty(Customer.IdProperty));
-        var orderType = model.AddEntityType(typeof(Order));
-        var customerFkProperty = orderType.AddProperty(Order.CustomerIdProperty);
-
-        var fk1 = orderType.AddForeignKey(customerFkProperty, customerKey1, baseType);
-
-        Assert.NotNull(fk1);
-        Assert.Same(fk1, orderType.FindForeignKeys(customerFkProperty).Single());
-        Assert.Same(fk1, orderType.FindForeignKey(customerFkProperty, customerKey1, baseType));
-        Assert.Same(fk1, orderType.GetForeignKeys().Single());
-
-        var fk2 = orderType.AddForeignKey(customerFkProperty, customerKey1, customerType);
-
-        Assert.Equal(2, orderType.FindForeignKeys(customerFkProperty).Count());
-        Assert.Same(fk2, orderType.FindForeignKey(customerFkProperty, customerKey1, customerType));
-        Assert.Equal(new[] { fk1, fk2 }, orderType.GetForeignKeys().ToArray());
-    }
 
     [ConditionalFact]
     public void Adding_a_foreign_key_throws_if_duplicate()
@@ -702,37 +673,6 @@ public void Adding_a_foreign_key_throws_if_properties_were_removed()
             Assert.Throws<InvalidOperationException>(() => entityType.AddForeignKey(new[] { fkProperty }, key, entityType)).Message);
     }
 
-    [ConditionalFact]
-    public void Can_add_a_foreign_key_if_any_properties_are_part_of_inherited_key()
-    {
-        var model = CreateModel();
-        var baseType = model.AddEntityType(typeof(BaseType));
-        var idProperty = baseType.AddProperty(Customer.IdProperty);
-        var idProperty2 = baseType.AddProperty("id2", typeof(int));
-        var key = baseType.AddKey(new[] { idProperty, idProperty2 });
-        var entityType = model.AddEntityType(typeof(Customer));
-        entityType.BaseType = baseType;
-        var fkProperty = entityType.AddProperty("fk", typeof(int));
-
-        Assert.NotNull(entityType.AddForeignKey(new[] { fkProperty, idProperty }, key, entityType));
-    }
-
-    [ConditionalFact]
-    public void Can_add_a_foreign_key_if_any_properties_are_part_of_inherited_key_with_value_generation()
-    {
-        var model = CreateModel();
-        var baseType = model.AddEntityType(typeof(BaseType));
-        var idProperty = baseType.AddProperty(Customer.IdProperty);
-        idProperty.ValueGenerated = ValueGenerated.OnAdd;
-        var idProperty2 = baseType.AddProperty("id2", typeof(int));
-        var key = baseType.AddKey(new[] { idProperty, idProperty2 });
-        var entityType = model.AddEntityType(typeof(Customer));
-        entityType.BaseType = baseType;
-        var fkProperty = entityType.AddProperty("fk", typeof(int));
-
-        Assert.NotNull(entityType.AddForeignKey(new[] { fkProperty, idProperty }, key, entityType));
-    }
-
     [ConditionalFact]
     public void Adding_a_foreign_key_throws_if_key_was_removed()
     {
@@ -905,6 +845,17 @@ public void Foreign_keys_are_ordered_by_property_count_then_property_names()
         Assert.True(new[] { fk1, fk2, fk3, fk4 }.SequenceEqual(orderType.GetForeignKeys()));
     }
 
+    [ConditionalFact]
+    public void Can_get_referencing_foreign_keys()
+    {
+        var entityType = CreateEmptyModel().AddEntityType("Customer");
+        var idProperty = entityType.AddProperty("id", typeof(int));
+        var fkProperty = entityType.AddProperty("fk", typeof(int));
+        var fk = entityType.AddForeignKey(fkProperty, entityType.SetPrimaryKey(idProperty), entityType);
+
+        Assert.Same(fk, entityType.GetReferencingForeignKeys().Single());
+    }
+
     [ConditionalFact]
     public void Can_add_and_remove_navigations()
     {
@@ -1235,6 +1186,123 @@ public void Navigations_are_ordered_by_name()
         Assert.True(new[] { navigation1, navigation2 }.SequenceEqual(((IReadOnlyEntityType)customerType).GetNavigations()));
     }
 
+    [ConditionalFact]
+    public void Can_get_one_to_many_inverses()
+    {
+        var model = BuildProductModel();
+
+        var category = model.FindEntityType(typeof(Product)).GetNavigations().Single(e => e.Name == "Category");
+        var products = model.FindEntityType(typeof(Category)).GetNavigations().Single(e => e.Name == "Products");
+
+        Assert.Same(category, products.Inverse);
+        Assert.Same(products, category.Inverse);
+    }
+
+    [ConditionalFact]
+    public void Can_get_one_to_one_inverses()
+    {
+        var model = BuildProductModel();
+
+        var category = model.FindEntityType(typeof(Product)).GetNavigations().Single(e => e.Name == "FeaturedProductCategory");
+        var product = model.FindEntityType(typeof(Category)).GetNavigations().Single(e => e.Name == "FeaturedProduct");
+
+        Assert.Same(category, product.Inverse);
+        Assert.Same(product, category.Inverse);
+    }
+
+    [ConditionalFact]
+    public void Can_get_target_ends()
+    {
+        var model = BuildProductModel();
+
+        var productType = model.FindEntityType(typeof(Product));
+        var categoryType = model.FindEntityType(typeof(Category));
+
+        var category = productType.GetNavigations().Single(e => e.Name == "Category");
+        var products = categoryType.GetNavigations().Single(e => e.Name == "Products");
+
+        Assert.Same(productType, products.TargetEntityType);
+        Assert.Same(categoryType, category.TargetEntityType);
+    }
+
+    [ConditionalFact]
+    public void Returns_null_when_no_inverse()
+    {
+        var products = BuildProductModel(createCategory: false).FindEntityType(typeof(Category)).GetNavigations()
+            .Single(e => e.Name == "Products");
+
+        Assert.Null(products.Inverse);
+
+        var category = BuildProductModel(createProducts: false).FindEntityType(typeof(Product)).GetNavigations()
+            .Single(e => e.Name == "Category");
+
+        Assert.Null(category.Inverse);
+
+        var featuredCategory = BuildProductModel(createFeaturedProduct: false).FindEntityType(typeof(Product)).GetNavigations()
+            .Single(e => e.Name == "FeaturedProductCategory");
+
+        Assert.Null(featuredCategory.Inverse);
+
+        var featuredProduct = BuildProductModel(createFeaturedProductCategory: false).FindEntityType(typeof(Category)).GetNavigations()
+            .Single(e => e.Name == "FeaturedProduct");
+
+        Assert.Null(featuredProduct.Inverse);
+    }
+
+    private static IReadOnlyModel BuildProductModel(
+        bool createProducts = true,
+        bool createCategory = true,
+        bool createFeaturedProductCategory = true,
+        bool createFeaturedProduct = true)
+    {
+        var builder = InMemoryTestHelpers.Instance.CreateConventionBuilder();
+        var model = builder.Model;
+
+        builder.Entity<Product>(
+            e =>
+            {
+                e.Ignore(p => p.Category);
+                e.Ignore(p => p.FeaturedProductCategory);
+            });
+        builder.Entity<Category>(
+            e =>
+            {
+                e.Ignore(c => c.Products);
+                e.Ignore(c => c.FeaturedProduct);
+            });
+
+        var categoryType = model.FindEntityType(typeof(Category));
+        var productType = model.FindEntityType(typeof(Product));
+
+        var categoryFk = productType.AddForeignKey(
+            productType.FindProperty("CategoryId"), categoryType.FindPrimaryKey(), categoryType);
+        var featuredProductFk = categoryType.AddForeignKey(
+            categoryType.FindProperty("FeaturedProductId"), productType.FindPrimaryKey(), productType);
+        featuredProductFk.IsUnique = true;
+
+        if (createProducts)
+        {
+            categoryFk.SetPrincipalToDependent(Category.ProductsProperty);
+        }
+
+        if (createCategory)
+        {
+            categoryFk.SetDependentToPrincipal(Product.CategoryProperty);
+        }
+
+        if (createFeaturedProductCategory)
+        {
+            featuredProductFk.SetPrincipalToDependent(Product.FeaturedProductCategoryProperty);
+        }
+
+        if (createFeaturedProduct)
+        {
+            featuredProductFk.SetDependentToPrincipal(Category.FeaturedProductProperty);
+        }
+
+        return model;
+    }
+
     [ConditionalFact]
     public void Can_add_and_remove_skip_navigation()
     {
@@ -1759,7 +1827,7 @@ private class HiddenField : HiddenFieldBase
         public int Id { get; set; }
     }
 
-    public class HiddenFieldBase
+    private class HiddenFieldBase
     {
         public static readonly FieldInfo DateField
             = typeof(HiddenFieldBase).GetRuntimeFields().Single(f => f.Name == nameof(_date));
@@ -1948,23 +2016,6 @@ public void Composite_primary_key_properties_are_listed_in_key_order()
         Assert.Equal(new[] { pkProperty1, pkProperty2, aProperty }, entityType.GetProperties());
     }
 
-    [ConditionalFact]
-    public void Properties_on_base_type_are_listed_before_derived_properties()
-    {
-        var model = CreateModel();
-
-        var parentType = model.AddEntityType("Parent");
-        var property2 = parentType.AddProperty("D", typeof(int));
-        var property1 = parentType.AddProperty("C", typeof(int));
-
-        var childType = model.AddEntityType("Child");
-        var property4 = childType.AddProperty("B", typeof(int));
-        var property3 = childType.AddProperty("A", typeof(int));
-        childType.BaseType = parentType;
-
-        Assert.Equal(new[] { property1, property2, property3, property4 }, childType.GetProperties());
-    }
-
     [ConditionalFact]
     public void Properties_are_properly_ordered_when_primary_key_changes()
     {
@@ -2400,6 +2451,23 @@ protected internal override void OnModelCreating(ModelBuilder modelBuilder)
         }
     }
 
+    [ConditionalFact]
+    public void Can_get_all_properties_and_navigations()
+    {
+        var entityType = CreateEmptyModel().AddEntityType(nameof(SelfRef));
+        var pk = entityType.SetPrimaryKey(entityType.AddProperty(nameof(SelfRef.Id), typeof(int)));
+        var fkProp = entityType.AddProperty(nameof(SelfRef.SelfRefId), typeof(int?));
+
+        var fk = entityType.AddForeignKey(new[] { fkProp }, pk, entityType);
+        fk.IsUnique = true;
+        var dependentToPrincipal = fk.SetDependentToPrincipal(nameof(SelfRef.SelfRef2));
+        var principalToDependent = fk.SetPrincipalToDependent(nameof(SelfRef.SelfRef1));
+
+        Assert.Equal(
+            new IReadOnlyPropertyBase[] { pk.Properties.Single(), fkProp, principalToDependent, dependentToPrincipal },
+            ((IRuntimeEntityType)entityType).GetSnapshottableMembers().ToArray());
+    }
+
     [ConditionalFact]
     public void Indexes_for_owned_collection_types_are_calculated_correctly()
     {
@@ -2627,21 +2695,6 @@ public void Change_tracking_can_be_set_to_snapshot_only_for_non_notifying_entiti
                 .Message);
     }
 
-    [ConditionalFact]
-    public void Setting_base_type_for_owned_throws()
-    {
-        var model = CreateModel();
-        var baseType = model.AddEntityType(typeof(BaseType));
-        var entityType = model.AddOwnedEntityType(typeof(Customer));
-
-        Assert.Equal(
-            CoreStrings.DerivedEntityOwnershipMismatch(
-                nameof(BaseType), nameof(Customer), nameof(Customer), nameof(BaseType)),
-            Assert.Throws<InvalidOperationException>(
-                    () => entityType.BaseType = baseType)
-                .Message);
-    }
-
     [ConditionalFact]
     public void Entity_type_with_deeply_nested_owned_shared_types_builds_correctly()
     {
@@ -3165,11 +3218,34 @@ private class OrderProduct
         public virtual Product Product { get; set; }
     }
 
+    private class Category
+    {
+        public static readonly PropertyInfo ProductsProperty = typeof(Category).GetProperty(nameof(Products));
+        public static readonly PropertyInfo FeaturedProductProperty = typeof(Category).GetProperty(nameof(FeaturedProduct));
+
+        public int Id { get; set; }
+
+        public int FeaturedProductId { get; set; }
+        public Product FeaturedProduct { get; set; }
+
+        public ICollection<Product> Products { get; set; }
+    }
+
     private class Product
     {
+        public static readonly PropertyInfo CategoryProperty = typeof(Product).GetProperty(nameof(Category));
         public static readonly PropertyInfo IdProperty = typeof(Product).GetProperty(nameof(Id));
 
+        public static readonly PropertyInfo FeaturedProductCategoryProperty =
+            typeof(Product).GetProperty(nameof(FeaturedProductCategory));
+
         public int Id { get; set; }
+
+        public Category FeaturedProductCategory { get; set; }
+
+        public int CategoryId { get; set; }
+        public Category Category { get; set; }
+
         public virtual ICollection<Order> Orders { get; set; }
     }
 
@@ -3239,10 +3315,18 @@ private class SelfRef
         public static readonly PropertyInfo ForeignKeyProperty = typeof(SelfRef).GetProperty("ForeignKey");
         public static readonly PropertyInfo SelfRef1Property = typeof(SelfRef).GetProperty(nameof(SelfRef1));
         public static readonly PropertyInfo SelfRef2Property = typeof(SelfRef).GetProperty(nameof(SelfRef2));
+        public static readonly PropertyInfo SelfRefIdProperty = typeof(SelfRef).GetProperty("SelfRefId");
 
         public int Id { get; set; }
         public SelfRef SelfRef1 { get; set; }
         public SelfRef SelfRef2 { get; set; }
+        public int? SelfRefId { get; set; }
         public int ForeignKey { get; set; }
     }
+    private static IMutableModel CreateEmptyModel()
+        => new Model();
+
+    private class A<T>
+    {
+    }
 }
diff --git a/test/EFCore.Tests/Metadata/NavigationExtensionsTest.cs b/test/EFCore.Tests/Metadata/NavigationExtensionsTest.cs
deleted file mode 100644
index 1d9bf9900c..0000000000
--- a/test/EFCore.Tests/Metadata/NavigationExtensionsTest.cs
+++ /dev/null
@@ -1,152 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-namespace Microsoft.EntityFrameworkCore.Metadata;
-
-public class NavigationExtensionsTest
-{
-    [ConditionalFact]
-    public void Can_get_one_to_many_inverses()
-    {
-        var model = BuildModel();
-
-        var category = model.FindEntityType(typeof(Product)).GetNavigations().Single(e => e.Name == "Category");
-        var products = model.FindEntityType(typeof(Category)).GetNavigations().Single(e => e.Name == "Products");
-
-        Assert.Same(category, products.Inverse);
-        Assert.Same(products, category.Inverse);
-    }
-
-    [ConditionalFact]
-    public void Can_get_one_to_one_inverses()
-    {
-        var model = BuildModel();
-
-        var category = model.FindEntityType(typeof(Product)).GetNavigations().Single(e => e.Name == "FeaturedProductCategory");
-        var product = model.FindEntityType(typeof(Category)).GetNavigations().Single(e => e.Name == "FeaturedProduct");
-
-        Assert.Same(category, product.Inverse);
-        Assert.Same(product, category.Inverse);
-    }
-
-    [ConditionalFact]
-    public void Can_get_target_ends()
-    {
-        var model = BuildModel();
-
-        var productType = model.FindEntityType(typeof(Product));
-        var categoryType = model.FindEntityType(typeof(Category));
-
-        var category = productType.GetNavigations().Single(e => e.Name == "Category");
-        var products = categoryType.GetNavigations().Single(e => e.Name == "Products");
-
-        Assert.Same(productType, products.TargetEntityType);
-        Assert.Same(categoryType, category.TargetEntityType);
-    }
-
-    [ConditionalFact]
-    public void Returns_null_when_no_inverse()
-    {
-        var products = BuildModel(createCategory: false).FindEntityType(typeof(Category)).GetNavigations()
-            .Single(e => e.Name == "Products");
-
-        Assert.Null(products.Inverse);
-
-        var category = BuildModel(createProducts: false).FindEntityType(typeof(Product)).GetNavigations()
-            .Single(e => e.Name == "Category");
-
-        Assert.Null(category.Inverse);
-
-        var featuredCategory = BuildModel(createFeaturedProduct: false).FindEntityType(typeof(Product)).GetNavigations()
-            .Single(e => e.Name == "FeaturedProductCategory");
-
-        Assert.Null(featuredCategory.Inverse);
-
-        var featuredProduct = BuildModel(createFeaturedProductCategory: false).FindEntityType(typeof(Category)).GetNavigations()
-            .Single(e => e.Name == "FeaturedProduct");
-
-        Assert.Null(featuredProduct.Inverse);
-    }
-
-    private class Category
-    {
-        public static readonly PropertyInfo ProductsProperty = typeof(Category).GetProperty(nameof(Products));
-        public static readonly PropertyInfo FeaturedProductProperty = typeof(Category).GetProperty(nameof(FeaturedProduct));
-
-        public int Id { get; set; }
-
-        public int FeaturedProductId { get; set; }
-        public Product FeaturedProduct { get; set; }
-
-        public ICollection<Product> Products { get; set; }
-    }
-
-    private class Product
-    {
-        public static readonly PropertyInfo CategoryProperty = typeof(Product).GetProperty(nameof(Category));
-
-        public static readonly PropertyInfo FeaturedProductCategoryProperty =
-            typeof(Product).GetProperty(nameof(FeaturedProductCategory));
-
-        public int Id { get; set; }
-
-        public Category FeaturedProductCategory { get; set; }
-
-        public int CategoryId { get; set; }
-        public Category Category { get; set; }
-    }
-
-    private static IReadOnlyModel BuildModel(
-        bool createProducts = true,
-        bool createCategory = true,
-        bool createFeaturedProductCategory = true,
-        bool createFeaturedProduct = true)
-    {
-        var builder = InMemoryTestHelpers.Instance.CreateConventionBuilder();
-        var model = builder.Model;
-
-        builder.Entity<Product>(
-            e =>
-            {
-                e.Ignore(p => p.Category);
-                e.Ignore(p => p.FeaturedProductCategory);
-            });
-        builder.Entity<Category>(
-            e =>
-            {
-                e.Ignore(c => c.Products);
-                e.Ignore(c => c.FeaturedProduct);
-            });
-
-        var categoryType = model.FindEntityType(typeof(Category));
-        var productType = model.FindEntityType(typeof(Product));
-
-        var categoryFk = productType.AddForeignKey(
-            productType.FindProperty("CategoryId"), categoryType.FindPrimaryKey(), categoryType);
-        var featuredProductFk = categoryType.AddForeignKey(
-            categoryType.FindProperty("FeaturedProductId"), productType.FindPrimaryKey(), productType);
-        featuredProductFk.IsUnique = true;
-
-        if (createProducts)
-        {
-            categoryFk.SetPrincipalToDependent(Category.ProductsProperty);
-        }
-
-        if (createCategory)
-        {
-            categoryFk.SetDependentToPrincipal(Product.CategoryProperty);
-        }
-
-        if (createFeaturedProductCategory)
-        {
-            featuredProductFk.SetPrincipalToDependent(Product.FeaturedProductCategoryProperty);
-        }
-
-        if (createFeaturedProduct)
-        {
-            featuredProductFk.SetDependentToPrincipal(Category.FeaturedProductProperty);
-        }
-
-        return model;
-    }
-}
diff --git a/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericRelationshipStringTest.cs b/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericRelationshipStringTest.cs
index 8cf02430aa..c2e0d7a609 100644
--- a/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericRelationshipStringTest.cs
+++ b/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericRelationshipStringTest.cs
@@ -69,7 +69,7 @@ public GenericOwnedTypesString(ModelBuilderFixtureBase fixture)
             => new GenericStringTestModelBuilder(testHelpers, configure);
     }
 
-    private class GenericStringTestModelBuilder : TestModelBuilder
+    public class GenericStringTestModelBuilder : TestModelBuilder
     {
         public GenericStringTestModelBuilder(TestHelpers testHelpers, Action<ModelConfigurationBuilder>? configure)
             : base(testHelpers, configure)
@@ -112,7 +112,7 @@ public override string GetDisplayName(Type entityType)
             => entityType.FullName!;
     }
 
-    private class GenericStringTestEntityTypeBuilder<TEntity> : GenericTestEntityTypeBuilder<TEntity>
+    protected class GenericStringTestEntityTypeBuilder<TEntity> : GenericTestEntityTypeBuilder<TEntity>
         where TEntity : class
     {
         public GenericStringTestEntityTypeBuilder(EntityTypeBuilder<TEntity> entityTypeBuilder)
@@ -168,7 +168,7 @@ protected override TestEntityTypeBuilder<TEntity> Wrap(EntityTypeBuilder<TEntity
                     navigationExpression?.GetMemberAccess().GetSimpleMemberName()));
     }
 
-    private class GenericStringTestReferenceNavigationBuilder<TEntity, TRelatedEntity> :
+    protected class GenericStringTestReferenceNavigationBuilder<TEntity, TRelatedEntity> :
         GenericTestReferenceNavigationBuilder<TEntity, TRelatedEntity>
         where TEntity : class
         where TRelatedEntity : class
@@ -192,7 +192,7 @@ private class GenericStringTestReferenceNavigationBuilder<TEntity, TRelatedEntit
                     navigationExpression?.GetMemberAccess().GetSimpleMemberName()));
     }
 
-    private class GenericStringTestCollectionNavigationBuilder<TEntity, TRelatedEntity>
+    protected class GenericStringTestCollectionNavigationBuilder<TEntity, TRelatedEntity>
         : GenericTestCollectionNavigationBuilder<TEntity, TRelatedEntity>
         where TEntity : class
         where TRelatedEntity : class
@@ -216,7 +216,7 @@ private class GenericStringTestCollectionNavigationBuilder<TEntity, TRelatedEnti
                     navigationExpression.GetMemberAccess().GetSimpleMemberName()));
     }
 
-    private class GenericStringTestReferenceCollectionBuilder<TEntity, TRelatedEntity>
+    protected class GenericStringTestReferenceCollectionBuilder<TEntity, TRelatedEntity>
         : GenericTestReferenceCollectionBuilder<TEntity, TRelatedEntity>
         where TEntity : class
         where TRelatedEntity : class
@@ -244,7 +244,7 @@ private class GenericStringTestReferenceCollectionBuilder<TEntity, TRelatedEntit
                     keyExpression.GetMemberAccessList().Select(p => p.GetSimpleMemberName()).ToArray()));
     }
 
-    private class GenericStringTestReferenceReferenceBuilder<TEntity, TRelatedEntity>
+    protected class GenericStringTestReferenceReferenceBuilder<TEntity, TRelatedEntity>
         : GenericTestReferenceReferenceBuilder<TEntity, TRelatedEntity>
         where TEntity : class
         where TRelatedEntity : class
@@ -285,7 +285,7 @@ public GenericStringTestReferenceReferenceBuilder(ReferenceReferenceBuilder<TEnt
                     typeof(TPrincipalEntity).FullName!, keyPropertyNames));
     }
 
-    private class GenericStringTestCollectionCollectionBuilder<TLeftEntity, TRightEntity> :
+    protected class GenericStringTestCollectionCollectionBuilder<TLeftEntity, TRightEntity> :
         GenericTestCollectionCollectionBuilder<TLeftEntity, TRightEntity>
         where TLeftEntity : class
         where TRightEntity : class
@@ -297,7 +297,7 @@ private class GenericStringTestCollectionCollectionBuilder<TLeftEntity, TRightEn
         }
     }
 
-    private class GenericStringTestOwnedNavigationBuilder<TEntity, TDependentEntity>
+    protected class GenericStringTestOwnedNavigationBuilder<TEntity, TDependentEntity>
         : GenericTestOwnedNavigationBuilder<TEntity, TDependentEntity>
         where TEntity : class
         where TDependentEntity : class
diff --git a/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericRelationshipTypeTest.cs b/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericRelationshipTypeTest.cs
index ad9e217b3c..9da8322f71 100644
--- a/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericRelationshipTypeTest.cs
+++ b/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericRelationshipTypeTest.cs
@@ -33,7 +33,7 @@ public GenericNonRelationshipTest(ModelBuilderFixtureBase fixture)
             => new GenericTypeTestModelBuilder(testHelpers, configure);
     }
 
-    private class GenericTypeTestModelBuilder : TestModelBuilder
+    public class GenericTypeTestModelBuilder : TestModelBuilder
     {
         public GenericTypeTestModelBuilder(TestHelpers testHelpers, Action<ModelConfigurationBuilder>? configure)
             : base(testHelpers, configure)
@@ -73,7 +73,7 @@ public override TestModelBuilder Ignore<TEntity>()
         }
     }
 
-    private class GenericTypeTestEntityTypeBuilder<TEntity> : GenericTestEntityTypeBuilder<TEntity>
+    protected class GenericTypeTestEntityTypeBuilder<TEntity> : GenericTestEntityTypeBuilder<TEntity>
         where TEntity : class
     {
         public GenericTypeTestEntityTypeBuilder(EntityTypeBuilder<TEntity> entityTypeBuilder)
@@ -113,7 +113,7 @@ protected override TestPropertyBuilder<TProperty> Wrap<TProperty>(PropertyBuilde
             => new GenericTypeTestCollectionNavigationBuilder<TEntity, TRelatedEntity>(EntityTypeBuilder.HasMany(navigationExpression));
     }
 
-    private class GenericTypeTestPropertyBuilder<TProperty> : GenericTestPropertyBuilder<TProperty>
+    protected class GenericTypeTestPropertyBuilder<TProperty> : GenericTestPropertyBuilder<TProperty>
     {
         public GenericTypeTestPropertyBuilder(PropertyBuilder<TProperty> propertyBuilder)
             : base(propertyBuilder)
@@ -141,7 +141,7 @@ public override TestPropertyBuilder<TProperty> HasConversion<TProvider>(ValueCom
             => Wrap(PropertyBuilder.HasConversion(typeof(TConverter), typeof(TComparer), typeof(TProviderComparer)));
     }
 
-    private class GenericTypeTestReferenceNavigationBuilder<TEntity, TRelatedEntity> : GenericTestReferenceNavigationBuilder<TEntity,
+    protected class GenericTypeTestReferenceNavigationBuilder<TEntity, TRelatedEntity> : GenericTestReferenceNavigationBuilder<TEntity,
         TRelatedEntity>
         where TEntity : class
         where TRelatedEntity : class
@@ -174,7 +174,7 @@ protected class GenericTypeTestCollectionNavigationBuilder<TEntity, TRelatedEnti
                 CollectionNavigationBuilder.WithMany(navigationExpression));
     }
 
-    private class GenericTypeTestReferenceReferenceBuilder<TEntity, TRelatedEntity>
+    protected class GenericTypeTestReferenceReferenceBuilder<TEntity, TRelatedEntity>
         : GenericTestReferenceReferenceBuilder<TEntity, TRelatedEntity>
         where TEntity : class
         where TRelatedEntity : class
@@ -327,7 +327,7 @@ public override TestEntityTypeBuilder<TJoinEntity> UsingEntity<TJoinEntity>()
                         new GenericTypeTestEntityTypeBuilder<TJoinEntity>(new EntityTypeBuilder<TJoinEntity>(e.Metadata)))));
     }
 
-    private class GenericTypeTestOwnedNavigationBuilder<TEntity, TRelatedEntity>
+    protected class GenericTypeTestOwnedNavigationBuilder<TEntity, TRelatedEntity>
         : GenericTestOwnedNavigationBuilder<TEntity, TRelatedEntity>
         where TEntity : class
         where TRelatedEntity : class
diff --git a/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericTest.cs b/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericTest.cs
index 0024ac8eea..69a4093364 100644
--- a/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericTest.cs
+++ b/test/EFCore.Tests/ModelBuilding/ModelBuilderGenericTest.cs
@@ -1143,7 +1143,7 @@ public override TestKeyBuilder<TEntity> HasAnnotation(string annotation, object?
             => KeyBuilder;
     }
 
-    public class GenericTestIndexBuilder<TEntity> : TestIndexBuilder<TEntity>, IInfrastructure<IndexBuilder<TEntity>>
+    protected class GenericTestIndexBuilder<TEntity> : TestIndexBuilder<TEntity>, IInfrastructure<IndexBuilder<TEntity>>
     {
         public GenericTestIndexBuilder(IndexBuilder<TEntity> indexBuilder)
         {
diff --git a/test/EFCore.Tests/ModelBuilding/ModelBuilderNonGenericTest.cs b/test/EFCore.Tests/ModelBuilding/ModelBuilderNonGenericTest.cs
index 4f87fe4dbd..ddff44aca7 100644
--- a/test/EFCore.Tests/ModelBuilding/ModelBuilderNonGenericTest.cs
+++ b/test/EFCore.Tests/ModelBuilding/ModelBuilderNonGenericTest.cs
@@ -1258,7 +1258,7 @@ public override TestKeyBuilder<TEntity> HasAnnotation(string annotation, object?
             => KeyBuilder;
     }
 
-    public class NonGenericTestIndexBuilder<TEntity> : TestIndexBuilder<TEntity>, IInfrastructure<IndexBuilder>
+    protected class NonGenericTestIndexBuilder<TEntity> : TestIndexBuilder<TEntity>, IInfrastructure<IndexBuilder>
     {
         public NonGenericTestIndexBuilder(IndexBuilder indexBuilder)
         {
diff --git a/test/EFCore.Tests/ModelBuilding/ShadowEntityTypeTest.cs b/test/EFCore.Tests/ModelBuilding/PropertyBagEntityTypeTest.cs
similarity index 99%
rename from test/EFCore.Tests/ModelBuilding/ShadowEntityTypeTest.cs
rename to test/EFCore.Tests/ModelBuilding/PropertyBagEntityTypeTest.cs
index 2c7de7bc33..6664f4dd1e 100644
--- a/test/EFCore.Tests/ModelBuilding/ShadowEntityTypeTest.cs
+++ b/test/EFCore.Tests/ModelBuilding/PropertyBagEntityTypeTest.cs
@@ -5,7 +5,7 @@
 
 namespace Microsoft.EntityFrameworkCore.ModelBuilding;
 
-public class ShadowEntityTypeTest
+public class PropertyBagEntityTypeTest
 {
     [ConditionalFact]
     public virtual void Can_create_two_shadow_owned_types()
diff --git a/test/EFCore.Tests/Query/CompiledQueryTest.cs b/test/EFCore.Tests/Query/CompiledQueryTest.cs
deleted file mode 100644
index b781fe287c..0000000000
--- a/test/EFCore.Tests/Query/CompiledQueryTest.cs
+++ /dev/null
@@ -1,76 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-namespace Microsoft.EntityFrameworkCore.Query;
-
-public class CompiledQueryTest
-{
-    [ConditionalFact]
-    public void CompiledQuery_throws_when_used_with_different_models()
-    {
-        using var context1 = new SwitchContext();
-        using var context2 = new SwitchContext();
-
-        var query = EF.CompileQuery((SwitchContext c, Bar p1) => c.Foos.Where(e => e.Bars.Contains(p1)));
-
-        _ = query(context1, new Bar()).ToList();
-        _ = query(context1, new Bar()).ToList();
-
-        Assert.Equal(
-            CoreStrings.CompiledQueryDifferentModel("(c, p1) => c.Foos .Where(e => e.Bars.Contains(p1))"),
-            Assert.Throws<InvalidOperationException>(
-                    () => query(context2, new Bar()).ToList())
-                .Message.Replace("\r", "").Replace("\n", ""), ignoreWhiteSpaceDifferences: true);
-
-        _ = query(context1, new Bar()).ToList();
-    }
-
-    [ConditionalFact]
-    public async Task CompiledQueryAsync_throws_when_used_with_different_models()
-    {
-        using var context1 = new SwitchContext();
-        using var context2 = new SwitchContext();
-
-        var query = EF.CompileAsyncQuery((SwitchContext c) => c.Foos);
-
-        _ = await query(context1).ToListAsync();
-        _ = await query(context1).ToListAsync();
-
-        Assert.Equal(
-            CoreStrings.CompiledQueryDifferentModel("c => c.Foos"),
-            (await Assert.ThrowsAsync<InvalidOperationException>(
-                () => query(context2).ToListAsync())).Message);
-
-        _ = await query(context1).ToListAsync();
-    }
-
-    private class Foo
-    {
-        public int Id { get; set; }
-        public List<Bar> Bars { get; } = new();
-    }
-
-    private class Bar
-    {
-        public int Id { get; set; }
-    }
-
-    private class SwitchContext : DbContext
-    {
-        public DbSet<Foo> Foos
-            => Set<Foo>();
-
-        protected internal override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
-            => optionsBuilder
-                .UseInMemoryDatabase(nameof(SwitchContext))
-                .ReplaceService<IModelCacheKeyFactory, DegenerateCacheKeyFactory>();
-    }
-
-    private class DegenerateCacheKeyFactory : IModelCacheKeyFactory
-    {
-        private static int _value;
-
-        public object Create(DbContext context, bool designTime)
-            => _value++;
-    }
-}
diff --git a/test/EFCore.Tests/Metadata/Internal/EntityMaterializerSourceTest.cs b/test/EFCore.Tests/Query/EntityMaterializerSourceTest.cs
similarity index 99%
rename from test/EFCore.Tests/Metadata/Internal/EntityMaterializerSourceTest.cs
rename to test/EFCore.Tests/Query/EntityMaterializerSourceTest.cs
index 757f2278bb..cc0ae31260 100644
--- a/test/EFCore.Tests/Metadata/Internal/EntityMaterializerSourceTest.cs
+++ b/test/EFCore.Tests/Query/EntityMaterializerSourceTest.cs
@@ -2,6 +2,7 @@
 // The .NET Foundation licenses this file to you under the MIT license.
 
 using System.ComponentModel.DataAnnotations.Schema;
+using Microsoft.EntityFrameworkCore.Metadata.Internal;
 using Microsoft.EntityFrameworkCore.Query.Internal;
 
 // ReSharper disable UnusedMember.Local
@@ -10,7 +11,7 @@
 // ReSharper disable InconsistentNaming
 // ReSharper disable ConvertPropertyToExpressionBody
 // ReSharper disable ConvertToAutoProperty
-namespace Microsoft.EntityFrameworkCore.Metadata.Internal;
+namespace Microsoft.EntityFrameworkCore.Query;
 
 public class EntityMaterializerSourceTest
 {
diff --git a/test/EFCore.Tests/QueryProviderTest.cs b/test/EFCore.Tests/Query/QueryProviderTest.cs
similarity index 96%
rename from test/EFCore.Tests/QueryProviderTest.cs
rename to test/EFCore.Tests/Query/QueryProviderTest.cs
index 082278aa01..082ad4bf03 100644
--- a/test/EFCore.Tests/QueryProviderTest.cs
+++ b/test/EFCore.Tests/Query/QueryProviderTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore;
+namespace Microsoft.EntityFrameworkCore.Query;
 
 public class QueryProviderTest
 {
diff --git a/test/EFCore.Tests/Storage/BoolToStringConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/BoolToStringConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/BoolToStringConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/BoolToStringConverterTest.cs
index 849d0c8ef8..a3bf61c81f 100644
--- a/test/EFCore.Tests/Storage/BoolToStringConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/BoolToStringConverterTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class BoolToStringConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/BoolToZeroOneConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/BoolToZeroOneConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/BoolToZeroOneConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/BoolToZeroOneConverterTest.cs
index 521f09a63b..87a3a7a1b4 100644
--- a/test/EFCore.Tests/Storage/BoolToZeroOneConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/BoolToZeroOneConverterTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class BoolToZeroOneConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/BytesToStringConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/BytesToStringConverterTest.cs
similarity index 96%
rename from test/EFCore.Tests/Storage/BytesToStringConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/BytesToStringConverterTest.cs
index 9030a10a89..301941c769 100644
--- a/test/EFCore.Tests/Storage/BytesToStringConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/BytesToStringConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class BytesToStringConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/CharToStringConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/CharToStringConverterTest.cs
similarity index 96%
rename from test/EFCore.Tests/Storage/CharToStringConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/CharToStringConverterTest.cs
index 09d2a0959e..b3e37913ad 100644
--- a/test/EFCore.Tests/Storage/CharToStringConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/CharToStringConverterTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class CharToStringConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/DateOnlyConvertersTest.cs b/test/EFCore.Tests/Storage/ValueConversion/DateOnlyConvertersTest.cs
similarity index 96%
rename from test/EFCore.Tests/Storage/DateOnlyConvertersTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/DateOnlyConvertersTest.cs
index 533fb1503a..f635607c58 100644
--- a/test/EFCore.Tests/Storage/DateOnlyConvertersTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/DateOnlyConvertersTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class DateOnlyConvertersTest
 {
diff --git a/test/EFCore.Tests/Storage/DateTimeConvertersTest.cs b/test/EFCore.Tests/Storage/ValueConversion/DateTimeConvertersTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/DateTimeConvertersTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/DateTimeConvertersTest.cs
index efd35bf936..b446d725a4 100644
--- a/test/EFCore.Tests/Storage/DateTimeConvertersTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/DateTimeConvertersTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class DateTimeConvertersTest
 {
diff --git a/test/EFCore.Tests/Storage/DateTimeOffsetConvertersTest.cs b/test/EFCore.Tests/Storage/ValueConversion/DateTimeOffsetConvertersTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/DateTimeOffsetConvertersTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/DateTimeOffsetConvertersTest.cs
index 4d9b3d5d10..92f6f7eebf 100644
--- a/test/EFCore.Tests/Storage/DateTimeOffsetConvertersTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/DateTimeOffsetConvertersTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class DateTimeOffsetConvertersTest
 {
diff --git a/test/EFCore.Tests/Storage/EnumToNumberConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/EnumToNumberConverterTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/EnumToNumberConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/EnumToNumberConverterTest.cs
index 64a432cb1f..feb5c8908e 100644
--- a/test/EFCore.Tests/Storage/EnumToNumberConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/EnumToNumberConverterTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class EnumToNumberConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/EnumToStringConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/EnumToStringConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/EnumToStringConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/EnumToStringConverterTest.cs
index 49c117f367..d3a0b21565 100644
--- a/test/EFCore.Tests/Storage/EnumToStringConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/EnumToStringConverterTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class EnumToStringConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/GuidToBytesConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/GuidToBytesConverterTest.cs
similarity index 98%
rename from test/EFCore.Tests/Storage/GuidToBytesConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/GuidToBytesConverterTest.cs
index e3531c7bb7..16fd7282bd 100644
--- a/test/EFCore.Tests/Storage/GuidToBytesConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/GuidToBytesConverterTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class GuidToBytesConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/GuidToStringConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/GuidToStringConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/GuidToStringConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/GuidToStringConverterTest.cs
index 9370227595..59135f9264 100644
--- a/test/EFCore.Tests/Storage/GuidToStringConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/GuidToStringConverterTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class GuidToStringConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/IPAddressToBytesConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/IPAddressToBytesConverterTest.cs
similarity index 98%
rename from test/EFCore.Tests/Storage/IPAddressToBytesConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/IPAddressToBytesConverterTest.cs
index d180d098bb..4c894d3864 100644
--- a/test/EFCore.Tests/Storage/IPAddressToBytesConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/IPAddressToBytesConverterTest.cs
@@ -3,7 +3,7 @@
 
 using System.Net;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class IPAddressToBytesConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/IPAddressToStringConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/IPAddressToStringConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/IPAddressToStringConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/IPAddressToStringConverterTest.cs
index 24f1bfea38..d0550eb272 100644
--- a/test/EFCore.Tests/Storage/IPAddressToStringConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/IPAddressToStringConverterTest.cs
@@ -3,7 +3,7 @@
 
 using System.Net;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class IPAddressToStringConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/NumberToBytesConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/NumberToBytesConverterTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/NumberToBytesConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/NumberToBytesConverterTest.cs
index f2c7337497..b99f28c5a7 100644
--- a/test/EFCore.Tests/Storage/NumberToBytesConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/NumberToBytesConverterTest.cs
@@ -1,7 +1,7 @@
 // Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class NumberToBytesConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/NumberToStringConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/NumberToStringConverterTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/NumberToStringConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/NumberToStringConverterTest.cs
index 660abbd2cf..7753dbf1bb 100644
--- a/test/EFCore.Tests/Storage/NumberToStringConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/NumberToStringConverterTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class NumberToStringConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/PhysicalAddressToBytesConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/PhysicalAddressToBytesConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/PhysicalAddressToBytesConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/PhysicalAddressToBytesConverterTest.cs
index 9dae00b278..ea6151e613 100644
--- a/test/EFCore.Tests/Storage/PhysicalAddressToBytesConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/PhysicalAddressToBytesConverterTest.cs
@@ -3,7 +3,7 @@
 
 using System.Net.NetworkInformation;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class PhysicalAddressToBytesConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/PhysicalAddressToStringConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/PhysicalAddressToStringConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/PhysicalAddressToStringConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/PhysicalAddressToStringConverterTest.cs
index 32fefc9b4d..ee8c723670 100644
--- a/test/EFCore.Tests/Storage/PhysicalAddressToStringConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/PhysicalAddressToStringConverterTest.cs
@@ -4,7 +4,7 @@
 using System.Net.NetworkInformation;
 using System.Text.RegularExpressions;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class PhysicalAddressToStringConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToBoolConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToBoolConverterTest.cs
similarity index 95%
rename from test/EFCore.Tests/Storage/StringToBoolConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToBoolConverterTest.cs
index 69bbf16220..a8c390aef5 100644
--- a/test/EFCore.Tests/Storage/StringToBoolConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToBoolConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToBoolConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToBytesConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToBytesConverterTest.cs
similarity index 96%
rename from test/EFCore.Tests/Storage/StringToBytesConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToBytesConverterTest.cs
index 4702465476..70821abe3c 100644
--- a/test/EFCore.Tests/Storage/StringToBytesConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToBytesConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToBytesConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToCharConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToCharConverterTest.cs
similarity index 96%
rename from test/EFCore.Tests/Storage/StringToCharConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToCharConverterTest.cs
index 96e75d4955..fec2592863 100644
--- a/test/EFCore.Tests/Storage/StringToCharConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToCharConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToCharConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToDateTimeConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToDateTimeConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/StringToDateTimeConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToDateTimeConverterTest.cs
index d36d7a3dbd..17fd8922a6 100644
--- a/test/EFCore.Tests/Storage/StringToDateTimeConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToDateTimeConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToDateTimeConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToDateTimeOffsetConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToDateTimeOffsetConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/StringToDateTimeOffsetConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToDateTimeOffsetConverterTest.cs
index d7c39d7b6c..3969905784 100644
--- a/test/EFCore.Tests/Storage/StringToDateTimeOffsetConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToDateTimeOffsetConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToDateTimeOffsetConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToEnumConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToEnumConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/StringToEnumConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToEnumConverterTest.cs
index ecefb1e2a3..179691193b 100644
--- a/test/EFCore.Tests/Storage/StringToEnumConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToEnumConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToEnumConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToGuidConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToGuidConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/StringToGuidConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToGuidConverterTest.cs
index 58ac4b2543..8df340657a 100644
--- a/test/EFCore.Tests/Storage/StringToGuidConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToGuidConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToGuidConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToNumberConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToNumberConverterTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/StringToNumberConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToNumberConverterTest.cs
index c90ee48428..fdd28387ed 100644
--- a/test/EFCore.Tests/Storage/StringToNumberConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToNumberConverterTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToNumberConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToTimeSpanConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToTimeSpanConverterTest.cs
similarity index 96%
rename from test/EFCore.Tests/Storage/StringToTimeSpanConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToTimeSpanConverterTest.cs
index 92b8c49125..497b7b9400 100644
--- a/test/EFCore.Tests/Storage/StringToTimeSpanConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToTimeSpanConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToTimeSpanConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/StringToUriConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/StringToUriConverterTest.cs
similarity index 97%
rename from test/EFCore.Tests/Storage/StringToUriConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/StringToUriConverterTest.cs
index b3c8924350..e4affc21ac 100644
--- a/test/EFCore.Tests/Storage/StringToUriConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/StringToUriConverterTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class StringToUriConverterTest
 {
diff --git a/test/EFCore.Tests/Storage/TimeOnlyConvertersTest.cs b/test/EFCore.Tests/Storage/ValueConversion/TimeOnlyConvertersTest.cs
similarity index 98%
rename from test/EFCore.Tests/Storage/TimeOnlyConvertersTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/TimeOnlyConvertersTest.cs
index 4f3c25dc36..cc79391864 100644
--- a/test/EFCore.Tests/Storage/TimeOnlyConvertersTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/TimeOnlyConvertersTest.cs
@@ -1,7 +1,7 @@
 ﻿// Licensed to the .NET Foundation under one or more agreements.
 // The .NET Foundation licenses this file to you under the MIT license.
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class TimeOnlyConvertersTest
 {
diff --git a/test/EFCore.Tests/Storage/TimeSpanConvertersTest.cs b/test/EFCore.Tests/Storage/ValueConversion/TimeSpanConvertersTest.cs
similarity index 98%
rename from test/EFCore.Tests/Storage/TimeSpanConvertersTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/TimeSpanConvertersTest.cs
index 5b03107210..cc552f40da 100644
--- a/test/EFCore.Tests/Storage/TimeSpanConvertersTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/TimeSpanConvertersTest.cs
@@ -3,7 +3,7 @@
 
 using Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class TimeSpanConvertersTest
 {
diff --git a/test/EFCore.Tests/Storage/ValueConverterSelectorTest.cs b/test/EFCore.Tests/Storage/ValueConversion/ValueConverterSelectorTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/ValueConverterSelectorTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/ValueConverterSelectorTest.cs
index 5096b8d7f0..37a279afd0 100644
--- a/test/EFCore.Tests/Storage/ValueConverterSelectorTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/ValueConverterSelectorTest.cs
@@ -4,7 +4,7 @@
 using System.Net;
 using Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class ValueConverterSelectorTest
 {
diff --git a/test/EFCore.Tests/Storage/ValueConverterTest.cs b/test/EFCore.Tests/Storage/ValueConversion/ValueConverterTest.cs
similarity index 99%
rename from test/EFCore.Tests/Storage/ValueConverterTest.cs
rename to test/EFCore.Tests/Storage/ValueConversion/ValueConverterTest.cs
index 00ab7f98eb..2ac8800cc7 100644
--- a/test/EFCore.Tests/Storage/ValueConverterTest.cs
+++ b/test/EFCore.Tests/Storage/ValueConversion/ValueConverterTest.cs
@@ -4,7 +4,7 @@
 using System.Collections;
 using System.ComponentModel.DataAnnotations.Schema;
 
-namespace Microsoft.EntityFrameworkCore.Storage;
+namespace Microsoft.EntityFrameworkCore.Storage.ValueConversion;
 
 public class ValueConverterTest
 {
diff --git a/test/EFCore.Tests/Utilities/TypeNameHelperTest.cs b/test/EFCore.Tests/Utilities/TypeNameHelperTest.cs
deleted file mode 100644
index 19f95dd71c..0000000000
--- a/test/EFCore.Tests/Utilities/TypeNameHelperTest.cs
+++ /dev/null
@@ -1,227 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-// ReSharper disable InconsistentNaming
-
-namespace Microsoft.EntityFrameworkCore.Utilities;
-
-public class TypeNameHelperTest
-{
-    [ConditionalTheory]
-    // Predefined Types
-    [InlineData(typeof(int), "int")]
-    [InlineData(typeof(List<int>), "System.Collections.Generic.List<int>")]
-    [InlineData(typeof(Dictionary<int, string>), "System.Collections.Generic.Dictionary<int, string>")]
-    [InlineData(
-        typeof(Dictionary<int, List<string>>), "System.Collections.Generic.Dictionary<int, System.Collections.Generic.List<string>>")]
-    [InlineData(typeof(List<List<string>>), "System.Collections.Generic.List<System.Collections.Generic.List<string>>")]
-    // Classes inside NonGeneric class
-    [InlineData(
-        typeof(A),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+A")]
-    [InlineData(
-        typeof(B<int>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+B<int>")]
-    [InlineData(
-        typeof(C<int, string>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+C<int, string>")]
-    [InlineData(
-        typeof(B<B<string>>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+B<Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+B<string>>")]
-    [InlineData(
-        typeof(C<int, B<string>>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+C<int, Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+B<string>>")]
-    // Classes inside Generic class
-    [InlineData(
-        typeof(Outer<int>.D),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Outer<int>+D")]
-    [InlineData(
-        typeof(Outer<int>.E<int>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Outer<int>+E<int>")]
-    [InlineData(
-        typeof(Outer<int>.F<int, string>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Outer<int>+F<int, string>")]
-    [InlineData(
-        typeof(Level1<int>.Level2<bool>.Level3<int>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Level1<int>+Level2<bool>+Level3<int>")]
-    [InlineData(
-        typeof(Outer<int>.E<Outer<int>.E<string>>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Outer<int>+E<Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Outer<int>+E<string>>")]
-    [InlineData(
-        typeof(Outer<int>.F<int, Outer<int>.E<string>>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Outer<int>+F<int, Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Outer<int>+E<string>>")]
-    [InlineData(
-        typeof(OuterGeneric<int>.InnerNonGeneric.InnerGeneric<int, string>.InnerGenericLeafNode<bool>),
-        "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+OuterGeneric<int>+InnerNonGeneric+InnerGeneric<int, string>+InnerGenericLeafNode<bool>")]
-    public void Can_pretty_print_CLR_full_name(Type type, string expected)
-        => Assert.Equal(expected, type.DisplayName());
-
-    [ConditionalTheory]
-    // Predefined Types
-    [InlineData(typeof(int), "int")]
-    [InlineData(typeof(List<int>), "List<int>")]
-    [InlineData(typeof(Dictionary<int, string>), "Dictionary<int, string>")]
-    [InlineData(typeof(Dictionary<int, List<string>>), "Dictionary<int, List<string>>")]
-    [InlineData(typeof(List<List<string>>), "List<List<string>>")]
-    // Classes inside NonGeneric class
-    [InlineData(typeof(A), "A")]
-    [InlineData(typeof(B<int>), "B<int>")]
-    [InlineData(typeof(C<int, string>), "C<int, string>")]
-    [InlineData(typeof(C<int, B<string>>), "C<int, B<string>>")]
-    [InlineData(typeof(B<B<string>>), "B<B<string>>")]
-    // Classes inside Generic class
-    [InlineData(typeof(Outer<int>.D), "D")]
-    [InlineData(typeof(Outer<int>.E<int>), "E<int>")]
-    [InlineData(typeof(Outer<int>.F<int, string>), "F<int, string>")]
-    [InlineData(typeof(Outer<int>.F<int, Outer<int>.E<string>>), "F<int, E<string>>")]
-    [InlineData(typeof(Outer<int>.E<Outer<int>.E<string>>), "E<E<string>>")]
-    [InlineData(
-        typeof(OuterGeneric<int>.InnerNonGeneric.InnerGeneric<int, string>.InnerGenericLeafNode<bool>), "InnerGenericLeafNode<bool>")]
-    public void Can_pretty_print_CLR_name(Type type, string expected)
-        => Assert.Equal(expected, type.ShortDisplayName());
-
-    [ConditionalTheory]
-    [InlineData(typeof(bool), "bool")]
-    [InlineData(typeof(byte), "byte")]
-    [InlineData(typeof(char), "char")]
-    [InlineData(typeof(decimal), "decimal")]
-    [InlineData(typeof(double), "double")]
-    [InlineData(typeof(float), "float")]
-    [InlineData(typeof(int), "int")]
-    [InlineData(typeof(long), "long")]
-    [InlineData(typeof(object), "object")]
-    [InlineData(typeof(sbyte), "sbyte")]
-    [InlineData(typeof(short), "short")]
-    [InlineData(typeof(string), "string")]
-    [InlineData(typeof(uint), "uint")]
-    [InlineData(typeof(ulong), "ulong")]
-    [InlineData(typeof(ushort), "ushort")]
-    [InlineData(typeof(void), "void")]
-    public void Returns_common_name_for_built_in_types(Type type, string expected)
-        => Assert.Equal(expected, type.DisplayName());
-
-    [ConditionalTheory]
-    [InlineData(typeof(int[]), true, "int[]")]
-    [InlineData(typeof(string[][]), true, "string[][]")]
-    [InlineData(typeof(int[,]), true, "int[,]")]
-    [InlineData(typeof(bool[,,,]), true, "bool[,,,]")]
-    [InlineData(typeof(A[,][,,]), true, "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+A[,][,,]")]
-    [InlineData(typeof(List<int[,][,,]>), true, "System.Collections.Generic.List<int[,][,,]>")]
-    [InlineData(typeof(List<int[,,][,]>[,][,,]), false, "List<int[,,][,]>[,][,,]")]
-    public void Can_pretty_print_array_name(Type type, bool fullName, string expected)
-        => Assert.Equal(expected, type.DisplayName(fullName));
-
-    public static TheoryData OpenGenericsTestData { get; } = CreateOpenGenericsTestData();
-
-    public static TheoryData CreateOpenGenericsTestData()
-    {
-        var openDictionaryType = typeof(Dictionary<,>);
-        var genArgsDictionary = openDictionaryType.GetGenericArguments();
-        genArgsDictionary[0] = typeof(B<>);
-        var closedDictionaryType = openDictionaryType.MakeGenericType(genArgsDictionary);
-        var openLevelType = typeof(Level1<>.Level2<>.Level3<>);
-        var genArgsLevel = openLevelType.GetGenericArguments();
-        genArgsLevel[1] = typeof(string);
-        var closedLevelType = openLevelType.MakeGenericType(genArgsLevel);
-        var openInnerType = typeof(OuterGeneric<>.InnerNonGeneric.InnerGeneric<,>.InnerGenericLeafNode<>);
-        var genArgsInnerType = openInnerType.GetGenericArguments();
-        genArgsInnerType[3] = typeof(bool);
-        var closedInnerType = openInnerType.MakeGenericType(genArgsInnerType);
-        return new TheoryData<Type, bool, string>
-        {
-            { typeof(List<>), false, "List<>" },
-            { typeof(Dictionary<,>), false, "Dictionary<,>" },
-            { typeof(List<>), true, "System.Collections.Generic.List<>" },
-            { typeof(Dictionary<,>), true, "System.Collections.Generic.Dictionary<,>" },
-            {
-                typeof(Level1<>.Level2<>.Level3<>), true,
-                "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Level1<>+Level2<>+Level3<>"
-            },
-            { typeof(PartiallyClosedGeneric<>).BaseType, true, "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+C<, int>" },
-            {
-                typeof(OuterGeneric<>.InnerNonGeneric.InnerGeneric<,>.InnerGenericLeafNode<>), true,
-                "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+OuterGeneric<>+InnerNonGeneric+InnerGeneric<,>+InnerGenericLeafNode<>"
-            },
-            {
-                closedDictionaryType, true,
-                "System.Collections.Generic.Dictionary<Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+B<>,>"
-            },
-            { closedLevelType, true, "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+Level1<>+Level2<string>+Level3<>" },
-            {
-                closedInnerType, true,
-                "Microsoft.EntityFrameworkCore.Utilities.TypeNameHelperTest+OuterGeneric<>+InnerNonGeneric+InnerGeneric<,>+InnerGenericLeafNode<bool>"
-            }
-        };
-    }
-
-    [ConditionalFact]
-    public void Can_pretty_print_open_generics()
-    {
-        foreach (var testData in OpenGenericsTestData)
-        {
-            var type = (Type)testData[0];
-            var fullName = (bool)testData[1];
-            var expected = (string)testData[2];
-
-            Assert.Equal(expected, type.DisplayName(fullName));
-        }
-    }
-
-    private class A
-    {
-    }
-
-    private class B<T>
-    {
-    }
-
-    private class C<T1, T2>
-    {
-    }
-
-    private class PartiallyClosedGeneric<T> : C<T, int>
-    {
-    }
-
-    private static class Outer<T>
-    {
-        public class D
-        {
-        }
-
-        public class E<T1>
-        {
-        }
-
-        public class F<T1, T2>
-        {
-        }
-    }
-
-    private static class OuterGeneric<T1>
-    {
-        public static class InnerNonGeneric
-        {
-            public static class InnerGeneric<T2, T3>
-            {
-                public class InnerGenericLeafNode<T4>
-                {
-                }
-
-                public class InnerLeafNode
-                {
-                }
-            }
-        }
-    }
-
-    private static class Level1<T1>
-    {
-        public static class Level2<T2>
-        {
-            public class Level3<T3>
-            {
-            }
-        }
-    }
-}
diff --git a/test/EFCore.Tests/ValueGeneration/TemporaryDateTimeValueGeneratorTest.cs b/test/EFCore.Tests/ValueGeneration/TemporaryDateTimeValueGeneratorTest.cs
deleted file mode 100644
index 97982e17bf..0000000000
--- a/test/EFCore.Tests/ValueGeneration/TemporaryDateTimeValueGeneratorTest.cs
+++ /dev/null
@@ -1,4 +0,0 @@
-// Licensed to the .NET Foundation under one or more agreements.
-// The .NET Foundation licenses this file to you under the MIT license.
-
-namespace Microsoft.EntityFrameworkCore.ValueGeneration;
