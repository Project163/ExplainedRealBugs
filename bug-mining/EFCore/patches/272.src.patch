diff --git a/src/EFCore.Relational/Infrastructure/RelationalModelValidator.cs b/src/EFCore.Relational/Infrastructure/RelationalModelValidator.cs
index c31029f826..29ff5f59e1 100644
--- a/src/EFCore.Relational/Infrastructure/RelationalModelValidator.cs
+++ b/src/EFCore.Relational/Infrastructure/RelationalModelValidator.cs
@@ -1863,11 +1863,6 @@ private static bool IsIdentifyingPrincipal(IEntityType dependentEntityType, IEnt
                 continue;
             }
 
-            if (!entityType.GetDirectlyDerivedTypes().Any())
-            {
-                continue;
-            }
-
             // Hierarchy mapping strategy must be the same across all types of mappings
             if (entityType.FindDiscriminatorProperty() != null)
             {
@@ -1890,7 +1885,8 @@ private static bool IsIdentifyingPrincipal(IEntityType dependentEntityType, IEnt
             else
             {
                 if (mappingStrategy != RelationalAnnotationNames.TpcMappingStrategy
-                    && entityType.FindPrimaryKey() == null)
+                    && entityType.FindPrimaryKey() == null
+                    && entityType.GetDirectlyDerivedTypes().Any())
                 {
                     throw new InvalidOperationException(
                         RelationalStrings.KeylessMappingStrategy(
@@ -1907,12 +1903,13 @@ private static bool IsIdentifyingPrincipal(IEntityType dependentEntityType, IEnt
                 var discriminatorValues = new Dictionary<string, IEntityType>();
                 foreach (var derivedType in derivedTypes)
                 {
-                    if (!derivedType.ClrType.IsInstantiable())
+                    var discriminatorValue = derivedType.GetDiscriminatorValue();
+                    if (!derivedType.ClrType.IsInstantiable()
+                        || discriminatorValue is null)
                     {
                         continue;
                     }
 
-                    var discriminatorValue = derivedType.GetDiscriminatorValue();
                     if (discriminatorValue is not string valueString)
                     {
                         throw new InvalidOperationException(
diff --git a/src/EFCore.Relational/Query/RelationalSqlTranslatingExpressionVisitor.cs b/src/EFCore.Relational/Query/RelationalSqlTranslatingExpressionVisitor.cs
index eee0012ece..7850ba29b2 100644
--- a/src/EFCore.Relational/Query/RelationalSqlTranslatingExpressionVisitor.cs
+++ b/src/EFCore.Relational/Query/RelationalSqlTranslatingExpressionVisitor.cs
@@ -1112,7 +1112,7 @@ SqlExpression GeneratePredicateTpt(StructuralTypeProjectionExpression entityProj
                     return matchingCaseWhenClauses.Count == 1
                         ? matchingCaseWhenClauses[0].Test
                         : matchingCaseWhenClauses.Select(e => e.Test)
-                            .Aggregate((l, r) => _sqlExpressionFactory.OrElse(l, r));
+                            .Aggregate(_sqlExpressionFactory.OrElse);
                 }
 
                 return discriminatorValues.Count == 1
diff --git a/src/EFCore/Infrastructure/ModelValidator.cs b/src/EFCore/Infrastructure/ModelValidator.cs
index 3b09fa5880..c3335af2a1 100644
--- a/src/EFCore/Infrastructure/ModelValidator.cs
+++ b/src/EFCore/Infrastructure/ModelValidator.cs
@@ -631,14 +631,14 @@ var entityTypeWithNullPk
     protected virtual void ValidateDiscriminatorValues(IEntityType rootEntityType)
     {
         var derivedTypes = rootEntityType.GetDerivedTypesInclusive().ToList();
-        if (derivedTypes.Count == 1)
-        {
-            return;
-        }
-
         var discriminatorProperty = rootEntityType.FindDiscriminatorProperty();
         if (discriminatorProperty == null)
         {
+            if (derivedTypes.Count == 1)
+            {
+                return;
+            }
+
             throw new InvalidOperationException(
                 CoreStrings.NoDiscriminatorProperty(rootEntityType.DisplayName()));
         }
diff --git a/src/EFCore/Properties/CoreStrings.Designer.cs b/src/EFCore/Properties/CoreStrings.Designer.cs
index 7199f5b111..ecc04f5d3f 100644
--- a/src/EFCore/Properties/CoreStrings.Designer.cs
+++ b/src/EFCore/Properties/CoreStrings.Designer.cs
@@ -1960,7 +1960,7 @@ public static string NoDiscriminatorProperty(object? entityType)
                 entityType);
 
         /// <summary>
-        ///     The entity type '{entityType}' is part of a hierarchy, but does not have a discriminator value configured.
+        ///     The entity type '{entityType}' has a discriminator property, but does not have a discriminator value configured.
         /// </summary>
         public static string NoDiscriminatorValue(object? entityType)
             => string.Format(
diff --git a/src/EFCore/Properties/CoreStrings.resx b/src/EFCore/Properties/CoreStrings.resx
index 301e4d2476..ce54c42bab 100644
--- a/src/EFCore/Properties/CoreStrings.resx
+++ b/src/EFCore/Properties/CoreStrings.resx
@@ -1169,7 +1169,7 @@
     <value>The entity type '{entityType}' is part of a hierarchy, but does not have a discriminator property configured.</value>
   </data>
   <data name="NoDiscriminatorValue" xml:space="preserve">
-    <value>The entity type '{entityType}' is part of a hierarchy, but does not have a discriminator value configured.</value>
+    <value>The entity type '{entityType}' has a discriminator property, but does not have a discriminator value configured.</value>
   </data>
   <data name="NoEfServices" xml:space="preserve">
     <value>Entity Framework services have not been added to the internal service provider. Either remove the call to 'UseInternalServiceProvider' so that Entity Framework will manage its own internal services, or use the method from your database provider to add the required services to the service provider (e.g. 'AddEntityFrameworkSqlServer').</value>
diff --git a/test/EFCore.Cosmos.FunctionalTests/EmbeddedDocumentsTest.cs b/test/EFCore.Cosmos.FunctionalTests/EmbeddedDocumentsTest.cs
index bb02fe750a..eaa6a81215 100644
--- a/test/EFCore.Cosmos.FunctionalTests/EmbeddedDocumentsTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/EmbeddedDocumentsTest.cs
@@ -410,7 +410,6 @@ public virtual async Task Can_use_non_int_keys_for_embedded_entities()
                             b.Property<Guid>("Id");
                         }));
             },
-            additionalModelCacheKey: "Guid_key",
             seed: false);
 
         Address address;
@@ -602,18 +601,15 @@ protected override ITestStoreFactory TestStoreFactory
 
         public virtual CosmosTestStore TestStore { get; }
         private Action<ModelBuilder> OnModelCreatingAction { get; set; }
-        private object AdditionalModelCacheKey { get; set; }
 
         protected override void OnModelCreating(ModelBuilder modelBuilder, DbContext context)
             => OnModelCreatingAction?.Invoke(modelBuilder);
 
         public DbContextOptions CreateOptions(
             Action<ModelBuilder> onModelCreating = null,
-            object additionalModelCacheKey = null,
             bool seed = true)
         {
             OnModelCreatingAction = onModelCreating;
-            AdditionalModelCacheKey = additionalModelCacheKey;
             var options = CreateOptions(TestStore);
             TestStore.Initialize(
                 ServiceProvider, () => new EmbeddedTransportationContext(options), c =>
@@ -629,30 +625,16 @@ protected override void OnModelCreating(ModelBuilder modelBuilder, DbContext con
         }
 
         protected override IServiceCollection AddServices(IServiceCollection serviceCollection)
-            => base.AddServices(serviceCollection)
-                .AddSingleton<IModelCacheKeyFactory>(new TestModelCacheKeyFactory(() => AdditionalModelCacheKey));
+            => base.AddServices(serviceCollection);
+
+        protected override object GetAdditionalModelCacheKey(DbContext context)
+            => OnModelCreatingAction?.GetHashCode();
 
         public Task InitializeAsync()
             => Task.CompletedTask;
 
         public Task DisposeAsync()
             => TestStore.DisposeAsync();
-
-        private class TestModelCacheKeyFactory : IModelCacheKeyFactory
-        {
-            private readonly Func<object> _getAdditionalKey;
-
-            public TestModelCacheKeyFactory(Func<object> getAdditionalKey)
-            {
-                _getAdditionalKey = getAdditionalKey;
-            }
-
-            public object Create(DbContext context)
-                => Tuple.Create(context.GetType(), _getAdditionalKey());
-
-            public object Create(DbContext context, bool designTime)
-                => Tuple.Create(context.GetType(), _getAdditionalKey(), designTime);
-        }
     }
 
     protected class EmbeddedTransportationContext : TransportationContext
diff --git a/test/EFCore.Cosmos.FunctionalTests/EndToEndCosmosTest.cs b/test/EFCore.Cosmos.FunctionalTests/EndToEndCosmosTest.cs
index 544d2dd33c..3013f0c61b 100644
--- a/test/EFCore.Cosmos.FunctionalTests/EndToEndCosmosTest.cs
+++ b/test/EFCore.Cosmos.FunctionalTests/EndToEndCosmosTest.cs
@@ -1754,10 +1754,12 @@ protected override void OnModelCreating(ModelBuilder modelBuilder)
             => modelBuilder.Entity<ConflictingId>();
     }
 
-    [ConditionalFact]
-    public async Task Can_have_non_string_property_named_Discriminator()
+    [ConditionalTheory]
+    [InlineData(true)]
+    [InlineData(false)]
+    public async Task Can_have_non_string_property_named_Discriminator(bool useDiscriminator)
     {
-        using var context = new NonStringDiscriminatorContext(Fixture.CreateOptions());
+        using var context = new NonStringDiscriminatorContext(Fixture.CreateOptions(), useDiscriminator);
         context.Database.EnsureCreated();
 
         var entry = await context.AddAsync(new NonStringDiscriminator { Id = 1 });
@@ -1767,11 +1769,97 @@ public async Task Can_have_non_string_property_named_Discriminator()
         Assert.NotNull(document);
         Assert.Equal("0", document["Discriminator"]);
 
-        Assert.NotNull(
-            await context.Set<NonStringDiscriminator>()
+        var baseEntity = await context.Set<NonStringDiscriminator>().OrderBy(e => e.Id).FirstOrDefaultAsync();
+        Assert.NotNull(baseEntity);
+
+        if (useDiscriminator)
+        {
+            AssertSql(
+            context,
+            """
+SELECT c
+FROM root c
+WHERE (c["Discriminator"] = 0)
+ORDER BY c["Id"]
+OFFSET 0 LIMIT 1
+""");
+        }
+        else
+        {
+            AssertSql(
+                context,
+                """
+SELECT c
+FROM root c
+ORDER BY c["Id"]
+OFFSET 0 LIMIT 1
+""");
+        }
+
+        Fixture.ListLoggerFactory.Clear();
+        Assert.Equal(baseEntity, await context.Set<NonStringDiscriminator>()
                 .Where(e => e.Discriminator == EntityType.Base).OrderBy(e => e.Id).FirstOrDefaultAsync());
 
-        AssertSql(
+        if (useDiscriminator)
+        {
+            AssertSql(
+            context,
+            """
+SELECT c
+FROM root c
+WHERE ((c["Discriminator"] = 0) AND (c["Discriminator"] = 0))
+ORDER BY c["Id"]
+OFFSET 0 LIMIT 1
+""");
+        }
+        else
+        {
+            AssertSql(
+            context,
+            """
+SELECT c
+FROM root c
+WHERE (c["Discriminator"] = 0)
+ORDER BY c["Id"]
+OFFSET 0 LIMIT 1
+""");
+        }
+
+        Fixture.ListLoggerFactory.Clear();
+        Assert.Equal(baseEntity, await context.Set<NonStringDiscriminator>()
+                .Where(e => e.GetType() == typeof(NonStringDiscriminator)).OrderBy(e => e.Id).FirstOrDefaultAsync());
+
+        if (useDiscriminator)
+        {
+            AssertSql(
+            context,
+            """
+SELECT c
+FROM root c
+WHERE (c["Discriminator"] = 0)
+ORDER BY c["Id"]
+OFFSET 0 LIMIT 1
+""");
+        }
+        else
+        {
+            AssertSql(
+            context,
+            """
+SELECT c
+FROM root c
+ORDER BY c["Id"]
+OFFSET 0 LIMIT 1
+""");
+        }
+
+        Fixture.ListLoggerFactory.Clear();
+        Assert.Equal(baseEntity, await context.Set<NonStringDiscriminator>()
+                .Where(e => e is NonStringDiscriminator).OrderBy(e => e.Id).FirstOrDefaultAsync());
+
+        if (useDiscriminator)
+        {
+            AssertSql(
             context,
             """
 SELECT c
@@ -1780,6 +1868,18 @@ SELECT c
 ORDER BY c["Id"]
 OFFSET 0 LIMIT 1
 """);
+        }
+        else
+        {
+            AssertSql(
+            context,
+            """
+SELECT c
+FROM root c
+ORDER BY c["Id"]
+OFFSET 0 LIMIT 1
+""");
+        }
     }
 
     private class NonStringDiscriminator
@@ -1796,13 +1896,24 @@ private enum EntityType
 
     public class NonStringDiscriminatorContext : DbContext
     {
-        public NonStringDiscriminatorContext(DbContextOptions dbContextOptions)
+        public NonStringDiscriminatorContext(DbContextOptions dbContextOptions, bool useDiscriminator)
             : base(dbContextOptions)
         {
+            UseDiscriminator = useDiscriminator;
         }
 
+        public bool UseDiscriminator { get; }
+
         protected override void OnModelCreating(ModelBuilder modelBuilder)
-            => modelBuilder.Entity<NonStringDiscriminator>();
+        {
+            modelBuilder.Entity<NonStringDiscriminator>();
+            if (UseDiscriminator)
+            {
+                modelBuilder.Entity<NonStringDiscriminator>()
+                    .HasDiscriminator(m => m.Discriminator)
+                    .HasValue(EntityType.Base);
+            }
+        }
     }
 
     private void AssertSql(DbContext context, params string[] expected)
@@ -1844,6 +1955,9 @@ public DbContextOptions CreateOptions()
         protected override bool ShouldLogCategory(string logCategory)
             => logCategory == DbLoggerCategory.Database.Command.Name;
 
+        protected override object GetAdditionalModelCacheKey(DbContext context)
+            => (context as NonStringDiscriminatorContext)?.UseDiscriminator;
+
         public Task InitializeAsync()
             => Task.CompletedTask;
 
diff --git a/test/EFCore.Cosmos.Tests/Infrastructure/CosmosModelValidatorTest.cs b/test/EFCore.Cosmos.Tests/Infrastructure/CosmosModelValidatorTest.cs
index c0013e92d6..584179c145 100644
--- a/test/EFCore.Cosmos.Tests/Infrastructure/CosmosModelValidatorTest.cs
+++ b/test/EFCore.Cosmos.Tests/Infrastructure/CosmosModelValidatorTest.cs
@@ -317,7 +317,7 @@ public virtual void Detects_missing_discriminator_value()
         modelBuilder.Entity<Customer>().ToContainer("Orders").HasDiscriminator().HasValue(null);
         modelBuilder.Entity<Order>().ToContainer("Orders");
 
-        VerifyError(CosmosStrings.NoDiscriminatorValue(typeof(Customer).Name, "Orders"), modelBuilder);
+        VerifyError(CoreStrings.NoDiscriminatorValue(typeof(Customer).Name), modelBuilder);
     }
 
     [ConditionalFact]
diff --git a/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.cs b/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.cs
index d1bc5750a8..58e161ecff 100644
--- a/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.cs
+++ b/test/EFCore.Design.Tests/Migrations/Design/CSharpMigrationsGeneratorTest.cs
@@ -382,7 +382,7 @@ public void Test_new_annotations_handled_for_properties()
                         ? validAnnotations[annotationName].Value
                         : null);
 
-                modelBuilder.FinalizeModel(designTime: true);
+                modelBuilder.FinalizeModel(designTime: true, skipValidation: true);
 
                 var sb = new IndentedStringBuilder();
 
diff --git a/test/EFCore.Specification.Tests/ServiceProviderFixtureBase.cs b/test/EFCore.Specification.Tests/ServiceProviderFixtureBase.cs
index 5d3733505b..cc13d843ac 100644
--- a/test/EFCore.Specification.Tests/ServiceProviderFixtureBase.cs
+++ b/test/EFCore.Specification.Tests/ServiceProviderFixtureBase.cs
@@ -28,8 +28,28 @@ public DbContextOptions CreateOptions(TestStore testStore)
 
     protected override IServiceCollection AddServices(IServiceCollection serviceCollection)
         => base.AddServices(serviceCollection)
-            .AddSingleton<ILoggerFactory>(TestStoreFactory.CreateListLoggerFactory(ShouldLogCategory));
+            .AddSingleton<ILoggerFactory>(TestStoreFactory.CreateListLoggerFactory(ShouldLogCategory))
+            .AddSingleton<IModelCacheKeyFactory>(new FuncCacheKeyFactory(GetAdditionalModelCacheKey));
 
     protected virtual bool ShouldLogCategory(string logCategory)
         => false;
+
+    protected virtual object GetAdditionalModelCacheKey(DbContext context)
+        => null;
+
+    private class FuncCacheKeyFactory : IModelCacheKeyFactory
+    {
+        private readonly Func<DbContext, object> _getAdditionalKey;
+
+        public FuncCacheKeyFactory(Func<DbContext, object> getAdditionalKey)
+        {
+            _getAdditionalKey = getAdditionalKey;
+        }
+
+        public object Create(DbContext context)
+            => Tuple.Create(context.GetType(), _getAdditionalKey(context));
+
+        public object Create(DbContext context, bool designTime)
+            => Tuple.Create(context.GetType(), _getAdditionalKey(context), designTime);
+    }
 }
diff --git a/test/EFCore.Tests/Infrastructure/ModelValidatorTest.cs b/test/EFCore.Tests/Infrastructure/ModelValidatorTest.cs
index 9e3546b70e..b86ff5a22f 100644
--- a/test/EFCore.Tests/Infrastructure/ModelValidatorTest.cs
+++ b/test/EFCore.Tests/Infrastructure/ModelValidatorTest.cs
@@ -1690,6 +1690,15 @@ public virtual void Detects_missing_discriminator_value_on_leaf()
         VerifyError(CoreStrings.NoDiscriminatorValue(entityGeneric.DisplayName()), modelBuilder);
     }
 
+    [ConditionalFact]
+    public virtual void Detects_missing_non_hierarchy_discriminator_value()
+    {
+        var modelBuilder = CreateConventionModelBuilder();
+        modelBuilder.Entity<A>().HasDiscriminator<byte>("ClassType");
+
+        VerifyError(CoreStrings.NoDiscriminatorValue(typeof(A).Name), modelBuilder);
+    }
+
     [ConditionalFact]
     public virtual void Detects_missing_non_string_discriminator_values()
     {
