diff --git a/src/EFCore.SqlServer/Migrations/SqlServerMigrationsSqlGenerator.cs b/src/EFCore.SqlServer/Migrations/SqlServerMigrationsSqlGenerator.cs
index e478aad78d..1119544f93 100644
--- a/src/EFCore.SqlServer/Migrations/SqlServerMigrationsSqlGenerator.cs
+++ b/src/EFCore.SqlServer/Migrations/SqlServerMigrationsSqlGenerator.cs
@@ -29,6 +29,9 @@ namespace Microsoft.EntityFrameworkCore.Migrations;
 /// </remarks>
 public class SqlServerMigrationsSqlGenerator : MigrationsSqlGenerator
 {
+    private static readonly bool UseOldBehavior32457 =
+        AppContext.TryGetSwitch("Microsoft.EntityFrameworkCore.Issue32457", out var enabled32457) && enabled32457;
+
     private IReadOnlyList<MigrationOperation> _operations = null!;
     private int _variableCounter;
 
@@ -1418,7 +1421,10 @@ protected override void Generate(SqlOperation operation, IModel? model, Migratio
             }
 
             var trimmed = line.TrimStart();
-            if (trimmed.StartsWith("GO", StringComparison.OrdinalIgnoreCase))
+            if (trimmed.StartsWith("GO", StringComparison.OrdinalIgnoreCase)
+                && (UseOldBehavior32457
+                    || trimmed.Length == 2
+                    || char.IsWhiteSpace(trimmed[2])))
             {
                 var batch = batchBuilder.ToString();
                 batchBuilder.Clear();
diff --git a/test/EFCore.Relational.Specification.Tests/Migrations/MigrationsInfrastructureTestBase.cs b/test/EFCore.Relational.Specification.Tests/Migrations/MigrationsInfrastructureTestBase.cs
index 9887af6764..0d1a226dcc 100644
--- a/test/EFCore.Relational.Specification.Tests/Migrations/MigrationsInfrastructureTestBase.cs
+++ b/test/EFCore.Relational.Specification.Tests/Migrations/MigrationsInfrastructureTestBase.cs
@@ -71,7 +71,8 @@ public virtual void Can_apply_all_migrations()
             history.GetAppliedMigrations(),
             x => Assert.Equal("00000000000001_Migration1", x.MigrationId),
             x => Assert.Equal("00000000000002_Migration2", x.MigrationId),
-            x => Assert.Equal("00000000000003_Migration3", x.MigrationId));
+            x => Assert.Equal("00000000000003_Migration3", x.MigrationId),
+            x => Assert.Equal("00000000000004_Migration4", x.MigrationId));
     }
 
     [ConditionalFact]
@@ -142,7 +143,8 @@ public virtual async Task Can_apply_all_migrations_async()
             await history.GetAppliedMigrationsAsync(),
             x => Assert.Equal("00000000000001_Migration1", x.MigrationId),
             x => Assert.Equal("00000000000002_Migration2", x.MigrationId),
-            x => Assert.Equal("00000000000003_Migration3", x.MigrationId));
+            x => Assert.Equal("00000000000003_Migration3", x.MigrationId),
+            x => Assert.Equal("00000000000004_Migration4", x.MigrationId));
     }
 
     [ConditionalFact]
@@ -412,4 +414,42 @@ protected override void Down(MigrationBuilder migrationBuilder)
         {
         }
     }
+
+    [DbContext(typeof(MigrationsContext))]
+    [Migration("00000000000004_Migration4")]
+    private class Migration4 : Migration
+    {
+        protected override void Up(MigrationBuilder migrationBuilder)
+        {
+            if (ActiveProvider == "Microsoft.EntityFrameworkCore.SqlServer")
+            {
+                migrationBuilder.Sql("""
+                CREATE PROCEDURE [dbo].[GotoReproduction]
+                AS
+                BEGIN
+                    DECLARE @Counter int;
+                    SET @Counter = 1;
+                    WHILE @Counter < 10
+                    BEGIN
+                        SELECT @Counter
+                        SET @Counter = @Counter + 1
+                        IF @Counter = 4 GOTO Branch_One --Jumps to the first branch.
+                        IF @Counter = 5 GOTO Branch_Two --This will never execute.
+                    END
+                    Branch_One:
+                        SELECT 'Jumping To Branch One.'
+                        GOTO Branch_Three; --This will prevent Branch_Two from executing.
+                    Branch_Two:
+                        SELECT 'Jumping To Branch Two.'
+                    Branch_Three:
+                        SELECT 'Jumping To Branch Three.'
+                END;
+            """);
+            }
+        }
+
+        protected override void Down(MigrationBuilder migrationBuilder)
+        {
+        }
+    }
 }
diff --git a/test/EFCore.SqlServer.FunctionalTests/Migrations/MigrationsInfrastructureSqlServerTest.cs b/test/EFCore.SqlServer.FunctionalTests/Migrations/MigrationsInfrastructureSqlServerTest.cs
index c02380efd1..7ce04a7590 100644
--- a/test/EFCore.SqlServer.FunctionalTests/Migrations/MigrationsInfrastructureSqlServerTest.cs
+++ b/test/EFCore.SqlServer.FunctionalTests/Migrations/MigrationsInfrastructureSqlServerTest.cs
@@ -123,6 +123,38 @@ public override void Can_generate_up_scripts()
 COMMIT;
 GO
 
+BEGIN TRANSACTION;
+GO
+
+    CREATE PROCEDURE [dbo].[GotoReproduction]
+    AS
+    BEGIN
+        DECLARE @Counter int;
+        SET @Counter = 1;
+        WHILE @Counter < 10
+        BEGIN
+            SELECT @Counter
+            SET @Counter = @Counter + 1
+            IF @Counter = 4 GOTO Branch_One --Jumps to the first branch.
+            IF @Counter = 5 GOTO Branch_Two --This will never execute.
+        END
+        Branch_One:
+            SELECT 'Jumping To Branch One.'
+            GOTO Branch_Three; --This will prevent Branch_Two from executing.
+        Branch_Two:
+            SELECT 'Jumping To Branch Two.'
+        Branch_Three:
+            SELECT 'Jumping To Branch Three.'
+    END;
+GO
+
+INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
+VALUES (N'00000000000004_Migration4', N'7.0.0-test');
+GO
+
+COMMIT;
+GO
+
 
 """,
                 Sql,
@@ -173,6 +205,32 @@ public override void Can_generate_up_scripts_noTransactions()
 VALUES (N'00000000000003_Migration3', N'7.0.0-test');
 GO
 
+    CREATE PROCEDURE [dbo].[GotoReproduction]
+    AS
+    BEGIN
+        DECLARE @Counter int;
+        SET @Counter = 1;
+        WHILE @Counter < 10
+        BEGIN
+            SELECT @Counter
+            SET @Counter = @Counter + 1
+            IF @Counter = 4 GOTO Branch_One --Jumps to the first branch.
+            IF @Counter = 5 GOTO Branch_Two --This will never execute.
+        END
+        Branch_One:
+            SELECT 'Jumping To Branch One.'
+            GOTO Branch_Three; --This will prevent Branch_Two from executing.
+        Branch_Two:
+            SELECT 'Jumping To Branch Two.'
+        Branch_Three:
+            SELECT 'Jumping To Branch Three.'
+    END;
+GO
+
+INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
+VALUES (N'00000000000004_Migration4', N'7.0.0-test');
+GO
+
 
 """,
                 Sql,
@@ -333,6 +391,50 @@ public override void Can_generate_idempotent_up_scripts()
 COMMIT;
 GO
 
+BEGIN TRANSACTION;
+GO
+
+IF NOT EXISTS (
+    SELECT * FROM [__EFMigrationsHistory]
+    WHERE [MigrationId] = N'00000000000004_Migration4'
+)
+BEGIN
+        CREATE PROCEDURE [dbo].[GotoReproduction]
+        AS
+        BEGIN
+            DECLARE @Counter int;
+            SET @Counter = 1;
+            WHILE @Counter < 10
+            BEGIN
+                SELECT @Counter
+                SET @Counter = @Counter + 1
+                IF @Counter = 4 GOTO Branch_One --Jumps to the first branch.
+                IF @Counter = 5 GOTO Branch_Two --This will never execute.
+            END
+            Branch_One:
+                SELECT 'Jumping To Branch One.'
+                GOTO Branch_Three; --This will prevent Branch_Two from executing.
+            Branch_Two:
+                SELECT 'Jumping To Branch Two.'
+            Branch_Three:
+                SELECT 'Jumping To Branch Three.'
+        END;
+END;
+GO
+
+IF NOT EXISTS (
+    SELECT * FROM [__EFMigrationsHistory]
+    WHERE [MigrationId] = N'00000000000004_Migration4'
+)
+BEGIN
+    INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
+    VALUES (N'00000000000004_Migration4', N'7.0.0-test');
+END;
+GO
+
+COMMIT;
+GO
+
 
 """,
                 Sql,
@@ -425,6 +527,44 @@ public override void Can_generate_idempotent_up_scripts_noTransactions()
 END;
 GO
 
+IF NOT EXISTS (
+    SELECT * FROM [__EFMigrationsHistory]
+    WHERE [MigrationId] = N'00000000000004_Migration4'
+)
+BEGIN
+        CREATE PROCEDURE [dbo].[GotoReproduction]
+        AS
+        BEGIN
+            DECLARE @Counter int;
+            SET @Counter = 1;
+            WHILE @Counter < 10
+            BEGIN
+                SELECT @Counter
+                SET @Counter = @Counter + 1
+                IF @Counter = 4 GOTO Branch_One --Jumps to the first branch.
+                IF @Counter = 5 GOTO Branch_Two --This will never execute.
+            END
+            Branch_One:
+                SELECT 'Jumping To Branch One.'
+                GOTO Branch_Three; --This will prevent Branch_Two from executing.
+            Branch_Two:
+                SELECT 'Jumping To Branch Two.'
+            Branch_Three:
+                SELECT 'Jumping To Branch Three.'
+        END;
+END;
+GO
+
+IF NOT EXISTS (
+    SELECT * FROM [__EFMigrationsHistory]
+    WHERE [MigrationId] = N'00000000000004_Migration4'
+)
+BEGIN
+    INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
+    VALUES (N'00000000000004_Migration4', N'7.0.0-test');
+END;
+GO
+
 
 """,
                 Sql,
diff --git a/test/EFCore.Sqlite.FunctionalTests/Migrations/MigrationsInfrastructureSqliteTest.cs b/test/EFCore.Sqlite.FunctionalTests/Migrations/MigrationsInfrastructureSqliteTest.cs
index 3a70db60f4..c8c33bfc71 100644
--- a/test/EFCore.Sqlite.FunctionalTests/Migrations/MigrationsInfrastructureSqliteTest.cs
+++ b/test/EFCore.Sqlite.FunctionalTests/Migrations/MigrationsInfrastructureSqliteTest.cs
@@ -88,6 +88,13 @@ public override void Can_generate_up_scripts()
 
 COMMIT;
 
+BEGIN TRANSACTION;
+
+INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
+VALUES ('00000000000004_Migration4', '7.0.0-test');
+
+COMMIT;
+
 
 """,
                 Sql,
@@ -121,6 +128,9 @@ public override void Can_generate_up_scripts_noTransactions()
 INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
 VALUES ('00000000000003_Migration3', '7.0.0-test');
 
+INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
+VALUES ('00000000000004_Migration4', '7.0.0-test');
+
 
 """,
                 Sql,
