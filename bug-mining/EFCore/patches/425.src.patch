diff --git a/Directory.Build.targets b/Directory.Build.targets
index 4aec99516a..bca11ece4c 100644
--- a/Directory.Build.targets
+++ b/Directory.Build.targets
@@ -11,6 +11,13 @@
   
   <Import Project="Sdk.targets" Sdk="Microsoft.DotNet.Arcade.Sdk" />
   <Import Project="eng\testing\linker\trimmingTests.targets" Condition="'$(IsPublishedAppTestProject)' == 'true'" />
+  
+  <ItemGroup>
+    <FrameworkReference Update="Microsoft.NETCore.App"
+                        Condition="'$(TargetFramework)' == 'net9.0'"
+                        RuntimeFrameworkVersion="$(MicrosoftNETCoreAppRuntimewinx64Version)"
+                        TargetingPackVersion="$(MicrosoftNETCoreAppRefVersion)" />
+  </ItemGroup>
 
   <Target Name="GetCustomAssemblyAttributes"
           BeforeTargets="GetAssemblyAttributes"
diff --git a/eng/Version.Details.xml b/eng/Version.Details.xml
index 698e1dc1d8..9bac574314 100644
--- a/eng/Version.Details.xml
+++ b/eng/Version.Details.xml
@@ -43,17 +43,17 @@
     </Dependency>
   </ProductDependencies>
   <ToolsetDependencies>
-    <Dependency Name="Microsoft.DotNet.Arcade.Sdk" Version="9.0.0-beta.23607.2">
+    <Dependency Name="Microsoft.DotNet.Arcade.Sdk" Version="9.0.0-beta.24114.1">
       <Uri>https://github.com/dotnet/arcade</Uri>
-      <Sha>3faeb9817f465151aa4bbcdb315f0a6170206760</Sha>
+      <Sha>d5b02a4900c4d521cb48b8f0d7e3f28175268f7c</Sha>
     </Dependency>
-    <Dependency Name="Microsoft.DotNet.Build.Tasks.Templating" Version="9.0.0-beta.23607.2">
+    <Dependency Name="Microsoft.DotNet.Build.Tasks.Templating" Version="9.0.0-beta.24114.1">
       <Uri>https://github.com/dotnet/arcade</Uri>
-      <Sha>3faeb9817f465151aa4bbcdb315f0a6170206760</Sha>
+      <Sha>d5b02a4900c4d521cb48b8f0d7e3f28175268f7c</Sha>
     </Dependency>
-    <Dependency Name="Microsoft.DotNet.Helix.Sdk" Version="9.0.0-beta.23607.2">
+    <Dependency Name="Microsoft.DotNet.Helix.Sdk" Version="9.0.0-beta.24114.1">
       <Uri>https://github.com/dotnet/arcade</Uri>
-      <Sha>3faeb9817f465151aa4bbcdb315f0a6170206760</Sha>
+      <Sha>d5b02a4900c4d521cb48b8f0d7e3f28175268f7c</Sha>
     </Dependency>
   </ToolsetDependencies>
 </Dependencies>
diff --git a/eng/Versions.props b/eng/Versions.props
index 0a3f3a2c7d..1067ab3366 100644
--- a/eng/Versions.props
+++ b/eng/Versions.props
@@ -28,12 +28,12 @@
     <SystemTextJsonVersion>9.0.0-preview.3.24126.1</SystemTextJsonVersion>
   </PropertyGroup>
   <PropertyGroup Label="Dependencies from dotnet/arcade">
-    <MicrosoftDotNetBuildTasksTemplatingVersion>9.0.0-beta.23607.2</MicrosoftDotNetBuildTasksTemplatingVersion>
+    <MicrosoftDotNetBuildTasksTemplatingVersion>9.0.0-beta.24114.1</MicrosoftDotNetBuildTasksTemplatingVersion>
   </PropertyGroup>
   <PropertyGroup Label="Other dependencies">
     <!-- NB: This version affects Visual Studio compatibility. See https://learn.microsoft.com/visualstudio/extensibility/roslyn-version-support -->
     <MicrosoftCodeAnalysisVersion>4.8.0</MicrosoftCodeAnalysisVersion>
-    <MicrosoftCodeAnalysisTestingVersion>1.1.2-beta1.23371.1</MicrosoftCodeAnalysisTestingVersion>
+    <MicrosoftCodeAnalysisTestingVersion>1.1.2-beta1.23578.3</MicrosoftCodeAnalysisTestingVersion>
     <XUnitVersion>2.6.1</XUnitVersion>
     <XUnitRunnerVisualstudioVersion>2.5.3</XUnitRunnerVisualstudioVersion>
   </PropertyGroup>
diff --git a/eng/common/build.cmd b/eng/common/build.cmd
new file mode 100644
index 0000000000..99daf368ab
--- /dev/null
+++ b/eng/common/build.cmd
@@ -0,0 +1,3 @@
+@echo off
+powershell -ExecutionPolicy ByPass -NoProfile -command "& """%~dp0build.ps1""" %*"
+exit /b %ErrorLevel%
diff --git a/eng/common/build.ps1 b/eng/common/build.ps1
index 33a6f2d0e2..3eca2ffe2e 100644
--- a/eng/common/build.ps1
+++ b/eng/common/build.ps1
@@ -19,6 +19,8 @@ Param(
   [switch] $pack,
   [switch] $publish,
   [switch] $clean,
+  [switch] $verticalBuild,
+  [switch][Alias('pb')]$productBuild,
   [switch][Alias('bl')]$binaryLog,
   [switch][Alias('nobl')]$excludeCIBinarylog,
   [switch] $ci,
@@ -58,6 +60,8 @@ function Print-Usage() {
   Write-Host "  -sign                   Sign build outputs"
   Write-Host "  -publish                Publish artifacts (e.g. symbols)"
   Write-Host "  -clean                  Clean the solution"
+  Write-Host "  -verticalBuild          Run in 'vertical build' infra mode."
+  Write-Host "  -productBuild           Build the solution in the way it will be built in the full .NET product (VMR) build (short: -pb)"
   Write-Host ""
 
   Write-Host "Advanced settings:"
@@ -95,6 +99,8 @@ function Build {
 
   $bl = if ($binaryLog) { '/bl:' + (Join-Path $LogDir 'Build.binlog') } else { '' }
   $platformArg = if ($platform) { "/p:Platform=$platform" } else { '' }
+  # disable terminal logger for now: https://github.com/dotnet/runtime/issues/97211
+  $tl = '/tl:false'
 
   if ($projects) {
     # Re-assign properties to a new variable because PowerShell doesn't let us append properties directly for unclear reasons.
@@ -111,6 +117,7 @@ function Build {
   MSBuild $toolsetBuildProj `
     $bl `
     $platformArg `
+    $tl `
     /p:Configuration=$configuration `
     /p:RepoRoot=$RepoRoot `
     /p:Restore=$restore `
@@ -120,6 +127,8 @@ function Build {
     /p:Deploy=$deploy `
     /p:Test=$test `
     /p:Pack=$pack `
+    /p:DotNetBuildRepo=$($productBuild -or $verticalBuild) `
+    /p:ArcadeBuildVertical=$verticalBuild `
     /p:IntegrationTest=$integrationTest `
     /p:PerformanceTest=$performanceTest `
     /p:Sign=$sign `
diff --git a/eng/common/build.sh b/eng/common/build.sh
index 2c17ba529b..c26bbaf634 100755
--- a/eng/common/build.sh
+++ b/eng/common/build.sh
@@ -22,6 +22,9 @@ usage()
   echo "  --sourceBuild              Source-build the solution (short: -sb)"
   echo "                             Will additionally trigger the following actions: --restore, --build, --pack"
   echo "                             If --configuration is not set explicitly, will also set it to 'Release'"
+  echo "  --productBuild             Build the solution in the way it will be built in the full .NET product (VMR) build (short: -pb)"
+  echo "                             Will additionally trigger the following actions: --restore, --build, --pack"
+  echo "                             If --configuration is not set explicitly, will also set it to 'Release'"
   echo "  --rebuild                  Rebuild solution"
   echo "  --test                     Run all unit tests in the solution (short: -t)"
   echo "  --integrationTest          Run all integration tests in the solution"
@@ -59,6 +62,8 @@ scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
 restore=false
 build=false
 source_build=false
+vertical_build=false
+product_build=false
 rebuild=false
 test=false
 integration_test=false
@@ -126,6 +131,20 @@ while [[ $# > 0 ]]; do
     -sourcebuild|-sb)
       build=true
       source_build=true
+      product_build=true
+      restore=true
+      pack=true
+      ;;
+    -productBuild|-pb)
+      build=true
+      product_build=true
+      restore=true
+      pack=true
+      ;;
+    -verticalbuild|-vb)
+      build=true
+      vertical_build=true
+      product_build=true
       restore=true
       pack=true
       ;;
@@ -213,13 +232,20 @@ function Build {
     bl="/bl:\"$log_dir/Build.binlog\""
   fi
 
+  # disable terminal logger for now: https://github.com/dotnet/runtime/issues/97211
+  local tl="/tl:false"
+
   MSBuild $_InitializeToolset \
     $bl \
+    $tl \
     /p:Configuration=$configuration \
     /p:RepoRoot="$repo_root" \
     /p:Restore=$restore \
     /p:Build=$build \
+    /p:DotNetBuildRepo=$product_build \
     /p:ArcadeBuildFromSource=$source_build \
+    /p:DotNetBuildSourceOnly=$source_build \
+    /p:ArcadeBuildVertical=$vertical_build \
     /p:Rebuild=$rebuild \
     /p:Test=$test \
     /p:Pack=$pack \
diff --git a/eng/common/cross/build-rootfs.sh b/eng/common/cross/build-rootfs.sh
index 4228f202e5..99a9dd6bb6 100755
--- a/eng/common/cross/build-rootfs.sh
+++ b/eng/common/cross/build-rootfs.sh
@@ -8,7 +8,7 @@ usage()
     echo "BuildArch can be: arm(default), arm64, armel, armv6, ppc64le, riscv64, s390x, x64, x86"
     echo "CodeName - optional, Code name for Linux, can be: xenial(default), zesty, bionic, alpine"
     echo "                               for alpine can be specified with version: alpineX.YY or alpineedge"
-    echo "                               for FreeBSD can be: freebsd12, freebsd13"
+    echo "                               for FreeBSD can be: freebsd13, freebsd14"
     echo "                               for illumos can be: illumos"
     echo "                               for Haiku can be: haiku."
     echo "lldbx.y - optional, LLDB version, can be: lldb3.9(default), lldb4.0, lldb5.0, lldb6.0 no-lldb. Ignored for alpine and FreeBSD"
@@ -71,9 +71,9 @@ __AlpinePackages+=" krb5-dev"
 __AlpinePackages+=" openssl-dev"
 __AlpinePackages+=" zlib-dev"
 
-__FreeBSDBase="12.4-RELEASE"
+__FreeBSDBase="13.2-RELEASE"
 __FreeBSDPkg="1.17.0"
-__FreeBSDABI="12"
+__FreeBSDABI="13"
 __FreeBSDPackages="libunwind"
 __FreeBSDPackages+=" icu"
 __FreeBSDPackages+=" libinotify"
@@ -182,12 +182,12 @@ while :; do
             __AlpinePackages="${__AlpinePackages// lldb-dev/}"
             __QEMUArch=riscv64
             __UbuntuArch=riscv64
-            __UbuntuRepo="http://deb.debian.org/debian-ports"
+            __UbuntuRepo="http://deb.debian.org/debian"
             __UbuntuPackages="${__UbuntuPackages// libunwind8-dev/}"
             unset __LLDB_Package
 
-            if [[ -e "/usr/share/keyrings/debian-ports-archive-keyring.gpg" ]]; then
-                __Keyring="--keyring /usr/share/keyrings/debian-ports-archive-keyring.gpg --include=debian-ports-archive-keyring"
+            if [[ -e "/usr/share/keyrings/debian-archive-keyring.gpg" ]]; then
+                __Keyring="--keyring /usr/share/keyrings/debian-archive-keyring.gpg --include=debian-archive-keyring"
             fi
             ;;
         ppc64le)
@@ -334,14 +334,14 @@ while :; do
                 __AlpineVersion="$__AlpineMajorVersion.$__AlpineMinoVersion"
             fi
             ;;
-        freebsd12)
+        freebsd13)
             __CodeName=freebsd
             __SkipUnmount=1
             ;;
-        freebsd13)
+        freebsd14)
             __CodeName=freebsd
-            __FreeBSDBase="13.2-RELEASE"
-            __FreeBSDABI="13"
+            __FreeBSDBase="14.0-RELEASE"
+            __FreeBSDABI="14"
             __SkipUnmount=1
             ;;
         illumos)
diff --git a/eng/common/cross/riscv64/sources.list.sid b/eng/common/cross/riscv64/sources.list.sid
index 65f730d224..b5f7a7e6e1 100644
--- a/eng/common/cross/riscv64/sources.list.sid
+++ b/eng/common/cross/riscv64/sources.list.sid
@@ -1 +1 @@
-deb http://deb.debian.org/debian-ports sid main
+deb http://deb.debian.org/debian sid main
diff --git a/eng/common/helixpublish.proj b/eng/common/helixpublish.proj
index d7f185856e..c1323bf412 100644
--- a/eng/common/helixpublish.proj
+++ b/eng/common/helixpublish.proj
@@ -1,3 +1,4 @@
+<!-- Licensed to the .NET Foundation under one or more agreements. The .NET Foundation licenses this file to you under the MIT license. -->
 <Project Sdk="Microsoft.DotNet.Helix.Sdk" DefaultTargets="Test">
 
   <PropertyGroup>
diff --git a/eng/common/internal/Directory.Build.props b/eng/common/internal/Directory.Build.props
index dbf99d82a5..a735fe9a13 100644
--- a/eng/common/internal/Directory.Build.props
+++ b/eng/common/internal/Directory.Build.props
@@ -1,4 +1,6 @@
 <!-- Licensed to the .NET Foundation under one or more agreements. The .NET Foundation licenses this file to you under the MIT license. -->
 <Project>
+
   <Import Project="Sdk.props" Sdk="Microsoft.DotNet.Arcade.Sdk" />
+
 </Project>
diff --git a/eng/common/internal/Tools.csproj b/eng/common/internal/Tools.csproj
index 7f5ce6d608..8fa77e5b18 100644
--- a/eng/common/internal/Tools.csproj
+++ b/eng/common/internal/Tools.csproj
@@ -1,5 +1,6 @@
 <!-- Licensed to the .NET Foundation under one or more agreements. The .NET Foundation licenses this file to you under the MIT license. -->
 <Project Sdk="Microsoft.NET.Sdk">
+
   <PropertyGroup>
     <TargetFramework>net472</TargetFramework>
     <ImportDirectoryBuildTargets>false</ImportDirectoryBuildTargets>
@@ -27,4 +28,5 @@
 
   <!-- Repository extensibility point -->
   <Import Project="$(RepositoryEngineeringDir)InternalTools.props" Condition="Exists('$(RepositoryEngineeringDir)InternalTools.props')" />
+
 </Project>
diff --git a/eng/common/native/init-os-and-arch.sh b/eng/common/native/init-os-and-arch.sh
index e693617a6c..caa448ff03 100644
--- a/eng/common/native/init-os-and-arch.sh
+++ b/eng/common/native/init-os-and-arch.sh
@@ -35,6 +35,10 @@ fi
 case "$CPUName" in
     arm64|aarch64)
         arch=arm64
+        if [ "$(getconf LONG_BIT)" -lt 64 ]; then
+            # This is 32-bit OS running on 64-bit CPU (for example Raspberry Pi OS)
+            arch=arm
+        fi
         ;;
 
     loongarch64)
diff --git a/eng/common/sdk-task.ps1 b/eng/common/sdk-task.ps1
index 73828dd30d..091023970f 100644
--- a/eng/common/sdk-task.ps1
+++ b/eng/common/sdk-task.ps1
@@ -64,7 +64,7 @@ try {
       $GlobalJson.tools | Add-Member -Name "vs" -Value (ConvertFrom-Json "{ `"version`": `"16.5`" }") -MemberType NoteProperty
     }
     if( -not ($GlobalJson.tools.PSObject.Properties.Name -match "xcopy-msbuild" )) {
-      $GlobalJson.tools | Add-Member -Name "xcopy-msbuild" -Value "17.8.1-2" -MemberType NoteProperty
+      $GlobalJson.tools | Add-Member -Name "xcopy-msbuild" -Value "17.8.5" -MemberType NoteProperty
     }
     if ($GlobalJson.tools."xcopy-msbuild".Trim() -ine "none") {
         $xcopyMSBuildToolsFolder = InitializeXCopyMSBuild $GlobalJson.tools."xcopy-msbuild" -install $true
diff --git a/eng/common/sdl/trim-assets-version.ps1 b/eng/common/sdl/trim-assets-version.ps1
index a2e0048770..0daa2a9e94 100644
--- a/eng/common/sdl/trim-assets-version.ps1
+++ b/eng/common/sdl/trim-assets-version.ps1
@@ -72,4 +72,4 @@ catch {
   Write-Host $_
   Write-PipelineTelemetryError -Force -Category 'Sdl' -Message $_
   ExitWithExitCode 1
-}
\ No newline at end of file
+}
diff --git a/eng/common/templates/job/publish-build-assets.yml b/eng/common/templates/job/publish-build-assets.yml
index aac4839b90..bb42240f86 100644
--- a/eng/common/templates/job/publish-build-assets.yml
+++ b/eng/common/templates/job/publish-build-assets.yml
@@ -63,6 +63,10 @@ jobs:
 
   steps:
   - ${{ if and(eq(parameters.runAsPublic, 'false'), ne(variables['System.TeamProject'], 'public'), notin(variables['Build.Reason'], 'PullRequest')) }}:
+    - checkout: self
+      fetchDepth: 3
+      clean: true
+
     - task: DownloadBuildArtifacts@0
       displayName: Download artifact
       inputs:
diff --git a/eng/common/templates/job/source-index-stage1.yml b/eng/common/templates/job/source-index-stage1.yml
index b98202aa02..b5a3e5c4a6 100644
--- a/eng/common/templates/job/source-index-stage1.yml
+++ b/eng/common/templates/job/source-index-stage1.yml
@@ -1,6 +1,6 @@
 parameters:
   runAsPublic: false
-  sourceIndexPackageVersion: 1.0.1-20230228.2
+  sourceIndexPackageVersion: 1.0.1-20240129.2
   sourceIndexPackageSource: https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-tools/nuget/v3/index.json
   sourceIndexBuildCommand: powershell -NoLogo -NoProfile -ExecutionPolicy Bypass -Command "eng/common/build.ps1 -restore -build -binarylog -ci"
   preSteps: []
@@ -30,20 +30,20 @@ jobs:
     pool:
       ${{ if eq(variables['System.TeamProject'], 'public') }}:
         name: $(DncEngPublicBuildPool)
-        demands: ImageOverride -equals windows.vs2019.amd64.open
+        demands: ImageOverride -equals windows.vs2022.amd64.open
       ${{ if eq(variables['System.TeamProject'], 'internal') }}:
         name: $(DncEngInternalBuildPool)
-        demands: ImageOverride -equals windows.vs2019.amd64
+        demands: ImageOverride -equals windows.vs2022.amd64
 
   steps:
   - ${{ each preStep in parameters.preSteps }}:
     - ${{ preStep }}
 
   - task: UseDotNet@2
-    displayName: Use .NET Core SDK 6
+    displayName: Use .NET 8 SDK
     inputs:
       packageType: sdk
-      version: 6.0.x
+      version: 8.0.x
       installationPath: $(Agent.TempDirectory)/dotnet
       workingDirectory: $(Agent.TempDirectory)
 
diff --git a/eng/common/templates/jobs/jobs.yml b/eng/common/templates/jobs/jobs.yml
index 67a2e2c747..289bb2396c 100644
--- a/eng/common/templates/jobs/jobs.yml
+++ b/eng/common/templates/jobs/jobs.yml
@@ -20,7 +20,7 @@ parameters:
     enabled: false
     # Optional: Include toolset dependencies in the generated graph files
     includeToolset: false
-
+    
   # Required: A collection of jobs to run - https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=vsts&tabs=schema#job
   jobs: []
 
@@ -47,7 +47,7 @@ parameters:
 jobs:
 - ${{ each job in parameters.jobs }}:
   - template: ../job/job.yml
-    parameters:
+    parameters: 
       # pass along parameters
       ${{ each parameter in parameters }}:
         ${{ if ne(parameter.key, 'jobs') }}:
diff --git a/eng/common/templates/post-build/common-variables.yml b/eng/common/templates/post-build/common-variables.yml
index 4ef7bd271f..b9ede10bf0 100644
--- a/eng/common/templates/post-build/common-variables.yml
+++ b/eng/common/templates/post-build/common-variables.yml
@@ -18,7 +18,7 @@ variables:
   - name: SymbolToolVersion
     value: 1.0.1
   - name: BinlogToolVersion
-    value: 1.0.8
+    value: 1.0.11
 
   - name: runCodesignValidationInjection
     value: false
diff --git a/eng/common/templates/steps/publish-logs.yml b/eng/common/templates/steps/publish-logs.yml
index dadf1c464c..80861297dd 100644
--- a/eng/common/templates/steps/publish-logs.yml
+++ b/eng/common/templates/steps/publish-logs.yml
@@ -3,7 +3,7 @@ parameters:
   JobLabel: ''
   CustomSensitiveDataList: ''
   # A default - in case value from eng/common/templates/post-build/common-variables.yml is not passed
-  BinlogToolVersion: '1.0.8'
+  BinlogToolVersion: '1.0.11'
 
 steps:
 - task: Powershell@2
diff --git a/eng/common/templates/steps/send-to-helix.yml b/eng/common/templates/steps/send-to-helix.yml
index 3eb7e2d5f8..68fa739c4a 100644
--- a/eng/common/templates/steps/send-to-helix.yml
+++ b/eng/common/templates/steps/send-to-helix.yml
@@ -5,6 +5,8 @@ parameters:
   HelixBuild: $(Build.BuildNumber)       # required -- the build number Helix will use to identify this -- automatically set to the AzDO build number
   HelixTargetQueues: ''                  # required -- semicolon-delimited list of Helix queues to test on; see https://helix.dot.net/ for a list of queues
   HelixAccessToken: ''                   # required -- access token to make Helix API requests; should be provided by the appropriate variable group
+  HelixProjectPath: 'eng/common/helixpublish.proj'  # optional -- path to the project file to build relative to BUILD_SOURCESDIRECTORY
+  HelixProjectArguments: ''              # optional -- arguments passed to the build command
   HelixConfiguration: ''                 # optional -- additional property attached to a job
   HelixPreCommands: ''                   # optional -- commands to run before Helix work item execution
   HelixPostCommands: ''                  # optional -- commands to run after Helix work item execution
@@ -29,7 +31,7 @@ parameters:
   continueOnError: false                 # optional -- determines whether to continue the build if the step errors; defaults to false
 
 steps:
-  - powershell: 'powershell "$env:BUILD_SOURCESDIRECTORY\eng\common\msbuild.ps1 $env:BUILD_SOURCESDIRECTORY\eng\common\helixpublish.proj /restore /p:TreatWarningsAsErrors=false /t:Test /bl:$env:BUILD_SOURCESDIRECTORY\artifacts\log\$env:BuildConfig\SendToHelix.binlog"'
+  - powershell: 'powershell "$env:BUILD_SOURCESDIRECTORY\eng\common\msbuild.ps1 $env:BUILD_SOURCESDIRECTORY/${{ parameters.HelixProjectPath }} /restore /p:TreatWarningsAsErrors=false ${{ parameters.HelixProjectArguments }} /t:Test /bl:$env:BUILD_SOURCESDIRECTORY\artifacts\log\$env:BuildConfig\SendToHelix.binlog"'
     displayName: ${{ parameters.DisplayNamePrefix }} (Windows)
     env:
       BuildConfig: $(_BuildConfig)
@@ -59,7 +61,7 @@ steps:
       SYSTEM_ACCESSTOKEN: $(System.AccessToken)
     condition: and(${{ parameters.condition }}, eq(variables['Agent.Os'], 'Windows_NT'))
     continueOnError: ${{ parameters.continueOnError }}
-  - script: $BUILD_SOURCESDIRECTORY/eng/common/msbuild.sh $BUILD_SOURCESDIRECTORY/eng/common/helixpublish.proj /restore /p:TreatWarningsAsErrors=false /t:Test /bl:$BUILD_SOURCESDIRECTORY/artifacts/log/$BuildConfig/SendToHelix.binlog
+  - script: $BUILD_SOURCESDIRECTORY/eng/common/msbuild.sh $BUILD_SOURCESDIRECTORY/${{ parameters.HelixProjectPath }} /restore /p:TreatWarningsAsErrors=false ${{ parameters.HelixProjectArguments }} /t:Test /bl:$BUILD_SOURCESDIRECTORY/artifacts/log/$BuildConfig/SendToHelix.binlog
     displayName: ${{ parameters.DisplayNamePrefix }} (Unix)
     env:
       BuildConfig: $(_BuildConfig)
diff --git a/eng/common/templates/steps/source-build.yml b/eng/common/templates/steps/source-build.yml
index 41bbb91573..32738aa938 100644
--- a/eng/common/templates/steps/source-build.yml
+++ b/eng/common/templates/steps/source-build.yml
@@ -94,6 +94,8 @@ steps:
       $baseOsArgs \
       /p:SourceBuildNonPortable=${{ parameters.platform.nonPortable }} \
       /p:ArcadeBuildFromSource=true \
+      /p:DotNetBuildSourceOnly=true \
+      /p:DotNetBuildRepo=true \
       /p:AssetManifestFileName=$assetManifestFileName
   displayName: Build
 
@@ -105,7 +107,7 @@ steps:
     Contents: |
       **/*.log
       **/*.binlog
-      artifacts/source-build/self/prebuilt-report/**
+      artifacts/sb/prebuilt-report/**
     TargetFolder: '$(Build.StagingDirectory)/BuildLogs'
     CleanTargetFolder: true
   continueOnError: true
@@ -126,4 +128,4 @@ steps:
 - task: ComponentGovernanceComponentDetection@0
   displayName: Component Detection (Exclude upstream cache)
   inputs:
-    ignoreDirectories: '$(Build.SourcesDirectory)/artifacts/source-build/self/src/artifacts/obj/source-built-upstream-cache'
+    ignoreDirectories: '$(Build.SourcesDirectory)/artifacts/sb/src/artifacts/obj/source-built-upstream-cache'
diff --git a/eng/common/tools.ps1 b/eng/common/tools.ps1
index 5c3b2a1e41..7d8dc89b91 100644
--- a/eng/common/tools.ps1
+++ b/eng/common/tools.ps1
@@ -165,11 +165,6 @@ function InitializeDotNetCli([bool]$install, [bool]$createSdkLocationFile) {
     $env:DOTNET_CLI_TELEMETRY_OPTOUT=1
   }
 
-  # Source Build uses DotNetCoreSdkDir variable
-  if ($env:DotNetCoreSdkDir -ne $null) {
-    $env:DOTNET_INSTALL_DIR = $env:DotNetCoreSdkDir
-  }
-
   # Find the first path on %PATH% that contains the dotnet.exe
   if ($useInstalledDotNetCli -and (-not $globalJsonHasRuntimes) -and ($env:DOTNET_INSTALL_DIR -eq $null)) {
     $dotnetExecutable = GetExecutableFileName 'dotnet'
@@ -384,8 +379,8 @@ function InitializeVisualStudioMSBuild([bool]$install, [object]$vsRequirements =
 
   # If the version of msbuild is going to be xcopied,
   # use this version. Version matches a package here:
-  # https://dev.azure.com/dnceng/public/_artifacts/feed/dotnet-eng/NuGet/RoslynTools.MSBuild/versions/17.8.1-2
-  $defaultXCopyMSBuildVersion = '17.8.1-2'
+  # https://dev.azure.com/dnceng/public/_artifacts/feed/dotnet-eng/NuGet/Microsoft.DotNet.Arcade.MSBuild.Xcopy/versions/17.8.5
+  $defaultXCopyMSBuildVersion = '17.8.5'
 
   if (!$vsRequirements) {
     if (Get-Member -InputObject $GlobalJson.tools -Name 'vs') {
@@ -450,7 +445,7 @@ function InitializeVisualStudioMSBuild([bool]$install, [object]$vsRequirements =
     if ($xcopyMSBuildVersion.Trim() -ine "none") {
         $vsInstallDir = InitializeXCopyMSBuild $xcopyMSBuildVersion $install
         if ($vsInstallDir -eq $null) {
-            throw "Could not xcopy msbuild. Please check that package 'RoslynTools.MSBuild @ $xcopyMSBuildVersion' exists on feed 'dotnet-eng'."
+            throw "Could not xcopy msbuild. Please check that package 'Microsoft.DotNet.Arcade.MSBuild.Xcopy @ $xcopyMSBuildVersion' exists on feed 'dotnet-eng'."
         }
     }
     if ($vsInstallDir -eq $null) {
@@ -487,7 +482,7 @@ function InstallXCopyMSBuild([string]$packageVersion) {
 }
 
 function InitializeXCopyMSBuild([string]$packageVersion, [bool]$install) {
-  $packageName = 'RoslynTools.MSBuild'
+  $packageName = 'Microsoft.DotNet.Arcade.MSBuild.Xcopy'
   $packageDir = Join-Path $ToolsDir "msbuild\$packageVersion"
   $packagePath = Join-Path $packageDir "$packageName.$packageVersion.nupkg"
 
@@ -604,11 +599,11 @@ function InitializeBuildTool() {
 
     # Use override if it exists - commonly set by source-build
     if ($null -eq $env:_OverrideArcadeInitializeBuildToolFramework) {
-      $initializeBuildToolFramework="net8.0"
+      $initializeBuildToolFramework="net9.0"
     } else {
       $initializeBuildToolFramework=$env:_OverrideArcadeInitializeBuildToolFramework
     }
-
+    
     $buildTool = @{ Path = $dotnetPath; Command = 'msbuild'; Tool = 'dotnet'; Framework = $initializeBuildToolFramework }
   } elseif ($msbuildEngine -eq "vs") {
     try {
@@ -684,8 +679,14 @@ function Read-ArcadeSdkVersion() {
 }
 
 function InitializeToolset() {
-  if (Test-Path variable:global:_ToolsetBuildProj) {
-    return $global:_ToolsetBuildProj
+  # For Unified Build/Source-build support, check whether the environment variable is
+  # set. If it is, then use this as the toolset build project.
+  if ($env:_InitializeToolset -ne $null) {
+    return $global:_InitializeToolset = $env:_InitializeToolset
+  }
+
+  if (Test-Path variable:global:_InitializeToolset) {
+    return $global:_InitializeToolset
   }
 
   $nugetCache = GetNuGetPackageCachePath
@@ -696,7 +697,7 @@ function InitializeToolset() {
   if (Test-Path $toolsetLocationFile) {
     $path = Get-Content $toolsetLocationFile -TotalCount 1
     if (Test-Path $path) {
-      return $global:_ToolsetBuildProj = $path
+      return $global:_InitializeToolset = $path
     }
   }
 
@@ -719,7 +720,7 @@ function InitializeToolset() {
     throw "Invalid toolset path: $path"
   }
 
-  return $global:_ToolsetBuildProj = $path
+  return $global:_InitializeToolset = $path
 }
 
 function ExitWithExitCode([int] $exitCode) {
@@ -771,12 +772,10 @@ function MSBuild() {
       # new scripts need to work with old packages, so we need to look for the old names/versions
       (Join-Path $basePath (Join-Path $buildTool.Framework 'Microsoft.DotNet.ArcadeLogging.dll')),
       (Join-Path $basePath (Join-Path $buildTool.Framework 'Microsoft.DotNet.Arcade.Sdk.dll')),
-      (Join-Path $basePath (Join-Path netcoreapp2.1 'Microsoft.DotNet.ArcadeLogging.dll')),
-      (Join-Path $basePath (Join-Path netcoreapp2.1 'Microsoft.DotNet.Arcade.Sdk.dll'))
-      (Join-Path $basePath (Join-Path netcoreapp3.1 'Microsoft.DotNet.ArcadeLogging.dll')),
-      (Join-Path $basePath (Join-Path netcoreapp3.1 'Microsoft.DotNet.Arcade.Sdk.dll'))
       (Join-Path $basePath (Join-Path net7.0 'Microsoft.DotNet.ArcadeLogging.dll')),
-      (Join-Path $basePath (Join-Path net7.0 'Microsoft.DotNet.Arcade.Sdk.dll'))
+      (Join-Path $basePath (Join-Path net7.0 'Microsoft.DotNet.Arcade.Sdk.dll')),
+      (Join-Path $basePath (Join-Path net8.0 'Microsoft.DotNet.ArcadeLogging.dll')),
+      (Join-Path $basePath (Join-Path net8.0 'Microsoft.DotNet.Arcade.Sdk.dll'))
     )
     $selectedPath = $null
     foreach ($path in $possiblePaths) {
@@ -835,7 +834,8 @@ function MSBuild-Core() {
     }
   }
 
-  $env:ARCADE_BUILD_TOOL_COMMAND = "$($buildTool.Path) $cmdArgs"
+  # Be sure quote the path in case there are spaces in the dotnet installation location.
+  $env:ARCADE_BUILD_TOOL_COMMAND = "`"$($buildTool.Path)`" $cmdArgs"
 
   $exitCode = Exec-Process $buildTool.Path $cmdArgs
 
diff --git a/eng/common/tools.sh b/eng/common/tools.sh
index e98daf50c6..ece4b73079 100755
--- a/eng/common/tools.sh
+++ b/eng/common/tools.sh
@@ -123,11 +123,6 @@ function InitializeDotNetCli {
   # so it doesn't output warnings to the console.
   export LTTNG_HOME="$HOME"
 
-  # Source Build uses DotNetCoreSdkDir variable
-  if [[ -n "${DotNetCoreSdkDir:-}" ]]; then
-    export DOTNET_INSTALL_DIR="$DotNetCoreSdkDir"
-  fi
-
   # Find the first path on $PATH that contains the dotnet.exe
   if [[ "$use_installed_dotnet_cli" == true && $global_json_has_runtimes == false && -z "${DOTNET_INSTALL_DIR:-}" ]]; then
     local dotnet_path=`command -v dotnet`
@@ -343,7 +338,7 @@ function InitializeBuildTool {
   _InitializeBuildToolCommand="msbuild"
   # use override if it exists - commonly set by source-build
   if [[ "${_OverrideArcadeInitializeBuildToolFramework:-x}" == "x" ]]; then
-    _InitializeBuildToolFramework="net8.0"
+    _InitializeBuildToolFramework="net9.0"
   else
     _InitializeBuildToolFramework="${_OverrideArcadeInitializeBuildToolFramework}"
   fi
@@ -458,12 +453,10 @@ function MSBuild {
     local possiblePaths=()
     possiblePaths+=( "$toolset_dir/$_InitializeBuildToolFramework/Microsoft.DotNet.ArcadeLogging.dll" )
     possiblePaths+=( "$toolset_dir/$_InitializeBuildToolFramework/Microsoft.DotNet.Arcade.Sdk.dll" )
-    possiblePaths+=( "$toolset_dir/netcoreapp2.1/Microsoft.DotNet.ArcadeLogging.dll" )
-    possiblePaths+=( "$toolset_dir/netcoreapp2.1/Microsoft.DotNet.Arcade.Sdk.dll" )
-    possiblePaths+=( "$toolset_dir/netcoreapp3.1/Microsoft.DotNet.ArcadeLogging.dll" )
-    possiblePaths+=( "$toolset_dir/netcoreapp3.1/Microsoft.DotNet.Arcade.Sdk.dll" )
     possiblePaths+=( "$toolset_dir/net7.0/Microsoft.DotNet.ArcadeLogging.dll" )
     possiblePaths+=( "$toolset_dir/net7.0/Microsoft.DotNet.Arcade.Sdk.dll" )
+    possiblePaths+=( "$toolset_dir/net8.0/Microsoft.DotNet.ArcadeLogging.dll" )
+    possiblePaths+=( "$toolset_dir/net8.0/Microsoft.DotNet.Arcade.Sdk.dll" )
     for path in "${possiblePaths[@]}"; do
       if [[ -f $path ]]; then
         selectedPath=$path
diff --git a/eng/helix.proj b/eng/helix.proj
index bcd1112918..29609a7b5f 100644
--- a/eng/helix.proj
+++ b/eng/helix.proj
@@ -69,7 +69,7 @@
   </ItemGroup>
 
   <PropertyGroup>
-    <XUnitPublishTargetFramework>net8.0</XUnitPublishTargetFramework>
+    <XUnitPublishTargetFramework>net9.0</XUnitPublishTargetFramework>
     <XUnitRuntimeTargetFramework>netcoreapp2.0</XUnitRuntimeTargetFramework>
     <XUnitRunnerVersion>2.4.2</XUnitRunnerVersion>
     <XUnitArguments></XUnitArguments>
diff --git a/global.json b/global.json
index f0948f5600..7ed570e360 100644
--- a/global.json
+++ b/global.json
@@ -1,14 +1,14 @@
 {
   "sdk": {
-    "version": "8.0.101",
+    "version": "9.0.100-preview.1.24101.2",
     "allowPrerelease": true,
     "rollForward": "latestMajor"
   },
   "tools": {
-    "dotnet": "8.0.101"
+    "dotnet": "9.0.100-preview.1.24101.2"
   },
   "msbuild-sdks": {
-    "Microsoft.DotNet.Arcade.Sdk": "9.0.0-beta.23607.2",
-    "Microsoft.DotNet.Helix.Sdk": "9.0.0-beta.23607.2"
+    "Microsoft.DotNet.Arcade.Sdk": "9.0.0-beta.24114.1",
+    "Microsoft.DotNet.Helix.Sdk": "9.0.0-beta.24114.1"
   }
 }
diff --git a/src/EFCore.Design/EFCore.Design.csproj b/src/EFCore.Design/EFCore.Design.csproj
index 9f100363a7..c91aa89bdd 100644
--- a/src/EFCore.Design/EFCore.Design.csproj
+++ b/src/EFCore.Design/EFCore.Design.csproj
@@ -62,7 +62,7 @@
     <PackageReference Include="Microsoft.CodeAnalysis.CSharp.Workspaces" Version="$(MicrosoftCodeAnalysisVersion)" />
     <PackageReference Include="Microsoft.Extensions.DependencyModel" Version="$(MicrosoftExtensionsDependencyModelVersion)" />
     <PackageReference Include="Microsoft.Extensions.HostFactoryResolver.Sources" PrivateAssets="All" Version="$(MicrosoftExtensionsHostFactoryResolverSourcesVersion)" />
-    <PackageReference Include="Mono.TextTemplating" Version="3.0.0-preview-0049-g4f33c8d8b1" />
+    <PackageReference Include="Mono.TextTemplating" Version="3.0.0-preview-0052-g5d0f76c785" />
   </ItemGroup>
 
   <ItemGroup>
diff --git a/src/EFCore.Design/Scaffolding/Internal/TextTemplatingModelGenerator.cs b/src/EFCore.Design/Scaffolding/Internal/TextTemplatingModelGenerator.cs
index aa4f3a5828..937bbd157f 100644
--- a/src/EFCore.Design/Scaffolding/Internal/TextTemplatingModelGenerator.cs
+++ b/src/EFCore.Design/Scaffolding/Internal/TextTemplatingModelGenerator.cs
@@ -107,7 +107,7 @@ public override ScaffoldedModel GenerateModel(IModel model, ModelCodeGenerationO
         {
             host.TemplateFile = contextTemplate;
 
-            generatedCode = Engine.ProcessTemplateAsync(File.ReadAllText(contextTemplate), host).GetAwaiter().GetResult();;
+            generatedCode = Engine.ProcessTemplateAsync(File.ReadAllText(contextTemplate), host).GetAwaiter().GetResult();
             CheckEncoding(host.OutputEncoding);
             HandleErrors(host);
         }
@@ -166,7 +166,7 @@ public override ScaffoldedModel GenerateModel(IModel model, ModelCodeGenerationO
                     if (compiledEntityTypeTemplate is null)
                     {
                         compiledEntityTypeTemplate = Engine.CompileTemplateAsync(File.ReadAllText(entityTypeTemplate), host, default)
-                            .GetAwaiter().GetResult();;
+                            .GetAwaiter().GetResult();
                         entityTypeExtension = host.Extension;
                         CheckEncoding(host.OutputEncoding);
                     }
@@ -210,7 +210,7 @@ public override ScaffoldedModel GenerateModel(IModel model, ModelCodeGenerationO
                     if (compiledConfigurationTemplate is null)
                     {
                         compiledConfigurationTemplate = Engine.CompileTemplateAsync(File.ReadAllText(configurationTemplate), host, default)
-                            .GetAwaiter().GetResult();;
+                            .GetAwaiter().GetResult();
                         configurationExtension = host.Extension;
                         CheckEncoding(host.OutputEncoding);
                     }
diff --git a/test/Directory.Build.props b/test/Directory.Build.props
index 9ccfadee78..68b58c1da1 100644
--- a/test/Directory.Build.props
+++ b/test/Directory.Build.props
@@ -5,6 +5,7 @@
     <NoWarn>$(NoWarn);CA1707;1591;xUnit1000;xUnit1003;xUnit1004;xUnit1010;xUnit1013;xUnit1026;xUnit2013;xUnit1024</NoWarn>
     <CodeAnalysisRuleSet>$(MSBuildThisFileDirectory)..\rulesets\EFCore.test.ruleset</CodeAnalysisRuleSet>
     <LangVersion>preview</LangVersion>
+    <DefaultNetCoreTargetFramework>net9.0</DefaultNetCoreTargetFramework>
   </PropertyGroup>
 
 </Project>
diff --git a/test/EFCore.Relational.Specification.Tests/TestUtilities/RelationalModelAsserter.cs b/test/EFCore.Relational.Specification.Tests/TestUtilities/RelationalModelAsserter.cs
index 591c631aa0..1a010d4e32 100644
--- a/test/EFCore.Relational.Specification.Tests/TestUtilities/RelationalModelAsserter.cs
+++ b/test/EFCore.Relational.Specification.Tests/TestUtilities/RelationalModelAsserter.cs
@@ -36,7 +36,8 @@ public class RelationalModelAsserter : ModelAsserter
                     Assert.Equal(expected.GetCollation(), actual.GetCollation());
                 }
             },
-            () => Assert.Equal(expected.GetDbFunctions(), actual.GetDbFunctions(),
+            () => Assert.Equal(expected.GetDbFunctions().Select(x => x),
+                actual.GetDbFunctions(),
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -44,7 +45,8 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.GetSequences(), actual.GetSequences(),
+            () => Assert.Equal(expected.GetSequences().Select(x => x),
+                actual.GetSequences(),
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -88,7 +90,8 @@ public class RelationalModelAsserter : ModelAsserter
             () => Assert.Equal(expected.MethodInfo, actual.MethodInfo),
             () => Assert.Equal(expected.Translation, actual.Translation),
             () => Assert.Equal(expected.TypeMapping?.StoreType, actual.TypeMapping?.StoreType),
-            () => Assert.Equal(expected.Parameters, actual.Parameters,
+            () => Assert.Equal(expected.Parameters.Select(x => x),
+                actual.Parameters,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -215,7 +218,8 @@ public class RelationalModelAsserter : ModelAsserter
                 actual.GetDeleteStoredProcedure(),
                 compareBackreferences: false,
                 compareMemberAnnotations),
-            () => Assert.Equal(expected.GetMappingFragments(), actual.GetMappingFragments(),
+            () => Assert.Equal(expected.GetMappingFragments().Select(x => x),
+                actual.GetMappingFragments(),
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -227,7 +231,8 @@ public class RelationalModelAsserter : ModelAsserter
             {
                 if (designTime)
                 {
-                    Assert.Equal(expected.GetCheckConstraints(), actual.GetCheckConstraints(),
+                    Assert.Equal(expected.GetCheckConstraints().Select(x => x),
+                        actual.GetCheckConstraints(),
                         (expected, actual) =>
                             AssertEqual(
                                 expected,
@@ -237,49 +242,57 @@ public class RelationalModelAsserter : ModelAsserter
                                 compareBackreferences: false));
                 }
             },
-            () => Assert.Equal(expectedStructuralType.GetDefaultMappings(), actualStructuralType.GetDefaultMappings(),
+            () => Assert.Equal(expectedStructuralType.GetDefaultMappings().Select(x => x),
+                actualStructuralType.GetDefaultMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetTableMappings(), actualStructuralType.GetTableMappings(),
+            () => Assert.Equal(expectedStructuralType.GetTableMappings().Select(x => x),
+                actualStructuralType.GetTableMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetViewMappings(), actualStructuralType.GetViewMappings(),
+            () => Assert.Equal(expectedStructuralType.GetViewMappings().Select(x => x),
+                actualStructuralType.GetViewMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetSqlQueryMappings(), actualStructuralType.GetSqlQueryMappings(),
+            () => Assert.Equal(expectedStructuralType.GetSqlQueryMappings().Select(x => x),
+                actualStructuralType.GetSqlQueryMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetFunctionMappings(), actualStructuralType.GetFunctionMappings(),
+            () => Assert.Equal(expectedStructuralType.GetFunctionMappings().Select(x => x),
+                actualStructuralType.GetFunctionMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetInsertStoredProcedureMappings(), actualStructuralType.GetInsertStoredProcedureMappings(),
+            () => Assert.Equal(expectedStructuralType.GetInsertStoredProcedureMappings().Select(x => x),
+                actualStructuralType.GetInsertStoredProcedureMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetUpdateStoredProcedureMappings(), actualStructuralType.GetUpdateStoredProcedureMappings(),
+            () => Assert.Equal(expectedStructuralType.GetUpdateStoredProcedureMappings().Select(x => x),
+                actualStructuralType.GetUpdateStoredProcedureMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetDeleteStoredProcedureMappings(), actualStructuralType.GetDeleteStoredProcedureMappings(),
+            () => Assert.Equal(expectedStructuralType.GetDeleteStoredProcedureMappings().Select(x => x),
+                actualStructuralType.GetDeleteStoredProcedureMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
@@ -340,7 +353,7 @@ public class RelationalModelAsserter : ModelAsserter
                     Assert.Equal(expected.EntityType, actual.EntityType, EntityTypeFullNameComparer.Instance);
                 }
             },
-            () => Assert.Equal(expected.Parameters, actual.Parameters,
+            () => Assert.Equal(expected.Parameters.Select(x => x), actual.Parameters,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -349,7 +362,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareBackreferences: false,
                         compareAnnotations)),
-            () => Assert.Equal(expected.ResultColumns, actual.ResultColumns,
+            () => Assert.Equal(expected.ResultColumns.Select(x => x), actual.ResultColumns,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -489,7 +502,8 @@ public class RelationalModelAsserter : ModelAsserter
                 actualStructuralType.GetDeleteStoredProcedure(),
                 compareBackreferences: false,
                 compareMemberAnnotations),
-            () => Assert.Equal(expectedStructuralType.GetMappingFragments(), actualStructuralType.GetMappingFragments(),
+            () => Assert.Equal(expectedStructuralType.GetMappingFragments().Select(x => x),
+                actualStructuralType.GetMappingFragments(),
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -497,49 +511,57 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareBackreferences: false)),
-            () => Assert.Equal(expectedStructuralType.GetDefaultMappings(), actualStructuralType.GetDefaultMappings(),
+            () => Assert.Equal(expectedStructuralType.GetDefaultMappings().Select(x => x),
+                actualStructuralType.GetDefaultMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetTableMappings(), actualStructuralType.GetTableMappings(),
+            () => Assert.Equal(expectedStructuralType.GetTableMappings().Select(x => x),
+                actualStructuralType.GetTableMappings().Select(x => x),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetViewMappings(), actualStructuralType.GetViewMappings(),
+            () => Assert.Equal(expectedStructuralType.GetViewMappings().Select(x => x),
+                actualStructuralType.GetViewMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetSqlQueryMappings(), actualStructuralType.GetSqlQueryMappings(),
+            () => Assert.Equal(expectedStructuralType.GetSqlQueryMappings().Select(x => x),
+                actualStructuralType.GetSqlQueryMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetFunctionMappings(), actualStructuralType.GetFunctionMappings(),
+            () => Assert.Equal(expectedStructuralType.GetFunctionMappings().Select(x => x),
+                actualStructuralType.GetFunctionMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetInsertStoredProcedureMappings(), actualStructuralType.GetInsertStoredProcedureMappings(),
+            () => Assert.Equal(expectedStructuralType.GetInsertStoredProcedureMappings().Select(x => x),
+                actualStructuralType.GetInsertStoredProcedureMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetUpdateStoredProcedureMappings(), actualStructuralType.GetUpdateStoredProcedureMappings(),
+            () => Assert.Equal(expectedStructuralType.GetUpdateStoredProcedureMappings().Select(x => x),
+                actualStructuralType.GetUpdateStoredProcedureMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedStructuralType.GetDeleteStoredProcedureMappings(), actualStructuralType.GetDeleteStoredProcedureMappings(),
+            () => Assert.Equal(expectedStructuralType.GetDeleteStoredProcedureMappings().Select(x => x),
+                actualStructuralType.GetDeleteStoredProcedureMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
@@ -607,68 +629,78 @@ public class RelationalModelAsserter : ModelAsserter
                     Assert.Equal(expected.GetCollation(), actual.GetCollation());
                 }
             },
-            () => Assert.Equal(expected.GetOverrides(), actual.GetOverrides(),
+            () => Assert.Equal(expected.GetOverrides().Select(x => x), actual.GetOverrides().Select(x => x),
                 (expected, actual) =>
                     AssertEqual(
                         expected,
                         actual,
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>())),
-            () => Assert.Equal(expectedProperty.GetDefaultColumnMappings().ToList(), actualProperty.GetDefaultColumnMappings(),
+            () => Assert.Equal(expectedProperty.GetDefaultColumnMappings().Select(x => x),
+                actualProperty.GetDefaultColumnMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetTableColumnMappings().ToList(), actualProperty.GetTableColumnMappings(),
+            () => Assert.Equal(expectedProperty.GetTableColumnMappings().Select(x => x),
+                actualProperty.GetTableColumnMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetViewColumnMappings().ToList(), actualProperty.GetViewColumnMappings(),
+            () => Assert.Equal(expectedProperty.GetViewColumnMappings().Select(x => x),
+                actualProperty.GetViewColumnMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetSqlQueryColumnMappings().ToList(), actualProperty.GetSqlQueryColumnMappings(),
+            () => Assert.Equal(expectedProperty.GetSqlQueryColumnMappings().Select(x => x),
+                actualProperty.GetSqlQueryColumnMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetFunctionColumnMappings().ToList(), actualProperty.GetFunctionColumnMappings(),
+            () => Assert.Equal(expectedProperty.GetFunctionColumnMappings().Select(x => x),
+                actualProperty.GetFunctionColumnMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetInsertStoredProcedureParameterMappings().ToList(), actualProperty.GetInsertStoredProcedureParameterMappings(),
+            () => Assert.Equal(expectedProperty.GetInsertStoredProcedureParameterMappings().Select(x => x),
+                actualProperty.GetInsertStoredProcedureParameterMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetInsertStoredProcedureResultColumnMappings().ToList(), actualProperty.GetInsertStoredProcedureResultColumnMappings(),
+            () => Assert.Equal(expectedProperty.GetInsertStoredProcedureResultColumnMappings().Select(x => x),
+                actualProperty.GetInsertStoredProcedureResultColumnMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetUpdateStoredProcedureParameterMappings().ToList(), actualProperty.GetUpdateStoredProcedureParameterMappings(),
+            () => Assert.Equal(expectedProperty.GetUpdateStoredProcedureParameterMappings().Select(x => x),
+                actualProperty.GetUpdateStoredProcedureParameterMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetUpdateStoredProcedureResultColumnMappings().ToList(), actualProperty.GetUpdateStoredProcedureResultColumnMappings(),
+            () => Assert.Equal(expectedProperty.GetUpdateStoredProcedureResultColumnMappings().Select(x => x),
+                actualProperty.GetUpdateStoredProcedureResultColumnMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
                     return true;
                 }),
-            () => Assert.Equal(expectedProperty.GetDeleteStoredProcedureParameterMappings().ToList(), actualProperty.GetDeleteStoredProcedureParameterMappings(),
+            () => Assert.Equal(expectedProperty.GetDeleteStoredProcedureParameterMappings().Select(x => x),
+                actualProperty.GetDeleteStoredProcedureParameterMappings(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Column.Table.SchemaQualifiedName, actual.Column.Table.SchemaQualifiedName);
@@ -719,7 +751,8 @@ public class RelationalModelAsserter : ModelAsserter
 
         Assert.Multiple(
             () => Assert.Equal(expected.GetConstraintName(), actual.GetConstraintName()),
-            () => Assert.Equal(expectedForeignKey.GetMappedConstraints().ToList(), actualForeignKey.GetMappedConstraints(),
+            () => Assert.Equal(expectedForeignKey.GetMappedConstraints().Select(x => x),
+                actualForeignKey.GetMappedConstraints(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
@@ -753,7 +786,8 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => Assert.Equal(expected.GetDatabaseName(), actual.GetDatabaseName()),
             () => Assert.Equal(expected.GetFilter(), actual.GetFilter()),
-            () => Assert.Equal(expectedIndex.GetMappedTableIndexes().ToList(), actualIndex.GetMappedTableIndexes(),
+            () => Assert.Equal(expectedIndex.GetMappedTableIndexes().Select(x => x),
+                actualIndex.GetMappedTableIndexes(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
@@ -786,7 +820,8 @@ public class RelationalModelAsserter : ModelAsserter
 
         Assert.Multiple(
             () => Assert.Equal(expected.GetName(), actual.GetName()),
-            () => Assert.Equal(expectedKey.GetMappedConstraints().ToList(), actualKey.GetMappedConstraints(),
+            () => Assert.Equal(expectedKey.GetMappedConstraints().Select(x => x),
+                actualKey.GetMappedConstraints(),
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Table.SchemaQualifiedName, actual.Table.SchemaQualifiedName);
@@ -831,7 +866,7 @@ public class RelationalModelAsserter : ModelAsserter
                     Assert.Equal(expected.Collation, actual.Collation);
                 }
             },
-            () => Assert.Equal(expectedModel.DefaultTables.Values, actualModel.DefaultTables.Values,
+            () => Assert.Equal(expectedModel.DefaultTables.Values.Select(x => x), actualModel.DefaultTables.Values,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -839,7 +874,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.Tables, actual.Tables,
+            () => Assert.Equal(expected.Tables.Select(x => x), actual.Tables,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -847,7 +882,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.Views, actual.Views,
+            () => Assert.Equal(expected.Views.Select(x => x), actual.Views,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -855,7 +890,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.Queries, actual.Queries,
+            () => Assert.Equal(expected.Queries.Select(x => x), actual.Queries,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -863,7 +898,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.Functions, actual.Functions,
+            () => Assert.Equal(expected.Functions.Select(x => x), actual.Functions,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -871,7 +906,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.StoredProcedures, actual.StoredProcedures,
+            () => Assert.Equal(expected.StoredProcedures.Select(x => x), actual.StoredProcedures,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -879,7 +914,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.Sequences, actual.Sequences,
+            () => Assert.Equal(expected.Sequences.Select(x => x), actual.Sequences,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -938,7 +973,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.EntityTypeMappings.ToList(), actual.EntityTypeMappings,
+            () => Assert.Equal(expected.EntityTypeMappings.Select(x => x), actual.EntityTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -946,7 +981,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.ComplexTypeMappings.ToList(), actual.ComplexTypeMappings,
+            () => Assert.Equal(expected.ComplexTypeMappings.Select(x => x), actual.ComplexTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -968,7 +1003,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations, compareMemberAnnotations),
             () => Assert.Same(actual, actual.Model.FindTable(actual.Name, actual.Schema)),
-            () => Assert.Equal(expected.Columns, actual.Columns,
+            () => Assert.Equal(expected.Columns.Select(x => x), actual.Columns,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -976,42 +1011,42 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.Indexes, actual.Indexes,
+            () => Assert.Equal(expected.Indexes.Select(x => x), actual.Indexes,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
                         actual,
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>())),
-            () => Assert.Equal(expected.ForeignKeyConstraints.ToList(), actual.ForeignKeyConstraints,
+            () => Assert.Equal(expected.ForeignKeyConstraints.Select(x => x), actual.ForeignKeyConstraints,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
                         actual,
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>())),
-            () => Assert.Equal(expected.ReferencingForeignKeyConstraints.ToList(), actual.ReferencingForeignKeyConstraints,
+            () => Assert.Equal(expected.ReferencingForeignKeyConstraints.Select(x => x), actual.ReferencingForeignKeyConstraints,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
                         actual,
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>())),
-            () => Assert.Equal(expected.UniqueConstraints, actual.UniqueConstraints,
+            () => Assert.Equal(expected.UniqueConstraints.Select(x => x), actual.UniqueConstraints,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
                         actual,
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>())),
-            () => Assert.Equal(expected.Triggers, actual.Triggers,
+            () => Assert.Equal(expected.Triggers.Select(x => x), actual.Triggers,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
                         actual,
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>())),
-            () => Assert.Equal(expected.EntityTypeMappings.ToList(), actual.EntityTypeMappings,
+            () => Assert.Equal(expected.EntityTypeMappings.Select(x => x), actual.EntityTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1019,7 +1054,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.ComplexTypeMappings.ToList(), actual.ComplexTypeMappings,
+            () => Assert.Equal(expected.ComplexTypeMappings.Select(x => x), actual.ComplexTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1041,7 +1076,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations, compareMemberAnnotations),
             () => Assert.Same(actual, actual.Model.FindView(actual.Name, actual.Schema)),
-            () => Assert.Equal(expected.Columns, actual.Columns,
+            () => Assert.Equal(expected.Columns.Select(x => x), actual.Columns,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1049,7 +1084,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.EntityTypeMappings.ToList(), actual.EntityTypeMappings,
+            () => Assert.Equal(expected.EntityTypeMappings.Select(x => x), actual.EntityTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1057,7 +1092,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.ComplexTypeMappings.ToList(), actual.ComplexTypeMappings,
+            () => Assert.Equal(expected.ComplexTypeMappings.Select(x => x), actual.ComplexTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1080,7 +1115,7 @@ public class RelationalModelAsserter : ModelAsserter
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations, compareMemberAnnotations),
             () => Assert.Equal(expected.Sql, actual.Sql),
             () => Assert.Same(actual, actual.Model.FindQuery(actual.Name)),
-            () => Assert.Equal(expected.Columns, actual.Columns,
+            () => Assert.Equal(expected.Columns.Select(x => x), actual.Columns,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1088,7 +1123,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.EntityTypeMappings.ToList(), actual.EntityTypeMappings,
+            () => Assert.Equal(expected.EntityTypeMappings.Select(x => x), actual.EntityTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1096,7 +1131,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.ComplexTypeMappings.ToList(), actual.ComplexTypeMappings,
+            () => Assert.Equal(expected.ComplexTypeMappings.Select(x => x), actual.ComplexTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1124,7 +1159,7 @@ public class RelationalModelAsserter : ModelAsserter
             () => Assert.Equal(
                 actual.DbFunctions.Select(p => p.ModelName),
                 expected.DbFunctions.Select(p => p.ModelName)),
-            () => Assert.Equal(expected.Parameters, actual.Parameters,
+            () => Assert.Equal(expected.Parameters.Select(x => x), actual.Parameters,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1132,7 +1167,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.Columns, actual.Columns,
+            () => Assert.Equal(expected.Columns.Select(x => x), actual.Columns,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1140,7 +1175,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.EntityTypeMappings.ToList(), actual.EntityTypeMappings,
+            () => Assert.Equal(expected.EntityTypeMappings.Select(x => x), actual.EntityTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1148,7 +1183,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.ComplexTypeMappings.ToList(), actual.ComplexTypeMappings,
+            () => Assert.Equal(expected.ComplexTypeMappings.Select(x => x), actual.ComplexTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1183,7 +1218,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>());
                     Assert.Same(actual, actual.ReturnValue.StoredProcedure);
-                    Assert.Equal(expected.ReturnValue.PropertyMappings, actual.ReturnValue.PropertyMappings,
+                    Assert.Equal(expected.ReturnValue.PropertyMappings.Select(x => x), actual.ReturnValue.PropertyMappings,
                         (expected, actual) =>
                             AssertEqual(
                                 expected,
@@ -1196,7 +1231,7 @@ public class RelationalModelAsserter : ModelAsserter
                     Assert.Null(actual.ReturnValue);
                 }
             },
-            () => Assert.Equal(expected.Parameters, actual.Parameters,
+            () => Assert.Equal(expected.Parameters.Select(x => x), actual.Parameters,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1204,7 +1239,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.ResultColumns, actual.ResultColumns,
+            () => Assert.Equal(expected.ResultColumns.Select(x => x), actual.ResultColumns,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1212,7 +1247,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.EntityTypeMappings.ToList(), actual.EntityTypeMappings,
+            () => Assert.Equal(expected.EntityTypeMappings.Select(x => x), actual.EntityTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1220,7 +1255,7 @@ public class RelationalModelAsserter : ModelAsserter
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations)),
-            () => Assert.Equal(expected.ComplexTypeMappings.ToList(), actual.ComplexTypeMappings,
+            () => Assert.Equal(expected.ComplexTypeMappings.Select(x => x), actual.ComplexTypeMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1258,7 +1293,7 @@ public class RelationalModelAsserter : ModelAsserter
     {
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
-            () => Assert.Equal(expected.ColumnMappings, actual.ColumnMappings,
+            () => Assert.Equal(expected.ColumnMappings.Select(x => x), actual.ColumnMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1281,7 +1316,7 @@ public class RelationalModelAsserter : ModelAsserter
             () => AssertEqual(expected.DeleteStoredProcedureMapping, actual.DeleteStoredProcedureMapping, compareMemberAnnotations),
             () => AssertEqual(expected.InsertStoredProcedureMapping, actual.InsertStoredProcedureMapping, compareMemberAnnotations),
             () => AssertEqual(expected.UpdateStoredProcedureMapping, actual.UpdateStoredProcedureMapping, compareMemberAnnotations),
-            () => Assert.Equal(expected.ColumnMappings, actual.ColumnMappings,
+            () => Assert.Equal(expected.ColumnMappings.Select(x => x), actual.ColumnMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1301,7 +1336,7 @@ public class RelationalModelAsserter : ModelAsserter
     {
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
-            () => Assert.Equal(expected.ColumnMappings, actual.ColumnMappings,
+            () => Assert.Equal(expected.ColumnMappings.Select(x => x), actual.ColumnMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1322,7 +1357,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Equal(expected.IsDefaultSqlQueryMapping, actual.IsDefaultSqlQueryMapping),
-            () => Assert.Equal(expected.ColumnMappings, actual.ColumnMappings,
+            () => Assert.Equal(expected.ColumnMappings.Select(x => x), actual.ColumnMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1343,7 +1378,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Equal(expected.IsDefaultFunctionMapping, actual.IsDefaultFunctionMapping),
-            () => Assert.Equal(expected.ColumnMappings, actual.ColumnMappings,
+            () => Assert.Equal(expected.ColumnMappings.Select(x => x), actual.ColumnMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1384,14 +1419,14 @@ public class RelationalModelAsserter : ModelAsserter
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Equal(expected.StoredProcedure.GetSchemaQualifiedName(), actual.StoredProcedure.GetSchemaQualifiedName()),
             () => Assert.Contains(expected.TableMapping?.Table.SchemaQualifiedName, actual.TableMapping?.Table.SchemaQualifiedName),
-            () => Assert.Equal(expected.ResultColumnMappings, actual.ResultColumnMappings,
+            () => Assert.Equal(expected.ResultColumnMappings.Select(x => x), actual.ResultColumnMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
                         actual,
                         compareMemberAnnotations ? expected.GetAnnotations() : Enumerable.Empty<IAnnotation>(),
                         compareMemberAnnotations ? actual.GetAnnotations() : Enumerable.Empty<IAnnotation>())),
-            () => Assert.Equal(expected.ParameterMappings, actual.ParameterMappings,
+            () => Assert.Equal(expected.ParameterMappings.Select(x => x), actual.ParameterMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1429,7 +1464,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Same(actual, actual.Table.FindColumn(actual.Name)),
-            () => Assert.Equal(expected.PropertyMappings, actual.PropertyMappings,
+            () => Assert.Equal(expected.PropertyMappings.Select(x => x), actual.PropertyMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1450,7 +1485,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Same(actual, actual.Table.FindColumn(actual.Name)),
-            () => Assert.Equal(expected.PropertyMappings, actual.PropertyMappings,
+            () => Assert.Equal(expected.PropertyMappings.Select(x => x), actual.PropertyMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1471,7 +1506,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Same(actual, actual.View.FindColumn(actual.Name)),
-            () => Assert.Equal(expected.PropertyMappings, actual.PropertyMappings,
+            () => Assert.Equal(expected.PropertyMappings.Select(x => x), actual.PropertyMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1492,7 +1527,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Same(actual, actual.SqlQuery.FindColumn(actual.Name)),
-            () => Assert.Equal(expected.PropertyMappings, actual.PropertyMappings,
+            () => Assert.Equal(expected.PropertyMappings.Select(x => x), actual.PropertyMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1513,7 +1548,7 @@ public class RelationalModelAsserter : ModelAsserter
         Assert.Multiple(
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Same(actual, actual.Function.FindColumn(actual.Name)),
-            () => Assert.Equal(expected.PropertyMappings, actual.PropertyMappings,
+            () => Assert.Equal(expected.PropertyMappings.Select(x => x), actual.PropertyMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1535,7 +1570,7 @@ public class RelationalModelAsserter : ModelAsserter
             () => Assert.Equal(expected.Name, actual.Name),
             () => Assert.Equal(expected.StoreType, actual.StoreType),
             () => Assert.Contains(actual, actual.Function.Parameters),
-            () => Assert.Equal(expected.DbFunctionParameters, actual.DbFunctionParameters,
+            () => Assert.Equal(expected.DbFunctionParameters.Select(x => x), actual.DbFunctionParameters,
                 (expected, actual) =>
                 {
                     Assert.Equal(expected.Name, actual.Name);
@@ -1557,7 +1592,7 @@ public class RelationalModelAsserter : ModelAsserter
             () => AssertEqualBase(expected, actual, expectedAnnotations, actualAnnotations),
             () => Assert.Equal(expected.Position, actual.Position),
             () => Assert.Same(actual, actual.StoredProcedure.FindResultColumn(actual.Name)),
-            () => Assert.Equal(expected.PropertyMappings, actual.PropertyMappings,
+            () => Assert.Equal(expected.PropertyMappings.Select(x => x), actual.PropertyMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
@@ -1580,7 +1615,7 @@ public class RelationalModelAsserter : ModelAsserter
             () => Assert.Equal(expected.Position, actual.Position),
             () => Assert.Equal(expected.Direction, actual.Direction),
             () => Assert.Same(actual, actual.StoredProcedure.FindParameter(actual.Name)),
-            () => Assert.Equal(expected.PropertyMappings, actual.PropertyMappings,
+            () => Assert.Equal(expected.PropertyMappings.Select(x => x), actual.PropertyMappings,
                 (expected, actual) =>
                     AssertEqual(
                         expected,
diff --git a/test/EFCore.Specification.Tests/StoreGeneratedTestBase.cs b/test/EFCore.Specification.Tests/StoreGeneratedTestBase.cs
index 2acdb97d08..501f690940 100644
--- a/test/EFCore.Specification.Tests/StoreGeneratedTestBase.cs
+++ b/test/EFCore.Specification.Tests/StoreGeneratedTestBase.cs
@@ -83,7 +83,7 @@ public virtual void Before_save_throw_always_throws_if_value_set(string property
     [InlineData(nameof(Anais.OnUpdateThrowBeforeUseAfter), "Rabbit")]
     [InlineData(nameof(Anais.OnUpdateThrowBeforeIgnoreAfter), "Rabbit")]
     [InlineData(nameof(Anais.OnUpdateThrowBeforeThrowAfter), "Rabbit")]
-    public virtual void Before_save_throw_ignores_value_if_not_set(string propertyName, string expectedValue)
+    public virtual void Before_save_throw_ignores_value_if_not_set(string propertyName, string? expectedValue)
     {
         var id = 0;
         ExecuteWithStrategyInTransaction(
@@ -179,7 +179,7 @@ public virtual void Before_save_use_ignores_value_if_not_set(string propertyName
     [InlineData(nameof(Anais.OnUpdateIgnoreBeforeUseAfter), "Rabbit")]
     [InlineData(nameof(Anais.OnUpdateIgnoreBeforeIgnoreAfter), "Rabbit")]
     [InlineData(nameof(Anais.OnUpdateIgnoreBeforeThrowAfter), "Rabbit")]
-    public virtual void Before_save_ignore_ignores_value_if_not_set(string propertyName, string expectedValue)
+    public virtual void Before_save_ignore_ignores_value_if_not_set(string propertyName, string? expectedValue)
     {
         var id = 0;
         ExecuteWithStrategyInTransaction(
@@ -208,7 +208,7 @@ public virtual void Before_save_ignore_ignores_value_if_not_set(string propertyN
     [InlineData(nameof(Anais.OnUpdateIgnoreBeforeUseAfter), "Rabbit")]
     [InlineData(nameof(Anais.OnUpdateIgnoreBeforeIgnoreAfter), "Rabbit")]
     [InlineData(nameof(Anais.OnUpdateIgnoreBeforeThrowAfter), "Rabbit")]
-    public virtual void Before_save_ignore_ignores_value_even_if_set(string propertyName, string expectedValue)
+    public virtual void Before_save_ignore_ignores_value_even_if_set(string propertyName, string? expectedValue)
     {
         var id = 0;
         ExecuteWithStrategyInTransaction(
diff --git a/test/EFCore.VisualBasic.FunctionalTests/EFCore.VisualBasic.FunctionalTests.vbproj b/test/EFCore.VisualBasic.FunctionalTests/EFCore.VisualBasic.FunctionalTests.vbproj
index 552e99becd..6b860b8698 100644
--- a/test/EFCore.VisualBasic.FunctionalTests/EFCore.VisualBasic.FunctionalTests.vbproj
+++ b/test/EFCore.VisualBasic.FunctionalTests/EFCore.VisualBasic.FunctionalTests.vbproj
@@ -2,7 +2,7 @@
 
   <PropertyGroup>
     <RootNamespace>Microsoft.EntityFrameworkCore</RootNamespace>
-    <TargetFramework>net8.0</TargetFramework>
+    <TargetFramework>$(DefaultNetCoreTargetFramework)</TargetFramework>
     <AssemblyName>Microsoft.EntityFrameworkCore.VisualBasic.FunctionalTests</AssemblyName>
     <SkipTests Condition="'$(OS)' != 'Windows_NT' AND '$(Test__SqlServer__DefaultConnection)' == ''">True</SkipTests>
     <LangVersion>latest</LangVersion>
diff --git a/test/Microsoft.Data.Sqlite.Tests/SqliteConnectionStringBuilderTest.cs b/test/Microsoft.Data.Sqlite.Tests/SqliteConnectionStringBuilderTest.cs
index b43cd5f4e2..8f6fab10c7 100644
--- a/test/Microsoft.Data.Sqlite.Tests/SqliteConnectionStringBuilderTest.cs
+++ b/test/Microsoft.Data.Sqlite.Tests/SqliteConnectionStringBuilderTest.cs
@@ -241,7 +241,7 @@ public void Item_throws_when_cannot_convert_to_enum_on_set(object value)
     [InlineData("False", false)]
     [InlineData(null, null)]
     [InlineData("", null)]
-    public void Item_converts_to_bool_on_set(object value, bool? expected)
+    public void Item_converts_to_bool_on_set(object? value, bool? expected)
     {
         var builder = new SqliteConnectionStringBuilder();
 
diff --git a/test/Microsoft.Data.Sqlite.Tests/SqliteConnectionTest.cs b/test/Microsoft.Data.Sqlite.Tests/SqliteConnectionTest.cs
index e931423473..c0dfcec233 100644
--- a/test/Microsoft.Data.Sqlite.Tests/SqliteConnectionTest.cs
+++ b/test/Microsoft.Data.Sqlite.Tests/SqliteConnectionTest.cs
@@ -1205,11 +1205,11 @@ public void GetSchema_works_when_no_args()
     [InlineData("")]
     [InlineData(" ")]
     [InlineData("Unknown")]
-    public void GetSchema_throws_when_unknown_collection(string collectionName)
+    public void GetSchema_throws_when_unknown_collection(string? collectionName)
     {
         using var connection = new SqliteConnection("Data Source=:memory:");
 
-        var ex = Assert.Throws<ArgumentException>(() => connection.GetSchema(collectionName));
+        var ex = Assert.Throws<ArgumentException>(() => connection.GetSchema(collectionName!));
 
         Assert.Equal(Resources.UnknownCollection(collectionName), ex.Message);
     }
