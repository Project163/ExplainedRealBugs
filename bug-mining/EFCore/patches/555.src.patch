diff --git a/src/EFCore.Relational/Query/RelationalShapedQueryCompilingExpressionVisitor.cs b/src/EFCore.Relational/Query/RelationalShapedQueryCompilingExpressionVisitor.cs
index 192f224b99..2250db9b03 100644
--- a/src/EFCore.Relational/Query/RelationalShapedQueryCompilingExpressionVisitor.cs
+++ b/src/EFCore.Relational/Query/RelationalShapedQueryCompilingExpressionVisitor.cs
@@ -265,7 +265,7 @@ protected override Expression VisitShapedQuery(ShapedQueryExpression shapedQuery
 
         if (shapedQueryExpression.ShaperExpression is RelationalGroupByResultExpression relationalGroupByResultExpression)
         {
-            var elementSelector = new ShaperProcessingExpressionVisitor(this, selectExpression, selectExpression.Tags, splitQuery, false)
+            var elementSelector = new ShaperProcessingExpressionVisitor(this, selectExpression, _tags, splitQuery, indexMap: false)
                 .ProcessRelationalGroupingResult(
                     relationalGroupByResultExpression,
                     out var relationalCommandResolver,
diff --git a/test/EFCore.InMemory.FunctionalTests/Query/NorthwindGroupByQueryInMemoryTest.cs b/test/EFCore.InMemory.FunctionalTests/Query/NorthwindGroupByQueryInMemoryTest.cs
index 0cbdbec62c..1e7af050b3 100644
--- a/test/EFCore.InMemory.FunctionalTests/Query/NorthwindGroupByQueryInMemoryTest.cs
+++ b/test/EFCore.InMemory.FunctionalTests/Query/NorthwindGroupByQueryInMemoryTest.cs
@@ -67,4 +67,9 @@ public override Task Final_GroupBy_property_entity_projecting_collection_and_sin
         => AssertTranslationFailedWithDetails(
             () => base.Final_GroupBy_property_entity_projecting_collection_and_single_result(async),
             InMemoryStrings.NonComposedGroupByNotSupported);
+
+    public override Task Final_GroupBy_TagWith(bool async)
+        => AssertTranslationFailedWithDetails(
+            () => base.Final_GroupBy_TagWith(async),
+            InMemoryStrings.NonComposedGroupByNotSupported);
 }
diff --git a/test/EFCore.Specification.Tests/Query/NorthwindGroupByQueryTestBase.cs b/test/EFCore.Specification.Tests/Query/NorthwindGroupByQueryTestBase.cs
index d123b7027b..ee4db2c2cb 100644
--- a/test/EFCore.Specification.Tests/Query/NorthwindGroupByQueryTestBase.cs
+++ b/test/EFCore.Specification.Tests/Query/NorthwindGroupByQueryTestBase.cs
@@ -2758,6 +2758,15 @@ public virtual Task Final_GroupBy_property_entity_projecting_collection_and_sing
                     AssertEqual(ee.LastOrder, aa.LastOrder);
                 }));
 
+    [ConditionalTheory]
+    [MemberData(nameof(IsAsyncData))]
+    public virtual Task Final_GroupBy_TagWith(bool async)
+        => AssertQuery(
+            async,
+            ss => ss.Set<Customer>().TagWith("foo").GroupBy(c => c.City),
+            elementSorter: e => e.Key,
+            elementAsserter: (e, a) => AssertGrouping(e, a));
+
     #endregion
 
     #region GroupByWithoutAggregate
diff --git a/test/EFCore.Specification.Tests/Query/NorthwindQueryTaggingQueryTestBase.cs b/test/EFCore.Specification.Tests/Query/NorthwindQueryTaggingQueryTestBase.cs
index 1a8af0cf61..4a533a5623 100644
--- a/test/EFCore.Specification.Tests/Query/NorthwindQueryTaggingQueryTestBase.cs
+++ b/test/EFCore.Specification.Tests/Query/NorthwindQueryTaggingQueryTestBase.cs
@@ -148,6 +148,8 @@ var customer
         Assert.NotNull(customer);
     }
 
+    // See also NorthwindGroupByQueryTestBase.Final_GroupBy_TagWith
+
     protected NorthwindContext CreateContext()
         => Fixture.CreateContext();
 }
diff --git a/test/EFCore.SqlServer.FunctionalTests/Query/NorthwindGroupByQuerySqlServerTest.cs b/test/EFCore.SqlServer.FunctionalTests/Query/NorthwindGroupByQuerySqlServerTest.cs
index 303d51362e..3ade710428 100644
--- a/test/EFCore.SqlServer.FunctionalTests/Query/NorthwindGroupByQuerySqlServerTest.cs
+++ b/test/EFCore.SqlServer.FunctionalTests/Query/NorthwindGroupByQuerySqlServerTest.cs
@@ -3595,6 +3595,8 @@ public override async Task GroupBy_aggregate_SelectMany(bool async)
         AssertSql();
     }
 
+    #region FinalGroupBy
+
     public override async Task Final_GroupBy_property_entity(bool async)
     {
         await base.Final_GroupBy_property_entity(async);
@@ -3772,6 +3774,22 @@ public override async Task Final_GroupBy_property_entity_projecting_collection_a
 """);
     }
 
+    public override async Task Final_GroupBy_TagWith(bool async)
+    {
+        await base.Final_GroupBy_TagWith(async);
+
+        AssertSql(
+            """
+-- foo
+
+SELECT [c].[City], [c].[CustomerID], [c].[Address], [c].[CompanyName], [c].[ContactName], [c].[ContactTitle], [c].[Country], [c].[Fax], [c].[Phone], [c].[PostalCode], [c].[Region]
+FROM [Customers] AS [c]
+ORDER BY [c].[City]
+""");
+    }
+
+    #endregion FinalGroupBy
+
     public override async Task GroupBy_Where_with_grouping_result(bool async)
     {
         await base.GroupBy_Where_with_grouping_result(async);
