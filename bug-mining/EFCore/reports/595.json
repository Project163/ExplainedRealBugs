{"url":"https://api.github.com/repos/dotnet/efcore/issues/35174","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/35174/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/35174/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/35174/events","html_url":"https://github.com/dotnet/efcore/issues/35174","id":2680043212,"node_id":"I_kwDOAPaMMs6fvjbM","number":35174,"title":"ASPNETCORE_ENVIRONMENT does not default to Development when using EF Core 9 if there is a IDesignTimeDbContextFactory implementation","user":{"login":"Pilchard123","id":11312118,"node_id":"MDQ6VXNlcjExMzEyMTE4","avatar_url":"https://avatars.githubusercontent.com/u/11312118?v=4","gravatar_id":"","url":"https://api.github.com/users/Pilchard123","html_url":"https://github.com/Pilchard123","followers_url":"https://api.github.com/users/Pilchard123/followers","following_url":"https://api.github.com/users/Pilchard123/following{/other_user}","gists_url":"https://api.github.com/users/Pilchard123/gists{/gist_id}","starred_url":"https://api.github.com/users/Pilchard123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Pilchard123/subscriptions","organizations_url":"https://api.github.com/users/Pilchard123/orgs","repos_url":"https://api.github.com/users/Pilchard123/repos","events_url":"https://api.github.com/users/Pilchard123/events{/privacy}","received_events_url":"https://api.github.com/users/Pilchard123/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":514908713,"node_id":"MDU6TGFiZWw1MTQ5MDg3MTM=","url":"https://api.github.com/repos/dotnet/efcore/labels/regression","name":"regression","color":"ff1fff","default":false,"description":null},{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900942474,"node_id":"MDU6TGFiZWwxOTAwOTQyNDc0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-migrations","name":"area-migrations","color":"32b37b","default":false,"description":""},{"id":1900945658,"node_id":"MDU6TGFiZWwxOTAwOTQ1NjU4","url":"https://api.github.com/repos/dotnet/efcore/labels/area-tools","name":"area-tools","color":"32b37b","default":false,"description":""},{"id":8130499638,"node_id":"LA_kwDOAPaMMs8AAAAB5J2UNg","url":"https://api.github.com/repos/dotnet/efcore/labels/preview-1","name":"preview-1","color":"ACB3D7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/208","html_url":"https://github.com/dotnet/efcore/milestone/208","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/208/labels","id":11959183,"node_id":"MI_kwDOAPaMMs4AtnuP","number":208,"title":"9.0.1","description":"","creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":21,"state":"closed","created_at":"2024-11-27T13:18:00Z","updated_at":"2025-02-05T21:51:51Z","due_on":null,"closed_at":"2025-02-05T21:49:40Z"},"comments":0,"created_at":"2024-11-21T16:05:04Z","updated_at":"2025-06-15T20:12:14Z","closed_at":"2024-12-06T01:42:29Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Running `dotnet ef database update` while using EF Core 8.0.11 or earlier used to set ASPNETCORE_ENVIRONMENT and DOTNET_ENVIRONMENT to \"Development\" if it was not explicitly specified. On updating to EF Core 9, those do not default if there is an implementation of `IDesignTimeDbContextFactory`. The version of dotnet-ef (at least between 9.0.0 and 8.0.11) does not seem to matter.\n\n[I believe this is the code in question](https://github.com/dotnet/efcore/blob/a4a350a6f77f6260a7f2f2bbd3fe91e5502a3540/src/EFCore.Design/Design/Internal/AppServiceProviderFactory.cs#L60), though I haven't managed to chase down why it's not being hit for 9.0.0 with `IDesignTimeDbContextFactory`.\n\n[This project](https://github.com/user-attachments/files/17848539/Repro.zip) can be manipulated to reproduce the issue, though I've also included some relevant tool output from `dotnet ef database update --project .\\ReproTest\\ --verbose` below.\n\nMy current workaround is to explicitly set the Environment as described at https://learn.microsoft.com/en-us/ef/core/cli/dotnet#aspnet-core-environment .\n\n### Provider and version information\n\nEF Core version:\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\nTarget framework: .NET 8 and 9\nOperating system: Windows 11 23H2, 22631.4460\nIDE: Visual Studio 2022 17.12.0\n\n### Log output\n\n**EF Core 8.0.11, no IDesignTimeDbContextFactory - WORKS**\n```\nUsing project 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj'.\nUsing startup project 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj'.\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\FakeUserProfiles\\richard.ward\\temp\\tmpwotm5q.tmp /verbosity:quiet /nologo C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\FakeUserProfiles\\richard.ward\\temp\\tmpg2k1nh.tmp /verbosity:quiet /nologo C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj\nBuild started...\ndotnet build C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj /verbosity:quiet /nologo /p:PublishAot=false\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:06.17\n\nBuild succeeded.\ndotnet exec --depsfile C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.deps.json --additionalprobingpath C:\\FakeUserProfiles\\richard.ward\\nuget --additionalprobingpath \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\NuGetPackages\" --runtimeconfig C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.runtimeconfig.json C:\\FakeUserProfiles\\richard.ward\\nuget\\dotnet-ef\\9.0.0\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll database update --assembly C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.dll --project C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj --startup-assembly C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.dll --startup-project C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj --project-dir C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ --root-namespace ReproTest --language C# --framework net9.0 --nullable --working-dir C:\\FakeUserProfiles\\richard.ward\\repos\\Test --verbose\nUsing assembly 'ReproTest'.\nUsing startup assembly 'ReproTest'.\nUsing application base 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0'.\nUsing working directory 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest'.\nUsing root namespace 'ReproTest'.\nUsing project directory 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\'.\nRemaining arguments: .\nFinding DbContext classes...\nFinding IDesignTimeDbContextFactory implementations...\nFinding application service provider in assembly 'ReproTest'...\nFinding Microsoft.Extensions.Hosting service provider...\nUsing environment 'Development'.\nUsing application service provider from Microsoft.Extensions.Hosting.\nFound DbContext 'TestDbContext'.\nFinding DbContext classes in the project...\nUsing context 'TestDbContext'.\nFinding design-time services referenced by assembly 'ReproTest'...\nFinding design-time services referenced by assembly 'ReproTest'...\nNo referenced design-time services were found.\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\nFinding IDesignTimeServices implementations in assembly 'ReproTest'...\nNo design-time services were found.\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (23ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT 1\nExecuted DbCommand (23ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT 1\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (18ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT OBJECT_ID(N'[__EFMigrationsHistory]');\nExecuted DbCommand (18ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT 1\nExecuted DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT 1\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT OBJECT_ID(N'[__EFMigrationsHistory]');\nExecuted DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (3ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT [MigrationId], [ProductVersion]\n      FROM [__EFMigrationsHistory]\n      ORDER BY [MigrationId];\nExecuted DbCommand (3ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT [MigrationId], [ProductVersion]\nFROM [__EFMigrationsHistory]\nORDER BY [MigrationId];\ninfo: Microsoft.EntityFrameworkCore.Migrations[20405]\n      No migrations were applied. The database is already up to date.\nNo migrations were applied. The database is already up to date.\nDone.\n```\n\n**EF Core 8.0.11, with IDesignTimeDbContextFactory - WORKS**\n```\nUsing project 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj'.\nUsing startup project 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj'.\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\FakeUserProfiles\\richard.ward\\temp\\tmpl42vyr.tmp /verbosity:quiet /nologo C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\FakeUserProfiles\\richard.ward\\temp\\tmpyp4ywh.tmp /verbosity:quiet /nologo C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj\nBuild started...\ndotnet build C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj /verbosity:quiet /nologo /p:PublishAot=false\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:05.10\n\nBuild succeeded.\ndotnet exec --depsfile C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.deps.json --additionalprobingpath C:\\FakeUserProfiles\\richard.ward\\nuget --additionalprobingpath \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\NuGetPackages\" --runtimeconfig C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.runtimeconfig.json C:\\FakeUserProfiles\\richard.ward\\nuget\\dotnet-ef\\9.0.0\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll database update --assembly C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.dll --project C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj --startup-assembly C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.dll --startup-project C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj --project-dir C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ --root-namespace ReproTest --language C# --framework net9.0 --nullable --working-dir C:\\FakeUserProfiles\\richard.ward\\repos\\Test --verbose\nUsing assembly 'ReproTest'.\nUsing startup assembly 'ReproTest'.\nUsing application base 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0'.\nUsing working directory 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest'.\nUsing root namespace 'ReproTest'.\nUsing project directory 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\'.\nRemaining arguments: .\nFinding DbContext classes...\nFinding IDesignTimeDbContextFactory implementations...\nFound IDesignTimeDbContextFactory implementation 'DesignTimeContextFactory'.\nFound DbContext 'TestDbContext'.\nFinding application service provider in assembly 'ReproTest'...\nFinding Microsoft.Extensions.Hosting service provider...\nUsing environment 'Development'.\nUsing application service provider from Microsoft.Extensions.Hosting.\nFinding DbContext classes in the project...\nUsing DbContext factory 'DesignTimeContextFactory'.\nUsing context 'TestDbContext'.\nFinding design-time services referenced by assembly 'ReproTest'...\nFinding design-time services referenced by assembly 'ReproTest'...\nNo referenced design-time services were found.\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\nFinding IDesignTimeServices implementations in assembly 'ReproTest'...\nNo design-time services were found.\nCreating DbConnection.\nCreated DbConnection. (50ms).\nMigrating using database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nOpening connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nOpened connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nCreating DbCommand for 'ExecuteNonQuery'.\nCreated DbCommand for 'ExecuteNonQuery' (9ms).\nInitialized DbCommand for 'ExecuteNonQuery' (17ms).\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT 1\nExecuted DbCommand (29ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT 1\nClosing connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nClosed connection to database 'TestDb' on server '(localdb)\\mssqllocaldb' (7ms).\nCreating DbCommand for 'ExecuteScalar'.\nCreated DbCommand for 'ExecuteScalar' (2ms).\nInitialized DbCommand for 'ExecuteScalar' (4ms).\nOpening connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nOpened connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\nExecuted DbCommand (19ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\nClosing connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nClosed connection to database 'TestDb' on server '(localdb)\\mssqllocaldb' (2ms).\nOpening connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nOpened connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nCreating DbCommand for 'ExecuteNonQuery'.\nCreated DbCommand for 'ExecuteNonQuery' (0ms).\nInitialized DbCommand for 'ExecuteNonQuery' (1ms).\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT 1\nExecuted DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT 1\nClosing connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nClosed connection to database 'TestDb' on server '(localdb)\\mssqllocaldb' (0ms).\nCreating DbCommand for 'ExecuteScalar'.\nCreated DbCommand for 'ExecuteScalar' (0ms).\nInitialized DbCommand for 'ExecuteScalar' (1ms).\nOpening connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nOpened connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\nExecuted DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\nClosing connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nClosed connection to database 'TestDb' on server '(localdb)\\mssqllocaldb' (1ms).\nOpening connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nOpened connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nCreating DbCommand for 'ExecuteReader'.\nCreated DbCommand for 'ExecuteReader' (0ms).\nInitialized DbCommand for 'ExecuteReader' (1ms).\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT [MigrationId], [ProductVersion]\nFROM [__EFMigrationsHistory]\nORDER BY [MigrationId];\nExecuted DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT [MigrationId], [ProductVersion]\nFROM [__EFMigrationsHistory]\nORDER BY [MigrationId];\nClosing data reader to 'TestDb' on server '(localdb)\\mssqllocaldb'.\nA data reader for 'TestDb' on server '(localdb)\\mssqllocaldb' is being disposed after spending 4ms reading results.\nClosing connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nClosed connection to database 'TestDb' on server '(localdb)\\mssqllocaldb' (0ms).\nNo migrations were applied. The database is already up to date.\n'TestDbContext' disposed.\nDisposing connection to database 'TestDb' on server '(localdb)\\mssqllocaldb'.\nDisposed connection to database '' on server '' (1ms).\nDone.\n```\n\n**EF Core 9.0.0, no IDesignTimeDbContextFactory - WORKS**\n```\nUsing project 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj'.\nUsing startup project 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj'.\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\FakeUserProfiles\\richard.ward\\temp\\tmppuq5sx.tmp /verbosity:quiet /nologo C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\FakeUserProfiles\\richard.ward\\temp\\tmprbhnb1.tmp /verbosity:quiet /nologo C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj\nBuild started...\ndotnet build C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj /verbosity:quiet /nologo /p:PublishAot=false\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:06.05\n\nBuild succeeded.\ndotnet exec --depsfile C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.deps.json --additionalprobingpath C:\\FakeUserProfiles\\richard.ward\\nuget --additionalprobingpath \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\NuGetPackages\" --runtimeconfig C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.runtimeconfig.json C:\\FakeUserProfiles\\richard.ward\\nuget\\dotnet-ef\\9.0.0\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll database update --assembly C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.dll --project C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj --startup-assembly C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.dll --startup-project C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj --project-dir C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ --root-namespace ReproTest --language C# --framework net9.0 --nullable --working-dir C:\\FakeUserProfiles\\richard.ward\\repos\\Test --verbose\nUsing assembly 'ReproTest'.\nUsing startup assembly 'ReproTest'.\nUsing application base 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0'.\nUsing working directory 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest'.\nUsing root namespace 'ReproTest'.\nUsing project directory 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\'.\nRemaining arguments: .\nFinding DbContext classes...\nFinding IDesignTimeDbContextFactory implementations...\nFinding DbContext classes in the project...\nFound DbContext 'TestDbContext'.\nFinding application service provider in assembly 'ReproTest'...\nFinding Microsoft.Extensions.Hosting service provider...\nUsing environment 'Development'.\nUsing application service provider from Microsoft.Extensions.Hosting.\nUsing context 'TestDbContext'.\nFinding design-time services referenced by assembly 'ReproTest'...\nFinding design-time services referenced by assembly 'ReproTest'...\nNo referenced design-time services were found.\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\nFinding IDesignTimeServices implementations in assembly 'ReproTest'...\nNo design-time services were found.\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (22ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT 1\nExecuted DbCommand (22ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT 1\ninfo: Microsoft.EntityFrameworkCore.Migrations[20411]\n      Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.\nAcquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (24ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      DECLARE @result int;\n      EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';\n      SELECT @result\nExecuted DbCommand (24ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nDECLARE @result int;\nEXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';\nSELECT @result\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL\n      BEGIN\n          CREATE TABLE [__EFMigrationsHistory] (\n              [MigrationId] nvarchar(150) NOT NULL,\n              [ProductVersion] nvarchar(32) NOT NULL,\n              CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])\n          );\n      END;\nExecuted DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nIF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL\nBEGIN\n    CREATE TABLE [__EFMigrationsHistory] (\n        [MigrationId] nvarchar(150) NOT NULL,\n        [ProductVersion] nvarchar(32) NOT NULL,\n        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])\n    );\nEND;\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT 1\nExecuted DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT 1\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT OBJECT_ID(N'[__EFMigrationsHistory]');\nExecuted DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (3ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      SELECT [MigrationId], [ProductVersion]\n      FROM [__EFMigrationsHistory]\n      ORDER BY [MigrationId];\nExecuted DbCommand (3ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nSELECT [MigrationId], [ProductVersion]\nFROM [__EFMigrationsHistory]\nORDER BY [MigrationId];\nNo migrations were applied. The database is already up to date.\ninfo: Microsoft.EntityFrameworkCore.Migrations[20405]\n      No migrations were applied. The database is already up to date.\ninfo: Microsoft.EntityFrameworkCore.Database.Command[20101]\n      Executed DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\n      DECLARE @result int;\n      EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';\n      SELECT @result\nExecuted DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\nDECLARE @result int;\nEXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';\nSELECT @result\nDone.\n```\n\n**EF Core 9.0.0, with IDesignTimeDbContextFactory - DOES NOT WORK**\n```\nUsing project 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj'.\nUsing startup project 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj'.\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\FakeUserProfiles\\richard.ward\\temp\\tmp2r1lqx.tmp /verbosity:quiet /nologo C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\FakeUserProfiles\\richard.ward\\temp\\tmpfn3pxx.tmp /verbosity:quiet /nologo C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj\nBuild started...\ndotnet build C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj /verbosity:quiet /nologo /p:PublishAot=false\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:04.96\n\nBuild succeeded.\ndotnet exec --depsfile C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.deps.json --additionalprobingpath C:\\FakeUserProfiles\\richard.ward\\nuget --additionalprobingpath \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\NuGetPackages\" --runtimeconfig C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.runtimeconfig.json C:\\FakeUserProfiles\\richard.ward\\nuget\\dotnet-ef\\9.0.0\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll database update --assembly C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.dll --project C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj --startup-assembly C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0\\ReproTest.dll --startup-project C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ReproTest.csproj --project-dir C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\ --root-namespace ReproTest --language C# --framework net9.0 --nullable --working-dir C:\\FakeUserProfiles\\richard.ward\\repos\\Test --verbose\nUsing assembly 'ReproTest'.\nUsing startup assembly 'ReproTest'.\nUsing application base 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\bin\\Debug\\net9.0'.\nUsing working directory 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest'.\nUsing root namespace 'ReproTest'.\nUsing project directory 'C:\\FakeUserProfiles\\richard.ward\\repos\\Test\\ReproTest\\'.\nRemaining arguments: .\nFinding DbContext classes...\nFinding IDesignTimeDbContextFactory implementations...\nFound IDesignTimeDbContextFactory implementation 'DesignTimeContextFactory'.\nFound DbContext 'TestDbContext'.\nFinding DbContext classes in the project...\nUsing DbContext factory 'DesignTimeContextFactory'.\nUsing context 'TestDbContext'.\nFinding design-time services referenced by assembly 'ReproTest'...\nFinding design-time services referenced by assembly 'ReproTest'...\nNo referenced design-time services were found.\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\nFinding IDesignTimeServices implementations in assembly 'ReproTest'...\nNo design-time services were found.\nCreating DbConnection.\nCreated DbConnection. (18ms).\nMigrating using database '' on server ''.\nOpening connection to database '' on server ''.\nAn error occurred using the connection to database '' on server ''.\n'TestDbContext' disposed.\nDisposing connection to database '' on server ''.\nDisposed connection to database '' on server '' (4ms).\nSystem.InvalidOperationException: The ConnectionString property has not been initialized.\n   at Microsoft.Data.SqlClient.SqlConnection.PermissionDemand()\n   at Microsoft.Data.SqlClient.SqlConnectionFactory.PermissionDemand(DbConnection outerConnection)\n   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)\n   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)\n   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)\n   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)\n   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)\n   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerDatabaseCreator.<>c__DisplayClass18_0.<Exists>b__0(DateTime giveUp)\n   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c__DisplayClass12_0`2.<Execute>b__0(DbContext _, TState s)\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)\n   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.Execute[TState,TResult](IExecutionStrategy strategy, TState state, Func`2 operation, Func`2 verifySucceeded)\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerDatabaseCreator.Exists(Boolean retryOnNotExists)\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerDatabaseCreator.Exists()\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.UpdateDatabase(String targetMigration, String connectionString, String contextType)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabaseImpl(String targetMigration, String connectionString, String contextType)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabase.<>c__DisplayClass0_0.<.ctor>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\nThe ConnectionString property has not been initialized.\n```","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/35174/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/35174/timeline","performed_via_github_app":null,"state_reason":"completed"}