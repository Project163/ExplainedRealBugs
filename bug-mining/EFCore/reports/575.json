{"url":"https://api.github.com/repos/dotnet/efcore/issues/34996","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34996/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34996/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34996/events","html_url":"https://github.com/dotnet/efcore/issues/34996","id":2617874797,"node_id":"I_kwDOAPaMMs6cCZlt","number":34996,"title":"ReadOnlyCollection<string> with private backing field throws exception on NullabilityInfoContext when trying to add migration","user":{"login":"Red-F","id":486021,"node_id":"MDQ6VXNlcjQ4NjAyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/486021?v=4","gravatar_id":"","url":"https://api.github.com/users/Red-F","html_url":"https://github.com/Red-F","followers_url":"https://api.github.com/users/Red-F/followers","following_url":"https://api.github.com/users/Red-F/following{/other_user}","gists_url":"https://api.github.com/users/Red-F/gists{/gist_id}","starred_url":"https://api.github.com/users/Red-F/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Red-F/subscriptions","organizations_url":"https://api.github.com/users/Red-F/orgs","repos_url":"https://api.github.com/users/Red-F/repos","events_url":"https://api.github.com/users/Red-F/events{/privacy}","received_events_url":"https://api.github.com/users/Red-F/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900942474,"node_id":"MDU6TGFiZWwxOTAwOTQyNDc0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-migrations","name":"area-migrations","color":"32b37b","default":false,"description":""},{"id":8130499638,"node_id":"LA_kwDOAPaMMs8AAAAB5J2UNg","url":"https://api.github.com/repos/dotnet/efcore/labels/preview-1","name":"preview-1","color":"ACB3D7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/209","html_url":"https://github.com/dotnet/efcore/milestone/209","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/209/labels","id":12021339,"node_id":"MI_kwDOAPaMMs4At25b","number":209,"title":"9.0.2","description":null,"creator":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":7,"state":"closed","created_at":"2024-12-10T03:44:52Z","updated_at":"2025-02-05T21:49:43Z","due_on":null,"closed_at":"2025-02-05T21:49:43Z"},"comments":7,"created_at":"2024-10-28T09:43:04Z","updated_at":"2025-06-15T20:11:13Z","closed_at":"2025-01-16T01:55:56Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Adding a Migration throws 'System.InvalidOperationException'\n\nAfter adding a new public property with a private backing field to the model, the create and drop apis (context.Database.EnsureDeleted()/context.Database.EnsureCreated()) produce the expected database and table. But trying to add a new migration throws the following:\n\n\n```bash\ndotnet ef migrations add SampleMigration\nBuild started...\nBuild succeeded.\nSystem.InvalidOperationException: Cannot scaffold C# literals of type 'System.Reflection.NullabilityInfoContext'. The provider should implement CoreTypeMapping.GenerateCodeLiteral to support using it at design time.\n   at Microsoft.EntityFrameworkCore.Design.Internal.CSharpHelper.UnknownLiteral(Object value)\n   at Microsoft.EntityFrameworkCore.Design.Internal.CSharpHelper.<Fragment>g__AppendMethodCall|57_0(IMethodCallCodeFragment current, <>c__DisplayClass57_0&)\n   at Microsoft.EntityFrameworkCore.Design.Internal.CSharpHelper.Fragment(IMethodCallCodeFragment fragment, Int32 indent)\n   at Microsoft.EntityFrameworkCore.Migrations.Design.CSharpSnapshotGenerator.GenerateAnnotations(String builderName, IAnnotatable annotatable, IndentedStringBuilder stringBuilder, Dictionary`2 annotations, Boolean inChainedCall, Boolean leadingNewline, MethodInfo hasAnnotationMethodInfo)\n   at Microsoft.EntityFrameworkCore.Migrations.Design.CSharpSnapshotGenerator.Generate(String modelBuilderName, IModel model, IndentedStringBuilder stringBuilder)\n   at Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGenerator.GenerateMetadata(String migrationNamespace, Type contextType, String migrationName, String migrationId, IModel targetModel)\n   at Microsoft.EntityFrameworkCore.Migrations.Design.MigrationsScaffolder.ScaffoldMigration(String migrationName, String rootNamespace, String subNamespace, String language, Boolean dryRun)\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.AddMigration(String name, String outputDir, String contextType, String namespace, Boolean dryRun)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigrationImpl(String name, String outputDir, String contextType, String namespace, Boolean dryRun)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigration.<>c__DisplayClass0_0.<.ctor>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.<>c__DisplayClass3_0`1.<Execute>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\nCannot scaffold C# literals of type 'System.Reflection.NullabilityInfoContext'. The provider should implement CoreTypeMapping.GenerateCodeLiteral to support using it at design time.\n```\n\n\n### Sample code\n\nPlease find the minimum code project here:\n\nhttps://github.com/Red-F/EfCoreMigrationIssue\n\nThis was code added to the model\n\n```C#\n\n    public IReadOnlyCollection<string> Uids => _uids.ToList();\n    private List<string> _uids = [];\n    \n    public void AddUids(IEnumerable<string> uids)\n    {\n        _uids.AddRange(uids);\n    }\n    \n    public void RemoveUids(IEnumerable<string> uids)\n    {\n        foreach (var uid in uids)\n        {\n            _uids.Remove(uid);\n        }\n    }\n\n```\n\n### Stack traces\n\nSee above.\n\n### Verbose output\n\n```bash\ndotnet ef --verbose migrations add SampleMigration\nUsing project '/home/fred/projects/EfCoreMigrationIssue/EfCoreMigrationIssue.csproj'.\nUsing startup project '/home/fred/projects/EfCoreMigrationIssue/EfCoreMigrationIssue.csproj'.\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=/tmp/tmpw9FrlF.tmp /verbosity:quiet /nologo /home/fred/projects/EfCoreMigrationIssue/EfCoreMigrationIssue.csproj\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=/tmp/tmp0ai4Yq.tmp /verbosity:quiet /nologo /home/fred/projects/EfCoreMigrationIssue/EfCoreMigrationIssue.csproj\nBuild started...\ndotnet build /home/fred/projects/EfCoreMigrationIssue/EfCoreMigrationIssue.csproj /verbosity:quiet /nologo /p:PublishAot=false\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:01.88\n\nBuild succeeded.\ndotnet exec --depsfile /home/fred/projects/EfCoreMigrationIssue/bin/Debug/net8.0/EfCoreMigrationIssue.deps.json --additionalprobingpath /home/fred/.nuget/packages --runtimeconfig /home/fred/projects/EfCoreMigrationIssue/bin/Debug/net8.0/EfCoreMigrationIssue.runtimeconfig.json /home/fred/.dotnet/tools/.store/dotnet-ef/9.0.0-rc.1.24451.1/dotnet-ef/9.0.0-rc.1.24451.1/tools/net8.0/any/tools/netcoreapp2.0/any/ef.dll migrations add SampleMigration --assembly /home/fred/projects/EfCoreMigrationIssue/bin/Debug/net8.0/EfCoreMigrationIssue.dll --project /home/fred/projects/EfCoreMigrationIssue/EfCoreMigrationIssue.csproj --startup-assembly /home/fred/projects/EfCoreMigrationIssue/bin/Debug/net8.0/EfCoreMigrationIssue.dll --startup-project /home/fred/projects/EfCoreMigrationIssue/EfCoreMigrationIssue.csproj --project-dir /home/fred/projects/EfCoreMigrationIssue/ --root-namespace EfCoreMigrationIssue --language C# --framework net8.0 --nullable --working-dir /home/fred/projects/EfCoreMigrationIssue --verbose\nUsing assembly 'EfCoreMigrationIssue'.\nUsing startup assembly 'EfCoreMigrationIssue'.\nUsing application base '/home/fred/projects/EfCoreMigrationIssue/bin/Debug/net8.0'.\nUsing working directory '/home/fred/projects/EfCoreMigrationIssue'.\nUsing root namespace 'EfCoreMigrationIssue'.\nUsing project directory '/home/fred/projects/EfCoreMigrationIssue/'.\nRemaining arguments: .\nFinding DbContext classes...\nFinding IDesignTimeDbContextFactory implementations...\nFinding DbContext classes in the project...\nFound DbContext 'DemoDbContext'.\nFinding application service provider in assembly 'EfCoreMigrationIssue'...\nFinding Microsoft.Extensions.Hosting service provider...\nUsing environment 'Development'.\nUsing application service provider from Microsoft.Extensions.Hosting.\nUsing context 'DemoDbContext'.\nFinding design-time services referenced by assembly 'EfCoreMigrationIssue'...\nFinding design-time services referenced by assembly 'EfCoreMigrationIssue'...\nNo referenced design-time services were found.\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\nFinding IDesignTimeServices implementations in assembly 'EfCoreMigrationIssue'...\nNo design-time services were found.\nSystem.InvalidOperationException: Cannot scaffold C# literals of type 'System.Reflection.NullabilityInfoContext'. The provider should implement CoreTypeMapping.GenerateCodeLiteral to support using it at design time.\n   at Microsoft.EntityFrameworkCore.Design.Internal.CSharpHelper.UnknownLiteral(Object value)\n   at Microsoft.EntityFrameworkCore.Design.Internal.CSharpHelper.<Fragment>g__AppendMethodCall|57_0(IMethodCallCodeFragment current, <>c__DisplayClass57_0&)\n   at Microsoft.EntityFrameworkCore.Design.Internal.CSharpHelper.Fragment(IMethodCallCodeFragment fragment, Int32 indent)\n   at Microsoft.EntityFrameworkCore.Migrations.Design.CSharpSnapshotGenerator.GenerateAnnotations(String builderName, IAnnotatable annotatable, IndentedStringBuilder stringBuilder, Dictionary`2 annotations, Boolean inChainedCall, Boolean leadingNewline, MethodInfo hasAnnotationMethodInfo)\n   at Microsoft.EntityFrameworkCore.Migrations.Design.CSharpSnapshotGenerator.Generate(String modelBuilderName, IModel model, IndentedStringBuilder stringBuilder)\n   at Microsoft.EntityFrameworkCore.Migrations.Design.CSharpMigrationsGenerator.GenerateMetadata(String migrationNamespace, Type contextType, String migrationName, String migrationId, IModel targetModel)\n   at Microsoft.EntityFrameworkCore.Migrations.Design.MigrationsScaffolder.ScaffoldMigration(String migrationName, String rootNamespace, String subNamespace, String language, Boolean dryRun)\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.AddMigration(String name, String outputDir, String contextType, String namespace, Boolean dryRun)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigrationImpl(String name, String outputDir, String contextType, String namespace, Boolean dryRun)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigration.<>c__DisplayClass0_0.<.ctor>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.<>c__DisplayClass3_0`1.<Execute>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\nCannot scaffold C# literals of type 'System.Reflection.NullabilityInfoContext'. The provider should implement CoreTypeMapping.GenerateCodeLiteral to support using it at design time.```\n\n### Include provider and version information\n\nEF Core version: 9.0.0-rc.2.24473.5 \nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\nTarget framework: .NET 8.0\nOperating system: Linux\nIDE: Rider/CLI\n","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34996/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34996/timeline","performed_via_github_app":null,"state_reason":"completed"}