[{"id":8605140746,"node_id":"LE_lADOAPaMMs5fUbPXzwAAAAIA6AcK","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8605140746","actor":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-02-24T19:42:27Z","label":{"name":"customer-reported","color":"a4a5f9"},"performed_via_github_app":null},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T22:23:55Z","updated_at":"2023-02-24T22:23:55Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30340","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/30340/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/30340/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/30340/events","html_url":"https://github.com/dotnet/efcore/pull/30340","id":1599345364,"node_id":"PR_kwDOAPaMMs5KvQDw","number":30340,"title":"Evaluate SqlServerConvertTranslator.SupportedMethods once","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-02-24T22:23:55Z","updated_at":"2023-02-25T16:04:43Z","closed_at":"2023-02-25T14:31:44Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dotnet/efcore/pulls/30340","html_url":"https://github.com/dotnet/efcore/pull/30340","diff_url":"https://github.com/dotnet/efcore/pull/30340.diff","patch_url":"https://github.com/dotnet/efcore/pull/30340.patch","merged_at":"2023-02-25T14:31:44Z"},"body":"Fixes #30338\r\n\r\n","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/30340/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":8606147854,"node_id":"REFE_lADOAPaMMs5fUbPXzwAAAAIA92UO","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8606147854","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4ec92a21281f95bda0a71cb45c1e3498e060a57e","commit_url":"https://api.github.com/repos/roji/efcore/commits/4ec92a21281f95bda0a71cb45c1e3498e060a57e","created_at":"2023-02-24T22:24:09Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1444598957","html_url":"https://github.com/dotnet/efcore/issues/30338#issuecomment-1444598957","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30338","id":1444598957,"node_id":"IC_kwDOAPaMMs5WGtSt","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T22:28:08Z","updated_at":"2023-02-24T22:28:08Z","body":"Thanks, I agree that we shouldn't statically store an IEnumerable that would get evaluated again and again - submitted #30340 to fix that.\r\n\r\nHowever, note that method translators such as SqlServerConvertTranslator are only invoked when compiling a query; under normal operations, a given query is only compiled once, and the results are cached and reused when the same query (i.e. same expression tree shape) is executed again. In other words, your custom expression builder code is very likely causing some query to be recompiled each time it's executed, which is quite bad for performance. This typically happens when constants are injected into the expresion tree when dynamically constructing queries - [see the docs on this](https://learn.microsoft.com/en-us/ef/core/performance/advanced-performance-topics?tabs=with-di%2Cwith-constant#dynamically-constructed-queries).\r\n\r\nRegardless of this specific issue, I'd recommend looking into whether you can avoid having the query recompile on each execution; this should help both EF's runtime perf (no more recompilation each time) as well as SQL Server the plan cache (hopefully since the same SQL can be generated rather than different SQLs). I'd need to know more about what you're doing to say more.\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1444598957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8606169116,"node_id":"AE_lADOAPaMMs5fUbPXzwAAAAIA97gc","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8606169116","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2023-02-24T22:28:14Z","assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":8606169458,"node_id":"LE_lADOAPaMMs5fUbPXzwAAAAIA97ly","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8606169458","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-02-24T22:28:18Z","label":{"name":"area-perf","color":"5319e7"},"performed_via_github_app":null},{"id":8606169877,"node_id":"LE_lADOAPaMMs5fUbPXzwAAAAIA97sV","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8606169877","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-02-24T22:28:23Z","label":{"name":"type-enhancement","color":"bfe5bf"},"performed_via_github_app":null},{"id":8606170205,"node_id":"LE_lADOAPaMMs5fUbPXzwAAAAIA97xd","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8606170205","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-02-24T22:28:27Z","label":{"name":"area-query","color":"32b37b"},"performed_via_github_app":null},{"id":8606171213,"node_id":"LE_lADOAPaMMs5fUbPXzwAAAAIA98BN","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8606171213","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-02-24T22:28:37Z","label":{"name":"closed-fixed","color":"777777"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1444602025","html_url":"https://github.com/dotnet/efcore/issues/30338#issuecomment-1444602025","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30338","id":1444602025,"node_id":"IC_kwDOAPaMMs5WGuCp","user":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T22:32:01Z","updated_at":"2023-02-24T22:38:47Z","body":"Thanks for the quick fix @roji! We are definitely affected by recompilation due to injecting constants into the expression tree. I will look into the [link](https://learn.microsoft.com/en-us/ef/core/performance/advanced-performance-topics?tabs=with-di%2Cwith-constant#dynamically-constructed-queries) you shared.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1444602025/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8606192418,"node_id":"MEE_lADOAPaMMs5fUbPXzwAAAAIA-BMi","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8606192418","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-02-24T22:32:02Z","performed_via_github_app":null},{"id":8606192434,"node_id":"SE_lADOAPaMMs5fUbPXzwAAAAIA-BMy","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8606192434","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-02-24T22:32:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1444988726","html_url":"https://github.com/dotnet/efcore/issues/30338#issuecomment-1444988726","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30338","id":1444988726,"node_id":"IC_kwDOAPaMMs5WIMc2","user":{"login":"stevendarby","id":41150696,"node_id":"MDQ6VXNlcjQxMTUwNjk2","avatar_url":"https://avatars.githubusercontent.com/u/41150696?v=4","gravatar_id":"","url":"https://api.github.com/users/stevendarby","html_url":"https://github.com/stevendarby","followers_url":"https://api.github.com/users/stevendarby/followers","following_url":"https://api.github.com/users/stevendarby/following{/other_user}","gists_url":"https://api.github.com/users/stevendarby/gists{/gist_id}","starred_url":"https://api.github.com/users/stevendarby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevendarby/subscriptions","organizations_url":"https://api.github.com/users/stevendarby/orgs","repos_url":"https://api.github.com/users/stevendarby/repos","events_url":"https://api.github.com/users/stevendarby/events{/privacy}","received_events_url":"https://api.github.com/users/stevendarby/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-25T04:33:24Z","updated_at":"2023-02-25T04:33:24Z","body":"@erdalsivri That link has good info but frames it as if the only solution for undesirable constants in a query built via the Expression API is to not use that API at all and just use regular LINQ. This isn't always possible, so I think it would be really useful to point out another solution.\r\n\r\nA \"With parameter\" example retaining use of the Expression API would be:\r\n\r\n```C#\r\nvar blogParam = Expression.Parameter(typeof(Blog), \"b\");\r\nExpression<Func<string>> urlExpression = () => url; // Add this line\r\nvar whereLambda = Expression.Lambda<Func<Blog, bool>>(\r\n    Expression.Equal(\r\n        Expression.MakeMemberAccess(\r\n            blogParam,\r\n            typeof(Blog).GetMember(nameof(Blog.Url)).Single()\r\n        ),\r\n        urlExpression.Body // Replace Expression.Constant with this\r\n    blogParam);\r\nblogs = blogs.Where(whereLambda);\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1444988726/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"stevendarby","id":41150696,"node_id":"MDQ6VXNlcjQxMTUwNjk2","avatar_url":"https://avatars.githubusercontent.com/u/41150696?v=4","gravatar_id":"","url":"https://api.github.com/users/stevendarby","html_url":"https://github.com/stevendarby","followers_url":"https://api.github.com/users/stevendarby/followers","following_url":"https://api.github.com/users/stevendarby/following{/other_user}","gists_url":"https://api.github.com/users/stevendarby/gists{/gist_id}","starred_url":"https://api.github.com/users/stevendarby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevendarby/subscriptions","organizations_url":"https://api.github.com/users/stevendarby/orgs","repos_url":"https://api.github.com/users/stevendarby/repos","events_url":"https://api.github.com/users/stevendarby/events{/privacy}","received_events_url":"https://api.github.com/users/stevendarby/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8607267820,"node_id":"MEE_lADOAPaMMs5fUbPXzwAAAAIBCHvs","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8607267820","actor":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-02-25T04:33:24Z","performed_via_github_app":null},{"id":8607267821,"node_id":"SE_lADOAPaMMs5fUbPXzwAAAAIBCHvt","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8607267821","actor":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-02-25T04:33:24Z","performed_via_github_app":null},{"id":8608001136,"node_id":"CE_lADOAPaMMs5fUbPXzwAAAAIBE6xw","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8608001136","actor":null,"event":"closed","commit_id":null,"commit_url":null,"created_at":"2023-02-25T14:31:46Z","state_reason":null,"performed_via_github_app":null},{"id":8608001148,"node_id":"REFE_lADOAPaMMs5fUbPXzwAAAAIBE6x8","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8608001148","actor":null,"event":"referenced","commit_id":"711f3c8ef61a6abdc14ce47e73bbe08e440b9c1a","commit_url":"https://api.github.com/repos/dotnet/efcore/commits/711f3c8ef61a6abdc14ce47e73bbe08e440b9c1a","created_at":"2023-02-25T14:31:46Z","performed_via_github_app":null},{"id":8608019333,"node_id":"MIE_lADOAPaMMs5fUbPXzwAAAAIBE_OF","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8608019333","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2023-02-25T14:46:24Z","milestone":{"title":"8.0.0-preview3"},"performed_via_github_app":null},{"id":8608115570,"node_id":"REFE_lADOAPaMMs5fUbPXzwAAAAIBFWty","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8608115570","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5b83e9327a94d7e23fabfe8af3c7dff98cd07323","commit_url":"https://api.github.com/repos/roji/EntityFramework.Docs/commits/5b83e9327a94d7e23fabfe8af3c7dff98cd07323","created_at":"2023-02-25T16:02:29Z","performed_via_github_app":null},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-25T16:02:41Z","updated_at":"2023-02-25T16:02:41Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues/4270","repository_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs","labels_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues/4270/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues/4270/comments","events_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues/4270/events","html_url":"https://github.com/dotnet/EntityFramework.Docs/pull/4270","id":1599751557,"node_id":"PR_kwDOAiyLos5KwkT1","number":4270,"title":"Improve section on dynamic query generation","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-02-25T16:02:41Z","updated_at":"2023-03-08T14:16:49Z","closed_at":"2023-03-08T14:16:47Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":36473762,"node_id":"MDEwOlJlcG9zaXRvcnkzNjQ3Mzc2Mg==","name":"EntityFramework.Docs","full_name":"dotnet/EntityFramework.Docs","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/EntityFramework.Docs","description":"Documentation for Entity Framework Core and Entity Framework 6","fork":false,"url":"https://api.github.com/repos/dotnet/EntityFramework.Docs","forks_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/forks","keys_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/teams","hooks_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/hooks","issue_events_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/events","assignees_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/tags","blobs_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/languages","stargazers_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/stargazers","contributors_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/contributors","subscribers_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/subscribers","subscription_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/subscription","commits_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/merges","archive_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/downloads","issues_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/deployments","created_at":"2015-05-29T00:24:23Z","updated_at":"2025-11-10T04:01:38Z","pushed_at":"2025-11-10T05:02:02Z","git_url":"git://github.com/dotnet/EntityFramework.Docs.git","ssh_url":"git@github.com:dotnet/EntityFramework.Docs.git","clone_url":"https://github.com/dotnet/EntityFramework.Docs.git","svn_url":"https://github.com/dotnet/EntityFramework.Docs","homepage":"https://learn.microsoft.com/ef/","size":18381,"stargazers_count":1709,"watchers_count":1709,"language":"Mermaid","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":1977,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":573,"license":{"key":"cc-by-4.0","name":"Creative Commons Attribution 4.0 International","spdx_id":"CC-BY-4.0","url":"https://api.github.com/licenses/cc-by-4.0","node_id":"MDc6TGljZW5zZTI1"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["documentation","entity-framework","entity-framework-6","entity-framework-core","orm"],"visibility":"public","forks":1977,"open_issues":573,"watchers":1709,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/pulls/4270","html_url":"https://github.com/dotnet/EntityFramework.Docs/pull/4270","diff_url":"https://github.com/dotnet/EntityFramework.Docs/pull/4270.diff","patch_url":"https://github.com/dotnet/EntityFramework.Docs/pull/4270.patch","merged_at":"2023-03-08T14:16:47Z"},"body":"See https://github.com/dotnet/efcore/issues/30338#issuecomment-1444988726","reactions":{"url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues/4270/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/EntityFramework.Docs/issues/4270/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445149165","html_url":"https://github.com/dotnet/efcore/issues/30338#issuecomment-1445149165","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30338","id":1445149165,"node_id":"IC_kwDOAPaMMs5WIznt","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-25T16:04:33Z","updated_at":"2023-02-25T16:04:33Z","body":"@stevendarby you're right that this doc section is a bit light, I've submitted https://github.com/dotnet/EntityFramework.Docs/pull/4270 to improve it.\r\n\r\nFYI I originally wrote it the way it is, since we've seen many users using the Expression API when they don't actually need to; so a big part of that is to guide them away from it for those cases. But of course in some scenarios you really do need to dynamically construct queries via the Expression API, and so I've added more information on how to do that, very similar to your code sample above.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445149165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8608118306,"node_id":"MEE_lADOAPaMMs5fUbPXzwAAAAIBFXYi","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8608118306","actor":{"login":"stevendarby","id":41150696,"node_id":"MDQ6VXNlcjQxMTUwNjk2","avatar_url":"https://avatars.githubusercontent.com/u/41150696?v=4","gravatar_id":"","url":"https://api.github.com/users/stevendarby","html_url":"https://github.com/stevendarby","followers_url":"https://api.github.com/users/stevendarby/followers","following_url":"https://api.github.com/users/stevendarby/following{/other_user}","gists_url":"https://api.github.com/users/stevendarby/gists{/gist_id}","starred_url":"https://api.github.com/users/stevendarby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevendarby/subscriptions","organizations_url":"https://api.github.com/users/stevendarby/orgs","repos_url":"https://api.github.com/users/stevendarby/repos","events_url":"https://api.github.com/users/stevendarby/events{/privacy}","received_events_url":"https://api.github.com/users/stevendarby/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-02-25T16:04:34Z","performed_via_github_app":null},{"id":8608118307,"node_id":"SE_lADOAPaMMs5fUbPXzwAAAAIBFXYj","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8608118307","actor":{"login":"stevendarby","id":41150696,"node_id":"MDQ6VXNlcjQxMTUwNjk2","avatar_url":"https://avatars.githubusercontent.com/u/41150696?v=4","gravatar_id":"","url":"https://api.github.com/users/stevendarby","html_url":"https://github.com/stevendarby","followers_url":"https://api.github.com/users/stevendarby/followers","following_url":"https://api.github.com/users/stevendarby/following{/other_user}","gists_url":"https://api.github.com/users/stevendarby/gists{/gist_id}","starred_url":"https://api.github.com/users/stevendarby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevendarby/subscriptions","organizations_url":"https://api.github.com/users/stevendarby/orgs","repos_url":"https://api.github.com/users/stevendarby/repos","events_url":"https://api.github.com/users/stevendarby/events{/privacy}","received_events_url":"https://api.github.com/users/stevendarby/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-02-25T16:04:34Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445166759","html_url":"https://github.com/dotnet/efcore/issues/30338#issuecomment-1445166759","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30338","id":1445166759,"node_id":"IC_kwDOAPaMMs5WI36n","user":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-25T17:40:58Z","updated_at":"2023-02-25T17:40:58Z","body":"For context, here is a simplified version of what we are doing:\r\n\r\n```c#\r\npublic static class IQueryableExtensions\r\n{\r\n  public static IQueryable<TSource> WhereIn<TSource>(\r\n    this IQueryable<TSource> query,\r\n    Expression<Func<TSource, int>> keySelector,\r\n    IEnumerable<int> values) where TSource : class\r\n  {\r\n    // GetDbContextFromIQueryable does some ugly reflection to be able to reach the AppDbContext\r\n    var valuesQuery = GetAppDbContextFromIQueryable(query).AsQuery(values);\r\n    var body = Expression.Call(null, s_containsIntMethod, valuesQuery.Expression, keySelector.Body);\r\n    return query.Where(Expression.Lambda<Func<TSource, bool>>(body, keySelector.Parameters[0]));\r\n  }\r\n}\r\n\r\npublic partial class AppDbContext\r\n{\r\n  public IQueryable<int> AsQuery(IEnumerable<int> values)\r\n  {\r\n    var valuesParam = BuildStringSplitParameter(SqlDbType.VarChar, values);\r\n    return Set<StringSplitIntResult>()\r\n      .FromSqlRaw(\r\n        \"SELECT CAST([Value] as INT) AS [Value] FROM STRING_SPLIT({0}, '|')\", valuesParam)\r\n      .Select(x => x.Value);\r\n  }\r\n}\r\n```\r\n\r\nWe are basically trying to optimize `Contains` queries to avoid cache plan bloat by pushing all parameters as a varchar.\r\n\r\nI expect these two to be equivalent:\r\n\r\n```c#\r\n_context.Users.Where(u => _context.AsQuery(userIds).Contains(u.Id));\r\n_context.Users.WhereIn(u => u.Id, userIds); // Dynamic expression\r\n```\r\n\r\nHowever, the dynamic version seems to be not taking advantage of EFCore's caching for some reason and ends up allocating thousands of `PropertyInfo[]` and `MethodInfo[]` objects.\r\n\r\nIf we use `Linqkit` to construct the expression, the performance is equivalent to the first version:\r\n\r\n```c#\r\npublic static class IQueryableExtensions\r\n{\r\n  public static IQueryable<TSource> WhereIn<TSource>(\r\n    this IQueryable<TSource> query,\r\n    Expression<Func<TSource, int>> keySelector,\r\n    IEnumerable<int> values) where TSource : class\r\n  {\r\n    // GetDbContextFromIQueryable does some ugly reflection to be able to reach the AppDbContext\r\n    var valuesQuery = GetAppDbContextFromIQueryable(query).AsQuery(values);\r\n    return query.AsExpandable().Where(u => valuesQuery.Contains(keySelector.Invoke(u));\r\n  }\r\n}\r\n```\r\n\r\nI still don't see why our dynamic expression is not cached. @stevendarby  `AsExpandable` seems to be working fine but I will investigate the example you shared to understand how it relates to our code.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445166759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8608236404,"node_id":"MEE_lADOAPaMMs5fUbPXzwAAAAIBF0N0","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8608236404","actor":{"login":"stevendarby","id":41150696,"node_id":"MDQ6VXNlcjQxMTUwNjk2","avatar_url":"https://avatars.githubusercontent.com/u/41150696?v=4","gravatar_id":"","url":"https://api.github.com/users/stevendarby","html_url":"https://github.com/stevendarby","followers_url":"https://api.github.com/users/stevendarby/followers","following_url":"https://api.github.com/users/stevendarby/following{/other_user}","gists_url":"https://api.github.com/users/stevendarby/gists{/gist_id}","starred_url":"https://api.github.com/users/stevendarby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevendarby/subscriptions","organizations_url":"https://api.github.com/users/stevendarby/orgs","repos_url":"https://api.github.com/users/stevendarby/repos","events_url":"https://api.github.com/users/stevendarby/events{/privacy}","received_events_url":"https://api.github.com/users/stevendarby/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-02-25T17:40:59Z","performed_via_github_app":null},{"id":8608236405,"node_id":"SE_lADOAPaMMs5fUbPXzwAAAAIBF0N1","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8608236405","actor":{"login":"stevendarby","id":41150696,"node_id":"MDQ6VXNlcjQxMTUwNjk2","avatar_url":"https://avatars.githubusercontent.com/u/41150696?v=4","gravatar_id":"","url":"https://api.github.com/users/stevendarby","html_url":"https://github.com/stevendarby","followers_url":"https://api.github.com/users/stevendarby/followers","following_url":"https://api.github.com/users/stevendarby/following{/other_user}","gists_url":"https://api.github.com/users/stevendarby/gists{/gist_id}","starred_url":"https://api.github.com/users/stevendarby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevendarby/subscriptions","organizations_url":"https://api.github.com/users/stevendarby/orgs","repos_url":"https://api.github.com/users/stevendarby/repos","events_url":"https://api.github.com/users/stevendarby/events{/privacy}","received_events_url":"https://api.github.com/users/stevendarby/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-02-25T17:40:59Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445168841","html_url":"https://github.com/dotnet/efcore/issues/30338#issuecomment-1445168841","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30338","id":1445168841,"node_id":"IC_kwDOAPaMMs5WI4bJ","user":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-25T17:51:41Z","updated_at":"2023-02-25T17:53:24Z","body":"By the way, there is a significant performance difference between these two static expressions as well:\r\n\r\n```c#\r\n_context.Users.Where(u => _context.AsQuery(userIds).Contains(u.Id)).Select(u => u.Id).ToQueryString();\r\n// TotalAllocatedMbDiff=391.89, TotalGcPauseMsDiff=112.10 DurationMs=5859.4\r\n```\r\n\r\n```c#\r\n_context.Users.Where(u => userIds.Contains(u.Id)).Select(u => u.Id).ToQueryString();\r\n// TotalAllocatedMbDiff=81.47, TotalGcPauseMsDiff=54.31 DurationMs=787.4\r\n```\r\n\r\nI executed these 10K times to get these numbers. The dynamic version with `WhereIn` is much worse:\r\n\r\n```c#\r\n_context.Users.WhereIn(u => u.Id, userIds).ToQueryString();\r\n// TotalAllocatedMbDiff=1731.69, TotalPauseMsDiff=1520.23 DurationMs=25846.3\r\n```\r\n\r\nNo matter what I did I wasn't able to reach the performance of `Where(u => userIds.Contains(u.Id))`. I guess `FromSqlRaw` has some overhead.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445168841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445169769","html_url":"https://github.com/dotnet/efcore/issues/30338#issuecomment-1445169769","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30338","id":1445169769,"node_id":"IC_kwDOAPaMMs5WI4pp","user":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-25T17:56:21Z","updated_at":"2023-02-25T17:56:21Z","body":"Interesting to note that this `Join` version is slightly better than the `Contains` query version but not as fast as vanilla Contains:\r\n\r\n```c#\r\n_context.Users.Join(s_context.AsQuery(s_userIds), u => u.Id, id => id, (u, _) => u).Select(u => u.Id).ToQueryString();\r\n// TotalAllocatedMbDiff=308.75, TotalPauseMsDiff=57.14 DurationMs=2507.9\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445169769/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445368576","html_url":"https://github.com/dotnet/efcore/issues/30338#issuecomment-1445368576","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30338","id":1445368576,"node_id":"IC_kwDOAPaMMs5WJpMA","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-26T13:58:07Z","updated_at":"2023-02-26T13:58:07Z","body":"@erdalsivri it's difficult to tell what's going on, because you're WhereIn has various non-EF things going on which aren't visible here (e.g. AsExpandable, AsQuery).\r\n\r\nFor one thing, I'd recommend looking at the actual SQL that comes out; does it embed different constant values? If so, then it must be recompiling each time. This, by the way, is the current behavior of EF for most database provider when using Contains with a collection parameter (#13617, hopefully we'll find a solution for this soon).\r\n\r\nOtherwise, I'd try to compare the actual, final expression trees - the thing on which you invoke the final ToQueryString operation. The differences there should tell you what's going on.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1445368576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8609568112,"node_id":"MEE_lADOAPaMMs5fUbPXzwAAAAIBK5Vw","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8609568112","actor":{"login":"erdalsivri","id":4797942,"node_id":"MDQ6VXNlcjQ3OTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/4797942?v=4","gravatar_id":"","url":"https://api.github.com/users/erdalsivri","html_url":"https://github.com/erdalsivri","followers_url":"https://api.github.com/users/erdalsivri/followers","following_url":"https://api.github.com/users/erdalsivri/following{/other_user}","gists_url":"https://api.github.com/users/erdalsivri/gists{/gist_id}","starred_url":"https://api.github.com/users/erdalsivri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erdalsivri/subscriptions","organizations_url":"https://api.github.com/users/erdalsivri/orgs","repos_url":"https://api.github.com/users/erdalsivri/repos","events_url":"https://api.github.com/users/erdalsivri/events{/privacy}","received_events_url":"https://api.github.com/users/erdalsivri/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-02-26T13:58:08Z","performed_via_github_app":null}]