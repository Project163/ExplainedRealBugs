[{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1007882652","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1007882652","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1007882652,"node_id":"IC_kwDOAPaMMs48ExGc","user":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-08T04:19:27Z","updated_at":"2022-01-08T04:19:27Z","body":"Some more investigation...\r\n\r\nI started working on commenting anything out that I thought might be an issue, working my way back up the main program loop...so to speak.  Something strange:\r\n\r\n```\r\n//- Check the command line arguments to see if we need to process anything\r\n                string[]? args = Environment.GetCommandLineArgs();\r\n                if (args.Length > 0)\r\n                {\r\n                    CheckCommandLine(args, applog, _configDBPath, _msgDBPath, _nwwsClient);\r\n                }\r\n                else\r\n                {\r\n                    applog.Debug(\"No command line options present when app was started.\");\r\n                }\r\n\r\n                Application.Exit();\r\n\r\n                //- Display Splash Screen\r\n                SplashScreen frmSplash = new SplashScreen(applog, _cfgHelper, _nwwsClient, _AssemblyVersion, _configDBPath, _msgDBPath, true);\r\n                frmSplash.ShowDialog();\r\n```\r\nAfter the \"Application.Exit()\" statement, the application continues on running the SplashScreen.  I was under the impression that Application.Exit is supposed to close down all the forms and then exit the application from the \"Main()\" method.  In other words, anything after \"Application.Exit();\" is just unreachable code.  If I use:\r\n\r\n```\r\nApplication.Exit();\r\nEnvironment.Exit(0);\r\n```\r\n\r\n...the program shuts down there, as expected.\r\n\r\nLooking at the documentation for Application.Exit() I see:\r\n\r\n> Informs all message pumps that they must terminate, and then closes all application windows after the messages have been processed.\r\n\r\nI'm no expert but am I to understand that \"Application.Exit()\" will kill off all message pumps, close all forms, but then the application continues to anything following it?\r\n\r\n-Joe\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1007882652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1007883185","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1007883185","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1007883185,"node_id":"IC_kwDOAPaMMs48ExOx","user":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-08T04:25:25Z","updated_at":"2022-01-08T04:26:00Z","body":"Same thing happens if I use:\r\n\r\n```\r\nApplication.Exit();\r\nthis.Close();\r\n```\r\n\r\nI know that the Application.Exit() closes the form that is currently running the code....but I would have expected the \"this.Close()\" would at least throw an exception.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1007883185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5876400607,"node_id":"TRE_lADOAPaMMs5BizD1zwAAAAFeQsHf","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5876400607","actor":{"login":"ericstj","id":8918108,"node_id":"MDQ6VXNlcjg5MTgxMDg=","avatar_url":"https://avatars.githubusercontent.com/u/8918108?v=4","gravatar_id":"","url":"https://api.github.com/users/ericstj","html_url":"https://github.com/ericstj","followers_url":"https://api.github.com/users/ericstj/followers","following_url":"https://api.github.com/users/ericstj/following{/other_user}","gists_url":"https://api.github.com/users/ericstj/gists{/gist_id}","starred_url":"https://api.github.com/users/ericstj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ericstj/subscriptions","organizations_url":"https://api.github.com/users/ericstj/orgs","repos_url":"https://api.github.com/users/ericstj/repos","events_url":"https://api.github.com/users/ericstj/events{/privacy}","received_events_url":"https://api.github.com/users/ericstj/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"transferred","commit_id":null,"commit_url":null,"created_at":"2022-01-11T21:39:03Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1010460240","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1010460240","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1010460240,"node_id":"IC_kwDOAPaMMs48OmZQ","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T23:29:49Z","updated_at":"2022-01-11T23:29:49Z","body":"@dataweasel Application.Exit() is a Winforms API which terminates the Winforms application/resources (e.g. closing windows), but the .NET program itself continues running. Environment.Exit is the thing that actually terminates the .NET process, and also triggers the Sqlite connection pool clearing code which you see above. Microsoft.Data.Sqlite and Winforms are oblivious of each other.\r\n\r\nRegardless, the stack trace you posted above does seem to indicate a bug. A few questions:\r\n\r\n* Which version of Microsoft.Data.Sqlite are you using?\r\n* Does the exception happen reliably every time? Or only from time to time? If it's the former, can you submit a minimal code repro which reproduces it?\r\n\r\nFrom a cursory look at SqliteConnectionPool nothing obvious pops up. [We do access _connections.Count without locking](https://github.com/dotnet/efcore/blob/main/src/Microsoft.Data.Sqlite.Core/SqliteConnectionPool.cs#L38), but that shouldn't cause any exceptions (we may want to consider locking around it just in case though).\r\n\r\n/cc @bricelam","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1010460240/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5876822707,"node_id":"MEE_lADOAPaMMs5BizD1zwAAAAFeSTKz","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5876822707","actor":{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-11T23:29:49Z","performed_via_github_app":null},{"id":5876822708,"node_id":"SE_lADOAPaMMs5BizD1zwAAAAFeSTK0","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5876822708","actor":{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-11T23:29:49Z","performed_via_github_app":null},{"id":5876822714,"node_id":"MEE_lADOAPaMMs5BizD1zwAAAAFeSTK6","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5876822714","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-11T23:29:49Z","performed_via_github_app":null},{"id":5876822718,"node_id":"SE_lADOAPaMMs5BizD1zwAAAAFeSTK-","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5876822718","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-11T23:29:50Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011108197","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011108197","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011108197,"node_id":"IC_kwDOAPaMMs48REll","user":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T14:35:26Z","updated_at":"2022-01-12T14:35:26Z","body":"@roji  - I am using the latest Microsoft.Data.Sqlite from Nuget (so...6.0.1?).  It does happen reliably every time...but I think I might have figured out my problem.\r\n\r\nI think I had a stray Sqlite connection still open when the program went to exit.  I did a full code review and found a class where I had opened a Sqlite connection and did not have a close at the end of the method.  When the close wasn't there I would get this exception 100% of the time.  When I added the close, the problem went away.  I then commented out the close and the exception returned.\r\n\r\nI will try to get a minimal code repro for you.  I'm looking at the following:\r\n\r\n1. Program Start\r\n2. Open connection to Sqlite DB.\r\n3. Instance a class that also opens a connection to a different Sqlite database but does not close it.\r\n4. Exit main program\r\n\r\nI'll let you know if this repros.\r\n\r\n-Joe","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011108197/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5880749434,"node_id":"MEE_lADOAPaMMs5BizD1zwAAAAFehR16","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5880749434","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-12T14:35:26Z","performed_via_github_app":null},{"id":5880749441,"node_id":"SE_lADOAPaMMs5BizD1zwAAAAFehR2B","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5880749441","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-12T14:35:26Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011149741","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011149741","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011149741,"node_id":"IC_kwDOAPaMMs48ROut","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T15:16:37Z","updated_at":"2022-01-12T15:16:37Z","body":"@dataweasel thanks for the additional. Even if you forgot the Close, I'm still very interested in looking into this, as it may indicate an internal bug which could have other effects. So a repro would be much appreciated.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011149741/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5881039391,"node_id":"MEE_lADOAPaMMs5BizD1zwAAAAFeiYof","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5881039391","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-12T15:16:37Z","performed_via_github_app":null},{"id":5881039405,"node_id":"SE_lADOAPaMMs5BizD1zwAAAAFeiYot","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5881039405","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-12T15:16:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011396473","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011396473","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011396473,"node_id":"IC_kwDOAPaMMs48SK95","user":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T19:50:46Z","updated_at":"2022-01-12T19:50:46Z","body":"That's an interesting bug, Whenever the pool attempts to [reclaim](https://github.com/dotnet/efcore/blob/41e6aaaf6216de904530de11b0bfd4af43fb13f7/src/Microsoft.Data.Sqlite.Core/SqliteConnectionPool.cs#L156) a connection, while enumerating the list, it might call [Return](https://github.com/dotnet/efcore/blob/41e6aaaf6216de904530de11b0bfd4af43fb13f7/src/Microsoft.Data.Sqlite.Core/SqliteConnectionPool.cs#L166) on a leaked connection. While returning the connection to the pool, in some cases it might [dispose](https://github.com/dotnet/efcore/blob/41e6aaaf6216de904530de11b0bfd4af43fb13f7/src/Microsoft.Data.Sqlite.Core/SqliteConnectionPool.cs#L88) them. And while disposing the connection, it's [removed](https://github.com/dotnet/efcore/blob/41e6aaaf6216de904530de11b0bfd4af43fb13f7/src/Microsoft.Data.Sqlite.Core/SqliteConnectionPool.cs#L150) from the `_connections` list. That way, the list is changed while it's already enumerated.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011396473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011403857","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011403857","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011403857,"node_id":"IC_kwDOAPaMMs48SMxR","user":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:01:23Z","updated_at":"2022-01-12T20:01:23Z","body":"I quickly tried this with a Console Application and leaving the connection open didn't cause an issue.  I'm not doing much work with the DB connections (just opening the connection to a file with no tables or data) so I'm not sure if that has anything to do with it.  My application where this was failing was a Windows Form app (.Net 5).\r\n\r\nStill working on it.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011403857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011416359","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011416359","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011416359,"node_id":"IC_kwDOAPaMMs48SP0n","user":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:17:56Z","updated_at":"2022-01-12T20:17:56Z","body":"Managed to reproduce in a console app.\r\n\r\n```csharp\r\n\r\nusing Microsoft.Data.Sqlite;\r\n\r\nTest();\r\n\r\nGC.Collect();\r\nGC.WaitForPendingFinalizers();\r\nGC.Collect();\r\n\r\nstatic void Test()\r\n{\r\n    var connection = new SqliteConnection(\"Data Source=hello.db\");\r\n    connection.Open();\r\n}\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011416359/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011430934","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011430934","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011430934,"node_id":"IC_kwDOAPaMMs48STYW","user":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:36:45Z","updated_at":"2022-01-12T20:36:45Z","body":"This works:\r\n\r\n```\r\nusing System;\r\nusing Microsoft.Data.Sqlite;\r\n\r\nnamespace SqliteDbTest\r\n{\r\n    internal class Program\r\n    {\r\n        private static SqliteConnection dbConn01 = null;\r\n\r\n        static void Main(string[] args)\r\n        {\r\n            DBOpen();\r\n            GC.Collect();\r\n            GC.WaitForPendingFinalizers();\r\n            GC.Collect();\r\n\r\n        }\r\n\r\n        static void DBOpen()\r\n        {\r\n            string strDB01File = @\"c:\\temp\\db01.sqlite\";\r\n\r\n            dbConn01 = new SqliteConnection($\"Data Source={strDB01File};\");\r\n            dbConn01.Open();\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThis breaks:\r\n\r\n```\r\nusing System;\r\nusing Microsoft.Data.Sqlite;\r\n\r\nnamespace SqliteDbTest\r\n{\r\n    internal class Program\r\n    {\r\n\r\n        static void Main(string[] args)\r\n        {\r\n            DBOpen();\r\n            GC.Collect();\r\n            GC.WaitForPendingFinalizers();\r\n            GC.Collect();\r\n\r\n        }\r\n\r\n        static void DBOpen()\r\n        {\r\n            string strDB01File = @\"c:\\temp\\db01.sqlite\";\r\n\r\n            var dbConn01 = new SqliteConnection($\"Data Source={strDB01File};\");\r\n            dbConn01.Open();\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nChanging to var instead of a declaration is the difference?\r\n\r\n-Joe","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011430934/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011432222","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011432222","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011432222,"node_id":"IC_kwDOAPaMMs48STse","user":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:38:27Z","updated_at":"2022-01-12T20:39:04Z","body":"> Changing to var instead of a declaration is the difference?\r\n\r\nKind of, in your case it's the static field - the point is for the GC to collect `SqliteConnection`.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011432222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011436324","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011436324","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011436324,"node_id":"IC_kwDOAPaMMs48SUsk","user":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:44:18Z","updated_at":"2022-01-12T20:44:18Z","body":"> Kind of, in your case it's the static field - the point is for the GC to collect `SqliteConnection`.\r\n\r\nOkay...I am starting to see it now.  It's now how it is being used or even that it is \"open\" when the program is ending.  When GC attempts to dispose of it (from a pool or something) it's disposing of the connection object, which changes the collection of connections while it is being enumerated.  Did I get that right?  That's why the stack trace has the \"ReclaimLeakedConnections()\" and such.\r\n\r\nI'm still learning.  Thanks for the insights.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011436324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011441000","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011441000","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011441000,"node_id":"IC_kwDOAPaMMs48SV1o","user":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:51:20Z","updated_at":"2022-01-12T20:51:20Z","body":"> When GC attempts to dispose of it (from a pool or something) it's disposing of the connection object, which changes the collection of connections while it is being enumerated.\r\n\r\nNot exactly. SQLite has a [mechanism](https://github.com/dotnet/efcore/blob/41e6aaaf6216de904530de11b0bfd4af43fb13f7/src/Microsoft.Data.Sqlite.Core/SqliteConnectionInternal.cs#L101) to detect leaked connections, which is mostly determined by `WeakReference<SqliteConnection?>` going 'stale' (which does happen whenever `SqliteConnection` is GC'ed), Also, SQLite has a [mechanism](https://github.com/dotnet/efcore/blob/41e6aaaf6216de904530de11b0bfd4af43fb13f7/src/Microsoft.Data.Sqlite.Core/SqliteConnectionFactory.cs#L31) to clear the pool whenever an app is closing. Combining both of them leads to the issue you've encountered.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011441000/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011491277","html_url":"https://github.com/dotnet/efcore/issues/27168#issuecomment-1011491277","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27168","id":1011491277,"node_id":"IC_kwDOAPaMMs48SiHN","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T22:02:10Z","updated_at":"2022-01-12T22:02:10Z","body":"Thanks for looking into this @vonzshik - yeah, ReclaimLeakedConnections iterates over _connections, but calls return inside which mutates them. So not a concurrency issue - just a plain old mutate-within-iteration bug.\r\n\r\nShould be fixable by copying _connections before iterating.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1011491277/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5883272518,"node_id":"MEE_lADOAPaMMs5BizD1zwAAAAFeq51G","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5883272518","actor":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-12T22:02:10Z","performed_via_github_app":null},{"id":5883272521,"node_id":"SE_lADOAPaMMs5BizD1zwAAAAFeq51J","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5883272521","actor":{"login":"vonzshik","id":14861420,"node_id":"MDQ6VXNlcjE0ODYxNDIw","avatar_url":"https://avatars.githubusercontent.com/u/14861420?v=4","gravatar_id":"","url":"https://api.github.com/users/vonzshik","html_url":"https://github.com/vonzshik","followers_url":"https://api.github.com/users/vonzshik/followers","following_url":"https://api.github.com/users/vonzshik/following{/other_user}","gists_url":"https://api.github.com/users/vonzshik/gists{/gist_id}","starred_url":"https://api.github.com/users/vonzshik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vonzshik/subscriptions","organizations_url":"https://api.github.com/users/vonzshik/orgs","repos_url":"https://api.github.com/users/vonzshik/repos","events_url":"https://api.github.com/users/vonzshik/events{/privacy}","received_events_url":"https://api.github.com/users/vonzshik/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-12T22:02:10Z","performed_via_github_app":null},{"id":5883273155,"node_id":"LE_lADOAPaMMs5BizD1zwAAAAFeq5_D","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5883273155","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-01-12T22:02:19Z","label":{"name":"type-bug","color":"f7c6c7"},"performed_via_github_app":null},{"id":5883273445,"node_id":"LE_lADOAPaMMs5BizD1zwAAAAFeq6Dl","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5883273445","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-01-12T22:02:23Z","label":{"name":"area-adonet-sqlite","color":"044a64"},"performed_via_github_app":null},{"id":5883273935,"node_id":"LE_lADOAPaMMs5BizD1zwAAAAFeq6LP","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5883273935","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-01-12T22:02:29Z","label":{"name":"Servicing-consider","color":"bfd4f2"},"performed_via_github_app":null},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T23:05:13Z","updated_at":"2022-01-12T23:05:13Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/24075","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/24075/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/24075/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/24075/events","html_url":"https://github.com/dotnet/efcore/issues/24075","id":802719955,"node_id":"MDU6SXNzdWU4MDI3MTk5NTU=","number":24075,"title":"Wrong translation for default(DateTime)/default(Guid)/default(TimeSpan) in linq projection","user":{"login":"anranruye","id":54608128,"node_id":"MDQ6VXNlcjU0NjA4MTI4","avatar_url":"https://avatars.githubusercontent.com/u/54608128?v=4","gravatar_id":"","url":"https://api.github.com/users/anranruye","html_url":"https://github.com/anranruye","followers_url":"https://api.github.com/users/anranruye/followers","following_url":"https://api.github.com/users/anranruye/following{/other_user}","gists_url":"https://api.github.com/users/anranruye/gists{/gist_id}","starred_url":"https://api.github.com/users/anranruye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anranruye/subscriptions","organizations_url":"https://api.github.com/users/anranruye/orgs","repos_url":"https://api.github.com/users/anranruye/repos","events_url":"https://api.github.com/users/anranruye/events{/privacy}","received_events_url":"https://api.github.com/users/anranruye/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":529485528,"node_id":"MDU6TGFiZWw1Mjk0ODU1Mjg=","url":"https://api.github.com/repos/dotnet/efcore/labels/needs-design","name":"needs-design","color":"fbca04","default":false,"description":null},{"id":846554729,"node_id":"MDU6TGFiZWw4NDY1NTQ3Mjk=","url":"https://api.github.com/repos/dotnet/efcore/labels/poachable","name":"poachable","color":"dd87ed","default":false,"description":""},{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1675384372,"node_id":"MDU6TGFiZWwxNjc1Mzg0Mzcy","url":"https://api.github.com/repos/dotnet/efcore/labels/area-query","name":"area-query","color":"32b37b","default":false,"description":""}],"state":"open","locked":false,"assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/2","html_url":"https://github.com/dotnet/efcore/milestone/2","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/2/labels","id":648040,"node_id":"MDk6TWlsZXN0b25lNjQ4MDQw","number":2,"title":"Backlog","description":"Issues that have been approved but are not scheduled a specific release.","creator":{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":2157,"closed_issues":10,"state":"open","created_at":"2014-05-03T18:58:28Z","updated_at":"2025-11-07T08:33:50Z","due_on":null,"closed_at":null},"comments":16,"created_at":"2021-02-06T15:04:13Z","updated_at":"2025-06-15T16:08:06Z","closed_at":null,"author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"How to reproduce:\r\n```C#\r\n    dbContext.Set<AnyEntityType>().Select(x => new\r\n    { \r\n        DateTime = default(DateTime), \r\n        x.SomeProperty \r\n    }).ToList();\r\n```\r\n\r\nExpected result:\r\nOne of:\r\n1. Can not translate linq query to sql command\r\n2. Parameterize `default(DateTime)` like a variable\r\n3. Client evaluate `default(DateTime)`\r\n4. Convert returned string value to `DateTime` type\r\n\r\nActual result:\r\n```\r\nSystem.InvalidCastException: Unable to cast object of type 'System.String' to type 'System.DateTime'.\r\n   at Microsoft.Data.SqlClient.SqlBuffer.get_DateTime()\r\n   at Microsoft.Data.SqlClient.SqlDataReader.GetDateTime(Int32 i)\r\n   at lambda_method5(Closure , QueryContext , DbDataReader , ResultContext , SingleQueryResultCoordinator )\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()\r\n   at System.Collections.Generic.List`1..ctor(IEnumerable`1 collection)\r\n   at System.Linq.Enumerable.ToList[TSource](IEnumerable`1 source)\r\n```\r\n\r\nGenerated sql:\r\n```SQL\r\n      SELECT '0001-01-01T00:00:00.0000000' AS [DateTime], [x].[SomeProperty]\r\n      FROM [TableName] AS [x]\r\n```\r\n\r\nEF Core version: 5.0.2\r\nDatabase provider:  Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework: .NET 5.0\r\nOperating system: Windows 10\r\nIDE: Visual Studio 2019 16.8\r\n","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/24075/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/24075/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":5896674699,"node_id":"AE_lADOAPaMMs5BizD1zwAAAAFfeB2L","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5896674699","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2022-01-14T18:58:54Z","assignee":{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":5896675242,"node_id":"MIE_lADOAPaMMs5BizD1zwAAAAFfeB-q","url":"https://api.github.com/repos/dotnet/efcore/issues/events/5896675242","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2022-01-14T18:59:00Z","milestone":{"title":"6.0.x"},"performed_via_github_app":null}]