{"url":"https://api.github.com/repos/dotnet/efcore/issues/30998","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/30998/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/30998/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/30998/events","html_url":"https://github.com/dotnet/efcore/issues/30998","id":1732368643,"node_id":"I_kwDOAPaMMs5nQdkD","number":30998,"title":"Scaffolding synapse fails when attempting to enumerate triggers","user":{"login":"memory-thrasher","id":39869500,"node_id":"MDQ6VXNlcjM5ODY5NTAw","avatar_url":"https://avatars.githubusercontent.com/u/39869500?v=4","gravatar_id":"","url":"https://api.github.com/users/memory-thrasher","html_url":"https://github.com/memory-thrasher","followers_url":"https://api.github.com/users/memory-thrasher/followers","following_url":"https://api.github.com/users/memory-thrasher/following{/other_user}","gists_url":"https://api.github.com/users/memory-thrasher/gists{/gist_id}","starred_url":"https://api.github.com/users/memory-thrasher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/memory-thrasher/subscriptions","organizations_url":"https://api.github.com/users/memory-thrasher/orgs","repos_url":"https://api.github.com/users/memory-thrasher/repos","events_url":"https://api.github.com/users/memory-thrasher/events{/privacy}","received_events_url":"https://api.github.com/users/memory-thrasher/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1900977179,"node_id":"MDU6TGFiZWwxOTAwOTc3MTc5","url":"https://api.github.com/repos/dotnet/efcore/labels/area-scaffolding","name":"area-scaffolding","color":"32b37b","default":false,"description":""},{"id":2272800544,"node_id":"MDU6TGFiZWwyMjcyODAwNTQ0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-sqlserver","name":"area-sqlserver","color":"32b37b","default":false,"description":""},{"id":2402623482,"node_id":"MDU6TGFiZWwyNDAyNjIzNDgy","url":"https://api.github.com/repos/dotnet/efcore/labels/community-contribution","name":"community-contribution","color":"004caa","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/174","html_url":"https://github.com/dotnet/efcore/milestone/174","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/174/labels","id":9624769,"node_id":"MI_kwDOAPaMMs4AktzB","number":174,"title":"7.0.10","description":null,"creator":{"login":"wtgodbe","id":14283640,"node_id":"MDQ6VXNlcjE0MjgzNjQw","avatar_url":"https://avatars.githubusercontent.com/u/14283640?v=4","gravatar_id":"","url":"https://api.github.com/users/wtgodbe","html_url":"https://github.com/wtgodbe","followers_url":"https://api.github.com/users/wtgodbe/followers","following_url":"https://api.github.com/users/wtgodbe/following{/other_user}","gists_url":"https://api.github.com/users/wtgodbe/gists{/gist_id}","starred_url":"https://api.github.com/users/wtgodbe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wtgodbe/subscriptions","organizations_url":"https://api.github.com/users/wtgodbe/orgs","repos_url":"https://api.github.com/users/wtgodbe/repos","events_url":"https://api.github.com/users/wtgodbe/events{/privacy}","received_events_url":"https://api.github.com/users/wtgodbe/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":1,"state":"closed","created_at":"2023-07-06T16:54:15Z","updated_at":"2023-11-14T13:52:12Z","due_on":null,"closed_at":"2023-08-08T21:09:48Z"},"comments":7,"created_at":"2023-05-30T14:15:58Z","updated_at":"2025-06-15T19:03:10Z","closed_at":"2023-07-06T23:07:15Z","author_association":"CONTRIBUTOR","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Synapse does not support triggers. Attempting to read fro mthe table sys.triggers via ssms results in the error: `Catalog view 'triggers' is not supported in this version.` Starting with efcore version 7.0.0, the scaffold process attempts to enumerate triggers, and fails with the same error message, with the stack trace below. The command requesting the scaffold is also below.\r\n\r\nThe file `src/EFCore.SqlServer/Scaffolding/Internal/SqlServerDatabaseModelFactory.cs`, which is responsible for enumerating all db objects during scaffolding, has other code that specifically behaves differently when run on synapse (by engine edition), and many of them have been added since version 7 but as of 5/25, triggers are still not filtered by engine edition. Therefore, I request a change, that triggers not be enumerated when scaffolding synapse. Furthermore, since we are not able to support efcore 8.x at this time, I request a patched 7.0.x release be published with this fix.\r\n\r\nI have tested a simple code change does allow the scaffold to complete and am in the process of validating the output. I intend to submit a pull request in the near future for this issue against 7.0.x\r\n\r\n```\r\ndotnet-ef dbcontext scaffold --no-build \"$connString\" Microsoft.EntityFrameworkCore.SqlServer --schema STARS --output-dir Models -f -c SynapseContextModel --startup-project . --project . --no-pluralize\r\n```\r\n\r\n```\r\nTo protect potentially sensitive information in your connection string, you should move it out of source code. You can avoid scaffolding the connection string by using the Name= syntax to read it from configuration - see https://go.microsoft.com/fwlink/?linkid=2131148. For more guidance on storing connection strings, see http://go.microsoft.com/fwlink/?LinkId=723263.\r\nMicrosoft.Data.SqlClient.SqlException (0x80131904): Catalog view 'triggers' is not supported in this version.\r\n   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlConnection.cs:line 2010\r\n   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\src\\Microsoft\\Data\\SqlClient\\SqlInternalConnection.cs:line 770\r\n   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\TdsParser.cs:line 1404\r\n   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\TdsParser.cs:line 1975\r\n   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData() in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlDataReader.cs:line 1142\r\n   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData() in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlDataReader.cs:line 260\r\n   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlCommand.cs:line 5124\r\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlCommand.cs:line 4937\r\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlCommand.cs:line 4621\r\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlCommand.cs:line 4491\r\n   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlCommand.cs:line 2038\r\n   at Microsoft.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior) in D:\\a\\_work\\1\\s\\src\\Microsoft.Data.SqlClient\\netcore\\src\\Microsoft\\Data\\SqlClient\\SqlCommand.cs:line 2000\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Scaffolding.Internal.SqlServerDatabaseModelFactory.GetTriggers(DbConnection connection, IReadOnlyList`1 tables, String tableFilter)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Scaffolding.Internal.SqlServerDatabaseModelFactory.GetTables(DbConnection connection, DatabaseModel databaseModel, Func`3 tableFilter, IReadOnlyDictionary`2 typeAliases, String databaseCollation)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Scaffolding.Internal.SqlServerDatabaseModelFactory.Create(DbConnection connection, DatabaseModelFactoryOptions options)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Scaffolding.Internal.SqlServerDatabaseModelFactory.Create(String connectionString, DatabaseModelFactoryOptions options)\r\n   at Microsoft.EntityFrameworkCore.Scaffolding.Internal.ReverseEngineerScaffolder.ScaffoldModel(String connectionString, DatabaseModelFactoryOptions databaseOptions, ModelReverseEngineerOptions modelOptions, ModelCodeGenerationOptions codeOptions)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DatabaseOperations.ScaffoldContext(String provider, String connectionString, String outputDir, String outputContextDir, String dbContextClassName, IEnumerable`1 schemas, IEnumerable`1 tables, String modelNamespace, String contextNamespace, Boolean useDataAnnotations, Boolean overwriteFiles, Boolean useDatabaseNames, Boolean suppressOnConfiguring, Boolean noPluralize)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.ScaffoldContextImpl(String provider, String connectionString, String outputDir, String outputDbContextDir, String dbContextClassName, IEnumerable`1 schemaFilters, IEnumerable`1 tableFilters, String modelNamespace, String contextNamespace, Boolean useDataAnnotations, Boolean overwriteFiles, Boolean useDatabaseNames, Boolean suppressOnConfiguring, Boolean noPluralize)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.ScaffoldContext.<>c__DisplayClass0_0.<.ctor>b__0()\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.<>c__DisplayClass3_0`1.<Execute>b__0()\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\r\nClientConnectionId: [redacted]\r\nError Number:104385,State:1,Class:16\r\nCatalog view 'triggers' is not supported in this version.\r\n```\r\n\r\nEF Core version: 7.0.4 and 8.0.23-preview\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework: .NET 7.0\r\nOperating system: 11\r\nIDE: N/A (dotnet cli)\r\n","closed_by":{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30998/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/30998/timeline","performed_via_github_app":null,"state_reason":"completed"}