{"url":"https://api.github.com/repos/dotnet/efcore/issues/34179","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34179/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34179/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34179/events","html_url":"https://github.com/dotnet/efcore/issues/34179","id":2395064531,"node_id":"I_kwDOAPaMMs6OwcjT","number":34179,"title":"Cosmos: Use 1:1 mapping for .NET `Id` to JSON `id` unless explicitly configured otherwise","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":526662235,"node_id":"MDU6TGFiZWw1MjY2NjIyMzU=","url":"https://api.github.com/repos/dotnet/efcore/labels/breaking-change","name":"breaking-change","color":"d93f0b","default":false,"description":null},{"id":1686778100,"node_id":"MDU6TGFiZWwxNjg2Nzc4MTAw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-cosmos","name":"area-cosmos","color":"32b37b","default":false,"description":""},{"id":1900941630,"node_id":"MDU6TGFiZWwxOTAwOTQxNjMw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-model-building","name":"area-model-building","color":"32b37b","default":false,"description":""},{"id":1901166749,"node_id":"MDU6TGFiZWwxOTAxMTY2NzQ5","url":"https://api.github.com/repos/dotnet/efcore/labels/area-change-tracking","name":"area-change-tracking","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/180","html_url":"https://github.com/dotnet/efcore/milestone/180","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/180/labels","id":9963267,"node_id":"MI_kwDOAPaMMs4AmAcD","number":180,"title":"9.0.0","description":null,"creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":339,"state":"closed","created_at":"2023-09-25T15:41:58Z","updated_at":"2025-04-01T18:19:15Z","due_on":null,"closed_at":"2024-11-14T11:54:05Z"},"comments":1,"created_at":"2024-07-08T09:01:33Z","updated_at":"2025-06-15T20:06:21Z","closed_at":"2024-08-02T15:36:27Z","author_association":"CONTRIBUTOR","type":{"id":1092406,"node_id":"IT_kwDOAIt-yc4AEKs2","name":"Feature","description":"A request, idea, or new functionality","color":"blue","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-10-08T09:10:05Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Motivation\r\n\r\nCurrently we have a lot of rules that determine which properties get configured as keys, partition keys, alternate keys, discriminators, and do on. The intention here is to create a model that will fall into the pit-of-success for use with Cosmos. This works to some extent, but the problem is that it becomes very hard to follow what is actually happening, or why. This means that, for example, that it is difficult to know which properties form a relatively simple concept such as the JSON `id` property. And without knowing the definition of the `id`, everything else becomes confusing.\r\n\r\n## Proposal\r\n\r\nRemove a lot of the magic from this area to create conventions that are easy to understand, while allowing additional configuration to be done explicitly, also in a non-magical way.\r\n\r\n## Principle\r\n\r\nBased on discussions with the Cosmos folks, we will use the following principle:\r\n\r\n- The EF primary key property `Id` discovered by convention should map 1:1 to the JSON id property, unless the developer explicitly configures something different.\r\n\r\nNotes:\r\n\r\n- This is likely what developers expect, and doing otherwise can cause confusion.\r\n- The downside is that EF and Cosmos have different concepts of key spaces—EF has one key space per root entity type, Cosmos has one key space per logical partition.\r\n\r\n## Discriminators\r\n\r\n- We will keep putting the discriminator into the model by convention.\r\n  - However, if there is only one entity type in the container, then we won’t use it in queries that are generated. #20268\r\n- The JSON `id` property will not have a discriminator added so as to keep it an easy-to-understand 1:1 mapping\r\n  - Developers need to be aware that there is one key space per logical partition in a container.\r\n  - We will provide a mechanism to go back to the old behavior\r\n\r\nNote that partition keys will still be added to the EF primary key definition.\r\n\r\n- This ensures that EF primary keys are unique across partitions, and that FK definitions can follow this.\r\n- The partition key properties have no impact on `id`\r\n- This means that the part of the primary key that isn’t partition keys will map 1:1 to JSON `id`. If this part is called `Id` then this is still `Id` to `id` mapping.\r\n","closed_by":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34179/timeline","performed_via_github_app":null,"state_reason":"completed"}