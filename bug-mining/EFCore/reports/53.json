{"url":"https://api.github.com/repos/dotnet/efcore/issues/28349","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/28349/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/28349/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/28349/events","html_url":"https://github.com/dotnet/efcore/issues/28349","id":1290349920,"node_id":"I_kwDOAPaMMs5M6S1g","number":28349,"title":"Down with a Sequence generated in incorrect order","user":{"login":"pdevito3","id":24260530,"node_id":"MDQ6VXNlcjI0MjYwNTMw","avatar_url":"https://avatars.githubusercontent.com/u/24260530?v=4","gravatar_id":"","url":"https://api.github.com/users/pdevito3","html_url":"https://github.com/pdevito3","followers_url":"https://api.github.com/users/pdevito3/followers","following_url":"https://api.github.com/users/pdevito3/following{/other_user}","gists_url":"https://api.github.com/users/pdevito3/gists{/gist_id}","starred_url":"https://api.github.com/users/pdevito3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pdevito3/subscriptions","organizations_url":"https://api.github.com/users/pdevito3/orgs","repos_url":"https://api.github.com/users/pdevito3/repos","events_url":"https://api.github.com/users/pdevito3/events{/privacy}","received_events_url":"https://api.github.com/users/pdevito3/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900942474,"node_id":"MDU6TGFiZWwxOTAwOTQyNDc0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-migrations","name":"area-migrations","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/128","html_url":"https://github.com/dotnet/efcore/milestone/128","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/128/labels","id":7236796,"node_id":"MI_kwDOAPaMMs4Abmy8","number":128,"title":"7.0.0","description":"EF Core 7.0","creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":375,"state":"closed","created_at":"2021-10-09T18:57:40Z","updated_at":"2024-11-13T16:14:22Z","due_on":null,"closed_at":"2022-11-05T18:37:45Z"},"comments":0,"created_at":"2022-06-30T16:01:26Z","updated_at":"2025-06-15T18:48:57Z","closed_at":"2022-07-05T18:34:02Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## File a bug\r\n\r\n### Include your code\r\n\r\nI have a config like this:\r\n```c#\r\n\r\n        modelBuilder.HasSequence<long>(Consts.DatabaseSequences.ConferenceOrderNoSequence)\r\n            .StartsAt(10000000) /\r\n            .IncrementsBy(1);\r\n\r\n// .....\r\n\r\n    public void Configure(EntityTypeBuilder<Conference> builder)\r\n    {\r\n        builder.Property(o => o.OrderNo)\r\n            .HasDefaultValueSql($\"concat('CONF', nextval('\\\"{Consts.DatabaseSequences.ConferenceOrderNoSequence}\\\"'))\")\r\n            .IsRequired();\r\n    }\r\n```\r\n\r\nthat generates a migration like this\r\n\r\n```c#\r\n        protected override void Up(MigrationBuilder migrationBuilder)\r\n        {\r\n            migrationBuilder.CreateSequence(\r\n                name: \"ConferenceOrderNumbers\",\r\n                startValue: 10000000L);\r\n\r\n            migrationBuilder.AddColumn<string>(\r\n                name: \"order_no\",\r\n                schema: \"event\",\r\n                table: \"event\",\r\n                type: \"text\",\r\n                nullable: false,\r\n                defaultValueSql: \"concat('CONF', nextval('\\\"ConferenceOrderNumbers\\\"'))\");\r\n        }\r\n\r\n        protected override void Down(MigrationBuilder migrationBuilder)\r\n        {            \r\n            migrationBuilder.DropSequence(\r\n                name: \"ConferenceOrderNumbers\");\r\n\r\n            migrationBuilder.DropColumn(\r\n                name: \"order_no\",\r\n                schema: \"event\",\r\n                table: \"event\");\r\n        }\r\n```\r\n\r\nI can easily resolve this manually by switching the order to this, but knowing and remembering to do that isn't ideal:\r\n```c#\r\n\r\n        protected override void Down(MigrationBuilder migrationBuilder)\r\n        {            \r\n            migrationBuilder.DropColumn(\r\n                name: \"order_no\",\r\n                schema: \"event\",\r\n                table: \"event\");\r\n\r\n            migrationBuilder.DropSequence(\r\n                name: \"ConferenceOrderNumbers\");\r\n        }\r\n```\r\n\r\n### Include stack traces\r\n\r\nInclude the full exception message and stack trace for any exception you encounter.\r\n\r\nUse triple-tick fences for stack traces. For example:\r\n\r\n```\r\nDETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.\r\n   at Npgsql.Internal.NpgsqlConnector.<ReadMessage>g__ReadMessageLong|211_0(NpgsqlConnector connector, Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)\r\n   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)\r\n   at Npgsql.NpgsqlDataReader.NextResult()\r\n   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)\r\n   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)\r\n   at Npgsql.NpgsqlCommand.ExecuteNonQuery(Boolean async, CancellationToken cancellationToken)\r\n   at Npgsql.NpgsqlCommand.ExecuteNonQuery()\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQuery(RelationalCommandParameterObject parameterObject)\r\n   at Microsoft.EntityFrameworkCore.Migrations.MigrationCommand.ExecuteNonQuery(IRelationalConnection connection, IReadOnlyDictionary`2 parameterValues)\r\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.ExecuteNonQuery(IEnumerable`1 migrationCommands, IRelationalConnection connection)\r\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.UpdateDatabase(String targetMigration, String connectionString, String contextType)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabaseImpl(String targetMigration, String connectionString, String contextType)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabase.<>c__DisplayClass0_0.<.ctor>b__0()\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\r\n  Exception data:\r\n    Severity: ERROR\r\n    SqlState: 2BP01\r\n    MessageText: cannot drop sequence \"ConferenceOrderNumbers\" because other objects depend on it\r\n    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.\r\n    Hint: Use DROP ... CASCADE to drop the dependent objects too.\r\n    File: dependency.c\r\n    Line: 1195\r\n    Routine: reportDependentObjects\r\n2BP01: cannot drop sequence \"ConferenceOrderNumbers\" because other objects depend on it\r\n\r\n```\r\n\r\n### Include provider and version information\r\n\r\nEF Core version:\r\nDatabase provider: postgres\r\nTarget framework: .NET 6\r\nOperating system: MacOS 12.4\r\nIDE: Rider 22.1\r\n","closed_by":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/28349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/28349/timeline","performed_via_github_app":null,"state_reason":"completed"}