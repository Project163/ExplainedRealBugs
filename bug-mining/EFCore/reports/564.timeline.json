[{"id":13205313845,"node_id":"LE_lADOAPaMMs6MsmczzwAAAAMTGRk1","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13205313845","actor":{"login":"renanhgon","id":42190575,"node_id":"MDQ6VXNlcjQyMTkwNTc1","avatar_url":"https://avatars.githubusercontent.com/u/42190575?v=4","gravatar_id":"","url":"https://api.github.com/users/renanhgon","html_url":"https://github.com/renanhgon","followers_url":"https://api.github.com/users/renanhgon/followers","following_url":"https://api.github.com/users/renanhgon/following{/other_user}","gists_url":"https://api.github.com/users/renanhgon/gists{/gist_id}","starred_url":"https://api.github.com/users/renanhgon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renanhgon/subscriptions","organizations_url":"https://api.github.com/users/renanhgon/orgs","repos_url":"https://api.github.com/users/renanhgon/repos","events_url":"https://api.github.com/users/renanhgon/events{/privacy}","received_events_url":"https://api.github.com/users/renanhgon/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-06-18T18:58:37Z","label":{"name":"customer-reported","color":"a4a5f9"},"performed_via_github_app":null},{"id":13208876919,"node_id":"AE_lADOAPaMMs6MsmczzwAAAAMTT3d3","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13208876919","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2024-06-19T02:20:33Z","assignee":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2178131891","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2178131891","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2178131891,"node_id":"IC_kwDOAPaMMs6B06ez","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-19T08:53:30Z","updated_at":"2024-06-19T08:53:30Z","body":"This issue is lacking enough information for us to be able to fully understand what is happening. Please attach a small, runnable project or post a small, runnable code listing that reproduces what you are seeing so that we can investigate.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2178131891/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2179190429","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2179190429","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2179190429,"node_id":"IC_kwDOAPaMMs6B486d","user":{"login":"renanhgon","id":42190575,"node_id":"MDQ6VXNlcjQyMTkwNTc1","avatar_url":"https://avatars.githubusercontent.com/u/42190575?v=4","gravatar_id":"","url":"https://api.github.com/users/renanhgon","html_url":"https://github.com/renanhgon","followers_url":"https://api.github.com/users/renanhgon/followers","following_url":"https://api.github.com/users/renanhgon/following{/other_user}","gists_url":"https://api.github.com/users/renanhgon/gists{/gist_id}","starred_url":"https://api.github.com/users/renanhgon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renanhgon/subscriptions","organizations_url":"https://api.github.com/users/renanhgon/orgs","repos_url":"https://api.github.com/users/renanhgon/repos","events_url":"https://api.github.com/users/renanhgon/events{/privacy}","received_events_url":"https://api.github.com/users/renanhgon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-19T17:12:23Z","updated_at":"2024-06-19T17:12:23Z","body":"Sure! I created this example repository with an implementation very close to my real scenario.\r\nhttps://github.com/renanhgon/EFCoreMemoryLeak\r\n\r\nWhen I run my application, just the _devops/ping_ route triggered by k8s is enough to cause a constant increase in memory usage. You can simulate these pings directly from the browser console:\r\n\r\n```Javascript\r\nsetInterval(() => fetch('/v1/devops/ping'), 10000);\r\nsetInterval(() => fetch('/v1/devops/ping'), 30000);\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2179190429/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"renanhgon","id":42190575,"node_id":"MDQ6VXNlcjQyMTkwNTc1","avatar_url":"https://avatars.githubusercontent.com/u/42190575?v=4","gravatar_id":"","url":"https://api.github.com/users/renanhgon","html_url":"https://github.com/renanhgon","followers_url":"https://api.github.com/users/renanhgon/followers","following_url":"https://api.github.com/users/renanhgon/following{/other_user}","gists_url":"https://api.github.com/users/renanhgon/gists{/gist_id}","starred_url":"https://api.github.com/users/renanhgon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renanhgon/subscriptions","organizations_url":"https://api.github.com/users/renanhgon/orgs","repos_url":"https://api.github.com/users/renanhgon/repos","events_url":"https://api.github.com/users/renanhgon/events{/privacy}","received_events_url":"https://api.github.com/users/renanhgon/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2205933037","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2205933037","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2205933037,"node_id":"IC_kwDOAPaMMs6De93t","user":{"login":"cssatkmd","id":159536497,"node_id":"U_kgDOCYJVcQ","avatar_url":"https://avatars.githubusercontent.com/u/159536497?v=4","gravatar_id":"","url":"https://api.github.com/users/cssatkmd","html_url":"https://github.com/cssatkmd","followers_url":"https://api.github.com/users/cssatkmd/followers","following_url":"https://api.github.com/users/cssatkmd/following{/other_user}","gists_url":"https://api.github.com/users/cssatkmd/gists{/gist_id}","starred_url":"https://api.github.com/users/cssatkmd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cssatkmd/subscriptions","organizations_url":"https://api.github.com/users/cssatkmd/orgs","repos_url":"https://api.github.com/users/cssatkmd/repos","events_url":"https://api.github.com/users/cssatkmd/events{/privacy}","received_events_url":"https://api.github.com/users/cssatkmd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-03T12:12:48Z","updated_at":"2024-07-03T12:12:48Z","body":"Has this issued been looked at or given any time and effort? We can reproduce a large memory usage, but we have yet to create a reproduceable example. \r\nThe example above seems to have a leak, so can this be confirmed or mitigated because of something?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2205933037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cssatkmd","id":159536497,"node_id":"U_kgDOCYJVcQ","avatar_url":"https://avatars.githubusercontent.com/u/159536497?v=4","gravatar_id":"","url":"https://api.github.com/users/cssatkmd","html_url":"https://github.com/cssatkmd","followers_url":"https://api.github.com/users/cssatkmd/followers","following_url":"https://api.github.com/users/cssatkmd/following{/other_user}","gists_url":"https://api.github.com/users/cssatkmd/gists{/gist_id}","starred_url":"https://api.github.com/users/cssatkmd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cssatkmd/subscriptions","organizations_url":"https://api.github.com/users/cssatkmd/orgs","repos_url":"https://api.github.com/users/cssatkmd/repos","events_url":"https://api.github.com/users/cssatkmd/events{/privacy}","received_events_url":"https://api.github.com/users/cssatkmd/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2210550401","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2210550401","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2210550401,"node_id":"IC_kwDOAPaMMs6DwlKB","user":{"login":"peterkiss1","id":55989469,"node_id":"MDQ6VXNlcjU1OTg5NDY5","avatar_url":"https://avatars.githubusercontent.com/u/55989469?v=4","gravatar_id":"","url":"https://api.github.com/users/peterkiss1","html_url":"https://github.com/peterkiss1","followers_url":"https://api.github.com/users/peterkiss1/followers","following_url":"https://api.github.com/users/peterkiss1/following{/other_user}","gists_url":"https://api.github.com/users/peterkiss1/gists{/gist_id}","starred_url":"https://api.github.com/users/peterkiss1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterkiss1/subscriptions","organizations_url":"https://api.github.com/users/peterkiss1/orgs","repos_url":"https://api.github.com/users/peterkiss1/repos","events_url":"https://api.github.com/users/peterkiss1/events{/privacy}","received_events_url":"https://api.github.com/users/peterkiss1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-05T09:39:53Z","updated_at":"2024-07-05T09:39:53Z","body":"Something similar is happening in my app;\r\n\r\nEF Core version: 8.0.6 or EF Core version: 8.0.4\r\nDatabase provider: Npgsql.EntityFrameworkCore.PostgreSQL 8.0.3\r\n\r\nThe setup is simple as the database holds 3 tables, from which 2 are in relation in a one-to-many mapping.\r\nApplication is a Web API, web requests are interacting with the context but also hosted services are doing database operations, context registered as transient, hosted services are creating their scope for each process then dispose the whole, DbContext also disposed everywhere still the memory usage is sky rocketing (low load is on the app). PostgreSQL driver has an issue with multiplexing and OpenTelemetry but we are not using multiplexing.\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2210550401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"peterkiss1","id":55989469,"node_id":"MDQ6VXNlcjU1OTg5NDY5","avatar_url":"https://avatars.githubusercontent.com/u/55989469?v=4","gravatar_id":"","url":"https://api.github.com/users/peterkiss1","html_url":"https://github.com/peterkiss1","followers_url":"https://api.github.com/users/peterkiss1/followers","following_url":"https://api.github.com/users/peterkiss1/following{/other_user}","gists_url":"https://api.github.com/users/peterkiss1/gists{/gist_id}","starred_url":"https://api.github.com/users/peterkiss1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterkiss1/subscriptions","organizations_url":"https://api.github.com/users/peterkiss1/orgs","repos_url":"https://api.github.com/users/peterkiss1/repos","events_url":"https://api.github.com/users/peterkiss1/events{/privacy}","received_events_url":"https://api.github.com/users/peterkiss1/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2211773338","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2211773338","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2211773338,"node_id":"IC_kwDOAPaMMs6D1Pua","user":{"login":"peterkiss1","id":55989469,"node_id":"MDQ6VXNlcjU1OTg5NDY5","avatar_url":"https://avatars.githubusercontent.com/u/55989469?v=4","gravatar_id":"","url":"https://api.github.com/users/peterkiss1","html_url":"https://github.com/peterkiss1","followers_url":"https://api.github.com/users/peterkiss1/followers","following_url":"https://api.github.com/users/peterkiss1/following{/other_user}","gists_url":"https://api.github.com/users/peterkiss1/gists{/gist_id}","starred_url":"https://api.github.com/users/peterkiss1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterkiss1/subscriptions","organizations_url":"https://api.github.com/users/peterkiss1/orgs","repos_url":"https://api.github.com/users/peterkiss1/repos","events_url":"https://api.github.com/users/peterkiss1/events{/privacy}","received_events_url":"https://api.github.com/users/peterkiss1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-06T13:47:01Z","updated_at":"2024-07-06T13:47:01Z","body":"Executed a couple of extra tests and\r\n\r\n- 8.0.0 looks better than 8.0.4 or 8.0.6\r\n- if i turn ON pooling for the context everything looks fine which is bad as pooling itself is not an essential thing and i'm afraid that something deeper is simple wrong with EF\r\n\r\nWho has memory issues please check the suffering apps with pooling.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2211773338/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"peterkiss1","id":55989469,"node_id":"MDQ6VXNlcjU1OTg5NDY5","avatar_url":"https://avatars.githubusercontent.com/u/55989469?v=4","gravatar_id":"","url":"https://api.github.com/users/peterkiss1","html_url":"https://github.com/peterkiss1","followers_url":"https://api.github.com/users/peterkiss1/followers","following_url":"https://api.github.com/users/peterkiss1/following{/other_user}","gists_url":"https://api.github.com/users/peterkiss1/gists{/gist_id}","starred_url":"https://api.github.com/users/peterkiss1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterkiss1/subscriptions","organizations_url":"https://api.github.com/users/peterkiss1/orgs","repos_url":"https://api.github.com/users/peterkiss1/repos","events_url":"https://api.github.com/users/peterkiss1/events{/privacy}","received_events_url":"https://api.github.com/users/peterkiss1/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":13497736385,"node_id":"LE_lADOAPaMMs6MsmczzwAAAAMkhxzB","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13497736385","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-07-14T11:36:33Z","label":{"name":"needs-design","color":"fbca04"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2227314287","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2227314287","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2227314287,"node_id":"IC_kwDOAPaMMs6Ewh5v","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-14T11:39:30Z","updated_at":"2024-07-14T11:39:30Z","body":"Note for team: we need to decide how to best investigate this kind of issue. My usual process doesn't work here, so I'd like to get advice from the team on how to proceed.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2227314287/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2283390430","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2283390430","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2283390430,"node_id":"IC_kwDOAPaMMs6IGcXe","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-12T08:33:32Z","updated_at":"2024-08-12T08:33:32Z","body":"@renanhgon Can you please post the `OutOfMemoryException` you get from running the repro until it runs out of memory?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2283390430/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":13843927700,"node_id":"MEE_lADOAPaMMs6MsmczzwAAAAM5KZKU","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13843927700","actor":{"login":"renanhgon","id":42190575,"node_id":"MDQ6VXNlcjQyMTkwNTc1","avatar_url":"https://avatars.githubusercontent.com/u/42190575?v=4","gravatar_id":"","url":"https://api.github.com/users/renanhgon","html_url":"https://github.com/renanhgon","followers_url":"https://api.github.com/users/renanhgon/followers","following_url":"https://api.github.com/users/renanhgon/following{/other_user}","gists_url":"https://api.github.com/users/renanhgon/gists{/gist_id}","starred_url":"https://api.github.com/users/renanhgon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renanhgon/subscriptions","organizations_url":"https://api.github.com/users/renanhgon/orgs","repos_url":"https://api.github.com/users/renanhgon/repos","events_url":"https://api.github.com/users/renanhgon/events{/privacy}","received_events_url":"https://api.github.com/users/renanhgon/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-08-12T08:33:33Z","performed_via_github_app":null},{"id":13843927719,"node_id":"SE_lADOAPaMMs6MsmczzwAAAAM5KZKn","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13843927719","actor":{"login":"renanhgon","id":42190575,"node_id":"MDQ6VXNlcjQyMTkwNTc1","avatar_url":"https://avatars.githubusercontent.com/u/42190575?v=4","gravatar_id":"","url":"https://api.github.com/users/renanhgon","html_url":"https://github.com/renanhgon","followers_url":"https://api.github.com/users/renanhgon/followers","following_url":"https://api.github.com/users/renanhgon/following{/other_user}","gists_url":"https://api.github.com/users/renanhgon/gists{/gist_id}","starred_url":"https://api.github.com/users/renanhgon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renanhgon/subscriptions","organizations_url":"https://api.github.com/users/renanhgon/orgs","repos_url":"https://api.github.com/users/renanhgon/repos","events_url":"https://api.github.com/users/renanhgon/events{/privacy}","received_events_url":"https://api.github.com/users/renanhgon/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-08-12T08:33:33Z","performed_via_github_app":null},{"id":13843928443,"node_id":"UNLE_lADOAPaMMs6MsmczzwAAAAM5KZV7","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13843928443","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2024-08-12T08:33:35Z","label":{"name":"needs-design","color":"fbca04"},"performed_via_github_app":null},{"id":14092247925,"node_id":"UNE_lADOAPaMMs6MsmczzwAAAANH9qN1","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14092247925","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unassigned","commit_id":null,"commit_url":null,"created_at":"2024-08-31T17:09:12Z","assignee":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2332281372","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2332281372","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2332281372,"node_id":"IC_kwDOAPaMMs6LA8oc","user":{"login":"bleapleaper","id":179136551,"node_id":"U_kgDOCq1oJw","avatar_url":"https://avatars.githubusercontent.com/u/179136551?v=4","gravatar_id":"","url":"https://api.github.com/users/bleapleaper","html_url":"https://github.com/bleapleaper","followers_url":"https://api.github.com/users/bleapleaper/followers","following_url":"https://api.github.com/users/bleapleaper/following{/other_user}","gists_url":"https://api.github.com/users/bleapleaper/gists{/gist_id}","starred_url":"https://api.github.com/users/bleapleaper/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleapleaper/subscriptions","organizations_url":"https://api.github.com/users/bleapleaper/orgs","repos_url":"https://api.github.com/users/bleapleaper/repos","events_url":"https://api.github.com/users/bleapleaper/events{/privacy}","received_events_url":"https://api.github.com/users/bleapleaper/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-05T17:31:57Z","updated_at":"2024-09-06T06:39:17Z","body":"@ajcvickers Semi-similar issue where my stuff is kept in memory. Used PerfView (first time) to find that [RelationalCommandCache](https://github.com/dotnet/efcore/blob/af1047eeae730a37dd0d106c113e3b518132adbc/src/EFCore.Relational/Query/Internal/RelationalCommandCache.cs#L54) uses my object in a cache key. No idea how it ended up there xD. However it would be nice if there was an option to turn on som debug messages when saving abnormal types to cache, wether MemoryCache or static\r\n\r\n\r\nedit; never mind. memory cache says no entries but visual studio heap says two entries - no idea what is going on\r\nedit2: oh its probably ef own service provider?\r\n\r\nanyway ServiceProviderCache or some cache is holding back 1 million ...Core.Update.ColumnModification and 13000 entites from being garbage collected","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2332281372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bleapleaper","id":179136551,"node_id":"U_kgDOCq1oJw","avatar_url":"https://avatars.githubusercontent.com/u/179136551?v=4","gravatar_id":"","url":"https://api.github.com/users/bleapleaper","html_url":"https://github.com/bleapleaper","followers_url":"https://api.github.com/users/bleapleaper/followers","following_url":"https://api.github.com/users/bleapleaper/following{/other_user}","gists_url":"https://api.github.com/users/bleapleaper/gists{/gist_id}","starred_url":"https://api.github.com/users/bleapleaper/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleapleaper/subscriptions","organizations_url":"https://api.github.com/users/bleapleaper/orgs","repos_url":"https://api.github.com/users/bleapleaper/repos","events_url":"https://api.github.com/users/bleapleaper/events{/privacy}","received_events_url":"https://api.github.com/users/bleapleaper/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14150872564,"node_id":"MEE_lADOAPaMMs6MsmczzwAAAANLdS30","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14150872564","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-09-05T17:31:58Z","performed_via_github_app":null},{"id":14150872576,"node_id":"SE_lADOAPaMMs6MsmczzwAAAANLdS4A","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14150872576","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-09-05T17:31:58Z","performed_via_github_app":null},{"actor":{"login":"cliffankh0z","id":180958674,"node_id":"U_kgDOCsk10g","avatar_url":"https://avatars.githubusercontent.com/u/180958674?v=4","gravatar_id":"","url":"https://api.github.com/users/cliffankh0z","html_url":"https://github.com/cliffankh0z","followers_url":"https://api.github.com/users/cliffankh0z/followers","following_url":"https://api.github.com/users/cliffankh0z/following{/other_user}","gists_url":"https://api.github.com/users/cliffankh0z/gists{/gist_id}","starred_url":"https://api.github.com/users/cliffankh0z/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cliffankh0z/subscriptions","organizations_url":"https://api.github.com/users/cliffankh0z/orgs","repos_url":"https://api.github.com/users/cliffankh0z/repos","events_url":"https://api.github.com/users/cliffankh0z/events{/privacy}","received_events_url":"https://api.github.com/users/cliffankh0z/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-09T12:58:10Z","updated_at":"2024-09-09T12:58:10Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34631","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34631/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34631/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34631/events","html_url":"https://github.com/dotnet/efcore/pull/34631","id":2513853216,"node_id":"PR_kwDOAPaMMs562Jyg","number":34631,"title":"Keep actual parameter values out of CommandCacheKey in RelationalCommandCache","user":{"login":"cliffankh0z","id":180958674,"node_id":"U_kgDOCsk10g","avatar_url":"https://avatars.githubusercontent.com/u/180958674?v=4","gravatar_id":"","url":"https://api.github.com/users/cliffankh0z","html_url":"https://github.com/cliffankh0z","followers_url":"https://api.github.com/users/cliffankh0z/followers","following_url":"https://api.github.com/users/cliffankh0z/following{/other_user}","gists_url":"https://api.github.com/users/cliffankh0z/gists{/gist_id}","starred_url":"https://api.github.com/users/cliffankh0z/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cliffankh0z/subscriptions","organizations_url":"https://api.github.com/users/cliffankh0z/orgs","repos_url":"https://api.github.com/users/cliffankh0z/repos","events_url":"https://api.github.com/users/cliffankh0z/events{/privacy}","received_events_url":"https://api.github.com/users/cliffankh0z/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2024-09-09T12:38:10Z","updated_at":"2024-10-01T06:43:43Z","closed_at":"2024-10-01T06:43:43Z","author_association":"NONE","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dotnet/efcore/pulls/34631","html_url":"https://github.com/dotnet/efcore/pull/34631","diff_url":"https://github.com/dotnet/efcore/pull/34631.diff","patch_url":"https://github.com/dotnet/efcore/pull/34631.patch","merged_at":null},"body":"Memory leak when storing the actual parameter values in MemoryCache in CommandCacheKey. Parameter values can be anything used as parameteres for the queries; lists of Guids, even objects used for entity inits etc. This keeps them from being garbage collected and thereby creating memory leaks. Store only what we actually need to compare parameter values.\r\n\r\nAnyway, the intent of the code is clear. If a maintainer could fix this in the correct manner and style that would be greatly appreciated!\r\n\r\n\r\n\r\n<!--\r\nPlease check whether the PR fulfills these requirements\r\n-->\r\n\r\n- [x ] I've read the guidelines for [contributing](CONTRIBUTING.md) and seen the [walkthrough](https://youtu.be/9OMxy1wal1s?t=1869)\r\n- [ ] I've posted a comment on an issue with a detailed description of how I am planning to contribute and got approval from a member of the team\r\n- [ ] The code builds and tests pass locally (also verified by our automated build checks)\r\n- [ ] Commit messages follow this format:\r\n```\r\n        Summary of the changes\r\n        - Store only the data we need\r\n\r\n        Fixes #34028\r\n```\r\n- [ ] Tests for the changes have been added (for bug fixes / features)\r\n- [ ] Code follows the same patterns and style as existing code in this repo\r\n\r\n#34028 \r\n\r\n","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34631/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34631/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2338219521","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2338219521","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2338219521,"node_id":"IC_kwDOAPaMMs6LXmYB","user":{"login":"cliffankh0z","id":180958674,"node_id":"U_kgDOCsk10g","avatar_url":"https://avatars.githubusercontent.com/u/180958674?v=4","gravatar_id":"","url":"https://api.github.com/users/cliffankh0z","html_url":"https://github.com/cliffankh0z","followers_url":"https://api.github.com/users/cliffankh0z/followers","following_url":"https://api.github.com/users/cliffankh0z/following{/other_user}","gists_url":"https://api.github.com/users/cliffankh0z/gists{/gist_id}","starred_url":"https://api.github.com/users/cliffankh0z/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cliffankh0z/subscriptions","organizations_url":"https://api.github.com/users/cliffankh0z/orgs","repos_url":"https://api.github.com/users/cliffankh0z/repos","events_url":"https://api.github.com/users/cliffankh0z/events{/privacy}","received_events_url":"https://api.github.com/users/cliffankh0z/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-09T14:04:14Z","updated_at":"2024-09-09T14:57:02Z","body":"@ajcvickers found the bug, inspect IMemoryCache in a breakpoint and you'll see what is mean. Lists of Guids and all different kinds of parameter values are put in IMemoryCache as CommandCacheKey. Only need the type info for the cache key, not the actual parameter value. These object can link to other object, which links to other objects thereby keeping all of them in memory\r\n\r\nYoull have to use  optionsBuilder.UseMemoryCache(_memoryCache); to be able to inspect this","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2338219521/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cliffankh0z","id":180958674,"node_id":"U_kgDOCsk10g","avatar_url":"https://avatars.githubusercontent.com/u/180958674?v=4","gravatar_id":"","url":"https://api.github.com/users/cliffankh0z","html_url":"https://github.com/cliffankh0z","followers_url":"https://api.github.com/users/cliffankh0z/followers","following_url":"https://api.github.com/users/cliffankh0z/following{/other_user}","gists_url":"https://api.github.com/users/cliffankh0z/gists{/gist_id}","starred_url":"https://api.github.com/users/cliffankh0z/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cliffankh0z/subscriptions","organizations_url":"https://api.github.com/users/cliffankh0z/orgs","repos_url":"https://api.github.com/users/cliffankh0z/repos","events_url":"https://api.github.com/users/cliffankh0z/events{/privacy}","received_events_url":"https://api.github.com/users/cliffankh0z/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14184085752,"node_id":"MEE_lADOAPaMMs6MsmczzwAAAANNb_j4","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14184085752","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-09-09T14:04:17Z","performed_via_github_app":null},{"id":14184085766,"node_id":"SE_lADOAPaMMs6MsmczzwAAAANNb_kG","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14184085766","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-09-09T14:04:17Z","performed_via_github_app":null},{"id":14192007880,"node_id":"AE_lADOAPaMMs6MsmczzwAAAANN6NrI","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14192007880","actor":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2024-09-10T03:41:22Z","assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":14466357084,"node_id":"MEE_lADOAPaMMs6MsmczzwAAAANeQxdc","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14466357084","actor":{"login":"cliffankh0z","id":180958674,"node_id":"U_kgDOCsk10g","avatar_url":"https://avatars.githubusercontent.com/u/180958674?v=4","gravatar_id":"","url":"https://api.github.com/users/cliffankh0z","html_url":"https://github.com/cliffankh0z","followers_url":"https://api.github.com/users/cliffankh0z/followers","following_url":"https://api.github.com/users/cliffankh0z/following{/other_user}","gists_url":"https://api.github.com/users/cliffankh0z/gists{/gist_id}","starred_url":"https://api.github.com/users/cliffankh0z/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cliffankh0z/subscriptions","organizations_url":"https://api.github.com/users/cliffankh0z/orgs","repos_url":"https://api.github.com/users/cliffankh0z/repos","events_url":"https://api.github.com/users/cliffankh0z/events{/privacy}","received_events_url":"https://api.github.com/users/cliffankh0z/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-01T05:59:27Z","performed_via_github_app":null},{"id":14466357099,"node_id":"SE_lADOAPaMMs6MsmczzwAAAANeQxdr","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14466357099","actor":{"login":"cliffankh0z","id":180958674,"node_id":"U_kgDOCsk10g","avatar_url":"https://avatars.githubusercontent.com/u/180958674?v=4","gravatar_id":"","url":"https://api.github.com/users/cliffankh0z","html_url":"https://github.com/cliffankh0z","followers_url":"https://api.github.com/users/cliffankh0z/followers","following_url":"https://api.github.com/users/cliffankh0z/following{/other_user}","gists_url":"https://api.github.com/users/cliffankh0z/gists{/gist_id}","starred_url":"https://api.github.com/users/cliffankh0z/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cliffankh0z/subscriptions","organizations_url":"https://api.github.com/users/cliffankh0z/orgs","repos_url":"https://api.github.com/users/cliffankh0z/repos","events_url":"https://api.github.com/users/cliffankh0z/events{/privacy}","received_events_url":"https://api.github.com/users/cliffankh0z/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-01T05:59:27Z","performed_via_github_app":null},{"actor":{"login":"yinzara","id":671855,"node_id":"MDQ6VXNlcjY3MTg1NQ==","avatar_url":"https://avatars.githubusercontent.com/u/671855?v=4","gravatar_id":"","url":"https://api.github.com/users/yinzara","html_url":"https://github.com/yinzara","followers_url":"https://api.github.com/users/yinzara/followers","following_url":"https://api.github.com/users/yinzara/following{/other_user}","gists_url":"https://api.github.com/users/yinzara/gists{/gist_id}","starred_url":"https://api.github.com/users/yinzara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yinzara/subscriptions","organizations_url":"https://api.github.com/users/yinzara/orgs","repos_url":"https://api.github.com/users/yinzara/repos","events_url":"https://api.github.com/users/yinzara/events{/privacy}","received_events_url":"https://api.github.com/users/yinzara/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-01T06:00:29Z","updated_at":"2024-10-01T06:00:29Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34803","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34803/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34803/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34803/events","html_url":"https://github.com/dotnet/efcore/pull/34803","id":2558261909,"node_id":"PR_kwDOAPaMMs59NCqx","number":34803,"title":"Keep parameter values out IMemoryCache in RelationalCommandCache","user":{"login":"yinzara","id":671855,"node_id":"MDQ6VXNlcjY3MTg1NQ==","avatar_url":"https://avatars.githubusercontent.com/u/671855?v=4","gravatar_id":"","url":"https://api.github.com/users/yinzara","html_url":"https://github.com/yinzara","followers_url":"https://api.github.com/users/yinzara/followers","following_url":"https://api.github.com/users/yinzara/following{/other_user}","gists_url":"https://api.github.com/users/yinzara/gists{/gist_id}","starred_url":"https://api.github.com/users/yinzara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yinzara/subscriptions","organizations_url":"https://api.github.com/users/yinzara/orgs","repos_url":"https://api.github.com/users/yinzara/repos","events_url":"https://api.github.com/users/yinzara/events{/privacy}","received_events_url":"https://api.github.com/users/yinzara/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2024-10-01T06:00:28Z","updated_at":"2024-10-14T20:41:32Z","closed_at":"2024-10-14T20:41:32Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dotnet/efcore/pulls/34803","html_url":"https://github.com/dotnet/efcore/pull/34803","diff_url":"https://github.com/dotnet/efcore/pull/34803.diff","patch_url":"https://github.com/dotnet/efcore/pull/34803.patch","merged_at":"2024-10-14T20:41:32Z"},"body":"Only store necessary info for parameter values RelationalCommandCacheKey to prevent memory leaks.\r\n\r\nThis a relatively serious memory leak defect and needs to be ported back to the `release/8.0` branch as well.\r\n\r\nFixes #34028\r\n\r\n- [X] I've read the guidelines for [contributing](CONTRIBUTING.md) and seen the [walkthrough](https://youtu.be/9OMxy1wal1s?t=1869)\r\n- [X] I've posted a comment on an issue with a detailed description of how I am planning to contribute and got approval from a member of the team\r\n- [X] The code builds and tests pass locally (also verified by our automated build checks)\r\n- [X] Commit messages follow this format:\r\n```\r\n        Summary of the changes\r\n        - Detail 1\r\n        - Detail 2\r\n\r\n        Fixes #bugnumber\r\n```\r\n- [X] Tests for the changes have been added (for bug fixes / features)\r\n- [X] Code follows the same patterns and style as existing code in this repo\r\n\r\n","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34803/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34803/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":14466473027,"node_id":"REFE_lADOAPaMMs6MsmczzwAAAANeRNxD","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14466473027","actor":{"login":"yinzara","id":671855,"node_id":"MDQ6VXNlcjY3MTg1NQ==","avatar_url":"https://avatars.githubusercontent.com/u/671855?v=4","gravatar_id":"","url":"https://api.github.com/users/yinzara","html_url":"https://github.com/yinzara","followers_url":"https://api.github.com/users/yinzara/followers","following_url":"https://api.github.com/users/yinzara/following{/other_user}","gists_url":"https://api.github.com/users/yinzara/gists{/gist_id}","starred_url":"https://api.github.com/users/yinzara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yinzara/subscriptions","organizations_url":"https://api.github.com/users/yinzara/orgs","repos_url":"https://api.github.com/users/yinzara/repos","events_url":"https://api.github.com/users/yinzara/events{/privacy}","received_events_url":"https://api.github.com/users/yinzara/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c95c928a597e3522880b9fe35e6c95ec6f015e96","commit_url":"https://api.github.com/repos/yinzara/efcore/commits/c95c928a597e3522880b9fe35e6c95ec6f015e96","created_at":"2024-10-01T06:12:00Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2384885184","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2384885184","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2384885184,"node_id":"IC_kwDOAPaMMs6OJnXA","user":{"login":"yinzara","id":671855,"node_id":"MDQ6VXNlcjY3MTg1NQ==","avatar_url":"https://avatars.githubusercontent.com/u/671855?v=4","gravatar_id":"","url":"https://api.github.com/users/yinzara","html_url":"https://github.com/yinzara","followers_url":"https://api.github.com/users/yinzara/followers","following_url":"https://api.github.com/users/yinzara/following{/other_user}","gists_url":"https://api.github.com/users/yinzara/gists{/gist_id}","starred_url":"https://api.github.com/users/yinzara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yinzara/subscriptions","organizations_url":"https://api.github.com/users/yinzara/orgs","repos_url":"https://api.github.com/users/yinzara/repos","events_url":"https://api.github.com/users/yinzara/events{/privacy}","received_events_url":"https://api.github.com/users/yinzara/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-01T06:13:24Z","updated_at":"2024-10-02T04:02:29Z","body":"I have now been able to reliably reproduce this issue and am producing a PR to fix it.\r\n\r\nThank you to @cliffankh0z for the PR that nearly fixed it already.\r\n\r\nThe following test case should work on both .NET 8 and .NET 9 (and is included in my PR) so it can be ported back to the `release/8.0` branch easily.  This fix is very important to get ported back ASAP as it is an active showstopper defect IMHO.\r\n\r\nIt shows the problem exists and now is fixed.\r\n\r\n```csharp\r\npublic class RelationalCommandCacheTest\r\n{\r\n    [ConditionalFact]\r\n    public void MemoryLeak()\r\n    {\r\n        // Setup:\r\n        // allow 1000 records to exist for a sizeable enough cache to see the problem\r\n        const int cacheSize = 1000;\r\n\r\n        // create a parameter expression and mock sql generator and processors to pass into all relational command cache creations\r\n        var param = Expression.Parameter(typeof(string));\r\n        var expression = Expression.Lambda<Func<string, string>>(param, param); // _ => _\r\n        var memoryCache = new MemoryCache(Options.Create(new MemoryCacheOptions { SizeLimit = cacheSize }));\r\n        var generator = new TestSqlGeneratorFactory();\r\n        var processor = new TestSqlProcessorFactory();\r\n        var cache = new RelationalCommandCache(memoryCache, generator, processor, expression, false\r\n#if !NET8_0\r\n            , null!\r\n#endif\r\n        );\r\n\r\n        // fill the cache completely once for a good baseline memory size\r\n        RunTest();\r\n        var memoryBefore = GC.GetTotalMemory(true);\r\n\r\n        // Act:\r\n        // attempt to look up the records again which should not increase the memory needed for the cache\r\n        // even though we will have all cache misses and new objects created with each lookup\r\n        RunTest();\r\n        var memoryAfter = GC.GetTotalMemory(true);\r\n\r\n        // Verify:\r\n        // memory footprint has not increased/decreased by more than a small margin of error (128k)\r\n        var difference = Math.Abs(memoryAfter - memoryBefore) / 1024;\r\n        Assert.True(difference < 128, $\"Memory leak detected in RelationalCommandCache: {difference}kb\");\r\n\r\n        return;\r\n        void RunTest()\r\n        {\r\n            for (var i = 0; i < cacheSize; i++) // run the size limit of the cache to completely replace all entries\r\n            {\r\n                var parameters = new ReadOnlyDictionary<string, object?>(new Dictionary<string, object?>\r\n                {\r\n                    // allocate a large object array with each parameter creation to exacerbate the problem\r\n                    // use a random key to cause a consistent cache miss\r\n                    [Guid.NewGuid().ToString()] = Enumerable.Range(1, 5000).Select(j => $\"{j}\").ToArray<object>()\r\n                });\r\n                cache.GetRelationalCommandTemplate(\r\n                    parameters); // ignore the result so it gets garbage collected\r\n            }\r\n        }\r\n    }\r\n\r\n    private class TestSqlProcessorFactory : IRelationalParameterBasedSqlProcessorFactory\r\n    {\r\n#if NET8_0\r\n        public RelationalParameterBasedSqlProcessor Create(bool useRelationalNulls)\r\n#else\r\n        public RelationalParameterBasedSqlProcessor Create(RelationalParameterBasedSqlProcessorParameters parameters)\r\n#endif\r\n            => new TestRelationalParameterBasedSqlProcessor();\r\n    }\r\n\r\n    private class TestRelationalParameterBasedSqlProcessor : RelationalParameterBasedSqlProcessor\r\n    {\r\n        internal TestRelationalParameterBasedSqlProcessor() : base(null!, null!) {}\r\n\r\n        public override Expression Optimize(\r\n            Expression queryExpression,\r\n            IReadOnlyDictionary<string, object?> parametersValues,\r\n            out bool canCache)\r\n        {\r\n            canCache = true;\r\n            return null!;\r\n        }\r\n    }\r\n\r\n    private class TestSqlGeneratorFactory : IQuerySqlGeneratorFactory\r\n    {\r\n        public QuerySqlGenerator Create()\r\n            => new TestQuerySqlGenerator();\r\n    }\r\n\r\n    private class TestQuerySqlGenerator() : QuerySqlGenerator(new QuerySqlGeneratorDependencies(null!, null!))\r\n    {\r\n        public override IRelationalCommand GetCommand(Expression queryExpression)\r\n            => new TestRelationalCommand();\r\n    }\r\n\r\n    private class TestRelationalCommand : IRelationalCommand\r\n    {\r\n        public string CommandText\r\n            => throw new NotImplementedException();\r\n\r\n        public IReadOnlyList<IRelationalParameter> Parameters\r\n            => throw new NotImplementedException();\r\n\r\n        public DbCommand CreateDbCommand(RelationalCommandParameterObject parameterObject, Guid commandId, DbCommandMethod commandMethod)\r\n            => throw new NotImplementedException();\r\n\r\n        public int ExecuteNonQuery(RelationalCommandParameterObject parameterObject)\r\n            => throw new NotImplementedException();\r\n\r\n        public Task<int> ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default)\r\n            => throw new NotImplementedException();\r\n\r\n        public object ExecuteScalar(RelationalCommandParameterObject parameterObject)\r\n            => throw new NotImplementedException();\r\n\r\n        public Task<object?> ExecuteScalarAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default)\r\n            => throw new NotImplementedException();\r\n\r\n        public RelationalDataReader ExecuteReader(RelationalCommandParameterObject parameterObject)\r\n            => throw new NotImplementedException();\r\n\r\n        public Task<RelationalDataReader> ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default)\r\n            => throw new NotImplementedException();\r\n\r\n        public void PopulateFrom(IRelationalCommandTemplate commandTemplate)\r\n            => throw new NotImplementedException();\r\n    }\r\n}\r\n\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2384885184/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yinzara","id":671855,"node_id":"MDQ6VXNlcjY3MTg1NQ==","avatar_url":"https://avatars.githubusercontent.com/u/671855?v=4","gravatar_id":"","url":"https://api.github.com/users/yinzara","html_url":"https://github.com/yinzara","followers_url":"https://api.github.com/users/yinzara/followers","following_url":"https://api.github.com/users/yinzara/following{/other_user}","gists_url":"https://api.github.com/users/yinzara/gists{/gist_id}","starred_url":"https://api.github.com/users/yinzara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yinzara/subscriptions","organizations_url":"https://api.github.com/users/yinzara/orgs","repos_url":"https://api.github.com/users/yinzara/repos","events_url":"https://api.github.com/users/yinzara/events{/privacy}","received_events_url":"https://api.github.com/users/yinzara/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14466486562,"node_id":"MEE_lADOAPaMMs6MsmczzwAAAANeRREi","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14466486562","actor":{"login":"cliffankh0z","id":180958674,"node_id":"U_kgDOCsk10g","avatar_url":"https://avatars.githubusercontent.com/u/180958674?v=4","gravatar_id":"","url":"https://api.github.com/users/cliffankh0z","html_url":"https://github.com/cliffankh0z","followers_url":"https://api.github.com/users/cliffankh0z/followers","following_url":"https://api.github.com/users/cliffankh0z/following{/other_user}","gists_url":"https://api.github.com/users/cliffankh0z/gists{/gist_id}","starred_url":"https://api.github.com/users/cliffankh0z/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cliffankh0z/subscriptions","organizations_url":"https://api.github.com/users/cliffankh0z/orgs","repos_url":"https://api.github.com/users/cliffankh0z/repos","events_url":"https://api.github.com/users/cliffankh0z/events{/privacy}","received_events_url":"https://api.github.com/users/cliffankh0z/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-01T06:13:25Z","performed_via_github_app":null},{"id":14466486575,"node_id":"SE_lADOAPaMMs6MsmczzwAAAANeRREv","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14466486575","actor":{"login":"cliffankh0z","id":180958674,"node_id":"U_kgDOCsk10g","avatar_url":"https://avatars.githubusercontent.com/u/180958674?v=4","gravatar_id":"","url":"https://api.github.com/users/cliffankh0z","html_url":"https://github.com/cliffankh0z","followers_url":"https://api.github.com/users/cliffankh0z/followers","following_url":"https://api.github.com/users/cliffankh0z/following{/other_user}","gists_url":"https://api.github.com/users/cliffankh0z/gists{/gist_id}","starred_url":"https://api.github.com/users/cliffankh0z/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cliffankh0z/subscriptions","organizations_url":"https://api.github.com/users/cliffankh0z/orgs","repos_url":"https://api.github.com/users/cliffankh0z/repos","events_url":"https://api.github.com/users/cliffankh0z/events{/privacy}","received_events_url":"https://api.github.com/users/cliffankh0z/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-01T06:13:25Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2386545607","html_url":"https://github.com/dotnet/efcore/issues/34028#issuecomment-2386545607","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34028","id":2386545607,"node_id":"IC_kwDOAPaMMs6OP8vH","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-01T17:12:42Z","updated_at":"2024-10-01T17:12:42Z","body":"@yinzara and others, I can indeed see that RelationalCommandCache retains references to user data, which indeed isn't ideal. But I'd like to make sure we're on the same page in terms of whether there's an actual leak here.\r\n\r\nEF instantiates a RelationalCommandCache for each LINQ query it compiles. The point of that cache is to have one entry for each permutation of parameter nullability values; that is, if there are two parameters in the query, there should always be at most 4 entries in that query's cache. In other words, you can execute the same query as many times as you want with as many values, it will only ever retain the user values from the first four invocations. It's certainly not great that the user values are retained, but I'm not seeing a leak here in the regular sense.\r\n\r\nNow, if you run **different** queries, you'll get different instances of RelationalCommandCache, which each will retain some user values. The total number of RelationalCommandCaches instances has an upper limit though, and old ones will get evicted. So again, I don't see a critical leak here either. @yinzara your repro above creates an unbounded number of RelationalCommandCache instances, which doesn't correspond to how EF actually works.\r\n\r\nTo be sure, I think we should improve things, but at this point I'm still not seeing a critical leak that needs to be fixed and backported. If I've missed something, an EF repro - not an artificial unit test-like repro that @yinzara wrote above - would help here.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2386545607/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}}]