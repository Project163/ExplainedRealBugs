{"url":"https://api.github.com/repos/dotnet/efcore/issues/34617","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34617/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34617/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34617/events","html_url":"https://github.com/dotnet/efcore/issues/34617","id":2507286796,"node_id":"I_kwDOAPaMMs6VcikM","number":34617,"title":"Abstract IDesignTimeServices leads to MissingMethodException with `ef migrations add`","user":{"login":"Danielku15","id":674916,"node_id":"MDQ6VXNlcjY3NDkxNg==","avatar_url":"https://avatars.githubusercontent.com/u/674916?v=4","gravatar_id":"","url":"https://api.github.com/users/Danielku15","html_url":"https://github.com/Danielku15","followers_url":"https://api.github.com/users/Danielku15/followers","following_url":"https://api.github.com/users/Danielku15/following{/other_user}","gists_url":"https://api.github.com/users/Danielku15/gists{/gist_id}","starred_url":"https://api.github.com/users/Danielku15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Danielku15/subscriptions","organizations_url":"https://api.github.com/users/Danielku15/orgs","repos_url":"https://api.github.com/users/Danielku15/repos","events_url":"https://api.github.com/users/Danielku15/events{/privacy}","received_events_url":"https://api.github.com/users/Danielku15/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900942474,"node_id":"MDU6TGFiZWwxOTAwOTQyNDc0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-migrations","name":"area-migrations","color":"32b37b","default":false,"description":""},{"id":9022438466,"node_id":"LA_kwDOAPaMMs8AAAACGcd8Qg","url":"https://api.github.com/repos/dotnet/efcore/labels/rc-2","name":"rc-2","color":"ACB3D7","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"Copilot","id":198982749,"node_id":"BOT_kgDOC9w8XQ","avatar_url":"https://avatars.githubusercontent.com/in/1143301?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-swe-agent","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/204","html_url":"https://github.com/dotnet/efcore/milestone/204","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/204/labels","id":11480673,"node_id":"MI_kwDOAPaMMs4Ary5h","number":204,"title":"10.0.0","description":"","creator":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":193,"state":"open","created_at":"2024-08-23T12:48:26Z","updated_at":"2025-11-05T08:24:30Z","due_on":null,"closed_at":null},"comments":1,"created_at":"2024-09-05T09:37:44Z","updated_at":"2025-09-08T19:59:10Z","closed_at":"2025-08-25T20:17:02Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## File a bug\r\n\r\nIf you have any non-constructable implementation of `Microsoft.EntityFrameworkCore.Design.IDesignTimeServices` in your application and you run `dotnet ef migrations add` you end up with an exception. \r\n\r\n### Include your code\r\n\r\n```cs\r\n[assembly: DesignTimeServicesReference(\"Data.Entity.ActualDesignTimeServices, MyProject\")]\r\n\r\nnamespace Data.Entity;\r\n\r\n#pragma warning disable EF1001\r\n\r\npublic abstract class DesignTimeServicesBase : IDesignTimeServices\r\n{\r\n    public void ConfigureDesignTimeServices(IServiceCollection serviceCollection)\r\n    {\r\n        DoSomething();\r\n    }\r\n\r\n    protected abstract void DoSomething();\r\n}\r\n\r\npublic class ActualDesignTimeServices : DesignTimeServicesBase\r\n{\r\n    protected override void DoSomething()\r\n    {\r\n\r\n    }\r\n}\r\n```\r\n\r\n### Include stack traces\r\n\r\n```\r\nSystem.MissingMethodException: Cannot dynamically create an instance of type 'Data.Entity.DesignTimeServicesBase'. Reason: Cannot create an abstract class.\r\n   at System.RuntimeType.ActivatorCache..ctor(RuntimeType rt)\r\n   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DesignTimeServicesBuilder.ConfigureDesignTimeServices(Type designTimeServicesType, IServiceCollection services)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DesignTimeServicesBuilder.ConfigureUserServices(IServiceCollection services)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DesignTimeServicesBuilder.CreateServiceCollection(DbContext context)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DesignTimeServicesBuilder.Build(DbContext context)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.AddMigration(String name, String outputDir, String contextType, String namespace)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigrationImpl(String name, String outputDir, String contextType, String namespace)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigration.<>c__DisplayClass0_0.<.ctor>b__0()\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.<>c__DisplayClass3_0`1.<Execute>b__0()\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\r\n```\r\n\r\n### Include verbose output\r\n\r\nPlease include `--verbose` output when filing bugs about the `dotnet ef` or Package Manager Console tools.\r\n\r\nUse triple-tick fences for tool output. For example:\r\n\r\n```\r\nC:\\Stuff\\AllTogetherNow\\FiveOh>dotnet ef migrations add Test\r\nUsing project 'D:\\Dev\\Git\\MyProject\\MyProject\\MyProject.csproj'.\r\nUsing startup project 'D:\\Dev\\Git\\MyProject\\MyProject\\MyProject.csproj'.\r\nWriting 'D:\\Dev\\Git\\MyProject\\MyProject\\obj\\MyProject.csproj.EntityFrameworkCore.targets'...\r\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\KUSC\\AppData\\Local\\Temp\\tmpxmo5k5.tmp /verbosity:quiet /nologo D:\\Dev\\Git\\MyProject\\MyProject\\MyProject.csproj\r\nWriting 'D:\\Dev\\Git\\MyProject\\MyProject\\obj\\MyProject.csproj.EntityFrameworkCore.targets'...\r\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\KUSC\\AppData\\Local\\Temp\\tmphd3bny.tmp /verbosity:quiet /nologo D:\\Dev\\Git\\MyProject\\MyProject\\MyProject.csproj\r\nBuild started...\r\ndotnet build D:\\Dev\\Git\\MyProject\\MyProject\\MyProject.csproj /verbosity:quiet /nologo /p:PublishAot=false\r\n\r\nBuild succeeded.\r\n    0 Warning(s)\r\n    0 Error(s)\r\n\r\nTime Elapsed 00:00:02.80\r\n\r\nWorkload updates are available. Run `dotnet workload list` for more information.\r\nBuild succeeded.\r\ndotnet exec --depsfile D:\\Dev\\Git\\MyProject\\MyProject\\bin\\Debug\\net8.0\\MyProject.deps.json --additionalprobingpath C:\\Users\\KUSC\\.nuget\\packages --additionalprobingpath \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\NuGetPackages\" --runtimeconfig D:\\Dev\\Git\\\r\nMyProject\\MyProject\\bin\\Debug\\net8.0\\MyProject.runtimeconfig.json C:\\Users\\KUSC\\.dotnet\\tools\\.store\\dotnet-ef\\8.0.6\\dotnet-ef\\8.0.6\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll migrations add InitialSchema --assembly D:\\Dev\\Git\\MyProject\\MyProject\\bin\\D\r\nebug\\net8.0\\MyProject.dll --project D:\\Dev\\Git\\MyProject\\MyProject\\MyProject.csproj --startup-assembly D:\\Dev\\Git\\MyProject\\MyProject\\bin\\Debug\\net8.0\\MyProject.dll --startup-project D:\\Dev\\Git\\MyProject\\MyProject\\MyProject.csproj --project-dir D:\\Dev\\Git\\MyProject\\MyProject\\ --root-namespace MyProject --language C# --framework net8.0 --nullable --working-dir D:\\Dev\\Git\\MyProject --verbose\r\nUsing assembly 'MyProject'.\r\nUsing startup assembly 'MyProject'.\r\nUsing application base 'D:\\Dev\\Git\\MyProject\\MyProject\\bin\\Debug\\net8.0'.\r\nUsing working directory 'D:\\Dev\\Git\\MyProject\\MyProject'.\r\nUsing root namespace 'MyProject'.\r\nUsing project directory 'D:\\Dev\\Git\\MyProject\\MyProject\\'.\r\nRemaining arguments: .\r\nThe Entity Framework tools version '8.0.6' is older than that of the runtime '8.0.8'. Update the tools for the latest features and bug fixes. See https://aka.ms/AAc1fbw for more information.\r\nFinding DbContext classes...\r\nFinding IDesignTimeDbContextFactory implementations...\r\nFinding application service provider in assembly 'MyProject'...\r\nFinding Microsoft.Extensions.Hosting service provider...\r\nUsing environment 'Development'.\r\nUsing application service provider from Microsoft.Extensions.Hosting.\r\nFound DbContext 'MyDbContext'.\r\nFinding DbContext classes in the project...\r\nUsing context 'MyDbContext'.\r\nFinding design-time services referenced by assembly 'MyProject'...\r\nFinding design-time services referenced by assembly 'MyProject'...\r\nUsing design-time services from assembly 'MyProject'.\r\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\r\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\r\nFinding IDesignTimeServices implementations in assembly 'MyProject'...\r\nUsing design-time services from class 'DesignTimeServicesBase'.\r\nSystem.MissingMethodException: Cannot dynamically create an instance of type 'MyProject.Data.Entity.DesignTimeServicesBase'. Reason: Cannot create an abstract class.\r\n   at System.RuntimeType.ActivatorCache..ctor(RuntimeType rt)\r\n   at System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly, Boolean wrapExceptions)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DesignTimeServicesBuilder.ConfigureDesignTimeServices(Type designTimeServicesType, IServiceCollection services)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DesignTimeServicesBuilder.ConfigureUserServices(IServiceCollection services)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DesignTimeServicesBuilder.CreateServiceCollection(DbContext context)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.DesignTimeServicesBuilder.Build(DbContext context)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.AddMigration(String name, String outputDir, String contextType, String namespace)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigrationImpl(String name, String outputDir, String contextType, String namespace)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigration.<>c__DisplayClass0_0.<.ctor>b__0()\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.<>c__DisplayClass3_0`1.<Execute>b__0()\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\r\nCannot dynamically create an instance of type 'MyProject.Data.Entity.DesignTimeServicesBase'. Reason: Cannot create an abstract class.\r\n```\r\n\r\n### Problem location\r\n\r\nThe problem is caused here:\r\n\r\nhttps://github.com/dotnet/efcore/blob/af1047eeae730a37dd0d106c113e3b518132adbc/src/EFCore.Design/Design/Internal/DesignTimeServicesBuilder.cs#L101\r\n\r\nEF doesn't check if the type can be really constructed and then fails subsequently. \r\n\r\n### Include provider and version information\r\n\r\nEF Core version: 8.0.8\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework: .NET 8.0\r\nOperating system: Windows 11 Professional\r\nIDE: CLI\r\n\r\n\r\n","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34617/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34617/timeline","performed_via_github_app":null,"state_reason":"completed"}