{"url":"https://api.github.com/repos/dotnet/efcore/issues/32679","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/32679/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/32679/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/32679/events","html_url":"https://github.com/dotnet/efcore/issues/32679","id":2056941262,"node_id":"I_kwDOAPaMMs56mm7O","number":32679,"title":"Exception when writing a JSON column with negative enum value","user":{"login":"MoryakSPb","id":31323043,"node_id":"MDQ6VXNlcjMxMzIzMDQz","avatar_url":"https://avatars.githubusercontent.com/u/31323043?v=4","gravatar_id":"","url":"https://api.github.com/users/MoryakSPb","html_url":"https://github.com/MoryakSPb","followers_url":"https://api.github.com/users/MoryakSPb/followers","following_url":"https://api.github.com/users/MoryakSPb/following{/other_user}","gists_url":"https://api.github.com/users/MoryakSPb/gists{/gist_id}","starred_url":"https://api.github.com/users/MoryakSPb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MoryakSPb/subscriptions","organizations_url":"https://api.github.com/users/MoryakSPb/orgs","repos_url":"https://api.github.com/users/MoryakSPb/repos","events_url":"https://api.github.com/users/MoryakSPb/events{/privacy}","received_events_url":"https://api.github.com/users/MoryakSPb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1901073050,"node_id":"MDU6TGFiZWwxOTAxMDczMDUw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-type-mapping","name":"area-type-mapping","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/186","html_url":"https://github.com/dotnet/efcore/milestone/186","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/186/labels","id":10201144,"node_id":"MI_kwDOAPaMMs4Am6g4","number":186,"title":"8.0.2","description":null,"creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":44,"state":"closed","created_at":"2023-11-17T09:03:59Z","updated_at":"2024-05-05T12:55:36Z","due_on":null,"closed_at":"2024-04-09T08:40:11Z"},"comments":1,"created_at":"2023-12-27T05:46:56Z","updated_at":"2025-06-15T19:56:19Z","closed_at":"2024-01-10T02:16:07Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When EF try writing a JSON document that contains negative enum value, an System.OverflowException is thrown.\r\n\r\nTest project: <https://github.com/MoryakSPb/EfEnumJson>\r\n\r\nStack trace:\r\n```\r\nSystem.OverflowException: Value was either too large or too small for a UInt64.\r\n   at System.Convert.ThrowUInt64OverflowException()\r\n   at System.Int32.System.IConvertible.ToUInt64(IFormatProvider provider)\r\n   at System.Convert.ChangeType(Object value, Type conversionType, IFormatProvider provider)\r\n   at Microsoft.EntityFrameworkCore.Storage.Json.JsonWarningEnumReaderWriter`1.ToJsonTyped(Utf8JsonWriter writer, TEnum value)\r\n   at Microsoft.EntityFrameworkCore.Storage.Json.JsonValueReaderWriter`1.ToJson(Utf8JsonWriter writer, Object value)\r\n   at Microsoft.EntityFrameworkCore.Update.ModificationCommand.WriteJson(Utf8JsonWriter writer, Object navigationValue, IUpdateEntry parentEntry, IEntityType entityType, Nullable`1 ordinal, Boolean isCollection, Boolean isTopLevel)\r\n   at Microsoft.EntityFrameworkCore.Update.ModificationCommand.<GenerateColumnModifications>g__HandleJson|41_4(List`1 columnModifications, <>c__DisplayClass41_0&)\r\n   at Microsoft.EntityFrameworkCore.Update.ModificationCommand.GenerateColumnModifications()\r\n   at Microsoft.EntityFrameworkCore.Update.ModificationCommand.<>c.<get_ColumnModifications>b__33_0(ModificationCommand command)\r\n   at Microsoft.EntityFrameworkCore.Internal.NonCapturingLazyInitializer.EnsureInitialized[TParam,TValue](TValue& target, TParam param, Func`2 valueFactory)\r\n   at Microsoft.EntityFrameworkCore.Update.ModificationCommand.get_ColumnModifications()\r\n   at Microsoft.EntityFrameworkCore.Update.UpdateSqlGenerator.AppendInsertReturningOperation(StringBuilder commandStringBuilder, IReadOnlyModificationCommand command, Int32 commandPosition, Boolean& requiresTransaction)\r\n   at Microsoft.EntityFrameworkCore.Sqlite.Update.Internal.SqliteUpdateSqlGenerator.AppendInsertOperation(StringBuilder commandStringBuilder, IReadOnlyModificationCommand command, Int32 commandPosition, Boolean& requiresTransaction)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.AddCommand(IReadOnlyModificationCommand modificationCommand)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.TryAddCommand(IReadOnlyModificationCommand modificationCommand)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.CommandBatchPreparer.CreateCommandBatches(IEnumerable`1 commandSet, Boolean moreCommandSets, Boolean assertColumnModification, ParameterNameGenerator parameterNameGenerator)+MoveNext()\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.CommandBatchPreparer.BatchCommands(IList`1 entries, IUpdateAdapter updateAdapter)+MoveNext()\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at EfEnumJson.Tests.EnumTests.EnumToJson(MyEnum value) in I:\\SourceCodes\\EfEnumJson\\EfEnumJson.Tests\\EnumTest.cs:line 36\r\n```\r\n\r\n## Provider and version information\r\n\r\nEF Core version: 8.0.0\r\n\r\nDatabase provider: Microsoft.EntityFrameworkCore.Sqlite\r\n(actual for Npgsql.EntityFrameworkCore.PostgreSQL also)\r\n\r\nTarget framework: .NET 8.0.0\r\n\r\nOperating system: Windows 11 22H2 (22621.2861)\r\n\r\nIDE: Visual Studio 2022 17.8.3\r\n","closed_by":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/32679/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/32679/timeline","performed_via_github_app":null,"state_reason":"completed"}