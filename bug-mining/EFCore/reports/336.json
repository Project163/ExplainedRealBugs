{"url":"https://api.github.com/repos/dotnet/efcore/issues/32461","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/32461/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/32461/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/32461/events","html_url":"https://github.com/dotnet/efcore/issues/32461","id":2018386510,"node_id":"I_kwDOAPaMMs54TiJO","number":32461,"title":"Allow Migrations assemble to be loaded from different assemblyLoadContexts","user":{"login":"davidnajar","id":4757467,"node_id":"MDQ6VXNlcjQ3NTc0Njc=","avatar_url":"https://avatars.githubusercontent.com/u/4757467?v=4","gravatar_id":"","url":"https://api.github.com/users/davidnajar","html_url":"https://github.com/davidnajar","followers_url":"https://api.github.com/users/davidnajar/followers","following_url":"https://api.github.com/users/davidnajar/following{/other_user}","gists_url":"https://api.github.com/users/davidnajar/gists{/gist_id}","starred_url":"https://api.github.com/users/davidnajar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidnajar/subscriptions","organizations_url":"https://api.github.com/users/davidnajar/orgs","repos_url":"https://api.github.com/users/davidnajar/repos","events_url":"https://api.github.com/users/davidnajar/events{/privacy}","received_events_url":"https://api.github.com/users/davidnajar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900942474,"node_id":"MDU6TGFiZWwxOTAwOTQyNDc0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-migrations","name":"area-migrations","color":"32b37b","default":false,"description":""},{"id":2402623482,"node_id":"MDU6TGFiZWwyNDAyNjIzNDgy","url":"https://api.github.com/repos/dotnet/efcore/labels/community-contribution","name":"community-contribution","color":"004caa","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/180","html_url":"https://github.com/dotnet/efcore/milestone/180","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/180/labels","id":9963267,"node_id":"MI_kwDOAPaMMs4AmAcD","number":180,"title":"9.0.0","description":null,"creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":339,"state":"closed","created_at":"2023-09-25T15:41:58Z","updated_at":"2025-04-01T18:19:15Z","due_on":null,"closed_at":"2024-11-14T11:54:05Z"},"comments":1,"created_at":"2023-11-30T10:57:31Z","updated_at":"2025-06-15T19:55:14Z","closed_at":"2023-12-07T15:37:22Z","author_association":"CONTRIBUTOR","type":{"id":1092406,"node_id":"IT_kwDOAIt-yc4AEKs2","name":"Feature","description":"A request, idea, or new functionality","color":"blue","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-10-08T09:10:05Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- What problem are you trying to solve? -->\r\nCurrently, when developing a plugin-based mechanism where each plugin is loaded from an isolated Assembly Load Context (for instance using [DotNetCorePlugins](https://github.com/natemcmaster/DotNetCorePlugins) the migrations can't be loaded from a referenced asembly of the plugin. They need to stay at the same type were the plugin type is defined. \r\nCurrently there are two options for defining the assembly where migrations are located: \r\n`builder.UseSqlServer(_connectionString,\r\n            b => b.MigrationsAssembly(migrationsAssembly);`\r\n\r\nbeing `migrationsAssembly `a plain string, or not specifying anything at all.\r\n\r\nInternally, this is handled in the following way:\r\n[MigrationsAssembly.cs](https://github.com/dotnet/efcore/blob/d49e211fb5f1405d74ff1474d3311d6cb4552a96/src/EFCore.Relational/Migrations/Internal/MigrationsAssembly.cs#L37)\r\n\r\n\r\n```\r\n public MigrationsAssembly(\r\n        ICurrentDbContext currentContext,\r\n        IDbContextOptions options,\r\n        IMigrationsIdGenerator idGenerator,\r\n        IDiagnosticsLogger<DbLoggerCategory.Migrations> logger)\r\n    {\r\n        _contextType = currentContext.Context.GetType();\r\n\r\n        var assemblyName = RelationalOptionsExtension.Extract(options).MigrationsAssembly;\r\n        Assembly = assemblyName == null\r\n            ? _contextType.Assembly\r\n            : Assembly.Load(new AssemblyName(assemblyName));\r\n\r\n        _idGenerator = idGenerator;\r\n        _logger = logger;\r\n    }\r\n\r\n```\r\n\r\nNote the condition: if there is not assemblyName specified it will use the same assembly where the context is defined. Otherwise will use Assembly.Load to load the assembly specified by name. \r\n\r\nThis does not work when the plugins are loaded from separate assembly load context, as the Assembly.Load is only loading assemblies from the AssemblyLoadContext.Default.\r\n<!-- Describe the solution you'd like -->\r\nIdeally, when specifying the migrations assembly, one could give directly the Assembly object, leveraging the responsibility of how to load the assembly to the caller, and not make assumptions like the one done with the Assembly.Load. There might be an overload to the \r\n```\r\npublic virtual TBuilder MigrationsAssembly(string? assemblyName)\r\n        => WithOption(e => (TExtension)e.WithMigrationsAssembly(Check.NullButNotEmpty(assemblyName, nameof(assemblyName))));\r\n```\r\naccepting an AssemblyObject itself","closed_by":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/32461/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/32461/timeline","performed_via_github_app":null,"state_reason":"completed"}