{"url":"https://api.github.com/repos/dotnet/efcore/issues/30885","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/30885/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/30885/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/30885/events","html_url":"https://github.com/dotnet/efcore/issues/30885","id":1708881857,"node_id":"I_kwDOAPaMMs5l23fB","number":30885,"title":"DateOnly/TimeOnly with JSON exceptions in preview 4","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1900941009,"node_id":"MDU6TGFiZWwxOTAwOTQxMDA5","url":"https://api.github.com/repos/dotnet/efcore/labels/area-save-changes","name":"area-save-changes","color":"32b37b","default":false,"description":""},{"id":4373235881,"node_id":"LA_kwDOAPaMMs8AAAABBKpIqQ","url":"https://api.github.com/repos/dotnet/efcore/labels/area-json","name":"area-json","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/152","html_url":"https://github.com/dotnet/efcore/milestone/152","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/152/labels","id":8392036,"node_id":"MI_kwDOAPaMMs4AgA1k","number":152,"title":"8.0.0","description":"EF Core 8.0","creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":280,"state":"closed","created_at":"2022-09-07T19:55:36Z","updated_at":"2025-04-07T08:59:46Z","due_on":null,"closed_at":"2023-11-14T14:00:33Z"},"comments":1,"created_at":"2023-05-14T09:43:57Z","updated_at":"2025-06-15T19:02:35Z","closed_at":"2023-09-08T16:45:09Z","author_association":"CONTRIBUTOR","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The [DateOnly/TimeOnly samples](https://github.com/dotnet/EntityFramework.Docs/blob/main/samples/core/Miscellaneous/NewInEFCore8/DateOnlyTimeOnlySample.cs) have started failing with Preview 4. Attempting to save the following:\r\n\r\n```\r\nOpeningHours {Id: 1} Unchanged\r\n  Id: 1 PK\r\n  ClosesAt: <null>\r\n  DayOfWeek: 'Sunday'\r\n  OpensAt: <null>\r\n  SchoolId: 1 FK\r\nOpeningHours {Id: 2} Unchanged\r\n  Id: 2 PK\r\n  ClosesAt: '6:00 PM'\r\n  DayOfWeek: 'Monday'\r\n  OpensAt: '8:00 AM'\r\n  SchoolId: 1 FK\r\nOpeningHours {Id: 3} Unchanged\r\n  Id: 3 PK\r\n  ClosesAt: '6:00 PM'\r\n  DayOfWeek: 'Tuesday'\r\n  OpensAt: '8:00 AM'\r\n  SchoolId: 1 FK\r\nOpeningHours {Id: 4} Unchanged\r\n  Id: 4 PK\r\n  ClosesAt: '6:00 PM'\r\n  DayOfWeek: 'Wednesday'\r\n  OpensAt: '8:00 AM'\r\n  SchoolId: 1 FK\r\nOpeningHours {Id: 5} Unchanged\r\n  Id: 5 PK\r\n  ClosesAt: '6:00 PM'\r\n  DayOfWeek: 'Thursday'\r\n  OpensAt: '8:00 AM'\r\n  SchoolId: 1 FK\r\nOpeningHours {Id: 6} Modified\r\n  Id: 6 PK\r\n  ClosesAt: '6:00 PM'\r\n  DayOfWeek: 'Friday'\r\n  OpensAt: '7:00 AM' Modified Originally '8:00 AM'\r\n  SchoolId: 1 FK\r\nOpeningHours {Id: 7} Unchanged\r\n  Id: 7 PK\r\n  ClosesAt: '5:00 PM'\r\n  DayOfWeek: 'Saturday'\r\n  OpensAt: '8:00 AM'\r\n  SchoolId: 1 FK\r\nOpeningHours {Id: 8} Unchanged\r\n  Id: 8 PK\r\n  ClosesAt: <null>\r\n  DayOfWeek: 'Sunday'\r\n  OpensAt: <null>\r\n  SchoolId: 2 FK\r\nOpeningHours {Id: 9} Unchanged\r\n  Id: 9 PK\r\n  ClosesAt: '3:35 PM'\r\n  DayOfWeek: 'Monday'\r\n  OpensAt: '8:45 AM'\r\n  SchoolId: 2 FK\r\nOpeningHours {Id: 10} Unchanged\r\n  Id: 10 PK\r\n  ClosesAt: '3:35 PM'\r\n  DayOfWeek: 'Tuesday'\r\n  OpensAt: '8:45 AM'\r\n  SchoolId: 2 FK\r\nOpeningHours {Id: 11} Unchanged\r\n  Id: 11 PK\r\n  ClosesAt: '3:35 PM'\r\n  DayOfWeek: 'Wednesday'\r\n  OpensAt: '8:45 AM'\r\n  SchoolId: 2 FK\r\nOpeningHours {Id: 12} Unchanged\r\n  Id: 12 PK\r\n  ClosesAt: '3:35 PM'\r\n  DayOfWeek: 'Thursday'\r\n  OpensAt: '8:45 AM'\r\n  SchoolId: 2 FK\r\nOpeningHours {Id: 13} Modified\r\n  Id: 13 PK\r\n  ClosesAt: '12:50 PM'\r\n  DayOfWeek: 'Friday'\r\n  OpensAt: '7:45 AM' Modified Originally '8:45 AM'\r\n  SchoolId: 2 FK\r\nOpeningHours {Id: 14} Unchanged\r\n  Id: 14 PK\r\n  ClosesAt: <null>\r\n  DayOfWeek: 'Saturday'\r\n  OpensAt: <null>\r\n  SchoolId: 2 FK\r\nSchool {Id: 1} Unchanged\r\n  Id: 1 PK\r\n  Founded: '5/11/1923'\r\n  Name: 'Stowe School'\r\n  OpeningHours: [{Id: 1}, {Id: 2}, {Id: 3}, {Id: 4}, {Id: 5}, {Id: 6}, {Id: 7}]\r\n  Terms: [{Id: 2}, {Id: 1}, {Id: 3}]\r\nSchool {Id: 2} Unchanged\r\n  Id: 2 PK\r\n  Founded: '5/1/1964'\r\n  Name: 'Farr High School'\r\n  OpeningHours: [{Id: 8}, {Id: 9}, {Id: 10}, {Id: 11}, {Id: 12}, {Id: 13}, {Id: 14}]\r\n  Terms: [{Id: 4}, {Id: 6}, {Id: 5}]\r\nTerm {Id: 1} Modified\r\n  Id: 1 PK\r\n  FirstDay: '9/7/2022'\r\n  LastDay: '12/17/2022' Modified Originally '12/16/2022'\r\n  Name: 'Michaelmas'\r\n  SchoolId: 1 FK\r\n  School: {Id: 1}\r\nTerm {Id: 2} Unchanged\r\n  Id: 2 PK\r\n  FirstDay: '1/8/2023'\r\n  LastDay: '3/24/2023'\r\n  Name: 'Lent'\r\n  SchoolId: 1 FK\r\n  School: {Id: 1}\r\nTerm {Id: 3} Unchanged\r\n  Id: 3 PK\r\n  FirstDay: '4/18/2023'\r\n  LastDay: '7/8/2023'\r\n  Name: 'Summer'\r\n  SchoolId: 1 FK\r\n  School: {Id: 1}\r\nTerm {Id: 4} Modified\r\n  Id: 4 PK\r\n  FirstDay: '8/16/2022'\r\n  LastDay: '12/24/2022' Modified Originally '12/23/2022'\r\n  Name: 'Autumn'\r\n  SchoolId: 2 FK\r\n  School: {Id: 2}\r\nTerm {Id: 5} Unchanged\r\n  Id: 5 PK\r\n  FirstDay: '1/9/2023'\r\n  LastDay: '3/31/2023'\r\n  Name: 'Winter'\r\n  SchoolId: 2 FK\r\n  School: {Id: 2}\r\nTerm {Id: 6} Unchanged\r\n  Id: 6 PK\r\n  FirstDay: '4/17/2023'\r\n  LastDay: '6/29/2023'\r\n  Name: 'Summer'\r\n  SchoolId: 2 FK\r\n  School: {Id: 2}\r\n```\r\n\r\nGenerates the following SQL:\r\n\r\n```\r\nfail: 5/14/2023 10:40:48.396 RelationalEventId.CommandError[20102] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Failed executing DbCommand (3ms) [Parameters=[@p0='07:00' (DbType = String), @p1='1', @p2='07:45' (DbType = String), @p3='2', @p5='1', @p4='12/17/2022' (DbType = Date), @p7='4', @p6='12/24/2022' (DbType = Date)], CommandType='Text', CommandTimeout='30']\r\n      SET NOCOUNT ON;\r\n      UPDATE [Schools] SET [OpeningHours] = JSON_MODIFY([OpeningHours], 'strict $[5].OpensAt', @p0)\r\n      OUTPUT 1\r\n      WHERE [Id] = @p1;\r\n      UPDATE [Schools] SET [OpeningHours] = JSON_MODIFY([OpeningHours], 'strict $[5].OpensAt', @p2)\r\n      OUTPUT 1\r\n      WHERE [Id] = @p3;\r\n      UPDATE [Term] SET [LastDay] = @p4\r\n      OUTPUT 1\r\n      WHERE [Id] = @p5;\r\n      UPDATE [Term] SET [LastDay] = @p6\r\n      OUTPUT 1\r\n      WHERE [Id] = @p7;\r\n```\r\n\r\nWhich throws:\r\n\r\n```\r\nUnhandled exception. Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.\r\n ---> System.InvalidCastException: Failed to convert parameter value from a TimeOnly to a String.\r\n ---> System.InvalidCastException: Object must implement IConvertible.\r\n   at System.Convert.ChangeType(Object value, Type conversionType, IFormatProvider provider)\r\n   at Microsoft.Data.SqlClient.SqlParameter.CoerceValue(Object value, MetaType destinationType, Boolean& coercedToDataFeed, Boolean& typeChanged, Boolean allowStreaming)\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)\r\n   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)\r\n   at NewInEfCore8.DateOnlyTimeOnlySample.DateOnlyTimeOnlyTest[TContext]() in C:\\github\\EntityFramework.Docs\\samples\\core\\Miscellaneous\\NewInEFCore8\\DateOnlyTimeOnlySample.cs:line 101\r\n   at NewInEfCore8.DateOnlyTimeOnlySample.DateOnlyTimeOnlyTest[TContext]() in C:\\github\\EntityFramework.Docs\\samples\\core\\Miscellaneous\\NewInEFCore8\\DateOnlyTimeOnlySample.cs:line 124\r\n   at Program.Main() in C:\\github\\EntityFramework.Docs\\samples\\core\\Miscellaneous\\NewInEFCore8\\Program.cs:line 15\r\n   at Program.<Main>()\r\n```","closed_by":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30885/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/30885/timeline","performed_via_github_app":null,"state_reason":"completed"}