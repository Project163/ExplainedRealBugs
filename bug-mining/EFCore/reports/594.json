{"url":"https://api.github.com/repos/dotnet/efcore/issues/35110","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/35110/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/35110/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/35110/events","html_url":"https://github.com/dotnet/efcore/issues/35110","id":2659769021,"node_id":"I_kwDOAPaMMs6eiNq9","number":35110,"title":"Unexpected PendingModelChangesWarning on initial creation of database via migrations","user":{"login":"peteraritchie","id":408620,"node_id":"MDQ6VXNlcjQwODYyMA==","avatar_url":"https://avatars.githubusercontent.com/u/408620?v=4","gravatar_id":"","url":"https://api.github.com/users/peteraritchie","html_url":"https://github.com/peteraritchie","followers_url":"https://api.github.com/users/peteraritchie/followers","following_url":"https://api.github.com/users/peteraritchie/following{/other_user}","gists_url":"https://api.github.com/users/peteraritchie/gists{/gist_id}","starred_url":"https://api.github.com/users/peteraritchie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peteraritchie/subscriptions","organizations_url":"https://api.github.com/users/peteraritchie/orgs","repos_url":"https://api.github.com/users/peteraritchie/repos","events_url":"https://api.github.com/users/peteraritchie/events{/privacy}","received_events_url":"https://api.github.com/users/peteraritchie/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":514908713,"node_id":"MDU6TGFiZWw1MTQ5MDg3MTM=","url":"https://api.github.com/repos/dotnet/efcore/labels/regression","name":"regression","color":"ff1fff","default":false,"description":null},{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900941630,"node_id":"MDU6TGFiZWwxOTAwOTQxNjMw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-model-building","name":"area-model-building","color":"32b37b","default":false,"description":""},{"id":8130499638,"node_id":"LA_kwDOAPaMMs8AAAAB5J2UNg","url":"https://api.github.com/repos/dotnet/efcore/labels/preview-1","name":"preview-1","color":"ACB3D7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/208","html_url":"https://github.com/dotnet/efcore/milestone/208","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/208/labels","id":11959183,"node_id":"MI_kwDOAPaMMs4AtnuP","number":208,"title":"9.0.1","description":"","creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":21,"state":"closed","created_at":"2024-11-27T13:18:00Z","updated_at":"2025-02-05T21:51:51Z","due_on":null,"closed_at":"2025-02-05T21:49:40Z"},"comments":37,"created_at":"2024-11-14T18:57:52Z","updated_at":"2025-02-11T22:30:32Z","closed_at":"2024-12-06T01:42:28Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When the entity config doesn't include `OwnsMany` the error does not occur.  his can be toggled with `INCLUDE_ACCOUNT_HOLDERS`: remove `INCLUDE_ACCOUNT_HOLDERS` as a compile-time constant from Domain and Infrastructure and the error does not occur.\n\nI could not reproduce when everything was in a single project.\n\n## Steps to reproduce:\n0. `git clone -b main --depth 1 https://github.com/peteraritchie/EfPendingModelChangesWarning.git`\n0. `cd EfPendingModelChangesWarning/src`\n0. `dotnet ef migrations add InitialCreate --startup-project Api --project Infrastructure`\n0. `dotnet ef database update --startup-project Api --project Infrastructure`\n\n### Include your code\n\nSee steps and [https://github.com/peteraritchie/EfPendingModelChangesWarning](https://github.com/peteraritchie/EfPendingModelChangesWarning)\n\n### Include stack traces\n\nOutput from `dotnet ef database update`:\n\n```\nSystem.InvalidOperationException: An error was generated for warning 'Microsoft.EntityFrameworkCore.Migrations.PendingModelChangesWarning': The model for context 'AccountSqliteDbContext' has pending changes. Add a new migration before updating the database. This exception can be suppressed or logged by passing event ID 'RelationalEventId.PendingModelChangesWarning' to the 'ConfigureWarnings' method in 'DbContext.OnConfiguring' or 'AddDbContext'.\n   at Microsoft.EntityFrameworkCore.Diagnostics.EventDefinition`1.Log[TLoggerCategory](IDiagnosticsLogger`1 logger, TParam arg)\n   at Microsoft.EntityFrameworkCore.Diagnostics.RelationalLoggerExtensions.PendingModelChangesWarning(IDiagnosticsLogger`1 diagnostics, Type contextType)\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.UpdateDatabase(String targetMigration, String connectionString, String contextType)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabaseImpl(String targetMigration, String connectionString, String contextType)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabase.<>c__DisplayClass0_0.<.ctor>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\nAn error was generated for warning 'Microsoft.EntityFrameworkCore.Migrations.PendingModelChangesWarning': The model for context 'AccountSqliteDbContext' has pending changes. Add a new migration before updating the database. This exception can be suppressed or logged by passing event ID 'RelationalEventId.PendingModelChangesWarning' to the 'ConfigureWarnings' method in 'DbContext.OnConfiguring' or 'AddDbContext'.\n```\n\n### Include verbose output\n\nVerbose output from `dotnet ef --verbose migrations add InitialCreate --startup-project Api --project Infrastructure`\n```\nUsing project 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\Pri.DDDReference.Infrastructure.csproj'.\nUsing startup project 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\Pri.DDDReference.Api.csproj'.\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\peter\\AppData\\Local\\Temp\\tmpbpsjyc.tmp /verbosity:quiet /nologo C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\Pri.DDDReference.Infrastructure.csproj\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\peter\\AppData\\Local\\Temp\\tmpsuql5r.tmp /verbosity:quiet /nologo C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\Pri.DDDReference.Api.csproj\nBuild started...\ndotnet build C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\Pri.DDDReference.Api.csproj /verbosity:quiet /nologo /p:PublishAot=false\nC:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Domain\\PostalAddress.cs(5,16): warning CS8618: Non-nullable property 'Street' must contain a non-null value when exiting constructor. Consider adding the 'required' modifier or declaring the property as nullable. [C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Domain\\Pri.DDDReference.Domain.csproj]\n\nBuild succeeded.\n\nC:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Domain\\PostalAddress.cs(5,16): warning CS8618: Non-nullable property 'Street' must contain a non-null value when exiting constructor. Consider adding the 'required' modifier or declaring the property as nullable. [C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Domain\\Pri.DDDReference.Domain.csproj]\n    1 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:06.83\n\nBuild succeeded.\ndotnet exec --depsfile C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0\\Pri.DDDReference.Api.deps.json --additionalprobingpath C:\\Users\\peter\\.nuget\\packages --additionalprobingpath \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\NuGetPackages\" --additionalprobingpath \"C:\\Program Files\\dotnet\\sdk\\NuGetFallbackFolder\" --runtimeconfig C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0\\Pri.DDDReference.Api.runtimeconfig.json C:\\Users\\peter\\.dotnet\\tools\\.store\\dotnet-ef\\9.0.0\\dotnet-ef\\9.0.0\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll migrations add InitialCreate --assembly C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0\\Pri.DDDReference.Infrastructure.dll --project C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\Pri.DDDReference.Infrastructure.csproj --startup-assembly C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0\\Pri.DDDReference.Api.dll --startup-project C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\Pri.DDDReference.Api.csproj --project-dir C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\ --root-namespace Pri.DDDReference.Infrastructure --language C# --framework net8.0 --nullable --working-dir C:\\Users\\peter\\src\\experiment\\DDDReference\\src --verbose\nUsing assembly 'Pri.DDDReference.Infrastructure'.\nUsing startup assembly 'Pri.DDDReference.Api'.\nUsing application base 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0'.\nUsing working directory 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api'.\nUsing root namespace 'Pri.DDDReference.Infrastructure'.\nUsing project directory 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\'.\nRemaining arguments: .\nFinding DbContext classes...\nFinding IDesignTimeDbContextFactory implementations...\nFinding DbContext classes in the project...\nFound DbContext 'AccountSqliteDbContext'.\nFinding application service provider in assembly 'Pri.DDDReference.Api'...\nFinding Microsoft.Extensions.Hosting service provider...\nUsing environment 'Development'.\nUsing application service provider from Microsoft.Extensions.Hosting.\nUsing context 'AccountSqliteDbContext'.\nFinding design-time services referenced by assembly 'Pri.DDDReference.Api'...\nFinding design-time services referenced by assembly 'Pri.DDDReference.Infrastructure'...\nNo referenced design-time services were found.\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.Sqlite'...\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.Sqlite'.\nFinding IDesignTimeServices implementations in assembly 'Pri.DDDReference.Api'...\nNo design-time services were found.\nWriting migration to 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\Migrations\\20241114183900_InitialCreate.cs'.\nWriting model snapshot to 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\Migrations\\AccountSqliteDbContextModelSnapshot.cs'.\nDone. To undo this action, use 'ef migrations remove'\n```\n\nverbose output from `dotnet ef --verbose database update --startup-project Api --project Infrastructure`\n```\nUsing project 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\Pri.DDDReference.Infrastructure.csproj'.\nUsing startup project 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\Pri.DDDReference.Api.csproj'.\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\peter\\AppData\\Local\\Temp\\tmpshmzoi.tmp /verbosity:quiet /nologo C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\Pri.DDDReference.Infrastructure.csproj\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\peter\\AppData\\Local\\Temp\\tmprm3hs3.tmp /verbosity:quiet /nologo C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\Pri.DDDReference.Api.csproj\nBuild started...\ndotnet build C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\Pri.DDDReference.Api.csproj /verbosity:quiet /nologo /p:PublishAot=false\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:03.15\n\nBuild succeeded.\ndotnet exec --depsfile C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0\\Pri.DDDReference.Api.deps.json --additionalprobingpath C:\\Users\\peter\\.nuget\\packages --additionalprobingpath \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\NuGetPackages\" --additionalprobingpath \"C:\\Program Files\\dotnet\\sdk\\NuGetFallbackFolder\" --runtimeconfig C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0\\Pri.DDDReference.Api.runtimeconfig.json C:\\Users\\peter\\.dotnet\\tools\\.store\\dotnet-ef\\9.0.0\\dotnet-ef\\9.0.0\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll database update --assembly C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0\\Pri.DDDReference.Infrastructure.dll --project C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\Pri.DDDReference.Infrastructure.csproj --startup-assembly C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0\\Pri.DDDReference.Api.dll --startup-project C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\Pri.DDDReference.Api.csproj --project-dir C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\ --root-namespace Pri.DDDReference.Infrastructure --language C# --framework net8.0 --nullable --working-dir C:\\Users\\peter\\src\\experiment\\DDDReference\\src --verbose\nUsing assembly 'Pri.DDDReference.Infrastructure'.\nUsing startup assembly 'Pri.DDDReference.Api'.\nUsing application base 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api\\bin\\Debug\\net8.0'.\nUsing working directory 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Api'.\nUsing root namespace 'Pri.DDDReference.Infrastructure'.\nUsing project directory 'C:\\Users\\peter\\src\\experiment\\DDDReference\\src\\Infrastructure\\'.\nRemaining arguments: .\nFinding DbContext classes...\nFinding IDesignTimeDbContextFactory implementations...\nFinding DbContext classes in the project...\nFound DbContext 'AccountSqliteDbContext'.\nFinding application service provider in assembly 'Pri.DDDReference.Api'...\nFinding Microsoft.Extensions.Hosting service provider...\nUsing environment 'Development'.\nUsing application service provider from Microsoft.Extensions.Hosting.\nUsing context 'AccountSqliteDbContext'.\nFinding design-time services referenced by assembly 'Pri.DDDReference.Api'...\nFinding design-time services referenced by assembly 'Pri.DDDReference.Infrastructure'...\nNo referenced design-time services were found.\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.Sqlite'...\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.Sqlite'.\nFinding IDesignTimeServices implementations in assembly 'Pri.DDDReference.Api'...\nNo design-time services were found.\nSystem.InvalidOperationException: An error was generated for warning 'Microsoft.EntityFrameworkCore.Migrations.PendingModelChangesWarning': The model for context 'AccountSqliteDbContext' has pending changes. Add a new migration before updating the database. This exception can be suppressed or logged by passing event ID 'RelationalEventId.PendingModelChangesWarning' to the 'ConfigureWarnings' method in 'DbContext.OnConfiguring' or 'AddDbContext'.\n   at Microsoft.EntityFrameworkCore.Diagnostics.EventDefinition`1.Log[TLoggerCategory](IDiagnosticsLogger`1 logger, TParam arg)\n   at Microsoft.EntityFrameworkCore.Diagnostics.RelationalLoggerExtensions.PendingModelChangesWarning(IDiagnosticsLogger`1 diagnostics, Type contextType)\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.UpdateDatabase(String targetMigration, String connectionString, String contextType)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabaseImpl(String targetMigration, String connectionString, String contextType)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabase.<>c__DisplayClass0_0.<.ctor>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\nAn error was generated for warning 'Microsoft.EntityFrameworkCore.Migrations.PendingModelChangesWarning': The model for context 'AccountSqliteDbContext' has pending changes. Add a new migration before updating the database. This exception can be suppressed or logged by passing event ID 'RelationalEventId.PendingModelChangesWarning' to the 'ConfigureWarnings' method in 'DbContext.OnConfiguring' or 'AddDbContext'.\n```\n### Include provider and version information\n\nEF Core version: 9.0.0 (first reproduced with 8.0.10\nDatabase provider: Microsoft.EntityFrameworkCore.Sqlite 9.0.0\nTarget framework: NET 8.0\nOperating system: Windows\nIDE: Visual Studio 2022 17.12.0\n","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/35110/reactions","total_count":8,"+1":8,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/35110/timeline","performed_via_github_app":null,"state_reason":"completed"}