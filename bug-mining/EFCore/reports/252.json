{"url":"https://api.github.com/repos/dotnet/efcore/issues/27826","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/27826/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/27826/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/27826/events","html_url":"https://github.com/dotnet/efcore/issues/27826","id":1205743209,"node_id":"I_kwDOAPaMMs5H3i5p","number":27826,"title":"Delay first retry in Transient Error Handling with Azure SQL","user":{"login":"martyt","id":3867474,"node_id":"MDQ6VXNlcjM4Njc0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3867474?v=4","gravatar_id":"","url":"https://api.github.com/users/martyt","html_url":"https://github.com/martyt","followers_url":"https://api.github.com/users/martyt/followers","following_url":"https://api.github.com/users/martyt/following{/other_user}","gists_url":"https://api.github.com/users/martyt/gists{/gist_id}","starred_url":"https://api.github.com/users/martyt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martyt/subscriptions","organizations_url":"https://api.github.com/users/martyt/orgs","repos_url":"https://api.github.com/users/martyt/repos","events_url":"https://api.github.com/users/martyt/events{/privacy}","received_events_url":"https://api.github.com/users/martyt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":2272800544,"node_id":"MDU6TGFiZWwyMjcyODAwNTQ0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-sqlserver","name":"area-sqlserver","color":"32b37b","default":false,"description":""},{"id":3281025791,"node_id":"MDU6TGFiZWwzMjgxMDI1Nzkx","url":"https://api.github.com/repos/dotnet/efcore/labels/priority-bug","name":"priority-bug","color":"1E3932","default":false,"description":"Issues which requires API breaks and have bigger impact hence should be fixed earlier in the release"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/152","html_url":"https://github.com/dotnet/efcore/milestone/152","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/152/labels","id":8392036,"node_id":"MI_kwDOAPaMMs4AgA1k","number":152,"title":"8.0.0","description":"EF Core 8.0","creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":280,"state":"closed","created_at":"2022-09-07T19:55:36Z","updated_at":"2025-04-07T08:59:46Z","due_on":null,"closed_at":"2023-11-14T14:00:33Z"},"comments":15,"created_at":"2022-04-15T17:27:19Z","updated_at":"2025-06-15T18:46:42Z","closed_at":"2023-09-05T18:10:54Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The [published advice on transient error handling for Azure SQL](https://docs.microsoft.com/en-us/azure/azure-sql/database/troubleshoot-common-connectivity-issues) recommends\r\n* Delaying \"several\" seconds before the first retry\r\n* Closing and opening the connection prior to eeach retry\r\n\r\nI've poked around in `SqlServerRetryingExecutionStrategy` and related classes, and can't find any evidence that either of those two recommendations are followed in EF Core - nor have I been able to figure out how I might implement those recommendations in a custom execution strategy. \r\n\r\nAdditionally, I've found that an `Execution Timeout Expired.` exception (Error number -2) is explicitly *not* considered transient -- yet it is the single most frequently occurring exception we encounter in our non-EF database code. The retry strategy we've implemented for that non-EF code closes and re-opens the connection before retrying the query and has completely eliminated failures due to timeout exceptions. I've had to add error number -2 to the `errorNumbersToAdd` list for EF Core, but, because the connection isn't closed and re-opened, I have zero expectation that retries for those errors will be successful.\r\n\r\nIs there a plan to support the recommended transient error handling when targeting Azure SQL? \r\nIs there a way I can implement a custom execution strategy that will close and re-open the database connection?\r\n","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/27826/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/27826/timeline","performed_via_github_app":null,"state_reason":"completed"}