[{"id":14388321767,"node_id":"LE_lADOAPaMMs6XxiztzwAAAANZnF3n","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14388321767","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-09-24T20:33:10Z","label":{"name":"customer-reported","color":"a4a5f9"},"performed_via_github_app":null},{"actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-24T22:56:42Z","updated_at":"2024-09-24T22:56:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34750","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34750/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34750/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34750/events","html_url":"https://github.com/dotnet/efcore/issues/34750","id":2546557312,"node_id":"I_kwDOAPaMMs6XyWGA","number":34750,"title":"Using ToString() on a value object causes unnecesssary case expression in query","user":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2024-09-24T22:56:41Z","updated_at":"2025-06-16T08:46:22Z","closed_at":"2024-09-25T15:34:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I posted issue [34749](https://github.com/dotnet/efcore/issues/34749) concerning a created query. In this context I experienced another issue.\r\n\r\nIn the projection I access properties that are custom types using value objects:\r\n```\r\ndanceCoverImage.Language == null ? null : danceCoverImage.Language.Tag,\r\ndanceCoverImage.ScreenSize == null ? null : danceCoverImage.ScreenSize.Value,\r\n```\r\nThis produces a query with the correct fields. \r\n\r\nBy accident I used ToString() in one projection.\r\n```\r\ndanceCoverImage.Language == null ? null : danceCoverImage.Language.ToString(),\r\ndanceCoverImage.ScreenSize == null ? null : danceCoverImage.ScreenSize.ToString(),\r\n```\r\nAs a result additional `CASE` statements are added to all those fields in the `SELECT` statements, i.e.:\r\n```\r\nCASE\r\n    WHEN [l0].[Language] IS NULL THEN CAST(1 AS bit)\r\n    ELSE CAST(0 AS bit)\r\nEND AS [c],\r\n[l0].[Language],\r\n```\r\nI don't understand why this extra flag is created in the query.\r\n\r\nWhen I use the property of the value object, the problem doesn't occur, so it is currently no issue for me, but I wanted to report this strange behavior. \r\n\r\n---\r\nEF Core version: 8.0.8\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework: NET 8.0\r\nOperating system: Win 11\r\nVisual Studio 2022 17.11.4","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34750/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34750/timeline","performed_via_github_app":null,"state_reason":"duplicate"}},"event":"cross-referenced"},{"actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-24T23:20:13Z","updated_at":"2024-09-24T23:20:13Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34751","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34751/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34751/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34751/events","html_url":"https://github.com/dotnet/efcore/issues/34751","id":2546580881,"node_id":"I_kwDOAPaMMs6Xyb2R","number":34751,"title":"How to extract projection logic into separate methods","user":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1675384372,"node_id":"MDU6TGFiZWwxNjc1Mzg0Mzcy","url":"https://api.github.com/repos/dotnet/efcore/labels/area-query","name":"area-query","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":10,"created_at":"2024-09-24T23:20:12Z","updated_at":"2025-01-22T13:22:09Z","closed_at":"2024-10-19T02:10:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I posted issue [34749](https://github.com/dotnet/efcore/issues/34749) concerning the same projection. My question here is: how can I extract projection logic into separate methods to make the code cleaner? \r\n\r\nThe projection:\r\n\r\n```\r\nList<LocationMLResponse> Locations;\r\n\r\nvar query = dbContext.Location.AsNoTracking()\r\n           .Select(location => new LocationMLResponse(\r\n            location.Id.Value,\r\n            location.Name.ToStringDictionary(),\r\n            location.CoverImages\r\n                .Join(dbContext.Image.AsNoTracking(),\r\n                danceCoverImage => danceCoverImage.ImageId,\r\n                image => image.Id,\r\n                (danceCoverImage, image) => new ImageItemResponse(\r\n                    danceCoverImage.ImageId.Value,\r\n                    danceCoverImage.DisplayOrder,\r\n                    danceCoverImage.Language == null ? null : danceCoverImage.Language.Tag,\r\n                    danceCoverImage.ScreenSize == null ? null : danceCoverImage.ScreenSize.Value,\r\n                    danceCoverImage.FocusPointX,\r\n                    danceCoverImage.FocusPointY,\r\n                    image.Uri.ToString(),\r\n                    image.MetaData.Width,\r\n                    image.MetaData.Height\r\n                )).ToList(),\r\n            location.Address.MapToDto(),\r\n            location.Created,\r\n            location.LastModified,\r\n            location.Version\r\n            ));\r\n\r\nLocations = await query.ToListAsync();\r\n```\r\nI tried to make the code more readable and extracted methods for the mapping:\r\n\r\n```\r\nvar query = dbContext.Location.AsNoTracking()\r\n           .Select(location => MapToLocationResponse.MLResponse(dbContext, location));\r\n\r\ninternal static class MapToLocationResponse\r\n{\r\n    public static LocationMLResponse MLResponse(VCDbContext dbContext, Location location)\r\n    {\r\n        return new LocationMLResponse(\r\n            location.Id.Value,\r\n            location.Name.ToStringDictionary(),\r\n            location.CoverImages\r\n                .Join(dbContext.Image.AsNoTracking(),\r\n                danceCoverImage => danceCoverImage.ImageId,\r\n                image => image.Id,\r\n                (danceCoverImage, image) => Mappings.MapToImageItemResponse(danceCoverImage, image)).ToList(),\r\n            location.Address.MapToDto(),\r\n            location.Created,\r\n            location.LastModified,\r\n            location.Version\r\n            );\r\n    }\r\n}\r\n\r\ninternal static partial class Mappings\r\n{\r\n    public static ImageItemResponse MapToImageItemResponse(ImageItem imageItem, Image image)\r\n    {\r\n        return new ImageItemResponse(\r\n            imageItem.ImageId.Value,\r\n            imageItem.DisplayOrder,\r\n            imageItem.Language == null ? null : imageItem.Language.ToString(),\r\n            imageItem.ScreenSize == null ? null : imageItem.ScreenSize.ToString(),\r\n            imageItem.FocusPointX,\r\n            imageItem.FocusPointY,\r\n            image.Uri.ToString(),\r\n            image.MetaData.Width,\r\n            image.MetaData.Height\r\n        );\r\n    }\r\n}\r\n```\r\n\r\nThis code creates the query:\r\n```\r\n     SELECT [l].[LocationId], [l].[Created], [l].[CreatedBy], [l].[CreatedInNameOf], [l].[LastModified], [l].[LastModifiedBy], [l].[LastModifiedInNameOf], [l].[Name], [l].[TId], [l].[Version], [l].[Address_City], [l].[Address_CountryId], [l].[Address_CountryName], [l].[Address_DeliveryInstruction], [l].[Address_State], [l].[Address_Street], [l].[Address_StreetAffix], [l].[Address_StreetNumber], [l].[Address_ZipCode], [l0].[TId], [l0].[DisplayOrder], [l0].[FocusPointX], [l0].[FocusPointY], [l0].[ImageId], [l0].[Language], [l0].[LocationId], [l0].[ScreenSize]\r\n     FROM [VC].[Location] AS [l]\r\n     LEFT JOIN [VC].[LocationCoverImage] AS [l0] ON [l].[LocationId] = [l0].[LocationId]\r\n     ORDER BY [l].[LocationId]\r\n```\r\nThe join to the Image table and the selection of the fields is missing.\r\n\r\nI tried nesting only one mapping:\r\n```\r\n List<LocationMLResponse> Locations;\r\n\r\n var query = dbContext.Location.AsNoTracking()//.AsSplitQuery()\r\n            .Select(location => new LocationMLResponse(\r\n             location.Id.Value,\r\n             location.Name.ToStringDictionary(),\r\n             location.CoverImages\r\n                 .Join(dbContext.Image.AsNoTracking(),\r\n                 danceCoverImage => danceCoverImage.ImageId,\r\n                 image => image.Id,\r\n                 (danceCoverImage, image) => Mappings.MapToImageItemResponse(danceCoverImage, image)).ToList(),\r\n             location.Address.MapToDto(),\r\n             location.Created,\r\n             location.LastModified,\r\n             location.Version\r\n             ));\r\n\r\n Locations = await query.ToListAsync();\r\n```\r\nThis  projection creates the same query as if with the full projection on top.\r\n\r\nHow can I split the logic so that EF Core still produces the correct query? I have many entities that have a property of type `List<ImageItem>`. Therefore, I don't want to repeat the code for every entity.\r\n\r\n---\r\nEF Core version: 8.0.8\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework: NET 8.0\r\nOperating system: Win 11\r\nVisual Studio 2022 17.11.4","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34751/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34751/timeline","performed_via_github_app":null,"state_reason":"not_planned"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2374245445","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2374245445","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2374245445,"node_id":"IC_kwDOAPaMMs6NhBxF","user":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-25T14:25:07Z","updated_at":"2024-09-25T16:10:28Z","body":"For issue #34750 I installed v9.0 rc1 to test. I also tested this issue. The problem still exists with rc1.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2374245445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2375513992","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2375513992","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2375513992,"node_id":"IC_kwDOAPaMMs6Nl3eI","user":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-26T00:45:14Z","updated_at":"2024-09-26T00:45:14Z","body":"@KillerBoogie we need a full repro to effectively investigate this problem. It's not immediately obvious what's going on here. I tried to reverse-engineer the repro based on code you provided, but I was unsuccessful.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2375513992/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14407569059,"node_id":"MEE_lADOAPaMMs6XxiztzwAAAANawg6j","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14407569059","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-09-26T00:45:16Z","performed_via_github_app":null},{"id":14407569065,"node_id":"SE_lADOAPaMMs6XxiztzwAAAANawg6p","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14407569065","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-09-26T00:45:16Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2377127900","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2377127900","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2377127900,"node_id":"IC_kwDOAPaMMs6NsBfc","user":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-26T14:24:11Z","updated_at":"2024-09-26T14:24:11Z","body":"@maumar : I stripped down the project. You can access it at https://github.com/KillerBoogie/ef-core-join-query-bug/tree/main ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2377127900/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14417568077,"node_id":"MEE_lADOAPaMMs6XxiztzwAAAANbWqFN","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14417568077","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-09-26T14:24:12Z","performed_via_github_app":null},{"id":14417568099,"node_id":"SE_lADOAPaMMs6XxiztzwAAAANbWqFj","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14417568099","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-09-26T14:24:13Z","performed_via_github_app":null},{"id":14427505372,"node_id":"AE_lADOAPaMMs6XxiztzwAAAANb8kLc","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14427505372","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2024-09-27T08:31:57Z","assignee":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2383461253","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2383461253","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2383461253,"node_id":"IC_kwDOAPaMMs6OELuF","user":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-30T15:02:06Z","updated_at":"2024-09-30T15:02:06Z","body":"@maumar: Have you been able to check the project?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2383461253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14457982719,"node_id":"MEE_lADOAPaMMs6XxiztzwAAAANdw07_","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14457982719","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-09-30T15:02:08Z","performed_via_github_app":null},{"id":14457982739,"node_id":"SE_lADOAPaMMs6XxiztzwAAAANdw08T","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14457982739","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-09-30T15:02:08Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2386265029","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2386265029","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2386265029,"node_id":"IC_kwDOAPaMMs6OO4PF","user":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-01T15:06:53Z","updated_at":"2024-10-01T15:52:44Z","body":"Since I couldn't continue with my project, I was searching for clues. I found a hint that due to `ownsMany` EF Core might eager load the collection in addition to the projection and that `.IgnoreAutoIncludes()` might help.\r\n\r\nI tried it without `AsSplitQuery()`, but the generated query was still false. I then tried it together as `IgnoreAutoIncludes().AsSplitQuery()`. It seemed to work, but either I overlooked the third query or hot reload affected the debug output. After restarting the project I still see 3 queries, but `IgnoreAutoIncludes()` strangely pulls unnecessary fields from the image table in a sub query.\r\n\r\nOn a positive side I found the cause for the null exception. It was due to the empty constructor I added for the `ImageItem`record. This object is a DTO and not an EF Core entity or value object. I was blind for it due to the faulty EF Core SQL. I updated the GitHub project accordingly. \r\n\r\n\r\n\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2386265029/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14479487215,"node_id":"RTE_lADOAPaMMs6XxiztzwAAAANfC3Dv","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14479487215","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2024-10-01T20:57:58Z","rename":{"from":"Created query for projection with ownedMany and join is wrong and leads to null exception","to":"Created query for projection with ownedMany and join is wrong"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2387832795","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2387832795","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2387832795,"node_id":"IC_kwDOAPaMMs6OU2_b","user":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-02T07:46:36Z","updated_at":"2024-10-02T07:46:36Z","body":"@KillerBoogie thanks for the repo, I'm able to access. I'm currently in the process of analyzing and simplifying the code. Unfortunately I can't clone a random repo from the internet and run it on my machine - I need to build things from scratch and that takes some time, as the project is quite complicated. I will post update once I have a (hopefully) failing minimal repro","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2387832795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14484019921,"node_id":"MEE_lADOAPaMMs6XxiztzwAAAANfUJrR","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14484019921","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-02T07:46:37Z","performed_via_github_app":null},{"id":14484019929,"node_id":"SE_lADOAPaMMs6XxiztzwAAAANfUJrZ","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14484019929","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-02T07:46:37Z","performed_via_github_app":null},{"id":14511765690,"node_id":"LE_lADOAPaMMs6XxiztzwAAAANg9_i6","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14511765690","actor":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-10-04T00:56:30Z","label":{"name":"area-query","color":"32b37b"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2392755074","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2392755074","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2392755074,"node_id":"IC_kwDOAPaMMs6OnouC","user":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-04T04:14:18Z","updated_at":"2024-10-04T04:14:18Z","body":"@KillerBoogie I'm able to reproduce this. Extra join is coming from `location.Address.MapToDto(),`\r\n\r\nLocation contains owned collection `CoverImages` (mapped to table `LocationCoverImage`, and it also contains complex property Address, which is being projected. Nav expansion is injecting include call for CoverImages (since it's eagerly loaded), even though the entity itself is not going to be projected (complex property alone is). \r\n\r\nMinimal repro:\r\n\r\n```cs\r\n    [ConditionalFact]\r\n    public async Task ComplexTypeOwnedType()\r\n    {\r\n        using var ctx = new MyContext();\r\n        await ctx.Database.EnsureDeletedAsync();\r\n        await ctx.Database.EnsureCreatedAsync();\r\n\r\n        var query = ctx.Entities.Select(x => x.Complex).ToList();\r\n    }\r\n\r\n    public class MyEntity\r\n    {\r\n        public int Id { get; set; }\r\n\r\n        public List<MyOwned> OwnedCollection { get; set; }\r\n        public MyComplex Complex { get; set; }\r\n    }\r\n\r\n    public class MyOwned\r\n    {\r\n        public string Name { get; set; }\r\n    }\r\n\r\n    public class MyComplex\r\n    {\r\n        public int Foo { get; set; }\r\n        public decimal Bar { get; set; }\r\n    }\r\n\r\n\r\n    public class MyContext : DbContext\r\n    {\r\n        public DbSet<MyEntity> Entities { get; set; }\r\n\r\n        protected override void OnModelCreating(ModelBuilder modelBuilder)\r\n        {\r\n            modelBuilder.Entity<MyEntity>(b =>\r\n            {\r\n                b.OwnsMany(x => x.OwnedCollection);\r\n                b.ComplexProperty(x => x.Complex).IsRequired();\r\n            });\r\n        }\r\n\r\n        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\r\n        {\r\n            optionsBuilder\r\n                    .UseSqlServer(@\"Server=(localdb)\\mssqllocaldb;Database=Repro;Trusted_Connection=True;MultipleActiveResultSets=true\")\r\n                    .LogTo(Console.WriteLine, LogLevel.Information)\r\n                    .EnableSensitiveDataLogging();\r\n        }\r\n    }\r\n\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2392755074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14512887755,"node_id":"MEE_lADOAPaMMs6XxiztzwAAAANhCRfL","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14512887755","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-04T04:14:19Z","performed_via_github_app":null},{"id":14512887759,"node_id":"SE_lADOAPaMMs6XxiztzwAAAANhCRfP","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14512887759","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-04T04:14:19Z","performed_via_github_app":null},{"id":14512888521,"node_id":"LE_lADOAPaMMs6XxiztzwAAAANhCRrJ","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14512888521","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-10-04T04:14:28Z","label":{"name":"type-bug","color":"f7c6c7"},"performed_via_github_app":null},{"id":14512889068,"node_id":"LE_lADOAPaMMs6XxiztzwAAAANhCRzs","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14512889068","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-10-04T04:14:34Z","label":{"name":"area-complex-types","color":"32b37b"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2392758239","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2392758239","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2392758239,"node_id":"IC_kwDOAPaMMs6Onpff","user":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-04T04:18:31Z","updated_at":"2024-10-04T04:18:31Z","body":"problem is in IncludeExpandingExpressionVisitor.VisitMember \r\n\r\nhttps://github.com/dotnet/efcore/blob/67254af14db19dbf17f04b0b3cae3881d09ccee0/src/EFCore/Query/Internal/NavigationExpandingExpressionVisitor.ExpressionVisitors.cs#L561\r\n\r\nwe block generation of includes if member is a primitive property but don't do the same for complex. \r\n\r\nWe could do:\r\n\r\n```cs\r\n                var complex = entityType?.FindComplexProperty(memberExpression.Member);\r\n                if (complex != null)\r\n                {\r\n                    return memberExpression;\r\n                }\r\n```\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2392758239/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14513314657,"node_id":"MIE_lADOAPaMMs6XxiztzwAAAANhD5th","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14513314657","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2024-10-04T05:03:52Z","milestone":{"title":"10.0.0"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2393961232","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2393961232","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2393961232,"node_id":"IC_kwDOAPaMMs6OsPMQ","user":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-04T15:27:59Z","updated_at":"2024-10-04T15:27:59Z","body":"Maurycy, thank you for your reply. Do I understand correctly, that this won't be fixed until version 10? If yes, does it mean the only options I have is to use OwnsOne instead of ComplexProperty or to use RawSQL with `For Json` on SQL Server?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2393961232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2394490842","html_url":"https://github.com/dotnet/efcore/issues/34749#issuecomment-2394490842","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/34749","id":2394490842,"node_id":"IC_kwDOAPaMMs6OuQfa","user":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-04T20:05:35Z","updated_at":"2024-10-04T20:05:35Z","body":"@KillerBoogie that's correct - we are closing down on EF 9 release, only fixing most critical issues at this point. This bug is not critical - it has perf implications as it brings more from the database than it should, but the data that is eventually presented to the user is correct (so no data corruption)\r\n\r\nUsing owned entities rather than complex types is a good solution if the extra join is a significant problem in your case. Unfortunately, `IgnoreAutoIncludes` doesn't work on owned types, that would have been a great solution.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2394490842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14524468771,"node_id":"MEE_lADOAPaMMs6XxiztzwAAAANhuc4j","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14524468771","actor":{"login":"KillerBoogie","id":42609546,"node_id":"MDQ6VXNlcjQyNjA5NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/42609546?v=4","gravatar_id":"","url":"https://api.github.com/users/KillerBoogie","html_url":"https://github.com/KillerBoogie","followers_url":"https://api.github.com/users/KillerBoogie/followers","following_url":"https://api.github.com/users/KillerBoogie/following{/other_user}","gists_url":"https://api.github.com/users/KillerBoogie/gists{/gist_id}","starred_url":"https://api.github.com/users/KillerBoogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KillerBoogie/subscriptions","organizations_url":"https://api.github.com/users/KillerBoogie/orgs","repos_url":"https://api.github.com/users/KillerBoogie/repos","events_url":"https://api.github.com/users/KillerBoogie/events{/privacy}","received_events_url":"https://api.github.com/users/KillerBoogie/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-04T20:05:36Z","performed_via_github_app":null}]