{"url":"https://api.github.com/repos/dotnet/efcore/issues/31314","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/31314/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/31314/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/31314/events","html_url":"https://github.com/dotnet/efcore/issues/31314","id":1812738749,"node_id":"I_kwDOAPaMMs5sDDK9","number":31314,"title":"TPH with Generic Entity referencing another TPH table causes endless migrations","user":{"login":"Scriptodude","id":14830277,"node_id":"MDQ6VXNlcjE0ODMwMjc3","avatar_url":"https://avatars.githubusercontent.com/u/14830277?v=4","gravatar_id":"","url":"https://api.github.com/users/Scriptodude","html_url":"https://github.com/Scriptodude","followers_url":"https://api.github.com/users/Scriptodude/followers","following_url":"https://api.github.com/users/Scriptodude/following{/other_user}","gists_url":"https://api.github.com/users/Scriptodude/gists{/gist_id}","starred_url":"https://api.github.com/users/Scriptodude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Scriptodude/subscriptions","organizations_url":"https://api.github.com/users/Scriptodude/orgs","repos_url":"https://api.github.com/users/Scriptodude/repos","events_url":"https://api.github.com/users/Scriptodude/events{/privacy}","received_events_url":"https://api.github.com/users/Scriptodude/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900942474,"node_id":"MDU6TGFiZWwxOTAwOTQyNDc0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-migrations","name":"area-migrations","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/152","html_url":"https://github.com/dotnet/efcore/milestone/152","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/152/labels","id":8392036,"node_id":"MI_kwDOAPaMMs4AgA1k","number":152,"title":"8.0.0","description":"EF Core 8.0","creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":280,"state":"closed","created_at":"2022-09-07T19:55:36Z","updated_at":"2025-04-07T08:59:46Z","due_on":null,"closed_at":"2023-11-14T14:00:33Z"},"comments":6,"created_at":"2023-07-19T21:10:37Z","updated_at":"2025-06-15T19:04:58Z","closed_at":"2023-08-10T20:06:34Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## File a bug\r\n\r\nWhen creating a link between a TPH-configured set of entities using generics and another TPH-configured entity, EF core keeps generating endless migrations with exactly the same content that was previously generated.\r\n\r\nIn the provided example, `FooExtension<T>` references on of two `BarBase`: `BarA` or `BarB`.\r\n\r\n`BarBase`, `BarA` and `BarB` are configured using TPH with a shadow-mode discriminator.\r\n\r\n`FooBase`, `FooExtension<BarA>` and `FooExtension<BarB>` are configured using TPH with a shadow-mode discriminator.\r\n\r\nThere are no exceptions per say, excepted that not matter how many times you run `dotnet ef migrations add`, you will always have a migration generating the exact same stuff. In the test code see `Migrations/20230719205038_redo.cs` and `Migrations/20230719205047_redo-2.cs `.\r\n\r\nRunning migration add will generate the exact same migration a third time.\r\n\r\n### Include your code\r\n\r\nReproductible example [here](https://github.com/Scriptodude/TphToTphEFBug)\r\n\r\n### Include stack traces\r\n\r\nN/A\r\n\r\n### Include verbose output\r\n\r\nPlease include `--verbose` output when filing bugs about the `dotnet ef` or Package Manager Console tools.\r\n\r\nUse triple-tick fences for tool output. For example:\r\n\r\n```\r\ndotnet exec --depsfile /tmp/TphGenericReferencesTph/bin/Debug/net7.0/TphGenericReferencesTph.deps.json --additionalprobingpath /Users/jonathan.lavigne/.nuget/packages --runtimeconfig /tmp/TphGenericReferencesTph/bin/Debug/net7.0/TphGenericReferencesTph.runtimeconfig.json /Users/jonathan.lavigne/.dotnet/tools/.store/dotnet-ef/7.0.9/dotnet-ef/7.0.9/tools/net6.0/any/tools/netcoreapp2.0/any/ef.dll migrations add redo-3 --assembly /tmp/TphGenericReferencesTph/bin/Debug/net7.0/TphGenericReferencesTph.dll --project /tmp/TphGenericReferencesTph/TphGenericReferencesTph.csproj --startup-assembly /tmp/TphGenericReferencesTph/bin/Debug/net7.0/TphGenericReferencesTph.dll --startup-project /tmp/TphGenericReferencesTph/TphGenericReferencesTph.csproj --project-dir /tmp/TphGenericReferencesTph/ --root-namespace TphGenericReferencesTph --language C# --framework net7.0 --nullable --working-dir /tmp/TphGenericReferencesTph --verbose\r\nUsing assembly 'TphGenericReferencesTph'.\r\nUsing startup assembly 'TphGenericReferencesTph'.\r\nUsing application base '/tmp/TphGenericReferencesTph/bin/Debug/net7.0'.\r\nUsing working directory '/tmp/TphGenericReferencesTph'.\r\nUsing root namespace 'TphGenericReferencesTph'.\r\nUsing project directory '/tmp/TphGenericReferencesTph/'.\r\nRemaining arguments: .\r\nFinding DbContext classes...\r\nFinding IDesignTimeDbContextFactory implementations...\r\nFinding application service provider in assembly 'TphGenericReferencesTph'...\r\nFinding Microsoft.Extensions.Hosting service provider...\r\nNo static method 'CreateHostBuilder(string[])' was found on class 'Program'.\r\nNo application service provider was found.\r\nFinding DbContext classes in the project...\r\nFound DbContext 'AppDbContext'.\r\nUsing context 'AppDbContext'.\r\nFinding design-time services referenced by assembly 'TphGenericReferencesTph'...\r\nFinding design-time services referenced by assembly 'TphGenericReferencesTph'...\r\nNo referenced design-time services were found.\r\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\r\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\r\nFinding IDesignTimeServices implementations in assembly 'TphGenericReferencesTph'...\r\nNo design-time services were found.\r\nThe property 'BarA.FooExtensionId' was created in shadow state because there are no eligible CLR members with a matching name.\r\nThe property 'BarB.FooExtensionId' was created in shadow state because there are no eligible CLR members with a matching name.\r\nWriting migration to '/tmp/TphGenericReferencesTph/Migrations/20230719210345_redo-3.cs'.\r\nWriting model snapshot to '/tmp/TphGenericReferencesTph/Migrations/AppDbContextModelSnapshot.cs'.\r\n'AppDbContext' disposed.\r\n```\r\n\r\n### Include provider and version information\r\n\r\nEF Core version: 7.0.9\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer - Also does the same with Npgsql.EntityFrameworkCore.PostgreSQL\r\nTarget framework: NET7.0\r\nOperating system: macOS - Ventura (13.4)\r\nIDE: JetBrains Rider 2023.1.4 and VSCode 1.79.2\r\n","closed_by":{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/31314/reactions","total_count":5,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":2},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/31314/timeline","performed_via_github_app":null,"state_reason":"completed"}