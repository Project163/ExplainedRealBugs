[{"id":18315160630,"node_id":"LE_lADOAPaMMs69RC07zwAAAARDqyw2","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18315160630","actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-06-25T11:53:04Z","label":{"name":"customer-reported","color":"a4a5f9"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3004568779","html_url":"https://github.com/dotnet/efcore/issues/36291#issuecomment-3004568779","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/36291","id":3004568779,"node_id":"IC_kwDOAPaMMs6zFhTL","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-06-25T12:19:36Z","updated_at":"2025-06-25T12:19:36Z","body":"@mycroes thanks for reporting this. What you're reporting seems quite odd, since the the main change here is in the WHERE clause, which doesn't reference `WasteRegistrations` at all; the only reference I'm seeing to that table is in the INNER JOIN, where except for the alias change things looks unchanged:\n\n```sql\n-- BEFORE:\nINNER JOIN [SourcePallet] AS [s3] ON [w].[SourcePalletId] = [s3].[Id]\n\n-- AFTER:\nINNER JOIN [SourcePallet] AS [s4] ON [w].[SourcePalletId] = [s4].[Id]\n```\n\nHowever, given that you've only posted very partial details (we don't even have the full SQL), it's difficult to know exactly what's going on. Would it be possible to try to put together a minimal, runnable repro we can run and see the query plan regression between the two EF versions?\n\nThe change in EF 9.0 to use bitwise NOT was done in #34213, /cc @ranma42.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3004568779/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":18315610306,"node_id":"MEE_lADOAPaMMs69RC07zwAAAARDsgjC","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18315610306","actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-06-25T12:19:37Z","performed_via_github_app":null},{"id":18315610316,"node_id":"SE_lADOAPaMMs69RC07zwAAAARDsgjM","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18315610316","actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-06-25T12:19:37Z","performed_via_github_app":null},{"id":18315610338,"node_id":"MEE_lADOAPaMMs69RC07zwAAAARDsgji","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18315610338","actor":{"login":"ranma42","id":1506030,"node_id":"MDQ6VXNlcjE1MDYwMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1506030?v=4","gravatar_id":"","url":"https://api.github.com/users/ranma42","html_url":"https://github.com/ranma42","followers_url":"https://api.github.com/users/ranma42/followers","following_url":"https://api.github.com/users/ranma42/following{/other_user}","gists_url":"https://api.github.com/users/ranma42/gists{/gist_id}","starred_url":"https://api.github.com/users/ranma42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranma42/subscriptions","organizations_url":"https://api.github.com/users/ranma42/orgs","repos_url":"https://api.github.com/users/ranma42/repos","events_url":"https://api.github.com/users/ranma42/events{/privacy}","received_events_url":"https://api.github.com/users/ranma42/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-06-25T12:19:37Z","performed_via_github_app":null},{"id":18315610360,"node_id":"SE_lADOAPaMMs69RC07zwAAAARDsgj4","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18315610360","actor":{"login":"ranma42","id":1506030,"node_id":"MDQ6VXNlcjE1MDYwMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1506030?v=4","gravatar_id":"","url":"https://api.github.com/users/ranma42","html_url":"https://github.com/ranma42","followers_url":"https://api.github.com/users/ranma42/followers","following_url":"https://api.github.com/users/ranma42/following{/other_user}","gists_url":"https://api.github.com/users/ranma42/gists{/gist_id}","starred_url":"https://api.github.com/users/ranma42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranma42/subscriptions","organizations_url":"https://api.github.com/users/ranma42/orgs","repos_url":"https://api.github.com/users/ranma42/repos","events_url":"https://api.github.com/users/ranma42/events{/privacy}","received_events_url":"https://api.github.com/users/ranma42/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-06-25T12:19:37Z","performed_via_github_app":null},{"id":18315610641,"node_id":"AE_lADOAPaMMs69RC07zwAAAARDsgoR","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18315610641","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2025-06-25T12:19:38Z","assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":18315612579,"node_id":"LE_lADOAPaMMs69RC07zwAAAARDshGj","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18315612579","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-06-25T12:19:45Z","label":{"name":"area-perf","color":"5319e7"},"performed_via_github_app":null},{"id":18315612597,"node_id":"LE_lADOAPaMMs69RC07zwAAAARDshG1","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18315612597","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-06-25T12:19:46Z","label":{"name":"area-query","color":"32b37b"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3004758845","html_url":"https://github.com/dotnet/efcore/issues/36291#issuecomment-3004758845","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/36291","id":3004758845,"node_id":"IC_kwDOAPaMMs6zGPs9","user":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-06-25T13:22:39Z","updated_at":"2025-06-25T13:22:39Z","body":"Hi @roji,\n\nI'm not sure how easy it will be to reproduce this in a smaller example, but for starters I'll include the two full SQL queries and io,time statistics.\n\nI fully agree with your statement about the `WasteRegistrations` reference, to the extent that I'm doubting my observations. Maybe I overlooked another part, but let's figure this out together.\n\n```sql\n-- EF Core 8\nSELECT (\n    SELECT TOP(1) [p4].[ProcessingLineType]\n    FROM [ProcessingLines] AS [p4]\n    LEFT JOIN [ProcessingLineConfigurations] AS [p5] ON [p4].[ActiveConfigurationId] = [p5].[Id]\n    WHERE EXISTS (\n        SELECT 1\n        FROM [ProcessingConfigurationFlows] AS [p6]\n        WHERE [p5].[Id] IS NOT NULL AND [p5].[Id] = [p6].[ConfigurationId] AND [p6].[FlowId] = [p1].[FlowId])), [p3].[ConsumedCount], (\n    SELECT CAST(COALESCE(SUM([s2].[NetWeight]), 0.0E0) AS real)\n    FROM [CurrentSourcePalletWeights] AS [c]\n    INNER JOIN [SourcePallet] AS [s1] ON [c].[SourcePalletId] = [s1].[Id]\n    INNER JOIN [SourcePalletWeightRegistrations] AS [s2] ON [c].[SourcePalletWeightRegistrationId] = [s2].[Id]\n    WHERE CASE\n        WHEN [s].[SupplyOrderId] IS NOT NULL THEN CASE\n            WHEN [s1].[SupplyOrderId] = [s].[SupplyOrderId] AND [s1].[SupplyOrderId] IS NOT NULL THEN CAST(1 AS bit)\n            ELSE CAST(0 AS bit)\n        END\n        ELSE CASE\n            WHEN [s1].[Id] = [p3].[ActivePalletId] AND [p3].[ActivePalletId] IS NOT NULL THEN CAST(1 AS bit)\n            ELSE CAST(0 AS bit)\n        END\n    END = CAST(1 AS bit)), [t0].[NumberOfItems], [t0].[UnloadNumberOfItems], [t0].[c], [t1].[NetWeight], [t1].[NumberOfRegistrations], [t1].[c]\nFROM [ProcessingLines] AS [p]\nLEFT JOIN [ProcessingLineConfigurations] AS [p0] ON [p].[ActiveConfigurationId] = [p0].[Id]\nINNER JOIN [ProcessingConfigurationFlows] AS [p1] ON [p0].[Id] = [p1].[ConfigurationId]\nINNER JOIN [ProductSupplyFlows] AS [p2] ON [p1].[FlowId] = [p2].[Id]\nINNER JOIN [PalletProcessingQueues] AS [p3] ON [p2].[ProcessingQueueId] = [p3].[Id]\nLEFT JOIN [SourcePallet] AS [s] ON [p3].[ActivePalletId] = [s].[Id]\nOUTER APPLY (\n    SELECT TOP(1) COALESCE(SUM([t].[NumberOfItems]), 0) AS [NumberOfItems], COALESCE(SUM(CASE\n        WHEN [t].[SourcePalletStatus] = 5 THEN [t].[NumberOfItems]\n    END), 0) AS [UnloadNumberOfItems], 1 AS [c]\n    FROM (\n        SELECT [s0].[NumberOfItems], [s0].[SourcePalletStatus], 1 AS [Key]\n        FROM [SourcePallet] AS [s0]\n        WHERE CASE\n            WHEN [s].[SupplyOrderId] IS NOT NULL THEN CASE\n                WHEN [s0].[SupplyOrderId] = [s].[SupplyOrderId] AND [s0].[SupplyOrderId] IS NOT NULL THEN CAST(1 AS bit)\n                ELSE CAST(0 AS bit)\n            END\n            ELSE CASE\n                WHEN [s0].[Id] = [p3].[ActivePalletId] AND [p3].[ActivePalletId] IS NOT NULL THEN CAST(1 AS bit)\n                ELSE CAST(0 AS bit)\n            END\n        END = CAST(1 AS bit)\n    ) AS [t]\n    GROUP BY [t].[Key]\n) AS [t0]\nOUTER APPLY (\n    SELECT TOP(1) CAST(COALESCE(SUM([t2].[NetWeight]), 0.0E0) AS real) AS [NetWeight], COUNT(*) AS [NumberOfRegistrations], 1 AS [c]\n    FROM (\n        SELECT [w].[NetWeight], 1 AS [Key]\n        FROM [WasteRegistrations] AS [w]\n        INNER JOIN [SourcePallet] AS [s3] ON [w].[SourcePalletId] = [s3].[Id]\n        WHERE CASE\n            WHEN [s].[SupplyOrderId] IS NOT NULL THEN CASE\n                WHEN [s3].[SupplyOrderId] = [s].[SupplyOrderId] AND [s3].[SupplyOrderId] IS NOT NULL THEN CAST(1 AS bit)\n                ELSE CAST(0 AS bit)\n            END\n            ELSE CASE\n                WHEN [s3].[Id] = [p3].[ActivePalletId] AND [p3].[ActivePalletId] IS NOT NULL THEN CAST(1 AS bit)\n                ELSE CAST(0 AS bit)\n            END\n        END = CAST(1 AS bit)\n    ) AS [t2]\n    GROUP BY [t2].[Key]\n) AS [t1]\n```\n\n```sql\n-- EF Core 9\nSELECT (\n    SELECT TOP(1) [p4].[ProcessingLineType]\n    FROM [ProcessingLines] AS [p4]\n    LEFT JOIN [ProcessingLineConfigurations] AS [p5] ON [p4].[ActiveConfigurationId] = [p5].[Id]\n    WHERE EXISTS (\n        SELECT 1\n        FROM [ProcessingConfigurationFlows] AS [p6]\n        WHERE [p5].[Id] IS NOT NULL AND [p5].[Id] = [p6].[ConfigurationId] AND [p6].[FlowId] = [p1].[FlowId])), [p3].[ConsumedCount], (\n    SELECT CAST(COALESCE(SUM([s3].[NetWeight]), 0.0E0) AS real)\n    FROM [CurrentSourcePalletWeights] AS [c]\n    INNER JOIN [SourcePallet] AS [s2] ON [c].[SourcePalletId] = [s2].[Id]\n    INNER JOIN [SourcePalletWeightRegistrations] AS [s3] ON [c].[SourcePalletWeightRegistrationId] = [s3].[Id]\n    WHERE CASE\n        WHEN [s].[SupplyOrderId] IS NOT NULL THEN ~CAST([s2].[SupplyOrderId] ^ [s].[SupplyOrderId] AS bit)\n        ELSE ~CAST([s2].[Id] ^ [p3].[ActivePalletId] AS bit)\n    END = CAST(1 AS bit)), [s6].[NumberOfItems], [s6].[UnloadNumberOfItems], [s6].[c], [s7].[NetWeight], [s7].[NumberOfRegistrations], [s7].[c]\nFROM [ProcessingLines] AS [p]\nLEFT JOIN [ProcessingLineConfigurations] AS [p0] ON [p].[ActiveConfigurationId] = [p0].[Id]\nINNER JOIN [ProcessingConfigurationFlows] AS [p1] ON [p0].[Id] = [p1].[ConfigurationId]\nINNER JOIN [ProductSupplyFlows] AS [p2] ON [p1].[FlowId] = [p2].[Id]\nINNER JOIN [PalletProcessingQueues] AS [p3] ON [p2].[ProcessingQueueId] = [p3].[Id]\nLEFT JOIN [SourcePallet] AS [s] ON [p3].[ActivePalletId] = [s].[Id]\nOUTER APPLY (\n    SELECT TOP(1) COALESCE(SUM([s1].[NumberOfItems]), 0) AS [NumberOfItems], COALESCE(SUM(CASE\n        WHEN [s1].[SourcePalletStatus] = 5 THEN [s1].[NumberOfItems]\n    END), 0) AS [UnloadNumberOfItems], 1 AS [c]\n    FROM (\n        SELECT [s0].[NumberOfItems], [s0].[SourcePalletStatus], 1 AS [Key]\n        FROM [SourcePallet] AS [s0]\n        WHERE CASE\n            WHEN [s].[SupplyOrderId] IS NOT NULL THEN ~CAST([s0].[SupplyOrderId] ^ [s].[SupplyOrderId] AS bit)\n            ELSE ~CAST([s0].[Id] ^ [p3].[ActivePalletId] AS bit)\n        END = CAST(1 AS bit)\n    ) AS [s1]\n    GROUP BY [s1].[Key]\n) AS [s6]\nOUTER APPLY (\n    SELECT TOP(1) CAST(COALESCE(SUM([s5].[NetWeight]), 0.0E0) AS real) AS [NetWeight], COUNT(*) AS [NumberOfRegistrations], 1 AS [c]\n    FROM (\n        SELECT [w].[NetWeight], 1 AS [Key]\n        FROM [WasteRegistrations] AS [w]\n        INNER JOIN [SourcePallet] AS [s4] ON [w].[SourcePalletId] = [s4].[Id]\n        WHERE CASE\n            WHEN [s].[SupplyOrderId] IS NOT NULL THEN ~CAST([s4].[SupplyOrderId] ^ [s].[SupplyOrderId] AS bit)\n            ELSE ~CAST([s4].[Id] ^ [p3].[ActivePalletId] AS bit)\n        END = CAST(1 AS bit)\n    ) AS [s5]\n    GROUP BY [s5].[Key]\n) AS [s7]\n```\n\n`time,io` statistics for EF8 query:\n```\nStarted executing query at Line 1\nSQL Server parse and compile time:\nCPU time = 46 ms, elapsed time = 733 ms.\nSQL Server Execution Times:\nCPU time = 0 ms, elapsed time = 0 ms.\nWarning: Null value is eliminated by an aggregate or other SET operation.\n(30 rows affected)\nTable 'Worktable'. Scan count 227, logical reads 842, physical reads 0, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'SourcePalletWeightRegistrations'. Scan count 0, logical reads 87, physical reads 5, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'CurrentSourcePalletWeights'. Scan count 0, logical reads 87, physical reads 5, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'SourcePallet'. Scan count 72, logical reads 223915, physical reads 3, page server reads 0, read-ahead reads 3606, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'ProcessingLineConfigurations'. Scan count 0, logical reads 56, physical reads 1, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'ProcessingLines'. Scan count 37, logical reads 130, physical reads 2, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'ProcessingConfigurationFlows'. Scan count 52, logical reads 104, physical reads 2, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'WasteRegistrations'. Scan count 29, logical reads 120, physical reads 14, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'PalletProcessingQueues'. Scan count 0, logical reads 60, physical reads 1, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'ProductSupplyFlows'. Scan count 0, logical reads 60, physical reads 1, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\n(1 row affected)\nSQL Server Execution Times:\nCPU time = 5672 ms, elapsed time = 5804 ms.\nTotal execution time: 00:00:06.584\n```\n\n`time,io` statistics for EF9 query:\n```\nStarted executing query at Line 1\nWarning: Null value is eliminated by an aggregate or other SET operation.\n(30 rows affected)\nTable 'Worktable'. Scan count 227, logical reads 842, physical reads 0, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'Workfile'. Scan count 0, logical reads 0, physical reads 0, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'CurrentSourcePalletWeights'. Scan count 23, logical reads 28773, physical reads 1, page server reads 0, read-ahead reads 2289, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'SourcePalletWeightRegistrations'. Scan count 23, logical reads 95243, physical reads 2, page server reads 0, read-ahead reads 5530, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'SourcePallet'. Scan count 72, logical reads 666601, physical reads 6, page server reads 0, read-ahead reads 45274, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'ProcessingLineConfigurations'. Scan count 0, logical reads 56, physical reads 1, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'ProcessingLines'. Scan count 37, logical reads 130, physical reads 2, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'ProcessingConfigurationFlows'. Scan count 52, logical reads 104, physical reads 2, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'WasteRegistrations'. Scan count 23, logical reads 2806713, physical reads 392, page server reads 0, read-ahead reads 178690, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'PalletProcessingQueues'. Scan count 0, logical reads 60, physical reads 1, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\nTable 'ProductSupplyFlows'. Scan count 0, logical reads 60, physical reads 1, page server reads 0, read-ahead reads 0, page server read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob page server reads 0, lob read-ahead reads 0, lob page server read-ahead reads 0.\n(1 row affected)\nSQL Server Execution Times:\nCPU time = 77391 ms, elapsed time = 79145 ms.\nTotal execution time: 00:01:19.270\n```\n\nAs you can see from the above it doesn't only affect `WasteRegistrations`, `SourcePallet` for one is also affected which might also be aversely affecting the rest of the execution.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3004758845/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":18316744077,"node_id":"MEE_lADOAPaMMs69RC07zwAAAARDw1WN","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18316744077","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-06-25T13:22:40Z","performed_via_github_app":null},{"id":18316744103,"node_id":"SE_lADOAPaMMs69RC07zwAAAARDw1Wn","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18316744103","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-06-25T13:22:40Z","performed_via_github_app":null},{"actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-06-25T13:41:39Z","updated_at":"2025-06-25T13:41:39Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/36293","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/36293/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/36293/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/36293/events","html_url":"https://github.com/dotnet/efcore/issues/36293","id":3175590674,"node_id":"I_kwDOAPaMMs69R6sS","number":36293,"title":"Ternary false-expression does not take ternary condition into account, resulting in slow execution on SQL Server","user":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":130861068,"node_id":"MDU6TGFiZWwxMzA4NjEwNjg=","url":"https://api.github.com/repos/dotnet/efcore/labels/area-perf","name":"area-perf","color":"5319e7","default":false,"description":""},{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1675384372,"node_id":"MDU6TGFiZWwxNjc1Mzg0Mzcy","url":"https://api.github.com/repos/dotnet/efcore/labels/area-query","name":"area-query","color":"32b37b","default":false,"description":""}],"state":"open","locked":false,"assignee":{"login":"cincuranet","id":4540597,"node_id":"MDQ6VXNlcjQ1NDA1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/4540597?v=4","gravatar_id":"","url":"https://api.github.com/users/cincuranet","html_url":"https://github.com/cincuranet","followers_url":"https://api.github.com/users/cincuranet/followers","following_url":"https://api.github.com/users/cincuranet/following{/other_user}","gists_url":"https://api.github.com/users/cincuranet/gists{/gist_id}","starred_url":"https://api.github.com/users/cincuranet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cincuranet/subscriptions","organizations_url":"https://api.github.com/users/cincuranet/orgs","repos_url":"https://api.github.com/users/cincuranet/repos","events_url":"https://api.github.com/users/cincuranet/events{/privacy}","received_events_url":"https://api.github.com/users/cincuranet/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"cincuranet","id":4540597,"node_id":"MDQ6VXNlcjQ1NDA1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/4540597?v=4","gravatar_id":"","url":"https://api.github.com/users/cincuranet","html_url":"https://github.com/cincuranet","followers_url":"https://api.github.com/users/cincuranet/followers","following_url":"https://api.github.com/users/cincuranet/following{/other_user}","gists_url":"https://api.github.com/users/cincuranet/gists{/gist_id}","starred_url":"https://api.github.com/users/cincuranet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cincuranet/subscriptions","organizations_url":"https://api.github.com/users/cincuranet/orgs","repos_url":"https://api.github.com/users/cincuranet/repos","events_url":"https://api.github.com/users/cincuranet/events{/privacy}","received_events_url":"https://api.github.com/users/cincuranet/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/214","html_url":"https://github.com/dotnet/efcore/milestone/214","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/214/labels","id":13093949,"node_id":"MI_kwDOAPaMMs4Ax8w9","number":214,"title":"11.0.0","description":null,"creator":{"login":"cincuranet","id":4540597,"node_id":"MDQ6VXNlcjQ1NDA1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/4540597?v=4","gravatar_id":"","url":"https://api.github.com/users/cincuranet","html_url":"https://github.com/cincuranet","followers_url":"https://api.github.com/users/cincuranet/followers","following_url":"https://api.github.com/users/cincuranet/following{/other_user}","gists_url":"https://api.github.com/users/cincuranet/gists{/gist_id}","starred_url":"https://api.github.com/users/cincuranet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cincuranet/subscriptions","organizations_url":"https://api.github.com/users/cincuranet/orgs","repos_url":"https://api.github.com/users/cincuranet/repos","events_url":"https://api.github.com/users/cincuranet/events{/privacy}","received_events_url":"https://api.github.com/users/cincuranet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":62,"closed_issues":17,"state":"open","created_at":"2025-06-16T18:44:38Z","updated_at":"2025-11-09T13:05:34Z","due_on":null,"closed_at":null},"comments":2,"created_at":"2025-06-25T13:08:16Z","updated_at":"2025-08-25T12:58:02Z","closed_at":null,"author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Bug description\n\nEF Core 8, only, but pending outcome of #36291.\n\nWhen the ternary condition contains a `== null` check, the else branch doesn't eliminate null values in the else expression, resulting in queries that will scan more data than required when executed against SQL Server.\n\nAs part of a query template to optimize performance for a specific query I have the following C# predicate, which translates and works as expected:\n```csharp\nr => Template.SupplyOrderId != null\n    ? r.SourcePallet.SupplyOrderId == Template.SupplyOrderId\n    : r.SourcePallet.Id == Template.ActivePalletId\n```\n\nThis predicate translates to the where clause of the following SQL subquery:\n```sql\nSELECT [w].[NetWeight], 1 AS [Key]\nFROM [WasteRegistrations] AS [w]\nINNER JOIN [SourcePallet] AS [s3] ON [w].[SourcePalletId] = [s3].[Id]\nWHERE CASE\n    WHEN [s].[SupplyOrderId] IS NOT NULL THEN CASE\n        WHEN [s3].[SupplyOrderId] = [s].[SupplyOrderId] AND [s3].[SupplyOrderId] IS NOT NULL THEN CAST(1 AS bit)\n        ELSE CAST(0 AS bit)\n    END\n    ELSE CASE\n        WHEN [s3].[Id] = [p3].[ActivePalletId] AND [p3].[ActivePalletId] IS NOT NULL THEN CAST(1 AS bit)\n        ELSE CAST(0 AS bit)\n    END\nEND = CAST(1 AS bit)\n```\nHere `s.SupplyOrderId` is of type `int?`, just as well as `p3.ActivePalletId` is of type `int?`.\n\nIf we however invert the ternary conditions and swap the expressions, we get the following expression:\n```csharp\nr => Template.SupplyOrderId == null\n    ? r.SourcePallet.Id == Template.ActivePalletId\n    : r.SourcePallet.SupplyOrderId == Template.SupplyOrderId.Value);\n```\n\nThis predicate translates to the where clause of the following SQL subquery:\n```sql\nSELECT [w].[NetWeight], 1 AS [Key]\nFROM [WasteRegistrations] AS [w]\nINNER JOIN [SourcePallet] AS [s3] ON [w].[SourcePalletId] = [s3].[Id]\nWHERE CASE\n    WHEN [s].[SupplyOrderId] IS NULL THEN CASE\n        WHEN [s3].[Id] = [p3].[ActivePalletId] AND [p3].[ActivePalletId] IS NOT NULL THEN CAST(1 AS bit)\n        ELSE CAST(0 AS bit)\n    END\n    ELSE CASE\n        WHEN ([s3].[SupplyOrderId] = [s].[SupplyOrderId] AND [s3].[SupplyOrderId] IS NOT NULL AND [s].[SupplyOrderId] IS NOT NULL) OR ([s3].[SupplyOrderId] IS NULL AND [s].[SupplyOrderId] IS NULL) THEN CAST(1 AS bit)\n        ELSE CAST(0 AS bit)\n    END\nEND = CAST(1 AS bit)\n```\nThe obvious flaw in this query is `OR ([s3].[SupplyOrderId] IS NULL AND [s].[SupplyOrderId] IS NULL`, because that's already excluded by this branch being the `ELSE CASE` of `WHEN [s].[SupplyOrderId] IS NULL`. Unfortunately SQL Server isn't able to optimize this out of the query, resulting in very inefficient data access. `SourcePallet` gets a **Clustered Index Scan** while there's more approriate indexes to use, this in turn causes a **Clustered Index Scan** against the `WasteRegistration` table (which in my case is a lot larger) instead of a more optimal `Clustered Index Seek`. Of course the outcome is specific to my data structures, nonetheless the `OR` part can be eliminated resolving this specific issue,\n\n### Your code\n\n```csharp\nSee above\n```\n\n### Stack traces\n\n```text\n\n```\n\n### Verbose output\n\n```text\n\n```\n\n### EF Core version\n\n8.0.11\n\n### Database provider\n\nMicrosoft.EntityFrameworkCore.SqlServer\n\n### Target framework\n\n.NET 8.0\n\n### Operating system\n\nWindows 11\n\n### IDE\n\nVisual Studio 2022 17.4","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/36293/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/36293/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3005647687","html_url":"https://github.com/dotnet/efcore/issues/36291#issuecomment-3005647687","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/36291","id":3005647687,"node_id":"IC_kwDOAPaMMs6zJotH","user":{"login":"ranma42","id":1506030,"node_id":"MDQ6VXNlcjE1MDYwMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1506030?v=4","gravatar_id":"","url":"https://api.github.com/users/ranma42","html_url":"https://github.com/ranma42","followers_url":"https://api.github.com/users/ranma42/followers","following_url":"https://api.github.com/users/ranma42/following{/other_user}","gists_url":"https://api.github.com/users/ranma42/gists{/gist_id}","starred_url":"https://api.github.com/users/ranma42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranma42/subscriptions","organizations_url":"https://api.github.com/users/ranma42/orgs","repos_url":"https://api.github.com/users/ranma42/repos","events_url":"https://api.github.com/users/ranma42/events{/privacy}","received_events_url":"https://api.github.com/users/ranma42/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-06-25T17:47:12Z","updated_at":"2025-06-25T17:47:12Z","body":"Apparently SQLServer is quite good at looking through (nested) CASE expressions, so the attempt to avoid casting back and forth between boolean expressions and BIT values seems to make things significantly worse.\n\nIt should be fairly straightforward to keep the simpler expressions in non-predicate contexts and use the CASE-based ones in predicates.\n\n@roji note that the PR that most likely caused the regression is https://github.com/dotnet/efcore/pull/34168 (i.e. the one that translates some `==` and `!=` as (negated) XOR).\n\nAnother option would be to revert the change and always translate using `CASE`, but that would re-introduce bugs around `NULL` (/`UNKNOWN`) boolean results (OTOH this was buggy before EFCore 9 and is not yet fully solved; currently tracked in #34001).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3005647687/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ranma42","id":1506030,"node_id":"MDQ6VXNlcjE1MDYwMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1506030?v=4","gravatar_id":"","url":"https://api.github.com/users/ranma42","html_url":"https://github.com/ranma42","followers_url":"https://api.github.com/users/ranma42/followers","following_url":"https://api.github.com/users/ranma42/following{/other_user}","gists_url":"https://api.github.com/users/ranma42/gists{/gist_id}","starred_url":"https://api.github.com/users/ranma42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranma42/subscriptions","organizations_url":"https://api.github.com/users/ranma42/orgs","repos_url":"https://api.github.com/users/ranma42/repos","events_url":"https://api.github.com/users/ranma42/events{/privacy}","received_events_url":"https://api.github.com/users/ranma42/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":18321551055,"node_id":"MEE_lADOAPaMMs69RC07zwAAAAREDK7P","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18321551055","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-06-25T17:47:14Z","performed_via_github_app":null},{"id":18321551084,"node_id":"SE_lADOAPaMMs69RC07zwAAAAREDK7s","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18321551084","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-06-25T17:47:14Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3005958924","html_url":"https://github.com/dotnet/efcore/issues/36291#issuecomment-3005958924","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/36291","id":3005958924,"node_id":"IC_kwDOAPaMMs6zK0sM","user":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-06-25T19:52:08Z","updated_at":"2025-06-25T19:52:08Z","body":"> Apparently SQLServer is quite good at looking through (nested) CASE expressions, so the attempt to avoid casting back and forth between boolean expressions and BIT values seems to make things significantly worse.\n\nWell... I have 5 templates leading to the same result set. They're all equivalent for my data model, but I'm not 100% confident SQL Server should be able to deduct that if ActivePallet has a SupplyOrder and I'm getting all SourcePallets for the SupplyOrder, that it can match that SourcePallet by Id as well. Sounds complicated (but isn't really), but I can make that deduction and as such can use the C# expression `r => r.SourcePallet.Id == Template,ActivePalletId || (Template.SupplyOrderId != null && r.SourcePallet.SupplyOrderId == Template.SupplyOrderId)`. What also works is `r => r.SourcePallet.Id == Template.ActivePalletId || r.SourcePallet.SupplyOrderId == Template.ActivePalletId ?? -1`. Both will yield the same result set, but these will actually complete in 2ms and 4ms respectively. So all in all, I have 5 templates to do this match, which currently execute in 2ms, 4ms, ~5.5s, ~33s and 40+s (same dataset, same hardware, same advantage of priming the cache with a non-timed identical query first). So while SQL Server honestly is amazingly smart, there's still room for improvement.\n\nAlso, this might look awkward, but if the pallet has no SupplyOrder I still want the details for the single pallet, which works equally well with this query.\n \n> It should be fairly straightforward to keep the simpler expressions in non-predicate contexts and use the CASE-based ones in predicates.\n\nSounds like a good plan. I was honestly amazed this slipped through and didn't get noticed yet.\n\nThanks for looking into this issue as well, I understand I'm not really delivering this on a silver plate with the huge queries and lack of runnable code.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3005958924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3006454470","html_url":"https://github.com/dotnet/efcore/issues/36291#issuecomment-3006454470","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/36291","id":3006454470,"node_id":"IC_kwDOAPaMMs6zMtrG","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-06-25T22:46:36Z","updated_at":"2025-06-25T22:46:36Z","body":">> It should be fairly straightforward to keep the simpler expressions in non-predicate contexts and use the CASE-based ones in predicates.\n>\n> Sounds like a good plan. I was honestly amazed this slipped through and didn't get noticed yet.\n\nI'm not sure varying our translation strategy based on whether they're in predicate or non-predicate is a good idea - that feels like it would introduce yet more complexity (we don't usually take this kind of context into account).\n\n@mycroes thanks for the full SQLs, but ideally we'd still have an actual minimal repro. It's not that I don't believe what you're reporting, but we usually want to have an actual repro and getting to the bottom of it before making a non-trivial SQL translation change such as the one being ddiscusse here.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3006454470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":18325519442,"node_id":"MEE_lADOAPaMMs69RC07zwAAAARESTxS","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18325519442","actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-06-25T22:46:37Z","performed_via_github_app":null},{"id":18325519460,"node_id":"SE_lADOAPaMMs69RC07zwAAAARESTxk","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18325519460","actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-06-25T22:46:37Z","performed_via_github_app":null},{"id":18641437948,"node_id":"SE_lADOAPaMMs69RC07zwAAAARXHcT8","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18641437948","actor":{"login":"marcominerva","id":3522534,"node_id":"MDQ6VXNlcjM1MjI1MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3522534?v=4","gravatar_id":"","url":"https://api.github.com/users/marcominerva","html_url":"https://github.com/marcominerva","followers_url":"https://api.github.com/users/marcominerva/followers","following_url":"https://api.github.com/users/marcominerva/following{/other_user}","gists_url":"https://api.github.com/users/marcominerva/gists{/gist_id}","starred_url":"https://api.github.com/users/marcominerva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcominerva/subscriptions","organizations_url":"https://api.github.com/users/marcominerva/orgs","repos_url":"https://api.github.com/users/marcominerva/repos","events_url":"https://api.github.com/users/marcominerva/events{/privacy}","received_events_url":"https://api.github.com/users/marcominerva/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-07-15T15:40:40Z","performed_via_github_app":null},{"id":18674344999,"node_id":"ITAE_lADOAPaMMs69RC07zwAAAARZE-Qn","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18674344999","actor":{"login":"cincuranet","id":4540597,"node_id":"MDQ6VXNlcjQ1NDA1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/4540597?v=4","gravatar_id":"","url":"https://api.github.com/users/cincuranet","html_url":"https://github.com/cincuranet","followers_url":"https://api.github.com/users/cincuranet/followers","following_url":"https://api.github.com/users/cincuranet/following{/other_user}","gists_url":"https://api.github.com/users/cincuranet/gists{/gist_id}","starred_url":"https://api.github.com/users/cincuranet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cincuranet/subscriptions","organizations_url":"https://api.github.com/users/cincuranet/orgs","repos_url":"https://api.github.com/users/cincuranet/repos","events_url":"https://api.github.com/users/cincuranet/events{/privacy}","received_events_url":"https://api.github.com/users/cincuranet/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"issue_type_added","commit_id":null,"commit_url":null,"created_at":"2025-07-17T07:46:35Z","performed_via_github_app":null},{"id":18674345330,"node_id":"MIE_lADOAPaMMs69RC07zwAAAARZE-Vy","url":"https://api.github.com/repos/dotnet/efcore/issues/events/18674345330","actor":{"login":"cincuranet","id":4540597,"node_id":"MDQ6VXNlcjQ1NDA1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/4540597?v=4","gravatar_id":"","url":"https://api.github.com/users/cincuranet","html_url":"https://github.com/cincuranet","followers_url":"https://api.github.com/users/cincuranet/followers","following_url":"https://api.github.com/users/cincuranet/following{/other_user}","gists_url":"https://api.github.com/users/cincuranet/gists{/gist_id}","starred_url":"https://api.github.com/users/cincuranet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cincuranet/subscriptions","organizations_url":"https://api.github.com/users/cincuranet/orgs","repos_url":"https://api.github.com/users/cincuranet/repos","events_url":"https://api.github.com/users/cincuranet/events{/privacy}","received_events_url":"https://api.github.com/users/cincuranet/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2025-07-17T07:46:36Z","milestone":{"title":"10.0.0"},"performed_via_github_app":null},{"id":19720355045,"node_id":"REFE_lADOAPaMMs69RC07zwAAAASXbLzl","url":"https://api.github.com/repos/dotnet/efcore/issues/events/19720355045","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4a7d549156be1c43b426ee0c27eaa54e87159731","commit_url":"https://api.github.com/repos/roji/efcore/commits/4a7d549156be1c43b426ee0c27eaa54e87159731","created_at":"2025-09-16T08:47:19Z","performed_via_github_app":null},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-09-16T08:58:26Z","updated_at":"2025-09-16T08:58:26Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/36797","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/36797/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/36797/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/36797/events","html_url":"https://github.com/dotnet/efcore/pull/36797","id":3421207401,"node_id":"PR_kwDOAPaMMs6ozyX5","number":36797,"title":"[rc2] SQL Server: Don't transform equality to bitwise operations in predicate contexts","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":5874934480,"node_id":"LA_kwDOAPaMMs8AAAABXixi0A","url":"https://api.github.com/repos/dotnet/efcore/labels/ask-mode","name":"ask-mode","color":"ce1e36","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2025-09-16T08:58:24Z","updated_at":"2025-09-19T12:08:41Z","closed_at":"2025-09-19T12:08:41Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dotnet/efcore/pulls/36797","html_url":"https://github.com/dotnet/efcore/pull/36797","diff_url":"https://github.com/dotnet/efcore/pull/36797.diff","patch_url":"https://github.com/dotnet/efcore/pull/36797.patch","merged_at":null},"body":"**Implementation note**: I suspect that this restores CASE in more scenarios than is absolutely necessary; for example, an alternative would be to very specifically pattern-match CASE within WHERE and perform the exemption for that only. However, despite the more complicated-looking SQL, there's probably no actual negative impact for having it (as opposed to the simpler-looking bitwise operation), and there seems to be more risk of regressing perf by keeping the bitwise operation (as happened in #36291) than there is by having CASE in more scenarios than needed.\r\n\r\nFixes #36291\r\n\r\n/cc @ranma42 \r\n\r\n**Description**\r\nEF 9.0 brought some improvements to simplify SQL and fix bugs in the SQL Server profivider; these essentially involved replacing the more complex CASE expressions we previously generated for certain equality constructs into bitwise operators, using e.g. XOR to express inequality.\r\n\r\nUnfortunately, after 9.0 it was reported that in some contexts this change caused a performance regression, as the new bitwise-based SQL caused SQL Server to no longer use indexes. This PR undoes that change, but only for predicate contexts which may benefit from index usage, while preserving the bitwise transformation for other contexts, where it fixes bugs.\r\n\r\n**Customer impact**\r\nCertain queries which should benefit from index usage on SQL Server do not, e.g. queries of the form:\r\n\r\n```c#\r\nvar foo = await context.Blogs.Where(b => b.SomeBool ? b.SomeInt1 == b.SomeInt2 : b.SomeInt1 == b.SOmeInt3).ToListAsync();\r\n```\r\n\r\nUsing a database index or not impacts query performance in decisive ways.\r\n\r\n**How found**\r\nUser reported.\r\n\r\n**Regression**\r\nYes (performance), in EF 9\r\n\r\n**Testing**\r\nAlready there (tests already assert on specific SQL).\r\n\r\n**Risk**\r\nLow, very targeted fix, and the SQL produced is correct in any case, and so very unlikely to produce a regression.\r\n","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/36797/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/36797/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3301820377","html_url":"https://github.com/dotnet/efcore/issues/36291#issuecomment-3301820377","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/36291","id":3301820377,"node_id":"IC_kwDOAPaMMs7EzcfZ","user":{"login":"ranma42","id":1506030,"node_id":"MDQ6VXNlcjE1MDYwMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1506030?v=4","gravatar_id":"","url":"https://api.github.com/users/ranma42","html_url":"https://github.com/ranma42","followers_url":"https://api.github.com/users/ranma42/followers","following_url":"https://api.github.com/users/ranma42/following{/other_user}","gists_url":"https://api.github.com/users/ranma42/gists{/gist_id}","starred_url":"https://api.github.com/users/ranma42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranma42/subscriptions","organizations_url":"https://api.github.com/users/ranma42/orgs","repos_url":"https://api.github.com/users/ranma42/repos","events_url":"https://api.github.com/users/ranma42/events{/privacy}","received_events_url":"https://api.github.com/users/ranma42/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-09-17T08:07:40Z","updated_at":"2025-09-17T08:07:40Z","body":"This snippet reproduces the two different translations:\n\n```csharp\n// @nuget: Microsoft.EntityFrameworkCore.SqlServer -Version 9.0.0\nusing System;\nusing System.Linq;\nusing Microsoft.EntityFrameworkCore;\n\nusing var db = new BloggingContext();\n\nvar query = db.Blogs\n    .Where(x => x.Id > 12 ? x.A == 1 : x.A == 2)\n    .ToQueryString();\n\nConsole.WriteLine(query);\n\npublic class BloggingContext : DbContext\n{\n    public DbSet<Blog> Blogs { get; set; }\n\n    protected override void OnConfiguring(DbContextOptionsBuilder options)\n        => options.UseSqlServer();\n}\n\npublic class Blog\n{\n    public int Id { get; set; }\n    public int A { get; set; }\n}\n```\n\nSpecifically, on EFCore 8 it outputs:\n```\nSELECT [b].[Id], [b].[A]\nFROM [Blogs] AS [b]\nWHERE CASE\n    WHEN [b].[Id] > 12 THEN CASE\n        WHEN [b].[A] = 1 THEN CAST(1 AS bit)\n        ELSE CAST(0 AS bit)\n    END\n    ELSE CASE\n        WHEN [b].[A] = 2 THEN CAST(1 AS bit)\n        ELSE CAST(0 AS bit)\n    END\nEND = CAST(1 AS bit)\n```\n\nwhile on EFCore 9 it outputs:\n```\nSELECT [b].[Id], [b].[A]\nFROM [Blogs] AS [b]\nWHERE CASE\n    WHEN [b].[Id] > 12 THEN ~CAST([b].[A] ^ 1 AS bit)\n    ELSE ~CAST([b].[A] ^ 2 AS bit)\nEND = CAST(1 AS bit)\n```\n\nUnfortunately this does not reproduce the most interesting part of the issue, i.e. the change in the execution plan used by the DB.\nI am afraid that in order to reproduce that, a more complex setting is needed (so far I have been unable to reproduce it exactly).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3301820377/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ranma42","id":1506030,"node_id":"MDQ6VXNlcjE1MDYwMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1506030?v=4","gravatar_id":"","url":"https://api.github.com/users/ranma42","html_url":"https://github.com/ranma42","followers_url":"https://api.github.com/users/ranma42/followers","following_url":"https://api.github.com/users/ranma42/following{/other_user}","gists_url":"https://api.github.com/users/ranma42/gists{/gist_id}","starred_url":"https://api.github.com/users/ranma42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranma42/subscriptions","organizations_url":"https://api.github.com/users/ranma42/orgs","repos_url":"https://api.github.com/users/ranma42/repos","events_url":"https://api.github.com/users/ranma42/events{/privacy}","received_events_url":"https://api.github.com/users/ranma42/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3303011151","html_url":"https://github.com/dotnet/efcore/issues/36291#issuecomment-3303011151","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/36291","id":3303011151,"node_id":"IC_kwDOAPaMMs7E3_NP","user":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-09-17T13:25:48Z","updated_at":"2025-09-17T13:25:48Z","body":"It's index related. I reference an optional relation (`SupplyOrder`), if it's set I aggregate over collection properties (waste registrations, weights) of the `SupplyOrder`, otherwise I use the reference to `ActivePallet`. With EF Core 9 it fails to distinct the null / non-null `SupplyOrderId`'s and I think it then ends up doing the aggregation over the entire set of waste registrations and weights before joining them on the (sub-)result of the `ProcessingLine` query. This specific case is all pretty complicated to replicate though, because it probably also depends on the amount of data.\n\nFrom the two generated queries I think there's an easy testcase. Add a filtered index on `A >= 1 AND A <= 2`. I think this should permit the filtered index to be used with the EF Core 8 query, but not with EF Core 9 statements. I guess this would be good enough to show the deficiency in this approach. It might take some actual data to do this, not sure how much data you're currently testing with.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/3303011151/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mycroes","id":122017,"node_id":"MDQ6VXNlcjEyMjAxNw==","avatar_url":"https://avatars.githubusercontent.com/u/122017?v=4","gravatar_id":"","url":"https://api.github.com/users/mycroes","html_url":"https://github.com/mycroes","followers_url":"https://api.github.com/users/mycroes/followers","following_url":"https://api.github.com/users/mycroes/following{/other_user}","gists_url":"https://api.github.com/users/mycroes/gists{/gist_id}","starred_url":"https://api.github.com/users/mycroes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mycroes/subscriptions","organizations_url":"https://api.github.com/users/mycroes/orgs","repos_url":"https://api.github.com/users/mycroes/repos","events_url":"https://api.github.com/users/mycroes/events{/privacy}","received_events_url":"https://api.github.com/users/mycroes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-09-17T16:52:52Z","updated_at":"2025-09-17T16:52:52Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/36809","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/36809/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/36809/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/36809/events","html_url":"https://github.com/dotnet/efcore/pull/36809","id":3423987730,"node_id":"PR_kwDOAPaMMs6o9FHm","number":36809,"title":"[rc2] SQL Server: Don't transform equality to bitwise operations in predicate contexts","user":{"login":"ranma42","id":1506030,"node_id":"MDQ6VXNlcjE1MDYwMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1506030?v=4","gravatar_id":"","url":"https://api.github.com/users/ranma42","html_url":"https://github.com/ranma42","followers_url":"https://api.github.com/users/ranma42/followers","following_url":"https://api.github.com/users/ranma42/following{/other_user}","gists_url":"https://api.github.com/users/ranma42/gists{/gist_id}","starred_url":"https://api.github.com/users/ranma42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ranma42/subscriptions","organizations_url":"https://api.github.com/users/ranma42/orgs","repos_url":"https://api.github.com/users/ranma42/repos","events_url":"https://api.github.com/users/ranma42/events{/privacy}","received_events_url":"https://api.github.com/users/ranma42/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":5874934480,"node_id":"LA_kwDOAPaMMs8AAAABXixi0A","url":"https://api.github.com/repos/dotnet/efcore/labels/ask-mode","name":"ask-mode","color":"ce1e36","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2025-09-16T22:59:47Z","updated_at":"2025-09-19T12:19:59Z","closed_at":"2025-09-19T12:08:12Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dotnet/efcore/pulls/36809","html_url":"https://github.com/dotnet/efcore/pull/36809","diff_url":"https://github.com/dotnet/efcore/pull/36809.diff","patch_url":"https://github.com/dotnet/efcore/pull/36809.patch","merged_at":"2025-09-19T12:08:12Z"},"body":"This is an alternative implementation of https://github.com/dotnet/efcore/pull/36797.\r\n\r\nI added a test which I think might make sense regardless, as it checks that the handling of nullable bools does not regress, at least in trivial cases (specifically, that test would fail on EFCore 8 and pass on 9).\r\n\r\nThe main difference in the approach when compared to #36797 is that instead of a field in the visitor, the `allowOptimizedExpansion` information is passed while visiting, just like the `inSearchConditionContext`.\r\n\r\nThe `allowOptimizedExpansion` is named like this to match the same value in the `SqlNullabilityProcessor` as it has the same semantics, namely that \"falsy\" results (NULLs, FALSEs) can be clumped together.","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/36809/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/36809/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":19798170387,"node_id":"CE_lADOAPaMMs69RC07zwAAAAScEBsT","url":"https://api.github.com/repos/dotnet/efcore/issues/events/19798170387","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"a4f37c552c9cb3485a043783cfd52afd90c24bdf","commit_url":"https://api.github.com/repos/dotnet/efcore/commits/a4f37c552c9cb3485a043783cfd52afd90c24bdf","created_at":"2025-09-19T12:08:13Z","state_reason":null,"performed_via_github_app":null},{"id":19798384895,"node_id":"LE_lADOAPaMMs69RC07zwAAAAScE2D_","url":"https://api.github.com/repos/dotnet/efcore/issues/events/19798384895","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-09-19T12:20:18Z","label":{"name":"rc-2","color":"ACB3D7"},"performed_via_github_app":null}]