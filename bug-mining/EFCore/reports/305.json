{"url":"https://api.github.com/repos/dotnet/efcore/issues/32208","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/32208/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/32208/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/32208/events","html_url":"https://github.com/dotnet/efcore/issues/32208","id":1973942368,"node_id":"I_kwDOAPaMMs51p_hg","number":32208,"title":"SqlNullabilityProcessor ignores Contains item visitation","user":{"login":"shvmgpt116","id":17099824,"node_id":"MDQ6VXNlcjE3MDk5ODI0","avatar_url":"https://avatars.githubusercontent.com/u/17099824?v=4","gravatar_id":"","url":"https://api.github.com/users/shvmgpt116","html_url":"https://github.com/shvmgpt116","followers_url":"https://api.github.com/users/shvmgpt116/followers","following_url":"https://api.github.com/users/shvmgpt116/following{/other_user}","gists_url":"https://api.github.com/users/shvmgpt116/gists{/gist_id}","starred_url":"https://api.github.com/users/shvmgpt116/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shvmgpt116/subscriptions","organizations_url":"https://api.github.com/users/shvmgpt116/orgs","repos_url":"https://api.github.com/users/shvmgpt116/repos","events_url":"https://api.github.com/users/shvmgpt116/events{/privacy}","received_events_url":"https://api.github.com/users/shvmgpt116/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1675384372,"node_id":"MDU6TGFiZWwxNjc1Mzg0Mzcy","url":"https://api.github.com/repos/dotnet/efcore/labels/area-query","name":"area-query","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/185","html_url":"https://github.com/dotnet/efcore/milestone/185","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/185/labels","id":10179429,"node_id":"MI_kwDOAPaMMs4Am1Nl","number":185,"title":"8.0.1","description":null,"creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":9,"state":"closed","created_at":"2023-11-13T14:02:14Z","updated_at":"2024-04-09T08:40:08Z","due_on":null,"closed_at":"2024-04-09T08:40:08Z"},"comments":6,"created_at":"2023-11-02T10:24:56Z","updated_at":"2025-06-15T19:53:37Z","closed_at":"2023-11-13T14:02:42Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am running GIT test `QueryBugsTest.Nested_contains_with_enum`. The test is executing following LINQ-\r\n```C#\r\nvar query = context.Todos\r\n    .Where(x => keys.Contains(todoTypes.Contains(x.Type) ? key : key))\r\n    .ToList();\r\n```\r\n\r\nThe test was working fine with Oracle EFCore 7 provider. However it seems there is some regression issue introduced from the relational layer in EFCore 8 daily label, due to which the test is failing.\r\n\r\nHere is my observation.\r\n\t\r\nSqlServer EFCore 7 provider used to generate following query for it-\r\n```\r\nSELECT [t].[Id], [t].[Type]\r\nFROM [Todos] AS [t]\r\nWHERE CASE\r\n    WHEN [t].[Type] = 0 THEN @__key_2\r\n    ELSE @__key_2\r\nEND IN ('0a47bcb7-a1cb-4345-8944-c58f82d6aac7', '5f221fb9-66f4-442a-92c9-d97ed5989cc7')\r\n```\r\n\r\nHowever in EFCore 8 provider, the query has been changed to-\r\n```\r\nSELECT [t].[Id], [t].[Type]\r\nFROM [Todos] AS [t]\r\nWHERE CASE\r\n    WHEN [t].[Type] = 0 THEN @__key_2\r\n    ELSE @__key_2\r\nEND IN (\r\n    SELECT [k].[value]\r\n    FROM OPENJSON(@__keys_0) WITH ([value] uniqueidentifier '$') AS [k]\r\n)\r\n```\r\n\r\nFor the database providers which don't support OPENJSON or similar functionality, they may want to keep on generating the query which was getting generated with EFCore 7 provider.\r\n\r\nFor Ex:- Oracle EFCore 7 provider generates following query for the test-\r\n```\r\nSELECT \"t\".\"Id\", \"t\".\"Type\"\r\nFROM \"Todos\" \"t\"\r\nWHERE CASE\r\n    WHEN \"t\".\"Type\" = 0 THEN :key_2\r\n    ELSE :key_2\r\nEND IN ('B7BC470ACBA145438944C58F82D6AAC7', 'B91F225FF4662A4492C9D97ED5989CC7')\r\n```\r\n\r\nHowever in EFCore 8 the query has been changed to-\r\n```\r\nSELECT \"t\".\"Id\", \"t\".\"Type\"\r\nFROM \"Todos\" \"t\"\r\nWHERE CASE\r\nWHEN \"t\".\"Type\" IN ( ) THEN :key_2\r\nELSE :key_2\r\nEND IN ('B7BC470ACBA145438944C58F82D6AAC7', 'B91F225FF4662A4492C9D97ED5989CC7')\r\n```\r\n\r\nWhile debugging the relational layer code (Method `SqlNullabilityProcessor.VisitIn`) . It seems EFCore 7 used to convert certain `InExpression `to `SqlBinaryExpression`.\r\nFor Ex:- There will be two `InExpression `for the above LINQ but the inner one will be converted to `SqlBinaryExpression `and the provider will generate `[t].[Type] = 0` corresponding to the `SqlBinaryExpression`.\r\nHowever in EFCore 8 provider, the converted `SqlBinaryExpression `isn't used to generate the SQL **if `InExpression.SubQuery` is null**.\r\n\r\nIs this expected? If yes, then `InExpression.Value` field shouldn't be null (which is the case as of now). The `InExpression` which is used to generate SQL `\"t\".\"Type\" IN ( )` has null value.\r\n\r\nThis seems to be an issue from the relational layer. Please could someone clarify.","closed_by":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/32208/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/32208/timeline","performed_via_github_app":null,"state_reason":"completed"}