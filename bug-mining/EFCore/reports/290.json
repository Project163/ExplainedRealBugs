{"url":"https://api.github.com/repos/dotnet/efcore/issues/30478","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/30478/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/30478/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/30478/events","html_url":"https://github.com/dotnet/efcore/issues/30478","id":1623657181,"node_id":"I_kwDOAPaMMs5gxwrd","number":30478,"title":"TemporalAll fails with JSON columns","user":{"login":"pekspro","id":3163293,"node_id":"MDQ6VXNlcjMxNjMyOTM=","avatar_url":"https://avatars.githubusercontent.com/u/3163293?v=4","gravatar_id":"","url":"https://api.github.com/users/pekspro","html_url":"https://github.com/pekspro","followers_url":"https://api.github.com/users/pekspro/followers","following_url":"https://api.github.com/users/pekspro/following{/other_user}","gists_url":"https://api.github.com/users/pekspro/gists{/gist_id}","starred_url":"https://api.github.com/users/pekspro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pekspro/subscriptions","organizations_url":"https://api.github.com/users/pekspro/orgs","repos_url":"https://api.github.com/users/pekspro/repos","events_url":"https://api.github.com/users/pekspro/events{/privacy}","received_events_url":"https://api.github.com/users/pekspro/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1675384372,"node_id":"MDU6TGFiZWwxNjc1Mzg0Mzcy","url":"https://api.github.com/repos/dotnet/efcore/labels/area-query","name":"area-query","color":"32b37b","default":false,"description":""},{"id":4373235881,"node_id":"LA_kwDOAPaMMs8AAAABBKpIqQ","url":"https://api.github.com/repos/dotnet/efcore/labels/area-json","name":"area-json","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/152","html_url":"https://github.com/dotnet/efcore/milestone/152","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/152/labels","id":8392036,"node_id":"MI_kwDOAPaMMs4AgA1k","number":152,"title":"8.0.0","description":"EF Core 8.0","creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":280,"state":"closed","created_at":"2022-09-07T19:55:36Z","updated_at":"2025-04-07T08:59:46Z","due_on":null,"closed_at":"2023-11-14T14:00:33Z"},"comments":2,"created_at":"2023-03-14T14:57:00Z","updated_at":"2025-06-15T19:00:37Z","closed_at":"2023-10-10T21:32:32Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"If you have a JSON column in a temporal table and calls `TemporalAll()`, an `System.InvalidOperationException` is thrown with the message:\r\n\r\n     Temporal query is trying to use navigation to an entity 'BlogDetails' which itself \r\n     doesn't map to temporal table. Either map the entity to temporal table or use \r\n     join manually to access it.\r\n\r\nThis is very similar to https://github.com/dotnet/efcore/issues/29156.\r\n\r\n### Full sample\r\n\r\n```C#\r\nusing Microsoft.EntityFrameworkCore;\r\n\r\nusing (var db = new BloggingContext())\r\n{\r\n    await db.Database.EnsureDeletedAsync();\r\n    await db.Database.EnsureCreatedAsync();\r\n\r\n    var blog = new Blog { Url = \"http://example.com\", Details = new BlogDetails() { Title = \"Title\" } };\r\n    db.Add(blog);\r\n    db.SaveChanges();\r\n\r\n    var blogs = db.Blogs.ToList();\r\n\r\n    // This thwrows: System.InvalidOperationException:\r\n    // Temporal query is trying to use navigation to an entity 'BlogDetails' which itself doesn't map to\r\n    // temporal table. Either map the entity to temporal table or use join manually to access it.\r\n    var blogsHistory = db.Blogs.TemporalAll().ToList();\r\n}\r\n\r\npublic class BloggingContext : DbContext\r\n{\r\n    public DbSet<Blog> Blogs { get; set; }\r\n    \r\n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\r\n    {\r\n        optionsBuilder\r\n            .UseSqlServer(\"Server=(localdb)\\\\mssqllocaldb;Database=ABlogDatabase;Trusted_Connection=True;\")\r\n            .LogTo(Console.WriteLine, new[] { DbLoggerCategory.Database.Command.Name, DbLoggerCategory.Database.Transaction.Name })\r\n            ;\r\n    }\r\n\r\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\r\n    {\r\n        base.OnModelCreating(modelBuilder);\r\n\r\n        modelBuilder\r\n            .Entity<Blog>(entity =>\r\n            {\r\n                entity.ToTable(\"Blog\", b => b.IsTemporal());\r\n\r\n                entity.OwnsOne(e => e.Details, ownedNavigationBuilder =>\r\n                {\r\n                    ownedNavigationBuilder.ToJson();\r\n                });\r\n            });\r\n    }\r\n}\r\n\r\npublic class Blog\r\n{\r\n    public int BlogId { get; set; }\r\n    public required string Url { get; set; }\r\n    public BlogDetails Details { get; set; } = null!;\r\n}\r\n\r\npublic class BlogDetails\r\n{\r\n    public string Title { get; set; } = null!;\r\n}\r\n```\r\n\r\n### Include provider and version information\r\n\r\nEF Core version: 7.0.4\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework:  .NET 7.0\r\nOperating system: Windows 11\r\nIDE: Visual Studio 2022 17.5\r\n","closed_by":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30478/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/30478/timeline","performed_via_github_app":null,"state_reason":"completed"}