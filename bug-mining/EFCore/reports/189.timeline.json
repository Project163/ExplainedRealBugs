[{"id":8647941281,"node_id":"LE_lADOAPaMMs5fwjz-zwAAAAIDdRyh","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8647941281","actor":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-03-02T10:46:53Z","label":{"name":"customer-reported","color":"a4a5f9"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1451672533","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1451672533","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1451672533,"node_id":"IC_kwDOAPaMMs5WhsPV","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-02T10:53:02Z","updated_at":"2023-03-02T10:53:02Z","body":"Your code doesn't throw an exception for me, see below for a minimal, runnable console program where I've pasted your code, and which works.\r\n\r\nNote also that combinedExpr isn't actually used in your query and can be removed (maybe you've posted the wrong thing?).\r\n\r\n<details>\r\n<summary>Attempted repro</summary>\r\n\r\n```c#\r\nawait using var ctx = new BlogContext();\r\nawait ctx.Database.EnsureDeletedAsync();\r\nawait ctx.Database.EnsureCreatedAsync();\r\n\r\nExpression<Func<Tenant, bool>> condition1 = t => t.Name == \"A\";\r\nExpression<Func<Tenant, bool>> condition2 = t => t.Name == \"B\";\r\n\r\nvar parameterExpr = Expression.Parameter(typeof(Tenant), \"t\");\r\nvar combinedExpr = Expression.OrElse(\r\n    Expression.Invoke(condition1, parameterExpr),\r\n    Expression.Invoke(condition2, parameterExpr)\r\n);\r\n\r\nExpression<Func<Tenant, bool>> combinedCondition = Expression.Lambda<Func<Tenant, bool>>(\r\n    Expression.OrElse(\r\n        Expression.Invoke(condition1, condition2.Parameters),\r\n        Expression.Invoke(condition2, condition2.Parameters)\r\n    ),\r\n    condition2.Parameters\r\n);\r\n\r\nvar query = ctx.Tenants.Where(combinedCondition);\r\n\r\nConsole.WriteLine(query.ToQueryString());\r\n// var result = query.ToList();\r\n\r\npublic class BlogContext : DbContext\r\n{\r\n    public DbSet<Tenant> Tenants { get; set; }\r\n\r\n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\r\n        => optionsBuilder\r\n            .UseSqlServer(@\"Server=localhost;Database=test;User=SA;Password=Abcd5678;Connect Timeout=60;ConnectRetryCount=0;Encrypt=false\")\r\n            //.UseSqlite(\"Filename=:memory:\")\r\n            // .UseNpgsql(@\"Host=localhost;Username=test;Password=test\")\r\n            .LogTo(Console.WriteLine, LogLevel.Information)\r\n            .EnableSensitiveDataLogging();\r\n\r\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\r\n    {\r\n    }\r\n}\r\n\r\npublic class Tenant\r\n{\r\n    public int Id { get; set; }\r\n    public string? Name { get; set; }\r\n}\r\n```\r\n\r\n</details>","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1451672533/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1453243972","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1453243972","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1453243972,"node_id":"IC_kwDOAPaMMs5Wnr5E","user":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T09:40:53Z","updated_at":"2023-03-03T09:43:33Z","body":"1. Exception occurs during query execution if I `call query.ToQueryString()` before `query.ToList()`\r\n\r\nhttps://user-images.githubusercontent.com/21305997/222685653-508bcb3b-7325-4db8-9118-b44edf51784f.mp4\r\n\r\n\r\n\r\n\r\n2. If I remove (comment) `query.ToQueryString()`, the query succeeds\r\n\r\n\r\nhttps://user-images.githubusercontent.com/21305997/222685913-124f5158-82cd-4725-84ef-fb5880f18696.mp4\r\n\r\n\r\n\r\n\r\n3. Exception occurs during `query.ToQueryString()` call if I call `query.ToQueryString()` after the query executed\r\n\r\n\r\nhttps://user-images.githubusercontent.com/21305997/222685989-c973c489-5f1c-47e3-bb11-083a457f29d5.mp4\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1453243972/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1453256157","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1453256157","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1453256157,"node_id":"IC_kwDOAPaMMs5Wnu3d","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T09:50:10Z","updated_at":"2023-03-03T09:50:10Z","body":"@verdysh can you please submit a minimal code sample - like the one I wrote in the comment above? Videos aren't very helpful, I can't copy-paste from them etc.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1453256157/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8658073037,"node_id":"MEE_lADOAPaMMs5fwjz-zwAAAAIED7XN","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8658073037","actor":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-03-03T09:50:10Z","performed_via_github_app":null},{"id":8658073055,"node_id":"SE_lADOAPaMMs5fwjz-zwAAAAIED7Xf","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8658073055","actor":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-03-03T09:50:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1453297165","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1453297165","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1453297165,"node_id":"IC_kwDOAPaMMs5Wn44N","user":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T10:20:53Z","updated_at":"2023-03-03T10:21:56Z","body":"This is almost exactly your code. The only difference is that in your example you don't call query execution (like `query.ToList()`). Try this code (based on yours):\r\n\r\n```\r\nawait using var ctx = new BlogContext();\r\nawait ctx.Database.EnsureDeletedAsync();\r\nawait ctx.Database.EnsureCreatedAsync();\r\n\r\nExpression<Func<Tenant, bool>> condition1 = t => t.Name == \"A\";\r\nExpression<Func<Tenant, bool>> condition2 = t => t.Name == \"B\";\r\n\r\nvar parameterExpr = Expression.Parameter(typeof(Tenant), \"t\");\r\nvar combinedExpr = Expression.OrElse(\r\n    Expression.Invoke(condition1, parameterExpr),\r\n    Expression.Invoke(condition2, parameterExpr)\r\n);\r\n\r\nExpression<Func<Tenant, bool>> combinedCondition = Expression.Lambda<Func<Tenant, bool>>(\r\n    Expression.OrElse(\r\n        Expression.Invoke(condition1, condition2.Parameters),\r\n        Expression.Invoke(condition2, condition2.Parameters)\r\n    ),\r\n    condition2.Parameters\r\n);\r\n\r\nvar query = ctx.Tenants.Where(combinedCondition);\r\n\r\nvar result = query.ToList(); // added this line\r\n\r\nConsole.WriteLine(query.ToQueryString());\r\n\r\n```\r\n\r\nAnd this\r\n\r\n```\r\nawait using var ctx = new BlogContext();\r\nawait ctx.Database.EnsureDeletedAsync();\r\nawait ctx.Database.EnsureCreatedAsync();\r\n\r\nExpression<Func<Tenant, bool>> condition1 = t => t.Name == \"A\";\r\nExpression<Func<Tenant, bool>> condition2 = t => t.Name == \"B\";\r\n\r\nvar parameterExpr = Expression.Parameter(typeof(Tenant), \"t\");\r\nvar combinedExpr = Expression.OrElse(\r\n    Expression.Invoke(condition1, parameterExpr),\r\n    Expression.Invoke(condition2, parameterExpr)\r\n);\r\n\r\nExpression<Func<Tenant, bool>> combinedCondition = Expression.Lambda<Func<Tenant, bool>>(\r\n    Expression.OrElse(\r\n        Expression.Invoke(condition1, condition2.Parameters),\r\n        Expression.Invoke(condition2, condition2.Parameters)\r\n    ),\r\n    condition2.Parameters\r\n);\r\n\r\nvar query = ctx.Tenants.Where(combinedCondition);\r\n\r\nConsole.WriteLine(query.ToQueryString());\r\n\r\nvar result = query.ToList(); // added this line\r\n\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1453297165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1455961003","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1455961003","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1455961003,"node_id":"IC_kwDOAPaMMs5WyDOr","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T11:27:51Z","updated_at":"2023-03-06T11:28:33Z","body":"Note for triage: query expression looks like this:\r\n\r\n```\r\nDbSet<Tenant>()\r\n    .Where(t => Invoke(t => t.Name == \"A\", t) || Invoke(t => t.Name == \"B\", t))\r\n```\r\n\r\nWhereas if the query is built in the normal way, then it looks like this:\r\n\r\n```\r\nDbSet<Tenant>()\r\n    .Where(t => t.Name == \"A\" || t.Name == \"B\")\r\n```\r\n\r\nSo it looks like the first case is not handled appropriately in the query cache.\r\n\r\nRepro:\r\n\r\n```C#\r\nawait using var ctx = new BlogContext();\r\nawait ctx.Database.EnsureDeletedAsync();\r\nawait ctx.Database.EnsureCreatedAsync();\r\n\r\nExpression<Func<Tenant, bool>> condition1 = t => t.Name == \"A\";\r\nExpression<Func<Tenant, bool>> condition2 = t => t.Name == \"B\";\r\n\r\nExpression<Func<Tenant, bool>> combinedCondition = Expression.Lambda<Func<Tenant, bool>>(\r\n    Expression.OrElse(\r\n        Expression.Invoke(condition1, condition2.Parameters),\r\n        Expression.Invoke(condition2, condition2.Parameters)\r\n    ),\r\n    condition2.Parameters\r\n);\r\n\r\nvar query = ctx.Tenants.Where(combinedCondition);\r\n\r\n//var query = ctx.Tenants.Where(t => t.Name == \"A\" || t.Name == \"B\");\r\n\r\nvar result1 = query.ToList();\r\nvar result2 = query.ToList();\r\n\r\npublic class BlogContext : DbContext\r\n{\r\n    public DbSet<Tenant> Tenants { get; set; }\r\n\r\n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\r\n        => optionsBuilder\r\n            .UseSqlServer(@\"Data Source=(LocalDb)\\MSSQLLocalDB;Database=AllTogetherNow\")\r\n            .LogTo(Console.WriteLine, LogLevel.Information)\r\n            .EnableSensitiveDataLogging();\r\n}\r\n\r\npublic class Tenant\r\n{\r\n    public int Id { get; set; }\r\n    public string? Name { get; set; }\r\n}\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nwarn: 3/6/2023 11:27:05.970 CoreEventId.SensitiveDataLoggingEnabledWarning[10400] (Microsoft.EntityFrameworkCore.Infrastructure)\r\n      Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.\r\ninfo: 3/6/2023 11:27:06.401 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Executed DbCommand (30ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\n      SELECT 1\r\ninfo: 3/6/2023 11:27:06.453 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Executed DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='60']\r\n      IF SERVERPROPERTY('EngineEdition') <> 5\r\n      BEGIN\r\n          ALTER DATABASE [AllTogetherNow] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;\r\n      END;\r\ninfo: 3/6/2023 11:27:06.464 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Executed DbCommand (10ms) [Parameters=[], CommandType='Text', CommandTimeout='60']\r\n      DROP DATABASE [AllTogetherNow];\r\ninfo: 3/6/2023 11:27:06.614 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Executed DbCommand (123ms) [Parameters=[], CommandType='Text', CommandTimeout='60']\r\n      CREATE DATABASE [AllTogetherNow];\r\ninfo: 3/6/2023 11:27:06.646 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Executed DbCommand (32ms) [Parameters=[], CommandType='Text', CommandTimeout='60']\r\n      IF SERVERPROPERTY('EngineEdition') <> 5\r\n      BEGIN\r\n          ALTER DATABASE [AllTogetherNow] SET READ_COMMITTED_SNAPSHOT ON;\r\n      END;\r\ninfo: 3/6/2023 11:27:06.650 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Executed DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\n      SELECT 1\r\ninfo: 3/6/2023 11:27:06.736 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Executed DbCommand (5ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\n      CREATE TABLE [Tenants] (\r\n          [Id] int NOT NULL IDENTITY,\r\n          [Name] nvarchar(max) NULL,\r\n          CONSTRAINT [PK_Tenants] PRIMARY KEY ([Id])\r\n      );\r\ninfo: 3/6/2023 11:27:07.028 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)\r\n      Executed DbCommand (6ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\n      SELECT [t].[Id], [t].[Name]\r\n      FROM [Tenants] AS [t]\r\n      WHERE [t].[Name] IN (N'A', N'B')\r\nUnhandled exception. System.ArgumentException: An item with the same key has already been added. Key: t\r\n   at System.Collections.Generic.Dictionary`2.TryInsert(TKey key, TValue value, InsertionBehavior behavior)\r\n   at System.Collections.Generic.Dictionary`2.Add(TKey key, TValue value)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.CompareLambda(LambdaExpression a, LambdaExpression b)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.Compare(Expression left, Expression right)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.CompareInvocation(InvocationExpression a, InvocationExpression b)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.Compare(Expression left, Expression right)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.CompareBinary(BinaryExpression a, BinaryExpression b)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.Compare(Expression left, Expression right)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.CompareLambda(LambdaExpression a, LambdaExpression b)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.Compare(Expression left, Expression right)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.CompareUnary(UnaryExpression a, UnaryExpression b)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.Compare(Expression left, Expression right)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.CompareExpressionList(IReadOnlyList`1 a, IReadOnlyList`1 b)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.CompareMethodCall(MethodCallExpression a, MethodCallExpression b)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.ExpressionComparer.Compare(Expression left, Expression right)\r\n   at Microsoft.EntityFrameworkCore.Query.ExpressionEqualityComparer.Equals(Expression x, Expression y)\r\n   at Microsoft.EntityFrameworkCore.Query.CompiledQueryCacheKeyGenerator.CompiledQueryCacheKey.Equals(CompiledQueryCacheKey other)\r\n   at Microsoft.EntityFrameworkCore.Query.RelationalCompiledQueryCacheKeyGenerator.RelationalCompiledQueryCacheKey.Equals(RelationalCompiledQueryCacheKey other)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerCompiledQueryCacheKeyGenerator.SqlServerCompiledQueryCacheKey.Equals(SqlServerCompiledQueryCacheKey other)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerCompiledQueryCacheKeyGenerator.SqlServerCompiledQueryCacheKey.Equals(Object obj)\r\n   at System.Collections.Concurrent.ConcurrentDictionary`2.TryGetValue(TKey key, TValue& value)\r\n   at Microsoft.Extensions.Caching.Memory.MemoryCache.TryGetValue(Object key, Object& result)\r\n   at Microsoft.Extensions.Caching.Memory.CacheExtensions.TryGetValue[TItem](IMemoryCache cache, Object key, TItem& value)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.CompiledQueryCache.GetOrAddQuery[TResult](Object cacheKey, Func`1 compiler)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.Execute[TResult](Expression query)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.Execute[TResult](Expression expression)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryable`1.GetEnumerator()\r\n   at System.Collections.Generic.List`1..ctor(IEnumerable`1 collection)\r\n   at System.Linq.Enumerable.ToList[TSource](IEnumerable`1 source)\r\n   at Program.<Main>$(String[] args) in C:\\local\\code\\AllTogetherNow\\Daily\\Daily.cs:line 27\r\n   at Program.<Main>$(String[] args) in C:\\local\\code\\AllTogetherNow\\Daily\\Daily.cs:line 27\r\n   at Program.<Main>(String[] args)\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1455961003/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1455977506","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1455977506","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1455977506,"node_id":"IC_kwDOAPaMMs5WyHQi","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T11:40:53Z","updated_at":"2023-03-06T11:40:53Z","body":"Will take a look","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1455977506/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1455988162","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1455988162","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1455988162,"node_id":"IC_kwDOAPaMMs5WyJ3C","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T11:47:29Z","updated_at":"2023-03-06T11:47:29Z","body":"The problem is in the expression tree: the parameters for `condition2` are also being used as the parameters for `combinedCondition` which contains it. Using the same ParameterExpression instance as a parameter to multiple lambdas in the expression tree is not supported, and the C# compiler doesn't ever produce such a tree AFAIK.\r\n\r\nTo make this work, simply define a new ParameterExpression for `combinedCondition`, as follows:\r\n\r\n```c#\r\nExpression<Func<Tenant, bool>> condition1 = t => t.Name == \"A\";\r\nExpression<Func<Tenant, bool>> condition2 = t => t.Name == \"B\";\r\n\r\nvar param = Expression.Parameter(typeof(Tenant), \"t\");\r\nExpression<Func<Tenant, bool>> combinedCondition = Expression.Lambda<Func<Tenant, bool>>(\r\n    Expression.OrElse(\r\n        Expression.Invoke(condition1, param),\r\n        Expression.Invoke(condition2, param)),\r\n    param);\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1455988162/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1456794882","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1456794882","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1456794882,"node_id":"IC_kwDOAPaMMs5W1O0C","user":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T19:10:03Z","updated_at":"2023-03-06T19:10:03Z","body":"@ajcvickers thanks for your answer!\r\n\r\n@roji it works, thanks!\r\nBut anyway it looks like a bug to me. Maybe a minor bug, but nevertheless.\r\nI think it should either throw an exception in all cases (no matter whether you call `query.ToList()`, some similar method that results in query execution, `query.ToQueryString()`, etc.) or it shouldn't throw an exception in all cases. Second option is preferable ðŸ˜‰","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1456794882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8677878630,"node_id":"MEE_lADOAPaMMs5fwjz-zwAAAAIFPetm","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8677878630","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-03-06T19:10:03Z","performed_via_github_app":null},{"id":8677878659,"node_id":"SE_lADOAPaMMs5fwjz-zwAAAAIFPeuD","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8677878659","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-03-06T19:10:03Z","performed_via_github_app":null},{"id":8677878687,"node_id":"MEE_lADOAPaMMs5fwjz-zwAAAAIFPeuf","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8677878687","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-03-06T19:10:04Z","performed_via_github_app":null},{"id":8677878711,"node_id":"SE_lADOAPaMMs5fwjz-zwAAAAIFPeu3","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8677878711","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-03-06T19:10:04Z","performed_via_github_app":null},{"actor":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T19:57:12Z","updated_at":"2023-03-06T19:57:12Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30396","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/30396/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/30396/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/30396/events","html_url":"https://github.com/dotnet/efcore/issues/30396","id":1608626270,"node_id":"I_kwDOAPaMMs5f4bBe","number":30396,"title":"\"System.ArgumentException : An item with the same key has already been added. Key: Param_0\" - when I try to run query second and subsequent times","user":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2023-03-03T13:22:21Z","updated_at":"2025-06-16T09:00:32Z","closed_at":"2023-03-09T06:51:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"EF Core version: 6.0.5\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework: .NET 6.0\r\n\r\nI have some complex query which is built kind of dynamically. I will not post all the code now, because it's a lot of code and there can be some sensitive information which should be cleaned before publishing. But here is a peace of the query which I hope gives you an idea what is going on:\r\n\r\n```\r\nvar query =\r\n\tdb.Files.Where(CreateFileExpressions(request, tenantId))\r\n\t// there are some more calls of SelectMany which contains similar Where statement into which expressions generated by some other methods pass\r\n;\r\n```\r\n\r\nAn example of CreateFileExpressions method:\r\n\r\n```\r\nprivate Expression<Func<File, bool>> CreateFileExpressions(GetFilesRequestDto? request, int tenantId)\r\n{\r\n\tvar paramExpr = Expression.Parameter(typeof(File));\r\n\r\n\tExpression<Func<File, bool>> expression = f => f.TenantId == tenantId;\r\n\r\n\tif (request is not null && request.Extensions is not null && request.Extensions.Values.Any())\r\n\t{\r\n\t\tExpression<Func<File, bool>> extensionsCondition = request.Extensions.Action == FilterValuesAction.Include ?\r\n\t\t\tf => request.Extensions.Values.Contains(f.Extension) :\r\n\t\t\tf => !request.Extensions.Values.Contains(f.Extension)\r\n\t\t;\r\n\r\n\t\texpression = Expression.Lambda<Func<File, bool>>(\r\n\t\t\tExpression.AndAlso(\r\n\t\t\t\tExpression.Invoke(expression, paramExpr),\r\n\t\t\t\tExpression.Invoke(extensionsCondition, paramExpr)\r\n\t\t\t),\r\n\t\t\tparamExpr\r\n\t\t);\r\n\t}\r\n\r\n\t// another similar if statement\r\n\r\n\treturn expression;\r\n}\r\n```\r\n\r\nGetFilesRequestDto:\r\n\r\n```\r\npublic class GetFilesRequestDto\r\n{\r\n\tpublic Filter<string>? Extensions { get; set; }\r\n\t// ...\r\n}\r\n\r\npublic class Filter<T>\r\n{\r\n\tpublic List<T> Values { get; set; }\r\n\tpublic FilterValuesAction Action { get; set; }\r\n}\r\n\r\npublic enum FilterValuesAction\r\n{\r\n\tInclude = 1,\r\n\tExclude = 2,\r\n}\r\n```\r\n\r\nThe problem is the next. When I execute this query first time, all is okay. But if I call this query a second and subsequent times, I get an exception:\r\n\r\n`System.ArgumentException : An item with the same key has already been added. Key: Param_0`\r\n\r\nIf I restart the application, I can execute this query only once again. This issue reproduces also if I make the query on the different instances of DbContext.\r\n\r\nIt looks like there is some cache inside EF or something like that. I've investigated a little bit and found information that there is a queries cache which can cause a similar issue. But they say that this cache is for DbContext instance, but I reproduce the issue on different DbContext instances.\r\n\r\nI found an advice to try the next:\r\n\r\n```\r\nvar cacheKey = new object();\r\n\r\nvar query = dbContext.MyEntities\r\n    .Where(e => e.SomeProperty == someValue)\r\n    .WithCompiledQueryCacheKey(cacheKey);\r\n```\r\n\t\r\nBut there is no `WithCompiledQueryCacheKey` method in my version of EF, maybe it is something what had been deleted since some version, I don't know.\r\n\r\nI would appreciate any advice how to fix that. If I should give more information, tell me please and I will try to give it.","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30396/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/30396/timeline","performed_via_github_app":null,"state_reason":"duplicate"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1457056705","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1457056705","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1457056705,"node_id":"IC_kwDOAPaMMs5W2OvB","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T21:51:22Z","updated_at":"2023-03-06T21:51:22Z","body":"We generally don't make an attempt to verify expression trees. Any tree constructed by the compiler should work; if you're dynamically constructing trees via the Expression APIs, that's considered advanced usage and it's your responsibility to produce a compiler-conforming tree.\r\n\r\nAdding validation here would introduce overhead that would slow everyone down, including the vast majority of users who don't ever construct dynamic queries in this way.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1457056705/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8679158054,"node_id":"LE_lADOAPaMMs5fwjz-zwAAAAIFUXEm","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8679158054","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-03-06T21:51:30Z","label":{"name":"closed-no-further-action","color":"777777"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1457694396","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1457694396","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1457694396,"node_id":"IC_kwDOAPaMMs5W4qa8","user":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-07T07:39:33Z","updated_at":"2023-03-07T07:39:33Z","body":"What if to add some specific method special for this `VerifyExpression()` which doesn't affect anything else? I understand this is not important for most of users but to have such method would be nice.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1457694396/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"verdysh","id":21305997,"node_id":"MDQ6VXNlcjIxMzA1OTk3","avatar_url":"https://avatars.githubusercontent.com/u/21305997?v=4","gravatar_id":"","url":"https://api.github.com/users/verdysh","html_url":"https://github.com/verdysh","followers_url":"https://api.github.com/users/verdysh/followers","following_url":"https://api.github.com/users/verdysh/following{/other_user}","gists_url":"https://api.github.com/users/verdysh/gists{/gist_id}","starred_url":"https://api.github.com/users/verdysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verdysh/subscriptions","organizations_url":"https://api.github.com/users/verdysh/orgs","repos_url":"https://api.github.com/users/verdysh/repos","events_url":"https://api.github.com/users/verdysh/events{/privacy}","received_events_url":"https://api.github.com/users/verdysh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8683855198,"node_id":"REFE_lADOAPaMMs5fwjz-zwAAAAIFmR1e","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8683855198","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5767603a0c644ce1ef75a0448c786044a047131d","commit_url":"https://api.github.com/repos/roji/efcore/commits/5767603a0c644ce1ef75a0448c786044a047131d","created_at":"2023-03-07T10:02:47Z","performed_via_github_app":null},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-07T10:03:28Z","updated_at":"2023-03-07T10:03:28Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30427","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/30427/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/30427/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/30427/events","html_url":"https://github.com/dotnet/efcore/pull/30427","id":1613103422,"node_id":"PR_kwDOAPaMMs5LdQFp","number":30427,"title":"Better exception when same parameter instance is reused in multiple lambdas","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-03-07T10:03:28Z","updated_at":"2023-03-08T08:01:39Z","closed_at":"2023-03-08T00:35:05Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dotnet/efcore/pulls/30427","html_url":"https://github.com/dotnet/efcore/pull/30427","diff_url":"https://github.com/dotnet/efcore/pull/30427.diff","patch_url":"https://github.com/dotnet/efcore/pull/30427.patch","merged_at":"2023-03-08T00:35:05Z"},"body":"Closes #30383\r\n\r\n","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/30427/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/30427/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1457888145","html_url":"https://github.com/dotnet/efcore/issues/30383#issuecomment-1457888145","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/30383","id":1457888145,"node_id":"IC_kwDOAPaMMs5W5ZuR","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-07T10:03:45Z","updated_at":"2023-03-07T10:03:45Z","body":"I don't think that would be valuable for most users. It's true that ideally this would throw on the first attempt to execute a bad query tree, but in practice everyone will get the exception quite quickly and would know that something is wrong. If we did introduce a `VerifyExpression()`, nobody would know about it (discoverability) until after seeing the error anyway, so that would be too late.\r\n\r\nI do agree that the exception message should be improved to point users in the right direction - submitted #30427 to improve this.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1457888145/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8683866091,"node_id":"UNLE_lADOAPaMMs5fwjz-zwAAAAIFmUfr","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8683866091","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2023-03-07T10:03:53Z","label":{"name":"closed-no-further-action","color":"777777"},"performed_via_github_app":null},{"id":8683866108,"node_id":"LE_lADOAPaMMs5fwjz-zwAAAAIFmUf8","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8683866108","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-03-07T10:03:53Z","label":{"name":"closed-fixed","color":"777777"},"performed_via_github_app":null},{"id":8683866328,"node_id":"AE_lADOAPaMMs5fwjz-zwAAAAIFmUjY","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8683866328","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2023-03-07T10:03:55Z","assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":8683866822,"node_id":"MIE_lADOAPaMMs5fwjz-zwAAAAIFmUrG","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8683866822","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2023-03-07T10:03:57Z","milestone":{"title":"8.0.0"},"performed_via_github_app":null},{"id":8683871674,"node_id":"RTE_lADOAPaMMs5fwjz-zwAAAAIFmV26","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8683871674","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2023-03-07T10:04:26Z","rename":{"from":"System.ArgumentException is thrown when I try to call query.ToQueryString()","to":"Cryptic exception when accidentally reusing the same parameter instance in dynamically-constructed query"},"performed_via_github_app":null},{"id":8691804732,"node_id":"CE_lADOAPaMMs5fwjz-zwAAAAIGEmo8","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8691804732","actor":null,"event":"closed","commit_id":null,"commit_url":null,"created_at":"2023-03-08T00:35:06Z","state_reason":null,"performed_via_github_app":null},{"id":8691804756,"node_id":"REFE_lADOAPaMMs5fwjz-zwAAAAIGEmpU","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8691804756","actor":null,"event":"referenced","commit_id":"779babb4c257e28ca1b5995c8dc9f19dd44fdba0","commit_url":"https://api.github.com/repos/dotnet/efcore/commits/779babb4c257e28ca1b5995c8dc9f19dd44fdba0","created_at":"2023-03-08T00:35:07Z","performed_via_github_app":null},{"id":8730797188,"node_id":"DEME_lADOAPaMMs5fwjz-zwAAAAIIZWSE","url":"https://api.github.com/repos/dotnet/efcore/issues/events/8730797188","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"demilestoned","commit_id":null,"commit_url":null,"created_at":"2023-03-13T11:52:20Z","milestone":{"title":"8.0.0"},"performed_via_github_app":null}]