{"url":"https://api.github.com/repos/dotnet/efcore/issues/29531","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/29531/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/29531/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/29531/events","html_url":"https://github.com/dotnet/efcore/issues/29531","id":1444406056,"node_id":"I_kwDOAPaMMs5WF-Mo","number":29531,"title":"6.0.11 to 7.0.0: [...] are both mapped to column [..] but are configured to use differing provider types ('double' and 'double?').'","user":{"login":"Dunge","id":6548184,"node_id":"MDQ6VXNlcjY1NDgxODQ=","avatar_url":"https://avatars.githubusercontent.com/u/6548184?v=4","gravatar_id":"","url":"https://api.github.com/users/Dunge","html_url":"https://github.com/Dunge","followers_url":"https://api.github.com/users/Dunge/followers","following_url":"https://api.github.com/users/Dunge/following{/other_user}","gists_url":"https://api.github.com/users/Dunge/gists{/gist_id}","starred_url":"https://api.github.com/users/Dunge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Dunge/subscriptions","organizations_url":"https://api.github.com/users/Dunge/orgs","repos_url":"https://api.github.com/users/Dunge/repos","events_url":"https://api.github.com/users/Dunge/events{/privacy}","received_events_url":"https://api.github.com/users/Dunge/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1900941630,"node_id":"MDU6TGFiZWwxOTAwOTQxNjMw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-model-building","name":"area-model-building","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/158","html_url":"https://github.com/dotnet/efcore/milestone/158","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/158/labels","id":8728724,"node_id":"MI_kwDOAPaMMs4AhTCU","number":158,"title":"7.0.3","description":null,"creator":{"login":"rbhanda","id":30737530,"node_id":"MDQ6VXNlcjMwNzM3NTMw","avatar_url":"https://avatars.githubusercontent.com/u/30737530?v=4","gravatar_id":"","url":"https://api.github.com/users/rbhanda","html_url":"https://github.com/rbhanda","followers_url":"https://api.github.com/users/rbhanda/followers","following_url":"https://api.github.com/users/rbhanda/following{/other_user}","gists_url":"https://api.github.com/users/rbhanda/gists{/gist_id}","starred_url":"https://api.github.com/users/rbhanda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rbhanda/subscriptions","organizations_url":"https://api.github.com/users/rbhanda/orgs","repos_url":"https://api.github.com/users/rbhanda/repos","events_url":"https://api.github.com/users/rbhanda/events{/privacy}","received_events_url":"https://api.github.com/users/rbhanda/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":46,"state":"closed","created_at":"2022-12-06T18:26:17Z","updated_at":"2023-02-21T20:44:42Z","due_on":null,"closed_at":"2023-02-15T01:31:11Z"},"comments":3,"created_at":"2022-11-10T18:52:59Z","updated_at":"2025-06-15T18:55:15Z","closed_at":"2022-12-05T22:38:24Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Include your code\r\n\r\nWhen updating Microsoft.EntityFrameworkCore.SqlServer from 6.0.11 to 7.0.0 I receive a new error. I checked the breaking changes and full release notes and I can't see anything that should impact this.\r\n\r\nI have four entities types mapped to the same database column. Column is named \"LowVoltageThreshold\" and is float nullable in the database.\r\n\r\nThree of these entities map directly to a double? property:\r\n\r\n```C#\r\n        public double? Threshold { get; set; }\r\n\r\n        public void Configure(EntityTypeBuilder<BearingChangedAlarmSetting> entity)\r\n        {\r\n            entity.HasBaseType<AlarmSetting>();\r\n            entity.Property(e => e.Threshold).HasColumnName(\"LowVoltageThreshold\");\r\n        }\r\n```\r\n\r\nThe other map to utility class containing a float? property, so I use a converter to convert from double? to float?:\r\n\r\n```C#\r\n    public class DistanceUnit\r\n    {\r\n        public float? Metres { get; set; }\r\n        [...]\r\n    }\r\n\r\n    public DistanceUnit Threshold { get; set; }\r\n\r\n    public void Configure(EntityTypeBuilder<RouteLengthChangedAlarmSetting> entity)\r\n    {\r\n        entity.HasBaseType<AlarmSetting>();\r\n        entity.Property(e => e.Threshold)\r\n            .HasColumnName(\"LowVoltageThreshold\")\r\n            .HasConversion(e => (double?)e.Metres, e => new DistanceUnit { Metres = (float?)e });\r\n    }\r\n```\r\n\r\nWhen looking at the signature returned by HasConversion it indeed have the nullable \"?\" in the type:\r\n![image](https://user-images.githubusercontent.com/6548184/201181418-dfc2a622-482f-4e1a-a951-c4e9722e9631.png)\r\n\r\nSo where does that \"double\" without the nullable comes from in the compatibility validation? And why did this behavior change in v7?\r\n\r\n### Include stack traces\r\n\r\nInclude the full exception message and stack trace for any exception you encounter.\r\n\r\n```\r\nSystem.InvalidOperationException: 'BearingChangedAlarmSetting.Threshold' and 'RouteLengthChangedAlarmSetting.Threshold' are both mapped to column 'LowVoltageThreshold' in 'AlarmSettings', but are configured to use differing provider types ('double' and 'double?').\r\n   at Microsoft.EntityFrameworkCore.Infrastructure.RelationalModelValidator.ValidateCompatible(IProperty property, IProperty duplicateProperty, String columnName, StoreObjectIdentifier& storeObject, IDiagnosticsLogger`1 logger)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Infrastructure.Internal.SqlServerModelValidator.ValidateCompatible(IProperty property, IProperty duplicateProperty, String columnName, StoreObjectIdentifier& storeObject, IDiagnosticsLogger`1 logger)\r\n   at Microsoft.EntityFrameworkCore.Infrastructure.RelationalModelValidator.ValidateSharedColumnsCompatibility(IReadOnlyList`1 mappedTypes, StoreObjectIdentifier& storeObject, IDiagnosticsLogger`1 logger)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Infrastructure.Internal.SqlServerModelValidator.ValidateSharedColumnsCompatibility(IReadOnlyList`1 mappedTypes, StoreObjectIdentifier& storeObject, IDiagnosticsLogger`1 logger)\r\n   at Microsoft.EntityFrameworkCore.Infrastructure.RelationalModelValidator.ValidateSharedTableCompatibility(IModel model, IDiagnosticsLogger`1 logger)\r\n   at Microsoft.EntityFrameworkCore.Infrastructure.RelationalModelValidator.Validate(IModel model, IDiagnosticsLogger`1 logger)\r\n   at Microsoft.EntityFrameworkCore.SqlServer.Infrastructure.Internal.SqlServerModelValidator.Validate(IModel model, IDiagnosticsLogger`1 logger)\r\n   at Microsoft.EntityFrameworkCore.Infrastructure.ModelRuntimeInitializer.Initialize(IModel model, Boolean designTime, IDiagnosticsLogger`1 validationLogger)\r\n   at Microsoft.EntityFrameworkCore.Infrastructure.ModelSource.GetModel(DbContext context, ModelCreationDependencies modelCreationDependencies, Boolean designTime)\r\n   at Microsoft.EntityFrameworkCore.Internal.DbContextServices.CreateModel(Boolean designTime)\r\n   at Microsoft.EntityFrameworkCore.Internal.DbContextServices.get_Model()\r\n```\r\n\r\n### Include provider and version information\r\n\r\nEF Core version: 7.0.0\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework: .NET 6.0","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/29531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/29531/timeline","performed_via_github_app":null,"state_reason":"completed"}