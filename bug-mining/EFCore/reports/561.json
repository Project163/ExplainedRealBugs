{"url":"https://api.github.com/repos/dotnet/efcore/issues/34875","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34875/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34875/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34875/events","html_url":"https://github.com/dotnet/efcore/issues/34875","id":2579412894,"node_id":"I_kwDOAPaMMs6Zvree","number":34875,"title":"Runtime error after updating to 8.0.10","user":{"login":"sharkk121","id":11296288,"node_id":"MDQ6VXNlcjExMjk2Mjg4","avatar_url":"https://avatars.githubusercontent.com/u/11296288?v=4","gravatar_id":"","url":"https://api.github.com/users/sharkk121","html_url":"https://github.com/sharkk121","followers_url":"https://api.github.com/users/sharkk121/followers","following_url":"https://api.github.com/users/sharkk121/following{/other_user}","gists_url":"https://api.github.com/users/sharkk121/gists{/gist_id}","starred_url":"https://api.github.com/users/sharkk121/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sharkk121/subscriptions","organizations_url":"https://api.github.com/users/sharkk121/orgs","repos_url":"https://api.github.com/users/sharkk121/repos","events_url":"https://api.github.com/users/sharkk121/events{/privacy}","received_events_url":"https://api.github.com/users/sharkk121/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":514908713,"node_id":"MDU6TGFiZWw1MTQ5MDg3MTM=","url":"https://api.github.com/repos/dotnet/efcore/labels/regression","name":"regression","color":"ff1fff","default":false,"description":null},{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900941630,"node_id":"MDU6TGFiZWwxOTAwOTQxNjMw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-model-building","name":"area-model-building","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/205","html_url":"https://github.com/dotnet/efcore/milestone/205","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/205/labels","id":11582336,"node_id":"MI_kwDOAPaMMs4AsLuA","number":205,"title":"8.0.11","description":null,"creator":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2024-09-14T06:41:33Z","updated_at":"2025-01-23T07:33:07Z","due_on":null,"closed_at":"2024-11-14T11:54:17Z"},"comments":3,"created_at":"2024-10-10T17:16:01Z","updated_at":"2024-10-16T00:39:47Z","closed_at":"2024-10-16T00:39:47Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## File a bug\n\nAfter upgrading Microsft.EntityFrameworkCore related nugets in my project from to 8.0.10 (from 8.0.8), my application fails at runtime as well as while running migrations on the attached repro repository. The error I'm getting:\n\n```\nUnable to create a 'DbContext' of type ''. The exception 'The convention invocations have reached the recursion limit. This is likely an issue in Entity Framework, please file an issue at https://go.microsoft.com/fwlink/?linkid=2142044.' was thrown while attempting to create an instance. For the different patterns supported at design time, see https://go.microsoft.com/fwlink/?linkid=851728\n```\n\n### Include your code\n\nhttps://github.com/sharkk121/EfCoreBug/tree/master\n\n```\ndotnet ef migrations add Test\n```\n\nIt completes without exceptions on 8.0.8. As a workaround you can also uncomment lines 19 and 20 in Program.cs as well as uncomment lines 36 and 42 in TestDbContext.cs (while commenting 37 and 43)\n\n### Include stack traces\n\n```\nMicrosoft.EntityFrameworkCore.Design.OperationException: Unable to create a 'DbContext' of type ''. The exception 'The convention invocations have reached the recursion limit. This is likely an issue in Entity Framework, please file an issue at https://go.microsoft.com/fwlink/?linkid=2142044.' was thrown while attempting to create an instance. For the different patterns supported at design time, see https://go.microsoft.com/fwlink/?linkid=851728\n ---> System.InvalidOperationException: The convention invocations have reached the recursion limit. This is likely an issue in Entity Framework, please file an issue at https://go.microsoft.com/fwlink/?linkid=2142044.\n   at Microsoft.EntityFrameworkCore.Metadata.Conventions.Internal.ConventionDispatcher.ConventionBatch.Run()\n   at Microsoft.EntityFrameworkCore.Metadata.Conventions.Internal.ConventionDispatcher.ConventionBatch.Dispose()\n   at Microsoft.EntityFrameworkCore.Metadata.Builders.CollectionCollectionBuilder.UsingEntity(String joinEntityName, Type joinEntityType, Func`2 configureRight, Func`2 configureLeft)\n   at Microsoft.EntityFrameworkCore.Metadata.Builders.CollectionCollectionBuilder`2.Using[TJoinEntity](String joinEntityName, Func`2 configureRight, Func`2 configureLeft)\n   at Microsoft.EntityFrameworkCore.Metadata.Builders.CollectionCollectionBuilder`2.UsingEntity[TJoinEntity](Func`2 configureRight, Func`2 configureLeft)\n   at Microsoft.EntityFrameworkCore.Metadata.Builders.CollectionCollectionBuilder`2.UsingEntity[TJoinEntity](Func`2 configureRight, Func`2 configureLeft, Action`1 configureJoinEntityType)\n   at EfCoreBug.PostsConfiguration.Configure(EntityTypeBuilder`1 builder) in H:\\source\\EfCoreBug\\TestDbContext.cs:line 29\n   at Microsoft.EntityFrameworkCore.ModelBuilder.ApplyConfiguration[TEntity](IEntityTypeConfiguration`1 configuration)\n   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)\n   at System.Reflection.MethodBaseInvoker.InvokeDirectByRefWithFewArgs(Object obj, Span`1 copyOfArgs, BindingFlags invokeAttr)\n   --- End of inner exception stack trace ---\n   at Microsoft.EntityFrameworkCore.Design.Internal.DbContextOperations.CreateContext(String contextType)\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.AddMigration(String name, String outputDir, String contextType, String namespace)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigrationImpl(String name, String outputDir, String contextType, String namespace)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigration.<>c__DisplayClass0_0.<.ctor>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.<>c__DisplayClass3_0`1.<Execute>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\n```\n\n### Include verbose output\n\n```\nPS H:\\source\\EfCoreBug> dotnet ef migrations add Test --verbose\nUsing project 'H:\\source\\EfCoreBug\\EfCoreBug.csproj'.\nUsing startup project 'H:\\source\\EfCoreBug\\EfCoreBug.csproj'.\nWriting 'H:\\source\\EfCoreBug\\obj\\EfCoreBug.csproj.EntityFrameworkCore.targets'...\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\sharkk121\\AppData\\Local\\Temp\\tmpsxoyop.tmp /verbosity:quiet /nologo H:\\source\\EfCoreBug\\EfCoreBug.csproj\nWriting 'H:\\source\\EfCoreBug\\obj\\EfCoreBug.csproj.EntityFrameworkCore.targets'...\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\sharkk121\\AppData\\Local\\Temp\\tmpxyon0w.tmp /verbosity:quiet /nologo H:\\source\\EfCoreBug\\EfCoreBug.csproj\nBuild started...\ndotnet build H:\\source\\EfCoreBug\\EfCoreBug.csproj /verbosity:quiet /nologo /p:PublishAot=false\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:00.72\n\nWorkload updates are available. Run `dotnet workload list` for more information.\nBuild succeeded.\ndotnet exec --depsfile H:\\source\\EfCoreBug\\bin\\Debug\\net8.0\\EfCoreBug.deps.json --additionalprobingpath C:\\Users\\sharkk121\\.nuget\\packages --runtimeconfig H:\\source\\EfCoreBug\\bin\\Debug\\net8.0\\EfCoreBug.runtimeconfig.json C:\\Users\\sharkk121\\.dotnet\\tools\\.store\\dotnet-ef\\8.0.10\\dotnet-ef\\8.0.10\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll migrations add Test --assembly H:\\source\\EfCoreBug\\bin\\Debug\\net8.0\\EfCoreBug.dll --project H:\\source\\EfCoreBug\\EfCoreBug.csproj --startup-assembly H:\\source\\EfCoreBug\\bin\\Debug\\net8.0\\EfCoreBug.dll --startup-project H:\\source\\EfCoreBug\\EfCoreBug.csproj --project-dir H:\\source\\EfCoreBug\\ --root-namespace EfCoreBug --language C# --framework net8.0 --nullable --working-dir H:\\source\\EfCoreBug --verbose\nUsing assembly 'EfCoreBug'.\nUsing startup assembly 'EfCoreBug'.\nUsing application base 'H:\\source\\EfCoreBug\\bin\\Debug\\net8.0'.\nUsing working directory 'H:\\source\\EfCoreBug'.\nUsing root namespace 'EfCoreBug'.\nUsing project directory 'H:\\source\\EfCoreBug\\'.\nRemaining arguments: .\nFinding DbContext classes...\nFinding IDesignTimeDbContextFactory implementations...\nFinding application service provider in assembly 'EfCoreBug'...\nFinding Microsoft.Extensions.Hosting service provider...\nNo static method 'CreateHostBuilder(string[])' was found on class 'Program'.\nNo application service provider was found.\nFinding DbContext classes in the project...\nFound DbContext 'TestDbContext'.\nUsing context 'TestDbContext'.\nMicrosoft.EntityFrameworkCore.Design.OperationException: Unable to create a 'DbContext' of type ''. The exception 'The convention invocations have reached the recursion limit. This is likely an issue in Entity Framework, please file an issue at https://go.microsoft.com/fwlink/?linkid=2142044.' was thrown while attempting to create an instance. For the different patterns supported at design time, see https://go.microsoft.com/fwlink/?linkid=851728\n ---> System.InvalidOperationException: The convention invocations have reached the recursion limit. This is likely an issue in Entity Framework, please file an issue at https://go.microsoft.com/fwlink/?linkid=2142044.\n   at Microsoft.EntityFrameworkCore.Metadata.Conventions.Internal.ConventionDispatcher.ConventionBatch.Run()\n   at Microsoft.EntityFrameworkCore.Metadata.Conventions.Internal.ConventionDispatcher.ConventionBatch.Dispose()\n   at Microsoft.EntityFrameworkCore.Metadata.Builders.CollectionCollectionBuilder.UsingEntity(String joinEntityName, Type joinEntityType, Func`2 configureRight, Func`2 configureLeft)\n   at Microsoft.EntityFrameworkCore.Metadata.Builders.CollectionCollectionBuilder`2.Using[TJoinEntity](String joinEntityName, Func`2 configureRight, Func`2 configureLeft)\n   at Microsoft.EntityFrameworkCore.Metadata.Builders.CollectionCollectionBuilder`2.UsingEntity[TJoinEntity](Func`2 configureRight, Func`2 configureLeft)\n   at Microsoft.EntityFrameworkCore.Metadata.Builders.CollectionCollectionBuilder`2.UsingEntity[TJoinEntity](Func`2 configureRight, Func`2 configureLeft, Action`1 configureJoinEntityType)\n   at EfCoreBug.PostsConfiguration.Configure(EntityTypeBuilder`1 builder) in H:\\source\\EfCoreBug\\TestDbContext.cs:line 29\n   at Microsoft.EntityFrameworkCore.ModelBuilder.ApplyConfiguration[TEntity](IEntityTypeConfiguration`1 configuration)\n   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)\n   at System.Reflection.MethodBaseInvoker.InvokeDirectByRefWithFewArgs(Object obj, Span`1 copyOfArgs, BindingFlags invokeAttr)\n   --- End of inner exception stack trace ---\n   at Microsoft.EntityFrameworkCore.Design.Internal.DbContextOperations.CreateContext(String contextType)\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.AddMigration(String name, String outputDir, String contextType, String namespace)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigrationImpl(String name, String outputDir, String contextType, String namespace)\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.AddMigration.<>c__DisplayClass0_0.<.ctor>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.<>c__DisplayClass3_0`1.<Execute>b__0()\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\nUnable to create a 'DbContext' of type ''. The exception 'The convention invocations have reached the recursion limit. This is likely an issue in Entity Framework, please file an issue at https://go.microsoft.com/fwlink/?linkid=2142044.' was thrown while attempting to create an instance. For the different patterns supported at design time, see https://go.microsoft.com/fwlink/?linkid=851728\n```\n\n### Include provider and version information\n\nEF Core version: 8.0.10\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\nTarget framework: .NET 8.0\nOperating system: Windows 11 23H2 22631.4249\nIDE: (e.g. Visual Studio 2022 17.11.5)\n","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34875/timeline","performed_via_github_app":null,"state_reason":"completed"}