{"url":"https://api.github.com/repos/dotnet/efcore/issues/32763","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/32763/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/32763/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/32763/events","html_url":"https://github.com/dotnet/efcore/issues/32763","id":2073751625,"node_id":"I_kwDOAPaMMs57mvBJ","number":32763,"title":"Owned entity on genericly typed entity generates unwanted steps in new migrations","user":{"login":"jmvlangen","id":866829,"node_id":"MDQ6VXNlcjg2NjgyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/866829?v=4","gravatar_id":"","url":"https://api.github.com/users/jmvlangen","html_url":"https://github.com/jmvlangen","followers_url":"https://api.github.com/users/jmvlangen/followers","following_url":"https://api.github.com/users/jmvlangen/following{/other_user}","gists_url":"https://api.github.com/users/jmvlangen/gists{/gist_id}","starred_url":"https://api.github.com/users/jmvlangen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jmvlangen/subscriptions","organizations_url":"https://api.github.com/users/jmvlangen/orgs","repos_url":"https://api.github.com/users/jmvlangen/repos","events_url":"https://api.github.com/users/jmvlangen/events{/privacy}","received_events_url":"https://api.github.com/users/jmvlangen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1900942474,"node_id":"MDU6TGFiZWwxOTAwOTQyNDc0","url":"https://api.github.com/repos/dotnet/efcore/labels/area-migrations","name":"area-migrations","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/188","html_url":"https://github.com/dotnet/efcore/milestone/188","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/188/labels","id":10432910,"node_id":"MI_kwDOAPaMMs4AnzGO","number":188,"title":"8.0.3","description":null,"creator":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":22,"state":"closed","created_at":"2024-01-18T01:09:32Z","updated_at":"2024-04-09T08:41:20Z","due_on":null,"closed_at":"2024-04-09T08:41:20Z"},"comments":1,"created_at":"2024-01-10T07:20:35Z","updated_at":"2025-06-15T19:57:02Z","closed_at":"2024-02-07T12:57:50Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"After upgrading our code from .NET 6 to .NET 8 we noticed some strange lines showing up in newly generated migration scripts. Even when there are no changes to the model, add-migration creates a migration which wants to drop some non-existent foreign keys and corresponding columns. Upon further inspection this column corresponds to the primary key of an owned entity of an entity whose class is genericly typed.\r\n\r\nThis is a minimal example that reproduces the problem:\r\n```C#\r\nusing Microsoft.EntityFrameworkCore;\r\n\r\npublic class Parent<TChild>\r\n{\r\n    public int Id { get; set; }\r\n    public string Name { get; set; }\r\n    public TChild Child { get; set; }\r\n}\r\n\r\npublic class Boy\r\n{\r\n    public string Name { get; set; }\r\n}\r\n\r\npublic class TestContext : DbContext\r\n{\r\n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\r\n    {\r\n        optionsBuilder.UseSqlServer();\r\n\r\n        base.OnConfiguring(optionsBuilder);\r\n    }\r\n\r\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\r\n    {\r\n        var parentBuilder = modelBuilder.Entity<Parent<Boy>>();\r\n\r\n        parentBuilder.HasKey(p => p.Id);\r\n        parentBuilder.OwnsOne(p => p.Child);\r\n\r\n        base.OnModelCreating(modelBuilder);\r\n    }\r\n}\r\n```\r\nIf you run Add-Migration from the EF core tools on this model, the first generated migration is fine. Every migration generated thereafter (even if no changes were made to the code) will contain the following two lines (besides all actual changes):\r\n```C#\r\n            migrationBuilder.DropForeignKey(\r\n                name: \"FK_Parent<Boy>_Parent<Boy>_Parent<Boy>Id\",\r\n                table: \"Parent<Boy>\");\r\n\r\n            migrationBuilder.DropColumn(\r\n                name: \"Parent<Boy>Id\",\r\n                table: \"Parent<Boy>\");\r\n```\r\n\r\nIn the TestContextModelSnapshot.cs we find:\r\n```C#\r\n            modelBuilder.Entity(\".Parent<Boy>\", b =>\r\n                {\r\n                    b.OwnsOne(\"Boy\", \"Child\", b1 =>\r\n                        {\r\n                            b1.Property<int>(\"ParentId\")\r\n                                .HasColumnType(\"int\")\r\n                                .HasColumnName(\"Parent<Boy>Id\");\r\n\r\n                            b1.Property<string>(\"Name\")\r\n                                .IsRequired()\r\n                                .HasColumnType(\"nvarchar(max)\");\r\n\r\n                            b1.HasKey(\"ParentId\");\r\n\r\n                            b1.ToTable(\"Parent<Boy>\");\r\n\r\n                            b1.WithOwner()\r\n                                .HasForeignKey(\"ParentId\");\r\n                        });\r\n\r\n                    b.Navigation(\"Child\");\r\n                });\r\n```\r\nThe line containing\r\n```C#\r\n.HasColumnName(\"Parent<Boy>Id\")\r\n```\r\nappears to be new. It did not appear in snapshots generated with the .NET 6 version of EF core. Since the property name seems to have changed in .NET 8, the column name seems to be added to stay consistent with previous version, even though this shadow property is never persisted to the database. Removing this line before generating a migration will make the migration omit the drop statements, but it does reinsert this line into the snapshot making it necessary to repeat this before every migration thereafter.\r\n\r\n### System information\r\n\r\nEF Core version: 8.0.0\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer 8.0.1\r\nTarget framework: .NET 8\r\nOperating system: Windows\r\nIDE: Visual Studio Enterprise 2022 17.8.3\r\n","closed_by":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/32763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/32763/timeline","performed_via_github_app":null,"state_reason":"completed"}