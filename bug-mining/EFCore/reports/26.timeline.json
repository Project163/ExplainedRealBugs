[{"id":6009020866,"node_id":"LE_lADOAPaMMs5DALhgzwAAAAFmKmHC","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6009020866","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-02-04T11:54:47Z","label":{"name":"type-enhancement","color":"bfe5bf"},"performed_via_github_app":null},{"id":6009020870,"node_id":"LE_lADOAPaMMs5DALhgzwAAAAFmKmHG","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6009020870","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-02-04T11:54:48Z","label":{"name":"area-perf","color":"5319e7"},"performed_via_github_app":null},{"id":6009020872,"node_id":"LE_lADOAPaMMs5DALhgzwAAAAFmKmHI","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6009020872","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-02-04T11:54:48Z","label":{"name":"area-save-changes","color":"32b37b"},"performed_via_github_app":null},{"id":6009020873,"node_id":"LE_lADOAPaMMs5DALhgzwAAAAFmKmHJ","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6009020873","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-02-04T11:54:48Z","label":{"name":"area-sqlserver","color":"32b37b"},"performed_via_github_app":null},{"id":6009020907,"node_id":"MEE_lADOAPaMMs5DALhgzwAAAAFmKmHr","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6009020907","actor":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-02-04T11:54:48Z","performed_via_github_app":null},{"id":6009020914,"node_id":"SE_lADOAPaMMs5DALhgzwAAAAFmKmHy","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6009020914","actor":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-02-04T11:54:48Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1029949567","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1029949567","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1029949567,"node_id":"IC_kwDOAPaMMs49Y8h_","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-04T12:38:21Z","updated_at":"2022-02-04T12:38:21Z","body":"See also #1441, #25345, and #7188.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1029949567/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-04T12:57:44Z","updated_at":"2022-02-04T12:57:44Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/7188","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/7188/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/7188/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/7188/events","html_url":"https://github.com/dotnet/efcore/issues/7188","id":193527349,"node_id":"MDU6SXNzdWUxOTM1MjczNDk=","number":7188,"title":"Use INSERT w/OUTPUT Instead of INSERT+SELECT","user":{"login":"bgribaudo","id":857202,"node_id":"MDQ6VXNlcjg1NzIwMg==","avatar_url":"https://avatars.githubusercontent.com/u/857202?v=4","gravatar_id":"","url":"https://api.github.com/users/bgribaudo","html_url":"https://github.com/bgribaudo","followers_url":"https://api.github.com/users/bgribaudo/followers","following_url":"https://api.github.com/users/bgribaudo/following{/other_user}","gists_url":"https://api.github.com/users/bgribaudo/gists{/gist_id}","starred_url":"https://api.github.com/users/bgribaudo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bgribaudo/subscriptions","organizations_url":"https://api.github.com/users/bgribaudo/orgs","repos_url":"https://api.github.com/users/bgribaudo/repos","events_url":"https://api.github.com/users/bgribaudo/events{/privacy}","received_events_url":"https://api.github.com/users/bgribaudo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":11,"created_at":"2016-12-05T15:26:15Z","updated_at":"2025-06-16T10:27:41Z","closed_at":"2022-10-16T10:45:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Entity Framework Core's SQL Server provider (at least, as of v. 1.1.0) follows each INSERT statement with a SELECT statement that fetches database-generated values and verifies the inserted row count.\r\n\r\n### Proposal\r\nEliminate the SELECT statement. Instead:\r\n* Fetch database-generated values using an OUTPUT clause on the INSERT statement. \r\n* Rely on the database provider to throw an exception of the INSERT fails instead of verifying inserted row count (looks like was supposed to have been implemented per #2131).\r\n\r\n### Examples\r\n#### Currently (EF Core 1.1.0)\r\n```\r\n-- Table w/identity column:\r\nSET NOCOUNT ON;\r\nINSERT INTO [TestTable1] ([Data])\r\nVALUES (@p0);\r\nSELECT [Id]\r\nFROM [TestTable1]\r\nWHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();\r\n\r\n-- Table w/identity and default value (`DEFAULT(GETDATE())`) columns:\r\nSET NOCOUNT ON;\r\nINSERT INTO [TestTable2] ([Data])\r\nVALUES (@p0);\r\nSELECT [Id], [HasDefaultValue]\r\nFROM [TestTable2]\r\nWHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();\r\n```\r\n\r\n#### Proposed Simplification\r\n````\r\n-- Table w/identity column:\r\nSET NOCOUNT ON;\r\nINSERT INTO [TestTable1] ([Data])\r\n    OUTPUT INSERTED.[Id]\r\nVALUES (@p0);\r\n\r\n-- Table w/identity and default value (`DEFAULT(GETDATE())`) columns:\r\nSET NOCOUNT ON;\r\nINSERT INTO [TestTable2] ([Data])\r\n    OUTPUT INSERTED.[Id], INSERTED.[HasDefaultValue]\r\nVALUES (@p0);\r\n````\r\n\r\n### Example Code\r\n[Example.zip](https://github.com/aspnet/EntityFramework/files/631475/Example.zip)\r\n\r\n### Further technical details\r\nEF Core version: 1.1.0\r\nOperating system: Windows 10\r\nVisual Studio version: VS 2015\r\n","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/7188/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/7188/timeline","performed_via_github_app":null,"state_reason":"duplicate"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1029965258","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1029965258","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1029965258,"node_id":"IC_kwDOAPaMMs49ZAXK","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-04T13:00:42Z","updated_at":"2022-02-04T13:00:42Z","body":"Thanks @ajcvickers, I was looking into IDENTITY as well. Reopened #7188 to revisit that pattern as well.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1029965258/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6009359751,"node_id":"MEE_lADOAPaMMs5DALhgzwAAAAFmL42H","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6009359751","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-02-04T13:00:42Z","performed_via_github_app":null},{"id":6009359758,"node_id":"SE_lADOAPaMMs5DALhgzwAAAAFmL42O","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6009359758","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-02-04T13:00:42Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031435860","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1031435860","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1031435860,"node_id":"IC_kwDOAPaMMs49enZU","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-07T12:52:02Z","updated_at":"2022-02-07T12:52:02Z","body":"See also:\r\n\r\n- PR: [#6675: Add support for triggers that modify values in the inserted/updated row to SQL Server](https://github.com/dotnet/efcore/pull/6675)\r\n  - Issue: [#6044: Issue with Computed Fields using User Defined Functions](https://github.com/dotnet/efcore/issues/6044) \r\n  - Issue:: [#6474: SQL Server update does not get values updated by trigger](https://github.com/dotnet/efcore/issues/6474)\r\n- PR: [#4889: Update pipeline hot path optimizations](https://github.com/dotnet/efcore/pull/4889)\r\n- PR: [#4707: Use MERGE for batch insert for Sql Server](https://github.com/dotnet/efcore/pull/4707)\r\n  - Issue: [#4478: SQL Server batching with Identity columns fails for image, text, and ntext columns](https://github.com/dotnet/efcore/issues/4478)\r\n- PR [#4171: Add a strong order to the generated values returned from batches of inserts for Sql Server](https://github.com/dotnet/efcore/pull/4171)\r\n  - Issue: [#4080: Inserted entities has different ID (DB vs instance) after SaveChanges](https://github.com/dotnet/efcore/issues/4080)\r\n- PR [#3947: Use SCOPE_IDENTITY() for SqlServer inserts if only one row is being inserted](https://github.com/dotnet/efcore/pull/3947)\r\n  - Issue: [#3893: Can we avoid some of the overhead from OUTPUT INTO changes](https://github.com/dotnet/efcore/issues/3893)\r\n- PR: [#3869: Use OUTPUT INTO for generated values in SqlServer to support tables with triggers](https://github.com/dotnet/efcore/pull/3869)\r\n  - Issue: [#1441: Support for inserting/updating tables with triggers (not use OUTPUT when batching off)](https://github.com/dotnet/efcore/issues/1441)","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031435860/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031541299","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1031541299","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1031541299,"node_id":"IC_kwDOAPaMMs49fBIz","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-07T14:41:38Z","updated_at":"2022-02-07T16:13:33Z","body":"@AndriySvyryd's suggestion of trying a memory-optimized TVP does reduce the time to something much closer to regular OUTPUT. However:\r\n\r\n* Unfortunately creating a memory-optimized TVP requires explicit, separate creation of the table type with the appropriate shape ([docs](https://docs.microsoft.com/en-us/sql/relational-databases/in-memory-oltp/faster-temp-table-and-table-variable-by-using-memory-optimization?view=sql-server-ver15#d-scenario-table-variable-can-be-memory_optimizedon)); the type persists until explicitly dropped. Creating and dropping the type every time yields horrible perf (over 600ms), so it's not clear how we would manage the lifecycle of these temporary table types.\r\n* Using memory-optimized tables (including temporary variables) requires [special database setup](https://docs.microsoft.com/en-us/sql/relational-databases/in-memory-oltp/the-memory-optimized-filegroup?view=sql-server-ver15).\r\n* There's still an ~8% advantage to OUTPUT over OUTPUT INTO with memory-optimized TVP.\r\n\r\n|                                     Method |       Mean |      Error |     StdDev |  Ratio | RatioSD |\r\n|------------------------------------------- |-----------:|-----------:|-----------:|-------:|--------:|\r\n|                                   NoOutput |   1.905 ms |  0.0376 ms |  0.0649 ms |   0.38 |    0.02 |\r\n|                                     Output |   1.785 ms |  0.0354 ms |  0.0407 ms |   0.36 |    0.01 |\r\n|                                 OutputInto |   4.985 ms |  0.0983 ms |  0.2136 ms |   1.00 |    0.00 |\r\n| OutputInto_MemoryOptimized_persistent_type |   1.935 ms |  0.0378 ms |  0.0518 ms |   0.39 |    0.02 |\r\n|  OutputInto_MemoryOptimized_transient_type | 610.737 ms | 11.9433 ms | 19.2862 ms | 122.22 |    6.18 |\r\n\r\nNote: I also benchmarked using ExecuteReaderAsync instead of ExecuteScalarAsync, and there was no difference.\r\n\r\n<details>\r\n<summary>Benchmark code</summary>\r\n\r\n```c#\r\nBenchmarkRunner.Run<SequenceBenchmark>();\r\n\r\npublic class SequenceBenchmark\r\n{\r\n    const string ConnectionString = \"Server=localhost;Database=test;User=SA;Password=Abcd5678;Connect Timeout=60;ConnectRetryCount=0;Encrypt=false\";\r\n    private SqlConnection _connection;\r\n\r\n    [GlobalSetup]\r\n    public async Task Setup()\r\n    {\r\n        _connection = new SqlConnection(ConnectionString);\r\n        await _connection.OpenAsync();\r\n\r\n        await using var cmd = new SqlCommand(@\"\r\nDROP TYPE IF EXISTS [tempTableType];\r\nDROP TABLE IF EXISTS [Foo];\r\nDROP SEQUENCE IF EXISTS [FooSeq];\r\n\r\nCREATE SEQUENCE [FooSeq] AS int START WITH 1 INCREMENT BY 1 NO MINVALUE NO MAXVALUE NO CYCLE;\r\n\r\nCREATE TABLE [Foo] (\r\n    [Id] int PRIMARY KEY NOT NULL DEFAULT (NEXT VALUE FOR FooSeq),\r\n    [BAR] int\r\n);\r\n\r\nCREATE TYPE [tempTableType] AS TABLE ([Id] int PRIMARY KEY NONCLUSTERED) WITH (MEMORY_OPTIMIZED = ON)\", _connection);\r\n        await cmd.ExecuteNonQueryAsync();\r\n    }\r\n\r\n    [Benchmark]\r\n    public async Task NoOutput()\r\n    {\r\n        await using var cmd = new SqlCommand(\"INSERT INTO [Foo] ([Bar]) VALUES (8)\", _connection);\r\n        _ = await cmd.ExecuteScalarAsync();\r\n    }\r\n\r\n    [Benchmark]\r\n    public async Task Output()\r\n    {\r\n        await using var cmd = new SqlCommand(\"INSERT INTO [Foo] ([Bar]) OUTPUT INSERTED.[Id] VALUES (8)\", _connection);\r\n        _ = await cmd.ExecuteScalarAsync();\r\n    }\r\n\r\n    [Benchmark(Baseline = true)]\r\n    public async Task OutputInto()\r\n    {\r\n        await using var cmd = new SqlCommand(@\"DECLARE @inserted TABLE ([Id] int);\r\nINSERT INTO [Foo] ([Bar]) OUTPUT INSERTED.[Id] INTO @inserted VALUES (8);\r\nSELECT [i].[Id] FROM @inserted i;\r\n\", _connection);\r\n        _ = await cmd.ExecuteScalarAsync();\r\n    }\r\n\r\n    [Benchmark]\r\n    public async Task OutputInto_MemoryOptimized_persistent_type()\r\n    {\r\n        await using var cmd = new SqlCommand(@\"DECLARE @inserted [tempTableType];\r\nINSERT INTO [Foo] ([Bar]) OUTPUT INSERTED.[Id] INTO @inserted VALUES (8);\r\nSELECT [i].[Id] FROM @inserted i;\r\n\", _connection);\r\n        _ = await cmd.ExecuteScalarAsync();\r\n    }\r\n\r\n    [Benchmark]\r\n    public async Task OutputInto_MemoryOptimized_transient_type()\r\n    {\r\n        await using var cmd = new SqlCommand(@\"CREATE TYPE [transientTempTableType] AS TABLE ([Id] int PRIMARY KEY NONCLUSTERED) WITH (MEMORY_OPTIMIZED = ON)\r\nDECLARE @inserted [tempTableType];\r\nINSERT INTO [Foo] ([Bar]) OUTPUT INSERTED.[Id] INTO @inserted VALUES (8);\r\nSELECT [i].[Id] FROM @inserted i;\r\nDROP TYPE [transientTempTableType];\r\n\", _connection);\r\n        _ = await cmd.ExecuteScalarAsync();\r\n    }\r\n\r\n    [GlobalCleanup]\r\n    public ValueTask Cleanup()\r\n        => _connection.DisposeAsync();\r\n}\r\n```\r\n\r\n</details>","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031541299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6019826906,"node_id":"MEE_lADOAPaMMs5DALhgzwAAAAFmz0Ta","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6019826906","actor":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-02-07T14:41:38Z","performed_via_github_app":null},{"id":6019826920,"node_id":"SE_lADOAPaMMs5DALhgzwAAAAFmz0To","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6019826920","actor":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-02-07T14:41:38Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031629153","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1031629153","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1031629153,"node_id":"IC_kwDOAPaMMs49fWlh","user":{"login":"ErikEJ","id":4169187,"node_id":"MDQ6VXNlcjQxNjkxODc=","avatar_url":"https://avatars.githubusercontent.com/u/4169187?v=4","gravatar_id":"","url":"https://api.github.com/users/ErikEJ","html_url":"https://github.com/ErikEJ","followers_url":"https://api.github.com/users/ErikEJ/followers","following_url":"https://api.github.com/users/ErikEJ/following{/other_user}","gists_url":"https://api.github.com/users/ErikEJ/gists{/gist_id}","starred_url":"https://api.github.com/users/ErikEJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErikEJ/subscriptions","organizations_url":"https://api.github.com/users/ErikEJ/orgs","repos_url":"https://api.github.com/users/ErikEJ/repos","events_url":"https://api.github.com/users/ErikEJ/events{/privacy}","received_events_url":"https://api.github.com/users/ErikEJ/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-07T15:58:58Z","updated_at":"2022-02-07T15:58:58Z","body":"Why are you testning with SEQUENCE ? No one uses that, not even migrations conventions.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031629153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ErikEJ","id":4169187,"node_id":"MDQ6VXNlcjQxNjkxODc=","avatar_url":"https://avatars.githubusercontent.com/u/4169187?v=4","gravatar_id":"","url":"https://api.github.com/users/ErikEJ","html_url":"https://github.com/ErikEJ","followers_url":"https://api.github.com/users/ErikEJ/followers","following_url":"https://api.github.com/users/ErikEJ/following{/other_user}","gists_url":"https://api.github.com/users/ErikEJ/gists{/gist_id}","starred_url":"https://api.github.com/users/ErikEJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErikEJ/subscriptions","organizations_url":"https://api.github.com/users/ErikEJ/orgs","repos_url":"https://api.github.com/users/ErikEJ/repos","events_url":"https://api.github.com/users/ErikEJ/events{/privacy}","received_events_url":"https://api.github.com/users/ErikEJ/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031645129","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1031645129","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1031645129,"node_id":"IC_kwDOAPaMMs49fafJ","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-07T16:12:15Z","updated_at":"2022-02-07T16:12:15Z","body":"@ErikEJ it doesn't really matter, it can be any sort of HasDefaultValue/HasDefaultValueSql. It's just that for IDENTITY specifically EF Core uses a different mechanism to bring back the value, so I preferred not to benchmark that.\r\n\r\nBasically anyone *not* using IDENTITY, but having a database-generated column is affected by this. Ths above is also specific to inserting few rows - when batching many rows we use MERGE. A similar thing may exist there, but more research is needed.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031645129/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6020523123,"node_id":"MEE_lADOAPaMMs5DALhgzwAAAAFm2eRz","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6020523123","actor":{"login":"ErikEJ","id":4169187,"node_id":"MDQ6VXNlcjQxNjkxODc=","avatar_url":"https://avatars.githubusercontent.com/u/4169187?v=4","gravatar_id":"","url":"https://api.github.com/users/ErikEJ","html_url":"https://github.com/ErikEJ","followers_url":"https://api.github.com/users/ErikEJ/followers","following_url":"https://api.github.com/users/ErikEJ/following{/other_user}","gists_url":"https://api.github.com/users/ErikEJ/gists{/gist_id}","starred_url":"https://api.github.com/users/ErikEJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErikEJ/subscriptions","organizations_url":"https://api.github.com/users/ErikEJ/orgs","repos_url":"https://api.github.com/users/ErikEJ/repos","events_url":"https://api.github.com/users/ErikEJ/events{/privacy}","received_events_url":"https://api.github.com/users/ErikEJ/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-02-07T16:12:15Z","performed_via_github_app":null},{"id":6020523131,"node_id":"SE_lADOAPaMMs5DALhgzwAAAAFm2eR7","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6020523131","actor":{"login":"ErikEJ","id":4169187,"node_id":"MDQ6VXNlcjQxNjkxODc=","avatar_url":"https://avatars.githubusercontent.com/u/4169187?v=4","gravatar_id":"","url":"https://api.github.com/users/ErikEJ","html_url":"https://github.com/ErikEJ","followers_url":"https://api.github.com/users/ErikEJ/followers","following_url":"https://api.github.com/users/ErikEJ/following{/other_user}","gists_url":"https://api.github.com/users/ErikEJ/gists{/gist_id}","starred_url":"https://api.github.com/users/ErikEJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErikEJ/subscriptions","organizations_url":"https://api.github.com/users/ErikEJ/orgs","repos_url":"https://api.github.com/users/ErikEJ/repos","events_url":"https://api.github.com/users/ErikEJ/events{/privacy}","received_events_url":"https://api.github.com/users/ErikEJ/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-02-07T16:12:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031650478","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1031650478","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1031650478,"node_id":"IC_kwDOAPaMMs49fbyu","user":{"login":"ErikEJ","id":4169187,"node_id":"MDQ6VXNlcjQxNjkxODc=","avatar_url":"https://avatars.githubusercontent.com/u/4169187?v=4","gravatar_id":"","url":"https://api.github.com/users/ErikEJ","html_url":"https://github.com/ErikEJ","followers_url":"https://api.github.com/users/ErikEJ/followers","following_url":"https://api.github.com/users/ErikEJ/following{/other_user}","gists_url":"https://api.github.com/users/ErikEJ/gists{/gist_id}","starred_url":"https://api.github.com/users/ErikEJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErikEJ/subscriptions","organizations_url":"https://api.github.com/users/ErikEJ/orgs","repos_url":"https://api.github.com/users/ErikEJ/repos","events_url":"https://api.github.com/users/ErikEJ/events{/privacy}","received_events_url":"https://api.github.com/users/ErikEJ/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-07T16:16:49Z","updated_at":"2022-02-07T16:16:49Z","body":"Seems like quite a narrow audience. For me it is usually either IDENTITY or a client side generated guid.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031650478/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ErikEJ","id":4169187,"node_id":"MDQ6VXNlcjQxNjkxODc=","avatar_url":"https://avatars.githubusercontent.com/u/4169187?v=4","gravatar_id":"","url":"https://api.github.com/users/ErikEJ","html_url":"https://github.com/ErikEJ","followers_url":"https://api.github.com/users/ErikEJ/followers","following_url":"https://api.github.com/users/ErikEJ/following{/other_user}","gists_url":"https://api.github.com/users/ErikEJ/gists{/gist_id}","starred_url":"https://api.github.com/users/ErikEJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErikEJ/subscriptions","organizations_url":"https://api.github.com/users/ErikEJ/orgs","repos_url":"https://api.github.com/users/ErikEJ/repos","events_url":"https://api.github.com/users/ErikEJ/events{/privacy}","received_events_url":"https://api.github.com/users/ErikEJ/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031674465","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1031674465","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1031674465,"node_id":"IC_kwDOAPaMMs49fhph","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-07T16:39:10Z","updated_at":"2022-06-07T18:13:17Z","body":"Maybe you're right, though if you have a guid key plus some other generated column, you're affected by this too.\r\n\r\nI'm looking at the batching version too (with MERGE), but we may end up deciding it's not worth addressing this.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031674465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031878857","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1031878857","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1031878857,"node_id":"IC_kwDOAPaMMs49gTjJ","user":{"login":"ErikEJ","id":4169187,"node_id":"MDQ6VXNlcjQxNjkxODc=","avatar_url":"https://avatars.githubusercontent.com/u/4169187?v=4","gravatar_id":"","url":"https://api.github.com/users/ErikEJ","html_url":"https://github.com/ErikEJ","followers_url":"https://api.github.com/users/ErikEJ/followers","following_url":"https://api.github.com/users/ErikEJ/following{/other_user}","gists_url":"https://api.github.com/users/ErikEJ/gists{/gist_id}","starred_url":"https://api.github.com/users/ErikEJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErikEJ/subscriptions","organizations_url":"https://api.github.com/users/ErikEJ/orgs","repos_url":"https://api.github.com/users/ErikEJ/repos","events_url":"https://api.github.com/users/ErikEJ/events{/privacy}","received_events_url":"https://api.github.com/users/ErikEJ/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-07T20:15:56Z","updated_at":"2022-02-07T20:15:56Z","body":">> Maybe you're right, though if you have a guid key plus some other generated column, your affected by this too.\n\nYeah, but again a very uncommon edge case scenario, in my experience.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031878857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ErikEJ","id":4169187,"node_id":"MDQ6VXNlcjQxNjkxODc=","avatar_url":"https://avatars.githubusercontent.com/u/4169187?v=4","gravatar_id":"","url":"https://api.github.com/users/ErikEJ","html_url":"https://github.com/ErikEJ","followers_url":"https://api.github.com/users/ErikEJ/followers","following_url":"https://api.github.com/users/ErikEJ/following{/other_user}","gists_url":"https://api.github.com/users/ErikEJ/gists{/gist_id}","starred_url":"https://api.github.com/users/ErikEJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErikEJ/subscriptions","organizations_url":"https://api.github.com/users/ErikEJ/orgs","repos_url":"https://api.github.com/users/ErikEJ/repos","events_url":"https://api.github.com/users/ErikEJ/events{/privacy}","received_events_url":"https://api.github.com/users/ErikEJ/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031973660","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1031973660","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1031973660,"node_id":"IC_kwDOAPaMMs49gqsc","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-07T21:59:09Z","updated_at":"2022-02-07T21:59:09Z","body":"I've taken a look at our MERGE usage, which also uses OUTPUT INTO. Here are some ideas:\r\n\r\n* Verified that our threshold for switching from INSERT to MERGE (4) is good: INSERTs are faster up to 3.\r\n  * However, for 2-3 statements, we could still batch our INSERTs (i.e. the batching threshold and the MERGE threshold aren't necessarily the same). That provides 0.5-1.2ms speed-up against localhost - with a remote SQL Server that would be more impactful. \r\n* In addition, switching to regular OUTPUT instead of OUTPUT INTO has the same perf benefits as for INSERT (5.5ms -> 2.1ms). Caveats:\r\n  * We'd have the same problem with triggers.\r\n  * MERGE doesn't guarantee ordering for OUTPUT-returned rows (#4171). If we're getting the key(s) column, we could use that to look up the entity instance at the client (i.e. not care about the ordering). If the key isn't server-generated, we could still request it in the OUTPUT clause for the lookup. I suspect that would mean a non-trivial change.\r\n\r\nThe above are just ideas at this point... I do believe that 3ms are a pretty huge difference though.\r\n\r\n### Benchmark results\r\n\r\n|                Method | Rows |      Mean |     Error |    StdDev |    Median | Ratio | RatioSD |\r\n|---------------------- |----- |----------:|----------:|----------:|----------:|------:|--------:|                                 \r\n| Merge_with_OutputInto |    1 |  5.263 ms | 0.1043 ms | 0.1984 ms |  5.260 ms |  1.00 |    0.00 |                                   \r\n|     Merge_with_Output |    1 |  1.891 ms | 0.0376 ms | 0.0916 ms |  1.898 ms |  0.36 |    0.02 |\r\n|        BatchedInserts |    1 |  1.836 ms | 0.0364 ms | 0.0907 ms |  1.856 ms |  0.35 |    0.02 |\r\n|               Inserts |    1 |  1.835 ms | 0.0442 ms | 0.1296 ms |  1.872 ms |  0.34 |    0.03 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |    2 |  5.370 ms | 0.1063 ms | 0.2048 ms |  5.403 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |    2 |  2.009 ms | 0.0376 ms | 0.0351 ms |  2.007 ms |  0.37 |    0.01 |\r\n|        BatchedInserts |    2 |  3.260 ms | 0.0474 ms | 0.0443 ms |  3.257 ms |  0.60 |    0.02 |\r\n|               Inserts |    2 |  3.871 ms | 0.0741 ms | 0.1015 ms |  3.891 ms |  0.72 |    0.03 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |    3 |  5.555 ms | 0.1094 ms | 0.1534 ms |  5.547 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |    3 |  2.041 ms | 0.0352 ms | 0.0329 ms |  2.036 ms |  0.37 |    0.01 |\r\n|        BatchedInserts |    3 |  4.580 ms | 0.0868 ms | 0.0928 ms |  4.584 ms |  0.83 |    0.03 |\r\n|               Inserts |    3 |  5.741 ms | 0.1147 ms | 0.2856 ms |  5.817 ms |  1.02 |    0.08 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |    4 |  5.451 ms | 0.1085 ms | 0.1900 ms |  5.472 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |    4 |  2.050 ms | 0.0406 ms | 0.0839 ms |  2.068 ms |  0.38 |    0.02 |\r\n|        BatchedInserts |    4 |  5.772 ms | 0.1146 ms | 0.2038 ms |  5.803 ms |  1.06 |    0.06 |\r\n|               Inserts |    4 |  7.755 ms | 0.1079 ms | 0.1009 ms |  7.762 ms |  1.41 |    0.06 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |    5 |  5.518 ms | 0.1086 ms | 0.2066 ms |  5.554 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |    5 |  2.090 ms | 0.0346 ms | 0.0324 ms |  2.090 ms |  0.38 |    0.02 |\r\n|        BatchedInserts |    5 |  7.037 ms | 0.1386 ms | 0.2832 ms |  7.094 ms |  1.28 |    0.07 |\r\n|               Inserts |    5 |  9.639 ms | 0.1890 ms | 0.3641 ms |  9.702 ms |  1.75 |    0.10 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |    6 |  5.606 ms | 0.1120 ms | 0.2184 ms |  5.600 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |    6 |  2.140 ms | 0.0295 ms | 0.0276 ms |  2.134 ms |  0.38 |    0.02 |\r\n|        BatchedInserts |    6 |  8.320 ms | 0.1641 ms | 0.3314 ms |  8.399 ms |  1.49 |    0.08 |\r\n|               Inserts |    6 | 11.734 ms | 0.1766 ms | 0.1652 ms | 11.735 ms |  2.09 |    0.11 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |    7 |  5.676 ms | 0.1134 ms | 0.2490 ms |  5.747 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |    7 |  2.175 ms | 0.0423 ms | 0.0671 ms |  2.192 ms |  0.38 |    0.02 |\r\n|        BatchedInserts |    7 |  9.724 ms | 0.1851 ms | 0.2131 ms |  9.749 ms |  1.71 |    0.09 |\r\n|               Inserts |    7 | 13.390 ms | 0.2642 ms | 0.5574 ms | 13.497 ms |  2.37 |    0.14 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |    8 |  5.707 ms | 0.1131 ms | 0.2152 ms |  5.735 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |    8 |  2.218 ms | 0.0442 ms | 0.0739 ms |  2.233 ms |  0.39 |    0.02 |\r\n|        BatchedInserts |    8 | 10.807 ms | 0.2128 ms | 0.2277 ms | 10.773 ms |  1.92 |    0.07 |\r\n|               Inserts |    8 | 15.381 ms | 0.2590 ms | 0.2423 ms | 15.332 ms |  2.75 |    0.13 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |    9 |  5.773 ms | 0.1149 ms | 0.2398 ms |  5.833 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |    9 |  2.245 ms | 0.0444 ms | 0.0494 ms |  2.258 ms |  0.39 |    0.02 |\r\n|        BatchedInserts |    9 | 12.031 ms | 0.2375 ms | 0.5010 ms | 12.149 ms |  2.09 |    0.12 |\r\n|               Inserts |    9 | 17.188 ms | 0.3232 ms | 0.3023 ms | 17.189 ms |  3.01 |    0.13 |\r\n|                       |      |           |           |           |           |       |         |\r\n| Merge_with_OutputInto |   10 |  5.860 ms | 0.1160 ms | 0.2235 ms |  5.958 ms |  1.00 |    0.00 |\r\n|     Merge_with_Output |   10 |  2.300 ms | 0.0413 ms | 0.0366 ms |  2.295 ms |  0.40 |    0.02 |\r\n|        BatchedInserts |   10 | 13.592 ms | 0.2710 ms | 0.4219 ms | 13.617 ms |  2.34 |    0.12 |\r\n|               Inserts |   10 | 19.513 ms | 0.3207 ms | 0.3000 ms | 19.528 ms |  3.39 |    0.20 |\r\n\r\n<details>\r\n<summary>Benchmark code</summary>\r\n\r\n```c#\r\nBenchmarkRunner.Run<SequenceBenchmark>();\r\n\r\npublic class SequenceBenchmark\r\n{\r\n    const string ConnectionString = \"Server=localhost;Database=test;User=SA;Password=Abcd5678;Connect Timeout=60;ConnectRetryCount=0;Encrypt=false\";\r\n    private SqlCommand _command;\r\n    private SqlConnection _connection;\r\n\r\n    [Params(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)]\r\n    public int Rows { get; set; }\r\n\r\n    private async Task Setup()\r\n    {\r\n        _connection = new SqlConnection(ConnectionString);\r\n        await _connection.OpenAsync();\r\n\r\n        await using var cmd = new SqlCommand(@\"\r\nDROP TABLE IF EXISTS [Foo];\r\nDROP SEQUENCE IF EXISTS [FooSeq];\r\n\r\nCREATE SEQUENCE [FooSeq] AS int START WITH 1 INCREMENT BY 1 NO MINVALUE NO MAXVALUE NO CYCLE;\r\n\r\nCREATE TABLE [Foo] (\r\n    [Id] int PRIMARY KEY NOT NULL DEFAULT (NEXT VALUE FOR FooSeq),\r\n    [BAR] int\r\n);\", _connection);\r\n        await cmd.ExecuteNonQueryAsync();\r\n    }\r\n\r\n    [GlobalSetup(Target = nameof(Merge_with_OutputInto))]\r\n    public async Task Setup_Merge_with_OutputInto()\r\n    {\r\n        await Setup();\r\n\r\n        _command = new SqlCommand { Connection = _connection };\r\n\r\n        var builder = new StringBuilder();\r\n\r\n        builder.AppendLine(@\"DECLARE @inserted0 TABLE ([Id] int, [_Position] [int]);\r\nMERGE [Blogs] USING (\r\nVALUES\");\r\n        \r\n        for (var i = 0; i < Rows; i++)\r\n        {\r\n            builder.Append($\"(@p{i}, {i})\");\r\n            if (i < Rows - 1)\r\n                builder.AppendLine(\",\");\r\n            _command.Parameters.Add(new(\"p\" + i, i));\r\n        }\r\n\r\n        builder.Append(@\") AS i ([Name], _Position) ON 1=0\r\nWHEN NOT MATCHED THEN\r\nINSERT ([Name])\r\nVALUES (i.[Name])\r\nOUTPUT INSERTED.[Id], i._Position\r\nINTO @inserted0;\r\n\r\nSELECT [i].[Id] FROM @inserted0 i\r\nORDER BY [i].[_Position];\");\r\n\r\n        _command.CommandText = builder.ToString();\r\n    }\r\n\r\n    [GlobalSetup(Target = nameof(Merge_with_Output))]\r\n    public async Task Setup_Merge_with_Output()\r\n    {\r\n        await Setup();\r\n\r\n        _command = new SqlCommand { Connection = _connection };\r\n\r\n        var builder = new StringBuilder();\r\n\r\n        builder.AppendLine(@\"MERGE [Blogs] USING (\r\nVALUES\");\r\n        \r\n        for (var i = 0; i < Rows; i++)\r\n        {\r\n            builder.Append($\"(@p{i})\");\r\n            if (i < Rows - 1)\r\n                builder.AppendLine(\",\");\r\n            _command.Parameters.Add(new(\"p\" + i, i));\r\n        }\r\n\r\n        builder.Append(@\") AS i ([Name]) ON 1=0\r\nWHEN NOT MATCHED THEN\r\nINSERT ([Name])\r\nVALUES (i.[Name])\r\nOUTPUT INSERTED.[Id];\");\r\n\r\n        _command.CommandText = builder.ToString();\r\n    }\r\n\r\n    [GlobalSetup(Target = nameof(BatchedInserts))]\r\n    public async Task Setup_BatchInserts()\r\n    {\r\n        await Setup();\r\n       \r\n        _command = new SqlCommand { Connection = _connection };\r\n        \r\n        var builder = new StringBuilder();\r\n        \r\n        for (var i = 0; i < Rows; i++)\r\n        {\r\n            if (i > 0)\r\n                builder.Append(\"; \");\r\n            \r\n            builder.Append($\"INSERT INTO [Blogs] ([Name]) VALUES (@p{i})\");\r\n\r\n            _command.Parameters.Add(new(\"p\" + i, i));\r\n        }\r\n\r\n        _command.CommandText = builder.ToString();\r\n    }\r\n\r\n    [GlobalSetup(Target = nameof(Inserts))]\r\n    public async Task Setup_Inserts()\r\n    {\r\n        await Setup();\r\n\r\n        _command = new SqlCommand(\"INSERT INTO [Blogs] ([Name]) VALUES (@p0)\", _connection);\r\n        _command.Parameters.Add(new SqlParameter { ParameterName = \"p0\" });\r\n    }\r\n\r\n    [Benchmark(Baseline = true)]\r\n    public async Task Merge_with_OutputInto()\r\n        => _ = await _command.ExecuteScalarAsync();\r\n\r\n    [Benchmark]\r\n    public async Task Merge_with_Output()\r\n        => _ = await _command.ExecuteScalarAsync();\r\n\r\n    [Benchmark]\r\n    public async Task BatchedInserts()\r\n        => _ = await _command.ExecuteScalarAsync();\r\n\r\n    [Benchmark]\r\n    public async Task Inserts()\r\n    {\r\n        for (var i = 0; i < Rows; i++)\r\n        {\r\n            _command.Parameters[0].Value = i;\r\n            \r\n            _ = await _command.ExecuteScalarAsync();\r\n        }\r\n    }\r\n\r\n    [GlobalCleanup]\r\n    public ValueTask Cleanup()\r\n        => _connection.DisposeAsync();\r\n}\r\n```\r\n\r\n</details>","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1031973660/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032359344","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1032359344","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1032359344,"node_id":"IC_kwDOAPaMMs49iI2w","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-08T08:50:58Z","updated_at":"2022-02-08T08:50:58Z","body":"@roji \r\n\r\n> If we're getting the key(s) column, we could use that to look up the entity instance at the client (i.e. not care about the ordering).\r\n\r\nSo, for generated keys, you mean pass in the temporary values for all the key columns, and then read them back out correlated with the real values?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032359344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6024990042,"node_id":"MEE_lADOAPaMMs5DALhgzwAAAAFnHg1a","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6024990042","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-02-08T08:50:58Z","performed_via_github_app":null},{"id":6024990047,"node_id":"SE_lADOAPaMMs5DALhgzwAAAAFnHg1f","url":"https://api.github.com/repos/dotnet/efcore/issues/events/6024990047","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-02-08T08:50:58Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032367286","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1032367286","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1032367286,"node_id":"IC_kwDOAPaMMs49iKy2","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-08T09:00:52Z","updated_at":"2022-02-08T09:00:52Z","body":"No need to pass them in - just ask for them to be sent back to you via the OUTPUT clause. Yeah, this adds more traffic, but given the extreme overhead of OUTPUT INTO there's a good chance it's justified.\r\n\r\n(note also the very common scenario where the ID itself is database-generated, so must be in the OUTPUT clause in any case).","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032367286/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032477677","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1032477677","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1032477677,"node_id":"IC_kwDOAPaMMs49ilvt","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-08T10:57:20Z","updated_at":"2022-02-08T10:57:20Z","body":"One additional note from the above: if we did switch to MERGE with OUTPUT instead of OUTPUT INTO, it becomes an efficient strategy starting with 1 row, so we could drop the INSERT/MERGE threshold and just always do MERGE (of course the above caveats still hold).","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032477677/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032538594","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1032538594","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1032538594,"node_id":"IC_kwDOAPaMMs49i0ni","user":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-08T12:08:46Z","updated_at":"2022-02-08T12:08:46Z","body":"But how can we look up the entity for which to set the generated ID when we don't know the ID until it is generated?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032538594/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032553656","html_url":"https://github.com/dotnet/efcore/issues/27372#issuecomment-1032553656","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/27372","id":1032553656,"node_id":"IC_kwDOAPaMMs49i4S4","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-08T12:25:52Z","updated_at":"2022-02-08T12:25:52Z","body":"Oops, you're right - I got tangled up here between the various scenarios. Will think about this some more and post something later.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1032553656/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}}]