[{"id":10392784020,"node_id":"LE_lADOAPaMMs5xQMUYzwAAAAJrdUyU","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784020","actor":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-09-13T10:54:01Z","label":{"name":"tenet-performance","color":"c2e0c6"},"performed_via_github_app":null},{"id":10392784023,"node_id":"LE_lADOAPaMMs5xQMUYzwAAAAJrdUyX","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784023","actor":null,"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-09-13T10:54:08Z","label":{"name":"untriaged","color":"fbca04"},"performed_via_github_app":null},{"id":10392784025,"node_id":"UE_lADOAPaMMs5xQMUYzwAAAAJrdUyZ","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784025","actor":{"login":"ChrisDenton","id":4459874,"node_id":"MDQ6VXNlcjQ0NTk4NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/4459874?v=4","gravatar_id":"","url":"https://api.github.com/users/ChrisDenton","html_url":"https://github.com/ChrisDenton","followers_url":"https://api.github.com/users/ChrisDenton/followers","following_url":"https://api.github.com/users/ChrisDenton/following{/other_user}","gists_url":"https://api.github.com/users/ChrisDenton/gists{/gist_id}","starred_url":"https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChrisDenton/subscriptions","organizations_url":"https://api.github.com/users/ChrisDenton/orgs","repos_url":"https://api.github.com/users/ChrisDenton/repos","events_url":"https://api.github.com/users/ChrisDenton/events{/privacy}","received_events_url":"https://api.github.com/users/ChrisDenton/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unsubscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-13T10:58:26Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684380","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722684380","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722684380,"node_id":"IC_kwDOAPaMMs5mrhPc","user":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-13T15:28:30Z","updated_at":"2023-09-13T15:28:30Z","body":"> If I take a dump 30 minutes later, it still shows this frame with this same data in this thread.\r\n\r\nThis fragment does not show the handle of the method being finalized. It is not a proof that the finalizer is stuck finalizing the same dynamic method. What is the full stacktrace from `k` command? Can you find the handle of the method being finalized from it?\r\n\r\nThe most likely explanation of the symptoms is that each request produces one or more DynamicMethods and the finalizer thread is not able to clean them up fast enough. Try to find out what is producing these dynamic methods. The dynamic methods are typically meant to be cached, and it is not unusual to a have a bug where it is not happening.\r\n\r\nThe problem can be magnified by enable tracing. Tracing makes the cleanup of DynamicMethods more expensive and so it makes it more likely that the finalizer thread won't be able to keep up with high DynamicMethod churn.  ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684381","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722684381","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722684381,"node_id":"IC_kwDOAPaMMs5mrhPd","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-13T15:29:50Z","updated_at":"2023-09-13T15:29:50Z","body":"Tagging subscribers to this area: @dotnet/gc\nSee info in [area-owners.md](https://github.com/dotnet/runtime/blob/main/docs/area-owners.md) if you want to be subscribed.\n<details>\n<summary>Issue Details</summary>\n<hr />\n\n### Description\r\n\r\nWhen our application reaches ~1700 Rps and ~85% Cpu usage per server during a short period of time due a traffic spike, around a 25% of our servers experiment what it seems to be a blockage in the finalizer thread and the application starts hoarding memory and increasing latency. Eventually we have to kill the server when memory is at 10X of what it uses normally and latency is not acceptable.\r\n\r\nExploring with dotnet-dump, we see that after the requests spike the finalizer queue starts to accumulate objects.  Taking multiple dumps shows that the \"Ready for finalization\" keep growing in each heap.\r\n\r\nWhen exploring the threads, there is always a thread `0x001B` that is stuck in this frame:\r\n\r\n```\r\n> clrstack -a                                                                                                                                                                                                                     \r\nOS Thread Id: 0x1b (21)\r\n        Child SP               IP Call Site\r\n00007F0002EC9930 00007f00081947b2 [InlinedCallFrame: 00007f0002ec9930] \r\n00007F0002EC9930 00007eff88696957 [InlinedCallFrame: 00007f0002ec9930] \r\n00007F0002EC9920 00007EFF88696957 System.RuntimeMethodHandle.Destroy(System.RuntimeMethodHandleInternal)\r\n    PARAMETERS:\r\n        method = <no data>\r\n\r\n00007F0002EC99C0 00007EFF9623E087 System.Reflection.Emit.DynamicResolver+DestroyScout.Finalize() [/_/src/coreclr/System.Private.CoreLib/src/System/Reflection/Emit/DynamicILGenerator.cs @ 669]\r\n    PARAMETERS:\r\n        this = <no data>\r\n\r\n00007F0002EC9D30 00007f0007957cc6 [DebuggerU2MCatchHandlerFrame: 00007f0002ec9d30] \r\n```\r\nIf I take a dump 30 minutes later, it still shows this frame with this same data in this thread.\r\n\r\n\r\nThose servers keep having a higher % of time in GC\r\n![image](https://github.com/dotnet/runtime/assets/704420/16f7269a-e55a-4437-91cd-7e0d07c5be42)\r\n\r\n### Configuration\r\n\r\nServer is an Azure [Standard_F16s_v2](https://learn.microsoft.com/en-us/azure/virtual-machines/fsv2-series) (16 cores, 32 GiB RAM).\r\n\r\nDocker image `mcr.microsoft.com/dotnet/aspnet:7.0.11`.\r\n\r\n```\r\n# dotnet --info                                                                                                                                                                               \r\n\r\nHost:\r\n  Version:      7.0.11\r\n  Architecture: x64\r\n  Commit:       ecb34f85ec\r\n\r\n.NET SDKs installed:\r\n  No SDKs were found.\r\n\r\n.NET runtimes installed:\r\n  Microsoft.AspNetCore.App 7.0.11 [/usr/share/dotnet/shared/Microsoft.AspNetCore.App]\r\n  Microsoft.NETCore.App 7.0.11 [/usr/share/dotnet/shared/Microsoft.NETCore.App]\r\n\r\n```\r\n\r\n```\r\n# uname -a\r\nLinux live-api-75fcf998d-hcwvz 5.15.0-1041-azure dotnet/runtime#48-Ubuntu SMP Tue Jun 20 20:34:08 UTC 2023 x86_64 GNU/Linux\r\n```\r\n\r\n### Regression?\r\n\r\nWe are not completely sure, but we have the feeling it started happening when we moved to .NET7 from .NET6.\r\nWhen we were in .NET6 we did not do see this kind of situation. After we moved to .NET7 we started seeing some machines using an unexpected big amount of memory that starts on a traffic spike situation.\r\n\r\n### Data\r\n\r\n```\r\n> syncblk                                                                                                                                                                                                                         \r\nIndex         SyncBlock MonitorHeld Recursion Owning Thread Info          SyncBlock Owner\r\n-----------------------------\r\nTotal           2661\r\nFree            793\r\n\r\n```\r\n\r\n```\r\n> finalizequeue -stat                                                                                                                                                                                                             \r\nSyncBlocks to be cleaned up: 0\r\nFree-Threaded Interfaces to be released: 0\r\nMTA Interfaces to be released: 0\r\nSTA Interfaces to be released: 0\r\n----------------------------------\r\n\r\nHeap 0\r\ngeneration 0 has 29 objects (7ef79c121920->7ef79c121a08)\r\ngeneration 1 has 2,464 objects (7ef79c11cc20->7ef79c121920)\r\ngeneration 2 has 0 objects (7ef79c11cc20->7ef79c11cc20)\r\nReady for finalization 560 objects (7ef79c123438->7ef79c1245b8)\r\n------------------------------\r\nHeap 1\r\ngeneration 0 has 5 objects (7ef5f820ada8->7ef5f820add0)\r\ngeneration 1 has 2,013 objects (7ef5f8206ec0->7ef5f820ada8)\r\ngeneration 2 has 0 objects (7ef5f8206ec0->7ef5f8206ec0)\r\nReady for finalization 309 objects (7ef5f820b480->7ef5f820be28)\r\n------------------------------\r\nHeap 2\r\ngeneration 0 has 7 objects (7ef5bc101488->7ef5bc1014c0)\r\ngeneration 1 has 1,409 objects (7ef5bc0fe880->7ef5bc101488)\r\ngeneration 2 has 0 objects (7ef5bc0fe880->7ef5bc0fe880)\r\nReady for finalization 321 objects (7ef5bc101ea0->7ef5bc1028a8)\r\n------------------------------\r\nHeap 3\r\ngeneration 0 has 14 objects (7ef6142535b8->7ef614253628)\r\ngeneration 1 has 1,295 objects (7ef614250d40->7ef6142535b8)\r\ngeneration 2 has 0 objects (7ef614250d40->7ef614250d40)\r\nReady for finalization 321 objects (7ef6142540a0->7ef614254aa8)\r\n------------------------------\r\nHeap 4\r\ngeneration 0 has 2 objects (7ef7a0bbfa88->7ef7a0bbfa98)\r\ngeneration 1 has 729 objects (7ef7a0bbe3c0->7ef7a0bbfa88)\r\ngeneration 2 has 0 objects (7ef7a0bbe3c0->7ef7a0bbe3c0)\r\nReady for finalization 322 objects (7ef7a0bc05c0->7ef7a0bc0fd0)\r\n------------------------------\r\nHeap 5\r\ngeneration 0 has 10 objects (7eff84129200->7eff84129250)\r\ngeneration 1 has 992 objects (7eff84127300->7eff84129200)\r\ngeneration 2 has 0 objects (7eff84127300->7eff84127300)\r\nReady for finalization 388 objects (7eff84129bd0->7eff8412a7f0)\r\n------------------------------\r\nHeap 6\r\ngeneration 0 has 5 objects (7ef694166578->7ef6941665a0)\r\ngeneration 1 has 1,511 objects (7ef694163640->7ef694166578)\r\ngeneration 2 has 0 objects (7ef694163640->7ef694163640)\r\nReady for finalization 339 objects (7ef694166fa8->7ef694167a40)\r\n------------------------------\r\nHeap 7\r\ngeneration 0 has 2 objects (7ef65c27acc0->7ef65c27acd0)\r\ngeneration 1 has 1,692 objects (7ef65c2777e0->7ef65c27acc0)\r\ngeneration 2 has 0 objects (7ef65c2777e0->7ef65c2777e0)\r\nReady for finalization 316 objects (7ef65c27b690->7ef65c27c070)\r\n------------------------------\r\nHeap 8\r\ngeneration 0 has 5 objects (7ef79c180c20->7ef79c180c48)\r\ngeneration 1 has 594 objects (7ef79c17f990->7ef79c180c20)\r\ngeneration 2 has 0 objects (7ef79c17f990->7ef79c17f990)\r\nReady for finalization 376 objects (7ef79c1818f0->7ef79c1824b0)\r\n------------------------------\r\nHeap 9\r\ngeneration 0 has 7 objects (7ef770377290->7ef7703772c8)\r\ngeneration 1 has 832 objects (7ef770375890->7ef770377290)\r\ngeneration 2 has 0 objects (7ef770375890->7ef770375890)\r\nReady for finalization 388 objects (7ef770377bd0->7ef7703787f0)\r\n------------------------------\r\nHeap 10\r\ngeneration 0 has 10 objects (7ef79c245ce0->7ef79c245d30)\r\ngeneration 1 has 804 objects (7ef79c2443c0->7ef79c245ce0)\r\ngeneration 2 has 0 objects (7ef79c2443c0->7ef79c2443c0)\r\nReady for finalization 390 objects (7ef79c246408->7ef79c247038)\r\n------------------------------\r\nHeap 11\r\ngeneration 0 has 8 objects (7ef6881c80c8->7ef6881c8108)\r\ngeneration 1 has 1,297 objects (7ef6881c5840->7ef6881c80c8)\r\ngeneration 2 has 0 objects (7ef6881c5840->7ef6881c5840)\r\nReady for finalization 327 objects (7ef6881c8b78->7ef6881c95b0)\r\n------------------------------\r\nHeap 12\r\ngeneration 0 has 10 objects (7ef79c2af180->7ef79c2af1d0)\r\ngeneration 1 has 2,222 objects (7ef79c2aac10->7ef79c2af180)\r\ngeneration 2 has 0 objects (7ef79c2aac10->7ef79c2aac10)\r\nReady for finalization 485 objects (7ef79c2afc38->7ef79c2b0b60)\r\n------------------------------\r\nHeap 13\r\ngeneration 0 has 13 objects (7ef74815af60->7ef74815afc8)\r\ngeneration 1 has 350 objects (7ef74815a470->7ef74815af60)\r\ngeneration 2 has 0 objects (7ef74815a470->7ef74815a470)\r\nReady for finalization 329 objects (7ef74815b948->7ef74815c390)\r\n------------------------------\r\nHeap 14\r\ngeneration 0 has 8 objects (7ef79c79e070->7ef79c79e0b0)\r\ngeneration 1 has 322 objects (7ef79c79d660->7ef79c79e070)\r\ngeneration 2 has 0 objects (7ef79c79d660->7ef79c79d660)\r\nReady for finalization 25,489 objects (7ef79c79e9b8->7ef79c7d0640)\r\n------------------------------\r\nHeap 15\r\ngeneration 0 has 7 objects (7ef6802dadd0->7ef6802dae08)\r\ngeneration 1 has 508 objects (7ef6802d9df0->7ef6802dadd0)\r\ngeneration 2 has 0 objects (7ef6802d9df0->7ef6802d9df0)\r\nReady for finalization 404,766 objects (7ef6802db588->7ef6805f1e78)\r\n------------------------------\r\nStatistics for all finalizable objects (including all objects ready for finalization):\r\nStatistics:\r\n          MT   Count  TotalSize Class Name\r\n\r\n[...]\r\n\r\n7eff8de90098     538     17,216 Microsoft.Win32.SafeHandles.SafeEvpMdCtxHandle\r\n7eff917fa6f8      70     18,480 Microsoft.Data.SqlClient.SNI.SNISslStream\r\n7eff90117f28     355     19,880 System.Runtime.CompilerServices.ConditionalWeakTable<System.Text.Json.JsonSerializerOptions, System.Object>+Container\r\n7eff9433c1f0     361     20,216 System.IO.Compression.Deflater\r\n7eff8c2c7b88     316     20,224 System.Net.Sockets.SafeSocketHandle\r\n7eff8d8ce2c8     663     21,216 Microsoft.Win32.SafeHandles.SafeX509Handle\r\n7eff8d830920   1,255     30,120 System.Threading.TimerHolder\r\n7eff9433efe8     394     31,520 System.IO.Compression.ZLibNative+ZLibStreamHandle\r\n7eff8c2c5228     316     37,920 System.Net.Sockets.Socket\r\n7eff927f5370     180     44,640 Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.Internal.SocketReceiver\r\n7eff8d859958     223     62,440 System.Net.Sockets.Socket+AwaitableSocketAsyncEventArgs\r\n7eff9146acb8     389     80,912 Microsoft.Data.SqlClient.SqlConnection\r\n7eff9149f348     980    290,080 Microsoft.Data.SqlClient.SqlCommand\r\n7eff89253d70   4,192    301,824 System.Threading.Thread\r\n7eff90b81468 247,708  5,944,992 System.Reflection.Emit.DynamicResolver+DestroyScout\r\n7eff8ad24450 199,413 14,357,736 System..Reflection.Emit.DynamicResolver\r\nTotal 460,012 objects, 21,441,768 bytes\r\n```\r\n\r\n```\r\n> dumpheap -stat\r\n\r\n[...]\r\n\r\n7eff8acfc688   207,010   9,936,480 System.Reflection.Emit.DynamicMethod+RTDynamicMethod\r\n7eff8ad200a8   207,010   9,936,480 System.Reflection.Emit.ScopeTree\r\n7eff8acfcf68   208,325   9,999,600 System.Reflection.Emit.SignatureHelper\r\n7eff8919ec38   605,088  14,522,112 System.RuntimeTypeHandle\r\n7eff8ad24450   207,001  14,904,072 System.Reflection.Emit.DynamicResolver\r\n7eff89817a20   212,441  20,394,336 System.RuntimeMethodInfoStub\r\n7eff8acfbda0   207,010  23,185,120 System.Reflection.Emit.DynamicMethod\r\n7eff8912a508   358,123  25,959,536 System.Object[]\r\n7eff8acfb6e8   207,010  31,465,520 System.Reflection.Emit.DynamicILGenerator\r\n7eff89251038 1,241,746 120,095,736 System.String\r\n7eff89773338 1,070,259 136,469,834 System.Byte[]\r\n7eff892b7aa8    90,512 260,066,802 System.Char[]\r\n55fb5eb4e900    55,769 364,019,016 Free\r\nTotal 10,141,843 objects, 1,321,079,065 bytes\r\n```\r\n\r\n```\r\n[System.Runtime]\r\n    % Time in GC since last GC (%)                                         5    \r\n    Allocation Rate (B / 1 sec)                                       6.2155e+08   \r\n    CPU Usage (%)                                                         57.81 \r\n    Exception Count (Count / 1 sec)                                       94    \r\n    GC Committed Bytes (MB)                                            1,675.366\r\n    GC Fragmentation (%)                                                  44.356\r\n    GC Heap Size (MB)                                                    637.815\r\n    Gen 0 GC Count (Count / 1 sec)                                         2    \r\n    Gen 0 Size (B)                                                 4,236,872    \r\n    Gen 1 GC Count (Count / 1 sec)                                         1    \r\n    Gen 1 Size (B)                                                11,126,616    \r\n    Gen 2 GC Count (Count / 1 sec)                                         0    \r\n    Gen 2 Size (B)                                                    5.2245e+08   \r\n    IL Bytes Jitted (B)                                               3.1923e+08   \r\n    LOH Size (B)                                                      5.7157e+08   \r\n    Monitor Lock Contention Count (Count / 1 sec)                      1,212    \r\n    Number of Active Timers                                               46    \r\n    Number of Assemblies Loaded                                          252    \r\n    Number of Methods Jitted                                       9,647,443    \r\n    POH (Pinned Object Heap) Size (B)                              4,465,760    \r\n    ThreadPool Completed Work Item Count (Count / 1 sec)              23,982    \r\n```\r\n\n\n<table>\n  <tr>\n    <th align=\"left\">Author:</th>\n    <td>vtortola</td>\n  </tr>\n  <tr>\n    <th align=\"left\">Assignees:</th>\n    <td>-</td>\n  </tr>\n  <tr>\n    <th align=\"left\">Labels:</th>\n    <td>\n\n`tenet-performance`, `area-GC-coreclr`, `untriaged`, `needs-area-label`\n\n</td>\n  </tr>\n  <tr>\n    <th align=\"left\">Milestone:</th>\n    <td>-</td>\n  </tr>\n</table>\n</details>","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10392784028,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrdUyc","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784028","actor":{"login":"cshung","id":3410332,"node_id":"MDQ6VXNlcjM0MTAzMzI=","avatar_url":"https://avatars.githubusercontent.com/u/3410332?v=4","gravatar_id":"","url":"https://api.github.com/users/cshung","html_url":"https://github.com/cshung","followers_url":"https://api.github.com/users/cshung/followers","following_url":"https://api.github.com/users/cshung/following{/other_user}","gists_url":"https://api.github.com/users/cshung/gists{/gist_id}","starred_url":"https://api.github.com/users/cshung/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cshung/subscriptions","organizations_url":"https://api.github.com/users/cshung/orgs","repos_url":"https://api.github.com/users/cshung/repos","events_url":"https://api.github.com/users/cshung/events{/privacy}","received_events_url":"https://api.github.com/users/cshung/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-13T15:29:50Z","performed_via_github_app":null},{"id":10392784031,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrdUyf","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784031","actor":{"login":"Maoni0","id":10837357,"node_id":"MDQ6VXNlcjEwODM3MzU3","avatar_url":"https://avatars.githubusercontent.com/u/10837357?v=4","gravatar_id":"","url":"https://api.github.com/users/Maoni0","html_url":"https://github.com/Maoni0","followers_url":"https://api.github.com/users/Maoni0/followers","following_url":"https://api.github.com/users/Maoni0/following{/other_user}","gists_url":"https://api.github.com/users/Maoni0/gists{/gist_id}","starred_url":"https://api.github.com/users/Maoni0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Maoni0/subscriptions","organizations_url":"https://api.github.com/users/Maoni0/orgs","repos_url":"https://api.github.com/users/Maoni0/repos","events_url":"https://api.github.com/users/Maoni0/events{/privacy}","received_events_url":"https://api.github.com/users/Maoni0/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-13T15:29:50Z","performed_via_github_app":null},{"id":10392784035,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrdUyj","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784035","actor":{"login":"markples","id":25672677,"node_id":"MDQ6VXNlcjI1NjcyNjc3","avatar_url":"https://avatars.githubusercontent.com/u/25672677?v=4","gravatar_id":"","url":"https://api.github.com/users/markples","html_url":"https://github.com/markples","followers_url":"https://api.github.com/users/markples/followers","following_url":"https://api.github.com/users/markples/following{/other_user}","gists_url":"https://api.github.com/users/markples/gists{/gist_id}","starred_url":"https://api.github.com/users/markples/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markples/subscriptions","organizations_url":"https://api.github.com/users/markples/orgs","repos_url":"https://api.github.com/users/markples/repos","events_url":"https://api.github.com/users/markples/events{/privacy}","received_events_url":"https://api.github.com/users/markples/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-13T15:29:50Z","performed_via_github_app":null},{"id":10392784036,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrdUyk","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784036","actor":{"login":"mangod9","id":61718172,"node_id":"MDQ6VXNlcjYxNzE4MTcy","avatar_url":"https://avatars.githubusercontent.com/u/61718172?v=4","gravatar_id":"","url":"https://api.github.com/users/mangod9","html_url":"https://github.com/mangod9","followers_url":"https://api.github.com/users/mangod9/followers","following_url":"https://api.github.com/users/mangod9/following{/other_user}","gists_url":"https://api.github.com/users/mangod9/gists{/gist_id}","starred_url":"https://api.github.com/users/mangod9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mangod9/subscriptions","organizations_url":"https://api.github.com/users/mangod9/orgs","repos_url":"https://api.github.com/users/mangod9/repos","events_url":"https://api.github.com/users/mangod9/events{/privacy}","received_events_url":"https://api.github.com/users/mangod9/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-13T15:29:51Z","performed_via_github_app":null},{"id":10392784039,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrdUyn","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784039","actor":{"login":"mrsharm","id":68247673,"node_id":"MDQ6VXNlcjY4MjQ3Njcz","avatar_url":"https://avatars.githubusercontent.com/u/68247673?v=4","gravatar_id":"","url":"https://api.github.com/users/mrsharm","html_url":"https://github.com/mrsharm","followers_url":"https://api.github.com/users/mrsharm/followers","following_url":"https://api.github.com/users/mrsharm/following{/other_user}","gists_url":"https://api.github.com/users/mrsharm/gists{/gist_id}","starred_url":"https://api.github.com/users/mrsharm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrsharm/subscriptions","organizations_url":"https://api.github.com/users/mrsharm/orgs","repos_url":"https://api.github.com/users/mrsharm/repos","events_url":"https://api.github.com/users/mrsharm/events{/privacy}","received_events_url":"https://api.github.com/users/mrsharm/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-13T15:29:51Z","performed_via_github_app":null},{"id":10392784045,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrdUyt","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784045","actor":{"login":"turbedi","id":5059753,"node_id":"MDQ6VXNlcjUwNTk3NTM=","avatar_url":"https://avatars.githubusercontent.com/u/5059753?v=4","gravatar_id":"","url":"https://api.github.com/users/turbedi","html_url":"https://github.com/turbedi","followers_url":"https://api.github.com/users/turbedi/followers","following_url":"https://api.github.com/users/turbedi/following{/other_user}","gists_url":"https://api.github.com/users/turbedi/gists{/gist_id}","starred_url":"https://api.github.com/users/turbedi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/turbedi/subscriptions","organizations_url":"https://api.github.com/users/turbedi/orgs","repos_url":"https://api.github.com/users/turbedi/repos","events_url":"https://api.github.com/users/turbedi/events{/privacy}","received_events_url":"https://api.github.com/users/turbedi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-13T16:03:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684384","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722684384","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722684384,"node_id":"IC_kwDOAPaMMs5mrhPg","user":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-13T16:20:28Z","updated_at":"2023-09-13T18:17:15Z","body":"> What is the full stacktrace from k command? Can you find the handle of the method being finalized from it?\r\n\r\nI am using dotnet-dump to analyze the memory dump, can that be found out with it?\r\n\r\n> The most likely explanation of the symptoms is that each request produces one or more DynamicMethods and the finalizer thread is not able to clean them up fast enough. \r\n\r\nNote this happens due a traffic spike that lasts just a few minutes. After that most of servers memory levels go back to normal when traffic volume gets back to normal, it is just a few of them that memory keeps growing and latency is getting worse despite of being receiving the same traffic than the rest of servers.\r\n\r\n> Try to find out what is producing these dynamic methods. The dynamic methods are typically meant to be cached, and it is not unusual to a have a bug where it is not happening.\r\n\r\nTracking those references using `gcroot` it seems to be mostly Entity Framework and System.Text.Json. We do not do much reflection by ourselves.\r\n\r\n> The problem can be magnified by enable tracing. Tracing makes the cleanup of DynamicMethods more expensive and so it makes it more likely that the finalizer thread won't be able to keep up with high DynamicMethod churn.\r\n\r\nWe do not have tracing enabled.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684385","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722684385","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722684385,"node_id":"IC_kwDOAPaMMs5mrhPh","user":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-13T20:25:29Z","updated_at":"2023-09-13T20:25:29Z","body":"> I am using dotnet-dump to analyze the memory dump, can that be found out with it?\r\n\r\ndotnet-dump is not able to printnative stacktraces. The dump has to be opened in native debugger for that. https://learn.microsoft.com/en-us/dotnet/core/diagnostics/debug-linux-dumps or https://learn.microsoft.com/en-us/troubleshoot/developer/webapps/aspnetcore/practice-troubleshoot-linux/lab-1-2-analyze-core-dumps-lldb-debugger have instructions for how to do that.\r\n\r\n> it seems to be mostly Entity Framework and System.Text.Json. We do not do much reflection by ourselves.\r\n\r\nThe way you are calling into Entity Framework and System.Text.Json may be creating too many dynamic methods that leads to the problem. For example, are you reusing JsonSerializationOptions instances - https://learn.microsoft.com/dotnet/standard/serialization/system-text-json/configure-options#reuse-jsonserializeroptions-instances ? \r\n\r\nIdeally, you should not see any dynamic methods created and destroyed per request in steady state.\r\n\r\n> We do not have tracing enabled.\r\n\r\nThe monitoring software may be enabling tracing for you. How are you producing the graph with GC utilization you have shared above? It is mostly likely done via tracing.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684386","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722684386","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722684386,"node_id":"IC_kwDOAPaMMs5mrhPi","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-14T13:22:43Z","updated_at":"2023-09-14T13:22:43Z","body":"This issue has been marked `needs-author-action` and may be missing some important information.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684386/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684387","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722684387","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722684387,"node_id":"IC_kwDOAPaMMs5mrhPj","user":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T21:39:00Z","updated_at":"2023-09-17T16:24:14Z","body":"Thank you. I will try getting than information from the dump. \r\n\r\nYes, we cache the JsonSerializationOptions.\r\n\r\nWe get that GC metric ftom Event Counters.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684389","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722684389","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722684389,"node_id":"IC_kwDOAPaMMs5mrhPl","user":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-17T16:41:27Z","updated_at":"2023-09-17T21:48:34Z","body":"I have LLDB installed now. I can see the backtrace of the thread in question:\r\n\r\n```\r\n(lldb) setthread 22\r\n\r\n(lldb) clrstack\r\nOS Thread Id: 0x1b (22)\r\n        Child SP               IP Call Site\r\n00007F71C8784930 00007f71cda917b2 [InlinedCallFrame: 00007f71c8784930] \r\n00007F71C8784930 00007f714dfa6957 [InlinedCallFrame: 00007f71c8784930] \r\n00007F71C8784920 00007F714DFA6957 System.RuntimeMethodHandle.Destroy(System.RuntimeMethodHandleInternal)\r\n00007F71C87849C0 00007F715748F237 System.Reflection.Emit.DynamicResolver+DestroyScout.Finalize() [/_/src/coreclr/System.Private.CoreLib/src/System/Reflection/Emit/DynamicILGenerator.cs @ 669]\r\n00007F71C8784D30 00007f71cd254af6 [DebuggerU2MCatchHandlerFrame: 00007f71c8784d30] \r\n\r\n(lldb) thread backtrace\r\n* thread dotnet/runtime#22, stop reason = signal 0\r\n  * frame #0: 0x00007f71cda917b2 libpthread.so.0`pthread_cond_wait@@GLIBC_2.3.2 + 482\r\n    frame dotnet/runtime#1: 0x00007f71cd3d0481 libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] void VolatileStore<PalCsInitState>(pt=0x00005617b1779048, val=PalCsFullyInitialized) at volatile.h:271:23\r\n    frame dotnet/runtime#2: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] Volatile<PalCsInitState>::Store(this=0x00005617b1779048) at volatile.h:393\r\n    frame dotnet/runtime#3: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] Volatile<PalCsInitState>::operator=(this=0x00005617b1779048, val=PalCsFullyInitialized) at volatile.h:434\r\n    frame dotnet/runtime#4: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) at cs.cpp:1117\r\n    frame dotnet/runtime#5: 0x00007f71cd3d0436 libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] CorUnix::PALCS_WaitOnCS(pPalCriticalSection=0x00005617b1779028, lInc=<unavailable>) at cs.cpp:1159\r\n    frame dotnet/runtime#6: 0x00007f71cd3d0380 libcoreclr.so`CorUnix::InternalEnterCriticalSection(pThread=<unavailable>, pCriticalSection=0x00005617b1779028) at cs.cpp:802\r\n    frame dotnet/runtime#7: 0x00007f71ccf961c4 libcoreclr.so`CrstBase::Enter(this=0x00005617b1779028) at crst.cpp:322:5\r\n    frame dotnet/runtime#8: 0x00007f71cd38cf3f libcoreclr.so`EEJitManager::Unload(this=0x00007f2ec80d9340, pAllocator=0x00007f71cd473eb8) at codeman.cpp:3600:21\r\n    frame dotnet/runtime#9: 0x00007f71ccf9e22b libcoreclr.so`LCGMethodResolver::Destroy(this=0x00007f7168112010) at dynamicmethod.cpp:1022:31\r\n    frame dotnet/runtime#10: 0x00007f71ccf9dff7 libcoreclr.so`DynamicMethodDesc::Destroy(this=0x00007f71680ff738) at dynamicmethod.cpp:893:29\r\n    frame dotnet/runtime#11: 0x00007f71cd154206 libcoreclr.so`RuntimeMethodHandle::GetMethodBody(pMethodUNSAFE=<unavailable>, pDeclaringTypeUNSAFE=<unavailable>) at runtimehandles.cpp:2370:9\r\n    frame dotnet/runtime#12: 0x00007f714dfa6964\r\n    frame dotnet/runtime#13: 0x00007f715748f237\r\n    frame dotnet/runtime#14: 0x00007f71cd254af6 libcoreclr.so`VarargPInvokeGenILStub at unixasmmacrosamd64.inc:871\r\n    frame dotnet/runtime#15: 0x00007f71cd00163c libcoreclr.so`MethodTable::CallFinalizer(Object*) at methodtable.cpp:4050:5\r\n    frame dotnet/runtime#16: 0x00007f71cd0015dc libcoreclr.so`MethodTable::CallFinalizer(obj=0x00007f715748f200) at methodtable.cpp:4168\r\n    frame dotnet/runtime#17: 0x00007f71cd0c9f32 libcoreclr.so`ScanTailCallArgBufferRoots(Thread*, void (*)(Object**, ScanContext*, unsigned int), ScanContext*) [inlined] GCRefMapDecoder::GetBit(this=<unavailable>) at gcrefmap.h:170:30\r\n    frame dotnet/runtime#18: 0x00007f71cd0c9f1e libcoreclr.so`ScanTailCallArgBufferRoots(Thread*, void (*)(Object**, ScanContext*, unsigned int), ScanContext*) [inlined] GCRefMapDecoder::GetInt() at gcrefmap.h:190\r\n    frame dotnet/runtime#19: 0x00007f71cd0c9ecb libcoreclr.so`ScanTailCallArgBufferRoots(Thread*, void (*)(Object**, ScanContext*, unsigned int), ScanContext*) at gcrefmap.h:231\r\n    frame dotnet/runtime#20: 0x00007f71cd0c9e74 libcoreclr.so`ScanTailCallArgBufferRoots(pThread=<unavailable>, fn=(libcoreclr.so`g_szFailFastBuffer + 440), sc=0x00007f71cd475a10)(Object**, ScanContext*, unsigned int), ScanContext*) at gcenv.ee.cpp:210\r\n    frame dotnet/runtime#21: 0x00007f71cd0ca155 libcoreclr.so`GCToEEInterface::SyncBlockCacheDemote(max_gen=-850937008) at gcenv.ee.cpp:371:42\r\n    frame dotnet/runtime#22: 0x00007f71cd04c39a libcoreclr.so at threads.cpp:0\r\n    frame dotnet/runtime#23: 0x00007f71cd04ca3d libcoreclr.so`NativeExceptionHolder<ManagedThreadBase_DispatchOuter(ManagedThreadCallState*)::$_6::operator()(ManagedThreadBase_DispatchOuter(ManagedThreadCallState*)::TryArgs*) const::'lambda'(PAL_SEHException&)>::InvokeFilter(PAL_SEHException&) [inlined] ManagedThreadBase_DispatchOuter(this=0x0000000000000001, ex=0x00007f71cd47b960)::$_6::operator()(ManagedThreadBase_DispatchOuter(ManagedThreadCallState*)::TryArgs*) const::'lambda'(PAL_SEHException&)::operator()(PAL_SEHException&) const at threads.cpp:7502:9\r\n    frame dotnet/runtime#24: 0x00007f71cd04c9f2 libcoreclr.so`NativeExceptionHolder<ManagedThreadBase_DispatchOuter(ManagedThreadCallState*)::$_6::operator()(ManagedThreadBase_DispatchOuter(ManagedThreadCallState*)::TryArgs*) const::'lambda'(PAL_SEHException&)>::InvokeFilter(this=<unavailable>, ex=0x00007f71cd47b960) at pal.h:4902\r\n    frame dotnet/runtime#25: 0x00007f71cd0ca3f8 libcoreclr.so`ProfilerShouldTrackConditionalWeakTableElements() at profilepriv.h:193:37\r\n    frame dotnet/runtime#26: 0x00007f71cd0ca3eb libcoreclr.so`ProfilerShouldTrackConditionalWeakTableElements() [inlined] void ProfControlBlock::IterateProfilers<void (*)(ProfilerInfo*, int (*)(ProfilerInfo*), int (*)(EEToProfInterfaceImpl*, int*), int*, int*), int (*)(ProfilerInfo*), int (*)(EEToProfInterfaceImpl*, int*), int*, int*>(this=0x00007f71c8784e00, callbackType=ActiveOrInitializing)(ProfilerInfo*, int (*)(ProfilerInfo*), int (*)(EEToProfInterfaceImpl*, int*), int*, int*), int (*)(ProfilerInfo*), int (*)(EEToProfInterfaceImpl*, int*), int*, int*) at profilepriv.h:207\r\n    frame dotnet/runtime#27: 0x00007f71cd0ca3eb libcoreclr.so`ProfilerShouldTrackConditionalWeakTableElements() [inlined] int ProfControlBlock::DoProfilerCallback<int (*)(ProfilerInfo*), int (*)(EEToProfInterfaceImpl*, int*), int*>(this=0x00007f71c8784e00, callbackType=ActiveOrInitializing)(ProfilerInfo*), int (*)(EEToProfInterfaceImpl*, int*), int*) at profilepriv.h:295\r\n    frame dotnet/runtime#28: 0x00007f71cd0ca3eb libcoreclr.so`ProfilerShouldTrackConditionalWeakTableElements() [inlined] int AnyProfilerPassesCondition<int (*)(ProfilerInfo*)>(int (*)(ProfilerInfo*)) at profilepriv.inl:101\r\n    frame dotnet/runtime#29: 0x00007f71cd0ca3eb libcoreclr.so`ProfilerShouldTrackConditionalWeakTableElements() [inlined] ProfControlBlock::IsCallback5Supported(this=0x00007f71c8784e00) at profilepriv.inl:263\r\n    frame dotnet/runtime#30: 0x00007f71cd0ca3eb libcoreclr.so`ProfilerShouldTrackConditionalWeakTableElements() [inlined] CORProfilerTrackConditionalWeakTableElements() at profilepriv.inl:1980\r\n    frame dotnet/runtime#31: 0x00007f71cd0ca3cc libcoreclr.so`ProfilerShouldTrackConditionalWeakTableElements() at gcenv.ee.cpp:548\r\n    frame dotnet/runtime#32: 0x00007f71cd3e1cee libcoreclr.so`::ExitThread(dwExitCode=<unavailable>) at thread.cpp:826:5\r\n    frame dotnet/runtime#33: 0x00007f71cda8aea7 libpthread.so.0`start_thread + 215\r\n    frame dotnet/runtime#34: 0x00007f71cd679a2f libc.so.6`__clone + 63\r\n```\r\n\r\nUnfortunately I only have this dump. I will force the situation again in the next few days and take two of them.\r\n\r\nFrom the CLR thread stacks, I see 108 threads which top stackframes are :\r\n\r\n```\r\nSystem.Runtime.CompilerServices.RuntimeHelpers.CompileMethod(System.RuntimeMethodHandleInternal)\r\nSystem.Runtime.CompilerServices.RuntimeHelpers.CompileMethod(System.RuntimeMethodHandleInternal)\r\nSystem.Reflection.Emit.DynamicMethod.CreateDelegate(System.Type, System.Object) [/_/src/coreclr/System.Private.CoreLib/src/System/Reflection/Emit/DynamicMethod.cs @ 370]\r\nSystem.Linq.Expressions.Compiler.LambdaCompiler.Compile(System.Linq.Expressions.LambdaExpression) [/_/src/libraries/System.Linq.Expressions/src/System/Linq/Expressions/Compiler/LambdaCompiler.cs @ 190]\r\n00007F3A4EFFA620 00007F7D2FC45A31 System.Linq.Expressions.Expression`1[[System.__Canon, System.Private.CoreLib]].Compile() [/_/src/libraries/System.Linq.Expressions/src/System/Linq/Expressions/LambdaExpression.cs @ 221]\r\nMicrosoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.GetValue(System.Linq.Expressions.Expression, System.String ByRef)\r\n\r\n```\r\nWhen comparing with a healthy application dump, only one thread was using `CreateDelegate`.\r\nIf that `CompileMethod` is being slow for some reason may explain why the whole application becomes slow.\r\n\r\nChecking some of those thread's backtrace I see they are also blocked on `pthread_cond_wait`:\r\n\r\n```\r\n(lldb) thread backtrace\r\n* thread dotnet/runtime#76, stop reason = signal 0\r\n  * frame #0: 0x00007f71cda917b2 libpthread.so.0`pthread_cond_wait@@GLIBC_2.3.2 + 482\r\n    frame dotnet/runtime#1: 0x00007f71cd3d0481 libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] void VolatileStore<PalCsInitState>(pt=0x00005617b1779048, val=PalCsFullyInitialized) at volatile.h:271:23\r\n    frame dotnet/runtime#2: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] Volatile<PalCsInitState>::Store(this=0x00005617b1779048) at volatile.h:393\r\n    frame dotnet/runtime#3: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] Volatile<PalCsInitState>::operator=(this=0x00005617b1779048, val=PalCsFullyInitialized) at volatile.h:434\r\n    frame dotnet/runtime#4: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) at cs.cpp:1117\r\n    frame dotnet/runtime#5: 0x00007f71cd3d0436 libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] CorUnix::PALCS_WaitOnCS(pPalCriticalSection=0x00005617b1779028, lInc=<unavailable>) at cs.cpp:1159\r\n    frame dotnet/runtime#6: 0x00007f71cd3d0380 libcoreclr.so`CorUnix::InternalEnterCriticalSection(pThread=<unavailable>, pCriticalSection=0x00005617b1779028) at cs.cpp:802\r\n    frame dotnet/runtime#7: 0x00007f71ccf961c4 libcoreclr.so`CrstBase::Enter(this=0x00005617b1779028) at crst.cpp:322:5\r\n    frame dotnet/runtime#8: 0x00007f71cd38dcc3 libcoreclr.so`EEJitManager::LazyGetFunctionEntry(this=<unavailable>, pCodeInfo=<unavailable>) at codeman.cpp:4279:82\r\n```\r\n\r\n```\r\n(lldb) thread backtrace\r\n* thread dotnet/runtime#77, stop reason = signal 0\r\n  * frame #0: 0x00007f71cda917b2 libpthread.so.0`pthread_cond_wait@@GLIBC_2.3.2 + 482\r\n    frame dotnet/runtime#1: 0x00007f71cd3d0481 libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] void VolatileStore<PalCsInitState>(pt=0x00005617b1779048, val=PalCsFullyInitialized) at volatile.h:271:23\r\n    frame dotnet/runtime#2: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] Volatile<PalCsInitState>::Store(this=0x00005617b1779048) at volatile.h:393\r\n    frame dotnet/runtime#3: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] Volatile<PalCsInitState>::operator=(this=0x00005617b1779048, val=PalCsFullyInitialized) at volatile.h:434\r\n    frame dotnet/runtime#4: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) at cs.cpp:1117\r\n    frame dotnet/runtime#5: 0x00007f71cd3d0436 libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] CorUnix::PALCS_WaitOnCS(pPalCriticalSection=0x00005617b1779028, lInc=<unavailable>) at cs.cpp:1159\r\n    frame dotnet/runtime#6: 0x00007f71cd3d0380 libcoreclr.so`CorUnix::InternalEnterCriticalSection(pThread=<unavailable>, pCriticalSection=0x00005617b1779028) at cs.cpp:802\r\n    frame dotnet/runtime#7: 0x00007f71ccf961c4 libcoreclr.so`CrstBase::Enter(this=0x00005617b1779028) at crst.cpp:322:5\r\n    frame dotnet/runtime#8: 0x00007f71cd38dcc3 libcoreclr.so`EEJitManager::LazyGetFunctionEntry(this=<unavailable>, pCodeInfo=<unavailable>) at codeman.cpp:4279:82\r\n```\r\n\r\n```\r\n(lldb) thread backtrace\r\n* thread dotnet/runtime#78, stop reason = signal 0\r\n  * frame #0: 0x00007f71cda917b2 libpthread.so.0`pthread_cond_wait@@GLIBC_2.3.2 + 482\r\n    frame dotnet/runtime#1: 0x00007f71cd3d0481 libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] void VolatileStore<PalCsInitState>(pt=0x00005617b1779048, val=PalCsFullyInitialized) at volatile.h:271:23\r\n    frame dotnet/runtime#2: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] Volatile<PalCsInitState>::Store(this=0x00005617b1779048) at volatile.h:393\r\n    frame dotnet/runtime#3: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] Volatile<PalCsInitState>::operator=(this=0x00005617b1779048, val=PalCsFullyInitialized) at volatile.h:434\r\n    frame dotnet/runtime#4: 0x00007f71cd3d047b libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) at cs.cpp:1117\r\n    frame dotnet/runtime#5: 0x00007f71cd3d0436 libcoreclr.so`CorUnix::InternalEnterCriticalSection(CorUnix::CPalThread*, _CRITICAL_SECTION*) [inlined] CorUnix::PALCS_WaitOnCS(pPalCriticalSection=0x00005617b1779028, lInc=<unavailable>) at cs.cpp:1159\r\n    frame dotnet/runtime#6: 0x00007f71cd3d0380 libcoreclr.so`CorUnix::InternalEnterCriticalSection(pThread=<unavailable>, pCriticalSection=0x00005617b1779028) at cs.cpp:802\r\n    frame dotnet/runtime#7: 0x00007f71ccf961c4 libcoreclr.so`CrstBase::Enter(this=0x00005617b1779028) at crst.cpp:322:5\r\n    frame dotnet/runtime#8: 0x00007f71cd38c70c libcoreclr.so`EEJitManager::allocEHInfoRaw(_hpCodeHdr*, unsigned int, unsigned long*) [inlined] MethodDesc::GetClassification(this=0x00007f715d8e7f90) const at method.hpp:1726:17\r\n    frame dotnet/runtime#9: 0x00007f71cd38c70b libcoreclr.so`EEJitManager::allocEHInfoRaw(_hpCodeHdr*, unsigned int, unsigned long*) [inlined] MethodDesc::IsLCGMethod(this=0x00007f715d8e7f90) at method.inl:99\r\n    frame dotnet/runtime#10: 0x00007f71cd38c70b libcoreclr.so`EEJitManager::allocEHInfoRaw(this=<unavailable>, pCodeHeader=<unavailable>, blockSize=2977402920, pAllocationSize=0x00007f2f967f6518) at codeman.cpp:3265\r\n[...]\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684391","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722684391","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722684391,"node_id":"IC_kwDOAPaMMs5mrhPn","user":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T02:46:31Z","updated_at":"2023-09-18T02:46:31Z","body":"> I see 108 threads which top stackframes are :\r\n```\r\nSystem.Linq.Expressions.Expression`1[[System.__Canon, System.Private.CoreLib]].Compile() [/_/src/libraries/System.Linq.Expressions/src/System/Linq/Expressions/LambdaExpression.cs @ 221]\r\nMicrosoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.GetValue(System.Linq.Expressions.Expression, System.String ByRef)\r\n```\r\n\r\nThis is the problem. The EFCore is generating a dynamic method per requiests that is overwhelming the system.\r\n\r\nIt should be fixed in current EF version by https://github.com/dotnet/efcore/pull/29815 . cc @roji ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722684391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10392784049,"node_id":"MEE_lADOAPaMMs5xQMUYzwAAAAJrdUyx","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784049","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-18T02:46:31Z","performed_via_github_app":null},{"id":10392784054,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrdUy2","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784054","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-18T02:46:31Z","performed_via_github_app":null},{"id":10392784103,"node_id":"TRE_lADOAPaMMs5xQMUYzwAAAAJrdUzn","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10392784103","actor":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"transferred","commit_id":null,"commit_url":null,"created_at":"2023-09-18T02:46:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722884456","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722884456","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722884456,"node_id":"IC_kwDOAPaMMs5msSFo","user":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T07:31:31Z","updated_at":"2023-09-18T07:59:36Z","body":"Thank you @jkotas \r\n\r\nFor the record we use Entity Framework 7.0.10 on .NET7. It was also happening with Entity Framework 6.0.6 on .NET7.\r\n\r\nOur application usually reads a single record from the database using `FindAsync`, and loads related entities explicitly depending of the usage.\r\n\r\nWe load related entities both with `Where` and without:\r\n * `await Entry(entity).Collection(u => u.Related).Query().LoadAsync(cancel);`\r\n * `await Entry(entity).Collection(u => u.Related).Query().Where(x => x.Member == \"member\").LoadAsync(cancel);`\r\n\r\nAlthough I can see stack traces using `CreateDelegate` also when calling `FindAsync`:\r\n\r\n```\r\n00007F3B1EFF9408 00007f7da80147b2 [InlinedCallFrame: 00007f3b1eff9408] System.Runtime.CompilerServices.RuntimeHelpers.CompileMethod(System.RuntimeMethodHandleInternal)\r\n00007F3B1EFF9408 00007f7d2fc3b8c3 [InlinedCallFrame: 00007f3b1eff9408] System.Runtime.CompilerServices.RuntimeHelpers.CompileMethod(System.RuntimeMethodHandleInternal)\r\n00007F3B1EFF9400 00007F7D2FC3B8C3 System.Reflection.Emit.DynamicMethod.CreateDelegate(System.Type, System.Object) [/_/src/coreclr/System.Private.CoreLib/src/System/Reflection/Emit/DynamicMethod.cs @ 370]\r\n00007F3B1EFF94A0 00007F7D2FC45B8B System.Linq.Expressions.Compiler.LambdaCompiler.Compile(System.Linq.Expressions.LambdaExpression) [/_/src/libraries/System.Linq.Expressions/src/System/Linq/Expressions/Compiler/LambdaCompiler.cs @ 190]\r\n00007F3B1EFF94D0 00007F7D2FC45A31 System.Linq.Expressions.Expression`1[[System.__Canon, System.Private.CoreLib]].Compile() [/_/src/libraries/System.Linq.Expressions/src/System/Linq/Expressions/LambdaExpression.cs @ 221]\r\n00007F3B1EFF94F0 00007F7D3688F156 Microsoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.GetValue(System.Linq.Expressions.Expression, System.String ByRef)\r\n00007F3B1EFF9560 00007F7D36899ED5 Microsoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.Evaluate(System.Linq.Expressions.Expression, Boolean) [/_/src/EFCore/Query/Internal/ParameterExtractingExpressionVisitor.cs @ 288]\r\n00007F3B1EFF95A0 00007F7D35678B83 Microsoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.Visit(System.Linq.Expressions.Expression) [/_/src/EFCore/Query/Internal/ParameterExtractingExpressionVisitor.cs @ 105]\r\n00007F3B1EFF95D0 00007F7D2FC4AFE6 System.Linq.Expressions.ExpressionVisitor.VisitBinary(System.Linq.Expressions.BinaryExpression)\r\n00007F3B1EFF9610 00007F7D35678B9D Microsoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.Visit(System.Linq.Expressions.Expression) [/_/src/EFCore/Query/Internal/ParameterExtractingExpressionVisitor.cs @ 108]\r\n00007F3B1EFF9640 00007F7D35679673 System.Linq.Expressions.ExpressionVisitor.VisitLambda[[System.__Canon, System.Private.CoreLib]](System.Linq.Expressions.Expression`1<System.__Canon>) [/_/src/libraries/System.Linq.Expressions/src/System/Linq/Expressions/ExpressionVisitor.cs @ 346]\r\n00007F3B1EFF9670 00007F7D35678B9D Microsoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.Visit(System.Linq.Expressions.Expression) [/_/src/EFCore/Query/Internal/ParameterExtractingExpressionVisitor.cs @ 108]\r\n00007F3B1EFF96A0 00007F7D3566CC99 System.Linq.Expressions.ExpressionVisitor.VisitUnary(System.Linq.Expressions.UnaryExpression) [/_/src/libraries/System.Linq.Expressions/src/System/Linq/Expressions/ExpressionVisitor.cs @ 540]\r\n00007F3B1EFF96C0 00007F7D35678B9D Microsoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.Visit(System.Linq.Expressions.Expression) [/_/src/EFCore/Query/Internal/ParameterExtractingExpressionVisitor.cs @ 108]\r\n00007F3B1EFF96F0 00007F7D319DFF4E System.Dynamic.Utils.ExpressionVisitorUtils.VisitArguments(System.Linq.Expressions.ExpressionVisitor, System.Linq.Expressions.IArgumentProvider) [/_/src/libraries/System.Linq.Expressions/src/System/Dynamic/Utils/ExpressionVisitorUtils.cs @ 66]\r\n00007F3B1EFF9740 00007F7D319E1303 System.Linq.Expressions.ExpressionVisitor.VisitMethodCall(System.Linq.Expressions.MethodCallExpression) [/_/src/libraries/System.Linq.Expressions/src/System/Linq/Expressions/ExpressionVisitor.cs @ 406]\r\n00007F3B1EFF9780 00007F7D35678B9D Microsoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.Visit(System.Linq.Expressions.Expression) [/_/src/EFCore/Query/Internal/ParameterExtractingExpressionVisitor.cs @ 108]\r\n00007F3B1EFF97B0 00007F7D368AB1C6 Microsoft.EntityFrameworkCore.Query.Internal.ParameterExtractingExpressionVisitor.ExtractParameters(System.Linq.Expressions.Expression, Boolean) [/_/src/EFCore/Query/Internal/ParameterExtractingExpressionVisitor.cs @ 75]\r\n00007F3B1EFF9800 00007F7D368AAE98 Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteAsync[[System.__Canon, System.Private.CoreLib]](System.Linq.Expressions.Expression, System.Threading.CancellationToken) [/_/src/EFCore/Query/Internal/QueryCompiler.cs @ 109]\r\n00007F3B1EFF9860 00007F7D369381CA Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ExecuteAsync[[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib]](System.Reflection.MethodInfo, System.Linq.IQueryable`1<System.__Canon>, System.Linq.Expressions.Expression, System.Threading.CancellationToken) [/_/src/EFCore/Extensions/EntityFrameworkQueryableExtensions.cs @ 3081]\r\n00007F3B1EFF98E0 00007F7D37A49E21 Microsoft.EntityFrameworkCore.Internal.EntityFinder`1[[System.__Canon, System.Private.CoreLib]].FindAsync(System.Object[], System.Threading.CancellationToken) [/_/src/EFCore/Internal/EntityFinder.cs @ 88]\r\n00007F3B1EFF9960 00007F7D37A43D30 Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1[[System.__Canon, System.Private.CoreLib]].FindAsync(System.Object[]) [/_/src/EFCore/Internal/InternalDbSet.cs @ 170]\r\n[...]\r\n```\r\n\r\nThe application were these stackframes were taken was running for days without problem until due a sudden traffic spike that made the CPU hit 85%, some servers included this one started to have memory issues and sluggishness.  ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722884456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10394467073,"node_id":"MEE_lADOAPaMMs5xQMUYzwAAAAJrjvsB","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10394467073","actor":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-18T07:52:54Z","performed_via_github_app":null},{"id":10394467089,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrjvsR","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10394467089","actor":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-18T07:52:54Z","performed_via_github_app":null},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T08:13:22Z","updated_at":"2023-09-18T08:13:22Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/31783","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/31783/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/31783/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/31783/events","html_url":"https://github.com/dotnet/efcore/issues/31783","id":1900354564,"node_id":"I_kwDOAPaMMs5xRRwE","number":31783,"title":"Stop generating dynamic method for each query invocation","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-09-18T07:44:04Z","updated_at":"2025-06-16T08:56:32Z","closed_at":"2023-09-18T08:13:21Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"In ParameterExtractingExpressionVisitor, we identify fragments of the query tree which aren't server correlated, compile them into a method and invoke that method to client-evaluate that part of the tree (the results are then embedded back as a parameter). In #29815 (merged for 8.0), we switched to use interpretation instead of compilation, but in all other versions the continuous compilation can creates considerable amounts of load, with a customer report of the finalizer thread getting backed up and the server needing to be eventually killed.\r\n\r\nWe should backport specifically the ParameterExtractingExpressionVisitor change to 7.0 and 6.0.","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/31783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/31783/timeline","performed_via_github_app":null,"state_reason":"duplicate"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722942754","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722942754","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722942754,"node_id":"IC_kwDOAPaMMs5msgUi","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T08:14:17Z","updated_at":"2023-09-18T08:14:17Z","body":"@jkotas thanks for digging into this... We should backport that specific fix to 7.0 and 6.0.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722942754/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10394705962,"node_id":"MEE_lADOAPaMMs5xQMUYzwAAAAJrkqAq","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10394705962","actor":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-18T08:14:17Z","performed_via_github_app":null},{"id":10394705975,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrkqA3","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10394705975","actor":{"login":"jkotas","id":6668460,"node_id":"MDQ6VXNlcjY2Njg0NjA=","avatar_url":"https://avatars.githubusercontent.com/u/6668460?v=4","gravatar_id":"","url":"https://api.github.com/users/jkotas","html_url":"https://github.com/jkotas","followers_url":"https://api.github.com/users/jkotas/followers","following_url":"https://api.github.com/users/jkotas/following{/other_user}","gists_url":"https://api.github.com/users/jkotas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkotas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkotas/subscriptions","organizations_url":"https://api.github.com/users/jkotas/orgs","repos_url":"https://api.github.com/users/jkotas/repos","events_url":"https://api.github.com/users/jkotas/events{/privacy}","received_events_url":"https://api.github.com/users/jkotas/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-18T08:14:17Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722946129","html_url":"https://github.com/dotnet/efcore/issues/31782#issuecomment-1722946129","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/31782","id":1722946129,"node_id":"IC_kwDOAPaMMs5mshJR","user":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T08:16:40Z","updated_at":"2023-09-18T08:16:40Z","body":"@roji in which version is this fixed?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/1722946129/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vtortola","id":704420,"node_id":"MDQ6VXNlcjcwNDQyMA==","avatar_url":"https://avatars.githubusercontent.com/u/704420?v=4","gravatar_id":"","url":"https://api.github.com/users/vtortola","html_url":"https://github.com/vtortola","followers_url":"https://api.github.com/users/vtortola/followers","following_url":"https://api.github.com/users/vtortola/following{/other_user}","gists_url":"https://api.github.com/users/vtortola/gists{/gist_id}","starred_url":"https://api.github.com/users/vtortola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtortola/subscriptions","organizations_url":"https://api.github.com/users/vtortola/orgs","repos_url":"https://api.github.com/users/vtortola/repos","events_url":"https://api.github.com/users/vtortola/events{/privacy}","received_events_url":"https://api.github.com/users/vtortola/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10394731165,"node_id":"MEE_lADOAPaMMs5xQMUYzwAAAAJrkwKd","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10394731165","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-18T08:16:40Z","performed_via_github_app":null},{"id":10394731186,"node_id":"SE_lADOAPaMMs5xQMUYzwAAAAJrkwKy","url":"https://api.github.com/repos/dotnet/efcore/issues/events/10394731186","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-18T08:16:40Z","performed_via_github_app":null}]