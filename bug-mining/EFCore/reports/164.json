{"url":"https://api.github.com/repos/dotnet/efcore/issues/29534","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/29534/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/29534/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/29534/events","html_url":"https://github.com/dotnet/efcore/issues/29534","id":1444599246,"node_id":"I_kwDOAPaMMs5WGtXO","number":29534,"title":"Generated Model Snapshot throws InvalidOperationException ","user":{"login":"vflame","id":12207061,"node_id":"MDQ6VXNlcjEyMjA3MDYx","avatar_url":"https://avatars.githubusercontent.com/u/12207061?v=4","gravatar_id":"","url":"https://api.github.com/users/vflame","html_url":"https://github.com/vflame","followers_url":"https://api.github.com/users/vflame/followers","following_url":"https://api.github.com/users/vflame/following{/other_user}","gists_url":"https://api.github.com/users/vflame/gists{/gist_id}","starred_url":"https://api.github.com/users/vflame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vflame/subscriptions","organizations_url":"https://api.github.com/users/vflame/orgs","repos_url":"https://api.github.com/users/vflame/repos","events_url":"https://api.github.com/users/vflame/events{/privacy}","received_events_url":"https://api.github.com/users/vflame/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":514908713,"node_id":"MDU6TGFiZWw1MTQ5MDg3MTM=","url":"https://api.github.com/repos/dotnet/efcore/labels/regression","name":"regression","color":"ff1fff","default":false,"description":null},{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1900941630,"node_id":"MDU6TGFiZWwxOTAwOTQxNjMw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-model-building","name":"area-model-building","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/158","html_url":"https://github.com/dotnet/efcore/milestone/158","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/158/labels","id":8728724,"node_id":"MI_kwDOAPaMMs4AhTCU","number":158,"title":"7.0.3","description":null,"creator":{"login":"rbhanda","id":30737530,"node_id":"MDQ6VXNlcjMwNzM3NTMw","avatar_url":"https://avatars.githubusercontent.com/u/30737530?v=4","gravatar_id":"","url":"https://api.github.com/users/rbhanda","html_url":"https://github.com/rbhanda","followers_url":"https://api.github.com/users/rbhanda/followers","following_url":"https://api.github.com/users/rbhanda/following{/other_user}","gists_url":"https://api.github.com/users/rbhanda/gists{/gist_id}","starred_url":"https://api.github.com/users/rbhanda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rbhanda/subscriptions","organizations_url":"https://api.github.com/users/rbhanda/orgs","repos_url":"https://api.github.com/users/rbhanda/repos","events_url":"https://api.github.com/users/rbhanda/events{/privacy}","received_events_url":"https://api.github.com/users/rbhanda/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":46,"state":"closed","created_at":"2022-12-06T18:26:17Z","updated_at":"2023-02-21T20:44:42Z","due_on":null,"closed_at":"2023-02-15T01:31:11Z"},"comments":15,"created_at":"2022-11-10T21:37:19Z","updated_at":"2025-06-15T18:55:19Z","closed_at":"2023-02-21T20:37:58Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When migrating from EF6 to EF7, the EF7 generated model snapshot throws `System.InvalidOperationException: Table name must be specified to configure a table-specific property mapping.` when being applied. The generated snapshot also prevents the migration from being removed due to the same exception. \r\n\r\nThe base type is mapped to a custom table name and the expected behavior is that types inheriting from the base table should share the same table name without explicit configuration.\r\n\r\nOnly the .csproj and nuget libraries were updated to 7, no model or configuration changes were made.\r\n\r\n\r\nEF Core 6 generated model:\r\n```c#\r\n modelBuilder.Entity(\"Domain.Aggregates.CustomerBalances.OutgoingCrossPlatformBalanceTransferLedgerEntry\", b =>\r\n                {\r\n                    b.HasBaseType(\"Domain.Aggregates.CustomerBalances.LedgerEntry\");\r\n\r\n                    b.Property<string>(\"TransferId\")\r\n                        .HasColumnType(\"text\")\r\n                        .HasColumnName(\"OutgoingCrossPlatformBalanceTransferLedgerEntry_TransferId\"); //moved to b.ToTable() in EF7\r\n\r\n                    b.HasIndex(\"TransferId\")\r\n                        .IsUnique();\r\n\r\n                    b.HasDiscriminator().HasValue(\"OutgoingCrossPlatformBalanceTransferLedgerEntry\");\r\n                });\r\n```\t\r\n\t\t\t\t\r\n\r\nEF Core 7 generated model:\r\n\r\n```c#\r\n modelBuilder.Entity(\"Domain.Aggregates.CustomerBalances.OutgoingCrossPlatformBalanceTransferLedgerEntry\", b =>\r\n                {\r\n                    b.HasBaseType(\"Domain.Aggregates.CustomerBalances.LedgerEntry\");\r\n\r\n                    b.Property<string>(\"TransferId\")\r\n                        .HasColumnType(\"text\");\r\n\r\n                    b.HasIndex(\"TransferId\")\r\n                        .IsUnique();\r\n\r\n//b.ToTable() generated code in EF7\r\n//exception thrown: System.InvalidOperationException: Table name must be specified to configure a table-specific property mapping.\r\n                    b.ToTable(t =>\r\n                        {\r\n                            t.Property(\"TransferId\")\r\n                                .HasColumnName(\"OutgoingCrossPlatformBalanceTransferLedgerEntry_TransferId\");\r\n                        });\r\n\r\n                    b.HasDiscriminator().HasValue(\"OutgoingCrossPlatformBalanceTransferLedgerEntry\");\r\n                });\r\n```\r\n\r\nConfig for base type:\r\n\r\n```c#\r\npublic class LedgerEntryConfiguration : IEntityTypeConfiguration<LedgerEntry>\r\n{\r\n    public void Configure(EntityTypeBuilder<LedgerEntry> builder)\r\n    {\r\n        builder.HasIndex(p => p.CreatedAt);\r\n        builder.ToTable(\"BalanceLedgerEntries\");\r\n    }\r\n}\r\n```\r\n\r\n\r\n\r\nBy adding `builder.ToTable(\"BalanceLedgerEntries\");` in the subtype configuration, the following is generated in the snapshot, which works:\r\n\r\n```c#\r\n b.ToTable(\"BalanceLedgerEntries\", null, t =>\r\n                        {\r\n                            t.Property(\"TransferId\")\r\n                                .HasColumnName(\"OutgoingCrossPlatformBalanceTransferLedgerEntry_TransferId\");\r\n                        });\r\n```\r\n\r\n","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/29534/reactions","total_count":15,"+1":15,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/29534/timeline","performed_via_github_app":null,"state_reason":"completed"}