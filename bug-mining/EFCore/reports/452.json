{"url":"https://api.github.com/repos/dotnet/efcore/issues/33605","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/33605/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/33605/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/33605/events","html_url":"https://github.com/dotnet/efcore/issues/33605","id":2261152258,"node_id":"I_kwDOAPaMMs6GxnIC","number":33605,"title":"Discriminator columns are created in Snapshot for wrongly configured TPC mapping strategy","user":{"login":"AlexDelPab","id":26739429,"node_id":"MDQ6VXNlcjI2NzM5NDI5","avatar_url":"https://avatars.githubusercontent.com/u/26739429?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexDelPab","html_url":"https://github.com/AlexDelPab","followers_url":"https://api.github.com/users/AlexDelPab/followers","following_url":"https://api.github.com/users/AlexDelPab/following{/other_user}","gists_url":"https://api.github.com/users/AlexDelPab/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexDelPab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexDelPab/subscriptions","organizations_url":"https://api.github.com/users/AlexDelPab/orgs","repos_url":"https://api.github.com/users/AlexDelPab/repos","events_url":"https://api.github.com/users/AlexDelPab/events{/privacy}","received_events_url":"https://api.github.com/users/AlexDelPab/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":514908713,"node_id":"MDU6TGFiZWw1MTQ5MDg3MTM=","url":"https://api.github.com/repos/dotnet/efcore/labels/regression","name":"regression","color":"ff1fff","default":false,"description":null},{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1900941630,"node_id":"MDU6TGFiZWwxOTAwOTQxNjMw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-model-building","name":"area-model-building","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/198","html_url":"https://github.com/dotnet/efcore/milestone/198","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/198/labels","id":11035505,"node_id":"MI_kwDOAPaMMs4AqGNx","number":198,"title":"8.0.7","description":null,"creator":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":9,"state":"closed","created_at":"2024-05-09T17:10:21Z","updated_at":"2024-11-13T15:19:12Z","due_on":null,"closed_at":"2024-08-26T09:11:07Z"},"comments":1,"created_at":"2024-04-24T12:14:04Z","updated_at":"2025-06-15T20:02:16Z","closed_at":"2024-05-01T22:35:21Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bug explanation\r\n\r\nAssume the following sample:\r\n\r\n```C#\r\nabstract class Animal {\r\n   public Food Food { get; set; }\r\n   public int Id { get; set; }\r\n}\r\nclass Cat : Animal {}\r\nclass Dog : Animal {}\r\n\r\nclass Food {\r\n  public List<Animal> Animals { get; set; }\r\n}\r\n```\r\n\r\nBy convention, EF tools would create the following tables for the abovementioned hierarchy: Animals, Cats, Dogs, and Foods, meaning table-per-hierarchy (TPH).  \r\n\r\nIf I want to create the tables as table-per-concrete-type (TPC), I can explicitly ignore the abstract class with the following line `modelBuilder.Ignore<Animal>();`\r\n\r\nWhen creating the first migration with the Ignore call via `dotnet ef migrations add Initial`, EF is confused about mixing TPH and TPC by adding a Discriminator value in the Snapshot file for the concrete classes which looks like this \r\n\r\n```C#\r\nmodelBuilder.Entity(\"Cat\", b =>\r\n                {\r\n                    b.Property<int>(\"Id\")\r\n                        .ValueGeneratedOnAdd()\r\n                        .HasColumnType(\"int\");\r\n\r\n                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>(\"Id\"));\r\n\r\n                  b.ToTable(\"Cats\");\r\n\r\n                    b.HasDiscriminator().HasValue(\"Cat\"); // <-- this line should not be here\r\n                });\r\n```\r\n\r\nWhen a second migration is created, the discriminator is dropped.\r\n\r\n```C#\r\nprotected override void Up(MigrationBuilder migrationBuilder)\r\n        {\r\n            migrationBuilder.DropColumn(\r\n                name: \"Discriminator\",\r\n                table: \"Cats\");\r\n\r\n            migrationBuilder.DropColumn(\r\n                name: \"Discriminator\",\r\n                table: \"Dogs\");\r\n        }\r\n```\r\n\r\nAfter calling `dotnet ef database update`, an exception is thrown because the discriminator column does not exist.\r\n\r\n```\r\nUsing project '/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj'.                                                  1 х  5s  13:57:19 ▓▒░\r\nUsing startup project '/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj'.\r\nWriting '/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/obj/EfCoreInheritanceSample.csproj.EntityFrameworkCore.targets'...\r\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=/var/folders/0x/5kkhnp1x3wndfz1fj7xr1qph0000gn/T/tmp3rdHHw.tmp /verbosity:quiet /nologo /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj\r\nWriting '/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/obj/EfCoreInheritanceSample.csproj.EntityFrameworkCore.targets'...\r\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=/var/folders/0x/5kkhnp1x3wndfz1fj7xr1qph0000gn/T/tmpClAEnm.tmp /verbosity:quiet /nologo /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj\r\nBuild started...\r\ndotnet build /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj /verbosity:quiet /nologo /p:PublishAot=false\r\n/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/Entities.cs(15,19): warning CS8618: Non-nullable property 'Color' must contain a non-null value when exiting constructor. Consider declaring the property as nullable. [/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj]\r\n/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/Entities.cs(7,19): warning CS8618: Non-nullable property 'Name' must contain a non-null value when exiting constructor. Consider declaring the property as nullable. [/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj]\r\n/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/Entities.cs(26,19): warning CS8618: Non-nullable property 'Name' must contain a non-null value when exiting constructor. Consider declaring the property as nullable. [/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj]\r\n\r\nBuild succeeded.\r\n\r\n/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/Entities.cs(15,19): warning CS8618: Non-nullable property 'Color' must contain a non-null value when exiting constructor. Consider declaring the property as nullable. [/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj]\r\n/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/Entities.cs(7,19): warning CS8618: Non-nullable property 'Name' must contain a non-null value when exiting constructor. Consider declaring the property as nullable. [/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj]\r\n/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/Entities.cs(26,19): warning CS8618: Non-nullable property 'Name' must contain a non-null value when exiting constructor. Consider declaring the property as nullable. [/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj]\r\n    3 Warning(s)\r\n    0 Error(s)\r\n\r\nTime Elapsed 00:00:00.80\r\nBuild succeeded.\r\ndotnet exec --depsfile /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/bin/Debug/net8.0/EfCoreInheritanceSample.deps.json --additionalprobingpath /Users/user/.nuget/packages --runtimeconfig /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/bin/Debug/net8.0/EfCoreInheritanceSample.runtimeconfig.json /Users/user/.nuget/packages/dotnet-ef/8.0.4/tools/net8.0/any/tools/netcoreapp2.0/any/ef.dll database update --assembly /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/bin/Debug/net8.0/EfCoreInheritanceSample.dll --project /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj --startup-assembly /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/bin/Debug/net8.0/EfCoreInheritanceSample.dll --startup-project /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/EfCoreInheritanceSample.csproj --project-dir /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/ --root-namespace EfCoreInheritanceSample --language C# --framework net8.0 --nullable --working-dir /Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample --verbose\r\nUsing assembly 'EfCoreInheritanceSample'.\r\nUsing startup assembly 'EfCoreInheritanceSample'.\r\nUsing application base '/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/bin/Debug/net8.0'.\r\nUsing working directory '/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample'.\r\nUsing root namespace 'EfCoreInheritanceSample'.\r\nUsing project directory '/Users/user/Downloads/EfCoreInheritanceSample/EfCoreInheritanceSample/'.\r\nRemaining arguments: .\r\nFinding DbContext classes...\r\nFinding IDesignTimeDbContextFactory implementations...\r\nFinding application service provider in assembly 'EfCoreInheritanceSample'...\r\nFinding Microsoft.Extensions.Hosting service provider...\r\nNo static method 'CreateHostBuilder(string[])' was found on class 'Program'.\r\nNo application service provider was found.\r\nFinding DbContext classes in the project...\r\nFound DbContext 'DataContext'.\r\nUsing context 'DataContext'.\r\nFinding design-time services referenced by assembly 'EfCoreInheritanceSample'...\r\nFinding design-time services referenced by assembly 'EfCoreInheritanceSample'...\r\nNo referenced design-time services were found.\r\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\r\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\r\nFinding IDesignTimeServices implementations in assembly 'EfCoreInheritanceSample'...\r\nNo design-time services were found.\r\nCreating DbConnection.\r\nCreated DbConnection. (17ms).\r\nMigrating using database 'EfCoreInheritanceSample' on server 'localhost'.\r\nOpening connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nOpened connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nCreating DbCommand for 'ExecuteNonQuery'.\r\nCreated DbCommand for 'ExecuteNonQuery' (1ms).\r\nInitialized DbCommand for 'ExecuteNonQuery' (3ms).\r\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT 1\r\nExecuted DbCommand (14ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT 1\r\nClosing connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nClosed connection to database 'EfCoreInheritanceSample' on server 'localhost' (1ms).\r\nCreating DbCommand for 'ExecuteScalar'.\r\nCreated DbCommand for 'ExecuteScalar' (0ms).\r\nInitialized DbCommand for 'ExecuteScalar' (0ms).\r\nOpening connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nOpened connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\r\nExecuted DbCommand (8ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\r\nClosing connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nClosed connection to database 'EfCoreInheritanceSample' on server 'localhost' (0ms).\r\nOpening connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nOpened connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nCreating DbCommand for 'ExecuteNonQuery'.\r\nCreated DbCommand for 'ExecuteNonQuery' (0ms).\r\nInitialized DbCommand for 'ExecuteNonQuery' (0ms).\r\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT 1\r\nExecuted DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT 1\r\nClosing connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nClosed connection to database 'EfCoreInheritanceSample' on server 'localhost' (0ms).\r\nCreating DbCommand for 'ExecuteScalar'.\r\nCreated DbCommand for 'ExecuteScalar' (0ms).\r\nInitialized DbCommand for 'ExecuteScalar' (0ms).\r\nOpening connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nOpened connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\r\nExecuted DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT OBJECT_ID(N'[__EFMigrationsHistory]');\r\nClosing connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nClosed connection to database 'EfCoreInheritanceSample' on server 'localhost' (0ms).\r\nOpening connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nOpened connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nCreating DbCommand for 'ExecuteReader'.\r\nCreated DbCommand for 'ExecuteReader' (0ms).\r\nInitialized DbCommand for 'ExecuteReader' (0ms).\r\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT [MigrationId], [ProductVersion]\r\nFROM [__EFMigrationsHistory]\r\nORDER BY [MigrationId];\r\nExecuted DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nSELECT [MigrationId], [ProductVersion]\r\nFROM [__EFMigrationsHistory]\r\nORDER BY [MigrationId];\r\nClosing data reader to 'EfCoreInheritanceSample' on server 'localhost'.\r\nA data reader for 'EfCoreInheritanceSample' on server 'localhost' is being disposed after spending 0ms reading results.\r\nClosing connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nClosed connection to database 'EfCoreInheritanceSample' on server 'localhost' (0ms).\r\nApplying migration '20240424115147_Test'.\r\nOpening connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nOpened connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nBeginning transaction with isolation level 'Unspecified'.\r\nBegan transaction with isolation level 'ReadCommitted'.\r\nCreating DbCommand for 'ExecuteNonQuery'.\r\nCreated DbCommand for 'ExecuteNonQuery' (0ms).\r\nInitialized DbCommand for 'ExecuteNonQuery' (0ms).\r\nExecuting DbCommand [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nDECLARE @var0 sysname;\r\nSELECT @var0 = [d].[name]\r\nFROM [sys].[default_constraints] [d]\r\nINNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]\r\nWHERE ([d].[parent_object_id] = OBJECT_ID(N'[B]') AND [c].[name] = N'Discriminator');\r\nIF @var0 IS NOT NULL EXEC(N'ALTER TABLE [B] DROP CONSTRAINT [' + @var0 + '];');\r\nALTER TABLE [B] DROP COLUMN [Discriminator];\r\nFailed executing DbCommand (17ms) [Parameters=[], CommandType='Text', CommandTimeout='30']\r\nDECLARE @var0 sysname;\r\nSELECT @var0 = [d].[name]\r\nFROM [sys].[default_constraints] [d]\r\nINNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]\r\nWHERE ([d].[parent_object_id] = OBJECT_ID(N'[B]') AND [c].[name] = N'Discriminator');\r\nIF @var0 IS NOT NULL EXEC(N'ALTER TABLE [B] DROP CONSTRAINT [' + @var0 + '];');\r\nALTER TABLE [B] DROP COLUMN [Discriminator];\r\nDisposing transaction.\r\nClosing connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nClosed connection to database 'EfCoreInheritanceSample' on server 'localhost' (0ms).\r\n'DataContext' disposed.\r\nDisposing connection to database 'EfCoreInheritanceSample' on server 'localhost'.\r\nDisposed connection to database '' on server '' (0ms).\r\nMicrosoft.Data.SqlClient.SqlException (0x80131904): ALTER TABLE DROP COLUMN failed because column 'Discriminator' does not exist in table 'B'.\r\n   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\r\n   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\r\n   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)\r\n   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)\r\n   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean isAsync, Int32 timeout, Boolean asyncWrite)\r\n   at Microsoft.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, Boolean sendToPipe, Int32 timeout, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String methodName)\r\n   at Microsoft.Data.SqlClient.SqlCommand.ExecuteNonQuery()\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQuery(RelationalCommandParameterObject parameterObject)\r\n   at Microsoft.EntityFrameworkCore.Migrations.MigrationCommand.ExecuteNonQuery(IRelationalConnection connection, IReadOnlyDictionary`2 parameterValues)\r\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.ExecuteNonQuery(IEnumerable`1 migrationCommands, IRelationalConnection connection)\r\n   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)\r\n   at Microsoft.EntityFrameworkCore.Design.Internal.MigrationsOperations.UpdateDatabase(String targetMigration, String connectionString, String contextType)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabaseImpl(String targetMigration, String connectionString, String contextType)\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.UpdateDatabase.<>c__DisplayClass0_0.<.ctor>b__0()\r\n   at Microsoft.EntityFrameworkCore.Design.OperationExecutor.OperationBase.Execute(Action action)\r\nClientConnectionId:16ac73a4-0190-4d93-afd6-9766002f407a\r\nError Number:4924,State:1,Class:16\r\nALTER TABLE DROP COLUMN failed because column 'Discriminator' does not exist in table 'B'.\r\n\r\n```\r\n### Reproduction steps\r\n\r\n1. Download the attached ZIP folder containing the .NET 8 sample\r\n2. Delete the migrations folder\r\n3. Create an initial migration via `dotnet ef migrations add Initial`\r\n4. Check the snapshot file where the discriminator column is added to the tables of the concrete classes\r\n5. Again create a migration via `dotnet ef migrations add Second`\r\n6. Check the migration file where the discriminator column is dropped\r\n7. Run the migrations via `dotnet ef database update`\r\n\r\nSeems to address a maybe similar problem like #20410  \r\n\r\n### Include provider and version information\r\n\r\nEF Core version: 8.0.4\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer\r\nTarget framework: .NET 8.0\r\nOperating system: MacOS Sonoma 14.2.1\r\nIDE: JetBrains Rider 2024.1\r\n[EfCoreInheritanceSample.zip](https://github.com/dotnet/efcore/files/15093901/EfCoreInheritanceSample.zip)\r\n","closed_by":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/33605/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/33605/timeline","performed_via_github_app":null,"state_reason":"completed"}