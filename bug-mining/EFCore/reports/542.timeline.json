[{"id":12548578867,"node_id":"LE_lADOAPaMMs6GZCi_zwAAAALr9B4z","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12548578867","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-04-20T20:42:55Z","label":{"name":"customer-reported","color":"a4a5f9"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2067975980","html_url":"https://github.com/dotnet/efcore/issues/33582#issuecomment-2067975980","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/33582","id":2067975980,"node_id":"IC_kwDOAPaMMs57Qs8s","user":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-21T09:26:15Z","updated_at":"2024-04-21T09:26:15Z","body":"Converting the `value` retrieved from the `values` array to a string solved the issue and the SQL was translated properly:\r\n\r\n```\r\nstring[] values = new[] {\"one\", \"two\", \"three\", \"four\"};\r\n\r\nvar query = (from item in _context.items\r\n             let value = values[item.value].ToString()\r\n             select new {item.id, value}).ToList();\r\n```\r\n\r\nI am not sure, it seems that EF Core -at the moment- isn't able to figure out the type of the `values` array during translation?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2067975980/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2067976660","html_url":"https://github.com/dotnet/efcore/issues/33582#issuecomment-2067976660","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/33582","id":2067976660,"node_id":"IC_kwDOAPaMMs57QtHU","user":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-21T09:28:58Z","updated_at":"2024-04-21T09:28:58Z","body":"I can't reproduce the problem on my end. I'm using the following code:\r\n\r\n```cs\r\n\r\nusing var ctx = new MyContext();\r\nawait ctx.Database.EnsureDeletedAsync();\r\nawait ctx.Database.EnsureCreatedAsync();\r\nawait ctx.Set<Entity>().AddAsync(new Entity { Value = 0 });\r\nawait ctx.Set<Entity>().AddAsync(new Entity { Value = 1 });\r\nawait ctx.SaveChangesAsync();\r\n\r\nstring[] values = new[] { \"one\", \"two\", \"three\", \"four\" };\r\n\r\nvar query = (from item in ctx.Set<Entity>()\r\n             let value = values[item.Value]\r\n             select new { item.Id, value }).ToList();\r\n\r\nConsole.WriteLine(query);\r\n\r\n\r\npublic class Entity\r\n{\r\n    public int Id { get; set; }\r\n    public int Value { get; set; }\r\n}\r\n\r\npublic class MyContext : DbContext\r\n{\r\n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\r\n    {\r\n        optionsBuilder.UseSqlServer(@\"Server=(localdb)\\mssqllocaldb;Database=Repro;Trusted_Connection=True;MultipleActiveResultSets=true\");\r\n    }\r\n\r\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\r\n    {\r\n        modelBuilder.Entity<Entity>();\r\n    }\r\n}\r\n```\r\n\r\nI get expected results and the sql is as follows:\r\n\r\n```sql\r\nexec sp_executesql N'SELECT [e].[Id], JSON_VALUE(@__values_0, ''$['' + CAST([e].[Value] AS nvarchar(max)) + '']'') AS [value]\r\nFROM [Entity] AS [e]',N'@__values_0 nvarchar(4000)',@__values_0=N'[\"one\",\"two\",\"three\",\"four\"]'\r\n```\r\n\r\n@edamascus can you modify the code I pasted above, so that it reproduces the problem you are seeing? Also, are you using the latest patch of EF 8?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2067976660/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null,"event":"commented","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12550364581,"node_id":"MEE_lADOAPaMMs6GZCi_zwAAAALsD12l","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12550364581","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-04-21T09:29:00Z","performed_via_github_app":null},{"id":12550364583,"node_id":"SE_lADOAPaMMs6GZCi_zwAAAALsD12n","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12550364583","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-04-21T09:29:00Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2067982873","html_url":"https://github.com/dotnet/efcore/issues/33582#issuecomment-2067982873","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/33582","id":2067982873,"node_id":"IC_kwDOAPaMMs57QuoZ","user":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-21T09:47:31Z","updated_at":"2024-04-21T09:47:31Z","body":"@maumar, the current version of EF Core I am using is `8.0.0`. I haven't updated to `8.0.4`, as I checked the [latest release notes](https://github.com/dotnet/efcore/releases/tag/v8.0.4) and did not find anything directly related to this matter.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2067982873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12550422659,"node_id":"MEE_lADOAPaMMs6GZCi_zwAAAALsEECD","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12550422659","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-04-21T09:47:32Z","performed_via_github_app":null},{"id":12550422665,"node_id":"SE_lADOAPaMMs6GZCi_zwAAAALsEECJ","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12550422665","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-04-21T09:47:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2067993547","html_url":"https://github.com/dotnet/efcore/issues/33582#issuecomment-2067993547","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/33582","id":2067993547,"node_id":"IC_kwDOAPaMMs57QxPL","user":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-21T10:24:09Z","updated_at":"2024-04-21T10:24:09Z","body":"@maumar, I had to simplify the actual code which I am having trouble with in order to report the issue. When declaring the `value` variable I am doing a null check to provide a default value when the value is null. Can you please try the following to see if the issue is reproduced (the change is in the following line `let value = item.Id != 0 ? values[item.Value] : \"zero\"`):\r\n\r\n```\r\n\r\nusing var ctx = new MyContext();\r\nawait ctx.Database.EnsureDeletedAsync();\r\nawait ctx.Database.EnsureCreatedAsync();\r\nawait ctx.Set<Entity>().AddAsync(new Entity { Value = 0 });\r\nawait ctx.Set<Entity>().AddAsync(new Entity { Value = 1 });\r\nawait ctx.SaveChangesAsync();\r\n\r\nstring[] values = new[] { \"one\", \"two\", \"three\", \"four\" };\r\n\r\nvar query = (from item in ctx.Set<Entity>()\r\n             let value = item.Id != 0 ? values[item.Value] : \"zero\"\r\n             select new { item.Id, value }).ToList();\r\n\r\nConsole.WriteLine(query);\r\n\r\npublic class Entity\r\n{\r\n    public int Id { get; set; }\r\n    public int Value { get; set; }\r\n}\r\n\r\npublic class MyContext : DbContext\r\n{\r\n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\r\n    {\r\n        optionsBuilder.UseSqlServer(@\"Server=(localdb)\\mssqllocaldb;Database=Repro;Trusted_Connection=True;MultipleActiveResultSets=true\");\r\n    }\r\n\r\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\r\n    {\r\n        modelBuilder.Entity<Entity>();\r\n    }\r\n}\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2067993547/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12550536283,"node_id":"MEE_lADOAPaMMs6GZCi_zwAAAALsEfxb","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12550536283","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-04-21T10:24:10Z","performed_via_github_app":null},{"id":12550536285,"node_id":"SE_lADOAPaMMs6GZCi_zwAAAALsEfxd","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12550536285","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-04-21T10:24:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2068020166","html_url":"https://github.com/dotnet/efcore/issues/33582#issuecomment-2068020166","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/33582","id":2068020166,"node_id":"IC_kwDOAPaMMs57Q3vG","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-21T12:06:41Z","updated_at":"2024-04-21T12:06:41Z","body":"@edamascus there have been many fixes that could be related to this, please try with the latest patch version. In fact, that's a good idea to always do before filing an issue.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2068020166/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12550732230,"node_id":"MEE_lADOAPaMMs6GZCi_zwAAAALsFPnG","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12550732230","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-04-21T12:06:42Z","performed_via_github_app":null},{"id":12550732232,"node_id":"SE_lADOAPaMMs6GZCi_zwAAAALsFPnI","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12550732232","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-04-21T12:06:42Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2068083282","html_url":"https://github.com/dotnet/efcore/issues/33582#issuecomment-2068083282","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/33582","id":2068083282,"node_id":"IC_kwDOAPaMMs57RHJS","user":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-21T15:23:43Z","updated_at":"2024-04-21T15:27:54Z","body":"@roji, my fault for missing out the important part which caused the issue. The problem exists in versions `8.0.0` and `8.0.4` with the following query (which includes the ternary operator):\r\n\r\n```\r\nstring[] values = new[] {\"one\", \"two\", \"three\", \"four\"};\r\n\r\nvar query = (from item in _context.items\r\n             let value = item.value != null ? values[item.value] : \"\"\r\n             select new {item.id, value}).ToList();\r\n```\r\n\r\nThe following query (with string conversion) works:\r\n\r\n```\r\nstring[] values = new[] {\"one\", \"two\", \"three\", \"four\"};\r\n\r\nvar query = (from item in _context.items\r\n             let value = item.value != null ? values[item.value].ToString() : \"\"\r\n             select new {item.id, value}).ToList();\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2068083282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12551143121,"node_id":"MEE_lADOAPaMMs6GZCi_zwAAAALsGz7R","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12551143121","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-04-21T15:23:44Z","performed_via_github_app":null},{"id":12551143125,"node_id":"SE_lADOAPaMMs6GZCi_zwAAAALsGz7V","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12551143125","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-04-21T15:23:44Z","performed_via_github_app":null},{"id":12551984055,"node_id":"LE_lADOAPaMMs6GZCi_zwAAAALsKBO3","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12551984055","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-04-21T21:12:52Z","label":{"name":"area-query","color":"32b37b"},"performed_via_github_app":null},{"id":12551984056,"node_id":"LE_lADOAPaMMs6GZCi_zwAAAALsKBO4","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12551984056","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-04-21T21:12:52Z","label":{"name":"area-type-mapping","color":"32b37b"},"performed_via_github_app":null},{"id":12551984198,"node_id":"LE_lADOAPaMMs6GZCi_zwAAAALsKBRG","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12551984198","actor":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-04-21T21:12:58Z","label":{"name":"type-bug","color":"f7c6c7"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2072482212","html_url":"https://github.com/dotnet/efcore/issues/33582#issuecomment-2072482212","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/33582","id":2072482212,"node_id":"IC_kwDOAPaMMs57h5Gk","user":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-23T14:31:34Z","updated_at":"2024-04-23T14:31:34Z","body":"Not sure if this is related. But the same code fails with the following exception when `item.value` is actually null (it works well when it is not null):\r\n\r\n> Microsoft.Data.SqlClient.SqlException (0x80131904): Argument data type NULL is invalid for argument 2 of JSON_VALUE function.\r\n\r\nIn order to fix the issue, I have to re-evaluate `item.value` when accessing the array's item by index:\r\n\r\n```\r\nstring[] values = new[] {\"one\", \"two\", \"three\", \"four\"};\r\n\r\nvar query = (from item in _context.items\r\n             let value = item.value != null ? values[item.value != null ? item.value : 0].ToString() : \"\"\r\n             select new {item.id, value}).ToList();\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2072482212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"edamascus","id":39170297,"node_id":"MDQ6VXNlcjM5MTcwMjk3","avatar_url":"https://avatars.githubusercontent.com/u/39170297?v=4","gravatar_id":"","url":"https://api.github.com/users/edamascus","html_url":"https://github.com/edamascus","followers_url":"https://api.github.com/users/edamascus/followers","following_url":"https://api.github.com/users/edamascus/following{/other_user}","gists_url":"https://api.github.com/users/edamascus/gists{/gist_id}","starred_url":"https://api.github.com/users/edamascus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edamascus/subscriptions","organizations_url":"https://api.github.com/users/edamascus/orgs","repos_url":"https://api.github.com/users/edamascus/repos","events_url":"https://api.github.com/users/edamascus/events{/privacy}","received_events_url":"https://api.github.com/users/edamascus/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2076126545","html_url":"https://github.com/dotnet/efcore/issues/33582#issuecomment-2076126545","issue_url":"https://api.github.com/repos/dotnet/efcore/issues/33582","id":2076126545,"node_id":"IC_kwDOAPaMMs57vy1R","user":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T01:10:27Z","updated_at":"2024-04-25T01:10:27Z","body":"I'm able to reproduce this on current bits. Problem is that SqlExpressionFactory.Case applies TypeMapping for elseResult based on type mappings before we run type inference code - we use provided type mapping and the type mappings from When clauses, but they are all null. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/comments/2076126545/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12612457258,"node_id":"AE_lADOAPaMMs6GZCi_zwAAAALvwtMq","url":"https://api.github.com/repos/dotnet/efcore/issues/events/12612457258","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2024-04-25T17:10:41Z","assignee":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":13509515937,"node_id":"MIE_lADOAPaMMs6GZCi_zwAAAAMlOtqh","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13509515937","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2024-07-15T18:29:08Z","milestone":{"title":"9.0.0"},"performed_via_github_app":null},{"id":13800194784,"node_id":"AE_lADOAPaMMs6GZCi_zwAAAAM2jkLg","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13800194784","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2024-08-08T02:20:45Z","assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":13800195230,"node_id":"LE_lADOAPaMMs6GZCi_zwAAAAM2jkSe","url":"https://api.github.com/repos/dotnet/efcore/issues/events/13800195230","actor":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-08-08T02:20:50Z","label":{"name":"regression","color":"ff1fff"},"performed_via_github_app":null},{"id":14233749250,"node_id":"UNE_lADOAPaMMs6GZCi_zwAAAANQZccC","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14233749250","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unassigned","commit_id":null,"commit_url":null,"created_at":"2024-09-12T14:10:59Z","assignee":{"login":"maumar","id":1591930,"node_id":"MDQ6VXNlcjE1OTE5MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1591930?v=4","gravatar_id":"","url":"https://api.github.com/users/maumar","html_url":"https://github.com/maumar","followers_url":"https://api.github.com/users/maumar/followers","following_url":"https://api.github.com/users/maumar/following{/other_user}","gists_url":"https://api.github.com/users/maumar/gists{/gist_id}","starred_url":"https://api.github.com/users/maumar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maumar/subscriptions","organizations_url":"https://api.github.com/users/maumar/orgs","repos_url":"https://api.github.com/users/maumar/repos","events_url":"https://api.github.com/users/maumar/events{/privacy}","received_events_url":"https://api.github.com/users/maumar/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":14234681156,"node_id":"LE_lADOAPaMMs6GZCi_zwAAAANQc_9E","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14234681156","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-09-12T15:06:28Z","label":{"name":"closed-fixed","color":"777777"},"performed_via_github_app":null},{"id":14234702247,"node_id":"REFE_lADOAPaMMs6GZCi_zwAAAANQdFGn","url":"https://api.github.com/repos/dotnet/efcore/issues/events/14234702247","actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2760589b5636b794a95c62774af6b68eb8b7edd8","commit_url":"https://api.github.com/repos/roji/efcore/commits/2760589b5636b794a95c62774af6b68eb8b7edd8","created_at":"2024-09-12T15:07:42Z","performed_via_github_app":null},{"actor":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-12T15:14:50Z","updated_at":"2024-09-12T15:14:50Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34663","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34663/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34663/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34663/events","html_url":"https://github.com/dotnet/efcore/pull/34663","id":2522693457,"node_id":"PR_kwDOAPaMMs57UfUZ","number":34663,"title":"[release/9.0] Fix type mapping management for JsonScalarExpression","user":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1469239654,"node_id":"MDU6TGFiZWwxNDY5MjM5NjU0","url":"https://api.github.com/repos/dotnet/efcore/labels/tell-mode","name":"tell-mode","color":"e989f9","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-09-12T15:14:49Z","updated_at":"2024-09-12T21:03:56Z","closed_at":"2024-09-12T21:03:55Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":16157746,"node_id":"MDEwOlJlcG9zaXRvcnkxNjE1Nzc0Ng==","name":"efcore","full_name":"dotnet/efcore","private":false,"owner":{"login":"dotnet","id":9141961,"node_id":"MDEyOk9yZ2FuaXphdGlvbjkxNDE5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/9141961?v=4","gravatar_id":"","url":"https://api.github.com/users/dotnet","html_url":"https://github.com/dotnet","followers_url":"https://api.github.com/users/dotnet/followers","following_url":"https://api.github.com/users/dotnet/following{/other_user}","gists_url":"https://api.github.com/users/dotnet/gists{/gist_id}","starred_url":"https://api.github.com/users/dotnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dotnet/subscriptions","organizations_url":"https://api.github.com/users/dotnet/orgs","repos_url":"https://api.github.com/users/dotnet/repos","events_url":"https://api.github.com/users/dotnet/events{/privacy}","received_events_url":"https://api.github.com/users/dotnet/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dotnet/efcore","description":"EF Core is a modern object-database mapper for .NET. It supports LINQ queries, change tracking, updates, and schema migrations.","fork":false,"url":"https://api.github.com/repos/dotnet/efcore","forks_url":"https://api.github.com/repos/dotnet/efcore/forks","keys_url":"https://api.github.com/repos/dotnet/efcore/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dotnet/efcore/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dotnet/efcore/teams","hooks_url":"https://api.github.com/repos/dotnet/efcore/hooks","issue_events_url":"https://api.github.com/repos/dotnet/efcore/issues/events{/number}","events_url":"https://api.github.com/repos/dotnet/efcore/events","assignees_url":"https://api.github.com/repos/dotnet/efcore/assignees{/user}","branches_url":"https://api.github.com/repos/dotnet/efcore/branches{/branch}","tags_url":"https://api.github.com/repos/dotnet/efcore/tags","blobs_url":"https://api.github.com/repos/dotnet/efcore/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dotnet/efcore/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dotnet/efcore/git/refs{/sha}","trees_url":"https://api.github.com/repos/dotnet/efcore/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dotnet/efcore/statuses/{sha}","languages_url":"https://api.github.com/repos/dotnet/efcore/languages","stargazers_url":"https://api.github.com/repos/dotnet/efcore/stargazers","contributors_url":"https://api.github.com/repos/dotnet/efcore/contributors","subscribers_url":"https://api.github.com/repos/dotnet/efcore/subscribers","subscription_url":"https://api.github.com/repos/dotnet/efcore/subscription","commits_url":"https://api.github.com/repos/dotnet/efcore/commits{/sha}","git_commits_url":"https://api.github.com/repos/dotnet/efcore/git/commits{/sha}","comments_url":"https://api.github.com/repos/dotnet/efcore/comments{/number}","issue_comment_url":"https://api.github.com/repos/dotnet/efcore/issues/comments{/number}","contents_url":"https://api.github.com/repos/dotnet/efcore/contents/{+path}","compare_url":"https://api.github.com/repos/dotnet/efcore/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dotnet/efcore/merges","archive_url":"https://api.github.com/repos/dotnet/efcore/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dotnet/efcore/downloads","issues_url":"https://api.github.com/repos/dotnet/efcore/issues{/number}","pulls_url":"https://api.github.com/repos/dotnet/efcore/pulls{/number}","milestones_url":"https://api.github.com/repos/dotnet/efcore/milestones{/number}","notifications_url":"https://api.github.com/repos/dotnet/efcore/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dotnet/efcore/labels{/name}","releases_url":"https://api.github.com/repos/dotnet/efcore/releases{/id}","deployments_url":"https://api.github.com/repos/dotnet/efcore/deployments","created_at":"2014-01-23T00:52:01Z","updated_at":"2025-11-10T14:21:49Z","pushed_at":"2025-11-10T05:59:58Z","git_url":"git://github.com/dotnet/efcore.git","ssh_url":"git@github.com:dotnet/efcore.git","clone_url":"https://github.com/dotnet/efcore.git","svn_url":"https://github.com/dotnet/efcore","homepage":"https://learn.microsoft.com/ef/","size":215987,"stargazers_count":14455,"watchers_count":14455,"language":"C#","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3324,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2430,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aspnet-product","c-sharp","database","dotnet-core","dotnet-framework","dotnet-standard","entity-framework","hacktoberfest","orm"],"visibility":"public","forks":3324,"open_issues":2430,"watchers":14455,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/dotnet/efcore/pulls/34663","html_url":"https://github.com/dotnet/efcore/pull/34663","diff_url":"https://github.com/dotnet/efcore/pull/34663.diff","patch_url":"https://github.com/dotnet/efcore/pull/34663.patch","merged_at":"2024-09-12T21:03:55Z"},"body":"Fixes #33582\r\n\r\n### Description\r\n\r\nIn 8.0, EF started translating queries using scalar collections. Unfortunately, the type mapping inference for scalar collections (JsonScalarExpression specifically) was flawed, as various infra was missing at the time, and applied the default type mapping in cases where it shouldn't have. This PR fixes type mapping inference for JsonScalarExpression.\r\n\r\n### Customer impact\r\n\r\nQueries using non-column scalar collections could fail in various scenarios. Example:\r\n\r\n```c#\r\nstring[] values = [\"one\", \"two\", \"three\", \"four\"];\r\n_ = await context.Entities\r\n    .Select(item => item.Id != 0 ? values[item.Value] : \"zero\")\r\n    .ToListAsync();\r\n```\r\n\r\n### How found\r\n\r\nReported by user.\r\n\r\n### Regression\r\n\r\nYes - from 7.0 to 8.0.\r\n\r\nThe case in #33582 was previously being client-evaluated (top-level Select); the scalar collection support in 8.0 allowed this to get this translated, but then the translation got blocked by this bug.\r\n\r\n### Testing\r\n\r\nAdded.\r\n\r\n### Risk\r\n\r\nLow.","reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34663/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34663/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]