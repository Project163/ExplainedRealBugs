{"url":"https://api.github.com/repos/dotnet/efcore/issues/27168","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/27168/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/27168/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/27168/events","html_url":"https://github.com/dotnet/efcore/issues/27168","id":1099641077,"node_id":"I_kwDOAPaMMs5BizD1","number":27168,"title":"Exception from SQLite provider when application is shutting down","user":{"login":"dataweasel","id":6961443,"node_id":"MDQ6VXNlcjY5NjE0NDM=","avatar_url":"https://avatars.githubusercontent.com/u/6961443?v=4","gravatar_id":"","url":"https://api.github.com/users/dataweasel","html_url":"https://github.com/dataweasel","followers_url":"https://api.github.com/users/dataweasel/followers","following_url":"https://api.github.com/users/dataweasel/following{/other_user}","gists_url":"https://api.github.com/users/dataweasel/gists{/gist_id}","starred_url":"https://api.github.com/users/dataweasel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dataweasel/subscriptions","organizations_url":"https://api.github.com/users/dataweasel/orgs","repos_url":"https://api.github.com/users/dataweasel/repos","events_url":"https://api.github.com/users/dataweasel/events{/privacy}","received_events_url":"https://api.github.com/users/dataweasel/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1111789566,"node_id":"MDU6TGFiZWwxMTExNzg5NTY2","url":"https://api.github.com/repos/dotnet/efcore/labels/area-adonet-sqlite","name":"area-adonet-sqlite","color":"044a64","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bricelam","id":1226749,"node_id":"MDQ6VXNlcjEyMjY3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1226749?v=4","gravatar_id":"","url":"https://api.github.com/users/bricelam","html_url":"https://github.com/bricelam","followers_url":"https://api.github.com/users/bricelam/followers","following_url":"https://api.github.com/users/bricelam/following{/other_user}","gists_url":"https://api.github.com/users/bricelam/gists{/gist_id}","starred_url":"https://api.github.com/users/bricelam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bricelam/subscriptions","organizations_url":"https://api.github.com/users/bricelam/orgs","repos_url":"https://api.github.com/users/bricelam/repos","events_url":"https://api.github.com/users/bricelam/events{/privacy}","received_events_url":"https://api.github.com/users/bricelam/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/136","html_url":"https://github.com/dotnet/efcore/milestone/136","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/136/labels","id":7681399,"node_id":"MI_kwDOAPaMMs4AdTV3","number":136,"title":"6.0.4","description":null,"creator":{"login":"rbhanda","id":30737530,"node_id":"MDQ6VXNlcjMwNzM3NTMw","avatar_url":"https://avatars.githubusercontent.com/u/30737530?v=4","gravatar_id":"","url":"https://api.github.com/users/rbhanda","html_url":"https://github.com/rbhanda","followers_url":"https://api.github.com/users/rbhanda/followers","following_url":"https://api.github.com/users/rbhanda/following{/other_user}","gists_url":"https://api.github.com/users/rbhanda/gists{/gist_id}","starred_url":"https://api.github.com/users/rbhanda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rbhanda/subscriptions","organizations_url":"https://api.github.com/users/rbhanda/orgs","repos_url":"https://api.github.com/users/rbhanda/repos","events_url":"https://api.github.com/users/rbhanda/events{/privacy}","received_events_url":"https://api.github.com/users/rbhanda/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2022-02-15T18:31:44Z","updated_at":"2022-04-18T13:25:06Z","due_on":null,"closed_at":"2022-04-15T20:39:26Z"},"comments":13,"created_at":"2022-01-06T23:12:36Z","updated_at":"2025-06-15T18:44:44Z","closed_at":"2022-03-02T09:52:58Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I hope I'm posting this in the right location.  I have been running this problem down for several days now and I'm not sure what is going on.  I've checked all my various libraries and 3rd party packages to see if there might be an issue there.  The problem is that the issue is happening when my code is no longer running.\r\n\r\nIn a nutshell, my issue is happening here:\r\n\r\n```\r\nusing System;\r\nusing System.Windows.Forms;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing System.Threading.Tasks;\r\n\r\nnamespace WeatherWire_Personal\r\n{\r\n    internal static class Program\r\n    {\r\n        /// <summary>\r\n        ///  The main entry point for the application.\r\n        /// </summary>\r\n        [STAThread]\r\n        static void Main()\r\n        {\r\n            Application.SetHighDpiMode(HighDpiMode.SystemAware);\r\n            Application.EnableVisualStyles();\r\n            Application.SetCompatibleTextRenderingDefault(false);\r\n            Application.Run(new WWMonitor());\r\n        }   **//-   <------ Exception is thrown HERE**\r\n    }\r\n}\r\n```\r\n\r\nIt's at the point above that a \"System.InvalidOperationException: 'Collection was modified; enumeration operation may not execute.\" exception is thrown.  No tasks show in the debugger.  I'm not sure what collection it is talking about since no collections in my code are being iterated at this point.\r\n\r\nSo...I disable \"Enable Just My Code\" in the debugger options, then set a breakpoint for that curly bracket.  I kick off a debugging session again, then close down the application.  When I hit the breakpoint there are no \"Tasks\" and no \"Locals\" shown.  With \"Source Link\" enabled I <F11> the debugger I get:\r\n\r\n<!DOCTYPE html>\r\n<HTML>\r\n<head>\r\n</head>\r\n<body>\r\n<!--StartFragment-->\r\n\r\n\r\n  | Name | Value | Type\r\n-- | -- | -- | --\r\n  | Message | \"Collection was modified; enumeration operation may not execute.\" | string\r\n  | Source | \"System.Private.CoreLib\" | string\r\n  | StackTrace | \"   at System.ThrowHelper.ThrowInvalidOperationException_InvalidOperation_EnumFailedVersion() in /_/src/libraries/System.Private.CoreLib/src/System/ThrowHelper.cs:line 361\" | string\r\n\r\n<!--EndFragment-->\r\n</body>\r\n</HTML>\r\n\r\nYesterday I ran the application from OUTSIDE Visual Studio 2022 from the DEBUG directory.  When I clicked the close button the application appeared to shut down without issue, but looking in the Windows Application Log I saw:\r\n\r\n```\r\nApplication: WeatherWire_Personal.exe\r\nCoreCLR Version: 5.0.1221.52207\r\n.NET Version: 5.0.12\r\nDescription: The process was terminated due to an unhandled exception.\r\nException Info: System.InvalidOperationException: Collection was modified; enumeration operation may not execute.\r\n   at System.Collections.Generic.List`1.Enumerator.MoveNextRare()\r\n   at Microsoft.Data.Sqlite.SqliteConnectionPool.ReclaimLeakedConnections()\r\n   at Microsoft.Data.Sqlite.SqliteConnectionPool.Clear()\r\n   at Microsoft.Data.Sqlite.SqliteConnectionFactory.ReleasePool(SqliteConnectionPool pool, Boolean clearing)\r\n   at Microsoft.Data.Sqlite.SqliteConnectionPoolGroup.Clear()\r\n   at Microsoft.Data.Sqlite.SqliteConnectionFactory.ClearPools()\r\n   at Microsoft.Data.Sqlite.SqliteConnectionFactory.<.ctor>b__7_1(Object _, EventArgs _)\r\n   at System.AppContext.OnProcessExit()\r\n```\r\n...then immediately after...\r\n```\r\nFaulting application name: WeatherWire_Personal.exe, version: 0.1.1.0, time stamp: 0x61732c02\r\nFaulting module name: KERNELBASE.dll, version: 10.0.19041.1387, time stamp: 0x0b9a844a\r\nException code: 0xe0434352\r\nFault offset: 0x0000000000034f69\r\nFaulting process id: 0xa208\r\nFaulting application start time: 0x01d802880e12fd2f\r\nFaulting application path: P:\\Development\\WeatherWire\\WeatherWire_Personal\\bin\\Debug\\net5.0-windows\\WeatherWire_Personal.exe\r\nFaulting module path: C:\\WINDOWS\\System32\\KERNELBASE.dll\r\nReport Id: d9c0925c-d9ae-40aa-b747-62bb35d2d0ea\r\nFaulting package full name: \r\nFaulting package-relative application ID: \r\n```\r\nI checked that I closed and even DISPOSE() my Sqlite Database connections.\r\n\r\nI'm totally at a loss if this is something with Visual Studio, .Net 5, or what.  It doesn't appear to be code that I'm running, although I haven't ruled it out.  It's just that the exception is being thrown after all my code stops running.\r\n\r\nI'd appreciate any guidance on where to look next that anyone has.\r\n\r\n-Joe\r\n\r\n\r\n","closed_by":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/27168/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/27168/timeline","performed_via_github_app":null,"state_reason":"completed"}