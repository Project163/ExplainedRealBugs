{"url":"https://api.github.com/repos/dotnet/efcore/issues/34028","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/34028/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/34028/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/34028/events","html_url":"https://github.com/dotnet/efcore/issues/34028","id":2360502067,"node_id":"I_kwDOAPaMMs6Msmcz","number":34028,"title":"User parameter data is referenced inside RelationalCommandCache","user":{"login":"renanhgon","id":42190575,"node_id":"MDQ6VXNlcjQyMTkwNTc1","avatar_url":"https://avatars.githubusercontent.com/u/42190575?v=4","gravatar_id":"","url":"https://api.github.com/users/renanhgon","html_url":"https://github.com/renanhgon","followers_url":"https://api.github.com/users/renanhgon/followers","following_url":"https://api.github.com/users/renanhgon/following{/other_user}","gists_url":"https://api.github.com/users/renanhgon/gists{/gist_id}","starred_url":"https://api.github.com/users/renanhgon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renanhgon/subscriptions","organizations_url":"https://api.github.com/users/renanhgon/orgs","repos_url":"https://api.github.com/users/renanhgon/repos","events_url":"https://api.github.com/users/renanhgon/events{/privacy}","received_events_url":"https://api.github.com/users/renanhgon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1675384372,"node_id":"MDU6TGFiZWwxNjc1Mzg0Mzcy","url":"https://api.github.com/repos/dotnet/efcore/labels/area-query","name":"area-query","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/205","html_url":"https://github.com/dotnet/efcore/milestone/205","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/205/labels","id":11582336,"node_id":"MI_kwDOAPaMMs4AsLuA","number":205,"title":"8.0.11","description":null,"creator":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2024-09-14T06:41:33Z","updated_at":"2025-01-23T07:33:07Z","due_on":null,"closed_at":"2024-11-14T11:54:17Z"},"comments":28,"created_at":"2024-06-18T18:58:37Z","updated_at":"2025-06-15T20:05:20Z","closed_at":"2025-01-23T07:33:06Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When I start my application, gradually, as processes are executed, the memory consumption just keeps increasing until my k8s pod simply dies due to lack of memory and gets restarted.\r\n\r\nAfter analyzing the generated dumps, we observed the following:\r\n\r\n![image](https://github.com/dotnet/efcore/assets/42190575/85c61633-8325-466b-b8b2-1d4d006cb582)\r\n\r\nTo ensure that the dispose method of my **DbContext** is always executed, some logs were added during its creation and disposal.\r\n```C#\r\npublic MyDbContext(IDatabaseConfig configuration, \r\n    ISeed seed, \r\n    ILogger<MyDbContext> logger)\r\n{\r\n    _contextId = Guid.NewGuid();\r\n    _logger = logger;\r\n\r\n    _logger.LogInformation(\"Context created. ID {0}\", _contextId.ToString());\r\n\r\n    _configuration = configuration;\r\n    _seed = seed;\r\n}\r\n\r\npublic override void Dispose()\r\n{\r\n    base.Dispose();\r\n    _logger.LogInformation(\"Context destroyed. ID {0}\", _contextId.ToString());\r\n}\r\n\r\npublic override ValueTask DisposeAsync()\r\n{\r\n    var result = base.DisposeAsync();\r\n    _logger.LogInformation(\"Context destroyed. ID {0}\", _contextId.ToString());\r\n    return result;\r\n}\r\n```\r\n\r\nAnd from these logs, we were able to confirm that the object is indeed always created and disposed without any problems.\r\n\r\nIn some previous issues, I observed some possible causes within the **OnConfiguring** method, but I believe that is not the problem in my case.\r\n\r\n```C#\r\nprotected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\r\n{\r\n    if (!optionsBuilder.IsConfigured)\r\n        optionsBuilder.UseNpgsql(_configuration.ConnectionString);\r\n\r\n    base.OnConfiguring(optionsBuilder);\r\n}\r\n```\r\n\r\nMy DbContext instance is resolved in this way:\r\n\r\n```C#\r\nprivate static void RegisterContext(IServiceCollection services) \r\n    => services.AddDbContext<IMyDbContext, MyDbContext>();\r\n```\r\n\r\nThe issue was created here because **Microsoft.EntityFrameworkCore.Internal.ServiceProviderCache** is indicated. But perhaps the problem might be related to the GarbageCollector?\r\n\r\nEF Core version: 8.0.6\r\nDatabase provider: Npgsql.EntityFrameworkCore.PostgreSQL\r\nTarget framework: NET 8.0\r\nOperating system: Windows 10\r\nIDE: Visual Studio 2022 17.10.1\r\nMy container is running with this base image: mcr.microsoft.com/dotnet/aspnet:8.0","closed_by":{"login":"roji","id":1862641,"node_id":"MDQ6VXNlcjE4NjI2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1862641?v=4","gravatar_id":"","url":"https://api.github.com/users/roji","html_url":"https://github.com/roji","followers_url":"https://api.github.com/users/roji/followers","following_url":"https://api.github.com/users/roji/following{/other_user}","gists_url":"https://api.github.com/users/roji/gists{/gist_id}","starred_url":"https://api.github.com/users/roji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roji/subscriptions","organizations_url":"https://api.github.com/users/roji/orgs","repos_url":"https://api.github.com/users/roji/repos","events_url":"https://api.github.com/users/roji/events{/privacy}","received_events_url":"https://api.github.com/users/roji/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/34028/reactions","total_count":11,"+1":11,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/34028/timeline","performed_via_github_app":null,"state_reason":"completed"}