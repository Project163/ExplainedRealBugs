{"url":"https://api.github.com/repos/dotnet/efcore/issues/32614","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/32614/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/32614/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/32614/events","html_url":"https://github.com/dotnet/efcore/issues/32614","id":2041829998,"node_id":"I_kwDOAPaMMs55s9pu","number":32614,"title":"Using SqliteConnection from an ASP.NET MVC (.NET Framework) application results in a few different exceptions","user":{"login":"thatnerdyguy","id":12850718,"node_id":"MDQ6VXNlcjEyODUwNzE4","avatar_url":"https://avatars.githubusercontent.com/u/12850718?v=4","gravatar_id":"","url":"https://api.github.com/users/thatnerdyguy","html_url":"https://github.com/thatnerdyguy","followers_url":"https://api.github.com/users/thatnerdyguy/followers","following_url":"https://api.github.com/users/thatnerdyguy/following{/other_user}","gists_url":"https://api.github.com/users/thatnerdyguy/gists{/gist_id}","starred_url":"https://api.github.com/users/thatnerdyguy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thatnerdyguy/subscriptions","organizations_url":"https://api.github.com/users/thatnerdyguy/orgs","repos_url":"https://api.github.com/users/thatnerdyguy/repos","events_url":"https://api.github.com/users/thatnerdyguy/events{/privacy}","received_events_url":"https://api.github.com/users/thatnerdyguy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":514908713,"node_id":"MDU6TGFiZWw1MTQ5MDg3MTM=","url":"https://api.github.com/repos/dotnet/efcore/labels/regression","name":"regression","color":"ff1fff","default":false,"description":null},{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1017558838,"node_id":"MDU6TGFiZWwxMDE3NTU4ODM4","url":"https://api.github.com/repos/dotnet/efcore/labels/Servicing-approved","name":"Servicing-approved","color":"048708","default":false,"description":""},{"id":1111789566,"node_id":"MDU6TGFiZWwxMTExNzg5NTY2","url":"https://api.github.com/repos/dotnet/efcore/labels/area-adonet-sqlite","name":"area-adonet-sqlite","color":"044a64","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/188","html_url":"https://github.com/dotnet/efcore/milestone/188","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/188/labels","id":10432910,"node_id":"MI_kwDOAPaMMs4AnzGO","number":188,"title":"8.0.3","description":null,"creator":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":22,"state":"closed","created_at":"2024-01-18T01:09:32Z","updated_at":"2024-04-09T08:41:20Z","due_on":null,"closed_at":"2024-04-09T08:41:20Z"},"comments":4,"created_at":"2023-12-14T14:34:58Z","updated_at":"2025-06-15T19:55:57Z","closed_at":"2024-02-07T12:57:44Z","author_association":"NONE","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Example project from following steps below: [WebApplication1.zip](https://github.com/dotnet/efcore/files/13674431/WebApplication1.zip)\r\n\r\n1. (In Visual Studio) Create a new ASP.NET Web Application (.NET Framework), chose MVC\r\n2. Add a NuGet reference to Microsoft.Data.Sqlite, version 8.0.0\r\n3. In the HomeController.cs, change the Index() action to:\r\n```C#\r\n        public ActionResult Index()\r\n        {\r\n            using (var conn = new SqliteConnection())\r\n            {\r\n                System.Console.WriteLine(\"SqliteConnection was created!\");\r\n            }\r\n\r\n            return View();\r\n        }\r\n```\r\n4. Run it locally under Debug, and you get something like:\r\n```\r\nLibrary e_sqlite3 not found\r\nplat: win\r\nsuffix: DLL\r\npossibilities (2):\r\n   1) C:\\Users\\TheUser\\AppData\\Local\\Temp\\Temporary ASP.NET Files\\vs\\68a120e0\\7682694\\assembly\\dl3\\8ffaeae5\\008bde07_f1d5d901\\runtimes\\win-x64\\native\\e_sqlite3.dll\r\n   2) C:\\Users\\TheUser\\AppData\\Local\\Temp\\Temporary ASP.NET Files\\vs\\68a120e0\\7682694\\assembly\\dl3\\8ffaeae5\\008bde07_f1d5d901\\e_sqlite3.dll\r\nwin TryLoad: C:\\Users\\TheUser\\AppData\\Local\\Temp\\Temporary ASP.NET Files\\vs\\68a120e0\\7682694\\assembly\\dl3\\8ffaeae5\\008bde07_f1d5d901\\runtimes\\win-x64\\native\\e_sqlite3.dll\r\nthrown: System.ComponentModel.Win32Exception (0x80004005): The specified module could not be found\r\n  at SQLitePCL.NativeLibrary.TryLoad(String name, Loader plat, Action`1 log, IntPtr& h)\r\nwin TryLoad: C:\\Users\\TheUser\\AppData\\Local\\Temp\\Temporary ASP.NET Files\\vs\\68a120e0\\7682694\\assembly\\dl3\\8ffaeae5\\008bde07_f1d5d901\\e_sqlite3.dll\r\nthrown: System.ComponentModel.Win32Exception (0x80004005): The specified module could not be found\r\n  at SQLitePCL.NativeLibrary.TryLoad(String name, Loader plat, Action`1 log, IntPtr& h)\r\nNOT FOUND\r\n```\r\n\r\nNow, even if you get around that (we got around it here by doing a runtime copy of e_sqlite.dll to the shadow copy location of SQLitePCLRaw.core.DLL), you can still get exceptions (as of version 8.0.0) from the type initialization of SqliteConnection, which you can approximate (in the attached example project), but uncommenting the ApproximateSqlConnectionStaticCtor() call in HomeController.Index(). In which case, you get:\r\n\r\n```\r\n[ArgumentException: The parameter is incorrect. (Exception from HRESULT: 0x80070057 (E_INVALIDARG))]\r\n   System.RuntimeTypeHandle.GetTypeByName(String name, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMarkHandle stackMark, IntPtr pPrivHostBinder, Boolean loadTypeFromPartialName, ObjectHandleOnStack type) +0\r\n   System.RuntimeTypeHandle.GetTypeByName(String name, Boolean throwOnError, Boolean ignoreCase, Boolean reflectionOnly, StackCrawlMark& stackMark, IntPtr pPrivHostBinder, Boolean loadTypeFromPartialName) +96\r\n   System.Type.GetType(String typeName) +62\r\n   WebApplication1.Controllers.HomeController.ApproximateSqlConnectionStaticCtor() in C:\\Code\\WebApplication1\\Controllers\\HomeController.cs:50\r\n   WebApplication1.Controllers.HomeController.Index() in C:\\Code\\WebApplication1\\Controllers\\HomeController.cs:18\r\n   lambda_method(Closure , ControllerBase , Object[] ) +87\r\n   System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +35\r\n   System.Web.Mvc.Async.<>c.<BeginInvokeSynchronousActionMethod>b__9_0(IAsyncResult asyncResult, ActionInvocation innerInvokeState) +39\r\n   System.Web.Mvc.Async.WrappedAsyncResult`2.CallEndDelegate(IAsyncResult asyncResult) +77\r\n   System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethod(IAsyncResult asyncResult) +42\r\n   System.Web.Mvc.Async.<>c__DisplayClass11_0.<InvokeActionMethodFilterAsynchronouslyRecursive>b__0() +80\r\n   System.Web.Mvc.Async.<>c__DisplayClass11_2.<InvokeActionMethodFilterAsynchronouslyRecursive>b__2() +396\r\n   System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethodWithFilters(IAsyncResult asyncResult) +42\r\n   System.Web.Mvc.Async.<>c__DisplayClass3_6.<BeginInvokeAction>b__4() +50\r\n   System.Web.Mvc.Async.<>c__DisplayClass3_1.<BeginInvokeAction>b__1(IAsyncResult asyncResult) +188\r\n   System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeAction(IAsyncResult asyncResult) +38\r\n   System.Web.Mvc.<>c.<BeginExecuteCore>b__152_1(IAsyncResult asyncResult, ExecuteCoreState innerState) +29\r\n   System.Web.Mvc.Async.WrappedAsyncVoid`1.CallEndDelegate(IAsyncResult asyncResult) +73\r\n   System.Web.Mvc.Controller.EndExecuteCore(IAsyncResult asyncResult) +52\r\n   System.Web.Mvc.Async.WrappedAsyncVoid`1.CallEndDelegate(IAsyncResult asyncResult) +39\r\n   System.Web.Mvc.Controller.EndExecute(IAsyncResult asyncResult) +38\r\n   System.Web.Mvc.<>c.<BeginProcessRequest>b__20_1(IAsyncResult asyncResult, ProcessRequestState innerState) +43\r\n   System.Web.Mvc.Async.WrappedAsyncVoid`1.CallEndDelegate(IAsyncResult asyncResult) +73\r\n   System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult) +38\r\n   System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +646\r\n   System.Web.HttpApplication.ExecuteStepImpl(IExecutionStep step) +182\r\n   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously) +134\r\n```\r\nat\r\n\r\n```\r\nLine 48:                 try\r\nLine 49:                 {\r\nLine 50:                     appDataType = Type.GetType(\"Windows.Storage.ApplicationData, Windows, ContentType=WindowsRuntime\")\r\nLine 51:                         ?? Type.GetType(\"Windows.Storage.ApplicationData, Microsoft.Windows.SDK.NET\");\r\nLine 52: \r\n```\r\n\r\n### Include version information\r\n\r\nMicrosoft.Data.Sqlite version: 8.0.0\r\nTarget framework: net48\r\nOperating system: Windows\r\n","closed_by":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/32614/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/32614/timeline","performed_via_github_app":null,"state_reason":"completed"}