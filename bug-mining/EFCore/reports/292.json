{"url":"https://api.github.com/repos/dotnet/efcore/issues/31749","repository_url":"https://api.github.com/repos/dotnet/efcore","labels_url":"https://api.github.com/repos/dotnet/efcore/issues/31749/labels{/name}","comments_url":"https://api.github.com/repos/dotnet/efcore/issues/31749/comments","events_url":"https://api.github.com/repos/dotnet/efcore/issues/31749/events","html_url":"https://github.com/dotnet/efcore/issues/31749","id":1898031958,"node_id":"I_kwDOAPaMMs5xIatW","number":31749,"title":"Owned type not working when referenced from entity with inheritance","user":{"login":"JoasE","id":32096708,"node_id":"MDQ6VXNlcjMyMDk2NzA4","avatar_url":"https://avatars.githubusercontent.com/u/32096708?v=4","gravatar_id":"","url":"https://api.github.com/users/JoasE","html_url":"https://github.com/JoasE","followers_url":"https://api.github.com/users/JoasE/followers","following_url":"https://api.github.com/users/JoasE/following{/other_user}","gists_url":"https://api.github.com/users/JoasE/gists{/gist_id}","starred_url":"https://api.github.com/users/JoasE/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JoasE/subscriptions","organizations_url":"https://api.github.com/users/JoasE/orgs","repos_url":"https://api.github.com/users/JoasE/repos","events_url":"https://api.github.com/users/JoasE/events{/privacy}","received_events_url":"https://api.github.com/users/JoasE/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":936619505,"node_id":"MDU6TGFiZWw5MzY2MTk1MDU=","url":"https://api.github.com/repos/dotnet/efcore/labels/customer-reported","name":"customer-reported","color":"a4a5f9","default":false,"description":""},{"id":1900941630,"node_id":"MDU6TGFiZWwxOTAwOTQxNjMw","url":"https://api.github.com/repos/dotnet/efcore/labels/area-model-building","name":"area-model-building","color":"32b37b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/dotnet/efcore/milestones/152","html_url":"https://github.com/dotnet/efcore/milestone/152","labels_url":"https://api.github.com/repos/dotnet/efcore/milestones/152/labels","id":8392036,"node_id":"MI_kwDOAPaMMs4AgA1k","number":152,"title":"8.0.0","description":"EF Core 8.0","creator":{"login":"ajcvickers","id":1430078,"node_id":"MDQ6VXNlcjE0MzAwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/1430078?v=4","gravatar_id":"","url":"https://api.github.com/users/ajcvickers","html_url":"https://github.com/ajcvickers","followers_url":"https://api.github.com/users/ajcvickers/followers","following_url":"https://api.github.com/users/ajcvickers/following{/other_user}","gists_url":"https://api.github.com/users/ajcvickers/gists{/gist_id}","starred_url":"https://api.github.com/users/ajcvickers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajcvickers/subscriptions","organizations_url":"https://api.github.com/users/ajcvickers/orgs","repos_url":"https://api.github.com/users/ajcvickers/repos","events_url":"https://api.github.com/users/ajcvickers/events{/privacy}","received_events_url":"https://api.github.com/users/ajcvickers/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":280,"state":"closed","created_at":"2022-09-07T19:55:36Z","updated_at":"2025-04-07T08:59:46Z","due_on":null,"closed_at":"2023-11-14T14:00:33Z"},"comments":3,"created_at":"2023-09-15T09:13:29Z","updated_at":"2025-06-15T19:51:51Z","closed_at":"2023-10-12T07:29:33Z","author_association":"CONTRIBUTOR","type":{"id":1092402,"node_id":"IT_kwDOAIt-yc4AEKsy","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T11:45:43Z","updated_at":"2024-07-26T10:20:14Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## File a bug\r\n\r\nHaving an owned type property on a base type is not recognized.\r\nThe generated migration does not contain a column for the property of the owned type.\r\n\r\n### Include your code\r\n\r\nRepo: https://github.com/JoasE/EfInheritanceOwnedType\r\n\r\nConsider the following model.\r\n```C#\r\npublic abstract class BaseType\r\n{\r\n    public BaseType(OwnedType ownedType)\r\n    {\r\n        OwnedType = ownedType;\r\n    }\r\n\r\n    protected BaseType(){}\r\n\r\n    public Guid Id { get; } = Guid.NewGuid();\r\n    public OwnedType OwnedType { get; }\r\n}\r\n\r\npublic class SubTypeOne : BaseType\r\n{\r\n    public SubTypeOne(OwnedType ownedType) : base(ownedType) {}\r\n    private SubTypeOne() {}\r\n}\r\n\r\npublic class SubTypeTwo : BaseType\r\n{\r\n    public SubTypeTwo(OwnedType ownedType) : base(ownedType) {}\r\n    private SubTypeTwo() {}\r\n}\r\n\r\n\r\npublic class OwnedType\r\n{\r\n    public OwnedType(Guid id)\r\n    {\r\n        Id = id;\r\n    }\r\n    public Guid Id { get; }\r\n}\r\n```\r\n\r\nUsing the following configuration:\r\n```csharp\r\nmodelBuilder.Owned<OwnedType>();\r\nmodelBuilder.Entity<BaseType>(baseType =>\r\n{\r\n    baseType.UseTpcMappingStrategy();\r\n\r\n    baseType.Property(x => x.Id);\r\n    baseType.OwnsOne(x => x.OwnedType, cfg => cfg.Property(x => x.Id));\r\n});\r\n```\r\n\r\nI would expect the generated migration to include the `OwnedType` `Id` property for the `SubTypeOne` and `SubTypeTwo` tables, but they do not. \r\n\r\n```csharp\r\nmigrationBuilder.CreateTable(\r\n    name: \"SubTypeOnes\",\r\n    columns: table => new\r\n    {\r\n        Id = table.Column<Guid>(type: \"uniqueidentifier\", nullable: false)\r\n    },\r\n    constraints: table =>\r\n    {\r\n        table.PrimaryKey(\"PK_SubTypeOnes\", x => x.Id);\r\n    });\r\n\r\nmigrationBuilder.CreateTable(\r\n    name: \"SubTypeTwos\",\r\n    columns: table => new\r\n    {\r\n        Id = table.Column<Guid>(type: \"uniqueidentifier\", nullable: false)\r\n    },\r\n    constraints: table =>\r\n    {\r\n        table.PrimaryKey(\"PK_SubTypeTwos\", x => x.Id);\r\n    });\r\n```\r\n\r\nI've also tried to rename the property on the owned type to something else and even giving that property a setter.\r\n\r\n### Include verbose output\r\n\r\n```\r\nUsing project 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj'.\r\nUsing startup project 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj'.\r\nWriting 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\obj\\EfInheritanceOwnedType.csproj.EntityFrameworkCore.targets'...\r\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\joase\\AppData\\Local\\Temp\\tmpg0lmin.tmp /verbosity:quiet /nologo C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj\r\nWriting 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\obj\\EfInheritanceOwnedType.csproj.EntityFrameworkCore.targets'...\r\ndotnet msbuild /target:GetEFProjectMetadata /property:EFProjectMetadataFile=C:\\Users\\joase\\AppData\\Local\\Temp\\tmprwv3jw.tmp /verbosity:quiet /nologo C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj\r\nBuild started...\r\ndotnet build C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj /verbosity:quiet /nologo /p:PublishAot=false\r\nC:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\Program.cs(14,15): warning CS8618: Non-nullable property 'OwnedType' must contain a non-null value when exiting constructor. Consider declaring the property as nullable. [C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj]\r\n\r\nBuild succeeded.\r\n\r\nC:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\Program.cs(14,15): warning CS8618: Non-nullable property 'OwnedType' must contain a non-null value when exiting constructor. Consider declaring the property as nullable. [C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj]\r\n    1 Warning(s)\r\n    0 Error(s)\r\n\r\nTime Elapsed 00:00:00.94\r\nBuild succeeded.\r\ndotnet exec --depsfile C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\bin\\Debug\\net8.0\\EfInheritanceOwnedType.deps.json --additionalprobingpath C:\\Users\\joase\\.nuget\\packages --additionalprobingpath \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\NuGetPackages\" --runtimeconfig C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\bin\\Debug\\net8.0\\EfInheritanceOwnedType.runtimeconfig.json C:\\Users\\joase\\.nuget\\packages\\dotnet-ef\\8.0.0-rc.1.23419.6\\tools\\net8.0\\any\\tools\\netcoreapp2.0\\any\\ef.dll migrations add Initial --assembly C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\bin\\Debug\\net8.0\\EfInheritanceOwnedType.dll --project C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj --startup-assembly C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\bin\\Debug\\net8.0\\EfInheritanceOwnedType.dll --startup-project C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\EfInheritanceOwnedType.csproj --project-dir C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\ --root-namespace EfInheritanceOwnedType --language C# --framework net8.0 --nullable --working-dir C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType --verbose\r\nUsing assembly 'EfInheritanceOwnedType'.\r\nUsing startup assembly 'EfInheritanceOwnedType'.\r\nUsing application base 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\bin\\Debug\\net8.0'.\r\nUsing working directory 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType'.\r\nUsing root namespace 'EfInheritanceOwnedType'.\r\nUsing project directory 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\'.\r\nRemaining arguments: .\r\nFinding DbContext classes...\r\nFinding IDesignTimeDbContextFactory implementations...\r\nFinding application service provider in assembly 'EfInheritanceOwnedType'...\r\nFinding Microsoft.Extensions.Hosting service provider...\r\nNo static method 'CreateHostBuilder(string[])' was found on class 'Program'.\r\nNo application service provider was found.\r\nFinding DbContext classes in the project...\r\nFound DbContext 'TestDbContext'.\r\nUsing context 'TestDbContext'.\r\nFinding design-time services referenced by assembly 'EfInheritanceOwnedType'...\r\nFinding design-time services referenced by assembly 'EfInheritanceOwnedType'...\r\nNo referenced design-time services were found.\r\nFinding design-time services for provider 'Microsoft.EntityFrameworkCore.SqlServer'...\r\nUsing design-time services from provider 'Microsoft.EntityFrameworkCore.SqlServer'.\r\nFinding IDesignTimeServices implementations in assembly 'EfInheritanceOwnedType'...\r\nNo design-time services were found.\r\nThe property 'OwnedType.BaseTypeId' was created in shadow state because there are no eligible CLR members with a matching name.\r\nWriting migration to 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\Migrations\\20230915090151_Initial.cs'.\r\nWriting model snapshot to 'C:\\Users\\joase\\source\\repos\\EfInheritanceOwnedType\\EfInheritanceOwnedType\\Migrations\\TestDbContextModelSnapshot.cs'.\r\n'TestDbContext' disposed.\r\nDone. To undo this action, use 'ef migrations remove'\r\n```\r\n\r\n### Include provider and version information\r\n\r\nEF Core version: 8.0.0-rc.1.23419.6\r\nDatabase provider: Microsoft.EntityFrameworkCore.SqlServer 8.0.0-rc.1.23419.6\r\nTarget framework: .NET 8-RC1\r\nOperating system: Windows 11\r\nIDE: Visual Studio 2022 17.8.0 Preview 2\r\n","closed_by":{"login":"AndriySvyryd","id":6539701,"node_id":"MDQ6VXNlcjY1Mzk3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/6539701?v=4","gravatar_id":"","url":"https://api.github.com/users/AndriySvyryd","html_url":"https://github.com/AndriySvyryd","followers_url":"https://api.github.com/users/AndriySvyryd/followers","following_url":"https://api.github.com/users/AndriySvyryd/following{/other_user}","gists_url":"https://api.github.com/users/AndriySvyryd/gists{/gist_id}","starred_url":"https://api.github.com/users/AndriySvyryd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndriySvyryd/subscriptions","organizations_url":"https://api.github.com/users/AndriySvyryd/orgs","repos_url":"https://api.github.com/users/AndriySvyryd/repos","events_url":"https://api.github.com/users/AndriySvyryd/events{/privacy}","received_events_url":"https://api.github.com/users/AndriySvyryd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/dotnet/efcore/issues/31749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dotnet/efcore/issues/31749/timeline","performed_via_github_app":null,"state_reason":"completed"}