<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:54:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[EMAIL-127] ImageHtmlEmail: Dollar or Backslash in certain places in &lt;img ... src...&gt;-tags causes exceptions &quot;IllegalArgumentException: Illegal group reference&quot;</title>
                <link>https://issues.apache.org/jira/browse/EMAIL-127</link>
                <project id="12310474" key="EMAIL">Commons Email</project>
                    <description>&lt;p&gt;I have a unit test which shows that dollar sign and backslash cause ImageHtmlEmail to throw an Exception (unfortunately not easy to provide a complete unit test, but it should be easy to enhance one of the existing tests for ImageHtmlEmail):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;			FileUtils.writeStringToFile(file, &quot;&amp;lt;html&amp;gt;teststring &amp;lt;img title=\&quot;$\&quot; src=\&quot;file://&quot; + file.getAbsolutePath() + &quot;\&quot;/&amp;gt;&amp;lt;/html&amp;gt;&quot;);&lt;/p&gt;

&lt;p&gt;			sender.sendHTMLEmail(files, mailConfig, emailConfig, REPORT_DIR);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It will throw the following Exception:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;java.lang.IllegalArgumentException: Illegal group reference&lt;br/&gt;
	at java.util.regex.Matcher.appendReplacement(Matcher.java:808)&lt;br/&gt;
	at org.apache.commons.mail.ImageHtmlEmail.replacePattern(ImageHtmlEmail.java:180)&lt;br/&gt;
	at org.apache.commons.mail.ImageHtmlEmail.buildMimeMessage(ImageHtmlEmail.java:103)&lt;br/&gt;
	at org.apache.commons.mail.Email.send(Email.java:1427)&lt;br/&gt;
	at EmailSender.sendHTMLEmail(EmailSender.java:93)&lt;br/&gt;
	at EmailSenderTest.testImageHtmlEmailDollarBackslash(EmailSenderTest.java:801)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;the cause is that Matcher.appendReplacement() actually treats Dollar and Backslash as special characters. From the javadoc of Matcher:&lt;/p&gt;

&lt;blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;Note that backslashes (&amp;lt;tt&amp;gt;\&amp;lt;/tt&amp;gt;) and dollar signs (&amp;lt;tt&amp;gt;$&amp;lt;/tt&amp;gt;) in&lt;/li&gt;
	&lt;li&gt;the replacement string may cause the results to be different than if it&lt;/li&gt;
	&lt;li&gt;were being treated as a literal replacement string. Dollar signs may be&lt;/li&gt;
	&lt;li&gt;treated as references to captured subsequences as described above, and&lt;/li&gt;
	&lt;li&gt;backslashes are used to escape literal characters in the replacement&lt;/li&gt;
	&lt;li&gt;string.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;A possible fix is to replace line 180 of ImageHtmlEmail.java with the following, i.e. replace &lt;tt&gt;$&lt;/tt&gt; by &lt;tt&gt;\$&lt;/tt&gt; and \ by \ \  to have them properly escaped.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;matcher.appendReplacement(stringBuffer, (matcher.group(1) + &lt;span class=&quot;code-quote&quot;&gt;&quot;cid:&quot;&lt;/span&gt; + cid + matcher.group(3)).replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;\\\\&quot;&lt;/span&gt;).replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;$&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;\\$&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="12655217">EMAIL-127</key>
            <summary>ImageHtmlEmail: Dollar or Backslash in certain places in &lt;img ... src...&gt;-tags causes exceptions &quot;IllegalArgumentException: Illegal group reference&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="centic">Dominik Stadler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Jun 2013 20:37:26 +0000</created>
                <updated>Thu, 24 Oct 2013 20:09:08 +0000</updated>
                            <resolved>Mon, 1 Jul 2013 19:08:57 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13695042" author="centic" created="Thu, 27 Jun 2013 20:40:05 +0000"  >&lt;p&gt;first replace backslash then dollar to not escape backslash from dollar-escaping again...&lt;/p&gt;</comment>
                            <comment id="13697079" author="tn" created="Mon, 1 Jul 2013 19:08:57 +0000"  >&lt;p&gt;Fixed in r1498625.&lt;/p&gt;

&lt;p&gt;I used Matcher.quoteReplacement to escape the replacement string.&lt;/p&gt;

&lt;p&gt;Thanks for the report!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335494</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 20 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lvd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335818</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>