<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:54:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[EMAIL-110] java.lang.OutOfMemoryError: Java heap space while parsing Mime part</title>
                <link>https://issues.apache.org/jira/browse/EMAIL-110</link>
                <project id="12310474" key="EMAIL">Commons Email</project>
                    <description>&lt;p&gt;I have a particular eml message which appears to cause a complete memory overflow deep within commons-email.&lt;br/&gt;
A look at the source code does reveal a suspect &quot;while&quot; loop which appears to never exit properly, and should be rewritten so that bad data could not give us this situation.&lt;br/&gt;
The stack trace is :&lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
	at java.util.Arrays.copyOf(Arrays.java:2786)&lt;br/&gt;
	at java.io.ByteArrayOutputStream.write(ByteArrayOutputStream.java:71)&lt;br/&gt;
	at javax.mail.internet.MimeMultipart.readTillFirstBoundary(MimeMultipart.java:316)&lt;br/&gt;
	at javax.mail.internet.MimeMultipart.parse(MimeMultipart.java:186)&lt;br/&gt;
	at javax.mail.internet.MimeMultipart.updateHeaders(MimeMultipart.java:130)&lt;br/&gt;
	at javax.mail.internet.MimeBodyPart.updateHeaders(MimeBodyPart.java:539)&lt;br/&gt;
	at javax.mail.internet.MimeMultipart.updateHeaders(MimeMultipart.java:133)&lt;br/&gt;
	at javax.mail.internet.MimeMessage.updateHeaders(MimeMessage.java:1393)&lt;br/&gt;
	at javax.mail.internet.MimeMessage.saveChanges(MimeMessage.java:1366)&lt;br/&gt;
	at javax.mail.Transport.send(Transport.java:76)&lt;br/&gt;
	at javax.mail.Transport.send(Transport.java:48)&lt;/p&gt;

&lt;p&gt;There are many public threads illustrating this same error, but they never pinpoint the code to Commons Email, I&apos;m guessing I&apos;m using the code in a way which exhibits this behaviour :&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/3177092/uploading-to-blobstore-gives-a-java-heap-outofmemoryerror&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/3177092/uploading-to-blobstore-gives-a-java-heap-outofmemoryerror&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/2994031/outofmemoryerror-trying-to-upload-to-blobstore-locally&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/2994031/outofmemoryerror-trying-to-upload-to-blobstore-locally&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows, Linux&lt;/p&gt;</environment>
        <key id="12534647">EMAIL-110</key>
            <summary>java.lang.OutOfMemoryError: Java heap space while parsing Mime part</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="sgoeschl">Siegfried Goeschl</assignee>
                                    <reporter username="skruger">Stephen Kruger</reporter>
                        <labels>
                    </labels>
                <created>Sun, 11 Dec 2011 09:18:13 +0000</created>
                <updated>Sat, 18 Feb 2012 21:35:39 +0000</updated>
                            <resolved>Tue, 17 Jan 2012 05:13:36 +0000</resolved>
                                    <version>1.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13167072" author="skruger" created="Sun, 11 Dec 2011 09:19:52 +0000"  >&lt;p&gt;The email message which crashes Commons email parser.&lt;/p&gt;</comment>
                            <comment id="13167074" author="maurizio.cucchiara" created="Sun, 11 Dec 2011 09:54:52 +0000"  >&lt;p&gt;Honestly, OOME are common in many situations and not necessarily related to commons. Sometimes increase the heap space fixes the problem.&lt;br/&gt;
But in order to detect your issue, I think it could be helpful if you provide some more details:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;what are you trying to achieve?&lt;/li&gt;
	&lt;li&gt;could you provide a code chunk you are trying to execute?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13167118" author="skruger" created="Sun, 11 Dec 2011 15:46:37 +0000"  >&lt;p&gt;Small Eclipse / Maven project which reproduces the problem.&lt;/p&gt;</comment>
                            <comment id="13167119" author="skruger" created="Sun, 11 Dec 2011 15:47:18 +0000"  >&lt;p&gt;The test mail I&apos;m trying to send is way too  small to warrant increasing heap space. It&apos;s definitely a loop termination problem where it&apos;s looking for some termination chars which are not there (perhaps erroneously on the part of the test mail).&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a simple Eclipse project (Maven based) which recreates the problem entirely.&lt;br/&gt;
My apologies if the issue turns out to be in one of the other dependencies - since you all use javax.mail it&apos;s hard to understand whose implementation is actually being used.&lt;/p&gt;</comment>
                            <comment id="13167148" author="maurizio.cucchiara" created="Sun, 11 Dec 2011 17:55:17 +0000"  >&lt;p&gt;Good starting point, I can confirm the issue now.&lt;br/&gt;
But unfortunately, I can also confirm that the issue is not commons-related.&lt;br/&gt;
In fact reducing the dependencies list, it works as expected.&lt;br/&gt;
For the sake of completeness, I made a few changes:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;mail.smtp.host: localhost (Utils.java)
mail.smtp.port: 25

To:mcucchiara@localhost (crashfix.eml)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks like it is abdera-related (removing that dependency make it works)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;                                 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;                               
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;               
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;junit&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;         
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;4.10&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;                
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;compile&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;                 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;                              
                                               
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;                               
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.commons&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;  
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;commons-email&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; 
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.2&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;                 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;                              
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;                                
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13167218" author="skruger" created="Sun, 11 Dec 2011 21:50:10 +0000"  >&lt;p&gt;I did notice the failure went away without the Abdera dep. &lt;br/&gt;
But still - it&apos;s not right that including a dep can cause such a failure in commons-email, or are you saying that the javax.mail.internet.MimeMultipart where the failure happens is not the commons-email one?&lt;br/&gt;
Perhaps it&apos;s pulling in a Sun implementation of that class? Could you debug to see whose implementation is being used when using the Abdera dep? I specifically excluded the javax.mail inherited by Abdera ;&lt;br/&gt;
			&amp;lt;exclusions&amp;gt;&lt;br/&gt;
				&amp;lt;exclusion&amp;gt;&lt;br/&gt;
					&amp;lt;artifactId&amp;gt;mail&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
					&amp;lt;groupId&amp;gt;javax.mail&amp;lt;/groupId&amp;gt;&lt;br/&gt;
				&amp;lt;/exclusion&amp;gt;&lt;br/&gt;
			&amp;lt;/exclusions&amp;gt;&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="13184121" author="sgoeschl" created="Wed, 11 Jan 2012 15:13:28 +0000"  >&lt;p&gt;Checking the dependency tree using &quot;mvn dependency:tree&quot; allows you to see what is included where. Don&apos;t know Abdera but in the past there were known issues when &quot;geronimo-spec-javamail&quot; was included since it did not implement the whole functionality of javamail.&lt;/p&gt;

&lt;p&gt;Assuming that Abdera is actually Apache Abdera it includes&lt;/p&gt;

&lt;p&gt;&amp;lt;dependency&amp;gt;&lt;br/&gt;
  &amp;lt;groupId&amp;gt;org.apache.geronimo.specs&amp;lt;/groupId&amp;gt;&lt;br/&gt;
  &amp;lt;artifactId&amp;gt;geronimo-activation_1.1_spec&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
  &amp;lt;version&amp;gt;1.1&amp;lt;/version&amp;gt;  &lt;br/&gt;
&amp;lt;/dependency&amp;gt;&lt;/p&gt;

&lt;p&gt;which could cause the problem&lt;/p&gt;</comment>
                            <comment id="13184124" author="sgoeschl" created="Wed, 11 Jan 2012 15:22:00 +0000"  >&lt;p&gt;One more note - I checked the &quot;crashfix.eml&quot; using &quot;http://tools.ietf.org/tools/msglint/&quot; and &quot;http://www.mimevalidator.net/&quot; and both tools are not very happy. While I have never seen an email in the wild passing those tests I still think that something is wrong with the email&lt;/p&gt;</comment>
                            <comment id="13184333" author="thefake" created="Wed, 11 Jan 2012 19:59:38 +0000"  >&lt;p&gt;I&apos;ve checked the RFC 822 &lt;a href=&quot;http://www.ietf.org/rfc/rfc822.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ietf.org/rfc/rfc822.txt&lt;/a&gt; &lt;br/&gt;
In appendix B.2 it is stated that the header has to be seperated from the content by a null line. The eml file given with this issue is missing this seperating line.&lt;/p&gt;</comment>
                            <comment id="13184396" author="sebb@apache.org" created="Wed, 11 Jan 2012 21:13:10 +0000"  >&lt;p&gt;The current pom no longer depends on abdera or geronimo specs; it depends on javamail and activation.&lt;/p&gt;</comment>
                            <comment id="13184464" author="sgoeschl" created="Wed, 11 Jan 2012 22:38:47 +0000"  >&lt;p&gt;In order to avoid confusion&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;commons-email depends on javamail and activation&lt;/li&gt;
	&lt;li&gt;Stephan Kruger mentioned &quot;Abdera&quot; dependencies and it could be the Apache Abdera project which uses the geronimo libraries (see &lt;a href=&quot;http://svn.apache.org/repos/asf/abdera/abdera2/pom.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/abdera/abdera2/pom.xml&lt;/a&gt;) and excludes javamail (see the Axis deps)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13185526" author="thefake" created="Fri, 13 Jan 2012 09:57:16 +0000"  >&lt;p&gt;Added a Patch:&lt;br/&gt;
New MimeMessageParser test to verify that it can parse the eml file without getting OOM.&lt;br/&gt;
Reproduced an other eml file with the same defect, tested with the Maven project given by Stephen Kruger to ensure that the OOM error occures with it too.&lt;/p&gt;

&lt;p&gt;The eml file is corrupt, as mentioned in my comment above. So the MimeMessageParser cannot detect any attachment within it. &lt;br/&gt;
As an other example, Outlook Express cannot read it too. It shows the Attachment with a size of 0 Bytes&lt;/p&gt;</comment>
                            <comment id="13187455" author="sgoeschl" created="Tue, 17 Jan 2012 05:13:36 +0000"  >&lt;p&gt;Get no OutOfMemoryException and the mail message is actually invaslid&lt;/p&gt;</comment>
                            <comment id="13211104" author="sgoeschl" created="Sat, 18 Feb 2012 21:35:39 +0000"  >&lt;p&gt;Applied patch to trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12510481" name="EMAIL-110.patch" size="13020" author="thefake" created="Fri, 13 Jan 2012 09:57:16 +0000"/>
                            <attachment id="12506902" name="MailBug.zip" size="13047" author="skruger" created="Sun, 11 Dec 2011 15:46:37 +0000"/>
                            <attachment id="12506888" name="crashfix.eml" size="29996" author="skruger" created="Sun, 11 Dec 2011 09:19:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vndb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>182759</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>