diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 38956bc..8b15743 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,9 @@
 
   <body>
     <release version="1.4.0" date="2014-??-??">
+      <action dev="tn" type="fix" issue="EMAIL-151" date="2015-03-10" due-to="Andreas Kohn">
+        "ImageHtmlEmail" failed to embed attachments if their data source name was null.
+      </action>
       <action dev="tn" type="fix" issue="EMAIL-147" date="2014-12-26" due-to="Can Eskikaya">
         Html emails did not have the correct content-type set when using the Apache Geronimo
         JavaMail implementation v1.8.x.
diff --git a/src/main/java/org/apache/commons/mail/ImageHtmlEmail.java b/src/main/java/org/apache/commons/mail/ImageHtmlEmail.java
index 6c09544..863684e 100644
--- a/src/main/java/org/apache/commons/mail/ImageHtmlEmail.java
+++ b/src/main/java/org/apache/commons/mail/ImageHtmlEmail.java
@@ -172,7 +172,7 @@ public class ImageHtmlEmail extends HtmlEmail
 
                 if (cid == null)
                 {
-                    cid = embed(dataSource, dataSource.getName());
+                    cid = embed(dataSource, name);
                     cidCache.put(name, cid);
                 }
 
diff --git a/src/test/java/org/apache/commons/mail/ImageHtmlEmailTest.java b/src/test/java/org/apache/commons/mail/ImageHtmlEmailTest.java
index ddb3719..e8f85fc 100644
--- a/src/test/java/org/apache/commons/mail/ImageHtmlEmailTest.java
+++ b/src/test/java/org/apache/commons/mail/ImageHtmlEmailTest.java
@@ -29,7 +29,9 @@ import org.apache.commons.mail.util.MimeMessageUtils;
 import org.junit.Before;
 import org.junit.Test;
 
+import javax.activation.DataSource;
 import javax.mail.internet.MimeMessage;
+
 import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
@@ -240,6 +242,46 @@ public class ImageHtmlEmailTest extends HtmlEmailTest {
         assertTrue(mimeMessageParser.getAttachmentList().size() == 1);
     }
 
+    @Test
+    public void testSendClassPathFileWithNullName() throws Exception {
+        Logger.getLogger(ImageHtmlEmail.class.getName()).setLevel(Level.FINEST);
+
+        // Create the email message
+        getMailServer();
+
+        final String strSubject = "Test HTML Send default";
+
+        email = new MockImageHtmlEmailConcrete();
+        email.setDataSourceResolver(new MockDataSourceClassPathResolver("/", TEST_IS_LENIENT));
+        email.setHostName(strTestMailServer);
+        email.setSmtpPort(getMailServerPort());
+        email.setFrom(strTestMailFrom);
+        email.addTo(strTestMailTo);
+        email.setSubject(strSubject);
+
+        final String html = loadUrlContent(TEST2_HTML_URL);
+
+        // set the html message
+        email.setHtmlMsg(html);
+
+        // set the alternative message
+        email.setTextMsg("Your email client does not support HTML messages");
+
+        // send the email
+        email.send();
+
+        fakeMailServer.stop();
+
+        assertEquals(1, fakeMailServer.getMessages().size());
+        final MimeMessage mimeMessage = fakeMailServer.getMessages().get(0).getMimeMessage();
+        MimeMessageUtils.writeMimeMessage(mimeMessage,
+                new File("./target/test-emails/testSendClassPathFileWithNullName.eml"));
+
+        final MimeMessageParser mimeMessageParser = new MimeMessageParser(mimeMessage).parse();
+        assertTrue(mimeMessageParser.getHtmlContent().contains("\"cid:"));
+        assertTrue(mimeMessageParser.getAttachmentList().size() == 1);
+    }
+
     @Test
     public void testSendHTMLAutoResolveFile() throws Exception {
         Logger.getLogger(ImageHtmlEmail.class.getName()).setLevel(Level.FINEST);
@@ -448,4 +490,20 @@ public class ImageHtmlEmailTest extends HtmlEmailTest {
         }
         return html.toString();
     }
+    
+    private static final class MockDataSourceClassPathResolver extends DataSourceClassPathResolver {
+
+        public MockDataSourceClassPathResolver(final String classPathBase, final boolean lenient) {
+            super(classPathBase, lenient);
+        }
+
+        @Override
+        public DataSource resolve(String resourceLocation, boolean isLenient) throws IOException {
+            javax.mail.util.ByteArrayDataSource ds =
+                    (javax.mail.util.ByteArrayDataSource) super.resolve(resourceLocation, isLenient);
+            ds.setName(null);
+            return ds;
+        }
+        
+    }
 }
