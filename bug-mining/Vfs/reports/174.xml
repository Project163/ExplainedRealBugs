<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-291] ZIP archives are not properly closed after unzipping and cannot be deleted until the JVM exists</title>
                <link>https://issues.apache.org/jira/browse/VFS-291</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;Open a zip file with the ZipFileObject&lt;/p&gt;

&lt;p&gt;get an inputstream on its content&lt;/p&gt;

&lt;p&gt;try to delete it... &lt;/p&gt;

&lt;p&gt;it fails.&lt;/p&gt;

&lt;p&gt;I have attached a possible solution to this bug.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12443207">VFS-291</key>
            <summary>ZIP archives are not properly closed after unzipping and cannot be deleted until the JVM exists</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pfeffer">Roman</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Sun, 13 Dec 2009 18:58:37 +0000</created>
                <updated>Fri, 9 Nov 2018 13:16:44 +0000</updated>
                            <resolved>Thu, 20 Jul 2017 01:36:17 +0000</resolved>
                                                    <fixVersion>2.2</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="12789929" author="pfeffer" created="Sun, 13 Dec 2009 19:01:15 +0000"  >&lt;p&gt;I have added a possible solution for this Bug.&lt;/p&gt;

&lt;p&gt;Please take a look at the attached file and merge it with head revision.&lt;/p&gt;</comment>
                            <comment id="12927556" author="ralph.goers@dslextreme.com" created="Tue, 2 Nov 2010 19:22:36 +0000"  >&lt;p&gt;I tried applying this change but it breaks the unit test.&lt;/p&gt;</comment>
                            <comment id="13276472" author="garydgregory" created="Wed, 16 May 2012 05:17:57 +0000"  >&lt;p&gt;We need a unit test or example that exhibits the problem.&lt;/p&gt;</comment>
                            <comment id="13704098" author="belugabehr" created="Wed, 10 Jul 2013 01:40:09 +0000"  >&lt;p&gt;I too am having this problem.  Deal breaker for my current project.  I have attached a standard eclipse project that demonstrates the issue.&lt;/p&gt;

&lt;p&gt;This has failed on WinXP 32 bit and Win7 64 Bit&lt;/p&gt;

&lt;p&gt;Version: Juno Release&lt;br/&gt;
Build id: 20120614-1722&lt;/p&gt;</comment>
                            <comment id="13704197" author="garydgregory" created="Wed, 10 Jul 2013 04:28:54 +0000"  >&lt;p&gt;Here is a trunk patch that passes all current tests. I&apos;d like a code review as I am not sure if this is a hack or a proper solution.&lt;/p&gt;</comment>
                            <comment id="13707744" author="garydgregory" created="Sat, 13 Jul 2013 14:30:40 +0000"  >&lt;p&gt;Any feedback on my patch? &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12591596/vfs-291.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12591596/vfs-291.diff&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13708254" author="belugabehr" created="Mon, 15 Jul 2013 05:52:13 +0000"  >&lt;p&gt;It took me a while to figure out where the problem is coming from, sorry.  So, your way is not a bad way of doing it, though, let me suggest an alternative...&lt;/p&gt;

&lt;p&gt;In AbstractFileObject, match the constructor&apos;s &quot;fs.fileObjectHanded(this);&quot; by putting a &quot;fs.fileObjectDestroyed(this)&quot; in  &quot;abstract&apos;s doDetach().&quot;  This way, the count will be corrected.  Currently, it&apos;s appears to be wrong in many implementations.  In the overriding implementation of detach(), do a check of (if fs.isReleasable(), fs.close()).  Patches included.&lt;/p&gt;</comment>
                            <comment id="13708436" author="belugabehr" created="Mon, 15 Jul 2013 13:06:32 +0000"  >&lt;p&gt;Or you can even move this all into AbstractFileObject (patch included).  That way you can easily apply the change to all providers without overriding any implementations.&lt;/p&gt;</comment>
                            <comment id="13708709" author="garydgregory" created="Mon, 15 Jul 2013 17:54:17 +0000"  >&lt;p&gt;Thank you for working through this. I like that your proposal attempts to fix the problems for all providers but... applying the &quot;2&quot; patch causes problems.&lt;/p&gt;

&lt;p&gt;Please try building from the command line with &quot;mvn clean test&quot;, which gives me:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Results :

Tests in error:
  FileExtensionSelectorTest.setUpClass:55 &#9559; NullPointer
  FileExtensionSelectorTest.tearDownClass:76 &#9559; FileSystem Could not find files i...
  FileIteratorTest.setUpClass:47 &#9559; NullPointer
  FileIteratorTest.tearDownClass:72 &#9559; FileSystem Could not find files in &quot;ram://...
  FileTypeSelectorTest.setUpClass:42 &#9559; NullPointer
  FileTypeSelectorTest.tearDownClass:62 &#9559; FileSystem Could not find files in &quot;ra...
  PatternFileSelectorTest.setUpClass:56 &#9559; NullPointer
  PatternFileSelectorTest.tearDownClass:78 &#9559; FileSystem Could not find files in ...
  CustomRamProviderTest.testReadEmptyFileByteByByte:125-&amp;gt;createEmptyFile:74 &#9559; NullPointer
  CustomRamProviderTest.testReadEmptyFileIntoBufferWithOffsetAndLength:142-&amp;gt;createEmptyFile:74 &#9559; NullPointer
  CustomRamProviderTest.testReadEmptyFileIntoBuffer:132-&amp;gt;createEmptyFile:74 &#9559; NullPointer
  CustomRamProviderTest.testReadNonEmptyFileByteByByte:151-&amp;gt;createNonEmptyFile:81 &#9559; NullPointer
  CustomRamProviderTest.testReadNonEmptyFileIntoBufferWithOffsetAndLength:181-&amp;gt;createNonEmptyFile:81 &#9559; NullPointer
  CustomRamProviderTest.testSmallFS:235 &#9559; NullPointer
  CustomRamProviderTest.testReadNonEmptyFileIntoBuffer:162-&amp;gt;createNonEmptyFile:81 &#9559; NullPointer
  ProviderTestSuite&amp;gt;AbstractTestSuite.run:153-&amp;gt;AbstractTestSuite.setUp:183 &#9559; NullPointer

Tests run: 1757, Failures: 0, Errors: 16, Skipped: 2

[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO]
[INFO] Commons VFS ....................................... SUCCESS [13.749s]
[INFO] Commons VFS Core .................................. FAILURE [3:41.104s]
[INFO] Commons VFS Examples .............................. SKIPPED
[INFO] Commons VFS Distribution .......................... SKIPPED
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3:55.606s
[INFO] Finished at: Mon Jul 15 13:43:47 EDT 2013
[INFO] Final Memory: 18M/162M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You first patch, also from 15-July-2013 passes all tests.&lt;/p&gt;

&lt;p&gt;Let&apos;s see if someone else has an opinion on how to best fix this...&lt;/p&gt;

&lt;p&gt;Also, a unit test would help.&lt;/p&gt;</comment>
                            <comment id="13709411" author="belugabehr" created="Tue, 16 Jul 2013 03:09:34 +0000"  >&lt;p&gt;I think it&apos;s best to patch RAM FileSystem and get a consistent API.  I&apos;m not particularly familiar with the code, so it&apos;s slow going.  I&apos;m looking at it though.&lt;/p&gt;</comment>
                            <comment id="13709429" author="antonjs" created="Tue, 16 Jul 2013 03:45:09 +0000"  >&lt;p&gt;I&apos;m experiencing the same problem, in the context of doing a copyFrom() from a Zip to Local FileObject in order to extract a Zip file. I&apos;d be happy to help with further troubleshooting.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a patch containing a unit test which recreates the problem on my machine. Apologies if it doesn&apos;t quite fit in with the structure for provider tests. It&apos;s a little awkward since it needs to attempt to modify the underlying zip file to determine whether the resource is still held open somewhere. I&apos;d welcome any thoughts on how it could be cleaner.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Anton&lt;/p&gt;</comment>
                            <comment id="13713144" author="belugabehr" created="Fri, 19 Jul 2013 00:01:33 +0000"  >&lt;p&gt;Well, I gave it my best shot, but no luck.  The RAMFile code is a bit hairy... For some reason, the &quot;save&quot; method closes the file that is being saved and that causes the file to detach and then because of the new code, closes the entire file system.  Someone else should take a look at it.&lt;/p&gt;</comment>
                            <comment id="15024591" author="dlmarion" created="Tue, 24 Nov 2015 14:26:01 +0000"  >&lt;p&gt;Running into this problem as well. Can we take the most recent working patch as-is and note that an issue still exists for zip files in RAM?&lt;/p&gt;</comment>
                            <comment id="15029123" author="b.eckenfels" created="Thu, 26 Nov 2015 17:19:52 +0000"  >&lt;p&gt;Adding&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;getManager().closeFileSystem(fileOne.getFileSystem());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to the test makes it pass on Windows. (in current 2.1-SNAPSHOT trunk).&lt;/p&gt;</comment>
                            <comment id="16093990" author="garydgregory" created="Thu, 20 Jul 2017 00:08:47 +0000"  >&lt;p&gt;I added org.apache.commons.vfs2.provider.zip.test.FileLockTestCase with @Ignore.&lt;/p&gt;</comment>
                            <comment id="16094065" author="garydgregory" created="Thu, 20 Jul 2017 01:36:17 +0000"  >&lt;p&gt;Fixed in svn trunk. Please verify and close from svn trunk or &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit -m &quot;[VFS-291] ZIP archives are not properly closed after unzipping and cannot be deleted until the JVM exists.&quot; -N C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/zip/test/FileLockTestCase.java C:/vcs/svn/apache/commons/trunks-proper/vfs/src/changes/changes.xml C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/zip/ZipFileObject.java
    Sending        C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/zip/ZipFileObject.java
    Sending        C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/zip/test/FileLockTestCase.java
    Sending        C:/vcs/svn/apache/commons/trunks-proper/vfs/src/changes/changes.xml
    Transmitting file data ...
    Unknown action received: commit finalizing
    Committed revision 1802443.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16172253" author="garydgregory" created="Tue, 19 Sep 2017 19:57:56 +0000"  >&lt;p&gt;Add refinement:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit -m &quot;[VFS-291] ZIP archives are not properly closed after unzipping and cannot be deleted until the JVM exists. Do not close underlying ZipFile too aggressively; only do so if all open streams are not in use!&quot; -N C:/vcs/svn/apache/commons/trunks-proper/vfs/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/zip/ZipFileObject.java
    Sending        C:/vcs/svn/apache/commons/trunks-proper/vfs/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/zip/ZipFileObject.java
    Transmitting file data ...
    Unknown action received: commit finalizing
    Committed revision 1808941.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16681413" author="tomnelson" created="Fri, 9 Nov 2018 13:16:44 +0000"  >&lt;p&gt;I believe that the code introduced in&#160;13f79535-47bb-0310-9956-ffa450edef68 renders version 2.2 unusable in a multi-threaded environment, as the underlying cache file can be closed while other threads are attempting to read from it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/accumulo/pull/728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/accumulo/pull/728&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12342206">VFS-6</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12592323" name="AbstractFileObject.java.2.patch" size="913" author="belugabehr" created="Mon, 15 Jul 2013 13:06:41 +0000"/>
                            <attachment id="12592279" name="AbstractFileObject.java.patch" size="717" author="belugabehr" created="Mon, 15 Jul 2013 05:52:32 +0000"/>
                            <attachment id="12592483" name="FileLockUnitTest.diff" size="2712" author="antonjs" created="Tue, 16 Jul 2013 03:45:47 +0000"/>
                            <attachment id="12591580" name="ZipCloseBug.zip" size="1012040" author="belugabehr" created="Wed, 10 Jul 2013 02:07:58 +0000"/>
                            <attachment id="12427860" name="ZipFileObject.java" size="5001" author="pfeffer" created="Sun, 13 Dec 2009 19:01:15 +0000"/>
                            <attachment id="12592280" name="ZipFileObject.java.patch" size="687" author="belugabehr" created="Mon, 15 Jul 2013 05:52:32 +0000"/>
                            <attachment id="12591596" name="vfs-291.diff" size="674" author="ggregory" created="Wed, 10 Jul 2013 04:28:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>200335</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1g8nr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>