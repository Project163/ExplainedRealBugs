<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-410] [SFTP] SftpFileObject getInputStream(long) reads the whole file into memory</title>
                <link>https://issues.apache.org/jira/browse/VFS-410</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;The method &lt;tt&gt;getInputStream(long filePointer)&lt;/tt&gt; in &lt;tt&gt;SftpFileObject.java&lt;/tt&gt; reads the complete file into memory to create the input stream.&lt;br/&gt;
Newer versions of JSch provide a method &lt;br/&gt;
&lt;tt&gt;channel.get(file, monitor, filePointer);&lt;/tt&gt;&lt;br/&gt;
that is much faster.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12551677">VFS-410</key>
            <summary>[SFTP] SftpFileObject getInputStream(long) reads the whole file into memory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mstockhammer">Martin Stockhammer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Apr 2012 20:57:30 +0000</created>
                <updated>Thu, 19 May 2016 18:26:00 +0000</updated>
                            <resolved>Fri, 20 Apr 2012 12:18:14 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13257812" author="mstockhammer" created="Thu, 19 Apr 2012 21:01:52 +0000"  >&lt;p&gt;Here is a patch that uses the new method. I added a version check for JSch to be sure the method is allowed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Index: src/main/java/org/apache/commons/vfs2/provider/sftp/SftpFileObject.java
===================================================================
--- src/main/java/org/apache/commons/vfs2/provider/sftp/SftpFileObject.java	(revision 1327822)
+++ src/main/java/org/apache/commons/vfs2/provider/sftp/SftpFileObject.java	(working copy)
@@ -42,6 +42,7 @@
 
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.jcraft.jsch.ChannelSftp;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.jcraft.jsch.ChannelSftp.LsEntry;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.jcraft.jsch.JSch;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.jcraft.jsch.SftpATTRS;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.jcraft.jsch.SftpException;
 
@@ -53,7 +54,25 @@
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SftpFileObject &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractFileObject
 {
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; MOD_TIME_FACTOR = 1000L;
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; useInputStream = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
 
+    &lt;span class=&quot;code-comment&quot;&gt;// Checking &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; JSch version. Versions &amp;gt;= 0.1.46 use the InputStream from
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// the SftpChannel.
&lt;/span&gt;+    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
+        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] versions = JSch.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getDeclaredField(&lt;span class=&quot;code-quote&quot;&gt;&quot;VERSION&quot;&lt;/span&gt;)
+                    .get(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).toString().split(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\.&quot;&lt;/span&gt;);
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (versions.length == 3) {
+                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] vers = { &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(versions[0]),
+                        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(versions[1]),
+                        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(versions[2]) };
+                useInputStream = vers[0] &amp;gt; 0 || vers[1] &amp;gt; 1
+                        || (vers[1] == 1 &amp;amp;&amp;amp; vers[2] &amp;gt;= 46);
+            }
+        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
+            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Retrieval of JSch version failed&quot;&lt;/span&gt;);
+        }
+    }
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SftpFileSystem fileSystem;
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; SftpATTRS attrs;
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; relPath;
@@ -447,32 +466,39 @@
 
     /**
      * Creates an input stream to read the file content from.
+     * The input stream is starting at the given position in the file.
      */
     InputStream getInputStream(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; filePointer) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
     {
         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ChannelSftp channel = fileSystem.getChannel();
-        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
-        {
-            &lt;span class=&quot;code-comment&quot;&gt;// hmmm - using the in memory method is soooo much faster ...
&lt;/span&gt;-            &lt;span class=&quot;code-comment&quot;&gt;// TODO - Don&apos;t read the entire file into memory. Use the
&lt;/span&gt;-            &lt;span class=&quot;code-comment&quot;&gt;// stream-based methods on ChannelSftp once they work properly &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt;
&lt;/span&gt;-            &lt;span class=&quot;code-comment&quot;&gt;// .... no stream based method with resume???
&lt;/span&gt;-            ByteArrayOutputStream outstr = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
-            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
-            {
-                channel.get(getName().getPathDecoded(), outstr, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
-                        ChannelSftp.RESUME, filePointer);
-            }
-            &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SftpException e)
-            {
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (useInputStream) {
+            &lt;span class=&quot;code-comment&quot;&gt;// Using InputStream directly from the channel.
&lt;/span&gt;+            &lt;span class=&quot;code-comment&quot;&gt;// Its much faster than the memory method.
&lt;/span&gt;+            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+                InputStream is = channel.get(getName().getPathDecoded(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
+                        filePointer);
+                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SftpInputStream(channel, is);
+            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SftpException e) {
+                fileSystem.putChannel(channel);
                 &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileSystemException(e);
+            } 
+
+        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
+            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+                &lt;span class=&quot;code-comment&quot;&gt;// Reading completely into the memory.
&lt;/span&gt;+                ByteArrayOutputStream outstr = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
+                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+                    channel.get(getName().getPathDecoded(), outstr, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
+                            ChannelSftp.RESUME, filePointer);
+                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SftpException e) {
+                    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileSystemException(e);
+                }
+                outstr.close();
+                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(outstr.toByteArray());
+
+            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
+                fileSystem.putChannel(channel);
             }
-            outstr.close();
-            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(outstr.toByteArray());
-        }
-        &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt;
-        {
-            fileSystem.putChannel(channel);
         }
     }
 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13257970" author="garydgregory" created="Fri, 20 Apr 2012 01:47:20 +0000"  >&lt;p&gt;Hi Martin,&lt;/p&gt;

&lt;p&gt;In order to use a patch, it must be attached to this issue as a patch file and granted the Apache license.&lt;/p&gt;

&lt;p&gt;I would not bother with the version check, the POM already specifies 0.1.46 and I am testing a build with 0.1.47 as we speak...&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="13258053" author="mstockhammer" created="Fri, 20 Apr 2012 06:50:57 +0000"  >&lt;p&gt;Ok, I removed the version check and attached the patch  as file with license grant. I hope it has the correct format. &lt;/p&gt;</comment>
                            <comment id="13258176" author="garydgregory" created="Fri, 20 Apr 2012 12:18:14 +0000"  >&lt;p&gt;Martin,&lt;/p&gt;

&lt;p&gt;Thank you for providing the patch. &lt;br/&gt;
It has been applied with only slight changes. &lt;br/&gt;
Committed revision 1328346.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15291789" author="b.eckenfels" created="Thu, 19 May 2016 18:26:00 +0000"  >&lt;p&gt;Apache Commons VFS 2.1 has been released. It includes this (total 171) resolved issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12523459" name="SftpFileObject.java.patch" size="2160" author="mstockhammer" created="Fri, 20 Apr 2012 06:50:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236485</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05k53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30360</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>