<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:15:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-807] LocalFile migration to NIO is not done correctly</title>
                <link>https://issues.apache.org/jira/browse/VFS-807</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;According to release notes (&lt;a href=&quot;https://archive.apache.org/dist/commons/vfs/RELEASE-NOTES.txt),&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://archive.apache.org/dist/commons/vfs/RELEASE-NOTES.txt),&lt;/a&gt; version 2.9.0 includes the following change:&lt;/p&gt;

&lt;p&gt;Replace construction of FileInputStream and FileOutputStream objects with Files NIO APIs. #164. Thanks to Arturo Bernal.&lt;/p&gt;

&lt;p&gt;Strangely, it was not completed: LocalFlie.java has the following now, even in master:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Creates an input stream to read the content from.
 */
 @Override
 &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; InputStream doGetInputStream(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; bufferSize) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(file);
 }&#160;


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But what is worse, doGetOutputStream is &lt;b&gt;completely&lt;/b&gt; broken:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Creates an output stream to write the file content to.
     */
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; OutputStream doGetOutputStream(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; bAppend) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Files.newOutputStream(file.toPath(), bAppend ? StandardOpenOption.APPEND : StandardOpenOption.CREATE);
    }&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This can be demonstrated with a small java program, see attachment. The program just tries to write to a local file (into the same directory), using different ways to do it:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Java IO, how it was done before VFS 2.9.0&lt;/li&gt;
	&lt;li&gt;Java NIO the way VFS 2.9.0 does it&lt;/li&gt;
	&lt;li&gt;Java NIO the way it must be done&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;What is important, the program also verifies the result.&lt;/p&gt;

&lt;p&gt;VFS 2.9.0 fails in 2 cases: &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;When the file does not exist and append must be performed:&#160; java.nio.file.NoSuchFileException is thrown in this case.&lt;/li&gt;
	&lt;li&gt;When the file exists and no append must be performed: the file is not truncated, so whatever is written overwrites the beginning of the file, keeping the rest.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13392714">VFS-807</key>
            <summary>LocalFile migration to NIO is not done correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="klv_m72">L</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Jul 2021 09:48:56 +0000</created>
                <updated>Tue, 31 May 2022 14:51:23 +0000</updated>
                            <resolved>Fri, 26 Nov 2021 12:35:08 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.10.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17390484" author="garydgregory" created="Fri, 30 Jul 2021 10:34:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klv_m72&quot; class=&quot;user-hover&quot; rel=&quot;klv_m72&quot;&gt;klv_m72&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&#160;&lt;/p&gt;

&lt;p&gt;Feel free to provide a PR on GitHub.&lt;/p&gt;</comment>
                            <comment id="17390642" author="garydgregory" created="Fri, 30 Jul 2021 15:30:58 +0000"  >&lt;p&gt;The problem is also like &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-744&quot; title=&quot;FileWriterWithEncoding for an existing file no longer truncates the file.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-744&quot;&gt;&lt;del&gt;IO-744&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17390771" author="garydgregory" created="Fri, 30 Jul 2021 20:06:27 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klv_m72&quot; class=&quot;user-hover&quot; rel=&quot;klv_m72&quot;&gt;klv_m72&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please try git master. I did not try your Java app as it is not runnable as a unit test. If you want to provide something we can use, feel free to provide a PR on GitHub for a unit test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17391431" author="klv_m72" created="Mon, 2 Aug 2021 08:27:55 +0000"  >&lt;p&gt;Reopening: the fix is not complete.&lt;/p&gt;

&lt;p&gt;It fixes only part of the problem: overwriting the existing file.&lt;/p&gt;

&lt;p&gt;The second part: appending to a non-existing file still fails&lt;/p&gt;</comment>
                            <comment id="17391433" author="klv_m72" created="Mon, 2 Aug 2021 08:31:33 +0000"  >&lt;p&gt;I have added some tests verifying the bug.&#160; I did not succeed creating a PR.&lt;/p&gt;

&lt;p&gt;The attached file (vfs-807.diff) contains the test changes and the correct fix for this issue.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;ProviderWriteTests.testOverwriteContent() fails with 2.9.0 and works in the latest master.&lt;/li&gt;
	&lt;li&gt;ProviderWriteAppendTests.testAppendToNonExsiting() fails with 2.9.0 and in the latest master.&lt;/li&gt;
	&lt;li&gt;They both succeed with the changes to LocalFile done in the patch.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17393448" author="garydgregory" created="Wed, 4 Aug 2021 21:19:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klv_m72&quot; class=&quot;user-hover&quot; rel=&quot;klv_m72&quot;&gt;klv_m72&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please don&apos;t delete comments (&quot;// TODO Reuse Apache Commons IO&quot;) in your patch because that&apos;s where the implementation will be coming from as soon as Apache Commons IO is released, you can see git master for Commons IO which I just updated. My plan is to release Commons IO and then to reuse its PathUtils.newOutputStream() method from here.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17393510" author="garydgregory" created="Thu, 5 Aug 2021 00:08:00 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klv_m72&quot; class=&quot;user-hover&quot; rel=&quot;klv_m72&quot;&gt;klv_m72&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please provide your diff as a PR on GitHub such that the GitHub Actions builds kick in for all of the OSs and JDKs we check.&lt;/p&gt;</comment>
                            <comment id="17394206" author="garydgregory" created="Thu, 5 Aug 2021 17:03:33 +0000"  >&lt;p&gt;i &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klv_m72&quot; class=&quot;user-hover&quot; rel=&quot;klv_m72&quot;&gt;klv_m72&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I pushed your tests and the same fix as Commons IO BUT for me, on Windows 10 and Java 8, the tests pass without the change to &lt;tt&gt;LocalFile&lt;/tt&gt; but you seem to report otherwise so this might be OS and Java version dependent.&lt;/p&gt;</comment>
                            <comment id="17394536" author="klv_m72" created="Fri, 6 Aug 2021 05:55:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;: thanks for pushing the tests.&lt;/p&gt;

&lt;p&gt;As for &quot;the tests pass without the change to &lt;tt&gt;LocalFile&lt;/tt&gt; &quot;: of course they pass now since you &lt;b&gt;have changed&lt;/b&gt; LocalFile (the same fix as Commons IO) finally fixing the problem. My comment with diff file was posted several days ago when LocalFile in master was still buggy.&lt;/p&gt;</comment>
                            <comment id="17394675" author="garydgregory" created="Fri, 6 Aug 2021 10:13:06 +0000"  >&lt;p&gt;That was a typo on my end, sorry, the tests passed without the change to main. What OS/JRE are you on?&lt;/p&gt;</comment>
                            <comment id="17394676" author="garydgregory" created="Fri, 6 Aug 2021 10:13:56 +0000"  >&lt;p&gt;Also note that the change to use Files NIO to create the input stream is not in.&lt;/p&gt;</comment>
                            <comment id="17394698" author="klv_m72" created="Fri, 6 Aug 2021 10:50:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I am using Windows 10 and jdk 8 as well.&lt;/p&gt;

&lt;p&gt;The thing is: you did not correctly pushed my test changes, namely, ProviderWriteAppendTests.java:&lt;/p&gt;

&lt;p&gt;Mine code:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (OutputStream os = file.getContent().getOutputStream(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)) {
&#160;&#160;&#160; os.write(content1.getBytes(StandardCharsets.UTF_8));
}&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Code in master:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (FileContent fileContent = file.getContent(); OutputStream os = fileContent.getOutputStream()) {
&#160;&#160;&#160; os.write(content1.getBytes(StandardCharsets.UTF_8));
}&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Your code does not perform &quot;append&quot;. It must be fileContent.getOutputStream(&lt;b&gt;true&lt;/b&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17394809" author="garydgregory" created="Fri, 6 Aug 2021 14:47:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klv_m72&quot; class=&quot;user-hover&quot; rel=&quot;klv_m72&quot;&gt;klv_m72&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My mistake. Fixed in git master.&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;</comment>
                            <comment id="17449284" author="garydgregory" created="Thu, 25 Nov 2021 18:38:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klv_m72&quot; class=&quot;user-hover&quot; rel=&quot;klv_m72&quot;&gt;klv_m72&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Can this ticket be closed?&lt;/p&gt;</comment>
                            <comment id="17449396" author="klv_m72" created="Fri, 26 Nov 2021 06:45:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; : yes, it can be closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13447671">VFS-820</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13399781">HOP-3255</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13031259" name="TestJdkWriteFile.java" size="4810" author="klv_m72" created="Fri, 30 Jul 2021 09:43:43 +0000"/>
                            <attachment id="13031371" name="vfs-807.diff" size="3929" author="klv_m72" created="Mon, 2 Aug 2021 08:31:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0th1s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>