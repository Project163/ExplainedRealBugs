<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:13:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-114] FtpFileObject lists children excessively using ON_RESOLVE cache strategy</title>
                <link>https://issues.apache.org/jira/browse/VFS-114</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;When calling FileObject.getChildren() on a org.apache.commons.vfs.provider.ftp.FtpFileObject using the default ON_RESOLVE cache strategy, I would FtpClientWrapper.listFiles() to be called only once. Instead, because FileObject.refresh() is called once for itself and each of its parents for each of the children. For example, if there&apos;s a file structure like:&lt;/p&gt;

&lt;p&gt;&amp;lt;pre&amp;gt;&lt;br/&gt;
    &lt;a href=&quot;ftp://ftp.example.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://ftp.example.com&lt;/a&gt;&lt;br/&gt;
       A/&lt;br/&gt;
          B/ &lt;br/&gt;
             C/&lt;br/&gt;
                1&lt;br/&gt;
                2&lt;br/&gt;
                3&lt;br/&gt;
&amp;lt;/pre&amp;gt;&lt;/p&gt;

&lt;p&gt;and you list files for the URL &quot;ftp://ftp.example.com/A/B/C/&quot;. Instead of calling listFiles() once on &quot;C&quot;, it calls listFiles() on each of &quot;A&quot;, &quot;B&quot;, and &quot;C&quot; for each of the children &quot;1&quot;, &quot;2&quot; and &quot;3&quot;, i.e. 9 times. I discovered this when listing a directory with 709 files--you can imagine my bewilderment at how long it took.&lt;/p&gt;

&lt;p&gt;I fixed this by reusing the FtpFileObject.inRefresh flag within AbstractFileObject.getChildren() to not refresh the listed directory when its children request a refresh. I&apos;ve used this inRefresh incorrectly, I think. I should rather use a separate flag depth counter like FtpFileObject.refreshDepth, incremented upon entry into AbstractFileObject.getChildren() and decremented upon exit. This approach would fix the implementation for providers other than FTP as well. Anyways, here&apos;s my patch:&lt;/p&gt;

&lt;p&gt;Index: core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java   (revision 513805)&lt;br/&gt;
+++ core/src/main/java/org/apache/commons/vfs/provider/ftp/FtpFileObject.java   (working copy)&lt;br/&gt;
@@ -94,7 +94,12 @@&lt;br/&gt;
      */&lt;br/&gt;
     private FTPFile getChildFile(final String name, final boolean flush) throws IOException&lt;br/&gt;
     {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (flush)&lt;br/&gt;
+        /* If we should flush cached children, clear our children map unless&lt;br/&gt;
+         * we&apos;re in the middle of a refresh in which case we&apos;ve just recently&lt;br/&gt;
+         * refreshed our children. No need to do it again when our children are&lt;br/&gt;
+         * refresh()ed, calling getChildFile() for themselves from within&lt;br/&gt;
+         * getInfo(). See getChildren(). */&lt;br/&gt;
+        if (flush &amp;amp;&amp;amp; !inRefresh)
         {
                        children = null;
         }
&lt;p&gt;@@ -322,6 +327,28 @@&lt;br/&gt;
         return null;&lt;br/&gt;
     }&lt;br/&gt;
+   &lt;br/&gt;
+    /** Returns the file&apos;s list of children.&lt;br/&gt;
+     *&lt;br/&gt;
+     *  @return The list of children&lt;br/&gt;
+     *  @throws FileSystemException If there was a problem listing children&lt;br/&gt;
+     *  @see    AbstratFileObject#getChildren()&lt;br/&gt;
+     *  @since  1.0&lt;br/&gt;
+     */&lt;br/&gt;
+    public FileObject[] getChildren() throws FileSystemException &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+        try {
+            /* Wrap our parent implementation, noting that we&apos;re refreshing so
+             * that we don&apos;t refresh() ourselves and each of our parents for
+             * each children. Note that refresh() will list children. Meaning,
+             * if if this file has C children, P parents, there will be (C * P)
+             * listings made with (C * (P + 1)) refreshes, when there should
+             * really only be 1 listing and C refreshes. */
+            this.inRefresh = true;
+            return super.getChildren();
+        } finally {
+            this.inRefresh = false;
+        }+    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;     /**&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;Lists the children of the file.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Mac OS X 10.4.8, Darwin 8.8.0; Java 1.5.0_06; &lt;br/&gt;
Libraries: ant-1.6.2.jar, commons-net-1.4.1.jar, commons-logging-1.0.4.jar, commons-collections-3.1.jar, jcifs-0.8.3.jar, jakarta-slide-webdavlib-20050629.161100.jar, jdom-1.0.jar, commons-httpclient-2.0.2.jar, jsch-0.1.23.jar, xml-apis-1.0.b2.jar, oro-2.0.8.jar, maven-xdoc-plugin-1.9.2.jar, &lt;/p&gt;</environment>
        <key id="12364173">VFS-114</key>
            <summary>FtpFileObject lists children excessively using ON_RESOLVE cache strategy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kloshih">K. Lo Shih</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Mar 2007 22:09:10 +0000</created>
                <updated>Wed, 27 Jul 2016 21:04:29 +0000</updated>
                            <resolved>Mon, 19 Mar 2007 20:54:45 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12478180" author="kloshih" created="Mon, 5 Mar 2007 22:11:32 +0000"  >&lt;p&gt;I guess I need to separate patch file.&lt;/p&gt;</comment>
                            <comment id="12478182" author="kloshih" created="Mon, 5 Mar 2007 22:15:48 +0000"  >&lt;p&gt;This may be the same problem, but its difficult to tell from the issue description.&lt;/p&gt;</comment>
                            <comment id="12482216" author="imario" created="Mon, 19 Mar 2007 20:54:45 +0000"  >&lt;p&gt;Good catch.&lt;br/&gt;
Applied.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Ciao,&lt;br/&gt;
Mario&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12353831">VFS-96</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12352661" name="VFS-114.patch" size="1997" author="kloshih" created="Mon, 5 Mar 2007 22:11:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>200173</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i13bpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>