<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-637] Zip files with legacy encoding and special characters let VFS crash</title>
                <link>https://issues.apache.org/jira/browse/VFS-637</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;Oracle has reworked the ZipFile object with Java 7. Since then the default constructor used by commons-vfs2 2.1 is more restrictive than with Java 6. The ZipFile constructor has got a second parameter (Charset) now for specification of the legacy charset to be used explicitly if the ZipFile doesn&apos;t state its UTF-8 compliance internally. This affects all ZIP files using a legacy charset for filename encoding but not using UTF-8 is it is common today. This could be a ZIP file with files containing german umlauts or russian characters in archived file&apos;s filenames, for example.&lt;/p&gt;

&lt;p&gt;To support this new parameter with (more or less) default values, the class org.apache.commons.vfs2.provider.zip.ZipFileSystem has to be extended by a default charset parameter, getter or setter (as you like) to forward this setting to the java.util.zip.ZipFile constructor.&lt;/p&gt;

&lt;p&gt;Quick workaround for me was to create a new OwnZipFileProvider referring to the even new OwnZipFileSystem (extending ZipFileSystem) with the following modified function. Change has been highlighted:&lt;/p&gt;

&lt;p&gt;{{	protected ZipFile createZipFile(final File file) throws FileSystemException {&lt;br/&gt;
		try {&lt;br/&gt;
			return new ZipFile(file&lt;font color=&quot;red&quot;&gt;&lt;b&gt;, Charset.forName(&quot;IBM437&quot;)&lt;/b&gt;&lt;/font&gt;);&lt;br/&gt;
		} catch (final IOException ioe) &lt;/p&gt;
{
			throw new FileSystemException(&quot;vfs.provider.zip/open-zip-file.error&quot;, file, ioe);
		}
&lt;p&gt;	}&lt;br/&gt;
}}&lt;/p&gt;

&lt;p&gt;Presetting to charset 437 as legacy default charset seems to be a a good workaround as stated in appendix D here: &lt;a href=&quot;https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;&quot;D.1 The ZIP format has historically supported only the original IBM PC character encoding set, commonly referred to as IBM Code Page 437.  This limits storing file name characters to only those within the original MS-DOS range of values and does not properly support file names in other character encodings, or  languages. &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&quot;&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Windows 10 64 Bit, Java 8&lt;/p&gt;</environment>
        <key id="13081433">VFS-637</key>
            <summary>Zip files with legacy encoding and special characters let VFS crash</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gschnepp">Guido Schnepp</reporter>
                        <labels>
                            <label>easyfix</label>
                    </labels>
                <created>Wed, 21 Jun 2017 14:04:35 +0000</created>
                <updated>Fri, 25 Jan 2019 16:11:09 +0000</updated>
                            <resolved>Fri, 25 Jan 2019 16:11:09 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="16057955" author="b.eckenfels" created="Wed, 21 Jun 2017 18:13:41 +0000"  >&lt;p&gt;What do you think about StandardCharSet.ASCII or LATIN1 as default or would you use absent (which throws for non UTF8 marked archives?)&lt;/p&gt;</comment>
                            <comment id="16058831" author="gschnepp" created="Thu, 22 Jun 2017 06:29:31 +0000"  >&lt;p&gt;Not much, because both encodings differ from IBM437 in bigger parts: &lt;/p&gt;

&lt;p&gt;java.nio.charset.StandardCharsets.US-ASCII is a 7 bit charset only, so all characters 0x80 and above are missing. That&apos;s the most interesting part of codepage 437 for non-US people, where you also find the german umlauts for example.&lt;/p&gt;

&lt;p&gt;ASCII (any) and ANSI (most) are 8 bit charsets which base on US-ASCII but have codepoints 0x80-0xFF defined - differently! On a sample with german umlaut &#196; (Latin capital letter A with diaeresis) and &#228; (Latin small letter a with diaeresis):&lt;br/&gt;
IBM437:        &#196; on 0x8E, &#228; on 0x84 ( &lt;a href=&quot;https://de.wikipedia.org/wiki/Codepage_437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://de.wikipedia.org/wiki/Codepage_437&lt;/a&gt; )&lt;br/&gt;
ISO-8859-1: &#196; on 0xC4, &#228; on 0xE4 ( &lt;a href=&quot;https://de.wikipedia.org/wiki/ISO_8859-1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://de.wikipedia.org/wiki/ISO_8859-1&lt;/a&gt; )&lt;br/&gt;
UNICODE:    &#196; on U+00C4, &#228; on U+00E4 ( &lt;a href=&quot;https://de.wikipedia.org/wiki/Umlaut&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://de.wikipedia.org/wiki/Umlaut&lt;/a&gt; )&lt;br/&gt;
US-ASCII:     &#196; non existent, &#228; non existent&lt;/p&gt;

&lt;p&gt;PKWare is only a vendor of ZIP aware products, but with pkzip one of the first, far before zip support has been added to operating systems or Java runtime natively. I by myself trust their expertise here. BUT: I&apos;ve also read on other pages, that on development of the ZIP format, encoding was &lt;ins&gt;not defined&lt;/ins&gt; (or not in mind) in any way. The language encoding bit has been added later. So some functionality is required long-term to set the desired encoding as user like, because you can also find ZIP files with native russian characters inside potentially - which are even not supported by IBM437.&lt;/p&gt;

&lt;p&gt;Another interesting source is the new Oracle Java Zip package javadoc: &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/util/zip/package-summary.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/api/java/util/zip/package-summary.html&lt;/a&gt; . The, in turn, refer to PKWare Appendix D already mentioned on Ticket above.&lt;/p&gt;</comment>
                            <comment id="16064341" author="gschnepp" created="Tue, 27 Jun 2017 06:19:39 +0000"  >&lt;p&gt;A small update: I have another ZIP file here compressed in a method java.util.zip isn&apos;t aware of. Search for error message &quot;java.util.zip.ZipException: invalid CEN header (bad signature)&quot;. Despite the message this file is fully correct, but stored with an unsupported method (by j.u.zip) only. Any bug report reagarding this is closed immediately with the not so helpful answer, java.util.zip only supports compression methods DEFLATE und STORE, it seems. No other comments. There are a lot more compression methods defined unfortunately, Wikipedia says.&lt;/p&gt;

&lt;p&gt;I will have a look for the option to switch to commons-compress even for my alternate OwnZipFileSystem.&lt;/p&gt;</comment>
                            <comment id="16077704" author="garydgregory" created="Fri, 7 Jul 2017 06:50:34 +0000"  >&lt;p&gt;Removing the &apos;Fix Version&apos; since there is no change applied to the code.&lt;/p&gt;</comment>
                            <comment id="16752392" author="garydgregory" created="Fri, 25 Jan 2019 16:11:09 +0000"  >&lt;p&gt;Changes in svn trunk now allows you to do this the VFS way with a new build class called &lt;tt&gt;ZipFileSystemConfigBuilder&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ZipFileSystemConfigBuilder builder = ZipFileSystemConfigBuilder.getInstance();
        &lt;span class=&quot;code-comment&quot;&gt;// Tests the same charset as the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; but we exercise having a Charset set.
&lt;/span&gt;        builder.setCharset(opts, StandardCharsets.UTF_8);
        FileObject resolvedFile = manager.resolveFile(uri, opts);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gjr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>