<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-523] HdfsFileObject equals method returns true for the same path on different hosts</title>
                <link>https://issues.apache.org/jira/browse/VFS-523</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;If I construct two HdfsFileObject referring to the same path (for instance, &quot;/&quot;) but on different hosts, the &quot;equals&quot; method will consider them equal (and the &quot;hashCode&quot; method will give the same results for both) even though they clearly refer to different files since they are on different hosts.&lt;/p&gt;

&lt;p&gt;These two methods should also factor in the HdfsFileSystem to the equation.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7&lt;/p&gt;</environment>
        <key id="12712452">VFS-523</key>
            <summary>HdfsFileObject equals method returns true for the same path on different hosts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="b.eckenfels">Bernd Eckenfels</assignee>
                                    <reporter username="rwhitcomb">Roger Lee Whitcomb</reporter>
                        <labels>
                            <label>hdfs</label>
                    </labels>
                <created>Mon, 5 May 2014 23:13:26 +0000</created>
                <updated>Thu, 19 May 2016 18:26:13 +0000</updated>
                            <resolved>Sun, 30 Nov 2014 09:22:56 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13990090" author="rwhitcomb" created="Mon, 5 May 2014 23:34:33 +0000"  >&lt;p&gt;The &quot;hdfsequal&quot; diff/patch file fixes the problem for me.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13997730" author="rwhitcomb" created="Wed, 14 May 2014 16:34:16 +0000"  >&lt;p&gt;Anyone able/willing to commit this patch? We are using it successfully (built local copy from head revs from SVN)....&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13998837" author="garydgregory" created="Thu, 15 May 2014 15:21:59 +0000"  >&lt;p&gt;Could you please provide a unit test with your patch?&lt;/p&gt;</comment>
                            <comment id="14000273" author="b.eckenfels" created="Fri, 16 May 2014 20:37:36 +0000"  >&lt;p&gt;BTW: there is also a test which tests if equal works for the positive case. I guess the negative case would be a bit more complicated if you actually want to test a second hdfs instance.&lt;/p&gt;

&lt;p&gt;Anyway, this change here make the test a bit more complete:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testEquals() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
    {
        &lt;span class=&quot;code-comment&quot;&gt;// Create test file (and check parent was created)
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject dir = manager.resolveFile(TEST_DIR1);
        Assert.assertNotNull(dir);
        Assert.assertFalse(dir.exists());
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject file1 = createTestFile(hdfs);
        Assert.assertTrue(file1.exists());
        Assert.assertTrue(dir.exists());

        &lt;span class=&quot;code-comment&quot;&gt;// Get a handle to the same file and ensure it is equal
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject file2 = manager.resolveFile(TEST_FILE1);
        Assert.assertEquals(file1, file2);

        &lt;span class=&quot;code-comment&quot;&gt;// Ensure different files on same filesystem are not equal
&lt;/span&gt;        Assert.assertNotEquals(dir, file1);
        Assert.assertNotEquals(dir, file2);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14000470" author="b.eckenfels" created="Fri, 16 May 2014 23:09:47 +0000"  >&lt;p&gt;the `equals` uses `path.equals()` but the `hashcode()` uses `path.getName().toString().hashCode()` (even before the patch). Do we want to unify this as well?&lt;/p&gt;

&lt;p&gt;BTW: I would merge the patch, I have verified that I can actually test Hdfs (and I can on Windows, see &lt;a href=&quot;https://issues.apache.org/jira/browse/VFS-526&quot; title=&quot;No Hdfs testing on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;VFS-526&quot;&gt;&lt;del&gt;VFS-526&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14000582" author="b.eckenfels" created="Sat, 17 May 2014 01:04:10 +0000"  >&lt;p&gt;I just checked the other FileObject implementations, none of them overwrites the basic equals/hashcode implementation. I wonder if a (better/other) solution would be to remove the implementations?&lt;/p&gt;

&lt;p&gt;Using same object compare and system hashcode would work in most situations where the caching is used (only NullFilesCache warn about producing multiple instances for the same resolve path).&lt;/p&gt;

&lt;p&gt;If we think this is not enough, then maybe it would be better to add hashcode+equals to the AbstractFileObject where it would compare the fileName and the filesystem (instance). The filesystem instance is used in AbstractFileObject#canRenameTo() so this is a common limitation.&lt;/p&gt;</comment>
                            <comment id="14000858" author="b.eckenfels" created="Sat, 17 May 2014 20:07:42 +0000"  >&lt;p&gt;I propose to commit the removal of equals/hashcode for this implementation. We can open another bug to think about adding a better abstract implementation. However the better defined semantic is (do)isSameFile which is also strangely implenmted for Hdfs. Do you think your usecase actually needs a &quot;is equal&quot; assertion (or does it only care about &quot;not equal&quot; as reported).&lt;/p&gt;</comment>
                            <comment id="14000860" author="b.eckenfels" created="Sat, 17 May 2014 20:14:18 +0000"  >&lt;p&gt;Could you try this patch against the Trunk, Roger?&lt;/p&gt;</comment>
                            <comment id="14001000" author="rwhitcomb" created="Sun, 18 May 2014 05:16:52 +0000"  >&lt;p&gt;Hi Bernd,  &lt;br/&gt;
The code I&apos;m using is in the Apache Pivot project in the VFSFileBrowser and related classes.  The failure I noticed, specifically, was that two HdfsFileObjects had the same path on different file systems, and they had the &quot;equals&quot; method return true.  I believe the code is consistently calling &quot;equals&quot; for these types of comparisons, but I don&apos;t know if all the tests are !equals or just equals.  I am a little reluctant to say that using just Object.equals would be fine, because (for instance) I would expect that an existing object pointing to a certain directory on a given filesystem should be &quot;equal&quot; to a newly created object pointing to that same directory on the same filesystem, which Object.equals would not return true for (so, I expect this to work similarly to String.equals where the method returns true if the content is the same, not merely when the objects are exactly the same object).&lt;/p&gt;

&lt;p&gt;So, I will test your latest patch as soon as I return to the office on Tuesday (unfortunately I am not in a position to try it until then).&lt;/p&gt;

&lt;p&gt;Thank you for the investigation on this.&lt;br/&gt;
~Roger&lt;/p&gt;</comment>
                            <comment id="14001003" author="rwhitcomb" created="Sun, 18 May 2014 05:26:25 +0000"  >&lt;p&gt;@Gary, I will certainly work on a unit test for this problem, although I expect to have some difficulty, as Bernd noted, because my actual fail case was using two different HDFS file systems, which I don&apos;t see the current tests being setup for.&lt;/p&gt;</comment>
                            <comment id="14229051" author="b.eckenfels" created="Sun, 30 Nov 2014 09:22:56 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1642530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1642530&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I applied the unify-hdfs-quals.patch, the equals unit test was already commited.&lt;/p&gt;</comment>
                            <comment id="14250289" author="rwhitcomb" created="Wed, 17 Dec 2014 18:42:09 +0000"  >&lt;p&gt;I&apos;ve just now (sorry for the LONG delay) tested head revs (with the &quot;unify-hdfs-equals.patch&quot;) in our application and everything seems to be working as expected.  I guess I&apos;m still a little skeptical that this approach is solid, though, since (I think) we&apos;re relying on the caching mechanism in order to always get the same object so the default Object.equals works right.  Although, for the moment I don&apos;t see any problems in actual operation.  &lt;/p&gt;</comment>
                            <comment id="14250899" author="b.eckenfels" created="Thu, 18 Dec 2014 00:41:57 +0000"  >&lt;p&gt;Thanks Roger. I agree that we should have a closer look at the instance semantics of FileObjects - for all filesystems. I opened an Task for that.&lt;/p&gt;</comment>
                            <comment id="15291822" author="b.eckenfels" created="Thu, 19 May 2016 18:26:13 +0000"  >&lt;p&gt;Apache Commons VFS 2.1 has been released. It includes this (total 171) resolved issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12762445">VFS-550</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12714866">VFS-526</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12643452" name="hdfsequal.diff" size="1016" author="rwhitcomb" created="Mon, 5 May 2014 23:34:33 +0000"/>
                            <attachment id="12645422" name="unify-hdfs-equals.patch" size="2131" author="b.eckenfels" created="Sat, 17 May 2014 20:14:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390768</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vb1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>391008</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>