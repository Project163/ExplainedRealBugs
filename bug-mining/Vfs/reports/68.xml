<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-293] FtpFileSystem causes deadlock</title>
                <link>https://issues.apache.org/jira/browse/VFS-293</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;I use Commons VFS to access FTP from multiple threads. In each thread I create directories and copy files on the FTP server.&lt;br/&gt;
Nearly everytime when i run the program  a deadlock occurs which causes all threads to hang. I&apos;ve created a stacktrace with &quot;jstack&quot; which clearly shows where the deadlock is happening.&lt;/p&gt;

&lt;p&gt;Stacktrace:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Found one Java-level deadlock:
=============================
&quot;pool-1-thread-5&quot;:
  waiting to lock monitor 0x030813b4 (object 0x22f972e8, a org.apache.commons.vfs.provider.ftp.FtpFileSystem),
  which is held by &quot;pool-1-thread-2&quot;
&quot;pool-1-thread-2&quot;:
  waiting to lock monitor 0x03082c7c (object 0x22f999e0, a java.lang.Object),
  which is held by &quot;pool-1-thread-4&quot;
&quot;pool-1-thread-4&quot;:
  waiting to lock monitor 0x030813b4 (object 0x22f972e8, a org.apache.commons.vfs.provider.ftp.FtpFileSystem),
  which is held by &quot;pool-1-thread-2&quot;

Java stack information for the threads listed above:
===================================================
&quot;pool-1-thread-5&quot;:
	at org.apache.commons.vfs.provider.AbstractFileSystem.streamOpened(AbstractFileSystem.java:569)
	- waiting to lock &amp;lt;0x22f972e8&amp;gt; (a org.apache.commons.vfs.provider.ftp.FtpFileSystem)
	at org.apache.commons.vfs.provider.DefaultFileContent.streamOpened(DefaultFileContent.java:92)
	at org.apache.commons.vfs.provider.DefaultFileContent.getOutputStream(DefaultFileContent.java:377)
	at at.js.jtransporter.transporter.VFSTransporter.createFile(VFSTransporter.java:119)
	at at.js.jtransporter.worker.resource.ResourceWorker.createFile(ResourceWorker.java:80)
	at at.js.jtransporter.worker.resource.ResourceWorker.processJob(ResourceWorker.java:51)
	at at.js.jtransporter.worker.AbstractRunnableWorker.run(AbstractRunnableWorker.java:82)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
	at java.lang.Thread.run(Thread.java:619)
&quot;pool-1-thread-2&quot;:
	at org.apache.commons.vfs.provider.ftp.FtpFileSystem.putClient(FtpFileSystem.java:137)
	- waiting to lock &amp;lt;0x22f999e0&amp;gt; (a java.lang.Object)
	at org.apache.commons.vfs.provider.ftp.FtpFileObject.doGetChildren(FtpFileObject.java:158)
	at org.apache.commons.vfs.provider.ftp.FtpFileObject.getChildFile(FtpFileObject.java:103)
	at org.apache.commons.vfs.provider.ftp.FtpFileObject.getInfo(FtpFileObject.java:181)
	at org.apache.commons.vfs.provider.ftp.FtpFileObject.refresh(FtpFileObject.java:208)
	at org.apache.commons.vfs.provider.AbstractFileSystem.resolveFile(AbstractFileSystem.java:319)
	- locked &amp;lt;0x22f972e8&amp;gt; (a org.apache.commons.vfs.provider.ftp.FtpFileSystem)
	at org.apache.commons.vfs.provider.AbstractFileSystem.resolveFile(AbstractFileSystem.java:267)
	- locked &amp;lt;0x22f972e8&amp;gt; (a org.apache.commons.vfs.provider.ftp.FtpFileSystem)
	at org.apache.commons.vfs.provider.AbstractFileObject.getParent(AbstractFileObject.java:512)
	- locked &amp;lt;0x22f972e8&amp;gt; (a org.apache.commons.vfs.provider.ftp.FtpFileSystem)
	at org.apache.commons.vfs.provider.ftp.FtpFileObject.getInfo(FtpFileObject.java:177)
	at org.apache.commons.vfs.provider.ftp.FtpFileObject.refresh(FtpFileObject.java:208)
	at org.apache.commons.vfs.provider.AbstractFileSystem.resolveFile(AbstractFileSystem.java:319)
	- locked &amp;lt;0x22f972e8&amp;gt; (a org.apache.commons.vfs.provider.ftp.FtpFileSystem)
	at org.apache.commons.vfs.provider.AbstractFileSystem.resolveFile(AbstractFileSystem.java:267)
	- locked &amp;lt;0x22f972e8&amp;gt; (a org.apache.commons.vfs.provider.ftp.FtpFileSystem)
	at org.apache.commons.vfs.provider.AbstractFileObject.resolveFile(AbstractFileObject.java:670)
	at at.js.jtransporter.transporter.VFSTransporter.createFile(VFSTransporter.java:118)
	at at.js.jtransporter.worker.resource.ResourceWorker.createFile(ResourceWorker.java:80)
	at at.js.jtransporter.worker.resource.ResourceWorker.processJob(ResourceWorker.java:51)
	at at.js.jtransporter.worker.AbstractRunnableWorker.run(AbstractRunnableWorker.java:82)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
	at java.lang.Thread.run(Thread.java:619)
&quot;pool-1-thread-4&quot;:
	at org.apache.commons.vfs.provider.AbstractFileSystem.resolveFile(AbstractFileSystem.java:267)
	- waiting to lock &amp;lt;0x22f972e8&amp;gt; (a org.apache.commons.vfs.provider.ftp.FtpFileSystem)
	at org.apache.commons.vfs.provider.AbstractFileSystem.getRoot(AbstractFileSystem.java:242)
	at org.apache.commons.vfs.provider.ftp.FtpFileSystem.getClient(FtpFileSystem.java:108)
	- locked &amp;lt;0x22f999e0&amp;gt; (a java.lang.Object)
	at org.apache.commons.vfs.provider.ftp.FtpFileObject.doGetOutputStream(FtpFileObject.java:490)
	at org.apache.commons.vfs.provider.AbstractFileObject.getOutputStream(AbstractFileObject.java:1219)
	at org.apache.commons.vfs.provider.DefaultFileContent.getOutputStream(DefaultFileContent.java:373)
	at at.js.jtransporter.transporter.VFSTransporter.createFile(VFSTransporter.java:119)
	at at.js.jtransporter.worker.resource.ResourceWorker.createFile(ResourceWorker.java:80)
	at at.js.jtransporter.worker.resource.ResourceWorker.processJob(ResourceWorker.java:51)
	at at.js.jtransporter.worker.AbstractRunnableWorker.run(AbstractRunnableWorker.java:82)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
	at java.lang.Thread.run(Thread.java:619)

Found 1 deadlock.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12444897">VFS-293</key>
            <summary>FtpFileSystem causes deadlock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="scharfj">Johannes Scharf</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jan 2010 12:17:13 +0000</created>
                <updated>Wed, 16 May 2012 05:27:51 +0000</updated>
                            <resolved>Tue, 23 Nov 2010 00:30:27 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12798020" author="scharfj" created="Fri, 8 Jan 2010 14:12:40 +0000"  >&lt;p&gt;I&apos;ve found a possible solution for this bug.&lt;br/&gt;
Simply synchronize the getClient and putClient methods themselves on &quot;this&quot; and remove the synchronized block inside the methods which synchronzes on &quot;idleClientSync&quot;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; FtpClient getClient() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileSystemException {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idleClient == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || !idleClient.isConnected()) {
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (log.isDebugEnabled()) {
				log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;getClient(): Returning &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FtpClient...&quot;&lt;/span&gt;);
			}
			FtpClient ftpClient = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FtpClientWrapper(
					(GenericFileName) getRoot().getName(),
					getFileSystemOptions());
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ftpClient;
		} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (log.isDebugEnabled()) {
				log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;getClient(): Returning idle FtpClient...&quot;&lt;/span&gt;);
			}
			&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FtpClient client = idleClient;
			idleClient = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; client;
		}
	}

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void putClient(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FtpClient client) {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idleClient == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (log.isDebugEnabled()) {
				log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Pooling used FtpClient...&quot;&lt;/span&gt;);
			}
			&lt;span class=&quot;code-comment&quot;&gt;// Hang on to client &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; later
&lt;/span&gt;			idleClient = client;
		} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (log.isDebugEnabled()) {
				log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Disposing used FtpClient...&quot;&lt;/span&gt;);
			}
			&lt;span class=&quot;code-comment&quot;&gt;// Close the client
&lt;/span&gt;			closeConnection(client);
		}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12934671" author="ralph.goers@dslextreme.com" created="Tue, 23 Nov 2010 00:30:27 +0000"  >&lt;p&gt;getClient and putClient no longer synchronize. Instead idleClient has been changed to an AtomicReference.&lt;/p&gt;</comment>
                            <comment id="13276482" author="garydgregory" created="Wed, 16 May 2012 05:27:51 +0000"  >&lt;p&gt;Closing issue as this is fixed by &quot;Ralph Goers added a comment - 23/Nov/10 00:30&quot;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>200337</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 27 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i13913:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227093</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>