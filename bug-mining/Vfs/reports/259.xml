<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:15:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-748] TarProvider Incorrectly marks file IMAGINARY after garbage collection with WeakRefFilesCache</title>
                <link>https://issues.apache.org/jira/browse/VFS-748</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;A Tar FileObject becomes unusable once it is removed from the filesCache.&#160; The example provided here uses the the WeakRefFilesCache but I suspect the bug is not limited to this cache type only, since it is the recreation of the entry after removal that is flawed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The following code snippet will repeatedly access the the tarball until garbage collection occurs.&#160; When this happens the cache entry is dropped but upon reaccess, a new cache entry is created that incorrectly marks the file as &quot;IMAGINARY&quot;.&#160; All subsequent access to this file is are not possible in the VM.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Output from the class provided looks like this....&lt;/p&gt;

&lt;p&gt;97&lt;br/&gt;
 98&lt;br/&gt;
 99&lt;br/&gt;
 100&lt;br/&gt;
 tgz:&lt;a href=&quot;file:///C:/env/ws/vfsTarBug/target/classes/test.tar.gz!/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///C:/env/ws/vfsTarBug/target/classes/test.tar.gz!/&lt;/a&gt; did not exist&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The number of successful iterations may vary depending upon the behavior of the GC.&lt;/p&gt;

&lt;p&gt;Tracing the run, the culprit appears to be a createFile method which hard codes the tarExists argument to false when it should be true.&#160; The stack trace for this appears below.&#160;&lt;/p&gt;

&lt;p&gt;at org.apache.commons.vfs2.provider.tar.TarFileSystem.createFile(TarFileSystem.java:210)at org.apache.commons.vfs2.provider.tar.TarFileSystem.createFile(TarFileSystem.java:210) &#160; at org.apache.commons.vfs2.provider.AbstractFileSystem.resolveFile(AbstractFileSystem.java:320) &#160; - locked &amp;lt;0x53d2&amp;gt; (a org.apache.commons.vfs2.provider.tar.TarFileSystem) &#160; at org.apache.commons.vfs2.provider.AbstractFileSystem.resolveFile(AbstractFileSystem.java:300) &#160; at org.apache.commons.vfs2.provider.AbstractFileSystem.getRoot(AbstractFileSystem.java:274) &#160; at org.apache.commons.vfs2.provider.AbstractLayeredFileProvider.createFileSystem(AbstractLayeredFileProvider.java:82) &#160; - locked &amp;lt;0x53e2&amp;gt; (a org.apache.commons.vfs2.provider.tar.TarFileProvider) &#160; at org.apache.commons.vfs2.provider.AbstractLayeredFileProvider.findFile(AbstractLayeredFileProvider.java:56) &#160; at org.apache.commons.vfs2.impl.DefaultFileSystemManager.resolveFile(DefaultFileSystemManager.java:711) &#160; at org.pentaho.di.core.vfs.ConcurrentFileSystemManager.resolveFile(ConcurrentFileSystemManager.java:91) &#160; at org.apache.commons.vfs2.impl.DefaultFileSystemManager.resolveFile(DefaultFileSystemManager.java:648)&lt;/p&gt;</description>
                <environment>&lt;p&gt;commons-vfs2.2.jar&lt;/p&gt;

&lt;p&gt;commons-compress-1.18.jar&lt;/p&gt;</environment>
        <key id="13272018">VFS-748</key>
            <summary>TarProvider Incorrectly marks file IMAGINARY after garbage collection with WeakRefFilesCache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Kafalas">Tim</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Dec 2019 17:48:25 +0000</created>
                <updated>Mon, 2 Nov 2020 02:07:53 +0000</updated>
                            <resolved>Mon, 2 Nov 2020 02:07:52 +0000</resolved>
                                    <version>2.2</version>
                                    <fixVersion>2.8.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17001201" author="garydgregory" created="Fri, 20 Dec 2019 20:25:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Kafalas&quot; class=&quot;user-hover&quot; rel=&quot;Kafalas&quot;&gt;Kafalas&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;The best way forward here would be to provide a PR on GitHub which includes your test.&lt;/p&gt;</comment>
                            <comment id="17224108" author="garydgregory" created="Sat, 31 Oct 2020 16:03:38 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://github.com/PeterAlfredLee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;@PeterAlfredLee&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I could not apply this patch cleanly from a patch file for some reason, but I did bring in the changes with expanded tests. Please see git master and close this PR and&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/VFS-748&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/VFS-748&lt;/a&gt;&#160;if all is well for your use case.&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12987390" name="TarBug.java" size="1851" author="Kafalas" created="Tue, 3 Dec 2019 17:38:40 +0000"/>
                            <attachment id="12987389" name="test.tar.gz" size="101" author="Kafalas" created="Tue, 3 Dec 2019 17:39:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z098wo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>