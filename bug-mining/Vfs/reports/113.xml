<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-443] Need an easy way to convert from a FileObject to a File</title>
                <link>https://issues.apache.org/jira/browse/VFS-443</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;I&apos;ve seen the reasons why Apache does not want to provide an easy way to convert from a FileObject to a java.io.File and those reasons make sense - however, I think that some things are being overlooked and there are still valid reasons for needing to convert from a FileObject to a File.&lt;/p&gt;

&lt;p&gt;Firstly, I would like to always use Apache VFS for everything I do - even if I know it&apos;s only on the local file system. The reasons for this are:&lt;/p&gt;

&lt;p&gt;1. it makes the code more flexible (it might start of being local file system and then as specs change it could become a requirement to work over http or inside zip files for example). &lt;/p&gt;

&lt;p&gt;2. The API is nicer to use than the java.io.File and it&apos;s easier to write cross platform code using it (file separator is always &quot;/&quot; etc).&lt;/p&gt;

&lt;p&gt;So if I work with Apache VFS for local file system use I would like to be able to get back to a java.io.File in case I need to interface with same other library. I would like a method that converted to a File or null if not possible. This would allow me to take an alternate action (eg copy file to local temp file if it&apos;s not already a local file). There&apos;s no need to copy the file if it is already local.&lt;/p&gt;

&lt;p&gt;The simplest fix for this is to just make the getLocalFile() method in LocalFile public. Once the user knows it&apos;s a LocalFile object it makes sense to call this method to obtain the java.io.File. So I could write a method like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;FileUtilities.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/**
    * If the supplied {@link FileObject} represents a local file then &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; returns that, otherwise
    * returns &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
    */
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; File getLocalFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject fileObject)
   {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fileObject &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; LocalFile)
      {
         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LocalFile localFile = (LocalFile)fileObject;

         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; localFile.getLocalFile();
      }

      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12615857">VFS-443</key>
            <summary>Need an easy way to convert from a FileObject to a File</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="nickallen">Nick Allen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Nov 2012 08:38:53 +0000</created>
                <updated>Mon, 15 Mar 2021 18:18:16 +0000</updated>
                                            <version>2.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13496185" author="garydgregory" created="Tue, 13 Nov 2012 13:25:39 +0000"  >&lt;p&gt;What about using:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;File f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fo.getURL().getPath());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Making getLocalFile() a public method is possible but against the current design. If you look at all the FileObject subclasses, the only public methods are @Override methods.&lt;/p&gt;</comment>
                            <comment id="13496484" author="nickallen" created="Tue, 13 Nov 2012 19:52:44 +0000"  >&lt;p&gt;That does not work if the url contains special characters (eg !,%, space etc) so is not a suitable replacement.&lt;/p&gt;</comment>
                            <comment id="13496487" author="nickallen" created="Tue, 13 Nov 2012 19:55:53 +0000"  >&lt;p&gt;I don&apos;t see why the only public methods have to be overrides. Why even expose the LocalFile class in that case? It can&apos;t do anything more than a FileObject can so as a client of the library I don&apos;t need to know about that class at all if I can access all it&apos;s functionality through its base class. It&apos;s a common design pattern that a sub-class can extend and add extra functionality so I don&apos;t really see why this should be a problem at all from a design point of view.&lt;/p&gt;</comment>
                            <comment id="13496505" author="garydgregory" created="Tue, 13 Nov 2012 20:16:36 +0000"  >&lt;p&gt;&quot;That does not work if the url contains special characters (eg !,%, space etc) s&quot;&lt;/p&gt;

&lt;p&gt;It depends on the file provider, this works (in trunk):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testFileObjectToFile() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileSystemException {
        FileObject fo = VFS.getManager().resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;//C:\\Users\\ggregory\\Documents\\eclipse\\LDE\\Java6Tests\\src\\test\\resources\\test space.txt&quot;&lt;/span&gt;);
&lt;/span&gt;        File f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fo.getURL().getPath());
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(f + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + f.exists());
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testResFileObjectToAbsoluteFile() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileSystemException {
        FileObject fo = VFS.getManager().resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;res:test space.txt&quot;&lt;/span&gt;);
        File f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fo.getURL().getPath());
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(f + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + f.exists());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you provide an example of what you want to do?&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="13496550" author="nickallen" created="Tue, 13 Nov 2012 21:16:36 +0000"  >&lt;p&gt;I added Junit tests to check that conversion works to some utility functions and they fail using the method that was suggested.&lt;/p&gt;

&lt;p&gt;Here are my unit tests:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;FileUtilityTests.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testFileObjectConversion()
   {
      testFileObjectConversion(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello.txt&quot;&lt;/span&gt;));
      testFileObjectConversion(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello there.txt&quot;&lt;/span&gt;));
      testFileObjectConversion(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello!?%#.txt&quot;&lt;/span&gt;));
   }

   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void testFileObjectConversion(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File file)
   {
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject fileObject = FileUtilities.getFileObject(file);
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File localFile = FileUtilities.getLocalFile(fileObject);

      Assert.assertTrue(localFile != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
      Assert.assertEquals(file.getAbsoluteFile(), localFile);
   }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And here are the functions that are tested:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;FileUtilities.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;/** Converts a {@link File} to a {@link FileObject}. */&lt;/span&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; FileObject getFileObject(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File file)
   {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
      {
         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File absoluteFile = file.getAbsoluteFile();
         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject fileObject = VFS.getManager().toFileObject(absoluteFile);

         &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; fileObject != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
         &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; absoluteFile.equals(getLocalFile(fileObject));

         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; fileObject;
      }
      &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileSystemException e)
      {
         &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(e);
      }
   }

   /**
    * If the supplied {@link FileObject} represents a local file then &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; returns that, otherwise
    * returns &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
    */
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; File getLocalFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject fileObject)
   {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fileObject &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; LocalFile)
      {
         &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
         {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fileObject.getURL().getPath());
         }
         &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileSystemException e)
         {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(e);
         }
      }

      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
   }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13496556" author="nickallen" created="Tue, 13 Nov 2012 21:18:08 +0000"  >&lt;p&gt;The test for a file with space works but with ?!# chars it doesn&apos;t.&lt;/p&gt;</comment>
                            <comment id="13496815" author="garydgregory" created="Wed, 14 Nov 2012 03:39:04 +0000"  >&lt;p&gt;OK, you&apos;ve convinced me, &lt;tt&gt;getLocalFile()&lt;/tt&gt; is now public with a usage recommendation in the Javadoc.&lt;/p&gt;

&lt;p&gt;Please provide feedback on the Javadoc if you would. Or anything else in VFS2.&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit -m &quot;[VFS-443] [Local] Need an easy way to convert from a FileObject to a File.&quot; C:/svn/org/apache/commons/trunks-proper/vfs/src/changes/changes.xml C:/svn/org/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/local/LocalFile.java
    Sending        C:/svn/org/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/local/LocalFile.java
    Sending        C:/svn/org/apache/commons/trunks-proper/vfs/src/changes/changes.xml
    Transmitting file data ...
    Committed revision 1409075.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13496963" author="joehni" created="Wed, 14 Nov 2012 09:11:46 +0000"  >&lt;p&gt;Hi Greg,&lt;/p&gt;

&lt;p&gt;actually I think this is not the proper action. Your code should be the obvious solution, but it fails, because it simply demonstrates a fundamental problem with VFS&apos; URL handling:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testFileNameWithSpaces() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; VirtualFileSystemException, URISyntaxException, IOException
{
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;a name.txt&quot;&lt;/span&gt;);
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileURL = file.toURI().toURL().toExternalForm();
  assertEquals(file.getAbsoluteFile(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(file.toURI().getPath()));
  assertEquals(file.getAbsoluteFile(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(fileURL).toURI().getPath()));

  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileSystemManager manager = VFS.getManager();
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject fo = manager.resolveFile(fileURL);
  assertEquals(file.getAbsoluteFile(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(fo.getURL().toExternalForm()).toURI().getPath()));
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testFileNameWithCharacters() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; VirtualFileSystemException, URISyntaxException, IOException
{
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;+# %&amp;amp;.txt&quot;&lt;/span&gt;);
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileURL = file.toURI().toURL().toExternalForm();
  assertEquals(file.getAbsoluteFile(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(file.toURI().getPath()));
  assertEquals(file.getAbsoluteFile(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(fileURL).toURI().getPath()));

  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(file).close();
    assertTrue(file.exists());

    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileSystemManager manager = VFS.getManager();
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject fo = manager.resolveFile(fileURL);
    assertTrue(fo.exists());
    assertEquals(file.getAbsoluteFile(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(fo.getURL().toExternalForm()).toURI().getPath()));
  } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    file.delete();
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Formally URLs are defined as subset of an URI in RFC 2396. However, java.net.URL has a long and sad story and the class does not ensure that the URL instance complies to this RFC. Even worse, the direct conversion between File and URL was never implemented properly and it will never be corrected, because too much code relies on the bad behavior (i.e. tries to fix the result afterwards). Therefore the JDK documents to do a proper conversion like in my unit test above using temporary URIs (see Javadoc for URL and URI).&lt;/p&gt;

&lt;p&gt;However, VFS fails here badly. The first test above fails in the last line with a URISyntaxException, because the URL returned from FileObject is no longer compliant - although a compliant URL was provided to VFS. The last assert in the second test fails, because the URL is truncated; VFS does no proper URL encoding/decoding.&lt;/p&gt;</comment>
                            <comment id="13496989" author="nickallen" created="Wed, 14 Nov 2012 09:53:49 +0000"  >&lt;p&gt;Thanks for making this public &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Is this now deployed as snapshot in maven repository yet? If so I can quickly update our maven dependency and check it works for you. The javadocs look good to me. I can&apos;t comment too much on the URL handling in VFS though...&lt;/p&gt;</comment>
                            <comment id="13496995" author="nickallen" created="Wed, 14 Nov 2012 10:01:10 +0000"  >&lt;p&gt;Looking at the LocalFile.java class it looks like the implementation has bugs in it. Just making getLocalFile() public will not work because this just directly returns the field and in my debugger I can see that this is null at this point. It seems the file has to be attached first. Looking at the LocalFile.doAttach() method it seems that this just uses the decoded path in the name but on Windows this should be with &quot;\&quot; not &quot;/&quot; and also the C:\ part is missing. I can&apos;t debug it yet to check but that is what I would expect to happen.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;LocalFile.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
     * Returns the local file that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file object represents.
     */
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; File getLocalFile()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; file;
    }

    /**
     * Attaches &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file object to its file resource.
     */
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void doAttach() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (file == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            &lt;span class=&quot;code-comment&quot;&gt;// Remove the &lt;span class=&quot;code-quote&quot;&gt;&quot;file:///&quot;&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// LocalFileName localFileName = (LocalFileName) getName();
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName = rootFile + getName().getPathDecoded();
            &lt;span class=&quot;code-comment&quot;&gt;// fileName = UriParser.decode(fileName);
&lt;/span&gt;            file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fileName);
        }
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13497328" author="garydgregory" created="Wed, 14 Nov 2012 18:38:11 +0000"  >&lt;p&gt;@Joerge&apos;s &lt;a href=&quot;https://issues.apache.org/jira/browse/VFS-443?focusedCommentId=13496963&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13496963&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/VFS-443?focusedCommentId=13496963&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13496963&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Well, this is quite a mess. &lt;/p&gt;

&lt;p&gt;Is &lt;tt&gt;LocalFileName.getURI()&lt;/tt&gt; the only place at fault here?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Returns the absolute URI of the file.
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; The absolute URI of the file.
     */
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getURI()
    {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri = &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getURI();

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (uri != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; uri.length() &amp;gt; 0)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
            {
                &lt;span class=&quot;code-comment&quot;&gt;// VFS-325: Handle URI special characters in filename
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// Decode the base uri and re-encode with URI special characters
&lt;/span&gt;                uri = UriParser.decode(uri);

                uri = UriParser.encode(uri, RESERVED_URI_CHARS);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FileSystemException e)
            {
                &lt;span class=&quot;code-comment&quot;&gt;// Default to base uri value
&lt;/span&gt;            }
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; uri;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then we have:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-comment&quot;&gt;// URI Characters that are possible in local filenames, but must be escaped
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; proper URI handling.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// How reserved URI chars were selected:
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//  URIs can contain :, /, ?, #, @
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//      See http://download.oracle.com/javase/6/docs/api/java/net/URI.html
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//          http://tools.ietf.org/html/rfc3986#section-2.2
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//  Since : and / occur before the path, only chars after path are escaped (i.e., # and ?)
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//  ? is a reserved filesystem character &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Windows and Unix, so can&apos;t be part of a filename.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//  Therefore only # is a reserved &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; in a URI as part of the path that can be in the filename.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; RESERVED_URI_CHARS[] = {&lt;span class=&quot;code-quote&quot;&gt;&apos;#&apos;&lt;/span&gt;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adding &lt;tt&gt;&apos; &apos;&lt;/tt&gt; (a space char) to the array causes the two tests above to pass. &lt;/p&gt;

&lt;p&gt;But this is a hack, and seems to go against the method as coded.&lt;/p&gt;

&lt;p&gt;Any thoughts on how to best fix this?&lt;/p&gt;</comment>
                            <comment id="13497351" author="joehni" created="Wed, 14 Nov 2012 19:06:19 +0000"  >&lt;p&gt;1/ I am -1 to make getLocalFile() public. The internal File instance was always meant to be a lazy object that is not necessarily created.&lt;/p&gt;

&lt;p&gt;2/ the comment lies for Unix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ touch \?.txt
$ ls *.txt
?.txt
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and of course can a file in Unix also have characters &apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos;, &apos;:&apos;, &apos;\&apos;&apos;, or  ... (well, as long as it does not save it into FAT).&lt;/p&gt;

&lt;p&gt;3/ For me it seems that VFS does not really separate between URL and URI. E.g. an URL cannot contain a space, while it is valid for an URI. Therefore, if something like FileObject.getURL() returns a URL, it should always be possible to create a URI from it - and this is not limited to file URLs only. Basically it is now at least possible to use the JDK for proper conversion, 1.4 was the last to fail. VFS is a lot older, but it looks like there is plenty of cruft left, that does not really work as expected either.&lt;/p&gt;</comment>
                            <comment id="13497403" author="garydgregory" created="Wed, 14 Nov 2012 20:17:31 +0000"  >&lt;p&gt;-1 it is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit -m &quot;Revert to making getLocalFile() protected.&quot; C:/svn/org/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/local/LocalFile.java
    Sending        C:/svn/org/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/local/LocalFile.java
    Transmitting file data ...
    Committed revision 1409369.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14611158" author="b.eckenfels" created="Wed, 1 Jul 2015 23:16:30 +0000"  >&lt;p&gt;I think it is good to reduce the exposure of provider classes/packages. All access should be done through the main api packages (which needs to be defined&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Otherwise it would be really hard to gurante compatibility.&lt;/p&gt;

&lt;p&gt;We already have a `FileSystemManager#toFileObject(File)` so we can add a FileSystemManager#toFile(FileObject)` as well?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257342</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0jxwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114426</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>