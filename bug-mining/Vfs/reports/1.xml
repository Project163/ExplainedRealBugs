<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:13:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-50] Threading issue with AbstractFileSystem.fireEvent</title>
                <link>https://issues.apache.org/jira/browse/VFS-50</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;I make heavy use of DelegateFileObject in my code and recently ran into a threading issue when a change in one file was trying to automatically update dependent DelegateFileObjects. While events where still being propagated, one DelegateFileObject removed itself as an event listener. This caused an index-of-range problem in AbstractFileSystem.fireEvent because the listener list had shrunk, but the &quot;count&quot; had already been fixed.&lt;/p&gt;

&lt;p&gt;It appears that the current implementation of fireEvent is not entirely thread safe, if event handlers can still change the listener list in place. I will attach a patch that works for me.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12343347">VFS-50</key>
            <summary>Threading issue with AbstractFileSystem.fireEvent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="imario">Mario Ivankovits</assignee>
                                    <reporter username="digi">Chris DiGiano</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 May 2006 20:12:04 +0000</created>
                <updated>Sun, 18 Feb 2007 17:38:38 +0000</updated>
                            <resolved>Sun, 18 Feb 2007 17:38:38 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12412770" author="digi" created="Mon, 22 May 2006 20:14:06 +0000"  >&lt;p&gt;Here&apos;s a patch that makes a copy of the listener list to avoid race conditions:&lt;/p&gt;

&lt;p&gt;Index: src/java/org/apache/commons/vfs/provider/AbstractFileSystem.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/vfs/provider/AbstractFileSystem.java    (revision 408551)&lt;br/&gt;
+++ src/java/org/apache/commons/vfs/provider/AbstractFileSystem.java    (working copy)&lt;br/&gt;
@@ -484,9 +484,12 @@&lt;br/&gt;
         synchronized (listenerMap)&lt;br/&gt;
         {&lt;br/&gt;
             final FileObject file = event.getFile();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final ArrayList listeners = (ArrayList) listenerMap.get(file.getName());&lt;/li&gt;
	&lt;li&gt;if (listeners != null)&lt;br/&gt;
+//            final ArrayList listeners = (ArrayList) listenerMap.get(file.getName());&lt;br/&gt;
+//            if (listeners != null)&lt;br/&gt;
+            if (listenerMap.containsKey(file.getName()))&lt;br/&gt;
             {&lt;br/&gt;
+                // Make a copy of the listeners to avoid race conditions. (Chris DiGiano)&lt;br/&gt;
+                final ArrayList listeners = new ArrayList((ArrayList) listenerMap.get(file.getName()));&lt;br/&gt;
                 final int count = listeners.size();&lt;br/&gt;
                 for (int i = 0; i &amp;lt; count; i++)&lt;br/&gt;
                 {&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12412771" author="digi" created="Mon, 22 May 2006 20:15:55 +0000"  >&lt;p&gt;By the way, it&apos;s not clear to me that the existing synchronization on listenerMap provides any real threading protection. The references itself is unlikely to change. Instead it&apos;s the contents of the map that we need to worry about.&lt;/p&gt;</comment>
                            <comment id="12413295" author="imario" created="Fri, 26 May 2006 02:50:34 +0000"  >&lt;p&gt;Well, this wasnt really a &quot;threading issue&quot; but a normal bug.&lt;br/&gt;
Since every access to the &quot;listeners&quot; is synchronized on the &quot;listenerMap&quot; both are save. There is no access to the &quot;listeners&quot; outside an &quot;listenerMap&quot; synchronization.&lt;/p&gt;

&lt;p&gt;I slightly modified your patch.&lt;/p&gt;

&lt;p&gt;Thanks for reporting it.&lt;/p&gt;</comment>
                            <comment id="12414099" author="digi" created="Thu, 1 Jun 2006 00:02:32 +0000"  >&lt;p&gt;I&apos;ve confirmed that Mario&apos;s slightly modified fix addresses the problem I was noticing in my own project. Thanks Mario!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>200111</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05jtb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30307</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>