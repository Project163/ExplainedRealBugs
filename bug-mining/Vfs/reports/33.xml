<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:13:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-120] SFTP-Exception: &quot;com.jcraft.jsch.JSchException: session is down&quot; if the SFTP-Server was killed and restarted (a normal shutdown of the SFTP-Server occured no Exception after restart.)</title>
                <link>https://issues.apache.org/jira/browse/VFS-120</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;The error occured after restarting if the SFTP-Server was KILLed!!.&lt;br/&gt;
With a normal shutdown of the SFTP-Server, no exception after restarting occured.&lt;/p&gt;

&lt;p&gt;I found no function to force the reset of the session in SftpFileSystem.java&lt;br/&gt;
There is a function:&lt;br/&gt;
    DefaultFileSystemManager manager = (DefaultFileSystemManager)VFS.getManager();&lt;br/&gt;
    manager.freeUnusedResources();&lt;br/&gt;
But this works only if AbstractFileSystem.isReleaseable() returns true.&lt;br/&gt;
And this this function return only true if all SFTP-FileObject are removed from the GarbageCollection (finally()-Methode).&lt;br/&gt;
I cannot force a GarbageCollection.&lt;br/&gt;
So there is no way to handle this Error! I must restart the VM (ServletContainer).&lt;/p&gt;

&lt;p&gt;org.apache.commons.vfs.FileSystemException: Could not copy &quot;file:///C:/TEMP/.....&quot; to &quot;sftp://......&quot;.&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.copyFrom(AbstractFileObject.java:902)&lt;br/&gt;
        at com.bearingpoint.orf.chat.core.service.ExportManagerImpl.exportChatMessages(Unknown Source)&lt;br/&gt;
        at com.bearingpoint.orf.chat.core.service.ExportManagerImpl.startExportNow(Unknown Source)&lt;br/&gt;
        at com.bearingpoint.orf.chat.core.service.ExportManagerImpl$ExportManagerRunnable.run(Unknown Source)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;br/&gt;
Caused by: org.apache.commons.vfs.FileSystemException: Could not write to &quot;sftp://chat:chat@10.1.5.130/home/chat/chatfile_12.zip&quot;.&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.getOutputStream(AbstractFileObject.java:1227)&lt;br/&gt;
        at org.apache.commons.vfs.provider.DefaultFileContent.getOutputStream(DefaultFileContent.java:373)&lt;br/&gt;
        at org.apache.commons.vfs.provider.DefaultFileContent.getOutputStream(DefaultFileContent.java:356)&lt;br/&gt;
        at org.apache.commons.vfs.FileUtil.copyContent(FileUtil.java:100)&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.copyFrom(AbstractFileObject.java:893)&lt;br/&gt;
        ... 4 more&lt;br/&gt;
Caused by: org.apache.commons.vfs.FileSystemException: Could not connect to SFTP server at &quot;sftp://chat:chat@10.1.5.130/&quot;.&lt;br/&gt;
        at org.apache.commons.vfs.provider.sftp.SftpFileSystem.getChannel(SftpFileSystem.java:144)&lt;br/&gt;
        at org.apache.commons.vfs.provider.sftp.SftpFileObject.doGetOutputStream(SftpFileObject.java:402)&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.getOutputStream(AbstractFileObject.java:1219)&lt;br/&gt;
        ... 8 more&lt;br/&gt;
Caused by: com.jcraft.jsch.JSchException: session is down&lt;br/&gt;
        at com.jcraft.jsch.Session.openChannel(Session.java:756)&lt;br/&gt;
        at org.apache.commons.vfs.provider.sftp.SftpFileSystem.getChannel(SftpFileSystem.java:122)&lt;br/&gt;
        ... 10 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tomcat 5.5&lt;br/&gt;
JDK 6.0 (build with JDK 5)&lt;/p&gt;

&lt;p&gt;commons-vfs-1.0.jar:&lt;br/&gt;
Specification-Title: Commons VFS&lt;br/&gt;
Implementation-Version: 1.0&lt;/p&gt;

&lt;p&gt;JSCH: jsch-0.1.31.jar&lt;/p&gt;</environment>
        <key id="12366191">VFS-120</key>
            <summary>SFTP-Exception: &quot;com.jcraft.jsch.JSchException: session is down&quot; if the SFTP-Server was killed and restarted (a normal shutdown of the SFTP-Server occured no Exception after restart.)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="imario">Mario Ivankovits</assignee>
                                    <reporter username="brabenetz">Harald Brabenetz</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Mar 2007 09:03:46 +0000</created>
                <updated>Wed, 27 Jul 2016 21:04:43 +0000</updated>
                            <resolved>Fri, 10 Aug 2007 19:00:31 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="12485958" author="brabenetz" created="Mon, 2 Apr 2007 07:53:57 +0000"  >&lt;p&gt;I found a Workaround:&lt;br/&gt;
I don&apos;t use the VFS.getManager(). Instead i create my own StandardFileSystemManager and close it inside a finally clause:&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------------&lt;br/&gt;
StandardFileSystemManager manager = new StandardFileSystemManager();&lt;br/&gt;
manager.init();&lt;/p&gt;

&lt;p&gt;try {&lt;br/&gt;
    ..... //do something&lt;br/&gt;
} finally {&lt;br/&gt;
    manager.close();&lt;br/&gt;
    manager = null;&lt;br/&gt;
}&lt;br/&gt;
------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;So, I always have a new Session.&lt;/p&gt;

&lt;p&gt;Is this a correct solution, or are there maybe side-effects?&lt;/p&gt;</comment>
                            <comment id="12485984" author="imario" created="Mon, 2 Apr 2007 10:56:25 +0000"  >&lt;p&gt;As a workaround you can do it that way, as long as you do not use this manager instance as singleton I see no side-effects.&lt;/p&gt;

&lt;p&gt;Still, I (or we? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )  should try to fix it.&lt;/p&gt;

&lt;p&gt;Ciao,&lt;br/&gt;
Mario&lt;/p&gt;</comment>
                            <comment id="12485992" author="brabenetz" created="Mon, 2 Apr 2007 12:08:49 +0000"  >&lt;p&gt;I&apos;m happy about the Workaround. It makes also a clean connection.open() &amp;amp; connection.close() on the SFTP-Server-Side.&lt;/p&gt;

&lt;p&gt;But for general use and worst case of Exceptions there should be a reinitialization of the JSCH-Session like the following (see also SftpFileSystem-patch.txt):&lt;/p&gt;

&lt;p&gt;if (&quot;session is down&quot;.equals(e.getMessage())){&lt;br/&gt;
    //reinitialize the Session. The next execution should work.&lt;br/&gt;
    doCloseCommunicationLink();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;So the Exception should occured only one time after killing and restart the SFTP-Server.&lt;/p&gt;

&lt;p&gt;But I have not tested it....&lt;/p&gt;</comment>
                            <comment id="12485994" author="brabenetz" created="Mon, 2 Apr 2007 12:09:56 +0000"  >&lt;p&gt;see last comment&lt;/p&gt;</comment>
                            <comment id="12510385" author="vikas maan" created="Thu, 5 Jul 2007 15:27:05 +0000"  >&lt;p&gt;I am facing this problem also.&lt;br/&gt;
When i stop the ftp-server and restarted it.My activity become hang and i am not receiving any error message.&lt;br/&gt;
2007-07-05 20:44:51,078 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Flow Thread(192168001166118364849065600301)&amp;#93;&lt;/span&gt; service     com.adeptia.indigo.services.AbstractService.execute(AbstractService.java:452) - Process_Flow_For_SecureFTP|FTP_Source_Secure_Test|FtpSource|Running|administrators|192168001166118294134403100005|192168001166118364849037500300|192168001166118294076370300003|192168001166118364849068700307|admin|Execute|wshost&lt;br/&gt;
2007-07-05 20:45:24,140 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Flow Thread(192168001166118364849065600301)&amp;#93;&lt;/span&gt;  flow     com.adeptia.indigo.jelly.ActivityTag.runSync(ActivityTag.java:369) - Process_Flow_For_SecureFTP|FTP_Source_Secure_Test|FtpSource|Failed|administrators|192168001166118294134403100005|192168001166118364849037500300|192168001166118294076370300003||admin|Error in execution for activity FtpSource:FTP_Source_Secure_Test:192168001166118294076370300003&lt;span class=&quot;error&quot;&gt;&amp;#91;inputstream is closed&amp;#93;&lt;/span&gt;|wshost&lt;/p&gt;


&lt;p&gt;java.io.IOException: inputstream is closed&lt;br/&gt;
	at com.jcraft.jsch.ChannelSftp.fill(Unknown Source)&lt;br/&gt;
	at com.jcraft.jsch.ChannelSftp.header(Unknown Source)&lt;br/&gt;
	at com.jcraft.jsch.ChannelSftp.access$700(Unknown Source)&lt;br/&gt;
	at com.jcraft.jsch.ChannelSftp$2.read(Unknown Source)&lt;br/&gt;
	at java.io.BufferedInputStream.read1(Unknown Source)&lt;br/&gt;
	at java.io.BufferedInputStream.read(Unknown Source)&lt;br/&gt;
	at org.apache.commons.vfs.util.MonitorInputStream.read(MonitorInputStream.java:88)&lt;br/&gt;
	at java.io.BufferedInputStream.read1(Unknown Source)&lt;br/&gt;
	at java.io.BufferedInputStream.read(Unknown Source)&lt;br/&gt;
	at org.apache.commons.vfs.util.MonitorInputStream.read(MonitorInputStream.java:88)&lt;br/&gt;
	at java.io.FilterInputStream.read(Unknown Source)&lt;br/&gt;
	at com.adeptia.indigo.services.transport.support.AbstractStreamSource.writeOutputStreamCallback(AbstractStreamSource.java:112)&lt;br/&gt;
rethrown as &lt;br/&gt;
rethrown as &lt;br/&gt;
com.adeptia.indigo.services.ServiceException: inputstream is closed&lt;br/&gt;
	at com.adeptia.indigo.services.transport.support.AbstractStreamSource.execute(AbstractStreamSource.java:91)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.commons.modeler.BaseModelMBean.invoke(BaseModelMBean.java:483)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.DynamicMetaDataImpl.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MetaDataImpl.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(Unknown Source)&lt;br/&gt;
	at com.adeptia.indigo.utils.RemoteMBeanProxy$LocalHandler.invokeOperation(RemoteMBeanProxy.java:441)&lt;br/&gt;
	at com.adeptia.indigo.utils.RemoteMBeanProxy$Handler.invoke(RemoteMBeanProxy.java:294)&lt;br/&gt;
	at $Proxy2.execute(Unknown Source)&lt;br/&gt;
	at com.adeptia.indigo.jelly.ActivityTag.runSync(ActivityTag.java:363)&lt;br/&gt;
	at com.adeptia.indigo.jelly.ActivityTag.doTag(ActivityTag.java:250)&lt;br/&gt;
	at org.apache.commons.jelly.impl.TagScript.run(TagScript.java:278)&lt;br/&gt;
	at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:133)&lt;br/&gt;
	at com.werken.blissed.jelly.JellyActivity.perform(JellyActivity.java:120)&lt;br/&gt;
	at com.werken.blissed.ProcessEngine.enterState(ProcessEngine.java:391)&lt;br/&gt;
	at com.werken.blissed.ProcessEngine.followTransition(ProcessEngine.java:509)&lt;br/&gt;
	at com.werken.blissed.ProcessEngine.checkTransitions(ProcessEngine.java:458)&lt;br/&gt;
	at com.werken.blissed.ProcessEngine.startProcess(ProcessEngine.java:366)&lt;br/&gt;
	at com.werken.blissed.ProcessEngine.spawn(ProcessEngine.java:299)&lt;br/&gt;
	at com.adeptia.indigo.processflow.BlissedProcessFlow.execute(BlissedProcessFlow.java:159)&lt;br/&gt;
	at com.adeptia.indigo.transaction.IndigoTransaction.execute(IndigoTransaction.java:423)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.commons.modeler.BaseModelMBean.invoke(BaseModelMBean.java:483)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.DynamicMetaDataImpl.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MetaDataImpl.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.doOperation(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.access$100(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at sun.rmi.server.UnicastServerRef.dispatch(Unknown Source)&lt;br/&gt;
	at sun.rmi.transport.Transport$1.run(Unknown Source)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at sun.rmi.transport.Transport.serviceCall(Unknown Source)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(Unknown Source)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(Unknown Source)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
2007-07-05 20:45:24,171 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Flow Thread(192168001166118364849065600301)&amp;#93;&lt;/span&gt; service     com.adeptia.indigo.services.AbstractService.dispose(AbstractService.java:232) - Process_Flow_For_SecureFTP|FTP_Source_Secure_Test|FtpSource|Aborted|administrators|192168001166118294134403100005|192168001166118364849037500300|192168001166118294076370300003|192168001166118364849068700307|admin|Activity disposed. Start Time:2007-07-05 20:44:50 End Time:2007-07-05 20:45:24 Run Time:33 second(s) 453 ms. Operation count:10846208  Bytes Average:324222.28 operations/sec|wshost&lt;br/&gt;
2007-07-05 20:45:24,203 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Flow Thread(192168001166118364849065600301)&amp;#93;&lt;/span&gt;  flow     com.adeptia.indigo.jelly.ActivityTag.runSync(ActivityTag.java:410) - Process_Flow_For_SecureFTP|FTP_Source_Secure_Test|FtpSource|Failed|administrators|192168001166118294134403100005|192168001166118364849037500300|192168001166118294076370300003||admin|Error in disposing activity FtpSource:FTP_Source_Secure_Test:192168001166118294076370300003&lt;span class=&quot;error&quot;&gt;&amp;#91;Could not close the input stream for file &amp;quot;sftp://maan:maan@vikas/transport/source/text_100mb.txt&amp;quot;.&amp;#93;&lt;/span&gt;|wshost&lt;br/&gt;
org.apache.commons.vfs.FileSystemException: Could not close the input stream for file &quot;sftp://maan:maan@vikas/transport/source/text_100mb.txt&quot;.&lt;br/&gt;
	at org.apache.commons.vfs.provider.DefaultFileContent$FileContentInputStream.close(DefaultFileContent.java:565)&lt;br/&gt;
	at com.adeptia.indigo.services.transport.ftp.FtpSource.dispose(FtpSource.java:201)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.commons.modeler.BaseModelMBean.invoke(BaseModelMBean.java:483)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.DynamicMetaDataImpl.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MetaDataImpl.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(Unknown Source)&lt;/p&gt;</comment>
                            <comment id="12517821" author="bas" created="Mon, 6 Aug 2007 04:44:22 +0000"  >&lt;p&gt;I am facing the same problem too.&lt;/p&gt;

&lt;p&gt;That&apos;s an exception I&apos;m getting when SFTP server goes down:&lt;br/&gt;
org.apache.commons.vfs.FileSystemException: Could not find files in &quot;sftp://***/public/download&quot;.&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.findFiles(AbstractFileObject.java:1518)&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.findFiles(AbstractFileObject.java:1061)&lt;br/&gt;
        ... 6 more&lt;br/&gt;
Caused by: org.apache.commons.vfs.FileSystemException: Could not list the contents of folder &quot;sftp://***/public/download&quot;.&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.getChildren(AbstractFileObject.java:576)&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.traverse(AbstractFileObject.java:1542)&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.findFiles(AbstractFileObject.java:1513)&lt;br/&gt;
        ... 7 more&lt;br/&gt;
Caused by: 4:&lt;br/&gt;
        at com.jcraft.jsch.ChannelSftp._stat(Unknown Source)&lt;br/&gt;
        at com.jcraft.jsch.ChannelSftp.stat(Unknown Source)a&lt;br/&gt;
        at com.jcraft.jsch.ChannelSftp.ls(Unknown Source)&lt;br/&gt;
        at org.apache.commons.vfs.provider.sftp.SftpFileObject.doListChildrenResolved(SftpFileObject.java:262)&lt;br/&gt;
        at org.apache.commons.vfs.provider.AbstractFileObject.getChildren(AbstractFileObject.java:571)&lt;br/&gt;
        ... 9 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at com.jcraft.jsch.ChannelSftp.fill(Unknown Source)&lt;br/&gt;
        at com.jcraft.jsch.ChannelSftp.header(Unknown Source)&lt;br/&gt;
        ... 14 more&lt;/p&gt;

&lt;p&gt;And than on any subsequent call I&apos;m getting that &quot;com.jcraft.jsch.JSchException: session is down&quot; exception.&lt;/p&gt;

&lt;p&gt;The only fix is to restart the whole application.&lt;/p&gt;

&lt;p&gt;I need this fix asap. Thank you.&lt;/p&gt;</comment>
                            <comment id="12517830" author="brabenetz" created="Mon, 6 Aug 2007 06:12:13 +0000"  >&lt;p&gt;Try to replace the:&lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
manager = VFS.getManager()&lt;br/&gt;
..... //do something&lt;br/&gt;
------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;through:&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;br/&gt;
StandardFileSystemManager manager = new StandardFileSystemManager();&lt;br/&gt;
manager.init();&lt;/p&gt;

&lt;p&gt;try {&lt;br/&gt;
    ..... //do something&lt;br/&gt;
} finally {&lt;br/&gt;
    manager.close();&lt;br/&gt;
    manager = null;&lt;br/&gt;
}&lt;br/&gt;
------------------------------------------------------------------------&lt;/p&gt;

</comment>
                            <comment id="12517831" author="brabenetz" created="Mon, 6 Aug 2007 06:15:49 +0000"  >&lt;p&gt;In my application this works fine.&lt;/p&gt;

&lt;p&gt;with friendly regards,&lt;br/&gt;
Harald&lt;/p&gt;</comment>
                            <comment id="12517832" author="bas" created="Mon, 6 Aug 2007 06:18:01 +0000"  >&lt;p&gt;Thanks, Harald. I&apos;ve noticed your comment above. The only problem is that&apos;s in production. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Anyway thanks a lot for a workaround, we will implement that unless fix will be released.&lt;/p&gt;</comment>
                            <comment id="12518256" author="dhartford" created="Tue, 7 Aug 2007 21:04:21 +0000"  >&lt;p&gt;Also experiencing problem - but within a different application/service that needs to use the VFS.getManager as supports multi-protocol.&lt;/p&gt;

&lt;p&gt;It, well, sucks to be using applications/services that rely on VFS-SFTP, hope this gets fixed QUICKLY and RELEASED.&lt;/p&gt;</comment>
                            <comment id="12519094" author="imario" created="Fri, 10 Aug 2007 19:00:31 +0000"  >&lt;p&gt;I think I found a fix without relying on the exception text. There is a session.isConnected() which seems to work fine.&lt;br/&gt;
Please give it a try. &lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="12519174" author="bas" created="Sat, 11 Aug 2007 00:21:55 +0000"  >&lt;p&gt;Mario,&lt;/p&gt;

&lt;p&gt;Thanks for an update, I&apos;ll give it a try some time next week. Could you please shed some light on when VFS 1.1 is about to be released?&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="12520136" author="arbfranklin" created="Thu, 16 Aug 2007 02:12:25 +0000"  >&lt;p&gt;Thanks for the patch above, it worked great for me. I just found one instance where it didn&apos;t due my use of the findFiles method. I was getting the following stack trace:&lt;/p&gt;

&lt;p&gt;Caused by: org.apache.commons.vfs.FileSystemException: Could not find files in &quot;sftp://username:password@server/tmp&quot;.&lt;br/&gt;
	at org.apache.commons.vfs.provider.AbstractFileObject.findFiles(AbstractFileObject.java:1518)&lt;br/&gt;
	at org.apache.commons.vfs.provider.AbstractFileObject.findFiles(AbstractFileObject.java:1061)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at com.cmss.connectors.brokersync.vfs.RetryRemoteFileSystemProxy.invoke(RetryRemoteFileSystemProxy.java:71)&lt;br/&gt;
	at $Proxy1.findFiles(Unknown Source)&lt;br/&gt;
	at com.cmss.connectors.brokersync.vfs.VfsFileSource.findMatchingSourceFiles(VfsFileSource.java:219)&lt;br/&gt;
	at com.cmss.connectors.brokersync.vfs.VfsFileSource.discover(VfsFileSource.java:194)&lt;br/&gt;
	... 5 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.commons.vfs.provider.AbstractFileObject.traverse(AbstractFileObject.java:1536)&lt;br/&gt;
	at org.apache.commons.vfs.provider.AbstractFileObject.findFiles(AbstractFileObject.java:1513)&lt;br/&gt;
	... 14 more&lt;/p&gt;

&lt;p&gt;I managed to fix this with the following patch:&lt;/p&gt;

&lt;p&gt;Index: core/src/main/java/org/apache/commons/vfs/provider/sftp/SftpFileObject.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; core/src/main/java/org/apache/commons/vfs/provider/sftp/SftpFileObject.java (revision 38737)&lt;br/&gt;
+++ core/src/main/java/org/apache/commons/vfs/provider/sftp/SftpFileObject.java (working copy)&lt;br/&gt;
@@ -121,7 +121,7 @@&lt;br/&gt;
                                // maybe the channel has some problems, so recreate the channel and retry&lt;br/&gt;
                                if (e.id != ChannelSftp.SSH_FX_NO_SUCH_FILE)&lt;br/&gt;
                                {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;channel.disconnect();&lt;br/&gt;
+                                       fileSystem.doCloseCommunicationLink();&lt;br/&gt;
                                        channel = fileSystem.getChannel();&lt;br/&gt;
                                        setStat(channel.stat(relPath));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Not sure if it&apos;s how you guys would fix the issue, but hope it helps.&lt;/p&gt;</comment>
                            <comment id="12867096" author="justvit" created="Thu, 13 May 2010 09:43:56 +0000"  >&lt;p&gt;I didn&apos;t want to fix the lib sources, so made this workaround:&lt;br/&gt;
------------------------------------------------&lt;br/&gt;
try {&lt;br/&gt;
   fsmgr = VFS.getManager();&lt;br/&gt;
   ...&lt;br/&gt;
   foSftpServer = fsmgr.resolveFile(&quot;sftp://user:pass@sftp.server.net/&quot;, fsopts);&lt;br/&gt;
   ...&lt;br/&gt;
   vfs = fsmgr.createVirtualFileSystem(&quot;vfs://&quot;).getFileSystem();&lt;br/&gt;
   vfs.addJunction(&quot;/sftp&quot;, foSftpServer);&lt;br/&gt;
   ....&lt;br/&gt;
   dstFile.copyFrom(srcFile, Selectors.SELECT_FILES);&lt;br/&gt;
} catch (Exception e) {&lt;br/&gt;
    try {&lt;br/&gt;
         if ( e.getCause().getCause().getCause().getMessage().equals(&quot;session is down&quot;) )&lt;/p&gt;
{
             fsmgr.closeFileSystem(foSftpServer.getFileSystem()); // workaround for JSchException: &quot;session is down&quot;
         }
&lt;p&gt;   &lt;br/&gt;
    } catch (Exception e1){ }&lt;br/&gt;
}&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12354742" name="SftpFileSystem-patch.txt" size="876" author="brabenetz" created="Mon, 2 Apr 2007 12:09:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>200179</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i138vz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227070</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>