<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-279] ClassCastException in LocalFileSystem when using OnCall caching</title>
                <link>https://issues.apache.org/jira/browse/VFS-279</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;When using OnCall caching in the file system, there is a ClassCastException in the LocalFileSystem#doReplicateFile function.&lt;/p&gt;

&lt;p&gt;To fix the issue, I replaced :&lt;/p&gt;

&lt;p&gt;        final LocalFile localFile = (LocalFile) fileObject;&lt;br/&gt;
by &lt;br/&gt;
        final LocalFile localFile = (LocalFile) FileObjectUtils.getAbstractFileObject(fileObject);&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12433436">VFS-279</key>
            <summary>ClassCastException in LocalFileSystem when using OnCall caching</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="b.eckenfels">Bernd Eckenfels</assignee>
                                    <reporter username="earith">Didier Earith</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Aug 2009 09:39:45 +0000</created>
                <updated>Wed, 27 Jul 2016 21:04:25 +0000</updated>
                            <resolved>Wed, 23 Sep 2015 15:49:06 +0000</resolved>
                                    <version>1.0</version>
                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12744967" author="earith" created="Wed, 19 Aug 2009 09:42:11 +0000"  >&lt;p&gt;Source file to fix the issue&lt;/p&gt;</comment>
                            <comment id="12774720" author="ralph.goers@dslextreme.com" created="Sun, 8 Nov 2009 05:03:37 +0000"  >&lt;p&gt;I looked at the patch and I don&apos;t understand why it fixes anything. Can you provide a unit test that illustrates the behavior?&lt;/p&gt;</comment>
                            <comment id="12774882" author="earith" created="Mon, 9 Nov 2009 07:34:21 +0000"  >&lt;p&gt;I don&apos;t have any simple unit tests to illustrate the behavior.&lt;/p&gt;

&lt;p&gt;Just see that fileObject can be an instance of DecoratedFileObject which doesn&apos;t inherited from AbstractFileObject. &lt;br/&gt;
As LocalFile object inherits from AbstractFileObject, if the object file is an DecoratedFileObject , you&apos;ll get a class cast exception.&lt;/p&gt;

&lt;p&gt;See also for example doRename function in the LocalFile class. Or you can search for getAbstractFileObject function, you will see that :&lt;/p&gt;

&lt;p&gt;        &quot;LocalFile localFile = (LocalFile) fileObject;&quot; is never used, but &lt;/p&gt;

&lt;p&gt;        &quot;LocalFile localFile = (LocalFile) FileObjectUtils.getAbstractFileObject(fileObject);&quot; is always used.&lt;/p&gt;

&lt;p&gt;And this lacks in the doReplicateFile function.&lt;/p&gt;</comment>
                            <comment id="12774887" author="ralph.goers@dslextreme.com" created="Mon, 9 Nov 2009 07:58:35 +0000"  >&lt;p&gt;Thanks.  What I&apos;m concerned about is that doReplicateFile takes a FileObject. From what I can tell, it is possible to call this method and pass in a ZipFileObject or HttpFileObject, neither of which extend LocalFileObject and aren&apos;t DecoratedFileObjects? If so, should it work or is throwing a ClassCastException the correct behavior?&lt;/p&gt;

&lt;p&gt;I assume you ran into this and I assume it must have been with a DecoratedFileObject? I&apos;m interested in that use case as I wonder why it is desired to replicate the underlying FileObject and not the DecoratedFileObject.&lt;/p&gt;</comment>
                            <comment id="12774906" author="earith" created="Mon, 9 Nov 2009 09:06:49 +0000"  >&lt;p&gt;Here is a simple test to reproduce the issue:&lt;/p&gt;

&lt;p&gt;The test consists in calling &apos;resolveFile&apos; with an uri (to a directory) which is contained into a jar file.&lt;/p&gt;



&lt;p&gt;public class TestVFS {&lt;/p&gt;

&lt;p&gt;    public static void main(String[] args) &lt;/p&gt;
{
        
        testBugDoReplicateFile();
        
    }

&lt;p&gt;    public static void testBugDoReplicateFile() {&lt;/p&gt;

&lt;p&gt;        StandardFileSystemManager standardFileSystemManager = new StandardFileSystemManager();&lt;br/&gt;
        standardFileSystemManager.setLogger(LogFactory.getLog(VFS.class));&lt;br/&gt;
        standardFileSystemManager.setClassLoader(TestVFS.class.getClassLoader());&lt;br/&gt;
        try &lt;/p&gt;
{
            URL configUrl = new URL(&quot;file:/C:/MyVFSProvider.xml&quot;);
            standardFileSystemManager.setConfiguration(configUrl);
            standardFileSystemManager.setCacheStrategy(CacheStrategy.ON_CALL);
            standardFileSystemManager.init();

            String uri = &quot;jar:file:/C:/MyJarFile!/schema/iso19139&quot;;
            FileSystemOptions opts = new FileSystemOptions();

            FileObject fileObject = standardFileSystemManager.resolveFile(uri, opts);

        }
&lt;p&gt; catch (FileSystemException e) &lt;/p&gt;
{
            e.printStackTrace();
        } catch (IOException e) {            e.printStackTrace();        }

&lt;p&gt;    }&lt;br/&gt;
}&lt;/p&gt;



&lt;p&gt;The stack is :&lt;/p&gt;


&lt;p&gt;LocalFileSystem.doReplicateFile(FileObject, FileSelector) line: 77	&lt;br/&gt;
LocalFileSystem(AbstractFileSystem).replicateFile(FileObject, FileSelector) line: 395	&lt;br/&gt;
JarFileSystem(ZipFileSystem).&amp;lt;init&amp;gt;(FileName, FileObject, FileSystemOptions) line: 63	&lt;br/&gt;
JarFileSystem.&amp;lt;init&amp;gt;(FileName, FileObject, FileSystemOptions) line: 51	&lt;br/&gt;
JarFileProvider.doCreateFileSystem(String, FileObject, FileSystemOptions) line: 82	&lt;br/&gt;
JarFileProvider(AbstractLayeredFileProvider).createFileSystem(String, FileObject, FileSystemOptions) line: 79	&lt;br/&gt;
JarFileProvider(AbstractLayeredFileProvider).findFile(FileObject, String, FileSystemOptions) line: 59	&lt;br/&gt;
StandardFileSystemManager(DefaultFileSystemManager).resolveFile(FileObject, String, FileSystemOptions) line: 691	&lt;br/&gt;
StandardFileSystemManager(DefaultFileSystemManager).resolveFile(String, FileSystemOptions) line: 619	&lt;br/&gt;
TestVFS.testBugDoReplicateFile() line: 36	&lt;br/&gt;
TestVFS.main(String[]) line: 18	&lt;/p&gt;



&lt;p&gt;In the doReplicateFile, the fileObject object  is  a OnCallRefreshFileObject instance  which inherits from DecoratedFileObject :&lt;/p&gt;


&lt;p&gt;fileObject	OnCallRefreshFileObject  (id=49)	&lt;br/&gt;
	decoratedFileObject	LocalFile  (id=57)	&lt;br/&gt;
		attached	true	&lt;br/&gt;
		children	null	&lt;br/&gt;
		content	null	&lt;br/&gt;
		file	File  (id=60)	&lt;br/&gt;
		fs	LocalFileSystem  (id=43)	&lt;br/&gt;
		name	WindowsFileName  (id=62)	&lt;br/&gt;
		objects	null	&lt;br/&gt;
		operations	null	&lt;br/&gt;
		parent	null	&lt;br/&gt;
		rootFile	&quot;C:&quot; (id=67)	&lt;br/&gt;
		type	FileType  (id=68)	&lt;/p&gt;





&lt;p&gt;MyVFSProvider.xml is &lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;providers&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;!-- &lt;br/&gt;
    &amp;lt;default-provider class-name=&quot;org.apache.commons.vfs.provider.url.UrlFileProvider&quot;/&amp;gt;&lt;br/&gt;
 --&amp;gt;&lt;br/&gt;
    &amp;lt;default-provider class-name=&quot;org.apache.commons.vfs.provider.local.DefaultLocalFileProvider&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;provider class-name=&quot;org.apache.commons.vfs.provider.local.DefaultLocalFileProvider&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;scheme name=&quot;local&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/provider&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;provider class-name=&quot;org.apache.commons.vfs.provider.local.DefaultLocalFileProvider&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;scheme name=&quot;file&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/provider&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;provider class-name=&quot;org.apache.commons.vfs.provider.ftp.FtpFileProvider&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;scheme name=&quot;ftp&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;if-available class-name=&quot;org.apache.commons.net.ftp.FTPFile&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/provider&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;provider class-name=&quot;org.apache.commons.vfs.provider.sftp.SftpFileProvider&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;scheme name=&quot;sftp&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/provider&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;provider class-name=&quot;org.apache.commons.vfs.provider.http.HttpFileProvider&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;scheme name=&quot;http&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/provider&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;provider class-name=&quot;org.apache.commons.vfs.provider.https.HttpsFileProvider&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;scheme name=&quot;https&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/provider&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;provider class-name=&quot;org.apache.commons.vfs.provider.jar.JarFileProvider&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;scheme name=&quot;jar&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/provider&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/providers&amp;gt;&lt;/p&gt;</comment>
                            <comment id="14876611" author="simon04" created="Fri, 18 Sep 2015 22:40:43 +0000"  >&lt;p&gt;Problem still persists. To test&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StandardFileSystemManager fs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardFileSystemManager();
        fs.setCacheStrategy(CacheStrategy.ON_CALL);
        fs.init();
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri = &lt;span class=&quot;code-quote&quot;&gt;&quot;jar:/path/to/a/jar.jar!META-INF/MANIFEST.MF&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; fs.resolveFile(uri, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileSystemOptions()).getContent().getSize() &amp;gt; 0;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I attached Didier&apos;s fix as a patch to be applied.&lt;/p&gt;</comment>
                            <comment id="14904699" author="b.eckenfels" created="Wed, 23 Sep 2015 15:49:06 +0000"  >&lt;p&gt;commited in &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1704885&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1704885&lt;/a&gt;&lt;br/&gt;
I also added a similar fix to the verifying file selector which is used by testing (in anticipation of testing with oncall)&lt;/p&gt;

&lt;p&gt;thanks didier and simon&lt;/p&gt;</comment>
                            <comment id="14904717" author="b.eckenfels" created="Wed, 23 Sep 2015 15:59:49 +0000"  >&lt;p&gt;the org.apache.commons.vfs2.provider.local.LocalFileSystem.doReplicateFile(FileObject, FileSelector) is overwriting the more general case. It looks like it is expected that you use the replicate() function of the filesystem your file is located on. fileObject.getFilesystem().replicat(fileObject, SELF). Not cleanly documented I think. But the patch does at least improve the tolerance a bit.&lt;/p&gt;</comment>
                            <comment id="15291875" author="b.eckenfels" created="Thu, 19 May 2016 18:26:30 +0000"  >&lt;p&gt;Apache Commons VFS 2.1 has been released. It includes this (total 171) resolved issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12445039">VFS-295</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12417000" name="LocalFileSystem.java" size="3124" author="earith" created="Wed, 19 Aug 2009 09:42:11 +0000"/>
                            <attachment id="12761212" name="VFS-279.patch" size="1149" author="simon04" created="Fri, 18 Sep 2015 22:40:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>200326</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1g8lj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302986</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>