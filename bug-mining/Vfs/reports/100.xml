<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-426] HTTP URL query string not part of cache key</title>
                <link>https://issues.apache.org/jira/browse/VFS-426</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;I am using commons-vfs amongst other things to download http files. When resolving different URLs where only the query string differs, the default cache returns the wrong URL sometimes (returning a previously accessed URL where only the query string differs).&lt;/p&gt;

&lt;p&gt;I think this is because the key property of URLFileName does not include the query string. The &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;createURI()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; method of URLFileName does include it, but when constructing the key the &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;createURI(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; useAbsolutePath, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; usePassword)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; method of AbstractFileName is used. This method only includes the path. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12596392">VFS-426</key>
            <summary>HTTP URL query string not part of cache key</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="daniel.bergholm@keybroker.com">Daniel Bergholm</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Jun 2012 12:46:49 +0000</created>
                <updated>Thu, 19 May 2016 18:26:11 +0000</updated>
                            <resolved>Tue, 3 Jul 2012 20:39:00 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13403962" author="garydgregory" created="Fri, 29 Jun 2012 15:17:10 +0000"  >&lt;p&gt;Daniel,&lt;/p&gt;

&lt;p&gt;Can you provide a unit test or example?&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="13404167" author="daniel.bergholm@keybroker.com" created="Fri, 29 Jun 2012 20:16:24 +0000"  >&lt;p&gt;Certainly:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void shouldResolveUrls() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileSystemException {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; firstUrl = &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//commons.apache.org/vfs&quot;&lt;/span&gt;;
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; secondUrl = &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//commons.apache.org/vfs?query=string&quot;&lt;/span&gt;;
&lt;/span&gt;
        FileSystemManager fileSystemManager = VFS.getManager();

        FileObject firstResult = fileSystemManager.resolveFile(firstUrl);
        assertEquals(firstUrl, firstResult.getURL().toExternalForm());

        FileObject secondResult = fileSystemManager.resolveFile(secondUrl);
        assertEquals(secondUrl, secondResult.getURL().toExternalForm()); &lt;span class=&quot;code-comment&quot;&gt;// fails
&lt;/span&gt;}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13404228" author="daniel.bergholm@keybroker.com" created="Fri, 29 Jun 2012 21:26:51 +0000"  >&lt;p&gt;My workaround is to use a FileSystemManager with a NullFilesCache (Spring bean declaration):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileSystemManager&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.vfs2.impl.StandardFileSystemManager&quot;&lt;/span&gt; init-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;init&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;filesCache&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.vfs2.cache.NullFilesCache&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Of course this workaround might not be good enough in cases where the performance hit of not using a cache is a problem. &lt;/p&gt;


&lt;p&gt;I think a fix for this bug would be to use &lt;tt&gt;org.apache.commons.vfs2.provider.AbstractFileName#createURI&lt;/tt&gt; (which is then overriden in this case by &lt;tt&gt;org.apache.commons.vfs2.provider.URLFileName#createURI()&lt;/tt&gt;) when creating the key in &lt;tt&gt;org.apache.commons.vfs2.provider.AbstractFileName#getKey()&lt;/tt&gt;, since the key is then used in &lt;tt&gt;org.apache.commons.vfs2.provider.AbstractFileName#equals(Object o)&lt;/tt&gt; and &lt;tt&gt;org.apache.commons.vfs2.provider.AbstractFileName#hashCode()&lt;/tt&gt;, which are then used in cache implementations (such as HashMaps)&lt;/p&gt;</comment>
                            <comment id="13404493" author="garydgregory" created="Sat, 30 Jun 2012 13:32:23 +0000"  >&lt;p&gt;I added the following test case to illustrate the issue:&lt;/p&gt;

&lt;p&gt;org.apache.commons.vfs2.provider.http.test.HttpFilesCacheTestCase&lt;/p&gt;

&lt;p&gt;Changing &lt;tt&gt;org.apache.commons.vfs2.provider.AbstractFileName#getKey(&lt;/tt&gt; to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getKey()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            key = createURI();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; key;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;or better:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getKey()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            key = getURI();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; key;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;does work for the new test case and no other test fails.&lt;/p&gt;

&lt;p&gt;Note that this can make the &lt;tt&gt;key&lt;/tt&gt; and the &lt;tt&gt;uri&lt;/tt&gt; ivars the same depending on the implementation of &lt;tt&gt;createURI()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Does anyone see a problem with this?&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;I&apos;ll wait a day or so for comments before committing.&lt;/b&gt;&lt;/p&gt;
</comment>
                            <comment id="13404748" author="garydgregory" created="Sun, 1 Jul 2012 15:38:21 +0000"  >&lt;p&gt;Proposed fix and test.&lt;/p&gt;</comment>
                            <comment id="13406018" author="garydgregory" created="Tue, 3 Jul 2012 20:39:00 +0000"  >&lt;p&gt;commit -m &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/VFS-426&quot; title=&quot;HTTP URL query string not part of cache key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;VFS-426&quot;&gt;&lt;del&gt;VFS-426&lt;/del&gt;&lt;/a&gt; HTTP URL query string not part of cache key &quot; C:/svn/org/apache/commons/trunks-proper/vfs/src/changes/changes.xml C:/svn/org/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/http/test/HttpFilesCacheTestCase.java C:/svn/org/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileName.java&lt;br/&gt;
    Sending        C:/svn/org/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileName.java&lt;br/&gt;
    Sending        C:/svn/org/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/http/test/HttpFilesCacheTestCase.java&lt;br/&gt;
    Sending        C:/svn/org/apache/commons/trunks-proper/vfs/src/changes/changes.xml&lt;br/&gt;
    Transmitting file data ...&lt;br/&gt;
    Committed revision 1356923.&lt;/p&gt;</comment>
                            <comment id="15291818" author="b.eckenfels" created="Thu, 19 May 2016 18:26:11 +0000"  >&lt;p&gt;Apache Commons VFS 2.1 has been released. It includes this (total 171) resolved issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12534162" name="vfs-426.diff" size="1629" author="ggregory" created="Sun, 1 Jul 2012 15:38:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244204</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05k4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30357</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>