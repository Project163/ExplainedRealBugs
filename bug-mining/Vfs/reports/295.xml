<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:15:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-833] Make constructor FileSystemOptions(Map) public</title>
                <link>https://issues.apache.org/jira/browse/VFS-833</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;&lt;b&gt;Problem:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The map `org.apache.commons.vfs2.FileSystemOptions#options` is TreeMap. The datastructure is&#160; not thread-safe and resulting in situations like &lt;a href=&quot;https://ivoanjo.me/blog/2018/07/21/writing-to-a-java-treemap-concurrently-can-lead-to-an-infinite-loop-during-reads/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt;&#160; when used in multithreaded environments.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Workaround:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;As a workaround, we have to synchronize the `FileSystemOptions` in all the places of the code.&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution:&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&#160;If there is no issue, the constructor `&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;protected FileSystemOptions(Map&amp;lt;FileSystemOptionKey, Object&amp;gt; options)` can be made public, so that users will have an option to pass a synchronized map when they have to. * Or, wrap the `TreeMap` instance with `java.util.Collections#synchronizedMap`, ensuring thread safety at the core.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13529555">VFS-833</key>
            <summary>Make constructor FileSystemOptions(Map) public</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kannangce">Kannan Ramamoorthy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Mar 2023 07:39:44 +0000</created>
                <updated>Fri, 24 Mar 2023 13:02:32 +0000</updated>
                            <resolved>Fri, 24 Mar 2023 13:02:32 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17703793" author="b.eckenfels" created="Wed, 22 Mar 2023 20:52:16 +0000"  >&lt;p&gt;Thanks for the report. Can you give an example when this actually happens - I.e. who changes why fs options. This does not really work very well since they are part of the Idendity of a filesystem instance. So I would say most of the time they have to be immutable. At least this is what VFS assumes why it does not synchronize. Maybe it&#8217;s enough if we do a defensive copy?&lt;/p&gt;</comment>
                            <comment id="17704140" author="garydgregory" created="Thu, 23 Mar 2023 13:14:06 +0000"  >&lt;p&gt;I would be OK with making the Map ctor public but you should not expect VFS to be thread-safe, it was not designed with thread-safety in mind, and while some changes have been made over time to make some corners of the code thread-safe, most of it is not. IOW, unless something is documented as thread-safe, assume it is not.&lt;/p&gt;

&lt;p&gt;The blog post seems pointless since TreeMap is documented as thread-unsafe, from the TreeMap Javadoc (in Java 8) and it&apos;s been documented as such since Java 1.2 (when TreeMap was introduced):&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
&lt;font color=&quot;#808080&quot;&gt; * &lt;/font&gt;&lt;font color=&quot;#1e789b&quot;&gt;&amp;lt;p&amp;gt;&amp;lt;strong&amp;gt;&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;Note that this implementation is not synchronized.&lt;/font&gt;&lt;font color=&quot;#1e789b&quot;&gt;&amp;lt;/strong&amp;gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * If multiple threads access a map concurrently, and at least one of the&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * threads modifies the map structurally, it &lt;/font&gt;&lt;font color=&quot;#1e789b&quot;&gt;&amp;lt;em&amp;gt;&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;must&lt;/font&gt;&lt;font color=&quot;#1e789b&quot;&gt;&amp;lt;/em&amp;gt;&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt; be synchronized&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * externally. (A structural modification is any operation that adds or&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * deletes one or more mappings; merely changing the value associated&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * with an existing key is not a structural modification.) This is&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * typically accomplished by synchronizing on some object that naturally&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * encapsulates the map.&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * If no such object exists, the map should be &quot;wrapped&quot; using the&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * &lt;/font&gt;&lt;font color=&quot;#a99c8c&quot;&gt;{@link Collections#synchronizedSortedMap Collections.synchronizedSortedMap}&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * method. This is best done at creation time, to prevent accidental&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * unsynchronized access to the map: &lt;/font&gt;&lt;font color=&quot;#1e789b&quot;&gt;&amp;lt;pre&amp;gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt; * SortedMap m = Collections.synchronizedSortedMap(new TreeMap(...));&lt;/font&gt;&lt;font color=&quot;#1e789b&quot;&gt;&amp;lt;/pre&amp;gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17704597" author="garydgregory" created="Fri, 24 Mar 2023 13:02:32 +0000"  >&lt;p&gt;In git master and the snapshot repository.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1grg0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>