<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:13:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-172] Cache of SFTP after move completely out of sync.</title>
                <link>https://issues.apache.org/jira/browse/VFS-172</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;Simple test method. See all the bogus cases at the end:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testObjectsAfterMoveOfParentDoNotExistWithSFTP() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
	{
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileSystemOptions fsOptions = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileSystemOptions();
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileSystemManager fsManager = VFS.getManager();
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject root = fsManager.resolveFile(SFTP_BASE_URL + &lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, fsOptions);
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!root.exists()) {
			root.createFolder();
		}

		assertTrue(root.exists());

		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject target = root.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!target.exists()) {
			target.createFolder();
		}

		assertTrue(target.exists());

		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject work = root.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;work&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!work.exists()) {
			work.createFolder();
		}

		assertTrue(work.exists());

		FileObject inWork = work.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;inWork&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!inWork.exists()) {
			inWork.createFolder();
		}

		assertTrue(inWork.exists());

		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject ready = target.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;ready-&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis());
		assertFalse(ready.exists());

		work.moveTo(ready);
		assertTrue(ready.exists());
		assertFalse(work.exists());

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			assertFalse(inWork.exists());
			fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Thrown &quot;&lt;/span&gt; + AssertionFailedError.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; expected, because of buggy implementation&quot;&lt;/span&gt;);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AssertionFailedError e) {
			&lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;sigh&amp;gt;
&lt;/span&gt;		}

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			inWork.refresh();
			assertFalse(inWork.exists());
			fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Thrown &quot;&lt;/span&gt; + AssertionFailedError.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; expected, because of buggy implementation&quot;&lt;/span&gt;);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AssertionFailedError e) {
			&lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;sigh&amp;gt;
&lt;/span&gt;		}

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			assertFalse(work.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;inWork&quot;&lt;/span&gt;).exists());
			fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Thrown &quot;&lt;/span&gt; + AssertionFailedError.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; expected, because of buggy implementation&quot;&lt;/span&gt;);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AssertionFailedError e) {
			&lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;sigh&amp;gt;
&lt;/span&gt;		}

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			work.refresh();
			assertFalse(work.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;inWork&quot;&lt;/span&gt;).exists());
			fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Thrown &quot;&lt;/span&gt; + AssertionFailedError.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; expected, because of buggy implementation&quot;&lt;/span&gt;);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AssertionFailedError e) {
			&lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;sigh&amp;gt;
&lt;/span&gt;		}
		
		&lt;span class=&quot;code-comment&quot;&gt;// it even possible to write into a file of the non-existing folder ...
&lt;/span&gt;		FileObject file = inWork.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;test.txt&quot;&lt;/span&gt;);
		OutputStream out = file.getContent().getOutputStream();
		out.write(&lt;span class=&quot;code-quote&quot;&gt;&quot;Foo&quot;&lt;/span&gt;.getBytes());
		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			out.close();
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(IOException e) {
			&lt;span class=&quot;code-comment&quot;&gt;// ignore &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;		}		
		assertTrue(file.exists());

		&lt;span class=&quot;code-comment&quot;&gt;// force update of references
&lt;/span&gt;		file = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
		out = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
		inWork = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.gc();
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.gc();
		&lt;span class=&quot;code-comment&quot;&gt;// ... aaaaahhhh ... something changed
&lt;/span&gt;		assertFalse(work.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;inWork&quot;&lt;/span&gt;).exists());
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There&apos;s not a single possibility to tell VFS that the FileObject is bogus and even worse, you can write into non-existing files of a non-existing folder without getting an Exception ...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12375681">VFS-172</key>
            <summary>Cache of SFTP after move completely out of sync.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="imario">Mario Ivankovits</assignee>
                                    <reporter username="joehni">Joerg Schaible</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Aug 2007 15:06:27 +0000</created>
                <updated>Sun, 16 Jun 2019 18:43:43 +0000</updated>
                            <resolved>Fri, 10 Aug 2007 18:32:33 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12518921" author="joehni" created="Fri, 10 Aug 2007 06:34:38 +0000"  >&lt;p&gt;It seems that the main problem is not the VFS code itself, but the usage of the jCraft library. Even after the following sequence the assert fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;		work.moveTo(ready);
		assertTrue(ready.exists());
		assertFalse(work.exists());
		
		fsManager.close();
		fsManager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardFileSystemManager();
		fsManager.init();
		root = fsManager.resolveFile(SFTP_BASE_URL + &lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, fsOptions);
		work = root.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;work&quot;&lt;/span&gt;);

		assertFalse(work.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;inWork&quot;&lt;/span&gt;).exists());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tried this with com.jcraft:jsch-0.1.23 and the current version com.jcraft:jsch-0.1.31. It seems that jsch keeps also a cache that is not reseted.&lt;/p&gt;</comment>
                            <comment id="12518936" author="joehni" created="Fri, 10 Aug 2007 07:51:55 +0000"  >&lt;p&gt;After some debugging I realized that the SftFileObject will never refresh itself. Main cause is that - even if it is detached - it keeps it&apos;s attribs. Unfortunately the implementation assumes that it is a real file as long as the attribs are available. My patch resets now the attribs in doDispatch. This solves the problem in the following test case (the caching strategy forces a refresh calling resolveFile):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testObjectsAfterMoveOfParentDoNotExistWithSFTP() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
	{
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileSystemOptions fsOptions = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileSystemOptions();
		StandardFileSystemManager fsManager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardFileSystemManager();
		fsManager.init();
		FileObject root = fsManager.resolveFile(SFTP_BASE_URL + &lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, fsOptions);
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!root.exists()) {
			root.createFolder();
		}

		assertTrue(root.exists());

		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject target = root.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!target.exists()) {
			target.createFolder();
		}

		assertTrue(target.exists());

		FileObject work = root.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;work&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!work.exists()) {
			work.createFolder();
		}

		assertTrue(work.exists());

		FileObject inWork = work.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;inWork&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!inWork.exists()) {
			inWork.createFolder();
		}

		assertTrue(inWork.exists());

		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject ready = target.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;ready-&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis());
		assertFalse(ready.exists());

		work.moveTo(ready);
		assertTrue(ready.exists());
		assertFalse(work.exists());
		&lt;span class=&quot;code-comment&quot;&gt;// resolve forces internal refresh
&lt;/span&gt;		assertFalse(work.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;inWork&quot;&lt;/span&gt;).exists());
		assertFalse(inWork.exists());
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, I was not able to run any of the unit tests, they are not found with M2. So I have no idea if the patch has side effects.&lt;/p&gt;</comment>
                            <comment id="12519085" author="imario" created="Fri, 10 Aug 2007 18:32:33 +0000"  >&lt;p&gt;Applied - Thanks for the patch!&lt;br/&gt;
Also implemented the refresh() method now to make the CachePolicy work with sftp too.&lt;/p&gt;

&lt;p&gt;Test case still works, so it looks good to me.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13226854">VFS-698</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12363562" name="VFS-172.diff" size="607" author="joehni" created="Fri, 10 Aug 2007 07:51:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>200230</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 16 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i138nz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227034</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>