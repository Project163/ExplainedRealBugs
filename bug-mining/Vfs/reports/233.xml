<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:15:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-733] Parent layer of ZipFileSystem set to null through OnCallRefreshFileObject and DecoratedFileObject.refresh()</title>
                <link>https://issues.apache.org/jira/browse/VFS-733</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;When using &lt;tt&gt;FileObject#exists&lt;/tt&gt; and &lt;tt&gt;FileObject#getContent&lt;/tt&gt; on a ZIP file (in any order), the reference to the parent file system is set to &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileObject zippedFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OnCallRefreshFileObject(fileInZip());
assertNotNull(zippedFile.getFileSystem().getParentLayer());

zippedFile.exists();
zippedFile.getContent();

assertNotNull(zippedFile.getFileSystem().getParentLayer()); &lt;span class=&quot;code-comment&quot;&gt;// fails&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For an executable example, refer to &lt;a href=&quot;https://github.com/f4lco/vfs-repro/blob/master/src/test/java/vfs/ZipParentLayerTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/f4lco/vfs-repro/blob/master/src/test/java/vfs/ZipParentLayerTest.java&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I come to believe this does not work as intended. I&apos;m also relatively clueless about a potential fix or workaround. For me, this bug blocks upgrading from VFS 2.1.&lt;/p&gt;


</description>
                <environment></environment>
        <key id="13260551">VFS-733</key>
            <summary>Parent layer of ZipFileSystem set to null through OnCallRefreshFileObject and DecoratedFileObject.refresh()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="falcod">Falco</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Oct 2019 10:45:33 +0000</created>
                <updated>Tue, 8 Oct 2019 16:17:59 +0000</updated>
                            <resolved>Mon, 7 Oct 2019 15:46:59 +0000</resolved>
                                    <version>2.2</version>
                    <version>2.4</version>
                    <version>2.3</version>
                    <version>2.4.1</version>
                                    <fixVersion>2.5.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16945184" author="garydgregory" created="Sat, 5 Oct 2019 23:44:17 +0000"  >&lt;p&gt;Please see the new (failing and ignored) unit test &lt;tt&gt;org.apache.commons.vfs2.provider.zip.Jira733TestCase&lt;/tt&gt;. You or anyone willing to help can test any PRs based on this test and the whole build.&lt;/p&gt;

&lt;p&gt;The simplest way I found to fix this test and allow the whole build to pass of course, is to not clear the &lt;tt&gt;FileObject&lt;/tt&gt;&#160;for the parent layer, which seems OK at first glance since closing other {{FileObject}}s &lt;em&gt;should&lt;/em&gt; be done elsewhere in VFS or in application code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;
diff --git a/commons-vfs2/dummy.txt b/commons-vfs2/dummy.txt
new file mode 100644
index 0000000..47d2739
--- /dev/null
+++ b/commons-vfs2/dummy.txt
@@ -0,0 +1 @@
+new content
\ No newline at end of file
diff --git a/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/AbstractFileSystem.java b/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/AbstractFileSystem.java
index 8132328..6f538e5 100644
--- a/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/AbstractFileSystem.java
+++ b/commons-vfs2/src/main/java/org/apache/commons/vfs2/provider/AbstractFileSystem.java
@@ -123,8 +123,6 @@
     @Override
     public void close() {
         closeCommunicationLink();
-
-        parentLayer = null;
     }
 
     /**
diff --git a/commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/zip/Jira733TestCase.java b/commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/zip/Jira733TestCase.java
index 84d03e2..6d6f73f 100644
--- a/commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/zip/Jira733TestCase.java
+++ b/commons-vfs2/src/test/java/org/apache/commons/vfs2/provider/zip/Jira733TestCase.java
@@ -30,7 +30,6 @@
 import org.junit.Ignore;
 import org.junit.Test;
 
-@Ignore
 public class Jira733TestCase {
 
     @After
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Either:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this fix is fine since we have no unit test failures as I mentioned, including the new test I added.&lt;/li&gt;
	&lt;li&gt;this fix is not fine but we do not know because our unit tests are missing a use case.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Anyone care to opine?&lt;/p&gt;

&lt;p&gt;Gary&lt;br/&gt;
 &#160;&lt;/p&gt;</comment>
                            <comment id="16945554" author="kinow" created="Mon, 7 Oct 2019 02:44:02 +0000"  >&lt;p&gt;Don&apos;t know the component and its codebase well enough to have a good opinion on whether it&apos;s safe to remove it or not. But at least looking at the git blame with GitHub&apos;s interface, it doesn&apos;t seem to have been added to fix a security bug.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-vfs/commit/5e5a5eaeba244bde97283135ee3f6d1730850563&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-vfs/commit/5e5a5eaeba244bde97283135ee3f6d1730850563&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The commit message seems to be related to GC collection for soft references. But given other class attributes are not set to null, maybe it that line where parentLayer is set to null could be removed. I wonder if it could also be made a `private final FileObject` as the `rootName`?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16945976" author="garydgregory" created="Mon, 7 Oct 2019 15:46:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=falcod&quot; class=&quot;user-hover&quot; rel=&quot;falcod&quot;&gt;falcod&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;In git master. Please verify and close.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16946978" author="falcod" created="Tue, 8 Oct 2019 15:23:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; Looks good to me. You may want to un-ignore&#160;&lt;tt&gt;org.apache.commons.vfs2.provider.zip.Jira733TestCase&lt;/tt&gt;, it&apos;s passing now.&lt;/p&gt;</comment>
                            <comment id="16947030" author="garydgregory" created="Tue, 8 Oct 2019 16:17:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=falcod&quot; class=&quot;user-hover&quot; rel=&quot;falcod&quot;&gt;falcod&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oops, I forgot to enable that test indeed. Fixed!&lt;/p&gt;

&lt;p&gt;Thank you!&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07amg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>