<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:14:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VFS-620] FileObject.moveTo(FileObject) API doesn&apos;t work well for a Linux FTP</title>
                <link>https://issues.apache.org/jira/browse/VFS-620</link>
                <project id="12310495" key="VFS">Commons VFS</project>
                    <description>&lt;p&gt;FileObject.moveTo(FileObject) API doesn&apos;t work well for a Linux FTP, especially for setting a user directory as its root directory case,&lt;br/&gt;
For example, for a ubuntu vsftpd, which is having &quot;/home/user1&quot; as its root directory, when renaming &quot;/test/test.txt&quot; to &quot;/test1/test1.txt&quot;, it will throw an exception.&lt;br/&gt;
In this case, it should consider the workingDirectory(would be &quot;/home/user1&quot;) together and append it to the from/to path to make the API work.&lt;/p&gt;

&lt;p&gt;Sample codes,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FileObject fileObject = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        FileObject toFileObject = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            StandardFileSystemManager fsManager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardFileSystemManager();
            fsManager.init();
            FileSystemOptions fsOpts = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileSystemOptions();

            FtpFileSystemConfigBuilder.getInstance().setPassiveMode(fsOpts, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            FtpFileSystemConfigBuilder.getInstance().setUserDirIsRoot(fsOpts, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            UserAuthenticator auth = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StaticUserAuthenticator(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;user&amp;gt;&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;password&amp;gt;&quot;&lt;/span&gt;);
            DefaultFileSystemConfigBuilder.getInstance().setUserAuthenticator(fsOpts, auth);

            fileObject = fsManager.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;ftp:&lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;Replaced address&amp;gt;/test/test.txt&quot;&lt;/span&gt;, fsOpts);
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;File exists:&quot;&lt;/span&gt; + fileObject.exists());

            toFileObject = fsManager.resolveFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;ftp:&lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;Replaced address&amp;gt;/test1/test1.txt&quot;&lt;/span&gt;, fsOpts);
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;File exists:&quot;&lt;/span&gt; + toFileObject.exists());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!toFileObject.exists()) {
                toFileObject.createFile();
            }
            fileObject.moveTo(toFileObject);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FileSystemException ex) {
            ex.printStackTrace();
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fileObject != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    fileObject.close();
                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FileSystemException ex) {
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (toFileObject != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    toFileObject.close();
                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FileSystemException ex) {
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And the output,&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;File exists:true
File exists:false
org.apache.commons.vfs2.FileSystemException: Could not rename &quot;ftp://&amp;lt;Replaced address&amp;gt;/test/test.txt&quot; to &quot;ftp://&amp;lt;Replaced address&amp;gt;/test1/test1.txt&quot;.
	at org.apache.commons.vfs2.provider.AbstractFileObject.moveTo(AbstractFileObject.java:1902)
	at TestFTP.main(TestFTP.java:59)
Caused by: org.apache.commons.vfs2.FileSystemException: Could not rename FTP file &quot;ftp://&amp;lt;Replaced address&amp;gt;/test/test.txt&quot; to &quot;ftp://&amp;lt;Replaced address&amp;gt;/test1/test1.txt&quot;.
	at org.apache.commons.vfs2.provider.ftp.FtpFileObject.doRename(FtpFileObject.java:524)
	at org.apache.commons.vfs2.provider.AbstractFileObject.moveTo(AbstractFileObject.java:1887)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;ubuntu vsftpd&lt;/p&gt;</environment>
        <key id="12994076">VFS-620</key>
            <summary>FileObject.moveTo(FileObject) API doesn&apos;t work well for a Linux FTP</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stevezhuang">stevezhuang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Aug 2016 20:01:13 +0000</created>
                <updated>Sun, 19 Mar 2017 08:52:17 +0000</updated>
                            <resolved>Sun, 19 Mar 2017 08:52:17 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.2</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15402725" author="stevezhuang" created="Mon, 1 Aug 2016 20:05:29 +0000"  >&lt;p&gt;Suggested fix,&lt;/p&gt;

&lt;p&gt;In the FtpClient.java, adding a new interface,&lt;br/&gt;
String printWorkingDirectory() throws IOException; &lt;/p&gt;

&lt;p&gt;Then in the FTPClientWrapper.java,&lt;br/&gt;
@Override &lt;br/&gt;
 public String printWorkingDirectory() throws IOException  &lt;br/&gt;
 { &lt;br/&gt;
    return getFtpClient().printWorkingDirectory(); &lt;br/&gt;
} &lt;/p&gt;

&lt;p&gt;private String remoteAbsolutePath(String path) throws IOException  &lt;br/&gt;
{&lt;br/&gt;
    String workingDir = printWorkingDirectory(); &lt;br/&gt;
    if (&quot;/&quot;.equals(workingDir)) &lt;/p&gt;
{ 
        return path; 
    }
&lt;p&gt;    return workingDir + path; &lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;@Override&lt;br/&gt;
    public boolean rename(final String oldName, final String newName) throws IOException&lt;br/&gt;
    {&lt;br/&gt;
        try&lt;/p&gt;
        {
            return getFtpClient().rename(remoteAbsolutePath(oldName), remoteAbsolutePath(newName));
        }
&lt;p&gt;        catch (final IOException e)&lt;/p&gt;
        {
            disconnect();
            return getFtpClient().rename(remoteAbsolutePath(oldName), remoteAbsolutePath(newName));
        }
&lt;p&gt;    }&lt;/p&gt;</comment>
                            <comment id="15402736" author="b.eckenfels" created="Mon, 1 Aug 2016 20:15:29 +0000"  >&lt;p&gt;It Looks to me the URLs are wrong. If the files are in /home/user1 you must speficy the full path Name in the URL. VFS has no Support for relative directories (in URLs) (unfortunatelly).&lt;/p&gt;

&lt;p&gt;(However if the path for the source is correct (the test Output somehow suggests that as the source exists) maybe the Problem is more on the destionation side and has nothign to do with the home Directory. Can you check the Server logfile what command it rejected (and why)?.&lt;/p&gt;

&lt;p&gt;Is the target (parent) Directory existing and writeable?&lt;/p&gt;</comment>
                            <comment id="15402912" author="stevezhuang" created="Mon, 1 Aug 2016 22:09:19 +0000"  >&lt;p&gt;Hi Bernd,&lt;/p&gt;

&lt;p&gt;Thanks for your checking/replying.&lt;/p&gt;

&lt;p&gt;The URLs are correct because the FileObject could be returned and operated. &lt;br/&gt;
And the target Directory is writable (if not existing, it will be created). &lt;br/&gt;
Actually it will work correctly if applying my suggested fix. &lt;/p&gt;

&lt;p&gt;I believe it would be an issue related to the &quot;UserDirIsRoot&quot; setting, VFS didn&apos;t handle it well when doing the rename.&lt;/p&gt;

&lt;p&gt;Best wishes,&lt;br/&gt;
Steve&lt;/p&gt;


</comment>
                            <comment id="15895200" author="svella" created="Fri, 3 Mar 2017 23:00:25 +0000"  >&lt;p&gt;I just ran into this with UserDirIsRoot=true. When stepping through it, it looks to me like the problem is in FtpFileObject.doRename():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; oldName = getName().getPath();
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; newName = newFile.getName().getPath();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; oldName = relPath;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; newName = ((FtpFileObject)FileObjectUtils.getAbstractFileObject(newFile)).getRelPath();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll submit a patch if I have time before someone actually gets to this.&lt;/p&gt;</comment>
                            <comment id="15900317" author="svella" created="Tue, 7 Mar 2017 22:34:34 +0000"  >&lt;p&gt;This appears to be a duplicate of both &lt;a href=&quot;https://issues.apache.org/jira/browse/VFS-188&quot; title=&quot;Rename does not work with some FTP servers that do not provide directory listings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;VFS-188&quot;&gt;VFS-188&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/VFS-292&quot; title=&quot;FTP: rename command effectively uses absolute paths which is incorrect in case of USER_DIR_IS_ROOT=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;VFS-292&quot;&gt;VFS-292&lt;/a&gt;, both of which had patches submitted last decade without so much as an acknowledgment, though neither patch is exactly right, in that they don&apos;t account for the possibility of a decorator on the source FileObject no include an updated test case. Here is a new patch &lt;a href=&quot;https://issues.apache.org/jira/browse/VFS-620&quot; title=&quot;FileObject.moveTo(FileObject) API doesn&amp;#39;t work well for a Linux FTP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;VFS-620&quot;&gt;&lt;del&gt;VFS-620&lt;/del&gt;&lt;/a&gt;.patch that accounts for that and adds in a test case that causes the entire suite being run against the FTP provider to be run both with and without the UserDirIsRoot option.&lt;/p&gt;</comment>
                            <comment id="15906486" author="garydgregory" created="Sun, 12 Mar 2017 10:39:52 +0000"  >&lt;p&gt;Thank you for the patch.&lt;/p&gt;

&lt;p&gt;I&apos;ll take a look this week unless someone else gets there first.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15907015" author="garydgregory" created="Mon, 13 Mar 2017 08:42:25 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;If I apply only the &lt;em&gt;test changes&lt;/em&gt; from the patch, then all the tests in &lt;tt&gt;org.apache.commons.vfs2.provider.ftp.test&lt;/tt&gt; pass.&lt;/p&gt;

&lt;p&gt;This tells me that the tests do not demonstrate that something is broken, so I do cannot be sure that the changes in main actually fix anything.&lt;/p&gt;

&lt;p&gt;Can you write a test that fails to show that changes in main are required?&lt;/p&gt;</comment>
                            <comment id="15924521" author="svella" created="Tue, 14 Mar 2017 16:32:30 +0000"  >&lt;p&gt;Updated patch.&lt;br/&gt;
Sorry about that. My original version of the added tests were failing without the update to the provider, but then before I submitted, I refactored the tests to minimize the changes and forgot to retest the original failure with the new tests and it turns out that I missed a few things in the refactored tests that were causing it to run the tests without the userDirIsRoot flag set.&lt;/p&gt;</comment>
                            <comment id="15926789" author="garydgregory" created="Wed, 15 Mar 2017 19:14:46 +0000"  >&lt;p&gt;Hi Shon,&lt;/p&gt;

&lt;p&gt;The patch does not compile. For example:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    protected String getFtpRootDir()
+    {
+        return return new File(getTestDirectory(), &quot;homeDirIsRoot&quot;).getPath();
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15926815" author="svella" created="Wed, 15 Mar 2017 19:31:12 +0000"  >&lt;p&gt;Sorry - I guess that what I get for trying to copy and paste the changes into the existing patch instead of doing a new diff from the sources that are working for me. Updated patch uploaded.&lt;/p&gt;
</comment>
                            <comment id="15931617" author="garydgregory" created="Sun, 19 Mar 2017 08:52:17 +0000"  >&lt;p&gt;Please verify and close.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit -m &quot;[VFS-620] FileObject.moveTo(FileObject) API doesn&apos;t work well for a Linux FTP.&quot; -N C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/ftp/FtpFileObject.java C:/vcs/svn/apache/commons/trunks-proper/vfs/src/changes/changes.xml C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/ftp/test/FtpProviderTestCase.java C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/ftp/test/FtpProviderUserDirTestCase.java C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/ftp/test/MultipleConnectionTestCase.java
    Sending        C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/main/java/org/apache/commons/vfs2/provider/ftp/FtpFileObject.java
    Sending        C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/ftp/test/FtpProviderTestCase.java
    Adding         C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/ftp/test/FtpProviderUserDirTestCase.java
    Sending        C:/vcs/svn/apache/commons/trunks-proper/vfs/core/src/test/java/org/apache/commons/vfs2/provider/ftp/test/MultipleConnectionTestCase.java
    Sending        C:/vcs/svn/apache/commons/trunks-proper/vfs/src/changes/changes.xml
    Transmitting file data ...
    Unknown action received: commit finalizing
    Committed revision 1787594.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I applied the patch with one small change to formatting.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12443788">VFS-292</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12385298">VFS-188</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12858936" name="VFS-620c.patch" size="9065" author="svella" created="Wed, 15 Mar 2017 19:31:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31rnj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>