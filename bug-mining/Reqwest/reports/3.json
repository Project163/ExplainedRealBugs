{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/82","repository_url":"https://api.github.com/repos/seanmonstar/reqwest","labels_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/82/labels{/name}","comments_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/82/comments","events_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/82/events","html_url":"https://github.com/seanmonstar/reqwest/issues/82","id":226592332,"node_id":"MDU6SXNzdWUyMjY1OTIzMzI=","number":82,"title":"Panic in Client::head with automatic GZIP decompression","user":{"login":"GyrosOfWar","id":739170,"node_id":"MDQ6VXNlcjczOTE3MA==","avatar_url":"https://avatars.githubusercontent.com/u/739170?v=4","gravatar_id":"","url":"https://api.github.com/users/GyrosOfWar","html_url":"https://github.com/GyrosOfWar","followers_url":"https://api.github.com/users/GyrosOfWar/followers","following_url":"https://api.github.com/users/GyrosOfWar/following{/other_user}","gists_url":"https://api.github.com/users/GyrosOfWar/gists{/gist_id}","starred_url":"https://api.github.com/users/GyrosOfWar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GyrosOfWar/subscriptions","organizations_url":"https://api.github.com/users/GyrosOfWar/orgs","repos_url":"https://api.github.com/users/GyrosOfWar/repos","events_url":"https://api.github.com/users/GyrosOfWar/events{/privacy}","received_events_url":"https://api.github.com/users/GyrosOfWar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2017-05-05T14:33:43Z","updated_at":"2017-05-05T19:51:24Z","closed_at":"2017-05-05T19:51:24Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When using `reqwest::Client` to make a HEAD request with GZIP decompression enabled (which is the default), a panic happens in the library.\r\n\r\nCode to reproduce:\r\n```rust\r\nuse reqwest::Client;\r\nfn main() {\r\n    let url = \"https://www.google.com/\";\r\n    let client = Client::new().unwrap();\r\n    client.head(url).send();\r\n}\r\n```\r\n\r\nBacktrace:\r\n```\r\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Error { repr: Custom(Custom { kind: UnexpectedEof, error: StringError(\"failed to fill whole buffer\") }) }', /checkout/src/libcore/result.rs:859\r\nstack backtrace:\r\n   0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace\r\n             at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::_print\r\n             at /checkout/src/libstd/sys_common/backtrace.rs:71\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at /checkout/src/libstd/sys_common/backtrace.rs:60\r\n             at /checkout/src/libstd/panicking.rs:355\r\n   3: std::panicking::default_hook\r\n             at /checkout/src/libstd/panicking.rs:371\r\n   4: std::panicking::rust_panic_with_hook\r\n             at /checkout/src/libstd/panicking.rs:549\r\n   5: std::panicking::begin_panic\r\n             at /checkout/src/libstd/panicking.rs:511\r\n   6: std::panicking::begin_panic_fmt\r\n             at /checkout/src/libstd/panicking.rs:495\r\n   7: rust_begin_unwind\r\n             at /checkout/src/libstd/panicking.rs:471\r\n   8: core::panicking::panic_fmt\r\n             at /checkout/src/libcore/panicking.rs:69\r\n   9: core::result::unwrap_failed\r\n             at /checkout/src/libcore/macros.rs:29\r\n  10: <core::result::Result<T, E>>::unwrap\r\n             at /checkout/src/libcore/result.rs:737\r\n  11: reqwest::client::Decoder::from_hyper_response\r\n             at /home/martin/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.5.1/src/client.rs:458\r\n  12: reqwest::client::RequestBuilder::send\r\n             at /home/martin/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.5.1/src/client.rs:331\r\n  13: main::bug_repro\r\n             at ./src/main.rs:41\r\n  14: main::main\r\n             at ./src/main.rs:47\r\n  15: std::panicking::try::do_call\r\n             at /checkout/src/libstd/panicking.rs:454\r\n  16: __rust_maybe_catch_panic\r\n             at /checkout/src/libpanic_unwind/lib.rs:98\r\n  17: std::rt::lang_start\r\n             at /checkout/src/libstd/panicking.rs:433\r\n             at /checkout/src/libstd/panic.rs:361\r\n             at /checkout/src/libstd/rt.rs:57\r\n  18: main\r\n  19: __libc_start_main\r\n  20: _start\r\n```\r\nHere's the debug log: [log.txt](https://github.com/seanmonstar/reqwest/files/979368/log.txt)\r\nWhen I disable automatic decompression (`client.gzip(false)`), it works fine. ","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/82/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/82/timeline","performed_via_github_app":null,"state_reason":"completed"}