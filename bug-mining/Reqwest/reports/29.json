{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/407","repository_url":"https://api.github.com/repos/seanmonstar/reqwest","labels_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/407/labels{/name}","comments_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/407/comments","events_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/407/events","html_url":"https://github.com/seanmonstar/reqwest/issues/407","id":393691025,"node_id":"MDU6SXNzdWUzOTM2OTEwMjU=","number":407,"title":"RequestBuilder headers() method behaviour different than header() with multiple values for same key","user":{"login":"scullionw","id":11668344,"node_id":"MDQ6VXNlcjExNjY4MzQ0","avatar_url":"https://avatars.githubusercontent.com/u/11668344?v=4","gravatar_id":"","url":"https://api.github.com/users/scullionw","html_url":"https://github.com/scullionw","followers_url":"https://api.github.com/users/scullionw/followers","following_url":"https://api.github.com/users/scullionw/following{/other_user}","gists_url":"https://api.github.com/users/scullionw/gists{/gist_id}","starred_url":"https://api.github.com/users/scullionw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scullionw/subscriptions","organizations_url":"https://api.github.com/users/scullionw/orgs","repos_url":"https://api.github.com/users/scullionw/repos","events_url":"https://api.github.com/users/scullionw/events{/privacy}","received_events_url":"https://api.github.com/users/scullionw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":401213509,"node_id":"MDU6TGFiZWw0MDEyMTM1MDk=","url":"https://api.github.com/repos/seanmonstar/reqwest/labels/C-bug","name":"C-bug","color":"ee0701","default":false,"description":"Category: bug. Something is wrong. This is bad!"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-12-22T17:44:17Z","updated_at":"2019-01-03T20:29:48Z","closed_at":"2019-01-03T20:29:48Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When adding headers through headers() one at a time all keys are properly set. However when constructing a HeaderMap beforehand and adding it using headers(), only one value from a certain key is kept.\r\n\r\nIs this the desired behaviour? It surprised me and took a while to debug until I echoed the full request that was actually sent.\r\n\r\nCaused by using insert() in headers() and append() in header().\r\n\r\nhttps://github.com/seanmonstar/reqwest/blob/c4985674aaa1cd23ec70ee7dfc24c76b714285c5/src/request.rs#L192\r\n\r\nhttps://github.com/seanmonstar/reqwest/blob/c4985674aaa1cd23ec70ee7dfc24c76b714285c5/src/request.rs#L151\r\n\r\n\r\nEDIT: Apparently even when I append manually, they are removed when sending. Seems like its impossible to send multiple headers.\r\n\r\nhttps://github.com/seanmonstar/reqwest/blob/c4985674aaa1cd23ec70ee7dfc24c76b714285c5/src/async_impl/client.rs#L452\r\n\r\n\r\nThese examples are then broken because they would never be sent:\r\nhttps://docs.rs/reqwest/0.9.5/reqwest/header/struct.HeaderMap.html#method.append\r\n\r\nIn that example, only \"earth\" is actually sent in the network request.\r\n\r\n`GET / HTTP/1.1\r\nuser-agent: reqwest/0.9.5\r\naccept: */*\r\nhost: earth\r\naccept-encoding: gzip`","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/407/timeline","performed_via_github_app":null,"state_reason":"completed"}