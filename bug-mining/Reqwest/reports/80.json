{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/1462","repository_url":"https://api.github.com/repos/seanmonstar/reqwest","labels_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/1462/labels{/name}","comments_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/1462/comments","events_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/1462/events","html_url":"https://github.com/seanmonstar/reqwest/issues/1462","id":1127245844,"node_id":"I_kwDOA7dkLM5DMGgU","number":1462,"title":"error decoding response body: deflate decompression error for garagehq.deuxfleurs.fr","user":{"login":"kevincox","id":494012,"node_id":"MDQ6VXNlcjQ5NDAxMg==","avatar_url":"https://avatars.githubusercontent.com/u/494012?v=4","gravatar_id":"","url":"https://api.github.com/users/kevincox","html_url":"https://github.com/kevincox","followers_url":"https://api.github.com/users/kevincox/followers","following_url":"https://api.github.com/users/kevincox/following{/other_user}","gists_url":"https://api.github.com/users/kevincox/gists{/gist_id}","starred_url":"https://api.github.com/users/kevincox/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kevincox/subscriptions","organizations_url":"https://api.github.com/users/kevincox/orgs","repos_url":"https://api.github.com/users/kevincox/repos","events_url":"https://api.github.com/users/kevincox/events{/privacy}","received_events_url":"https://api.github.com/users/kevincox/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2022-02-08T13:17:34Z","updated_at":"2023-08-23T15:49:55Z","closed_at":"2023-08-08T17:33:47Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When trying to download content from garagehq.deuxfleurs.fr I get the following error when reading the request body:\r\n\r\n> Error downloading feed: error decoding response body: deflate decompression error\r\n\r\nreqwest version: 0.11.9 features `[\"brotli\", \"deflate\", \"gzip\", \"json\", \"multipart\", \"rustls-tls-native-roots\", \"trust-dns\"]`, hyper version: 0.14.16\r\n\r\nLogs for request of https://garagehq.deuxfleurs.fr/rss.xml\r\n\r\n```rust\r\n[src/feeds.rs:191] &client = Client {\r\n    accepts: Accepts {\r\n        gzip: true,\r\n        brotli: true,\r\n        deflate: true,\r\n    },\r\n    proxies: [\r\n        Proxy(\r\n            System(\r\n                {},\r\n            ),\r\n            None,\r\n        ),\r\n    ],\r\n    referer: true,\r\n    default_headers: {\r\n        \"accept\": \"*/*\",\r\n        \"user-agent\": \"feedmail.org/0\",\r\n    },\r\n    timeout: 600s,\r\n}\r\n[src/feeds.rs:195] &req = RequestBuilder {\r\n    method: GET,\r\n    url: Url {\r\n        scheme: \"https\",\r\n        cannot_be_a_base: false,\r\n        username: \"\",\r\n        password: None,\r\n        host: Some(\r\n            Domain(\r\n                \"garagehq.deuxfleurs.fr\",\r\n            ),\r\n        ),\r\n        port: None,\r\n        path: \"/rss.xml\",\r\n        query: None,\r\n        fragment: None,\r\n    },\r\n    headers: {\r\n        \"accept\": \"application/atom+xml,application/rss+xml,text/html\",\r\n    },\r\n}\r\n[src/feeds.rs:204] res.headers() = {\r\n    \"content-type\": \"text/xml; charset=utf-8\",\r\n    \"last-modified\": \"Mon, 07 Feb 2022 15:14:37 GMT\",\r\n    \"accept-ranges\": \"bytes\",\r\n    \"etag\": \"\\\"152840837968ef47c827a8954ca42d44\\\"\",\r\n    \"date\": \"Tue, 08 Feb 2022 12:55:10 GMT\",\r\n}\r\n```\r\n\r\nInterestingly I can't see any `Content-Encoding` headers. Maybe they are stripped by hyper or reqwest before I can see them?\r\n\r\nThe website itself appears to support deflate, gzip and zstd compression which curl can read just fine.\r\n\r\n```\r\ncurl -v --compressed -Haccept-encoding:deflate https://garagehq.deuxfleurs.fr/rss.xml\r\ncurl -v --compressed -Haccept-encoding:gzip https://garagehq.deuxfleurs.fr/rss.xml\r\ncurl -v --compressed -Haccept-encoding:zstd https://garagehq.deuxfleurs.fr/rss.xml\r\n```\r\n\r\nThe server appears to have a server-side preference for zstd, then deflate. So it does make sense that the deflate content was being returned.\r\n\r\n```\r\n% curl -v --compressed -Haccept-encoding:br,gzip,deflate https://garagehq.deuxfleurs.fr/rss.xml\r\n...\r\n< content-encoding: deflate\r\n```\r\n\r\n## Minimal Working Example\r\n\r\nCreate run the following program:\r\n\r\n```rust\r\nfn main() {\r\n\tlet res = reqwest::blocking::get(\"https://garagehq.deuxfleurs.fr/rss.xml\").unwrap();\r\n\tdbg!(&res);\r\n\tlet body = res.text().unwrap();\r\n\tdbg!(&body);\r\n}\r\n```\r\n\r\nIt succeeds without the `deflate` feature and fails when `deflate` is added. Note that my full program is using the async interface.\r\n\r\n```\r\n[src/main.rs:3] &res = Response {\r\n    url: Url {\r\n        scheme: \"https\",\r\n        cannot_be_a_base: false,\r\n        username: \"\",\r\n        password: None,\r\n        host: Some(\r\n            Domain(\r\n                \"garagehq.deuxfleurs.fr\",\r\n            ),\r\n        ),\r\n        port: None,\r\n        path: \"/rss.xml\",\r\n        query: None,\r\n        fragment: None,\r\n    },\r\n    status: 200,\r\n    headers: {\r\n        \"content-type\": \"text/xml; charset=utf-8\",\r\n        \"last-modified\": \"Mon, 07 Feb 2022 15:14:37 GMT\",\r\n        \"accept-ranges\": \"bytes\",\r\n        \"etag\": \"\\\"152840837968ef47c827a8954ca42d44\\\"\",\r\n        \"date\": \"Tue, 08 Feb 2022 13:15:17 GMT\",\r\n        \"transfer-encoding\": \"chunked\",\r\n    },\r\n}\r\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: reqwest::Error { kind: Decode, source: Custom { kind: Other, error: DecompressError(General { msg: None }) } }', src/main.rs:4:27\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/1462/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/1462/timeline","performed_via_github_app":null,"state_reason":"completed"}