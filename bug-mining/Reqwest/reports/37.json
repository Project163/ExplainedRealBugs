{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/484","repository_url":"https://api.github.com/repos/seanmonstar/reqwest","labels_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/484/labels{/name}","comments_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/484/comments","events_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/484/events","html_url":"https://github.com/seanmonstar/reqwest/issues/484","id":427419414,"node_id":"MDU6SXNzdWU0Mjc0MTk0MTQ=","number":484,"title":"Reqwest panic due to invalid uri on redirects","user":{"login":"Alvenix","id":5764299,"node_id":"MDQ6VXNlcjU3NjQyOTk=","avatar_url":"https://avatars.githubusercontent.com/u/5764299?v=4","gravatar_id":"","url":"https://api.github.com/users/Alvenix","html_url":"https://github.com/Alvenix","followers_url":"https://api.github.com/users/Alvenix/followers","following_url":"https://api.github.com/users/Alvenix/following{/other_user}","gists_url":"https://api.github.com/users/Alvenix/gists{/gist_id}","starred_url":"https://api.github.com/users/Alvenix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Alvenix/subscriptions","organizations_url":"https://api.github.com/users/Alvenix/orgs","repos_url":"https://api.github.com/users/Alvenix/repos","events_url":"https://api.github.com/users/Alvenix/events{/privacy}","received_events_url":"https://api.github.com/users/Alvenix/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-03-31T17:12:28Z","updated_at":"2019-04-01T18:13:01Z","closed_at":"2019-04-01T18:13:01Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The following code panics due to InvalidUri(InvalidUriChar) even though the URL is valid.\r\n\r\nOpening the URL on the browser it turns out that the page redirect to \"http://www.eishockey.at{request_uri}/\" which may be actually invalid which may cause the panic.\r\n\r\n```\r\n#[macro_use]\r\nextern crate error_chain;\r\n\r\nerror_chain! {\r\n    foreign_links {\r\n        Reqwest(reqwest::Error);\r\n    }\r\n}\r\n\r\nfn main() -> Result<()> {\r\n    // This panics\r\n    let body = reqwest::get(\"http://eishockey.at\")?.text()?;\r\n\r\n    // This does not panic because the redirect does not happen\r\n    //let body = reqwest::get(\"http://www.eishockey.at\")?.text()?;\r\n\r\n    println!(\"body = {:?}\", body);\r\n\r\n    Ok(())\r\n}\r\n```\r\n\r\nThe backtrace is as follows:\r\n```\r\nthread 'reqwest-internal-sync-runtime' panicked at 'a parsed Url should always be a valid Uri: InvalidUri(InvalidUriChar)', src/libcore/result.rs:997:5\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:39\r\n   1: std::sys_common::backtrace::_print\r\n             at src/libstd/sys_common/backtrace.rs:70\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/sys_common/backtrace.rs:58\r\n             at src/libstd/panicking.rs:200\r\n   3: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:215\r\n   4: std::panicking::rust_panic_with_hook\r\n             at src/libstd/panicking.rs:478\r\n   5: std::panicking::continue_panic_fmt\r\n             at src/libstd/panicking.rs:385\r\n   6: rust_begin_unwind\r\n             at src/libstd/panicking.rs:312\r\n   7: core::panicking::panic_fmt\r\n             at src/libcore/panicking.rs:85\r\n   8: core::result::unwrap_failed\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libcore/macros.rs:16\r\n   9: <core::result::Result<T, E>>::expect\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libcore/result.rs:825\r\n  10: reqwest::into_url::to_uri\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/into_url.rs:42\r\n  11: <reqwest::async_impl::client::PendingRequest as futures::future::Future>::poll\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/async_impl/client.rs:736\r\n  12: <reqwest::async_impl::client::Pending as futures::future::Future>::poll\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/async_impl/client.rs:661\r\n  13: reqwest::client::ClientHandle::new::{{closure}}::{{closure}}::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/client.rs:562\r\n  14: <futures::future::poll_fn::PollFn<F> as futures::future::Future>::poll\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/future/poll_fn.rs:43\r\n  15: <alloc::boxed::Box<F> as futures::future::Future>::poll\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/future/mod.rs:113\r\n  16: <futures::task_impl::Spawn<T>>::poll_future_notify::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:326\r\n  17: <futures::task_impl::Spawn<T>>::enter::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:396\r\n  18: futures::task_impl::std::set\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/std/mod.rs:78\r\n  19: <futures::task_impl::Spawn<T>>::enter\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:396\r\n  20: <futures::task_impl::Spawn<T>>::poll_fn_notify\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:288\r\n  21: <futures::task_impl::Spawn<T>>::poll_future_notify\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:326\r\n  22: <tokio_current_thread::scheduler::Scheduled<'a, U>>::tick\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/scheduler.rs:351\r\n  23: <tokio_current_thread::scheduler::Scheduler<U>>::tick::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/scheduler.rs:330\r\n  24: <tokio_current_thread::Borrow<'a, U>>::enter::{{closure}}::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/lib.rs:788\r\n  25: tokio_current_thread::CurrentRunner::set_spawn\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/lib.rs:825\r\n  26: <tokio_current_thread::Borrow<'a, U>>::enter::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/lib.rs:788\r\n  27: <std::thread::local::LocalKey<T>>::try_with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:299\r\n  28: <std::thread::local::LocalKey<T>>::with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:245\r\n  29: <tokio_current_thread::Borrow<'a, U>>::enter\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/lib.rs:786\r\n  30: <tokio_current_thread::scheduler::Scheduler<U>>::tick\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/scheduler.rs:330\r\n  31: <tokio_current_thread::Entered<'a, P>>::tick\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/lib.rs:612\r\n  32: <tokio_current_thread::Entered<'a, P>>::block_on\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-current-thread-0.1.6/src/lib.rs:502\r\n  33: tokio::runtime::current_thread::runtime::Runtime::block_on::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.1.18/src/runtime/current_thread/runtime.rs:200\r\n  34: tokio::runtime::current_thread::runtime::Runtime::enter::{{closure}}::{{closure}}::{{closure}}::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.1.18/src/runtime/current_thread/runtime.rs:241\r\n  35: tokio_executor::global::with_default::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-executor-0.1.7/src/global.rs:209\r\n  36: <std::thread::local::LocalKey<T>>::try_with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:299\r\n  37: <std::thread::local::LocalKey<T>>::with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:245\r\n  38: tokio_executor::global::with_default\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-executor-0.1.7/src/global.rs:178\r\n  39: tokio::runtime::current_thread::runtime::Runtime::enter::{{closure}}::{{closure}}::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.1.18/src/runtime/current_thread/runtime.rs:239\r\n  40: tokio_timer::timer::handle::with_default::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-timer-0.2.10/src/timer/handle.rs:94\r\n  41: <std::thread::local::LocalKey<T>>::try_with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:299\r\n  42: <std::thread::local::LocalKey<T>>::with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:245\r\n  43: tokio_timer::timer::handle::with_default\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-timer-0.2.10/src/timer/handle.rs:81\r\n  44: tokio::runtime::current_thread::runtime::Runtime::enter::{{closure}}::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.1.18/src/runtime/current_thread/runtime.rs:232\r\n  45: tokio_timer::clock::clock::with_default::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-timer-0.2.10/src/clock/clock.rs:141\r\n  46: <std::thread::local::LocalKey<T>>::try_with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:299\r\n  47: <std::thread::local::LocalKey<T>>::with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:245\r\n  48: tokio_timer::clock::clock::with_default\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-timer-0.2.10/src/clock/clock.rs:124\r\n  49: tokio::runtime::current_thread::runtime::Runtime::enter::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.1.18/src/runtime/current_thread/runtime.rs:231\r\n  50: tokio_reactor::with_default::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-reactor-0.1.9/src/lib.rs:237\r\n  51: <std::thread::local::LocalKey<T>>::try_with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:299\r\n  52: <std::thread::local::LocalKey<T>>::with\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/thread/local.rs:245\r\n  53: tokio_reactor::with_default\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-reactor-0.1.9/src/lib.rs:217\r\n  54: tokio::runtime::current_thread::runtime::Runtime::enter\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.1.18/src/runtime/current_thread/runtime.rs:230\r\n  55: tokio::runtime::current_thread::runtime::Runtime::block_on\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-0.1.18/src/runtime/current_thread/runtime.rs:198\r\n  56: reqwest::client::ClientHandle::new::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/client.rs:581\r\nthread 'main' panicked at 'event loop thread panicked', /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/client.rs:665:5\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:39\r\n   1: std::sys_common::backtrace::_print\r\n             at src/libstd/sys_common/backtrace.rs:70\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/sys_common/backtrace.rs:58\r\n             at src/libstd/panicking.rs:200\r\n   3: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:215\r\n   4: std::panicking::rust_panic_with_hook\r\n             at src/libstd/panicking.rs:478\r\n   5: std::panicking::begin_panic\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/panicking.rs:412\r\n   6: reqwest::client::event_loop_panicked\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/client.rs:665\r\n   7: reqwest::client::ClientHandle::execute_request::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/client.rs:622\r\n   8: <core::result::Result<T, E>>::map_err\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libcore/result.rs:520\r\n   9: <futures::future::map_err::MapErr<A, F> as futures::future::Future>::poll\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/future/map_err.rs:34\r\n  10: <futures::future::join::MaybeDone<A>>::poll\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/future/join.rs:153\r\n  11: <futures::future::join::Join<A, B> as futures::future::Future>::poll\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/future/join.rs:75\r\n  12: <futures::future::map::Map<A, F> as futures::future::Future>::poll\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/future/map.rs:30\r\n  13: <futures::task_impl::Spawn<T>>::poll_future_notify::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:326\r\n  14: <futures::task_impl::Spawn<T>>::enter::{{closure}}\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:396\r\n  15: futures::task_impl::std::set\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/std/mod.rs:78\r\n  16: <futures::task_impl::Spawn<T>>::enter\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:396\r\n  17: <futures::task_impl::Spawn<T>>::poll_fn_notify\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:288\r\n  18: <futures::task_impl::Spawn<T>>::poll_future_notify\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.25/src/task_impl/mod.rs:326\r\n  19: reqwest::wait::timeout\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/wait.rs:23\r\n  20: reqwest::client::ClientHandle::execute_request\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/client.rs:626\r\n  21: reqwest::client::Client::execute\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/client.rs:477\r\n  22: reqwest::request::RequestBuilder::send\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/request.rs:502\r\n  23: reqwest::get\r\n             at /home/abdullah/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.9.12/src/lib.rs:301\r\n  24: reqwest_test::main\r\n             at src/main.rs:12\r\n  25: std::rt::lang_start::{{closure}}\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/rt.rs:64\r\n  26: std::panicking::try::do_call\r\n             at src/libstd/rt.rs:49\r\n             at src/libstd/panicking.rs:297\r\n  27: __rust_maybe_catch_panic\r\n             at src/libpanic_unwind/lib.rs:92\r\n  28: std::rt::lang_start_internal\r\n             at src/libstd/panicking.rs:276\r\n             at src/libstd/panic.rs:388\r\n             at src/libstd/rt.rs:48\r\n  29: std::rt::lang_start\r\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libstd/rt.rs:64\r\n  30: main\r\n  31: __libc_start_main\r\n  32: _start\r\n\r\n```","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/484/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/484/timeline","performed_via_github_app":null,"state_reason":"completed"}