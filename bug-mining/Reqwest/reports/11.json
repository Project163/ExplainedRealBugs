{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/171","repository_url":"https://api.github.com/repos/seanmonstar/reqwest","labels_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/171/labels{/name}","comments_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/171/comments","events_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/171/events","html_url":"https://github.com/seanmonstar/reqwest/issues/171","id":245031105,"node_id":"MDU6SXNzdWUyNDUwMzExMDU=","number":171,"title":"Panic in redirect::remove_sensitive_headers with Authorization header set using struct","user":{"login":"gyng","id":370496,"node_id":"MDQ6VXNlcjM3MDQ5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/370496?v=4","gravatar_id":"","url":"https://api.github.com/users/gyng","html_url":"https://github.com/gyng","followers_url":"https://api.github.com/users/gyng/followers","following_url":"https://api.github.com/users/gyng/following{/other_user}","gists_url":"https://api.github.com/users/gyng/gists{/gist_id}","starred_url":"https://api.github.com/users/gyng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyng/subscriptions","organizations_url":"https://api.github.com/users/gyng/orgs","repos_url":"https://api.github.com/users/gyng/repos","events_url":"https://api.github.com/users/gyng/events{/privacy}","received_events_url":"https://api.github.com/users/gyng/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":626770011,"node_id":"MDU6TGFiZWw2MjY3NzAwMTE=","url":"https://api.github.com/repos/seanmonstar/reqwest/labels/B-upstream","name":"B-upstream","color":"1d76db","default":false,"description":"Blocked: upstream. Depends on a dependency to make a change first."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-07-24T10:05:28Z","updated_at":"2017-07-25T01:17:19Z","closed_at":"2017-07-25T01:17:19Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm getting a panic in `redirect::remove_sensitive_headers` when I make a request to `http://google.com` with an Authorization header set using a `Basic` struct on reqwest 0.7.1.\r\n\r\nCode:\r\n\r\n```rust\r\nextern crate reqwest;\r\n\r\nfn main() {\r\n    let mut headers = reqwest::header::Headers::new();\r\n    // headers.set(reqwest::header::Authorization(\"letmein\".to_owned())); // this is okay\r\n    headers.set(reqwest::header::Authorization(reqwest::header::Basic {\r\n        username: \"username\".to_string(),\r\n        password: Some(\"password\".to_string()),\r\n    }));\r\n\r\n    reqwest::Client::new()\r\n        .expect(\"failed to make client\")\r\n        .get(\"http://google.com\") // redirects\r\n        .expect(\"failed to add get\")\r\n        .headers(headers)\r\n        .send()\r\n        .expect(\"failed to send\");\r\n}\r\n```\r\n\r\nBacktrace:\r\n```\r\n➜  panics git:(master) ✗ RUST_BACKTRACE=1 cargo run\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs\r\n     Running `target/debug/panics`\r\nthread 'reqwest-internal-sync-core' panicked at 'item.raw must exist', src/libcore/option.rs:794\r\nstack backtrace:\r\n   0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace\r\n   1: std::panicking::default_hook::{{closure}}\r\n   2: std::panicking::default_hook\r\n   3: std::panicking::rust_panic_with_hook\r\n   4: std::panicking::begin_panic\r\n   5: std::panicking::begin_panic_fmt\r\n   6: rust_begin_unwind\r\n   7: core::panicking::panic_fmt\r\n   8: core::option::expect_failed\r\n   9: <core::option::Option<T>>::expect\r\n  10: hyper::header::internals::item::Item::into_typed\r\n  11: core::ops::FnOnce::call_once\r\n  12: <core::option::Option<T>>::and_then\r\n  13: hyper::header::Headers::remove\r\n  14: reqwest::redirect::remove_sensitive_headers\r\n  15: <reqwest::async_impl::client::Pending as futures::future::Future>::poll\r\n  16: <futures::future::chain::Chain<A, B, C>>::poll\r\n  17: <futures::future::then::Then<A, B, F> as futures::future::Future>::poll\r\n  18: <alloc::boxed::Box<F> as futures::future::Future>::poll\r\n  19: <futures::task_impl::Spawn<F>>::poll_future_notify::{{closure}}\r\n  20: <futures::task_impl::Spawn<T>>::enter::{{closure}}\r\n  21: futures::task_impl::std::set\r\n  22: <futures::task_impl::Spawn<T>>::enter\r\n  23: <futures::task_impl::Spawn<F>>::poll_future_notify\r\n  24: tokio_core::reactor::Core::dispatch_task::{{closure}}\r\n  25: <scoped_tls::ScopedKey<T>>::set\r\n  26: tokio_core::reactor::Core::dispatch_task\r\n  27: tokio_core::reactor::Core::dispatch\r\n  28: tokio_core::reactor::Core::poll\r\n  29: tokio_core::reactor::Core::run\r\n  30: reqwest::client::ClientHandle::new::{{closure}}\r\n  31: <std::panic::AssertUnwindSafe<F> as core::ops::FnOnce<()>>::call_once\r\n  32: std::panicking::try::do_call\r\n  33: __rust_maybe_catch_panic\r\n  34: std::panicking::try\r\n  35: std::panic::catch_unwind\r\n  36: std::thread::Builder::spawn::{{closure}}\r\n  37: <F as alloc::boxed::FnBox<A>>::call_box\r\n  38: std::sys::imp::thread::Thread::new::thread_start\r\n  39: _pthread_body\r\n  40: _pthread_start\r\nthread 'main' panicked at 'core thread panicked', /Users/_/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.7.1/src/client.rs:392\r\nstack backtrace:\r\n   0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace\r\n   1: std::panicking::default_hook::{{closure}}\r\n   2: std::panicking::default_hook\r\n   3: std::panicking::rust_panic_with_hook\r\n   4: std::panicking::begin_panic\r\n   5: reqwest::client::ClientHandle::execute_request\r\n   6: reqwest::client::Client::execute\r\n   7: reqwest::request::RequestBuilder::send\r\n   8: panics::main\r\n   9: __rust_maybe_catch_panic\r\n  10: std::rt::lang_start\r\n  11: main\r\n  ```\r\n","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/seanmonstar/reqwest/issues/171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/seanmonstar/reqwest/issues/171/timeline","performed_via_github_app":null,"state_reason":"completed"}