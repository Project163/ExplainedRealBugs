{"url":"https://api.github.com/repos/App-vNext/Polly/issues/1732","repository_url":"https://api.github.com/repos/App-vNext/Polly","labels_url":"https://api.github.com/repos/App-vNext/Polly/issues/1732/labels{/name}","comments_url":"https://api.github.com/repos/App-vNext/Polly/issues/1732/comments","events_url":"https://api.github.com/repos/App-vNext/Polly/issues/1732/events","html_url":"https://github.com/App-vNext/Polly/issues/1732","id":1964687217,"node_id":"I_kwDOAJaD5s51Gr9x","number":1732,"title":"[Feature request]: AOT compatibility","user":{"login":"davidfowl","id":95136,"node_id":"MDQ6VXNlcjk1MTM2","avatar_url":"https://avatars.githubusercontent.com/u/95136?v=4","gravatar_id":"","url":"https://api.github.com/users/davidfowl","html_url":"https://github.com/davidfowl","followers_url":"https://api.github.com/users/davidfowl/followers","following_url":"https://api.github.com/users/davidfowl/following{/other_user}","gists_url":"https://api.github.com/users/davidfowl/gists{/gist_id}","starred_url":"https://api.github.com/users/davidfowl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidfowl/subscriptions","organizations_url":"https://api.github.com/users/davidfowl/orgs","repos_url":"https://api.github.com/users/davidfowl/repos","events_url":"https://api.github.com/users/davidfowl/events{/privacy}","received_events_url":"https://api.github.com/users/davidfowl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1747848886,"node_id":"MDU6TGFiZWwxNzQ3ODQ4ODg2","url":"https://api.github.com/repos/App-vNext/Polly/labels/feature%20suggestion","name":"feature suggestion","color":"0052cc","default":false,"description":""},{"id":6140126801,"node_id":"LA_kwDOAJaD5s8AAAABbfrmUQ","url":"https://api.github.com/repos/App-vNext/Polly/labels/aot","name":"aot","color":"5FCFE4","default":false,"description":"Relates to native AoT support"}],"state":"closed","locked":false,"assignee":{"login":"martincostello","id":1439341,"node_id":"MDQ6VXNlcjE0MzkzNDE=","avatar_url":"https://avatars.githubusercontent.com/u/1439341?v=4","gravatar_id":"","url":"https://api.github.com/users/martincostello","html_url":"https://github.com/martincostello","followers_url":"https://api.github.com/users/martincostello/followers","following_url":"https://api.github.com/users/martincostello/following{/other_user}","gists_url":"https://api.github.com/users/martincostello/gists{/gist_id}","starred_url":"https://api.github.com/users/martincostello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martincostello/subscriptions","organizations_url":"https://api.github.com/users/martincostello/orgs","repos_url":"https://api.github.com/users/martincostello/repos","events_url":"https://api.github.com/users/martincostello/events{/privacy}","received_events_url":"https://api.github.com/users/martincostello/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"martincostello","id":1439341,"node_id":"MDQ6VXNlcjE0MzkzNDE=","avatar_url":"https://avatars.githubusercontent.com/u/1439341?v=4","gravatar_id":"","url":"https://api.github.com/users/martincostello","html_url":"https://github.com/martincostello","followers_url":"https://api.github.com/users/martincostello/followers","following_url":"https://api.github.com/users/martincostello/following{/other_user}","gists_url":"https://api.github.com/users/martincostello/gists{/gist_id}","starred_url":"https://api.github.com/users/martincostello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martincostello/subscriptions","organizations_url":"https://api.github.com/users/martincostello/orgs","repos_url":"https://api.github.com/users/martincostello/repos","events_url":"https://api.github.com/users/martincostello/events{/privacy}","received_events_url":"https://api.github.com/users/martincostello/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/App-vNext/Polly/milestones/45","html_url":"https://github.com/App-vNext/Polly/milestone/45","labels_url":"https://api.github.com/repos/App-vNext/Polly/milestones/45/labels","id":9967205,"node_id":"MI_kwDOAJaD5s4AmBZl","number":45,"title":"v8.1.0","description":"","creator":{"login":"martincostello","id":1439341,"node_id":"MDQ6VXNlcjE0MzkzNDE=","avatar_url":"https://avatars.githubusercontent.com/u/1439341?v=4","gravatar_id":"","url":"https://api.github.com/users/martincostello","html_url":"https://github.com/martincostello","followers_url":"https://api.github.com/users/martincostello/followers","following_url":"https://api.github.com/users/martincostello/following{/other_user}","gists_url":"https://api.github.com/users/martincostello/gists{/gist_id}","starred_url":"https://api.github.com/users/martincostello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martincostello/subscriptions","organizations_url":"https://api.github.com/users/martincostello/orgs","repos_url":"https://api.github.com/users/martincostello/repos","events_url":"https://api.github.com/users/martincostello/events{/privacy}","received_events_url":"https://api.github.com/users/martincostello/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":15,"state":"closed","created_at":"2023-09-26T12:24:34Z","updated_at":"2023-10-31T17:53:47Z","due_on":"2023-10-31T07:00:00Z","closed_at":"2023-10-31T10:55:23Z"},"comments":12,"created_at":"2023-10-27T03:14:05Z","updated_at":"2023-10-31T17:51:12Z","closed_at":"2023-10-30T17:35:33Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Is your feature request related to a specific problem? Or an existing feature?\r\n\r\nPolly is at the core of [Microsoft.Extensions.Http.Resilience](https://github.com/dotnet/extensions/tree/main/src/Libraries/Microsoft.Extensions.Http.Resilience) and we'd like the libraries that depend on this package and polly itself to work in AOT environments.\r\n\r\n### Describe the solution you'd like\r\n\r\nAdd `<IsAotCompatible>true</IsAotCompatible>` to the project files and work through the AOT issues. I've run a project that has a dependency and saw this:\r\n\r\n```\r\n  ILC: Method '[Polly.Core]Polly.Utils.Pipeline.CompositeComponent+DelegatingComponent.ExecuteCore<__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`2<__Canon,__Canon>>>>>>(Func`3<Resi\r\n  lienceContext,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`2<__Canon,__Canon>>>>>,ValueTask`1<Outcome`1<__Canon>>>,ResilienceContext,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__\r\n  Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`2<__Canon,__Canon>>>>>)' will always throw because: Failed to load type 'Polly.Utils.Pipeline.PipelineComponent' from assembly 'Polly.Core, Version=8.0.0.0, Culture=neutral, PublicKeyToken=c8a\r\n  3ffc3f8f825cc'\r\nILC : AOT analysis warning IL3054: Polly.Utils.Pipeline.CompositeComponent.DelegatingComponent.ExecuteCore<__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`2<__Canon,__Canon>>>>>>(Fun\r\nc`3<ResilienceContext,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`2<__Canon,__Canon>>>>>,ValueTask`1<Outcome`1<__Canon>>>,ResilienceContext,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Ca\r\nnon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`2<__Canon,__Canon>>>>>): Generic expansion to 'Polly.Utils.Pipeline.PipelineComponent.ExecuteCore<__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__C\r\nanon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`2<__Canon,__Canon>>>>>>>(Func`3<ResilienceContext,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,\r\nValueTuple`2<__Canon,__Canon>>>>>>,ValueTask`1<Outcome`1<__Canon>>>,ResilienceContext,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`3<__Canon,__Canon,ValueTuple`2<__Canon,__Canon>>>>>>)' w\r\nas aborted due to generic recursion. An exception will be thrown at runtime if this codepath is ever reached. Generic recursion also negatively affects compilation speed and the size of the compilation output. It is advisable to remove the source of the generic recursi\r\non by restructuring the program around the source of recursion. The source of generic recursion might include: 'Polly.Utils.Pipeline.PipelineComponent.ExecuteCore<TResult,TState>(Func`3<ResilienceContext,TState,ValueTask`1<Outcome`1<TResult>>>,ResilienceContext,!!1)',\r\n'Polly.Utils.Pipeline.ComponentWithDisposeCallbacks.ExecuteCore<TResult,TState>(Func`3<ResilienceContext,TState,ValueTask`1<Outcome`1<TResult>>>,ResilienceContext,!!1)', 'Polly.Utils.Pipeline.CompositeComponent.ExecuteCore<TResult,TState>(Func`3<ResilienceContext,TStat\r\ne,ValueTask`1<Outcome`1<TResult>>>,ResilienceContext,!!1)', 'Polly.Utils.Pipeline.CompositeComponent.ExecuteCoreWithoutTelemetry<TResult,TState>(Func`3<ResilienceContext,TState,ValueTask`1<Outcome`1<TResult>>>,ResilienceContext,!!1)', 'Polly.Utils.Pipeline.CompositeCom\r\nponent.ExecuteCoreWithTelemetry<TResult,TState>(Func`3<ResilienceContext,TState,ValueTask`1<Outcome`1<TResult>>>,ResilienceContext,!!1)', 'Polly.Utils.Pipeline.CompositeComponent.<ExecuteCoreWithTelemetry>d__13`2', 'Polly.Utils.Pipeline.ExternalComponent.ExecuteCore<TR\r\nesult,TState>(Func`3<ResilienceContext,TState,ValueTask`1<Outcome`1<TResult>>>,ResilienceContext,!!1)', 'Polly.Utils.Pipeline.ReloadableComponent.ExecuteCore<TResult,TState>(Func`3<ResilienceContext,TState,ValueTask`1<Outcome`1<TResult>>>,ResilienceContext,!!1)', 'Poll\r\ny.Utils.Pipeline.CompositeComponent.DelegatingComponent.ExecuteCore<TResult,TState>(Func`3<ResilienceContext,TState,ValueTask`1<Outcome`1<TResult>>>,ResilienceContext,!!1)', 'Polly.Utils.Pipeline.CompositeComponent.DelegatingComponent.<>c__6`2' [C:\\dev\\git\\eShop\\src\\Or\r\ndering.BackgroundTasks\\Ordering.BackgroundTasks.csproj]\r\n```\r\n\r\ncc @MichalStrehovsky \r\n\r\n### Additional context\r\n\r\n_No response_","closed_by":{"login":"martincostello","id":1439341,"node_id":"MDQ6VXNlcjE0MzkzNDE=","avatar_url":"https://avatars.githubusercontent.com/u/1439341?v=4","gravatar_id":"","url":"https://api.github.com/users/martincostello","html_url":"https://github.com/martincostello","followers_url":"https://api.github.com/users/martincostello/followers","following_url":"https://api.github.com/users/martincostello/following{/other_user}","gists_url":"https://api.github.com/users/martincostello/gists{/gist_id}","starred_url":"https://api.github.com/users/martincostello/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martincostello/subscriptions","organizations_url":"https://api.github.com/users/martincostello/orgs","repos_url":"https://api.github.com/users/martincostello/repos","events_url":"https://api.github.com/users/martincostello/events{/privacy}","received_events_url":"https://api.github.com/users/martincostello/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/App-vNext/Polly/issues/1732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/App-vNext/Polly/issues/1732/timeline","performed_via_github_app":null,"state_reason":"completed"}