<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:15:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VYSPER-342] Access to UTF-8 encoding and decoding is not thread safe</title>
                <link>https://issues.apache.org/jira/browse/VYSPER-342</link>
                <project id="12310930" key="VYSPER">VYSPER</project>
                    <description>&lt;p&gt;Bug was found when testing server with several simultaneous clients connecting at the same time. CharsetDecoder would throw IllegalStateException and Stanza XML parsing would fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12653162">VYSPER-342</key>
            <summary>Access to UTF-8 encoding and decoding is not thread safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brainlounge">Bernd Fondermann</assignee>
                                    <reporter username="mmul">Mikko Multanen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jun 2013 09:45:58 +0000</created>
                <updated>Mon, 17 Jun 2013 12:51:10 +0000</updated>
                            <resolved>Mon, 17 Jun 2013 12:51:10 +0000</resolved>
                                    <version>0.8</version>
                                    <fixVersion>0.8</fixVersion>
                                    <component>core protocol</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13685406" author="mmul" created="Mon, 17 Jun 2013 09:46:57 +0000"  >&lt;p&gt;Patch to fix CharsetUtil thread safety&lt;/p&gt;</comment>
                            <comment id="13685471" author="brainlounge" created="Mon, 17 Jun 2013 11:42:30 +0000"  >&lt;p&gt;thanks for the issue + contribution&lt;br/&gt;
is there a particular reason to use thread locals instead of singletons?&lt;/p&gt;</comment>
                            <comment id="13685473" author="elecharny" created="Mon, 17 Jun 2013 11:54:18 +0000"  >&lt;p&gt;I&apos;m pretty sure that Mikko used ThreadLocal to avoid explicit synchronization. This is smart !&lt;/p&gt;</comment>
                            <comment id="13685482" author="mmul" created="Mon, 17 Jun 2013 12:08:50 +0000"  >&lt;p&gt;Emmanuel is right. I used thread locals to avoid possible performance issues.&lt;/p&gt;</comment>
                            <comment id="13685484" author="brainlounge" created="Mon, 17 Jun 2013 12:10:51 +0000"  >&lt;p&gt;is it? ok, what about my Commit: 013be8be8bc384678afc524c053c8584c24827a4 ?&lt;br/&gt;
it uses synchronization, but avoids locking AFAP, and is a little less code.&lt;/p&gt;</comment>
                            <comment id="13685486" author="brainlounge" created="Mon, 17 Jun 2013 12:12:38 +0000"  >&lt;p&gt;what kind of performance issues? &lt;br/&gt;
at init-time, or at access time?&lt;br/&gt;
can we measure this?&lt;/p&gt;</comment>
                            <comment id="13685488" author="elecharny" created="Mon, 17 Jun 2013 12:16:23 +0000"  >&lt;p&gt;When you have a synchronized block, one single thread can access it. Assuming that the code is CPU intensive, you can quickly make it a bottleneck in your application (This is in theory, it&apos;s not necessarily the case here).&lt;/p&gt;

&lt;p&gt;Using a ThreadLocal just remove this constraint : you will have one instance in each thread, with no sync at all (ThreadLocal storage is done in a Map, not synchronized).&lt;/p&gt;

&lt;p&gt;This is a really good pattern to use in most of the case, especially when the operation is costly. If it&apos;s about incrementing a counter, of course, that would be dumb...&lt;/p&gt;

&lt;p&gt;Makes me think that most of the SimpleDateFormat instances should also be stored in ThreadLocal...&lt;/p&gt;</comment>
                            <comment id="13685499" author="mmul" created="Mon, 17 Jun 2013 12:33:41 +0000"  >&lt;p&gt;CharsetDecoder and CharsetEncoder are not thread safe so to avoid concurrency issues I used thread locals. This way each thread gets it&apos;s own decoder and encoder. Synchronizing UTF8.newDecoder() does not prevent two threads calling decoder.decode at the same time, which was the original issue. If you like to use synchronization then all calls to decoder.decode and encoder.encode should be in synchronized blocks.&lt;/p&gt;</comment>
                            <comment id="13685504" author="brainlounge" created="Mon, 17 Jun 2013 12:38:20 +0000"  >&lt;p&gt;yep, I roughly know what &quot;synchronized&quot; does. however, my code referenced above will only run into blocking until the singleton is initialized once, maybe overriding the singleton when other threads are waiting to enter the synchronized block.&lt;/p&gt;</comment>
                            <comment id="13685508" author="brainlounge" created="Mon, 17 Jun 2013 12:45:01 +0000"  >&lt;p&gt;@Mikko: ok, got it now. I&apos;m reinstating your original patch.&lt;/p&gt;</comment>
                            <comment id="13685514" author="brainlounge" created="Mon, 17 Jun 2013 12:51:10 +0000"  >&lt;p&gt;patch applied. thanks for contributing!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12588123" name="fix_charset_util.patch" size="15017" author="mmul" created="Mon, 17 Jun 2013 09:46:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333485</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lj13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333813</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>