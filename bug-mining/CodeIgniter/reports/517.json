{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5605","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5605/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5605/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5605/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/5605","id":363952342,"node_id":"MDU6SXNzdWUzNjM5NTIzNDI=","number":5605,"title":"Array passes form validation for string element with the same name + fix","user":{"login":"Stanzi1791","id":6654587,"node_id":"MDQ6VXNlcjY2NTQ1ODc=","avatar_url":"https://avatars.githubusercontent.com/u/6654587?v=4","gravatar_id":"","url":"https://api.github.com/users/Stanzi1791","html_url":"https://github.com/Stanzi1791","followers_url":"https://api.github.com/users/Stanzi1791/followers","following_url":"https://api.github.com/users/Stanzi1791/following{/other_user}","gists_url":"https://api.github.com/users/Stanzi1791/gists{/gist_id}","starred_url":"https://api.github.com/users/Stanzi1791/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stanzi1791/subscriptions","organizations_url":"https://api.github.com/users/Stanzi1791/orgs","repos_url":"https://api.github.com/users/Stanzi1791/repos","events_url":"https://api.github.com/users/Stanzi1791/events{/privacy}","received_events_url":"https://api.github.com/users/Stanzi1791/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":140924,"node_id":"MDU6TGFiZWwxNDA5MjQ=","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/labels/Bug","name":"Bug","color":"eb2420","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/21","html_url":"https://github.com/bcit-ci/CodeIgniter/milestone/21","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/21/labels","id":3427519,"node_id":"MDk6TWlsZXN0b25lMzQyNzUxOQ==","number":21,"title":"3.1.10","description":"","creator":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":16,"state":"closed","created_at":"2018-06-15T10:50:51Z","updated_at":"2019-01-31T16:41:01Z","due_on":null,"closed_at":"2019-01-31T16:41:01Z"},"comments":10,"created_at":"2018-09-26T10:11:14Z","updated_at":"2019-01-04T12:51:40Z","closed_at":"2018-12-27T16:45:51Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I've set up form validation for (amongst other fields) a text input box with the name \"cms\", this is in my application\\config\\form_validation.php file:\r\n\r\n    // ...\r\n\r\n        array(\r\n            'field' =>  'cms',\r\n            'label' =>  'CMS',\r\n            'rules' =>  'is_natural_no_zero' \r\n        ),\r\n\r\n    // ...\r\n\r\nIf I use a regular `<input name=\"cms\" value=\"1\">` this works fine.\r\n\r\nYet, if I tweak the html for the form (trying to forge an invalid POST request), and send a \"cms\" array to the controller instead of a string value, like this \r\n\r\n`<input name=\"cms[]\" value=\"some\"><input name=\"cms[]\" value=\"other\">`\r\n\r\nthis array bypasses the validation rule, because CodeIgniter treats 'cms' and 'cms[]' as different things in validation (as it should). However, since both the 'cms' and 'cms[]' values are retrieved from the POST array using `$this->input->post('cms');` I have no way to tell which value (the string or the array) I am retrieving.\r\n\r\nI believe this is a bug in CodeIgniter's form validation, because this is in the comments in the system\\libraries\\form_validation.php file (line 661):\r\n\r\n```\r\n// If we get an array field, but it's not expected - then it is most likely\r\n// somebody messing with the form on the client side, so we'll just consider\r\n// it an empty field\r\n```\r\n\r\nAnd the code beneath that actually tries to set the value to NULL, but then this NULL is then never re-assigned to the POST array.\r\n\r\nI've fixed this by creating a file at application\\libraries\\MY_Form_validation.php, copying the _execute function from system\\libraries\\form_validation.php and replacing the following:\r\n\r\n```\r\n// If we get an array field, but it's not expected - then it is most likely\r\n// somebody messing with the form on the client side, so we'll just consider\r\n// it an empty field\r\n$postdata = is_array($this->_field_data[$row['field']]['postdata'])\r\n\t? NULL\r\n\t: $this->_field_data[$row['field']]['postdata'];\r\n```\r\n\r\nwith\r\n\r\n```\r\n// If we get an array field, but it's not expected - then it is most likely\r\n// somebody messing with the form on the client side, so we'll just consider\r\n// it an empty field\r\n$postdata = is_array($this->_field_data[$row['field']]['postdata'])\r\n\t? \"\"\r\n\t: $this->_field_data[$row['field']]['postdata'];\r\n$this->_field_data[$row['field']]['postdata'] = $postdata;\r\n```\r\n\r\n(Using NULL here won't work, because the _reset_post_array function won't re-assign NULL values back to the POST array.)\r\n\r\nDid I fix this correctly?\r\nI need to use this in production, so I just want to make sure I didn't break anything else. :)\r\n\r\nCodeIgniter version 3.1.9","closed_by":{"login":"Stanzi1791","id":6654587,"node_id":"MDQ6VXNlcjY2NTQ1ODc=","avatar_url":"https://avatars.githubusercontent.com/u/6654587?v=4","gravatar_id":"","url":"https://api.github.com/users/Stanzi1791","html_url":"https://github.com/Stanzi1791","followers_url":"https://api.github.com/users/Stanzi1791/followers","following_url":"https://api.github.com/users/Stanzi1791/following{/other_user}","gists_url":"https://api.github.com/users/Stanzi1791/gists{/gist_id}","starred_url":"https://api.github.com/users/Stanzi1791/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Stanzi1791/subscriptions","organizations_url":"https://api.github.com/users/Stanzi1791/orgs","repos_url":"https://api.github.com/users/Stanzi1791/repos","events_url":"https://api.github.com/users/Stanzi1791/events{/privacy}","received_events_url":"https://api.github.com/users/Stanzi1791/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5605/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5605/timeline","performed_via_github_app":null,"state_reason":"completed"}