[{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/127797894","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/4026#issuecomment-127797894","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4026","id":127797894,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzc5Nzg5NA==","user":{"login":"jklovanc","id":5922710,"node_id":"MDQ6VXNlcjU5MjI3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/5922710?v=4","gravatar_id":"","url":"https://api.github.com/users/jklovanc","html_url":"https://github.com/jklovanc","followers_url":"https://api.github.com/users/jklovanc/followers","following_url":"https://api.github.com/users/jklovanc/following{/other_user}","gists_url":"https://api.github.com/users/jklovanc/gists{/gist_id}","starred_url":"https://api.github.com/users/jklovanc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jklovanc/subscriptions","organizations_url":"https://api.github.com/users/jklovanc/orgs","repos_url":"https://api.github.com/users/jklovanc/repos","events_url":"https://api.github.com/users/jklovanc/events{/privacy}","received_events_url":"https://api.github.com/users/jklovanc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-04T23:45:34Z","updated_at":"2015-08-04T23:45:34Z","body":"On looking further the issue is bigger than I thought. The documentation has the following description for \"strict mode\";\n\"When strict mode is enabled, if you are running multiple groups of transactions, if one group fails all groups will be rolled back.\"\nThat is not true as transaction will be committed when level 0 of the transaction is reached.  As the code stands now the a query  failure in or out of a transaction will cause all future transaction to fail. A query failure will have no effect on and transaction that has been committed. \n\nQuery faulure only effect previous queries is the transactions have been nested. Take a look at the following;\n$this->db->trans_start();\n//first queries\n$this->db->trans_complete();\n$this->db->trans_start();\n//second queries\n$this->db->trans_complete();\n$this->db->trans_start();\n//third queries\n$this->db->trans_complete();\nIf the first queries complete it will be committed at the first trans_complete(). If the second queries do not complete the first transaction can not be rolled back as it has already been committed. The third  queries will roll back only in \"strict mode\".\n\nLook at a nested query;\n$this->db->trans_start();\n    //some transaction\n   $this->db->trans_start();\n    //inside transaction\n    $this->db->trans_complete();\n    //last queries\n$this->db->trans_complete();\nIn this case the commit only happens on the outside trans_complete(). Therefore all previous queries, after the first trans_start(), are rolled back. The trans_strict flag is meaningless as it only effects resetting on the outside trans_complete().\n\nThe issue comes in choosing where to reset the _trans_status flag. Currently it is set in trans_complete(). The problem with it being there is that queries before the transaction can set that flag to false and the transaction will fail.\n\nI think it should be done in trans begin and the following line should be changed;\n$this->_trans_failure = ($test_mode === TRUE) ? TRUE : FALSE;\nShould be ;\nif ($this->trans_strict === FALSE)\n{\n   $this->_trans_status = ($test_mode === TRUE) ? FALSE : TRUE ;\n}\nThis resets the _trans_status flag on the outermost transaction with strict mode off and makes test_mode work. Currently test mode does not work as _trans_failure in not accessed anywhere. In the event that \"strict mode\" is on subsequent transactions will fail if any query fails. Right now any transaction fails if any previous query fails reguardless of \"strict mode\".\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/127797894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jklovanc","id":5922710,"node_id":"MDQ6VXNlcjU5MjI3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/5922710?v=4","gravatar_id":"","url":"https://api.github.com/users/jklovanc","html_url":"https://github.com/jklovanc","followers_url":"https://api.github.com/users/jklovanc/followers","following_url":"https://api.github.com/users/jklovanc/following{/other_user}","gists_url":"https://api.github.com/users/jklovanc/gists{/gist_id}","starred_url":"https://api.github.com/users/jklovanc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jklovanc/subscriptions","organizations_url":"https://api.github.com/users/jklovanc/orgs","repos_url":"https://api.github.com/users/jklovanc/repos","events_url":"https://api.github.com/users/jklovanc/events{/privacy}","received_events_url":"https://api.github.com/users/jklovanc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/127805936","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/4026#issuecomment-127805936","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4026","id":127805936,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzgwNTkzNg==","user":{"login":"keynote","id":200518,"node_id":"MDQ6VXNlcjIwMDUxOA==","avatar_url":"https://avatars.githubusercontent.com/u/200518?v=4","gravatar_id":"","url":"https://api.github.com/users/keynote","html_url":"https://github.com/keynote","followers_url":"https://api.github.com/users/keynote/followers","following_url":"https://api.github.com/users/keynote/following{/other_user}","gists_url":"https://api.github.com/users/keynote/gists{/gist_id}","starred_url":"https://api.github.com/users/keynote/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keynote/subscriptions","organizations_url":"https://api.github.com/users/keynote/orgs","repos_url":"https://api.github.com/users/keynote/repos","events_url":"https://api.github.com/users/keynote/events{/privacy}","received_events_url":"https://api.github.com/users/keynote/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-05T00:49:45Z","updated_at":"2015-08-05T00:49:45Z","body":"Joe\n\nYou’re gonna have to explain this one to me\n\nM\n\nFrom: jklovanc\nReply-To: bcit-ci/CodeIgniter\nDate: Tuesday, August 4, 2015 at 4:46 PM\nTo: bcit-ci/CodeIgniter\nCc: Podium 1\nSubject: Re: [CodeIgniter] _trans_status set outside a transaction (#4026)\n\nOn looking further the issue is bigger than I thought. The documentation has the following description for \"strict mode\";\n\"When strict mode is enabled, if you are running multiple groups of transactions, if one group fails all groups will be rolled back.\"\nThat is not true as transaction will be committed when level 0 of the transaction is reached. As the code stands now the a query failure in or out of a transaction will cause all future transaction to fail. A query failure will have no effect on and transaction that has been committed.\n\nQuery faulure only effect previous queries is the transactions have been nested. Take a look at the following;\n$this->db->trans_start();\n//first queries\n$this->db->trans_complete();\n$this->db->trans_start();\n//second queries\n$this->db->trans_complete();\n$this->db->trans_start();\n//third queries\n$this->db->trans_complete();\nIf the first queries complete it will be committed at the first trans_complete(). If the second queries do not complete the first transaction can not be rolled back as it has already been committed. The third queries will roll back only in \"strict mode\".\n\nLook at a nested query;\n$this->db->trans_start();\n//some transaction\n$this->db->trans_start();\n//inside transaction\n$this->db->trans_complete();\n//last queries\n$this->db->trans_complete();\nIn this case the commit only happens on the outside trans_complete(). Therefore all previous queries, after the first trans_start(), are rolled back. The trans_strict flag is meaningless as it only effects resetting on the outside trans_complete().\n\nThe issue comes in choosing where to reset the _trans_status flag. Currently it is set in trans_complete(). The problem with it being there is that queries before the transaction can set that flag to false and the transaction will fail.\n\nI think it should be done in trans begin and the following line should be changed;\n$this->_trans_failure = ($test_mode === TRUE) ? TRUE : FALSE;\nShould be ;\nif ($this->trans_strict === FALSE)\n{\n$this->_trans_status = ($test_mode === TRUE) ? FALSE : TRUE ;\n}\nThis resets the _trans_status flag on the outermost transaction with strict mode off and makes test_mode work. Currently test mode does not work as _trans_failure in not accessed anywhere. In the event that \"strict mode\" is on subsequent transactions will fail if any query fails. Right now any transaction fails if any previous query fails reguardless of \"strict mode\".\n\n—\nReply to this email directly or view it on GitHubhttps://github.com/bcit-ci/CodeIgniter/issues/4026#issuecomment-127797894.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/127805936/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"keynote","id":200518,"node_id":"MDQ6VXNlcjIwMDUxOA==","avatar_url":"https://avatars.githubusercontent.com/u/200518?v=4","gravatar_id":"","url":"https://api.github.com/users/keynote","html_url":"https://github.com/keynote","followers_url":"https://api.github.com/users/keynote/followers","following_url":"https://api.github.com/users/keynote/following{/other_user}","gists_url":"https://api.github.com/users/keynote/gists{/gist_id}","starred_url":"https://api.github.com/users/keynote/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keynote/subscriptions","organizations_url":"https://api.github.com/users/keynote/orgs","repos_url":"https://api.github.com/users/keynote/repos","events_url":"https://api.github.com/users/keynote/events{/privacy}","received_events_url":"https://api.github.com/users/keynote/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/127806208","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/4026#issuecomment-127806208","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4026","id":127806208,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzgwNjIwOA==","user":{"login":"jklovanc","id":5922710,"node_id":"MDQ6VXNlcjU5MjI3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/5922710?v=4","gravatar_id":"","url":"https://api.github.com/users/jklovanc","html_url":"https://github.com/jklovanc","followers_url":"https://api.github.com/users/jklovanc/followers","following_url":"https://api.github.com/users/jklovanc/following{/other_user}","gists_url":"https://api.github.com/users/jklovanc/gists{/gist_id}","starred_url":"https://api.github.com/users/jklovanc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jklovanc/subscriptions","organizations_url":"https://api.github.com/users/jklovanc/orgs","repos_url":"https://api.github.com/users/jklovanc/repos","events_url":"https://api.github.com/users/jklovanc/events{/privacy}","received_events_url":"https://api.github.com/users/jklovanc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-05T00:52:17Z","updated_at":"2015-08-05T00:52:17Z","body":"What is unclear?\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/127806208/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jklovanc","id":5922710,"node_id":"MDQ6VXNlcjU5MjI3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/5922710?v=4","gravatar_id":"","url":"https://api.github.com/users/jklovanc","html_url":"https://github.com/jklovanc","followers_url":"https://api.github.com/users/jklovanc/followers","following_url":"https://api.github.com/users/jklovanc/following{/other_user}","gists_url":"https://api.github.com/users/jklovanc/gists{/gist_id}","starred_url":"https://api.github.com/users/jklovanc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jklovanc/subscriptions","organizations_url":"https://api.github.com/users/jklovanc/orgs","repos_url":"https://api.github.com/users/jklovanc/repos","events_url":"https://api.github.com/users/jklovanc/events{/privacy}","received_events_url":"https://api.github.com/users/jklovanc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":374091362,"node_id":"MDExOkNsb3NlZEV2ZW50Mzc0MDkxMzYy","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/374091362","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"4e5ff1f7f8c1897526e9362fdcf7b574c1b3cdf9","commit_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/commits/4e5ff1f7f8c1897526e9362fdcf7b574c1b3cdf9","created_at":"2015-08-05T11:32:14Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/127965590","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/4026#issuecomment-127965590","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4026","id":127965590,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNzk2NTU5MA==","user":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-05T11:35:50Z","updated_at":"2015-08-05T11:35:50Z","body":"@jklovanc I got some clues from what you wrote, but the sheer size of your comment and it going back and forth between different issues does make it unclear.\n\nThe original issue reported by @keynote is fixed with the above commit. Please open a new one for what else you see as problematic, and possibly try to format it better. :)\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/127965590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":374095132,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mzc0MDk1MTMy","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/374095132","actor":{"login":"jklovanc","id":5922710,"node_id":"MDQ6VXNlcjU5MjI3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/5922710?v=4","gravatar_id":"","url":"https://api.github.com/users/jklovanc","html_url":"https://github.com/jklovanc","followers_url":"https://api.github.com/users/jklovanc/followers","following_url":"https://api.github.com/users/jklovanc/following{/other_user}","gists_url":"https://api.github.com/users/jklovanc/gists{/gist_id}","starred_url":"https://api.github.com/users/jklovanc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jklovanc/subscriptions","organizations_url":"https://api.github.com/users/jklovanc/orgs","repos_url":"https://api.github.com/users/jklovanc/repos","events_url":"https://api.github.com/users/jklovanc/events{/privacy}","received_events_url":"https://api.github.com/users/jklovanc/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2015-08-05T11:35:50Z","performed_via_github_app":null},{"id":374095133,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM3NDA5NTEzMw==","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/374095133","actor":{"login":"jklovanc","id":5922710,"node_id":"MDQ6VXNlcjU5MjI3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/5922710?v=4","gravatar_id":"","url":"https://api.github.com/users/jklovanc","html_url":"https://github.com/jklovanc","followers_url":"https://api.github.com/users/jklovanc/followers","following_url":"https://api.github.com/users/jklovanc/following{/other_user}","gists_url":"https://api.github.com/users/jklovanc/gists{/gist_id}","starred_url":"https://api.github.com/users/jklovanc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jklovanc/subscriptions","organizations_url":"https://api.github.com/users/jklovanc/orgs","repos_url":"https://api.github.com/users/jklovanc/repos","events_url":"https://api.github.com/users/jklovanc/events{/privacy}","received_events_url":"https://api.github.com/users/jklovanc/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2015-08-05T11:35:50Z","performed_via_github_app":null},{"id":374095135,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50Mzc0MDk1MTM1","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/374095135","actor":{"login":"keynote","id":200518,"node_id":"MDQ6VXNlcjIwMDUxOA==","avatar_url":"https://avatars.githubusercontent.com/u/200518?v=4","gravatar_id":"","url":"https://api.github.com/users/keynote","html_url":"https://github.com/keynote","followers_url":"https://api.github.com/users/keynote/followers","following_url":"https://api.github.com/users/keynote/following{/other_user}","gists_url":"https://api.github.com/users/keynote/gists{/gist_id}","starred_url":"https://api.github.com/users/keynote/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keynote/subscriptions","organizations_url":"https://api.github.com/users/keynote/orgs","repos_url":"https://api.github.com/users/keynote/repos","events_url":"https://api.github.com/users/keynote/events{/privacy}","received_events_url":"https://api.github.com/users/keynote/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2015-08-05T11:35:50Z","performed_via_github_app":null},{"id":374095136,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM3NDA5NTEzNg==","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/374095136","actor":{"login":"keynote","id":200518,"node_id":"MDQ6VXNlcjIwMDUxOA==","avatar_url":"https://avatars.githubusercontent.com/u/200518?v=4","gravatar_id":"","url":"https://api.github.com/users/keynote","html_url":"https://github.com/keynote","followers_url":"https://api.github.com/users/keynote/followers","following_url":"https://api.github.com/users/keynote/following{/other_user}","gists_url":"https://api.github.com/users/keynote/gists{/gist_id}","starred_url":"https://api.github.com/users/keynote/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keynote/subscriptions","organizations_url":"https://api.github.com/users/keynote/orgs","repos_url":"https://api.github.com/users/keynote/repos","events_url":"https://api.github.com/users/keynote/events{/privacy}","received_events_url":"https://api.github.com/users/keynote/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2015-08-05T11:35:50Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/128085162","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/4026#issuecomment-128085162","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4026","id":128085162,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA4NTE2Mg==","user":{"login":"jklovanc","id":5922710,"node_id":"MDQ6VXNlcjU5MjI3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/5922710?v=4","gravatar_id":"","url":"https://api.github.com/users/jklovanc","html_url":"https://github.com/jklovanc","followers_url":"https://api.github.com/users/jklovanc/followers","following_url":"https://api.github.com/users/jklovanc/following{/other_user}","gists_url":"https://api.github.com/users/jklovanc/gists{/gist_id}","starred_url":"https://api.github.com/users/jklovanc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jklovanc/subscriptions","organizations_url":"https://api.github.com/users/jklovanc/orgs","repos_url":"https://api.github.com/users/jklovanc/repos","events_url":"https://api.github.com/users/jklovanc/events{/privacy}","received_events_url":"https://api.github.com/users/jklovanc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-05T17:33:27Z","updated_at":"2015-08-05T17:33:27Z","body":"I am actually both people that submitted. The code change I submitted needs to be done in every driver and I do not have the time or inclination to fix your code. I tried to re-submit but the system blanked my input half way through editing. It goes back and forth a bit because there are two issues that are intertwined.  Maybe this will be a better explanation.\n\n# First transaction after a failed query always fails.\n\nAll drivers use  _trans_status to track is a query has failed. It uses true on no failure and false on failure. That variable is set in three places;\n1. True as a default on initialization.\n2. False if a query fails.\n3. True in trans_complete() if \"strict mode\" is of and the transaction is at nesting level 1. This is done after the rollback is done.\nTake a look at the following scenario.\n1. The class is initialized. This will set _trans_status to true.\n2. A query fails. This will set _trans_status to false\n3. A transaction is started. No change to _trans_status. It is still false.\n4. Queries complete correctly.  No change to _trans_status. It is still false.\n5. Trans_complete() is run.\n- Since _trans_status is false trans_rollback() will be run and all queries will be ignored.\n- If trans_strict is false, _trans_status is set to true.\n\nAs you can see the query ran before transaction will cause the transaction to rollback even though no queries failed in the transaction. This happens not matter what \"strict mode\" is set to.\n\nAnother issue I found was that there is a variable _trans_failure that is set in trans_start() but never used.\n\n# Solution\n\nThe following changes need to be made to all the drivers as the problem exists in every driver.\n1. The code to update _trans_status in trans_complete() needs to be removed.\n2. The following changes need to be made to trans_start();\n- remove the following line.\n  \n  > $this->_trans_failure = ($test_mode === TRUE) ? TRUE : FALSE;\n  - replace with the following code;\n\n> if ($this->trans_strict === FALSE)\n> {\n>    $this->_trans_status = ($test_mode === TRUE) ? FALSE : TRUE ;\n> }\n\nI honestly do not understand how your forking gets code back into the main repository.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/128085162/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jklovanc","id":5922710,"node_id":"MDQ6VXNlcjU5MjI3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/5922710?v=4","gravatar_id":"","url":"https://api.github.com/users/jklovanc","html_url":"https://github.com/jklovanc","followers_url":"https://api.github.com/users/jklovanc/followers","following_url":"https://api.github.com/users/jklovanc/following{/other_user}","gists_url":"https://api.github.com/users/jklovanc/gists{/gist_id}","starred_url":"https://api.github.com/users/jklovanc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jklovanc/subscriptions","organizations_url":"https://api.github.com/users/jklovanc/orgs","repos_url":"https://api.github.com/users/jklovanc/repos","events_url":"https://api.github.com/users/jklovanc/events{/privacy}","received_events_url":"https://api.github.com/users/jklovanc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/128353497","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/4026#issuecomment-128353497","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4026","id":128353497,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODM1MzQ5Nw==","user":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-06T12:55:41Z","updated_at":"2015-08-06T12:55:41Z","body":"Forking our repository provides you with the necessary commit privileges to make your changes (because the fork is in fact your repository).\n\nAfter you've made those changes, all you need to do is to create a \"Pull Request\" (you'll have a button for that), which is basically the same as telling us this \"I've made some changes that I want you to have, you can get them from repository X, branch Y.\" The difference being that we don't have to do that manually and it is easier to look at the diff, comment back and forth with you on it, automate testing, etc.\nThe [GitHub Help](https://help.github.com/) pages should be helpful if you can't quite understand it yet.\n\nI'll continue the rest of the conversation in #4032 once I go through all the details and relevant pieces of code. :)\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/128353497/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":375273071,"node_id":"MDEyOkxhYmVsZWRFdmVudDM3NTI3MzA3MQ==","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/375273071","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2015-08-06T13:13:17Z","label":{"name":"Bug","color":"e10c02"},"performed_via_github_app":null},{"id":382468297,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDM4MjQ2ODI5Nw==","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/382468297","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2015-08-14T11:12:05Z","milestone":{"title":"3.0.1"},"performed_via_github_app":null},{"actor":{"login":"ymchun","id":282311,"node_id":"MDQ6VXNlcjI4MjMxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/282311?v=4","gravatar_id":"","url":"https://api.github.com/users/ymchun","html_url":"https://github.com/ymchun","followers_url":"https://api.github.com/users/ymchun/followers","following_url":"https://api.github.com/users/ymchun/following{/other_user}","gists_url":"https://api.github.com/users/ymchun/gists{/gist_id}","starred_url":"https://api.github.com/users/ymchun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymchun/subscriptions","organizations_url":"https://api.github.com/users/ymchun/orgs","repos_url":"https://api.github.com/users/ymchun/repos","events_url":"https://api.github.com/users/ymchun/events{/privacy}","received_events_url":"https://api.github.com/users/ymchun/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-09-04T11:49:57Z","updated_at":"2017-09-04T11:49:57Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5246","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5246/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5246/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5246/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/5246","id":255016398,"node_id":"MDU6SXNzdWUyNTUwMTYzOTg=","number":5246,"title":"Transaction status in loop not reset","user":{"login":"ymchun","id":282311,"node_id":"MDQ6VXNlcjI4MjMxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/282311?v=4","gravatar_id":"","url":"https://api.github.com/users/ymchun","html_url":"https://github.com/ymchun","followers_url":"https://api.github.com/users/ymchun/followers","following_url":"https://api.github.com/users/ymchun/following{/other_user}","gists_url":"https://api.github.com/users/ymchun/gists{/gist_id}","starred_url":"https://api.github.com/users/ymchun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ymchun/subscriptions","organizations_url":"https://api.github.com/users/ymchun/orgs","repos_url":"https://api.github.com/users/ymchun/repos","events_url":"https://api.github.com/users/ymchun/events{/privacy}","received_events_url":"https://api.github.com/users/ymchun/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":140924,"node_id":"MDU6TGFiZWwxNDA5MjQ=","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/labels/Bug","name":"Bug","color":"eb2420","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/17","html_url":"https://github.com/bcit-ci/CodeIgniter/milestone/17","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/17/labels","id":2595848,"node_id":"MDk6TWlsZXN0b25lMjU5NTg0OA==","number":17,"title":"3.1.6","description":"","creator":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":9,"state":"closed","created_at":"2017-06-21T12:39:56Z","updated_at":"2017-09-27T15:57:11Z","due_on":"2017-09-25T07:00:00Z","closed_at":"2017-09-27T15:57:11Z"},"comments":5,"created_at":"2017-09-04T11:40:04Z","updated_at":"2017-09-04T12:43:11Z","closed_at":"2017-09-04T12:43:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":2234102,"node_id":"MDEwOlJlcG9zaXRvcnkyMjM0MTAy","name":"CodeIgniter","full_name":"bcit-ci/CodeIgniter","private":false,"owner":{"login":"bcit-ci","id":8863432,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg4NjM0MzI=","avatar_url":"https://avatars.githubusercontent.com/u/8863432?v=4","gravatar_id":"","url":"https://api.github.com/users/bcit-ci","html_url":"https://github.com/bcit-ci","followers_url":"https://api.github.com/users/bcit-ci/followers","following_url":"https://api.github.com/users/bcit-ci/following{/other_user}","gists_url":"https://api.github.com/users/bcit-ci/gists{/gist_id}","starred_url":"https://api.github.com/users/bcit-ci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bcit-ci/subscriptions","organizations_url":"https://api.github.com/users/bcit-ci/orgs","repos_url":"https://api.github.com/users/bcit-ci/repos","events_url":"https://api.github.com/users/bcit-ci/events{/privacy}","received_events_url":"https://api.github.com/users/bcit-ci/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bcit-ci/CodeIgniter","description":"Open Source PHP Framework (originally from EllisLab)","fork":false,"url":"https://api.github.com/repos/bcit-ci/CodeIgniter","forks_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/forks","keys_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/teams","hooks_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/hooks","issue_events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events{/number}","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/events","assignees_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/assignees{/user}","branches_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/branches{/branch}","tags_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/tags","blobs_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/git/refs{/sha}","trees_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/statuses/{sha}","languages_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/languages","stargazers_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/stargazers","contributors_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/contributors","subscribers_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/subscribers","subscription_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/subscription","commits_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/commits{/sha}","git_commits_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/git/commits{/sha}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/comments{/number}","issue_comment_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments{/number}","contents_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/contents/{+path}","compare_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/merges","archive_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/downloads","issues_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues{/number}","pulls_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/pulls{/number}","milestones_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones{/number}","notifications_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/labels{/name}","releases_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/releases{/id}","deployments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/deployments","created_at":"2011-08-19T13:34:00Z","updated_at":"2025-11-10T12:47:16Z","pushed_at":"2024-07-15T07:39:54Z","git_url":"git://github.com/bcit-ci/CodeIgniter.git","ssh_url":"git@github.com:bcit-ci/CodeIgniter.git","clone_url":"https://github.com/bcit-ci/CodeIgniter.git","svn_url":"https://github.com/bcit-ci/CodeIgniter","homepage":"https://codeigniter.com/","size":54780,"stargazers_count":18235,"watchers_count":18235,"language":"PHP","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":7636,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":105,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["php","php-framework","php7","php8"],"visibility":"public","forks":7636,"open_issues":105,"watchers":18235,"default_branch":"develop","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Consider the following code\r\n\r\n```PHP\r\n<?php\r\n\r\nforeach($users as $user){\r\n\t$this->db->trans_begin();\r\n\r\n\t$this->db->query('some sql 1');\r\n\t$this->db->query('some sql 2');\r\n\t$this->db->query('some sql 3');\r\n\r\n\tif($this->db->trans_status() === FALSE){\r\n\t\t$this->db->trans_rollback();\r\n\t}\r\n\telse{\r\n\t\t$this->db->trans_commit();\r\n\t}\r\n}\r\n```\r\n\r\nI am using this code to loop an user array to create users.\r\nEach loop need to use 3 query to create a single user eg. insert user info, insert permission, ...\r\n\r\nMy expectation:\r\nWhen some users failed, skip that user and rollback. Then continue to create users after that.\r\n\r\nBut the thing I got:\r\n$this->db->trans_status() always return FALSE when something failed in the middle, all users got rolled back after one user failed.\r\n\r\nI think $this->db->trans_status() never reset when doing commit or rollback.\r\n\r\nCI version: 3.1.5\r\nPHP version: 5.6.31\r\nServer: Windows Server 2012 R2\r\n","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5246/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"mackxpall","id":118120494,"node_id":"U_kgDOBwpgLg","avatar_url":"https://avatars.githubusercontent.com/u/118120494?v=4","gravatar_id":"","url":"https://api.github.com/users/mackxpall","html_url":"https://github.com/mackxpall","followers_url":"https://api.github.com/users/mackxpall/followers","following_url":"https://api.github.com/users/mackxpall/following{/other_user}","gists_url":"https://api.github.com/users/mackxpall/gists{/gist_id}","starred_url":"https://api.github.com/users/mackxpall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mackxpall/subscriptions","organizations_url":"https://api.github.com/users/mackxpall/orgs","repos_url":"https://api.github.com/users/mackxpall/repos","events_url":"https://api.github.com/users/mackxpall/events{/privacy}","received_events_url":"https://api.github.com/users/mackxpall/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-11-27T03:44:18Z","updated_at":"2022-11-27T03:44:18Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues/6916","repository_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4","labels_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues/6916/labels{/name}","comments_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues/6916/comments","events_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues/6916/events","html_url":"https://github.com/codeigniter4/CodeIgniter4/issues/6916","id":1465321341,"node_id":"I_kwDOAniwTs5XVwd9","number":6916,"title":"DB Transactions description for Strict Mode","user":{"login":"mackxpall","id":118120494,"node_id":"U_kgDOBwpgLg","avatar_url":"https://avatars.githubusercontent.com/u/118120494?v=4","gravatar_id":"","url":"https://api.github.com/users/mackxpall","html_url":"https://github.com/mackxpall","followers_url":"https://api.github.com/users/mackxpall/followers","following_url":"https://api.github.com/users/mackxpall/following{/other_user}","gists_url":"https://api.github.com/users/mackxpall/gists{/gist_id}","starred_url":"https://api.github.com/users/mackxpall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mackxpall/subscriptions","organizations_url":"https://api.github.com/users/mackxpall/orgs","repos_url":"https://api.github.com/users/mackxpall/repos","events_url":"https://api.github.com/users/mackxpall/events{/privacy}","received_events_url":"https://api.github.com/users/mackxpall/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":253155270,"node_id":"MDU6TGFiZWwyNTMxNTUyNzA=","url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/labels/bug","name":"bug","color":"fc2929","default":true,"description":"Verified issues on the current code behavior or pull requests that will fix them"},{"id":373010461,"node_id":"MDU6TGFiZWwzNzMwMTA0NjE=","url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/labels/documentation","name":"documentation","color":"d4c5f9","default":true,"description":"Pull requests for documentation only"},{"id":373010525,"node_id":"MDU6TGFiZWwzNzMwMTA1MjU=","url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/labels/database","name":"database","color":"d4c5f9","default":false,"description":"Issues or pull requests that affect the database layer"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-11-27T03:44:18Z","updated_at":"2022-11-29T23:58:52Z","closed_at":"2022-11-29T23:58:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":41463886,"node_id":"MDEwOlJlcG9zaXRvcnk0MTQ2Mzg4Ng==","name":"CodeIgniter4","full_name":"codeigniter4/CodeIgniter4","private":false,"owner":{"login":"codeigniter4","id":44521256,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ0NTIxMjU2","avatar_url":"https://avatars.githubusercontent.com/u/44521256?v=4","gravatar_id":"","url":"https://api.github.com/users/codeigniter4","html_url":"https://github.com/codeigniter4","followers_url":"https://api.github.com/users/codeigniter4/followers","following_url":"https://api.github.com/users/codeigniter4/following{/other_user}","gists_url":"https://api.github.com/users/codeigniter4/gists{/gist_id}","starred_url":"https://api.github.com/users/codeigniter4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codeigniter4/subscriptions","organizations_url":"https://api.github.com/users/codeigniter4/orgs","repos_url":"https://api.github.com/users/codeigniter4/repos","events_url":"https://api.github.com/users/codeigniter4/events{/privacy}","received_events_url":"https://api.github.com/users/codeigniter4/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/codeigniter4/CodeIgniter4","description":"Open Source PHP Framework (originally from EllisLab)","fork":false,"url":"https://api.github.com/repos/codeigniter4/CodeIgniter4","forks_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/forks","keys_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/keys{/key_id}","collaborators_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/teams","hooks_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/hooks","issue_events_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues/events{/number}","events_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/events","assignees_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/assignees{/user}","branches_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/branches{/branch}","tags_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/tags","blobs_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/git/refs{/sha}","trees_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/git/trees{/sha}","statuses_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/statuses/{sha}","languages_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/languages","stargazers_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/stargazers","contributors_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/contributors","subscribers_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/subscribers","subscription_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/subscription","commits_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/commits{/sha}","git_commits_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/git/commits{/sha}","comments_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/comments{/number}","issue_comment_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues/comments{/number}","contents_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/contents/{+path}","compare_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/compare/{base}...{head}","merges_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/merges","archive_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/downloads","issues_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues{/number}","pulls_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/pulls{/number}","milestones_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/milestones{/number}","notifications_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/labels{/name}","releases_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/releases{/id}","deployments_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/deployments","created_at":"2015-08-27T03:32:45Z","updated_at":"2025-11-10T12:47:20Z","pushed_at":"2025-11-06T07:09:01Z","git_url":"git://github.com/codeigniter4/CodeIgniter4.git","ssh_url":"git@github.com:codeigniter4/CodeIgniter4.git","clone_url":"https://github.com/codeigniter4/CodeIgniter4.git","svn_url":"https://github.com/codeigniter4/CodeIgniter4","homepage":"https://codeigniter.com/","size":343382,"stargazers_count":5768,"watchers_count":5768,"language":"PHP","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":false,"forks_count":1969,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":51,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["codeigniter","codeigniter4","framework-php","hacktoberfest","php","php-framework","php8"],"visibility":"public","forks":1969,"open_issues":51,"watchers":5768,"default_branch":"develop","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"On looking further the issue is bigger than I thought. The documentation has the following description for \"strict mode\";\n\"When strict mode is enabled, if you are running multiple groups of transactions, if one group fails all groups will be rolled back.\"\nThat is not true as transaction will be committed when level 0 of the transaction is reached.  As the code stands now the a query  failure in or out of a transaction will cause all future transaction to fail. A query failure will have no effect on and transaction that has been committed. \n\nQuery faulure only effect previous queries is the transactions have been nested. Take a look at the following;\n$this->db->trans_start();\n//first queries\n$this->db->trans_complete();\n$this->db->trans_start();\n//second queries\n$this->db->trans_complete();\n$this->db->trans_start();\n//third queries\n$this->db->trans_complete();\nIf the first queries complete it will be committed at the first trans_complete(). If the second queries do not complete the first transaction can not be rolled back as it has already been committed. The third  queries will roll back only in \"strict mode\".\n\nLook at a nested query;\n$this->db->trans_start();\n    //some transaction\n   $this->db->trans_start();\n    //inside transaction\n    $this->db->trans_complete();\n    //last queries\n$this->db->trans_complete();\nIn this case the commit only happens on the outside trans_complete(). Therefore all previous queries, after the first trans_start(), are rolled back. The trans_strict flag is meaningless as it only effects resetting on the outside trans_complete().\n\nThe issue comes in choosing where to reset the _trans_status flag. Currently it is set in trans_complete(). The problem with it being there is that queries before the transaction can set that flag to false and the transaction will fail.\n\nI think it should be done in trans begin and the following line should be changed;\n$this->_trans_failure = ($test_mode === TRUE) ? TRUE : FALSE;\nShould be ;\nif ($this->trans_strict === FALSE)\n{\n   $this->_trans_status = ($test_mode === TRUE) ? FALSE : TRUE ;\n}\nThis resets the _trans_status flag on the outermost transaction with strict mode off and makes test_mode work. Currently test mode does not work as _trans_failure in not accessed anywhere. In the event that \"strict mode\" is on subsequent transactions will fail if any query fails. Right now any transaction fails if any previous query fails reguardless of \"strict mode\".\n\n\n_Originally posted by @jklovanc in https://github.com/bcit-ci/CodeIgniter/issues/4026#issuecomment-127797894_","reactions":{"url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues/6916/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/codeigniter4/CodeIgniter4/issues/6916/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]