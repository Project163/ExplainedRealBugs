{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4066","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4066/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4066/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4066/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/4066","id":102431228,"node_id":"MDU6SXNzdWUxMDI0MzEyMjg=","number":4066,"title":"v3.0.1 - Cache Fallback Broken","user":{"login":"refringe","id":127057,"node_id":"MDQ6VXNlcjEyNzA1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/127057?v=4","gravatar_id":"","url":"https://api.github.com/users/refringe","html_url":"https://github.com/refringe","followers_url":"https://api.github.com/users/refringe/followers","following_url":"https://api.github.com/users/refringe/following{/other_user}","gists_url":"https://api.github.com/users/refringe/gists{/gist_id}","starred_url":"https://api.github.com/users/refringe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/refringe/subscriptions","organizations_url":"https://api.github.com/users/refringe/orgs","repos_url":"https://api.github.com/users/refringe/repos","events_url":"https://api.github.com/users/refringe/events{/privacy}","received_events_url":"https://api.github.com/users/refringe/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":140924,"node_id":"MDU6TGFiZWwxNDA5MjQ=","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/labels/Bug","name":"Bug","color":"eb2420","default":false,"description":null},{"id":247789555,"node_id":"MDU6TGFiZWwyNDc3ODk1NTU=","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/labels/Regression","name":"Regression","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/5","html_url":"https://github.com/bcit-ci/CodeIgniter/milestone/5","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/5/labels","id":1254988,"node_id":"MDk6TWlsZXN0b25lMTI1NDk4OA==","number":5,"title":"3.0.2","description":"","creator":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":22,"state":"closed","created_at":"2015-08-14T10:53:51Z","updated_at":"2015-10-08T16:29:56Z","due_on":"2015-10-07T07:00:00Z","closed_at":"2015-10-08T16:29:24Z"},"comments":0,"created_at":"2015-08-21T17:50:33Z","updated_at":"2015-08-31T12:12:09Z","closed_at":"2015-08-31T12:12:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In [this commit](https://github.com/bcit-ci/CodeIgniter/commit/9aade1cd9f666ac0f70c97c4299063fafe68ada8) the code that was used to setup the connection to the cache server (Redis and Memcache[d]) was moved from a sub-method of the `is_supported` method to the construct method. This is causing issues when the primary cache adapter is not supported.\n\nSo let's run through the problem from the start. Let's assume the PHP memcache(d) modules are disabled and this is the CI cache driver setup:\n\n```\n$this->load->driver('cache', ['adapter' => 'memcached', 'backup' => 'file']);\n```\n\nIf memcache(d) is not available, we'll get a debug message telling us so, and the system will fallback to the backup file-based adapter. [The logic for this can be found here.](https://github.com/bcit-ci/CodeIgniter/blob/3.0.1/system/libraries/Cache/Cache.php#L107-L122)\n\nHowever, when the primary adapter class, memcached, is loaded the construct method is run and because of [these conditions](https://github.com/bcit-ci/CodeIgniter/blob/3.0.1/system/libraries/Cache/drivers/Cache_memcached.php#L99-L110) we end up with the RuntimeException thrown, which halts the script and kills the site.\n\nI only use the memcached and file adapters, but I assume this is happening in any cache adapter that throws an exception in the construct. We can't throw exceptions in the adapter construct methods if we need them to fail gracefully (so the back-up adapter can be used).\n","closed_by":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4066/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/4066/timeline","performed_via_github_app":null,"state_reason":"completed"}