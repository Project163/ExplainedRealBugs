{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3593","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3593/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3593/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3593/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/3593","id":57713143,"node_id":"MDU6SXNzdWU1NzcxMzE0Mw==","number":3593,"title":"system/core/uri.php problem related to encoded characters","user":{"login":"Ignasimg","id":2076465,"node_id":"MDQ6VXNlcjIwNzY0NjU=","avatar_url":"https://avatars.githubusercontent.com/u/2076465?v=4","gravatar_id":"","url":"https://api.github.com/users/Ignasimg","html_url":"https://github.com/Ignasimg","followers_url":"https://api.github.com/users/Ignasimg/followers","following_url":"https://api.github.com/users/Ignasimg/following{/other_user}","gists_url":"https://api.github.com/users/Ignasimg/gists{/gist_id}","starred_url":"https://api.github.com/users/Ignasimg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ignasimg/subscriptions","organizations_url":"https://api.github.com/users/Ignasimg/orgs","repos_url":"https://api.github.com/users/Ignasimg/repos","events_url":"https://api.github.com/users/Ignasimg/events{/privacy}","received_events_url":"https://api.github.com/users/Ignasimg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2015-02-15T01:09:26Z","updated_at":"2015-02-18T16:08:36Z","closed_at":"2015-02-16T09:27:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"So I was porting my web from CI 2.2.0 to 3.0rc2 when I noticed a weird issue with the urls.\n\nThe thing is my website requires to pass some base64 encoded value in the url, that means from time to time I'll pass a = character, since it is a disallowed on codeigniter instead of allowing it through conf, back on 2.2.0 I decided to encode / decode the base64 with urlencode / urldecode (basically, transforming = to %3D). And that worked fine.\n\nBut on CI 3.0rc2 it doesn't work anymore (complaining about disallowed characters on URL, even thought I didn't change the allowed characters configuration and so it has remain the same in both versions)\n\nAfter exploring for a little bit I've discovered in 2.2.0 the _fetch_uri_string method, defaultly fetched the uri from a _detect_uri method which also defaultly got it from $_SERVER['REQUEST_URI'] and $_SERVER['SCRIPT_NAME'] substracting the script route from the full route.\n\nNow on 3.0rc2 the _fetch_uri_string method doesn't exist anymore and the task is apparently handled in the constructor. But not only that, the _detect_uri method also doesn't exist, and the default behaviour now is to get the uri from $_SERVER['PATH_INFO'] directly. \n\nAnd that's the issue, the value on $_SERVER['PATH_INFO'] is already decoded, and hence any encoded character such as %3D is already decoded into it's maybe non-allowed version.\n\nSome things I've tried or thought:\n-Acording to [$_SERVER manpage on php.net](http://php.net/manual/en/reserved.variables.server.php) there should be a ORIG_PATH_INFO which is the original version of PATH_INFO before processed by php. Aparently that should be it, however I tried it and the only thing I got is an undefined index error (running on apache 2.4.7 with php 5.4.24, I'm aware this is not a codeigniter issue, just to prof I'm not too much outdated) \n-Why was _detect_uri removed? it really looks like too much work to do for something that could be more easily obtained from a simple server var, but after all, correctness should be the priority.\n-~~I don't know which processing is taken to transform ORIG_PATH_INFO into PATH_INFO (beside probably an urldecode), but if that was the only thing that's done, it should be easy to fake ORIG_PATH_INFO encoding PATH_INFO (taking care not to encode slashes /) so... explode -> encode -> implode~~\n\nOther thought are welcome.\n","closed_by":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3593/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3593/timeline","performed_via_github_app":null,"state_reason":"completed"}