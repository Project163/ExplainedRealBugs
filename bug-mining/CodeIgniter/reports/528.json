{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5857","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5857/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5857/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5857/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/5857","id":506644248,"node_id":"MDU6SXNzdWU1MDY2NDQyNDg=","number":5857,"title":"Session conflict with Session_files_driver driver","user":{"login":"TimotheeBoutinDAMAaas","id":56547103,"node_id":"MDQ6VXNlcjU2NTQ3MTAz","avatar_url":"https://avatars.githubusercontent.com/u/56547103?v=4","gravatar_id":"","url":"https://api.github.com/users/TimotheeBoutinDAMAaas","html_url":"https://github.com/TimotheeBoutinDAMAaas","followers_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/followers","following_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/following{/other_user}","gists_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/gists{/gist_id}","starred_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/subscriptions","organizations_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/orgs","repos_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/repos","events_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/events{/privacy}","received_events_url":"https://api.github.com/users/TimotheeBoutinDAMAaas/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":140924,"node_id":"MDU6TGFiZWwxNDA5MjQ=","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/labels/Bug","name":"Bug","color":"eb2420","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/23","html_url":"https://github.com/bcit-ci/CodeIgniter/milestone/23","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/23/labels","id":4680381,"node_id":"MDk6TWlsZXN0b25lNDY4MDM4MQ==","number":23,"title":"3.1.12","description":"","creator":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":36,"state":"closed","created_at":"2019-09-22T14:06:54Z","updated_at":"2022-03-03T12:50:23Z","due_on":null,"closed_at":"2022-03-03T12:50:23Z"},"comments":1,"created_at":"2019-10-14T13:10:57Z","updated_at":"2019-10-21T08:20:44Z","closed_at":"2019-10-21T08:20:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"While sending multiple call to a server with the same session ID, using the CI_Session_files_driver\r\nwe encouter some problem when reading the session file.\r\n\r\n-------------------------------------\r\n\r\nThe filesize (line 212) reads the size of the session file which has been put in the cache at line 174 (in the fopen), but the file may have changed of content (and so of length).\r\n\r\nSee _note_ in the filesize docs : https://www.php.net/manual/en/function.filesize.php\r\n\r\nWhen it occurs (multiple call at the same time, some writing things in session) the session data will be unconsistent, invalid, and so destroyed.\r\n\r\n-------------------------------------\r\n\r\nWe patched it by the folowing way :\r\n\r\n- Comment of the read method\r\n- Change it to a simple fread\r\n\r\n```\r\n\r\n//\t\tfor ($read = 0, $length = filesize($this->_file_path.$session_id); $read < $length; $read += self::strlen($buffer))\r\n//\t\t{\r\n//\t\t\tif (($buffer = fread($this->_file_handle, $length - $read)) === FALSE)\r\n//\t\t\t{\r\n//\t\t\t\tbreak;\r\n//\t\t\t}\r\n//\r\n//\t\t\t$session_data .= $buffer;\r\n//\t\t}\r\n\t\twhile (($buffer = fread($this->_file_handle, 10000))) $session_data .= $buffer;\r\n\r\n\r\n```","closed_by":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5857/timeline","performed_via_github_app":null,"state_reason":"completed"}