[{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/94408572","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/3787#issuecomment-94408572","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3787","id":94408572,"node_id":"MDEyOklzc3VlQ29tbWVudDk0NDA4NTcy","user":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-04-20T09:38:07Z","updated_at":"2015-04-20T09:38:07Z","body":"It's not a typo, and your suggested final solution makes that whole loop redundant ...\n\nWhat do you mean by \"does not work\" exactly? Give us some details.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/94408572/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/94425656","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/3787#issuecomment-94425656","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3787","id":94425656,"node_id":"MDEyOklzc3VlQ29tbWVudDk0NDI1NjU2","user":{"login":"mainuljs","id":7961667,"node_id":"MDQ6VXNlcjc5NjE2Njc=","avatar_url":"https://avatars.githubusercontent.com/u/7961667?v=4","gravatar_id":"","url":"https://api.github.com/users/mainuljs","html_url":"https://github.com/mainuljs","followers_url":"https://api.github.com/users/mainuljs/followers","following_url":"https://api.github.com/users/mainuljs/following{/other_user}","gists_url":"https://api.github.com/users/mainuljs/gists{/gist_id}","starred_url":"https://api.github.com/users/mainuljs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mainuljs/subscriptions","organizations_url":"https://api.github.com/users/mainuljs/orgs","repos_url":"https://api.github.com/users/mainuljs/repos","events_url":"https://api.github.com/users/mainuljs/events{/privacy}","received_events_url":"https://api.github.com/users/mainuljs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-04-20T11:14:02Z","updated_at":"2015-04-20T11:14:02Z","body":"If this function is called like this\n\n```\n$filepath='/public_html/';\n$this->ftp->delete_dir($filepath);\n```\n\nThen in function..\n\n```\n$list = $this->ftp->list_files('/public_html/');\nprint_r($list);\n```\n\nreturn something like this\n\n```\nArray ( [0] => . [1] => .. [2] => New Folder [3] => index.php )\n```\n\nThen we check for folder(if available) for recursion. If file it will be deleted. And\n. or .. check by preg_match()  like\n\n```\npreg_match('#\\.\\.?$#', $list[$i]) // will check . or ..\n```\n\nin your function checking like\n\n```\npreg_match('#/\\.\\.?$#', $list[$i])  // extra '/'  after # which not match . or ..\n```\n\n If folder found then recursion happen\n\n```\n// Your way.\n$this->delete_dir($list[$i]); // delete_dir('New Folder/'); which leads to not found. Incorrect Path  \n\n//my way\n$this->delete_dir($filepath.$list[$i]); // delete_dir('/public_html/New Folder/'); found. just concatenate $filepath and $list[$i].\n```\n\nWhole function like this\n\n```\n    public function delete_dir($filepath)\n    {\n        if ( ! $this->_is_conn())\n        {\n            return FALSE;\n        }\n\n\n        // Add a trailing slash to the file path if needed\n        $filepath = preg_replace('/(.+?)\\/*$/', '\\\\1/', $filepath);\n\n        echo $filepath;\n        $list = $this->list_files($filepath);\n        if ( ! empty($list))\n        {\n            for ($i = 0, $c = count($list); $i < $c; $i++)\n            {\n                // If we can't delete the item it's probaly a directory,\n                // so we'll recursively call delete_dir()\n                if ( ! preg_match('#\\.\\.?$#', $list[$i]) && ! @ftp_delete($this->conn_id, $filepath.$list[$i]))\n                {\n                    $this->delete_dir($filepath.$list[$i]);\n                }\n            }\n        }\n        if (@ftp_rmdir($this->conn_id, $filepath) === FALSE)\n        {\n            if ($this->debug === TRUE)\n            {\n                $this->_error('ftp_unable_to_delete');\n            }\n            return FALSE;\n        }\n\n        return TRUE;\n    }\n\n```\n\nNow you may got it. \nYour code shows  'Unable to delete' error.\nMy code work for me.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/94425656/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mainuljs","id":7961667,"node_id":"MDQ6VXNlcjc5NjE2Njc=","avatar_url":"https://avatars.githubusercontent.com/u/7961667?v=4","gravatar_id":"","url":"https://api.github.com/users/mainuljs","html_url":"https://github.com/mainuljs","followers_url":"https://api.github.com/users/mainuljs/followers","following_url":"https://api.github.com/users/mainuljs/following{/other_user}","gists_url":"https://api.github.com/users/mainuljs/gists{/gist_id}","starred_url":"https://api.github.com/users/mainuljs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mainuljs/subscriptions","organizations_url":"https://api.github.com/users/mainuljs/orgs","repos_url":"https://api.github.com/users/mainuljs/repos","events_url":"https://api.github.com/users/mainuljs/events{/privacy}","received_events_url":"https://api.github.com/users/mainuljs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/94430807","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/3787#issuecomment-94430807","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3787","id":94430807,"node_id":"MDEyOklzc3VlQ29tbWVudDk0NDMwODA3","user":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-04-20T11:44:07Z","updated_at":"2015-04-20T11:44:07Z","body":"It's hardly my code, but yes - I see what you mean now.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/94430807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":285133109,"node_id":"MDExOkNsb3NlZEV2ZW50Mjg1MTMzMTA5","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/285133109","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"d3913f591353d17954ee900f2524f24c1833af85","commit_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/commits/d3913f591353d17954ee900f2524f24c1833af85","created_at":"2015-04-20T11:47:14Z","state_reason":null,"performed_via_github_app":null},{"id":382460727,"node_id":"MDEyOkxhYmVsZWRFdmVudDM4MjQ2MDcyNw==","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/382460727","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2015-08-14T10:59:02Z","label":{"name":"Bug","color":"e10c02"},"performed_via_github_app":null},{"id":382460761,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDM4MjQ2MDc2MQ==","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/events/382460761","actor":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2015-08-14T10:59:04Z","milestone":{"title":"3.0.1"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/296231909","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/3787#issuecomment-296231909","issue_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3787","id":296231909,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjIzMTkwOQ==","user":{"login":"Yomi337","id":27862078,"node_id":"MDQ6VXNlcjI3ODYyMDc4","avatar_url":"https://avatars.githubusercontent.com/u/27862078?v=4","gravatar_id":"","url":"https://api.github.com/users/Yomi337","html_url":"https://github.com/Yomi337","followers_url":"https://api.github.com/users/Yomi337/followers","following_url":"https://api.github.com/users/Yomi337/following{/other_user}","gists_url":"https://api.github.com/users/Yomi337/gists{/gist_id}","starred_url":"https://api.github.com/users/Yomi337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Yomi337/subscriptions","organizations_url":"https://api.github.com/users/Yomi337/orgs","repos_url":"https://api.github.com/users/Yomi337/repos","events_url":"https://api.github.com/users/Yomi337/events{/privacy}","received_events_url":"https://api.github.com/users/Yomi337/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-21T16:02:34Z","updated_at":"2017-04-21T16:02:34Z","body":"Hey guys, i found a very annoying thing in this method, i fixed it for my project and wanna share my solution with you. \r\n\r\n$list = $this->list_files($filepath); returns full paths for each file and folder in $filepath (you can check it by yourself or just read it here http://php.net/manual/en/function.ftp-nlist.php).  So this part ---> $this->delete_dir($filepath.$list[$i]); fails recursion if you trying to delete dir with sub-dir.\r\n\r\ne. g. You are trying to delete \"application/cache/123/\" and you have some \"456\" folder inside this, so the 2nd iteration will look like $this->delete_dir('application/cache/123/application/cache/123/456'); which causes an error.\r\n\r\nI removed $filename from this line $this->delete_dir($filepath.$list[$i]); because $list[$i] already contains fullpath and now i got a pretty good working code.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/comments/296231909/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Yomi337","id":27862078,"node_id":"MDQ6VXNlcjI3ODYyMDc4","avatar_url":"https://avatars.githubusercontent.com/u/27862078?v=4","gravatar_id":"","url":"https://api.github.com/users/Yomi337","html_url":"https://github.com/Yomi337","followers_url":"https://api.github.com/users/Yomi337/followers","following_url":"https://api.github.com/users/Yomi337/following{/other_user}","gists_url":"https://api.github.com/users/Yomi337/gists{/gist_id}","starred_url":"https://api.github.com/users/Yomi337/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Yomi337/subscriptions","organizations_url":"https://api.github.com/users/Yomi337/orgs","repos_url":"https://api.github.com/users/Yomi337/repos","events_url":"https://api.github.com/users/Yomi337/events{/privacy}","received_events_url":"https://api.github.com/users/Yomi337/received_events","type":"User","user_view_type":"public","site_admin":false}}]