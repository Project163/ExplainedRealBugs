{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/196","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/196/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/196/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/196/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/196","id":1442515,"node_id":"MDU6SXNzdWUxNDQyNTE1","number":196,"title":"Can't load library instances with same name for two different ontroller instances","user":{"login":"bitbucket-import","id":991171,"node_id":"MDQ6VXNlcjk5MTE3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/991171?v=4","gravatar_id":"","url":"https://api.github.com/users/bitbucket-import","html_url":"https://github.com/bitbucket-import","followers_url":"https://api.github.com/users/bitbucket-import/followers","following_url":"https://api.github.com/users/bitbucket-import/following{/other_user}","gists_url":"https://api.github.com/users/bitbucket-import/gists{/gist_id}","starred_url":"https://api.github.com/users/bitbucket-import/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitbucket-import/subscriptions","organizations_url":"https://api.github.com/users/bitbucket-import/orgs","repos_url":"https://api.github.com/users/bitbucket-import/repos","events_url":"https://api.github.com/users/bitbucket-import/events{/privacy}","received_events_url":"https://api.github.com/users/bitbucket-import/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2011-08-19T14:50:52Z","updated_at":"2011-08-21T15:41:27Z","closed_at":"2011-08-21T15:41:27Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This bug manifests itself only when more than one controller is loaded during the lifetime of the script. This may happen when running tests with PHPUnit.\n\nLoader->_ci_init_class() sets a property of the CI instance with the name of a loaded object and maps the object to its class in a _ci_classes array.\nFurthermore Loader->_ci_load_class() adds the loaded file name to a _ci_loaded_files array.\n\nWhen it comes to detecting duplicate objects, however, Loader->_ci_load_class() only looks in  _ci_loaded_files array unless a specific object name is given and returns if an instance name is already found. As a consequence if we have one Loader instance, but more than one controller loaded (PHPUnit tests) we are unable to load an instance of the same library for each controller.\n\nLoader should check for duplicates on the $CI->$class property always and not only when we pass a distinctive object name as this is only useful when we want to load distinct class instances within the scope of the same controller instance.\n\nI noticed the bug in 1.7.3, but it's still there in 2.0.2.\nI'm able to overcome the issue by extending Loader ad overriding _ci_load_class. The overridden function is in the attached file. \n","closed_by":{"login":"ericlbarnes","id":116662,"node_id":"MDQ6VXNlcjExNjY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/116662?v=4","gravatar_id":"","url":"https://api.github.com/users/ericlbarnes","html_url":"https://github.com/ericlbarnes","followers_url":"https://api.github.com/users/ericlbarnes/followers","following_url":"https://api.github.com/users/ericlbarnes/following{/other_user}","gists_url":"https://api.github.com/users/ericlbarnes/gists{/gist_id}","starred_url":"https://api.github.com/users/ericlbarnes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ericlbarnes/subscriptions","organizations_url":"https://api.github.com/users/ericlbarnes/orgs","repos_url":"https://api.github.com/users/ericlbarnes/repos","events_url":"https://api.github.com/users/ericlbarnes/events{/privacy}","received_events_url":"https://api.github.com/users/ericlbarnes/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/196/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/196/timeline","performed_via_github_app":null,"state_reason":"completed"}