{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/45","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/45/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/45/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/45/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/45","id":1442027,"node_id":"MDU6SXNzdWUxNDQyMDI3","number":45,"title":"Update memcached Driver support for Memcache && Memcached ","user":{"login":"bitbucket-import","id":991171,"node_id":"MDQ6VXNlcjk5MTE3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/991171?v=4","gravatar_id":"","url":"https://api.github.com/users/bitbucket-import","html_url":"https://github.com/bitbucket-import","followers_url":"https://api.github.com/users/bitbucket-import/followers","following_url":"https://api.github.com/users/bitbucket-import/following{/other_user}","gists_url":"https://api.github.com/users/bitbucket-import/gists{/gist_id}","starred_url":"https://api.github.com/users/bitbucket-import/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitbucket-import/subscriptions","organizations_url":"https://api.github.com/users/bitbucket-import/orgs","repos_url":"https://api.github.com/users/bitbucket-import/repos","events_url":"https://api.github.com/users/bitbucket-import/events{/privacy}","received_events_url":"https://api.github.com/users/bitbucket-import/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2011-08-19T14:46:10Z","updated_at":"2012-02-28T13:47:09Z","closed_at":"2012-02-28T13:47:09Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When I am using Memcached driver of CodeIgniter, i have problem about it's not support for memcache lib on Zend Server.\n\nThis is patch for Memcached Drivers\n\n{{{\n# !php\n\n<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');\n/**\n- CodeIgniter\n  *\n- An open source application development framework for PHP 4.3.2 or newer\n  *\n- @package     CodeIgniter\n- @author      ExpressionEngine Dev Team\n- @copyright   Copyright (c) 2006 - 2011 EllisLab, Inc.\n- @license     http://codeigniter.com/user_guide/license.html\n- @link        http://codeigniter.com\n- @since       Version 2.0\n- @filesource  \n  */\n\n// ------------------------------------------------------------------------\n\n/**\n- CodeIgniter Memcached Caching Class \n  *\n- @package     CodeIgniter\n- @subpackage  Libraries\n- @category    Core\n- @author      ExpressionEngine Dev Team\n- @link  \n  */\n\nclass CI_Cache_memcached extends CI_Driver {\n\n```\nprivate $_memcached;    // Holds the memcached object\n\nprotected $_memcache_conf   = array(\n                'default' => array(\n                    'host'      => '127.0.0.1',\n                    'port'      => 11211,\n                    'weight'    => 1\n                )\n            );\n\n// ------------------------------------------------------------------------ \n\n/**\n * Fetch from cache\n *\n * @param   mixed       unique key id\n * @return  mixed       data on success/false on failure\n */ \npublic function get($id)\n{   \n    $data = $this->_memcached->get($id);\n\n    return (is_array($data)) ? $data[0] : FALSE;\n}\n\n// ------------------------------------------------------------------------\n\n/**\n * Save\n *\n * @param   string      unique identifier\n * @param   mixed       data being cached\n * @param   int         time to live\n * @return  boolean     true on success, false on failure\n */\npublic function save($id, $data, $ttl = 60)\n{\n    return $this->_memcached->add($id, array($data, time(), $ttl), $ttl);\n}\n\n// ------------------------------------------------------------------------\n\n/**\n * Delete from Cache\n *\n * @param   mixed       key to be deleted.\n * @return  boolean     true on success, false on failure\n */\npublic function delete($id)\n{\n    return $this->_memcached->delete($id);\n}\n\n// ------------------------------------------------------------------------\n\n/**\n * Clean the Cache\n *\n * @return  boolean     false on failure/true on success\n */\npublic function clean()\n{\n    return $this->_memcached->flush();\n}\n\n// ------------------------------------------------------------------------\n\n/**\n * Cache Info\n *\n * @param   null        type not supported in memcached\n * @return  mixed       array on success, false on failure\n */\npublic function cache_info($type = NULL)\n{\n    return $this->_memcached->getStats();\n}\n\n// ------------------------------------------------------------------------\n\n/**\n * Get Cache Metadata\n *\n * @param   mixed       key to get cache metadata on\n * @return  mixed       FALSE on failure, array on success.\n */\npublic function get_metadata($id)\n{\n    $stored = $this->_memcached->get($id);\n\n    if (count($stored) !== 3)\n    {\n        return FALSE;\n    }\n\n    list($data, $time, $ttl) = $stored;\n\n    return array(\n        'expire'    => $time + $ttl,\n        'mtime'     => $time,\n        'data'      => $data\n    );\n}\n\n// ------------------------------------------------------------------------\n\n/**\n * Setup memcached.\n */\nprivate function _setup_memcached()\n{\n    // Try to load memcached server info from the config file.\n    $CI =& get_instance();\n\n    if ($CI->config->load('memcached', TRUE, TRUE))\n    {\n        if (is_array($CI->config->config['memcached']))\n        {\n            $this->_memcache_conf = NULL;\n\n            foreach ($CI->config->config['memcached'] as $name => $conf)\n            {\n                $this->_memcache_conf[$name] = $conf;\n            }               \n        }           \n    }\n\n    if(class_exists('Memcached')) {\n        $this->_memcached = new Memcached();\n    } else if(class_exists('Memcache')) {\n        $this->_memcached = new Memcache();\n    } else {\n        show_error('Can\\'t create Memcached object.');\n        return FALSE;\n    }\n\n    foreach ($this->_memcache_conf['memcached'] as $name => $cache_server)\n    {\n        if ( ! array_key_exists('host', $cache_server))\n        {\n            $cache_server['host'] = $this->_default_options['host'];\n        }\n\n        if ( ! array_key_exists('port', $cache_server))\n        {\n            $cache_server['port'] = $this->_default_options['port'];\n        }\n\n        if ( ! array_key_exists('weight', $cache_server))\n        {\n            $cache_server['weight'] = $this->_default_options['weight'];\n        }\n\n        $this->_memcached->addServer(\n                $cache_server['host'], $cache_server['port'], $cache_server['weight']\n        );\n    }\n}\n\n// ------------------------------------------------------------------------\n\n\n/**\n * Is supported\n *\n * Returns FALSE if memcached is not supported on the system.\n * If it is, we setup the memcached object & return TRUE\n */\npublic function is_supported()\n{\n\n    if ( ! extension_loaded('memcache') && !extension_loaded('memcached'))\n    {\n        log_message('error', 'The Memcached Extension must be loaded to use Memcached Cache.');\n\n        return FALSE;\n    }\n\n    $this->_setup_memcached();\n    return TRUE;\n}\n\n// ------------------------------------------------------------------------\n```\n\n}\n// End Class\n\n/\\* End of file Cache_memcached.php _/\n/_ Location: ./system/libraries/Cache/drivers/Cache_memcached.php */\n}}}\n","closed_by":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/45/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/45/timeline","performed_via_github_app":null,"state_reason":"completed"}