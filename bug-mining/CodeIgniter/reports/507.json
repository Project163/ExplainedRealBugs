{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5435","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5435/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5435/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5435/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/5435","id":303403560,"node_id":"MDU6SXNzdWUzMDM0MDM1NjA=","number":5435,"title":"Field data returns one-less fields after query with limit","user":{"login":"NaldoRay","id":10150984,"node_id":"MDQ6VXNlcjEwMTUwOTg0","avatar_url":"https://avatars.githubusercontent.com/u/10150984?v=4","gravatar_id":"","url":"https://api.github.com/users/NaldoRay","html_url":"https://github.com/NaldoRay","followers_url":"https://api.github.com/users/NaldoRay/followers","following_url":"https://api.github.com/users/NaldoRay/following{/other_user}","gists_url":"https://api.github.com/users/NaldoRay/gists{/gist_id}","starred_url":"https://api.github.com/users/NaldoRay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NaldoRay/subscriptions","organizations_url":"https://api.github.com/users/NaldoRay/orgs","repos_url":"https://api.github.com/users/NaldoRay/repos","events_url":"https://api.github.com/users/NaldoRay/events{/privacy}","received_events_url":"https://api.github.com/users/NaldoRay/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":140924,"node_id":"MDU6TGFiZWwxNDA5MjQ=","url":"https://api.github.com/repos/bcit-ci/CodeIgniter/labels/Bug","name":"Bug","color":"eb2420","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/19","html_url":"https://github.com/bcit-ci/CodeIgniter/milestone/19","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/milestones/19/labels","id":3079510,"node_id":"MDk6TWlsZXN0b25lMzA3OTUxMA==","number":19,"title":"3.1.8","description":"","creator":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":6,"state":"closed","created_at":"2018-01-31T21:55:50Z","updated_at":"2018-04-23T11:34:25Z","due_on":null,"closed_at":"2018-04-13T10:06:12Z"},"comments":3,"created_at":"2018-03-08T09:01:44Z","updated_at":"2018-03-15T14:29:53Z","closed_at":"2018-03-10T04:39:18Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm extending the `query()` from core oci8 driver and I've found bug on `$result->field_data()` (`$result` is an `oci8_result` returned from `parent::query()` method).\r\nThe `field_data()` is returning one less fields on subsequent queries after doing select query with `limit()`.\r\n\r\nHere's the scenario where it failed:\r\n```\r\n// query with limit\r\n$db->limit(5)->get('TABLE'); // field_data() returns full fields here\r\n\r\n// subsequent query\r\n$db->get('TABLE'); // field_data() returns one-less fields\r\n```\r\n\r\nHere's how I extends the query() and found the bug:\r\n```\r\npublic function query($sql, $binds = FALSE, $return_object = NULL)\r\n{\r\n\t$result = parent::query($sql, $binds, $return_object);\r\n        // ............\r\n        $field_data = $result->field_data();\r\n       // dump field_data to check the fields, second query will return one-less fields\r\n       var_dump($field_data); \r\n}\r\n```\r\nAfter I trace oci8 driver files, I found that `$this->limit_used` is not reset to `FALSE` after select query is reset. Why it matters? When `$this->limit_used` is `TRUE`,  number of fields that being returned by `field_data()` will be subtracted by 1.\r\n\r\nSo my fix / workaround is by adding/overriding `_reset_select()` method on `oci8_driver`\r\n```\r\nprotected function _reset_select ()\r\n{\r\n        parent::_reset_select();\r\n        $this->limit_used = false;\r\n}\r\n```\r\n\r\nNote that this problem occurs only with `oci8` driver.\r\nI hope it's already fixed in future release. \r\nThanks.","closed_by":{"login":"NaldoRay","id":10150984,"node_id":"MDQ6VXNlcjEwMTUwOTg0","avatar_url":"https://avatars.githubusercontent.com/u/10150984?v=4","gravatar_id":"","url":"https://api.github.com/users/NaldoRay","html_url":"https://github.com/NaldoRay","followers_url":"https://api.github.com/users/NaldoRay/followers","following_url":"https://api.github.com/users/NaldoRay/following{/other_user}","gists_url":"https://api.github.com/users/NaldoRay/gists{/gist_id}","starred_url":"https://api.github.com/users/NaldoRay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NaldoRay/subscriptions","organizations_url":"https://api.github.com/users/NaldoRay/orgs","repos_url":"https://api.github.com/users/NaldoRay/repos","events_url":"https://api.github.com/users/NaldoRay/events{/privacy}","received_events_url":"https://api.github.com/users/NaldoRay/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/5435/timeline","performed_via_github_app":null,"state_reason":"completed"}