{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3317","repository_url":"https://api.github.com/repos/bcit-ci/CodeIgniter","labels_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3317/labels{/name}","comments_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3317/comments","events_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3317/events","html_url":"https://github.com/bcit-ci/CodeIgniter/issues/3317","id":48079796,"node_id":"MDU6SXNzdWU0ODA3OTc5Ng==","number":3317,"title":"Encrypted Sessions in XAMPP","user":{"login":"katie1348","id":4849251,"node_id":"MDQ6VXNlcjQ4NDkyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/4849251?v=4","gravatar_id":"","url":"https://api.github.com/users/katie1348","html_url":"https://github.com/katie1348","followers_url":"https://api.github.com/users/katie1348/followers","following_url":"https://api.github.com/users/katie1348/following{/other_user}","gists_url":"https://api.github.com/users/katie1348/gists{/gist_id}","starred_url":"https://api.github.com/users/katie1348/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/katie1348/subscriptions","organizations_url":"https://api.github.com/users/katie1348/orgs","repos_url":"https://api.github.com/users/katie1348/repos","events_url":"https://api.github.com/users/katie1348/events{/privacy}","received_events_url":"https://api.github.com/users/katie1348/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2014-11-07T13:07:38Z","updated_at":"2016-08-12T06:13:56Z","closed_at":"2014-11-07T13:14:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have just updated my old Codeigniter 2.x installation to 3.0.\n\nMy development system runs under XAMPP and this too has been updated to the latest 1.8.3, for PHP 5.5.15.\n\nThis is fine, it all works nicely so there is no problem.\n\nAs I move through switching things on with the existing project, I find that there is a problem using Encryption with the Session cookie class.\n\nBy default the system uses AES-128 with CBC. Fine, except that XAMPP does not have AES-128!\n\nThe available ciphers are: **cast-128 gost rijndael-128 twofish cast-256 loki97 rijndael-192 saferplus wake blowfish-compat des rijndael-256 serpent xtea blowfish enigma rc2 tripledes arcfour**\n\nAs per my phpinfo().\n\nSo, I need to change the cipher used. Not a problem you say, just ....\n\nWhich is possible of course, but I have added and am proposing that we add in some additional config paramenters, so that it can be easily controlled from the static config file.\n\n``` php\n/*\n|--------------------------------------------------------------------------\n| Encryption Key\n|--------------------------------------------------------------------------\n|\n| If you use the Encryption class or the Session class you\n| MUST set an encryption key.  See the user guide for info.\n|\n| http://codeigniter.com/user_guide/libraries/encryption.html\n| http://codeigniter.com/user_guide/libraries/sessions.html\n|\n*/\n$config['encryption_key']       = 'key';\n$config['encryption_cipher']    = 'aes-128';\n$config['encryption_mode']      = 'cbc';\n```\n\nThat takes care of the default values, which are the same as current.\n\nThen add these few lines into the __constructor\n\n``` php\n        if (self::strlen($cipher = config_item('encryption_cipher')) > 0)\n        {\n            $this->_cipher = $cipher;\n        }\n\n        if (self::strlen($mode = config_item('encryption_mode')) > 0)\n        {\n            $this->_mode = $mode;\n        }\n```\n\nto give \n\n``` php\n    public function __construct(array $params = array())\n    {\n        $this->_drivers = array(\n            'mcrypt' => defined('MCRYPT_DEV_URANDOM'),\n            // While OpenSSL is available for PHP 5.3.0, an IV parameter\n            // for the encrypt/decrypt functions is only available since 5.3.3\n            'openssl' => (is_php('5.3.3') && extension_loaded('openssl'))\n        );\n\n        if ( ! $this->_drivers['mcrypt'] && ! $this->_drivers['openssl'])\n        {\n            return show_error('Encryption: Unable to find an available encryption driver.');\n        }\n\n        if (self::strlen($cipher = config_item('encryption_cipher')) > 0)\n        {\n            $this->_cipher = $cipher;\n        }\n\n        if (self::strlen($mode = config_item('encryption_mode')) > 0)\n        {\n            $this->_mode = $mode;\n        }\n\n        isset(self::$func_override) OR self::$func_override = (extension_loaded('mbstring') && ini_get('mbstring.func_override'));\n        $this->initialize($params);\n\n        if ( ! isset($this->_key) && self::strlen($key = config_item('encryption_key')) > 0)\n        {\n            $this->_key = substr($key, 0, 32);\n        }\n\n        log_message('debug', 'Encryption Class Initialized');\n    }\n```\n\n``` php\n$config['encryption_cipher']    = 'rijndael-128';\n$config['encryption_mode']      = 'cbc';\n```\n\nA mcrypt cipher is now supported and all is well with the world.\n\nThis might not be the best way to do it, but it seems to work nicely.\n\nAny additional guidance, as to the best way to change this would be appreciated if this is the wrong way.\n\nThanks\n","closed_by":{"login":"narfbg","id":1058011,"node_id":"MDQ6VXNlcjEwNTgwMTE=","avatar_url":"https://avatars.githubusercontent.com/u/1058011?v=4","gravatar_id":"","url":"https://api.github.com/users/narfbg","html_url":"https://github.com/narfbg","followers_url":"https://api.github.com/users/narfbg/followers","following_url":"https://api.github.com/users/narfbg/following{/other_user}","gists_url":"https://api.github.com/users/narfbg/gists{/gist_id}","starred_url":"https://api.github.com/users/narfbg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/narfbg/subscriptions","organizations_url":"https://api.github.com/users/narfbg/orgs","repos_url":"https://api.github.com/users/narfbg/repos","events_url":"https://api.github.com/users/narfbg/events{/privacy}","received_events_url":"https://api.github.com/users/narfbg/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bcit-ci/CodeIgniter/issues/3317/timeline","performed_via_github_app":null,"state_reason":"completed"}