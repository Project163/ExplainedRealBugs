<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:27:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-7086] Injecting Spring bean may cause ClassCastException</title>
                <link>https://issues.apache.org/jira/browse/WICKET-7086</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;IssueSummary%3A&quot;&gt;&lt;/a&gt;Issue Summary:&lt;/h3&gt;

&lt;p&gt;The &lt;tt&gt;getBeanNameOfClass()&lt;/tt&gt; method used for injecting Spring beans into Wicket components has a limitation when dealing with generic collection fields. The method is designed to look up a bean name based on the raw type of the collection (e.g., &lt;tt&gt;List&lt;/tt&gt;). However, in scenarios where there are beans with more specific generic types (e.g., &lt;tt&gt;List&amp;lt;SomeClass&amp;gt;&lt;/tt&gt;), the method incorrectly resolves and injects the bean, leading to potential &lt;tt&gt;ClassCastException&lt;/tt&gt; issues at runtime.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;ProblemDetails%3A&quot;&gt;&lt;/a&gt;Problem Details:&lt;/h3&gt;

&lt;p&gt;When the field class is a generic collection (e.g., &lt;tt&gt;List&amp;lt;AnyClass&amp;gt;&lt;/tt&gt;), the &lt;tt&gt;getBeanNameOfClass()&lt;/tt&gt; method resolves a bean with the type of the raw collection (e.g., &lt;tt&gt;List&lt;/tt&gt;). This behavior generally works as intended. However, when there are beans with more specific generic types (e.g., &lt;tt&gt;List&amp;lt;SomeClass&amp;gt;&lt;/tt&gt;), the method incorrectly identifies and injects the bean, even if the generic types (&lt;tt&gt;SomeClass&lt;/tt&gt; and &lt;tt&gt;AnyClass&lt;/tt&gt;) do not match. This results in unexpected behavior and may cause &lt;tt&gt;ClassCastException&lt;/tt&gt; errors later in the application.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;ReproductionScenario%3A&quot;&gt;&lt;/a&gt;Reproduction Scenario:&lt;/h3&gt;

&lt;p&gt;This issue becomes apparent when using Apache Causeway in conjunction with Spring Data REST.&#160; There is a bean named &lt;tt&gt;defaultMessageConverters&lt;/tt&gt; (wich is a List) is inserted into &lt;tt&gt;CausewayWicketApplication&lt;/tt&gt; within the &lt;tt&gt;applicationInitializers&lt;/tt&gt; field, it is erroneously resolved based on the raw type, leading to improper injection.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;ProposedSolution%3A&quot;&gt;&lt;/a&gt;Proposed Solution:&lt;/h3&gt;

&lt;p&gt;Review and enhance the &lt;tt&gt;getBeanNameOfClass()&lt;/tt&gt; method to consider generic types more accurately, ensuring that beans are resolved based on compatibility with the field&apos;s specific generic type.&#160;&lt;/p&gt;

&lt;p&gt;Problem is here:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; names = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(
    Arrays.asList(BeanFactoryUtils.beanNamesForTypeIncludingAncestors(ctx, clazz)));
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It uses the clazz, without generic.&lt;/p&gt;

&lt;p&gt;Possible solution:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ResolvableType resolvableType = &lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt; != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? ResolvableType.forClassWithGenerics(clazz, &lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;) : ResolvableType.forClass(clazz);
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; names = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(
    Arrays.asList(BeanFactoryUtils.beanNamesForTypeIncludingAncestors(ctx, resolvableType)));
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It is compatible with Spring from 4.2.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;AdditionalContext%3A&quot;&gt;&lt;/a&gt;Additional Context:&lt;/h3&gt;

&lt;p&gt;This problem affects scenarios where generic collections are used in Spring-Wicket integration, and it becomes particularly prominent when Apache Causeway is utilized alongside Spring Data REST.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13558392">WICKET-7086</key>
            <summary>Injecting Spring bean may cause ClassCastException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="gyorfimi">Mikl&#243;s Gy&#337;rfi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Nov 2023 11:18:10 +0000</created>
                <updated>Mon, 4 Dec 2023 09:14:27 +0000</updated>
                            <resolved>Mon, 4 Dec 2023 07:25:12 +0000</resolved>
                                    <version>9.15.0</version>
                                    <fixVersion>10.0.0</fixVersion>
                    <fixVersion>9.17.0</fixVersion>
                                    <component>wicket-spring</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17787171" author="mgrigorov" created="Fri, 17 Nov 2023 12:23:23 +0000"  >&lt;p&gt;Any chance you could provide a mini reproducer ? (Hopefully without Causeway!)&lt;/p&gt;</comment>
                            <comment id="17787194" author="gyorfimi" created="Fri, 17 Nov 2023 13:17:54 +0000"  >&lt;p&gt;I added a small Spring Boot project, hopefully helps. Gradle project,&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;./gradlew bootRun&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;starts, and shows ClassCastException.&#160;&lt;/p&gt;

&lt;p&gt;Comments are in src/main/java/com/example/repro/ReproApplication.java to clarify the situation.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17788752" author="jira-bot" created="Wed, 22 Nov 2023 12:35:08 +0000"  >&lt;p&gt;Commit f899d4e13707f65ec00ae8e2fe590251093b0eed in wicket&apos;s branch refs/heads/wicket-7086-better-support-for-manual-injection-with-generics from Martin Tzvetanov Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f899d4e137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f899d4e137&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7086&quot; title=&quot;Injecting Spring bean may cause ClassCastException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7086&quot;&gt;&lt;del&gt;WICKET-7086&lt;/del&gt;&lt;/a&gt;: Injecting Spring bean may cause ClassCastException&lt;/p&gt;

&lt;p&gt;Signed-off-by: Martin Tzvetanov Grigorov &amp;lt;mgrigorov@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17788754" author="jira-bot" created="Wed, 22 Nov 2023 12:35:51 +0000"  >&lt;p&gt;Commit b05bd2c3692594e996bbca7e05fd89694aa80b82 in wicket&apos;s branch refs/heads/wicket-7086-better-support-for-manual-injection-with-generics from Martin Tzvetanov Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=b05bd2c369&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=b05bd2c369&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7086&quot; title=&quot;Injecting Spring bean may cause ClassCastException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7086&quot;&gt;&lt;del&gt;WICKET-7086&lt;/del&gt;&lt;/a&gt;: Injecting Spring bean may cause ClassCastException&lt;/p&gt;

&lt;p&gt;Signed-off-by: Martin Tzvetanov Grigorov &amp;lt;mgrigorov@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17788755" author="githubbot" created="Wed, 22 Nov 2023 12:35:51 +0000"  >&lt;p&gt;martin-g opened a new pull request, #709:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/709&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/709&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   (no comment)&lt;/p&gt;

</comment>
                            <comment id="17792675" author="githubbot" created="Mon, 4 Dec 2023 07:24:01 +0000"  >&lt;p&gt;martin-g merged PR #709:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/709&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/709&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17792676" author="jira-bot" created="Mon, 4 Dec 2023 07:24:04 +0000"  >&lt;p&gt;Commit ef8ebe0f9adf21aa35cf8b522bc1f1086866a3ff in wicket&apos;s branch refs/heads/master from Martin Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=ef8ebe0f9a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=ef8ebe0f9a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7086&quot; title=&quot;Injecting Spring bean may cause ClassCastException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7086&quot;&gt;&lt;del&gt;WICKET-7086&lt;/del&gt;&lt;/a&gt;: Injecting Spring bean may cause ClassCastException (#709)&lt;/p&gt;

&lt;p&gt;Signed-off-by: Martin Tzvetanov Grigorov &amp;lt;mgrigorov@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17792681" author="jira-bot" created="Mon, 4 Dec 2023 07:25:06 +0000"  >&lt;p&gt;Commit 262cf30fcad32192512811109829758742fa0609 in wicket&apos;s branch refs/heads/wicket-9.x from Martin Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=262cf30fca&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=262cf30fca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7086&quot; title=&quot;Injecting Spring bean may cause ClassCastException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7086&quot;&gt;&lt;del&gt;WICKET-7086&lt;/del&gt;&lt;/a&gt;: Injecting Spring bean may cause ClassCastException (#709)&lt;/p&gt;

&lt;p&gt;Signed-off-by: Martin Tzvetanov Grigorov &amp;lt;mgrigorov@apache.org&amp;gt;&lt;br/&gt;
(cherry picked from commit ef8ebe0f9adf21aa35cf8b522bc1f1086866a3ff)&lt;/p&gt;</comment>
                            <comment id="17792742" author="jira-bot" created="Mon, 4 Dec 2023 09:14:27 +0000"  >&lt;p&gt;Commit 694c95ca60c4a0ca3b7bbfd5af9df4190238ec34 in wicket&apos;s branch refs/heads/wicket-9.x from Martin Tzvetanov Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=694c95ca60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=694c95ca60&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7086&quot; title=&quot;Injecting Spring bean may cause ClassCastException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7086&quot;&gt;&lt;del&gt;WICKET-7086&lt;/del&gt;&lt;/a&gt;: Fix the build for wicket-9.x&lt;/p&gt;

&lt;p&gt;Replace jakarta.* with javax.*&lt;br/&gt;
Implement ApplicationContextMock#getBeanNamesForType(ResolvableType, ...) methods&lt;/p&gt;

&lt;p&gt;Signed-off-by: Martin Tzvetanov Grigorov &amp;lt;mgrigorov@apache.org&amp;gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13064483" name="repro.tgz" size="65261" author="gyorfimi" created="Fri, 17 Nov 2023 13:14:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1loi0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>