{"url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/28","repository_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/28/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/28/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/28/events","html_url":"https://github.com/FasterXML/jackson-dataformats-binary/issues/28","id":174025787,"node_id":"MDU6SXNzdWUxNzQwMjU3ODc=","number":28,"title":"Java float deserialized as `DoubleNode` instance","user":{"login":"teabot","id":228950,"node_id":"MDQ6VXNlcjIyODk1MA==","avatar_url":"https://avatars.githubusercontent.com/u/228950?v=4","gravatar_id":"","url":"https://api.github.com/users/teabot","html_url":"https://github.com/teabot","followers_url":"https://api.github.com/users/teabot/followers","following_url":"https://api.github.com/users/teabot/following{/other_user}","gists_url":"https://api.github.com/users/teabot/gists{/gist_id}","starred_url":"https://api.github.com/users/teabot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/teabot/subscriptions","organizations_url":"https://api.github.com/users/teabot/orgs","repos_url":"https://api.github.com/users/teabot/repos","events_url":"https://api.github.com/users/teabot/events{/privacy}","received_events_url":"https://api.github.com/users/teabot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/milestones/5","html_url":"https://github.com/FasterXML/jackson-dataformats-binary/milestone/5","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/milestones/5/labels","id":1976594,"node_id":"MDk6TWlsZXN0b25lMTk3NjU5NA==","number":5,"title":"2.8.3","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":1,"state":"open","created_at":"2016-09-01T03:30:21Z","updated_at":"2016-09-01T03:30:21Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2016-08-30T13:56:27Z","updated_at":"2016-09-01T03:47:16Z","closed_at":"2016-09-01T03:30:13Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When parsing JSON documents with a schema described by suitably annotated Java POJO classes, Jackson represents `float` values with `DoubleNode` instances, not `FloatNode` instances as might be expected. This causes problems with other downstream libraries that attempt to interpret the node tree. There are situations where they may call `isFloat()` on the respective nodes, expecting it to return `true` for nodes that were derived from `float` properties. However, in these circumstances `DoubleNode.isFloat()` is invoked yielding a return value of `false` and causing said libraries to raise an error.\n\nI believe I have traced this behaviour back to: [`com.fasterxml.jackson.databind.deser.std.BaseNodeDeserializer._fromFloat(...)`](https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/deser/std/JsonNodeDeserializer.java#L383)\n\nThe last call to the `nodeFactory` returns a `DoubleNode` not a `FloatNode`. I wonder if this should instead be implemented in a similar manner to [`_fromInt(...)`](https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/deser/std/JsonNodeDeserializer.java#L339) like so:\n\n```\n    protected final JsonNode _fromFloat(JsonParser p, DeserializationContext ctxt,\n            final JsonNodeFactory nodeFactory) throws IOException\n    {\n        JsonParser.NumberType nt = p.getNumberType();\n        if (nt == JsonParser.NumberType.BIG_DECIMAL\n            || ctxt.isEnabled(DeserializationFeature.USE_BIG_DECIMAL_FOR_FLOATS)) {\n            return nodeFactory.numberNode(p.getDecimalValue());\n        }\n        if (nt == JsonParser.NumberType.DOUBLE) {              // PROPOSED CHANGE\n            return nodeFactory.numberNode(p.getDoubleValue()); // PROPOSED CHANGE\n        }                                                      // PROPOSED CHANGE\n        return nodeFactory.numberNode(p.getFloatValue());      // PROPOSED CHANGE\n    }\n```\n\nI am currently working around this by patching the downstream library to do something like this:\n\n```\nif (node.isDouble() && node.doubleValue() >= -Float.MAX_VALUE\n    && node.doubleValue() <= Float.MAX_VALUE || node.isFloat()) {\n        return datum.floatValue();\n```\n\nReference: [problem discussion on jackson-user](https://groups.google.com/forum/#!msg/jackson-user/M6UUyfOGmq8/7Q7DNQq5FQAJ)\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/28/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/28/timeline","performed_via_github_app":null,"state_reason":"completed"}