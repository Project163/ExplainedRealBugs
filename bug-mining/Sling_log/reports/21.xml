<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:37:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SLING-3185] ClassCastException in o.a.s.commons.log&apos;s LogbackManager at bundle activation</title>
                <link>https://issues.apache.org/jira/browse/SLING-3185</link>
                <project id="12310710" key="SLING">Sling</project>
                    <description>&lt;p&gt;with the initial launchpad runmodes patch of &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-3155&quot; title=&quot;Switch launchpad between Jackrabbit and Oak based on run modes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-3155&quot;&gt;&lt;del&gt;SLING-3155&lt;/del&gt;&lt;/a&gt;, the org.apache.sling.commons.log bundle does not start initially, due to a ClassCastException in Logback manager.&lt;/p&gt;

&lt;p&gt;Note that there is a circular dependency between this bundle and slf4j.api:&lt;/p&gt;

&lt;p&gt;commons log imports org.slf4j,version=1.6.4 from slf4j.api&lt;/p&gt;

&lt;p&gt;slf4j.api imports org.slf4j.impl,version=1.6.4 from org.apache.sling.commons.log&lt;/p&gt;</description>
                <environment></environment>
        <key id="12674301">SLING-3185</key>
            <summary>ClassCastException in o.a.s.commons.log&apos;s LogbackManager at bundle activation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bdelacretaz">Bertrand Delacretaz</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Oct 2013 12:02:34 +0000</created>
                <updated>Fri, 7 Mar 2014 06:16:22 +0000</updated>
                            <resolved>Thu, 17 Oct 2013 13:40:55 +0000</resolved>
                                    <version>Commons Log 3.0.0</version>
                                    <fixVersion>Commons Log 4.0.0</fixVersion>
                                    <component>Commons</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13797828" author="bdelacretaz" created="Thu, 17 Oct 2013 12:16:18 +0000"  >&lt;p&gt;What happens at startup of my patched launchpad is&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[Loaded org.slf4j.helpers.SubstituteLoggerFactory from slinginstall:slf4j-api-1.6.4.jar]

[Loaded ch.qos.logback.classic.LoggerContext from slinginstall:org.apache.sling.commons.log-3.0.3-SNAPSHOT.jar]

*ERROR* [FelixStartLevel] ERROR: Error starting slinginstall:org.apache.sling.commons.log-3.0.3-SNAPSHOT.jar (java.lang.ClassCastException: org.slf4j.helpers.SubstituteLoggerFactory cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to ch.qos.logback.classic.LoggerContext)
  at org.apache.sling.commons.log.logback.internal.LogbackManager.&amp;lt;init&amp;gt;(LogbackManager.java:101)
  at org.apache.sling.commons.log.logback.internal.Activator.start(Activator.java:55)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;According to Chetan, logback uses its own classloader, that&apos;s probably what causes the ClassCastException.&lt;/p&gt;

&lt;p&gt;Once Sling starts, the commons.log bundle starts without problems.&lt;/p&gt;</comment>
                            <comment id="13797877" author="chetanm" created="Thu, 17 Oct 2013 13:18:28 +0000"  >&lt;p&gt;The issue occurs because of the way SLF4J performs initialization. When it is asked for the logger for the very first time it triggers the initialization of Logging layer and sets its state to &lt;tt&gt;ONGOING_INITILIZATION&lt;/tt&gt;. Now untill it gets initialized if any other thread asks for Logger then it returns a logger obtained from &lt;tt&gt;SubstituteLoggerFactory&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This logger factory gets swapped with actual LoggerFactory when initialization is complete. See also &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;So what happens here that by the time Sling LogbackManager tries to obtain the LoggerFactory the initialization was not complete and it got &lt;tt&gt;SubstituteLoggerFactory&lt;/tt&gt; instead of Logback&apos;s &lt;tt&gt;LoggerContext&lt;/tt&gt; resulting in CCE&lt;/p&gt;

&lt;p&gt;As a fix we now make a call to &lt;tt&gt;StaticLoggerBinder.getSingleton();&lt;/tt&gt; which ensures that by the time this call returns the Logback based Logger implementation is binded to SLF4J as it is done in a static initializer &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://bugzilla.slf4j.org/show_bug.cgi?id=106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugzilla.slf4j.org/show_bug.cgi?id=106&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13797903" author="bdelacretaz" created="Thu, 17 Oct 2013 13:40:55 +0000"  >&lt;p&gt;Patch committed in revision 1533079, it does indeed fix my issue, thanks for your contribution!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12672989">SLING-3155</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12674500">SLING-3189</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12608925" name="SLING-3185.patch" size="3022" author="chetanm" created="Thu, 17 Oct 2013 13:18:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1p0o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354215</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>