<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:37:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SLING-7529] Log message layouts are not property inherited</title>
                <link>https://issues.apache.org/jira/browse/SLING-7529</link>
                <project id="12310710" key="SLING">Sling</project>
                    <description>&lt;p&gt;Steps to reproduce on AEM 6.3 with Apache Sling Commons Log 5.1.2:&lt;br/&gt;
1. Create&#160;Logger Configuration for Logger &quot;my.project&quot;, log file &quot;error.log&quot;, log level &apos;Information&quot; and message pattern &quot;My project: {5}&quot;&lt;br/&gt;
2. Create an Slf4J logger for class my.project.Sample and use it to infolog message &quot;test foo&quot;&lt;br/&gt;
3. Change the configuration created in step 1 - update logger to &quot;my.project.Sample&quot;&lt;br/&gt;
4. Use the logger created in step 2 to infolog message &quot;test bar&quot;&lt;/p&gt;

&lt;p&gt;Expected result:&lt;br/&gt;
5. error.log file would contain messages &quot;My project: test foo&quot; and &quot;My project: test bar&quot;&lt;/p&gt;

&lt;p&gt;Actual result:&lt;br/&gt;
5. error.log file contains the message &quot;test foo&quot; in the format configured as the default format, but also contains the message &quot;My project: test bar&quot; - the second message, in the appropriate format.&lt;/p&gt;

&lt;p&gt;Investigation:&lt;br/&gt;
Checking the source code, I&apos;ve discovered the following in class &apos;LoggerSpecificEncoder&apos;, starting from line 47:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Layout&amp;lt;ILoggingEvent&amp;gt; getLayout(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; loggerName) {
        &lt;span class=&quot;code-comment&quot;&gt;// TODO Handle layout inheritance wrt logger names
&lt;/span&gt;        Layout&amp;lt;ILoggingEvent&amp;gt; layout = layoutByCategory.get(loggerName);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (layout == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            layout = defaultLayout;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; layout;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which means that, unless the configuration is created for the exact logger name, the default one will be used - the functionality is not broken, but simply not implemented.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13142084">SLING-7529</key>
            <summary>Log message layouts are not property inherited</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="CptBartender">Fryderyk Wysocki</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Mar 2018 11:38:50 +0000</created>
                <updated>Mon, 26 Mar 2018 13:11:39 +0000</updated>
                            <resolved>Mon, 12 Mar 2018 09:04:40 +0000</resolved>
                                    <version>Commons Log 5.1.2</version>
                                    <fixVersion>Commons Log 5.1.4</fixVersion>
                                    <component>Commons</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16383534" author="githubbot" created="Fri, 2 Mar 2018 12:24:08 +0000"  >&lt;p&gt;CptBartender opened a new pull request #3: &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7529&quot; title=&quot;Log message layouts are not property inherited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7529&quot;&gt;&lt;del&gt;SLING-7529&lt;/del&gt;&lt;/a&gt; - implemented layout inheritance in log encoder&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I&apos;ve implemented a simple method that finds the best (longest) match among the registered layouts and put it in place of the //TODO tag within the code.&lt;/p&gt;

&lt;p&gt;   I did not run the tests as these don&apos;t pass on my environment for unrelated reasons, however the class is not mentioned in any tests so I&apos;m assuming this shouldn&apos;t break existing tests.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16384714" author="githubbot" created="Sat, 3 Mar 2018 16:10:24 +0000"  >&lt;p&gt;chetanmeh commented on issue #3: &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7529&quot; title=&quot;Log message layouts are not property inherited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7529&quot;&gt;&lt;del&gt;SLING-7529&lt;/del&gt;&lt;/a&gt; - implemented layout inheritance in log encoder&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-370158930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-370158930&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Looks fine. Can you add a test case for the same&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16385871" author="githubbot" created="Mon, 5 Mar 2018 09:53:44 +0000"  >&lt;p&gt;CptBartender commented on issue #3: &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7529&quot; title=&quot;Log message layouts are not property inherited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7529&quot;&gt;&lt;del&gt;SLING-7529&lt;/del&gt;&lt;/a&gt; - implemented layout inheritance in log encoder&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-370366380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-370366380&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @chetanmeh I&apos;ve added some simple JUnit tests as well as fixed one conrnercase where loggers for similarly-named packages might end up using wrong layouts - probably wouldn&apos;t occur in AEM setup, but it theoretically can happen and thus is a bug - I&apos;ve added a test case for it as well.&lt;/p&gt;

&lt;p&gt;   If the code is ok as-is, then please let me know if it would be possible to release it soon as 5.1.3, otherwise please let me know your thoughts on the code.&lt;/p&gt;

&lt;p&gt;   Cheers&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16392622" author="githubbot" created="Fri, 9 Mar 2018 09:03:44 +0000"  >&lt;p&gt;CptBartender commented on issue #3: &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7529&quot; title=&quot;Log message layouts are not property inherited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7529&quot;&gt;&lt;del&gt;SLING-7529&lt;/del&gt;&lt;/a&gt; - implemented layout inheritance in log encoder&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-371754265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-371754265&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @chetanmeh : any chance you could find some time to take a look at the update to this PR?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16392658" author="githubbot" created="Fri, 9 Mar 2018 09:46:02 +0000"  >&lt;p&gt;chetanmeh commented on issue #3: &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7529&quot; title=&quot;Log message layouts are not property inherited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7529&quot;&gt;&lt;del&gt;SLING-7529&lt;/del&gt;&lt;/a&gt; - implemented layout inheritance in log encoder&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-371764459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-371764459&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @CptBartender Sorry for the delay here. Would look into this early next week&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16394932" author="githubbot" created="Mon, 12 Mar 2018 08:04:36 +0000"  >&lt;p&gt;chetanmeh commented on issue #3: &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7529&quot; title=&quot;Log message layouts are not property inherited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7529&quot;&gt;&lt;del&gt;SLING-7529&lt;/del&gt;&lt;/a&gt; - implemented layout inheritance in log encoder&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-372222722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-372222722&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @CptBartender Can you add license headers on the newly added files in test. Without that build fails for `mvn verfiy` in RAT check&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16394965" author="githubbot" created="Mon, 12 Mar 2018 08:57:43 +0000"  >&lt;p&gt;CptBartender commented on issue #3: &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7529&quot; title=&quot;Log message layouts are not property inherited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7529&quot;&gt;&lt;del&gt;SLING-7529&lt;/del&gt;&lt;/a&gt; - implemented layout inheritance in log encoder&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-372235458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3#issuecomment-372235458&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @chetanmeh I&apos;ve added the requested headers&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16394969" author="githubbot" created="Mon, 12 Mar 2018 09:02:53 +0000"  >&lt;p&gt;chetanmeh closed pull request #3: &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7529&quot; title=&quot;Log message layouts are not property inherited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7529&quot;&gt;&lt;del&gt;SLING-7529&lt;/del&gt;&lt;/a&gt; - implemented layout inheritance in log encoder&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-log/pull/3&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/src/main/java/org/apache/sling/commons/log/logback/internal/util/LoggerSpecificEncoder.java b/src/main/java/org/apache/sling/commons/log/logback/internal/util/LoggerSpecificEncoder.java&lt;br/&gt;
index 702acf8..996a5b0 100644&lt;br/&gt;
&amp;#8212; a/src/main/java/org/apache/sling/commons/log/logback/internal/util/LoggerSpecificEncoder.java&lt;br/&gt;
+++ b/src/main/java/org/apache/sling/commons/log/logback/internal/util/LoggerSpecificEncoder.java&lt;br/&gt;
@@ -45,12 +45,24 @@ public LoggerSpecificEncoder(Layout&amp;lt;ILoggingEvent&amp;gt; defaultLayout) {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     private Layout&amp;lt;ILoggingEvent&amp;gt; getLayout(String loggerName) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// TODO Handle layout inheritance wrt logger names&lt;/li&gt;
	&lt;li&gt;Layout&amp;lt;ILoggingEvent&amp;gt; layout = layoutByCategory.get(loggerName);&lt;/li&gt;
	&lt;li&gt;if (layout == null) 
{
-            layout = defaultLayout;
+        String bestMatchLayoutKey = getBestMatchLayoutKey(loggerName);
+        return layoutByCategory.getOrDefault(bestMatchLayoutKey, defaultLayout);
+    }
&lt;p&gt;+&lt;br/&gt;
+    private String getBestMatchLayoutKey(String loggerName) {&lt;br/&gt;
+        if (layoutByCategory.containsKey(loggerName)) &lt;/p&gt;
{
+            // fastpath for exact name match
+            return loggerName;
+        }
&lt;p&gt;+        String bestMatch = loggerName;&lt;br/&gt;
+        int bestMatchLength = 0;&lt;br/&gt;
+        for (String layoutKey : layoutByCategory.keySet()) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+            if (loggerName.startsWith(layoutKey) &amp;amp;&amp;amp; loggerName.charAt(layoutKey.length()) == &amp;#39;.&amp;#39; &amp;amp;&amp;amp; layoutKey.length() &amp;gt; bestMatchLength) {
+                bestMatch = layoutKey;
+                bestMatchLength = layoutKey.length();
+            }         }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;return layout;&lt;br/&gt;
+        return bestMatch;&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private byte[] convertToBytes(String s) {&lt;br/&gt;
diff --git a/src/test/java/org/apache/sling/commons/log/logback/internal/util/AbstractPatternLayoutWrapper.java b/src/test/java/org/apache/sling/commons/log/logback/internal/util/AbstractPatternLayoutWrapper.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 0000000..93ed24f&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/src/test/java/org/apache/sling/commons/log/logback/internal/util/AbstractPatternLayoutWrapper.java&lt;br/&gt;
@@ -0,0 +1,177 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied.  See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.sling.commons.log.logback.internal.util;&lt;br/&gt;
+&lt;br/&gt;
+import ch.qos.logback.classic.PatternLayout;&lt;br/&gt;
+import ch.qos.logback.classic.spi.ILoggingEvent;&lt;br/&gt;
+import ch.qos.logback.core.Context;&lt;br/&gt;
+import ch.qos.logback.core.pattern.PostCompileProcessor;&lt;br/&gt;
+import ch.qos.logback.core.status.Status;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Abstract wrapper for &lt;/p&gt;
{@link PatternLayout} class. Can be extended to implement &apos;Decorator&apos; design pattern.&lt;br/&gt;
+ *&lt;br/&gt;
+ * @apiNote This has probably no use outside of testing&lt;br/&gt;
+ */&lt;br/&gt;
+public abstract class AbstractPatternLayoutWrapper extends PatternLayout {&lt;br/&gt;
+&lt;br/&gt;
+    protected final PatternLayout wrapped;&lt;br/&gt;
+&lt;br/&gt;
+    protected AbstractPatternLayoutWrapper(final PatternLayout wrapped) {
+        this.wrapped = wrapped;
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public String doLayout(final ILoggingEvent event) {
+        return wrapped.doLayout(event);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public String getFileHeader() {
+        return wrapped.getFileHeader();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public String getPresentationHeader() {
+        return wrapped.getPresentationHeader();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public String getPresentationFooter() {
+        return wrapped.getPresentationFooter();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public String getFileFooter() {
+        return wrapped.getFileFooter();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public String getContentType() {
+        return wrapped.getContentType();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void setContext(final Context context) {
+        wrapped.setContext(context);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public Context getContext() {
+        return wrapped.getContext();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void addStatus(final Status status) {
+        wrapped.addStatus(status);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void addInfo(final String s) {
+        wrapped.addInfo(s);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void addInfo(final String msg, final Throwable ex) {
+        wrapped.addInfo(msg, ex);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void addWarn(final String s) {
+        wrapped.addWarn(s);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void addWarn(final String msg, final Throwable ex) {
+        wrapped.addWarn(msg, ex);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void addError(final String s) {
+        wrapped.addError(s);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void addError(final String msg, final Throwable ex) {
+        wrapped.addError(msg, ex);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void start() {
+        wrapped.start();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void stop() {
+        wrapped.stop();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public boolean isStarted() {
+        return wrapped.isStarted();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public Map&amp;lt;String, String&amp;gt; getDefaultConverterMap() {
+        return wrapped.getDefaultConverterMap();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public Map&amp;lt;String, String&amp;gt; getEffectiveConverterMap() {
+        return wrapped.getEffectiveConverterMap();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void setPostCompileProcessor(PostCompileProcessor&amp;lt;ILoggingEvent&amp;gt; postCompileProcessor) {
+        wrapped.setPostCompileProcessor(postCompileProcessor);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public String getPattern() {
+        return wrapped.getPattern();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void setPattern(String pattern) {
+        wrapped.setPattern(pattern);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public String toString() {
+        return wrapped.toString();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public Map&amp;lt;String, String&amp;gt; getInstanceConverterMap() {
+        return wrapped.getInstanceConverterMap();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public boolean isOutputPatternAsHeader() {
+        return wrapped.isOutputPatternAsHeader();
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public void setOutputPatternAsHeader(boolean outputPatternAsHeader) {
+        wrapped.isOutputPatternAsHeader();
+    }&lt;br/&gt;
+}&lt;br/&gt;
diff --git a/src/test/java/org/apache/sling/commons/log/logback/internal/util/LoggerSpecificEncoderTest.java b/src/test/java/org/apache/sling/commons/log/logback/internal/util/LoggerSpecificEncoderTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 0000000..a32e406&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/src/test/java/org/apache/sling/commons/log/logback/internal/util/LoggerSpecificEncoderTest.java&lt;br/&gt;
@@ -0,0 +1,118 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied.  See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.sling.commons.log.logback.internal.util;&lt;br/&gt;
+&lt;br/&gt;
+import ch.qos.logback.classic.PatternLayout;&lt;br/&gt;
+import ch.qos.logback.classic.spi.ILoggingEvent;&lt;br/&gt;
+import org.apache.felix.framework.util.ImmutableList;&lt;br/&gt;
+import org.apache.sling.commons.log.logback.internal.LogConfig;&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+import org.junit.runner.RunWith;&lt;br/&gt;
+import org.mockito.Mock;&lt;br/&gt;
+import org.mockito.junit.MockitoJUnitRunner;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.HashSet;&lt;br/&gt;
+&lt;br/&gt;
+import static org.hamcrest.Matchers.equalTo;&lt;br/&gt;
+import static org.hamcrest.Matchers.is;&lt;br/&gt;
+import static org.junit.Assert.assertThat;&lt;br/&gt;
+import static org.mockito.Mockito.mock;&lt;br/&gt;
+import static org.mockito.Mockito.when;&lt;br/&gt;
+&lt;br/&gt;
+@RunWith(MockitoJUnitRunner.class)&lt;br/&gt;
+public class LoggerSpecificEncoderTest {&lt;br/&gt;
+&lt;br/&gt;
+    private LoggerSpecificEncoder tested;&lt;br/&gt;
+&lt;br/&gt;
+    @Mock&lt;br/&gt;
+    private ILoggingEvent mockTestEvent;&lt;br/&gt;
+&lt;br/&gt;
+    @Before&lt;br/&gt;
+    public void setUp() {
+        tested = new LoggerSpecificEncoder(new PrefixTestLayout(&quot;DEFAULT:&quot;));
+        when(mockTestEvent.getMessage()).thenReturn(&quot;test message&quot;);
+        when(mockTestEvent.getLoggerName()).thenReturn(&quot;org.apache.sling.testing.FooBar&quot;);
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testShouldReturnWithDefaultLayoutForNoConfigs() {
+        assertThat(tested.encode(mockTestEvent), is(equalTo(&quot;DEFAULT:test message&quot;.getBytes())));
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testShouldIgnoreNonmatchingLayoutCategories() {
+        LogConfig logConfigMock = mock(LogConfig.class);
+        when(logConfigMock.getCategories()).thenReturn(new HashSet&amp;lt;&amp;gt;(ImmutableList.newInstance(&quot;org.apache.commons&quot;, &quot;com.initech.sling&quot;)));
+        when(logConfigMock.createLayout()).thenReturn(new PrefixTestLayout(&quot;INITECH:&quot;));
+        tested.addLogConfig(logConfigMock);
+
+        assertThat(tested.encode(mockTestEvent), is(equalTo(&quot;DEFAULT:test message&quot;.getBytes())));
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testShouldIgnorePartialMatchingPackageName() {
+        LogConfig logConfigMock = mock(LogConfig.class);
+        when(logConfigMock.getCategories()).thenReturn(new HashSet&amp;lt;&amp;gt;(ImmutableList.newInstance(&quot;org.apache.sling.test&quot;)));
+        when(logConfigMock.createLayout()).thenReturn(new PrefixTestLayout(&quot;INITECH:&quot;));
+        tested.addLogConfig(logConfigMock);
+
+        assertThat(tested.encode(mockTestEvent), is(equalTo(&quot;DEFAULT:test message&quot;.getBytes())));
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testShouldUseExactMatchingCategoryLayout() {
+        LogConfig logConfigMock = mock(LogConfig.class);
+        when(logConfigMock.getCategories()).thenReturn(new HashSet&amp;lt;&amp;gt;(ImmutableList.newInstance(&quot;org.apache.sling.testing.FooBar&quot;)));
+        when(logConfigMock.createLayout()).thenReturn(new PrefixTestLayout(&quot;INITECH:&quot;));
+        tested.addLogConfig(logConfigMock);
+
+        assertThat(tested.encode(mockTestEvent), is(equalTo(&quot;INITECH:test message&quot;.getBytes())));
+    }&lt;br/&gt;
+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testShouldUseInheritedCategoryLayout() {
+        LogConfig logConfigMock = mock(LogConfig.class);
+        when(logConfigMock.getCategories()).thenReturn(new HashSet&amp;lt;&amp;gt;(ImmutableList.newInstance(&quot;org.apache&quot;)));
+        when(logConfigMock.createLayout()).thenReturn(new PrefixTestLayout(&quot;INITECH:&quot;));
+        tested.addLogConfig(logConfigMock);
+
+        assertThat(tested.encode(mockTestEvent), is(equalTo(&quot;INITECH:test message&quot;.getBytes())));
+    }&lt;br/&gt;
+&lt;br/&gt;
+    /**&lt;br/&gt;
+     * Simple partial implementation of {@link PatternLayout}
&lt;p&gt; that redirects all method calls that are not explicitly extended to an&lt;br/&gt;
+     * underlying mock (available as a protected &lt;/p&gt;
{@link PrefixTestLayout#wrapped}
&lt;p&gt; field).&lt;br/&gt;
+     */&lt;br/&gt;
+    private static class PrefixTestLayout extends AbstractPatternLayoutWrapper {&lt;br/&gt;
+&lt;br/&gt;
+        private final String prefix;&lt;br/&gt;
+&lt;br/&gt;
+        private PrefixTestLayout(String prefix) &lt;/p&gt;
{
+            super(mock(PatternLayout.class));
+            this.prefix = prefix;
+        }
&lt;p&gt;+&lt;br/&gt;
+        @Override&lt;br/&gt;
+        public String doLayout(ILoggingEvent event) &lt;/p&gt;
{
+            return prefix + event.getMessage();
+        }
&lt;p&gt;+    }&lt;br/&gt;
+}&lt;br/&gt;
\ No newline at end of file&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16394971" author="chetanm" created="Mon, 12 Mar 2018 09:04:40 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=CptBartender&quot; class=&quot;user-hover&quot; rel=&quot;CptBartender&quot;&gt;CptBartender&lt;/a&gt; for the PR. Its now merged to master&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qskf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>