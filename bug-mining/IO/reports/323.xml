<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:28:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-800] Fix back-incompatible change for PathUtils.deleteDirectory(): throw NoSuchFileException instead of IllegalArgumentException</title>
                <link>https://issues.apache.org/jira/browse/IO-800</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;We are trying to upgrade Apache Solr from commons-io 2.11 to 2.13 in &lt;a href=&quot;https://github.com/apache/solr/pull/1653.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/1653.&lt;/a&gt; As you will see in the PR comments and also in the failed &lt;a href=&quot;https://github.com/apache/solr/actions/runs/5209945412/jobs/9400431409?pr=1653&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;test logs&lt;/a&gt;, a call to PathUtils.deleteDirectory on a non-existing directory, behaves differently between those versions.&lt;/p&gt;

&lt;p&gt;This looks like a regression related to refactoring of that method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13539254">IO-800</key>
            <summary>Fix back-incompatible change for PathUtils.deleteDirectory(): throw NoSuchFileException instead of IllegalArgumentException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Jun 2023 11:07:13 +0000</created>
                <updated>Wed, 27 Sep 2023 07:52:30 +0000</updated>
                            <resolved>Thu, 8 Jun 2023 18:01:47 +0000</resolved>
                                    <version>2.12.0</version>
                    <version>2.13.0</version>
                                    <fixVersion>2.14.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17730532" author="janhoy" created="Thu, 8 Jun 2023 12:22:03 +0000"  >&lt;p&gt;I found the root cause. A change in commit &lt;a href=&quot;https://github.com/janhoy/commons-io/commit/dcb09db922e1edbd6dc6cb1531b827451d58aa83#diff-4162512d2bb8d032482958d8dabacc1c2398e95597a49fa5b0fc02aabc8717d6R1248&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Add and use PathUtils.sizeOf(Path)&lt;/a&gt; in sept 2021 added a &lt;a href=&quot;https://github.com/janhoy/commons-io/commit/dcb09db922e1edbd6dc6cb1531b827451d58aa83#diff-4162512d2bb8d032482958d8dabacc1c2398e95597a49fa5b0fc02aabc8717d6R1248&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;requireExists()&lt;/tt&gt;&lt;/a&gt; call to &lt;tt&gt;visitFileTree()&lt;/tt&gt;, changing the behavior for deleting non-existing directories as compared to v2.11.0.&#160;&lt;/p&gt;

&lt;p&gt;Here is a failing test, asserting that we expect IOException here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
From 553438804b227f280aa093c9848392ca226a9141 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jan=20H=C3=B8ydahl?= &amp;lt;janhoy@users.noreply.github.com&amp;gt;
Date: Thu, 8 Jun 2023 14:19:51 +0200
Subject: [PATCH] Test to reproduce IO-800
---
&#160;.../io/file/PathUtilsDeleteDirectoryTest.java &#160; &#160; &#160; &#160;| 12 ++++++++++++
&#160;1 file changed, 12 insertions(+)
diff --git a/src/test/java/org/apache/commons/io/file/PathUtilsDeleteDirectoryTest.java b/src/test/java/org/apache/commons/io/file/PathUtilsDeleteDirectoryTest.java
index 121b2dc013..dd7d840ff9 100644
--- a/src/test/java/org/apache/commons/io/file/PathUtilsDeleteDirectoryTest.java
+++ b/src/test/java/org/apache/commons/io/file/PathUtilsDeleteDirectoryTest.java
@@ -18,9 +18,11 @@
&#160;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.commons.io.file;
&#160;
&#160;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.apache.commons.io.file.CounterAssertions.assertCounts;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.jupiter.api.Assertions.assertThrows;
&#160;
&#160;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
&#160;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Files;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Path;
&#160;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Paths;
&#160;
&#160;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.Test;
@@ -93,4 +95,14 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testDeleteEmptyDirectory() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-comment&quot;&gt;// This will &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not empty.
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160;Files.deleteIfExists(tempDirPath);
&#160; &#160; &#160;}
+
+ &#160;/**
+ &#160; * Non existing directory, https:&lt;span class=&quot;code-comment&quot;&gt;//issues.apache.org/jira/browse/IO-800.
&lt;/span&gt;+ &#160; */
+ &#160;@Test
+ &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void deleteNonExistingDirectory() {
+ &#160; &#160; &#160;assertThrows(IOException.class, () -&amp;gt;
+ &#160; &#160; &#160; &#160; &#160;PathUtils.deleteDirectory(tempDirPath.resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;nonexistent&quot;&lt;/span&gt;))
+ &#160; &#160; &#160;);
+ &#160;}
&#160;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17730544" author="garydgregory" created="Thu, 8 Jun 2023 12:38:27 +0000"  >&lt;p&gt;FYI, I added a test for the current behavior:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/src/test/java/org/apache/commons/io/file/PathUtilsDeleteDirectoryTest.java b/src/test/java/org/apache/commons/io/file/PathUtilsDeleteDirectoryTest.java
index 121b2dc..298e24c 100644
--- a/src/test/java/org/apache/commons/io/file/PathUtilsDeleteDirectoryTest.java
+++ b/src/test/java/org/apache/commons/io/file/PathUtilsDeleteDirectoryTest.java
@@ -18,9 +18,12 @@
 &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.commons.io.file;
 
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.apache.commons.io.file.CounterAssertions.assertCounts;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.jupiter.api.Assertions.assertFalse;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.jupiter.api.Assertions.assertThrows;
 
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Files;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Path;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Paths;
 
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.Test;
@@ -30,6 +33,18 @@
  */
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PathUtilsDeleteDirectoryTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractTempDirTest {
 
+    @Test
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testDeleteAbsentDirectory() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
+        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path absent = tempDirPath.resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;ThisDirectoryDoesNotExist&quot;&lt;/span&gt;);
+        assertFalse(Files.exists(absent));
+        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;IllegalArgumentException&amp;gt; expectedType = IllegalArgumentException.class;
+        assertThrows(expectedType, () -&amp;gt; PathUtils.deleteDirectory(absent));
+        assertThrows(expectedType, () -&amp;gt; PathUtils.deleteDirectory(absent, StandardDeleteOption.OVERRIDE_READ_ONLY));
+        assertThrows(expectedType, () -&amp;gt; PathUtils.deleteDirectory(absent, PathUtils.EMPTY_DELETE_OPTION_ARRAY));
+        &lt;span class=&quot;code-comment&quot;&gt;// This will &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not empty.
&lt;/span&gt;+        Files.deleteIfExists(tempDirPath);
+    }
+
     /**
      * Tests a directory with one file of size 0.
      */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17730545" author="garydgregory" created="Thu, 8 Jun 2023 12:49:53 +0000"  >&lt;p&gt;In some places, we also cause&#160;NIO&apos;s &lt;tt&gt;NoSuchFileException&lt;/tt&gt; to be thrown. The JRE also uses IO&apos;s &lt;tt&gt;FileNotFoundException&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;I wonder if we should reuse one of these for directories instead of &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; or create a  &lt;tt&gt;NoSuchDirectoryException&lt;/tt&gt; for NIO calls and/or &lt;tt&gt;DirectoryNotFoundException&lt;/tt&gt; for IO calls...&lt;/p&gt;</comment>
                            <comment id="17730549" author="janhoy" created="Thu, 8 Jun 2023 13:00:57 +0000"  >&lt;p&gt;My main concern is the unintendend change for a long-existing API, so it should stay the same for the sake of back-compat. The unintendend change not only affects deleteDirectory but all APIs using &lt;tt&gt;visitFileTree&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;My proposed fix is revering the (unrelated) change in the commit referenced above:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/main/java/org/apache/commons/io/file/PathUtils.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&amp;lt;+&amp;gt;ISO-8859-1
===================================================================
diff --git a/src/main/java/org/apache/commons/io/file/PathUtils.java b/src/main/java/org/apache/commons/io/file/PathUtils.java
--- a/src/main/java/org/apache/commons/io/file/PathUtils.java &#160; &#160;(revision d3910a914787db46207886bc6cd3c3ac803a4f76)
+++ b/src/main/java/org/apache/commons/io/file/PathUtils.java &#160; &#160;(date 1686228971841)
@@ -1650,7 +1650,6 @@
&#160; &#160; &#160; * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; NullPointerException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the directory is {@code &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}.
&#160; &#160; &#160; */
&#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; FileVisitor&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; Path&amp;gt;&amp;gt; T visitFileTree(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; T visitor, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path directory) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
- &#160; &#160; &#160; &#160;requireExists(directory, &lt;span class=&quot;code-quote&quot;&gt;&quot;directory&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160;Files.walkFileTree(directory, visitor);
&#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; visitor;
&#160; &#160; &#160;}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17730556" author="garydgregory" created="Thu, 8 Jun 2023 13:18:20 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;&lt;br/&gt;
Feel free to submit a PR so we can see what other changes this might imply.&lt;/p&gt;</comment>
                            <comment id="17730587" author="janhoy" created="Thu, 8 Jun 2023 14:25:38 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/commons-io/pull/459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/459&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17730764" author="janhoy" created="Thu, 8 Jun 2023 23:09:04 +0000"  >&lt;p&gt;Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17765470" author="janhoy" created="Fri, 15 Sep 2023 06:46:26 +0000"  >&lt;p&gt;Hi, I was expecting a 2.13.1 or 2.14 release to fix this unintended API break. In Solr we are delaying upgrade og commons-io until this is fixed. Any news on a release?&lt;/p&gt;</comment>
                            <comment id="17765584" author="garydgregory" created="Fri, 15 Sep 2023 11:44:11 +0000"  >&lt;p&gt;Does a local or snapshot build of the git branch work for your use case?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13552138">IO-810</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1iey0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>