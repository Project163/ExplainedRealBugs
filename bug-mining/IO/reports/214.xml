<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:27:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-554] FileUtils.copyToFile(InputStream source, File destination) should not close input stream</title>
                <link>https://issues.apache.org/jira/browse/IO-554</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;In 2.6 this method is closing the input stream, while the javadoc states the opposite.&lt;br/&gt;
The correct behavior is to leave the stream open, as stated in the javadoc.&lt;/p&gt;

&lt;p&gt;I assigned a high priority because this incorrect behavior breaks existing code, especially when used in combination with ZipInputStream.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Copies bytes from an {@link InputStream} &amp;lt;code&amp;gt;source&amp;lt;/code&amp;gt; to a file
 * &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;. The directories up to &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;
 * will be created &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; they don&apos;t already exist. &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;
 * will be overwritten &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it already exists.
 * The {@code source} stream is left open, e.g. &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; use with {@link java.util.zip.ZipInputStream ZipInputStream}.
 * See {@link #copyInputStreamToFile(InputStream, File)} &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a method that closes the input stream.
 *
 * @param source      the &amp;lt;code&amp;gt;InputStream&amp;lt;/code&amp;gt; to copy bytes from, must not be {@code &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
 * @param destination the non-directory &amp;lt;code&amp;gt;File&amp;lt;/code&amp;gt; to write bytes to
 *                    (possibly overwriting), must not be {@code &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
 * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; is a directory
 * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; cannot be written
 * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; needs creating but can&apos;t be
 * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; an IO error occurs during copying
 * @since 2.5
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void copyToFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InputStream source, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File destination) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (InputStream in = source;
		 OutputStream out = openOutputStream(destination)) {
		IOUtils.copy(in, out);
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;instead it should be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void copyToFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InputStream source, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File destination) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (OutputStream out = openOutputStream(destination)) {
		IOUtils.copy(source, out);
	}
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13116141">IO-554</key>
            <summary>FileUtils.copyToFile(InputStream source, File destination) should not close input stream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="mmariotti">Michele Mariotti</reporter>
                        <labels>
                            <label>regression</label>
                    </labels>
                <created>Sat, 4 Nov 2017 11:17:28 +0000</created>
                <updated>Thu, 28 May 2020 14:49:03 +0000</updated>
                            <resolved>Tue, 12 Jun 2018 22:04:22 +0000</resolved>
                                    <version>2.6</version>
                                    <fixVersion>2.7</fixVersion>
                                    <component>Streams/Writers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16239364" author="kinow" created="Sun, 5 Nov 2017 03:25:48 +0000"  >&lt;p&gt;Nice catch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmariotti&quot; class=&quot;user-hover&quot; rel=&quot;mmariotti&quot;&gt;mmariotti&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Would you like to submit a pull request with this change? If not, let me know and I&apos;ll quickly prepare a pull request and credit you.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Bruno&lt;/p&gt;</comment>
                            <comment id="16239465" author="githubbot" created="Sun, 5 Nov 2017 09:34:58 +0000"  >&lt;p&gt;GitHub user mmariotti opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-io/pull/49&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/49&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-554&quot; title=&quot;FileUtils.copyToFile(InputStream source, File destination) should not close input stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-554&quot;&gt;&lt;del&gt;IO-554&lt;/del&gt;&lt;/a&gt; fixed: prevent input stream close&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-554&quot; title=&quot;FileUtils.copyToFile(InputStream source, File destination) should not close input stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-554&quot;&gt;&lt;del&gt;IO-554&lt;/del&gt;&lt;/a&gt; FileUtils.copyToFile(InputStream source, File destination) closes input stream.&lt;br/&gt;
    Fixed removing &apos;source&apos; from try-with-resources.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mmariotti/commons-io&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mmariotti/commons-io&lt;/a&gt; patch-1&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-io/pull/49.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/49.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #49&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c9fb10f0e45ec66cff342692fd440d06da250e88&lt;br/&gt;
Author: Michele Mariotti &amp;lt;mariotti.shape@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-11-05T09:32:16Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-554&quot; title=&quot;FileUtils.copyToFile(InputStream source, File destination) should not close input stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-554&quot;&gt;&lt;del&gt;IO-554&lt;/del&gt;&lt;/a&gt; fixed: prevent input stream close&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-554&quot; title=&quot;FileUtils.copyToFile(InputStream source, File destination) should not close input stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-554&quot;&gt;&lt;del&gt;IO-554&lt;/del&gt;&lt;/a&gt; FileUtils.copyToFile(InputStream source, File destination) closes input stream.&lt;br/&gt;
    Fixed removing &apos;source&apos; from try-with-resources.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16239466" author="mmariotti" created="Sun, 5 Nov 2017 09:37:06 +0000"  >&lt;p&gt;Created Pull Request &lt;a href=&quot;https://github.com/apache/commons-io/pull/49&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#49&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Glad to help &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16239471" author="b.eckenfels" created="Sun, 5 Nov 2017 10:00:13 +0000"  >&lt;p&gt;Can you add a test case as well?&lt;/p&gt;</comment>
                            <comment id="16239495" author="mmariotti" created="Sun, 5 Nov 2017 10:55:12 +0000"  >&lt;p&gt;test case added&lt;/p&gt;</comment>
                            <comment id="16239579" author="jochen@apache.org" created="Sun, 5 Nov 2017 15:08:37 +0000"  >&lt;p&gt;For the sake of binary compatibility, I&apos;d suggest an alternate proposal:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Change the Javadocs of FileUtils.copyToFile to reflect the current situation.&lt;/li&gt;
	&lt;li&gt;Introduce a new method copyToFile(InputStream, File, boolean), which is basically doing the same than the old implementation, except that the last parameter decides upon closing, or not.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="16239595" author="mmariotti" created="Sun, 5 Nov 2017 15:42:35 +0000"  >&lt;p&gt;There is already a method which closes the input stream: it is FileUtils.copyInputStreamToFile.&lt;br/&gt;
The only difference between methods is the closure of input stream.&lt;br/&gt;
However, I agree that the method names are an unhappy choice and that should be renamed to something more meaningful.&lt;/p&gt;</comment>
                            <comment id="16239738" author="kinow" created="Sun, 5 Nov 2017 21:50:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jochen%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;jochen@apache.org&quot;&gt;jochen@apache.org&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt;For the sake of binary compatibility, I&apos;d suggest an alternate proposal&lt;/p&gt;

&lt;p&gt;I think the change is still binary compatible, but not API/behavioral compatible? Though I always get confused with these two...&lt;/p&gt;

&lt;p&gt;As it seems like a bug/regression added accidentally in 2.6, I thought it could still be fixed as in the pull request, and released in a 2.7 version. What do you think?&lt;/p&gt;</comment>
                            <comment id="16240010" author="jochen@apache.org" created="Mon, 6 Nov 2017 07:53:18 +0000"  >&lt;p&gt;Fact is, if we pull that one in, then the next version will behave different, which makes it binary incompatible. Perhaps, a discussion on devs@commons is in order.&lt;/p&gt;</comment>
                            <comment id="16240019" author="kinow" created="Mon, 6 Nov 2017 08:16:21 +0000"  >&lt;p&gt;&amp;gt;Fact is, if we pull that one in, then the next version will behave different, which makes it binary incompatible.&lt;/p&gt;

&lt;p&gt;I *&lt;b&gt;think&lt;/b&gt;* it would be behavioural imcompatible per &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;. But I may be wrong.&lt;/p&gt;

&lt;p&gt;&amp;gt;Perhaps, a discussion on devs@commons is in order.&lt;/p&gt;

&lt;p&gt;+1, others would be able to clear up any confusion and having a consensus on this now would be better than waiting to discuss it during a release vote. Shall I start the thread?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://docs.oracle.com/javase/specs/jls/se7/html/jls-13.html#jls-13.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/specs/jls/se7/html/jls-13.html#jls-13.2&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://blogs.oracle.com/darcy/kinds-of-compatibility:-source,-binary,-and-behavioral&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blogs.oracle.com/darcy/kinds-of-compatibility:-source,-binary,-and-behavioral&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16240022" author="b.eckenfels" created="Mon, 6 Nov 2017 08:25:08 +0000"  >&lt;p&gt;2.5 and before did not close the file. So this is a change which violates the Javadoc spec and was introduced in 2.6, this is IMHO enough justification to revert to the documented behavior. Of course the releasenotes for 2.7 should have a fat warning about this.&lt;/p&gt;</comment>
                            <comment id="16505803" author="tmortagne" created="Fri, 8 Jun 2018 07:50:49 +0000"  >&lt;p&gt;It does not make any sense to me to debate if an important regression like this one introduced in the previous version should be fixed... for retro compatibility reason. If you are using any library which use this API based on commons-io 2.5 or less, any upgrade of commons-io on your side will break it which is not really acceptable given commons-io standards.&lt;/p&gt;

&lt;p&gt;I agree that behavior should not change but that&apos;s actually an argument for a bugfix release as fast as possible, not to keep a regression.&lt;/p&gt;</comment>
                            <comment id="16506089" author="garydgregory" created="Fri, 8 Jun 2018 14:38:33 +0000"  >&lt;p&gt;We should pull this change in, this is just a plain old bug.&lt;/p&gt;</comment>
                            <comment id="16506882" author="kinow" created="Sat, 9 Jun 2018 09:37:27 +0000"  >&lt;p&gt;TL;DR;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;2.5 did not close the stream&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;2.6 closed the stream after the introduction of try-with-resources&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;This issue is about the changed behaviour, with a pull request to revert it back to 2.5 behaviour&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Recapitulating;&lt;/p&gt;

&lt;p&gt;I believe the &lt;b&gt;copyToFile&lt;/b&gt; method was released with Release 2.5 &#8211; 2016-04-22, added in this commit from &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-381&quot; title=&quot;Add FileUtils.copyInputStreamToFile API with option to leave the source open&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-381&quot;&gt;&lt;del&gt;IO-381&lt;/del&gt;&lt;/a&gt; from May 2013 &lt;a href=&quot;https://github.com/apache/commons-io/commit/ee2f71d9fd2ce253f53de137950fa90087b9f565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/commit/ee2f71d9fd2ce253f53de137950fa90087b9f565&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The code from the 2.5 released tag reads:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Copies bytes from an {@link InputStream} &amp;lt;code&amp;gt;source&amp;lt;/code&amp;gt; to a file
     * &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;. The directories up to &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;
     * will be created &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; they don&apos;t already exist. &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;
     * will be overwritten &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it already exists.
     * The {@code source} stream is left open, e.g. &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; use with {@link java.util.zip.ZipInputStream ZipInputStream}.
     * See {@link #copyInputStreamToFile(InputStream, File)} &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a method that closes the input stream.
     *
     * @param source      the &amp;lt;code&amp;gt;InputStream&amp;lt;/code&amp;gt; to copy bytes from, must not be {@code &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
     * @param destination the non-directory &amp;lt;code&amp;gt;File&amp;lt;/code&amp;gt; to write bytes to
     *                    (possibly overwriting), must not be {@code &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; is a directory
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; cannot be written
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; needs creating but can&apos;t be
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; an IO error occurs during copying
     * @since 2.5
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void copyToFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InputStream source, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File destination) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileOutputStream output = openOutputStream(destination);
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            IOUtils.copy(source, output);
            output.close(); &lt;span class=&quot;code-comment&quot;&gt;// don&apos;t swallow close Exception &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; copy completes normally
&lt;/span&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            IOUtils.closeQuietly(output);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;NB the Javadocs states &quot;&lt;b&gt;The {@code source} stream is left open&lt;/b&gt;&quot;. I had a look at the code, and tested in Eclipse, and it is indeed left open.&lt;/p&gt;

&lt;p&gt; But on this commit from May 2016, released later with Release 2.6 &#8211; 2017-10-15, we added try-with-resources, which changed the behaviour of the code.&lt;/p&gt;

&lt;p&gt; The code from &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-505&quot; title=&quot;Make LineIterator implement Closeable to support try-with-resources statements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-505&quot;&gt;&lt;del&gt;IO-505&lt;/del&gt;&lt;/a&gt; from the 2.6 released tag_**_ reads:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&#160;&#160; /**
&#160;&#160;&#160;&#160; * Copies bytes from an {@link InputStream} &amp;lt;code&amp;gt;source&amp;lt;/code&amp;gt; to a file
&#160;&#160;&#160;&#160; * &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;. The directories up to &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;
&#160;&#160;&#160;&#160; * will be created &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; they don&apos;t already exist. &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt;
&#160;&#160;&#160;&#160; * will be overwritten &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it already exists.
&#160;&#160;&#160;&#160; * The {@code source} stream is left open, e.g. &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; use with {@link java.util.zip.ZipInputStream ZipInputStream}.
&#160;&#160;&#160;&#160; * See {@link #copyInputStreamToFile(InputStream, File)} &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a method that closes the input stream.
&#160;&#160;&#160;&#160; *
&#160;&#160;&#160;&#160; * @param source&#160;&#160;&#160;&#160;&#160; the &amp;lt;code&amp;gt;InputStream&amp;lt;/code&amp;gt; to copy bytes from, must not be {@code &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
&#160;&#160;&#160;&#160; * @param destination the non-directory &amp;lt;code&amp;gt;File&amp;lt;/code&amp;gt; to write bytes to
&#160;&#160;&#160;&#160; *&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; (possibly overwriting), must not be {@code &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
&#160;&#160;&#160;&#160; * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; is a directory
&#160;&#160;&#160;&#160; * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; cannot be written
&#160;&#160;&#160;&#160; * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &amp;lt;code&amp;gt;destination&amp;lt;/code&amp;gt; needs creating but can&apos;t be
&#160;&#160;&#160;&#160; * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; an IO error occurs during copying
&#160;&#160;&#160;&#160; * @since 2.5
&#160;&#160;&#160;&#160; */
&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void copyToFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InputStream source, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File destination) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (InputStream in = source;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; OutputStream out = openOutputStream(destination)) {
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; IOUtils.copy(in, out);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
&#160;&#160;&#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;NB the Javadocs states &quot;&lt;b&gt;The {@code source} stream is left open&lt;/b&gt;&quot;. But the try-with-resources closes the in/source input stream. I think this change in the behaviour was not intentional.&lt;/p&gt;

&lt;p&gt;The pull request for this issue is proposing to revert what was added in 2.6. I would not use commons-io-2.6 `copyToFile`, as I would normally handle the stream myself, or use the other method that already closed the stream before.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tmortagne&quot; class=&quot;user-hover&quot; rel=&quot;tmortagne&quot;&gt;tmortagne&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;&amp;gt;I agree that behavior should not change but that&apos;s actually an argument for a bugfix release as fast as possible, not to keep a regression.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;In a similar case, Commons Pool 2.4.3 kept binary compatibility but changed the way the code worked when iterating stack traces (see &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-320&quot; title=&quot;Use more efficient stack walking mechanisms for usage tracking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-320&quot;&gt;&lt;del&gt;POOL-320&lt;/del&gt;&lt;/a&gt;), which caused an issue and prevented us from using this version in Commons DBCP. Instead of keeping the method and adding a new one, or updating documentation, we reverted the change in 2.5.0 (see &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-335&quot; title=&quot;Make abandoned logging stack trace requirements configurable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-335&quot;&gt;&lt;del&gt;POOL-335&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;In my opinion we should revert the regression added in 2.6, with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmariotti&quot; class=&quot;user-hover&quot; rel=&quot;mmariotti&quot;&gt;mmariotti&lt;/a&gt; &apos;s pull request suggested, which also includes a unit test to prevent the regression from happening again.&lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;

&lt;p&gt;Bruno&lt;/p&gt;

&lt;p&gt;(**) There is a tag commons-io-2.5, but no commons-io-2.6, only RC1, RC2, and commons-io-2.6-RC3.&lt;/p&gt;</comment>
                            <comment id="16510287" author="githubbot" created="Tue, 12 Jun 2018 22:02:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-io/pull/49&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/49&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16510289" author="garydgregory" created="Tue, 12 Jun 2018 22:04:22 +0000"  >&lt;p&gt;Patch applied to git master. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="16929114" author="wilx" created="Fri, 13 Sep 2019 11:07:51 +0000"  >&lt;p&gt;Can we get a release of Commons IO with this fix? I have just hit it and it is mighty annoying.&lt;/p&gt;</comment>
                            <comment id="16964116" author="tmortagne" created="Thu, 31 Oct 2019 15:15:32 +0000"  >&lt;p&gt;A release would definitely be nice, this is starting to be pretty old.&lt;/p&gt;</comment>
                            <comment id="17118742" author="jochen reinhardt" created="Thu, 28 May 2020 14:27:56 +0000"  >&lt;p&gt;Just hit by this issue. When can we have a release? Can you do a fix release, e.g. 2.6.1? Is this going to literally take years to make a fix available?&lt;/p&gt;</comment>
                            <comment id="17118773" author="jochen@apache.org" created="Thu, 28 May 2020 14:45:34 +0000"  >&lt;p&gt;See&#160;&lt;a href=&quot;https://lists.apache.org/thread.html/r3cca5423debb9d2e8b439fcc4acf8eb150bfefc9ae2338f64ac43428%40%3Cdev.commons.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/r3cca5423debb9d2e8b439fcc4acf8eb150bfefc9ae2338f64ac43428%40%3Cdev.commons.apache.org%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Ah, we&apos;re even one step further: Commons-IO 2.7 is out.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12646624">IO-381</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12965763">IO-505</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mefb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>