<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:25:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-128] NPE on FilenameUtils.equalsNormalizedOnSystem()</title>
                <link>https://issues.apache.org/jira/browse/IO-128</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;The following code in commons-io (1.3.2) throws an NPE exception:&lt;/p&gt;

&lt;p&gt;org.apache.commons.io.FilenameUtils&lt;br/&gt;
    .equalsNormalizedOnSystem(&lt;br/&gt;
            &quot;//a.html&quot;,&lt;br/&gt;
            &quot;//ab.html&quot;);&lt;/p&gt;

&lt;p&gt;And here is the exception:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException: The strings must not be null&lt;br/&gt;
   at org.apache.commons.io.IOCase.checkEquals(IOCase.java:141)&lt;br/&gt;
   at org.apache.commons.io.FilenameUtils.equals(FilenameUtils.java:984)&lt;br/&gt;
   at org.apache.commons.io.FilenameUtils.equalsNormalizedOnSystem(FilenameUtils.java:956)&lt;br/&gt;
   at CodeSnippet_32.run(CodeSnippet_32.java:4)&lt;br/&gt;
   at org.eclipse.jdt.internal.debug.ui.snippeteditor.ScrapbookMain1.eval(ScrapbookMain1.java:20)&lt;br/&gt;
   at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
   at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
   at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
   at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
   at org.eclipse.jdt.internal.debug.ui.snippeteditor.ScrapbookMain.evalLoop(ScrapbookMain.java:54)&lt;br/&gt;
   at org.eclipse.jdt.internal.debug.ui.snippeteditor.ScrapbookMain.main(ScrapbookMain.java:35)&lt;/p&gt;

&lt;p&gt;I think it is wrong a message &quot;The strings must not be null&quot;, since there is not a null string involved in the call.&lt;/p&gt;

&lt;p&gt;Interesting is if both or 1 of the strings is null, it did not throws an exception.&lt;/p&gt;

&lt;p&gt;Additional comment from Niall Pemberton (on the dev mail list):&lt;/p&gt;

&lt;p&gt;The problem is that the FilenameUtils&apos;s normalize(String) method&lt;br/&gt;
returns &quot;null&quot; if it thinks the file names are invalid - which in your&lt;br/&gt;
case it seems to be doing so for both file names.&lt;/p&gt;

&lt;p&gt;So I guess theres two issues here - you&apos;re right the error is&lt;br/&gt;
misleading and FilenameUtils should check the names again after&lt;br/&gt;
calling normalize() for nulls and throw a more appropriate message.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12380257">IO-128</key>
            <summary>NPE on FilenameUtils.equalsNormalizedOnSystem()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="niallp">Niall Pemberton</assignee>
                                    <reporter username="antonio">Antonio Gallardo Rivera</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Oct 2007 18:44:41 +0000</created>
                <updated>Thu, 21 Dec 2023 13:03:39 +0000</updated>
                            <resolved>Thu, 21 Dec 2023 13:02:31 +0000</resolved>
                                    <version>1.2</version>
                    <version>1.3</version>
                    <version>1.3.1</version>
                    <version>1.3.2</version>
                                    <fixVersion>2.16.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12534442" author="niallp" created="Fri, 12 Oct 2007 23:43:29 +0000"  >&lt;p&gt;Antonio,&lt;/p&gt;

&lt;p&gt;Tthanks for reporting this - I have added null checks after the file names have been &quot;normalized&quot; and if theres an error (i.e. they return null) then its now throwing an IllegalArgumentException with the message &quot;Error normalizing one or both of the file names&quot; - hopefully that will make it less confusing if errors occur when the names are &quot;normalized&quot;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=584325&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=584325&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12534452" author="niallp" created="Sat, 13 Oct 2007 00:42:36 +0000"  >&lt;p&gt;From the dev list...&lt;/p&gt;

&lt;p&gt;On 10/13/07, Antonio Gallardo &amp;lt;agallardo@agssa.net&amp;gt; wrote:&lt;br/&gt;
&amp;gt; Hi Niall,&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Thanks for taking care of the issue, however it is not clear to me from&lt;br/&gt;
&amp;gt; the javadocs that we should expect an IllegalArgumentException returning&lt;br/&gt;
&amp;gt; from equalsNormalizedOnSystem(). IMHO, it states it calls first the&lt;br/&gt;
&amp;gt; normalize() and based on the javadocs of normalize(), it should silently&lt;br/&gt;
&amp;gt; fix, the link. On the javados, there is:&lt;/p&gt;

&lt;p&gt;Unfortunately until today I had never looked at or used the normalize code - so I don&apos;t know what the original intention was.  The javadocs for the normalize() method do say &quot;the normalized filename, or null if invalid&quot; for the return value (see &lt;a href=&quot;http://tinyurl.com/2tczc8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tinyurl.com/2tczc8&lt;/a&gt;). So it seems clear that errors return null (and there are tests for error conditions in the test case (see &lt;a href=&quot;http://tinyurl.com/3bh7ml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tinyurl.com/3bh7ml&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;On that basis I believe that we must cater for errors in the equals method. As it stands I think my change to throw an IllegalArgumentException with a relevant message and in the right place is better than a misleading NullPointerException elsewhere. However I am happy for anyone else to come up with better suggestions.&lt;/p&gt;

&lt;p&gt;Whether a value like &quot;//file.txt&quot; should be causing a normalize error is another question though...&lt;/p&gt;

&lt;p&gt;&amp;gt; //foo/.//bar --&amp;gt; /foo/bar&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Hence a user could assume that&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; //file.txt --&amp;gt; /file.txt and not an IllegalArgumentException&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Is that correct?&lt;/p&gt;

&lt;p&gt;Tracking through your issue one of the first things the doNormalize() method does is call  getPrefixLength() and if it returns a negative value, then it returns null - indicating invalid.&lt;/p&gt;

&lt;p&gt;In getPrefixLength() there is code that if the first two characters are file separators (which they are in your case) then it returns -1 if there are no other separator characters - so thats triggering the error here.&lt;/p&gt;

&lt;p&gt;Therefore seems that someone has specifically coded to cause an error in your scenario. Hopefully someone with better knowledge will jump in and talk more sense than I can. Sorry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12534481" author="scolebourne" created="Sat, 13 Oct 2007 08:03:34 +0000"  >&lt;p&gt;I believe that the intention was that all invalid inputs would result in null, not an exception, so the fix is incorrect. (But it should also not throw NPE)&lt;/p&gt;

&lt;p&gt;A double slash at the start is taken to refer to a UNC server name. Since //file.txt isn&apos;t sufficient for a UNC server name, the getPrefixLength method returns null.&lt;/p&gt;

&lt;p&gt;Two options: &lt;br/&gt;
a) clarify that if the double slash is at the start, it has to refer to a UNC name&lt;br/&gt;
b) handle the case that a double slash at the start should be just normalized to a single slash if it is not a UNC name.&lt;/p&gt;

&lt;p&gt;(b) is probably better. Effectively you need to convert // to / before getting the prefix in this scenario.&lt;/p&gt;</comment>
                            <comment id="12534541" author="niallp" created="Sat, 13 Oct 2007 14:09:47 +0000"  >&lt;p&gt;Stephen, thanks for helping with this...&lt;/p&gt;

&lt;p&gt;&quot;I believe that the intention was that all invalid inputs would result in null, not an exception, so the fix is incorrect. (But it should also not throw NPE)&quot;&lt;/p&gt;

&lt;p&gt;The problem is in the equals method which returns a primitive boolean, so returning null is not an option. It calls the normalize() method on the file names, so the question is what should that method do if the &quot;normalized&quot; file names are null? Currently it causes a confusing NPE - if an exception is not correct in the equals method then the question is what to do? Perhaps it should continue, but use the un-normalized file name for any that are invalid?&lt;/p&gt;

&lt;p&gt;&quot;Two options:&lt;br/&gt;
a) clarify that if the double slash is at the start, it has to refer to a UNC name&lt;br/&gt;
b) handle the case that a double slash at the start should be just normalized to a single slash if it is not a UNC name.&quot;&lt;/p&gt;

&lt;p&gt;Seems to me that since the current &quot;normalize&quot; contract is to return null for invalid names then isn&apos;t option b) effectively changing the contract of that method? Or is it that although a file name such as //foo.txt is not a valid UNC name - it should be considered a valid file name?&lt;/p&gt;</comment>
                            <comment id="12534606" author="scolebourne" created="Sun, 14 Oct 2007 08:33:23 +0000"  >&lt;p&gt;For equals() the general contract is that if they are not equal then it returns false. object.equals(null) returns false for example. I don&apos;t think using the un-normalized name is the right way to go.&lt;/p&gt;

&lt;p&gt;The second question is whether normalize is trying to extract a UNC name, and if it decides it isn&apos;t then what to do. I suspect that its best to try and remove the UNC prefix, and if not then treat as per any other filename (ie. remove the double slash.)&lt;/p&gt;</comment>
                            <comment id="12534721" author="antonio" created="Mon, 15 Oct 2007 02:55:16 +0000"  >&lt;p&gt;IMHO, the UNC for &quot;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&quot; not &quot;//&quot; See: &lt;a href=&quot;http://en.wikipedia.org/wiki/Path_%28computing%29#Uniform_Naming_Convention&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/Path_%28computing%29#Uniform_Naming_Convention&lt;/a&gt;&lt;br/&gt;
Hence // should be fixed to a single slash. Makes sense?&lt;/p&gt;</comment>
                            <comment id="12534830" author="niallp" created="Mon, 15 Oct 2007 12:16:03 +0000"  >&lt;p&gt;I&apos;l leave the UNC issue for others to decide/fix.&lt;/p&gt;

&lt;p&gt;&quot;For equals() the general contract is that if they are not equal then it returns false. object.equals(null) returns false for example. I don&apos;t think using the un-normalized name is the right way to go. &quot;&lt;/p&gt;

&lt;p&gt;If both file names are invalid (but different) and therefore both result in null after normalization then it would be strange IMO to return &quot;true&quot; from the equals method - which was the only reason I suggested using the un-normalized name if the normalized name is null.&lt;/p&gt;</comment>
                            <comment id="12534837" author="niallp" created="Mon, 15 Oct 2007 12:24:09 +0000"  >&lt;p&gt;P.S. IOCase checkEquals throws a NullPointerException if either of the Strings are null&lt;/p&gt;</comment>
                            <comment id="12534854" author="niallp" created="Mon, 15 Oct 2007 14:20:26 +0000"  >&lt;p&gt;OK heres a patch replacing the exception I added. It only compares the &quot;un-normalized&quot; file names if they are both invalid&lt;/p&gt;</comment>
                            <comment id="12540667" author="niallp" created="Wed, 7 Nov 2007 04:28:53 +0000"  >&lt;p&gt;I&apos;ve changed the IllegalArgumentException to a NullPointerException - so the way it stands now the behaviour is unchanged from the last released version - just has a better error message.&lt;/p&gt;

&lt;p&gt;If others think the equals method shouldn&apos;t throw an exception (seems OK to me, otherwise it will just mask invalid &quot;normalized&quot; file names) then I have attached a suggested patch - I&apos;ll leave this for others to decide if/what changes are appropriate for this and the UNC names issue.&lt;/p&gt;</comment>
                            <comment id="12556313" author="niallp" created="Sun, 6 Jan 2008 00:53:06 +0000"  >&lt;p&gt;Moving this to post 1.4 - needs someone to step up and do the work&lt;/p&gt;</comment>
                            <comment id="17799212" author="elharo" created="Thu, 21 Dec 2023 00:05:33 +0000"  >&lt;p&gt;I added a test for this and it seems to have been fixed, likely a long time ago. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12369075" name="IO-128-v2.patch" size="3392" author="niallp" created="Wed, 7 Nov 2007 04:28:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3184</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 46 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0smbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>165094</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>