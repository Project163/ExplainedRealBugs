<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:29:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-850] DeletingPathVisitor always fails to delete a dir when symbolic link target is deleted before the link itself</title>
                <link>https://issues.apache.org/jira/browse/IO-850</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;DeletingPathVisitor doesn&apos;t give us an option for the SimplePathVisitor superclass visitFileFailedFunction property (that constructor also exposed to the intermediate class CountingPathVisitor is not used/exposed in the DeletingPathVisitor class)&lt;/p&gt;

&lt;p&gt;So i can&apos;t use that but the DeletingPathVisitor should use that, because i can&apos;t delete a certain directory if you have something like this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;parentdir:&lt;/p&gt;

&lt;p&gt;&#160; adir&lt;/p&gt;

&lt;p&gt;&#160; symboliclinkpointingtoadir&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;if that happens and i call this Files.walkFileTree(path, DeletingPathVisitor.withLongCounters());&lt;/p&gt;

&lt;p&gt;on the parent dir and it first deletes &quot;adir&quot;&#160;&lt;/p&gt;

&lt;p&gt;then it will completely fail to delete that parentdir (or clean the parent dir)&lt;/p&gt;

&lt;p&gt;this is because Files will try to open the directory stream of that &quot;symboliclinkpointingtoadir&quot; and that will fail because the &quot;adir&quot; is already gone. so its now an invalid symbolic link. The the Files walkFileTree implementation does call visitFileFailed but that is competely not implemented in the DeletingPathVisitor and i have no means of also adding it to it.&lt;/p&gt;

&lt;p&gt;i think DeletingPathVisitor should just do what i now do in my own implementation:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; FileVisitResult visitFileFailed(Path file, IOException exc) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Files.deleteIfExists(file);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; FileVisitResult.CONTINUE;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;just try to delete that file and be done with it (this works fine)&lt;/p&gt;

&lt;p&gt;now it bombs out because that IOException is something like &quot;FileNotFound&quot;&#160;&lt;/p&gt;

&lt;p&gt;and if if i call it again and again on that dir (so &quot;adir&quot; is already gone) the DeletingPathVisitor is never able to delete/clean that parent dir it always bombs out.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13573640">IO-850</key>
            <summary>DeletingPathVisitor always fails to delete a dir when symbolic link target is deleted before the link itself</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jcompanger@gmail.com">Johan Compagner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Mar 2024 08:58:12 +0000</created>
                <updated>Tue, 8 Jul 2025 22:27:39 +0000</updated>
                            <resolved>Tue, 8 Jul 2025 22:27:39 +0000</resolved>
                                    <version>2.15.1</version>
                                    <fixVersion>2.19.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17831761" author="garydgregory" created="Thu, 28 Mar 2024 12:29:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcompanger%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;jcompanger@gmail.com&quot;&gt;jcompanger@gmail.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Interesting case! Thank you for reporting it.&lt;/p&gt;

&lt;p&gt;Would you create a failing unit test (PR in GitHub or patch attachment)?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="17833906" author="garydgregory" created="Thu, 4 Apr 2024 11:50:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcompanger%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;jcompanger@gmail.com&quot;&gt;jcompanger@gmail.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I cannot reproduce your text in a unit test, please see &lt;a href=&quot;https://github.com/apache/commons-io/blob/08b3ea4ed7c09b65260d1929d42b9a5c39d5007a/src/test/java/org/apache/commons/io/file/DeletingPathVisitorTest.java#L121-L157&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/blob/08b3ea4ed7c09b65260d1929d42b9a5c39d5007a/src/test/java/org/apache/commons/io/file/DeletingPathVisitorTest.java#L121-L157&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Tests https:&lt;span class=&quot;code-comment&quot;&gt;//issues.apache.org/jira/browse/IO-850
&lt;/span&gt;     */
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIO850DirectoriesOnly() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path rootDir = Files.createDirectory(managedTempDirPath.resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;IO850&quot;&lt;/span&gt;));
        createTempSymlinkedRelativeDir(rootDir);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path targetDir = rootDir.resolve(SUB_DIR);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path symlinkDir = rootDir.resolve(SYMLINKED_DIR);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DeletingPathVisitor visitor = DeletingPathVisitor.withLongCounters();
        Files.walkFileTree(rootDir, visitor);
        assertFalse(Files.exists(targetDir));
        assertFalse(Files.exists(symlinkDir));
        assertFalse(Files.exists(rootDir));
        assertTrue(visitor.getPathCounters().getDirectoryCounter().get() &amp;gt; 0);
    }

    /**
     * Tests https:&lt;span class=&quot;code-comment&quot;&gt;//issues.apache.org/jira/browse/IO-850
&lt;/span&gt;     */
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIO850DirectoriesAndFiles() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path rootDir = Files.createDirectory(managedTempDirPath.resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;IO850&quot;&lt;/span&gt;));
        createTempSymlinkedRelativeDir(rootDir);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path targetDir = rootDir.resolve(SUB_DIR);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path symlinkDir = rootDir.resolve(SYMLINKED_DIR);
        Files.write(targetDir.resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;file0.txt&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt;.getBytes(StandardCharsets.UTF_8));
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path subDir0 = Files.createDirectory(targetDir.resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;subDir0&quot;&lt;/span&gt;));
        Files.write(subDir0.resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;file1.txt&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt;.getBytes(StandardCharsets.UTF_8));
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DeletingPathVisitor visitor = DeletingPathVisitor.withLongCounters();
        Files.walkFileTree(rootDir, visitor);
        assertFalse(Files.exists(targetDir));
        assertFalse(Files.exists(symlinkDir));
        assertFalse(Files.exists(rootDir));
        assertTrue(visitor.getPathCounters().getDirectoryCounter().get() &amp;gt; 0);
        assertTrue(visitor.getPathCounters().getFileCounter().get() &amp;gt; 0);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would you please review and test with the current release &lt;b&gt;2.16.0&lt;/b&gt;? &lt;br/&gt;
TY&#160;&lt;/p&gt;</comment>
                            <comment id="17841974" author="garydgregory" created="Mon, 29 Apr 2024 12:29:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcompanger%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;jcompanger@gmail.com&quot;&gt;jcompanger@gmail.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Note that &lt;b&gt;2.16.1&lt;/b&gt; is available.&lt;/p&gt;</comment>
                            <comment id="17897961" author="garydgregory" created="Wed, 13 Nov 2024 15:32:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcompanger%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;jcompanger@gmail.com&quot;&gt;jcompanger@gmail.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;See also 2.17.0 and 2.18.0-SNAPSHOT.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1o9rc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>