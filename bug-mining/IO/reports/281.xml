<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:27:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-638] Infinite loop in CharSequenceInputStream.read for 4-byte characters with UTF-8 and 3-byte buffer.</title>
                <link>https://issues.apache.org/jira/browse/IO-638</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;In the constructor of `CharSequenceInputStream` there is the following code to ensure the buffer is large enough to hold one character:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-comment&quot;&gt;// Ensure that buffer is &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; enough to hold a complete character   
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; maxBytesPerChar = encoder.maxBytesPerChar();      
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (bufferSize &amp;lt; maxBytesPerChar) {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Buffer size &quot;&lt;/span&gt; + bufferSize + &lt;span class=&quot;code-quote&quot;&gt;&quot; is less than maxBytesPerChar &quot;&lt;/span&gt; +
    maxBytesPerChar);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, for UTF-8, `maxBytesPerChar` returns 3.0 not 4.0, even though some characters (such as emoji) require 4 bytes to encode.&#160; As a result you can create a `CharSequenceInputStream` with a buffer size of 3, but when attempting to fill the buffer, `CharsetEncoder.encode` will succeed with an OVERFLOW result without actually writing anything to buffer if attempting to encode a 4 byte character. This in turn results in an infinite loop in read methods, since the buffer never actually gets anything written to it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;NOTE: as I understand it, the reason the encoder returns 3 and not 4 is because 3 is the maximum number of byte that a single java `char` can represent, since a 4 byte encoding in UTF-8 would require two a surragate pair of two `char`s.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is may be a problem for other encodings as well, but I&apos;ve only tested it for utf-8.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Requiring the buffer to be at least twice the maxBytesPerChar would ensure this doesn&apos;t happen.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13268376">IO-638</key>
            <summary>Infinite loop in CharSequenceInputStream.read for 4-byte characters with UTF-8 and 3-byte buffer.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="thayne2">Thayne McCombs</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Nov 2019 17:09:35 +0000</created>
                <updated>Sun, 26 Sep 2021 16:14:00 +0000</updated>
                            <resolved>Sun, 26 Sep 2021 16:14:00 +0000</resolved>
                                    <version>2.6</version>
                                    <fixVersion>2.12.0</fixVersion>
                                    <component>Streams/Writers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17267534" author="garydgregory" created="Mon, 18 Jan 2021 21:14:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thayne2&quot; class=&quot;user-hover&quot; rel=&quot;thayne2&quot;&gt;thayne2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;Please feel free to provide a PR on GitHub with a unit test.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17420323" author="garydgregory" created="Sun, 26 Sep 2021 16:14:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thayne2&quot; class=&quot;user-hover&quot; rel=&quot;thayne2&quot;&gt;thayne2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please see git master, verify your use case and close if OK.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08mg0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>