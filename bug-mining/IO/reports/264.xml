<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:27:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-556] Unexpected behavior of FileNameUtils.normalize may lead to limited path traversal vulnerabilies</title>
                <link>https://issues.apache.org/jira/browse/IO-556</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;I sent this report in an Email to security@apache.org on 2017-10-16. I did not receive any kind of response yet (2017-11-18 as of writing). I am now posting it publicly, to open the issue up for discussion, and hopefully initiate a fix.&lt;/p&gt;

&lt;p&gt;This report is not about a vulnerability in &lt;tt&gt;commons-io&lt;/tt&gt; per se, but an unexpected behavior that has a high chance of introducing a path traversal vulnerability when using &lt;tt&gt;FilenameUtils.normalize&lt;/tt&gt; to sanitize user input. The traversal is limited to a single out-of-bounds-stepping &quot;/../&quot; segment.&lt;/p&gt;
&lt;h5&gt;&lt;a name=&quot;Reproduction&quot;&gt;&lt;/a&gt;Reproduction&lt;/h5&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
FilenameUtils.normalize(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//../foo&quot;&lt;/span&gt;);        // returns &lt;span class=&quot;code-quote&quot;&gt;&quot;//../foo&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;\\\\..\\foo&quot;&lt;/span&gt;, based on java.io.File.separatorChar
&lt;/span&gt;FilenameUtils.normalize(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\\\..\\foo&quot;&lt;/span&gt;);        &lt;span class=&quot;code-comment&quot;&gt;// returns &lt;span class=&quot;code-quote&quot;&gt;&quot;//../foo&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;\\\\..\\foo&quot;&lt;/span&gt;, based on java.io.File.separatorChar&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h5&gt;&lt;a name=&quot;Possibleimpact%28example%29&quot;&gt;&lt;/a&gt;Possible impact (example)&lt;/h5&gt;

&lt;p&gt;Consider a web-application that uses &lt;tt&gt;FilenameUtils.normalize&lt;/tt&gt; to sanitize a user-supplied file name string, and then appends the sanitized value to a configured upload directory to store the uploaded content in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//../foo&quot;&lt;/span&gt;;            // actually user-supplied (e.g. from multipart-POST request)
&lt;/span&gt;fileName = FilenameUtils.normalize(fileName);    &lt;span class=&quot;code-comment&quot;&gt;// still holds the same value (&lt;span class=&quot;code-quote&quot;&gt;&quot;//../foo&quot;&lt;/span&gt;)   
&lt;/span&gt;           
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fileName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    File newFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;/base/uploads&quot;&lt;/span&gt;, fileName);    &lt;span class=&quot;code-comment&quot;&gt;// java.io.File treats &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; forward slashes as singles
&lt;/span&gt;                                &lt;span class=&quot;code-comment&quot;&gt;// newFile now points to &lt;span class=&quot;code-quote&quot;&gt;&quot;/base/uploads//../foo&quot;&lt;/span&gt;
&lt;/span&gt;    newFile = newFile.getCanonicalFile();            &lt;span class=&quot;code-comment&quot;&gt;// newFile now points to &lt;span class=&quot;code-quote&quot;&gt;&quot;/base/foo&quot;&lt;/span&gt;, which should be inaccessible
&lt;/span&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// Write contents to newFile...
&lt;/span&gt;} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    &lt;span class=&quot;code-comment&quot;&gt;// Assume malicious activity, handle error
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h5&gt;&lt;a name=&quot;Relevantcodelocations&quot;&gt;&lt;/a&gt;Relevant code locations&lt;/h5&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.commons.io.FilenameUtils#getPrefixLength&lt;/tt&gt; : everything between a leading &quot;//&quot; and the next &quot;/&quot; is treated as a UNC server name, and ignored in all further validation logic of &lt;tt&gt;org.apache.commons.io.FilenameUtils#doNormalize&lt;/tt&gt; .&lt;/li&gt;
&lt;/ul&gt;


&lt;h5&gt;&lt;a name=&quot;Discussion&quot;&gt;&lt;/a&gt;Discussion&lt;/h5&gt;

&lt;p&gt;One might argue that the given example is a misuse of the &lt;tt&gt;FilenameUtils.normalize&lt;/tt&gt; method, and that everyone using it should expect absolute paths, full UNC paths, etc. to be returned by the method.&lt;br/&gt;
 Furthermore, the vulnerability can only occur due to the lax behavior of &lt;tt&gt;java.io.File&lt;/tt&gt; .&lt;/p&gt;

&lt;p&gt;On the other hand, I believe that the JavaDoc of &lt;tt&gt;FilenameUtils.normalize&lt;/tt&gt; suggests to most readers, that this method is exactly what is needed to sanitize file names:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;//-----------------------------------------------------------------------
    /**
     * Normalizes a path, removing double and single dot path steps,
     * and removing any final directory separator.
     * &amp;lt;p&amp;gt;
     * This method normalizes a path to a standard format.
     * The input may contain separators in either Unix or Windows format.
     * The output will contain separators in the format of the system.
     * &amp;lt;p&amp;gt;
     * A trailing slash will be removed.
     * A double slash will be merged to a single slash (but UNC names are handled).
     * A single dot path segment will be removed.
     * A double dot will cause that path segment and the one before to be removed.
     * If the double dot has no parent path segment to work with, {@code null}
     * is returned.
     * &amp;lt;p&amp;gt;
     * The output will be the same on both Unix and Windows except
     * for the separator character.
     * &amp;lt;pre&amp;gt;
     * /foo//               --&amp;amp;gt;   /foo
     * /foo/./              --&amp;amp;gt;   /foo
     * /foo/../bar          --&amp;amp;gt;   /bar
     * /foo/../bar/         --&amp;amp;gt;   /bar
     * /foo/../bar/../baz   --&amp;amp;gt;   /baz
     * //foo//./bar         --&amp;amp;gt;   /foo/bar
     * /../                 --&amp;amp;gt;   null
     * ../foo               --&amp;amp;gt;   null
     * foo/bar/..           --&amp;amp;gt;   foo
     * foo/../../bar        --&amp;amp;gt;   null
     * foo/../bar           --&amp;amp;gt;   bar
     * //server/foo/../bar  --&amp;amp;gt;   //server/bar
     * //server/../bar      --&amp;amp;gt;   null
     * C:\foo\..\bar        --&amp;amp;gt;   C:\bar
     * C:\..\bar            --&amp;amp;gt;   null
     * ~/foo/../bar/        --&amp;amp;gt;   ~/bar
     * ~/../bar             --&amp;amp;gt;   null
     * &amp;lt;/pre&amp;gt;
     * (Note the file separator returned will be correct for Windows/Unix)
     *
     * @param filename  the filename to normalize, null returns null
     * @return the normalized filename, or null if invalid. Null bytes inside string will be removed
     */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have done a quick survey of the usages of the method in public GitHub repositories. I have found numerous projects that suffer from the limited path traversal vulnerability that is described here because of this very issue. This includes Webservers, Web-Frameworks, Archive-Extraction-Software, and others.&lt;/p&gt;

&lt;p&gt;Preventing path traversal attacks is not trivial, and many people turn to libraries like &lt;tt&gt;commons-io&lt;/tt&gt; to avoid making mistakes when implementing parsing logic on their own. They trust that &lt;tt&gt;FilenameUtils&lt;/tt&gt; will provide them with the most complete, and suitable sanitation logic for file names.&lt;br/&gt;
 In addition, &quot;..&quot; is not a valid UNC host name according to &lt;a href=&quot;https://msdn.microsoft.com/de-de/library/gg465305.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://msdn.microsoft.com/de-de/library/gg465305.aspx&lt;/a&gt; , so prohibiting it shouldn&apos;t result in any major problems.&lt;/p&gt;</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="13119433">IO-556</key>
            <summary>Unexpected behavior of FileNameUtils.normalize may lead to limited path traversal vulnerabilies</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Lukas Euler">Lukas Euler</reporter>
                        <labels>
                            <label>security</label>
                            <label>security-issue</label>
                    </labels>
                <created>Sat, 18 Nov 2017 18:27:37 +0000</created>
                <updated>Thu, 9 Sep 2021 19:01:51 +0000</updated>
                            <resolved>Thu, 30 Nov 2017 20:34:05 +0000</resolved>
                                    <version>1.1</version>
                    <version>1.2</version>
                    <version>1.3</version>
                    <version>1.3.1</version>
                    <version>1.3.2</version>
                    <version>1.4</version>
                    <version>2.0.1</version>
                    <version>2.1</version>
                    <version>2.2</version>
                    <version>2.3</version>
                    <version>2.4</version>
                    <version>2.5</version>
                    <version>2.6</version>
                                    <fixVersion>2.7</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17057237" author="seavan32100" created="Wed, 11 Mar 2020 17:22:54 +0000"  >&lt;p&gt;Project uses &lt;b&gt;normalize()&lt;/b&gt; to generated file path based on windows\linux but in VeraCode security can report method used line detected as Directory Traversal T issue as medium flaws.&lt;br/&gt;
Common.io 2.6 API&#160;Unexpected behavior with normalize(String s) method is not performing validations on path input. &quot;../ &quot;&#160;is allowing but return as Null if the input type is some thing like &quot;&lt;font color=&quot;#FF0000&quot;&gt;&lt;b&gt;../../&lt;/b&gt;&lt;/font&gt;&quot;. with the below lines of code checks can be remove path DT vulnerabilities issue. Could somebody please give solution.&lt;br/&gt;
Veracode report result Directiry Travesal medium flaws detected need to fix.&lt;/p&gt;

&lt;p&gt;fileName = &quot;../../etc/passwd&quot;;&lt;/p&gt;

&lt;p&gt;fileName = FilenameUtils.normalize(fileName); // still holds the same value (&quot;//../foo&quot;) &lt;/p&gt;

&lt;p&gt;if (fileName != null) &lt;/p&gt;
{
 // file creation path eg: drivec\root\06-03-2020\folder\test 
}
&lt;p&gt; &lt;br/&gt;
else &lt;/p&gt;
{
throw new CustomerException(&quot;Invalid path creation found&quot;);
}

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17326527" author="jameshowe" created="Wed, 21 Apr 2021 13:19:27 +0000"  >&lt;p&gt;Was 2.2 when this was introduced, or does it go back to 1.4 etc. as CVE-2021-29425 says?&lt;/p&gt;</comment>
                            <comment id="17412773" author="juliusdavies" created="Thu, 9 Sep 2021 18:46:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jameshowe&quot; class=&quot;user-hover&quot; rel=&quot;jameshowe&quot;&gt;jameshowe&lt;/a&gt;&#160;- goes back to 1.1.&#160; &#160;FilenameUtils not present in 1.0.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java -cp commons-io-1.1.jar:. T &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-comment&quot;&gt;//../foo&apos;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//../foo&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java -cp commons-io-2.6.jar:. T &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-comment&quot;&gt;//../foo&apos;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//../foo&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java -cp commons-io-2.7.jar:. T &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-comment&quot;&gt;//../foo&apos;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Based on a T.java like this):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;T {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;T { &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println( org.apache.commons.io.FilenameUtils.normalize(args[0]));
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17412783" author="juliusdavies" created="Thu, 9 Sep 2021 19:01:51 +0000"  >&lt;p&gt;I adjusted the description just now:&#160; &#160;s/FileNameUtils/FilenameUtils/g&lt;/p&gt;

&lt;p&gt;I&apos;m an apache committer from 2008 in &quot;commons&quot; but haven&apos;t been active in at least 8 years.&#160; Until today.&#160; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13121929">IO-559</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3myon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>