<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:28:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-811] Files.walk() direct and indirect callers fail to close the returned Stream&lt;Path&gt;</title>
                <link>https://issues.apache.org/jira/browse/IO-811</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;JDK method Files.walk() clearly documents that the returned Stream&amp;lt;Path&amp;gt; must be closed: &quot;This method must be used within a try-with-resources statement or similar control structure to ensure that the stream&apos;s open directories are closed promptly after the stream&apos;s operations have completed.&quot; However, the Commons IO methods that consume these streams fail to close them. And the methods that pass on these streams fail to document that closing them is required.&lt;/p&gt;

&lt;p&gt;Problematic methods that I see:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;PathUtils.walk() lacks a documentation warning&lt;/li&gt;
	&lt;li&gt;FilesUncheck.walk() both variants lack a documentation warning&lt;/li&gt;
	&lt;li&gt;FileUtils.streamFiles() lacks a documentation warning&lt;/li&gt;
	&lt;li&gt;FileUtils.listFiles() consumes a Files.walk() stream without closing it&lt;/li&gt;
	&lt;li&gt;FileUtils.iterateFiles() claims to close the stream if the iterator is consumed, however, in my test of consuming an iterator returned from this method, a breakpoint set on FileTreeWalker.close() is never hit&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Failing to close these streams can result in file handle leaks and other problems, hence the importance of documenting and heading this requirement from the JDK method.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 11, Eclipse Adoptium OpenJDK 17.0.8.1+1&lt;/p&gt;</environment>
        <key id="13552500">IO-811</key>
            <summary>Files.walk() direct and indirect callers fail to close the returned Stream&lt;Path&gt;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="adam@labkey.com">Adam Rauch</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Sep 2023 23:10:57 +0000</created>
                <updated>Mon, 2 Oct 2023 20:05:38 +0000</updated>
                            <resolved>Mon, 2 Oct 2023 13:38:03 +0000</resolved>
                                    <version>2.13.0</version>
                                    <fixVersion>2.15.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17770616" author="adam@labkey.com" created="Fri, 29 Sep 2023 23:28:11 +0000"  >&lt;p&gt;Turns out there are additional stream-returning methods in the JDK Files class that are called by Commons IO but not handled properly. Search for usages of:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Files.list()&lt;/li&gt;
	&lt;li&gt;Files.lines() - two variants&lt;/li&gt;
	&lt;li&gt;Files.walk() - additional variant&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17770621" author="adam@labkey.com" created="Sat, 30 Sep 2023 00:06:31 +0000"  >&lt;p&gt;Also Files.newDirectoryStream() - both variants&lt;/p&gt;</comment>
                            <comment id="17770631" author="garydgregory" created="Sat, 30 Sep 2023 01:29:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adam%40labkey.com&quot; class=&quot;user-hover&quot; rel=&quot;adam@labkey.com&quot;&gt;adam@labkey.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report. I&apos;ve updated Javadocs and some test code.&lt;/p&gt;

&lt;p&gt;For Javadoc changes, I split the task into a new ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-812&quot; title=&quot;Javadoc should mention closing Streams based on file resources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-812&quot;&gt;&lt;del&gt;IO-812&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Please review your lists and let us know of your findings.&lt;/p&gt;

&lt;p&gt;Also feel free to provide a PR on GitHub &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17770741" author="adam@labkey.com" created="Sat, 30 Sep 2023 17:05:43 +0000"  >&lt;p&gt;JavaDoc and test changes look good to me. PR that attempts to close the streams that Commons IO consumes has been created: &lt;a href=&quot;https://github.com/apache/commons-io/pull/489&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/489&lt;/a&gt; Not tested extensively; please scrutinize.&lt;/p&gt;</comment>
                            <comment id="17770864" author="garydgregory" created="Sun, 1 Oct 2023 13:11:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adam%40labkey.com&quot; class=&quot;user-hover&quot; rel=&quot;adam@labkey.com&quot;&gt;adam@labkey.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your PR.&lt;/p&gt;

&lt;p&gt;Please verify git master and/or a snapshot build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/commons-io/commons-io/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/commons-io/commons-io/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17770921" author="adam@labkey.com" created="Sun, 1 Oct 2023 20:29:07 +0000"  >&lt;p&gt;FileUtils.listFiles() is now correctly closing the stream. Thanks!&lt;br/&gt;
&#160;&lt;br/&gt;
FileUtils.iterateFiles(), however, does not close the stream after the iterator is consumed. I believe the issue is that StreamIterator.iterator() does not return a StreamIterator wrapper... instead it returns the supplied stream&apos;s iterator:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; Iterator&amp;lt;T&amp;gt; iterator(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Stream&amp;lt;T&amp;gt; stream) {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamIterator&amp;lt;&amp;gt;(stream).iterator;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Therefore the wrapper&apos;s methods are never called.&lt;br/&gt;
&#160;Simple test code:&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (Stream&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; stream = Stream.of(1, 2, 3).onClose(() -&amp;gt; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closing!&quot;&lt;/span&gt;))) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(stream.map(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;::valueOf).collect(Collectors.joining(&lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;)));
}

Iterator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; iter = StreamIterator.iterator(Stream.of(1, 2, 3).onClose(() -&amp;gt; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closing!&quot;&lt;/span&gt;)));

&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (iter.hasNext()) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(iter.next());
}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that I couldn&apos;t test StreamIterator directly because the class isn&apos;t public... is there a reason why the factory method is public but the class itself is not?&lt;/p&gt;</comment>
                            <comment id="17770924" author="garydgregory" created="Sun, 1 Oct 2023 20:34:20 +0000"  >&lt;p&gt;Just a mistake, the whole class is meant to be package private. You can test the class from the same package if you want to provide additional tests in a PR.&lt;/p&gt;</comment>
                            <comment id="17770926" author="adam@labkey.com" created="Sun, 1 Oct 2023 21:10:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-io/pull/490&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StreamIterator test PR&lt;/a&gt; created. This test will fail until StreamIterator.iterator() is fixed. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; let me know if you want me to also fix the method and make it package private.&lt;/p&gt;</comment>
                            <comment id="17770927" author="adam@labkey.com" created="Sun, 1 Oct 2023 21:25:23 +0000"  >&lt;p&gt;Also note that the StreamIterator JavaDoc is a bit misleading in that callers can&apos;t invoke close() on the returned iterator since the factory method returns Iterator&amp;lt;T&amp;gt; not StreamIterator&amp;lt;T&amp;gt;.&lt;/p&gt;</comment>
                            <comment id="17771073" author="garydgregory" created="Mon, 2 Oct 2023 12:39:57 +0000"  >&lt;p&gt;Thank you for your update &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adam%40labkey.com&quot; class=&quot;user-hover&quot; rel=&quot;adam@labkey.com&quot;&gt;adam@labkey.com&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Issue fixed and PR merged, please review git master.&lt;/p&gt;

&lt;p&gt;I wonder if, once adjusted, &lt;tt&gt;StreamIterator&lt;/tt&gt; should be made public...&lt;/p&gt;</comment>
                            <comment id="17771101" author="garydgregory" created="Mon, 2 Oct 2023 13:38:03 +0000"  >&lt;p&gt;Resolving unless &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adam%40labkey.com&quot; class=&quot;user-hover&quot; rel=&quot;adam@labkey.com&quot;&gt;adam@labkey.com&lt;/a&gt; finds something else &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17771257" author="adam@labkey.com" created="Mon, 2 Oct 2023 20:05:07 +0000"  >&lt;p&gt;Everything looks good to me. Thanks for making the changes!&#160;&lt;/p&gt;

&lt;p&gt;FWIW: I think making &lt;tt&gt;StreamIterator&lt;/tt&gt; and &lt;tt&gt;StreamIterator.iterator()&lt;/tt&gt; public would be worthwhile.&lt;/p&gt;</comment>
                            <comment id="17771259" author="adam@labkey.com" created="Mon, 2 Oct 2023 20:05:38 +0000"  >&lt;p&gt;Verified changes on master&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="13552534">IO-812</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ko6o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>