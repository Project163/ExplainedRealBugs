<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:29:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-279] Tailer erroneously considers file as new</title>
                <link>https://issues.apache.org/jira/browse/IO-279</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;Tailer sometimes erroneously considers the tailed file as new, forcing a repositioning at the start of the file: I&apos;m still unable to reproduce this in a test case, because it only happens to me with huge log files during Apache Tomcat startup.&lt;/p&gt;

&lt;p&gt;This is the piece of code causing the problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// See &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the file needs to be read again
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (length &amp;gt; position) {

    &lt;span class=&quot;code-comment&quot;&gt;// The file has more content than it did last time
&lt;/span&gt;    last = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
    position = readLines(reader);

} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (FileUtils.isFileNewer(file, last)) {

    /* This can happen &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the file is truncated or overwritten
        * with the exact same length of information. In cases like
        * &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, the file position needs to be reset
        */
    position = 0;
    reader.seek(position); &lt;span class=&quot;code-comment&quot;&gt;// cannot be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; here
&lt;/span&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// Now we can read &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; lines
&lt;/span&gt;    last = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
    position = readLines(reader);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What probably happens is that the new file content is about to be written on disk, the date is already updated but content is still not flushed, so actual length is untouched and there you go.&lt;/p&gt;

&lt;p&gt;In other words, I think there should be some better method to verify the condition above, rather than relying only on dates: keeping and comparing the hash code of the latest line may be a solution, but may hurt performances ... other ideas?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12514326">IO-279</key>
            <summary>Tailer erroneously considers file as new</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sbtourist">Sergio Bossa</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Jul 2011 14:37:34 +0000</created>
                <updated>Sat, 5 Jul 2025 13:18:50 +0000</updated>
                            <resolved>Sat, 5 Jul 2025 13:15:12 +0000</resolved>
                                    <version>2.0.1</version>
                    <version>2.4</version>
                                    <fixVersion>2.20.0</fixVersion>
                                        <due></due>
                            <votes>5</votes>
                                    <watches>26</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="13152475" author="cmbaron" created="Thu, 17 Nov 2011 23:57:08 +0000"  >&lt;p&gt;There are at least two additional causes that I&apos;ve identified:&lt;/p&gt;

&lt;p&gt;(1) &quot;last&quot; time stamp does not include time spent reading or listener handling.&lt;/p&gt;

&lt;p&gt;last = System.currentTimeMillis();&lt;br/&gt;
position = readLines(reader);&lt;/p&gt;

&lt;p&gt;readLines(...) continues to read and handle lines from the log until it reaches the EOF.&lt;/p&gt;

&lt;p&gt;An erroneous truncation can be detected ff (a) content is added to the file between the recording of the &quot;last&quot; timestamp and (b) before readLine encounters EOF and (c) no content is added during the delay time.&lt;/p&gt;

&lt;p&gt;The fix is to reverse the two lines such that the timestamp is recorded after the call to readLines(...).&lt;/p&gt;


&lt;p&gt;(2) On very highly loaded system content could be written between the point the file length is saved and the timestamp is compared.&lt;/p&gt;

&lt;p&gt;The fix is to compare the file date to the &quot;last&quot; timestamp prior to checking its length and to use that boolean result in the nested else if.&lt;/p&gt;

</comment>
                            <comment id="13174763" author="markltbaker" created="Thu, 22 Dec 2011 11:35:05 +0000"  >&lt;p&gt;I see this bug as well, I am using this class to tail log files during a lengthly build process and occasionally the entire log file will be regurgitated &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13174800" author="sbtourist" created="Thu, 22 Dec 2011 13:30:34 +0000"  >&lt;p&gt;Mark, that should be fixed in my fork: &lt;a href=&quot;https://github.com/sbtourist/tayler&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sbtourist/tayler&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13291427" author="sebb@apache.org" created="Thu, 7 Jun 2012 23:44:51 +0000"  >&lt;p&gt;There&apos;s a general problem here, in that it&apos;s not possible to obtain both the file position and the current timestamp (System or File) as part of a single transaction.&lt;/p&gt;

&lt;p&gt;However, the critical case is where the File timestamp is greater than the System timestamp, so it does not matter if the File timestamp is measured too early or the System timestamp is measured too late.&lt;/p&gt;</comment>
                            <comment id="13291497" author="niallp" created="Fri, 8 Jun 2012 02:05:57 +0000"  >&lt;p&gt;Firstly I don&apos;t know why System.currentTimeMillis() is used. What matters is if the files lastModified time compared to its previous lastModified value.&lt;/p&gt;

&lt;p&gt;I agree with Chris that the lastModified time should be stored after the file is read.&lt;/p&gt;</comment>
                            <comment id="13291498" author="niallp" created="Fri, 8 Jun 2012 02:11:15 +0000"  >&lt;p&gt;Ooo, my bad - this is already fixed. Still same as my patch except using file.lastModified() rather than System.currentTimeMillis()&lt;/p&gt;</comment>
                            <comment id="13291627" author="sebb@apache.org" created="Fri, 8 Jun 2012 08:40:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;What matters is if the files lastModified time compared to its previous lastModified value.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, but if that is measured after calling readLines, this might trigger case (2) above.&lt;/p&gt;</comment>
                            <comment id="13504637" author="molendag" created="Tue, 27 Nov 2012 14:31:44 +0000"  >&lt;p&gt;I am tailing with the fixed Tailer (commons-io 2.4.0) a log4j log file and I still see the issue. Despite the fact that the log file was neither rotated nor new data was added, the position is being reset to 0, causing the Tailer re-reading the monitored file from the begining. &lt;/p&gt;

&lt;p&gt;Since log4j&apos;s asynchronous logger is used to log into the monitored file, it might happen, that the modifiedDate is set before the content is actually flushed to the file. &lt;/p&gt;

&lt;p&gt;I assume reseting position was added to cover the case, when the monitored file is overriden. I think it is imposiilble for the Tailer to determine this. The current implementation covers only the case, when the file length is equal to the last read position. If the file legth after being overriden is higher than the last read position, then the Tailer will assume data was normally appended and process the file from the last read position. &lt;/p&gt;

&lt;p&gt;Assuming the data is only appended to the file, I&apos;d just get rid of the reseting position feature from Tailer to resolve the issue finally.&lt;/p&gt;</comment>
                            <comment id="13504713" author="sebb@apache.org" created="Tue, 27 Nov 2012 16:08:57 +0000"  >&lt;p&gt;It seems odd that the OS should update the file modification date before the file has actually been modified.&lt;br/&gt;
I would expect the flush to write the data to the file and then update the date.&lt;/p&gt;

&lt;p&gt;But perhaps it does behave that way.&lt;/p&gt;

&lt;p&gt;Could you provide a patch that works with your use case?&lt;/p&gt;</comment>
                            <comment id="13549558" author="richard_hawkes" created="Thu, 10 Jan 2013 11:41:35 +0000"  >&lt;p&gt;Guys, I have downloaded 2.4 which (I think) you are saying has fixed it. However, I notice that the fileRotated is still getting called erroneously. I have done a fair bit of research into this, and it would seem that the file.length() method is not always 100% up to date, which leads to position occasionally being greater than file.length() !! Quite often it seems to be a few miliseconds behind the actual position. I suppose with that much data bouncing around the network.&lt;/p&gt;

&lt;p&gt;I have added a check after the readLines(reader) to see if position is greater than file.length() if it is, it waits a second. That seems to mop up this issue, although I know it&apos;s one ALMIGHTY hack!&lt;/p&gt;</comment>
                            <comment id="13632780" author="meerlol" created="Tue, 16 Apr 2013 11:54:12 +0000"  >&lt;p&gt;Just a mere &apos;touch &amp;lt;file&amp;gt;&apos; triggers a complete reload of the file. I can not imagine that that is wanted behaviour.&lt;/p&gt;</comment>
                            <comment id="13632806" author="richard_hawkes" created="Tue, 16 Apr 2013 12:51:53 +0000"  >&lt;p&gt;Herman, I don&apos;t think anyone&apos;s looking at this. I would say that the tailer is flawed and should not be used. It&apos;s no better than reading the file via standard Java methods. I had really hoped to leverage this, but such is the way with open source &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13633299" author="sebb@apache.org" created="Tue, 16 Apr 2013 20:20:48 +0000"  >&lt;p&gt;The issue has been marked resolved; if you have a patch please re-open and provide the patch, preferably with a test case that demonstrates the problem.&lt;/p&gt;</comment>
                            <comment id="13633820" author="meerlol" created="Wed, 17 Apr 2013 06:12:56 +0000"  >&lt;p&gt;Well, this is the world turned upside down. I can only reopen the issue if I have a patch for it. That doesn&apos;t make sense. The problem still exists and therefore the ticket should be reopened. I have patched it locally for myself but I doubt that my patch is ok for everyone because I completely removed the last else if statement. For me it makes no sense to check if the file is newer. The only use case would be that the file had been overwritten with exactly the same amount of data. Truncation is not an issue because that would mean that the length and position must have been 0 anyway. For me it is way more likely that the file&apos;s modified time has been updated than that the content has been overwritten with the same amount of bytes.&lt;/p&gt;</comment>
                            <comment id="13633836" author="richard_hawkes" created="Wed, 17 Apr 2013 06:54:56 +0000"  >&lt;p&gt;Strikes me that this should simply be re-opened. Issue is recreatable, but as yet no fix is known.&lt;/p&gt;</comment>
                            <comment id="13633954" author="sebb@apache.org" created="Wed, 17 Apr 2013 11:08:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can only reopen the issue if I have a patch for it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s not what I meant. The issue had been marked resolved, so developers were unlikely to look at it.&lt;br/&gt;
But without a proposed patch (even if incomplete) or a test case, there&apos;s not a lot developers can do.&lt;/p&gt;</comment>
                            <comment id="13635001" author="meerlol" created="Thu, 18 Apr 2013 08:54:05 +0000"  >&lt;p&gt;Hi, here is the requested test case patch. It tests both cases: only the lastmodified updated and content overwritten with exactly the same amount of bytes.&lt;/p&gt;</comment>
                            <comment id="13637320" author="sebb@apache.org" created="Sat, 20 Apr 2013 18:40:17 +0000"  >&lt;p&gt;The test seems wrong to me.&lt;br/&gt;
Only one line is written to the file, yet the check says:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;1 line count&quot;&lt;/span&gt;, 2, lines.size());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, I&apos;m not sure that changing the file modification date should be ignored.&lt;br/&gt;
How can one tell the difference between a file that has been touched from one that has been re-written to the same length? &lt;/p&gt;

&lt;p&gt;Potentially it may even be the same data - that would be an unusual use-case, but not impossible.&lt;br/&gt;
For example, a rotating logger that records events but does not include a timestamp. The same event sequence could recur.&lt;/p&gt;

&lt;p&gt;A further problem with the test case in the patch is that it does not check the data, only the line count.&lt;/p&gt;</comment>
                            <comment id="13637384" author="sebb@apache.org" created="Sat, 20 Apr 2013 22:10:37 +0000"  >&lt;p&gt;Having said that, if there is still a problem whereby the code does not follow the file properly, please provide full details.&lt;/p&gt;</comment>
                            <comment id="13637805" author="meerlol" created="Mon, 22 Apr 2013 07:25:43 +0000"  >&lt;p&gt;I&apos;m sorry, I had the test correct but modified it before making the patch. I will correct it and upload it in a few minutes.&lt;/p&gt;

&lt;p&gt;Let&apos;s be clear, I&apos;m not suggesting to ignore the file modification date as a solution. For me that would be the perfect solution and I think the most common use case as well. The likelihood of the file being touched seems way higher to me than the likelihood that the exact same sequence of bytes are written, especially when the files get larger. And as can be seen from other comments above there are more people reporting this problem. It is probably not an option to make Java 7 a requirement so we can use the WatchService?&lt;/p&gt;</comment>
                            <comment id="13637806" author="meerlol" created="Mon, 22 Apr 2013 07:26:09 +0000"  >&lt;p&gt;Fixed testcase, mea culpa.&lt;/p&gt;</comment>
                            <comment id="13637876" author="sebb@apache.org" created="Mon, 22 Apr 2013 09:41:09 +0000"  >&lt;p&gt;My point was that discriminating between &apos;touch&apos; and an updated file is tricky and not always possible.&lt;br/&gt;
I don&apos;t consider it a fault that the a touched file is seen as new (cf. backup).&lt;/p&gt;

&lt;p&gt;We really need a test case that shows the exact same error.&lt;/p&gt;

&lt;p&gt;Also it would be helpful to know if the failures occurred on Unix or Windows, and whether reOpen is true or false.&lt;/p&gt;</comment>
                            <comment id="13637882" author="meerlol" created="Mon, 22 Apr 2013 09:53:23 +0000"  >&lt;p&gt;I totally agree, it is very hard to discriminate between the different use cases. It might only be possible with Java 7. What do you mean with (cf. backup) by the way?&lt;/p&gt;

&lt;p&gt;My case occurs on Linux (Debian) where I wrote a tool to tail GlassFish log files and out put them to Kafka. Every now and then it spits out the entire log file again, which makes the Tailer useless for me. I have a suspicion that the problem might be related to the fact that the &apos;last&apos; is set to System.currentTimeMillis() instead of to file.lastModified(). Maybe there is a granularity difference between the two, where the FS rounds the last modified upwards? If I stat the file then it always has a 1 sec precision. That would explain it I guess. I will patch it here and run a test today.&lt;/p&gt;</comment>
                            <comment id="13637900" author="sebb@apache.org" created="Mon, 22 Apr 2013 10:26:12 +0000"  >&lt;p&gt;OK thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(cf. backup)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I meant that backup treats touched files as new, so Tailer should too.&lt;/p&gt;
</comment>
                            <comment id="13641863" author="meerlol" created="Thu, 25 Apr 2013 14:43:04 +0000"  >&lt;p&gt;Ok, I&apos;ve tested the patch for a few days now. The problem has not reoccured anymore whereas before it used to happen multiple times per day. I have attached the patch.&lt;/p&gt;</comment>
                            <comment id="13642645" author="sebb@apache.org" created="Fri, 26 Apr 2013 07:14:45 +0000"  >&lt;p&gt;Thanks. Can you confirm exactly what you changed? Did you replace all 3 instances of System.currentTimeMillis() or only some of them?&lt;/p&gt;

&lt;p&gt;Also the new test case testModifiedTime fails for me both with the current code and when the code is patched by replacing all 3 System.currentTimeMillis() with file.lastModifiedTime(). Is that what you expect? Or should the test succeed?&lt;/p&gt;</comment>
                            <comment id="13642647" author="meerlol" created="Fri, 26 Apr 2013 07:20:58 +0000"  >&lt;p&gt;Yes I replaced all 3 instances of System.currentTimeMillis()&lt;/p&gt;

&lt;p&gt;The test will indeed still fail, it doesn&apos;t solve the specific case of differentiating between the touch of a file and overwriting the contents of the file with the exact same amount of bytes. It solves this specific bug as the title says &apos;Tailer erroneously considers file as new&apos;. So I guess it is better to create a new ticket and attach the testcase to that ticket, because that is a different bug (which is very hard to solve as has already been said by most of us).&lt;/p&gt;</comment>
                            <comment id="13642652" author="sebb@apache.org" created="Fri, 26 Apr 2013 07:52:12 +0000"  >&lt;p&gt;OK, thanks, I&apos;ll apply the same fix to Tailer.&lt;/p&gt;</comment>
                            <comment id="13642690" author="sebb@apache.org" created="Fri, 26 Apr 2013 08:48:21 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1476097&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1476097&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/IO-279&quot; title=&quot;Tailer erroneously considers file as new&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-279&quot;&gt;&lt;del&gt;IO-279&lt;/del&gt;&lt;/a&gt;  Tailer erroneously considers file as new.&lt;br/&gt;
        Fix to use file.lastModified() rather than System.currentTimeMillis()&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/io/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/io/trunk/src/main/java/org/apache/commons/io/input/Tailer.java&lt;/p&gt;</comment>
                            <comment id="13701007" author="otis" created="Fri, 5 Jul 2013 17:15:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;My case occurs on Linux (Debian) where I wrote a tool to tail GlassFish log files and out put them to Kafka. Every now and then it spits out the entire log file again, which makes the Tailer useless for me.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What about tracking the current position/line in the file, at least approximately.&lt;br/&gt;
Then, after detecting apparent new/rotated file one could check things like size of the file or some such and compare it with the offset to answer the question such as &quot;Does this apparently new file that I&apos;m about to start tailing from its beginning actually already have the offset I was at before?  If so, maybe this is the same file and somebody just touched it.  In that case, let me just jump to that offset&quot;.&lt;/p&gt;

&lt;p&gt;Doable?&lt;/p&gt;</comment>
                            <comment id="13701020" author="sebb@apache.org" created="Fri, 5 Jul 2013 17:44:04 +0000"  >&lt;p&gt;Note that the particular problem you quoted has been solved.&lt;/p&gt;

&lt;p&gt;We already keep track of the location in the file within the code, and we compare file sizes and times.&lt;/p&gt;

&lt;p&gt;The problem is trying to distinguish a file that has been touched from a file that has been rewritten or truncated to exactly the same size.&lt;/p&gt;</comment>
                            <comment id="13701104" author="otis" created="Fri, 5 Jul 2013 20:27:22 +0000"  >&lt;p&gt;Thanks Sebb.  I see.  So things like logrotate can confuse the tailer if they truncate files instead of moving them?&lt;/p&gt;</comment>
                            <comment id="13720991" author="mqsquidy" created="Fri, 26 Jul 2013 17:47:30 +0000"  >&lt;p&gt;Just wanted to confirm to anyone who cares, commons-io 2.4 tag with the April patch attached to this JIRA, still has the issue in the scenerio we are using it. We have a daemon network listener process written in C++ that opens a log file, appends new data, closes the file, repeatedly, for which we are trying to use the Tailer classes to pump the log through Kafka, similar to Herman in the above thread. Using commons-io 2.4 prebuilt jar we were getting the intermittent reatart on almost all hosts more than once a day. Using the patched jar it happened less, but still happens. I am trying the forked version in github published by Sergio. I will respond with my findings.&lt;/p&gt;</comment>
                            <comment id="13755691" author="kgr" created="Sun, 1 Sep 2013 09:34:14 +0000"  >&lt;p&gt;In many cases it can be assumed that a file can not be overwritten with the exact same length of data (always will be smaller after reset). In our project we are using a slightly patched version of commons-io library with a flag added to the Tailer class that enables/disables resetting file position when a file update is encountered but a file length is not changed. If we are sure that a file can not be overwritten with the exact size then we disable the flag to prevent this issue. I&apos;ve attached the patch we are using (&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12600974/12600974_disable_resetting.patch&quot; title=&quot;disable_resetting.patch attached to IO-279&quot;&gt;disable_resetting.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;). It is based on the version 2.4. Maybe it would be worth to apply this patch to the trunk?&lt;/p&gt;</comment>
                            <comment id="13920732" author="unlogic" created="Wed, 5 Mar 2014 10:47:27 +0000"  >&lt;p&gt;I stumbled across this issue while tailing a file on a remote server via Samba.&lt;/p&gt;

&lt;p&gt;The clock on the server was running a few seconds ahead of my local machine which caused the file to be seen as newer even though it wasn&apos;t.&lt;/p&gt;

&lt;p&gt;I solved this by simply replacing the line:&lt;/p&gt;

&lt;p&gt;last = System.currentTimeMillis();&lt;/p&gt;

&lt;p&gt;With:&lt;/p&gt;

&lt;p&gt;last = file.lastModified();&lt;/p&gt;

&lt;p&gt;That way it doesn&apos;t matter if the clocks are not in perfect sync.&lt;/p&gt;</comment>
                            <comment id="13920981" author="sebb@apache.org" created="Wed, 5 Mar 2014 15:46:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;last = file.lastModified();&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That change has already been made in trunk and will be in 2.5&lt;/p&gt;</comment>
                            <comment id="13923678" author="liuhongyan" created="Fri, 7 Mar 2014 08:15:00 +0000"  >&lt;p&gt;I have downloaded from the trunk, but the question remains.Repeat output for three times, it seems that problems unresolved.&lt;/p&gt;</comment>
                            <comment id="14025201" author="sleepy9090" created="Mon, 9 Jun 2014 13:58:28 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I was curious if there has been any progress on this issue?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14335787" author="spullara" created="Wed, 25 Feb 2015 01:15:50 +0000"  >&lt;p&gt;We are running into this bug on a terribly slow EBS volume. I think that the behavior should match what &quot;tail -f&quot; would do in this situation which appears to not reset the read position when the file is newer and the lengths are equal. Only if the length is less do they consider it a truncation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://git.savannah.gnu.org/cgit/coreutils.git/tree/src/tail.c#n1205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git.savannah.gnu.org/cgit/coreutils.git/tree/src/tail.c#n1205&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14335807" author="spullara" created="Wed, 25 Feb 2015 01:29:20 +0000"  >&lt;p&gt;Also, any plan to upgrade this to Java 7 so we can use the WatchService rather than this polling version?&lt;/p&gt;</comment>
                            <comment id="14541633" author="kervin" created="Wed, 13 May 2015 09:10:07 +0000"  >&lt;p&gt;This issue is still present in 2.5-SNAPSHOT and I think found why, at least for my application.&lt;/p&gt;

&lt;p&gt;The problem is on some OSes &apos;File.lastmodified()&apos; is cached until an event e.g. File.close().  This at least happens on Windows in some circumstances.  I was monitoring a log4net file on a IIS application.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Reference&lt;/b&gt; : &lt;a href=&quot;http://blogs.technet.com/b/asiasupp/archive/2010/12/14/file-date-modified-property-are-not-updating-while-modifying-a-file-without-closing-it.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://blogs.technet.com/b/asiasupp/archive/2010/12/14/file-date-modified-property-are-not-updating-while-modifying-a-file-without-closing-it.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This means that the file will grow in reported size as it remains open, but the &apos;lastmodified()&apos; result will remain constant until that other application closes the file.&lt;/p&gt;

&lt;p&gt;Tailer does something very puzzling.  It will call seek(0) in this case...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Tailer.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newer) {
                        /*
                         * This can happen &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the file is truncated or overwritten with the exact same length of
                         * information. In cases like &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, the file position needs to be reset
                         */
                        position = 0;
                        reader.seek(position); &lt;span class=&quot;code-comment&quot;&gt;// cannot be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; here
&lt;/span&gt;
                        &lt;span class=&quot;code-comment&quot;&gt;// Now we can read &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; lines
&lt;/span&gt;                        position = readLines(reader);
                        last = file.lastModified();
                    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Shouldn&apos;t Tailer throw an exception in the worse case?  But I would argue that seeing the lastmodified update but not seeing the size update isn&apos;t really an exception condition.  The file could have been &apos;touched&apos;, lastmodified manually set other ways, etc.&lt;/p&gt;

&lt;p&gt;By the way, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kgr&quot; class=&quot;user-hover&quot; rel=&quot;kgr&quot;&gt;kgr&lt;/a&gt; also proposed similar in September 2013.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spullara&quot; class=&quot;user-hover&quot; rel=&quot;spullara&quot;&gt;spullara&lt;/a&gt; also proposed this in February 2015.&lt;/p&gt;

&lt;p&gt;There can be a &apos;useFileTimestamps&apos; flag which would allow users to ignore the lastmodified() related tests.  Using filesize as the only method of detecting change.&lt;/p&gt;</comment>
                            <comment id="14695997" author="shawnhe" created="Thu, 13 Aug 2015 21:44:23 +0000"  >&lt;p&gt;I am encountering the same issue with commons-io 2.4 and using the Tailer class. I assume we could manually build a commons-io class and use that in Java before an official release comes out with a patch suggested by the above two people.&lt;/p&gt;</comment>
                            <comment id="15241662" author="vanteo" created="Thu, 14 Apr 2016 18:16:07 +0000"  >&lt;p&gt;I am also encountering this problem with 2.4. Using it on RHEL 5.11 (yes, very old). It seems that there is a window that gets hit a few times per day where the OS file system updates the file modification date slightly before the file size is updated, hence Tailer thinks it needs to re-read from the very beginning.&lt;/p&gt;

&lt;p&gt;To workaround, I have removed all checks to file modification time from the run method. In my case, detecting changes by file size alone is enough. It would be nice for this to be configurable.&lt;/p&gt;</comment>
                            <comment id="15902016" author="vanteo" created="Wed, 8 Mar 2017 21:41:25 +0000"  >&lt;p&gt;FYI. This issue is still present on commons.io 2.5 on RHEL 5.11 for me.&lt;/p&gt;</comment>
                            <comment id="16076219" author="githubbot" created="Thu, 6 Jul 2017 09:18:36 +0000"  >&lt;p&gt;GitHub user myyron opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-io/pull/40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/40&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-279&quot; title=&quot;Tailer erroneously considers file as new&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-279&quot;&gt;&lt;del&gt;IO-279&lt;/del&gt;&lt;/a&gt;: Added ignoreNew parameter on instantiating Tailer.&lt;/p&gt;

&lt;p&gt;    Encountered this bug today when we try to tail a file that is being modified even though there is no new content being added.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/myyron/commons-io&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/myyron/commons-io&lt;/a&gt; IO_279&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-io/pull/40.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/40.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #40&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 79dd3567811f0f155c43cb88f331489b85e6189c&lt;br/&gt;
Author: mlatorilla &amp;lt;mlatorilla@sunpowercorp.com&amp;gt;&lt;br/&gt;
Date:   2017-07-06T08:44:57Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-279&quot; title=&quot;Tailer erroneously considers file as new&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-279&quot;&gt;&lt;del&gt;IO-279&lt;/del&gt;&lt;/a&gt;: Added ignoreNew parameter on instantiating Tailer.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="17527959" author="JIRAUSER288635" created="Tue, 26 Apr 2022 07:20:18 +0000"  >&lt;p&gt;Issue is still present in version 2.7. As it is in reopen state, Kindly confirm if it is being planned to fix in upcoming release.&lt;/p&gt;</comment>
                            <comment id="17528366" author="garydgregory" created="Tue, 26 Apr 2022 19:18:23 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apoorva+Maheshwari&quot; class=&quot;user-hover&quot; rel=&quot;Apoorva Maheshwari&quot;&gt;Apoorva Maheshwari&lt;/a&gt;&lt;br/&gt;
2.7 is old, please check the current version. If you bnb want anything done, feel free to provide a PR on GitHub &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17528636" author="JIRAUSER288635" created="Wed, 27 Apr 2022 08:24:03 +0000"  >&lt;p&gt;Issue is also present in 2.11 version. Please check.&lt;/p&gt;</comment>
                            <comment id="17631266" author="JIRAUSER298285" created="Wed, 9 Nov 2022 20:21:13 +0000"  >&lt;p&gt;Is there a progress on fixing this issue? I still encounter this problem.&lt;/p&gt;</comment>
                            <comment id="17631268" author="garydgregory" created="Wed, 9 Nov 2022 20:24:36 +0000"  >&lt;p&gt;I think any PR in this area is likely outdated, so feel free to provide one on GitHub.&#160;&lt;/p&gt;</comment>
                            <comment id="17988036" author="JIRAUSER310138" created="Thu, 3 Jul 2025 04:13:10 +0000"  >&lt;p&gt;new PR &lt;a href=&quot;https://github.com/apache/commons-io/pull/757&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/757&lt;/a&gt; to solve the last parts of this issue.&#160;&lt;br/&gt;
Adds a new&#160; &quot;ignoreTouc&quot;h flag to the builder. With default false, behaviour is unchanged. Set to true ignores timestamp updates.&lt;/p&gt;</comment>
                            <comment id="17998271" author="garydgregory" created="Sat, 5 Jul 2025 13:16:28 +0000"  >&lt;p&gt;TY &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbudi&quot; class=&quot;user-hover&quot; rel=&quot;jbudi&quot;&gt;jbudi&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;PR merged to git master and snapshot builds in &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13023515">IO-523</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12531358" name="IO-279.patch" size="1522" author="niallp" created="Fri, 8 Jun 2012 02:05:57 +0000"/>
                            <attachment id="12600974" name="disable_resetting.patch" size="2691" author="kgr" created="Sun, 1 Sep 2013 09:50:44 +0000"/>
                            <attachment id="12580537" name="fix-tailer.patch" size="1504" author="meerlol" created="Thu, 25 Apr 2013 14:43:04 +0000"/>
                            <attachment id="12579793" name="modify-test-fixed.patch" size="2491" author="meerlol" created="Mon, 22 Apr 2013 07:26:09 +0000"/>
                            <attachment id="12579292" name="modify-test.patch" size="2491" author="meerlol" created="Thu, 18 Apr 2013 08:54:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3157</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b0mv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62215</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>