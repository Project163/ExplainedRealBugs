<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:28:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-755] Using FileUtils.listFiles() with background changes fails on Linux</title>
                <link>https://issues.apache.org/jira/browse/IO-755</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;When calling &lt;tt&gt;FileUtils.listFiles&lt;/tt&gt; and a file is being removed from this or a subdirectory during the execution the following Error occurs on linux.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Stacktrace&quot;&gt;&lt;/a&gt;Stacktrace&lt;/h3&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language: trace.&lt;/span&gt; Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yaml&lt;/div&gt;&lt;pre&gt;
Caused by: java.nio.file.NoSuchFileException: /**
	at java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)
	at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)
	at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116)
	at java.base/sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)
	at java.base/sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:149)
	at java.base/sun.nio.fs.LinuxFileSystemProvider.readAttributes(LinuxFileSystemProvider.java:99)
	at java.base/java.nio.file.Files.readAttributes(Files.java:1764)
	at java.base/java.nio.file.FileTreeWalker.getAttributes(FileTreeWalker.java:219)
	at java.base/java.nio.file.FileTreeWalker.visit(FileTreeWalker.java:276)
	at java.base/java.nio.file.FileTreeWalker.next(FileTreeWalker.java:373)
	at java.base/java.nio.file.Files.walkFileTree(Files.java:2761)
	at org.apache.commons.io.FileUtils.listAccumulate(FileUtils.java:2076)
	at org.apache.commons.io.FileUtils.listFiles(FileUtils.java:2132)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;&lt;a name=&quot;Upgradeofapachecommonsio&quot;&gt;&lt;/a&gt;Upgrade of apache commons-io&lt;/h3&gt;
&lt;p&gt;The version of the dependency was upgraded from 2.8 to 2.11. In 2.9 the library started using java.nio instead of java.io which might behave differently on unix, when a file is not existent during processing of directories.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Causingfunctionalityinourimplementation&quot;&gt;&lt;/a&gt;Causing functionality in our implementation&lt;/h3&gt;
&lt;p&gt;In some part we have multithreaded access to the filesystem. A folder is accessed from multiple threads which access the folder with &lt;tt&gt;org.apache.commons.io.FileUtils#listFiles(java.io.File, org.apache.commons.io.filefilter.IOFileFilter, org.apache.commons.io.filefilter.IOFileFilter)&lt;/tt&gt;. These threads also &lt;b&gt;move&lt;/b&gt;, &lt;b&gt;delete&lt;/b&gt; and &lt;b&gt;rename&lt;/b&gt; files from this directory. While this seems to be working on a windows machine, it is not the case on a Linux machine. In 2.8 apparently there was no issue with this.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;In short&lt;/b&gt;: While a directory is being listed with &lt;tt&gt;FileUtils.listFiles()&lt;/tt&gt;, a file is being deleted. When trying to read its file-attributes it stops because of a &lt;tt&gt;NoSuchFileException&lt;/tt&gt;.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Othercommonsiofunctionalities&quot;&gt;&lt;/a&gt;Other commons-io functionalities&lt;/h3&gt;
&lt;p&gt;We tried using &lt;tt&gt;PathUtils.walk(directory filters, 5, false).map(Path::toFile).collect(Collectors.toList())&lt;/tt&gt;. This method was introduced with the same change.&lt;br/&gt;
This produced a similar stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language: trace.&lt;/span&gt; Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yaml&lt;/div&gt;&lt;pre&gt;
Caused by: java.io.UncheckedIOException: java.nio.file.NoSuchFileException: /*
	at java.base/java.nio.file.FileTreeIterator.fetchNextIfNeeded(FileTreeIterator.java:87)
	at java.base/java.nio.file.FileTreeIterator.hasNext(FileTreeIterator.java:103)
	at java.base/java.util.Iterator.forEachRemaining(Iterator.java:132)
	at java.base/java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)
	at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:913)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:578)
	... 47 more
Caused by: java.nio.file.NoSuchFileException: /*
	at java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)
	at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)
	at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116)
	at java.base/sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)
	at java.base/sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:149)
	at java.base/sun.nio.fs.LinuxFileSystemProvider.readAttributes(LinuxFileSystemProvider.java:99)
	at java.base/java.nio.file.Files.readAttributes(Files.java:1764)
	at java.base/java.nio.file.FileTreeWalker.getAttributes(FileTreeWalker.java:219)
	at java.base/java.nio.file.FileTreeWalker.visit(FileTreeWalker.java:276)
	at java.base/java.nio.file.FileTreeWalker.next(FileTreeWalker.java:373)
	at java.base/java.nio.file.FileTreeIterator.fetchNextIfNeeded(FileTreeIterator.java:83)
	... 59 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;&lt;a name=&quot;gitcommit&quot;&gt;&lt;/a&gt;git commit&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-io/commit/4a514d3306b55b3667d1449ebd4cbe5f19dd7af0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/commit/4a514d3306b55b3667d1449ebd4cbe5f19dd7af0&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;OtherQuestions&quot;&gt;&lt;/a&gt;Other Questions&lt;/h3&gt;
&lt;ul&gt;
	&lt;li&gt;What was the reason to wrap all &lt;tt&gt;IOException&lt;/tt&gt; into &lt;tt&gt;UncheckedIOException&lt;/tt&gt; in those methods?&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13408894">IO-755</key>
            <summary>Using FileUtils.listFiles() with background changes fails on Linux</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="EaseRider">Alexis Suter</reporter>
                        <labels>
                            <label>listFiles</label>
                    </labels>
                <created>Thu, 28 Oct 2021 12:30:52 +0000</created>
                <updated>Mon, 10 Oct 2022 15:46:17 +0000</updated>
                            <resolved>Mon, 20 Jun 2022 13:12:48 +0000</resolved>
                                    <version>2.9.0</version>
                    <version>2.10.0</version>
                    <version>2.11.0</version>
                                    <fixVersion>2.12.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17435386" author="easerider" created="Thu, 28 Oct 2021 12:58:33 +0000"  >&lt;p&gt;Will be reopened, when reviewed.&lt;/p&gt;</comment>
                            <comment id="17435572" author="garydgregory" created="Thu, 28 Oct 2021 17:20:57 +0000"  >&lt;p&gt;&quot;Will be reopened, when reviewed.&quot;&lt;/p&gt;

&lt;p&gt;What does this mean?&lt;/p&gt;</comment>
                            <comment id="17435929" author="easerider" created="Fri, 29 Oct 2021 11:14:12 +0000"  >&lt;p&gt;Had to discuss something with a colleague to be sure of the issue.&lt;/p&gt;</comment>
                            <comment id="17435968" author="garydgregory" created="Fri, 29 Oct 2021 12:55:13 +0000"  >&lt;p&gt;WRT exceptions, unchecked exceptions make using lambdas easy.&lt;/p&gt;</comment>
                            <comment id="17436000" author="garydgregory" created="Fri, 29 Oct 2021 13:59:09 +0000"  >&lt;p&gt;How about using &lt;tt&gt;PathUtils.walk(Path, PathFilter, int, boolean, FileVisitOption...)&lt;/tt&gt;&#160;and passing &lt;tt&gt;false&lt;/tt&gt;&#160;to &lt;tt&gt;readAttributes&lt;/tt&gt; which is what &lt;tt&gt;FileUtils.streamFiles(File, boolean, String...)&lt;/tt&gt;&#160;and consequently &lt;tt&gt;FileUtils.iterateFiles(File, String[], boolean)&lt;/tt&gt; and&#160;&lt;br/&gt;
 &lt;tt&gt;FileUtils.listFiles(File, String[], boolean)&lt;/tt&gt; do.&lt;/p&gt;

&lt;p&gt;It would be nice if &lt;tt&gt;java.nio.file.FileVisitOption&lt;/tt&gt;&#160;had a &lt;tt&gt;DONT_READ_FILE_ATTRIBUTES&lt;/tt&gt;&#160;value I suppose as it looks like attribute reading in baked-in file walking.&lt;/p&gt;</comment>
                            <comment id="17437382" author="easerider" created="Tue, 2 Nov 2021 14:23:07 +0000"  >&lt;p&gt;This is what we tried as well with similar exception as described in the issue. I also found a very similar issue someone had using &lt;tt&gt;Files.walkFileTree&lt;/tt&gt;: &lt;a href=&quot;https://stackoverflow.com/questions/46203630/how-do-i-prevent-java-filetreewalker-failing-prematurely&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/46203630/how-do-i-prevent-java-filetreewalker-failing-prematurely&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here they changed the behaviour of the &lt;tt&gt;SimpleFileVisitor.visitFileFailed&lt;/tt&gt; to skip and log &lt;tt&gt;AccessDeniedException&lt;/tt&gt;. As described in the issues response they suggest to catch &lt;tt&gt;NoSuchFileException&lt;/tt&gt; as well. Also there seems to be a problem with .tar files on Windows.&lt;/p&gt;

&lt;p&gt;Do you think it would be a nice solution to use an extension of the &lt;tt&gt;AccumulatorPathVisitor&lt;/tt&gt; in &lt;tt&gt;org.apache.commons.io.FileUtils#listAccumulate&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;I don&apos;t know other reasons than a removed file why a &lt;tt&gt;NoSuchFileException&lt;/tt&gt; would occur, when walking through directories. General questions: Should any other exception be handled as well? &lt;/p&gt;</comment>
                            <comment id="17437455" author="garydgregory" created="Tue, 2 Nov 2021 16:18:40 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=EaseRider&quot; class=&quot;user-hover&quot; rel=&quot;EaseRider&quot;&gt;EaseRider&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Feel free to provide a PR on GitHub so we can see what this would look like.&lt;/p&gt;

&lt;p&gt;I am not sure this is doable without providing a custom tree walker implementation.&#160;&lt;/p&gt;</comment>
                            <comment id="17487775" author="garydgregory" created="Sun, 6 Feb 2022 22:14:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=EaseRider&quot; class=&quot;user-hover&quot; rel=&quot;EaseRider&quot;&gt;EaseRider&lt;/a&gt; ping?&lt;/p&gt;</comment>
                            <comment id="17513909" author="JIRAUSER287233" created="Tue, 29 Mar 2022 08:13:18 +0000"  >&lt;p&gt;I think I have experienced this problem or a very similar one on Windows Server. I have a couple of java applications which process messages in the form of files which are deposited in a number of folders. I use FileUtils.listFiles every few seconds to determine if there is a file which needs processing. This can run for many days at which point it seems to stop finding any files in a folder even when there are some present. I was using version 2.11.0 - I have now reverted to version 2.6 and so far my stress test application has not exhibited the same problem. No idea what the trigger is - maybe resource leak or some unhandled exception to do with not being able to scan a network folder if the remote machine is rebooted.&lt;/p&gt;</comment>
                            <comment id="17556369" author="garydgregory" created="Mon, 20 Jun 2022 13:12:48 +0000"  >&lt;p&gt;The API now ignores file visitation failures as they occur. Please try git master or a 2.12.0-SNAPSHOT build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/commons-io/commons-io/2.12.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/commons-io/commons-io/2.12.0-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17615159" author="easerider" created="Mon, 10 Oct 2022 15:15:36 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I finally found the time to test the fix. Using 2.12.0-SNAPSHOT the fix works fine! I also looked into the code-changes in FileUtils and I believe the &lt;tt&gt;(p, e) -&amp;gt; FileVisitResult.CONTINUE&lt;/tt&gt; is a good solution.&lt;/p&gt;

&lt;p&gt;Thank you very much for looking into it.&lt;/p&gt;</comment>
                            <comment id="17615176" author="garydgregory" created="Mon, 10 Oct 2022 15:46:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=EaseRider&quot; class=&quot;user-hover&quot; rel=&quot;EaseRider&quot;&gt;EaseRider&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Good news! Thank you for verifying the change.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0w8u8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>