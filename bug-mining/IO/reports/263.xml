<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:27:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-718] FileUtils.checksumCRC32 and FileUtils.checksum are not thread safe</title>
                <link>https://issues.apache.org/jira/browse/IO-718</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;When calling &lt;tt&gt;FileUtils.checksumCRC32&lt;/tt&gt; from multiple threads (in order to improve throughput when calculating CRC&apos;s for a large folder), the code is not thread-safe, resulting in incorrect CRC output.&lt;/p&gt;

&lt;p&gt;The following simple test demonstrates the issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void should() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ExecutionException, InterruptedException {
  File testFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\Temp\\large-file.txt&quot;&lt;/span&gt;);
  &lt;span class=&quot;code-comment&quot;&gt;// ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);
&lt;/span&gt;  ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(5);
  List&amp;lt;Future&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;&amp;gt; futures = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 20; i++) {
    futures.add(scheduler.submit(() -&amp;gt; FileUtils.checksumCRC32(testFile)));
  }
  List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; crcs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Future&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; : futures) {
    crcs.add(&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.get());
  }
  Assertions.assertThat(crcs).allMatch(c -&amp;gt; crcs.get(0).equals(c));
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the above code, with a thread-pool size of 1, all calculated CRC&apos;s for the file are the same.&#160; With a thread-pool size of more, the CRC&apos;s differ.&lt;/p&gt;

&lt;p&gt;The issue appears to be related to the use of a common &lt;tt&gt;SKIP_BYTE_BUFFER&lt;/tt&gt; in &lt;tt&gt;IOUtils.consume&lt;/tt&gt;.&#160; The multiple threads all read into the same buffer as the data is being &quot;discarded&quot;.&#160; However, &lt;tt&gt;FileUtils.checksum&lt;/tt&gt; uses a &lt;tt&gt;CheckedInputStream&lt;/tt&gt; to calculate the CRC, which uses the value read into the shared buffer.&#160; With multiple threads writing to that buffer the CRC mechanism breaks down.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Apache Commons Io 2.8.0.&lt;/p&gt;

&lt;p&gt;JDK 1.8.0_181.&lt;/p&gt;</environment>
        <key id="13356493">IO-718</key>
            <summary>FileUtils.checksumCRC32 and FileUtils.checksum are not thread safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="robabod">Robert Cooper</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2021 12:33:30 +0000</created>
                <updated>Wed, 17 Feb 2021 16:17:07 +0000</updated>
                            <resolved>Wed, 17 Feb 2021 16:17:07 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.9.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17277973" author="robabod" created="Wed, 3 Feb 2021 12:38:38 +0000"  >&lt;p&gt;Note that I did not spot anywhere in the documentation that stated the code was not thread-safe, although it&apos;s entirely possible I may have missed it.&lt;/p&gt;

&lt;p&gt;Also worth noting that the code in which we found this issue isn&apos;t calculating the CRC of the same file repeatedly, instead working on different files, but the code listed above is a quick demonstration of the issue.&lt;/p&gt;</comment>
                            <comment id="17285944" author="garydgregory" created="Wed, 17 Feb 2021 16:16:20 +0000"  >&lt;p&gt;Note that the char buffer was/is documented as thread unsafe and mentions that buffers (plural) are shared this is not explicitly stated for the byte buufer.&lt;/p&gt;

&lt;p&gt;Regardless, this is easy to address. Please see git master or the latest snapshot build.&lt;/p&gt;

&lt;p&gt;In general, do not assume thread-safety unless it is stated.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nba0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>