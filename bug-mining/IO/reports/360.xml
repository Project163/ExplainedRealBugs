<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:29:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-781] CharSequenceInputStream.available() returns too large numbers in some cases</title>
                <link>https://issues.apache.org/jira/browse/IO-781</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h3&gt;
&lt;p&gt;The &lt;tt&gt;available()&lt;/tt&gt; method of &lt;tt&gt;org.apache.commons.io.input.CharSequenceInputStream&lt;/tt&gt; erroneously returns values larger than the actual number of available bytes in some cases.&lt;/p&gt;

&lt;p&gt;The underlying issue is that &lt;tt&gt;CharSequenceInputStream&lt;/tt&gt; makes incorrect assumptions about the relation between chars and bytes. The &lt;tt&gt;CodingErrorAction.REPLACE&lt;/tt&gt; can convert 2 chars (1 supplementary code point) to one byte (the replacement char &lt;tt&gt;?&lt;/tt&gt;). Additionally in case &lt;tt&gt;CharSequenceInputStream&lt;/tt&gt; is ever extended to support specifying a &lt;tt&gt;CharsetEncoder&lt;/tt&gt;, the &lt;tt&gt;CodingErrorAction.IGNORE&lt;/tt&gt; would probably cause similar issues. There might also be some uncommon charsets which can encode 2 chars to 1 byte; though I am not aware of such charset yet.&lt;/p&gt;

&lt;p&gt;This was originally mentioned in pull request &lt;a href=&quot;https://github.com/apache/commons-io/pull/293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#293&lt;/a&gt;. That PR also proposed to replace the underlying &lt;tt&gt;CharSequenceInputStream&lt;/tt&gt; implementation with &lt;tt&gt;ReaderInputStream&lt;/tt&gt; because in general using &lt;tt&gt;CharsetEncoder&lt;/tt&gt; is error-prone so it might be good to avoid having two classes implementing logic on top of it. (Potentially &lt;tt&gt;CharSequenceInputStream&lt;/tt&gt; is missing a call to &lt;tt&gt;CharsetEncoder.flush&lt;/tt&gt;, see also &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-714&quot; title=&quot;ReaderInputStream does not call CharsetEncoder.flush(...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-714&quot;&gt;&lt;del&gt;IO-714&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Example&quot;&gt;&lt;/a&gt;Example&lt;/h3&gt;
&lt;p&gt;In the example below &lt;tt&gt;available()&lt;/tt&gt; erroneously returns 2 even though only 1 byte can be read.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Charset charset = Charset.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;Big5&quot;&lt;/span&gt;);
CharSequenceInputStream in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CharSequenceInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;\uD800\uDC00&quot;&lt;/span&gt;, charset);
&lt;span class=&quot;code-comment&quot;&gt;// BUG: available() returns 2 but only 1 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; is read afterwards
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Available: &quot;&lt;/span&gt; + in.available());
&lt;span class=&quot;code-comment&quot;&gt;// Note: readAllBytes() is a method added in Java 9
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Actually read: &quot;&lt;/span&gt; + in.readAllBytes().length);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13481018">IO-781</key>
            <summary>CharSequenceInputStream.available() returns too large numbers in some cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Marcono1234">Marcono1234</reporter>
                        <labels>
                    </labels>
                <created>Sun, 11 Sep 2022 14:21:44 +0000</created>
                <updated>Tue, 26 Dec 2023 18:57:29 +0000</updated>
                            <resolved>Sat, 23 Dec 2023 02:46:11 +0000</resolved>
                                    <version>2.11.0</version>
                                    <fixVersion>2.16.0</fixVersion>
                                    <component>Streams/Writers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17603145" author="garydgregory" created="Mon, 12 Sep 2022 15:19:35 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Marcono1234&quot; class=&quot;user-hover&quot; rel=&quot;Marcono1234&quot;&gt;Marcono1234&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;We gladly welcome PRs on GitHub &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17728974" author="garydgregory" created="Sat, 3 Jun 2023 13:35:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;Additionally in case CharSequenceInputStream is ever extended to support specifying a CharsetEncoder&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;br/&gt;
For more advanced use cases, &lt;tt&gt;CharSequenceInputStream.Builder&lt;/tt&gt; now supports &lt;tt&gt;setCharsetEncoder(CharsetEncoder)&lt;/tt&gt;; in git master and snapshot builds.&lt;/p&gt;</comment>
                            <comment id="17768287" author="garydgregory" created="Sat, 23 Sep 2023 13:24:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Marcono1234&quot; class=&quot;user-hover&quot; rel=&quot;Marcono1234&quot;&gt;Marcono1234&lt;/a&gt;&lt;br/&gt;
Does this resolve your issue?&lt;/p&gt;</comment>
                            <comment id="17768405" author="marcono1234" created="Sun, 24 Sep 2023 16:01:32 +0000"  >&lt;p&gt;No, as hinted in the description of this issue, the new &lt;tt&gt;CharSequenceInputStream.Builder&lt;/tt&gt; with its &lt;tt&gt;setCharsetEncoder&lt;/tt&gt; method now introduced a second variant of this bug:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Additionally in case &lt;tt&gt;CharSequenceInputStream&lt;/tt&gt; is ever extended to support specifying a &lt;tt&gt;CharsetEncoder&lt;/tt&gt;, the &lt;tt&gt;CodingErrorAction.IGNORE&lt;/tt&gt; would probably cause similar issues.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Using the new &lt;tt&gt;setCharsetEncoder&lt;/tt&gt; method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Charset charset = StandardCharsets.US_ASCII;
CharSequenceInputStream in = CharSequenceInputStream.builder()
    .setCharsetEncoder(charset.newEncoder().onUnmappableCharacter(CodingErrorAction.IGNORE))
    .setCharSequence(&lt;span class=&quot;code-quote&quot;&gt;&quot;\uD800\uDC00&quot;&lt;/span&gt;)
    .get();
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Available: &quot;&lt;/span&gt; + in.available());
&lt;span class=&quot;code-comment&quot;&gt;// Note: readAllBytes() is a method added in Java 9
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Actually read: &quot;&lt;/span&gt; + in.readAllBytes().length);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This prints:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Available: 2
Actually read: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17793635" author="swingguy1024@yahoo.com" created="Wed, 6 Dec 2023 11:00:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Marcono1234&quot; class=&quot;user-hover&quot; rel=&quot;Marcono1234&quot;&gt;Marcono1234&lt;/a&gt; Does this only happen with Surrogate Pairs? If so, I&apos;m not sure how to fix it, but before we do, I wonder if it would make sense to add a note in the documentation that currently, the available method doesn&apos;t work when the text includes surrogate pairs. These code points are not for Unicode characters. For information on surrogate pairs, read Unicode&apos;s description at &lt;a href=&quot;https://www.unicode.org/glossary/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Glossary (unicode.org)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Surrogates are code points, but not unicode characters. They have a distinct range, from D800 to DBFF for the first code point, and from DC00 to DFFFF for the second code point. They always come in pairs or they don&apos;t work. So it shouldn&apos;t be hard to scan and identify them. If I understand them correctly, each surrogate pair, such as &quot;\uD800\uDC00&quot; decodes to a single character.&#160;&lt;/p&gt;</comment>
                            <comment id="17795002" author="marcono1234" created="Sat, 9 Dec 2023 23:37:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SwingGuy1024%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;SwingGuy1024@yahoo.com&quot;&gt;SwingGuy1024@yahoo.com&lt;/a&gt;, no this is not limited to surrogate chars. Here is an example without surrogate chars based on the &lt;tt&gt;CodingErrorAction.IGNORE&lt;/tt&gt; variant shown above:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Charset charset = StandardCharsets.US_ASCII;
CharSequenceInputStream in = CharSequenceInputStream.builder()
    .setCharsetEncoder(charset.newEncoder().onUnmappableCharacter(CodingErrorAction.IGNORE))
    .setCharSequence(&lt;span class=&quot;code-quote&quot;&gt;&quot;\u0080&quot;&lt;/span&gt;)
    .get();
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Available: &quot;&lt;/span&gt; + in.available());
&lt;span class=&quot;code-comment&quot;&gt;// Note: readAllBytes() is a method added in Java 9
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Actually read: &quot;&lt;/span&gt; + in.readAllBytes().length);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As mentioned above the underlying issue is that &lt;tt&gt;CharSequenceInputStream.available()&lt;/tt&gt; makes potentially wrong guesses about how many bytes will be available by considering &lt;tt&gt;this.cBuf.remaining()&lt;/tt&gt;, instead of just returning the number of bytes which are guaranteed to be available (&lt;tt&gt;this.bBuf.remaining()&lt;/tt&gt; I assume).&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;So it shouldn&apos;t be hard to scan and identify &lt;span class=&quot;error&quot;&gt;&amp;#91;surrogate chars&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is in my opinion something which should not be done. Because this issue is not limited to surrogate chars in the first place, and also because the underlying &lt;tt&gt;CharsetEncoder&lt;/tt&gt; handles the encoding already; &lt;tt&gt;CharSequenceInputStream&lt;/tt&gt; should just not make any assumptions which are not guaranteed to be true.&lt;/p&gt;</comment>
                            <comment id="17795504" author="garydgregory" created="Mon, 11 Dec 2023 21:02:21 +0000"  >&lt;p&gt;If we can get a bug fix in a PR, I am happy to cut a release candidate for this.&lt;/p&gt;</comment>
                            <comment id="17799983" author="elharo" created="Sat, 23 Dec 2023 02:28:06 +0000"  >&lt;p&gt;This can be closed now&lt;/p&gt;</comment>
                            <comment id="17800524" author="marcono1234" created="Tue, 26 Dec 2023 16:57:36 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elharo&quot; class=&quot;user-hover&quot; rel=&quot;elharo&quot;&gt;elharo&lt;/a&gt;! There is one small issue with these changes; have created &lt;a href=&quot;https://github.com/apache/commons-io/pull/537&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/537&lt;/a&gt; for that.&lt;/p&gt;

&lt;p&gt;As mentioned in the description of this issue here I am wondering if it would be better to have one common implementation for &lt;tt&gt;CharSequenceInputStream&lt;/tt&gt; and &lt;tt&gt;ReaderInputStream&lt;/tt&gt; because &lt;tt&gt;CharsetEncoder&lt;/tt&gt; usage is pretty error-prone and the &lt;tt&gt;CharSequenceInputStream&lt;/tt&gt; implementation is most likely incomplete at the moment.&lt;br/&gt;
I am not sure if the approach I originally proposed in &lt;a href=&quot;https://github.com/apache/commons-io/pull/293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/293&lt;/a&gt; (and the comments there) would be a reasonable way to solve this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 45 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18gzc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>