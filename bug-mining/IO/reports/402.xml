<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:29:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-867] Fix ThresholdingOutputStream#isThresholdExceeded</title>
                <link>https://issues.apache.org/jira/browse/IO-867</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;The ThresholdingOutputStream has a beautiful boolean field called thresholdExceeded, yet the corresponding getter returns `written &amp;gt; threshold`.&lt;/p&gt;

&lt;p&gt;This means after `#thresholdReached()`, the next time `#getStream()` is called the &apos;threshold getter&apos; returns false!&lt;/p&gt;

&lt;p&gt;This causes very inconsistent behavior...&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java&lt;/p&gt;</environment>
        <key id="13606799">IO-867</key>
            <summary>Fix ThresholdingOutputStream#isThresholdExceeded</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nielsm5">Niels</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jan 2025 16:13:48 +0000</created>
                <updated>Sat, 4 Oct 2025 14:44:41 +0000</updated>
                                            <version>2.18.0</version>
                                                    <component>Streams/Writers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17922930" author="garydgregory" created="Sat, 1 Feb 2025 13:23:21 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nielsm5&quot; class=&quot;user-hover&quot; rel=&quot;nielsm5&quot;&gt;nielsm5&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;Do you have a unit test that demonstrates the issue?&lt;/p&gt;

&lt;p&gt;See &lt;tt&gt;ThresholdingOutputStreamTest&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I think there is a different issue as well: If a write fails, the threshold field is incorrectly set.&lt;/p&gt;


&lt;p&gt;Ty&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17927542" author="JIRAUSER308690" created="Sun, 16 Feb 2025 17:48:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I assume &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nielsm5&quot; class=&quot;user-hover&quot; rel=&quot;nielsm5&quot;&gt;nielsm5&lt;/a&gt; wanted to say that after the threshold is reached and the threshold consumer is called, on next write to the underlying stream, the threshold consumer will not be called again. &lt;br/&gt;
This is because the `thresholdExceeded` instance variable, once set to true in the `checkThreshold` method when reaching the threshold, remain in `true` state. Any further call for `checkThreshold(..)` method will not do anything because `thresholdExceeded` is set to true.&lt;br/&gt;
A unit test to show this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	@Test
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testThresholdConsumerNotTriggeredWhenStreamExceededThreshold() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AtomicInteger counter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicInteger(0);
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; initCount = 0;
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; threshold = 1;

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ByteArrayOutputStream os = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream(4);
				ThresholdingOutputStream out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ThresholdingOutputStream(threshold, t -&amp;gt; {
					counter.incrementAndGet();
				}, o -&amp;gt; os)) {
			out.write(&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);
			assertFalse(out.isThresholdExceeded());
			out.write(&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);
			assertTrue(out.isThresholdExceeded());
			assertFalse(counter.get() == 2);
		}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As I can understand from the code, this is an expected behavior and can be reset by calling `resetByteCount()` method if needed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	@Test
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testThresholdConsumerTriggeredThoTimesWhenStreamExceededThreshold() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AtomicInteger counter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicInteger(0);
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; initCount = 0;
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; threshold = 1;
		
		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ByteArrayOutputStream os = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream(4);
				ThresholdingOutputStream out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ThresholdingOutputStream(threshold, t -&amp;gt; {
					counter.incrementAndGet();
					t.resetByteCount();
				}, o -&amp;gt; os)) {
			out.write(&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);
			assertFalse(out.isThresholdExceeded());
			out.write(&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);
			assertFalse(out.isThresholdExceeded());
			out.write(&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);
			out.write(&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);
			assertFalse(counter.get() == 2);
		}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;Your&#160;assumption is correct, but we get to quicksand here.&lt;br/&gt;
If write fails, it does not mean that it did not write anything to the channel, it could be it was a partial success and some data still went through...&lt;/p&gt;</comment>
                            <comment id="17927568" author="garydgregory" created="Sun, 16 Feb 2025 22:01:21 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ciskyper&quot; class=&quot;user-hover&quot; rel=&quot;ciskyper&quot;&gt;ciskyper&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your research and feedback.&lt;/p&gt;

&lt;p&gt;I added the following tests in git master:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.commons.io.output.ThresholdingOutputStreamTest.testResetByteCount()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.commons.io.output.ThresholdingOutputStreamTest.testResetByteCountBrokenOutputStream()&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Does that answer your question?&lt;/p&gt;

&lt;p&gt;Feel free to add more tests for partial writes in a PR or here.&lt;/p&gt;

&lt;p&gt;TY&lt;/p&gt;</comment>
                            <comment id="18003915" author="garydgregory" created="Tue, 8 Jul 2025 22:26:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ciskyper&quot; class=&quot;user-hover&quot; rel=&quot;ciskyper&quot;&gt;ciskyper&lt;/a&gt; PING?&lt;/p&gt;</comment>
                            <comment id="18024686" author="garydgregory" created="Sat, 4 Oct 2025 14:44:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ciskyper&quot; class=&quot;user-hover&quot; rel=&quot;ciskyper&quot;&gt;ciskyper&lt;/a&gt; ping?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1txc8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>