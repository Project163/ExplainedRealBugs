<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:29:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-845] Copying symbolic links. how should FileUtils.copyDirectory. behave?</title>
                <link>https://issues.apache.org/jira/browse/IO-845</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;The current 2.15.1 release and earlier versions have bugs in the copying of symbolic link cycles using FileUtils.copyDirectory. There are also bugs in copying broken symbolic links reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-807&quot; title=&quot;FileUtils.requireExists does not take into account soft links&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-807&quot;&gt;&lt;del&gt;IO-807&lt;/del&gt;&lt;/a&gt;. These are fixed at head because symbolic links to directories are now copied as symbolic links rather than by resolving the files. However this causes problems for some non-hypothetical existing code that relied on the old behavior for copying directories containing non-cyclical symbolic links.In particular, Google has &lt;a href=&quot;https://github.com/apache/commons-io/commit/ec4144b01b4107d6b39f5f4d784cf05217ea4dfa#commitcomment-137567006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;reported failures in some of their internal projects&lt;/a&gt; when using the version at head as a result of this. However I don&apos;t think that the directories Google is copying contain cycles, so they weren&apos;t hitting the old bugs.&lt;/p&gt;

&lt;p&gt;The question is how to resolve this so that FileUtils.copyDirectory behaves reasonably with all possible directories whether cycles are present or not. Is there a consistent and reasonable way we can or should copy some links to directories as directories and others as actual directories? There are a number of cases to consider:&lt;/p&gt;

&lt;p&gt;1. No symbolic links. Just copy everything and we&apos;re good.&lt;/p&gt;

&lt;p&gt;2. Symbolic links but only to files, not directories. Copy the file or copy the link?&lt;/p&gt;

&lt;p&gt;3. Symbolic links but only to files within the root directory being copied. Right now at head we create a link to the old directory in the source. We could instead create a link to the new directory in the target.&lt;/p&gt;

&lt;p&gt;4. Symbolic links to files outside the root directory being copied. Right now at head we create a link to the old directory in the source. We should probably keep this behavior.&lt;/p&gt;

&lt;p&gt;I think the behavior we want is as follows, and then I think we handle most use cases while avoiding cycle problems:&lt;/p&gt;

&lt;p&gt;1. Start from a root directory, the source.&lt;br/&gt;
2. Never copy anything that is not contained in that directory to the target.&lt;br/&gt;
3. When walking the directory tree, if a symbolic link is encountered:&lt;br/&gt;
3.1 If the symbolic link points outside the source, create a new symbolic link to the same target.&lt;br/&gt;
3.2 If the symbolic link points to a target inside the source, create a new symbolic link to the copy of the target.&lt;/p&gt;

&lt;p&gt;However every symbolic link in the source turns into a symbolic link in the copy. Cycles do not cause problems because they are not followed. The only discrepancy I see in this approach is that a link to a directory outside the source that is a link that points back into the source still points back into the source, not the target. Thus the copy can point back into the source indirectly. Perhaps when copying links that point outside the source we can fully resolve them to and repoint as needed.&lt;/p&gt;

&lt;p&gt;I don&apos;t know that this actually fixes Google&apos;s problem. They sort of want files if not directories to be resolved when copying. Maybe that&apos;s a argument. Maybe that&apos;s a separate method like FileUtils.actualizeFiles(directory) that walks a file tree and replaces every link to a file with the contents of the target file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13566432">IO-845</key>
            <summary>Copying symbolic links. how should FileUtils.copyDirectory. behave?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="elharo">Elliotte Rusty Harold</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Jan 2024 13:18:40 +0000</created>
                <updated>Sat, 23 Mar 2024 19:37:13 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17811690" author="elharo" created="Sun, 28 Jan 2024 20:46:17 +0000"  >&lt;p&gt;My bad, I meant 2.15.1.  &lt;a href=&quot;https://search.maven.org/artifact/commons-io/commons-io/2.15.1/jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://search.maven.org/artifact/commons-io/commons-io/2.15.1/jar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The major versions between commons-lang and commons-io keep throwing me&lt;/p&gt;</comment>
                            <comment id="17811704" author="elharo" created="Mon, 29 Jan 2024 01:01:04 +0000"  >&lt;p&gt;One way to describe this is that once symlinks are added, the source directory we&apos;re copying is a graph rather than a tree. The copied graph should be the same as the source graph.&lt;/p&gt;</comment>
                            <comment id="17813679" author="elharo" created="Fri, 2 Feb 2024 13:54:51 +0000"  >&lt;p&gt;There are three reasonable cases I can see here:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Don&apos;t repoint links. All copied links point to the original files.&lt;/li&gt;
	&lt;li&gt;Repoint links that target files inside the copied directory. Maintain links that point outside the copied directory.&lt;/li&gt;
	&lt;li&gt;Actualize files. No links to files are copied. Instead links are replaced by the contents of the files they point to.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I think #2 is the least surprising behavior. Possibly we could add an argument that chooses between these behaviors. Another option would be to additional methods independent of the copy that replace a link with its contents, or that walks a directory and replaces all links with its contents. I&apos;d be skeptical of the need for this if we didn&apos;t know that Google was already using this.&lt;/p&gt;</comment>
                            <comment id="17813945" author="garydgregory" created="Sat, 3 Feb 2024 13:51:08 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elharo&quot; class=&quot;user-hover&quot; rel=&quot;elharo&quot;&gt;elharo&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;WRT &quot;I don&apos;t know that this actually fixes Google&apos;s problem.&quot;: Would you state here the relationship with PR &lt;a href=&quot;https://github.com/apache/commons-io/pull/572/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/572/&lt;/a&gt; so we can set expectations and document what we think the outcome might be for them?&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;</comment>
                            <comment id="17814081" author="elharo" created="Sun, 4 Feb 2024 13:25:25 +0000"  >&lt;p&gt;It would be helpful if @eamonnmcmanus could chime in on this. I&apos;m no longer inside the plex, and can&apos;t test what they&apos;re actually doing. Ultimately this depends on whether the linked resource files copybara is copying during tests are inside the directory being copied or outside of it. I don&apos;t know. If they&apos;re inside it, then this will fix their issue. If they&apos;re outside of it they won&apos;t.&lt;/p&gt;

&lt;p&gt;That said, Google has been relying on undocumented, unintended, and frankly surprising behavior of the old version of this method. Until &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-807&quot; title=&quot;FileUtils.requireExists does not take into account soft links&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-807&quot;&gt;&lt;del&gt;IO-807&lt;/del&gt;&lt;/a&gt; I don&apos;t think anyone had much thought about or tested how the copyDirectory methods handled symbolic links. Now that I have thought about it, I can&apos;t see the previous behavior as sensible. Copying 10 links to the same 1 MB file should not make 10 MB worth of new files, which is what we were doing. And it&apos;s also true that the old behavior had some obvious cycle bugs that are now fixed by copying links as links.&lt;/p&gt;

&lt;p&gt;We could add a flag to this method somehow that does revert to the old behavior. However it strikes me that actualizing links (i.e. replacing a link with the bytes it links to) should be a separate operation from copying a directory. It might be worth adding a FileUtils.actualize() method that does this. It makes me a little nervous because it&apos;s not an atomic operation and could fail halfway through, leaving things in an inconsistent state, but that&apos;s true of most I/O methods.&lt;/p&gt;

</comment>
                            <comment id="17830158" author="garydgregory" created="Sat, 23 Mar 2024 19:37:13 +0000"  >&lt;p&gt;Another interesting use case is dealing with drives/volumes/mounts.&lt;/p&gt;

&lt;p&gt;For example, if I copy C:\test1 to D:\test2 (USB or network) and take (disconnect) Drive D to another machine, I expect all the bytes to be there, symlinks or not. If the source has a symlink outside of itself, I&apos;d still expect the bytes to come with me. Is that case handled in all of the above and the PR?&lt;/p&gt;

&lt;p&gt;Do we need a new copyDirectoryGraph() API that always copies links as links?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1n1rk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>