<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:29:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-856] FileUtils.listFiles(final File, String[], boolean) can throw NoSuchFileException</title>
                <link>https://issues.apache.org/jira/browse/IO-856</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;ListFiles crashes when vanishing files are involved while listing, ListFiles should simply list, the application should care of if files are not existent any more:&lt;br/&gt;
&amp;lt;pre&amp;gt;&lt;/p&gt;

&lt;p&gt;java.io.UncheckedIOException: java.nio.file.NoSuchFileException: /tmp/20b50a15-b84e-4a9a-953e-223452dac994/a914fa55-50f7-4de0-8ca6-1fd84f10b29a.png&lt;br/&gt;
&#160; &#160; at java.base/java.nio.file.FileTreeIterator.fetchNextIfNeeded(FileTreeIterator.java:87)&lt;br/&gt;
&#160; &#160; at java.base/java.nio.file.FileTreeIterator.hasNext(FileTreeIterator.java:103)&lt;br/&gt;
&#160; &#160; at java.base/java.util.Iterator.forEachRemaining(Iterator.java:132)&lt;br/&gt;
&#160; &#160; at java.base/java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1845)&lt;br/&gt;
&#160; &#160; at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)&lt;br/&gt;
&#160; &#160; at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)&lt;br/&gt;
&#160; &#160; at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)&lt;br/&gt;
&#160; &#160; at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)&lt;br/&gt;
&#160; &#160; at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)&lt;br/&gt;
&#160; &#160; at org.apache.commons.io@2.16.1/org.apache.commons.io.FileUtils.toList(FileUtils.java:3025)&lt;br/&gt;
&#160; &#160; at org.apache.commons.io@2.16.1/org.apache.commons.io.FileUtils.listFiles(FileUtils.java:2314)&lt;br/&gt;
&#160; &#160; at com.itth.test/test.ApacheBug.lambda$main$1(ApacheBug.java:39)&lt;br/&gt;
&#160; &#160; at java.base/java.lang.Thread.run(Thread.java:842)&lt;br/&gt;
Caused by: java.nio.file.NoSuchFileException: /tmp/20b50a15-b84e-4a9a-953e-223452dac994/a914fa55-50f7-4de0-8ca6-1fd84f10b29a.png&lt;br/&gt;
&#160; &#160; at java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)&lt;br/&gt;
&#160; &#160; at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:106)&lt;br/&gt;
&#160; &#160; at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)&lt;br/&gt;
&#160; &#160; at java.base/sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)&lt;br/&gt;
&#160; &#160; at java.base/sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:148)&lt;br/&gt;
&#160; &#160; at java.base/sun.nio.fs.LinuxFileSystemProvider.readAttributes(LinuxFileSystemProvider.java:99)&lt;br/&gt;
&#160; &#160; at java.base/java.nio.file.Files.readAttributes(Files.java:1851)&lt;br/&gt;
&#160; &#160; at java.base/java.nio.file.FileTreeWalker.getAttributes(FileTreeWalker.java:226)&lt;br/&gt;
&#160; &#160; at java.base/java.nio.file.FileTreeWalker.visit(FileTreeWalker.java:277)&lt;br/&gt;
&#160; &#160; at java.base/java.nio.file.FileTreeWalker.next(FileTreeWalker.java:374)&lt;br/&gt;
&#160; &#160; at java.base/java.nio.file.FileTreeIterator.fetchNextIfNeeded(FileTreeIterator.java:83)&lt;br/&gt;
&#160; &#160; ... 12 more&lt;/p&gt;

&lt;p&gt;&amp;lt;/pre&amp;gt;&lt;/p&gt;

&lt;p&gt;Use this to reproduce:&lt;/p&gt;

&lt;p&gt;&amp;lt;pre&amp;gt;&lt;br/&gt;
package test;&lt;/p&gt;

&lt;p&gt;import org.apache.commons.io.FileUtils;&lt;/p&gt;

&lt;p&gt;import java.io.BufferedOutputStream;&lt;br/&gt;
import java.io.File;&lt;br/&gt;
import java.io.FileOutputStream;&lt;br/&gt;
import java.io.IOException;&lt;br/&gt;
import java.nio.charset.StandardCharsets;&lt;br/&gt;
import java.nio.file.Path;&lt;br/&gt;
import java.util.Collection;&lt;br/&gt;
import java.util.UUID;&lt;/p&gt;

&lt;p&gt;public class ApacheBug {&lt;br/&gt;
public static void main(String[] args) {&lt;br/&gt;
// create random directory in tmp, create the directory if it does not exist&lt;br/&gt;
final File dir = FileUtils.getTempDirectory();&lt;br/&gt;
if (!dir.exists()) {&lt;br/&gt;
if (!dir.mkdirs()) &lt;/p&gt;
{
throw new RuntimeException(&quot;could not create image file path: &quot; + dir.getAbsolutePath());
}
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;// create random file in the directory&lt;br/&gt;
new Thread(() -&amp;gt; {&lt;br/&gt;
try {&lt;br/&gt;
while (true) &lt;/p&gt;
{
final File file = Path.of(dir.getAbsolutePath(), UUID.randomUUID().toString() + &quot;.png&quot;).toFile();
new BufferedOutputStream(new FileOutputStream(file)).write(&quot;TEST&quot;.getBytes(StandardCharsets.UTF_8));
file.delete();
}
&lt;p&gt;} catch (IOException e) &lt;/p&gt;
{
e.printStackTrace();
}&lt;br/&gt;
}).start();&lt;br/&gt;
new Thread(() -&amp;gt; {&lt;br/&gt;
try {&lt;br/&gt;
while (true) {
final Collection&amp;lt;File&amp;gt; files = FileUtils.listFiles(dir, new String[]\{&quot;png&quot;}, true);&lt;br/&gt;
System.out.println(files.size());&lt;br/&gt;
}&lt;br/&gt;
} catch (Exception e) {
e.printStackTrace();
}
&lt;p&gt;}).start();&lt;/p&gt;

&lt;p&gt;try &lt;/p&gt;
{
Thread.sleep(10000);
}
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
Thread.currentThread().interrupt();
}
&lt;p&gt;}&lt;br/&gt;
}&lt;br/&gt;
&amp;lt;/pe&amp;gt;&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13581788">IO-856</key>
            <summary>FileUtils.listFiles(final File, String[], boolean) can throw NoSuchFileException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="thomas.hartwig@gmail.com">Thomas Hartwig</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Jun 2024 12:30:30 +0000</created>
                <updated>Wed, 13 Nov 2024 13:56:24 +0000</updated>
                            <resolved>Sun, 10 Nov 2024 18:55:58 +0000</resolved>
                                    <version>2.16.1</version>
                                    <fixVersion>2.18.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17852930" author="garydgregory" created="Thu, 6 Jun 2024 19:55:29 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.hartwig%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;thomas.hartwig@gmail.com&quot;&gt;thomas.hartwig@gmail.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;Please specify:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;What OS? Some UNIX variant it seems.&lt;/li&gt;
	&lt;li&gt;What Java version?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17852938" author="thomas.hartwig@gmail.com" created="Thu, 6 Jun 2024 20:19:19 +0000"  >&lt;p&gt;Distributor ID: Ubuntu &lt;br/&gt;
Description: &#160;&#160;&#160;Ubuntu 22.04.4 LTS &lt;br/&gt;
Release: &#160;&#160;&#160;&#160;&#160;&#160;&#160;22.04 &lt;br/&gt;
Codename: &#160;&#160;&#160;&#160;&#160;&#160;jammy&lt;/p&gt;


&lt;p&gt;java.vm.vendor: Oracle Corporation&lt;br/&gt;
sun.arch.data.model: 64&lt;br/&gt;
java.vendor.url: &lt;a href=&quot;https://java.oracle.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://java.oracle.com/&lt;/a&gt;&lt;br/&gt;
user.timezone: Europe/Berlin&lt;br/&gt;
java.vm.specification.version: 17&lt;br/&gt;
os.name: Linux&lt;br/&gt;
sun.java.launcher: SUN_STANDARD&lt;br/&gt;
user.country: US&lt;br/&gt;
sun.boot.library.path: /opt/graalvm-jdk-17.0.10+11.1/lib&lt;br/&gt;
jdk.debug: release&lt;br/&gt;
sun.cpu.endian: little&lt;br/&gt;
user.home: /home/th&lt;br/&gt;
user.language: en&lt;br/&gt;
java.specification.vendor: Oracle Corporation&lt;br/&gt;
java.vm.specification.vendor: Oracle Corporation&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
jdk.module.main.class: test.ApacheBug&lt;br/&gt;
jdk.module.main: com.itth.test&lt;br/&gt;
sun.management.compiler: HotSpot 64-Bit Tiered Compilers&lt;br/&gt;
java.runtime.version: 17.0.10+11-LTS-jvmci-23.0-b27&lt;br/&gt;
user.name: th&lt;br/&gt;
path.separator: :&lt;br/&gt;
os.version: 5.15.0-107-lowlatency&lt;br/&gt;
java.runtime.name: Java(TM) SE Runtime Environment&lt;br/&gt;
file.encoding: UTF-8&lt;br/&gt;
java.vm.name: Java HotSpot(TM) 64-Bit Server VM&lt;br/&gt;
java.vendor.version: Oracle GraalVM 17.0.10+11.1&lt;br/&gt;
java.vendor.url.bug: &lt;a href=&quot;https://bugreport.java.com/bugreport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugreport.java.com/bugreport/&lt;/a&gt;&lt;br/&gt;
java.io.tmpdir: /tmp&lt;br/&gt;
java.version: 17.0.10&lt;br/&gt;
user.dir: /home/th/dev/ai/idea-projects/uvis&lt;br/&gt;
os.arch: amd64&lt;br/&gt;
java.vm.specification.name: Java Virtual Machine Specification&lt;br/&gt;
native.encoding: UTF-8&lt;br/&gt;
java.library.path: /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib&lt;br/&gt;
java.vm.info: mixed mode, sharing&lt;br/&gt;
java.vendor: Oracle Corporation&lt;br/&gt;
java.vm.version: 17.0.10+11-LTS-jvmci-23.0-b27&lt;br/&gt;
sun.io.unicode.encoding: UnicodeLittle&lt;br/&gt;
java.class.version: 61.0&lt;/p&gt;</comment>
                            <comment id="17852969" author="garydgregory" created="Thu, 6 Jun 2024 23:59:21 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.hartwig%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;thomas.hartwig@gmail.com&quot;&gt;thomas.hartwig@gmail.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your update.&lt;/p&gt;

&lt;p&gt;I added a unit test to reproduce this kind of issue: A file deletion between creating the stream and collecting it. It passes on Windows, Ubuntu, and macOS, using Java 11, 17, and 21 (see &lt;a href=&quot;https://github.com/apache/commons-io/actions&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/actions&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;The new test is here: &lt;a href=&quot;https://github.com/apache/commons-io/blob/97c4803e1c8f100756d24eff4fdfd631a08534dc/src/test/java/org/apache/commons/io/FileUtilsListFilesTest.java#L209-L223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/blob/97c4803e1c8f100756d24eff4fdfd631a08534dc/src/test/java/org/apache/commons/io/FileUtilsListFilesTest.java#L209-L223&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The best path forward would be for you to create a PR with a failing unit test we can debug.&lt;/p&gt;

&lt;p&gt;You could try updating to the current version of Java 17 and see if that helps.&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;</comment>
                            <comment id="17855906" author="garydgregory" created="Tue, 18 Jun 2024 12:04:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.hartwig%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;thomas.hartwig@gmail.com&quot;&gt;thomas.hartwig@gmail.com&lt;/a&gt;&lt;br/&gt;
Ping?&lt;/p&gt;</comment>
                            <comment id="17855935" author="thomas.hartwig@gmail.com" created="Tue, 18 Jun 2024 13:16:00 +0000"  >&lt;p&gt;Hi Gary,&lt;br/&gt;
the test you provided has obvious errors and is failing already at first assertion. I do not understand what the problem is to copy my code into it.&lt;br/&gt;
I tested all the latest JDK for 17 and 19. Nothing works.&lt;/p&gt;



&lt;p&gt;BR&lt;/p&gt;</comment>
                            <comment id="17855970" author="garydgregory" created="Tue, 18 Jun 2024 15:12:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.hartwig%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;thomas.hartwig@gmail.com&quot;&gt;thomas.hartwig@gmail.com&lt;/a&gt;&lt;br/&gt;
The build passes for all Java LTS versions on GitHub CI: &lt;a href=&quot;https://github.com/apache/commons-io/actions&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/actions&lt;/a&gt;&lt;br/&gt;
So where is the test failing &quot;at first assertion&quot;?&lt;/p&gt;

&lt;p&gt;The best path forward is to provide a PR on GitHub with a JUnit test that shows the failure.&lt;/p&gt;

&lt;p&gt;&quot;I do not understand what the problem is to copy my code into it.&quot;&lt;/p&gt;

&lt;p&gt;The code you provided is not a unit test, it&apos;s a standalone program that makes no assertions; it also seems to be nondeterministic.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17897006" author="garydgregory" created="Sun, 10 Nov 2024 12:39:39 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.hartwig%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;thomas.hartwig@gmail.com&quot;&gt;thomas.hartwig@gmail.com&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;I added a slightly modified version of this test in `FileUtilsListFilesTest.testListFilesWithDeletionThreaded()`&lt;/li&gt;
	&lt;li&gt;This test is only enabled on Windows&lt;/li&gt;
	&lt;li&gt;There are hidden failures on GitHub CI on Ubuntu and macOS&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17897038" author="garydgregory" created="Sun, 10 Nov 2024 18:55:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.hartwig%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;thomas.hartwig@gmail.com&quot;&gt;thomas.hartwig@gmail.com&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please test git master or a snapshot build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13598551">IO-863</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1pni0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>