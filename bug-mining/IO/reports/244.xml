<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:27:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-692] PathUtils delete throws an exception when deleting a symlink that points to a file that does not exist</title>
                <link>https://issues.apache.org/jira/browse/IO-692</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;&lt;b&gt;PathUtils.delete&lt;/b&gt; throws an Exception when deleting a symlink to a file that doesn&apos;t exist, in our case this was when the files were deleted out of sequence.&lt;/p&gt;

&lt;p&gt;Minimal reproducing code running as a unit test (scala). This creates a symlink to a fail that does not exist at all.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val file = Files.createSymbolicLink(
  Paths.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;x.txt&quot;&lt;/span&gt;),
  Paths.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;,  &lt;span class=&quot;code-quote&quot;&gt;&quot;y.txt&quot;&lt;/span&gt;).toAbsolutePath,
)
PathUtils.delete(file)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This throws the following exception&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[error]    java.nio.file.NoSuchFileException: target/x.txt (UnixException.java:86)
[error] sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)
[error] sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
[error] sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
[error] sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)
[error] sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:144)
[error] org.apache.commons.io.file.PathUtils.deleteFile(PathUtils.java:361)
[error] org.apache.commons.io.file.PathUtils.delete(PathUtils.java:304)
[error] org.apache.commons.io.file.PathUtils.delete(PathUtils.java:280)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The offending code is this in&#160;&lt;b&gt;PathUtils&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; PathCounters deleteFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path file, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DeleteOption... options) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-comment&quot;&gt;// Files.deleteIfExists() never follows links, so use LinkOption.NOFOLLOW_LINKS in other calls to Files.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Files.isDirectory(file, LinkOption.NOFOLLOW_LINKS)) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NoSuchFileException(file.toString());
    }
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PathCounters pathCounts = Counters.longPathCounters();
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; exists = Files.exists(file, LinkOption.NOFOLLOW_LINKS);
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; size = exists ? Files.size(file) : 0;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (overrideReadOnly(options) &amp;amp;&amp;amp; exists) {
        setReadOnly(file, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, LinkOption.NOFOLLOW_LINKS);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Files.deleteIfExists(file)) {
        pathCounts.getFileCounter().increment();
        pathCounts.getByteCounter().add(size);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pathCounts;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This manifests because&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Files.exists(file, LinkOption.NOFOLLOW_LINKS); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; always returns &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the symlink exists
&lt;/span&gt;
Files.size(file) &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; an exception because there is no file to check the size of&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A guess at the solution would be to only check the size if the file exists and is not a symlink&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; size = exists &amp;amp;&amp;amp; !Files.isSymbolicLink() ? Files.size(file) : 0;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This was discovered when using &lt;b&gt;FileUtils.deleteDirectory&lt;/b&gt;&#160;where we have a structure like the following. We clean up these directories when the process finishes, since upgrading to 2.8.0 this fails if the parent directory is deleted before the child.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 work_dir/
   parent_dir/
     big_file.txt
   child_dir/
     symlink_to_big_file.txt&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As a work around using&#160;&lt;b&gt;PathUtils.deleteDirectory&lt;/b&gt; seems to work regardless of the deletion order&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java version &quot;1.8.0_202&quot; Java(TM) SE Runtime Environment (build 1.8.0_202-b08) Java HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</environment>
        <key id="13339863">IO-692</key>
            <summary>PathUtils delete throws an exception when deleting a symlink that points to a file that does not exist</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="matthew_rooney_trimble">Matthew Rooney</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Nov 2020 00:15:53 +0000</created>
                <updated>Sun, 6 Dec 2020 23:26:55 +0000</updated>
                            <resolved>Sun, 6 Dec 2020 23:26:55 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17244872" author="ebourg" created="Sun, 6 Dec 2020 23:26:55 +0000"  >&lt;p&gt;Thank you for the report, the suggested fix has been applied.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0kgkg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>