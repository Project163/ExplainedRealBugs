<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:27:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IO-689] All new FileUtils methods do a useless Instant-&gt;ZonedDateTime-&gt;Instant roundtrip</title>
                <link>https://issues.apache.org/jira/browse/IO-689</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;This commit in PR #124 breaks FileUtils with new Java 8 datetime APIs:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-io/pull/124/commits/2eb549873470844c88681e92c64631f796002020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-io/pull/124/commits/2eb549873470844c88681e92c64631f796002020&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Because of this I had to put all of the methods to the list of blacklisted APIs in Apache Lucene / Solr. The reason for this change is that now all depend on local datetime, there&apos;s no way to pass an Instant with a UNIX timestamp through the API without it being corrupted due to forwards/backwards transformation.&lt;/p&gt;

&lt;p&gt;Background: During DST changes the same local date time exists two times (in autumn, you have in most countries two time the 2:30am time, once before and once after the DST change - because time is rolled back).&lt;/p&gt;

&lt;p&gt;With the above commit you first convert an Instant (which is by definition just a UNIX timestamp and can be converted as-is to a long) to a local Datetime and then back to an Instant. By this forward/backward transformation you get off by an hour during that one hour in autumn, when DST switches back to standard time.&lt;/p&gt;

&lt;p&gt;Please revert this commit and release a bugfix.&lt;/p&gt;

&lt;p&gt;There is no reason to convert an Instant to local and back, the arguments in the PR are plain wrong. Instants are timezoneless and are identical to UNIX timestamps.&lt;/p&gt;

&lt;p&gt;This commit breaks all new methods, because at the end all new methods go through the &quot;Instant&quot; path which does the faulty transformation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13328944">IO-689</key>
            <summary>All new FileUtils methods do a useless Instant-&gt;ZonedDateTime-&gt;Instant roundtrip</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="uschindler">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Sep 2020 08:31:32 +0000</created>
                <updated>Sat, 26 Sep 2020 22:06:32 +0000</updated>
                            <resolved>Sat, 26 Sep 2020 22:06:32 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.9.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17200656" author="thetaphi" created="Wed, 23 Sep 2020 08:33:08 +0000"  >&lt;p&gt;See blacklist of &quot;broken methods&quot; for Common-IO 2.8: &lt;a href=&quot;https://github.com/policeman-tools/forbidden-apis/commit/be6638037e2acf8ecb7e585e5f98d1286fdf7bbf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/policeman-tools/forbidden-apis/commit/be6638037e2acf8ecb7e585e5f98d1286fdf7bbf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17200657" author="thetaphi" created="Wed, 23 Sep 2020 08:33:59 +0000"  >&lt;p&gt;Actually there&apos;s no test that checks the effects of this commit to be reverted.&lt;/p&gt;</comment>
                            <comment id="17200693" author="alexherbert" created="Wed, 23 Sep 2020 09:44:20 +0000"  >&lt;p&gt;This concerns for example the following method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isFileNewer(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File file, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Instant instant) {
        Objects.requireNonNull(instant, &lt;span class=&quot;code-quote&quot;&gt;&quot;instant&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; isFileNewer(file, instant.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Reading the javadoc &lt;tt&gt;Instant.atZone&lt;/tt&gt; is equivalent to &lt;tt&gt;ZonedDateTime.ofInstant(this, zone)&lt;/tt&gt;. The javadoc for that states that:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Calling toInstant() will return an instant equal to the one used here.

Converting an instant to a zoned date-time is simple as there is only one valid offset for each instant.&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thus the following is documented to be a round trip to an equivalent Instant:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
instant.atZone(ZoneId.systemDefault()).toInstant()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So IIUC the conversion to/from should have no effect.&lt;/p&gt;

&lt;p&gt;I have tried to create a DateTimeZone on the time change for British Summer Time and the instant from this can be offset by 1 hour and still passes a round trip:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIO689() {
    &lt;span class=&quot;code-comment&quot;&gt;// Daylight saving time in United Kingdom ends 02:00 on Sunday, 25 October, 2020
&lt;/span&gt;    ZoneId bstZone = ZoneId.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;Europe/London&quot;&lt;/span&gt;);
    ZonedDateTime date = ZonedDateTime.of(2020, 10, 25, 2, 0, 0, 0, bstZone);
    Instant instant = date.toInstant();
    Instant instant2 = instant.plus(1, ChronoUnit.HOURS);
    Instant instant3 = instant.minus(1, ChronoUnit.HOURS);
    Assertions.assertEquals(instant, instant.atZone(bstZone).toInstant());
    Assertions.assertEquals(instant2, instant2.atZone(bstZone).toInstant());
    Assertions.assertEquals(instant3, instant3.atZone(bstZone).toInstant());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is there an example where the round trip does not provide an equal Instant?&lt;/p&gt;</comment>
                            <comment id="17200727" author="thetaphi" created="Wed, 23 Sep 2020 10:42:21 +0000"  >&lt;p&gt;The general problem here: An instant is just Epoch seconds (look at source code, there are no timezones involved!), so why do you convert it to a zoned time at all (and back)? There is no reason to do this, you don&apos;t even have a test that shows that this is really needed. This is overhead, because it needs to access a synchronized global JVM setting (default zone), it also produces many useless objects and does calculations that don&apos;t change anything - which you verified in your test.&lt;/p&gt;

&lt;p&gt;The roundtrip works in your example, because &quot;atZone&quot; includes the timezone into the returned object. I was missing that, sorry! If you would convert it to a LocalDateTime, then you have a problem - ZonedDatetime is OK!&lt;/p&gt;

&lt;p&gt;With your Test you have already shown, that the Instant does not change, so please remove the useless conversion! That&apos;s all I want to say, the risk to change the epoch seconds is too high for nonsense. The method that&apos;s called at the very end is just &lt;tt&gt;isFileNewer(File,long)&lt;/tt&gt; and that takes a epoch milli (that has no timezone). &lt;tt&gt;Instant&lt;/tt&gt; is just a wrapper around that.&lt;/p&gt;</comment>
                            <comment id="17200760" author="thetaphi" created="Wed, 23 Sep 2020 11:33:47 +0000"  >&lt;p&gt;On our side, I removed the Instant and ZonedDateTime signatures from forbiddenApis, so they can be used in code (as the bug is not a problem for consumers). Of course the ones depending on local time zone should still not used in libraries like Lucene/Solr.&lt;/p&gt;

&lt;p&gt;Still, the obsolete roundtrip should really be removed in a later version.&lt;/p&gt;</comment>
                            <comment id="17200780" author="alexherbert" created="Wed, 23 Sep 2020 11:59:38 +0000"  >&lt;p&gt;So for clarity all the methods that eventually require use of &lt;tt&gt;ZoneId.systemDefault()&lt;/tt&gt; have been flagged by forbidden APIs:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.commons.io.FileUtils#isFileNewer(java.io.File,java.time.chrono.ChronoLocalDate)
org.apache.commons.io.FileUtils#isFileNewer(java.io.File,java.time.chrono.ChronoLocalDate,java.time.LocalTime)
org.apache.commons.io.FileUtils#isFileNewer(java.io.File,java.time.chrono.ChronoLocalDateTime)
org.apache.commons.io.FileUtils#isFileOlder(java.io.File,java.time.chrono.ChronoLocalDate)
org.apache.commons.io.FileUtils#isFileOlder(java.io.File,java.time.chrono.ChronoLocalDate,java.time.LocalTime)
org.apache.commons.io.FileUtils#isFileOlder(java.io.File,java.time.chrono.ChronoLocalDateTime)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So is the resolution:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Add a note to the Javadoc for these methods that the input date will be assumed to use the default ZoneId&lt;/li&gt;
	&lt;li&gt;Remove the round trip from Instant to ZonedDateTime back to Instant&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="17200794" author="thetaphi" created="Wed, 23 Sep 2020 12:35:32 +0000"  >&lt;p&gt;Yes, exactly that! Thanks.&lt;/p&gt;</comment>
                            <comment id="17200805" author="thetaphi" created="Wed, 23 Sep 2020 12:48:26 +0000"  >&lt;p&gt;In general, it would be important that all methods in commons-io that rely on default charsets, default locale or default timezone to have some Javadocs line mentioning this. A good trick would be to use a separate javadocs tag.&lt;/p&gt;</comment>
                            <comment id="17200819" author="alexherbert" created="Wed, 23 Sep 2020 13:20:00 +0000"  >&lt;p&gt;Updated javadocs in commit &lt;a href=&quot;https://github.com/apache/commons-io/commit/8f4ccfc0819152b18490960b698ab3fc2573d824/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8f4ccfc0819152b18490960b698ab3fc2573d824&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Removed round-trip in commit &lt;a href=&quot;https://github.com/apache/commons-io/commit/e1a5fdde3937f47a8f78d14dff4f2c91337c2ad0/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;e1a5fdde3937f47a8f78d14dff4f2c91337c2ad0&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17200845" author="thetaphi" created="Wed, 23 Sep 2020 14:07:32 +0000"  >&lt;p&gt;Thanks, looks fine to me. Forbiddenapis was updated and contains only the signatures as listed before. The new version was released already and was applied to Lucene/Solr. We have not yet upgraded commons-io, but soon this will happen.&lt;/p&gt;</comment>
                            <comment id="17202355" author="garydgregory" created="Fri, 25 Sep 2020 18:33:48 +0000"  >&lt;p&gt;May we mark this as resolved for 2.9.0?&lt;/p&gt;</comment>
                            <comment id="17202445" author="alexherbert" created="Fri, 25 Sep 2020 22:31:57 +0000"  >&lt;p&gt;OK with me.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0iu74:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>