{"url":"https://api.github.com/repos/python/mypy/issues/13965","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/13965/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/13965/comments","events_url":"https://api.github.com/repos/python/mypy/issues/13965/events","html_url":"https://github.com/python/mypy/issues/13965","id":1429012420,"node_id":"I_kwDOAGuhRc5VLP_E","number":13965,"title":"Make `--no-implicit-reexport` friendlier","user":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488358,"node_id":"MDU6TGFiZWwyMTQ4ODM1OA==","url":"https://api.github.com/repos/python/mypy/labels/feature","name":"feature","color":"84b6eb","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-10-30T20:45:41Z","updated_at":"2023-09-19T03:50:34Z","closed_at":"2023-09-19T03:50:34Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Currently, users have to pay double jeopardy if they rely on an implicit reexport. First, they get an error \"module does not explicitly export attribute [attr-defined]\", but then the type of the thing also becomes Any.\r\n\r\nI think it would be friendlier to have mypy just use the type of the hidden thing. This is useful in cases where you can't change the module you're importing from. In some cases, you can have a per-module implicit_reexport config (although I'd argue most users would struggle to find that solution), but in some \"consenting adults\" situations this isn't quite what you want.\r\n\r\nHere's what the patch could look like for the semanal portion of this (edit: merged!). We'd also need to modify attribute access logic.\r\n\r\n<details>\r\n\r\n```\r\ndiff --git a/mypy/semanal.py b/mypy/semanal.py\r\nindex b37c9b2a5..06d648a16 100644\r\n--- a/mypy/semanal.py\r\n+++ b/mypy/semanal.py\r\n@@ -2242,10 +2242,20 @@ class SemanticAnalyzer(\r\n                     )\r\n                     continue\r\n \r\n-            if node and not node.module_hidden:\r\n+            if node:\r\n                 self.process_imported_symbol(\r\n                     node, module_id, id, imported_id, fullname, module_public, context=imp\r\n                 )\r\n+                if node.module_hidden:\r\n+                    self.report_missing_module_attribute(\r\n+                        module_id,\r\n+                        id,\r\n+                        imported_id,\r\n+                        module_public=module_public,\r\n+                        module_hidden=not module_public,\r\n+                        context=imp,\r\n+                        add_unknown_imported_symbol=False,\r\n+                    )\r\n             elif module and not missing_submodule:\r\n                 # Target module exists but the imported name is missing or hidden.\r\n                 self.report_missing_module_attribute(\r\n@@ -2333,6 +2343,7 @@ class SemanticAnalyzer(\r\n         module_public: bool,\r\n         module_hidden: bool,\r\n         context: Node,\r\n+        add_unknown_imported_symbol: bool = True,\r\n     ) -> None:\r\n         # Missing attribute.\r\n         if self.is_incomplete_namespace(import_id):\r\n@@ -2357,13 +2368,14 @@ class SemanticAnalyzer(\r\n                     suggestion = f\"; maybe {pretty_seq(matches, 'or')}?\"\r\n                     message += f\"{suggestion}\"\r\n         self.fail(message, context, code=codes.ATTR_DEFINED)\r\n-        self.add_unknown_imported_symbol(\r\n-            imported_id,\r\n-            context,\r\n-            target_name=None,\r\n-            module_public=module_public,\r\n-            module_hidden=not module_public,\r\n-        )\r\n+        if add_unknown_imported_symbol:\r\n+            self.add_unknown_imported_symbol(\r\n+                imported_id,\r\n+                context,\r\n+                target_name=None,\r\n+                module_public=module_public,\r\n+                module_hidden=not module_public,\r\n+            )\r\n \r\n         if import_id == \"typing\":\r\n             # The user probably has a missing definition in a test fixture. Let's verify.\r\ndiff --git a/test-data/unit/check-flags.test b/test-data/unit/check-flags.test\r\nindex 5a075dd6e..9beffd2f9 100644\r\n--- a/test-data/unit/check-flags.test\r\n+++ b/test-data/unit/check-flags.test\r\n@@ -1606,14 +1606,18 @@ strict_equality = false\r\n \r\n \r\n [case testNoImplicitReexport]\r\n-# flags: --no-implicit-reexport\r\n-from other_module_2 import a\r\n+# flags: --no-implicit-reexport --show-error-codes\r\n+from other_module_2 import a  # E: Module \"other_module_2\" does not explicitly export attribute \"a\"  [attr-defined]\r\n+reveal_type(a)  # N: Revealed type is \"builtins.int\"\r\n+\r\n+import other_module_2\r\n+reveal_type(other_module_2.a)  # E: \"object\" does not explicitly export attribute \"a\"  [attr-defined] \\\r\n+                               # N: Revealed type is \"builtins.int\"\r\n+\r\n [file other_module_1.py]\r\n a = 5\r\n [file other_module_2.py]\r\n from other_module_1 import a\r\n-[out]\r\n-main:2: error: Module \"other_module_2\" does not explicitly export attribute \"a\"\r\n \r\n [case testNoImplicitReexportRespectsAll]\r\n # flags: --no-implicit-reexport\r\n```\r\n\r\n</details>","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/13965/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/13965/timeline","performed_via_github_app":null,"state_reason":"completed"}