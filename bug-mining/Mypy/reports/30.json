{"url":"https://api.github.com/repos/python/mypy/issues/11079","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/11079/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/11079/comments","events_url":"https://api.github.com/repos/python/mypy/issues/11079/events","html_url":"https://github.com/python/mypy/issues/11079","id":991869870,"node_id":"MDU6SXNzdWU5OTE4Njk4NzA=","number":11079,"title":"Internal error when providing a `def` with type hints in a `TypedDict` class","user":{"login":"sami-evangelista","id":3997162,"node_id":"MDQ6VXNlcjM5OTcxNjI=","avatar_url":"https://avatars.githubusercontent.com/u/3997162?v=4","gravatar_id":"","url":"https://api.github.com/users/sami-evangelista","html_url":"https://github.com/sami-evangelista","followers_url":"https://api.github.com/users/sami-evangelista/followers","following_url":"https://api.github.com/users/sami-evangelista/following{/other_user}","gists_url":"https://api.github.com/users/sami-evangelista/gists{/gist_id}","starred_url":"https://api.github.com/users/sami-evangelista/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sami-evangelista/subscriptions","organizations_url":"https://api.github.com/users/sami-evangelista/orgs","repos_url":"https://api.github.com/users/sami-evangelista/repos","events_url":"https://api.github.com/users/sami-evangelista/events{/privacy}","received_events_url":"https://api.github.com/users/sami-evangelista/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-09-09T06:54:44Z","updated_at":"2021-09-17T19:57:18Z","closed_at":"2021-09-17T19:57:18Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Input file:\r\n```python\r\nfrom typing import Any, TypedDict\r\ndict_t = TypedDict('dict_t', {\r\n    'i': int,\r\n    's': str,\r\n    'b': bool\r\n}, total=False)\r\nclass D(dict_t):\r\n    def __setitem__(self, key: str, val: Any) -> None:\r\n        pass\r\n```\r\nInternal error:\r\n```\r\n$ mypy --show-traceback d.py\r\n\r\nd.py:8: error: Invalid statement in TypedDict definition; expected \"field_name: field_type\"\r\nd.py: error: INTERNAL ERROR -- Please try using mypy master on Github:\r\nhttps://mypy.readthedocs.io/en/stable/common_issues.html#using-a-development-mypy-build\r\nPlease report a bug at https://github.com/python/mypy/issues\r\nversion: 0.920+dev.bbea3b56297d3d966b9a98900c218df6616fec85\r\nd.py: : note: use --pdb to drop into pdb\r\nd.py:8: error: Invalid statement in TypedDict definition; expected \"field_name: field_type\"\r\nTraceback (most recent call last):\r\n  File \"/home/user/.local/bin/mypy\", line 8, in <module>\r\n    sys.exit(console_entry())\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/__main__.py\", line 11, in console_entry\r\n    main(None, sys.stdout, sys.stderr)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/main.py\", line 87, in main\r\n    res, messages, blockers = run_build(sources, options, fscache, t0, stdout, stderr)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/main.py\", line 165, in run_build\r\n    res = build.build(sources, options, None, flush_errors, fscache, stdout, stderr)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/build.py\", line 179, in build\r\n    result = _build(\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/build.py\", line 254, in _build\r\n    graph = dispatch(sources, manager, stdout)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/build.py\", line 2707, in dispatch\r\n    process_graph(graph, manager)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/build.py\", line 3031, in process_graph\r\n    process_stale_scc(graph, scc, manager)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/build.py\", line 3123, in process_stale_scc\r\n    mypy.semanal_main.semantic_analysis_for_scc(graph, scc, manager.errors)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/semanal_main.py\", line 84, in semantic_analysis_for_scc\r\n    check_type_arguments(graph, scc, errors)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/semanal_main.py\", line 360, in check_type_arguments\r\n    state.tree.accept(analyzer)\r\n  File \"/usr/lib64/python3.9/contextlib.py\", line 135, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/build.py\", line 1962, in wrap_context\r\n    yield\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/semanal_main.py\", line 360, in check_type_arguments\r\n    state.tree.accept(analyzer)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/nodes.py\", line 310, in accept\r\n    return visitor.visit_mypy_file(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/semanal_typeargs.py\", line 39, in visit_mypy_file\r\n    super().visit_mypy_file(o)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/traverser.py\", line 37, in visit_mypy_file\r\n    d.accept(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/nodes.py\", line 959, in accept\r\n    return visitor.visit_class_def(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/semanal_typeargs.py\", line 49, in visit_class_def\r\n    super().visit_class_def(defn)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/mixedtraverser.py\", line 28, in visit_class_def\r\n    super().visit_class_def(o)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/traverser.py\", line 73, in visit_class_def\r\n    o.defs.accept(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/nodes.py\", line 1024, in accept\r\n    return visitor.visit_block(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/semanal_typeargs.py\", line 53, in visit_block\r\n    super().visit_block(o)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/traverser.py\", line 41, in visit_block\r\n    s.accept(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/nodes.py\", line 696, in accept\r\n    return visitor.visit_func_def(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/traverser.py\", line 56, in visit_func_def\r\n    self.visit_func(o)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/semanal_typeargs.py\", line 45, in visit_func\r\n    super().visit_func(defn)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/mixedtraverser.py\", line 23, in visit_func\r\n    self.visit_optional_type(o.type)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/mixedtraverser.py\", line 91, in visit_optional_type\r\n    t.accept(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/types.py\", line 1114, in accept\r\n    return visitor.visit_callable_type(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/typetraverser.py\", line 52, in visit_callable_type\r\n    t.fallback.accept(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/types.py\", line 858, in accept\r\n    return visitor.visit_instance(self)\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/semanal_typeargs.py\", line 69, in visit_instance\r\n    for (i, arg), tvar in zip(enumerate(t.args), info.defn.type_vars):\r\n  File \"/home/user/.local/lib/python3.9/site-packages/mypy/nodes.py\", line 2656, in __getattribute__\r\n    raise AssertionError(object.__getattribute__(self, 'msg'))\r\nAssertionError: fallback can't be filled out until semanal\r\n```","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/11079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/11079/timeline","performed_via_github_app":null,"state_reason":"completed"}