[{"id":5190224490,"node_id":"MDEyOkxhYmVsZWRFdmVudDUxOTAyMjQ0OTA=","url":"https://api.github.com/repos/python/mypy/issues/events/5190224490","actor":{"login":"tlambert03","id":1609449,"node_id":"MDQ6VXNlcjE2MDk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1609449?v=4","gravatar_id":"","url":"https://api.github.com/users/tlambert03","html_url":"https://github.com/tlambert03","followers_url":"https://api.github.com/users/tlambert03/followers","following_url":"https://api.github.com/users/tlambert03/following{/other_user}","gists_url":"https://api.github.com/users/tlambert03/gists{/gist_id}","starred_url":"https://api.github.com/users/tlambert03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlambert03/subscriptions","organizations_url":"https://api.github.com/users/tlambert03/orgs","repos_url":"https://api.github.com/users/tlambert03/repos","events_url":"https://api.github.com/users/tlambert03/events{/privacy}","received_events_url":"https://api.github.com/users/tlambert03/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-08-21T21:57:53Z","label":{"name":"crash","color":"b60205"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/python/mypy/issues/comments/903409854","html_url":"https://github.com/python/mypy/issues/11007#issuecomment-903409854","issue_url":"https://api.github.com/repos/python/mypy/issues/11007","id":903409854,"node_id":"IC_kwDOAGuhRc412PC-","user":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-23T03:14:16Z","updated_at":"2021-08-23T03:14:16Z","body":"This is surely a bug in mypy, thanks for the report!\r\n\r\nI don't know what version of xarray you're running exactly, but looking at master right now, there is a call to `is_scalar` at line 1646 (https://github.com/pydata/xarray/blob/main/xarray/core/common.py#L1646). Mypy's TypeGuard support is a little buggy in general, so we probably just need to add a case somewhere.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/comments/903409854/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/python/mypy/issues/comments/903556634","html_url":"https://github.com/python/mypy/issues/11007#issuecomment-903556634","issue_url":"https://api.github.com/repos/python/mypy/issues/11007","id":903556634,"node_id":"IC_kwDOAGuhRc412y4a","user":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-23T08:32:26Z","updated_at":"2021-08-23T08:32:26Z","body":"Probably the same as https://github.com/python/mypy/issues/10647\r\n\r\nAlso not the first time we've had an issue stemming from xarray's typing (https://github.com/python/mypy/issues/9437), could be good to ensure mypy_primer coverage...","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/comments/903556634/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/python/mypy/issues/comments/903964800","html_url":"https://github.com/python/mypy/issues/11007#issuecomment-903964800","issue_url":"https://api.github.com/repos/python/mypy/issues/11007","id":903964800,"node_id":"IC_kwDOAGuhRc414WiA","user":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-23T17:21:10Z","updated_at":"2021-08-23T17:32:27Z","body":"( @tlambert03 if your project using xarray + mypy is open source, let me know, and I can add it to mypy_primer. It looks like I already have xarray in there, but clearly that wasn't enough)\r\n\r\nedit: found https://github.com/arviz-devs/arviz.git which reproduces the crash","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/comments/903964800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5195823302,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NTE5NTgyMzMwMg==","url":"https://api.github.com/repos/python/mypy/issues/events/5195823302","actor":{"login":"tlambert03","id":1609449,"node_id":"MDQ6VXNlcjE2MDk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1609449?v=4","gravatar_id":"","url":"https://api.github.com/users/tlambert03","html_url":"https://github.com/tlambert03","followers_url":"https://api.github.com/users/tlambert03/followers","following_url":"https://api.github.com/users/tlambert03/following{/other_user}","gists_url":"https://api.github.com/users/tlambert03/gists{/gist_id}","starred_url":"https://api.github.com/users/tlambert03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlambert03/subscriptions","organizations_url":"https://api.github.com/users/tlambert03/orgs","repos_url":"https://api.github.com/users/tlambert03/repos","events_url":"https://api.github.com/users/tlambert03/events{/privacy}","received_events_url":"https://api.github.com/users/tlambert03/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-08-23T17:21:10Z","performed_via_github_app":null},{"id":5195823305,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDUxOTU4MjMzMDU=","url":"https://api.github.com/repos/python/mypy/issues/events/5195823305","actor":{"login":"tlambert03","id":1609449,"node_id":"MDQ6VXNlcjE2MDk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1609449?v=4","gravatar_id":"","url":"https://api.github.com/users/tlambert03","html_url":"https://github.com/tlambert03","followers_url":"https://api.github.com/users/tlambert03/followers","following_url":"https://api.github.com/users/tlambert03/following{/other_user}","gists_url":"https://api.github.com/users/tlambert03/gists{/gist_id}","starred_url":"https://api.github.com/users/tlambert03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlambert03/subscriptions","organizations_url":"https://api.github.com/users/tlambert03/orgs","repos_url":"https://api.github.com/users/tlambert03/repos","events_url":"https://api.github.com/users/tlambert03/events{/privacy}","received_events_url":"https://api.github.com/users/tlambert03/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-08-23T17:21:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/python/mypy/issues/comments/903965845","html_url":"https://github.com/python/mypy/issues/11007#issuecomment-903965845","issue_url":"https://api.github.com/repos/python/mypy/issues/11007","id":903965845,"node_id":"IC_kwDOAGuhRc414WyV","user":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-23T17:22:48Z","updated_at":"2021-08-23T17:22:48Z","body":"The repro case here apparently is just importing xarray, so it's not clear why mypy-primer wouldn't catch that.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/comments/903965845/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/python/mypy/issues/comments/903969555","html_url":"https://github.com/python/mypy/issues/11007#issuecomment-903969555","issue_url":"https://api.github.com/repos/python/mypy/issues/11007","id":903969555,"node_id":"IC_kwDOAGuhRc414XsT","user":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-23T17:28:20Z","updated_at":"2021-08-23T17:28:20Z","body":"My guess would be because xarray's mypy.ini doesn't have check untyped defs","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/comments/903969555/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/python/mypy/issues/comments/903970941","html_url":"https://github.com/python/mypy/issues/11007#issuecomment-903970941","issue_url":"https://api.github.com/repos/python/mypy/issues/11007","id":903970941,"node_id":"IC_kwDOAGuhRc414YB9","user":{"login":"tlambert03","id":1609449,"node_id":"MDQ6VXNlcjE2MDk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1609449?v=4","gravatar_id":"","url":"https://api.github.com/users/tlambert03","html_url":"https://github.com/tlambert03","followers_url":"https://api.github.com/users/tlambert03/followers","following_url":"https://api.github.com/users/tlambert03/following{/other_user}","gists_url":"https://api.github.com/users/tlambert03/gists{/gist_id}","starred_url":"https://api.github.com/users/tlambert03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlambert03/subscriptions","organizations_url":"https://api.github.com/users/tlambert03/orgs","repos_url":"https://api.github.com/users/tlambert03/repos","events_url":"https://api.github.com/users/tlambert03/events{/privacy}","received_events_url":"https://api.github.com/users/tlambert03/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-23T17:30:31Z","updated_at":"2021-08-23T17:33:33Z","body":"here's the most relevant thing I could find about the way xarray uses mypy internally:\r\n\r\nhttps://github.com/pydata/xarray/blob/808b2e9eec1ec48d43cf9311dee27cd5550b8fd2/setup.cfg#L242-L245\r\n\r\n\r\n```ini\r\n[mypy]\r\nexclude = properties|asv_bench|doc\r\nfiles = xarray/**/*.py\r\nshow_error_codes = True\r\n\r\n# version spanning code is hard to type annotate (and most of this module will\r\n# be going away soon anyways)\r\n[mypy-xarray.core.pycompat]\r\nignore_errors = True\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/comments/903970941/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tlambert03","id":1609449,"node_id":"MDQ6VXNlcjE2MDk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1609449?v=4","gravatar_id":"","url":"https://api.github.com/users/tlambert03","html_url":"https://github.com/tlambert03","followers_url":"https://api.github.com/users/tlambert03/followers","following_url":"https://api.github.com/users/tlambert03/following{/other_user}","gists_url":"https://api.github.com/users/tlambert03/gists{/gist_id}","starred_url":"https://api.github.com/users/tlambert03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlambert03/subscriptions","organizations_url":"https://api.github.com/users/tlambert03/orgs","repos_url":"https://api.github.com/users/tlambert03/repos","events_url":"https://api.github.com/users/tlambert03/events{/privacy}","received_events_url":"https://api.github.com/users/tlambert03/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/python/mypy/issues/comments/903973250","html_url":"https://github.com/python/mypy/issues/11007#issuecomment-903973250","issue_url":"https://api.github.com/repos/python/mypy/issues/11007","id":903973250,"node_id":"IC_kwDOAGuhRc414YmC","user":{"login":"tlambert03","id":1609449,"node_id":"MDQ6VXNlcjE2MDk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1609449?v=4","gravatar_id":"","url":"https://api.github.com/users/tlambert03","html_url":"https://github.com/tlambert03","followers_url":"https://api.github.com/users/tlambert03/followers","following_url":"https://api.github.com/users/tlambert03/following{/other_user}","gists_url":"https://api.github.com/users/tlambert03/gists{/gist_id}","starred_url":"https://api.github.com/users/tlambert03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlambert03/subscriptions","organizations_url":"https://api.github.com/users/tlambert03/orgs","repos_url":"https://api.github.com/users/tlambert03/repos","events_url":"https://api.github.com/users/tlambert03/events{/privacy}","received_events_url":"https://api.github.com/users/tlambert03/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-23T17:34:05Z","updated_at":"2021-08-23T17:34:05Z","body":"but I'm not an xarray developer, I work on a project ([napari](https://github.com/napari/napari)) which had an xarray import which broke my ability to test our own package.  The minimal reproducible example above is just a fresh environment with a couple installs, a single `import xarray` statement with `--check-untyped-defs`","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/comments/903973250/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tlambert03","id":1609449,"node_id":"MDQ6VXNlcjE2MDk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1609449?v=4","gravatar_id":"","url":"https://api.github.com/users/tlambert03","html_url":"https://github.com/tlambert03","followers_url":"https://api.github.com/users/tlambert03/followers","following_url":"https://api.github.com/users/tlambert03/following{/other_user}","gists_url":"https://api.github.com/users/tlambert03/gists{/gist_id}","starred_url":"https://api.github.com/users/tlambert03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlambert03/subscriptions","organizations_url":"https://api.github.com/users/tlambert03/orgs","repos_url":"https://api.github.com/users/tlambert03/repos","events_url":"https://api.github.com/users/tlambert03/events{/privacy}","received_events_url":"https://api.github.com/users/tlambert03/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-06T03:00:28Z","updated_at":"2021-09-06T03:00:28Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/python/mypy/issues/11061","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/11061/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/11061/comments","events_url":"https://api.github.com/repos/python/mypy/issues/11061/events","html_url":"https://github.com/python/mypy/pull/11061","id":988692382,"node_id":"MDExOlB1bGxSZXF1ZXN0NzI3NTQ3MTE4","number":11061,"title":"Fix type guard crashes","user":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2021-09-06T03:00:28Z","updated_at":"2021-09-14T06:42:10Z","closed_at":"2021-09-14T06:42:07Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":7053637,"node_id":"MDEwOlJlcG9zaXRvcnk3MDUzNjM3","name":"mypy","full_name":"python/mypy","private":false,"owner":{"login":"python","id":1525981,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1MjU5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1525981?v=4","gravatar_id":"","url":"https://api.github.com/users/python","html_url":"https://github.com/python","followers_url":"https://api.github.com/users/python/followers","following_url":"https://api.github.com/users/python/following{/other_user}","gists_url":"https://api.github.com/users/python/gists{/gist_id}","starred_url":"https://api.github.com/users/python/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/python/subscriptions","organizations_url":"https://api.github.com/users/python/orgs","repos_url":"https://api.github.com/users/python/repos","events_url":"https://api.github.com/users/python/events{/privacy}","received_events_url":"https://api.github.com/users/python/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/python/mypy","description":"Optional static typing for Python","fork":false,"url":"https://api.github.com/repos/python/mypy","forks_url":"https://api.github.com/repos/python/mypy/forks","keys_url":"https://api.github.com/repos/python/mypy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/python/mypy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/python/mypy/teams","hooks_url":"https://api.github.com/repos/python/mypy/hooks","issue_events_url":"https://api.github.com/repos/python/mypy/issues/events{/number}","events_url":"https://api.github.com/repos/python/mypy/events","assignees_url":"https://api.github.com/repos/python/mypy/assignees{/user}","branches_url":"https://api.github.com/repos/python/mypy/branches{/branch}","tags_url":"https://api.github.com/repos/python/mypy/tags","blobs_url":"https://api.github.com/repos/python/mypy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/python/mypy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/python/mypy/git/refs{/sha}","trees_url":"https://api.github.com/repos/python/mypy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/python/mypy/statuses/{sha}","languages_url":"https://api.github.com/repos/python/mypy/languages","stargazers_url":"https://api.github.com/repos/python/mypy/stargazers","contributors_url":"https://api.github.com/repos/python/mypy/contributors","subscribers_url":"https://api.github.com/repos/python/mypy/subscribers","subscription_url":"https://api.github.com/repos/python/mypy/subscription","commits_url":"https://api.github.com/repos/python/mypy/commits{/sha}","git_commits_url":"https://api.github.com/repos/python/mypy/git/commits{/sha}","comments_url":"https://api.github.com/repos/python/mypy/comments{/number}","issue_comment_url":"https://api.github.com/repos/python/mypy/issues/comments{/number}","contents_url":"https://api.github.com/repos/python/mypy/contents/{+path}","compare_url":"https://api.github.com/repos/python/mypy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/python/mypy/merges","archive_url":"https://api.github.com/repos/python/mypy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/python/mypy/downloads","issues_url":"https://api.github.com/repos/python/mypy/issues{/number}","pulls_url":"https://api.github.com/repos/python/mypy/pulls{/number}","milestones_url":"https://api.github.com/repos/python/mypy/milestones{/number}","notifications_url":"https://api.github.com/repos/python/mypy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/python/mypy/labels{/name}","releases_url":"https://api.github.com/repos/python/mypy/releases{/id}","deployments_url":"https://api.github.com/repos/python/mypy/deployments","created_at":"2012-12-07T13:30:23Z","updated_at":"2025-11-09T16:41:25Z","pushed_at":"2025-11-08T23:13:28Z","git_url":"git://github.com/python/mypy.git","ssh_url":"git@github.com:python/mypy.git","clone_url":"https://github.com/python/mypy.git","svn_url":"https://github.com/python/mypy","homepage":"https://www.mypy-lang.org/","size":76085,"stargazers_count":19971,"watchers_count":19971,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":3042,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":3097,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["linter","python","typechecker","types","typing"],"visibility":"public","forks":3042,"open_issues":3097,"watchers":19971,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/python/mypy/pulls/11061","html_url":"https://github.com/python/mypy/pull/11061","diff_url":"https://github.com/python/mypy/pull/11061.diff","patch_url":"https://github.com/python/mypy/pull/11061.patch","merged_at":"2021-09-14T06:42:05Z"},"body":"Fixes #11007, fixes #10899, fixes #10647\r\n\r\nSince the initial implementation of TypeGuard, there have been several fixes quickly applied to make mypy not crash on various TypeGuard things. This includes #10496, #10683 and #11015. We'll discuss how this PR relates to each of these three changes.\r\n\r\nIn particular, #10496 seems incorrect. As A5rocks discusses in #10899 , it introduces confusion between a type guarded variable and a TypeGuard[T]. This PR basically walks back that change entirely and renames TypeGuardType to TypeGuardedType to reduce that possible confusion.\r\n\r\nNow, we still have the issue that TypeGuardedTypes are getting everywhere and causing unhappiness. I see two high level solutions to this:\r\na) Make TypeGuardedType a proper type, then delegate to the wrapped type in a bunch of type visitors and arbitrary amounts of other places where multiple types interact, and hope that we got all of them,\r\nb) Make TypeGuardedType as an improper type (as it was in the original implementation)! Similar to TypeAliasType, it's just a wrapper for another type, so we unwrap it in get_proper_type. This is the approach this PR takes. This might feel controversial, but I think it could be the better option. It also means that if we type check we won't get type guard crashes.\r\n\r\n#10683 is basically \"remove call that leads to crash from the stacktrace\". I think the join here (that ends up being with the wrapped type of the TypeGuardedType) is actually fine: if it's different, it tells us that the type changed, which is what we want to know. So seems fine to remove the special casing.\r\n\r\nFinally, #11015. This is the other contentious part of this PR. I liked the idea of moving the core \"type guard overrides narrowing\" idea into meet.py, so I kept that. But my changes ended up regressing a reveal_type testTypeGuardNestedRestrictionAny test that was added. But it's not really clear to me how that worked or really, what it tested. I tried writing a simpler version of what I thought the test was meant to test (this is testTypeGuardMultipleCondition added in this PR), but that fails on master.\r\n\r\nAnyway, this should at least fix the type guard crashes that have been coming up.","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/11061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/11061/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":5297389516,"node_id":"CE_lADOAGuhRc46MBaJzwAAAAE7v7_M","url":"https://api.github.com/repos/python/mypy/issues/events/5297389516","actor":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-09-14T06:42:06Z","state_reason":null,"performed_via_github_app":null},{"id":5297389692,"node_id":"REFE_lADOAGuhRc46MBaJzwAAAAE7v8B8","url":"https://api.github.com/repos/python/mypy/issues/events/5297389692","actor":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"05f38571f1b7af46dbadaeba0f74626d3a9e07c9","commit_url":"https://api.github.com/repos/python/mypy/commits/05f38571f1b7af46dbadaeba0f74626d3a9e07c9","created_at":"2021-09-14T06:42:08Z","performed_via_github_app":null},{"actor":{"login":"wbolster","id":748944,"node_id":"MDQ6VXNlcjc0ODk0NA==","avatar_url":"https://avatars.githubusercontent.com/u/748944?v=4","gravatar_id":"","url":"https://api.github.com/users/wbolster","html_url":"https://github.com/wbolster","followers_url":"https://api.github.com/users/wbolster/followers","following_url":"https://api.github.com/users/wbolster/following{/other_user}","gists_url":"https://api.github.com/users/wbolster/gists{/gist_id}","starred_url":"https://api.github.com/users/wbolster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wbolster/subscriptions","organizations_url":"https://api.github.com/users/wbolster/orgs","repos_url":"https://api.github.com/users/wbolster/repos","events_url":"https://api.github.com/users/wbolster/events{/privacy}","received_events_url":"https://api.github.com/users/wbolster/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-01T16:58:43Z","updated_at":"2021-11-01T16:58:43Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/python/mypy/issues/11428","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/11428/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/11428/comments","events_url":"https://api.github.com/repos/python/mypy/issues/11428/events","html_url":"https://github.com/python/mypy/issues/11428","id":1041383081,"node_id":"I_kwDOAGuhRc4-Ej6p","number":11428,"title":"TypeGuard functions not properly recognizing generic types","user":{"login":"wbolster","id":748944,"node_id":"MDQ6VXNlcjc0ODk0NA==","avatar_url":"https://avatars.githubusercontent.com/u/748944?v=4","gravatar_id":"","url":"https://api.github.com/users/wbolster","html_url":"https://github.com/wbolster","followers_url":"https://api.github.com/users/wbolster/followers","following_url":"https://api.github.com/users/wbolster/following{/other_user}","gists_url":"https://api.github.com/users/wbolster/gists{/gist_id}","starred_url":"https://api.github.com/users/wbolster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wbolster/subscriptions","organizations_url":"https://api.github.com/users/wbolster/orgs","repos_url":"https://api.github.com/users/wbolster/repos","events_url":"https://api.github.com/users/wbolster/events{/privacy}","received_events_url":"https://api.github.com/users/wbolster/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":3945317421,"node_id":"LA_kwDOAGuhRc7rKMQt","url":"https://api.github.com/repos/python/mypy/labels/topic-typeguard-typeis","name":"topic-typeguard-typeis","color":"b60205","default":false,"description":"TypeGuard / TypeIs / PEP 647 / PEP 742"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2021-11-01T16:56:16Z","updated_at":"2022-05-08T02:55:40Z","closed_at":"2022-05-08T02:55:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":7053637,"node_id":"MDEwOlJlcG9zaXRvcnk3MDUzNjM3","name":"mypy","full_name":"python/mypy","private":false,"owner":{"login":"python","id":1525981,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1MjU5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1525981?v=4","gravatar_id":"","url":"https://api.github.com/users/python","html_url":"https://github.com/python","followers_url":"https://api.github.com/users/python/followers","following_url":"https://api.github.com/users/python/following{/other_user}","gists_url":"https://api.github.com/users/python/gists{/gist_id}","starred_url":"https://api.github.com/users/python/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/python/subscriptions","organizations_url":"https://api.github.com/users/python/orgs","repos_url":"https://api.github.com/users/python/repos","events_url":"https://api.github.com/users/python/events{/privacy}","received_events_url":"https://api.github.com/users/python/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/python/mypy","description":"Optional static typing for Python","fork":false,"url":"https://api.github.com/repos/python/mypy","forks_url":"https://api.github.com/repos/python/mypy/forks","keys_url":"https://api.github.com/repos/python/mypy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/python/mypy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/python/mypy/teams","hooks_url":"https://api.github.com/repos/python/mypy/hooks","issue_events_url":"https://api.github.com/repos/python/mypy/issues/events{/number}","events_url":"https://api.github.com/repos/python/mypy/events","assignees_url":"https://api.github.com/repos/python/mypy/assignees{/user}","branches_url":"https://api.github.com/repos/python/mypy/branches{/branch}","tags_url":"https://api.github.com/repos/python/mypy/tags","blobs_url":"https://api.github.com/repos/python/mypy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/python/mypy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/python/mypy/git/refs{/sha}","trees_url":"https://api.github.com/repos/python/mypy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/python/mypy/statuses/{sha}","languages_url":"https://api.github.com/repos/python/mypy/languages","stargazers_url":"https://api.github.com/repos/python/mypy/stargazers","contributors_url":"https://api.github.com/repos/python/mypy/contributors","subscribers_url":"https://api.github.com/repos/python/mypy/subscribers","subscription_url":"https://api.github.com/repos/python/mypy/subscription","commits_url":"https://api.github.com/repos/python/mypy/commits{/sha}","git_commits_url":"https://api.github.com/repos/python/mypy/git/commits{/sha}","comments_url":"https://api.github.com/repos/python/mypy/comments{/number}","issue_comment_url":"https://api.github.com/repos/python/mypy/issues/comments{/number}","contents_url":"https://api.github.com/repos/python/mypy/contents/{+path}","compare_url":"https://api.github.com/repos/python/mypy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/python/mypy/merges","archive_url":"https://api.github.com/repos/python/mypy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/python/mypy/downloads","issues_url":"https://api.github.com/repos/python/mypy/issues{/number}","pulls_url":"https://api.github.com/repos/python/mypy/pulls{/number}","milestones_url":"https://api.github.com/repos/python/mypy/milestones{/number}","notifications_url":"https://api.github.com/repos/python/mypy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/python/mypy/labels{/name}","releases_url":"https://api.github.com/repos/python/mypy/releases{/id}","deployments_url":"https://api.github.com/repos/python/mypy/deployments","created_at":"2012-12-07T13:30:23Z","updated_at":"2025-11-09T16:41:25Z","pushed_at":"2025-11-08T23:13:28Z","git_url":"git://github.com/python/mypy.git","ssh_url":"git@github.com:python/mypy.git","clone_url":"https://github.com/python/mypy.git","svn_url":"https://github.com/python/mypy","homepage":"https://www.mypy-lang.org/","size":76085,"stargazers_count":19971,"watchers_count":19971,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":3042,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":3097,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["linter","python","typechecker","types","typing"],"visibility":"public","forks":3042,"open_issues":3097,"watchers":19971,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"**Bug Report**\r\n\r\nIt seems the `typing.TypeGuard` support is not able to properly discriminate a union of two (generic) types.\r\n\r\n**To Reproduce**\r\n\r\n* The example below defines two completely distinct types, `Left[L]` and `Right[R]`, both of which happen to be generic and have a `.value` attribute.\r\n* The `LeftOrRight` is a `Union` of those types.\r\n* `x` is a variable of type `LeftOrRight[str, int]`. In this example it has value `Left(\"\")`\r\n* Using `isinstance()` works fine to figure out whether `x` is either `Left` or `Right`, and within the `if/else` block the types are correct, including the types `L` and `R` (both `TypeVar`)\r\n* The `is_left()` and `is_right()` helpers use `typing.TypeGuard`, but Mypy does not recognize the types like it did with the `isinstance()` check.\r\n\r\n```python\r\nfrom typing import Generic, TypeGuard, TypeVar, Union\r\n\r\nL = TypeVar(\"L\")\r\nR = TypeVar(\"R\")\r\n\r\n\r\nclass Left(Generic[L]):\r\n    value: L\r\n\r\n    def __init__(self, value: L):\r\n        self.value = value\r\n\r\n\r\nclass Right(Generic[R]):\r\n    value: R\r\n\r\n    def __init__(self, value: R):\r\n        self.value = value\r\n\r\n\r\nLeftOrRight = Union[Left[L], Right[R]]\r\n\r\n\r\ndef is_left(obj: LeftOrRight[L, R]) -> TypeGuard[Left[L]]:\r\n    return isinstance(obj, Left)\r\n\r\n\r\ndef is_right(obj: LeftOrRight[L, R]) -> TypeGuard[Right[R]]:\r\n    return isinstance(obj, Right)\r\n\r\n\r\nx: LeftOrRight[str, int] = Left(\"\")\r\nreveal_type(x)  # Revealed type is \"Union[Left[builtins.str], Right[builtins.int]]\"\r\n\r\nif isinstance(x, Left):\r\n    reveal_type(x)  # Revealed type is \"Left[builtins.str]\"\r\n    x.value + \"\"  # only valid for str\r\nelse:\r\n    reveal_type(x)  # Revealed type is \"Right[builtins.int]\"\r\n    x.value + 10  # only valid for int\r\n\r\nif is_left(x):\r\n    reveal_type(x)  # Revealed type is \"Left[L`-1]\"\r\n    x.value + \"\"  #  Unsupported left operand type for + (\"L\")  [operator]\r\nelse:\r\n    reveal_type(x)  # Revealed type is \"Union[Left[builtins.str], Right[builtins.int]]\"\r\n    x.value + 10  # Unsupported operand types for + (\"str\" and \"int\")  [operator]\r\n\r\n```\r\n\r\n**Expected Behavior**\r\n\r\n`is_left()` and `is_right()` act as type-safe ways to discriminate between the two members of the `Union`, including the actual type of the (generic) `.value` attribute.\r\n\r\n**Actual Behavior**\r\n\r\n* `reveal_type()` returns wrong results\r\n* type errors reported in what seems to be perfectly fine and very strict code\r\n\r\n**Your Environment**\r\n\r\nThis happens with both Mypy 0.910 (current release as time of writing) and today's `git` checkout of the main branch.\r\n","reactions":{"url":"https://api.github.com/repos/python/mypy/issues/11428/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/11428/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"haroldmeerwaldt","id":48909471,"node_id":"MDQ6VXNlcjQ4OTA5NDcx","avatar_url":"https://avatars.githubusercontent.com/u/48909471?v=4","gravatar_id":"","url":"https://api.github.com/users/haroldmeerwaldt","html_url":"https://github.com/haroldmeerwaldt","followers_url":"https://api.github.com/users/haroldmeerwaldt/followers","following_url":"https://api.github.com/users/haroldmeerwaldt/following{/other_user}","gists_url":"https://api.github.com/users/haroldmeerwaldt/gists{/gist_id}","starred_url":"https://api.github.com/users/haroldmeerwaldt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/haroldmeerwaldt/subscriptions","organizations_url":"https://api.github.com/users/haroldmeerwaldt/orgs","repos_url":"https://api.github.com/users/haroldmeerwaldt/repos","events_url":"https://api.github.com/users/haroldmeerwaldt/events{/privacy}","received_events_url":"https://api.github.com/users/haroldmeerwaldt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-12T13:01:56Z","updated_at":"2021-11-12T13:01:56Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/pydata/xarray/issues/5960","repository_url":"https://api.github.com/repos/pydata/xarray","labels_url":"https://api.github.com/repos/pydata/xarray/issues/5960/labels{/name}","comments_url":"https://api.github.com/repos/pydata/xarray/issues/5960/comments","events_url":"https://api.github.com/repos/pydata/xarray/issues/5960/events","html_url":"https://github.com/pydata/xarray/issues/5960","id":1048491482,"node_id":"I_kwDOAMm_X84-frXa","number":5960,"title":"Mypy 0.910 gives an internal error on xarray.core.common.full_like","user":{"login":"haroldmeerwaldt","id":48909471,"node_id":"MDQ6VXNlcjQ4OTA5NDcx","avatar_url":"https://avatars.githubusercontent.com/u/48909471?v=4","gravatar_id":"","url":"https://api.github.com/users/haroldmeerwaldt","html_url":"https://github.com/haroldmeerwaldt","followers_url":"https://api.github.com/users/haroldmeerwaldt/followers","following_url":"https://api.github.com/users/haroldmeerwaldt/following{/other_user}","gists_url":"https://api.github.com/users/haroldmeerwaldt/gists{/gist_id}","starred_url":"https://api.github.com/users/haroldmeerwaldt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/haroldmeerwaldt/subscriptions","organizations_url":"https://api.github.com/users/haroldmeerwaldt/orgs","repos_url":"https://api.github.com/users/haroldmeerwaldt/repos","events_url":"https://api.github.com/users/haroldmeerwaldt/events{/privacy}","received_events_url":"https://api.github.com/users/haroldmeerwaldt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-11-09T11:25:04Z","updated_at":"2022-09-09T08:57:12Z","closed_at":"2021-11-12T13:02:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":13221727,"node_id":"MDEwOlJlcG9zaXRvcnkxMzIyMTcyNw==","name":"xarray","full_name":"pydata/xarray","private":false,"owner":{"login":"pydata","id":1284191,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEyODQxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/1284191?v=4","gravatar_id":"","url":"https://api.github.com/users/pydata","html_url":"https://github.com/pydata","followers_url":"https://api.github.com/users/pydata/followers","following_url":"https://api.github.com/users/pydata/following{/other_user}","gists_url":"https://api.github.com/users/pydata/gists{/gist_id}","starred_url":"https://api.github.com/users/pydata/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pydata/subscriptions","organizations_url":"https://api.github.com/users/pydata/orgs","repos_url":"https://api.github.com/users/pydata/repos","events_url":"https://api.github.com/users/pydata/events{/privacy}","received_events_url":"https://api.github.com/users/pydata/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/pydata/xarray","description":"N-D labeled arrays and datasets in Python","fork":false,"url":"https://api.github.com/repos/pydata/xarray","forks_url":"https://api.github.com/repos/pydata/xarray/forks","keys_url":"https://api.github.com/repos/pydata/xarray/keys{/key_id}","collaborators_url":"https://api.github.com/repos/pydata/xarray/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/pydata/xarray/teams","hooks_url":"https://api.github.com/repos/pydata/xarray/hooks","issue_events_url":"https://api.github.com/repos/pydata/xarray/issues/events{/number}","events_url":"https://api.github.com/repos/pydata/xarray/events","assignees_url":"https://api.github.com/repos/pydata/xarray/assignees{/user}","branches_url":"https://api.github.com/repos/pydata/xarray/branches{/branch}","tags_url":"https://api.github.com/repos/pydata/xarray/tags","blobs_url":"https://api.github.com/repos/pydata/xarray/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/pydata/xarray/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/pydata/xarray/git/refs{/sha}","trees_url":"https://api.github.com/repos/pydata/xarray/git/trees{/sha}","statuses_url":"https://api.github.com/repos/pydata/xarray/statuses/{sha}","languages_url":"https://api.github.com/repos/pydata/xarray/languages","stargazers_url":"https://api.github.com/repos/pydata/xarray/stargazers","contributors_url":"https://api.github.com/repos/pydata/xarray/contributors","subscribers_url":"https://api.github.com/repos/pydata/xarray/subscribers","subscription_url":"https://api.github.com/repos/pydata/xarray/subscription","commits_url":"https://api.github.com/repos/pydata/xarray/commits{/sha}","git_commits_url":"https://api.github.com/repos/pydata/xarray/git/commits{/sha}","comments_url":"https://api.github.com/repos/pydata/xarray/comments{/number}","issue_comment_url":"https://api.github.com/repos/pydata/xarray/issues/comments{/number}","contents_url":"https://api.github.com/repos/pydata/xarray/contents/{+path}","compare_url":"https://api.github.com/repos/pydata/xarray/compare/{base}...{head}","merges_url":"https://api.github.com/repos/pydata/xarray/merges","archive_url":"https://api.github.com/repos/pydata/xarray/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/pydata/xarray/downloads","issues_url":"https://api.github.com/repos/pydata/xarray/issues{/number}","pulls_url":"https://api.github.com/repos/pydata/xarray/pulls{/number}","milestones_url":"https://api.github.com/repos/pydata/xarray/milestones{/number}","notifications_url":"https://api.github.com/repos/pydata/xarray/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/pydata/xarray/labels{/name}","releases_url":"https://api.github.com/repos/pydata/xarray/releases{/id}","deployments_url":"https://api.github.com/repos/pydata/xarray/deployments","created_at":"2013-09-30T17:21:10Z","updated_at":"2025-11-09T10:41:04Z","pushed_at":"2025-11-07T07:26:35Z","git_url":"git://github.com/pydata/xarray.git","ssh_url":"git@github.com:pydata/xarray.git","clone_url":"https://github.com/pydata/xarray.git","svn_url":"https://github.com/pydata/xarray","homepage":"https://xarray.dev","size":51480,"stargazers_count":4013,"watchers_count":4013,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":1197,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1327,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["dask","netcdf","numpy","pandas","python","xarray"],"visibility":"public","forks":1197,"open_issues":1327,"watchers":4013,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"<!-- Please include a self-contained copy-pastable example that generates the issue if possible.\r\n\r\nPlease be concise with code posted. See guidelines below on how to provide a good bug report:\r\n\r\n- Craft Minimal Bug Reports: http://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports\r\n- Minimal Complete Verifiable Examples: https://stackoverflow.com/help/mcve\r\n\r\nBug reports that follow these guidelines are easier to diagnose, and so are often handled much more quickly.\r\n-->\r\n\r\n**What happened**:\r\nmypy raised an internal error when checking importing xarray:\r\n\r\n```\r\nC:\\Users\\xxx\\env\\lib\\site-packages\\xarray\\core\\common.py:1664: error: INTERNAL ERROR -- Please try using mypy master on Github:\r\nhttps://mypy.readthedocs.io/en/stable/common_issues.html#using-a-development-mypy-build\r\nPlease report a bug at https://github.com/python/mypy/issues\r\nversion: 0.910\r\nTraceback (most recent call last):\r\n  File \"C:\\Python397\\lib\\runpy.py\", line 197, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"C:\\Python397\\lib\\runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"mypy\\checkexpr.py\", line 3911, in accept\r\n  File \"mypy\\nodes.py\", line 1558, in accept\r\n  File \"mypy\\checkexpr.py\", line 271, in visit_call_expr\r\n  File \"mypy\\checkexpr.py\", line 353, in visit_call_expr_inner\r\n  File \"mypy\\checkexpr.py\", line 858, in check_call_expr_with_callee_type\r\n  File \"mypy\\checkexpr.py\", line 917, in check_call\r\n  File \"mypy\\checkexpr.py\", line 1014, in check_callable_call\r\n  File \"mypy\\checkexpr.py\", line 1485, in check_argument_types\r\n  File \"mypy\\checkexpr.py\", line 1515, in check_arg\r\n  File \"mypy\\subtypes.py\", line 93, in is_subtype\r\n  File \"mypy\\subtypes.py\", line 147, in _is_subtype\r\n  File \"mypy\\types.py\", line 1790, in accept\r\n  File \"mypy\\subtypes.py\", line 476, in visit_union_type\r\n  File \"mypy\\subtypes.py\", line 205, in _is_subtype\r\n  File \"mypy\\subtypes.py\", line 93, in is_subtype\r\n  File \"mypy\\subtypes.py\", line 147, in _is_subtype\r\n  File \"mypy\\types.py\", line 290, in accept\r\n  File \"mypy\\subtypes.py\", line 479, in visit_type_guard_type\r\nRuntimeError: TypeGuard should not appear here\r\nC:\\Users\\xxx\\env\\lib\\site-packages\\xarray\\core\\common.py:1664: : note: use --pdb to drop into pdb\r\n```\r\n\r\nIt appears to have to do with this piece of code on line 1664 in xarray.core.common.full_like:\r\n```python\r\n    if isinstance(other, Dataset):\r\n        if not isinstance(fill_value, dict):\r\n            fill_value = {k: fill_value for k in other.data_vars.keys()}\r\n```\r\n\r\n**What you expected to happen**:\r\nI expected mypy to pass without errors. In 0.18.2 it still worked:\r\n```bash\r\npip install \"xarray==0.18.2\"\r\npip install mypy\r\nmypy -c \"import xarray\" --show-traceback\r\n>>> Success: no issues found in 1 source file\r\n```\r\n\r\n**Minimal Complete Verifiable Example**:\r\n```bash\r\npip install xarray\r\npip install mypy\r\nmypy -c \"import xarray\" --show-traceback\r\n```\r\n\r\n**Anything else we need to know?**:\r\nmypy version: 0.910\r\nxarray version: 0.20.1\r\nxarray 0.18.2 works fine, but 0.19.0 does not\r\n\r\n**Environment**:\r\n\r\n<details><summary>Output of <tt>xr.show_versions()</tt></summary>\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit: None\r\npython: 3.9.7 (tags/v3.9.7:1016ef3, Aug 30 2021, 20:19:38) [MSC v.1929 64 bit (AMD64)]\r\npython-bits: 64\r\nOS: Windows\r\nOS-release: 10\r\nmachine: AMD64\r\nprocessor: Intel64 Family 6 Model 78 Stepping 3, GenuineIntel\r\nbyteorder: little\r\nLC_ALL: None\r\nLANG: None\r\nLOCALE: ('Dutch_Netherlands', '1252')\r\nlibhdf5: 1.12.1\r\nlibnetcdf: None\r\nxarray: 0.20.1\r\npandas: 1.3.4\r\nnumpy: 1.21.4\r\nscipy: 1.7.2\r\nnetCDF4: None\r\npydap: None\r\nh5netcdf: 0.11.0\r\nh5py: 3.5.0\r\nNio: None\r\nzarr: None\r\ncftime: None\r\nnc_time_axis: None\r\nPseudoNetCDF: None\r\nrasterio: None\r\ncfgrib: None\r\niris: None\r\nbottleneck: None\r\ndask: None\r\ndistributed: None\r\nmatplotlib: 3.4.3\r\ncartopy: None\r\nseaborn: None\r\nnumbagg: None\r\nfsspec: None\r\ncupy: None\r\npint: None\r\nsparse: None\r\nsetuptools: 58.5.3\r\npip: 21.3.1\r\nconda: None\r\npytest: 6.2.5\r\nIPython: 7.29.0\r\nsphinx: None\r\n\r\n\r\n</details>\r\n","reactions":{"url":"https://api.github.com/repos/pydata/xarray/issues/5960/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydata/xarray/issues/5960/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]