{"url":"https://api.github.com/repos/python/mypy/issues/19483","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/19483/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/19483/comments","events_url":"https://api.github.com/repos/python/mypy/issues/19483/events","html_url":"https://github.com/python/mypy/issues/19483","id":3246421633,"node_id":"I_kwDOAGuhRc7BgHaB","number":19483,"title":"1.17.0 regression: dict literals incompatible with Sequence[TypedDict]","user":{"login":"LefterisJP","id":1658405,"node_id":"MDQ6VXNlcjE2NTg0MDU=","avatar_url":"https://avatars.githubusercontent.com/u/1658405?v=4","gravatar_id":"","url":"https://api.github.com/users/LefterisJP","html_url":"https://github.com/LefterisJP","followers_url":"https://api.github.com/users/LefterisJP/followers","following_url":"https://api.github.com/users/LefterisJP/following{/other_user}","gists_url":"https://api.github.com/users/LefterisJP/gists{/gist_id}","starred_url":"https://api.github.com/users/LefterisJP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LefterisJP/subscriptions","organizations_url":"https://api.github.com/users/LefterisJP/orgs","repos_url":"https://api.github.com/users/LefterisJP/repos","events_url":"https://api.github.com/users/LefterisJP/events{/privacy}","received_events_url":"https://api.github.com/users/LefterisJP/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":488169816,"node_id":"MDU6TGFiZWw0ODgxNjk4MTY=","url":"https://api.github.com/repos/python/mypy/labels/topic-typed-dict","name":"topic-typed-dict","color":"d4c5f9","default":false,"description":null},{"id":3945264178,"node_id":"LA_kwDOAGuhRc7rJ_Qy","url":"https://api.github.com/repos/python/mypy/labels/topic-type-context","name":"topic-type-context","color":"83B1BA","default":false,"description":"Type context / bidirectional inference"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2025-07-20T14:40:13Z","updated_at":"2025-07-31T07:54:06Z","closed_at":"2025-07-21T18:31:00Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bug Report\n\n(yes I used claude code to sum the issue up)\n\n### Summary\nmypy 1.17.0 incorrectly reports type errors when using dict literals that should be compatible with `Sequence[TypedDict]` fields. This worked correctly in mypy 1.16.1 and represents a regression in TypedDict structural typing.\n\n### Expected Behavior\nDict literals with the correct structure should be accepted when assigned to fields expecting `Sequence[TypedDict]`, following structural typing principles that TypedDict is supposed to provide.\n\n### Actual Behavior\nmypy 1.17.0 reports:\n```\nerror: Incompatible types (expression has type \"list[dict[str, str]]\", TypedDict item \"inputs\" has type \"Sequence[Component]\")  [typeddict-item]\n```\n\n### Environment\n- **mypy version**: 1.17.0 (fails) vs 1.16.1 (works)\n- **Python version**: 3.11.9\n- **Platform**: Linux\n- **Dependencies**: None (pure `typing` module)\n\n### Minimal Reproducible Example\n\nSave as `test_regression.py`:\n\n```python\nclass Component(TypedDict):\n    \"\"\"Simulates ABIComponent from eth_typing\"\"\"\n    type: str\n    name: NotRequired[str]\n    components: NotRequired[Sequence['Component']]\n\nclass Function(TypedDict):\n    \"\"\"Simulates ABIFunction from eth_typing\"\"\"\n    type: Literal['function']\n    name: str\n    stateMutability: Literal['pure', 'view', 'nonpayable', 'payable']\n    inputs: NotRequired[Sequence[Component]]\n    outputs: NotRequired[Sequence[Component]]\n\n# This should work according to TypedDict structural typing rules\n# Works in mypy 1.16.1, fails in mypy 1.17.0\n\n# Simple case\nsimple_function: Function = {\n    'type': 'function',\n    'name': 'test',\n    'stateMutability': 'view',\n    'inputs': [{'type': 'uint256', 'name': 'value'}],  # Error in 1.17.0\n    'outputs': [{'type': 'bool'}]  # Error in 1.17.0\n}\n\n# Nested case (components within components)\ncomplex_function: Function = {\n    'type': 'function', \n    'name': 'complex',\n    'stateMutability': 'view',\n    'inputs': [\n        {'type': 'tuple', 'components': [  # Error in 1.17.0\n            {'type': 'uint256', 'name': 'amount'},\n            {'type': 'address', 'name': 'recipient'}\n        ]}\n    ]\n}\n\n# Direct assignment to Sequence should also fail\ncomponents_list: Sequence[Component] = [\n    {'type': 'uint256', 'name': 'value'},  # Error in 1.17.0\n    {'type': 'address'}  # Error in 1.17.0  \n]\n\n# List of functions\nfunction_list: list[Function] = [\n    {\n        'type': 'function',\n        'name': 'func1', \n        'stateMutability': 'pure',\n        'inputs': [{'type': 'uint256'}]  # Error in 1.17.0\n    }\n]\n```\n\n### Steps to Reproduce\n1. Save the code above as `test_regression.py`\n2. Run with mypy 1.16.1: `mypy test_regression.py` → ✅ Success\n3. Run with mypy 1.17.0: `mypy test_regression.py` → ❌ Fails\n\n### Error Output (mypy 1.17.0)\n```\nstandalone_bug_test.py:43: error: Incompatible types (expression has type \"list[dict[str, str]]\", TypedDict item \"components\" has type \"Sequence[Component]\")  [typeddict-item]\nstandalone_bug_test.py:62: error: Incompatible types (expression has type \"list[dict[str, str]]\", TypedDict item \"inputs\" has type \"Sequence[Component]\")  [typeddict-item]\n```\n\n### Analysis\nThis is a clear regression where mypy 1.17.0 is no longer properly recognizing dict literals as structurally compatible with TypedDict types when used in `Sequence[TypedDict]` contexts. The fundamental principle of TypedDict structural typing is broken.\n\n### Root Cause\nThe issue appears to be in mypy's type inference logic where:\n1. Dict literals inside lists are inferred as `dict[str, str]` instead of the contextually expected TypedDict\n2. This inference happens before structural compatibility is checked\n3. The resulting `list[dict[str, str]]` is then (correctly) rejected as incompatible with `Sequence[TypedDict]`\n\n### Expected Fix\nDict literals should be contextually typed when the expected type is `Sequence[TypedDict]`, allowing structural compatibility to work as intended.\n\n### Workarounds\n- Use `# type: ignore[typeddict-item]` or `# type: ignore[assignment]` comments\n- Use explicit `cast(list[Component], [...])` \n- Use explicit TypedDict construction: `Component(type='uint256', name='value')`\n- Downgrade to mypy 1.16.1","closed_by":{"login":"ilevkivskyi","id":12005495,"node_id":"MDQ6VXNlcjEyMDA1NDk1","avatar_url":"https://avatars.githubusercontent.com/u/12005495?v=4","gravatar_id":"","url":"https://api.github.com/users/ilevkivskyi","html_url":"https://github.com/ilevkivskyi","followers_url":"https://api.github.com/users/ilevkivskyi/followers","following_url":"https://api.github.com/users/ilevkivskyi/following{/other_user}","gists_url":"https://api.github.com/users/ilevkivskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/ilevkivskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilevkivskyi/subscriptions","organizations_url":"https://api.github.com/users/ilevkivskyi/orgs","repos_url":"https://api.github.com/users/ilevkivskyi/repos","events_url":"https://api.github.com/users/ilevkivskyi/events{/privacy}","received_events_url":"https://api.github.com/users/ilevkivskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/19483/reactions","total_count":2,"+1":1,"-1":1,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/19483/timeline","performed_via_github_app":null,"state_reason":"completed"}