{"url":"https://api.github.com/repos/python/mypy/issues/18886","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/18886/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/18886/comments","events_url":"https://api.github.com/repos/python/mypy/issues/18886/events","html_url":"https://github.com/python/mypy/issues/18886","id":2974197326,"node_id":"I_kwDOAGuhRc6xRqZO","number":18886,"title":"Stubgen crashes on dataclass field","user":{"login":"KapJI","id":3767331,"node_id":"MDQ6VXNlcjM3NjczMzE=","avatar_url":"https://avatars.githubusercontent.com/u/3767331?v=4","gravatar_id":"","url":"https://api.github.com/users/KapJI","html_url":"https://github.com/KapJI","followers_url":"https://api.github.com/users/KapJI/followers","following_url":"https://api.github.com/users/KapJI/following{/other_user}","gists_url":"https://api.github.com/users/KapJI/gists{/gist_id}","starred_url":"https://api.github.com/users/KapJI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KapJI/subscriptions","organizations_url":"https://api.github.com/users/KapJI/orgs","repos_url":"https://api.github.com/users/KapJI/repos","events_url":"https://api.github.com/users/KapJI/events{/privacy}","received_events_url":"https://api.github.com/users/KapJI/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null},{"id":3201597398,"node_id":"MDU6TGFiZWwzMjAxNTk3Mzk4","url":"https://api.github.com/repos/python/mypy/labels/topic-stubgen","name":"topic-stubgen","color":"bfd4f2","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-04-05T13:18:23Z","updated_at":"2025-05-19T14:14:01Z","closed_at":"2025-05-19T14:14:01Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\n  Use this form only if mypy reports an \"INTERNAL ERROR\" and/or gives a traceback.\n  Please include the traceback and all other messages below (use `mypy --show-traceback`).\n-->\n\n**Crash Report**\n\nWhen running stubgen on home assistant codebase on the latest master, it crashes with the following error.\n\n**Traceback**\n\n```\nTraceback (most recent call last):\n  File \".venv/bin/stubgen\", line 10, in <module>\n    sys.exit(main())\n             ~~~~^^\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 1984, in main\n    generate_stubs(options)\n    ~~~~~~~~~~~~~~^^^^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 1787, in generate_stubs\n    generate_stub_for_py_module(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        mod,\n        ^^^^\n    ...<7 lines>...\n        all_modules=all_module_names,\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 1757, in generate_stub_for_py_module\n    mod.ast.accept(gen)\n    ~~~~~~~~~~~~~~^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/nodes.py\", line 361, in accept\n    return visitor.visit_mypy_file(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 504, in visit_mypy_file\n    super().visit_mypy_file(o)\n    ~~~~~~~~~~~~~~~~~~~~~~~^^^\n  File \".venv/lib/python3.13/site-packages/mypy/traverser.py\", line 119, in visit_mypy_file\n    d.accept(self)\n    ~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/nodes.py\", line 1200, in accept\n    return visitor.visit_class_def(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 811, in visit_class_def\n    super().visit_class_def(o)\n    ~~~~~~~~~~~~~~~~~~~~~~~^^^\n  File \".venv/lib/python3.13/site-packages/mypy/traverser.py\", line 155, in visit_class_def\n    o.defs.accept(self)\n    ~~~~~~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/nodes.py\", line 1281, in accept\n    return visitor.visit_block(self)\n           ~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 906, in visit_block\n    super().visit_block(o)\n    ~~~~~~~~~~~~~~~~~~~^^^\n  File \".venv/lib/python3.13/site-packages/mypy/traverser.py\", line 123, in visit_block\n    s.accept(self)\n    ~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/nodes.py\", line 1368, in accept\n    return visitor.visit_assignment_stmt(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 943, in visit_assignment_stmt\n    init = self.get_init(item.name, o.rvalue, annotation)\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 1254, in get_init\n    initializer = self.get_assign_initializer(rvalue)\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 1275, in get_assign_initializer\n    return f\" = {rvalue.accept(p)}\"\n                 ~~~~~~~~~~~~~^^^\n  File \".venv/lib/python3.13/site-packages/mypy/nodes.py\", line 1990, in accept\n    return visitor.visit_call_expr(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/stubgen.py\", line 296, in visit_call_expr\n    args.append(f\"{name}={arg.accept(self)}\")\n                          ~~~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/nodes.py\", line 2071, in accept\n    return visitor.visit_unary_expr(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \".venv/lib/python3.13/site-packages/mypy/visitor.py\", line 527, in visit_unary_expr\n    raise NotImplementedError()\nNotImplementedError\n```\n\n**To Reproduce**\n\n```python3\nfrom dataclasses import dataclass, field\n\n@dataclass\nclass ClassName:\n    field_name: float = field(default=-1, init=False)\n```\n\n**Your Environment**\n\n<!-- Include as many relevant details about the environment you experienced the bug in -->\n\n- Mypy version used: `67b70ce00ee9f2da1c49e75a044aad7ab7c137ff`\n- Mypy command-line flags: `stubgen test.py`\n- Mypy configuration options from `mypy.ini` (and other config files):\n- Python version used: 3.13.2\n- Operating system and version: Linux, MacOS\n\n<!--\nYou can freely edit this text, please remove all the lines\nyou believe are unnecessary.\n-->\n","closed_by":{"login":"sobolevn","id":4660275,"node_id":"MDQ6VXNlcjQ2NjAyNzU=","avatar_url":"https://avatars.githubusercontent.com/u/4660275?v=4","gravatar_id":"","url":"https://api.github.com/users/sobolevn","html_url":"https://github.com/sobolevn","followers_url":"https://api.github.com/users/sobolevn/followers","following_url":"https://api.github.com/users/sobolevn/following{/other_user}","gists_url":"https://api.github.com/users/sobolevn/gists{/gist_id}","starred_url":"https://api.github.com/users/sobolevn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sobolevn/subscriptions","organizations_url":"https://api.github.com/users/sobolevn/orgs","repos_url":"https://api.github.com/users/sobolevn/repos","events_url":"https://api.github.com/users/sobolevn/events{/privacy}","received_events_url":"https://api.github.com/users/sobolevn/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/18886/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/18886/timeline","performed_via_github_app":null,"state_reason":"completed"}