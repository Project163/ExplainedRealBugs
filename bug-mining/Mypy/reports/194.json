{"url":"https://api.github.com/repos/python/mypy/issues/13757","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/13757/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/13757/comments","events_url":"https://api.github.com/repos/python/mypy/issues/13757/events","html_url":"https://github.com/python/mypy/issues/13757","id":1390029747,"node_id":"I_kwDOAGuhRc5S2iuz","number":13757,"title":"follow_imports doesn't take affect for \"spurious duplicate modules\"","user":{"login":"sjschaff","id":3375437,"node_id":"MDQ6VXNlcjMzNzU0Mzc=","avatar_url":"https://avatars.githubusercontent.com/u/3375437?v=4","gravatar_id":"","url":"https://api.github.com/users/sjschaff","html_url":"https://github.com/sjschaff","followers_url":"https://api.github.com/users/sjschaff/followers","following_url":"https://api.github.com/users/sjschaff/following{/other_user}","gists_url":"https://api.github.com/users/sjschaff/gists{/gist_id}","starred_url":"https://api.github.com/users/sjschaff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sjschaff/subscriptions","organizations_url":"https://api.github.com/users/sjschaff/orgs","repos_url":"https://api.github.com/users/sjschaff/repos","events_url":"https://api.github.com/users/sjschaff/events{/privacy}","received_events_url":"https://api.github.com/users/sjschaff/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-09-28T22:51:22Z","updated_at":"2022-09-29T00:52:14Z","closed_at":"2022-09-29T00:52:14Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form instead.\r\nPlease consider:\r\n\r\n- checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n- searching our issue tracker: https://github.com/python/mypy/issues to see if it's already been reported\r\n- asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\nI'm currently attempting to run mypy on a new project I'm setting up for my company.  It has a dependency on a shared module which in its current state is not ready for type checking.  Ideally I could just have mypy ignore that module, however I'm having some difficulty due to a perhaps somewhat unusual structure (described below).  Fundamentally, the issue is a file named 'config.py' next to a directory name 'config' in the same location.  This causes mypy to read the wrong \"submodule\", which would be fine for now, if not for that fact that it also cannot be ignored with follow_imports=skip. This results in an error in my project\r\n`error: Module \"shared_module.config\" has no attribute \"CONFIG\"`\r\n\r\n<!--\r\nIf you're reporting a problem with a specific library function, the typeshed tracker is better suited for this report: https://github.com/python/typeshed/issues\r\n\r\nIf the project you encountered the issue in is open source, please provide a link to the project.\r\n-->\r\n\r\n\r\n**To Reproduce**\r\n\r\n[mypy-repro.zip](https://github.com/python/mypy/files/9669337/mypy-repro.zip)\r\n\r\nI've attached a minimal repro project, but here is a summary:\r\nProject Structure\r\n- project\r\n  - my_module\r\n    - mypy.ini \r\n    - this_breaks.py\r\n    - this_works.py\r\n  - shared_module\r\n    - config (not a submodule, no python code here)\r\n      - a.json\r\n      - b.json\r\n      - _etc._ \r\n    - config.py\r\n    - foobar.py\r\n \r\nconfig.py\r\n```python\r\nCONFIG = {'foo': 'bar'}\r\n```\r\nfoobar.py (empty file)\r\n\r\nthis_breaks.py\r\n```python\r\nfrom shared_module.config import CONFIG\r\n```\r\n\r\nthis_works.py\r\n```python\r\nfrom shared_module.foobar import DOESNT_EXIST\r\n```\r\n\r\nmypy.ini\r\n```ini\r\n[mypy]\r\nmypy_path = $MYPY_CONFIG_FILE_DIR/../\r\nnamespace_packages = True\r\n\r\n[mypy-shared_module.*]\r\nfollow_imports = skip\r\n```\r\n**Expected Behavior**\r\nMypy sees the import `from shared_module.config import CONFIG`, treats it as Any, and moves along\r\nMypy sees the import `from shared_module.foobar import DOESNT_EXIST`, treats it as Any, and moves along\r\n\r\n<!--\r\nHow did you expect mypy to behave? It’s fine if you’re not sure your understanding is correct.\r\nWrite down what you thought would happen. If you expected no errors, delete this section.\r\n-->\r\n\r\n**Actual Behavior**\r\nMypy sees the import `from shared_module.foobar import DOESNT_EXIST`, treats it as Any, and moves along **exactly what I was hoping for** (sanity checks that my ini file is setup correctly, obviously wont actually run in python)\r\n\r\nMypy sees the import `from shared_module.config import CONFIG`, **does not ignore it**, and additionally attempts to find CONFIG in the config folder, rather than config.py (The python interpreter correctly imports from config.py)\r\nboth are problems, but the former (not ignoring my import) is my primary concern for now.\r\n\r\nI have also tried these to no avail\r\n```ini\r\n[mypy-shared_module.config]\r\n[mypy-shared_module.config.*]\r\n```\r\nIn the short term, I can use # type: ignore on my imports but this is far from ideal\r\n\r\n<!-- What went wrong? Paste mypy's output. -->\r\n```bash\r\n$ mypy this_works.py\r\nSuccess: no issues found in 1 source file\r\n\r\n$ mypy this_breaks.py\r\nthis_breaks.py:1: error: Module \"shared_module.config\" has no attribute \"CONFIG\"\r\nFound 1 error in 1 file (checked 1 source file)\r\n```\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\nmacOS 12.6, conda \r\n\r\n- Mypy version used: 0.91, 0.981\r\n- Mypy command-line flags: (none, see ini file)\r\n- Mypy configuration options from `mypy.ini` (and other config files): (see above)\r\n- Python version used: 3.8.8, 3.8.13\r\n\r\n<!-- You can freely edit this text, please remove all the lines you believe are unnecessary. -->\r\n","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/13757/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/13757/timeline","performed_via_github_app":null,"state_reason":"completed"}