{"url":"https://api.github.com/repos/python/mypy/issues/15060","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/15060/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/15060/comments","events_url":"https://api.github.com/repos/python/mypy/issues/15060/events","html_url":"https://github.com/python/mypy/issues/15060","id":1669691586,"node_id":"I_kwDOAGuhRc5jhXjC","number":15060,"title":"Crash type-checking overloaded function","user":{"login":"evhub","id":1337598,"node_id":"MDQ6VXNlcjEzMzc1OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1337598?v=4","gravatar_id":"","url":"https://api.github.com/users/evhub","html_url":"https://github.com/evhub","followers_url":"https://api.github.com/users/evhub/followers","following_url":"https://api.github.com/users/evhub/following{/other_user}","gists_url":"https://api.github.com/users/evhub/gists{/gist_id}","starred_url":"https://api.github.com/users/evhub/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evhub/subscriptions","organizations_url":"https://api.github.com/users/evhub/orgs","repos_url":"https://api.github.com/users/evhub/repos","events_url":"https://api.github.com/users/evhub/events{/privacy}","received_events_url":"https://api.github.com/users/evhub/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-04-16T05:34:33Z","updated_at":"2023-05-02T13:36:22Z","closed_at":"2023-05-02T13:36:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  Use this form only if mypy reports an \"INTERNAL ERROR\" and/or gives a traceback.\r\n  Please include the traceback and all other messages below (use `mypy --show-traceback`).\r\n-->\r\n\r\n**Crash Report**\r\n\r\nCrash typing code that previously on older mypy versions worked fine. Not sure exactly how old the last working mypy version is for this, though (I think the release that broke this would have had to have been some time around January 2023).\r\n\r\n**Traceback**\r\n\r\n```\r\nfmap_mypy_test.py:46: error: INTERNAL ERROR -- Please try using mypy master on GitHub:\r\nhttps://mypy.readthedocs.io/en/stable/common_issues.html#using-a-development-mypy-build\r\nPlease report a bug at https://github.com/python/mypy/issues\r\nversion: 1.2.0\r\nTraceback (most recent call last):\r\n  File \"C:\\Program Files\\Python39\\lib\\runpy.py\", line 197, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"C:\\Program Files\\Python39\\lib\\runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"mypy\\checkexpr.py\", line 4885, in accept\r\n  File \"mypy\\nodes.py\", line 2032, in accept\r\n  File \"mypy\\checkexpr.py\", line 2917, in visit_op_expr\r\n  File \"mypy\\checkexpr.py\", line 3486, in check_op\r\n  File \"mypy\\checkexpr.py\", line 3408, in check_op_reversible\r\n  File \"mypy\\checkexpr.py\", line 3267, in check_method_call\r\n  File \"mypy\\checkexpr.py\", line 1303, in check_call\r\n  File \"mypy\\checkexpr.py\", line 2252, in check_overload_call\r\n  File \"mypy\\checkexpr.py\", line 2406, in infer_overload_return_type\r\n  File \"mypy\\checkexpr.py\", line 1292, in check_call\r\n  File \"mypy\\checkexpr.py\", line 1432, in check_callable_call\r\n  File \"mypy\\expandtype.py\", line 148, in freshen_function_type_vars\r\n  File \"mypy\\expandtype.py\", line 77, in expand_type\r\n  File \"mypy\\types.py\", line 1869, in accept\r\n  File \"mypy\\expandtype.py\", line 418, in visit_callable_type\r\n  File \"mypy\\types.py\", line 1357, in accept\r\n  File \"mypy\\expandtype.py\", line 230, in visit_instance\r\n  File \"mypy\\expandtype.py\", line 458, in expand_types_with_unpack\r\n  File \"mypy\\types.py\", line 2656, in accept\r\n  File \"mypy\\expandtype.py\", line 484, in visit_union_type\r\n  File \"mypy\\expandtype.py\", line 516, in expand_types\r\n  File \"mypy\\types.py\", line 1206, in accept\r\n  File \"mypy\\expandtype.py\", line 221, in visit_erased_type\r\nRuntimeError:\r\nfmap_mypy_test.py:46: : note: use --pdb to drop into pdb\r\n```\r\n\r\n**To Reproduce**\r\n\r\nI was able to isolate the error down to just a relatively small code snippet. Just run `mypy` on https://gist.github.com/evhub/10d62ee526dddb9c9b27ad8c4632e32d to reproduce. Lines marked \"OFFENDING LINES\" are the ones that seem to be causing the error.\r\n\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: 1.2.0\r\n- Mypy command-line flags: just `--show-traceback`\r\n- Mypy configuration options from `mypy.ini` (and other config files): None\r\n- Python version used: 3.9.7\r\n- Operating system and version: Windows 10\r\n\r\n<!--\r\nYou can freely edit this text, please remove all the lines\r\nyou believe are unnecessary.\r\n-->\r\n","closed_by":{"login":"JukkaL","id":1107911,"node_id":"MDQ6VXNlcjExMDc5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1107911?v=4","gravatar_id":"","url":"https://api.github.com/users/JukkaL","html_url":"https://github.com/JukkaL","followers_url":"https://api.github.com/users/JukkaL/followers","following_url":"https://api.github.com/users/JukkaL/following{/other_user}","gists_url":"https://api.github.com/users/JukkaL/gists{/gist_id}","starred_url":"https://api.github.com/users/JukkaL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JukkaL/subscriptions","organizations_url":"https://api.github.com/users/JukkaL/orgs","repos_url":"https://api.github.com/users/JukkaL/repos","events_url":"https://api.github.com/users/JukkaL/events{/privacy}","received_events_url":"https://api.github.com/users/JukkaL/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/15060/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/15060/timeline","performed_via_github_app":null,"state_reason":"completed"}