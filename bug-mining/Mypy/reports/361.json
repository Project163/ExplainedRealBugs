{"url":"https://api.github.com/repos/python/mypy/issues/15975","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/15975/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/15975/comments","events_url":"https://api.github.com/repos/python/mypy/issues/15975/events","html_url":"https://github.com/python/mypy/issues/15975","id":1868874042,"node_id":"I_kwDOAGuhRc5vZME6","number":15975,"title":"attrs & dataclasses false positive error with slots=True when subclassing from non-slots base class","user":{"login":"Hnasar","id":463274,"node_id":"MDQ6VXNlcjQ2MzI3NA==","avatar_url":"https://avatars.githubusercontent.com/u/463274?v=4","gravatar_id":"","url":"https://api.github.com/users/Hnasar","html_url":"https://github.com/Hnasar","followers_url":"https://api.github.com/users/Hnasar/followers","following_url":"https://api.github.com/users/Hnasar/following{/other_user}","gists_url":"https://api.github.com/users/Hnasar/gists{/gist_id}","starred_url":"https://api.github.com/users/Hnasar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hnasar/subscriptions","organizations_url":"https://api.github.com/users/Hnasar/orgs","repos_url":"https://api.github.com/users/Hnasar/repos","events_url":"https://api.github.com/users/Hnasar/events{/privacy}","received_events_url":"https://api.github.com/users/Hnasar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-08-28T03:07:37Z","updated_at":"2023-08-28T08:03:51Z","closed_at":"2023-08-28T08:03:51Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form instead.\r\nPlease consider:\r\n\r\n- checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n- searching our issue tracker: https://github.com/python/mypy/issues to see if it's already been reported\r\n- asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\n\r\n<!--\r\nIf you're reporting a problem with a specific library function, the typeshed tracker is better suited for this report: https://github.com/python/typeshed/issues\r\n\r\nIf the project you encountered the issue in is open source, please provide a link to the project.\r\n-->\r\n\r\nWith `attrs.define(slots=True)` and `dataclass(slots=True)`, if the base class doesn't use `__slots__`  then mypy shouldn't error when assigning new attributes to the instance. \r\n\r\n\r\n\r\n**To Reproduce**\r\n\r\n```python\r\nimport attrs\r\n@attrs.define(slots=True)\r\nclass AttrEx(Exception):\r\n    def __init__(self, other_exception: Exception) -> None:\r\n        self.__traceback__ = other_exception.__traceback__  # should not error\r\n\r\n\r\nimport dataclasses\r\n@dataclasses.dataclass(slots=True)\r\nclass DataclassEx(Exception):\r\n    def __init__(self, other_exception: Exception) -> None:\r\n        self.__traceback__ = other_exception.__traceback__  # should not error\r\n\r\nclass SlotsEx(Exception):\r\n    __slots__ = (\"foo\",)\r\n    def __init__(self, other_exception: Exception) -> None:\r\n        self.__traceback__ = other_exception.__traceback__  # correctly doesn't error\r\n```\r\nhttps://mypy-play.net/?mypy=latest&python=3.11&gist=9abddb20dc0419557e8bc07c93e41d25\r\n\r\n**Expected Behavior**\r\n\r\n<!--\r\nHow did you expect mypy to behave? It’s fine if you’re not sure your understanding is correct.\r\nWrite down what you thought would happen. If you expected no errors, delete this section.\r\n-->\r\n\r\nNo error, since this is fine at runtime (and mypy correctly doesn't error for classes which manually define slots (and don't use attrs or dataclasses).\r\n\r\n> When inheriting from a class without __slots__, the [__dict__](https://docs.python.org/3/library/stdtypes.html#object.__dict__) and __weakref__ attribute of the instances will always be accessible.\r\n> https://docs.python.org/3/reference/datamodel.html#slots\r\n\r\n\r\n\r\n**Actual Behavior**\r\n\r\n<!-- What went wrong? Paste mypy's output. -->\r\n```\r\nfoo.py:7: error: Trying to assign name \"__traceback__\" that is not in \"__slots__\" of type \"foo.AttrEx\"  [misc]\r\nfoo.py:16: error: Trying to assign name \"__traceback__\" that is not in \"__slots__\" of type \"foo.DataclassEx\"  [misc]\r\nFound 2 errors in 1 file (checked 1 source file)\r\n```\r\n\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: `mypy 1.6.0+dev.d7b24514d7301f86031b7d1e2215cf8c2476bec0 (compiled: no)` but this behavior is also present in 1.2 (if not earlier)\r\n\r\n\r\n<!-- You can freely edit this text, please remove all the lines you believe are unnecessary. -->\r\n","closed_by":{"login":"sobolevn","id":4660275,"node_id":"MDQ6VXNlcjQ2NjAyNzU=","avatar_url":"https://avatars.githubusercontent.com/u/4660275?v=4","gravatar_id":"","url":"https://api.github.com/users/sobolevn","html_url":"https://github.com/sobolevn","followers_url":"https://api.github.com/users/sobolevn/followers","following_url":"https://api.github.com/users/sobolevn/following{/other_user}","gists_url":"https://api.github.com/users/sobolevn/gists{/gist_id}","starred_url":"https://api.github.com/users/sobolevn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sobolevn/subscriptions","organizations_url":"https://api.github.com/users/sobolevn/orgs","repos_url":"https://api.github.com/users/sobolevn/repos","events_url":"https://api.github.com/users/sobolevn/events{/privacy}","received_events_url":"https://api.github.com/users/sobolevn/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/15975/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/15975/timeline","performed_via_github_app":null,"state_reason":"completed"}