{"url":"https://api.github.com/repos/python/mypy/issues/13574","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/13574/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/13574/comments","events_url":"https://api.github.com/repos/python/mypy/issues/13574/events","html_url":"https://github.com/python/mypy/issues/13574","id":1358206284,"node_id":"I_kwDOAGuhRc5Q9JVM","number":13574,"title":"stubgenc.py does not generate correct lines for staticmethods","user":{"login":"EzioHelios","id":78869679,"node_id":"MDQ6VXNlcjc4ODY5Njc5","avatar_url":"https://avatars.githubusercontent.com/u/78869679?v=4","gravatar_id":"","url":"https://api.github.com/users/EzioHelios","html_url":"https://github.com/EzioHelios","followers_url":"https://api.github.com/users/EzioHelios/followers","following_url":"https://api.github.com/users/EzioHelios/following{/other_user}","gists_url":"https://api.github.com/users/EzioHelios/gists{/gist_id}","starred_url":"https://api.github.com/users/EzioHelios/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EzioHelios/subscriptions","organizations_url":"https://api.github.com/users/EzioHelios/orgs","repos_url":"https://api.github.com/users/EzioHelios/repos","events_url":"https://api.github.com/users/EzioHelios/events{/privacy}","received_events_url":"https://api.github.com/users/EzioHelios/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":3201597398,"node_id":"MDU6TGFiZWwzMjAxNTk3Mzk4","url":"https://api.github.com/repos/python/mypy/labels/topic-stubgen","name":"topic-stubgen","color":"bfd4f2","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-09-01T03:47:47Z","updated_at":"2024-01-08T09:08:34Z","closed_at":"2024-01-08T09:08:34Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Bug Report**\r\n\r\nWhen I use stubgen to generate stub file for a pybind11 module\r\n\r\n```cpp\r\nklass\r\n.def_static(\"some_static_method\", &A::some_static_method,\r\n    R\"#(None)#\", py::arg(\"a\"), py::arg(\"b\")\r\n    );\r\n```\r\nwhere `pybind11::class_ klass` is bound to C++ `class A`\r\n\r\nthe result line is like:\r\n\r\n```python\r\nclass A:\r\n    def some_static_method(self, *args, **kwargs): ...\r\n```\r\n\r\nwhich should be like:\r\n\r\n```python\r\nclass A:\r\n    @static_method\r\n    def some_static_method(a: T, b: T): ...\r\n```\r\n\r\nThe issue here is related to a pybind11 discussion: [https://github.com/pybind/pybind11/issues/2403].\r\nwhich says \"a static method of class Foo, Foo.__dict__['f_static'] points to the static method decorator around the function object instead, not the function object itself\"\r\n\r\nSo, I temporarily fixed this issue for my own project by appending a staticmethod checker right after the `is_c_classmethod` in file stubgenc.py:\r\n\r\n```python\r\ndef is_c_staticmethod(obj: object) -> bool:\r\n    return type(obj).__name__ in ('staticmethod')\r\n```\r\n\r\n```python\r\ndef generate_c_type_stub(module: ModuleType,\r\n                         class_name: str,\r\n                         obj: type,\r\n                         output: List[str],\r\n                         imports: List[str],\r\n                         sigs: Optional[Dict[str, str]] = None,\r\n                         class_sigs: Optional[Dict[str, str]] = None) -> None:\r\n                ...\r\n                if is_c_classmethod(value):\r\n                    methods.append('@classmethod')\r\n                    self_var = 'cls'\r\n                elif is_c_staticmethod(value):\r\n                    methods.append('@staticmethod')\r\n                    value = value.__func__\r\n                    self_var = None\r\n                else:\r\n                    self_var = 'self'\r\n                ...\r\n```\r\nThe result turns out correct with my pybind11 code. But I guess it may not work for other conditions?\r\n\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/13574/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/13574/timeline","performed_via_github_app":null,"state_reason":"completed"}