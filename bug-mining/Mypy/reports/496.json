{"url":"https://api.github.com/repos/python/mypy/issues/12692","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/12692/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/12692/comments","events_url":"https://api.github.com/repos/python/mypy/issues/12692/events","html_url":"https://github.com/python/mypy/issues/12692","id":1219144790,"node_id":"I_kwDOAGuhRc5IqqxW","number":12692,"title":"Error when displaying error that contains unicode characters in Windows","user":{"login":"aleloi","id":16827347,"node_id":"MDQ6VXNlcjE2ODI3MzQ3","avatar_url":"https://avatars.githubusercontent.com/u/16827347?v=4","gravatar_id":"","url":"https://api.github.com/users/aleloi","html_url":"https://github.com/aleloi","followers_url":"https://api.github.com/users/aleloi/followers","following_url":"https://api.github.com/users/aleloi/following{/other_user}","gists_url":"https://api.github.com/users/aleloi/gists{/gist_id}","starred_url":"https://api.github.com/users/aleloi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aleloi/subscriptions","organizations_url":"https://api.github.com/users/aleloi/orgs","repos_url":"https://api.github.com/users/aleloi/repos","events_url":"https://api.github.com/users/aleloi/events{/privacy}","received_events_url":"https://api.github.com/users/aleloi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null},{"id":608992726,"node_id":"MDU6TGFiZWw2MDg5OTI3MjY=","url":"https://api.github.com/repos/python/mypy/labels/topic-usability","name":"topic-usability","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-04-28T18:58:58Z","updated_at":"2025-04-30T17:37:15Z","closed_at":"2024-12-14T16:38:05Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  If you're new to mypy and you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form\r\n  instead.\r\n  Please also consider:\r\n\r\n  - checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n  - searching our issue tracker: https://github.com/python/mypy/issues to see if\r\n    it's already been reported\r\n  - asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\n\r\n<!--\r\nNote: If the problem you are reporting is about a specific library function, then the typeshed tracker is better suited\r\nfor this report: https://github.com/python/typeshed/issues\r\n-->\r\n\r\nWhen displaying a type error about e.g. a variable that contains unicode characters, mypy crashes.\r\n\r\n**To Reproduce**\r\n1. Make a file `file.py` containing the line `x=γ`. \r\n2. Run `mypy.exe --show-column-numbers file.py` through flycheck (python-mypy) in Emacs \r\n\r\n**Expected Behavior**\r\nAn error message like `file.py:1:5: error: Name \"γ\" is not defined`\r\n\r\n<!--\r\n  How did you expect your project to behave?\r\n  It’s fine if you’re not sure your understanding is correct.\r\n  Write down what you thought would happen. If you just expected no errors, you can delete this section.\r\n-->\r\n\r\n**Actual Behavior**\r\nIt crashes and prints a stack trace:\r\n```\r\nFile \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Python39_64\\lib\\runpy.py\", line 197, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Python39_64\\lib\\runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"c:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Python39_64\\Scripts\\mypy.exe\\__main__.py\", line 7, in <module>\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Python39_64\\lib\\site-packages\\mypy\\__main__.py\", line 15, in console_entry\r\n    main(None, sys.stdout, sys.stderr)\r\n  File \"mypy\\main.py\", line 96, in main\r\n  File \"mypy\\main.py\", line 173, in run_build\r\n  File \"mypy\\build.py\", line 180, in build\r\n  File \"mypy\\build.py\", line 256, in _build\r\n  File \"mypy\\build.py\", line 2717, in dispatch\r\n  File \"mypy\\build.py\", line 3048, in process_graph\r\n  File \"mypy\\build.py\", line 3164, in process_stale_scc\r\n  File \"mypy\\main.py\", line 165, in flush_errors\r\n  File \"mypy\\main.py\", line 199, in show_messages\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Python39_64\\lib\\encodings\\cp1252.py\", line 19, in encode\r\n    return codecs.charmap_encode(input,self.errors,encoding_table)[0]\r\nUnicodeEncodeError: 'charmap' codec can't encode character '\\u03b3' in position 33: character maps to <undefined>\r\n```\r\n\r\nI've fixed it locally by adding \r\n```\r\nsys.stdout.reconfigure(encoding='utf-8')\r\nsys.stderr.reconfigure(encoding='utf-8')\r\n```\r\n\r\nin `mypy/__main__.py`. It works for me, but I don't know whether it's the right thing for mypy. \r\n\r\n\r\n<!--\r\n  Did something go wrong?\r\n  Is something broken, or not behaving as you expected?\r\n-->\r\n\r\n**Your Environment**\r\n\r\nPython 3.9.7, mypy 0.931 on Windows\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: 0.931\r\n- Mypy command-line flags: --show-column-numbers\r\n- Mypy configuration options from `mypy.ini` (and other config files): None, I think\r\n- Python version used:  3.9.7\r\n- Operating system and version: Windows 11\r\n\r\n<!--\r\nYou can freely edit this text, please remove all the lines\r\nyou believe are unnecessary.\r\n-->\r\n","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/12692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/12692/timeline","performed_via_github_app":null,"state_reason":"completed"}