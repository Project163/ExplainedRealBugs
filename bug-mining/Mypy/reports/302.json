{"url":"https://api.github.com/repos/python/mypy/issues/14912","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/14912/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/14912/comments","events_url":"https://api.github.com/repos/python/mypy/issues/14912/events","html_url":"https://github.com/python/mypy/issues/14912","id":1627966582,"node_id":"I_kwDOAGuhRc5hCMx2","number":14912,"title":"mypy failed to narrow down union types including `Self` with `isinstance`","user":{"login":"mon-jai","id":91261297,"node_id":"MDQ6VXNlcjkxMjYxMjk3","avatar_url":"https://avatars.githubusercontent.com/u/91261297?v=4","gravatar_id":"","url":"https://api.github.com/users/mon-jai","html_url":"https://github.com/mon-jai","followers_url":"https://api.github.com/users/mon-jai/followers","following_url":"https://api.github.com/users/mon-jai/following{/other_user}","gists_url":"https://api.github.com/users/mon-jai/gists{/gist_id}","starred_url":"https://api.github.com/users/mon-jai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mon-jai/subscriptions","organizations_url":"https://api.github.com/users/mon-jai/orgs","repos_url":"https://api.github.com/users/mon-jai/repos","events_url":"https://api.github.com/users/mon-jai/events{/privacy}","received_events_url":"https://api.github.com/users/mon-jai/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":427181007,"node_id":"MDU6TGFiZWw0MjcxODEwMDc=","url":"https://api.github.com/repos/python/mypy/labels/topic-type-variables","name":"topic-type-variables","color":"0052cc","default":false,"description":null},{"id":3945357842,"node_id":"LA_kwDOAGuhRc7rKWIS","url":"https://api.github.com/repos/python/mypy/labels/topic-self-types","name":"topic-self-types","color":"d4c5f9","default":false,"description":"Types for self"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-03-16T17:33:13Z","updated_at":"2023-03-25T22:14:05Z","closed_at":"2023-03-25T22:14:05Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form instead.\r\nPlease consider:\r\n\r\n- checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n- searching our issue tracker: https://github.com/python/mypy/issues to see if it's already been reported\r\n- asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\n\r\n<!--\r\nIf you're reporting a problem with a specific library function, the typeshed tracker is better suited for this report: https://github.com/python/typeshed/issues\r\n\r\nIf the project you encountered the issue in is open source, please provide a link to the project.\r\n-->\r\n\r\nmypy failed to narrow down union types including `Self` with `isinstance`.\r\n\r\n**To Reproduce**\r\n\r\nConsider the following code:\r\n\r\n```python\r\nfrom dataclasses import dataclass\r\nfrom typing import Self, reveal_type\r\n\r\n\r\n@dataclass\r\nclass Foo:\r\n    i: int\r\n\r\n    def bar(self, other: Self | int) -> int:\r\n        if isinstance(other, Foo):\r\n            return self.i * other.i\r\n        else:\r\n            reveal_type(other)  # \"int\" expected, gets \"Self | int\"\r\n            return self.i * other # Unsupported operand types for * (\"int\" and \"Self\")  [operator]mypy(error)\r\n\r\n```\r\n\r\n**Expected Behavior**\r\n\r\n<!--\r\nHow did you expect mypy to behave? It’s fine if you’re not sure your understanding is correct.\r\nWrite down what you thought would happen. If you expected no errors, delete this section.\r\n-->\r\n\r\nOther should be infered as an `int` and mypy reports no error.\r\n\r\n**Actual Behavior**\r\n\r\n<!-- What went wrong? Paste mypy's output. -->\r\n\r\nmypy failed to narrow type of `other`\r\n\r\n```\r\nRevealed type is \"Union[Self`0, builtins.int]\"mypy(note)\r\n```\r\n\r\nAlso, mypy reports the following error.\r\n\r\n```\r\nUnsupported operand types for * (\"int\" and \"Self\")  [operator]mypy(error)\r\n```\r\n\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: 1.1.1\r\n- Mypy command-line flags: `--follow-imports=silent --ignore-missing-imports --show-column-numbers --no-pretty` (VSCode defaults)\r\n- Mypy configuration options from `mypy.ini` (and other config files): None\r\n- Python version used: 3.11.1\r\n\r\n<!-- You can freely edit this text, please remove all the lines you believe are unnecessary. -->\r\n","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/14912/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/14912/timeline","performed_via_github_app":null,"state_reason":"completed"}