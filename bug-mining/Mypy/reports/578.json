{"url":"https://api.github.com/repos/python/mypy/issues/19139","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/19139/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/19139/comments","events_url":"https://api.github.com/repos/python/mypy/issues/19139/events","html_url":"https://github.com/python/mypy/issues/19139","id":3087054619,"node_id":"I_kwDOAGuhRc64ALcb","number":19139,"title":"[1.16 regression] narrowing on is_dataclass","user":{"login":"henryiii","id":4616906,"node_id":"MDQ6VXNlcjQ2MTY5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/4616906?v=4","gravatar_id":"","url":"https://api.github.com/users/henryiii","html_url":"https://github.com/henryiii","followers_url":"https://api.github.com/users/henryiii/followers","following_url":"https://api.github.com/users/henryiii/following{/other_user}","gists_url":"https://api.github.com/users/henryiii/gists{/gist_id}","starred_url":"https://api.github.com/users/henryiii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henryiii/subscriptions","organizations_url":"https://api.github.com/users/henryiii/orgs","repos_url":"https://api.github.com/users/henryiii/repos","events_url":"https://api.github.com/users/henryiii/events{/privacy}","received_events_url":"https://api.github.com/users/henryiii/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":3945317421,"node_id":"LA_kwDOAGuhRc7rKMQt","url":"https://api.github.com/repos/python/mypy/labels/topic-typeguard-typeis","name":"topic-typeguard-typeis","color":"b60205","default":false,"description":"TypeGuard / TypeIs / PEP 647 / PEP 742"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2025-05-23T17:30:53Z","updated_at":"2025-06-03T07:37:39Z","closed_at":"2025-06-03T07:37:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\nIf you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form instead.\nPlease consider:\n\n- checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\n- searching our issue tracker: https://github.com/python/mypy/issues to see if it's already been reported\n- asking on gitter chat: https://gitter.im/python/typing\n-->\n\n**Bug Report**\n\n<!--\nIf you're reporting a problem with a specific library function, the typeshed tracker is better suited for this report: https://github.com/python/typeshed/issues\n\nIf the project you encountered the issue in is open source, please provide a link to the project.\n-->\n\nIf you use `isinstance(item, type)`, this used to be used in conjunction with `dataclasses.is_dataclass` to identify types and instances. It's the recommendation in the CPython documentation, in fact: https://docs.python.org/3/library/dataclasses.html#dataclasses.is_dataclass. However, the latests MyPy no longer narrows this correctly (from what I can tell, unless I'm doing something wrong), and still thinks I might have an instance, which then breaks later when creating an instance, etc.\n\nNote that I can flip the order, in which case I just get `builtins.type` for both versions. This isn't enough to fix it for some of the more complex usages in scikit-build-core, though.\n\n**To Reproduce**\n\n```python\nimport dataclasses\n\nraw_target: object\n\nif isinstance(raw_target, type) and dataclasses.is_dataclass(raw_target):\n    reveal_type(raw_target)\n```\n\n**Expected Behavior**\n\n<!--\nHow did you expect mypy to behave? It’s fine if you’re not sure your understanding is correct.\nWrite down what you thought would happen. If you expected no errors, delete this section.\n-->\n\n\nThis is from 1.15:\n\n```\ntmp.py:6: note: Revealed type is \"Type[_typeshed.DataclassInstance]\"\n```\n\n**Actual Behavior**\n\n<!-- What went wrong? Paste mypy's output. -->\n\n```\ntmp.py:6: note: Revealed type is \"Union[_typeshed.DataclassInstance, Type[_typeshed.DataclassInstance]]\"\n```\n\n**Your Environment**\n\n<!-- Include as many relevant details about the environment you experienced the bug in -->\n\n- Mypy version used: `uvx --from git+https://github.com/python/mypy mypy tmp.py` was used, so latest commit, also latest release 1.15 version for comparison.\n- Python version used: 3.13\n\n<!-- You can freely edit this text, please remove all the lines you believe are unnecessary. -->\n\nNoticed in https://github.com/hauntsaninja/mypy_primer/pull/174.\n","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/19139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/19139/timeline","performed_via_github_app":null,"state_reason":"completed"}