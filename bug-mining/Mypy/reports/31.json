{"url":"https://api.github.com/repos/python/mypy/issues/11105","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/11105/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/11105/comments","events_url":"https://api.github.com/repos/python/mypy/issues/11105/events","html_url":"https://github.com/python/mypy/issues/11105","id":995892894,"node_id":"I_kwDOAGuhRc47XB6e","number":11105,"title":"Crashes when running with xmlschema","user":{"login":"gaborbernat","id":690238,"node_id":"MDQ6VXNlcjY5MDIzOA==","avatar_url":"https://avatars.githubusercontent.com/u/690238?v=4","gravatar_id":"","url":"https://api.github.com/users/gaborbernat","html_url":"https://github.com/gaborbernat","followers_url":"https://api.github.com/users/gaborbernat/followers","following_url":"https://api.github.com/users/gaborbernat/following{/other_user}","gists_url":"https://api.github.com/users/gaborbernat/gists{/gist_id}","starred_url":"https://api.github.com/users/gaborbernat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaborbernat/subscriptions","organizations_url":"https://api.github.com/users/gaborbernat/orgs","repos_url":"https://api.github.com/users/gaborbernat/repos","events_url":"https://api.github.com/users/gaborbernat/events{/privacy}","received_events_url":"https://api.github.com/users/gaborbernat/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-09-14T11:12:40Z","updated_at":"2021-09-19T02:28:23Z","closed_at":"2021-09-19T02:28:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  Use this form only if mypy reports an \"INTERNAL ERROR\" and/or gives a traceback.\r\n  Please include the traceback and all other messages below (use `mypy --show-traceback`).\r\n-->\r\n\r\n**Crash Report**\r\n\r\n(Tell us what happened.)\r\n\r\n**Traceback**\r\n\r\n```\r\nversion: 0.920+dev.05f38571f1b7af46dbadaeba0f74626d3a9e07c9\r\n/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/xmlschema/xpath.py:211: : note: use --pdb to drop into pdb\r\nTraceback (most recent call last):\r\n  File \"/Users/git/prj/.tox/4/type/bin/mypy\", line 8, in <module>\r\n    sys.exit(console_entry())\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/__main__.py\", line 11, in console_entry\r\n    main(None, sys.stdout, sys.stderr)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/main.py\", line 87, in main\r\n    res, messages, blockers = run_build(sources, options, fscache, t0, stdout, stderr)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/main.py\", line 165, in run_build\r\n    res = build.build(sources, options, None, flush_errors, fscache, stdout, stderr)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/build.py\", line 179, in build\r\n    result = _build(\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/build.py\", line 254, in _build\r\n    graph = dispatch(sources, manager, stdout)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/build.py\", line 2707, in dispatch\r\n    process_graph(graph, manager)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/build.py\", line 3031, in process_graph\r\n    process_stale_scc(graph, scc, manager)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/build.py\", line 3129, in process_stale_scc\r\n    graph[id].type_check_first_pass()\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/build.py\", line 2175, in type_check_first_pass\r\n    self.type_checker().check_first_pass()\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 303, in check_first_pass\r\n    self.accept(d)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 409, in accept\r\n    stmt.accept(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/nodes.py\", line 959, in accept\r\n    return visitor.visit_class_def(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 1741, in visit_class_def\r\n    self.accept(defn.defs)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 409, in accept\r\n    stmt.accept(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/nodes.py\", line 1024, in accept\r\n    return visitor.visit_block(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 2003, in visit_block\r\n    self.accept(s)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 409, in accept\r\n    stmt.accept(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/nodes.py\", line 696, in accept\r\n    return visitor.visit_func_def(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 741, in visit_func_def\r\n    self._visit_func_def(defn)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 745, in _visit_func_def\r\n    self.check_func_item(defn, name=defn.name)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 807, in check_func_item\r\n    self.check_func_def(defn, typ, name)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 990, in check_func_def\r\n    self.accept(item.body)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 409, in accept\r\n    stmt.accept(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/nodes.py\", line 1024, in accept\r\n    return visitor.visit_block(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 2003, in visit_block\r\n    self.accept(s)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 409, in accept\r\n    stmt.accept(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/nodes.py\", line 1083, in accept\r\n    return visitor.visit_assignment_stmt(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 2045, in visit_assignment_stmt\r\n    self.check_assignment(s.lvalues[-1], s.rvalue, s.type is None, s.new_syntax)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checker.py\", line 2227, in check_assignment\r\n    rvalue_type = self.expr_checker.accept(rvalue)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checkexpr.py\", line 3912, in accept\r\n    typ = node.accept(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/nodes.py\", line 1600, in accept\r\n    return visitor.visit_call_expr(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checkexpr.py\", line 277, in visit_call_expr\r\n    return self.visit_call_expr_inner(e, allow_none_return=allow_none_return)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checkexpr.py\", line 366, in visit_call_expr_inner\r\n    ret_type = self.check_call_expr_with_callee_type(callee_type, e, fullname,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checkexpr.py\", line 873, in check_call_expr_with_callee_type\r\n    return self.check_call(callee_type, e.args, e.arg_kinds, e,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checkexpr.py\", line 933, in check_call\r\n    return self.check_callable_call(callee, args, arg_kinds, context, arg_names,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checkexpr.py\", line 1030, in check_callable_call\r\n    self.check_argument_types(arg_types, arg_kinds, args, callee, formal_to_actual, context,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checkexpr.py\", line 1495, in check_argument_types\r\n    check_arg(expanded_actual, actual_type, arg_kinds[actual],\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/checkexpr.py\", line 1536, in check_arg\r\n    messages.incompatible_argument_note(original_caller_type, callee_type, context,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/messages.py\", line 599, in incompatible_argument_note\r\n    self.report_protocol_problems(original_caller_type, item,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/messages.py\", line 1448, in report_protocol_problems\r\n    conflict_types = get_conflict_protocol_types(subtype, supertype)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/messages.py\", line 2027, in get_conflict_protocol_types\r\n    is_compat = is_subtype(subtype, supertype, ignore_pos_arg_names=True)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/subtypes.py\", line 93, in is_subtype\r\n    return _is_subtype(left, right,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/subtypes.py\", line 118, in _is_subtype\r\n    is_subtype_of_item = any(is_subtype(orig_left, item,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/subtypes.py\", line 118, in <genexpr>\r\n    is_subtype_of_item = any(is_subtype(orig_left, item,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/subtypes.py\", line 93, in is_subtype\r\n    return _is_subtype(left, right,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/subtypes.py\", line 147, in _is_subtype\r\n    return left.accept(SubtypeVisitor(orig_right,\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/types.py\", line 1809, in accept\r\n    return visitor.visit_partial_type(self)\r\n  File \"/Users/git/prj/.tox/4/type/lib/python3.9/site-packages/mypy/subtypes.py\", line 480, in visit_partial_type\r\n    raise RuntimeError\r\nRuntimeError:\r\n```\r\n\r\n**To Reproduce**\r\n\r\nI am running into this in a complex private code, and haven't managed to make a small reproducible yet.\r\n\r\n**Your Environment**\r\n\r\n- Mypy version used: master\r\n- Mypy command-line flags: `mypy --python-version 3.8 --namespace-packages --strict --config-file tox.ini --package pkg --show-traceback`\r\n- Mypy configuration options from `mypy.ini` (and other config files): none.\r\n- Python version used: 3.9.7\r\n- Operating system and version: macOS Catalina\r\n\r\n```\r\n‚ùØ .tox/4/type/bin/pip list\r\nPackage                        Version\r\n------------------------------ --------------------------------------------------\r\nelementpath                    2.3.1\r\nmypy                           0.920+dev.05f38571f1b7af46dbadaeba0f74626d3a9e07c9\r\nmypy-extensions                0.4.3\r\npip                            21.2.4\r\nsetuptools                     57.4.0\r\ntoml                           0.10.2\r\ntomli                          1.1.0\r\ntyping-extensions              3.10.0.2\r\nwheel                          0.37.0\r\nxmlschema                      1.7.1\r\n```\r\n","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/11105/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/11105/timeline","performed_via_github_app":null,"state_reason":"completed"}