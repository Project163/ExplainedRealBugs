{"url":"https://api.github.com/repos/python/mypy/issues/10329","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/10329/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/10329/comments","events_url":"https://api.github.com/repos/python/mypy/issues/10329/events","html_url":"https://github.com/python/mypy/issues/10329","id":858983895,"node_id":"MDU6SXNzdWU4NTg5ODM4OTU=","number":10329,"title":"Handling module names ending with `__init__`","user":{"login":"BoniLindsley","id":14114757,"node_id":"MDQ6VXNlcjE0MTE0NzU3","avatar_url":"https://avatars.githubusercontent.com/u/14114757?v=4","gravatar_id":"","url":"https://api.github.com/users/BoniLindsley","html_url":"https://github.com/BoniLindsley","followers_url":"https://api.github.com/users/BoniLindsley/followers","following_url":"https://api.github.com/users/BoniLindsley/following{/other_user}","gists_url":"https://api.github.com/users/BoniLindsley/gists{/gist_id}","starred_url":"https://api.github.com/users/BoniLindsley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BoniLindsley/subscriptions","organizations_url":"https://api.github.com/users/BoniLindsley/orgs","repos_url":"https://api.github.com/users/BoniLindsley/repos","events_url":"https://api.github.com/users/BoniLindsley/events{/privacy}","received_events_url":"https://api.github.com/users/BoniLindsley/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-04-15T15:13:43Z","updated_at":"2022-08-04T01:32:02Z","closed_at":"2022-08-04T01:32:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Bug Report**\r\n\r\nAttempts to find type hints that import package submodules whose names end with `__init__` seem to prevented. An example being `test/test__init__.py`, with double underscores on both ends.\r\n\r\n**To Reproduce**\r\n\r\nI tried to create a script for this, but roughly, it does the following:\r\n\r\n1. Create a package directory.\r\n2. Create some `*__init__.py` and `__init__.py`. Some other combination of underscores and names can also be checked.\r\n3. Import the former from the latter, using either absolute or relative.\r\n4. Type check the package using mypy.\r\n\r\nA Bash script for this:\r\n\r\n```bash\r\n#!/usr/bin/bash\r\n\r\n# Create a namespace package directory.\r\npackage_name='test'\r\nif [[ -e \"${package_name}\" ]]; then\r\n  printf 'Path %s exists. Needed for tests.\\n' \"$package_name\"\r\n  read -n1 -r \\\r\n    -p 'Press <Y> to remove and remake. Press anything else to abort.' \\\r\n    key\r\n  if [[ 'Y' != \"$key\" ]]; then\r\n    printf 'Aborting. Pressed key was: %s\\n' \"$key\"\r\n    exit 1\r\n  fi\r\n  rm -dfr test\r\nfi\r\nmkdir test\r\n\r\n# Create submodules to import.\r\nmodule_names=(     \\\r\n  'test_init__'    \\\r\n  'test_init___'   \\\r\n  'test__init__'   \\\r\n  'test__init___'  \\\r\n  'test___init__'  \\\r\n  'test___init___' \\\r\n)\r\n# Make up some variables to be imported.\r\nfor name in \"${module_names[@]}\"; do\r\n  printf 'num_%s = 1' \"${name}\" > \"${package_name}/${name}.py\"\r\ndone\r\n\r\n# Relative import of variables.\r\ncat << EOF > \"${package_name}/__init__.py\"\r\nfrom .test_init__ import num_test_init__\r\nfrom .test_init___ import num_test_init___\r\nfrom .test__init__  import num_test__init__ # Errors\r\nfrom .test__init___ import num_test__init___\r\nfrom .test___init__  import num_test___init__ # Errors\r\nfrom .test___init___ import num_test___init___\r\nEOF\r\npython3 -m \"${package_name}.__init__\"  # Loads fine in Python.\r\npython3 -m mypy --config-file= --package \"${package_name}\"\r\n# Output:\r\n# test/__init__.py:3: error: Skipping analyzing 'test.test__init__': found module but no type hints or library stubs\r\n# test/__init__.py:3: note: See https://mypy.readthedocs.io/en/latest/running_mypy.html#missing-imports\r\n# test/__init__.py:5: error: Skipping analyzing 'test.test___init__': found module but no type hints or library stubs\r\n# Found 2 errors in 1 file (checked 5 source files)\r\n```\r\n\r\nRelative imports of modules produce slightly different errors, but they are errors nonetheless.\r\n```bash\r\ncat << EOF > \"${package_name}/__init__.py\"\r\nfrom . import test_init__\r\nfrom . import test_init___\r\nfrom . import test__init__  # Errors\r\nfrom . import test__init___\r\nfrom . import test___init__  # Errors\r\nfrom . import test___init___\r\nEOF\r\npython3 -m \"${package_name}.__init__\"  # Loads fine in Python.\r\npython3 -m mypy --config-file= --package \"${package_name}\"\r\n# Output:\r\n# test/__init__.py:3: error: Module 'test' has no attribute 'test__init__'; maybe \"test__init___\", \"test___init__\", or \"test_init__\"?\r\n# test/__init__.py:5: error: Module 'test' has no attribute 'test___init__'; maybe \"test___init___\", \"test__init__\", or \"test__init___\"?\r\n# Found 2 errors in 1 file (checked 5 source files)\r\n```\r\n\r\nType checking with absolute imports exhibit similar behaviours.\r\n\r\n**Expected Behavior**\r\n\r\nI expected the type checks to pass. I am not aware of module naming restrictions that might restrict this, but there might be some? Naming might be too much of an edge case to support even if not?\r\n\r\n**Actual Behavior**\r\n\r\nOutput from mypy noted at the end of the Bash scripts.\r\n\r\n**Your Environment**\r\n\r\n- Mypy version used: `mypy 0.812` from `python3 -m mypy --version`\r\n- Mypy command-line flags: `python3 -m mypy --config-file= --package \"${package_name}\"`\r\n- Mypy configuration options from `mypy.ini` (and other config files): Not applicable with `--config-file=`.\r\n- Python version used: `Python 3.9.2` from `python3 --version`\r\n- Operating system and version: `Description:    Debian GNU/Linux bullseye/sid` from `lsb_release --description`","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/10329/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/10329/timeline","performed_via_github_app":null,"state_reason":"completed"}