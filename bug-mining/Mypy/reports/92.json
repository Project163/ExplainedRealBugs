{"url":"https://api.github.com/repos/python/mypy/issues/11971","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/11971/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/11971/comments","events_url":"https://api.github.com/repos/python/mypy/issues/11971/events","html_url":"https://github.com/python/mypy/issues/11971","id":1099568212,"node_id":"I_kwDOAGuhRc5BihRU","number":11971,"title":"False positives for \"Attempted to reuse member name in Enum\"","user":{"login":"mrossinek","id":21973473,"node_id":"MDQ6VXNlcjIxOTczNDcz","avatar_url":"https://avatars.githubusercontent.com/u/21973473?v=4","gravatar_id":"","url":"https://api.github.com/users/mrossinek","html_url":"https://github.com/mrossinek","followers_url":"https://api.github.com/users/mrossinek/followers","following_url":"https://api.github.com/users/mrossinek/following{/other_user}","gists_url":"https://api.github.com/users/mrossinek/gists{/gist_id}","starred_url":"https://api.github.com/users/mrossinek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrossinek/subscriptions","organizations_url":"https://api.github.com/users/mrossinek/orgs","repos_url":"https://api.github.com/users/mrossinek/repos","events_url":"https://api.github.com/users/mrossinek/events{/privacy}","received_events_url":"https://api.github.com/users/mrossinek/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":3542345285,"node_id":"LA_kwDOAGuhRc7TI-ZF","url":"https://api.github.com/repos/python/mypy/labels/topic-enum","name":"topic-enum","color":"47988D","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-01-11T20:02:35Z","updated_at":"2022-01-15T20:18:57Z","closed_at":"2022-01-15T20:18:57Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  If you're new to mypy and you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form\r\n  instead.\r\n  Please also consider:\r\n\r\n  - checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n  - searching our issue tracker: https://github.com/python/mypy/issues to see if\r\n    it's already been reported\r\n  - asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\n\r\n<!--\r\nNote: If the problem you are reporting is about a specific library function, then the typeshed tracker is better suited\r\nfor this report: https://github.com/python/typeshed/issues\r\n-->\r\n\r\nFalse positives for Enum member reuse attempts when an Enum has a large number of entries.\r\nI first encountered this issue [here](https://gitlab.com/mrossinek/cobib/-/jobs/1964120222#L192)\r\n\r\n**To Reproduce**\r\n\r\nUnfortunately, I have not yet found a minimal reproducing example.\r\n\r\n1. Clone https://gitlab.com/mrossinek/cobib\r\n2. Run `mypy --strict src/cobib/config/event.py` with `mypy -V >= 0.930`\r\n\r\n**Expected Behavior**\r\n\r\n<!--\r\n  How did you expect your project to behave?\r\n  It’s fine if you’re not sure your understanding is correct.\r\n  Write down what you thought would happen. If you just expected no errors, you can delete this section.\r\n-->\r\n\r\nNo errors should occur.\r\n\r\n**Actual Behavior**\r\n\r\n<!--\r\n  Did something go wrong?\r\n  Is something broken, or not behaving as you expected?\r\n-->\r\n\r\nI obtain the following errors:\r\n```\r\nsrc/cobib/config/event.py:137: error: Attempted to reuse member name \"PostAddCommand\" in Enum definition \"Event\"  [misc]\r\nsrc/cobib/config/event.py:222: error: Attempted to reuse member name \"PostImportCommand\" in Enum definition \"Event\"  [misc]\r\nsrc/cobib/config/event.py:445: error: Attempted to reuse member name \"PostBibtexParse\" in Enum definition \"Event\"  [misc]\r\nsrc/cobib/config/event.py:498: error: Attempted to reuse member name \"PostYAMLParse\" in Enum definition \"Event\"  [misc]\r\nsrc/cobib/config/event.py:551: error: Attempted to reuse member name \"PostArxivParse\" in Enum definition \"Event\"  [misc]\r\nsrc/cobib/config/event.py:578: error: Attempted to reuse member name \"PostDOIParse\" in Enum definition \"Event\"  [misc]\r\nsrc/cobib/config/event.py:605: error: Attempted to reuse member name \"PostISBNParse\" in Enum definition \"Event\"  [misc]\r\nsrc/cobib/config/event.py:632: error: Attempted to reuse member name \"PostURLParse\" in Enum definition \"Event\"  [misc]\r\nsrc/cobib/config/event.py:663: error: Attempted to reuse member name \"PostZoteroImport\" in Enum definition \"Event\"  [misc]\r\n```\r\n\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: 0.930 and 0.931\r\n- Mypy command-line flags: `--strict`\r\n- Mypy configuration options from `mypy.ini` (and other config files):\r\n```\r\n[mypy]\r\npython_version = 3.7\r\nshow_error_codes = True\r\nwarn_return_any = True\r\nwarn_unused_configs = True\r\n```\r\n- Python version used: 3.10.1\r\n- Operating system and version: Arch Linux, 5.15.13-arch1-1 as well as in the `python:latest` Docker container\r\n\r\n<!--\r\nYou can freely edit this text, please remove all the lines\r\nyou believe are unnecessary.\r\n-->\r\n\r\n**More information**\r\n\r\nI believe that this bug was introduced as part of #11267. It introduced the following line: https://github.com/python/mypy/blob/48d810d/mypy/semanal.py#L2874\r\nInstead, I would expect this line to look more like https://github.com/python/mypy/blob/48d810d/mypy/semanal.py#L453 (i.e. also allow `PlaceholderNode` objects.\r\n\r\nThe reason that I believe this to be necessary is open inspecting the runtime data during the offending scenarios. There I was able to extract the following `names: SymbolTable` object:\r\n```\r\nSymbolTable(\r\n  PostAddCommand : Mdef/PlaceholderNode (cobib.config.event.Event.PostAddCommand)\r\n  PostArxivParse : Mdef/PlaceholderNode (cobib.config.event.Event.PostArxivParse)\r\n  PostBibtexDump : Mdef/Var (cobib.config.event.Event.PostBibtexDump) : cobib.config.event.Event\r\n  PostBibtexParse : Mdef/PlaceholderNode (cobib.config.event.Event.PostBibtexParse)\r\n  PostDOIParse : Mdef/PlaceholderNode (cobib.config.event.Event.PostDOIParse)\r\n  PostDeleteCommand : Mdef/Var (cobib.config.event.Event.PostDeleteCommand) : cobib.config.event.Event\r\n  PostEditCommand : Mdef/Var (cobib.config.event.Event.PostEditCommand) : cobib.config.event.Event\r\n  PostExportCommand : Mdef/Var (cobib.config.event.Event.PostExportCommand) : cobib.config.event.Event\r\n  PostFileDownload : Mdef/Var (cobib.config.event.Event.PostFileDownload) : cobib.config.event.Event\r\n  PostGitCommit : Mdef/Var (cobib.config.event.Event.PostGitCommit) : cobib.config.event.Event\r\n  PostISBNParse : Mdef/PlaceholderNode (cobib.config.event.Event.PostISBNParse)\r\n  PostImportCommand : Mdef/PlaceholderNode (cobib.config.event.Event.PostImportCommand)\r\n  PostInitCommand : Mdef/Var (cobib.config.event.Event.PostInitCommand) : cobib.config.event.Event\r\n  PostListCommand : Mdef/Var (cobib.config.event.Event.PostListCommand) : cobib.config.event.Event\r\n  PostModifyCommand : Mdef/Var (cobib.config.event.Event.PostModifyCommand) : cobib.config.event.Event\r\n  PostOpenCommand : Mdef/Var (cobib.config.event.Event.PostOpenCommand) : cobib.config.event.Event\r\n  PostRedoCommand : Mdef/Var (cobib.config.event.Event.PostRedoCommand) : cobib.config.event.Event\r\n  PostSearchCommand : Mdef/Var (cobib.config.event.Event.PostSearchCommand) : cobib.config.event.Event\r\n  PostShowCommand : Mdef/Var (cobib.config.event.Event.PostShowCommand) : cobib.config.event.Event\r\n  PostURLParse : Mdef/PlaceholderNode (cobib.config.event.Event.PostURLParse)\r\n  PostUndoCommand : Mdef/Var (cobib.config.event.Event.PostUndoCommand) : cobib.config.event.Event\r\n  PostYAMLDump : Mdef/Var (cobib.config.event.Event.PostYAMLDump) : cobib.config.event.Event\r\n  PostYAMLParse : Mdef/PlaceholderNode (cobib.config.event.Event.PostYAMLParse)\r\n  PostZoteroImport : Mdef/PlaceholderNode (cobib.config.event.Event.PostZoteroImport)\r\n  PreAddCommand : Mdef/Var (cobib.config.event.Event.PreAddCommand) : cobib.config.event.Event\r\n  PreArxivParse : Mdef/Var (cobib.config.event.Event.PreArxivParse) : cobib.config.event.Event\r\n  PreBibtexDump : Mdef/Var (cobib.config.event.Event.PreBibtexDump) : cobib.config.event.Event\r\n  PreBibtexParse : Mdef/Var (cobib.config.event.Event.PreBibtexParse) : cobib.config.event.Event\r\n  PreDOIParse : Mdef/Var (cobib.config.event.Event.PreDOIParse) : cobib.config.event.Event\r\n  PreDeleteCommand : Mdef/Var (cobib.config.event.Event.PreDeleteCommand) : cobib.config.event.Event\r\n  PreEditCommand : Mdef/Var (cobib.config.event.Event.PreEditCommand) : cobib.config.event.Event\r\n  PreExportCommand : Mdef/Var (cobib.config.event.Event.PreExportCommand) : cobib.config.event.Event\r\n  PreFileDownload : Mdef/Var (cobib.config.event.Event.PreFileDownload) : cobib.config.event.Event\r\n  PreGitCommit : Mdef/Var (cobib.config.event.Event.PreGitCommit) : cobib.config.event.Event\r\n  PreISBNParse : Mdef/Var (cobib.config.event.Event.PreISBNParse) : cobib.config.event.Event\r\n  PreImportCommand : Mdef/Var (cobib.config.event.Event.PreImportCommand) : cobib.config.event.Event\r\n  PreInitCommand : Mdef/Var (cobib.config.event.Event.PreInitCommand) : cobib.config.event.Event\r\n  PreListCommand : Mdef/Var (cobib.config.event.Event.PreListCommand) : cobib.config.event.Event\r\n  PreModifyCommand : Mdef/Var (cobib.config.event.Event.PreModifyCommand) : cobib.config.event.Event\r\n  PreOpenCommand : Mdef/Var (cobib.config.event.Event.PreOpenCommand) : cobib.config.event.Event\r\n  PreRedoCommand : Mdef/Var (cobib.config.event.Event.PreRedoCommand) : cobib.config.event.Event\r\n  PreSearchCommand : Mdef/Var (cobib.config.event.Event.PreSearchCommand) : cobib.config.event.Event\r\n  PreShowCommand : Mdef/Var (cobib.config.event.Event.PreShowCommand) : cobib.config.event.Event\r\n  PreURLParse : Mdef/Var (cobib.config.event.Event.PreURLParse) : cobib.config.event.Event\r\n  PreUndoCommand : Mdef/Var (cobib.config.event.Event.PreUndoCommand) : cobib.config.event.Event\r\n  PreYAMLDump : Mdef/Var (cobib.config.event.Event.PreYAMLDump) : cobib.config.event.Event\r\n  PreYAMLParse : Mdef/Var (cobib.config.event.Event.PreYAMLParse) : cobib.config.event.Event\r\n  PreZoteroImport : Mdef/Var (cobib.config.event.Event.PreZoteroImport) : cobib.config.event.Event\r\n  __new__ : Mdef/FuncDef (cobib.config.event.Event.__new__) : def (cls: Any, annotation: Any?) -> Event?\r\n  _annotation_ : Mdef/Var (cobib.config.event.Event._annotation_) : Any\r\n  fire : Mdef/FuncDef (cobib.config.event.Event.fire) : def (self: Any, *args: Any?, **kwargs: Any?) -> Any?\r\n  subscribe : Mdef/FuncDef (cobib.config.event.Event.subscribe) : def (self: Any, function: Callable?) -> Callable?\r\n  validate : Mdef/FuncDef (cobib.config.event.Event.validate) : def (self: Any) -> bool?\r\n)\r\n```\r\nThis is just prior to this error being raised:\r\n```\r\nAttempted to reuse member name \"PostAddCommand\" in Enum definition \"Event\"\r\n```\r\nThe following are the `lvalue` and `names[name]` at this specific occurrence.\r\n```\r\nNameExpr(PostAddCommand) Mdef/PlaceholderNode (cobib.config.event.Event.PostAddCommand)\r\n```\r\n\r\nI am going to open a PR in a second with a suggestion to fix this by also allowing `PlaceholderNode` objects.","closed_by":{"login":"97littleleaf11","id":11172084,"node_id":"MDQ6VXNlcjExMTcyMDg0","avatar_url":"https://avatars.githubusercontent.com/u/11172084?v=4","gravatar_id":"","url":"https://api.github.com/users/97littleleaf11","html_url":"https://github.com/97littleleaf11","followers_url":"https://api.github.com/users/97littleleaf11/followers","following_url":"https://api.github.com/users/97littleleaf11/following{/other_user}","gists_url":"https://api.github.com/users/97littleleaf11/gists{/gist_id}","starred_url":"https://api.github.com/users/97littleleaf11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/97littleleaf11/subscriptions","organizations_url":"https://api.github.com/users/97littleleaf11/orgs","repos_url":"https://api.github.com/users/97littleleaf11/repos","events_url":"https://api.github.com/users/97littleleaf11/events{/privacy}","received_events_url":"https://api.github.com/users/97littleleaf11/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/11971/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/11971/timeline","performed_via_github_app":null,"state_reason":"completed"}