{"url":"https://api.github.com/repos/python/mypy/issues/15088","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/15088/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/15088/comments","events_url":"https://api.github.com/repos/python/mypy/issues/15088/events","html_url":"https://github.com/python/mypy/issues/15088","id":1675856604,"node_id":"I_kwDOAGuhRc5j44rc","number":15088,"title":"Generic type parameters to Argument 1 of `attrs.evolve` only unify under very specific circumstances (mypy 1.2)","user":{"login":"mwchase","id":882845,"node_id":"MDQ6VXNlcjg4Mjg0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/882845?v=4","gravatar_id":"","url":"https://api.github.com/users/mwchase","html_url":"https://github.com/mwchase","followers_url":"https://api.github.com/users/mwchase/followers","following_url":"https://api.github.com/users/mwchase/following{/other_user}","gists_url":"https://api.github.com/users/mwchase/gists{/gist_id}","starred_url":"https://api.github.com/users/mwchase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mwchase/subscriptions","organizations_url":"https://api.github.com/users/mwchase/orgs","repos_url":"https://api.github.com/users/mwchase/repos","events_url":"https://api.github.com/users/mwchase/events{/privacy}","received_events_url":"https://api.github.com/users/mwchase/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":852620211,"node_id":"MDU6TGFiZWw4NTI2MjAyMTE=","url":"https://api.github.com/repos/python/mypy/labels/topic-attrs","name":"topic-attrs","color":"91f5f7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-04-20T01:41:41Z","updated_at":"2023-04-24T03:12:27Z","closed_at":"2023-04-21T06:40:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form instead.\r\nPlease consider:\r\n\r\n- checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n- searching our issue tracker: https://github.com/python/mypy/issues to see if it's already been reported\r\n- asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\n\r\n<!--\r\nIf you're reporting a problem with a specific library function, the typeshed tracker is better suited for this report: https://github.com/python/typeshed/issues\r\n\r\nIf the project you encountered the issue in is open source, please provide a link to the project.\r\n-->\r\n\r\n(A clear and concise description of what the bug is.)\r\n\r\n**To Reproduce**\r\n\r\n```python\r\nfrom __future__ import annotations\r\n\r\nfrom attrs import evolve, frozen\r\nfrom typing import Generic, TypeVar\r\n\r\nT1 = TypeVar(\"T1\")\r\nT2 = TypeVar(\"T2\")\r\n\r\n\r\n@frozen\r\nclass Test(Generic[T1]):\r\n    var: T1\r\n\r\n    # Can't substitute equivalent typevar in method.\r\n    def update(self: Test[T2], var: T2) -> Test[T2]:\r\n        return evolve(self, var=var)\r\n\r\n\r\n# Can't use *same* typevar in function.\r\ndef update_t1(test: Test[T1], var: T1) -> Test[T1]:\r\n    return evolve(test, var=var)\r\n\r\n\r\n# Can't use equivalent typevar in function.\r\ndef update_t2(test: Test[T2], var: T2) -> Test[T2]:\r\n    return evolve(test, var=var)\r\n```\r\n\r\n**Actual Behavior**\r\n\r\n```\r\ntest_mypy.py:16: error: Argument 1 to \"evolve\" of \"Test[T2]\" has incompatible type \"Test[T2]\"; expected \"Test[T1]\"  [arg-type]\r\ntest_mypy.py:16: error: Argument \"var\" to \"evolve\" of \"Test[T2]\" has incompatible type \"T2\"; expected \"T1\"  [arg-type]\r\ntest_mypy.py:21: error: Argument 1 to \"evolve\" of \"Test[T1]\" has incompatible type \"Test[T1]\"; expected \"Test[T1]\"  [arg-type]\r\ntest_mypy.py:21: error: Argument \"var\" to \"evolve\" of \"Test[T1]\" has incompatible type \"T1\"; expected \"T1\"  [arg-type]\r\ntest_mypy.py:26: error: Argument 1 to \"evolve\" of \"Test[T2]\" has incompatible type \"Test[T2]\"; expected \"Test[T1]\"  [arg-type]\r\ntest_mypy.py:26: error: Argument \"var\" to \"evolve\" of \"Test[T2]\" has incompatible type \"T2\"; expected \"T1\"  [arg-type]\r\nFound 6 errors in 1 file (checked 1 source file)\r\n```\r\n\r\nThis gets worse when using constrained typevars, because the typevar on the function/method gets expanded to every constraint, but the typevar on the class isn't expanded, so it only accepts the typevar, even though it's passing the concrete type.\r\n\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: `mypy 1.2.0 (compiled: yes)` (passes with `mypy 1.1.1 (compiled: yes)`)\r\n- Mypy command-line flags:\r\n- Mypy configuration options from `mypy.ini` (and other config files): (these approximate some past version of `--strict`, and a bunch of project-specific stuff that shouldn't be relevant)\r\n```\r\n[mypy]\r\nwarn_unused_configs = True\r\ndisallow_any_generics = True\r\ndisallow_subclassing_any = True\r\ndisallow_untyped_calls = True\r\ndisallow_untyped_defs = True\r\ndisallow_untyped_decorators = True\r\nno_implicit_optional = True\r\nwarn_redundant_casts = True\r\nwarn_unused_ignores = True\r\nwarn_return_any = True\r\nno_implicit_reexport = True\r\nstrict_equality = True\r\n\r\nplugins = trio_typing.plugin, plugins/type_func.py\r\nshow_error_codes = True\r\n\r\nmypy_path = $MYPY_CONFIG_FILE_DIR/stubs\r\n\r\n[mypy-cement.utils.version]\r\nignore_missing_imports = True\r\n\r\n[mypy-cement.core.exc]\r\nignore_missing_imports = True\r\n\r\n[mypy-tqdm]\r\nignore_missing_imports = True\r\n```\r\n- Python version used: `3.9.4`\r\n\r\n<!-- You can freely edit this text, please remove all the lines you believe are unnecessary. -->\r\n","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/15088/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/15088/timeline","performed_via_github_app":null,"state_reason":"completed"}