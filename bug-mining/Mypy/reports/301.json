{"url":"https://api.github.com/repos/python/mypy/issues/14852","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/14852/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/14852/comments","events_url":"https://api.github.com/repos/python/mypy/issues/14852/events","html_url":"https://github.com/python/mypy/issues/14852","id":1614258563,"node_id":"I_kwDOAGuhRc5gN6GD","number":14852,"title":"Multiple inheritance checks do not consider callable objects as possible subtypes of usual functions","user":{"login":"tyralla","id":25983587,"node_id":"MDQ6VXNlcjI1OTgzNTg3","avatar_url":"https://avatars.githubusercontent.com/u/25983587?v=4","gravatar_id":"","url":"https://api.github.com/users/tyralla","html_url":"https://github.com/tyralla","followers_url":"https://api.github.com/users/tyralla/followers","following_url":"https://api.github.com/users/tyralla/following{/other_user}","gists_url":"https://api.github.com/users/tyralla/gists{/gist_id}","starred_url":"https://api.github.com/users/tyralla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tyralla/subscriptions","organizations_url":"https://api.github.com/users/tyralla/orgs","repos_url":"https://api.github.com/users/tyralla/repos","events_url":"https://api.github.com/users/tyralla/events{/privacy}","received_events_url":"https://api.github.com/users/tyralla/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-03-07T21:48:14Z","updated_at":"2023-03-25T22:08:39Z","closed_at":"2023-03-25T22:08:39Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"It seems Mypy's method `TypeChecker.check_compatibility` for checking multiple inheritance compatibility does not consider that callable objects can be subtypes of usual functions, but method `TypeChecker.check_method_override_for_base_with_name` does so for single inheritance.\r\n\r\nFor the following example, Mypy reports:\r\n- Definition of \"f\" in base class \"A1\" is incompatible with definition in base class \"A2\"  [misc]\r\n- Definition of \"f\" in base class \"A2\" is incompatible with definition in base class \"A1\"  [misc]\r\n\r\n```python\r\nfrom typing import Any, Callable, Self\r\n\r\nclass F:\r\n    def __init__(self, f: Callable[[Any, int], int]) -> None:\r\n        self.wrapped = f\r\n        self.m: Any\r\n    def __get__(self, obj: Any, objtype: Any) -> Self:\r\n        self.m = obj\r\n        return self\r\n    def __call__(self, x: int) -> int:\r\n        return self.wrapped(self, x)\r\n\r\ndef dec(f: Callable[[Any, int], int]) -> F:\r\n    return F(f)\r\n\r\nclass A1:\r\n    def f(self, x: int) -> int:\r\n        return 1 * x\r\n\r\nclass B1(A1):  # no error reported, IMO okay\r\n    @dec\r\n    def f(self, x: int) -> int:\r\n        return 2 * x\r\n\r\nclass A2:\r\n    @dec\r\n    def f(self, x: int) -> int:\r\n        return 3 * x\r\n\r\nclass B21(A1, A2):  # error reported, IMO okay\r\n    pass\r\n\r\nclass B22(A2, A1):  # error reported, IMO not okay\r\n    pass\r\n\r\nassert B1().f(1) == 2\r\nassert B21().f(1) == 1\r\nassert B22().f(1) == 3\r\n\r\nassert hasattr(B1().f, \"wrapped\")\r\n# assert hasattr(B21().f), \"wrapped\")  # would crash\r\nassert hasattr(B22().f, \"wrapped\")\r\n```","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/14852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/14852/timeline","performed_via_github_app":null,"state_reason":"completed"}