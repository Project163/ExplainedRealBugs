{"url":"https://api.github.com/repos/python/mypy/issues/13214","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/13214/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/13214/comments","events_url":"https://api.github.com/repos/python/mypy/issues/13214/events","html_url":"https://github.com/python/mypy/issues/13214","id":1313675311,"node_id":"I_kwDOAGuhRc5OTRgv","number":13214,"title":"in-project stubs cause mypy to bail in 0.971","user":{"login":"vfazio","id":5265893,"node_id":"MDQ6VXNlcjUyNjU4OTM=","avatar_url":"https://avatars.githubusercontent.com/u/5265893?v=4","gravatar_id":"","url":"https://api.github.com/users/vfazio","html_url":"https://github.com/vfazio","followers_url":"https://api.github.com/users/vfazio/followers","following_url":"https://api.github.com/users/vfazio/following{/other_user}","gists_url":"https://api.github.com/users/vfazio/gists{/gist_id}","starred_url":"https://api.github.com/users/vfazio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vfazio/subscriptions","organizations_url":"https://api.github.com/users/vfazio/orgs","repos_url":"https://api.github.com/users/vfazio/repos","events_url":"https://api.github.com/users/vfazio/events{/privacy}","received_events_url":"https://api.github.com/users/vfazio/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-07-21T18:59:32Z","updated_at":"2022-08-15T13:14:57Z","closed_at":"2022-07-25T17:28:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  If you're new to mypy and you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form\r\n  instead.\r\n  Please also consider:\r\n\r\n  - checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n  - searching our issue tracker: https://github.com/python/mypy/issues to see if\r\n    it's already been reported\r\n  - asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\n\r\nWe have a project that includes type stubs for a python package that does not provide it's own typing. We followed guidance per https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-library-stubs-or-py-typed-marker number 3\r\n\r\n```\r\n(venv) vfazio@vfazio2 ~/development/xtf $ grep mypy_path mypy.ini\r\nmypy_path=$MYPY_CONFIG_FILE_DIR/stubs\r\n```\r\n\r\nIn mypy 0.961, type checks pass\r\n\r\n```\r\n(venv) vfazio@vfazio2 ~/development/xtf $ mypy -V; mypy xes/\r\nmypy 0.961 (compiled: no)\r\nSuccess: no issues found in 86 source files\r\n```\r\nIn mypy 0.971, these now fail because the current path is being added to the path search \r\n\r\n```\r\n(venv) vfazio@vfazio2 ~/development/xtf :( $ mypy -V; mypy xes/\r\nmypy 0.971 (compiled: no)\r\n['/mnt/development/mypy/venv/lib/python3.10/site-packages', '/mnt/development/xtf']\r\n/mnt/development/xtf is in the MYPYPATH. Please remove it.\r\nSee https://mypy.readthedocs.io/en/stable/running_mypy.html#how-mypy-handles-imports for more info\r\n\r\n```\r\n\r\nIf i modify `mypy/pyinfo.py::getsearchdirs` to exclude the current working directory (effectively reverting 2132036a019ed26d77389c0a9af9b928911a5846) the type checks \"work\" except I now get type failures for the stubs\r\n\r\n```\r\n(venv) vfazio@vfazio2 ~/development/xtf $ mypy -V; mypy xes/\r\nmypy 0.971 (compiled: no)\r\nstubs/redacted/path/file.pyi:49:9: error: Function is missing a return type annotation  [no-untyped-def]\r\nstubs/redacted/path/file.pyi:49:9: note: Use \"-> None\" if function does not return a value\r\n<snip>\r\nFound 58 errors in 2 files (checked 86 source files)\r\n\r\n```\r\n\r\n<!--\r\nNote: If the problem you are reporting is about a specific library function, then the typeshed tracker is better suited\r\nfor this report: https://github.com/python/typeshed/issues\r\n-->\r\n\r\n**Expected Behavior**\r\n\r\n<!--\r\n  How did you expect your project to behave?\r\n  It’s fine if you’re not sure your understanding is correct.\r\n  Write down what you thought would happen. If you just expected no errors, you can delete this section.\r\n-->\r\n\r\nFailures wouldn't occur or documentation would be updated to reflect how to accommodate this use case.\r\n\r\n**Actual Behavior**\r\n\r\n<!--\r\n  Did something go wrong?\r\n  Is something broken, or not behaving as you expected?\r\n-->\r\n\r\nmypy now fails to type check our code because we include stubs as part of our source tree\r\n\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: 0.971\r\n- Mypy command-line flags:\r\n- Mypy configuration options from `mypy.ini` (and other config files):\r\n- Python version used: 3.10.4\r\n- Operating system and version: Ubuntu 20.04\r\n\r\n<!--\r\nYou can freely edit this text, please remove all the lines\r\nyou believe are unnecessary.\r\n-->\r\n","closed_by":{"login":"ilevkivskyi","id":12005495,"node_id":"MDQ6VXNlcjEyMDA1NDk1","avatar_url":"https://avatars.githubusercontent.com/u/12005495?v=4","gravatar_id":"","url":"https://api.github.com/users/ilevkivskyi","html_url":"https://github.com/ilevkivskyi","followers_url":"https://api.github.com/users/ilevkivskyi/followers","following_url":"https://api.github.com/users/ilevkivskyi/following{/other_user}","gists_url":"https://api.github.com/users/ilevkivskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/ilevkivskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilevkivskyi/subscriptions","organizations_url":"https://api.github.com/users/ilevkivskyi/orgs","repos_url":"https://api.github.com/users/ilevkivskyi/repos","events_url":"https://api.github.com/users/ilevkivskyi/events{/privacy}","received_events_url":"https://api.github.com/users/ilevkivskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/13214/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/13214/timeline","performed_via_github_app":null,"state_reason":"completed"}