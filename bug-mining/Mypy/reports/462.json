{"url":"https://api.github.com/repos/python/mypy/issues/17048","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/17048/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/17048/comments","events_url":"https://api.github.com/repos/python/mypy/issues/17048/events","html_url":"https://github.com/python/mypy/issues/17048","id":2194524907,"node_id":"I_kwDOAGuhRc6Czcrr","number":17048,"title":"\"Can't find package\" error when package is installed but missing a py.typed file","user":{"login":"gmc444-b","id":21226719,"node_id":"MDQ6VXNlcjIxMjI2NzE5","avatar_url":"https://avatars.githubusercontent.com/u/21226719?v=4","gravatar_id":"","url":"https://api.github.com/users/gmc444-b","html_url":"https://github.com/gmc444-b","followers_url":"https://api.github.com/users/gmc444-b/followers","following_url":"https://api.github.com/users/gmc444-b/following{/other_user}","gists_url":"https://api.github.com/users/gmc444-b/gists{/gist_id}","starred_url":"https://api.github.com/users/gmc444-b/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmc444-b/subscriptions","organizations_url":"https://api.github.com/users/gmc444-b/orgs","repos_url":"https://api.github.com/users/gmc444-b/repos","events_url":"https://api.github.com/users/gmc444-b/events{/privacy}","received_events_url":"https://api.github.com/users/gmc444-b/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-03-19T10:02:31Z","updated_at":"2024-10-10T22:40:15Z","closed_at":"2024-10-10T22:40:14Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form instead.\r\nPlease consider:\r\n\r\n- checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n- searching our issue tracker: https://github.com/python/mypy/issues to see if it's already been reported\r\n- asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\n\r\nA while back I opened #16634 but didn't provide enough details on how to reproduce the problem. Here I'm providing a reproducer.\r\n\r\nWhen a package is installed without a `py.typed` file, installed into a virtual env, and then I run `mypy -p packagename` I get the error `Can't find package packagename` when a more appropriate error message should be provided.\r\n\r\n**To Reproduce**\r\n\r\nThe following files make up the reproducer:\r\n```\r\n├── pyproject.toml\r\n├── run-reproducer.sh\r\n└── src\r\n    └── reproducer\r\n        └── __init__.py\r\n```\r\n\r\nThe content of each file\r\n```\r\n#---- pyproject.toml\r\n\r\n[build-system]\r\nrequires = [\"setuptools\"]\r\nmodule_dir = \"src\"\r\n\r\n[project]\r\nname = \"reproducer\"\r\nversion = \"0.1\"\r\n\r\n[project.scripts]\r\nreproducer = \"reproducer.__init__:main\"\r\n\r\n[tool.setuptools.package-data]\r\n\"*\" = [\"py.typed\",]\r\n\r\n#-------- src/reproducer/__init__.py\r\n\r\ndef main(args: list[str] | None=None) -> None:\r\n    print(\"Hello from the reproducer\")\r\n\r\n#------- run-reproducer.sh\r\n\r\n#!/usr/bin/env bash\r\n\r\npython3.12 -m venv .venv\r\n.venv/bin/pip install . mypy\r\n.venv/bin/reproducer   # This works\r\n.venv/bin/mypy -p reproducer --strict   # This fails to find the reproducer\r\n```\r\n\r\n**Expected Behavior**\r\n\r\nUnder other circumstances, users can get an error message saying that type information is missing from the given package. That would be the preferred error message for this use-case.\r\n\r\n**Actual Behavior**\r\n\r\nSet up the files as described above, run the `run-reproducer.sh` script to initialize a virtual env with the reproducer package and mypy installed, and invoke mypy. The output I get is `Can't find package 'reproducer'`\r\n\r\n**Your Environment**\r\n\r\nPython 3.12 on Ubuntu 22.04, but I'm also able to reproduce this on Red Hat systems.\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used:  1.0.9\r\n- Mypy command-line flags:  -p reproducer --strict   (but same failure without --strict)\r\n- Mypy configuration options from `mypy.ini` (and other config files):  None\r\n- Python version used: 3.12\r\n\r\n<!-- You can freely edit this text, please remove all the lines you believe are unnecessary. -->\r\n","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/17048/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/17048/timeline","performed_via_github_app":null,"state_reason":"completed"}