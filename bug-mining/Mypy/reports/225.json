{"url":"https://api.github.com/repos/python/mypy/issues/14027","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/14027/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/14027/comments","events_url":"https://api.github.com/repos/python/mypy/issues/14027/events","html_url":"https://github.com/python/mypy/issues/14027","id":1438821417,"node_id":"I_kwDOAGuhRc5Vwqwp","number":14027,"title":"latest mypy 0.990 crashes with SQLAlchemy main","user":{"login":"zzzeek","id":128223,"node_id":"MDQ6VXNlcjEyODIyMw==","avatar_url":"https://avatars.githubusercontent.com/u/128223?v=4","gravatar_id":"","url":"https://api.github.com/users/zzzeek","html_url":"https://github.com/zzzeek","followers_url":"https://api.github.com/users/zzzeek/followers","following_url":"https://api.github.com/users/zzzeek/following{/other_user}","gists_url":"https://api.github.com/users/zzzeek/gists{/gist_id}","starred_url":"https://api.github.com/users/zzzeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zzzeek/subscriptions","organizations_url":"https://api.github.com/users/zzzeek/orgs","repos_url":"https://api.github.com/users/zzzeek/repos","events_url":"https://api.github.com/users/zzzeek/events{/privacy}","received_events_url":"https://api.github.com/users/zzzeek/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2022-11-07T18:53:56Z","updated_at":"2022-11-11T20:08:31Z","closed_at":"2022-11-11T20:08:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"running mypy or dmypy on SQLAlchemy main branch crashes reliably for the new 0.990 release .    For the run below, I have SQLAlchemy checked out on the rel_2_0_0b3 branch so that the results should stay the same regardless of when we make new commits to main.   Same issue reproduces with mypy git master.\r\n\r\n\r\n```\r\n[classic@photon3 tmp]$ virtualenv .venv\r\ncreated virtual environment CPython3.10.0.final.0-64 in 234ms\r\n\r\n[classic@photon3 tmp]$ .venv/bin/pip install mypy\r\nSuccessfully installed mypy-0.990 mypy-extensions-0.4.3 tomli-2.0.1 typing-extensions-4.4.0\r\n\r\n[classic@photon3 tmp]$ git clone https://github.com/sqlalchemy/sqlalchemy\r\nCloning into 'sqlalchemy'...\r\n\r\n[classic@photon3 tmp]$ source .venv/bin/activate\r\n(.venv) [classic@photon3 tmp]$ cd sqlalchemy/\r\n\r\n(.venv) [classic@photon3 tmp]$ git checkout rel_2_0_0b3\r\nHEAD is now at 35648a109 - 2.0.0b3\r\n\r\n\r\n(.venv) [classic@photon3 sqlalchemy:HEAD]$ mypy --show-traceback lib/\r\nlib/sqlalchemy/util/typing.py:371: error: Missing return statement  [empty-body]\r\nlib/sqlalchemy/util/typing.py:392: error: Missing return statement  [empty-body]\r\nlib/sqlalchemy/util/typing.py:395: error: Implicit return in function which does not return  [empty-body]\r\nlib/sqlalchemy/util/typing.py:398: error: Implicit return in function which does not return  [empty-body]\r\nlib/sqlalchemy/util/typing.py:414: error: Missing return statement  [empty-body]\r\nlib/sqlalchemy/util/langhelpers.py:1451: error: Function \"Callable[[type, Union[type, UnionType, Tuple[Union[type, UnionType, Tuple[Any, ...]], ...]]], bool]\" could always be true in boolean context  [truthy-function]\r\nlib/sqlalchemy/sql/visitors.py:556: error: Function \"Callable[..., Any]\" could always be true in boolean context  [truthy-function]\r\nlib/sqlalchemy/sql/traversals.py:568: error: Function \"Callable[..., Any]\" could always be true in boolean context  [truthy-function]\r\nlib/sqlalchemy/pool/base.py:730: error: Function \"Callable[[Optional[DBAPIConnection], Optional[_ConnectionRecord], Pool, Optional[ReferenceType[_ConnectionFairy]], Union[bool, Literal['debug'], None], bool, Optional[_ConnectionFairy]], None]\" could always be true in boolean context  [truthy-function]\r\nlib/sqlalchemy/sql/compiler.py:1730: error: Function \"Callable[[Any, Any], Any]\" could always be true in boolean context  [truthy-function]\r\nlib/sqlalchemy/engine/interfaces.py:1259: error: Missing return statement  [empty-body]\r\nlib/sqlalchemy/engine/base.py:2950: error: Function \"Callable[[], bool]\" could always be true in boolean context  [truthy-function]\r\nlib/sqlalchemy/orm/bulk_persistence.py:889: error: INTERNAL ERROR -- Please try using mypy master on GitHub:\r\nhttps://mypy.readthedocs.io/en/stable/common_issues.html#using-a-development-mypy-build\r\nPlease report a bug at https://github.com/python/mypy/issues\r\nversion: 1.0.0+dev.39d35cdee1bd02a6fb071334273e1c1fb0893066\r\nTraceback (most recent call last):\r\n  File \"/home/classic/tmp/.venv/bin/mypy\", line 8, in <module>\r\n    sys.exit(console_entry())\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/__main__.py\", line 15, in console_entry\r\n    main()\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/main.py\", line 95, in main\r\n    res, messages, blockers = run_build(sources, options, fscache, t0, stdout, stderr)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/main.py\", line 174, in run_build\r\n    res = build.build(sources, options, None, flush_errors, fscache, stdout, stderr)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/build.py\", line 193, in build\r\n    result = _build(\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/build.py\", line 276, in _build\r\n    graph = dispatch(sources, manager, stdout)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/build.py\", line 2903, in dispatch\r\n    process_graph(graph, manager)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/build.py\", line 3287, in process_graph\r\n    process_stale_scc(graph, scc, manager)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/build.py\", line 3388, in process_stale_scc\r\n    graph[id].type_check_first_pass()\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/build.py\", line 2309, in type_check_first_pass\r\n    self.type_checker().check_first_pass()\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 465, in check_first_pass\r\n    self.accept(d)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 573, in accept\r\n    stmt.accept(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/nodes.py\", line 1161, in accept\r\n    return visitor.visit_class_def(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 2132, in visit_class_def\r\n    self.accept(defn.defs)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 573, in accept\r\n    stmt.accept(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/nodes.py\", line 1242, in accept\r\n    return visitor.visit_block(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 2569, in visit_block\r\n    self.accept(s)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 573, in accept\r\n    stmt.accept(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/nodes.py\", line 934, in accept\r\n    return visitor.visit_decorator(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 4533, in visit_decorator\r\n    self.check_func_item(e.func, name=e.func.name)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 1011, in check_func_item\r\n    self.check_func_def(defn, typ, name, allow_empty)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 1208, in check_func_def\r\n    self.accept(item.body)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 573, in accept\r\n    stmt.accept(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/nodes.py\", line 1242, in accept\r\n    return visitor.visit_block(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 2569, in visit_block\r\n    self.accept(s)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 573, in accept\r\n    stmt.accept(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/nodes.py\", line 1510, in accept\r\n    return visitor.visit_if_stmt(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 4185, in visit_if_stmt\r\n    self.accept(s.else_body)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 573, in accept\r\n    stmt.accept(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/nodes.py\", line 1242, in accept\r\n    return visitor.visit_block(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 2569, in visit_block\r\n    self.accept(s)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 573, in accept\r\n    stmt.accept(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/nodes.py\", line 834, in accept\r\n    return visitor.visit_func_def(self)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 938, in visit_func_def\r\n    self._visit_func_def(defn)\r\n  File \"/home/classic/tmp/.venv/lib/python3.10/site-packages/mypy/checker.py\", line 963, in _visit_func_def\r\n    assert orig_type is not None, f\"Error checking function redefinition {defn}\"\r\nAssertionError: Error checking function redefinition FuncDef:889(\r\n  eval_condition\r\n  Args(\r\n    Var(obj))\r\n  Block:889(\r\n    ReturnStmt:890(\r\n      NameExpr(True [builtins.True]))))\r\nlib/sqlalchemy/orm/bulk_persistence.py:889: : note: use --pdb to drop into pdb\r\n```","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/14027/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/14027/timeline","performed_via_github_app":null,"state_reason":"completed"}