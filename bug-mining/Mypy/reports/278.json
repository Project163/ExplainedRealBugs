{"url":"https://api.github.com/repos/python/mypy/issues/14631","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/14631/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/14631/comments","events_url":"https://api.github.com/repos/python/mypy/issues/14631/events","html_url":"https://github.com/python/mypy/issues/14631","id":1574098582,"node_id":"I_kwDOAGuhRc5d0taW","number":14631,"title":"\"unresolved placeholder type None\" on mypy 1.0.0","user":{"login":"jonathanslenders","id":216638,"node_id":"MDQ6VXNlcjIxNjYzOA==","avatar_url":"https://avatars.githubusercontent.com/u/216638?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanslenders","html_url":"https://github.com/jonathanslenders","followers_url":"https://api.github.com/users/jonathanslenders/followers","following_url":"https://api.github.com/users/jonathanslenders/following{/other_user}","gists_url":"https://api.github.com/users/jonathanslenders/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanslenders/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanslenders/subscriptions","organizations_url":"https://api.github.com/users/jonathanslenders/orgs","repos_url":"https://api.github.com/users/jonathanslenders/repos","events_url":"https://api.github.com/users/jonathanslenders/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanslenders/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2023-02-07T10:46:53Z","updated_at":"2024-10-23T07:48:44Z","closed_at":"2023-02-08T19:51:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Bug Report**\r\n\r\nThere is a bug that makes it impossible to typecheck any Python application/library that has an import of the asyncssh package. However, typechecking asyncssh directly doesn't result in this bug. (See below, for a sort of reproducer).\r\n\r\nThe error looks like this:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/jonathan/.pyenv/versions/env/bin/mypy\", line 8, in <module>\r\n    sys.exit(console_entry())\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/__main__.py\", line 15, in console_entry\r\n    main()\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/main.py\", line 95, in main\r\n    res, messages, blockers = run_build(sources, options, fscache, t0, stdout, stderr)\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/main.py\", line 174, in run_build\r\n    res = build.build(sources, options, None, flush_errors, fscache, stdout, stderr)\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/build.py\", line 194, in build\r\n    result = _build(\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/build.py\", line 277, in _build\r\n    graph = dispatch(sources, manager, stdout)\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/build.py\", line 2923, in dispatch\r\n    process_graph(graph, manager)\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/build.py\", line 3320, in process_graph\r\n    process_stale_scc(graph, scc, manager)\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/build.py\", line 3443, in process_stale_scc\r\n    graph[id].write_cache()\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/build.py\", line 2504, in write_cache\r\n    new_interface_hash, self.meta = write_cache(\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/build.py\", line 1574, in write_cache\r\n    data = tree.serialize()\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/nodes.py\", line 377, in serialize\r\n    \"names\": self.names.serialize(self._fullname),\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/nodes.py\", line 3841, in serialize\r\n    data[key] = value.serialize(fullname, key)\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/nodes.py\", line 3778, in serialize\r\n    data[\"node\"] = self.node.serialize()\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/nodes.py\", line 3514, in serialize\r\n    \"target\": self.target.serialize(),\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/types.py\", line 2072, in serialize\r\n    \"ret_type\": self.ret_type.serialize(),\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/types.py\", line 605, in serialize\r\n    \"values\": [v.serialize() for v in self.values],\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/types.py\", line 605, in <listcomp>\r\n    \"values\": [v.serialize() for v in self.values],\r\n  File \"/home/jonathan/.pyenv/versions/3.9.13/envs/env/lib/python3.9/site-packages/mypy/types.py\", line 2876, in serialize\r\n    assert False, f\"Internal error: unresolved placeholder type {self.fullname}\"\r\nAssertionError: Internal error: unresolved placeholder type None\r\n```\r\n\r\n**To Reproduce**\r\n\r\nInstall `asyncssh`, then create a Python file with only this import and typecheck that file.\r\n```python\r\nimport asyncssh\r\n```\r\nOr:\r\n```sh\r\nmypy -c 'import asyncssh'\r\n```\r\n\r\nI tried to reduce the code surface as much as possible. Removing every file within asyncssh, except `py.typed` and `__init__.py`, and then write the following in `__init__.py`:\r\n\r\n```python\r\nfrom typing import TypeVar, Callable\r\nT = TypeVar('T', 'A', 'B')\r\nFunc = Callable[[], T]\r\n```\r\nWith the above snippet it still happens.\r\n\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: 1.0.0\r\n- Mypy command-line flags:  `--strict`\r\n- Mypy configuration options from `mypy.ini` (and other config files): /\r\n- Python version used: 3.9.13\r\n\r\n\r\ncc: @ronf","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/14631/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/14631/timeline","performed_via_github_app":null,"state_reason":"completed"}