{"url":"https://api.github.com/repos/python/mypy/issues/11234","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/11234/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/11234/comments","events_url":"https://api.github.com/repos/python/mypy/issues/11234/events","html_url":"https://github.com/python/mypy/issues/11234","id":1012379545,"node_id":"I_kwDOAGuhRc48V6-Z","number":11234,"title":"Mypy issue validating package with directory and -p arg","user":{"login":"oleksiykamenyev","id":9027086,"node_id":"MDQ6VXNlcjkwMjcwODY=","avatar_url":"https://avatars.githubusercontent.com/u/9027086?v=4","gravatar_id":"","url":"https://api.github.com/users/oleksiykamenyev","html_url":"https://github.com/oleksiykamenyev","followers_url":"https://api.github.com/users/oleksiykamenyev/followers","following_url":"https://api.github.com/users/oleksiykamenyev/following{/other_user}","gists_url":"https://api.github.com/users/oleksiykamenyev/gists{/gist_id}","starred_url":"https://api.github.com/users/oleksiykamenyev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oleksiykamenyev/subscriptions","organizations_url":"https://api.github.com/users/oleksiykamenyev/orgs","repos_url":"https://api.github.com/users/oleksiykamenyev/repos","events_url":"https://api.github.com/users/oleksiykamenyev/events{/privacy}","received_events_url":"https://api.github.com/users/oleksiykamenyev/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-09-30T16:23:50Z","updated_at":"2022-09-27T05:57:52Z","closed_at":"2022-09-27T05:57:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Bug Report**\r\nI'm having an issue running mypy on a package with the `-p` argument where the package directory has a subdirectory inside it. I'm receiving the following error with mypy 0.9.10:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/oleksiyk/.pyenv/versions/3.8.9/lib/python3.8/runpy.py\", line 194, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"/Users/oleksiyk/.pyenv/versions/3.8.9/lib/python3.8/runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/__main__.py\", line 23, in <module>\r\n    console_entry()\r\n  File \"mypy/build.py\", line 1955, in wrap_context\r\n  File \"mypy/build.py\", line 2205, in finish_passes\r\n  File \"mypy/build.py\", line 818, in report_file\r\n  File \"mypy/report.py\", line 83, in file\r\n  File \"mypy/report.py\", line 482, in on_file\r\n  File \"mypy/report.py\", line 131, in iterate_python_lines\r\n  File \"/Users/oleksiyk/.pyenv/versions/3.8.9/lib/python3.8/tokenize.py\", line 392, in open\r\n    buffer = _builtin_open(filename, 'rb')\r\nIsADirectoryError: [Errno 21] Is a directory: 'python_tools/resources'\r\n```\r\n\r\nI tested with the master branch, and the error is the same, but the traceback is different:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/oleksiyk/.pyenv/versions/3.8.9/lib/python3.8/runpy.py\", line 194, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"/Users/oleksiyk/.pyenv/versions/3.8.9/lib/python3.8/runpy.py\", line 87, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/__main__.py\", line 23, in <module>\r\n    console_entry()\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/__main__.py\", line 11, in console_entry\r\n    main(None, sys.stdout, sys.stderr)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/main.py\", line 87, in main\r\n    res, messages, blockers = run_build(sources, options, fscache, t0, stdout, stderr)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/main.py\", line 165, in run_build\r\n    res = build.build(sources, options, None, flush_errors, fscache, stdout, stderr)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 179, in build\r\n    result = _build(\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 254, in _build\r\n    graph = dispatch(sources, manager, stdout)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 2707, in dispatch\r\n    process_graph(graph, manager)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 3031, in process_graph\r\n    process_stale_scc(graph, scc, manager)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 3132, in process_stale_scc\r\n    graph[id].finish_passes()\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 2220, in finish_passes\r\n    free_tree(self.tree)\r\n  File \"/Users/oleksiyk/.pyenv/versions/3.8.9/lib/python3.8/contextlib.py\", line 131, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 1962, in wrap_context\r\n    yield\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 2215, in finish_passes\r\n    manager.report_file(self.tree, self.type_map(), self.options)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/build.py\", line 821, in report_file\r\n    self.reports.file(file, self.modules, type_map, options)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/report.py\", line 85, in file\r\n    reporter.on_file(tree, modules, type_map, options)\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/report.py\", line 483, in on_file\r\n    for lineno, line_text in iterate_python_lines(path):\r\n  File \"/Users/oleksiyk/virtualenv_python38/lib/python3.8/site-packages/mypy/report.py\", line 133, in iterate_python_lines\r\n    with tokenize.open(path) as input_file:\r\n  File \"/Users/oleksiyk/.pyenv/versions/3.8.9/lib/python3.8/tokenize.py\", line 392, in open\r\n    buffer = _builtin_open(filename, 'rb')\r\nIsADirectoryError: [Errno 21] Is a directory: 'python_tools/resources'\r\n```\r\n\r\nWithout the -p argument, the command passes with no issue.\r\n\r\n**Expected Behavior**\r\n\r\nI'm not too familiar with mypy, but I would expect the code to ignore such directories I think. I'm also not sure why the -p argument would cause this issue, when the code otherwise works normally. When I dug through the traceback a bit, I found this function https://github.com/python/mypy/blob/f98f78216ba9d6ab68c8e69c19e9f3c7926c5efe/mypy/report.py#L121-L128 that seems to handle skipping different paths for mypy validation. For the sake of testing, I changed the directory name above from `resources` to `stubs`, and that fixed the error. Perhaps all directories should be ignored by this skip function (or maybe they shouldn't be passed into it in the first place, not sure)?\r\n\r\n**My Environment**\r\n\r\n- Mypy version used: 0.9.10 and 0.920+dev.209a7193feb4bbfa38d09232b0a5a916e9d2e605\r\n- Full command run: `python3.8 -m mypy --txt-report ~/tmp/mypyr_report --install-types --non-interactive --namespace-packages --ignore-missing-imports -p yahoo.contrib.mx3_python_tools --show-traceback`\r\n- Mypy configuration options from `mypy.ini` (and other config files): none\r\n- Python version used: 3.8.9 (although in a separate env, 3.9 showed the same issue)\r\n- Operating system and version: MacOS Big Sur version 11.6","closed_by":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/11234/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/11234/timeline","performed_via_github_app":null,"state_reason":"completed"}