{"url":"https://api.github.com/repos/python/mypy/issues/13085","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/13085/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/13085/comments","events_url":"https://api.github.com/repos/python/mypy/issues/13085/events","html_url":"https://github.com/python/mypy/issues/13085","id":1297447061,"node_id":"I_kwDOAGuhRc5NVXiV","number":13085,"title":"Cache causes mypy to fail every 2nd run for module importing from google.cloud","user":{"login":"MaxG87","id":5477952,"node_id":"MDQ6VXNlcjU0Nzc5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5477952?v=4","gravatar_id":"","url":"https://api.github.com/users/MaxG87","html_url":"https://github.com/MaxG87","followers_url":"https://api.github.com/users/MaxG87/followers","following_url":"https://api.github.com/users/MaxG87/following{/other_user}","gists_url":"https://api.github.com/users/MaxG87/gists{/gist_id}","starred_url":"https://api.github.com/users/MaxG87/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MaxG87/subscriptions","organizations_url":"https://api.github.com/users/MaxG87/orgs","repos_url":"https://api.github.com/users/MaxG87/repos","events_url":"https://api.github.com/users/MaxG87/events{/privacy}","received_events_url":"https://api.github.com/users/MaxG87/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":354997184,"node_id":"MDU6TGFiZWwzNTQ5OTcxODQ=","url":"https://api.github.com/repos/python/mypy/labels/topic-incremental","name":"topic-incremental","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2022-07-07T13:30:05Z","updated_at":"2022-07-20T12:55:20Z","closed_at":"2022-07-20T12:55:20Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is very similar to #12232. However, I had to modify the minimum working example, because `mypy==0.961` fixed the other one.\r\n\r\n**Bug Report**\r\nI have a project that imports things from `google.cloud`, which is a namespace package as far as I know. In a certain, very specific configuration mypy fails on every second run. This is very similar to #9852 and an almost duplicate of #12232. However, this bug affects the most recent mypy, 0.961. Since the reproducer of #9852 and #12232 are fixed, I open a new bug report.\r\n\r\n**To Reproduce**\r\n\r\nThe following script does reproduce the problem on Debian Stable and inside the Docker image `python:latest`.\r\n\r\n```bash\r\n#!/usr/bin/env bash\r\n\r\nVENV=$(mktemp -d)\r\n\r\nrm -rf \"$VENV\"\r\n\r\n# The order of the imports matters. If one imports datastore first, the error\r\n# does not occur. Also, one must suppress the type error on the import of\r\n# `storage`, otherwise the error does not appear neither.\r\ncat <<EOF >script.py\r\nfrom google.cloud import storage  # type: ignore[attr-defined]\r\nfrom google.cloud.exceptions import NotFound\r\nEOF\r\n\r\npython3 -m venv \"$VENV\"\r\nsource \"$VENV/bin/activate\"\r\npython3 -m pip install mypy==0.961 google-cloud-storage==2.0.0 google-cloud-datastore==2.4.0\r\n\r\nmypy script.py\r\nmypy script.py\r\nmypy script.py\r\nmypy script.py\r\n```\r\n\r\n**Expected Behavior**\r\nPass or fail every time. I am not sure what would be correct in this case.\r\n\r\n**Actual Behavior**\r\nMypy accepts and rejects the code every 2nd run.\r\n\r\n**Your Environment**\r\n\r\nDebian Stable and `python:latest`. The reproducing script should cover all relevant details.","closed_by":{"login":"JukkaL","id":1107911,"node_id":"MDQ6VXNlcjExMDc5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1107911?v=4","gravatar_id":"","url":"https://api.github.com/users/JukkaL","html_url":"https://github.com/JukkaL","followers_url":"https://api.github.com/users/JukkaL/followers","following_url":"https://api.github.com/users/JukkaL/following{/other_user}","gists_url":"https://api.github.com/users/JukkaL/gists{/gist_id}","starred_url":"https://api.github.com/users/JukkaL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JukkaL/subscriptions","organizations_url":"https://api.github.com/users/JukkaL/orgs","repos_url":"https://api.github.com/users/JukkaL/repos","events_url":"https://api.github.com/users/JukkaL/events{/privacy}","received_events_url":"https://api.github.com/users/JukkaL/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/13085/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/13085/timeline","performed_via_github_app":null,"state_reason":"completed"}