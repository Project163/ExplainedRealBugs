{"url":"https://api.github.com/repos/python/mypy/issues/13521","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/13521/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/13521/comments","events_url":"https://api.github.com/repos/python/mypy/issues/13521/events","html_url":"https://github.com/python/mypy/issues/13521","id":1352091801,"node_id":"I_kwDOAGuhRc5Ql0iZ","number":13521,"title":"Regression on `master`: mypy unconditionally crashes when used with `--enable-error-code` for multiple error codes","user":{"login":"AlexWaygood","id":66076021,"node_id":"MDQ6VXNlcjY2MDc2MDIx","avatar_url":"https://avatars.githubusercontent.com/u/66076021?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexWaygood","html_url":"https://github.com/AlexWaygood","followers_url":"https://api.github.com/users/AlexWaygood/followers","following_url":"https://api.github.com/users/AlexWaygood/following{/other_user}","gists_url":"https://api.github.com/users/AlexWaygood/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexWaygood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexWaygood/subscriptions","organizations_url":"https://api.github.com/users/AlexWaygood/orgs","repos_url":"https://api.github.com/users/AlexWaygood/repos","events_url":"https://api.github.com/users/AlexWaygood/events{/privacy}","received_events_url":"https://api.github.com/users/AlexWaygood/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null},{"id":513232516,"node_id":"MDU6TGFiZWw1MTMyMzI1MTY=","url":"https://api.github.com/repos/python/mypy/labels/priority-0-high","name":"priority-0-high","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"ilevkivskyi","id":12005495,"node_id":"MDQ6VXNlcjEyMDA1NDk1","avatar_url":"https://avatars.githubusercontent.com/u/12005495?v=4","gravatar_id":"","url":"https://api.github.com/users/ilevkivskyi","html_url":"https://github.com/ilevkivskyi","followers_url":"https://api.github.com/users/ilevkivskyi/followers","following_url":"https://api.github.com/users/ilevkivskyi/following{/other_user}","gists_url":"https://api.github.com/users/ilevkivskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/ilevkivskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilevkivskyi/subscriptions","organizations_url":"https://api.github.com/users/ilevkivskyi/orgs","repos_url":"https://api.github.com/users/ilevkivskyi/repos","events_url":"https://api.github.com/users/ilevkivskyi/events{/privacy}","received_events_url":"https://api.github.com/users/ilevkivskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"ilevkivskyi","id":12005495,"node_id":"MDQ6VXNlcjEyMDA1NDk1","avatar_url":"https://avatars.githubusercontent.com/u/12005495?v=4","gravatar_id":"","url":"https://api.github.com/users/ilevkivskyi","html_url":"https://github.com/ilevkivskyi","followers_url":"https://api.github.com/users/ilevkivskyi/followers","following_url":"https://api.github.com/users/ilevkivskyi/following{/other_user}","gists_url":"https://api.github.com/users/ilevkivskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/ilevkivskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilevkivskyi/subscriptions","organizations_url":"https://api.github.com/users/ilevkivskyi/orgs","repos_url":"https://api.github.com/users/ilevkivskyi/repos","events_url":"https://api.github.com/users/ilevkivskyi/events{/privacy}","received_events_url":"https://api.github.com/users/ilevkivskyi/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2022-08-26T10:42:59Z","updated_at":"2022-08-26T15:12:25Z","closed_at":"2022-08-26T15:12:25Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Crash Report**\r\n\r\nOn the `master` branch, mypy unconditionally crashes if used with the command-line options `--enable-error-code ignore-without-code`. I've bisected the regression to:\r\n- #13502\r\n\r\n**Traceback**\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\alexw\\AppData\\Local\\Programs\\Python\\Python310\\lib\\runpy.py\", line 196, in _run_module_as_main\r\n    return _run_code(code, main_globals, None,\r\n  File \"C:\\Users\\alexw\\AppData\\Local\\Programs\\Python\\Python310\\lib\\runpy.py\", line 86, in _run_code\r\n    exec(code, run_globals)\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\venv\\Scripts\\mypy.exe\\__main__.py\", line 7, in <module>\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\__main__.py\", line 15, in console_entry\r\n    main()\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\main.py\", line 95, in main\r\n    res, messages, blockers = run_build(sources, options, fscache, t0, stdout, stderr)\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\main.py\", line 174, in run_build\r\n    res = build.build(sources, options, None, flush_errors, fscache, stdout, stderr)\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\build.py\", line 186, in build\r\n    result = _build(\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\build.py\", line 269, in _build\r\n    graph = dispatch(sources, manager, stdout)\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\build.py\", line 2873, in dispatch\r\n    process_graph(graph, manager)\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\build.py\", line 3257, in process_graph\r\n    process_stale_scc(graph, scc, manager)\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\build.py\", line 3378, in process_stale_scc\r\n    graph[id].write_cache()\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\build.py\", line 2447, in write_cache\r\n    new_interface_hash, self.meta = write_cache(\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\build.py\", line 1639, in write_cache\r\n    meta_str = json_dumps(meta, manager.options.debug_cache)\r\n  File \"C:\\Users\\alexw\\coding\\mypy\\mypy\\build.py\", line 1510, in json_dumps\r\n    return json.dumps(obj, sort_keys=True)\r\n  File \"C:\\Users\\alexw\\AppData\\Local\\Programs\\Python\\Python310\\lib\\json\\__init__.py\", line 238, in dumps\r\n    **kw).encode(obj)\r\n  File \"C:\\Users\\alexw\\AppData\\Local\\Programs\\Python\\Python310\\lib\\json\\encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"C:\\Users\\alexw\\AppData\\Local\\Programs\\Python\\Python310\\lib\\json\\encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"C:\\Users\\alexw\\AppData\\Local\\Programs\\Python\\Python310\\lib\\json\\encoder.py\", line 179, in default\r\n    raise TypeError(f'Object of type {o.__class__.__name__} '\r\nTypeError: Object of type ErrorCode is not JSON serializable\r\n```\r\n\r\n**To Reproduce**\r\n\r\n- `cd` into a local clone of mypy, activate a local environment with an editable install of mypy.\r\n- Checkout the `master` branch.\r\n- Run `mypy --enable-error-code ignore-without-code` on any repository. I've reproduced it using the selfcheck (`python -m mypy --config-file mypy_self_check.ini -p mypy --enable-error-code ignore-without-code`) and also on my local clone of `flake8-pyi`, which has the `ignore-without-code` error code enabled as part of its default mypy configuration.","closed_by":{"login":"ilevkivskyi","id":12005495,"node_id":"MDQ6VXNlcjEyMDA1NDk1","avatar_url":"https://avatars.githubusercontent.com/u/12005495?v=4","gravatar_id":"","url":"https://api.github.com/users/ilevkivskyi","html_url":"https://github.com/ilevkivskyi","followers_url":"https://api.github.com/users/ilevkivskyi/followers","following_url":"https://api.github.com/users/ilevkivskyi/following{/other_user}","gists_url":"https://api.github.com/users/ilevkivskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/ilevkivskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilevkivskyi/subscriptions","organizations_url":"https://api.github.com/users/ilevkivskyi/orgs","repos_url":"https://api.github.com/users/ilevkivskyi/repos","events_url":"https://api.github.com/users/ilevkivskyi/events{/privacy}","received_events_url":"https://api.github.com/users/ilevkivskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/13521/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/13521/timeline","performed_via_github_app":null,"state_reason":"completed"}