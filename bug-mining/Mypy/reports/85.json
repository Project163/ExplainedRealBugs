{"url":"https://api.github.com/repos/python/mypy/issues/11825","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/11825/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/11825/comments","events_url":"https://api.github.com/repos/python/mypy/issues/11825/events","html_url":"https://github.com/python/mypy/issues/11825","id":1087207976,"node_id":"I_kwDOAGuhRc5AzXoo","number":11825,"title":"Crash/Regression - 0.930 no longer accepts multiline basic strings for `exclude` patterns in `pyproject.toml`","user":{"login":"posita","id":222581,"node_id":"MDQ6VXNlcjIyMjU4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/222581?v=4","gravatar_id":"","url":"https://api.github.com/users/posita","html_url":"https://github.com/posita","followers_url":"https://api.github.com/users/posita/followers","following_url":"https://api.github.com/users/posita/following{/other_user}","gists_url":"https://api.github.com/users/posita/gists{/gist_id}","starred_url":"https://api.github.com/users/posita/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/posita/subscriptions","organizations_url":"https://api.github.com/users/posita/orgs","repos_url":"https://api.github.com/users/posita/repos","events_url":"https://api.github.com/users/posita/events{/privacy}","received_events_url":"https://api.github.com/users/posita/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-12-22T21:40:31Z","updated_at":"2022-01-04T17:03:17Z","closed_at":"2022-01-04T17:03:17Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Crash Report**\r\n\r\n``` toml\r\n# pyproject.toml\r\n[tool.mypy]\r\nexclude = \"\"\"(?x)(\r\n  (^|/)build/\r\n)\"\"\"\r\n```\r\n\r\nAnyone using a [multiline basic string](https://toml.io/en/v1.0.0#string) to define a regex for `exclude` such as above ([source](https://github.com/python/mypy/issues/10250#issuecomment-905781154)) will have to rewrite their regex to no longer span multiple lines:\r\n\r\n``` toml\r\n# pyproject.toml\r\n[tool.mypy]\r\nexclude = \"(?x)( (^|/)build/ )\"\r\n```\r\n\r\nI believe this was working up through 0.921. I have not yet confirmed whether this has anything to do with #11329.\r\n\r\n**Traceback**\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/sre_parse.py\", line 948, in parse\r\n    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/sre_parse.py\", line 443, in _parse_sub\r\n    itemsappend(_parse(source, state, verbose, nested + 1,\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/sre_parse.py\", line 817, in _parse\r\n    raise Verbose\r\nsre_parse.Verbose\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"…/bin/mypy\", line 8, in <module>\r\n    sys.exit(console_entry())\r\n  File \"…/lib/python3.10/site-packages/mypy/__main__.py\", line 12, in console_entry\r\n    main(None, sys.stdout, sys.stderr)\r\n  File \"…/lib/python3.10/site-packages/mypy/main.py\", line 70, in main\r\n    sources, options = process_options(args, stdout=stdout, stderr=stderr,\r\n  File \"…/lib/python3.10/site-packages/mypy/main.py\", line 1057, in process_options\r\n    targets = create_source_list(special_opts.files, options, fscache)\r\n  File \"…/lib/python3.10/site-packages/mypy/find_sources.py\", line 38, in create_source_list\r\n    sub_sources = finder.find_sources_in_dir(path)\r\n  File \"…/lib/python3.10/site-packages/mypy/find_sources.py\", line 112, in find_sources_in_dir\r\n    if matches_exclude(\r\n  File \"…/lib/python3.10/site-packages/mypy/modulefinder.py\", line 524, in matches_exclude\r\n    if re.search(exclude, subpath_str):\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/re.py\", line 200, in search\r\n    return _compile(pattern, flags).search(string)\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/re.py\", line 303, in _compile\r\n    p = sre_compile.compile(pattern, flags)\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/sre_compile.py\", line 764, in compile\r\n    p = sre_parse.parse(p, flags)\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/sre_parse.py\", line 956, in parse\r\n    p = _parse_sub(source, state, True, 0)\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/sre_parse.py\", line 443, in _parse_sub\r\n    itemsappend(_parse(source, state, verbose, nested + 1,\r\n  File \"/Library/Frameworks/MacPorts-20211130/Python.framework/Versions/3.10/lib/python3.10/sre_parse.py\", line 836, in _parse\r\n    raise source.error(\"missing ), unterminated subpattern\",\r\nre.error: missing ), unterminated subpattern at position 4\r\n```\r\n\r\n**To Reproduce**\r\n\r\n`mypy [--config-file=pyproject.toml] …`\r\n\r\n**Your Environment**\r\n\r\n- Mypy version used: 0.930\r\n- Mypy command-line flags: `mypy [--config-file=pyproject.toml] …`\r\n- Mypy configuration options from `pyproject.toml`: `exclude` (file is above)\r\n- Python version used: 3.10","closed_by":{"login":"JukkaL","id":1107911,"node_id":"MDQ6VXNlcjExMDc5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1107911?v=4","gravatar_id":"","url":"https://api.github.com/users/JukkaL","html_url":"https://github.com/JukkaL","followers_url":"https://api.github.com/users/JukkaL/followers","following_url":"https://api.github.com/users/JukkaL/following{/other_user}","gists_url":"https://api.github.com/users/JukkaL/gists{/gist_id}","starred_url":"https://api.github.com/users/JukkaL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JukkaL/subscriptions","organizations_url":"https://api.github.com/users/JukkaL/orgs","repos_url":"https://api.github.com/users/JukkaL/repos","events_url":"https://api.github.com/users/JukkaL/events{/privacy}","received_events_url":"https://api.github.com/users/JukkaL/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/11825/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/11825/timeline","performed_via_github_app":null,"state_reason":"completed"}