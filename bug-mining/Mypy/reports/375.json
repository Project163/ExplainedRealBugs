{"url":"https://api.github.com/repos/python/mypy/issues/15877","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/15877/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/15877/comments","events_url":"https://api.github.com/repos/python/mypy/issues/15877/events","html_url":"https://github.com/python/mypy/issues/15877","id":1851442983,"node_id":"I_kwDOAGuhRc5uWscn","number":15877,"title":"pyproject.toml requires mypy 1.4.0-1.5.0 + mypycify in setup.py: failure (AssertionError)","user":{"login":"mr-c","id":1330696,"node_id":"MDQ6VXNlcjEzMzA2OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1330696?v=4","gravatar_id":"","url":"https://api.github.com/users/mr-c","html_url":"https://github.com/mr-c","followers_url":"https://api.github.com/users/mr-c/followers","following_url":"https://api.github.com/users/mr-c/following{/other_user}","gists_url":"https://api.github.com/users/mr-c/gists{/gist_id}","starred_url":"https://api.github.com/users/mr-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mr-c/subscriptions","organizations_url":"https://api.github.com/users/mr-c/orgs","repos_url":"https://api.github.com/users/mr-c/repos","events_url":"https://api.github.com/users/mr-c/events{/privacy}","received_events_url":"https://api.github.com/users/mr-c/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":3945405283,"node_id":"LA_kwDOAGuhRc7rKhtj","url":"https://api.github.com/repos/python/mypy/labels/topic-mypyc","name":"topic-mypyc","color":"B64F6B","default":false,"description":"mypyc bugs"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-08-15T13:27:15Z","updated_at":"2023-09-17T12:23:00Z","closed_at":"2023-09-17T12:23:00Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Bug Report**\r\n\r\nWhen upgrading a `mypycify`-using Python project from mypy 1.3.0 to a newer version, a `pip install` of my project fails where it does not with mypy 1.3.0\r\n\r\n**To Reproduce**\r\n\r\n``` bash\r\ngit clone https://github.com/common-workflow-language/cwltool\r\ncd cwltool\r\nsed  -i 's/mypy==1.3.0/mypy==1.4.0/' pyproject.toml  # or to 1.4.1, or 1.5.0\r\nMYPYPATH=mypy-stubs CWLTOOL_USE_MYPYC=1 pip install  .\r\n```\r\n\r\n**Expected Behavior**\r\n\r\n```\r\n$ MYPYPATH=mypy-stubs CWLTOOL_USE_MYPYC=1 pip install .\r\nProcessing /home/michael/cwltool\r\n  Installing build dependencies ... done\r\n  Getting requirements to build wheel ... done\r\n  Installing backend dependencies ... done\r\n  Preparing metadata (pyproject.toml) ... done\r\nRequirement already satisfied: setuptools in ./env3.11/lib/python3.11/site-packages (from cwltool==3.1) (66.1.1)\r\n\r\n[snip]\r\n\r\nBuilding wheels for collected packages: cwltool\r\n  Building wheel for cwltool (pyproject.toml) ... done\r\n  Created wheel for cwltool: filename=cwltool-3.1-cp311-cp311-linux_x86_64.whl size=3672349 sha256=c467454417b08ede66d0832b6a17e7b00cded2d7e6073be12100d83746bb04ae\r\n  Stored in directory: /tmp/pip-ephem-wheel-cache-z0z1cpyr/wheels/ee/cd/42/595fc105979e9f4d5af86398d7a0f9de9008e61383a87ccdb1\r\nSuccessfully built cwltool\r\n```\r\n**Actual Behavior**\r\n\r\n(passing `--no-binary mypy` to `pip install` to get a more interesting stacktrace, the same error occurs without it)\r\n\r\n```\r\n$ MYPYPATH=mypy-stubs CWLTOOL_USE_MYPYC=1 pip install  . --no-binary mypy\r\nProcessing /home/michael/cwltool\r\n  Installing build dependencies ... done\r\n  Getting requirements to build wheel ... error\r\n  error: subprocess-exited-with-error\r\n  \r\n  × Getting requirements to build wheel did not run successfully.\r\n  │ exit code: 1\r\n  ╰─> [35 lines of output]\r\n      Traceback (most recent call last):\r\n        File \"/home/michael/cwltool/env3.11/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 353, in <module>\r\n          main()\r\n        File \"/home/michael/cwltool/env3.11/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 335, in main\r\n          json_out['return_val'] = hook(**hook_input['kwargs'])\r\n                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/home/michael/cwltool/env3.11/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 118, in get_requires_for_build_wheel\r\n          return hook(config_settings)\r\n                 ^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 341, in get_requires_for_build_wheel\r\n          return self._get_build_requires(config_settings, requirements=['wheel'])\r\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 323, in _get_build_requires\r\n          self.run_setup()\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 338, in run_setup\r\n          exec(code, locals())\r\n        File \"<string>\", line 91, in <module>\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/mypyc/build.py\", line 511, in mypycify\r\n          groups, group_cfilenames = mypyc_build(\r\n                                     ^^^^^^^^^^^^\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/mypyc/build.py\", line 421, in mypyc_build\r\n          group_cfiles, ops_text = generate_c(\r\n                                   ^^^^^^^^^^^\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/mypyc/build.py\", line 233, in generate_c\r\n          emit_messages(options, errors.new_messages(), t2 - t1)\r\n                                 ^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/mypyc/errors.py\", line 25, in new_messages\r\n          return self._errors.new_messages()\r\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/mypy/errors.py\", line 871, in new_messages\r\n          msgs.extend(self.file_messages(path))\r\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/tmp/pip-build-env-rnls4s4_/overlay/lib/python3.11/site-packages/mypy/errors.py\", line 857, in file_messages\r\n          assert self.read_source\r\n      AssertionError\r\n      [end of output]\r\n  \r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: subprocess-exited-with-error\r\n\r\n× Getting requirements to build wheel did not run successfully.\r\n│ exit code: 1\r\n╰─> See above for output.\r\n\r\nnote: This error originates from a subprocess, and is likely not a problem with pip.\r\n\r\n```\r\n\r\nSame for mypy 1.4.1 and 1.5.0\r\n\r\n**Your Environment**\r\n\r\n- Mypy version used: 1.4.0+\r\n- Python version used: 3.11.2\r\n","closed_by":{"login":"ilevkivskyi","id":12005495,"node_id":"MDQ6VXNlcjEyMDA1NDk1","avatar_url":"https://avatars.githubusercontent.com/u/12005495?v=4","gravatar_id":"","url":"https://api.github.com/users/ilevkivskyi","html_url":"https://github.com/ilevkivskyi","followers_url":"https://api.github.com/users/ilevkivskyi/followers","following_url":"https://api.github.com/users/ilevkivskyi/following{/other_user}","gists_url":"https://api.github.com/users/ilevkivskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/ilevkivskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilevkivskyi/subscriptions","organizations_url":"https://api.github.com/users/ilevkivskyi/orgs","repos_url":"https://api.github.com/users/ilevkivskyi/repos","events_url":"https://api.github.com/users/ilevkivskyi/events{/privacy}","received_events_url":"https://api.github.com/users/ilevkivskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/15877/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/15877/timeline","performed_via_github_app":null,"state_reason":"completed"}