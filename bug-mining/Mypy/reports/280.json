{"url":"https://api.github.com/repos/python/mypy/issues/14633","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/14633/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/14633/comments","events_url":"https://api.github.com/repos/python/mypy/issues/14633/events","html_url":"https://github.com/python/mypy/issues/14633","id":1574108130,"node_id":"I_kwDOAGuhRc5d0vvi","number":14633,"title":"Regression on i686: testI64Cast fails (mypy v1.0.0)","user":{"login":"mr-c","id":1330696,"node_id":"MDQ6VXNlcjEzMzA2OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1330696?v=4","gravatar_id":"","url":"https://api.github.com/users/mr-c","html_url":"https://github.com/mr-c","followers_url":"https://api.github.com/users/mr-c/followers","following_url":"https://api.github.com/users/mr-c/following{/other_user}","gists_url":"https://api.github.com/users/mr-c/gists{/gist_id}","starred_url":"https://api.github.com/users/mr-c/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mr-c/subscriptions","organizations_url":"https://api.github.com/users/mr-c/orgs","repos_url":"https://api.github.com/users/mr-c/repos","events_url":"https://api.github.com/users/mr-c/events{/privacy}","received_events_url":"https://api.github.com/users/mr-c/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"},{"id":937709516,"node_id":"MDU6TGFiZWw5Mzc3MDk1MTY=","url":"https://api.github.com/repos/python/mypy/labels/topic-tests","name":"topic-tests","color":"c2e0c6","default":false,"description":""},{"id":3945405283,"node_id":"LA_kwDOAGuhRc7rKhtj","url":"https://api.github.com/repos/python/mypy/labels/topic-mypyc","name":"topic-mypyc","color":"B64F6B","default":false,"description":"mypyc bugs"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-02-07T10:54:03Z","updated_at":"2023-02-13T18:11:15Z","closed_at":"2023-02-13T18:11:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Bug Report**\r\n\r\nHello, while preparing the Debian package for mypy 1.0  (:tada: congratulations!), we are getting a `testI64Cast` failure on i686\r\n\r\n**To Reproduce**\r\n\r\n``` Dockerfile\r\nFROM --platform=linux/i386 debian:unstable-slim\r\nRUN apt-get update && apt-get install -y python3-pip python3-lxml wget make\r\nWORKDIR /tmp\r\nRUN wget https://github.com/python/mypy/archive/refs/tags/v1.0.0.tar.gz && \\\r\n\ttar xzf v*tar.gz && \\\r\n\trm *.tar.gz\r\nWORKDIR /tmp/mypy-1.0.0\r\nRUN python3 -m pip install -r test-requirements.txt\r\nRUN python3 -m pytest -v -n 0 -k testI64Cast\r\n```\r\n\r\n**Expected Behavior**\r\n\r\n```\r\nmypyc/test/test_irbuild.py::TestGenOps::irbuild-i64.test::testI64Cast PASSED [100%]\r\n```\r\n\r\n**Actual Behavior**\r\n```\r\nmypyc/test/test_irbuild.py::TestGenOps::irbuild-i64.test::testI64Cast FAILED [100%]\r\n\r\n=================================== FAILURES ===================================\r\n_________________________________ testI64Cast __________________________________\r\ndata: /tmp/mypy-1.0.0/mypyc/test-data/irbuild-i64.test:1734:\r\n../mypy-1.0.0/mypyc/test/test_irbuild.py:83: in run_case\r\n    assert_test_output(testcase, actual, \"Invalid source code output\", expected_output)\r\nE   AssertionError: Invalid source code output (/tmp/mypy-1.0.0/mypyc/test-data/irbuild-i64.test, line 1734)\r\n----------------------------- Captured stderr call -----------------------------\r\nExpected:\r\n  ...\r\n  def cast_int(x):\r\n      x :: int\r\n      r0 :: native_int\r\n      r1 :: bit\r\n      r2, r3 :: int64                           (diff)\r\n      r4 :: ptr                                 (diff)\r\n      r5 :: c_ptr                               (diff)\r\n      r6 :: int64                               (diff)\r\n  L0:\r\n      r0 = x & 1\r\n      r1 = r0 == 0\r\n      if r1 goto L1 else goto L2 :: bool\r\n  L1:\r\n      r2 = x >> 1                               (diff)\r\n      r3 = r2                                   (diff)\r\n      goto L3                                   (diff)\r\n  L2:                                           (diff)\r\n      r4 = x ^ 1                                (diff)\r\n      r5 = r4                                   (diff)\r\n      r6 = CPyLong_AsInt64(r5)                  (diff)\r\n      r3 = r6                                   (diff)\r\n      keep_alive x                              (diff)\r\n  L3:                                           (diff)\r\n      return r3                                 (diff)\r\nActual:\r\n  ...\r\n  def cast_int(x):\r\n      x :: int\r\n      r0 :: native_int\r\n      r1 :: bit\r\n      r2, r3, r4 :: int64                       (diff)\r\n      r5 :: ptr                                 (diff)\r\n      r6 :: c_ptr                               (diff)\r\n      r7 :: int64                               (diff)\r\n  L0:\r\n      r0 = x & 1\r\n      r1 = r0 == 0\r\n      if r1 goto L1 else goto L2 :: bool\r\n  L1:\r\n      r2 = extend signed x: builtins.int to int64 (diff)\r\n      r3 = r2 >> 1                              (diff)\r\n      r4 = r3                                   (diff)\r\n      goto L3                                   (diff)\r\n  L2:                                           (diff)\r\n      r5 = x ^ 1                                (diff)\r\n      r6 = r5                                   (diff)\r\n      r7 = CPyLong_AsInt64(r6)                  (diff)\r\n      r4 = r7                                   (diff)\r\n      keep_alive x                              (diff)\r\n  L3:                                           (diff)\r\n      return r4                                 (diff)\r\n\r\nAlignment of first line difference:\r\n  E:     r2, r3 :: int64\r\n  A:     r2, r3, r4 :: int64\r\n               ^\r\n```\r\n**Your Environment**\r\n\r\n- Mypy version used: v1.0.0\r\n- Mypy command-line flags:\r\n- Mypy configuration options from `mypy.ini` (and other config files):\r\n- Python version used: 3.11.1\r\n","closed_by":{"login":"JukkaL","id":1107911,"node_id":"MDQ6VXNlcjExMDc5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1107911?v=4","gravatar_id":"","url":"https://api.github.com/users/JukkaL","html_url":"https://github.com/JukkaL","followers_url":"https://api.github.com/users/JukkaL/followers","following_url":"https://api.github.com/users/JukkaL/following{/other_user}","gists_url":"https://api.github.com/users/JukkaL/gists{/gist_id}","starred_url":"https://api.github.com/users/JukkaL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JukkaL/subscriptions","organizations_url":"https://api.github.com/users/JukkaL/orgs","repos_url":"https://api.github.com/users/JukkaL/repos","events_url":"https://api.github.com/users/JukkaL/events{/privacy}","received_events_url":"https://api.github.com/users/JukkaL/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/14633/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/14633/timeline","performed_via_github_app":null,"state_reason":"completed"}