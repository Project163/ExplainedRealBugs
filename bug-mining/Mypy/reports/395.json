{"url":"https://api.github.com/repos/python/mypy/issues/16533","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/16533/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/16533/comments","events_url":"https://api.github.com/repos/python/mypy/issues/16533/events","html_url":"https://github.com/python/mypy/issues/16533","id":2004110272,"node_id":"I_kwDOAGuhRc53dEvA","number":16533,"title":"Internal error with an alias type that is a callable with an unpacked tuple as args","user":{"login":"Drache91","id":2191594,"node_id":"MDQ6VXNlcjIxOTE1OTQ=","avatar_url":"https://avatars.githubusercontent.com/u/2191594?v=4","gravatar_id":"","url":"https://api.github.com/users/Drache91","html_url":"https://github.com/Drache91","followers_url":"https://api.github.com/users/Drache91/followers","following_url":"https://api.github.com/users/Drache91/following{/other_user}","gists_url":"https://api.github.com/users/Drache91/gists{/gist_id}","starred_url":"https://api.github.com/users/Drache91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Drache91/subscriptions","organizations_url":"https://api.github.com/users/Drache91/orgs","repos_url":"https://api.github.com/users/Drache91/repos","events_url":"https://api.github.com/users/Drache91/events{/privacy}","received_events_url":"https://api.github.com/users/Drache91/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":379446833,"node_id":"MDU6TGFiZWwzNzk0NDY4MzM=","url":"https://api.github.com/repos/python/mypy/labels/crash","name":"crash","color":"b60205","default":false,"description":null},{"id":3945135234,"node_id":"LA_kwDOAGuhRc7rJfyC","url":"https://api.github.com/repos/python/mypy/labels/topic-type-alias","name":"topic-type-alias","color":"51FABE","default":false,"description":"TypeAlias and other type alias issues"},{"id":3945158431,"node_id":"LA_kwDOAGuhRc7rJlcf","url":"https://api.github.com/repos/python/mypy/labels/topic-pep-646","name":"topic-pep-646","color":"733478","default":false,"description":"PEP 646 (TypeVarTuple, Unpack)"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-11-21T11:53:15Z","updated_at":"2023-12-12T19:12:28Z","closed_at":"2023-12-12T19:12:27Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Bug Report**\r\n\r\nMypy crashes (errors) when using an aliased `Callable` with an unpacked `Tuple` within the arguments part. The definition throws no errors and using the type without the use of an alias is also working fine.\r\n\r\nmypy version: 1.7.0\r\npython version: 3.11.2\r\n\r\n**To Reproduce**\r\n\r\nThis is the smallest reproduction I could come up with. The error occours with the definition of `f2` where the type alias `_CallableValue` is used.\r\n\r\n```python\r\nfrom typing import Callable, Any, Tuple, Unpack\r\n\r\n\r\n_CallableValue = Callable[[Unpack[Tuple[Any, ...]]], Any]  # This is fine\r\n\r\ndef f(fun: Callable[[Unpack[Tuple[Any, ...]]], Any]) -> None: ...  # This is fine\r\n\r\ndef f2(fun: _CallableValue) -> None: ...  # Mypy errors here with an internal error\r\n\r\n```\r\n([Playground](https://mypy-play.net/?mypy=1.7.0&python=3.11&flags=show-traceback&gist=9adb1b244c3693114130f82525cf42c8))\r\n\r\n**Expected Behavior**\r\n\r\nI would expect mypy to not have an internal error and instead produce a success result.\r\n\r\n**Actual Behavior**\r\n\r\nMypy has an internal error.\r\n\r\nOutput with my projects environment (VSCode, Python 3.11.2, mypy 1.7.0 (compiled: yes)):\r\n\r\n```Stacktrace\r\n2023-11-21 12:20:06.389 [info] [Trace - 12:20:06 PM] Sending notification 'textDocument/didSave'.\r\n2023-11-21 12:20:06.397 [info] [Trace - 12:20:06 PM] Received notification 'window/logMessage'.\r\n2023-11-21 12:20:06.397 [info] venv/Scripts/python.exe -m mypy --no-color-output --no-error-summary --show-absolute-path --show-column-numbers --show-error-codes --no-pretty --show-traceback --show-error-end c:\\Users\\[PROJECT_PATH]\\.vscode\\mypytest.py\r\n2023-11-21 12:20:06.398 [info] [Trace - 12:20:06 PM] Received notification 'window/logMessage'.\r\n2023-11-21 12:20:06.398 [info] CWD Server: c:\\Users\\[PROJECT_PATH]\r\n2023-11-21 12:20:07.125 [info] [Trace - 12:20:07 PM] Received notification 'window/logMessage'.\r\n2023-11-21 12:20:07.125 [info] c:\\Users\\[PROJECT_PATH]\\.vscode\\mypytest.py:7: error: INTERNAL ERROR -- Please try using mypy master on GitHub:\r\nhttps://mypy.readthedocs.io/en/stable/common_issues.html#using-a-development-mypy-build\r\nPlease report a bug at https://github.com/python/mypy/issues\r\nversion: 1.7.0\r\nc:\\Users\\[PROJECT_PATH]\\.vscode\\mypytest.py:7: : note: use --pdb to drop into pdb\r\n\r\n2023-11-21 12:20:07.126 [info] [Trace - 12:20:07 PM] Received notification 'window/logMessage'.\r\n2023-11-21 12:20:07.126 [info] file:///c%3A/Users/[PROJECT_PATH]/.vscode/mypytest.py :\r\nTraceback (most recent call last):\r\n  File \"<frozen runpy>\", line 198, in _run_module_as_main\r\n  File \"<frozen runpy>\", line 88, in _run_code\r\n  File \"mypy\\semanal.py\", line 6525, in accept\r\n  File \"mypy\\nodes.py\", line 785, in accept\r\n  File \"mypy\\semanal.py\", line 832, in visit_func_def\r\n  File \"mypy\\semanal.py\", line 866, in analyze_func_def\r\n  File \"mypy\\semanal_shared.py\", line 373, in has_placeholder\r\n  File \"mypy\\types.py\", line 1964, in accept\r\n  File \"mypy\\type_visitor.py\", line 505, in visit_callable_type\r\n  File \"mypy\\type_visitor.py\", line 557, in query_types\r\n  File \"mypy\\types.py\", line 395, in accept\r\n  File \"mypy\\type_visitor.py\", line 550, in visit_type_alias_type\r\n  File \"mypy\\types.py\", line 3072, in get_proper_type\r\n  File \"mypy\\types.py\", line 337, in _expand_once\r\n  File \"mypy\\types.py\", line 1964, in accept\r\n  File \"mypy\\expandtype.py\", line 368, in visit_callable_type\r\n  File \"mypy\\expandtype.py\", line 317, in interpolate_args_for_unpack\r\nAssertionError: \r\n\r\n2023-11-21 12:20:07.126 [info] [Trace - 12:20:07 PM] Received notification 'window/logMessage'.\r\n2023-11-21 12:20:07.126 [info] file:///c%3A/Users/[PROJECT_PATH]/.vscode/mypytest.py :\r\nTraceback (most recent call last):\r\n  File \"<frozen runpy>\", line 198, in _run_module_as_main\r\n  File \"<frozen runpy>\", line 88, in _run_code\r\n  File \"mypy\\semanal.py\", line 6525, in accept\r\n  File \"mypy\\nodes.py\", line 785, in accept\r\n  File \"mypy\\semanal.py\", line 832, in visit_func_def\r\n  File \"mypy\\semanal.py\", line 866, in analyze_func_def\r\n  File \"mypy\\semanal_shared.py\", line 373, in has_placeholder\r\n  File \"mypy\\types.py\", line 1964, in accept\r\n  File \"mypy\\type_visitor.py\", line 505, in visit_callable_type\r\n  File \"mypy\\type_visitor.py\", line 557, in query_types\r\n  File \"mypy\\types.py\", line 395, in accept\r\n  File \"mypy\\type_visitor.py\", line 550, in visit_type_alias_type\r\n  File \"mypy\\types.py\", line 3072, in get_proper_type\r\n  File \"mypy\\types.py\", line 337, in _expand_once\r\n  File \"mypy\\types.py\", line 1964, in accept\r\n  File \"mypy\\expandtype.py\", line 368, in visit_callable_type\r\n  File \"mypy\\expandtype.py\", line 317, in interpolate_args_for_unpack\r\nAssertionError: \r\n\r\n2023-11-21 12:20:07.126 [info] [Trace - 12:20:07 PM] Received notification 'textDocument/publishDiagnostics'.\r\n```\r\n\r\nPlayground gist output (Python 3.11 and mypy 1.7.0)\r\n\r\n```stacktrace\r\nFailed (exit code: 2) (3302 ms)\r\n\r\nTraceback (most recent call last):\r\n  File \"<frozen runpy>\", line 198, in _run_module_as_main\r\n  File \"<frozen runpy>\", line 88, in _run_code\r\n  File \"mypy/semanal.py\", line 6525, in accept\r\n  File \"mypy/nodes.py\", line 785, in accept\r\n  File \"mypy/semanal.py\", line 832, in visit_func_def\r\n  File \"mypy/semanal.py\", line 866, in analyze_func_def\r\n  File \"mypy/semanal_shared.py\", line 373, in has_placeholder\r\n  File \"mypy/types.py\", line 1964, in accept\r\n  File \"mypy/type_visitor.py\", line 505, in visit_callable_type\r\n  File \"mypy/type_visitor.py\", line 557, in query_types\r\n  File \"mypy/types.py\", line 395, in accept\r\n  File \"mypy/type_visitor.py\", line 550, in visit_type_alias_type\r\n  File \"mypy/types.py\", line 3072, in get_proper_type\r\n  File \"mypy/types.py\", line 337, in _expand_once\r\n  File \"mypy/types.py\", line 1964, in accept\r\n  File \"mypy/expandtype.py\", line 368, in visit_callable_type\r\n  File \"mypy/expandtype.py\", line 317, in interpolate_args_for_unpack\r\nAssertionError: \r\n\r\nmain.py:8: error: INTERNAL ERROR -- Please try using mypy master on GitHub:\r\nhttps://mypy.readthedocs.io/en/stable/common_issues.html#using-a-development-mypy-build\r\nPlease report a bug at https://github.com/python/mypy/issues\r\nversion: 1.7.0\r\nmain.py:8: : note: use --pdb to drop into pdb\r\n```\r\n\r\n**Your Environment**\r\n\r\n- Mypy version used: 1.7.0 (compiled: yes)\r\n- Mypy command-line flags: `-no-color-output --no-error-summary --show-absolute-path --show-column-numbers --show-error-codes --no-pretty --show-traceback --show-error-end c:\\Users\\[PROJECT_PATH]\\.vscode\\mypytest.py`\r\n- Mypy configuration options from `mypy.ini` (and other config files):\r\n```cfg\r\n[mypy]\r\nplugins = pydantic.mypy\r\nfollow_imports = silent\r\nwarn_redundant_casts = True\r\ndisallow_untyped_defs = True\r\ndisallow_any_unimported = False\r\nno_implicit_optional = True\r\ncheck_untyped_defs = True\r\nwarn_return_any = True\r\nshow_error_codes = True\r\nwarn_unused_ignores = True\r\n```\r\n- Python version used: 3.11.2\r\n\r\n(It's reproducable on the mypy playground, please see the \"Playground\"-link at the bottom of the \"To Reproduce\"-section.)\r\n\r\n","closed_by":{"login":"JukkaL","id":1107911,"node_id":"MDQ6VXNlcjExMDc5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1107911?v=4","gravatar_id":"","url":"https://api.github.com/users/JukkaL","html_url":"https://github.com/JukkaL","followers_url":"https://api.github.com/users/JukkaL/followers","following_url":"https://api.github.com/users/JukkaL/following{/other_user}","gists_url":"https://api.github.com/users/JukkaL/gists{/gist_id}","starred_url":"https://api.github.com/users/JukkaL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JukkaL/subscriptions","organizations_url":"https://api.github.com/users/JukkaL/orgs","repos_url":"https://api.github.com/users/JukkaL/repos","events_url":"https://api.github.com/users/JukkaL/events{/privacy}","received_events_url":"https://api.github.com/users/JukkaL/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/16533/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/16533/timeline","performed_via_github_app":null,"state_reason":"completed"}