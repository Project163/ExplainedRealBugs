{"url":"https://api.github.com/repos/python/mypy/issues/12678","repository_url":"https://api.github.com/repos/python/mypy","labels_url":"https://api.github.com/repos/python/mypy/issues/12678/labels{/name}","comments_url":"https://api.github.com/repos/python/mypy/issues/12678/comments","events_url":"https://api.github.com/repos/python/mypy/issues/12678/events","html_url":"https://github.com/python/mypy/issues/12678","id":1217265613,"node_id":"I_kwDOAGuhRc5Ijf_N","number":12678,"title":"Can not find \"numpy.core._multiarray_umath\" if numpy is installed via pip with --target argument.","user":{"login":"oxidase","id":4421046,"node_id":"MDQ6VXNlcjQ0MjEwNDY=","avatar_url":"https://avatars.githubusercontent.com/u/4421046?v=4","gravatar_id":"","url":"https://api.github.com/users/oxidase","html_url":"https://github.com/oxidase","followers_url":"https://api.github.com/users/oxidase/followers","following_url":"https://api.github.com/users/oxidase/following{/other_user}","gists_url":"https://api.github.com/users/oxidase/gists{/gist_id}","starred_url":"https://api.github.com/users/oxidase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oxidase/subscriptions","organizations_url":"https://api.github.com/users/oxidase/orgs","repos_url":"https://api.github.com/users/oxidase/repos","events_url":"https://api.github.com/users/oxidase/events{/privacy}","received_events_url":"https://api.github.com/users/oxidase/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":21488356,"node_id":"MDU6TGFiZWwyMTQ4ODM1Ng==","url":"https://api.github.com/repos/python/mypy/labels/bug","name":"bug","color":"f9d0c4","default":true,"description":"mypy got something wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-04-27T12:12:01Z","updated_at":"2022-08-11T12:36:17Z","closed_at":"2022-08-11T12:36:17Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  If you're new to mypy and you're not sure whether what you're experiencing is a mypy bug, please see the \"Question and Help\" form\r\n  instead.\r\n  Please also consider:\r\n\r\n  - checking our common issues page: https://mypy.readthedocs.io/en/stable/common_issues.html\r\n  - searching our issue tracker: https://github.com/python/mypy/issues to see if\r\n    it's already been reported\r\n  - asking on gitter chat: https://gitter.im/python/typing\r\n-->\r\n\r\n**Bug Report**\r\n\r\n<!--\r\nNote: If the problem you are reporting is about a specific library function, then the typeshed tracker is better suited\r\nfor this report: https://github.com/python/typeshed/issues\r\n-->\r\n\r\n\r\nWhen `numpy` is installed with a non-user or a non-system directory the is specified in `MYPYPATH` path mypy fails with some missing modules.\r\n\r\n**To Reproduce**\r\n\r\n\r\n1. `python3 -m pip install --user mypy`\r\n2. `python3 -m pip install --target=$HOME/tmp/site-packages numpy`\r\n3.\r\n```\r\ncat > $HOME/tmp/test.py <<EOF\r\nfrom typing import Any, TYPE_CHECKING\r\nimport numpy as np\r\nimport numpy.typing as npt\r\n\r\na: npt.NDArray[Any] = np.ndarray((2,3))\r\nif TYPE_CHECKING:\r\n    reveal_type(a)\r\nEOF\r\n````\r\n4. `MYPYPATH=$HOME/tmp/site-packages python3 -m mypy $HOME/tmp/test.py`\r\n```\r\ntmp/site-packages/numpy/core/umath.py:10: error: Cannot find implementation or library stub for module named \"numpy.core._multiarray_umath\"\r\ntmp/site-packages/numpy/core/umath.py:10: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports\r\ntmp/site-packages/numpy/typing/_generic_alias.py:66: error: \"object\" has no attribute \"__parameters__\"\r\n...\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:2937: note: If it is meant to be abstract, add 'abc.ABCMeta' as an explicit metaclass\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:3034: error: Class numpy.flexible has abstract attributes \"__init__\"\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:3034: note: If it is meant to be abstract, add 'abc.ABCMeta' as an explicit metaclass\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:3060: error: Class numpy.character has abstract attributes \"__init__\"\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:3060: note: If it is meant to be abstract, add 'abc.ABCMeta' as an explicit metaclass\r\nFound 166 errors in 21 files (checked 1 source file)\r\n```\r\n\r\n**Expected Behavior**\r\n\r\n<!--\r\n  How did you expect your project to behave?\r\n  It’s fine if you’re not sure your understanding is correct.\r\n  Write down what you thought would happen. If you just expected no errors, you can delete this section.\r\n-->\r\n\r\nI would expect that mypy at step 4 works similar to \r\n```\r\npython3 -m pip install --user numpy\r\npython3 -m mypy $HOME/tmp/test.py\r\ntmp/test.py:7: note: Revealed type is \"numpy.ndarray[Any, numpy.dtype[Any]]\"\r\n```\r\n\r\n**Actual Behavior**\r\n\r\n<!--\r\n  Did something go wrong?\r\n  Is something broken, or not behaving as you expected?\r\n-->\r\n\r\n```\r\nMYPYPATH=$HOME/tmp/site-packages python3 -m mypy $HOME/tmp/test.py\r\ntmp/site-packages/numpy/core/umath.py:10: error: Cannot find implementation or library stub for module named \"numpy.core._multiarray_umath\"\r\ntmp/site-packages/numpy/core/umath.py:10: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports\r\ntmp/site-packages/numpy/typing/_generic_alias.py:66: error: \"object\" has no attribute \"__parameters__\"\r\ntmp/site-packages/numpy/typing/_generic_alias.py:67: error: Value of type \"object\" is not indexable\r\ntmp/site-packages/numpy/typing/_generic_alias.py:170: error: Argument 2 to \"_reconstruct_alias\" has incompatible type \"Iterator[object]\"; expected \"Iterator[TypeVar]\"\r\ntmp/site-packages/numpy/typing/_add_docstring.py:38: error: Need type annotation for \"new_lines\" (hint: \"new_lines: List[<type>] = ...\")\r\ntmp/site-packages/numpy/lib/polynomial.pyi:59: error: Overloaded function signatures 1 and 2 overlap with incompatible return types\r\ntmp/site-packages/numpy/lib/polynomial.pyi:59: error: Overloaded function signatures 1 and 3 overlap with incompatible return types\r\n...\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:3034: error: Class numpy.flexible has abstract attributes \"__init__\"\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:3034: note: If it is meant to be abstract, add 'abc.ABCMeta' as an explicit metaclass\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:3060: error: Class numpy.character has abstract attributes \"__init__\"\r\ntmp/site-packages/numpy/typing/_ufunc.pyi:3060: note: If it is meant to be abstract, add 'abc.ABCMeta' as an explicit metaclass\r\nFound 166 errors in 21 files (checked 1 source file)\r\n```\r\n\r\n**Your Environment**\r\n\r\n<!-- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Mypy version used: 0.942\r\n- Mypy command-line flags: `MYPYPATH=$HOME/tmp/site-packages mypy $HOME/tmp/test.py`\r\n- Mypy configuration options from `mypy.ini` (and other config files): --\r\n- Python version used: 3.8.10\r\n- Operating system and version: Ubuntu 20.04\r\n","closed_by":{"login":"JukkaL","id":1107911,"node_id":"MDQ6VXNlcjExMDc5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1107911?v=4","gravatar_id":"","url":"https://api.github.com/users/JukkaL","html_url":"https://github.com/JukkaL","followers_url":"https://api.github.com/users/JukkaL/followers","following_url":"https://api.github.com/users/JukkaL/following{/other_user}","gists_url":"https://api.github.com/users/JukkaL/gists{/gist_id}","starred_url":"https://api.github.com/users/JukkaL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JukkaL/subscriptions","organizations_url":"https://api.github.com/users/JukkaL/orgs","repos_url":"https://api.github.com/users/JukkaL/repos","events_url":"https://api.github.com/users/JukkaL/events{/privacy}","received_events_url":"https://api.github.com/users/JukkaL/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python/mypy/issues/12678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python/mypy/issues/12678/timeline","performed_via_github_app":null,"state_reason":"completed"}