<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:38:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SLING-7320] NPE in sling commons threads</title>
                <link>https://issues.apache.org/jira/browse/SLING-7320</link>
                <project id="12310710" key="SLING">Sling</project>
                    <description>&lt;p&gt;I&apos;m currently running a number of integration tests via pax exam and sometimes I see the following stacktrace. I&apos;ve already seen this in a running sling also. This happens only in some runs but on that cases is breaking my CI workflow&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;sling-default-5&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.ThreadLocalCleaner.copy(ThreadLocalCleaner.java:186)&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.ThreadLocalCleaner.saveOldThreadLocals(ThreadLocalCleaner.java:176)&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.ThreadLocalCleaner.&amp;lt;init&amp;gt;(ThreadLocalCleaner.java:51)&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.ThreadPoolExecutorCleaningThreadLocals.beforeExecute(ThreadPoolExecutorCleaningThreadLocals.java:55)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1146)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;</description>
                <environment>Linux, jdk18</environment>
        <key id="13126255">SLING-7320</key>
            <summary>NPE in sling commons threads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwin">Konrad Windszus</assignee>
                                    <reporter username="ivoleitao">Ivo Leit&#227;o</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Dec 2017 11:46:11 +0000</created>
                <updated>Fri, 26 Jan 2018 15:49:32 +0000</updated>
                            <resolved>Thu, 25 Jan 2018 13:39:59 +0000</resolved>
                                    <version>Commons Threads 3.2.10</version>
                                    <fixVersion>Commons Threads 3.2.16</fixVersion>
                                    <component>Commons</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16298367" author="kwin" created="Wed, 20 Dec 2017 12:07:26 +0000"  >&lt;p&gt;This looks related to the NPE observed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-6261?focusedCommentId=16174537&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16174537&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SLING-6261?focusedCommentId=16174537&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16174537&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16298433" author="ivoleitao" created="Wed, 20 Dec 2017 12:52:58 +0000"  >&lt;p&gt;Yes, it&apos;s similar but this one it&apos;s on the copy method. On that example I&apos;ve not seen a NPE on that method&lt;/p&gt;

&lt;p&gt;Regards,  &lt;/p&gt;</comment>
                            <comment id="16302632" author="ivoleitao" created="Sun, 24 Dec 2017 01:08:26 +0000"  >&lt;p&gt;Just to update this issue I&apos;ve just catched this exception in the change method also. Stacktrace bellow:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;sling-default-1&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.DefaultThreadPool$LoggingThreadLocalChangeListener.changed(DefaultThreadPool.java:160)&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.ThreadLocalCleaner.changed(ThreadLocalCleaner.java:141)&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.ThreadLocalCleaner.diff(ThreadLocalCleaner.java:119)&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.ThreadLocalCleaner.cleanup(ThreadLocalCleaner.java:79)&lt;br/&gt;
	at org.apache.sling.commons.threads.impl.ThreadPoolExecutorCleaningThreadLocals.afterExecute(ThreadPoolExecutorCleaningThreadLocals.java:63)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1157)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;</comment>
                            <comment id="16335881" author="kwin" created="Tue, 23 Jan 2018 14:59:05 +0000"  >&lt;p&gt;The latter NPE can only happen if listener is &lt;tt&gt;null&lt;/tt&gt;. &lt;tt&gt;listener&lt;/tt&gt; is a final field in &lt;tt&gt;ThreadLocalCleaner&lt;/tt&gt; and is set only once in the constructor. Can you give a test case how to reproduce? At least from within Sling the listener can never be &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The former NPE can only happen if the initReflectionFields() method has thrown an exception (which may happen with other JDKs than OpenJDK/Oracle). I will guard around this better in the future.&lt;/p&gt;</comment>
                            <comment id="16335915" author="kwin" created="Tue, 23 Jan 2018 15:23:31 +0000"  >&lt;p&gt;Prevented the NPE in copy with &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-commons-threads/commit/bb1ec98753d7972a63d961e81725796ac2a918a8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-commons-threads/commit/bb1ec98753d7972a63d961e81725796ac2a918a8&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16339222" author="rombert" created="Thu, 25 Jan 2018 13:39:59 +0000"  >&lt;p&gt;Looks like this is fixed, resolving. Please let us know if this happens with the upcoming 3.2.14 release ( release vote will start shortly )&lt;/p&gt;</comment>
                            <comment id="16341182" author="kwin" created="Fri, 26 Jan 2018 15:49:32 +0000"  >&lt;p&gt;Actually my fix was not sufficient. The correct fix for the first NPE is now in &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-7447&quot; title=&quot;Race condition in ThreadLocalCleaner initialization code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-7447&quot;&gt;&lt;del&gt;SLING-7447&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13133854">SLING-7447</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13019472">SLING-6261</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3o4jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>