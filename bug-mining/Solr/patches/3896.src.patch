diff --git a/solr/CHANGES.txt b/solr/CHANGES.txt
index a9e63f3d143..ff8283841e4 100644
--- a/solr/CHANGES.txt
+++ b/solr/CHANGES.txt
@@ -180,6 +180,8 @@ Bug Fixes
 * SOLR-9304: Fix Solr's HTTP handling to respect '-Dsolr.ssl.checkPeerName=false' aka SOLR_SSL_CHECK_PEER_NAME
   (Shawn Heisey, Carlton Findley, Robby Pond, hossman)
 
+* SOLR-12250: NegativeArraySizeException on TransactionLog if previous document more than 1.9GB (Cao Manh Dat)
+
 Optimizations
 ----------------------
 
diff --git a/solr/core/src/java/org/apache/solr/update/TransactionLog.java b/solr/core/src/java/org/apache/solr/update/TransactionLog.java
index 35d722b734f..be4dabc39d6 100644
--- a/solr/core/src/java/org/apache/solr/update/TransactionLog.java
+++ b/solr/core/src/java/org/apache/solr/update/TransactionLog.java
@@ -379,7 +379,8 @@ public class TransactionLog implements Closeable {
 
       // adaptive buffer sizing
       int bufSize = lastAddSize;    // unsynchronized access of lastAddSize should be fine
-      bufSize = Math.min(1024*1024, bufSize+(bufSize>>3)+256);
+      // at least 256 bytes and at most 1 MB
+      bufSize = Math.min(1024*1024, Math.max(256, bufSize+(bufSize>>3)+256));
 
       MemOutputStream out = new MemOutputStream(new byte[bufSize]);
       codec.init(out);
diff --git a/solr/core/src/test/org/apache/solr/update/TransactionLogTest.java b/solr/core/src/test/org/apache/solr/update/TransactionLogTest.java
new file mode 100644
index 00000000000..944b2ee9aa5
--- /dev/null
+++ b/solr/core/src/test/org/apache/solr/update/TransactionLogTest.java
@@ -0,0 +1,45 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.solr.update;
+
+import java.io.IOException;
+import java.nio.file.Files;
+import java.util.ArrayList;
+import java.util.Locale;
+
+import org.apache.lucene.util.LuceneTestCase;
+import org.apache.solr.common.SolrInputDocument;
+import org.junit.Test;
+
+import static org.mockito.Mockito.*;
+
+public class TransactionLogTest extends LuceneTestCase {
+
+  @Test
+  public void testBigLastAddSize() throws IOException {
+    String tlogFileName = String.format(Locale.ROOT, UpdateLog.LOG_FILENAME_PATTERN, UpdateLog.TLOG_NAME, 0);
+    try (TransactionLog transactionLog = new TransactionLog(Files.createTempFile(tlogFileName, "").toFile(), new ArrayList<>())) {
+      transactionLog.lastAddSize = 2000000000;
+      AddUpdateCommand updateCommand = mock(AddUpdateCommand.class);
+      when(updateCommand.isInPlaceUpdate()).thenReturn(false);
+      when(updateCommand.getSolrInputDocument()).thenReturn(new SolrInputDocument());
+      transactionLog.write(updateCommand, 0);
+    }
+  }
+
+}
