diff --git a/dev-tools/idea/.idea/libraries/Solrj_test_library.xml b/dev-tools/idea/.idea/libraries/Solrj_test_library.xml
deleted file mode 100644
index 5ff1abf52f8..00000000000
--- a/dev-tools/idea/.idea/libraries/Solrj_test_library.xml
+++ /dev/null
@@ -1,10 +0,0 @@
-<component name="libraryTable">
-  <library name="Solrj test library">
-    <CLASSES>
-      <root url="file://$PROJECT_DIR$/solr/solrj/test-lib" />
-    </CLASSES>
-    <JAVADOC />
-    <SOURCES />
-    <jarDirectory url="file://$PROJECT_DIR$/solr/solrj/test-lib" recursive="false" />
-  </library>
-</component>
\ No newline at end of file
diff --git a/dev-tools/idea/solr/contrib/analysis-extras/analysis-extras.iml b/dev-tools/idea/solr/contrib/analysis-extras/analysis-extras.iml
index 85878b8e743..b43efb544b6 100644
--- a/dev-tools/idea/solr/contrib/analysis-extras/analysis-extras.iml
+++ b/dev-tools/idea/solr/contrib/analysis-extras/analysis-extras.iml
@@ -27,6 +27,16 @@
     <orderEntry type="library" scope="TEST" name="JUnit" level="project" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="module" module-name="morfologik" />
     <orderEntry type="module" module-name="icu" />
     <orderEntry type="module" module-name="smartcn" />
diff --git a/dev-tools/idea/solr/contrib/clustering/clustering.iml b/dev-tools/idea/solr/contrib/clustering/clustering.iml
index f19a3b5706a..b54d347c54d 100644
--- a/dev-tools/idea/solr/contrib/clustering/clustering.iml
+++ b/dev-tools/idea/solr/contrib/clustering/clustering.iml
@@ -27,6 +27,16 @@
     <orderEntry type="library" scope="TEST" name="JUnit" level="project" />
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="module" module-name="highlighter" />
     <orderEntry type="module" module-name="memory" />
     <orderEntry type="module" module-name="misc" />
diff --git a/dev-tools/idea/solr/contrib/dataimporthandler-extras/dataimporthandler-extras.iml b/dev-tools/idea/solr/contrib/dataimporthandler-extras/dataimporthandler-extras.iml
index ced9613a687..a41171fb083 100644
--- a/dev-tools/idea/solr/contrib/dataimporthandler-extras/dataimporthandler-extras.iml
+++ b/dev-tools/idea/solr/contrib/dataimporthandler-extras/dataimporthandler-extras.iml
@@ -14,6 +14,16 @@
     <orderEntry type="library" scope="TEST" name="JUnit" level="project" />
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="library" name="Solr core library" level="project" />
     <orderEntry type="library" name="Solrj library" level="project" />
     <orderEntry type="library" name="Solr DIH library" level="project" />
diff --git a/dev-tools/idea/solr/contrib/extraction/extraction.iml b/dev-tools/idea/solr/contrib/extraction/extraction.iml
index fc729a9763d..2413752bd90 100644
--- a/dev-tools/idea/solr/contrib/extraction/extraction.iml
+++ b/dev-tools/idea/solr/contrib/extraction/extraction.iml
@@ -14,6 +14,16 @@
     <orderEntry type="library" scope="TEST" name="JUnit" level="project" />
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="library" name="Solr core library" level="project" />
     <orderEntry type="library" name="Solrj library" level="project" />
     <orderEntry type="library" name="Solr extraction library" level="project" />
diff --git a/dev-tools/idea/solr/contrib/langid/langid.iml b/dev-tools/idea/solr/contrib/langid/langid.iml
index 8a95345a5bf..879ad34655c 100644
--- a/dev-tools/idea/solr/contrib/langid/langid.iml
+++ b/dev-tools/idea/solr/contrib/langid/langid.iml
@@ -28,6 +28,16 @@
     </orderEntry>
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="module" module-name="solr-core" />
     <orderEntry type="module" module-name="solrj" />
   </component>
diff --git a/dev-tools/idea/solr/contrib/map-reduce/map-reduce.iml b/dev-tools/idea/solr/contrib/map-reduce/map-reduce.iml
index 572e1d838ac..fd2c86d2615 100644
--- a/dev-tools/idea/solr/contrib/map-reduce/map-reduce.iml
+++ b/dev-tools/idea/solr/contrib/map-reduce/map-reduce.iml
@@ -21,6 +21,16 @@
     <orderEntry type="library" scope="TEST" name="Solr example library" level="project" />
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="module" module-name="solr-core" />
     <orderEntry type="module" module-name="solrj" />
     <orderEntry type="module" module-name="misc" />
diff --git a/dev-tools/idea/solr/contrib/morphlines-cell/morphlines-cell.iml b/dev-tools/idea/solr/contrib/morphlines-cell/morphlines-cell.iml
index a4198a13b32..94078051c95 100644
--- a/dev-tools/idea/solr/contrib/morphlines-cell/morphlines-cell.iml
+++ b/dev-tools/idea/solr/contrib/morphlines-cell/morphlines-cell.iml
@@ -21,6 +21,16 @@
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="lucene-core" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="module" module-name="solr-core" />
     <orderEntry type="module" module-name="solrj" />
     <orderEntry type="module" module-name="extraction" />
diff --git a/dev-tools/idea/solr/contrib/uima/uima.iml b/dev-tools/idea/solr/contrib/uima/uima.iml
index b765a2cce78..be03e9f4676 100644
--- a/dev-tools/idea/solr/contrib/uima/uima.iml
+++ b/dev-tools/idea/solr/contrib/uima/uima.iml
@@ -27,6 +27,16 @@
     </orderEntry>
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="module" module-name="solr-core" />
     <orderEntry type="module" module-name="solrj" />
     <orderEntry type="module" module-name="lucene-core" />
diff --git a/dev-tools/idea/solr/contrib/velocity/velocity.iml b/dev-tools/idea/solr/contrib/velocity/velocity.iml
index 63080198597..816601f1f3a 100644
--- a/dev-tools/idea/solr/contrib/velocity/velocity.iml
+++ b/dev-tools/idea/solr/contrib/velocity/velocity.iml
@@ -17,6 +17,16 @@
     <orderEntry type="library" name="Solr velocity library" level="project" />
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="module" module-name="lucene-core" />
     <orderEntry type="module" module-name="solr-core" />
     <orderEntry type="module" module-name="solrj" />
diff --git a/dev-tools/idea/solr/solrj/src/test/solrj-tests.iml b/dev-tools/idea/solr/solrj/src/test/solrj-tests.iml
index 9ec607cf929..9718e70e1d1 100644
--- a/dev-tools/idea/solr/solrj/src/test/solrj-tests.iml
+++ b/dev-tools/idea/solr/solrj/src/test/solrj-tests.iml
@@ -12,7 +12,16 @@
     <orderEntry type="library" scope="TEST" name="JUnit" level="project" />
     <orderEntry type="library" scope="TEST" name="Solr core library" level="project" />
     <orderEntry type="library" scope="TEST" name="Solrj library" level="project" />
-    <orderEntry type="library" scope="TEST" name="Solrj test library" level="project" />
+    <orderEntry type="module-library" scope="TEST">
+      <library>
+        <CLASSES>
+          <root url="file://$MODULE_DIR$/test-lib" />
+        </CLASSES>
+        <JAVADOC />
+        <SOURCES />
+        <jarDirectory url="file://$MODULE_DIR$/test-lib" recursive="false" />
+      </library>
+    </orderEntry>
     <orderEntry type="library" scope="TEST" name="Solr example library" level="project" />
     <orderEntry type="module" scope="TEST" module-name="lucene-test-framework" />
     <orderEntry type="module" scope="TEST" module-name="solr-test-framework" />
diff --git a/solr/CHANGES.txt b/solr/CHANGES.txt
index 82bac73706c..3a83dcb1551 100644
--- a/solr/CHANGES.txt
+++ b/solr/CHANGES.txt
@@ -138,9 +138,9 @@ Other Changes
 Build
 ---------------------
 
-* SOLR-6006: Separate test and compile scope dependencies in the Solrj ivy.xml
-  file, so that the derived Maven dependencies get filled out properly in the
-  Solrj POM. (Steven Scott, Steve Rowe)
+* SOLR-6006: Separate test and compile scope dependencies in the Solrj and
+  Solr contrib ivy.xml files, so that the derived Maven dependencies get
+  filled out properly in the corresponding POMs. (Steven Scott, Steve Rowe)
 
 ==================  4.8.0 ==================
 
diff --git a/solr/contrib/analysis-extras/build.xml b/solr/contrib/analysis-extras/build.xml
index 1c6945aaf6f..2f9c599a87e 100644
--- a/solr/contrib/analysis-extras/build.xml
+++ b/solr/contrib/analysis-extras/build.xml
@@ -17,7 +17,7 @@
     limitations under the License.
  -->
 
-<project name="solr-analysis-extras" default="default">
+<project name="solr-analysis-extras" default="default" xmlns:ivy="antlib:org.apache.ivy.ant">
 
   <description>
     Additional analysis components
@@ -43,6 +43,10 @@
     <path refid="solr.base.classpath"/>
   </path>
 
+  <path id="test.classpath">
+    <path refid="solr.test.base.classpath"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
+  </path>
 
   <!-- 
     Although the smartcn, stempel, and morfologik jars are not dependencies of
diff --git a/solr/contrib/analysis-extras/ivy.xml b/solr/contrib/analysis-extras/ivy.xml
index fe7c0dc4ed4..104963b464d 100644
--- a/solr/contrib/analysis-extras/ivy.xml
+++ b/solr/contrib/analysis-extras/ivy.xml
@@ -17,17 +17,24 @@
    under the License.    
 -->
 <ivy-module version="2.0">
-    <info organisation="org.apache.solr" module="analysis-extras"/>
-    <dependencies>
-      <dependency org="com.ibm.icu" name="icu4j" rev="${/com.ibm.icu/icu4j}" transitive="false"/>
-      <!-- 
-        Although the 3rd party morfologik jars are not dependencies of code in 
-        the analysis-extras contrib, they must remain here in order to
-        populate the Solr distribution
-       -->
-      <dependency org="org.carrot2" name="morfologik-polish" rev="${/org.carrot2/morfologik-polish}" transitive="false"/>
-      <dependency org="org.carrot2" name="morfologik-fsa" rev="${/org.carrot2/morfologik-fsa}" transitive="false"/>
-      <dependency org="org.carrot2" name="morfologik-stemming" rev="${/org.carrot2/morfologik-stemming}" transitive="false"/>
-      <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/> 
-    </dependencies>
+  <info organisation="org.apache.solr" module="analysis-extras"/>
+  <configurations>
+    <conf name="compile" transitive="false"/>
+    <conf name="test" transitive="false"/>
+  </configurations>
+  <dependencies>
+    <dependency org="com.ibm.icu" name="icu4j" rev="${/com.ibm.icu/icu4j}" conf="compile->*"/>
+    <!--
+      Although the 3rd party morfologik jars are not dependencies of code in
+      the analysis-extras contrib, they must remain here in order to
+      populate the Solr distribution
+     -->
+    <dependency org="org.carrot2" name="morfologik-polish" rev="${/org.carrot2/morfologik-polish}" conf="compile->*"/>
+    <dependency org="org.carrot2" name="morfologik-fsa" rev="${/org.carrot2/morfologik-fsa}" conf="compile->*"/>
+    <dependency org="org.carrot2" name="morfologik-stemming" rev="${/org.carrot2/morfologik-stemming}" conf="compile->*"/>
+
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
+    <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/>
+  </dependencies>
 </ivy-module>
diff --git a/solr/contrib/clustering/build.xml b/solr/contrib/clustering/build.xml
index 7a6f1a2efb0..0a4aa453044 100644
--- a/solr/contrib/clustering/build.xml
+++ b/solr/contrib/clustering/build.xml
@@ -17,11 +17,26 @@
     limitations under the License.
  -->
 
-<project name="solr-clustering" default="default">
+<project name="solr-clustering" default="default" xmlns:ivy="antlib:org.apache.ivy.ant">
 
   <description>
     Clustering Integraton
   </description>
 
+  <property name="test.lib.dir" location="test-lib"/>
+
   <import file="../contrib-build.xml"/>
+
+  <path id="test.classpath">
+    <path refid="solr.test.base.classpath"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
+  </path>
+
+  <target name="resolve" depends="ivy-availability-check,ivy-fail,ivy-configure">
+    <sequential>
+      <ivy:retrieve conf="compile" type="jar,bundle" sync="${ivy.sync}" log="download-only"/>
+      <ivy:retrieve conf="test" type="jar,bundle,test" sync="${ivy.sync}" log="download-only"
+                    pattern="${test.lib.dir}/[artifact]-[revision](-[classifier]).[ext]"/>
+    </sequential>
+  </target>
 </project>
diff --git a/solr/contrib/clustering/ivy.xml b/solr/contrib/clustering/ivy.xml
index f336018124a..b56b3ccbf92 100644
--- a/solr/contrib/clustering/ivy.xml
+++ b/solr/contrib/clustering/ivy.xml
@@ -17,27 +17,33 @@
    under the License.    
 -->
 <ivy-module version="2.0">
-    <info organisation="org.apache.solr" module="clustering"/>
-    <dependencies>
-      <dependency org="org.carrot2" name="carrot2-mini" rev="${/org.carrot2/carrot2-mini}" transitive="false"/>
+  <info organisation="org.apache.solr" module="clustering"/>
+  <configurations>
+    <conf name="compile" transitive="false"/>
+    <conf name="test" transitive="false"/>
+  </configurations>
+  <dependencies>
+    <dependency org="org.carrot2" name="carrot2-mini" rev="${/org.carrot2/carrot2-mini}" transitive="false"/>
 
-      <dependency org="com.carrotsearch" name="hppc" rev="${/com.carrotsearch/hppc}" transitive="false"/>
-      <dependency org="org.carrot2.attributes" name="attributes-binder" rev="${/org.carrot2.attributes/attributes-binder}" transitive="false"/>
-      <dependency org="org.simpleframework" name="simple-xml" rev="${/org.simpleframework/simple-xml}" transitive="false"/>
+    <dependency org="com.carrotsearch" name="hppc" rev="${/com.carrotsearch/hppc}" transitive="false"/>
+    <dependency org="org.carrot2.attributes" name="attributes-binder" rev="${/org.carrot2.attributes/attributes-binder}" transitive="false"/>
+    <dependency org="org.simpleframework" name="simple-xml" rev="${/org.simpleframework/simple-xml}" transitive="false"/>
 
-      <dependency org="org.apache.mahout" name="mahout-math" rev="${/org.apache.mahout/mahout-math}" transitive="false"/>
-      <dependency org="org.apache.mahout" name="mahout-collections" rev="${/org.apache.mahout/mahout-collections}" transitive="false"/>
+    <dependency org="org.apache.mahout" name="mahout-math" rev="${/org.apache.mahout/mahout-math}" transitive="false"/>
+    <dependency org="org.apache.mahout" name="mahout-collections" rev="${/org.apache.mahout/mahout-collections}" transitive="false"/>
 
-      <dependency org="org.codehaus.jackson" name="jackson-core-asl" rev="${/org.codehaus.jackson/jackson-core-asl}" transitive="false"/>
-      <dependency org="org.codehaus.jackson" name="jackson-mapper-asl" rev="${/org.codehaus.jackson/jackson-mapper-asl}" transitive="false"/>
+    <dependency org="org.codehaus.jackson" name="jackson-core-asl" rev="${/org.codehaus.jackson/jackson-core-asl}" transitive="false"/>
+    <dependency org="org.codehaus.jackson" name="jackson-mapper-asl" rev="${/org.codehaus.jackson/jackson-mapper-asl}" transitive="false"/>
 
-      <!--
-      Included as part of Solr's environment.
+    <!--
+    Included as part of Solr's environment.
 
-      com.google.guava:guava:jar:14.0.1:compile
-      commons-lang:commons-lang:jar:2.6:compile
-      -->
+    com.google.guava:guava:jar:14.0.1:compile
+    commons-lang:commons-lang:jar:2.6:compile
+     -->
 
-      <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/> 
-    </dependencies>
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
+    <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/>
+  </dependencies>
 </ivy-module>
diff --git a/solr/contrib/contrib-build.xml b/solr/contrib/contrib-build.xml
index fc5888b8a4b..82b2509a79d 100644
--- a/solr/contrib/contrib-build.xml
+++ b/solr/contrib/contrib-build.xml
@@ -17,10 +17,12 @@
     limitations under the License.
  -->
 
-<project name="solr-contrib-build">
+<project name="solr-contrib-build" xmlns:ivy="antlib:org.apache.ivy.ant">
   <dirname file="${ant.file.solr-contrib-build}" property="solr-contrib.dir"/>
   <property name="build.dir" location="${solr-contrib.dir}/../build/contrib/${ant.project.name}"/>
 
+  <property name="test.lib.dir" location="test-lib"/>
+
   <import file="../common-build.xml"/>
 
   <target name="compile-core" depends="compile-solr-core,compile-solrj,common-solr.compile-core"/>
@@ -44,4 +46,12 @@
       <fileset dir="${build.dir}" includes="lucene-libs/**"/>
     </copy>
   </target>
+
+  <target name="resolve" depends="ivy-availability-check,ivy-fail,ivy-configure">
+    <sequential>
+      <ivy:retrieve conf="compile" type="jar,bundle" sync="${ivy.sync}" log="download-only"/>
+      <ivy:retrieve conf="test" type="jar,bundle,test" sync="${ivy.sync}" log="download-only"
+                    pattern="${test.lib.dir}/[artifact]-[revision](-[classifier]).[ext]"/>
+    </sequential>
+  </target>
 </project>
diff --git a/solr/contrib/dataimporthandler-extras/build.xml b/solr/contrib/dataimporthandler-extras/build.xml
index b2fb410d4b0..9daf9004052 100644
--- a/solr/contrib/dataimporthandler-extras/build.xml
+++ b/solr/contrib/dataimporthandler-extras/build.xml
@@ -63,6 +63,7 @@
     <path refid="solr.test.base.classpath"/>
     <pathelement location="${common-solr.dir}/build/contrib/solr-dataimporthandler/classes/test"/>
     <path refid="classpath"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
   </path>
 
   <!-- TODO: make this nicer like lucene? -->
diff --git a/solr/contrib/dataimporthandler-extras/ivy.xml b/solr/contrib/dataimporthandler-extras/ivy.xml
index cce44a4caf7..432c6c1e9cd 100644
--- a/solr/contrib/dataimporthandler-extras/ivy.xml
+++ b/solr/contrib/dataimporthandler-extras/ivy.xml
@@ -26,5 +26,11 @@
         
         https://issues.apache.org/jira/browse/SOLR-3848
     -->
-
+  <configurations>
+    <conf name="compile" transitive="false"/>
+    <conf name="test" transitive="false"/>
+  </configurations>
+  <dependencies>
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+  </dependencies>
 </ivy-module>
diff --git a/solr/contrib/dataimporthandler/build.xml b/solr/contrib/dataimporthandler/build.xml
index 87e365faf12..a3befd85f82 100644
--- a/solr/contrib/dataimporthandler/build.xml
+++ b/solr/contrib/dataimporthandler/build.xml
@@ -17,7 +17,7 @@
     limitations under the License.
  -->
 
-<project name="solr-dataimporthandler" default="default" xmlns:ivy="antlib:org.apache.ivy.ant">
+<project name="solr-dataimporthandler" default="default">
 	
   <description>
     Data Import Handler
@@ -26,20 +26,10 @@
   <!-- the tests have some parallel problems: writability to single copy of dataimport.properties -->
   <property name="tests.jvms.override" value="1"/>
 
-  <property name="test.lib.dir" location="test-lib"/>
-  
   <import file="../contrib-build.xml"/>
 
   <path id="test.classpath">
     <path refid="solr.test.base.classpath"/>
     <fileset dir="${test.lib.dir}" includes="*.jar"/>
   </path>
-
-  <target name="resolve" depends="ivy-availability-check,ivy-fail,ivy-configure">
-    <sequential>
-      <ivy:retrieve conf="compile" type="jar,bundle" sync="${ivy.sync}" log="download-only"/>
-      <ivy:retrieve conf="test" type="jar,bundle,test" sync="${ivy.sync}" log="download-only"
-                    pattern="${test.lib.dir}/[artifact]-[revision](-[classifier]).[ext]"/>
-    </sequential>
-  </target>
 </project>
diff --git a/solr/contrib/dataimporthandler/ivy.xml b/solr/contrib/dataimporthandler/ivy.xml
index 2a6a143e8f5..1e4d9dc751c 100644
--- a/solr/contrib/dataimporthandler/ivy.xml
+++ b/solr/contrib/dataimporthandler/ivy.xml
@@ -24,11 +24,12 @@
   </configurations>
   <dependencies>
     <dependency org="javax.activation" name="activation" rev="${/javax.activation/activation}" conf="compile->*"/>
-    <dependency org="javax.mail" name="mail" rev="${/javax.mail/mail}"  conf="compile->*"/>
+    <dependency org="javax.mail" name="mail" rev="${/javax.mail/mail}" conf="compile->*"/>
 
-    <dependency org="hsqldb" name="hsqldb" rev="${/hsqldb/hsqldb}" transitive="false" conf="test->*"/>
-    <dependency org="org.apache.derby" name="derby" rev="${/org.apache.derby/derby}" transitive="false" conf="test->*"/>
-    <dependency org="org.easymock" name="easymock" rev="${/org.easymock/easymock}" transitive="false" conf="test->*"/>
+    <dependency org="hsqldb" name="hsqldb" rev="${/hsqldb/hsqldb}" conf="test->*"/>
+    <dependency org="org.apache.derby" name="derby" rev="${/org.apache.derby/derby}" conf="test->*"/>
+    <dependency org="org.easymock" name="easymock" rev="${/org.easymock/easymock}" conf="test->*"/>
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
 
     <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/> 
   </dependencies>
diff --git a/solr/contrib/extraction/build.xml b/solr/contrib/extraction/build.xml
index ab56899250e..a9505711383 100644
--- a/solr/contrib/extraction/build.xml
+++ b/solr/contrib/extraction/build.xml
@@ -25,4 +25,8 @@
 
   <import file="../contrib-build.xml"/>
 
+  <path id="test.classpath">
+    <path refid="solr.test.base.classpath"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
+  </path>
 </project>
diff --git a/solr/contrib/extraction/ivy.xml b/solr/contrib/extraction/ivy.xml
index 30af1fedc7b..bf1da736618 100644
--- a/solr/contrib/extraction/ivy.xml
+++ b/solr/contrib/extraction/ivy.xml
@@ -17,47 +17,54 @@
    under the License.    
 -->
 <ivy-module version="2.0">
-    <info organisation="org.apache.solr" module="extraction"/>
-    <dependencies>
-      <!-- Tika JARs -->
-      <dependency org="org.apache.tika" name="tika-core" rev="${/org.apache.tika/tika-core}" transitive="false"/>
-      <dependency org="org.apache.tika" name="tika-parsers" rev="${/org.apache.tika/tika-parsers}" transitive="false"/>
-      <dependency org="org.apache.tika" name="tika-xmp" rev="${/org.apache.tika/tika-xmp}" transitive="false"/>
-      <!-- Tika dependencies - see http://tika.apache.org/1.3/gettingstarted.html#Using_Tika_as_a_Maven_dependency -->
-      <!-- When upgrading Tika, upgrade dependencies versions and add any new ones
-           (except slf4j-api, commons-codec, commons-logging, geronimo-stax-api_1.0_spec) -->
-      <dependency org="org.gagravarr" name="vorbis-java-tika" rev="${/org.gagravarr/vorbis-java-tika}" transitive="false"/>
-      <dependency org="org.gagravarr" name="vorbis-java-core" rev="${/org.gagravarr/vorbis-java-core}" transitive="false"/>
-      <dependency org="edu.ucar" name="netcdf" rev="${/edu.ucar/netcdf}" transitive="false"/>
-      <dependency org="org.apache.james" name="apache-mime4j-core" rev="${/org.apache.james/apache-mime4j-core}" transitive="false"/>
-      <dependency org="org.apache.james" name="apache-mime4j-dom" rev="${/org.apache.james/apache-mime4j-dom}" transitive="false"/>
-      <dependency org="org.apache.commons" name="commons-compress" rev="${/org.apache.commons/commons-compress}" transitive="false"/>
-      <dependency org="org.apache.pdfbox" name="pdfbox" rev="${/org.apache.pdfbox/pdfbox}" transitive="false"/>
-      <dependency org="org.apache.pdfbox" name="fontbox" rev="${/org.apache.pdfbox/fontbox}" transitive="false"/>
-      <dependency org="org.apache.pdfbox" name="jempbox" rev="${/org.apache.pdfbox/jempbox}" transitive="false"/>
-      <dependency org="org.bouncycastle" name="bcmail-jdk15" rev="${/org.bouncycastle/bcmail-jdk15}" transitive="false"/>
-      <dependency org="org.bouncycastle" name="bcprov-jdk15" rev="${/org.bouncycastle/bcprov-jdk15}" transitive="false"/>
-      <dependency org="org.apache.poi" name="poi" rev="${/org.apache.poi/poi}" transitive="false"/>
-      <dependency org="org.apache.poi" name="poi-scratchpad" rev="${/org.apache.poi/poi-scratchpad}" transitive="false"/>
-      <dependency org="org.apache.poi" name="poi-ooxml" rev="${/org.apache.poi/poi-ooxml}" transitive="false"/>
-      <dependency org="org.apache.poi" name="poi-ooxml-schemas" rev="${/org.apache.poi/poi-ooxml-schemas}" transitive="false"/>
-      <dependency org="org.apache.xmlbeans" name="xmlbeans" rev="${/org.apache.xmlbeans/xmlbeans}" transitive="false"/>
-      <dependency org="dom4j" name="dom4j" rev="${/dom4j/dom4j}" transitive="false"/>
-      <dependency org="org.ccil.cowan.tagsoup" name="tagsoup" rev="${/org.ccil.cowan.tagsoup/tagsoup}" transitive="false"/>
-      <dependency org="com.googlecode.mp4parser" name="isoparser" rev="${/com.googlecode.mp4parser/isoparser}" transitive="false"/>
-      <dependency org="org.aspectj" name="aspectjrt" rev="${/org.aspectj/aspectjrt}" transitive="false"/>
-      <dependency org="com.drewnoakes" name="metadata-extractor" rev="${/com.drewnoakes/metadata-extractor}" transitive="false"/>
-      <dependency org="de.l3s.boilerpipe" name="boilerpipe" rev="${/de.l3s.boilerpipe/boilerpipe}" transitive="false"/>
-      <dependency org="rome" name="rome" rev="${/rome/rome}" transitive="false"/>
-      <dependency org="jdom" name="jdom" rev="${/jdom/jdom}" transitive="false"/>
-      <dependency org="com.googlecode.juniversalchardet" name="juniversalchardet" rev="${/com.googlecode.juniversalchardet/juniversalchardet}" transitive="false"/>
-      <dependency org="org.tukaani" name="xz" rev="${/org.tukaani/xz}" transitive="false"/>
-      <dependency org="com.adobe.xmp" name="xmpcore" rev="${/com.adobe.xmp/xmpcore}" transitive="false"/>
-      <dependency org="asm" name="asm" rev="${/asm/asm}" transitive="false"/>
+  <info organisation="org.apache.solr" module="extraction"/>
+  <configurations>
+    <conf name="compile" transitive="false"/>
+    <conf name="test" transitive="false"/>
+  </configurations>
+  <dependencies>
+    <!-- Tika JARs -->
+    <dependency org="org.apache.tika" name="tika-core" rev="${/org.apache.tika/tika-core}" conf="compile->*"/>
+    <dependency org="org.apache.tika" name="tika-parsers" rev="${/org.apache.tika/tika-parsers}" conf="compile->*"/>
+    <dependency org="org.apache.tika" name="tika-xmp" rev="${/org.apache.tika/tika-xmp}" conf="compile->*"/>
+    <!-- Tika dependencies - see http://tika.apache.org/1.3/gettingstarted.html#Using_Tika_as_a_Maven_dependency -->
+    <!-- When upgrading Tika, upgrade dependencies versions and add any new ones
+         (except slf4j-api, commons-codec, commons-logging, geronimo-stax-api_1.0_spec) -->
+    <dependency org="org.gagravarr" name="vorbis-java-tika" rev="${/org.gagravarr/vorbis-java-tika}" conf="compile->*"/>
+    <dependency org="org.gagravarr" name="vorbis-java-core" rev="${/org.gagravarr/vorbis-java-core}" conf="compile->*"/>
+    <dependency org="edu.ucar" name="netcdf" rev="${/edu.ucar/netcdf}" conf="compile->*"/>
+    <dependency org="org.apache.james" name="apache-mime4j-core" rev="${/org.apache.james/apache-mime4j-core}" conf="compile->*"/>
+    <dependency org="org.apache.james" name="apache-mime4j-dom" rev="${/org.apache.james/apache-mime4j-dom}" conf="compile->*"/>
+    <dependency org="org.apache.commons" name="commons-compress" rev="${/org.apache.commons/commons-compress}" conf="compile->*"/>
+    <dependency org="org.apache.pdfbox" name="pdfbox" rev="${/org.apache.pdfbox/pdfbox}" conf="compile->*"/>
+    <dependency org="org.apache.pdfbox" name="fontbox" rev="${/org.apache.pdfbox/fontbox}" conf="compile->*"/>
+    <dependency org="org.apache.pdfbox" name="jempbox" rev="${/org.apache.pdfbox/jempbox}" conf="compile->*"/>
+    <dependency org="org.bouncycastle" name="bcmail-jdk15" rev="${/org.bouncycastle/bcmail-jdk15}" conf="compile->*"/>
+    <dependency org="org.bouncycastle" name="bcprov-jdk15" rev="${/org.bouncycastle/bcprov-jdk15}" conf="compile->*"/>
+    <dependency org="org.apache.poi" name="poi" rev="${/org.apache.poi/poi}" conf="compile->*"/>
+    <dependency org="org.apache.poi" name="poi-scratchpad" rev="${/org.apache.poi/poi-scratchpad}" conf="compile->*"/>
+    <dependency org="org.apache.poi" name="poi-ooxml" rev="${/org.apache.poi/poi-ooxml}" conf="compile->*"/>
+    <dependency org="org.apache.poi" name="poi-ooxml-schemas" rev="${/org.apache.poi/poi-ooxml-schemas}" conf="compile->*"/>
+    <dependency org="org.apache.xmlbeans" name="xmlbeans" rev="${/org.apache.xmlbeans/xmlbeans}" conf="compile->*"/>
+    <dependency org="dom4j" name="dom4j" rev="${/dom4j/dom4j}" conf="compile->*"/>
+    <dependency org="org.ccil.cowan.tagsoup" name="tagsoup" rev="${/org.ccil.cowan.tagsoup/tagsoup}" conf="compile->*"/>
+    <dependency org="com.googlecode.mp4parser" name="isoparser" rev="${/com.googlecode.mp4parser/isoparser}" conf="compile->*"/>
+    <dependency org="org.aspectj" name="aspectjrt" rev="${/org.aspectj/aspectjrt}" conf="compile->*"/>
+    <dependency org="com.drewnoakes" name="metadata-extractor" rev="${/com.drewnoakes/metadata-extractor}" conf="compile->*"/>
+    <dependency org="de.l3s.boilerpipe" name="boilerpipe" rev="${/de.l3s.boilerpipe/boilerpipe}" conf="compile->*"/>
+    <dependency org="rome" name="rome" rev="${/rome/rome}" conf="compile->*"/>
+    <dependency org="jdom" name="jdom" rev="${/jdom/jdom}" conf="compile->*"/>
+    <dependency org="com.googlecode.juniversalchardet" name="juniversalchardet" rev="${/com.googlecode.juniversalchardet/juniversalchardet}" conf="compile->*"/>
+    <dependency org="org.tukaani" name="xz" rev="${/org.tukaani/xz}" conf="compile->*"/>
+    <dependency org="com.adobe.xmp" name="xmpcore" rev="${/com.adobe.xmp/xmpcore}" conf="compile->*"/>
+    <dependency org="asm" name="asm" rev="${/asm/asm}" conf="compile->*"/>
 
-      <!-- Other ExtracingRequestHandler dependencies -->
-      <dependency org="com.ibm.icu" name="icu4j" rev="${/com.ibm.icu/icu4j}" transitive="false"/>
-      <dependency org="xerces" name="xercesImpl" rev="${/xerces/xercesImpl}" transitive="false"/>
-      <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/> 
-    </dependencies>
+    <!-- Other ExtractingRequestHandler dependencies -->
+    <dependency org="com.ibm.icu" name="icu4j" rev="${/com.ibm.icu/icu4j}" conf="compile->*"/>
+    <dependency org="xerces" name="xercesImpl" rev="${/xerces/xercesImpl}" conf="compile->*"/>
+
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
+    <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/>
+  </dependencies>
 </ivy-module>
diff --git a/solr/contrib/langid/build.xml b/solr/contrib/langid/build.xml
index 271ea0ecc17..bc3cd1b48a1 100644
--- a/solr/contrib/langid/build.xml
+++ b/solr/contrib/langid/build.xml
@@ -31,7 +31,12 @@
     <path refid="solr.base.classpath"/>   
   </path>
 
-    <!-- we don't actually need to compile this thing, we just want its libs -->
+  <path id="test.classpath">
+    <path refid="solr.test.base.classpath"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
+  </path>
+
+  <!-- we don't actually need to compile this thing, we just want its libs -->
   <target name="resolve-extraction-libs">
     <ant dir="${common-solr.dir}/contrib/extraction" target="resolve" inheritAll="false">
       <propertyset refid="uptodate.and.compiled.properties"/>
diff --git a/solr/contrib/langid/ivy.xml b/solr/contrib/langid/ivy.xml
index c62f7176bd3..b4772a9628e 100644
--- a/solr/contrib/langid/ivy.xml
+++ b/solr/contrib/langid/ivy.xml
@@ -17,10 +17,17 @@
    under the License.    
 -->
 <ivy-module version="2.0">
-    <info organisation="org.apache.solr" module="langid"/>
-    <dependencies>
-      <dependency org="com.cybozu.labs" name="langdetect" rev="${/com.cybozu.labs/langdetect}" transitive="false"/>
-      <dependency org="net.arnx" name="jsonic" rev="${/net.arnx/jsonic}" transitive="false"/>
-      <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/>
-    </dependencies>
+  <info organisation="org.apache.solr" module="langid"/>
+  <configurations>
+    <conf name="compile" transitive="false"/>
+    <conf name="test" transitive="false"/>
+  </configurations>
+  <dependencies>
+    <dependency org="com.cybozu.labs" name="langdetect" rev="${/com.cybozu.labs/langdetect}" conf="compile->*"/>
+    <dependency org="net.arnx" name="jsonic" rev="${/net.arnx/jsonic}" conf="compile->*"/>
+
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
+    <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/>
+  </dependencies>
 </ivy-module>
diff --git a/solr/contrib/map-reduce/build.xml b/solr/contrib/map-reduce/build.xml
index 8391c1acfbd..2b858cd3cc0 100644
--- a/solr/contrib/map-reduce/build.xml
+++ b/solr/contrib/map-reduce/build.xml
@@ -93,6 +93,7 @@
     <pathelement location="${common-solr.dir}/build/contrib/solr-morphlines-core/classes/test"/>
     <pathelement location="${common-solr.dir}/contrib/morphlines-core/src/test-files"/>
     <fileset dir="${common-solr.dir}/contrib/morphlines-core/test-lib" excludes="${common.classpath.excludes}"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
   </path>
 
   <path id="javadoc.classpath">
diff --git a/solr/contrib/map-reduce/ivy.xml b/solr/contrib/map-reduce/ivy.xml
index 3af96eddd61..2e0e55d8459 100644
--- a/solr/contrib/map-reduce/ivy.xml
+++ b/solr/contrib/map-reduce/ivy.xml
@@ -16,7 +16,7 @@
    specific language governing permissions and limitations
    under the License.    
 -->
-<ivy-module version="2.0" xmlns:maven="http://ant.apache.org/ivy/maven">
+<ivy-module version="2.0">
   <info organisation="org.apache.solr" module="map-reduce" />
   <configurations>
     <conf name="compile" transitive="false" />
@@ -31,7 +31,9 @@
     <dependency org="net.sf.saxon" name="Saxon-HE" rev="${/net.sf.saxon/Saxon-HE}" conf="compile->*" />
     
     <dependency org="org.kitesdk" name="kite-morphlines-hadoop-sequencefile" rev="${/org.kitesdk/kite-morphlines-hadoop-sequencefile}" conf="compile->*" />
-    
+
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
     <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}" />
   </dependencies>
 </ivy-module>
diff --git a/solr/contrib/morphlines-cell/build.xml b/solr/contrib/morphlines-cell/build.xml
index f036d236c10..6e5d5a9199b 100644
--- a/solr/contrib/morphlines-cell/build.xml
+++ b/solr/contrib/morphlines-cell/build.xml
@@ -95,6 +95,7 @@
     <pathelement location="${common-solr.dir}/build/contrib/solr-morphlines-core/classes/test"/>
     <pathelement location="${common-solr.dir}/contrib/morphlines-core/src/test-files"/>
     <fileset dir="${common-solr.dir}/contrib/morphlines-core/test-lib" excludes="${common.classpath.excludes}"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
   </path>
 
   <path id="javadoc.classpath">
diff --git a/solr/contrib/morphlines-cell/ivy.xml b/solr/contrib/morphlines-cell/ivy.xml
index 62bb81888c0..4122861f20e 100644
--- a/solr/contrib/morphlines-cell/ivy.xml
+++ b/solr/contrib/morphlines-cell/ivy.xml
@@ -16,7 +16,7 @@
    specific language governing permissions and limitations
    under the License.    
 -->
-<ivy-module version="2.0" xmlns:maven="http://ant.apache.org/ivy/maven">
+<ivy-module version="2.0">
   <info organisation="org.apache.solr" module="morphlines-cell" />
   <configurations>
     <conf name="compile" transitive="false" />
@@ -29,7 +29,9 @@
     <dependency org="org.kitesdk" name="kite-morphlines-tika-decompress" rev="${/org.kitesdk/kite-morphlines-tika-decompress}" conf="compile->*" />
     <dependency org="org.kitesdk" name="kite-morphlines-json" rev="${/org.kitesdk/kite-morphlines-json}" conf="compile->*" />
     <dependency org="org.kitesdk" name="kite-morphlines-twitter" rev="${/org.kitesdk/kite-morphlines-twitter}" conf="compile->*" />
-    
+
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
     <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}" />
 
   </dependencies>
diff --git a/solr/contrib/morphlines-core/build.xml b/solr/contrib/morphlines-core/build.xml
index 859b0322e2b..0b1b59543ae 100644
--- a/solr/contrib/morphlines-core/build.xml
+++ b/solr/contrib/morphlines-core/build.xml
@@ -23,8 +23,6 @@
     Solr Morphlines commands.
   </description>
 
-  <property name="test.lib.dir" location="test-lib"/>
-
   <import file="../contrib-build.xml"/>
   
   <solr-contrib-uptodate name="extraction" 
@@ -93,14 +91,6 @@
     </ant>
   </target>
 
-  <target name="resolve" depends="ivy-availability-check,ivy-fail,ivy-configure">
-    <sequential>
-      <ivy:retrieve conf="compile" type="jar,bundle" sync="${ivy.sync}" log="download-only"/>
-      <ivy:retrieve conf="test,test.DfsMiniCluster" type="jar,bundle,test" sync="${ivy.sync}" log="download-only"
-                    pattern="${test.lib.dir}/[artifact]-[revision](-[classifier]).[ext]"/>
-    </sequential>
-  </target>
-
   <target name="compile-core" depends="resolve-extraction-libs, compile-solr-extraction, solr-contrib-build.compile-core"/>
   <target name="dist" depends="common-solr.dist"/>
 
diff --git a/solr/contrib/morphlines-core/ivy.xml b/solr/contrib/morphlines-core/ivy.xml
index 58b07d02e19..939914acd44 100644
--- a/solr/contrib/morphlines-core/ivy.xml
+++ b/solr/contrib/morphlines-core/ivy.xml
@@ -114,6 +114,8 @@
     <dependency org="com.sun.jersey" name="jersey-core" rev="${/com.sun.jersey/jersey-core}" conf="test->*" />
 
     <dependency org="commons-collections" name="commons-collections" rev="${/commons-collections/commons-collections}" conf="test->*" />
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
     <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}" />
 
   </dependencies>
diff --git a/solr/contrib/uima/build.xml b/solr/contrib/uima/build.xml
index ee564221148..438f139f243 100644
--- a/solr/contrib/uima/build.xml
+++ b/solr/contrib/uima/build.xml
@@ -35,6 +35,11 @@
     <path refid="solr.base.classpath"/>
   </path>
 
+  <path id="test.classpath">
+    <path refid="solr.test.base.classpath"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
+  </path>
+
   <target name="module-jars-to-solr"
           depends="-module-jars-to-solr-not-for-package,-module-jars-to-solr-package"/>
   <target name="-module-jars-to-solr-not-for-package" unless="called.from.create-package">
diff --git a/solr/contrib/uima/ivy.xml b/solr/contrib/uima/ivy.xml
index 69c3c40ac61..a09a09cef95 100644
--- a/solr/contrib/uima/ivy.xml
+++ b/solr/contrib/uima/ivy.xml
@@ -17,14 +17,21 @@
    under the License.    
 -->
 <ivy-module version="2.0">
-    <info organisation="org.apache.solr" module="uima"/>
-    <dependencies>
-      <dependency org="commons-digester" name="commons-digester" rev="${/commons-digester/commons-digester}" transitive="false"/>
-      <dependency org="org.apache.uima" name="AlchemyAPIAnnotator" rev="${/org.apache.uima/AlchemyAPIAnnotator}" transitive="false"/>
-      <dependency org="org.apache.uima" name="OpenCalaisAnnotator" rev="${/org.apache.uima/OpenCalaisAnnotator}" transitive="false"/>
-      <dependency org="org.apache.uima" name="Tagger" rev="${/org.apache.uima/Tagger}" transitive="false"/>
-      <dependency org="org.apache.uima" name="WhitespaceTokenizer" rev="${/org.apache.uima/WhitespaceTokenizer}" transitive="false"/>
-      <dependency org="org.apache.uima" name="uimaj-core" rev="${/org.apache.uima/uimaj-core}" transitive="false"/>
-      <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/> 
-    </dependencies>
+  <info organisation="org.apache.solr" module="uima"/>
+  <configurations>
+    <conf name="compile" transitive="false"/>
+    <conf name="test" transitive="false"/>
+  </configurations>
+  <dependencies>
+    <dependency org="commons-digester" name="commons-digester" rev="${/commons-digester/commons-digester}" conf="compile->*"/>
+    <dependency org="org.apache.uima" name="AlchemyAPIAnnotator" rev="${/org.apache.uima/AlchemyAPIAnnotator}" conf="compile->*"/>
+    <dependency org="org.apache.uima" name="OpenCalaisAnnotator" rev="${/org.apache.uima/OpenCalaisAnnotator}" conf="compile->*"/>
+    <dependency org="org.apache.uima" name="Tagger" rev="${/org.apache.uima/Tagger}" conf="compile->*"/>
+    <dependency org="org.apache.uima" name="WhitespaceTokenizer" rev="${/org.apache.uima/WhitespaceTokenizer}" conf="compile->*"/>
+    <dependency org="org.apache.uima" name="uimaj-core" rev="${/org.apache.uima/uimaj-core}" conf="compile->*"/>
+
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
+    <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/>
+  </dependencies>
 </ivy-module>
diff --git a/solr/contrib/velocity/build.xml b/solr/contrib/velocity/build.xml
index a6712afcd79..fc08da1615c 100644
--- a/solr/contrib/velocity/build.xml
+++ b/solr/contrib/velocity/build.xml
@@ -25,4 +25,8 @@
 
   <import file="../contrib-build.xml"/>
 
+  <path id="test.classpath">
+    <path refid="solr.test.base.classpath"/>
+    <fileset dir="${test.lib.dir}" includes="*.jar"/>
+  </path>
 </project>
diff --git a/solr/contrib/velocity/ivy.xml b/solr/contrib/velocity/ivy.xml
index 279c61fe202..129dde496b1 100644
--- a/solr/contrib/velocity/ivy.xml
+++ b/solr/contrib/velocity/ivy.xml
@@ -17,12 +17,19 @@
    under the License.    
 -->
 <ivy-module version="2.0">
-    <info organisation="org.apache.solr" module="velocity"/>
-    <dependencies>
-      <dependency org="commons-beanutils" name="commons-beanutils" rev="${/commons-beanutils/commons-beanutils}" transitive="false"/>
-      <dependency org="commons-collections" name="commons-collections" rev="${/commons-collections/commons-collections}" transitive="false"/>
-      <dependency org="org.apache.velocity" name="velocity" rev="${/org.apache.velocity/velocity}" transitive="false"/>
-      <dependency org="org.apache.velocity" name="velocity-tools" rev="${/org.apache.velocity/velocity-tools}" transitive="false"/>
-      <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/> 
-    </dependencies>
+  <info organisation="org.apache.solr" module="velocity"/>
+  <configurations>
+    <conf name="compile" transitive="false"/>
+    <conf name="test" transitive="false"/>
+  </configurations>
+  <dependencies>
+    <dependency org="commons-beanutils" name="commons-beanutils" rev="${/commons-beanutils/commons-beanutils}" conf="compile->*"/>
+    <dependency org="commons-collections" name="commons-collections" rev="${/commons-collections/commons-collections}" conf="compile->*"/>
+    <dependency org="org.apache.velocity" name="velocity" rev="${/org.apache.velocity/velocity}" conf="compile->*"/>
+    <dependency org="org.apache.velocity" name="velocity-tools" rev="${/org.apache.velocity/velocity-tools}" conf="compile->*"/>
+
+    <dependency org="org.slf4j" name="jcl-over-slf4j" rev="${/org.slf4j/jcl-over-slf4j}" conf="test->*"/>
+
+    <exclude org="*" ext="*" matcher="regexp" type="${ivy.exclude.types}"/>
+  </dependencies>
 </ivy-module>
