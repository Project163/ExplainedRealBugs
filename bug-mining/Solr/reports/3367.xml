<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:22:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10423] ShingleFilter causes overly restrictive queries to be produced</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10423</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When &lt;tt&gt;sow=false&lt;/tt&gt; and &lt;tt&gt;ShingleFilter&lt;/tt&gt; is included in the query analyzer, &lt;tt&gt;QueryBuilder&lt;/tt&gt; produces queries that inappropriately require sequential terms.  E.g. the query &quot;A B C&quot; produces &lt;tt&gt;(+A_B +B_C) A_B_C&lt;/tt&gt; when the query analyzer includes &lt;tt&gt;&amp;lt;filter class=&quot;solr.ShingleFilterFactory&quot; maxShingleSize=&quot;3&quot; outputUnigrams=&quot;false&quot; tokenSeparator=&quot;_&quot;/&amp;gt;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Aman Deep Singh reported this problem on the solr-user list. From &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201703.mbox/%3cCANEGTX9BwBPwQc-cXieAc7QSAS7x2TgZovOMy5ZTiAgco1p11Q@mail.gmail.com%3e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201703.mbox/%3cCANEGTX9BwBPwQc-cXieAc7QSAS7x2TgZovOMy5ZTiAgco1p11Q@mail.gmail.com%3e&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I was trying to use the shingle filter but it was not creating the query as&lt;br/&gt;
desirable.&lt;/p&gt;

&lt;p&gt;my schema is&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;fieldType name=&quot;cust_shingle&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&amp;gt;
  &amp;lt;analyzer&amp;gt;
    &amp;lt;tokenizer class=&quot;solr.StandardTokenizerFactory&quot;/&amp;gt;
    &amp;lt;filter class=&quot;solr.ShingleFilterFactory&quot; outputUnigrams=&quot;false&quot; maxShingleSize=&quot;4&quot;/&amp;gt;
    &amp;lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&amp;gt;
  &amp;lt;/analyzer&amp;gt;
&amp;lt;/fieldType&amp;gt;
&amp;lt;field name=&quot;nameShingle&quot; type=&quot;cust_shingle&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;my solr query is&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://localhost:8983/solr/productCollection/select?
 defType=edismax
&amp;amp;debugQuery=true
&amp;amp;q=one%20plus%20one%20four
&amp;amp;qf=nameShingle
&amp;amp;sow=false
&amp;amp;wt=xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and it was creating the parsed query as&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;str name=&quot;parsedquery&quot;&amp;gt;
(+(DisjunctionMaxQuery(((+nameShingle:one plus +nameShingle:plus one
+nameShingle:one four))) DisjunctionMaxQuery(((+nameShingle:one plus
+nameShingle:plus one four))) DisjunctionMaxQuery(((+nameShingle:one plus one +nameShingle:one four))) DisjunctionMaxQuery((nameShingle:one plus one four)))~1)/no_coord
&amp;lt;/str&amp;gt;
&amp;lt;str name=&quot;parsedquery_toString&quot;&amp;gt;
*+((((+nameShingle:one plus +nameShingle:plus one +nameShingle:one four))
((+nameShingle:one plus +nameShingle:plus one four)) ((+nameShingle:one
plus one +nameShingle:one four)) (nameShingle:one plus one four))~1)*
&amp;lt;/str&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So ideally token creations is perfect but in the query it is using boolean + operator which is causing the problem as if i have a document with name as &quot;one plus one&quot; ,according to the shingles it has to matched as its token will be  (&quot;one plus&quot;,&quot;one plus one&quot;,&quot;plus one&quot;) .&lt;/p&gt;

&lt;p&gt;I have tried using the q.op and played around the mm also but nothing is&lt;br/&gt;
giving me the correct response.&lt;/p&gt;

&lt;p&gt;Any idea how i can fetch that document even if the document is missing any&lt;br/&gt;
token.&lt;/p&gt;

&lt;p&gt;My expected response will be getting the document &quot;one plus one&quot; even the user query has any additional term like &quot;one plus one two&quot; and so on.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="13061539">SOLR-10423</key>
            <summary>ShingleFilter causes overly restrictive queries to be produced</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Apr 2017 21:30:41 +0000</created>
                <updated>Sat, 8 Jun 2019 15:20:11 +0000</updated>
                            <resolved>Wed, 5 Apr 2017 20:56:00 +0000</resolved>
                                    <version>6.5</version>
                                    <fixVersion>6.5.1</fixVersion>
                    <fixVersion>6.6</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15955912" author="steve_rowe" created="Tue, 4 Apr 2017 21:44:58 +0000"  >&lt;p&gt;I think the fix for this problem is to expose &lt;tt&gt;QueryBuilder.setEnableGraphQueries()&lt;/tt&gt; on Solr field types, in the same way that the &lt;tt&gt;autoGeneratePhraseQueries&lt;/tt&gt; option is now.&lt;/p&gt;

&lt;p&gt;Since 6.5 is the first version of Solr that included the &lt;tt&gt;sow=false&lt;/tt&gt; option, it previously wasn&apos;t possible to construct queries using ShingleFilter, because Solr&apos;s query parser always split on whitespace before performing analysis, one term at a time.&lt;/p&gt;

&lt;p&gt;The following Lucene unit test (added to the queryparser module&apos;s &lt;tt&gt;TestQueryParser.java&lt;/tt&gt;, after adding a test dependency on the analysis-common module), which calls &lt;tt&gt;QueryBuilder.setEnableGraphQueries(false);&lt;/tt&gt;, succeeds for me.  When I change the test to call &lt;tt&gt;assertQueryEquals()&lt;/tt&gt; (which doesn&apos;t disable graph queries, which are enabled by default), the test fails with this assertion error: &lt;tt&gt;Query /A B C/ yielded /(+A_B +B_C) A_B_C/, expecting  /Synonym(A_B A_B_C) B_C/&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testShinglesSplitOnWhitespace() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    Analyzer a = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Analyzer() {
      @Override &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; TokenStreamComponents createComponents(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) {
        Tokenizer tokenizer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MockTokenizer(MockTokenizer.WHITESPACE, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
        ShingleFilter tokenStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ShingleFilter(tokenizer, 2, 3);
        tokenStream.setTokenSeparator(&lt;span class=&quot;code-quote&quot;&gt;&quot;_&quot;&lt;/span&gt;);
        tokenStream.setOutputUnigrams(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TokenStreamComponents(tokenizer, tokenStream);
      }
    };
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; oldSplitOnWhitespace = splitOnWhitespace;
    splitOnWhitespace = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    assertQueryEqualsNoGraph(&lt;span class=&quot;code-quote&quot;&gt;&quot;A B C&quot;&lt;/span&gt;, a, &lt;span class=&quot;code-quote&quot;&gt;&quot;Synonym(A_B A_B_C) B_C&quot;&lt;/span&gt;);
    splitOnWhitespace = oldSplitOnWhitespace;
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void assertQueryEqualsNoGraph(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; query, Analyzer a, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; result) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    QueryParser parser = getParser(a);
    parser.setEnableGraphQueries(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    Query q = parser.parse(query);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s = q.toString(&lt;span class=&quot;code-quote&quot;&gt;&quot;field&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!s.equals(result)) {
      fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Query /&quot;&lt;/span&gt; + query + &lt;span class=&quot;code-quote&quot;&gt;&quot;/ yielded /&quot;&lt;/span&gt; + s + &lt;span class=&quot;code-quote&quot;&gt;&quot;/, expecting /&quot;&lt;/span&gt; + result + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15957280" author="steve_rowe" created="Wed, 5 Apr 2017 17:24:24 +0000"  >&lt;p&gt;Patch with suggested fix and tests: specifying &lt;tt&gt;&amp;lt;fieldtype ... enableGraphQueries=&quot;false&quot;&amp;gt;...&lt;/tt&gt; allows functional queries over ShingleFilter&apos;d fields.&lt;/p&gt;

&lt;p&gt;Running tests and precommit now.  I&apos;d like to include this in Solr 6.5.1.&lt;/p&gt;</comment>
                            <comment id="15957426" author="steve_rowe" created="Wed, 5 Apr 2017 18:49:04 +0000"  >&lt;p&gt;All Solr tests and precommit pass.&lt;/p&gt;</comment>
                            <comment id="15957653" author="jira-bot" created="Wed, 5 Apr 2017 20:54:31 +0000"  >&lt;p&gt;Commit 213e50a982e7a6f4ecb0d47178e7509393b74a7a in lucene-solr&apos;s branch refs/heads/branch_6_5 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=213e50a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=213e50a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10423&quot; title=&quot;ShingleFilter causes overly restrictive queries to be produced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10423&quot;&gt;&lt;del&gt;SOLR-10423&lt;/del&gt;&lt;/a&gt;: Disable graph query production via schema configuration &amp;lt;fieldtype ... enableGraphQueries=&quot;false&quot;&amp;gt;.  This fixes broken queries for ShingleFilter-containing query-time analyzers when request param sow=false.&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	solr/core/src/java/org/apache/solr/parser/QueryParser.java&lt;br/&gt;
	solr/core/src/java/org/apache/solr/parser/QueryParser.jj&lt;br/&gt;
	solr/core/src/java/org/apache/solr/search/ExtendedDismaxQParser.java&lt;br/&gt;
	solr/core/src/test/org/apache/solr/search/TestSolrQueryParser.java&lt;/p&gt;</comment>
                            <comment id="15957654" author="jira-bot" created="Wed, 5 Apr 2017 20:54:39 +0000"  >&lt;p&gt;Commit 3a6fbd741110b04d590ced10375b076321fb8bf7 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a6fbd7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3a6fbd7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10423&quot; title=&quot;ShingleFilter causes overly restrictive queries to be produced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10423&quot;&gt;&lt;del&gt;SOLR-10423&lt;/del&gt;&lt;/a&gt;: Disable graph query production via schema configuration &amp;lt;fieldtype ... enableGraphQueries=&quot;false&quot;&amp;gt;.  This fixes broken queries for ShingleFilter-containing query-time analyzers when request param sow=false.&lt;/p&gt;</comment>
                            <comment id="15957656" author="jira-bot" created="Wed, 5 Apr 2017 20:54:42 +0000"  >&lt;p&gt;Commit dbd22a6ada774eb30aee4b9312eb7913dee6890e in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dbd22a6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dbd22a6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10423&quot; title=&quot;ShingleFilter causes overly restrictive queries to be produced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10423&quot;&gt;&lt;del&gt;SOLR-10423&lt;/del&gt;&lt;/a&gt;: Disable graph query production via schema configuration &amp;lt;fieldtype ... enableGraphQueries=&quot;false&quot;&amp;gt;.  This fixes broken queries for ShingleFilter-containing query-time analyzers when request param sow=false.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12862114" name="SOLR-10423.patch" size="15293" author="sarowe" created="Wed, 5 Apr 2017 17:24:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3d7bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>