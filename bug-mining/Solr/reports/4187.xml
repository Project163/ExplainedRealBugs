<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:37:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13408] Cannot start/stop DaemonStream repeatedly, other API improvements</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13408</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If I create a DaemonStream then use the API commands to stop it then start it repeatedly, after the first time it&apos;s stopped/started, it cannot be stopped again.&lt;/p&gt;

&lt;p&gt;DaemonStream.close() checks whether a local variable &quot;closed&quot; is true, and if so does nothing. Otherwise it closes the stream then sets &quot;closed&quot; to true.&lt;/p&gt;

&lt;p&gt;However, when the stream is started again, &quot;closed&quot; is not set to false, therefore the next time you try to stop the deamon, nothing happens and it continues to run. One other consequence of this is that you can have orphan threads running in the background. Say I&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
stop the daemon
start it again
create another one with the same ID
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When the new one is created, this code is executed over in StreamHandler.handleRequestBody:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
daemons.remove(daemonStream.getId()).close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which will not terminate the stream thread as above. Then the open() method executes this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.streamRunner = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRunner(runInterval, id);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;leaving the thread running.&lt;/p&gt;

&lt;p&gt;Finally, there&apos;s an NPE if I try to start a non-existent daemon.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13228232">SOLR-13408</key>
            <summary>Cannot start/stop DaemonStream repeatedly, other API improvements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Apr 2019 02:01:33 +0000</created>
                <updated>Tue, 8 Oct 2019 14:50:27 +0000</updated>
                            <resolved>Wed, 17 Apr 2019 23:52:11 +0000</resolved>
                                    <version>7.7</version>
                    <version>8.0</version>
                    <version>9.0</version>
                                    <fixVersion>7.7.2</fixVersion>
                    <fixVersion>8.1</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>streaming expressions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16818616" author="erickerickson" created="Tue, 16 Apr 2019 04:20:19 +0000"  >&lt;p&gt;Preliminary patch, I rearranged some code in StreamHandler....&lt;/p&gt;</comment>
                            <comment id="16819011" author="risdenk" created="Tue, 16 Apr 2019 13:19:49 +0000"  >&lt;p&gt;I think even just calling open twice would cause an issue. There is nothing stopping someone from opening the daemon stream programmatically twice.&lt;/p&gt;</comment>
                            <comment id="16819013" author="risdenk" created="Tue, 16 Apr 2019 13:21:33 +0000"  >&lt;p&gt;StreamExpressionTest is where some existing daemon open/close tests are.&lt;/p&gt;</comment>
                            <comment id="16819071" author="erickerickson" created="Tue, 16 Apr 2019 14:28:42 +0000"  >&lt;p&gt;Oooh, calling open twice. Didn&apos;t think about that.&lt;/p&gt;

&lt;p&gt;I&apos;ll check out StreamExpression Test, I did already find StreamingTest so I have at least two places to look&lt;/p&gt;</comment>
                            <comment id="16820326" author="erickerickson" created="Wed, 17 Apr 2019 17:22:23 +0000"  >&lt;p&gt;New patch. I haven&apos;t run precommit or the full test suite, I want to beast the tests I modified first.&lt;/p&gt;

&lt;p&gt;This patch isn&apos;t nearly as much of a code change as its size would indicate, much of it is tests. I did rearrange some code in&#160;StreamHandler....&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove&quot; class=&quot;user-hover&quot; rel=&quot;dpgove&quot;&gt;dpgove&lt;/a&gt; any comments you&apos;d care to make welcome of course.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this in a day or two assuming all goes well.&lt;/p&gt;</comment>
                            <comment id="16820566" author="erickerickson" created="Wed, 17 Apr 2019 22:59:56 +0000"  >&lt;p&gt;Final patch with CHANGES.txt.&#160;&lt;/p&gt;

&lt;p&gt;I will commit this to 7.7 as well as any new 7.7 release should pick it up.&lt;/p&gt;</comment>
                            <comment id="16820570" author="jira-bot" created="Wed, 17 Apr 2019 23:07:37 +0000"  >&lt;p&gt;Commit a9771a58495b319b36b32381c786d9d9801e64ea in lucene-solr&apos;s branch refs/heads/master from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a9771a5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a9771a5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13408&quot; title=&quot;Cannot start/stop DaemonStream repeatedly, other API improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13408&quot;&gt;&lt;del&gt;SOLR-13408&lt;/del&gt;&lt;/a&gt;: Cannot start/stop DaemonStream repeatedly, other API improvements&lt;/p&gt;</comment>
                            <comment id="16820577" author="jira-bot" created="Wed, 17 Apr 2019 23:21:21 +0000"  >&lt;p&gt;Commit ca1cc248e072a6ddfa8969b434c270ed7ecf88e3 in lucene-solr&apos;s branch refs/heads/branch_8x from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ca1cc24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ca1cc24&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13408&quot; title=&quot;Cannot start/stop DaemonStream repeatedly, other API improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13408&quot;&gt;&lt;del&gt;SOLR-13408&lt;/del&gt;&lt;/a&gt;: Cannot start/stop DaemonStream repeatedly, other API improvements&lt;/p&gt;

&lt;p&gt;(cherry picked from commit a9771a58495b319b36b32381c786d9d9801e64ea)&lt;/p&gt;</comment>
                            <comment id="16820592" author="jira-bot" created="Wed, 17 Apr 2019 23:51:45 +0000"  >&lt;p&gt;Commit ac38f23db2133fcd16e2c81c44ca1695de2718b3 in lucene-solr&apos;s branch refs/heads/branch_7_7 from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ac38f23&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ac38f23&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13408&quot; title=&quot;Cannot start/stop DaemonStream repeatedly, other API improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13408&quot;&gt;&lt;del&gt;SOLR-13408&lt;/del&gt;&lt;/a&gt;: Cannot start/stop DaemonStream repeatedly, other API improvements&lt;/p&gt;</comment>
                            <comment id="16857065" author="janhoy" created="Wed, 5 Jun 2019 21:30:45 +0000"  >&lt;p&gt;Closing after the 7.7.2 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12966291" name="SOLR-13408.patch" size="23837" author="erickerickson" created="Wed, 17 Apr 2019 23:00:23 +0000"/>
                            <attachment id="12966262" name="SOLR-13408.patch" size="22867" author="erickerickson" created="Wed, 17 Apr 2019 17:19:11 +0000"/>
                            <attachment id="12966030" name="SOLR-13408.patch" size="5530" author="erickerickson" created="Tue, 16 Apr 2019 04:20:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01tgw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>