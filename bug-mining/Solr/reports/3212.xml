<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:18:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9883] example solr config files can lead to invalid tlog replays when using add-unknown-fields-to-schema updat chain</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9883</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The current basic_configs and data_driven_schema_configs try to create unknown fields. The problem is that the date processing &quot;ParseDateFieldUpdateProcessorFactory&quot; is not invoked if the doc is replayed from the tlog. Whether there are other places this is a problem I don&apos;t know, this is a concrete example that fails in the field.&lt;/p&gt;

&lt;p&gt;So say I have a pattern for dates that omits the trialing &apos;Z&apos;, as:&lt;br/&gt;
yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSS&lt;/p&gt;

&lt;p&gt;This work fine when the doc is initially indexed. Now say the doc must be replayed from the tlog. The doc errors out with &quot;unknown date format&quot; since (apparently) this doesn&apos;t go through the same update chain, perhaps due to the sample configs defining ParseDateFieldUpdateProcessorFactory after  DistributedUpdateProcessorFactory?&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13029593">SOLR-9883</key>
            <summary>example solr config files can lead to invalid tlog replays when using add-unknown-fields-to-schema updat chain</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Dec 2016 22:52:51 +0000</created>
                <updated>Sat, 8 Jun 2019 15:31:33 +0000</updated>
                            <resolved>Sat, 7 Jan 2017 21:42:33 +0000</resolved>
                                    <version>6.3</version>
                                    <fixVersion>6.4</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15765491" author="erickerickson" created="Tue, 20 Dec 2016 22:55:40 +0000"  >&lt;p&gt;There&apos;s quite a bit of discussion at &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8030&quot; title=&quot;Transaction log does not store the update chain (or req params?) used for updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8030&quot;&gt;SOLR-8030&lt;/a&gt; that&apos;s relevant.&lt;/p&gt;

&lt;p&gt;I don&apos;t quite know whether the simple expedient of putting the URPs before the DistribUpdateProcessorFactory is sufficient (or safe).&lt;/p&gt;</comment>
                            <comment id="15798765" author="steve_rowe" created="Wed, 4 Jan 2017 17:11:51 +0000"  >&lt;p&gt;Attaching a patch that switches example configs&apos;s add-unknown-fields-to-schema update chains so that the DUP is after the AddSchemaFields URPF.  In my manual testing (see below), this prevents the data corruption: the buffered tlog entry includes the date normalization. I also made &lt;tt&gt;AddSchemaFields&lt;/tt&gt; URPF implement &lt;tt&gt;UpdateRequestProcessorFactory.RunAlways&lt;/tt&gt;, so that schema modifications will continue to be applied on all replicas (the original rationale for moving the DUP position on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6137&quot; title=&quot;Managed Schema / Schemaless and SolrCloud concurrency issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6137&quot;&gt;&lt;del&gt;SOLR-6137&lt;/del&gt;&lt;/a&gt;). &lt;/p&gt;

&lt;p&gt;Following an offline reproduction suggestion from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;, I was able to manually reproduce the data corruption as follows:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Added an artificial 1-minute delay in &lt;tt&gt;PeerSync&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;bin/solr start -e cloud  # nodes=2, coll=gettingstarted, shards=1, rf=2, configset=data_driven_schema_configs&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;curl -X POST -H &apos;Content-type: application/xml&apos; &lt;a href=&quot;http://localhost:8983/solr/gettingstarted/update&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/gettingstarted/update&lt;/a&gt; -d &apos;&amp;lt;add&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;field name=&quot;f_dt&quot;&amp;gt;2015-06-09&amp;lt;/field&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/add&amp;gt;&apos;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;kill -9 $(cat bin/solr-7574.pid)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;curl -X POST -H &apos;Content-type: application/xml&apos; &lt;a href=&quot;http://localhost:8983/solr/gettingstarted/update&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/gettingstarted/update&lt;/a&gt; -d &apos;&amp;lt;add&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;field name=&quot;f_dt&quot;&amp;gt;2015-06-10&amp;lt;/field&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/add&amp;gt;&apos;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;bin/solr start -cloud -p 7574 -s &quot;example/cloud/node2/solr&quot; -z localhost:9983&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;curl -X POST -H &apos;Content-type: application/xml&apos; &lt;a href=&quot;http://localhost:8983/solr/gettingstarted/update&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/gettingstarted/update&lt;/a&gt; -d &apos;&amp;lt;add&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;field name=&quot;f_dt&quot;&amp;gt;2015-06-11&amp;lt;/field&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/add&amp;gt;&apos;&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I had to add step #3 to create a transaction log entry on the 7574 replica prior to shutdown; otherwise on restart it would refuse to perform peer sync, because it didn&apos;t know where to start (due to no recent versions in the tlog) and instead initiated full recovery.&lt;/p&gt;

&lt;p&gt;I&apos;m working on an automated data corruption test.&lt;/p&gt;

&lt;p&gt;I want to get this change into the 6.4 release.&lt;/p&gt;</comment>
                            <comment id="15798902" author="steve_rowe" created="Wed, 4 Jan 2017 18:04:09 +0000"  >&lt;p&gt;Forgot to mention: with the attached patch, I was no longer able to reproduce the data corruption with the above method.&lt;/p&gt;</comment>
                            <comment id="15808141" author="steve_rowe" created="Sat, 7 Jan 2017 21:02:09 +0000"  >&lt;p&gt;Patch with a new automated data corruption test.  I tried to make a cloud test, but I couldn&apos;t get it to work.  Instead, the test in the patch simulates this situation by directly turning on tlog buffering mode in a single core, and sending in an update (with param &lt;tt&gt;update.distrib=fromleader&lt;/tt&gt;) after manually running the &quot;add-unknown-fields-to-schema&quot; update chain on it up through the DUP.  The test succeeds with the solr config modifications in the patch, and fails without it.&lt;/p&gt;

&lt;p&gt;The patch also fixes a typos in the replay failure log message (&lt;tt&gt;REYPLAY&lt;/tt&gt;-&amp;gt;&lt;tt&gt;REPLAY&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;m running all Solr tests and precommit now.  When they succeed, I&apos;ll commit.&lt;/p&gt;</comment>
                            <comment id="15808187" author="steve_rowe" created="Sat, 7 Jan 2017 21:31:44 +0000"  >&lt;p&gt;Updated patch, moves config files to temp dir to avoid permission failures when auto-upgrading the schema file to &lt;tt&gt;managed-schema&lt;/tt&gt;.  (Didn&apos;t see this failure when running from IntelliJ.)&lt;/p&gt;

&lt;p&gt;All Solr tests pass, and precommit passes.  Committing shortly.&lt;/p&gt;</comment>
                            <comment id="15808200" author="jira-bot" created="Sat, 7 Jan 2017 21:41:31 +0000"  >&lt;p&gt;Commit 9a6ff177b6f7c776cc6bf4625ed2d5dd7cce81d2 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a6ff17&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a6ff17&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9883&quot; title=&quot;example solr config files can lead to invalid tlog replays when using add-unknown-fields-to-schema updat chain&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9883&quot;&gt;&lt;del&gt;SOLR-9883&lt;/del&gt;&lt;/a&gt;: In example schemaless configs&apos; default update chain, move the DUP to after the AddSchemaFields URP (which is now tagged as RunAlways), to avoid invalid buffered tlog entry replays.&lt;/p&gt;</comment>
                            <comment id="15808201" author="jira-bot" created="Sat, 7 Jan 2017 21:41:34 +0000"  >&lt;p&gt;Commit d817fd43eccd67a5d73c3bbc49561de65d3fc9cb in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d817fd4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d817fd4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9883&quot; title=&quot;example solr config files can lead to invalid tlog replays when using add-unknown-fields-to-schema updat chain&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9883&quot;&gt;&lt;del&gt;SOLR-9883&lt;/del&gt;&lt;/a&gt;: In example schemaless configs&apos; default update chain, move the DUP to after the AddSchemaFields URP (which is now tagged as RunAlways), to avoid invalid buffered tlog entry replays.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12863047">SOLR-8030</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12846202" name="SOLR-9883.patch" size="19271" author="sarowe" created="Sat, 7 Jan 2017 21:31:44 +0000"/>
                            <attachment id="12846198" name="SOLR-9883.patch" size="18549" author="sarowe" created="Sat, 7 Jan 2017 21:02:09 +0000"/>
                            <attachment id="12845578" name="SOLR-9883.patch" size="7544" author="sarowe" created="Wed, 4 Jan 2017 17:11:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37uk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>