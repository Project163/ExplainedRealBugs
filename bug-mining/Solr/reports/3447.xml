<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:23:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10719] Creating a core.properties fails if the parent of core.properties is a symlinked dierctory</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10719</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Well, it doesn&apos;t actually fail until you try to restart the Solr instance. The root is that creating core.properties fails.&lt;/p&gt;

&lt;p&gt;This is due to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8260&quot; title=&quot;Use NIO2 APIs in core discovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8260&quot;&gt;&lt;del&gt;SOLR-8260&lt;/del&gt;&lt;/a&gt;. CorePropertiesLocator.writePropertiesFile changed from:&lt;br/&gt;
propfile.getParentFile().mkdirs();&lt;br/&gt;
to&lt;br/&gt;
Files.createDirectories(propfile.getParent());&lt;/p&gt;

&lt;p&gt;The former (apparently) thinks it&apos;s OK if a symlink points to a directory, but the latter throws an exception.&lt;/p&gt;

&lt;p&gt;So the behavior here is that the call appears to succeed, the replica is created and is functional. Until you restart the instance when it&apos;s not discovered.&lt;/p&gt;

&lt;p&gt;I hacked in a simple test to see if the parent existed already and skip the call to createDirectories if so and ADDREPLICA works just fine. Restarting Solr finds the replica.&lt;/p&gt;

&lt;p&gt;The test &quot;for real&quot; would probably have to be better than this as we probably really want to keep from overwriting an existing replica and the like, didn&apos;t check whether that&apos;s already accounted for though.&lt;/p&gt;

&lt;p&gt;There&apos;s another issue here that failing to write the properties file should fail the ADDREPLICA IMO.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; I&apos;m guessing that this is an unintended side-effect of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8260&quot; title=&quot;Use NIO2 APIs in core discovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8260&quot;&gt;&lt;del&gt;SOLR-8260&lt;/del&gt;&lt;/a&gt; but wanted to check before diving in deeper.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13073573">SOLR-10719</key>
            <summary>Creating a core.properties fails if the parent of core.properties is a symlinked dierctory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 May 2017 21:24:52 +0000</created>
                <updated>Sat, 8 Jun 2019 15:23:33 +0000</updated>
                            <resolved>Tue, 30 May 2017 03:16:50 +0000</resolved>
                                                    <fixVersion>6.6.1</fixVersion>
                    <fixVersion>7.0</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16018045" author="erickerickson" created="Fri, 19 May 2017 21:25:19 +0000"  >&lt;p&gt;Assigning to myself to track, but anyone else should feel free to tackle it.&lt;/p&gt;</comment>
                            <comment id="16019693" author="romseygeek" created="Mon, 22 May 2017 15:18:18 +0000"  >&lt;p&gt;I don&apos;t follow what&apos;s happening here - are you saying that Files.createDirectories() fails, but the ADDREPLICA call succeeds anyway?  That sounds ... wrong?&lt;/p&gt;</comment>
                            <comment id="16019710" author="erickerickson" created="Mon, 22 May 2017 15:32:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; There&apos;s no question that this is wrong. Yes, the ADDREPLICA succeeds. I looked at it quickly and the replica is even up and running. Until you restart solr then core.properties is not found, the core is not discovered and people are left wondering what happened. If you manually reconstruct the core.properties file at the destination of the symlink and restart, the core is alive and healthy. This is not theoretical BTW, it happened &quot;in the field&quot;.&lt;/p&gt;

&lt;p&gt;It&apos;s particularly scary when you then DELETEREPLICA because you see your new replica active. It takes over leadership and everything.&lt;/p&gt;

&lt;p&gt;This worked in earlier versions of Solr.&lt;/p&gt;

&lt;p&gt;Files.createDirectories throws an exception &quot;file already exists&quot; IIRC, but it&apos;s swallowed, doesn&apos;t propagate back up the stack.&lt;/p&gt;

&lt;p&gt;So there are two issues here I suppose:&lt;br/&gt;
1&amp;gt; should we follow symlinks (I think we should)&lt;br/&gt;
2&amp;gt; should failing to write core.properties files cause the ADDREPLICA to fail (I think it should).&lt;/p&gt;

&lt;p&gt;Maybe break &amp;lt;2&amp;gt; out into a new JIRA?&lt;/p&gt;
</comment>
                            <comment id="16025518" author="erickerickson" created="Thu, 25 May 2017 22:58:28 +0000"  >&lt;p&gt;This is actually a bit weirder. Files.createDirectories &lt;em&gt;does&lt;/em&gt; succeed if you specify a subdir of the symlink. So if&lt;br/&gt;
sym -&amp;gt; dir1&lt;/p&gt;

&lt;p&gt;and I ask CreateDirectories to create sym/eoe1/eoe2/eoe3 all the directories are created just fine. But when core.properties is being written, it wants to write to sym/core.properties and the createDirectories fails on creating sym as it&apos;s a symlink.&lt;/p&gt;

&lt;p&gt;I see multiple places in the code where we call Files.createDirectories, even some tagged with&lt;/p&gt;

&lt;p&gt;//note, this will fail if this is a symlink&lt;/p&gt;

&lt;p&gt;All in all, symlinks are going to be a problem in several places in the code.&lt;/p&gt;

&lt;p&gt;So I&apos;m thinking of providing a method  in FileUtils to deal with this kind of thing that would then be available for other users as appropriate.&lt;/p&gt;

&lt;p&gt;Oh, and I&apos;m &lt;em&gt;not&lt;/em&gt; suggesting that we make this a blanket change as I&apos;m not sure these other places &lt;em&gt;should&lt;/em&gt; be changed.&lt;/p&gt;</comment>
                            <comment id="16025778" author="erickerickson" created="Fri, 26 May 2017 04:04:16 +0000"  >&lt;p&gt;First cut at a patch. It seems to handle the cases in this JIRA, i.e. if the dest is a symlink it&apos;ll still create the core and write the core.properties. Additionally, if the core.properties file cannot be created it throws an error.&lt;/p&gt;

&lt;p&gt;Will look more tomorrow but so far this approach looks promising.&lt;/p&gt;</comment>
                            <comment id="16028719" author="jira-bot" created="Tue, 30 May 2017 03:09:48 +0000"  >&lt;p&gt;Commit 412e4ae2c192a5b444dd63220e5918f4e7fd47be in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=412e4ae&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=412e4ae&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10719&quot; title=&quot;Creating a core.properties fails if the parent of core.properties is a symlinked dierctory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10719&quot;&gt;&lt;del&gt;SOLR-10719&lt;/del&gt;&lt;/a&gt;: Creating a core.properties fails if the parent of core.properties is a symlinked dierctory&lt;/p&gt;</comment>
                            <comment id="16028721" author="erickerickson" created="Tue, 30 May 2017 03:11:42 +0000"  >&lt;p&gt;final patch with CHANGES&lt;/p&gt;</comment>
                            <comment id="16028722" author="jira-bot" created="Tue, 30 May 2017 03:15:56 +0000"  >&lt;p&gt;Commit ee10c452d1710ad2b0028675623dfee467981afd in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ee10c45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ee10c45&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10719&quot; title=&quot;Creating a core.properties fails if the parent of core.properties is a symlinked dierctory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10719&quot;&gt;&lt;del&gt;SOLR-10719&lt;/del&gt;&lt;/a&gt;: Creating a core.properties fails if the parent of core.properties is a symlinked dierctory&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 412e4ae)&lt;/p&gt;</comment>
                            <comment id="16134655" author="jira-bot" created="Mon, 21 Aug 2017 02:59:40 +0000"  >&lt;p&gt;Commit 425af4f658de763821fea41b763fb3fda8316ad0 in lucene-solr&apos;s branch refs/heads/branch_6_6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=425af4f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=425af4f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10719&quot; title=&quot;Creating a core.properties fails if the parent of core.properties is a symlinked dierctory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10719&quot;&gt;&lt;del&gt;SOLR-10719&lt;/del&gt;&lt;/a&gt;: Creating a core.properties fails if the parent of core.properties is a symlinked dierctory&lt;/p&gt;

&lt;p&gt;(cherry picked from commit ee10c45)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12870344" name="SOLR-10719.patch" size="3369" author="erickerickson" created="Tue, 30 May 2017 03:11:42 +0000"/>
                            <attachment id="12869994" name="SOLR-10719.patch" size="2828" author="erickerickson" created="Fri, 26 May 2017 04:04:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f8wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>