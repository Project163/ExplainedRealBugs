<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:44:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5601] NPE in OverseerCollectionProcessor.migrateKey - inconsistent failure from MigrateRouteKeyTest</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5601</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Encountered a weird &lt;em&gt;semi-reproducible&lt;/em&gt; failure from MigrateRouteKeyTest.... &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant test  -Dtestcase=MigrateRouteKeyTest -Dtests.method=testDistribSearch -Dtests.seed=26F9FF92782251B6 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=sr_CS -Dtests.timezone=Europe/Zaporozhye -Dtests.file.encoding=UTF-8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attempting to reproduce with that line caused failures the first 2 times i tried, and then succeeded every time after that.&lt;/p&gt;

&lt;p&gt;Details of failure to follow in comment.&lt;/p&gt;

&lt;p&gt;(NOTE: this may be related to some recent jenkins failures due to thread leaks from this test)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12687080">SOLR-5601</key>
            <summary>NPE in OverseerCollectionProcessor.migrateKey - inconsistent failure from MigrateRouteKeyTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Jan 2014 23:55:56 +0000</created>
                <updated>Mon, 9 May 2016 18:49:31 +0000</updated>
                            <resolved>Mon, 6 Jan 2014 16:02:52 +0000</resolved>
                                    <version>4.7</version>
                                    <fixVersion>4.7</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13860972" author="hossman" created="Thu, 2 Jan 2014 23:56:23 +0000"  >&lt;p&gt;The initial start of trouble seened to me an NPE in OverseerCollectionProcessor.migrateKey...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 324502 T1186 oasc.ZkController.checkRecovery I am the leader, no recovery necessary
   [junit4]   2&amp;gt; 324502 T1186 oasc.ZkController.publish publishing core=split_shard2_temp_shard1_shard1_replica1 state=active
   [junit4]   2&amp;gt; 324514 T1228 C220 P42114 oasup.LogUpdateProcessor.finish [collection1] webapp=/tr_/xq path=/update params={distrib.from=http://127.0.0.1:47570/tr_/xq/collection1/&amp;amp;version=2&amp;amp;wt=javabin&amp;amp;update.distrib=FROMLEADER} {add=[m/1!116 (1456162963872284672)]} 0 0
   [junit4]   2&amp;gt; 324515 T1189 C221 P47570 oasup.LogUpdateProcessor.finish [collection1] webapp=/tr_/xq path=/update params={version=2&amp;amp;wt=javabin} {add=[m/1!116 (1456162963872284672)]} 0 3
   [junit4]   2&amp;gt; 324526 T1186 oascc.ZkStateReader.updateClusterState Updating cloud state from ZooKeeper... 
   [junit4]   2&amp;gt; 324527 T1186 oasc.SolrXMLCoresLocator.doPersist Persisted core descriptions to /home/hossman/lucene/dev/solr/build/solr-core/test/J2/../../../../../../../../../home/hossman/lucene/dev/solr/build/solr-core/test/J2/./org.apache.solr.cloud.MigrateRouteKeyTest-jetty1-1388705195623/solr.xml
   [junit4]   2&amp;gt; 324527 T1186 oass.SolrDispatchFilter.handleAdminRequest [admin] webapp=null path=/admin/cores params={numShards=1&amp;amp;collection.configName=conf1&amp;amp;version=2&amp;amp;wt=javabin&amp;amp;name=split_shard2_temp_shard1_shard1_replica1&amp;amp;shard=shard1&amp;amp;collection=split_shard2_temp_shard1&amp;amp;qt=/admin/cores&amp;amp;action=CREATE} status=0 QTime=1656 
   [junit4]   2&amp;gt; 324528 T1174 oasc.OverseerCollectionProcessor.createCollection Finished create command on all shards for collection: split_shard2_temp_shard1
   [junit4]   2&amp;gt; 324528 T1174 oasc.OverseerCollectionProcessor.migrateKey Asking source leader to wait for: split_shard2_temp_shard1_shard1_replica1 to be alive on: 127.0.0.1:47570_tr_%2Fxq
   [junit4]   2&amp;gt; 324528 T1174 oasc.SolrException.log ERROR Collection migrate of migrate failed:java.lang.NullPointerException
   [junit4]   2&amp;gt; 		at org.apache.solr.cloud.OverseerCollectionProcessor.migrateKey(OverseerCollectionProcessor.java:1208)
   [junit4]   2&amp;gt; 		at org.apache.solr.cloud.OverseerCollectionProcessor.migrate(OverseerCollectionProcessor.java:1102)
   [junit4]   2&amp;gt; 		at org.apache.solr.cloud.OverseerCollectionProcessor.processMessage(OverseerCollectionProcessor.java:252)
   [junit4]   2&amp;gt; 		at org.apache.solr.cloud.OverseerCollectionProcessor.run(OverseerCollectionProcessor.java:176)
   [junit4]   2&amp;gt; 		at java.lang.Thread.run(Thread.java:724)
   [junit4]   2&amp;gt; 	
   [junit4]   2&amp;gt; 324551 T1217 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/collection-queue-work/qnr-0000000002 state: SyncConnected type NodeDataChanged
   [junit4]   2&amp;gt; 324552 T1172 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/queue state: SyncConnected type NodeChildrenChanged
   [junit4]   2&amp;gt; 324552 T1172 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/queue state: SyncConnected type NodeChildrenChanged
   [junit4]   2&amp;gt; 324559 T1172 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/collection-queue-work state: SyncConnected type NodeChildrenChanged
   [junit4]   2&amp;gt; 324559 T1174 oasc.OverseerCollectionProcessor.run Overseer Collection Processor: Message id:/overseer/collection-queue-work/qn-0000000002 complete, response:{success={null={responseHeader={status=0,QTime=0},core=migrate_multipleshardtest_targetCollection_shard1_replica1,status=BUFFERING},null={responseHeader={status=0,QTime=1656},core=split_shard2_temp_shard1_shard1_replica1}},Operation migrate caused exception:=java.lang.NullPointerException,exception={msg=null,rspCode=-1}}
   [junit4]   2&amp;gt; 324568 T1173 oascc.ZkStateReader.updateClusterState Updating cloud state from ZooKeeper... 
   [junit4]   2&amp;gt; 324569 T1173 oasc.Overseer$ClusterStateUpdater.updateState Update state numShards=1 message={
   [junit4]   2&amp;gt; 	  &quot;operation&quot;:&quot;state&quot;,
   [junit4]   2&amp;gt; 	  &quot;state&quot;:&quot;active&quot;,
   [junit4]   2&amp;gt; 	  &quot;base_url&quot;:&quot;http://127.0.0.1:47570/tr_/xq&quot;,
   [junit4]   2&amp;gt; 	  &quot;core&quot;:&quot;split_shard2_temp_shard1_shard1_replica1&quot;,
   [junit4]   2&amp;gt; 	  &quot;roles&quot;:null,
   [junit4]   2&amp;gt; 	  &quot;node_name&quot;:&quot;127.0.0.1:47570_tr_%2Fxq&quot;,
   [junit4]   2&amp;gt; 	  &quot;shard&quot;:&quot;shard1&quot;,
   [junit4]   2&amp;gt; 	  &quot;shard_range&quot;:null,
   [junit4]   2&amp;gt; 	  &quot;shard_state&quot;:&quot;active&quot;,
   [junit4]   2&amp;gt; 	  &quot;shard_parent&quot;:null,
   [junit4]   2&amp;gt; 	  &quot;collection&quot;:&quot;split_shard2_temp_shard1&quot;,
   [junit4]   2&amp;gt; 	  &quot;numShards&quot;:&quot;1&quot;,
   [junit4]   2&amp;gt; 	  &quot;core_node_name&quot;:&quot;core_node1&quot;}
   [junit4]   2&amp;gt; 324570 T1209 oass.SolrDispatchFilter.handleAdminRequest [admin] webapp=null path=/admin/collections params={split.key=a/1!&amp;amp;version=2&amp;amp;wt=javabin&amp;amp;forward.timeout=45&amp;amp;collection=collection1&amp;amp;target.collection=migrate_multipleshardtest_targetCollection&amp;amp;action=MIGRATE} status=500 QTime=2211 
   [junit4]   2&amp;gt; 324571 T1209 oasc.SolrException.log ERROR null:org.apache.solr.common.SolrException
   [junit4]   2&amp;gt; 		at org.apache.solr.handler.admin.CollectionsHandler.handleResponse(CollectionsHandler.java:204)
   [junit4]   2&amp;gt; 		at org.apache.solr.handler.admin.CollectionsHandler.handleMigrate(CollectionsHandler.java:450)
   [junit4]   2&amp;gt; 		at org.apache.solr.handler.admin.CollectionsHandler.handleRequestBody(CollectionsHandler.java:174)
   [junit4]   2&amp;gt; 		at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)
   [junit4]   2&amp;gt; 		at org.apache.solr.servlet.SolrDispatchFilter.handleAdminRequest(SolrDispatchFilter.java:705)
   [junit4]   2&amp;gt; 		at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:260)
   [junit4]   2&amp;gt; 		at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:200)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)
   [junit4]   2&amp;gt; 		at org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:136)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:229)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.handler.GzipHandler.handle(GzipHandler.java:301)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1077)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.Server.handle(Server.java:368)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:489)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:942)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:1004)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)
   [junit4]   2&amp;gt; 		at java.lang.Thread.run(Thread.java:724)
   [junit4]   2&amp;gt; 	
   [junit4]   2&amp;gt; 324572 T1249 C222 P46266 oasup.LogUpdateProcessor.finish [collection1] webapp=/tr_/xq path=/update params={distrib.from=http://127.0.0.1:52363/tr_/xq/collection1/&amp;amp;version=2&amp;amp;wt=javabin&amp;amp;update.distrib=FROMLEADER} {add=[n/1!117 (1456162963931004928)]} 0 0
   [junit4]   2&amp;gt; 324573 T1207 C223 P52363 oasup.LogUpdateProcessor.finish [collection1] webapp=/tr_/xq path=/update params={version=2&amp;amp;wt=javabin} {add=[n/1!117 (1456162963931004928)]} 0 5
   [junit4]   2&amp;gt; 324585 T1146 oasc.ChaosMonkey.monkeyLog monkey: stop shard! 36682
   [junit4]   2&amp;gt; 324585 T1146 oasc.CoreContainer.shutdown Shutting down CoreContainer instance=2033417453
   [junit4]   2&amp;gt; 324586 T1146 oasc.ZkController.publish publishing core=collection1 state=down
   [junit4]   2&amp;gt; 324586 T1146 oasc.ZkController.publish numShards not found on descriptor - reading it from system property
   [junit4]   2&amp;gt; 324617 T1172 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/queue state: SyncConnected type NodeChildrenChanged
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...which then cascaded into an &quot;IllegalStateException: Connection pool shut down&quot;...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 324711 T1281 oascc.ZkStateReader.createClusterStateWatchersAndUpdate Updating cluster state from ZooKeeper... 
   [junit4]   2&amp;gt; 324718 T1197 oascc.SolrZkClient.makePath makePath: /overseer_elect/leader
   [junit4]   2&amp;gt; 324722 T1146 oejsh.ContextHandler.doStop stopped o.e.j.s.ServletContextHandler{/tr_/xq,null}
   [junit4]   2&amp;gt; 324726 T1197 oasc.Overseer.start Overseer (id=91010183481589766-127.0.0.1:47570_tr_%2Fxq-n_0000000001) starting
   [junit4]   2&amp;gt; 324727 T1281 oasc.MigrateRouteKeyTest$Indexer.run ERROR Exception while adding document id: id=o/1!118 org.apache.solr.client.solrj.SolrServerException: org.apache.solr.client.solrj.SolrServerException: java.lang.IllegalStateException: Connection pool shut down
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrServer.directUpdate(CloudSolrServer.java:361)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrServer.request(CloudSolrServer.java:510)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.request.AbstractUpdateRequest.process(AbstractUpdateRequest.java:117)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:116)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:102)
   [junit4]   2&amp;gt; 	at org.apache.solr.cloud.MigrateRouteKeyTest$Indexer.run(MigrateRouteKeyTest.java:252)
   [junit4]   2&amp;gt; Caused by: org.apache.solr.client.solrj.SolrServerException: java.lang.IllegalStateException: Connection pool shut down
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:310)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrServer.directUpdate(CloudSolrServer.java:358)
   [junit4]   2&amp;gt; 	... 5 more
   [junit4]   2&amp;gt; Caused by: java.lang.IllegalStateException: Connection pool shut down
   [junit4]   2&amp;gt; 	at org.apache.http.pool.AbstractConnPool.lease(AbstractConnPool.java:167)
   [junit4]   2&amp;gt; 	at org.apache.http.pool.AbstractConnPool.lease(AbstractConnPool.java:199)
   [junit4]   2&amp;gt; 	at org.apache.http.impl.conn.PoolingClientConnectionManager.requestConnection(PoolingClientConnectionManager.java:188)
   [junit4]   2&amp;gt; 	at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:448)
   [junit4]   2&amp;gt; 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:906)
   [junit4]   2&amp;gt; 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:805)
   [junit4]   2&amp;gt; 	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:784)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:395)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:283)
   [junit4]   2&amp;gt; 	... 6 more
   [junit4]   2&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;...lots more &quot;IllegalStateException: Connection pool shut down&quot; for various doc add attempts, ultimatly leading to...&lt;/p&gt;



&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=MigrateRouteKeyTest -Dtests.method=testDistribSearch -Dtests.seed=26F9FF92782251B6 -Dtests.slow=true -Dtests.locale=sr_CS -Dtests.timezone=Europe/Zaporozhye -Dtests.file.encoding=UTF-8
   [junit4] ERROR   28.8s J2 | MigrateRouteKeyTest.testDistribSearch &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: Server Error
   [junit4]    &amp;gt; request: http://127.0.0.1:52363/tr_/xq/admin/collections?action=MIGRATE&amp;amp;collection=collection1&amp;amp;target.collection=migrate_multipleshardtest_targetCollection&amp;amp;split.key=a/1!&amp;amp;forward.timeout=45&amp;amp;wt=javabin&amp;amp;version=2
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([26F9FF92782251B6:A71F718A0F7D318A]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:495)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.MigrateRouteKeyTest.invoke(MigrateRouteKeyTest.java:139)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.MigrateRouteKeyTest.invokeMigrateApi(MigrateRouteKeyTest.java:125)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.MigrateRouteKeyTest.multipleShardMigrateTest(MigrateRouteKeyTest.java:198)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.MigrateRouteKeyTest.doTest(MigrateRouteKeyTest.java:93)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:867)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:724)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;...and then...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 50947 T1145 ccr.ThreadLeakControl.checkThreadLeaks SEVERE 4 threads leaked from SUITE scope at org.apache.solr.cloud.MigrateRouteKeyTest: 
   [junit4]   2&amp;gt; 	   1) Thread[id=1298, name=Timer-98, state=TIMED_WAITING, group=TGRP-MigrateRouteKeyTest]
   [junit4]   2&amp;gt; 	        at java.lang.Object.wait(Native Method)
   [junit4]   2&amp;gt; 	        at java.util.TimerThread.mainLoop(Timer.java:552)
   [junit4]   2&amp;gt; 	        at java.util.TimerThread.run(Timer.java:505)
   [junit4]   2&amp;gt; 	   2) Thread[id=1299, name=Thread-532-SendThread(localhost:46743), state=TIMED_WAITING, group=TGRP-MigrateRouteKeyTest]
   [junit4]   2&amp;gt; 	        at java.lang.Thread.sleep(Native Method)
   [junit4]   2&amp;gt; 	        at org.apache.zookeeper.client.StaticHostProvider.next(StaticHostProvider.java:86)
   [junit4]   2&amp;gt; 	        at org.apache.zookeeper.ClientCnxn$SendThread.startConnect(ClientCnxn.java:937)
   [junit4]   2&amp;gt; 	        at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:993)
   [junit4]   2&amp;gt; 	   3) Thread[id=1300, name=Thread-532-EventThread, state=WAITING, group=TGRP-MigrateRouteKeyTest]
   [junit4]   2&amp;gt; 	        at sun.misc.Unsafe.park(Native Method)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]   2&amp;gt; 	        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:491)
   [junit4]   2&amp;gt; 	   4) Thread[id=1281, name=Thread-532, state=TIMED_WAITING, group=TGRP-MigrateRouteKeyTest]
   [junit4]   2&amp;gt; 	        at java.lang.Object.wait(Native Method)
   [junit4]   2&amp;gt; 	        at org.apache.solr.common.cloud.ConnectionManager.waitForConnected(ConnectionManager.java:204)
   [junit4]   2&amp;gt; 	        at org.apache.solr.common.cloud.SolrZkClient.&amp;lt;init&amp;gt;(SolrZkClient.java:139)
   [junit4]   2&amp;gt; 	        at org.apache.solr.common.cloud.SolrZkClient.&amp;lt;init&amp;gt;(SolrZkClient.java:98)
   [junit4]   2&amp;gt; 	        at org.apache.solr.common.cloud.SolrZkClient.&amp;lt;init&amp;gt;(SolrZkClient.java:88)
   [junit4]   2&amp;gt; 	        at org.apache.solr.common.cloud.ZkStateReader.&amp;lt;init&amp;gt;(ZkStateReader.java:183)
   [junit4]   2&amp;gt; 	        at org.apache.solr.client.solrj.impl.CloudSolrServer.connect(CloudSolrServer.java:240)
   [junit4]   2&amp;gt; 	        at org.apache.solr.client.solrj.impl.CloudSolrServer.request(CloudSolrServer.java:501)
   [junit4]   2&amp;gt; 	        at org.apache.solr.client.solrj.request.AbstractUpdateRequest.process(AbstractUpdateRequest.java:117)
   [junit4]   2&amp;gt; 	        at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:116)
   [junit4]   2&amp;gt; 	        at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:102)
   [junit4]   2&amp;gt; 	        at org.apache.solr.cloud.MigrateRouteKeyTest$Indexer.run(MigrateRouteKeyTest.java:252)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="13861176" author="anshumg" created="Fri, 3 Jan 2014 03:57:41 +0000"  >&lt;p&gt;I tried running the test 50 times over but didn&apos;t yet run into it.&lt;/p&gt;

&lt;p&gt;Looks like it had issues at one of the 2 spots considering that it never seemed to have asked the source leader to split the index:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;While constructing the WaitForState call i.e. waiting for the replicas to be seen as active on temp source leader (More likely as I couldn&apos;t spot any logs from there)&lt;/li&gt;
	&lt;li&gt;During the above mentioned WaitForState call.&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="13861494" author="shalinmangar" created="Fri, 3 Jan 2014 13:21:08 +0000"  >&lt;p&gt;This should fix it. It was possible that the temp collection had been created (since we wait for it) but the leader hadn&apos;t been elected yet causing the NPE. We should use zkStateReader.getLeaderRetry for this.&lt;/p&gt;</comment>
                            <comment id="13861508" author="jira-bot" created="Fri, 3 Jan 2014 13:39:28 +0000"  >&lt;p&gt;Commit 1555083 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1555083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1555083&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5601&quot; title=&quot;NPE in OverseerCollectionProcessor.migrateKey - inconsistent failure from MigrateRouteKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5601&quot;&gt;&lt;del&gt;SOLR-5601&lt;/del&gt;&lt;/a&gt;: Use zkStateReader.getLeaderRetry to find the leader of a newly created temp collection&lt;/p&gt;</comment>
                            <comment id="13861519" author="jira-bot" created="Fri, 3 Jan 2014 13:41:35 +0000"  >&lt;p&gt;Commit 1555084 from shalin@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1555084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1555084&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5601&quot; title=&quot;NPE in OverseerCollectionProcessor.migrateKey - inconsistent failure from MigrateRouteKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5601&quot;&gt;&lt;del&gt;SOLR-5601&lt;/del&gt;&lt;/a&gt;: Use zkStateReader.getLeaderRetry to find the leader of a newly created temp collection&lt;/p&gt;</comment>
                            <comment id="13863062" author="shalinmangar" created="Mon, 6 Jan 2014 16:02:52 +0000"  >&lt;p&gt;I haven&apos;t seen this issue again on jenkins and couldn&apos;t reproduce this after the fix on my ec2 test box.&lt;/p&gt;

&lt;p&gt;Thanks Hoss and Anshum!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12621323" name="SOLR-5601.patch" size="1104" author="shalin" created="Fri, 3 Jan 2014 13:21:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366075</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 46 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1r3ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366386</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>