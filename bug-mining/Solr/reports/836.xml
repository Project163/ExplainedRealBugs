<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:26:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2124] SEVERE exceptions are being logged for expected PingRequestHandler SERVICE_UNAVAILABLE exceptions</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2124</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As reported by a user, if you use the PingRequestHandler, and the corrisponding helthcheck file doesn&apos;t exist (and expected situation when a server is out of rotation) Solr is logging a SEVERE error...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SEVERE: org.apache.solr.common.SolrException: Service disabled
	at org.apache.solr.handler.PingRequestHandler.handleRequestBody(PingRequestHandler.java:48)
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:1324)
	at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:337)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:240)
	at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)
	at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388)
	at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)
	at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)
	at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765)
	at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:418)
	at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)
	at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)
	at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)
	at org.mortbay.jetty.Server.handle(Server.java:326)
	at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)
	at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:923)
	at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:547)
	at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)
	at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)
	at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:228)
	at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is in spite of hte fact that PingRequestHandler explicitly sets the &quot;alreadyLogged&quot; boolean to true in the SolrException constructor.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12474462">SOLR-2124</key>
            <summary>SEVERE exceptions are being logged for expected PingRequestHandler SERVICE_UNAVAILABLE exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdyer">James Dyer</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Sat, 18 Sep 2010 02:04:18 +0000</created>
                <updated>Fri, 10 May 2013 10:40:26 +0000</updated>
                            <resolved>Tue, 20 Mar 2012 17:50:48 +0000</resolved>
                                                    <fixVersion>3.6</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12910890" author="hossman" created="Sat, 18 Sep 2010 02:09:32 +0000"  >&lt;p&gt;At first glance, this seems like a fundemental problem with how the &quot;logged&quot; property of SolrException is used ... logOnce is hte only method that ever tests it, the other log methods blindly set it to true and proceed with logging.&lt;/p&gt;

&lt;p&gt;if this is intentional, then i suspect there are lots of places in the code that are using &quot;log&quot; when they are suppose to be using &quot;logOnce&quot;&lt;/p&gt;

&lt;p&gt;(It also makes no sense to me that the &quot;logged&quot; property is defaulted to &quot;true&quot; in several constructors)&lt;/p&gt;</comment>
                            <comment id="12921419" author="elyograg" created="Fri, 15 Oct 2010 16:04:07 +0000"  >&lt;p&gt;I looked at the 1.4.1 source, since that&apos;s what I am using at the moment.  I changed one line in RequestHandlerBase.java.  Original line:&lt;/p&gt;

&lt;p&gt;SolrException.log(SolrCore.log,e);&lt;/p&gt;

&lt;p&gt;New line:&lt;/p&gt;

&lt;p&gt;SolrException.logOnce(SolrCore.log,null,e);&lt;/p&gt;

&lt;p&gt;The modified 1.4.1 source successfully compiled and passed all junit tests.  It&apos;ll take me a while to get to the point where I can try it out to see whether it actually makes things better.  I&apos;m not qualified to check whether this change will cause problems elsewhere.  This change does not address Hoss&apos;s parenthetical comment regarding the logged property defaulting to true.&lt;/p&gt;</comment>
                            <comment id="12921421" author="yseeley@gmail.com" created="Fri, 15 Oct 2010 16:17:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;if this is intentional, then i suspect there are lots of places in the code that are using &quot;log&quot; when they are suppose to be using &quot;logOnce&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep, probably so.  Last time I audited the exception logging for that was so long ago that I I think I worked at CNET &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;(It also makes no sense to me that the &quot;logged&quot; property is defaulted to &quot;true&quot; in several constructors)&lt;br/&gt;
Hmmm, yeah.  Wish I could remember why that was.&lt;br/&gt;
If we change, we should probably check out all of the places that use those constructors too.&lt;/p&gt;</comment>
                            <comment id="12921426" author="elyograg" created="Fri, 15 Oct 2010 16:23:06 +0000"  >&lt;p&gt;I was able to test it sooner than I expected.  I am now getting no log at all when checking the ping handler on a disabled core, which I suspect is not a desirable effect, and probably due to the logged property defaulting to true as Hoss mentioned.&lt;/p&gt;</comment>
                            <comment id="12921427" author="yseeley@gmail.com" created="Fri, 15 Oct 2010 16:29:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;(It also makes no sense to me that the &quot;logged&quot; property is defaulted to &quot;true&quot; in several constructors)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It looks like it always defaults to true if it takes a Throwable.&lt;br/&gt;
I guess the original idea was probably that if you caught a Throwable, you should either log it right there (as opposed to logging the SolrException), or not at all.&lt;/p&gt;</comment>
                            <comment id="12921895" author="elyograg" created="Sun, 17 Oct 2010 20:13:21 +0000"  >&lt;p&gt;I spent a while trying to work out the changes required to use logOnce and have it work as expected, got overwhelmed and lost.  Then I started with a fresh source tarball and tried to figure out how to just get it to log an error instead of throwing an exception.  I lack the necessary java skills to do something so basic.&lt;/p&gt;</comment>
                            <comment id="12988444" author="rcmuir" created="Sat, 29 Jan 2011 12:25:12 +0000"  >&lt;p&gt;Moving out all unassigned issues set to 3.1 per this email: &lt;a href=&quot;http://www.lucidimagination.com/search/document/f026cc56081b5a51/unassigned_jira_issues_set_for_3_1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.lucidimagination.com/search/document/f026cc56081b5a51/unassigned_jira_issues_set_for_3_1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13043787" author="rcmuir" created="Fri, 3 Jun 2011 16:47:03 +0000"  >&lt;p&gt;Bulk move 3.2 -&amp;gt; 3.3&lt;/p&gt;</comment>
                            <comment id="13106289" author="rcmuir" created="Fri, 16 Sep 2011 14:50:24 +0000"  >&lt;p&gt;3.4 -&amp;gt; 3.5&lt;/p&gt;</comment>
                            <comment id="13224589" author="erickerickson" created="Wed, 7 Mar 2012 18:55:58 +0000"  >&lt;p&gt;A lot has changed since this was submitted, see: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2191&quot; title=&quot;Change SolrException cstrs that take Throwable to default to alreadyLogged=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2191&quot;&gt;&lt;del&gt;SOLR-2191&lt;/del&gt;&lt;/a&gt; and associated. Is this still an issue? I confess I&apos;m not quite sure how to reproduce it to test (hint, hint)....&lt;/p&gt;</comment>
                            <comment id="13224608" author="jdyer" created="Wed, 7 Mar 2012 19:17:24 +0000"  >&lt;p&gt;I think this is still a problem.  I have a snapshot from 1/31 (post-2191 and its children) and it still logs a whole stack trace every time the load balancer pings it, if the &quot;service-enabled&quot; file is missing.  This is a pretty big annoyance for me because I often use a &quot;live&quot;, load-balanced dev environment to test new versions with the testing node taken &quot;out&quot; using this ping feature.  If nobody else does anything, I&apos;ll likely be annoyed enough to fix it eventually.&lt;/p&gt;</comment>
                            <comment id="13224653" author="erickerickson" created="Wed, 7 Mar 2012 19:57:17 +0000"  >&lt;p&gt;James:&lt;/p&gt;

&lt;p&gt;I&apos;ll let you get to it then when you get annoyed &amp;lt;G&amp;gt;....&lt;/p&gt;

&lt;p&gt;Do note that the whole logOnce stuff doesn&apos;t exist any more in trunk, FWIW....&lt;/p&gt;</comment>
                            <comment id="13232756" author="jdyer" created="Mon, 19 Mar 2012 17:42:28 +0000"  >&lt;p&gt;Patch changes SolrException to not log the exception if its 503/&quot;Service Unavailable&quot;.  In all cases this is used, the 503 SE is thrown intentionally.  That is, its really not a Runtime-style exception at all.  There is nothing to debug and a stack trace is no going to be helpful.&lt;/p&gt;

&lt;p&gt;For PingRequestHandler, this is what it logs AFTER the patch:&lt;/p&gt;

&lt;p&gt;12:33:45,836 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;SolrCore&amp;#93;&lt;/span&gt; [] webapp=/Solr_Trunk path=/admin/ping params={} status=503 QTime=0 &lt;/p&gt;

&lt;p&gt;(compare with the full stack trace in the Description)&lt;/p&gt;

&lt;p&gt;I will commit shortly if nobody objects.&lt;/p&gt;</comment>
                            <comment id="13232766" author="elyograg" created="Mon, 19 Mar 2012 17:49:01 +0000"  >&lt;p&gt;Thank you, James!  I am really looking forward to 3.6.&lt;/p&gt;</comment>
                            <comment id="13233614" author="jdyer" created="Tue, 20 Mar 2012 17:50:48 +0000"  >&lt;p&gt;committed.&lt;/p&gt;

&lt;p&gt;Trunk: r1302970&lt;br/&gt;
Branch_3x: r1303037&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12478183">SOLR-2191</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12518916" name="SOLR-2124.patch" size="1341" author="jdyer" created="Mon, 19 Mar 2012 17:42:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5383</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03mnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19105</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>