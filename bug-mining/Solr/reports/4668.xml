<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:47:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15169] SolrPaths.assertPathAllowed normalization problem</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15169</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In the &lt;tt&gt;SolrPaths.assertPathAllowed&lt;/tt&gt; the &lt;tt&gt;normalize()&lt;/tt&gt; method is only called for &lt;tt&gt;pathToAssert&lt;/tt&gt; and not for the &lt;tt&gt;allowPaths&lt;/tt&gt; elements, which means that the following call gives SolrException:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SolrPaths.assertPathAllowed(Path.of(&quot;/a/b/../b/d&quot;), Set.of(Path.of(&quot;/a/b/../b&quot;), Path.of(&quot;/c&quot;))); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;even if &quot;a/b/..b/&quot; is a prefix of &quot;/a/b/../b/d&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13359581">SOLR-15169</key>
            <summary>SolrPaths.assertPathAllowed normalization problem</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="asalamon74">Andras Salamon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Feb 2021 12:41:33 +0000</created>
                <updated>Thu, 12 May 2022 00:26:27 +0000</updated>
                            <resolved>Sun, 11 Apr 2021 16:23:31 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="9000">2.5h</timespent>
                                <comments>
                            <comment id="17289243" author="mdrob" created="Tue, 23 Feb 2021 18:23:54 +0000"  >&lt;p&gt;I&apos;m not sure that it is a good idea to start allowing directory traversal for the allowed paths. I don&apos;t have a specific proof of concept for the kind of escalation it would allow, but intuitively something about it feels wrong.&lt;/p&gt;

&lt;p&gt;That said, if we are going to do this, we should normalize when we add the path elements in the CoreContainer constructor and store those, not doing the normalize on each check.&lt;/p&gt;

&lt;p&gt;I would also move the unit test to TestCoreContainer, we already have some similar tests there, instead of creating a new class.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Will need to think some more about whether this is safe, though. Maybe somebody else will be able to chime in with additional perspective.&lt;/p&gt;</comment>
                            <comment id="17289371" author="janhoy" created="Tue, 23 Feb 2021 21:51:38 +0000"  >&lt;p&gt;Please describe the problem from the end user&#8217;s perspective. &lt;/p&gt;

&lt;p&gt;How do they configure solr?&lt;br/&gt;
How will this lead to an allowed path being rejected?&lt;/p&gt;</comment>
                            <comment id="17289829" author="asalamon74" created="Wed, 24 Feb 2021 10:17:32 +0000"  >&lt;p&gt;Thanks for the comments.&lt;/p&gt;

&lt;p&gt;I was not trying to add a new feature, I backported&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14561&quot; title=&quot;Validate parameters to CoreAdminAPI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14561&quot;&gt;&lt;del&gt;SOLR-14561&lt;/del&gt;&lt;/a&gt;&#160;to our Solr 8.4.1 (+lots of patches) and got several similar unit test failures:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SolrCloudExampleTest
ShardRoutingCustomTest
TestRandomRequestDistribution
TestCloudManagedSchema
CheckHdfsIndexTest&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with errors like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit4]   2&amp;gt; 7410 ERROR (qtp1427077336-53) [n:127.0.0.1:60158_sr_%2Fm    x:control_collection_shard1_replica_n1 ] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: Path /Users/andrassalamon/src/lucene-solr/solr/build/solr-core/test/J0/temp/solr.cloud.SolrCloudExampleTest_C8068C6606AB5C90-001/control-001/cores/control_collection_shard1_replica_n1 must be relative to SOLR_HOME, SOLR_DATA_HOME coreRootDirectory. Set system property &apos;solr.allowPaths&apos; to add
 other allowed paths. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Checking the logs showed that the normalize method will converter&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/Users/andrassalamon/src/lucene-solr/solr/build/solr-core/test/J0/../../../../../../../../../Users/andrassalamon/src/lucene-solr/solr/build/solr-core/test/J0/temp/solr.cloud.ShardRoutingCustomTest_7699317C45F3CE23-001/control-001/cores/control_collection_shard1_replica_n1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;./Users/andrassalamon/src/lucene-solr/solr/build/solr-core/test/J0/temp/solr.cloud.ShardRoutingCustomTest_7699317C45F3CE23-001/control-001/cores/control_collection_shard1_replica_n1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and after that even if allowedPath contains the following two paths:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/Users/andrassalamon/src/lucene-solr/solr/build/solr-core/test/J0/../../../../../../../../../Users/andrassalamon/src/lucene-solr/solr/build/solr-core/test/J0/temp/solr.cloud.ShardRoutingCustomTest_7699317C45F3CE23-001/control-001,
/Users/andrassalamon/src/lucene-solr/solr/build/solr-core/test/J0/../../../../../../../../../Users/andrassalamon/src/lucene-solr/solr/build/solr-core/test/J0/temp/solr.cloud.ShardRoutingCustomTest_7699317C45F3CE23-001/control-001/cores
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;startsWith will return false.&lt;/p&gt;

&lt;p&gt;I checked the code and found the problem in the SolrPaths.assertPathAllowed method.&lt;/p&gt;

&lt;p&gt;I do think it&apos;s not a good idea to call normalize for pathToAssert and not call it for allowPaths. To be honest I wouldn&apos;t call it at all, but the comment before the call implies that it&apos;s important.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;// Conversion Path -&amp;gt; String -&amp;gt; Path is to be able to compare against org.apache.lucene.mockfile.FilterPath instances&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so that&apos;s why I added the normalize.&lt;/p&gt;</comment>
                            <comment id="17308511" author="janhoy" created="Thu, 25 Mar 2021 09:06:48 +0000"  >&lt;p&gt;Can you share your unit test class with us? I wonder how you end up with all those relative paths in the first place&lt;/p&gt;</comment>
                            <comment id="17308522" author="asalamon74" created="Thu, 25 Mar 2021 09:22:30 +0000"  >&lt;p&gt;These are not special unit test classes, just the same classes which can be found in upstream. For example SolrCloudExampleTest: &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr%2F8.4.1/solr/core/src/test/org/apache/solr/cloud/SolrCloudExampleTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr%2F8.4.1/solr/core/src/test/org/apache/solr/cloud/SolrCloudExampleTest.java&lt;/a&gt;&#160;So I don&apos;t really understand why those relative path caused problems for us and not upstream.&lt;/p&gt;</comment>
                            <comment id="17318864" author="jira-bot" created="Sun, 11 Apr 2021 16:22:21 +0000"  >&lt;p&gt;Commit 963a81de14535139a637d901875c25760d14da8a in solr&apos;s branch refs/heads/main from Andr&#225;s Salamon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=963a81d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=963a81d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15169&quot; title=&quot;SolrPaths.assertPathAllowed normalization problem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15169&quot;&gt;&lt;del&gt;SOLR-15169&lt;/del&gt;&lt;/a&gt; SolrPaths.assertPathAllowed normalization problem (#22)&lt;/p&gt;
</comment>
                            <comment id="17535420" author="janhoy" created="Thu, 12 May 2022 00:26:27 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nubs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>