<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:11:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3696] LBHttpSolrServer&apos;s aliveCheckExecutor is not closed in RecoveryZkTest (and possibly other tests)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3696</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;LBHttpSolrServer is never shut down properly and leaks pool threads from aliveCheckExecutor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600814">SOLR-3696</key>
            <summary>LBHttpSolrServer&apos;s aliveCheckExecutor is not closed in RecoveryZkTest (and possibly other tests)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="dweiss">Dawid Weiss</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 31 Jul 2012 09:51:19 +0000</created>
                <updated>Fri, 7 Nov 2025 08:38:09 +0000</updated>
                            <resolved>Thu, 25 Sep 2025 20:50:32 +0000</resolved>
                                                    <fixVersion>9.10</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17879955" author="dsmiley" created="Fri, 6 Sep 2024 18:49:25 +0000"  >&lt;p&gt;Searching for &quot;aliveCheckExecutor&quot; in CI build emails, and based on my experience with a test failure today, the most common test exhibiting this is CollectionsRepairEventListenerTest.&lt;br/&gt;
I reviewed LBSolrClient and I think it&apos;s properly handling the lifecycle.  It won&apos;t be resurrected after closure.  So I suspect the LBSolrClient itself might be mismanaged (not closed).  I see LBSolrClient isn&apos;t using ObjectReleaseTracker so I suggest the next step is to do this and hope something comes up.&lt;/p&gt;</comment>
                            <comment id="17879978" author="hossman" created="Fri, 6 Sep 2024 21:22:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;I see LBSolrClient isn&apos;t using ObjectReleaseTracker so I suggest the next step is to do this and hope something comes up.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17880058" author="jira-bot" created="Sat, 7 Sep 2024 16:45:22 +0000"  >&lt;p&gt;Commit 7063334fd00f406d33ed79f2c1bf79c4e30969a3 in solr&apos;s branch refs/heads/main from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=7063334fd00&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=7063334fd00&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3696&quot; title=&quot;LBHttpSolrServer&amp;#39;s aliveCheckExecutor is not closed in RecoveryZkTest (and possibly other tests)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3696&quot;&gt;&lt;del&gt;SOLR-3696&lt;/del&gt;&lt;/a&gt;: LBSolrClient use ObjectReleaseTracker (#2695)&lt;/p&gt;
</comment>
                            <comment id="17880061" author="jira-bot" created="Sat, 7 Sep 2024 17:49:17 +0000"  >&lt;p&gt;Commit 4537c166a812b90a4c7cbed591ddaf148445fb6b in solr&apos;s branch refs/heads/branch_9x from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=4537c166a81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=4537c166a81&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3696&quot; title=&quot;LBHttpSolrServer&amp;#39;s aliveCheckExecutor is not closed in RecoveryZkTest (and possibly other tests)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3696&quot;&gt;&lt;del&gt;SOLR-3696&lt;/del&gt;&lt;/a&gt;: LBSolrClient use ObjectReleaseTracker (#2695)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 7063334fd00f406d33ed79f2c1bf79c4e30969a3)&lt;/p&gt;</comment>
                            <comment id="18022607" author="hossman" created="Thu, 25 Sep 2025 02:11:27 +0000"  >&lt;p&gt;For reasons i don&apos;t understand, my test reports show that &lt;tt&gt;TestReplicaProperties&lt;/tt&gt; has been failing in ~50% of all jenkins builds over the past 7 days &#8211; but only on the &quot;main&quot; branch (since it&apos;s a suite level test failure which can record more failures then runs, historic metrics aren&apos;t available because they are unreliably &#8211; so no idea how long it&apos;s been failing).&lt;/p&gt;

&lt;p&gt;Based on a sampling of the jenkins log, the problem is always leaked &lt;tt&gt;aliveCheckExecutor&lt;/tt&gt; threads.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;These seeds don&apos;t &lt;b&gt;reliably&lt;/b&gt; reproduce for me, but they do &lt;em&gt;occasionally&lt;/em&gt; reproduce &#8211; and since neither jenkins nor any of my local failures included any &lt;tt&gt;ObjectReleaseTracker&lt;/tt&gt; failures regarding the &lt;tt&gt;LBSolrClient&lt;/tt&gt; instance, that strongly suggests that the &lt;tt&gt;LBSolrClient&lt;/tt&gt; &lt;b&gt;IS&lt;/b&gt; being properly closed, but &lt;tt&gt;LBSolrClient&lt;/tt&gt; is &lt;em&gt;&lt;b&gt;not&lt;/b&gt;&lt;/em&gt; (reliably) closing the &lt;tt&gt;aliveCheckExecutor&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Reviewing the lifecycle of the &lt;tt&gt;aliveCheckExecutor&lt;/tt&gt; I had a hunch, and with a small amount of instrumentation I was able to confirm what the problem is: Nothing prevents a thread from executing a request via &lt;tt&gt;LBSolrClient&lt;/tt&gt;, which may then &quot;fail&quot; and cause &lt;tt&gt;LBSolrClient.startAliveCheckExecutor&lt;/tt&gt; to be called, &lt;b&gt;AFTER&lt;/b&gt; &lt;tt&gt;LBSolrClient.close()&lt;/tt&gt; has been (concurrently) called by some other thread.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    // LBSolrClient.aliveCheckExecutor is initially null
T1: sends a request via the LBSolrClient, which fails and enters LBSolrClient.startAliveCheckExecutor
T2: enters LBSolrClient.close, synchronizes on LBSolrClient.this
T2: sees that aliveCheckExecutor is null, does nothing, returns (releasing synchronization lock on LBSolrClient.this)
T1: sees that aliveCheckExecutor is null, synchronizes on LBSolrClient.this
T1: double checks that aliveCheckExecutor is still null, assigns it a new Executor, returns (releasing synchronization lock on LBSolrClient.this)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We need to make &lt;tt&gt;LBSolrClient.startAliveCheckExecutor()&lt;/tt&gt; smart enough to not initialize the Executor if the &lt;tt&gt;LBSolrClient.close()&lt;/tt&gt; has already been (or is concurrently being) called.&lt;/p&gt;</comment>
                            <comment id="18022608" author="hossman" created="Thu, 25 Sep 2025 02:12:55 +0000"  >&lt;p&gt;Attaching patch with fix that hasn&apos;t failed for me yet in beasting.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Still can&apos;t really understand why more tests aren&apos;t failing because of this, and/or why we&apos;re not seeing similar failures from TestReplicaProperties on branch_9x&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;(the lifecycle of the aliveCheckExecutor is effectively the same on both branches)&lt;/p&gt;</comment>
                            <comment id="18022616" author="JIRAUSER305513" created="Thu, 25 Sep 2025 04:50:46 +0000"  >&lt;p&gt;I am not aware of the full discussion that going on here, but I believe I did comment on a PR which I believe related to the failing of TestReplicaProperties starting from 13th Sep.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/solr/pull/3451#issuecomment-3290847327&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/3451#issuecomment-3290847327&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://develocity.apache.org/scans/tests?search.relativeStartTime=P28D&amp;amp;search.rootProjectNames=solr-root&amp;amp;search.timeZoneId=Asia%2FCalcutta&amp;amp;tests.container=org.apache.solr.cloud.api.collections.TestReplicaProperties&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://develocity.apache.org/scans/tests?search.relativeStartTime=P28D&amp;amp;search.rootProjectNames=solr-root&amp;amp;search.timeZoneId=Asia%2FCalcutta&amp;amp;tests.container=org.apache.solr.cloud.api.collections.TestReplicaProperties&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18022850" author="hossman" created="Thu, 25 Sep 2025 16:42:46 +0000"  >&lt;p&gt;Good note Sanjay &#8211; I forgot to check the develocity reports.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;/ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt; for review (mainly because he&apos;s the last person to work on the zombie checking code, but the fact that he was involved in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17837&quot; title=&quot;BALANCESHARDUNIQUE with `preferredLeader` sets property for PULL nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17837&quot;&gt;&lt;del&gt;SOLR-17837&lt;/del&gt;&lt;/a&gt; is a bonus)&lt;/p&gt;</comment>
                            <comment id="18022853" author="dsmiley" created="Thu, 25 Sep 2025 16:50:04 +0000"  >&lt;p&gt;+1 to the patch.  Awesome analysis Hoss!&lt;/p&gt;</comment>
                            <comment id="18022865" author="jira-bot" created="Thu, 25 Sep 2025 17:57:23 +0000"  >&lt;p&gt;Commit 1121d24aff6e6039491d795f9b590841ef513aae in solr&apos;s branch refs/heads/main from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=1121d24aff6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=1121d24aff6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3696&quot; title=&quot;LBHttpSolrServer&amp;#39;s aliveCheckExecutor is not closed in RecoveryZkTest (and possibly other tests)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3696&quot;&gt;&lt;del&gt;SOLR-3696&lt;/del&gt;&lt;/a&gt;: Fix for LB/Cloud SolrClients that could leak on close() if concurrent request failed and triggered zombie server logic&lt;/p&gt;</comment>
                            <comment id="18022871" author="jira-bot" created="Thu, 25 Sep 2025 18:37:00 +0000"  >&lt;p&gt;Commit 47ea29412a0949a769d0b29cb2cc631f8f51d1bb in solr&apos;s branch refs/heads/branch_9x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=47ea29412a0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=47ea29412a0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3696&quot; title=&quot;LBHttpSolrServer&amp;#39;s aliveCheckExecutor is not closed in RecoveryZkTest (and possibly other tests)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3696&quot;&gt;&lt;del&gt;SOLR-3696&lt;/del&gt;&lt;/a&gt;: Fix for LB/Cloud SolrClients that could leak on close() if concurrent request failed and triggered zombie server logic&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1121d24aff6e6039491d795f9b590841ef513aae)&lt;/p&gt;</comment>
                            <comment id="18022901" author="jira-bot" created="Thu, 25 Sep 2025 20:50:03 +0000"  >&lt;p&gt;Commit 13876d9efda67c16568a6a84e3da1dbd4f30c670 in solr&apos;s branch refs/heads/branch_9_9 from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=13876d9efda&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=13876d9efda&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3696&quot; title=&quot;LBHttpSolrServer&amp;#39;s aliveCheckExecutor is not closed in RecoveryZkTest (and possibly other tests)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3696&quot;&gt;&lt;del&gt;SOLR-3696&lt;/del&gt;&lt;/a&gt;: Fix for LB/Cloud SolrClients that could leak on close() if concurrent request failed and triggered zombie server logic&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1121d24aff6e6039491d795f9b590841ef513aae)&lt;/p&gt;</comment>
                            <comment id="18022945" author="houston" created="Fri, 26 Sep 2025 00:52:46 +0000"  >&lt;p&gt;+1 thanks for tracking this down! Been swamped and had no idea why that other commit broke the test. Great fix&lt;/p&gt;</comment>
                            <comment id="18036149" author="janhoy" created="Fri, 7 Nov 2025 08:38:09 +0000"  >&lt;p&gt;Closing after the 9.10.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13625571">SOLR-17837</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13078547" name="SOLR-3696.patch" size="1910" author="hossman" created="Thu, 25 Sep 2025 02:11:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03d5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17564</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>