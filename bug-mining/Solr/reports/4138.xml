<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:36:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13248] Autoscaling based replica placement is broken out of the box</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13248</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12739&quot; title=&quot;Make autoscaling policy based replica placement the default strategy for placing replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12739&quot;&gt;&lt;del&gt;SOLR-12739&lt;/del&gt;&lt;/a&gt; made autoscaling as the default replica placement strategy. However in the absence of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12845&quot; title=&quot;Add a default cluster policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12845&quot;&gt;&lt;del&gt;SOLR-12845&lt;/del&gt;&lt;/a&gt;, replicas can be placed without any regards for maxShardsPerNode causing multiple replicas of the same shard to be placed on the same node together. Also it was reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13247&quot; title=&quot;Incorrect shard placement during Collection creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13247&quot;&gt;SOLR-13247&lt;/a&gt; that createNodeSet is not being respected as well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13159&quot; title=&quot;Autoscaling not distributing collection evenly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13159&quot;&gt;&lt;del&gt;SOLR-13159&lt;/del&gt;&lt;/a&gt; was an early signal of the problem but it was not reproducible and there was a DNS problem in the cluster too so the root cause was not clear then.&lt;/p&gt;

&lt;p&gt;I am creating this blocker issue because as it stands today, we cannot guarantee the layout of new collections. At a minimum, we should revert to using the legacy replica assignment policy or add default policies with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12845&quot; title=&quot;Add a default cluster policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12845&quot;&gt;&lt;del&gt;SOLR-12845&lt;/del&gt;&lt;/a&gt; and have createNodeSet work. Related but not mandatory would be to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12847&quot; title=&quot;Cut over implementation of maxShardsPerNode to a collection policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12847&quot;&gt;&lt;del&gt;SOLR-12847&lt;/del&gt;&lt;/a&gt; as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13215730">SOLR-13248</key>
            <summary>Autoscaling based replica placement is broken out of the box</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Feb 2019 12:36:29 +0000</created>
                <updated>Sat, 8 Jun 2019 15:00:50 +0000</updated>
                            <resolved>Thu, 7 Mar 2019 18:51:03 +0000</resolved>
                                    <version>7.6</version>
                    <version>7.7</version>
                                    <fixVersion>7.7.1</fixVersion>
                    <fixVersion>8.0</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>AutoScaling</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16768434" author="erickerickson" created="Thu, 14 Feb 2019 15:31:07 +0000"  >&lt;p&gt;Does this imply there&apos;ll be a 7.7.1? Seems like we should.&lt;/p&gt;</comment>
                            <comment id="16768445" author="erickerickson" created="Thu, 14 Feb 2019 15:36:42 +0000"  >&lt;p&gt;Not sure if this is related or not but it&apos;s worth checking. Also linked from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12347&quot; title=&quot;Raise the default SOLR_STOP_WAIT from 3 minutes.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12347&quot;&gt;SOLR-12347&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16768469" author="shalinmangar" created="Thu, 14 Feb 2019 16:04:14 +0000"  >&lt;p&gt;Yes, we should have a 7.7.1 with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12739&quot; title=&quot;Make autoscaling policy based replica placement the default strategy for placing replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12739&quot;&gt;&lt;del&gt;SOLR-12739&lt;/del&gt;&lt;/a&gt; reverted.&lt;/p&gt;</comment>
                            <comment id="16769078" author="shalinmangar" created="Fri, 15 Feb 2019 08:35:58 +0000"  >&lt;p&gt;Here&apos;s a patch that sets the default to use legacy assignment instead of autoscaling.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt; &amp;#8211; thanks for the suggestion, this is indeed simpler than reverting &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12739&quot; title=&quot;Make autoscaling policy based replica placement the default strategy for placing replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12739&quot;&gt;&lt;del&gt;SOLR-12739&lt;/del&gt;&lt;/a&gt; entirely. I am running into two test failures:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;org.apache.solr.security.JWTAuthPluginIntegrationTest.createCollectionUpdateAndQueryDistributed&lt;/li&gt;
	&lt;li&gt;org.apache.solr.security.hadoop.TestSolrCloudWithHadoopAuthPlugin.testBasics&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Both these tests are failing because of wrong PKI metric minimums. It is not clear to me how a different cluster layout might cause these failures because the metrics are being accumulated across all nodes. Can you please take a look?&lt;/p&gt;</comment>
                            <comment id="16769084" author="janhoy" created="Fri, 15 Feb 2019 08:49:25 +0000"  >&lt;p&gt;I see the same Shalin.&lt;/p&gt;

&lt;p&gt;Seems like collection create with autoscaling-based placement&#160;triggers 12 PKI requests while when using legacy one it only triggers 2. Could it be that the autoscaling code path spawns a bunch of inter-node traffic that the legacy doesn&apos;t? In that case, I guess we have two solutions. A) Lower the assertPkiAuthMetricsMinimums to actual levels in those two tests, or B) Modify those two tests &lt;tt&gt;setup()&lt;/tt&gt;&#160;method to explicitly set &lt;tt&gt;useLegacyReplicaAssignment=false&lt;/tt&gt;&#160;cluster property.&lt;/p&gt;</comment>
                            <comment id="16769090" author="janhoy" created="Fri, 15 Feb 2019 08:59:55 +0000"  >&lt;p&gt;Hmm, I tried the latter (used withProperty() and had to extend&#160;KNOWN_CLUSTER_PROPS in ZkStateReader), but that did not fix it.&#160;However, changing back the two defaults in Assign.java makes the test pass again. So looks like there is a bug in actually picking up and using the cluster property when set in ZK.&lt;/p&gt;</comment>
                            <comment id="16769094" author="janhoy" created="Fri, 15 Feb 2019 09:02:53 +0000"  >&lt;p&gt;Ok, has to be because it expects the property to be inside a &quot;defaults&quot; object and not top-level. Have not seen this before, how to set?&lt;/p&gt;</comment>
                            <comment id="16769102" author="shalinmangar" created="Fri, 15 Feb 2019 09:07:30 +0000"  >&lt;p&gt;In other tests, I can set useLegacyReplicaAssignment this way:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; V2Request.Builder(&lt;span class=&quot;code-quote&quot;&gt;&quot;/cluster&quot;&lt;/span&gt;)
        .withMethod(SolrRequest.METHOD.POST)
        .withPayload(&lt;span class=&quot;code-quote&quot;&gt;&quot;{set-obj-property:{defaults : {cluster: {useLegacyReplicaAssignment:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}}}}}&quot;&lt;/span&gt;)
        .build()
        .process(cluster.getSolrClient());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But it does not work here because the call returns HTTP 401.&lt;/p&gt;</comment>
                            <comment id="16769116" author="janhoy" created="Fri, 15 Feb 2019 09:17:05 +0000"  >&lt;p&gt;We should probably add support for the nested properties in &lt;tt&gt;SolrCloudTestCase&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
configureCluster(NUM_SERVERS)&lt;span class=&quot;code-comment&quot;&gt;// nodes
&lt;/span&gt;    .withSecurityJson(TEST_PATH().resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;security&quot;&lt;/span&gt;).resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;jwt_plugin_jwk_security.json&quot;&lt;/span&gt;))
    .addConfig(&lt;span class=&quot;code-quote&quot;&gt;&quot;conf1&quot;&lt;/span&gt;, TEST_PATH().resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;configsets&quot;&lt;/span&gt;).resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;cloud-minimal&quot;&lt;/span&gt;).resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;conf&quot;&lt;/span&gt;))
    .withDefaultCollectionProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;useLegacyReplicaAssignment&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
    .configure();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;i.e. add a method &lt;tt&gt;withDefaultCollectionProperty&lt;/tt&gt; to the builder?&lt;/p&gt;</comment>
                            <comment id="16769146" author="janhoy" created="Fri, 15 Feb 2019 09:49:37 +0000"  >&lt;p&gt;Got it working with the withDefaultollectionProperty trick, see last patch.&lt;/p&gt;

&lt;p&gt;Guess, since this is in the defaults.cluster namespace, the method name should be &lt;tt&gt;withDefaultClusterProperty&lt;/tt&gt; ?&lt;/p&gt;</comment>
                            <comment id="16769157" author="shalinmangar" created="Fri, 15 Feb 2019 10:02:38 +0000"  >&lt;p&gt;Thanks Jan!. Here&apos;s a patch &lt;tt&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;.patch&lt;/tt&gt; which renames the method to &lt;tt&gt;withDefaultClusterProperty&lt;/tt&gt; and adds a call to it in the TestSolrCloudWithHadoopAuthPlugin class.&lt;/p&gt;

&lt;p&gt;I&apos;m going to start another test run and manually smoke test this.&lt;/p&gt;</comment>
                            <comment id="16769164" author="janhoy" created="Fri, 15 Feb 2019 10:16:39 +0000"  >&lt;p&gt;Good! Then we won&apos;t need to fix those tests when we flip the default again in 8.x &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16769202" author="shalinmangar" created="Fri, 15 Feb 2019 11:11:53 +0000"  >&lt;p&gt;Updated patch that fixes a failure in &lt;tt&gt;TestPolicy.testAutoscalingPreferencesUsedWithNoPolicy&lt;/tt&gt; that relied on autoscaling being the default replica assignment policy.&lt;/p&gt;</comment>
                            <comment id="16771126" author="romseygeek" created="Mon, 18 Feb 2019 14:34:02 +0000"  >&lt;p&gt;Is this ready to be committed?&#160; And am I OK to start building the 8.0 release immediately once it&apos;s in, or do we want to give it 24 hours to bake?&lt;/p&gt;</comment>
                            <comment id="16771217" author="shalinmangar" created="Mon, 18 Feb 2019 16:46:54 +0000"  >&lt;p&gt;I&apos;m finishing a test run. I&apos;ll ping you once I commit. It should be good to go once committed.&lt;/p&gt;</comment>
                            <comment id="16771395" author="jira-bot" created="Mon, 18 Feb 2019 21:46:28 +0000"  >&lt;p&gt;Commit 7e2d40197cb096fe0519652c2ebbbf38a70d0d65 in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=7e2d401&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=7e2d401&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Autoscaling based replica placement is broken out of the box.&lt;/p&gt;

&lt;p&gt;Solr 7.5 enabled autoscaling based replica placement by default but in the absence of default cluster policies, autoscaling can place more than 1 replica of the  same shard on the same node. Also, the maxShardsPerNode and createNodeSet was not respected. Due to these reasons,  this issue reverts the default replica placement policy to the &apos;legacy&apos; assignment policy that was the default until Solr 7.4.&lt;/p&gt;</comment>
                            <comment id="16771401" author="jira-bot" created="Mon, 18 Feb 2019 21:56:33 +0000"  >&lt;p&gt;Commit 97875af3f93477f48e4ead1979b2f36797106e06 in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=97875af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=97875af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Adding upgrade notes which explain the problem and the mitigation as well as steps to revert to the old behavior&lt;/p&gt;</comment>
                            <comment id="16771413" author="jira-bot" created="Mon, 18 Feb 2019 22:26:39 +0000"  >&lt;p&gt;Commit 7ede4e2b430c7e0c36dedf21fcab35fe48ed783d in lucene-solr&apos;s branch refs/heads/branch_8x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=7ede4e2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=7ede4e2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Autoscaling based replica placement is broken out of the box.&lt;/p&gt;

&lt;p&gt;Solr 7.5 enabled autoscaling based replica placement by default but in the absence of default cluster policies, autoscaling can place more than 1 replica of the  same shard on the same node. Also, the maxShardsPerNode and createNodeSet was not respected. Due to these reasons,  this issue reverts the default replica placement policy to the &apos;legacy&apos; assignment policy that was the default until Solr 7.4.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 7e2d40197cb096fe0519652c2ebbbf38a70d0d65)&lt;/p&gt;</comment>
                            <comment id="16771414" author="jira-bot" created="Mon, 18 Feb 2019 22:26:40 +0000"  >&lt;p&gt;Commit d697b4a6ad3ac977a2890f57225293c17a44779f in lucene-solr&apos;s branch refs/heads/branch_8x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d697b4a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d697b4a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Adding upgrade notes which explain the problem and the mitigation as well as steps to revert to the old behavior&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 97875af3f93477f48e4ead1979b2f36797106e06)&lt;/p&gt;</comment>
                            <comment id="16771472" author="jira-bot" created="Tue, 19 Feb 2019 01:20:30 +0000"  >&lt;p&gt;Commit 521701dd9cf8ff20a02bb25f9512f17247840eed in lucene-solr&apos;s branch refs/heads/branch_8_0 from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=521701d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=521701d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Autoscaling based replica placement is broken out of the box.&lt;/p&gt;

&lt;p&gt;Solr 7.5 enabled autoscaling based replica placement by default but in the absence of default cluster policies, autoscaling can place more than 1 replica of the&#160; same shard on the same node. Also, the maxShardsPerNode and createNodeSet was not respected. Due to these reasons,&#160; this issue reverts the default replica placement policy to the &apos;legacy&apos; assignment policy that was the default until Solr 7.4.&lt;/p&gt;

&lt;p&gt;Cherry-picked from commit 7ede4e2b&lt;/p&gt;</comment>
                            <comment id="16771473" author="jira-bot" created="Tue, 19 Feb 2019 01:20:31 +0000"  >&lt;p&gt;Commit 884a70d0b7bb009e775702db0b3fe7c509b9ac02 in lucene-solr&apos;s branch refs/heads/branch_8_0 from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=884a70d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=884a70d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Adding upgrade notes which explain the problem and the mitigation as well as steps to revert to the old behavior&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 97875af3f93477f48e4ead1979b2f36797106e06)&lt;/p&gt;</comment>
                            <comment id="16771481" author="shalinmangar" created="Tue, 19 Feb 2019 01:31:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; &amp;#8211; this is ready to go.&lt;/p&gt;</comment>
                            <comment id="16773694" author="ichattopadhyaya" created="Thu, 21 Feb 2019 06:11:23 +0000"  >&lt;p&gt;Reopening this for backporting to branch_7x and branch_7_7 for inclusion into 7.7.1 release.&lt;/p&gt;</comment>
                            <comment id="16773696" author="ichattopadhyaya" created="Thu, 21 Feb 2019 06:13:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;Jan H&#248;ydahl &#8211; thanks for the suggestion, this is indeed simpler than reverting &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12739&quot; title=&quot;Make autoscaling policy based replica placement the default strategy for placing replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12739&quot;&gt;&lt;del&gt;SOLR-12739&lt;/del&gt;&lt;/a&gt; entirely&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Based on this, I&apos;m not reverting &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12739&quot; title=&quot;Make autoscaling policy based replica placement the default strategy for placing replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12739&quot;&gt;&lt;del&gt;SOLR-12739&lt;/del&gt;&lt;/a&gt; in branch_7x while backporting this issue. Please let me know if that&apos;s not correct.&lt;/p&gt;</comment>
                            <comment id="16773742" author="ichattopadhyaya" created="Thu, 21 Feb 2019 07:09:18 +0000"  >&lt;p&gt;I cherry-picked the commit 7e2d40197cb096fe0519652c2ebbbf38a70d0d65 from master to branch_7x for backporting. After resolving the CHANGES.txt conflicts, I&apos;m attaching the resulting patch.&lt;br/&gt;
Unfortunately, I&apos;m hitting a test failure for RulesTest and I&apos;m looking into it. Can someone more familiar with this issue please have a look? The log for the test failure is here: &lt;a href=&quot;https://paste.fedoraproject.org/paste/PjcMM-9kGkz7zD6fEO75tQ&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://paste.fedoraproject.org/paste/PjcMM-9kGkz7zD6fEO75tQ&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16773787" author="ichattopadhyaya" created="Thu, 21 Feb 2019 08:04:16 +0000"  >&lt;p&gt;Seems like the same test (RulesTest) fails on branch_7x on my machine even before backporting. Jenkins hasn&apos;t picked up such a failure, though. Cleaning and fresh clone both didn&apos;t help; I get this test to fail 100% of the time. Looking into why this could be (and also trying other machines now).&lt;/p&gt;</comment>
                            <comment id="16773809" author="jira-bot" created="Thu, 21 Feb 2019 08:25:37 +0000"  >&lt;p&gt;Commit 3c6d1bad756d68bf007edaa0c8e08ff3d5c39147 in lucene-solr&apos;s branch refs/heads/branch_7x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3c6d1ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3c6d1ba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Autoscaling based replica placement is broken out of the box.&lt;/p&gt;

&lt;p&gt;Solr 7.5 enabled autoscaling based replica placement by default but in the absence of default cluster policies, autoscaling can place more than 1 replica of the  same shard on the same node. Also, the maxShardsPerNode and createNodeSet was not respected. Due to these reasons,  this issue reverts the default replica placement policy to the &apos;legacy&apos; assignment policy that was the default until Solr 7.4.&lt;/p&gt;</comment>
                            <comment id="16773810" author="jira-bot" created="Thu, 21 Feb 2019 08:25:38 +0000"  >&lt;p&gt;Commit a5113ac1b3859e40424b509737fc1a01467c14b6 in lucene-solr&apos;s branch refs/heads/branch_7x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a5113ac&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a5113ac&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Adding upgrade notes which explain the problem and the mitigation as well as steps to revert to the old behavior&lt;/p&gt;</comment>
                            <comment id="16773811" author="ichattopadhyaya" created="Thu, 21 Feb 2019 08:25:39 +0000"  >&lt;p&gt;I seem to have resolved it! I had about 1.5GB free disk space; cleaned up some more and now the test seems to be passing consistently. Guessing that replicas weren&apos;t being placed in the test due to low free disk space.&lt;/p&gt;</comment>
                            <comment id="16773832" author="jira-bot" created="Thu, 21 Feb 2019 08:49:13 +0000"  >&lt;p&gt;Commit e720372d906049fd1b2936ec32af9f07fe370887 in lucene-solr&apos;s branch refs/heads/branch_7_7 from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e720372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e720372&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Autoscaling based replica placement is broken out of the box.&lt;/p&gt;

&lt;p&gt;Solr 7.5 enabled autoscaling based replica placement by default but in the absence of default cluster policies, autoscaling can place more than 1 replica of the  same shard on the same node. Also, the maxShardsPerNode and createNodeSet was not respected. Due to these reasons,  this issue reverts the default replica placement policy to the &apos;legacy&apos; assignment policy that was the default until Solr 7.4.&lt;/p&gt;</comment>
                            <comment id="16773833" author="jira-bot" created="Thu, 21 Feb 2019 08:49:15 +0000"  >&lt;p&gt;Commit ea9413deb59e6fe14b99906f0fd9b55077488eda in lucene-solr&apos;s branch refs/heads/branch_7_7 from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ea9413d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ea9413d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13248&quot; title=&quot;Autoscaling based replica placement is broken out of the box&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13248&quot;&gt;&lt;del&gt;SOLR-13248&lt;/del&gt;&lt;/a&gt;: Adding upgrade notes which explain the problem and the mitigation as well as steps to revert to the old behavior&lt;/p&gt;</comment>
                            <comment id="16787092" author="erickerickson" created="Thu, 7 Mar 2019 18:48:59 +0000"  >&lt;p&gt;Can this be closed now? It&apos;s kinda scary to see it &quot;unresolved&quot;&lt;/p&gt;</comment>
                            <comment id="16787093" author="ichattopadhyaya" created="Thu, 7 Mar 2019 18:51:23 +0000"  >&lt;p&gt;Sure, done. Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="13215714">SOLR-13247</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13210837">SOLR-13159</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13183170">SOLR-12739</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13195250">SOLR-12944</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13190310">SOLR-12847</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13190305">SOLR-12845</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12959565" name="SOLR-13248-branch7x-backport.patch" size="11849" author="ichattopadhyaya" created="Thu, 21 Feb 2019 07:06:46 +0000"/>
                            <attachment id="12958846" name="SOLR-13248-withDefaultCollectionProp.patch" size="6889" author="janhoy" created="Fri, 15 Feb 2019 09:48:56 +0000"/>
                            <attachment id="12958864" name="SOLR-13248.patch" size="11824" author="shalin" created="Fri, 15 Feb 2019 11:10:35 +0000"/>
                            <attachment id="12958848" name="SOLR-13248.patch" size="10639" author="shalin" created="Fri, 15 Feb 2019 10:01:17 +0000"/>
                            <attachment id="12958833" name="SOLR-13248.patch" size="4340" author="shalin" created="Fri, 15 Feb 2019 08:27:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0zbs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>