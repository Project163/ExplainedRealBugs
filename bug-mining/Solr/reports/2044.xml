<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:55:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6314] Facet counts duplicated in the response if specified more than once on the request.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6314</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I am trying to work with multi-threaded faceting on SolrCloud and in the process i was hit by some issues.&lt;/p&gt;

&lt;p&gt;I am currently running the below upstream test on different SolrCloud configurations and i am getting a different result set per configuration.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/test/org/apache/solr/request/TestFaceting.java#L654&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/test/org/apache/solr/request/TestFaceting.java#L654&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Setup:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Indexed 50 docs into SolrCloud.&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;If the SolrCloud has only 1 shard, the facet field query has the below output (which matches with the expected upstream test output - # facet fields ~ 50).&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ curl  &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/collection1/select?facet=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;fl=id&amp;amp;indent=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;q=id%3A*&amp;amp;facet.limit=-1&amp;amp;facet.threads=1000&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f9_ws&amp;amp;facet.field=f9_ws&amp;amp;facet.field=f9_ws&amp;amp;facet.field=f9_ws&amp;amp;facet.field=f9_ws&amp;amp;rows=1&amp;amp;wt=xml&quot;&lt;/span&gt;
&lt;/span&gt;
&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;response&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;0&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;&amp;gt;21&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;&amp;gt;id&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;indent&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;&amp;gt;id:*&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet.limit&quot;&lt;/span&gt;&amp;gt;-1&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet.threads&quot;&lt;/span&gt;&amp;gt;1000&amp;lt;/str&amp;gt;
    &amp;lt;arr name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet.field&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
    &amp;lt;/arr&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;wt&quot;&lt;/span&gt;&amp;gt;xml&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt;&amp;gt;1&amp;lt;/str&amp;gt;
  &amp;lt;/lst&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;result name=&lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt; numFound=&lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt; start=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;doc&amp;gt;
    &amp;lt;&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;0.0&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;&amp;gt;&amp;lt;/doc&amp;gt;
&amp;lt;/result&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_counts&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_queries&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_fields&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f0_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_1&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_2&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f0_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_1&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_2&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f0_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_1&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_2&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f0_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_1&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_2&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f0_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_1&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_2&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f1_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_1&quot;&lt;/span&gt;&amp;gt;33&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_3&quot;&lt;/span&gt;&amp;gt;17&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f1_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_1&quot;&lt;/span&gt;&amp;gt;33&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_3&quot;&lt;/span&gt;&amp;gt;17&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f1_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_1&quot;&lt;/span&gt;&amp;gt;33&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_3&quot;&lt;/span&gt;&amp;gt;17&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f1_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_1&quot;&lt;/span&gt;&amp;gt;33&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_3&quot;&lt;/span&gt;&amp;gt;17&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f1_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_1&quot;&lt;/span&gt;&amp;gt;33&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_3&quot;&lt;/span&gt;&amp;gt;17&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f2_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_1&quot;&lt;/span&gt;&amp;gt;37&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_4&quot;&lt;/span&gt;&amp;gt;13&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f2_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_1&quot;&lt;/span&gt;&amp;gt;37&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_4&quot;&lt;/span&gt;&amp;gt;13&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f2_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_1&quot;&lt;/span&gt;&amp;gt;37&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_4&quot;&lt;/span&gt;&amp;gt;13&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f2_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_1&quot;&lt;/span&gt;&amp;gt;37&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_4&quot;&lt;/span&gt;&amp;gt;13&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f2_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_1&quot;&lt;/span&gt;&amp;gt;37&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_4&quot;&lt;/span&gt;&amp;gt;13&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f3_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_1&quot;&lt;/span&gt;&amp;gt;40&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_5&quot;&lt;/span&gt;&amp;gt;10&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;

    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f3_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_1&quot;&lt;/span&gt;&amp;gt;40&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_5&quot;&lt;/span&gt;&amp;gt;10&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f3_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_1&quot;&lt;/span&gt;&amp;gt;40&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_5&quot;&lt;/span&gt;&amp;gt;10&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f3_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_1&quot;&lt;/span&gt;&amp;gt;40&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_5&quot;&lt;/span&gt;&amp;gt;10&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f3_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_1&quot;&lt;/span&gt;&amp;gt;40&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_5&quot;&lt;/span&gt;&amp;gt;10&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f4_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_1&quot;&lt;/span&gt;&amp;gt;41&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_6&quot;&lt;/span&gt;&amp;gt;9&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f4_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_1&quot;&lt;/span&gt;&amp;gt;41&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_6&quot;&lt;/span&gt;&amp;gt;9&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f4_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_1&quot;&lt;/span&gt;&amp;gt;41&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_6&quot;&lt;/span&gt;&amp;gt;9&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f4_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_1&quot;&lt;/span&gt;&amp;gt;41&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_6&quot;&lt;/span&gt;&amp;gt;9&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f4_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_1&quot;&lt;/span&gt;&amp;gt;41&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_6&quot;&lt;/span&gt;&amp;gt;9&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f5_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_1&quot;&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_7&quot;&lt;/span&gt;&amp;gt;8&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f5_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_1&quot;&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_7&quot;&lt;/span&gt;&amp;gt;8&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f5_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_1&quot;&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_7&quot;&lt;/span&gt;&amp;gt;8&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f5_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_1&quot;&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_7&quot;&lt;/span&gt;&amp;gt;8&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f5_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_1&quot;&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_7&quot;&lt;/span&gt;&amp;gt;8&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f6_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_1&quot;&lt;/span&gt;&amp;gt;43&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_8&quot;&lt;/span&gt;&amp;gt;7&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;

    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f6_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_1&quot;&lt;/span&gt;&amp;gt;43&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_8&quot;&lt;/span&gt;&amp;gt;7&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f6_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_1&quot;&lt;/span&gt;&amp;gt;43&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_8&quot;&lt;/span&gt;&amp;gt;7&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f6_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_1&quot;&lt;/span&gt;&amp;gt;43&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_8&quot;&lt;/span&gt;&amp;gt;7&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f6_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_1&quot;&lt;/span&gt;&amp;gt;43&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_8&quot;&lt;/span&gt;&amp;gt;7&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f7_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_1&quot;&lt;/span&gt;&amp;gt;44&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_9&quot;&lt;/span&gt;&amp;gt;6&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f7_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_1&quot;&lt;/span&gt;&amp;gt;44&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_9&quot;&lt;/span&gt;&amp;gt;6&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f7_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_1&quot;&lt;/span&gt;&amp;gt;44&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_9&quot;&lt;/span&gt;&amp;gt;6&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f7_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_1&quot;&lt;/span&gt;&amp;gt;44&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_9&quot;&lt;/span&gt;&amp;gt;6&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f7_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_1&quot;&lt;/span&gt;&amp;gt;44&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_9&quot;&lt;/span&gt;&amp;gt;6&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f8_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_10&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f8_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_10&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f8_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_10&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f8_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_10&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f8_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_10&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f9_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_11&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f9_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_11&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;

    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f9_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_11&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f9_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_11&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f9_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_11&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
  &amp;lt;/lst&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_dates&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_ranges&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;/response&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Now, if a create a new collection with 2 shards (&amp;gt;1 shard SolrCloud), the same above query results in a different output. (# facet fields ~ 10 ;  Expected 50)&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ curl  &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/collection1/select?facet=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;fl=id&amp;amp;indent=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;q=id%3A*&amp;amp;facet.limit=-1&amp;amp;facet.threads=1000&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f0_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f1_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f2_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f3_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f4_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f5_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f6_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f7_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f8_ws&amp;amp;facet.field=f9_ws&amp;amp;facet.field=f9_ws&amp;amp;facet.field=f9_ws&amp;amp;facet.field=f9_ws&amp;amp;facet.field=f9_ws&amp;amp;rows=1&amp;amp;wt=xml&quot;&lt;/span&gt;
&lt;/span&gt; 
&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;response&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;0&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;&amp;gt;31&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;&amp;gt;id&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;indent&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;&amp;gt;id:*&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet.limit&quot;&lt;/span&gt;&amp;gt;-1&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet.threads&quot;&lt;/span&gt;&amp;gt;1000&amp;lt;/str&amp;gt;
    &amp;lt;arr name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet.field&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f0_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f1_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f2_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f3_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f4_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f5_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f6_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f7_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f8_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
      &amp;lt;str&amp;gt;f9_ws&amp;lt;/str&amp;gt;
    &amp;lt;/arr&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;wt&quot;&lt;/span&gt;&amp;gt;xml&amp;lt;/str&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt;&amp;gt;1&amp;lt;/str&amp;gt;
  &amp;lt;/lst&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;result name=&lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt; numFound=&lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt; start=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; maxScore=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;doc&amp;gt;
    &amp;lt;&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;2.0&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;&amp;gt;&amp;lt;/doc&amp;gt;
&amp;lt;/result&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_counts&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_queries&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_fields&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f0_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_1&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;zero_2&quot;&lt;/span&gt;&amp;gt;25&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f1_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_1&quot;&lt;/span&gt;&amp;gt;33&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;one_3&quot;&lt;/span&gt;&amp;gt;17&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f2_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_1&quot;&lt;/span&gt;&amp;gt;37&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;two_4&quot;&lt;/span&gt;&amp;gt;13&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f3_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_1&quot;&lt;/span&gt;&amp;gt;40&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;three_5&quot;&lt;/span&gt;&amp;gt;10&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f4_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_1&quot;&lt;/span&gt;&amp;gt;41&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;four_6&quot;&lt;/span&gt;&amp;gt;9&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f5_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_1&quot;&lt;/span&gt;&amp;gt;42&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;five_7&quot;&lt;/span&gt;&amp;gt;8&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f6_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_1&quot;&lt;/span&gt;&amp;gt;43&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;six_8&quot;&lt;/span&gt;&amp;gt;7&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f7_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_1&quot;&lt;/span&gt;&amp;gt;44&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;seven_9&quot;&lt;/span&gt;&amp;gt;6&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f8_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;eight_10&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;f9_ws&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_1&quot;&lt;/span&gt;&amp;gt;45&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
      &amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;nine_11&quot;&lt;/span&gt;&amp;gt;5&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
    &amp;lt;/lst&amp;gt;
  &amp;lt;/lst&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_dates&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_ranges&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;/response&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This behavior is quite strange as it is being dependent on the number of shards in SolrCloud. It would be great if someone can shed some light on this?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12731467">SOLR-6314</key>
            <summary>Facet counts duplicated in the response if specified more than once on the request.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="vamsee">Vamsee K. Yarlagadda</reporter>
                        <labels>
                    </labels>
                <created>Sat, 2 Aug 2014 00:13:27 +0000</created>
                <updated>Mon, 9 May 2016 18:47:38 +0000</updated>
                            <resolved>Mon, 18 Aug 2014 21:02:25 +0000</resolved>
                                    <version>6.0</version>
                                    <fixVersion>4.10</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SearchComponents - other</component>
                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14083620" author="erickerickson" created="Sat, 2 Aug 2014 16:35:04 +0000"  >&lt;p&gt;I know something about that code so I&apos;ll try to take a look.&lt;/p&gt;

&lt;p&gt;I&apos;m not entirely sure when I&apos;ll get to it though, I&apos;m slammed. So&lt;br/&gt;
if someone wants to look at it instead, please feel free.&lt;/p&gt;

&lt;p&gt;Vamsee:&lt;/p&gt;

&lt;p&gt;What version of Solr are you seeing this on?&lt;/p&gt;</comment>
                            <comment id="14083726" author="vamsee" created="Sat, 2 Aug 2014 20:59:56 +0000"  >&lt;p&gt;Thanks @Erick. I was able to replicate the issue on Solr trunk (5.0)&lt;br/&gt;
Let me know if there is anything I can do to help in the process. &lt;/p&gt;</comment>
                            <comment id="14088820" author="erickerickson" created="Thu, 7 Aug 2014 04:29:28 +0000"  >&lt;p&gt;OK, taking a closer look at this and I wonder what the right behavior is. The totals&lt;br/&gt;
are correct, it&apos;s just that they repeated in one case and not in  another. &lt;/p&gt;

&lt;p&gt;It &lt;em&gt;looks&lt;/em&gt; like I can restate the problem like this:&lt;/p&gt;

&lt;p&gt;When a facet field is requested more than one time in non-sharded cluster, then the field&lt;br/&gt;
is repeated in the result set. &lt;/p&gt;

&lt;p&gt;When a facet field is requested more than once in a sharded cluster, then the field is only&lt;br/&gt;
returned once in the result set.&lt;/p&gt;

&lt;p&gt;IOW, specifying the same facet.field twice: &amp;amp;facet.field=f1&amp;amp;facet.field=f1&lt;br/&gt;
results in two (identical) sections in the response in a non-sharded case&lt;br/&gt;
and one in the sharded case.&lt;/p&gt;

&lt;p&gt;I&apos;ll look at the code tomorrow to see where the difference happens, I suspect in the&lt;br/&gt;
aggregating code in the distributed case but that&apos;s just a guess.&lt;/p&gt;

&lt;p&gt;So the question is what the right behavior really is. I can argue that specifying the&lt;br/&gt;
exact same facet parameter (either query or field) more than once is a waste, and the&lt;br/&gt;
facet information should be cleaned up on the way in by removing duplicates. That would give&lt;br/&gt;
the same response in both cases and return just one entry per unique facet criteria. This is &lt;br/&gt;
arguably avoiding useless work (what&apos;s the value of specifying the same facet parameter&lt;br/&gt;
twice?) That would change current behavior in the single-shard case however.&lt;/p&gt;

&lt;p&gt;If we tried to return multiple entries in the sharded case, it seems quite fragile to try to sum the&lt;br/&gt;
facet sub-counts separately. By that I mean say shard 1 returns&lt;br/&gt;
f1:33&lt;br/&gt;
f1:33&lt;/p&gt;

&lt;p&gt;shard two returns&lt;br/&gt;
f1:78&lt;br/&gt;
f1:78 &lt;/p&gt;

&lt;p&gt;You&apos;d like the final result to be&lt;br/&gt;
f1:111&lt;br/&gt;
f1:111&lt;/p&gt;

&lt;p&gt;On the surface, some rule like &quot;add facets by&lt;br/&gt;
position when the key is identical and return multiple&lt;br/&gt;
counts&quot; seems like it would work, but it also seems&lt;br/&gt;
rife for errors to creep in with arguably no added value. What happens,&lt;br/&gt;
for instance, if there are three values for &quot;f1&quot; from one shard&lt;br/&gt;
and only two from another? I don&apos;t see how that would really happen,&lt;br/&gt;
but....&lt;/p&gt;

&lt;p&gt;So, my question for you (and anyone who wants to chime in)&lt;br/&gt;
is: &quot;Do you agree that pruning multiple identical facet criteria&lt;br/&gt;
is a Good Thing?&quot;. If not, what use case does returning multiple&lt;br/&gt;
identical facet counts support and is that use case worth the&lt;br/&gt;
effort? My gut feeling is no.&lt;/p&gt;

&lt;p&gt;Thanks for bringing this up it&apos;s certainly something&lt;br/&gt;
that&apos;s confusing. I suspect it&apos;s just something that hasn&apos;t been&lt;br/&gt;
thought of in the past....&lt;/p&gt;</comment>
                            <comment id="14088833" author="vamsee" created="Thu, 7 Aug 2014 05:01:23 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; for looking into this.&lt;/p&gt;

&lt;p&gt;Yes, you are right. It makes perfect sense to return a count for every unique facet request rather than repeating the facets over and over. It might be the case that the facet result that&apos;s returned in the case of multi-shard (by going through the aggregating code) is the right thing to do. Perhaps, we may want to fix the behavior for single shard system and make changes to the unit tests to reflect the same.&lt;/p&gt;

&lt;p&gt;I can&apos;t think of any particular reason why the initial implementation of multithreaded faceting created a test that will check for duplicate facet counts. It might be a test bug too?&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/test/org/apache/solr/request/TestFaceting.java#L654&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/test/org/apache/solr/request/TestFaceting.java#L654&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="14089341" author="elyograg" created="Thu, 7 Aug 2014 15:27:23 +0000"  >&lt;p&gt;I can&apos;t imagine any situations where having the f1 key in the results twice (with the same info) is useful, so I would argue that the non-distributed query should behave like the distributed query and only return it once.  If someone has a reasonable use case for the current behavior, then you can forget what I said and make distributed work like non-distributed ... but hopefully with an optimization in both instances so that it only calculates the results once.&lt;/p&gt;

&lt;p&gt;One thing that a user might do is include two &lt;b&gt;nearly&lt;/b&gt; identical keys like this, either for migration purposes, or to work around web developers who are completely clueless:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;facet.field=f1&amp;amp;facet.field={!key=foo}f1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This &lt;b&gt;does&lt;/b&gt; work properly in Solr 4.9 with a distributed facet &amp;#8211; the original and re-keyed facets are both returned, with identical info.  I don&apos;t know if it runs the facet twice or re-uses the info that is already calculated.&lt;/p&gt;</comment>
                            <comment id="14090297" author="erickerickson" created="Fri, 8 Aug 2014 04:42:55 +0000"  >&lt;p&gt;OK, here&apos;s a patch. The only real code changes are in MultimapSolrParams. There&apos;s &lt;em&gt;got&lt;/em&gt; to be a more efficient way to check to see if there&apos;s a duplicate, but this is enough to see if this approach works.&lt;/p&gt;

&lt;p&gt;All tests pass, although you&apos;ll note a couple were written to expect multiple duplicate return fields that I had to change. IMO they were testing the wrong behavior.&lt;/p&gt;

&lt;p&gt;Now, the thing that worries me here is that this code will be executed for all the requests coming in. Any code that counts on multiple identical parameters making it through is toast. Personally I don&apos;t see why that&apos;s a problem, but here&apos;s a chance to object.&lt;/p&gt;

&lt;p&gt;I mean fq clauses go through here. As does most anything else in the world. It&apos;s still the case that different &lt;em&gt;values&lt;/em&gt; get multiple entries, for instance specifying&lt;br/&gt;
&amp;amp;f.manu.facet.mincount=3&amp;amp;f.manu.facet.mincount=2&lt;br/&gt;
results in two entries in the f.manu.facet.mincount array. That&apos;s correct behavior though.&lt;/p&gt;

&lt;p&gt;Anyway, I&apos;ll look for a more efficient way to test other than looping through the array, mostly this is a chance for people to see if this makes sense.&lt;/p&gt;</comment>
                            <comment id="14090870" author="yseeley@gmail.com" created="Fri, 8 Aug 2014 15:26:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;The only real code changes are in MultimapSolrParams.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure it makes sense to &quot;dedup&quot; at that level.  That implies that repeated parameters never make sense in any context... and I don&apos;t think we can/should try to do that.  If you want to dedup facet parameters for some reason, then it should probably be done in the faceting code.&lt;/p&gt;</comment>
                            <comment id="14090909" author="erickerickson" created="Fri, 8 Aug 2014 16:02:03 +0000"  >&lt;p&gt;bq: If you want to dedup facet parameters for some reason, then it should probably be &lt;br/&gt;
done in the faceting code.&lt;/p&gt;

&lt;p&gt;Yeah, that&apos;s exactly what&apos;s making me uncomfortable about the patch, it&apos;s at such a low level and it&lt;br/&gt;
affects &lt;em&gt;everything&lt;/em&gt;. Unintended consequences and all that.&lt;/p&gt;

&lt;p&gt;OTOH, what&apos;s the case for allowing dups? Do you have specific cases where that&apos;s&lt;br/&gt;
good or is your comment more of a statement that we shouldn&apos;t restrict future possibilities&lt;br/&gt;
just because I&apos;m not sufficiently imaginative &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ?&lt;/p&gt;

&lt;p&gt;I&apos;m really having a tough time imagining scenarios where allowing dups is useful, and I can&lt;br/&gt;
come up with scenarios where allowing dups is harmful (imagine multiple, expensive, identical&lt;br/&gt;
fq clause with cache=false for instance) that would be caught here. Hmmm, a WARN-level &lt;br/&gt;
log message is indicated for dups no matter what I think.&lt;/p&gt;

&lt;p&gt;The counter-argument is that the user should be free to shoot themselves in the foot as&lt;br/&gt;
they want to.&lt;/p&gt;

&lt;p&gt;The counter-counter argument is that when we identify potential traps we&lt;br/&gt;
should do something about them if we can.&lt;/p&gt;

&lt;p&gt;What do you think about this alternative? (note, I&apos;m not proposing it as much as throwing it out&lt;br/&gt;
for discussion). Leave the dup-detection where it is and log a WARN level message when dups&lt;br/&gt;
are detected, and move the actual de-duping out to the faceting code. Then de-dupe on a case-&lt;br/&gt;
by-case basis as situations arise.&lt;/p&gt;

&lt;p&gt;Where this started was that the exact same query over the exact same data set returns different&lt;br/&gt;
results in sharded and non-sharded situations. The results have the same information, just &lt;br/&gt;
repeated in the single shard case. Which means that somehow the sharded code manages to &lt;br/&gt;
ignore the extra entries. I&apos;ll look at how in a bit. At any rate, the &lt;br/&gt;
sharded case manages to avoid returning the data multiple times so either there&apos;s code in there &lt;br/&gt;
specifically to deal with this or it&apos;s happening by chance, which is its own gotcha.&lt;/p&gt;

&lt;p&gt;I&apos;ve seen some very large queries out in the wild and it&apos;s hard in many cases to see things&lt;br/&gt;
like this so logging a message would help the users figure out their (perhaps&lt;br/&gt;
machine-generated) code was doing things  they &lt;em&gt;probably&lt;/em&gt; don&apos;t want.&lt;/p&gt;

&lt;p&gt;So this is a long winded way of saying &quot;Hell, I don&apos;t know&quot;. My &lt;em&gt;slight&lt;/em&gt; preference here&lt;br/&gt;
would be to dedupe as it&apos;s being done in this patch (and log warnings when doing so). It&lt;br/&gt;
just feels &quot;more correct&quot; and may prevent weird behavior in the future. But I&apos;m not &lt;br/&gt;
adamant about that, if the general consensus is that doing this on a case-by-case basis&lt;br/&gt;
is a better idea I can make it so for the facet case.&lt;/p&gt;</comment>
                            <comment id="14098119" author="erickerickson" created="Fri, 15 Aug 2014 04:18:26 +0000"  >&lt;p&gt;While arguably the behavior I started looking at is benign-but-annoying (if inefficient), there is bona-fide badness here. If you specify facet.query=blah twice in distributed mode, the result is twice the count it should be.&lt;/p&gt;

&lt;p&gt;Try this: URL on the test docs, simple 2-shard setup:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/collection1/query?q=*:*&amp;amp;facet=true&amp;amp;facet.range.mincount=1&amp;amp;facet.range=manufacturedate_dt&amp;amp;facet.range.start=NOW-100YEARS&amp;amp;facet.range.end=NOW&amp;amp;facet.range.gap=%2B10YEAR&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/collection1/query?q=*:*&amp;amp;facet=true&amp;amp;facet.range.mincount=1&amp;amp;facet.range=manufacturedate_dt&amp;amp;facet.range.start=NOW-100YEARS&amp;amp;facet.range.end=NOW&amp;amp;facet.range.gap=%2B10YEAR&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The only non-zero entry is&lt;br/&gt;
&quot;2004-08-14T22:53:07.852Z&quot;,&lt;br/&gt;
11&lt;/p&gt;

&lt;p&gt;Now duplicate the field by adding another copy of:&lt;br/&gt;
&amp;amp;facet.range=manufacturedate_dt&lt;br/&gt;
the count goes to 22&lt;br/&gt;
oops.&lt;/p&gt;

&lt;p&gt;Admittedly this is pilot error, but still it&apos;s incorrect.&lt;/p&gt;

&lt;p&gt;I looked at de-duping in the facet component only, but that ran into weird null pointer exceptions. Given that I slightly favored deduping at a high level anyway, I&apos;m not willing to pursue that avenue unless there&apos;s a really good counter-argument.&lt;/p&gt;

&lt;p&gt;Long version:&lt;/p&gt;

&lt;p&gt;The behavior is different because the distributed case is, of course, a separate code path. Part of that path is FacetComponent.parse (roughly line 1000 in trunk). That method collects the facet.field parameters into a LinkedHashMap, so multiple entries are weeded out. In the case where we specify the field twice, the params are still &lt;em&gt;passed to the shards and calculated twice&lt;/em&gt;. And returned twice. It just happens that the facets member var (which collected the names of the fields) only has one entry for the multiply-specified field since it&apos;s a HashMap. So it only asks for the facet counts from the response packet once for each shard. Since they&apos;re identical, it&apos;s OK.&lt;/p&gt;

&lt;p&gt;However, take rangeFacets, roughly line 981 in FacetComponent is defined as a SimpleOrderedMap. Which checks to see if there is already an entry for the field in question... and if there is adds to it. &lt;/p&gt;

&lt;p&gt;I think that this adds weight to the somewhat invasive change I first tried. I don&apos;t know how many of these are hanging around. Based on them being SimpleOrderedMaps, I&apos;m guessing at least date facets, pivot facets and interval facets at least have problems.&lt;/p&gt;

&lt;p&gt;So rather than find them one-by-one I&apos;m inclined to do the deduping at a higher level.&lt;/p&gt;

&lt;p&gt;This is easy to demonstrate in the distributed tests, just hack TestDistributedSearch to duplicate one of the facet.range (or other facet types that use SimpleOrderedMaps) in the queries . Tests start failing.&lt;/p&gt;

&lt;p&gt;I&apos;ll probably attach a new version of the patch tonight (running tests now). It&apos;s just like the old one except it adds duplicated fields to the distributed facets test (which will fail without the patch).&lt;/p&gt;

&lt;p&gt;I spent some time trying to move the dedupe code to FacetComponent, but it&apos;s more tangled than I think is worth the effort. It&apos;s not difficult&lt;br/&gt;
to dedupe the parameters, but they&apos;re passed through in a SolrParams object. So far so good. But somehow that generates a null pointer exception down the road. I &lt;em&gt;think&lt;/em&gt; that the problem here is that there are some assumptions about how many entries should be there based on the original parameters in the request. Or something like that. Deduping on the highest level seems to avoid this altogether and I&apos;m very afraid it&apos;s an N+1 problem.&lt;/p&gt;

&lt;p&gt;Let me know if anyone disagrees violently. Otherwise I&apos;ll commit sometime this weekend assuming tests pass.&lt;/p&gt;</comment>
                            <comment id="14098163" author="erickerickson" created="Fri, 15 Aug 2014 05:06:07 +0000"  >&lt;p&gt;Latest patch as promised.&lt;/p&gt;</comment>
                            <comment id="14098760" author="yseeley@gmail.com" created="Fri, 15 Aug 2014 17:01:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;OTOH, what&apos;s the case for allowing dups?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s a general parameter passing mechanism, so we&apos;re talking about all possible plugins/interfaces.&lt;br/&gt;
But here&apos;s one off the top of my head...  specifying field values with query parameters:&lt;/p&gt;

&lt;p&gt;&amp;amp;field.description=shoes&lt;br/&gt;
&amp;amp;field.color=red&lt;br/&gt;
&amp;amp;field.color=blue&lt;br/&gt;
&amp;amp;field.size=10.5&lt;br/&gt;
&amp;amp;field.size=10.5&lt;/p&gt;

&lt;p&gt;It still seems like there&apos;s no bug here.&lt;br/&gt;
The root cause of the incorrect facet count appears to be an incorrect facet request, right?&lt;br/&gt;
If that&apos;s the case, the simplest answer is &quot;well, that behavior is undefined&quot;.&lt;br/&gt;
Or if we want to help detect the user error sooner, simply throw an exception in the facet component?&lt;/p&gt;</comment>
                            <comment id="14099319" author="erickerickson" created="Fri, 15 Aug 2014 22:56:00 +0000"  >&lt;p&gt;Ahhh, OK. If I&apos;m understanding the approach, then collapsing the identical params&lt;br/&gt;
would screw up anything that depended on relative positions (as one example). So&lt;br/&gt;
something like this:&lt;/p&gt;

&lt;p&gt;&amp;amp;field.description=shoes&lt;br/&gt;
&amp;amp;field.color=red&lt;br/&gt;
&amp;amp;field.color=blue&lt;br/&gt;
&amp;amp;field.color=black&lt;br/&gt;
&amp;amp;field.size=10.5&lt;br/&gt;
&amp;amp;field.size=10.5&lt;br/&gt;
&amp;amp;field.size=11&lt;/p&gt;

&lt;p&gt;where there&apos;s an positional association between the order of the&lt;br/&gt;
colors and the shoe size you&apos;re looking for. In this case it means&lt;br/&gt;
red and blue shoes of size 10.5 &lt;br/&gt;
black shoes 11&lt;/p&gt;

&lt;p&gt;and collapsing the two 10.5s would screw it up.&lt;/p&gt;

&lt;p&gt;Ok, that makes sense.&lt;/p&gt;

&lt;p&gt;Certainly throwing an error in the component would be easily do-able.&lt;/p&gt;

&lt;p&gt;Let me see if I can put something together that collapses the values in &lt;br/&gt;
facet component, an approach just occurred to me. If it works we&apos;ll have &lt;br/&gt;
two choices. Then we can all weigh in on whether it&apos;s better to &lt;/p&gt;

&lt;p&gt;1&amp;gt; throw an error or (possibly breaking currently-running code BTW)&lt;br/&gt;
or&lt;br/&gt;
2&amp;gt; remove the duplicates and log a warning.&lt;/p&gt;</comment>
                            <comment id="14101155" author="jira-bot" created="Mon, 18 Aug 2014 19:45:19 +0000"  >&lt;p&gt;Commit 1618716 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1618716&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1618716&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6314&quot; title=&quot;Facet counts duplicated in the response if specified more than once on the request.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6314&quot;&gt;&lt;del&gt;SOLR-6314&lt;/del&gt;&lt;/a&gt;: Multi-threaded facet counts differ when SolrCloud has &amp;gt;1 shard&lt;/p&gt;</comment>
                            <comment id="14101199" author="erickerickson" created="Mon, 18 Aug 2014 20:11:19 +0000"  >&lt;p&gt;Final version of patch, it&apos;s my day to forget to put them up first.&lt;/p&gt;</comment>
                            <comment id="14101287" author="jira-bot" created="Mon, 18 Aug 2014 21:01:57 +0000"  >&lt;p&gt;Commit 1618734 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1618734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1618734&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6314&quot; title=&quot;Facet counts duplicated in the response if specified more than once on the request.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6314&quot;&gt;&lt;del&gt;SOLR-6314&lt;/del&gt;&lt;/a&gt;: Multi-threaded facet counts differ when SolrCloud has &amp;gt;1 shard&lt;/p&gt;</comment>
                            <comment id="14101289" author="erickerickson" created="Mon, 18 Aug 2014 21:02:25 +0000"  >&lt;p&gt;Thanks Vamsee!&lt;/p&gt;</comment>
                            <comment id="14101292" author="erickerickson" created="Mon, 18 Aug 2014 21:03:16 +0000"  >&lt;p&gt;BTW, the final solution was to NOT log any warnings in the general case and just remove the dups in the facet component that were facet-related.&lt;/p&gt;</comment>
                            <comment id="14103564" author="vamsee" created="Wed, 20 Aug 2014 07:36:10 +0000"  >&lt;p&gt;The patch looks good to me. &lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14105395" author="markrmiller@gmail.com" created="Thu, 21 Aug 2014 14:10:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Multi-threaded facet counts differ when SolrCloud has &amp;gt;1 shard&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This seems like the wrong title for the JIRA and especially the wrong title in CHANGES. Makes it sound like a severe bug rather than what I&apos;m reading above.&lt;/p&gt;</comment>
                            <comment id="14105397" author="markrmiller@gmail.com" created="Thu, 21 Aug 2014 14:13:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6314&quot; title=&quot;Facet counts duplicated in the response if specified more than once on the request.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6314&quot;&gt;&lt;del&gt;SOLR-6314&lt;/del&gt;&lt;/a&gt;: Multi-threaded facet counts differ when SolrCloud has &amp;gt;1 shard (Erick Erickson)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Also missing credit for Vamsee in CHANGES.&lt;/p&gt;</comment>
                            <comment id="14105524" author="erickerickson" created="Thu, 21 Aug 2014 16:15:02 +0000"  >&lt;p&gt;Yep, you&apos;re right. The counts were correct, it was just repeated unnecessarily in the response under some conditions.&lt;/p&gt;

&lt;p&gt;Fixing up both.&lt;/p&gt;</comment>
                            <comment id="14105526" author="jira-bot" created="Thu, 21 Aug 2014 16:16:59 +0000"  >&lt;p&gt;Commit 1619470 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619470&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619470&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6314&quot; title=&quot;Facet counts duplicated in the response if specified more than once on the request.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6314&quot;&gt;&lt;del&gt;SOLR-6314&lt;/del&gt;&lt;/a&gt;: updated bug title to be more accurate and include Vamsee in credits, all in CHNAGES.txt. No code changes&lt;/p&gt;</comment>
                            <comment id="14105528" author="jira-bot" created="Thu, 21 Aug 2014 16:17:51 +0000"  >&lt;p&gt;Commit 1619471 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619471&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6314&quot; title=&quot;Facet counts duplicated in the response if specified more than once on the request.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6314&quot;&gt;&lt;del&gt;SOLR-6314&lt;/del&gt;&lt;/a&gt;: updated bug title to be more accurate and include Vamsee in credits, all in CHNAGES.txt. No code changes&lt;/p&gt;</comment>
                            <comment id="14105542" author="jira-bot" created="Thu, 21 Aug 2014 16:30:30 +0000"  >&lt;p&gt;Commit 1619478 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjernst&quot; class=&quot;user-hover&quot; rel=&quot;rjernst&quot;&gt;rjernst&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619478&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6314&quot; title=&quot;Facet counts duplicated in the response if specified more than once on the request.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6314&quot;&gt;&lt;del&gt;SOLR-6314&lt;/del&gt;&lt;/a&gt;: updated bug title to be more accurate and include Vamsee in credits, all in CHNAGES.txt. No code changes&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12734654">SOLR-6386</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12662558" name="SOLR-6314.patch" size="6718" author="erickerickson" created="Mon, 18 Aug 2014 20:11:19 +0000"/>
                            <attachment id="12662000" name="SOLR-6314.patch" size="9676" author="erickerickson" created="Fri, 15 Aug 2014 05:06:07 +0000"/>
                            <attachment id="12660550" name="SOLR-6314.patch" size="8116" author="erickerickson" created="Fri, 8 Aug 2014 04:42:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ygpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409534</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>