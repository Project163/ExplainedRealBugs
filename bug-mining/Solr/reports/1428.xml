<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:37:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4891] JsonLoader should preserve field value types from the JSON content stream</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4891</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;JSON content streams carry some basic type information for their field values, as parsed by Noggit: LONG, NUMBER, BIGNUMBER, and BOOLEAN.  &lt;tt&gt;JsonLoader&lt;/tt&gt; should set field value object types in the &lt;tt&gt;SolrInputDocument&lt;/tt&gt; according to the content stream&apos;s data types. &lt;/p&gt;

&lt;p&gt;Currently &lt;tt&gt;JsonLoader&lt;/tt&gt; converts all non-&lt;tt&gt;String&lt;/tt&gt;-typed field values to &lt;tt&gt;String&lt;/tt&gt;-s.&lt;/p&gt;

&lt;p&gt;There is a comment in &lt;tt&gt;JsonLoader.parseSingleFieldValue()&lt;/tt&gt;, where the convert-everything-to-string logic happens, that says &quot;for legacy reasons, single values s are expected to be strings&quot;, but other content streams&apos; type information is not flattened like this, e.g. &lt;tt&gt;JavabinLoader&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12650660">SOLR-4891</key>
            <summary>JsonLoader should preserve field value types from the JSON content stream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Jun 2013 15:34:03 +0000</created>
                <updated>Tue, 23 Jul 2013 18:38:38 +0000</updated>
                            <resolved>Wed, 5 Jun 2013 15:30:00 +0000</resolved>
                                                    <fixVersion>4.4</fixVersion>
                                    <component>update</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13673212" author="steve_rowe" created="Mon, 3 Jun 2013 15:39:24 +0000"  >&lt;p&gt;Simple patch preserving JSON types in &lt;tt&gt;SolrInputDocument&lt;/tt&gt;, with some tests.&lt;/p&gt;</comment>
                            <comment id="13674609" author="steve_rowe" created="Tue, 4 Jun 2013 17:51:36 +0000"  >&lt;p&gt;If there are no objections I&apos;ll commit this later today.&lt;/p&gt;</comment>
                            <comment id="13675493" author="steve_rowe" created="Wed, 5 Jun 2013 00:59:23 +0000"  >&lt;p&gt;Committed:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;trunk: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=1489676&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1489676&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;branch_4x: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=1489677&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1489677&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13676011" author="steve_rowe" created="Wed, 5 Jun 2013 15:14:56 +0000"  >&lt;p&gt;At Hoss&apos;s suggestion on #solr IRC last night, I tested whether &lt;tt&gt;JsonLoader&lt;/tt&gt; behavior has changed around &lt;tt&gt;BigInteger&lt;/tt&gt; and &lt;tt&gt;BigDecimal&lt;/tt&gt; values as a result of the changes committed under this issue.&lt;/p&gt;

&lt;p&gt;I&apos;m reopening to address an issue with adding JSON &lt;tt&gt;BIGNUMBER&lt;/tt&gt;-s (returned by the Noggit parser when a number won&apos;t fit in either a long or a double) to trie integer or long fields: a &lt;tt&gt;NumberFormatException&lt;/tt&gt; is no longer triggered, and the values are silently corrupted.&lt;/p&gt;

&lt;p&gt;Before committing the patch on this issue, &lt;tt&gt;BigInteger&lt;/tt&gt;-typed values were not created for &lt;tt&gt;BIGNUMBER&lt;/tt&gt;-s in &lt;tt&gt;SolrInputDocument&lt;/tt&gt;; instead, they (along with every other JSON value) were converted to &lt;tt&gt;String&lt;/tt&gt;-s, and then adding such a value to an integer or long field would cause a &lt;tt&gt;NumberFormatException&lt;/tt&gt; to be thrown from &lt;tt&gt;Integer.parseInt()&lt;/tt&gt; or &lt;tt&gt;Long.parseLong()&lt;/tt&gt;.  This was proper and good.&lt;/p&gt;

&lt;p&gt;But now, &lt;tt&gt;BigInteger&lt;/tt&gt;-typed values are converted (in &lt;tt&gt;TrieField.createField()&lt;/tt&gt; to int/long using &lt;tt&gt;BigInteger&lt;/tt&gt;&apos;s &lt;tt&gt;intValue()&lt;/tt&gt; and &lt;tt&gt;longValue()&lt;/tt&gt; methods, which return only the low-order 32 and 64 bits, respectively.  These values are always corrupted: the truncated high-order bits are guaranteed to be non-zero, since &lt;tt&gt;BigInteger&lt;/tt&gt; typing only happens when values won&apos;t fit into 64 bits.&lt;/p&gt;

&lt;p&gt;Reverting back to &lt;tt&gt;String&lt;/tt&gt;-typed &lt;tt&gt;BIGNUMBER&lt;/tt&gt; values fixes the problem.&lt;/p&gt;

&lt;p&gt;By contrast, &lt;tt&gt;BigDecimal&lt;/tt&gt;&apos;s &lt;tt&gt;doubleValue()&lt;/tt&gt; and &lt;tt&gt;floatValue()&lt;/tt&gt; methods truncate the low-order bits, resulting in loss of precision rather than corruption.  This is the same behavior used by &lt;tt&gt;Double.parseDouble()&lt;/tt&gt; and &lt;tt&gt;Float.parseFloat()&lt;/tt&gt;.  Reverting back to &lt;tt&gt;String&lt;/tt&gt;-typing for decimal &lt;tt&gt;BIGNUMBER&lt;/tt&gt;-s in addition to integral &lt;tt&gt;BIGNUMBER&lt;/tt&gt;-s won&apos;t be a problem.&lt;/p&gt;

&lt;p&gt;Patch forthcoming.&lt;/p&gt;</comment>
                            <comment id="13676021" author="steve_rowe" created="Wed, 5 Jun 2013 15:25:13 +0000"  >&lt;p&gt;patch - committing shortly&lt;/p&gt;</comment>
                            <comment id="13676029" author="steve_rowe" created="Wed, 5 Jun 2013 15:30:00 +0000"  >&lt;p&gt;Committed:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;trunk: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=1489914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1489914&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;branch_4x: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=1489915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1489915&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13716804" author="steve_rowe" created="Tue, 23 Jul 2013 18:38:38 +0000"  >&lt;p&gt;Bulk close resolved 4.4 issues&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12546593">SOLR-3250</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12586334" name="SOLR-4891-BigInteger-bugfix.patch" size="6575" author="sarowe" created="Wed, 5 Jun 2013 15:25:13 +0000"/>
                            <attachment id="12585873" name="SOLR-4891.patch" size="8733" author="sarowe" created="Mon, 3 Jun 2013 15:39:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>330987</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1l3of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>331320</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>