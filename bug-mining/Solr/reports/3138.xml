<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:17:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6203] cast exception while searching with sort function and result grouping</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6203</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;After upgrading from 4.5.1 to 4.7+, a schema including a &lt;tt&gt;&quot;*&quot;&lt;/tt&gt; dynamic field as text gets a cast exception when using a sort function and result grouping.  &lt;/p&gt;

&lt;p&gt;Repro (with example config):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Add &lt;tt&gt;&quot;*&quot;&lt;/tt&gt; dynamic field as a &lt;tt&gt;TextField&lt;/tt&gt;, eg:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;dynamicField name=&quot;*&quot; type=&quot;text_general&quot; multiValued=&quot;true&quot; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Create  sharded collection
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;curl &apos;http://localhost:8983/solr/admin/collections?action=CREATE&amp;amp;name=test&amp;amp;numShards=2&amp;amp;maxShardsPerNode=2&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Add example docs (query must have some results)&lt;/li&gt;
	&lt;li&gt;Submit query which sorts on a function result and uses result grouping:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
  &quot;responseHeader&quot;: {
    &quot;status&quot;: 500,
    &quot;QTime&quot;: 50,
    &quot;params&quot;: {
      &quot;sort&quot;: &quot;sqrt(popularity) desc&quot;,
      &quot;indent&quot;: &quot;true&quot;,
      &quot;q&quot;: &quot;*:*&quot;,
      &quot;_&quot;: &quot;1403709010008&quot;,
      &quot;group.field&quot;: &quot;manu&quot;,
      &quot;group&quot;: &quot;true&quot;,
      &quot;wt&quot;: &quot;json&quot;
    }
  },
  &quot;error&quot;: {
    &quot;msg&quot;: &quot;java.lang.Double cannot be cast to org.apache.lucene.util.BytesRef&quot;,
    &quot;code&quot;: 500
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Source exception from log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR - 2014-06-25 08:10:10.055; org.apache.solr.common.SolrException; java.lang.ClassCastException: java.lang.Double cannot be cast to org.apache.lucene.util.BytesRef
    at org.apache.solr.schema.FieldType.marshalStringSortValue(FieldType.java:981)
    at org.apache.solr.schema.TextField.marshalSortValue(TextField.java:176)
    at org.apache.solr.search.grouping.distributed.shardresultserializer.SearchGroupsResultTransformer.serializeSearchGroup(SearchGroupsResultTransformer.java:125)
    at org.apache.solr.search.grouping.distributed.shardresultserializer.SearchGroupsResultTransformer.transform(SearchGroupsResultTransformer.java:65)
    at org.apache.solr.search.grouping.distributed.shardresultserializer.SearchGroupsResultTransformer.transform(SearchGroupsResultTransformer.java:43)
    at org.apache.solr.search.grouping.CommandHandler.processResult(CommandHandler.java:193)
    at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:340)
    at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:218)
    at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)
  ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like &lt;tt&gt;serializeSearchGroup&lt;/tt&gt; is matching the sort expression as the &lt;tt&gt;&quot;*&quot;&lt;/tt&gt; dynamic field, which is a TextField in the repro.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12723736">SOLR-6203</key>
            <summary>cast exception while searching with sort function and result grouping</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nated">Nate Dire</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jun 2014 20:07:15 +0000</created>
                <updated>Wed, 13 May 2020 13:33:16 +0000</updated>
                                            <version>4.7</version>
                    <version>4.8</version>
                                                    <component>search</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14044167" author="nated" created="Wed, 25 Jun 2014 23:14:14 +0000"  >&lt;p&gt;Attached a patch with an addition to DistributedQueryComponentCustomSortTest that triggers  the exception.&lt;/p&gt;</comment>
                            <comment id="14059132" author="hossman" created="Fri, 11 Jul 2014 18:21:04 +0000"  >&lt;p&gt;I haven&apos;t looked into this, but i remember similar issues were problematic with normal distributed sorting in older versions of Solr, but this should have largely been resolved by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5354&quot; title=&quot;Distributed sort is broken with CUSTOM FieldType&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5354&quot;&gt;&lt;del&gt;SOLR-5354&lt;/del&gt;&lt;/a&gt; &amp;#8211; see in particular this comment &amp;amp; subsequent commit...&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5354?focusedCommentId=13835891&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13835891&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-5354?focusedCommentId=13835891&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13835891&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://svn.apache.org/r1547430&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1547430&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;..apparently we&apos;re still missing a place in the grouping code that should be looking at SortSpec.getSchemaFields() and isn&apos;t.&lt;/p&gt;</comment>
                            <comment id="14493264" author="jhava" created="Mon, 13 Apr 2015 23:23:36 +0000"  >&lt;p&gt;Hello, has anybody looked into this? I have tried to take Hoss Man&apos;s advice, but my tests are still failing. This is my first dive into Solr code and I am only guessing how things fit together. I don&apos;t think it&apos;s worth posting my code, but here is the list of source files I have stumbled across and modified; if some other files are calling out for modification, please let me know! Thanks in advance for any suggestions.&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/handler/component/ResponseBuilder.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/grouping/distributed/command/SearchGroupsFieldCommand.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/grouping/distributed/command/TopGroupsFieldCommand.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/grouping/distributed/shardresultserializer/TopGroupsResultTransformer.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/grouping/distributed/shardresultserializer/SearchGroupsResultTransformer.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/grouping/distributed/shardresultserializer/ShardResultTransformer.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/grouping/distributed/responseprocessor/SearchGroupShardResponseProcessor.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/grouping/distributed/responseprocessor/TopGroupsShardResponseProcessor.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/grouping/GroupingSpecification.java&lt;/p&gt;

&lt;p&gt;./solr/core/src/java/org/apache/solr/search/QParser.java&lt;/p&gt;</comment>
                            <comment id="14941441" author="judith" created="Fri, 2 Oct 2015 17:26:16 +0000"  >&lt;p&gt;Hello, all.  I have created a patch based on Hoss Man&apos;s advice.  I added some unit tests and tested in my company&apos;s dev environment but have not tested with live traffic.  I will upload the patch along with a README file summarizing the changes.&lt;/p&gt;

&lt;p&gt;This is my first patch; apologies in advance if I am doing something wrong, but please let me know!  &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="15531054" author="juddhi" created="Wed, 28 Sep 2016 22:23:25 +0000"  >&lt;p&gt;Hello, does anybody know if this issue has been resolved in Solr 6.1 or if there is a workaround?&lt;/p&gt;

&lt;p&gt;Thanks in advance.&lt;/p&gt;</comment>
                            <comment id="15565762" author="cpoerschke" created="Tue, 11 Oct 2016 15:30:02 +0000"  >&lt;p&gt;Taking a look as part of &lt;a href=&quot;https://www.meetup.com/New-England-Search-Technologies-NEST-Group/events/233492535/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.meetup.com/New-England-Search-Technologies-NEST-Group/events/233492535/&lt;/a&gt; today.&lt;/p&gt;</comment>
                            <comment id="15565827" author="jira-bot" created="Tue, 11 Oct 2016 15:57:09 +0000"  >&lt;p&gt;Commit 2bbca4c512ca8a4ec6be167bc11822bc9a6e6113 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2bbca4c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2bbca4c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;(part of) &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt;: ResponseBuilder.setSortSpec arg name tweak. (Judith Silverman via Christine Poerschke)&lt;/p&gt;</comment>
                            <comment id="15565836" author="jira-bot" created="Tue, 11 Oct 2016 16:00:41 +0000"  >&lt;p&gt;Commit ca625ea5660b93fa56f4af55bfbf06024d64e184 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca625ea&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca625ea&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;(part of) &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt;: ResponseBuilder.setSortSpec arg name tweak. (Judith Silverman via Christine Poerschke)&lt;/p&gt;</comment>
                            <comment id="15579056" author="jira-bot" created="Sun, 16 Oct 2016 01:13:08 +0000"  >&lt;p&gt;Commit a4a314d1602458cd7427b337d32eca60049c72da in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a4a314d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a4a314d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt;: in QueryComponent rename groupSortStr to sortWithinGroupStr (so that name and meaning match)&lt;/p&gt;</comment>
                            <comment id="15579072" author="jira-bot" created="Sun, 16 Oct 2016 01:28:20 +0000"  >&lt;p&gt;Commit e87072bc5abb6b7c6f7a6e494d9360814689dffd in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e87072b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e87072b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt;: in QueryComponent rename groupSortStr to sortWithinGroupStr (so that name and meaning match)&lt;/p&gt;</comment>
                            <comment id="15585885" author="cpoerschke" created="Tue, 18 Oct 2016 16:19:36 +0000"  >&lt;p&gt;Attaching variant of the original unittest patch using &quot;id&quot; instead of &quot;text&quot; for the &quot;group.field&quot; and with diff taken from the top-level directory.&lt;/p&gt;</comment>
                            <comment id="15585894" author="cpoerschke" created="Tue, 18 Oct 2016 16:23:12 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nated&quot; class=&quot;user-hover&quot; rel=&quot;nated&quot;&gt;nated&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Judith&quot; class=&quot;user-hover&quot; rel=&quot;Judith&quot;&gt;Judith&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks for reporting this issue in detail and attaching test case and code change patches.&lt;/p&gt;

&lt;p&gt;I started looking at this last week but only now got around to writing comments here, apologies for the delay.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The original &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt;-unittest.patch still applies cleanly but running
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cd solr/core
ant test -Dtestcase=DistributedQueryComponentCustomSortTest
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;gives&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;... unexpected docvalues type SORTED_SET &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; field &lt;span class=&quot;code-quote&quot;&gt;&apos;text&apos;&lt;/span&gt; (expected=SORTED). Re-index with correct docvalues type. ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;error. I have not looked into the details for that error but simply changing&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;- ... &lt;span class=&quot;code-quote&quot;&gt;&quot;group.field&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt; ...
+ ... &lt;span class=&quot;code-quote&quot;&gt;&quot;group.field&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in the test patch again produces the &lt;tt&gt;java.lang.Double cannot be cast to org.apache.lucene.util.BytesRef&lt;/tt&gt; exception.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The original &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt;.patch could no longer be applied cleanly, that is of course nothing to worry about though since the patch is over a year old by now.
	&lt;ul&gt;
		&lt;li&gt;I have separated out some parts of the patch into the micro commits above and into the linked &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9627&quot; title=&quot;add QParser.getSortSpec, deprecate misleadingly named QParser.getSort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9627&quot;&gt;&lt;del&gt;SOLR-9627&lt;/del&gt;&lt;/a&gt; patch.&lt;/li&gt;
		&lt;li&gt;Trying to graft everything from your patch onto the current master branch seemed to work at first but then tests were failing and so i backtracked, to what your README mentions as the first step i.e. storing SortSpecs rather than Sorts in GroupingSpecification. There was also the
&lt;blockquote&gt;&lt;p&gt;TODO eliminate GroupingSpec&apos;s (Group)Offset and (Group)Limit fields and get those values from its SortSpecs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;comment in your patch and i pulled that into scope for the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; sub-step because i think it will make the subsequent code changes here easier.&lt;/p&gt;
		&lt;ul&gt;
			&lt;li&gt;The tests for the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; sub-step are still failing, extra pairs of eyes and reviews of the patch are very welcome. The &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9649&quot; title=&quot;Distributed grouping can return &amp;#39;too many&amp;#39; results?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9649&quot;&gt;SOLR-9649&lt;/a&gt; discovery is also unexpected and perhaps figuring out the latter will help with fixing the former.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15607409" author="judith" created="Wed, 26 Oct 2016 04:47:35 +0000"  >&lt;p&gt;Christine, thanks for taking an interest in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt;.  I will be happy to lend a pair of eyes but it will take a while for me to remind myself how the patch worked and to catch up with the changes to Solr since 4.10.  I do have some elementary questions about the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; which I will post under that jira.  Thanks again.&lt;/p&gt;</comment>
                            <comment id="15706695" author="cpoerschke" created="Tue, 29 Nov 2016 22:08:57 +0000"  >&lt;p&gt;Just a quick note for the log here to say that &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9783&quot; title=&quot;remove no-longer-needed sortWithinGroup null checks in (Search|Top)Group[s]ShardResponseProcessor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9783&quot;&gt;&lt;del&gt;SOLR-9783&lt;/del&gt;&lt;/a&gt; have been committed to master, the former includes step (1) from Judith&apos;s README file and the latter should help with step (2) i.e. passing around SortSpecs rather than plain Sorts.&lt;/p&gt;

&lt;p&gt;I myself at the moment don&apos;t have a chunk of time to continue with the next logical part of step (2) but if I had time then I would next go and change signatures where needed (and only where needed) so that the SortSpecs become available where they will be used later (signature changes only for now, actual use would be a subsequent step). And if there&apos;s obvious non-trivial code duplication (in the code that will need to be changed later) then I would factor out utility methods to reduce the duplication. In case anyone else wants to pursue the same incremental approach in the meantime, I&apos;ve started &lt;a href=&quot;https://github.com/apache/lucene-solr/tree/jira/solr-6203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jira/solr-6203&lt;/a&gt; working branch (with one small &lt;a href=&quot;https://github.com/apache/lucene-solr/commit/859eb0837f52d131924ce8401c4ae1dc3056b7de&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt;) for which pull requests could be opened or alternatively if preferred then i&apos;d be happy to review any new patch files attached to this ticket.&lt;/p&gt;</comment>
                            <comment id="15709543" author="judith" created="Wed, 30 Nov 2016 19:38:08 +0000"  >&lt;p&gt;Thanks for the update, Christine.  I am happy to pursue your incremental approach.  I have made a patch to your branch in which I uncommented a couple of your signature changes and modified calls to the affected methods to use the new signatures.  I also took this opportunity to  start standardizing field and method names related to the field variously known throughout the codebase as &quot;sortWithinGroup&quot; and &quot;withinGroupSort&quot;.  The latter fits better with related field and method names, and since we are already deprecating GroupingSpecification&apos;s accessors for Sorts in favor of accessors of  SortSpecs, this seems to me like a good time to make the change.  I renamed the new public accessors and also renamed private fields in all the files I was already modifying for this commit.  If you approve of this change, I will rename private fields in other files.  In the meantime, I will keep going in the direction you indicated.                           &lt;br/&gt;
Thanks,        &lt;br/&gt;
Judith &lt;/p&gt;</comment>
                            <comment id="15710884" author="judith" created="Thu, 1 Dec 2016 04:53:52 +0000"  >&lt;p&gt;Hi, in tonight&apos;s patch I finished uncommenting your new signatures and made the changes necessary to get the code to compile and the existing tests to pass.&lt;/p&gt;</comment>
                            <comment id="15713080" author="cpoerschke" created="Thu, 1 Dec 2016 21:04:54 +0000"  >&lt;p&gt;Hi Judith, thanks for your patch(es). I&apos;ve not had any time yet to take a closer look but have gone and applied the latest patch to the working branch plus two comments/replies to two of your comments/questions. Hope that helps.&lt;/p&gt;</comment>
                            <comment id="15715697" author="judith" created="Fri, 2 Dec 2016 17:16:30 +0000"  >&lt;p&gt;Hi, Christine, thanks for updating the branch and replying to my           questions.  Re the one about rb.getSortSpec() in&lt;br/&gt;
SearchGroupShardResponseProcessor.java:  it&apos;s already confusing to this newbie that the master code base has two Sorts (rb.getSortSpec().getSort() and rb.getGroupingSpec().getGroupSort()) in play at the same time in a grouped search (to say nothing of the within-group Sort), and by the time we&apos;re finished with this branch we will have not only two Sorts but two full-fledged SortSpecs.  If we can do something at this early stage to make it clear which is to be used for what, or to consolidate them, I&apos;m in favor. &lt;br/&gt;
Thanks,&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="15716061" author="cpoerschke" created="Fri, 2 Dec 2016 19:40:13 +0000"  >&lt;p&gt;Hi Judith.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...  it&apos;s already confusing ... that the master code base has two Sorts (rb.getSortSpec().getSort() and rb.getGroupingSpec().getGroupSort()) in play at the same time in a grouped search (to say nothing of the within-group Sort) ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s a very fair point and looking beyond the scope of this bug fix ticket here it would be good if confusing code can be made less confusing.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;... the one about rb.getSortSpec() in SearchGroupShardResponseProcessor.java: ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;ul&gt;
	&lt;li&gt;Actually it&apos;s then not just about SearchGroupShardResponseProcessor (SGSRP) really but we can question not just why SGSRP uses both &lt;tt&gt;rb.getGroupingSpec().getGroupSort[Spec]()&lt;/tt&gt; and &lt;tt&gt;rb.getSortSpec()&lt;/tt&gt; but why &lt;em&gt;anything&lt;/em&gt; uses both &lt;tt&gt;rb.getGroupingSpec().getGroupSortSpec().get...()&lt;/tt&gt; and &lt;tt&gt;rb.getSortSpec().get...()&lt;/tt&gt; - and from a quick look around all the places concerned have access to &lt;tt&gt;rb&lt;/tt&gt; and so have the possibility of using either.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Okay, then the next logical question is &quot;Is there a difference between the two?&quot; and a very cursory lookaround finds &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;QueryComponent.java&lt;/a&gt; and
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;GroupingSpecification groupingSpec = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroupingSpecification();
rb.setGroupingSpec(groupingSpec);

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SortSpec sortSpec = rb.getSortSpec();

&lt;span class=&quot;code-comment&quot;&gt;//TODO: move weighting of sort
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SortSpec groupSortSpec = searcher.weightSortSpec(sortSpec, Sort.RELEVANCE);
...
groupingSpec.setGroupSortSpec(groupSortSpec);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;So based on that it seems that:
	&lt;ul&gt;
		&lt;li&gt;the &quot;TODO: move weighting of sort&quot; could help get rid of GroupingSpecification&apos;s groupSort[Spec]&lt;/li&gt;
		&lt;li&gt;since SearchGroupShardResponseProcessor.process uses (as you say) only the offset and count part of &lt;tt&gt;ss&lt;/tt&gt; the
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-    SortSpec ss = rb.getSortSpec();
-    Sort groupSort = rb.getGroupingSpec().getGroupSort();
+    SortSpec groupSortSpec = rb.getGroupingSpec().getGroupSortSpec();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;change you propose should work and be a small step towards making the code less confusing.&lt;/p&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Code reading and &apos;thinking aloud&apos; done - does that kind of make sense?&lt;/p&gt;

&lt;p&gt;PS: I am not suggesting we get rid of GroupingSpecification&apos;s groupSort[Spec] here/at this time nor to pursue the &quot;//TODO: move weighting of sort&quot; here/at this time. But both would be worthwhile and yes here at this time we can stop using &lt;tt&gt;rb.getSortSpec()&lt;/tt&gt; in SearchGroupShardResponseProcessor.process as you suggested.&lt;/p&gt;

&lt;p&gt;Have a good weekend!&lt;/p&gt;

&lt;p&gt;Christine&lt;/p&gt;</comment>
                            <comment id="15716091" author="cpoerschke" created="Fri, 2 Dec 2016 19:49:35 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9821&quot; title=&quot;QueryComponent.prepareGrouping: //TODO: move weighting of sort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9821&quot;&gt;SOLR-9821&lt;/a&gt; to separately (at some point) pursue the &quot;QueryComponent.prepareGrouping: //TODO: move weighting of sort&quot; mentioned above.&lt;/p&gt;</comment>
                            <comment id="15716678" author="judith" created="Fri, 2 Dec 2016 22:06:45 +0000"  >&lt;p&gt;Hi, yes, that does indeed make sense, not that I have a clear idea of what &quot;weighting of sort&quot; does.  And on that topic:&lt;/p&gt;

&lt;p&gt;I&apos;ve had more time this week to work on this jira than I will have in the foreseeable future, so I&apos;m forging ahead rather than sensibly waiting for your comments.  I started calling new utility functions that make use of SortSpec&apos;s SchemaFields, but my updated unit tests kept failing with the same old &quot;java.lang.Double cannot be cast to org.apache.lucene.util.BytesRef&quot; error, and I got to wondering about the call to schema.getFileOrNull() in the new implWeightSortSpec() function from the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; patch.  That function allows the dynamic &apos;*&apos; field to lay claim to schema fields which SortSpecParsing carefully protected from it, just as it does when called by the XXXResultTransformer functions we are gearing up to modify.&lt;/p&gt;

&lt;p&gt;I have only the vaguest understanding of what the weightSort()/rewrite()/createWeight() functions are all about.  Do they actually affect which SchemaField a SortField should be associated to?  I tweaked implWeightSortSpec() to leave SchemaFields alone except in the case that nullEquivalent kicks in, and all unit tests (including new ones testing the use of the new utility functions) now pass.  For now, I&apos;m posting a patch to our branch containing just the tweak to implWSS() and a little cleanup (removing my questions and your replies).      &lt;/p&gt;

&lt;p&gt;Have a good weekend yourself!  Thanks,&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="15723659" author="judith" created="Mon, 5 Dec 2016 23:04:35 +0000"  >&lt;p&gt;Hi, Christine.  I&apos;m posting what I have so far; please review at your    &lt;br/&gt;
convenience.  This afternoon&apos;s patch includes the changes from the       &lt;br/&gt;
patch of Dec. 3.  I added calls to two new utility functions (which      &lt;br/&gt;
turned out to be identical, so if you approve them, they should be       &lt;br/&gt;
combined and put in a good place) and copied over unit tests from last   &lt;br/&gt;
year&apos;s patch, which pass.                                                &lt;/p&gt;

&lt;p&gt;Cheers,                                                                  &lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="15773321" author="cpoerschke" created="Fri, 23 Dec 2016 17:24:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;... since we are already deprecating GroupingSpecification&apos;s accessors for Sorts in favor of accessors of SortSpecs, this seems to me like a good time to make the change. I renamed the new public accessors ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bc8936a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bc8936a&lt;/a&gt; just added the rename under the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; ticket which as you say was already concerned with those accessors.&lt;/p&gt;</comment>
                            <comment id="15773348" author="cpoerschke" created="Fri, 23 Dec 2016 17:39:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;... new utility functions (which turned out to be identical ... combined and put in a good place ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9890&quot; title=&quot;factor out ShardResultTransformerUtils.[un]marshSortValue methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9890&quot;&gt;&lt;del&gt;SOLR-9890&lt;/del&gt;&lt;/a&gt; proposes a combined version in a new place. What do you think?&lt;/p&gt;</comment>
                            <comment id="15773821" author="judith" created="Fri, 23 Dec 2016 22:41:17 +0000"  >&lt;p&gt;Hi, I see, you are separating the refactoring from the bug fix.  I like the new name and the new place.&lt;/p&gt;</comment>
                            <comment id="15881896" author="judith" created="Fri, 24 Feb 2017 03:59:17 +0000"  >&lt;p&gt;Hi, Christine, are there changes you would like me to make to the patch dated 05Dec16? As I recall, your commit of 23Dec16 took us part of the way toward that patch. &lt;br/&gt;
Do my concerns about SOLR_9660 (02Dec16 above) make sense?&lt;br/&gt;
Thanks,&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="15883546" author="cpoerschke" created="Fri, 24 Feb 2017 21:25:40 +0000"  >&lt;p&gt;Hi Judith,&lt;/p&gt;

&lt;p&gt;Thanks for following up on this ticket!&lt;/p&gt;

&lt;p&gt;I&apos;ve tried to remind myself about where we had left things by applying your Dec5th patch to the &lt;a href=&quot;https://github.com/apache/lucene-solr/tree/jira/solr-6203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jira/solr-6203&lt;/a&gt; working branch and then merging in the master branch changes including the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9890&quot; title=&quot;factor out ShardResultTransformerUtils.[un]marshSortValue methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9890&quot;&gt;&lt;del&gt;SOLR-9890&lt;/del&gt;&lt;/a&gt; piece. After resolving the merges &quot;it compiles&quot; but i haven&apos;t run any tests or anything.&lt;/p&gt;

&lt;p&gt;From your Dec 2nd comments:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;... I got to wondering about the call to schema.getFileOrNull() in the new implWeightSortSpec() function from the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; patch. That function allows the dynamic &apos;*&apos; field to lay claim to schema fields which SortSpecParsing carefully protected from it, just as it does when called by the XXXResultTransformer functions we are gearing up to modify. ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Merging the master branch into the working branch didn&apos;t help too much with jogging my memory, but this sounds like a very good lead.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;The schema.getFileOrNull() let&apos;s the dynamic &apos;&amp;#42;&apos; field claim &apos;sqrt(popularity) desc&apos; (or is it only &apos;popularity&apos;?) from the sort whereas in SortSpecParsing there&apos;s the &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/search/SortSpecParsing.java#L103-L108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;// short circuit test for a really simple field name ... // let&apos;s try it as a function instead&lt;/a&gt; logic which protects the sort from being misinterpreted as a &apos;&amp;#42;&apos; dynamic field.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;That is how I read your comment combined with the code, are we on the same page on this point? Assuming we are, and I think we are, then yes your weightSort/rewrite/createWeight and implWeightSortSpec observations and questions make sense to me.&lt;/p&gt;

&lt;p&gt;So, following in that direction, the &apos;solution under consideration&apos; is then:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;pass SortSpec rather than just Sort around (much of that already done via linked preparatory refactors)&lt;/li&gt;
	&lt;li&gt;have the ShardResultTransformer classes use the SortSpec&apos;s SchemaField objects because
	&lt;ul&gt;
		&lt;li&gt;the Sort&apos;s SortField requires use of IndexSchema.getFieldOrNull for conversion into a SchemaField object&lt;/li&gt;
		&lt;li&gt;IndexSchema.getFieldOrNull does not protect the sort function from being misinterpreted as a &apos;*&apos; dynamic field&lt;/li&gt;
		&lt;li&gt;the SortSpec&apos;s SchemaField objects require no conversion&lt;/li&gt;
		&lt;li&gt;the SortSpec&apos;s SchemaField objects originally came from SortSpecParsing which afforded protection from the &apos;*&apos; dynamic field&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Does that summary make sense so far? Assuming it does, then on to the &apos;complication and remaining questions&apos;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;QueryComponent didn&apos;t just use the Sort &apos;as it is&apos; but it does this (not fully understood by us) &apos;weighting of sort&apos; thing&lt;/li&gt;
	&lt;li&gt;&apos;weighting of sort&apos; is a SolrIndexSearcher &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java#L1001-L1004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;thing&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;as part of the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; refactor QueryComponent doing &apos;weighting of sort&apos; became &apos;weighting of sort spec&apos; which is still a SolrIndexSearcher &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java#L1006-L1030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;thing&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&apos;weighting of sort spec&apos; needs to consider the SchemaField objects in the sort spec
	&lt;ul&gt;
		&lt;li&gt;question 1: is it fair to assume that the SchemaField objects of the original and the rewritten/weighted sort match?&lt;/li&gt;
		&lt;li&gt;question 2: if rewriting/weighting turns the original sort into a null sort, what should the SchemaField objects be for the rewritten/weighted sort spec?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Right, okay, that was a lot of writing, thank you for reading this far &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Does it sort of (no pun intended) help sum up where we think we are here?&lt;/p&gt;

&lt;p&gt;If it does then the next step (not for today) will be to find answers to the two open questions and decide on how to proceed with the patch/working branch.&lt;/p&gt;

&lt;p&gt;Have a nice weekend!&lt;/p&gt;

&lt;p&gt;Christine&lt;/p&gt;</comment>
                            <comment id="15884541" author="judith" created="Sun, 26 Feb 2017 05:10:25 +0000"  >&lt;p&gt;Hi, Christine, thanks for the quick response.                                                                                                                   &lt;/p&gt;

&lt;p&gt;The code in QueryComponent.java which calls weightSort() in the                                                                    &lt;br/&gt;
non-grouped case (as opposed to the grouped case we are trying to fix)&lt;br/&gt;
proceeds to iterate through sortSpec.getSchemaFields()                                                                        without modifying that (immutable) list of SchemaFields at all:&lt;/p&gt;

&lt;p&gt;       ...&lt;br/&gt;
      SortSpec sortSpec = rb.getSortSpec();                                                                                        &lt;br/&gt;
      Sort sort = searcher.weightSort(sortSpec.getSort());                                                                         &lt;/p&gt;

&lt;p&gt;      SortField[] sortFields = sort==null ? new SortField[]&lt;/p&gt;
{SortField.FIELD_SCORE}
&lt;p&gt; : sort.getSort();                               &lt;br/&gt;
      List&amp;lt;SchemaField&amp;gt; schemaFields = sortSpec.getSchemaFields();                                                                 &lt;/p&gt;

&lt;p&gt;      for (int fld = 0; fld &amp;lt; schemaFields.size(); fld++) {                                                                        &lt;br/&gt;
             SchemaField schemaField = schemaFields.get(fld);                                                                           &lt;br/&gt;
             FieldType ft = null == schemaField? null : schemaField.getType();  &lt;br/&gt;
        ...&lt;/p&gt;


&lt;p&gt;On the basis of that code, I would tentatively answer your questions as follows:                                                                &lt;/p&gt;

&lt;p&gt;Question #1: yes                                                                                                                   &lt;br/&gt;
Question #2: the original SchemaField object(s) (I suspect that rewrite/weight does                                                                   not turn a non-null into a null)                                                                       &lt;/p&gt;

&lt;p&gt;The SortSpecParser adds a null to the SchemaFields list for any                                                                    &lt;br/&gt;
SortField that doesn&apos;t correspond to a plain old field,                                                                            &lt;br/&gt;
i.e. SortFields corresponding to ValueSource and FunctionQueries---                                                                &lt;br/&gt;
exactly the ones the weightSort()/rewrite()/createWeight() business is used to                                                                    &lt;br/&gt;
support, if I understand correctly (cf. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2533&quot; title=&quot;Improve API of ValueSource &amp;amp; FunctionQuery SortField weighting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2533&quot;&gt;&lt;del&gt;SOLR-2533&lt;/del&gt;&lt;/a&gt;). (Sorts by score                                                                &lt;br/&gt;
and lucene docid also get null schemaFields.)                                                                                      &lt;/p&gt;

&lt;p&gt;My understanding is that any SortField actually modified by rewrite() is                                                               &lt;br/&gt;
associated to a null SchemaField to begin with, and that it would be                                                                    &lt;br/&gt;
inappropriate to replace that null with something else when we call                                                                 rewrite() on the SortField.  Our new utility functions will see that null&lt;br/&gt;
and refrain from marshalling/unmarshalling.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="15940486" author="judith" created="Fri, 24 Mar 2017 14:51:56 +0000"  >&lt;p&gt;Hi, Christine.  Last weekend I merged from master through commit                                              &lt;br/&gt;
e7d9db9d6c4dccc158b52d535 to my local copy of our branch and ran &apos;ant                                         &lt;br/&gt;
clean test&apos; twice.  There were two failures the first time and none the                                       &lt;br/&gt;
second.  Here are the tests that failed:                                                                      &lt;/p&gt;

&lt;p&gt;   org.apache.solr.cloud.CollectionsAPIDistributedZkTest.testTooManyReplicas                                  &lt;br/&gt;
   org.apache.solr.cloud.OnlyLeaderIndexesTest.test                                                           &lt;/p&gt;

&lt;p&gt;The two tests modified on our branch, TestDistributedGrouping and                                             &lt;br/&gt;
DistributedQueryComponentCustomSortTest, both passed both times.  I am                                        &lt;br/&gt;
attaching a patch for the second of these in which I remove some                                              &lt;br/&gt;
duplicated test cases and add some new ones.                                                                  &lt;/p&gt;

&lt;p&gt;If you are holding out for an authoritative answer to your questions                                          &lt;br/&gt;
from 24Feb17, is there someone we could ask?                                                                  &lt;/p&gt;

&lt;p&gt;Thanks,                                                                                                       &lt;br/&gt;
Judith         &lt;/p&gt;</comment>
                            <comment id="15970458" author="judith" created="Sun, 16 Apr 2017 17:47:42 +0000"  >&lt;p&gt;Hi, Christine.  I merged from master though commit 00f0c30 to my fork of the jira/solr-6203 branch, resolved a conflict in TopGroupsFieldCommand.java, and committed. Unit tests all pass, including those added in previous commits to test the fix of the bug which is the subject of this jira.&lt;br/&gt;
I closed the outstanding pull request and opened another.  Is there anything else I can do to help move things along?&lt;br/&gt;
Thanks,&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="15971773" author="judith" created="Mon, 17 Apr 2017 22:46:10 +0000"  >&lt;p&gt;Today&apos;s patch is based on commit 66715a476 to master in the lucene-solr repo (Mon Apr 17 11:08:53 2017).  All unit tests pass, including those added in this patch which test the functionality this patch is designed to fix.&lt;/p&gt;</comment>
                            <comment id="15972725" author="judith" created="Tue, 18 Apr 2017 13:57:50 +0000"  >&lt;p&gt;The restriction of yesterday&apos;s patch to SolrIndexSearcher.java is independent of the rest of the patch and addresses a defect introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9660&quot; title=&quot;in GroupingSpecification factor [group](sort|offset|limit) into [group](sortSpec)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9660&quot;&gt;&lt;del&gt;SOLR-9660&lt;/del&gt;&lt;/a&gt; (discussed above).  That defect affects the value of an class member which is not used in the present master, but it breaks unit tests on the jira/solr-6203 branch if that branch&apos;s change to SolrIndexSearcher.java is reverted.&lt;/p&gt;</comment>
                            <comment id="15973156" author="cpoerschke" created="Tue, 18 Apr 2017 17:50:22 +0000"  >&lt;p&gt;Hi Judith, thanks for merging master into working branch and resolving the merge conflict. Sorry I&apos;d gone rather silent here (and otherwise busy elsewhere). Alright, let&apos;s see if we can wrap this ticket up here soon, git branches will definitely help I think &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;How about this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Let&apos;s switch to your &lt;a href=&quot;https://github.com/jitka18/lucene-solr/tree/jira/solr-6203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jitka18/lucene-solr/tree/jira/solr-6203&lt;/a&gt; fork of the apache:jira/solr-6203 branch as the definitive working branch.
	&lt;ul&gt;
		&lt;li&gt;No need to attach further .patch files to this ticket here (we&apos;ll just do one &apos;final&apos; one with the final fix in the end).&lt;/li&gt;
		&lt;li&gt;No further updates to the apache:jira/solr-6203 working branch (would it be clearer to delete it right away now or only in the end?).&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Next step:
	&lt;ul&gt;
		&lt;li&gt;Could you merge the latest master into the jitka18:jira/solr-6203 and open a pull request into apache:master - this will help us &apos;see&apos; what the changes overall are.&lt;/li&gt;
		&lt;li&gt;I will add another rename change to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10394&quot; title=&quot;search.grouping.Command rename: getSortWithinGroup --&amp;gt; getWithinGroupSort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10394&quot;&gt;&lt;del&gt;SOLR-10394&lt;/del&gt;&lt;/a&gt; to help us tell apart actual changes from mostly-rename changes.&lt;/li&gt;
		&lt;li&gt;I will take a look at and run the tests.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15980240" author="judith" created="Sun, 23 Apr 2017 03:21:33 +0000"  >&lt;p&gt;Hi, Christine.  I consolidated the DistributedQueryComponentCustomSortTest tests as you suggested and updated my pull request to your branch.&lt;br/&gt;
Cheers,&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="16004618" author="judith" created="Wed, 10 May 2017 12:37:35 +0000"  >&lt;p&gt;Hi, Christine.  I have accepted your pull request to my branch, thanks.&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="16005038" author="cpoerschke" created="Wed, 10 May 2017 17:13:07 +0000"  >&lt;p&gt;Thanks Judith! Returning to this, the &lt;tt&gt;ss&lt;/tt&gt; vs. &lt;tt&gt;groupSortSpec&lt;/tt&gt; refactor thing just tripped me up again, so have gone and split it out to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10659&quot; title=&quot;remove ResponseBuilder.getSortSpec use in SearchGroupShardResponseProcessor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10659&quot;&gt;&lt;del&gt;SOLR-10659&lt;/del&gt;&lt;/a&gt; for clarity. Hope that makes sense.&lt;/p&gt;</comment>
                            <comment id="16005412" author="judith" created="Wed, 10 May 2017 21:01:09 +0000"  >&lt;p&gt;Short and sweet.&lt;br/&gt;
I see from the diff that we still haven&apos;t standardized nomenclature in the master branch:&lt;br/&gt;
   &quot;Sort withinGroupSort = rb.getGroupingSpec().getSortWithinGroup();&quot;&lt;br/&gt;
I thought you had already split out a patch for that, but I must be thinking of something else.&lt;br/&gt;
Thanks,&lt;br/&gt;
Judith&lt;/p&gt;</comment>
                            <comment id="16574152" author="ipv6guru" created="Thu, 9 Aug 2018 01:01:41 +0000"  >&lt;p&gt;Move issue from deprecated &apos;In  Progress&apos; back to &apos;Open&apos;&lt;/p&gt;</comment>
                            <comment id="16913636" author="cpoerschke" created="Thu, 22 Aug 2019 19:33:17 +0000"  >&lt;p&gt;ticket cross-referencing: I tried to return to this ticket here today and in doing so realised that a little bit of dead code could be removed in QueryCommand.java (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13711&quot; title=&quot;remove dead sort==null code paths in QueryCommand.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13711&quot;&gt;SOLR-13711&lt;/a&gt; created for that) and that this would mildly simplify the Sort-to-SortSpecs transition (as part of this ticket here) for that class, as well as making the code a little clearer by removing unreachable code.&lt;/p&gt;</comment>
                            <comment id="16914493" author="cpoerschke" created="Fri, 23 Aug 2019 17:38:55 +0000"  >&lt;p&gt;Hmm, so first I tried to resume work from the &lt;a href=&quot;https://github.com/jitka18/lucene-solr/tree/jira/solr-6203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jitka18/lucene-solr/tree/jira/solr-6203&lt;/a&gt; working branch but struggled with that because since then (May 2017) many things changed, understandably so, and refactoring changes (e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10990&quot; title=&quot;QueryComponent.process breakup (for readability)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10990&quot;&gt;&lt;del&gt;SOLR-10990&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13585&quot; title=&quot;factor out SearchGroupsResultTransformer.[de]serializeOneSearchGroup methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13585&quot;&gt;&lt;del&gt;SOLR-13585&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13603&quot; title=&quot;Remove deprecated grouping methods usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13603&quot;&gt;&lt;del&gt;SOLR-13603&lt;/del&gt;&lt;/a&gt;) can be helpful for code readability etc. but can be tough to conflict resolve on git merge etc.&lt;/p&gt;

&lt;p&gt;Anyway, so then I&apos;ve used &lt;a href=&quot;https://github.com/apache/lucene-solr/compare/master...jitka18:jira/solr-6203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/compare/master...jitka18:jira/solr-6203&lt;/a&gt; as a reference and the patch just attached contains, I think, most (but not all) of the changes e.g. the SolrIndexSearcher change is missing and also the test changes are not yet transplanted.&lt;/p&gt;

&lt;p&gt;With hindsight, perhaps the tests should have been revived first actually &lt;b&gt;to determine if and how this is still an issue with the 8.x Solr series&lt;/b&gt; ... ?&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;PS: Why the switch back from git branch to patch file? Just small personal preference in part plus we now have a Lucene/Solr QA bot setup which will automatically provide patch feedback but the bot does not (yet) do the same for pull requests.&lt;/p&gt;

&lt;p&gt;PS PS: As always, any and all input and contributions appreciated here and if git branches and pull requests instead of patch file attachments are more your thing then absolutely please do feel free to choose that option.&lt;/p&gt;</comment>
                            <comment id="16914577" author="lucenesolrqa" created="Fri, 23 Aug 2019 20:03:41 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; The patch doesn&apos;t appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m 15s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m  5s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m  5s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m  5s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m  5s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m  5s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 34m 38s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; 42m 17s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12978434/SOLR-6203.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12978434/SOLR-6203.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene1-us-west 4.15.0-54-generic #58-Ubuntu SMP Mon Jun 24 10:55:24 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 07f1364800 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.10.5 compiled on March 28 2019 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; LTS &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/537/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/537/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: solr/core U: solr/core &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/537/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/537/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16972242" author="cpoerschke" created="Tue, 12 Nov 2019 10:05:07 +0000"  >&lt;p&gt;Unassigning the ticket to try and make it clearer that it&apos;s fully up-for-grabs (and that I&apos;m unlikely to have bandwidth for it in the foreseeable future, sorry).&lt;/p&gt;</comment>
                            <comment id="17106309" author="lucenesolrqa" created="Wed, 13 May 2020 13:33:16 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; patch &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;  0m 16s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt; does not apply to master. Rebase required? Wrong Branch? See &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&lt;/a&gt; for help. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6203&quot; title=&quot;cast exception while searching with sort function and result grouping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6203&quot;&gt;SOLR-6203&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12978434/SOLR-6203.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12978434/SOLR-6203.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/746/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/746/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13137358">SOLR-11961</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13011474">SOLR-9627</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13013233">SOLR-9660</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13021948">SOLR-9783</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13030417">SOLR-9890</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13060443">SOLR-10394</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13086009">SOLR-11042</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13070872">SOLR-10659</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12764794" name="README" size="3745" author="Judith" created="Fri, 2 Oct 2015 17:22:27 +0000"/>
                            <attachment id="12833977" name="SOLR-6203-unittest.patch" size="1190" author="cpoerschke" created="Tue, 18 Oct 2016 16:19:36 +0000"/>
                            <attachment id="12652515" name="SOLR-6203-unittest.patch" size="1056" author="nated" created="Wed, 25 Jun 2014 23:14:14 +0000"/>
                            <attachment id="12978434" name="SOLR-6203.patch" size="37260" author="cpoerschke" created="Fri, 23 Aug 2019 17:36:38 +0000"/>
                            <attachment id="12863697" name="SOLR-6203.patch" size="64920" author="Judith" created="Mon, 17 Apr 2017 22:46:10 +0000"/>
                            <attachment id="12860363" name="SOLR-6203.patch" size="13019" author="Judith" created="Fri, 24 Mar 2017 14:49:49 +0000"/>
                            <attachment id="12841838" name="SOLR-6203.patch" size="48937" author="Judith" created="Mon, 5 Dec 2016 23:04:35 +0000"/>
                            <attachment id="12841569" name="SOLR-6203.patch" size="8243" author="Judith" created="Fri, 2 Dec 2016 22:06:45 +0000"/>
                            <attachment id="12841225" name="SOLR-6203.patch" size="37217" author="Judith" created="Thu, 1 Dec 2016 05:30:50 +0000"/>
                            <attachment id="12841221" name="SOLR-6203.patch" size="16624" author="Judith" created="Thu, 1 Dec 2016 04:53:52 +0000"/>
                            <attachment id="12841108" name="SOLR-6203.patch" size="21479" author="Judith" created="Wed, 30 Nov 2016 19:39:58 +0000"/>
                            <attachment id="12764795" name="SOLR-6203.patch" size="119987" author="Judith" created="Fri, 2 Oct 2015 17:22:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401921</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x6if:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401989</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>