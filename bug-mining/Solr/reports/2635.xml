<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:07:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6547] CloudSolrServer query getqtime Exception</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6547</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We are using CloudSolrServer to query ,but solrj throw Exception ;&lt;br/&gt;
java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.Integer 	at org.apache.solr.client.solrj.response.SolrResponseBase.getQTime(SolrResponseBase.java:76)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12743071">SOLR-6547</key>
            <summary>CloudSolrServer query getqtime Exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="kevinchen">kevin</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Sep 2014 02:55:36 +0000</created>
                <updated>Mon, 9 May 2016 18:44:30 +0000</updated>
                            <resolved>Wed, 16 Sep 2015 07:20:07 +0000</resolved>
                                    <version>4.10</version>
                    <version>5.3</version>
                                    <fixVersion>5.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14174699" author="anuragsharma" created="Fri, 17 Oct 2014 03:50:49 +0000"  >&lt;p&gt;Can you mention the exact query it will become easy to investigate/reproduce&lt;/p&gt;</comment>
                            <comment id="14174776" author="hossman" created="Fri, 17 Oct 2014 06:38:31 +0000"  >&lt;p&gt;i suspect this has something to do with the code in CloudSolrServer.condenseResponse ?&lt;/p&gt;

&lt;p&gt;I honestly have no idea what that method is for or what it&apos;s doing, but a quick grep suggests that&apos;s the only place in the code base where a &quot;long&quot; value is getting assocaited with &quot;QTime&quot;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;CloudSolrServer.condenseResponse should be fixed to use an int for QTime&lt;/li&gt;
	&lt;li&gt;SolrResponseBase.getQTime can (and probably should) be hardended to do something like this instead of just a direct Integer cast...
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ((&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;) header.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;)).intValue()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;...that kind of pattern can help protect us in the future if we decide that QTime &lt;b&gt;should&lt;/b&gt; be a long&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14175867" author="anuragsharma" created="Sat, 18 Oct 2014 05:39:46 +0000"  >&lt;p&gt;Hi Hoss,&lt;/p&gt;

&lt;p&gt;Thanks for your update. &lt;/p&gt;

&lt;p&gt;Time is usually returned as long value. Since getQTime returns, int looks like the interest is to return value in seconds and not milliseconds. &lt;/p&gt;

&lt;p&gt;I agree with your suggestion to change the return type to either long or use intValue while returning in the current method.&lt;/p&gt;

&lt;p&gt;Is there a way I can reproduce the java.lang.ClassCastException mentioned in the description?&lt;br/&gt;
Kevin - Any suggestion?&lt;/p&gt;

&lt;p&gt;Anurag&lt;/p&gt;</comment>
                            <comment id="14175888" author="elyograg" created="Sat, 18 Oct 2014 06:40:34 +0000"  >&lt;p&gt;There&apos;s merit either way.&lt;/p&gt;

&lt;p&gt;Integer.MAX_VALUE in milliseconds is a little more than 24 days.  I doubt you would ever run into a query that would actually take that long and still have enough resources to actually finish, so an int has plenty of capacity to handle QTime.  The difference is tiny for a single value, but a long does take up twice as much memory.  If most of the existing code uses an int, I am inclined to stick with that and change the deviating code.&lt;/p&gt;

&lt;p&gt;On the other hand ... everything else related to time in Java &lt;b&gt;is&lt;/b&gt; represented as a long, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anuragsharma&quot; class=&quot;user-hover&quot; rel=&quot;anuragsharma&quot;&gt;anuragsharma&lt;/a&gt; mentioned.  If the value is ever used for calculation with any of those other numbers, it might save a tiny bit of CPU time if Java doesn&apos;t have to convert.&lt;/p&gt;

&lt;p&gt;Switching everything to a long is likely to involve quite a bit of effort to locate and change every place that it&apos;s used, which is a big part of why I suggest sticking with int.  I don&apos;t think we would ever &lt;b&gt;need&lt;/b&gt; a long for relative times.&lt;/p&gt;</comment>
                            <comment id="14175969" author="anuragsharma" created="Sat, 18 Oct 2014 12:04:13 +0000"  >&lt;p&gt;I am not sure of the usage. If there is a use case to calculate the response time then long would be precise to respond the query time in millisecond. With int the millisecond detail is missed.&lt;/p&gt;</comment>
                            <comment id="14176006" author="elyograg" created="Sat, 18 Oct 2014 14:05:41 +0000"  >&lt;p&gt;QTime is always in milliseconds, no matter what size the primitive datatype is.  The maximum value of a signed integer is 2147483647.  In seconds, this is about 68 years &amp;#8211; the UNIX epoch is the beginning of 1970, and the 32-bit signed counter will run out in 2038.  In milliseconds, this number is only 24 days.&lt;/p&gt;</comment>
                            <comment id="14176048" author="anuragsharma" created="Sat, 18 Oct 2014 16:05:02 +0000"  >&lt;p&gt;Based on the above comment we are good to go with Hoss Mann comment to extract the intValue from long:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ((&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;) header.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;)).intValue()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A couple of failing unit tests can help in fixing and creating the patch. &lt;/p&gt;</comment>
                            <comment id="14184481" author="anuragsharma" created="Sun, 26 Oct 2014 13:27:54 +0000"  >&lt;p&gt;QTime is saved as long after truncating nano second part of time. This is equivalent to capturing the time in milliseconds. Here is the code snippet of what&apos;s happening in the CloudSolrServer. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; start = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime();
.
.
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; end = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime();
RouteResponse rr =  condenseResponse(shardResponses, (&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)((end - start)/1000000));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;condenseResponse function&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; RouteResponse condenseResponse(NamedList response, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeMillis) {
  .
  .
  cheader.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;, timeMillis);
  .
  .
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since the time in seconds can be captured with Integer, there are two ways to fix the issue:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;In CloudSolrServer, truncate the milliseconds part as well and save QTime in Integer. This way getQTime won&apos;t throw Long to Integer ClassCastException as the object coming to it already Integer.&lt;/li&gt;
	&lt;li&gt;In SolrResponseBase.getQTime function, check the instanceOf Object and get integer from it as shown in the code snippet below
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; qtime = 0;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(obj &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;) {
        	qtime = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)(((&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;) obj).longValue()/1000);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obj &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;) {
        	qtime = (&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;)obj;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obj &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) {
        	qtime = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) obj);        	
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; qtime;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Please vote for proceeding the best approach. Also like to get opinion on writing unit test in CloudSolrServerTest class.&lt;/p&gt;</comment>
                            <comment id="14213698" author="anuragsharma" created="Sat, 15 Nov 2014 17:11:59 +0000"  >&lt;p&gt;Fix using #2 approach, without UT.&lt;/p&gt;</comment>
                            <comment id="14226153" author="noble.paul" created="Wed, 26 Nov 2014 13:09:49 +0000"  >&lt;p&gt;no need to check for string etc.&lt;/p&gt;

&lt;p&gt;Is it possible to get a testcase for this?&lt;/p&gt;</comment>
                            <comment id="14747011" author="shalinmangar" created="Wed, 16 Sep 2015 07:00:32 +0000"  >&lt;p&gt;Test + fix. I&apos;ll commit shortly.&lt;/p&gt;</comment>
                            <comment id="14747027" author="jira-bot" created="Wed, 16 Sep 2015 07:06:24 +0000"  >&lt;p&gt;Commit 1703335 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1703335&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1703335&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6547&quot; title=&quot;CloudSolrServer query getqtime Exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6547&quot;&gt;&lt;del&gt;SOLR-6547&lt;/del&gt;&lt;/a&gt;: ClassCastException in SolrResponseBase.getQTime&lt;/p&gt;</comment>
                            <comment id="14747061" author="jira-bot" created="Wed, 16 Sep 2015 07:19:07 +0000"  >&lt;p&gt;Commit 1703343 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1703343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1703343&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6547&quot; title=&quot;CloudSolrServer query getqtime Exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6547&quot;&gt;&lt;del&gt;SOLR-6547&lt;/del&gt;&lt;/a&gt;: ClassCastException in SolrResponseBase.getQTime&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12756182" name="SOLR-6547.patch" size="5132" author="shalin" created="Wed, 16 Sep 2015 07:00:32 +0000"/>
                            <attachment id="12683838" name="SOLR-6547.patch" size="845" author="noble.paul" created="Wed, 26 Nov 2014 13:09:49 +0000"/>
                            <attachment id="12681752" name="SOLR-6547.patch" size="1022" author="anuragsharma" created="Sat, 15 Nov 2014 17:11:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20be7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>