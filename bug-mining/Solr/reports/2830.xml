<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:11:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8190] Implement Closeable on TupleStream</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8190</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Implementing Closeable on TupleStream provides the ability to use try-with-resources (&lt;a href=&quot;https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html&lt;/a&gt;) in tests and in practice. This prevents TupleStreams from being left open when there is an error in the tests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12907415">SOLR-8190</key>
            <summary>Implement Closeable on TupleStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="jbernste">Joel Bernstein</assignee>
                                    <reporter username="krisden">Kevin Risden</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Oct 2015 14:19:23 +0000</created>
                <updated>Tue, 8 Oct 2019 14:51:26 +0000</updated>
                            <resolved>Thu, 11 Feb 2016 17:41:56 +0000</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14971072" author="risdenk" created="Fri, 23 Oct 2015 14:26:01 +0000"  >&lt;p&gt;Found that CloudSolrStream yields two NullPointerExceptions when being closed during tests for solrStreams and cloudSolrClient being null. Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8191&quot; title=&quot;Guard against CloudSolrStream close method NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8191&quot;&gt;&lt;del&gt;SOLR-8191&lt;/del&gt;&lt;/a&gt; to address it.&lt;/p&gt;</comment>
                            <comment id="14971077" author="risdenk" created="Fri, 23 Oct 2015 14:29:59 +0000"  >&lt;p&gt;Fixed stream tests to use assertEquals methods instead of assertTrue(boolean condition) since most of the conditions were for equals. &lt;/p&gt;</comment>
                            <comment id="15059187" author="gerlowskija" created="Wed, 16 Dec 2015 00:22:21 +0000"  >&lt;p&gt;Would be nice to get this rolling again.  To keep it up to date, I&apos;ve updated the patch to apply cleanly off of trunk.&lt;/p&gt;

&lt;p&gt;Tests still fail due to the NPE addressed in the (unresolved) &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8091&quot; title=&quot;Solr Website Fails WCAG Contrast Ratio&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8091&quot;&gt;&lt;del&gt;SOLR-8091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15060019" author="risdenk" created="Wed, 16 Dec 2015 14:13:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt; Thanks for taking a look. I think the above JIRA should have been &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8191&quot; title=&quot;Guard against CloudSolrStream close method NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8191&quot;&gt;&lt;del&gt;SOLR-8191&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15060966" author="joel.bernstein" created="Wed, 16 Dec 2015 21:55:41 +0000"  >&lt;p&gt;Gave this a quick review. I like the idea of implementing closable, but in this case close() would get called twice for each test.&lt;/p&gt;

&lt;p&gt;Maybe the better approach is to call close() in the finally block of the methods that call open(). &lt;/p&gt;</comment>
                            <comment id="15061076" author="risdenk" created="Wed, 16 Dec 2015 23:02:32 +0000"  >&lt;p&gt;The getTuples method was added recently which is the only place that open/close is called. This is where the try w/ resources should go instead of wrapping each test. I&apos;ll update the patch with changes. This should make the patch a lot simpler. While investigating this I found that there are now two new NPE issues w/ FacetStream and StatsStream with the same type cause as in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8191&quot; title=&quot;Guard against CloudSolrStream close method NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8191&quot;&gt;&lt;del&gt;SOLR-8191&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15061362" author="gerlowskija" created="Thu, 17 Dec 2015 02:40:58 +0000"  >&lt;p&gt;+1 for pushing the try-with-resources into the &lt;tt&gt;getTuples&lt;/tt&gt; method.  I was considering this when I updated the patch, but I didn&apos;t want to step on any toes (especially since I&apos;m not super familiar the code) so I just left as-is.&lt;/p&gt;

&lt;p&gt;Should really shrink the patch too, which is a nice plus.&lt;/p&gt;</comment>
                            <comment id="15062152" author="risdenk" created="Thu, 17 Dec 2015 14:58:23 +0000"  >&lt;p&gt;So I put more thought into this last night and since TupleStream has an open method it makes try-with-resources not really applicable. In the case here, it will call close twice as implemented. try-with-resources can&apos;t be pushed into getTuples since try-with-resources doesn&apos;t work with a open method.&lt;/p&gt;

&lt;p&gt;Thinking about this brought up the following thoughts:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;What should happen when open is called twice?&lt;/li&gt;
	&lt;li&gt;What should happen when close is called twice?&lt;/li&gt;
	&lt;li&gt;What should happen when close is called without open being called?&lt;/li&gt;
	&lt;li&gt;Are there places in the code where open/close is called without a try/finally? Will that cause issues?&lt;/li&gt;
	&lt;li&gt;Are there places in the code where TupleStream.open is called without a related close call?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There are no checks currently to see if a stream has already been opened or closed. This is what is causing the different NPE exceptions like in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8191&quot; title=&quot;Guard against CloudSolrStream close method NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8191&quot;&gt;&lt;del&gt;SOLR-8191&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For this ticket, I think just implementing Closeable on TupleStream and not changing the tests is appropriate. The above items should be addressed though. This will make the patch smaller and the tests can be improved in followup JIRAS.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt; - Thoughts on the above?&lt;/p&gt;</comment>
                            <comment id="15062376" author="joel.bernstein" created="Thu, 17 Dec 2015 17:23:43 +0000"  >&lt;p&gt;The /stream and /sql handler should be calling open() and close() in the majority of situations. There are also situations where the Streams themselves may open() and close() internal streams. For example the hashJoin stream may open a stream read it into a hashtable and then close the stream. &lt;/p&gt;

&lt;p&gt;But if people want to work directly with the Streaming API, rather the sending a Streaming Expression to the /stream handler, it would be nice to add some robustness to how open and close are handled. Probably we should through exceptions in the first three cases you mention.&lt;/p&gt;</comment>
                            <comment id="15062818" author="gerlowskija" created="Thu, 17 Dec 2015 21:07:23 +0000"  >&lt;p&gt;Yeah, I guess it doesn&apos;t make a ton of sense to push try-with-finally when it doesn&apos;t really work with {{TupleStream}}s API.&lt;/p&gt;

&lt;p&gt;I agree with you and Joel, it makes sense to catch these special cases and throw an &lt;tt&gt;IllegalStateException&lt;/tt&gt; or something similar.&lt;/p&gt;</comment>
                            <comment id="15087816" author="risdenk" created="Thu, 7 Jan 2016 18:23:16 +0000"  >&lt;p&gt;Added simple patch for just implementing Closeable on TupleStream.&lt;/p&gt;</comment>
                            <comment id="15137766" author="risdenk" created="Mon, 8 Feb 2016 21:50:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; - Can the latest simple patch be reviewed?&lt;/p&gt;</comment>
                            <comment id="15143128" author="jira-bot" created="Thu, 11 Feb 2016 17:41:25 +0000"  >&lt;p&gt;Commit 739b81063eb9045b4686ce8ad702c61451503306 in lucene-solr&apos;s branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=739b810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=739b810&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8190&quot; title=&quot;Implement Closeable on TupleStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8190&quot;&gt;&lt;del&gt;SOLR-8190&lt;/del&gt;&lt;/a&gt;: Implement Closeable on TupleStream&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12907420">SOLR-8191</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12781018" name="SOLR-8190.patch" size="1075" author="krisden" created="Thu, 7 Jan 2016 18:23:16 +0000"/>
                            <attachment id="12777869" name="SOLR-8190.patch" size="52556" author="gerlowskija" created="Wed, 16 Dec 2015 00:22:21 +0000"/>
                            <attachment id="12768303" name="SOLR-8190.patch" size="56197" author="krisden" created="Fri, 23 Oct 2015 14:30:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nfrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>