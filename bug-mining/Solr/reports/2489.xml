<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:05:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7625] Version bucket seed not updated after new index is installed on a replica</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7625</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7332&quot; title=&quot;Seed version buckets with max version from index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7332&quot;&gt;&lt;del&gt;SOLR-7332&lt;/del&gt;&lt;/a&gt; ... I used to set the highest value on the version buckets based on a lookup to the index whenever a firstSearcher event fired, but that led to reentrant lock issues (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7587&quot; title=&quot;TestSpellCheckResponse stalled and never timed out -- possible VersionBucket bug? (5.2 branch)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7587&quot;&gt;&lt;del&gt;SOLR-7587&lt;/del&gt;&lt;/a&gt;), so I moved that version seeding code into the SolrCore constructor.&lt;/p&gt;

&lt;p&gt;While working on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4506&quot; title=&quot;[solr4.0.0] many index.{date} dir in replication node &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4506&quot;&gt;&lt;del&gt;SOLR-4506&lt;/del&gt;&lt;/a&gt;, I just realized that if a core has to pull index files from the leader to recover, then the version bucket doesn&apos;t get updated once the new index files are pulled over. In other words, the code seeds the version buckets during core init, but if the underlying index changes due to being too far out-of-date, then the version buckets are never updated once the new index is in place. The risk is that if bucket versions are seeded with a value that is too low, then it can lead to correctness issues with versioned updates.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12834743">SOLR-7625</key>
            <summary>Version bucket seed not updated after new index is installed on a replica</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thelabdude">Timothy Potter</assignee>
                                    <reporter username="thelabdude">Timothy Potter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jun 2015 17:42:42 +0000</created>
                <updated>Mon, 9 May 2016 18:51:04 +0000</updated>
                            <resolved>Tue, 2 Jun 2015 20:32:44 +0000</resolved>
                                    <version>5.2</version>
                                    <fixVersion>5.2</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14569482" author="anshumg" created="Tue, 2 Jun 2015 17:45:11 +0000"  >&lt;p&gt;Good we found this just in time! I&apos;ll hold on and also fix other minor issues.&lt;/p&gt;</comment>
                            <comment id="14569614" author="thelabdude" created="Tue, 2 Jun 2015 19:32:53 +0000"  >&lt;p&gt;Here&apos;s a patch that addresses this issue. The key part of the fix is in RecoveryStrategy where it will call &lt;tt&gt;core.seedVersionBuckets()&lt;/tt&gt; after recovery is successful if the tlog wasn&apos;t replayed; if the tlog was replayed, then the version buckets are already updated as part of the replay process. So this patch catches the problem where no replay happens, but the underlying index still gets updated (usually by downloading a new index dir from the leader).&lt;/p&gt;

&lt;p&gt;For now, I had to infuse a test for this into the HttpPartitionTest because I need a replica to go into recovery to verify that that version bucket max is updated after recovery succeeds.&lt;/p&gt;

&lt;p&gt;All tests pass on trunk with this patch applied.&lt;/p&gt;</comment>
                            <comment id="14569668" author="anshumg" created="Tue, 2 Jun 2015 20:09:08 +0000"  >&lt;p&gt;Did a quick review. LGTM. +1.&lt;/p&gt;</comment>
                            <comment id="14569676" author="jira-bot" created="Tue, 2 Jun 2015 20:15:17 +0000"  >&lt;p&gt;Commit 1683174 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1683174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1683174&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7625&quot; title=&quot;Version bucket seed not updated after new index is installed on a replica&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7625&quot;&gt;&lt;del&gt;SOLR-7625&lt;/del&gt;&lt;/a&gt;: Ensure that the max value for seeding version buckets is updated after recovery even if the UpdateLog is not replayed.&lt;/p&gt;</comment>
                            <comment id="14569679" author="jira-bot" created="Tue, 2 Jun 2015 20:15:50 +0000"  >&lt;p&gt;Commit 1683175 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1683175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1683175&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7625&quot; title=&quot;Version bucket seed not updated after new index is installed on a replica&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7625&quot;&gt;&lt;del&gt;SOLR-7625&lt;/del&gt;&lt;/a&gt;: Ensure that the max value for seeding version buckets is updated after recovery even if the UpdateLog is not replayed.&lt;/p&gt;</comment>
                            <comment id="14569698" author="jira-bot" created="Tue, 2 Jun 2015 20:30:38 +0000"  >&lt;p&gt;Commit 1683177 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_2&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1683177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1683177&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7625&quot; title=&quot;Version bucket seed not updated after new index is installed on a replica&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7625&quot;&gt;&lt;del&gt;SOLR-7625&lt;/del&gt;&lt;/a&gt;: Ensure that the max value for seeding version buckets is updated after recovery even if the UpdateLog is not replayed.&lt;/p&gt;</comment>
                            <comment id="14586860" author="anshumg" created="Mon, 15 Jun 2015 21:43:34 +0000"  >&lt;p&gt;Bulk close for 5.2.0.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12787165">SOLR-7332</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12832318">SOLR-7587</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12736990" name="SOLR-7625.patch" size="7436" author="thelabdude" created="Tue, 2 Jun 2015 19:32:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fiyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>