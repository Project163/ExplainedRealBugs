<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:00:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6643] Core load silently aborted if missing schema has depenencies - LinkageErrors swollowed</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6643</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;b&gt;How to reproduce&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Start with standard collection1 config&lt;/li&gt;
	&lt;li&gt;Add a field type to schema using the ICU contrib, no need for a field
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;text_icu&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;analyzer&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.ICUTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/analyzer&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/fieldType&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;cd example&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;mkdir solr/lib&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;cp ../contrib/analysis-extras/lucene-libs/lucene-analyzers-icu-4.10.1.jar solr/lib/&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;bin/solr -f&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Core is not loaded, and no messages in log after this line
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;... INFO  org.apache.solr.schema.IndexSchema  &#8211; [collection1] Schema name=example
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Note that we did &lt;b&gt;not&lt;/b&gt; add the dependency libs from &lt;tt&gt;analysis-extras/lib&lt;/tt&gt;, so we&apos;d expect a &lt;tt&gt;ClassNotFoundException&lt;/tt&gt;, but some way the initialization of schema aborts silently. The ICUTokenizerFactory is instansiated by reflection and I suspect that some exception is swallowed in &lt;tt&gt;AbstractPluginLoader#create()&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12749776">SOLR-6643</key>
            <summary>Core load silently aborted if missing schema has depenencies - LinkageErrors swollowed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                            <label>logging</label>
                    </labels>
                <created>Wed, 22 Oct 2014 13:48:24 +0000</created>
                <updated>Mon, 9 May 2016 18:54:37 +0000</updated>
                            <resolved>Thu, 8 Jan 2015 19:53:56 +0000</resolved>
                                    <version>4.10.1</version>
                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14207830" author="janhoy" created="Wed, 12 Nov 2014 08:51:44 +0000"  >&lt;p&gt;Any ideas for how to solve this?&lt;/p&gt;</comment>
                            <comment id="14254378" author="hossman" created="Sat, 20 Dec 2014 00:50:40 +0000"  >&lt;p&gt;I was able to reproduce Jan&apos;s steps, and then while trying again using core CREATE instead of relying on startup, was able to get an error returned to the client indicating the root cause of the problem...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NoClassDefFoundError: com/ibm/icu/text/BreakIterator
	at java.lang.Class.getDeclaredConstructors0(Native Method)
	at java.lang.Class.privateGetDeclaredConstructors(Class.java:2663)
	at java.lang.Class.getConstructor0(Class.java:3067)
	at java.lang.Class.getConstructor(Class.java:1817)
	at org.apache.solr.core.SolrResourceLoader.newInstance(SolrResourceLoader.java:604)
	at org.apache.solr.schema.FieldTypePluginLoader$2.create(FieldTypePluginLoader.java:333)
	at org.apache.solr.schema.FieldTypePluginLoader$2.create(FieldTypePluginLoader.java:326)
	at org.apache.solr.util.plugin.AbstractPluginLoader.load(AbstractPluginLoader.java:151)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...which kind of makes sense: nothing in the plugin architetcure does much in the way of &quot;catching&quot; LinkageError&apos;s like NoClassDefFoundError because in general trying ot catch Error&apos;s is usually a bad idea.&lt;/p&gt;

&lt;p&gt;i think however that it would make sense for SolrResourceLoader to at least catch+log+rethrow any error from newInstance&lt;/p&gt;

&lt;p&gt;that still leaves a second question however: the NoClassDefFoundError should (currently) be bubbling all the way up to the CoreContainer which should then be recording it as an init failure for the core &amp;#8211; but that isn&apos;t happening.  why?&lt;/p&gt;

&lt;p&gt;based on my testing, if a java.lang.Error is thrown during init of something like RequestHandler, then that gets properly tracked as a coreInitFailure &amp;#8211; but if something from the schema (ie: FieldType) throws a j.l.Error, that gets swallowed up.&lt;/p&gt;</comment>
                            <comment id="14254379" author="hossman" created="Sat, 20 Dec 2014 00:51:45 +0000"  >&lt;p&gt;Here&apos;s a patch that does a few things:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;adds 2 tests to CoreContainerCoreInitFailuresTest
	&lt;ul&gt;
		&lt;li&gt;testJavaLangErrorFromHandlerOnStartup demonstrates that a new ThrowErrorOnInitRequestHandler causes a correctly tracked coreInitFailure&lt;/li&gt;
		&lt;li&gt;testJavaLangErrorFromSchemaOnStartup demonstrates that a new ThrowErrorOnInitFieldType causes a correctly tracked coreInitFailure
		&lt;ul&gt;
			&lt;li&gt;this test currently fails&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;SolrResourceLoader...
	&lt;ul&gt;
		&lt;li&gt;now logs &amp;amp; re-throws any execptions&lt;/li&gt;
		&lt;li&gt;has some refactoring to remove copy/paste code
		&lt;ul&gt;
			&lt;li&gt;nocommits noted here until more agressive testing is done.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I still don&apos;t understand why testJavaLangErrorFromSchemaOnStartup, and i won&apos;t have much time to work on it in the near future &amp;#8211; but it may be a good idea to commit this patch as is with an &lt;tt&gt;@Ignore&lt;/tt&gt; on that test linking to a new spin-off issue &amp;#8211; so that we can at least get te SolrResourceLoader logging in place for people who run into problems like this .&lt;/p&gt;
</comment>
                            <comment id="14254966" author="romseygeek" created="Sat, 20 Dec 2014 22:04:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;but that isn&apos;t happening. why?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it&apos;s because CoreContainer.create() is catching Exceptions, not Errors, when updating the coreInitFailure map.  Maybe the best solution is for SolrResourceLoader to try and catch LinkageErrors and rethrow it as a SolrException.  Catching classloader problems is I think within the resource loader&apos;s remit (unlike out of memory errors, etc).&lt;/p&gt;</comment>
                            <comment id="14268399" author="hossman" created="Wed, 7 Jan 2015 22:28:49 +0000"  >
&lt;blockquote&gt;&lt;p&gt;I think it&apos;s because CoreContainer.create() is catching Exceptions, not Errors, when updating the coreInitFailure map. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure - but the piece i couldn&apos;t make sense of is why/where testJavaLangErrorFromHandlerOnStartup passed (and those Errors ere in coreInitFailures) but testJavaLangErrorFromSchemaOnStartup didn&apos;t.&lt;/p&gt;

&lt;p&gt;digging arround a bit more, it looks like this is because SolrCore() is wrapping &lt;em&gt;some&lt;/em&gt; types of Throwable in SolrException (shudder) but the IndexSchema already exists before the SolreCore constructor is called, and any Errors that come from it don&apos;t get similar wrapping.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe the best solution is for SolrResourceLoader to try and catch LinkageErrors and rethrow it as a SolrException. Catching classloader problems is I think within the resource loader&apos;s remit (unlike out of memory errors, etc).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;maybe - but that&apos;s a slippery slope i&apos;d rather avoid &amp;#8211; i&apos;m catching &amp;amp; re-throwing Errors is one thing, &lt;b&gt;wrapping&lt;/b&gt; Errors in Exceptions is something i&apos;m very much not a fan of.&lt;/p&gt;

&lt;p&gt;i think a safer (and more all encompasing) fix would be for CoreContainer to handle wraping Errors in SolrException - not for the purpose of re-throwing, but just for tracking in coreInitFailures.  that way even for things like OOM or IOError during core init, we still have a note about it in coreInitFailures.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;Attaching an updated patch that goes this direction - still running tests, but review/comments appreciated&lt;/p&gt;</comment>
                            <comment id="14269834" author="jira-bot" created="Thu, 8 Jan 2015 18:38:58 +0000"  >&lt;p&gt;Commit 1650350 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1650350&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1650350&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6643&quot; title=&quot;Core load silently aborted if missing schema has depenencies - LinkageErrors swollowed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6643&quot;&gt;&lt;del&gt;SOLR-6643&lt;/del&gt;&lt;/a&gt;: Fix error reporting &amp;amp; logging of low level JVM Errors that occur when loading/reloading a SolrCore&lt;/p&gt;</comment>
                            <comment id="14269951" author="jira-bot" created="Thu, 8 Jan 2015 19:52:58 +0000"  >&lt;p&gt;Commit 1650367 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1650367&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1650367&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6643&quot; title=&quot;Core load silently aborted if missing schema has depenencies - LinkageErrors swollowed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6643&quot;&gt;&lt;del&gt;SOLR-6643&lt;/del&gt;&lt;/a&gt;: Fix error reporting &amp;amp; logging of low level JVM Errors that occur when loading/reloading a SolrCore (merge r1650350)&lt;/p&gt;</comment>
                            <comment id="14332815" author="anshumg" created="Mon, 23 Feb 2015 05:02:04 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12690642" name="SOLR-6643.patch" size="15943" author="hossman" created="Wed, 7 Jan 2015 22:28:49 +0000"/>
                            <attachment id="12688475" name="SOLR-6643.patch" size="16636" author="hossman" created="Sat, 20 Dec 2014 00:51:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21g53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>