<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:26:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2983] Unable to load custom MergePolicy</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2983</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As part of a recent upgrade to Solr 3.5.0 we encountered an error related to our use of LinkedIn&apos;s ZoieMergePolicy.&lt;/p&gt;

&lt;p&gt;It seems the code that loads a custom MergePolicy was at some point moved into SolrIndexConfig.java from SolrIndexWriter.java, but as this code was copied verbatim it now contains a bug:&lt;/p&gt;

&lt;p&gt;    try {&lt;br/&gt;
      policy = (MergePolicy) schema.getResourceLoader().newInstance(mpClassName, null, new Class[]&lt;/p&gt;
{IndexWriter.class}
&lt;p&gt;, new Object[]&lt;/p&gt;
{this}
&lt;p&gt;);&lt;br/&gt;
    } catch (Exception e) &lt;/p&gt;
{
      policy = (MergePolicy) schema.getResourceLoader().newInstance(mpClassName);
    }

&lt;p&gt;&apos;this&apos; is no longer an IndexWriter but a SolrIndexConfig, therefore the call to newInstance will always throw an exception and the catch clause will be executed. If the custom MergePolicy does not have a default constructor (which is the case of ZoieMergePolicy), the second attempt to create the MergePolicy will also fail and Solr won&apos;t start.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535984">SOLR-2983</key>
            <summary>Unable to load custom MergePolicy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="teofili">Tommaso Teofili</assignee>
                                    <reporter username="herberts">Mathias Herberts</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Dec 2011 10:39:02 +0000</created>
                <updated>Fri, 10 May 2013 10:40:50 +0000</updated>
                            <resolved>Thu, 29 Mar 2012 10:00:45 +0000</resolved>
                                                    <fixVersion>3.6</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13185703" author="hossman" created="Fri, 13 Jan 2012 17:55:44 +0000"  >&lt;p&gt;this seems like a really silly and anoying mistake in 3.5 ... we clearly need better tests using mock MergePolicies.&lt;/p&gt;

&lt;p&gt;herbert: do you have a patch to fix the init code?&lt;/p&gt;</comment>
                            <comment id="13187535" author="herberts" created="Tue, 17 Jan 2012 08:53:43 +0000"  >&lt;p&gt;IIRC the IndexWriter is not available in SolrIndexConfig, so I don&apos;t have an easy fix.&lt;/p&gt;</comment>
                            <comment id="13187733" author="teofili" created="Tue, 17 Jan 2012 15:03:31 +0000"  >&lt;p&gt;it looks like it&apos;s a cyclic dependency problem since the SolrIndexWriter uses the SolrIndexConfig.toIndexWriterConfig method to create an IndexWriterConfig which is used to call the basic Lucene IndexWriter constructor while at the same time the SolrIndexConfig.toIndexWriterConfig may need an IndexWriter to instantiate the MergePolicy (try clause).&lt;/p&gt;</comment>
                            <comment id="13187741" author="simonw" created="Tue, 17 Jan 2012 15:12:54 +0000"  >&lt;p&gt;honestly expecting IW in the ctor is bogus. IndexWriter passes itself to the mergePolicy in MergePolicy#setIndexWriter() and we should really keep it that way. the fix here is to not give the option to pass IW to the MP in the ctor.&lt;/p&gt;</comment>
                            <comment id="13187762" author="teofili" created="Tue, 17 Jan 2012 15:44:14 +0000"  >&lt;p&gt;that probably depends on migrations from old APIs, however, apart from that, I agree the setter (and SetOnce) facilities are the best way to inject an IW in the mergePolicy.&lt;br/&gt;
Therefore the above try/catch clause has little meaning and IMHO it may be better to just keep the policy instantiation like this:&lt;/p&gt;

&lt;p&gt;MergePolicy policy = (MergePolicy) schema.getResourceLoader().newInstance(mpClassName);&lt;/p&gt;
</comment>
                            <comment id="13187806" author="teofili" created="Tue, 17 Jan 2012 17:12:25 +0000"  >&lt;p&gt;simple patch which just removes the (always failing) try clause, adding unit tests for a bad merge policy sample&lt;/p&gt;</comment>
                            <comment id="13187968" author="simonw" created="Tue, 17 Jan 2012 20:22:28 +0000"  >&lt;p&gt;I agree we should just get rid of it. I think this deserves a CHANGES.TXT entry. &lt;/p&gt;</comment>
                            <comment id="13190500" author="simonw" created="Sat, 21 Jan 2012 18:28:12 +0000"  >&lt;p&gt;tomasso can you update changes.txt too. once this is done I can just commit it, thanks!&lt;/p&gt;</comment>
                            <comment id="13233639" author="hossman" created="Tue, 20 Mar 2012 18:09:34 +0000"  >&lt;p&gt;Tomas: as simon said, this patch looks good provided we have a blurb about the change in the upgrade/backcompat section.&lt;/p&gt;

&lt;p&gt;wanna go ahead an commit for 3.6?&lt;/p&gt;

&lt;p&gt;(although: please remove that cut/paste comment about &quot;kitchen sink&quot; in your new bad-mp-solrconfig.xml)&lt;/p&gt;</comment>
                            <comment id="13233660" author="tomasflobbe" created="Tue, 20 Mar 2012 18:46:28 +0000"  >&lt;p&gt;I think it was assigned to the wrong person. Assigning it to Tommaso&lt;/p&gt;</comment>
                            <comment id="13233731" author="teofili" created="Tue, 20 Mar 2012 20:49:01 +0000"  >&lt;p&gt;Agreed, I&apos;m going to do the needed updates to changes.txt and upgrade/backcompat.&lt;/p&gt;</comment>
                            <comment id="13235413" author="teofili" created="Thu, 22 Mar 2012 07:14:09 +0000"  >&lt;p&gt;I just noticed also the toIndexWriter method should be explicitly tested, going to work on it and attach a new patch&lt;/p&gt;</comment>
                            <comment id="13236073" author="teofili" created="Thu, 22 Mar 2012 21:47:14 +0000"  >&lt;p&gt;new patch which adds the changes.txt entry and adds the toIndexWriterConfig() method (the one which caused the failures) testing&lt;/p&gt;</comment>
                            <comment id="13236111" author="teofili" created="Thu, 22 Mar 2012 22:21:59 +0000"  >&lt;p&gt;committed on trunk at r1304098&lt;/p&gt;</comment>
                            <comment id="13241049" author="teofili" created="Thu, 29 Mar 2012 07:31:10 +0000"  >&lt;p&gt;and merged to branch_3x on r1306733&lt;/p&gt;</comment>
                            <comment id="13241108" author="teofili" created="Thu, 29 Mar 2012 09:31:02 +0000"  >&lt;p&gt;SolrIndexConfigTest fails in 3x because the SolrIndexConfig constructor &quot;prefix&quot; parameter cannot be null&lt;/p&gt;</comment>
                            <comment id="13241124" author="teofili" created="Thu, 29 Mar 2012 10:00:46 +0000"  >&lt;p&gt;fixed issue with SolrIndexConfigTest in branch_3x&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12510857" name="SOLR-2983.patch" size="7568" author="teofili" created="Tue, 17 Jan 2012 17:12:25 +0000"/>
                            <attachment id="12519515" name="SOLR-2983_2.patch" size="8074" author="teofili" created="Thu, 22 Mar 2012 21:47:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221667</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03hef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>