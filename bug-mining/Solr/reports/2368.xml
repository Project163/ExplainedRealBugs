<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4044] CloudSolrServer early connect problems</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4044</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If you call CloudSolrServer.connect() after Zookeeper is up, but before clusterstate, etc. is populated, you will get &quot;No live SolrServer&quot; exceptions (line 322 in LBHttpSolrServer):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrServerException(&lt;span class=&quot;code-quote&quot;&gt;&quot;No live SolrServers available to handle &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; request&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;for all requests made even though all the Solr nodes are coming up just fine.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12615147">SOLR-4044</key>
            <summary>CloudSolrServer early connect problems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="gsingers">Grant Ingersoll</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Nov 2012 11:48:46 +0000</created>
                <updated>Mon, 9 May 2016 18:56:23 +0000</updated>
                            <resolved>Mon, 9 Mar 2015 10:33:55 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="13510718" author="gsingers" created="Wed, 5 Dec 2012 19:49:25 +0000"  >&lt;p&gt;I think this also happens even if connect is called via the process() method.  AFAICT, from reading the code, it is due to ZkStateReader being instantiated once in the connect string, but not really being notified if/when cores/collections are available b/c it doesn&apos;t have anything it can set watches on, yet, b/c Solr may not be ready yet.&lt;/p&gt;

&lt;p&gt;I will try to write up a test to see if I can reproduce this.&lt;/p&gt;</comment>
                            <comment id="13511428" author="yseeley@gmail.com" created="Thu, 6 Dec 2012 14:47:45 +0000"  >&lt;p&gt;Hmmm, so if I&apos;m understanding you correctly, if you start up the CloudSolrServer early, then even after the cluster is ready, the CloudSolrServer never sees it as ready.&lt;/p&gt;

&lt;p&gt;If the issue truly is in ZkStateReader, this may be an issue beyond CloudSolrServer and cause problems in the servers themselves?  Or perhaps the code that creates all the collection template stuff if none exists has been preventing this from being seen?&lt;/p&gt;

&lt;p&gt;If it looks like there is no clusterstate.json it seems like we should have an option to bail out immediately (with an appropriate error message).&lt;/p&gt;

&lt;p&gt;Do we also need a mode that waits and retries for a certain amount of time?&lt;/p&gt;</comment>
                            <comment id="13511432" author="markrmiller@gmail.com" created="Thu, 6 Dec 2012 14:53:03 +0000"  >&lt;p&gt;I think since a core or the overseer is not up yet, the nodes to watch are simply not there - a fix may be as simple as allowing the cloudsolrserver or zkstatereader to create the nodes it&apos;s expecting to watch if it doesn&apos;t find them.&lt;/p&gt;</comment>
                            <comment id="13511451" author="gsingers" created="Thu, 6 Dec 2012 15:20:01 +0000"  >&lt;p&gt;FWIW, my workaround is simply to catch the exception and to recreate a new CloudSolrServer and try again (with some backoff logic).&lt;/p&gt;</comment>
                            <comment id="13511452" author="gsingers" created="Thu, 6 Dec 2012 15:20:45 +0000"  >&lt;p&gt;Also, note, I&apos;m still working to confirm what is happening with a standalone test, but it may take me a bit.&lt;/p&gt;</comment>
                            <comment id="13511485" author="yseeley@gmail.com" created="Thu, 6 Dec 2012 16:04:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;a fix may be as simple as allowing the cloudsolrserver or zkstatereader to create the nodes it&apos;s expecting to watch if it doesn&apos;t find them.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A retry seems much safer... after all, someone could have given the wrong path.  Seems like clients should normally be read-only w.r.t. ZK.&lt;/p&gt;</comment>
                            <comment id="13511538" author="markrmiller@gmail.com" created="Thu, 6 Dec 2012 17:29:03 +0000"  >&lt;p&gt;Yeah, makes sense.&lt;/p&gt;</comment>
                            <comment id="13717417" author="steve_rowe" created="Tue, 23 Jul 2013 18:48:11 +0000"  >&lt;p&gt;Bulk move 4.4 issues to 4.5 and 5.0&lt;/p&gt;</comment>
                            <comment id="13971193" author="thetaphi" created="Wed, 16 Apr 2014 12:57:25 +0000"  >&lt;p&gt;Move issue to Solr 4.9.&lt;/p&gt;</comment>
                            <comment id="14060069" author="vzhovtiuk" created="Sun, 13 Jul 2014 10:13:02 +0000"  >&lt;p&gt;Added test to reproduce the issue&lt;/p&gt;</comment>
                            <comment id="14339947" author="romseygeek" created="Fri, 27 Feb 2015 09:44:24 +0000"  >&lt;p&gt;Moving the conversation over from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7146&quot; title=&quot;MiniSolrCloudCluster based tests can fail with ZooKeeperException NoNode for /live_nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7146&quot;&gt;&lt;del&gt;SOLR-7146&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Seems like clients should normally be read-only w.r.t. ZK.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This isn&apos;t the case at the moment - ZkStateReader.createClusterStateWatchersAndUpdate already calls ensureExists() on the aliases and clusterstate.json znodes.  I agree that it sounds like a good idea, though.&lt;/p&gt;

&lt;p&gt;Maybe a nicer way forward would be:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;throw a 503 SolrServerException if any of the watcher nodes don&apos;t exist in ZkStateReader when cCSWAU is called&lt;/li&gt;
	&lt;li&gt;add a sugar waitForCluster(timeout) method to CloudSolrClient that will repeatedly check zk for the relevant nodes&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also, if we want to really ensure that clients never actually change ZK, we could add a ReadOnlyZkClient that subclasses SolrZkClient and throws UOE on makePath() and setData(), and make CloudSolrClient use that.&lt;/p&gt;</comment>
                            <comment id="14340008" author="romseygeek" created="Fri, 27 Feb 2015 11:09:00 +0000"  >&lt;p&gt;Patch with test.  ZkStateReader doesn&apos;t try and create any nodes any more, and will throw an exception in createClusterStateWatchersAndUpdate if the relevant nodes aren&apos;t there.  Nodes are instead created in ZkController.&lt;/p&gt;</comment>
                            <comment id="14340342" author="romseygeek" created="Fri, 27 Feb 2015 16:21:44 +0000"  >&lt;p&gt;Better patch, with some fixes for OverseerTest and ZkStateWriterTest.  All tests pass.&lt;/p&gt;</comment>
                            <comment id="14347594" author="shalinmangar" created="Wed, 4 Mar 2015 21:28:37 +0000"  >&lt;p&gt;I am hesitant to introduce a method called waitForCluster. Can we overload connect with a boolean waitForCluster and timeout parameters instead?&lt;/p&gt;</comment>
                            <comment id="14351811" author="romseygeek" created="Sat, 7 Mar 2015 21:32:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can we overload connect with a boolean waitForCluster and timeout parameters instead?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s nicer.  No need for the boolean as the presence of timeout parameters implies that you&apos;re ready to wait.  Here&apos;s a patch.&lt;/p&gt;</comment>
                            <comment id="14351892" author="shalinmangar" created="Sun, 8 Mar 2015 04:36:15 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14352762" author="romseygeek" created="Mon, 9 Mar 2015 10:33:55 +0000"  >&lt;p&gt;Thanks everyone!&lt;/p&gt;</comment>
                            <comment id="14352763" author="jira-bot" created="Mon, 9 Mar 2015 10:34:21 +0000"  >&lt;p&gt;Commit 1665174 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1665174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1665174&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4044&quot; title=&quot;CloudSolrServer early connect problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4044&quot;&gt;&lt;del&gt;SOLR-4044&lt;/del&gt;&lt;/a&gt;: CloudSolrClient.connect() can take a timeout parameter to wait for the cluster&lt;/p&gt;</comment>
                            <comment id="14352770" author="jira-bot" created="Mon, 9 Mar 2015 10:36:53 +0000"  >&lt;p&gt;Commit 1665175 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1665175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1665175&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4044&quot; title=&quot;CloudSolrServer early connect problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4044&quot;&gt;&lt;del&gt;SOLR-4044&lt;/del&gt;&lt;/a&gt;: CloudSolrClient.connect() can take a timeout parameter to wait for the cluster&lt;/p&gt;</comment>
                            <comment id="14495424" author="thelabdude" created="Wed, 15 Apr 2015 00:31:04 +0000"  >&lt;p&gt;Bulk close after 5.1 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12776961">SOLR-7146</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12703262" name="SOLR-4044-waitforcluster.patch" size="17842" author="romseygeek" created="Sat, 7 Mar 2015 21:32:02 +0000"/>
                            <attachment id="12701384" name="SOLR-4044-waitforcluster.patch" size="18904" author="romseygeek" created="Fri, 27 Feb 2015 16:21:44 +0000"/>
                            <attachment id="12701336" name="SOLR-4044-waitforcluster.patch" size="10403" author="romseygeek" created="Fri, 27 Feb 2015 11:09:00 +0000"/>
                            <attachment id="12655444" name="SOLR-4044.patch" size="3705" author="vzhovtiuk" created="Sun, 13 Jul 2014 10:13:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255731</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fuav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90507</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>