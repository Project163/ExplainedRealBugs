<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:38:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12941] IndexSizeTrigger and splitMethod=link problems</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12941</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;tt&gt;IndexSizeTrigger&lt;/tt&gt;&#160;can be configured to use&#160;&lt;tt&gt;splitMethod=link&lt;/tt&gt;&#160;(&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12730&quot; title=&quot;Implement staggered SPLITSHARD requests in IndexSizeTrigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12730&quot;&gt;&lt;del&gt;SOLR-12730&lt;/del&gt;&lt;/a&gt;), which uses hard-linking for creating sub-shards.&lt;/p&gt;

&lt;p&gt;However, if the trigger uses&#160;&lt;tt&gt;aboveBytes&lt;/tt&gt; condition the resulting sub-shards will not immediately decrease in size, until all of the deleted documents will be expunged (either by gradual merges or by explicit and costly expungeDeletes command). As a result the new sub-shards will still exceed the &lt;tt&gt;aboveBytes&lt;/tt&gt; threshold, which will cause the trigger to keep generating new split requests.&lt;/p&gt;

&lt;p&gt;I see two options how to solve this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;disallow using &lt;tt&gt;aboveBytes&lt;/tt&gt; with &lt;tt&gt;splitMethod=link&lt;/tt&gt;. This unfortunately is a very desirable combination because it monitors the actual index size and uses the fast splitting method.&lt;/li&gt;
	&lt;li&gt;calculate an internal estimate of &quot;eventual index size&quot; for an index with deletions, and use this estimate when checking with &lt;tt&gt;aboveBytes&lt;/tt&gt;&#160;instead of the real index size. This of course introduces a potentially significant estimation error but allows to properly treat hard-linked sub-shards with deletions as (eventually) significantly smaller than the parent shard.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13195114">SOLR-12941</key>
            <summary>IndexSizeTrigger and splitMethod=link problems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ab">Andrzej Bialecki</assignee>
                                    <reporter username="ab">Andrzej Bialecki</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Oct 2018 13:05:06 +0000</created>
                <updated>Fri, 26 Jul 2019 08:56:14 +0000</updated>
                            <resolved>Tue, 28 May 2019 10:01:22 +0000</resolved>
                                    <version>7.6</version>
                    <version>8.0</version>
                                    <fixVersion>8.2</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16672156" author="dsmiley" created="Thu, 1 Nov 2018 20:33:14 +0000"  >&lt;p&gt;definitely do the latter (estimate eventual index size) by simply using a ratio of numDocs / maxDocs.&lt;/p&gt;</comment>
                            <comment id="16672265" author="ab" created="Thu, 1 Nov 2018 21:40:23 +0000"  >&lt;p&gt;Another interesting failure that I and Shalin spotted while debugging test failures is that occasionally older commit points linger around for a while, and they throw off the size calculations too (because the actual directory size consists of all segments from the previous commit point plus all segments from the latest commit point).&lt;/p&gt;

&lt;p&gt;The trigger should probably consider only the latest commit point because older ones will eventually be deleted. This will require adding a metric (gauge) to SolrCore to report the details of only the latest commit point.&lt;/p&gt;</comment>
                            <comment id="16849025" author="ab" created="Mon, 27 May 2019 15:35:53 +0000"  >&lt;p&gt;This patch contains the following changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;added a new metric &lt;tt&gt;SEARCHER.searcher.indexCommitSize&lt;/tt&gt; that tracks the size of only those index files that are included in the latest commit point.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;IndexSizeTrigger&lt;/tt&gt; now uses this metric to consider only the size of the latest commit point. Using this value it calculates an estimated effective index size based on the percentage of non-deleted documents.&lt;/li&gt;
	&lt;li&gt;unit test to demonstrate that &lt;tt&gt;aboveBytes&lt;/tt&gt; condition now works with &lt;tt&gt;splitMethod=link&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;improve tracking of SEARCHER metrics in the simulator.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If there are no objections I&apos;d like to commit this shortly.&lt;/p&gt;</comment>
                            <comment id="16849531" author="jira-bot" created="Tue, 28 May 2019 09:34:50 +0000"  >&lt;p&gt;Commit 04d781db8b188d168892e088af872565e32c72f5 in lucene-solr&apos;s branch refs/heads/branch_8x from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=04d781d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=04d781d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12941&quot; title=&quot;IndexSizeTrigger and splitMethod=link problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12941&quot;&gt;&lt;del&gt;SOLR-12941&lt;/del&gt;&lt;/a&gt;: Fix IndexSizeTrigger to correctly work with &quot;aboveBytes&quot; and &quot;splitMethod=link&quot; parameters.&lt;/p&gt;</comment>
                            <comment id="16849532" author="jira-bot" created="Tue, 28 May 2019 09:35:15 +0000"  >&lt;p&gt;Commit 32ad3724333b178181b61b1582a87f3b6becba25 in lucene-solr&apos;s branch refs/heads/master from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=32ad372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=32ad372&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12941&quot; title=&quot;IndexSizeTrigger and splitMethod=link problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12941&quot;&gt;&lt;del&gt;SOLR-12941&lt;/del&gt;&lt;/a&gt;: Fix IndexSizeTrigger to correctly work with &quot;aboveBytes&quot; and &quot;splitMethod=link&quot; parameters.&lt;/p&gt;</comment>
                            <comment id="16849838" author="jira-bot" created="Tue, 28 May 2019 15:24:18 +0000"  >&lt;p&gt;Commit 90e0d1eba10b3d611b2f8692f57e33beb91823b0 in lucene-solr&apos;s branch refs/heads/master from Christine Poerschke&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=90e0d1e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=90e0d1e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12941&quot; title=&quot;IndexSizeTrigger and splitMethod=link problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12941&quot;&gt;&lt;del&gt;SOLR-12941&lt;/del&gt;&lt;/a&gt;: remove unused import in IndexSizeTriggerTest&lt;/p&gt;</comment>
                            <comment id="16849842" author="jira-bot" created="Tue, 28 May 2019 15:26:43 +0000"  >&lt;p&gt;Commit e9feb1146bf99d9285322ba3c51b1a3b5b6a1603 in lucene-solr&apos;s branch refs/heads/branch_8x from Christine Poerschke&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e9feb11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e9feb11&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12941&quot; title=&quot;IndexSizeTrigger and splitMethod=link problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12941&quot;&gt;&lt;del&gt;SOLR-12941&lt;/del&gt;&lt;/a&gt;: remove unused import in IndexSizeTriggerTest&lt;/p&gt;</comment>
                            <comment id="16849891" author="ab" created="Tue, 28 May 2019 16:24:16 +0000"  >&lt;p&gt;Thanks Christine!&lt;/p&gt;</comment>
                            <comment id="16893553" author="ivera" created="Fri, 26 Jul 2019 08:56:14 +0000"  >&lt;p&gt;Closing after the 8.2.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12969923" name="SOLR-12941.patch" size="26479" author="ab" created="Mon, 27 May 2019 15:31:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zstr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>