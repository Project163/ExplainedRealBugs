<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:35:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6117] Replication command=fetchindex always return success.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6117</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Replication API command=fetchindex do fetch the index. while occur the error, still give success response. &lt;br/&gt;
API should return the right status, especially WAIT parameter is true.(synchronous).&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12717086">SOLR-6117</key>
            <summary>Replication command=fetchindex always return success.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gerlowskija">Jason Gerlowski</assignee>
                                    <reporter username="raintung.li">Raintung Li</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 May 2014 16:59:57 +0000</created>
                <updated>Mon, 11 Feb 2019 09:20:11 +0000</updated>
                            <resolved>Mon, 3 Dec 2018 13:24:00 +0000</resolved>
                                    <version>4.6</version>
                    <version>7.5</version>
                                    <fixVersion>7.7</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>replication (java)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14012390" author="shalinmangar" created="Thu, 29 May 2014 14:17:38 +0000"  >&lt;p&gt;Thanks Raintung.&lt;/p&gt;

&lt;p&gt;In this patch, I&apos;ve made changes to store the actual exception and to print it in the response.&lt;/p&gt;</comment>
                            <comment id="14012469" author="shalinmangar" created="Thu, 29 May 2014 15:55:57 +0000"  >&lt;p&gt;Another iteration. I removed the exception from the Status class because the SnapPuller API is written to never throw exceptions. Instead, it just returns booleans for success/failure. Throwing exceptions is a very invasive change.&lt;/p&gt;

&lt;p&gt;This patch just returns the right status. I&apos;ve added a test as well. Is this sufficient for you Raintung?&lt;/p&gt;</comment>
                            <comment id="14012729" author="varunthacker" created="Thu, 29 May 2014 19:02:55 +0000"  >&lt;p&gt;It looks like all of the other commands also return OK_STATUS &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (command.equals(CMD_GET_FILE)) {
      getFileStream(solrParams, rsp);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (command.equals(CMD_GET_FILE_LIST)) {
      getFileList(solrParams, rsp);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (command.equalsIgnoreCase(CMD_BACKUP)) {
      doSnapShoot(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ModifiableSolrParams(solrParams), rsp, req);
      rsp.add(STATUS, OK_STATUS);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (command.equalsIgnoreCase(CMD_DELETE_BACKUP)) {
      deleteSnapshot(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ModifiableSolrParams(solrParams), rsp, req);
      rsp.add(STATUS, OK_STATUS);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The actual error stack trace gets printed in the logs. Should we change how the remaining also get handled?&lt;/p&gt;</comment>
                            <comment id="14013351" author="shalinmangar" created="Fri, 30 May 2014 06:37:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;The actual error stack trace gets printed in the logs. Should we change how the remaining also get handled?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think an exception should be returned in the response if possible. The old days of just logging exceptions are gone. We can&apos;t expect users to sift through GBs of logs in SolrCloud to find the reason behind the failure. But that&apos;s a big change so I think we should do it in another issue.&lt;/p&gt;</comment>
                            <comment id="16700791" author="gerlowskija" created="Tue, 27 Nov 2018 17:46:39 +0000"  >&lt;p&gt;Most recent attached patch is a slight update of Shalin&apos;s.  I&apos;d hoped to add a lot more tests with this that trigger the various failure conditions, but it&apos;s hard to reproduce many of them via JUnit.  Also looked at adding unit tests for ReplicationHandler directly, but it relies heavily on SolrCore, which is final which makes mocking/stubbing difficult as well.  If anyone sees a way to get more coverage on this without major surgery, I&apos;d love to hear it.&lt;/p&gt;

&lt;p&gt;The current patch makes sure that we never advertise a response as status=OK falsely, so it&apos;s just a bugfix and should be safe to include in branch_7x from a breaking-change perspective.  There&apos;s a lot of other problems with the replication handler responses that would require breaking changes.  Specifically:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&quot;status&quot; is only present on some responses.  Ideally it should be present on all /replication responses so that clients can rely on it being there.&lt;/li&gt;
	&lt;li&gt;&quot;status&quot; is used inconsistently.  Some uses give it an enum-like value that clients could key off of, others treat it like a &quot;message&quot; field and just give it random error messages&lt;/li&gt;
	&lt;li&gt;when errors occur, the &quot;message&quot; and &quot;exception&quot; fields are used inconsistently.  Ideally if an error occurs there would always be a message, and sometimes there would also be an exception.&lt;/li&gt;
	&lt;li&gt;many of the error-cases involving argument-validation set the status field properly but return with the wrong HTTP status (200). (i.e. they should throw a SolrException).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I plan on working some of these out soon in a larger commit that can be put on master.&lt;/p&gt;</comment>
                            <comment id="16701957" author="gerlowskija" created="Wed, 28 Nov 2018 14:32:32 +0000"  >&lt;p&gt;Attached an updated patch that&apos;s intended for the master branch, and thus has liberty to do more to make the various responses from the /replication API more uniform.  This version of the patch addresses all of the bullet points in my previous comment.  Haven&apos;t run tests more generally yet, but I hope to commit to master in the next week or so.&lt;/p&gt;

&lt;p&gt;One thing I forgot to clarify in my previous comment: both of these patches address &lt;em&gt;all&lt;/em&gt; subcommands in the /replication API (not just &quot;fetchindex&quot;)  That was a point of discussion in the original effort on this JIRA, so just thought I&apos;d clarify.&lt;/p&gt;</comment>
                            <comment id="16706272" author="jira-bot" created="Sun, 2 Dec 2018 13:16:08 +0000"  >&lt;p&gt;Commit 1df106e0e726ca0fe83d5074973d91a0fb21fd0a in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1df106e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1df106e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6117&quot; title=&quot;Replication command=fetchindex always return success.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6117&quot;&gt;&lt;del&gt;SOLR-6117&lt;/del&gt;&lt;/a&gt;: Return correct &apos;status&apos; from ReplicationHandler&lt;/p&gt;</comment>
                            <comment id="16706476" author="jira-bot" created="Sun, 2 Dec 2018 21:23:13 +0000"  >&lt;p&gt;Commit c951578fcabfd5520f425156b0fa35f35811554d in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c951578&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c951578&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6117&quot; title=&quot;Replication command=fetchindex always return success.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6117&quot;&gt;&lt;del&gt;SOLR-6117&lt;/del&gt;&lt;/a&gt;: Unify ReplicationHandler error handling&lt;/p&gt;

&lt;p&gt;Prior to this commit, ReplicationHandler had a few inconsistencies&lt;br/&gt;
in how it reported errors:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Sometimes the &apos;status&apos; field was used as an enum (e.g. &apos;success&apos;&lt;br/&gt;
    v. &apos;failure&apos;.  Elsewhere it is used to hold error messages.&lt;/li&gt;
	&lt;li&gt;Sometimes an explicit &apos;message&apos; field was used, but often not.&lt;/li&gt;
	&lt;li&gt;Sometimes a stack trace was provided in place of an error message.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This commit tweaks the various error cases in ReplicationHandler to&lt;br/&gt;
report errors consistently.  &apos;status&apos; is always an enum-type value.  A&lt;br/&gt;
&apos;message&apos; field is provided for all errors, with an optional &apos;exception&apos;&lt;br/&gt;
field.&lt;/p&gt;</comment>
                            <comment id="16707190" author="gerlowskija" created="Mon, 3 Dec 2018 13:24:00 +0000"  >&lt;p&gt;Marking this as &apos;Fixed&apos; for 8.0 and 7.7.  To summarize/clarify, the fixes on &lt;tt&gt;master&lt;/tt&gt; and &lt;tt&gt;branch_7x&lt;/tt&gt; are a little different based on the need to avoid potentially breaking changes on 7x.  The 7x changes only go far enough to fix the bug where we return a &lt;br/&gt;
&quot;success&quot; status even when the request fails.  The master changes do this, as well as correcting a few inconsistencies between the different error cases.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12949845" name="SOLR-6117-master.patch" size="22781" author="gerlowskija" created="Wed, 28 Nov 2018 14:26:00 +0000"/>
                            <attachment id="12949724" name="SOLR-6117.patch" size="9829" author="gerlowskija" created="Tue, 27 Nov 2018 17:29:18 +0000"/>
                            <attachment id="12647381" name="SOLR-6117.patch" size="2887" author="shalin" created="Thu, 29 May 2014 15:55:57 +0000"/>
                            <attachment id="12647371" name="SOLR-6117.patch" size="2049" author="shalin" created="Thu, 29 May 2014 14:17:38 +0000"/>
                            <attachment id="12647166" name="SOLR-6117.txt" size="1888" author="raintung.li" created="Wed, 28 May 2014 17:05:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>395294</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1w24v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>395425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>