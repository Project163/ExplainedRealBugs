<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:09:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-1111] fix FieldCache usage in Solr</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1111</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Recent changes in Lucene have altered how the FieldCache is used and as-is could lead to previously working Solr installations blowing up when they upgrade to 1.4.  We need to fix, or document the affects of these changes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12422696">SOLR-1111</key>
            <summary>fix FieldCache usage in Solr</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Apr 2009 14:17:21 +0000</created>
                <updated>Fri, 16 Apr 2021 20:54:51 +0000</updated>
                            <resolved>Fri, 16 Apr 2021 20:54:51 +0000</resolved>
                                                                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="12698399" author="yseeley@gmail.com" created="Mon, 13 Apr 2009 14:30:23 +0000"  >&lt;p&gt;The major issue is that Lucene now creates scorers per-segment, and if you use Lucene&apos;s searcher.search(...,sort) then the FieldCache populations will also be per-segment.&lt;/p&gt;

&lt;p&gt;The biggest issue:  If FieldCache get&apos;s populated at both the top-level reader and per-segment, memory usage doubles (as does un-inversion time).&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Faceting on single-valued fields uses the FieldCache at the top-level (and would be&lt;/li&gt;
	&lt;li&gt;This is non-trivial to change...  if we started counting per-segment, counts would somehow have to be merged across segments.&lt;/li&gt;
	&lt;li&gt;Sorting in Solr currently uses the FieldCache at the top level&lt;/li&gt;
	&lt;li&gt;This can&apos;t easily be changed to use Lucene&apos;s searcher.search(...,sort) since we are using a hit collector (which can be wrapped in a time limited collector).&lt;/li&gt;
	&lt;li&gt;Distributed search uses the top-level FieldCache to retrieve sort field values.&lt;/li&gt;
	&lt;li&gt;FunctionQuery now derives values at the segment level&lt;/li&gt;
	&lt;li&gt;This also applies to the function range query&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Another issue for function query is the use of ord()... it won&apos;t be valid in multi-segment indexes if evaluated at the segment level.&lt;/p&gt;

&lt;p&gt;Evaluate custom sorters (like query elevation, etc) to ensure that they still work at the segment level.  Solr doesn&apos;t currently do segment-level sorting like Lucene now does, but perhaps we should switch for more near-real-time support.&lt;/p&gt;</comment>
                            <comment id="12705414" author="jminard" created="Sun, 3 May 2009 12:19:08 +0000"  >&lt;p&gt;Is this Lucene version in the current 1.4 trunk, or is it a version not-yet integrated into Solr libs?&lt;/p&gt;

&lt;p&gt;And also, the description makes it sound like an upgrade issue, but really any 1.4 version could blow up due to this problem.&lt;/p&gt;

&lt;p&gt;Lastly, define &quot;blow up&quot;...  Uses double memory, or some other side effect?&lt;/p&gt;</comment>
                            <comment id="12705418" author="yseeley@gmail.com" created="Sun, 3 May 2009 13:29:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is this Lucene version in the current 1.4 trunk&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;define &quot;blow up&quot;... Uses double memory, or some other side effect?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep - which can cause previously working systems OOM errors.&lt;/p&gt;</comment>
                            <comment id="12709223" author="yseeley@gmail.com" created="Thu, 14 May 2009 00:07:22 +0000"  >&lt;p&gt;Here&apos;s a patch for distributed search to retrieve sort field values from the lowest level index readers.&lt;br/&gt;
I plan on committing shortly.&lt;/p&gt;</comment>
                            <comment id="12709518" author="yseeley@gmail.com" created="Thu, 14 May 2009 18:38:27 +0000"  >&lt;p&gt;I just committed the distributed search part of this patch.&lt;/p&gt;</comment>
                            <comment id="12712752" author="yseeley@gmail.com" created="Mon, 25 May 2009 17:05:05 +0000"  >&lt;p&gt;Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1111&quot; title=&quot;fix FieldCache usage in Solr&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1111&quot;&gt;&lt;del&gt;SOLR-1111&lt;/del&gt;&lt;/a&gt;_sort.patch to use new Lucene Collector classes, including sorting collectors that will use FieldCache entries at the segment level instead of the top level reader.&lt;/p&gt;

&lt;p&gt;Unfortunately, tests don&apos;t currently pass - NPE caused by sort=a_i asc.&lt;br/&gt;
Looks like we&apos;ll need to port any custom comparators over to the new FieldComparatorSource (I hadn&apos;t thought about this before, but of course it makes sense that the old custom comparators wouldn&apos;t work since there isn&apos;t a method to compare docs from different segments).&lt;/p&gt;</comment>
                            <comment id="12712823" author="yseeley@gmail.com" created="Tue, 26 May 2009 00:36:04 +0000"  >&lt;p&gt;Attaching updated patch - multiple test cases still failing.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fixed the sort-last comparator sources&lt;/li&gt;
	&lt;li&gt;fixed SolrIndexReader.sortDocSet()&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12713028" author="yseeley@gmail.com" created="Tue, 26 May 2009 14:34:22 +0000"  >&lt;p&gt;Latest patch - some tests still fail.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fixed/implemented sort-missing-last as a new FieldComparatorSource&lt;/li&gt;
	&lt;li&gt;fixed distributed search for sorting missing last&lt;/li&gt;
	&lt;li&gt;fixed function query when scores are NaN or -infinity... had to map to -max_val&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This won&apos;t apply to trunk because it clashes with the reversion of SolrIndexSearcher to use delegation rather than inheritance.  I fixed it by changing &quot;super(r)&quot; to &quot;super(wrap(r))&quot;&lt;/p&gt;</comment>
                            <comment id="12713053" author="yseeley@gmail.com" created="Tue, 26 May 2009 15:23:24 +0000"  >&lt;p&gt;TODO reminder: FieldCache.DEFAULT and ExtendedFieldCache.EXT_DEFAULT are different instances... make sure that we are using the same instance everywhere to avoid more memory being used than necessary.&lt;/p&gt;</comment>
                            <comment id="12713247" author="yseeley@gmail.com" created="Tue, 26 May 2009 20:51:27 +0000"  >&lt;p&gt;Attaching updated patch.  All tests new pass.&lt;/p&gt;</comment>
                            <comment id="12713271" author="yseeley@gmail.com" created="Tue, 26 May 2009 21:36:48 +0000"  >&lt;p&gt;committed.  Leaving this issue open for now - need to look at RandomSortField, FieldCache.DEFAULT, and perhaps some tests (something to show that FieldCache entries are being shared).&lt;/p&gt;</comment>
                            <comment id="12713285" author="yseeley@gmail.com" created="Tue, 26 May 2009 22:10:03 +0000"  >&lt;p&gt;For FieldCache issues, I&apos;ve opened &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1662&quot; title=&quot;consolidate FieldCache and ExtendedFieldCache instances&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-1662&quot;&gt;&lt;del&gt;LUCENE-1662&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12740974" author="yseeley@gmail.com" created="Sat, 8 Aug 2009 21:24:10 +0000"  >&lt;p&gt;Moving the rest of this to 1.5&lt;/p&gt;</comment>
                            <comment id="12872606" author="hossman" created="Thu, 27 May 2010 22:08:42 +0000"  >&lt;p&gt;Bulk updating 240 Solr issues to set the Fix Version to &quot;next&quot; per the process outlined in this email...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Selection criteria was &quot;Unresolved&quot; with a Fix Version of 1.5, 1.6, 3.1, or 4.0.  email notifications were suppressed.&lt;/p&gt;

&lt;p&gt;A unique token for finding these 240 issues in the future: hossversioncleanup20100527&lt;/p&gt;</comment>
                            <comment id="13043812" author="rcmuir" created="Fri, 3 Jun 2011 16:47:12 +0000"  >&lt;p&gt;Bulk move 3.2 -&amp;gt; 3.3&lt;/p&gt;</comment>
                            <comment id="13106445" author="rcmuir" created="Fri, 16 Sep 2011 14:51:08 +0000"  >&lt;p&gt;3.4 -&amp;gt; 3.5&lt;/p&gt;</comment>
                            <comment id="13235917" author="erickerickson" created="Thu, 22 Mar 2012 19:19:54 +0000"  >&lt;p&gt;Is this relevant any more? I found this by accident while investigating a client question...&lt;/p&gt;</comment>
                            <comment id="13237091" author="hossman" created="Fri, 23 Mar 2012 20:38:10 +0000"  >&lt;p&gt;Issue is marked 3.6 and actively being discussed but has no assignee - assigning to most active committer contributing patches/discussion so far to triage wether this can/should be pushed to 4.0 or not.&lt;/p&gt;</comment>
                            <comment id="13412203" author="hossman" created="Wed, 11 Jul 2012 22:26:19 +0000"  >&lt;p&gt;bulk fixing the version info for 4.0-ALPHA and 4.0 all affected issues have &quot;hoss20120711-bulk-40-change&quot; in comment&lt;/p&gt;</comment>
                            <comment id="13429893" author="rcmuir" created="Tue, 7 Aug 2012 03:44:04 +0000"  >&lt;p&gt;rmuir20120906-bulk-40-change&lt;/p&gt;</comment>
                            <comment id="13452194" author="rcmuir" created="Mon, 10 Sep 2012 17:41:57 +0000"  >&lt;p&gt;moving all 4.0 issues not touched in a month to 4.1&lt;/p&gt;</comment>
                            <comment id="17324077" author="dsmiley" created="Fri, 16 Apr 2021 20:54:51 +0000"  >&lt;p&gt;Closing. &#160;Committs were made a long time ago and can be found in history tagged with this JIRA ID.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12428863">SOLR-1247</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12429426">SOLR-1259</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12431085">SOLR-1299</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12431898">SOLR-1318</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12560699">SOLR-3545</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12423498">SOLR-1124</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12408073" name="SOLR-1111-distrib.patch" size="9090" author="yseeley@gmail.com" created="Thu, 14 May 2009 00:07:22 +0000"/>
                            <attachment id="12409075" name="SOLR-1111_sort.patch" size="46667" author="yseeley@gmail.com" created="Tue, 26 May 2009 20:51:27 +0000"/>
                            <attachment id="12409041" name="SOLR-1111_sort.patch" size="41651" author="yseeley@gmail.com" created="Tue, 26 May 2009 14:34:22 +0000"/>
                            <attachment id="12408976" name="SOLR-1111_sort.patch" size="33417" author="yseeley@gmail.com" created="Tue, 26 May 2009 00:36:04 +0000"/>
                            <attachment id="12408956" name="SOLR-1111_sort.patch" size="21517" author="yseeley@gmail.com" created="Mon, 25 May 2009 17:05:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03spb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20083</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>