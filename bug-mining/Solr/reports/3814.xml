<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:31:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12020] terms faceting on date field fails in distributed refinement</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12020</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This appears to be a regression, as the reporter indicates that Solr 6.2 worked and Solr 6.6 does not. &lt;br/&gt;
&lt;a href=&quot;http://markmail.org/message/hwlajuy5jnmf4yd6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/hwlajuy5jnmf4yd6&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve reproduced the issue on the master branch (future v8) as well.&lt;br/&gt;
A typical exception that results from a terms facet on a date field is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.solr.common.SolrException: Invalid Date &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&apos;Sat Feb 03 01:02:03 WET 2001&apos;&lt;/span&gt;
	at org.apache.solr.util.DateMathParser.parseMath(DateMathParser.java:247)
	at org.apache.solr.util.DateMathParser.parseMath(DateMathParser.java:226)
	at org.apache.solr.schema.DatePointField.toNativeType(DatePointField.java:113)
	at org.apache.solr.search.facet.FacetFieldProcessor.refineBucket(FacetFieldProcessor.java:683)
	at org.apache.solr.search.facet.FacetFieldProcessor.refineFacets(FacetFieldProcessor.java:638)
	at org.apache.solr.search.facet.FacetFieldProcessorByArray.calcFacets(FacetFieldProcessorByArray.java:66)
	at org.apache.solr.search.facet.FacetFieldProcessorByArray.process(FacetFieldProcessorByArray.java:58)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13140331">SOLR-12020</key>
            <summary>terms faceting on date field fails in distributed refinement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Feb 2018 22:08:52 +0000</created>
                <updated>Sat, 8 Jun 2019 15:11:33 +0000</updated>
                            <resolved>Mon, 5 Mar 2018 17:36:37 +0000</resolved>
                                    <version>6.6</version>
                                    <fixVersion>7.3</fixVersion>
                                    <component>Facet Module</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16374740" author="yseeley@gmail.com" created="Fri, 23 Feb 2018 17:54:58 +0000"  >&lt;p&gt;Attached failing test, currently working on a fix.&lt;/p&gt;</comment>
                            <comment id="16384313" author="yseeley@gmail.com" created="Fri, 2 Mar 2018 23:34:03 +0000"  >&lt;p&gt;Attached a patch to fix.  The issue was that JSON is used to pass refinement issue, and Date objects were converted using toString().&lt;br/&gt;
There was also a related bug when creating a string representation of the bucketValue to pass to ft.getFieldQuery()&lt;/p&gt;</comment>
                            <comment id="16386514" author="dsmiley" created="Mon, 5 Mar 2018 18:41:42 +0000"  >&lt;p&gt;Maybe JSONWriter.write should know about Date &amp;amp; Instant, so that we don&apos;t have to play wack-amole with special casing down-stream?&lt;/p&gt;

&lt;p&gt;BTW Date.toInstant() is the easiest way to go from a Date to an Instant.&lt;/p&gt;</comment>
                            <comment id="16386526" author="mbraun688" created="Mon, 5 Mar 2018 18:47:21 +0000"  >&lt;p&gt;Looks like the git bot missed the commits for this&lt;/p&gt;</comment>
                            <comment id="16405067" author="yseeley@gmail.com" created="Mon, 19 Mar 2018 16:18:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe JSONWriter.write should know about Date &amp;amp; Instant, so that we don&apos;t have to play wack-amole with special casing down-stream?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That will require a new noggit release, but yeah I agree Date should be handled &quot;correctly&quot; (non locale dependent) by default.&lt;/p&gt;</comment>
                            <comment id="16405477" author="aguilara" created="Mon, 19 Mar 2018 21:24:51 +0000"  >&lt;p&gt;Hi, I am the person that reported this issue and I tried the fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt; pushed and I still get the same error.&#160; I spoke with him through e-mail and he recommended me providing more details in this ticket.&#160;&lt;/p&gt;

&lt;p&gt;So I am attaching the configuration files for the core that we use where the query is failing, a file of the data we index, and a screenshot of the output I get when running a query.&lt;/p&gt;

&lt;p&gt;Once you get the core and the data indexed, using the following error should hopefully give the same error I attached:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;https://localhost:&amp;lt;solr_port&amp;gt;/solr/vb_popbio/abndGraphdata?q=*:*&amp;amp;term=species_category&amp;amp;fq=geo_coords:[35.1021,-115.998%20TO%2036.9982,-114.046]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Hopefully this helps with the debugging. I also wanted to say that this query works on Solr 6.1 (not Solr 6.2 like I had initially reported).&#160; Thanks for looking into this.&lt;/p&gt;</comment>
                            <comment id="16411638" author="yseeley@gmail.com" created="Fri, 23 Mar 2018 16:15:38 +0000"  >&lt;p&gt;Thanks for the extra info!  I haven&apos;t been able to reproduce your exact problem in a unit test yet, but I did reproduce an issue in general with refinement with date fields as a parent facet (patch attached).&lt;/p&gt;

&lt;p&gt;What was the stack trace corresponding to the &quot;Invalid Date String&quot; error?&lt;/p&gt;

&lt;p&gt;I&apos;m about to go on vacation through the middle of next week, so I won&apos;t be able to continue looking into this until I get back.&lt;/p&gt;</comment>
                            <comment id="16411654" author="aguilara" created="Fri, 23 Mar 2018 16:29:43 +0000"  >&lt;p&gt;This is the stack trace I get in 7.3&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://pastebin.com/UcHY6FWu&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pastebin.com/UcHY6FWu&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the stack trace I got on 6.6&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://pastebin.com/rsHvKK63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pastebin.com/rsHvKK63&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12912842" name="SOLR-12020.patch" size="4766" author="yseeley@gmail.com" created="Fri, 2 Mar 2018 23:28:21 +0000"/>
                            <attachment id="12911762" name="SOLR-12020.patch" size="986" author="yseeley@gmail.com" created="Fri, 23 Feb 2018 17:54:09 +0000"/>
                            <attachment id="12915928" name="SOLR-12020_test.patch" size="8151" author="yseeley@gmail.com" created="Fri, 23 Mar 2018 16:10:58 +0000"/>
                            <attachment id="12915206" name="Solr Error.png" size="151270" author="aguilara" created="Mon, 19 Mar 2018 21:20:14 +0000"/>
                            <attachment id="12915205" name="popbio-solr-VB-2018-02-main-05.json.gz" size="29999953" author="aguilara" created="Mon, 19 Mar 2018 21:20:00 +0000"/>
                            <attachment id="12915204" name="vb_popbio_conf.tar.gz" size="137629" author="aguilara" created="Mon, 19 Mar 2018 21:19:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qhsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>