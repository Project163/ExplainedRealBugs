<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:34:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11585] Solr SQL does not work with point numeric fields</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11585</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Solr SQL does not work with point field types. there is no support for &apos;pint&apos;, &apos;plong&apos;, &apos;pdouble&apos;, &apos;pfloat&apos;  in &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/7.1.0/solr/core/src/java/org/apache/solr/handler/sql/SolrSchema.java#L99&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/7.1.0/solr/core/src/java/org/apache/solr/handler/sql/SolrSchema.java#L99&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Sample query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/ratings1/sql?indent=off&amp;amp;wt=json&amp;amp;version=2.2&amp;amp;aggregationMode=facet&amp;amp;stmt=+SELECT+movie_id,+COUNT(*)+as+agg_count,+avg(rating)+as+avg_rating,+sum(rating)+as+sum_rating,+min(rating)+as+min_rating,+max(rating)+as+max_rating+FROM+ratings1+GROUP+BY+movie_id+ORDER+BY+movie_id+asc
&lt;/span&gt;
Error:
Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing SQL &lt;span class=&quot;code-quote&quot;&gt;&quot; SELECT movie_id, COUNT(*) as agg_count, avg(rating) as avg_rating, sum(rating) as sum_rating, min(rating) as min_rating, max(rating) as max_rating FROM ratingsffd34e87_2c95_4c82_acff_d31c40983b73 GROUP BY movie_id ORDER BY movie_id asc &quot;&lt;/span&gt;: From line 1, column 42 to line 1, column 52: Cannot apply &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG&apos;&lt;/span&gt; to arguments of type &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG(&amp;lt;JAVATYPE(CLASS JAVA.LANG.STRING)&amp;gt;)&apos;&lt;/span&gt;. Supported form(s): &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG(&amp;lt;NUMERIC&amp;gt;)&apos;&lt;/span&gt;
	at org.apache.solr.client.solrj.io.stream.JDBCStream.open(JDBCStream.java:270)
	at org.apache.solr.client.solrj.io.stream.ExceptionStream.open(ExceptionStream.java:51)
	at org.apache.solr.handler.StreamHandler$TimerStream.open(StreamHandler.java:605)
	at org.apache.solr.client.solrj.io.stream.TupleStream.writeMap(TupleStream.java:83)
	at org.apache.solr.response.JSONWriter.writeMap(JSONResponseWriter.java:547)
	at org.apache.solr.response.TextResponseWriter.writeVal(TextResponseWriter.java:198)
	at org.apache.solr.response.JSONWriter.writeNamedListAsMapWithDups(JSONResponseWriter.java:209)
	at org.apache.solr.response.JSONWriter.writeNamedList(JSONResponseWriter.java:325)
	at org.apache.solr.response.JSONWriter.writeResponse(JSONResponseWriter.java:120)
	at org.apache.solr.response.JSONResponseWriter.write(JSONResponseWriter.java:71)
	at org.apache.solr.response.QueryResponseWriterUtil.writeQueryResponse(QueryResponseWriterUtil.java:65)
	at org.apache.solr.servlet.HttpSolrCall.writeResponse(HttpSolrCall.java:806)
	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:535)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:382)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:326)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)
	at org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:139)
	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)
	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)
	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)
	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)
	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)
	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)
	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)
	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
	at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:426)
	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)
	at org.eclipse.jetty.server.Server.handle(Server.java:534)
	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)
	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)
	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283)
	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108)
	at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)
	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671)
	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: java.sql.SQLException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing SQL &lt;span class=&quot;code-quote&quot;&gt;&quot; SELECT movie_id, COUNT(*) as agg_count, avg(rating) as avg_rating, sum(rating) as sum_rating, min(rating) as min_rating, max(rating) as max_rating FROM ratingsffd34e87_2c95_4c82_acff_d31c40983b73 GROUP BY movie_id ORDER BY movie_id asc &quot;&lt;/span&gt;: From line 1, column 42 to line 1, column 52: Cannot apply &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG&apos;&lt;/span&gt; to arguments of type &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG(&amp;lt;JAVATYPE(CLASS JAVA.LANG.STRING)&amp;gt;)&apos;&lt;/span&gt;. Supported form(s): &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG(&amp;lt;NUMERIC&amp;gt;)&apos;&lt;/span&gt;
	at org.apache.calcite.avatica.Helper.createException(Helper.java:56)
	at org.apache.calcite.avatica.Helper.createException(Helper.java:41)
	at org.apache.calcite.avatica.AvaticaStatement.executeInternal(AvaticaStatement.java:156)
	at org.apache.calcite.avatica.AvaticaStatement.executeQuery(AvaticaStatement.java:218)
	at org.apache.solr.client.solrj.io.stream.JDBCStream.open(JDBCStream.java:268)
	... 38 more
Caused by: org.apache.calcite.runtime.CalciteContextException: From line 1, column 42 to line 1, column 52: Cannot apply &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG&apos;&lt;/span&gt; to arguments of type &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG(&amp;lt;JAVATYPE(CLASS JAVA.LANG.STRING)&amp;gt;)&apos;&lt;/span&gt;. Supported form(s): &lt;span class=&quot;code-quote&quot;&gt;&apos;AVG(&amp;lt;NUMERIC&amp;gt;)&apos;&lt;/span&gt;
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13113410">SOLR-11585</key>
            <summary>Solr SQL does not work with point numeric fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10003">Resolved</resolution>
                                        <assignee username="jbernste">Joel Bernstein</assignee>
                                    <reporter username="kiranch">Kiran</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Oct 2017 19:16:17 +0000</created>
                <updated>Tue, 8 Oct 2019 14:50:45 +0000</updated>
                            <resolved>Thu, 30 Aug 2018 13:03:41 +0000</resolved>
                                    <version>7.1</version>
                                                    <component>Parallel SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16227358" author="kiranch" created="Tue, 31 Oct 2017 19:19:28 +0000"  >&lt;p&gt;Did some local testing with the attached patch and it seems to fix the issue&lt;/p&gt;</comment>
                            <comment id="16227368" author="varunthacker" created="Tue, 31 Oct 2017 19:29:34 +0000"  >&lt;p&gt;The  tests didn&apos;t catch this because TestSQLHandler is using field names like &lt;tt&gt;field_i&lt;/tt&gt; which is hardcoded to use trie fields. If it used &lt;tt&gt;field_ti&lt;/tt&gt; then the test framework would have randomized b/w trie and point fields. &lt;/p&gt;

&lt;p&gt;We should just use {[schema.xml}} instead of &lt;tt&gt;&quot;schema-sql.xml&quot;&lt;/tt&gt; . A quick glance shows that the test uses three dynamic fields - _t  , _s and _i which is present in schema.xml . _i is also randomized b/w trie and point fields. &lt;/p&gt;</comment>
                            <comment id="16574975" author="joel.bernstein" created="Thu, 9 Aug 2018 15:10:31 +0000"  >&lt;p&gt;I&apos;ll apply the patch and then work on the tests so that all the numeric field types are exercised.&lt;/p&gt;</comment>
                            <comment id="16575045" author="joel.bernstein" created="Thu, 9 Aug 2018 15:55:56 +0000"  >&lt;p&gt;I think it will be very difficult to switch the test case to use schema.xml because DocValues are required for many of the SQL queries being tested. In schema.xml DocValues are randomized in places which will break the test.&lt;/p&gt;

&lt;p&gt;So I will focus on getting all the field types that need to be tested in schema-sql.xml. Then I&apos;ll expand the tests to excercise all the field types.&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ll also remove the badapple designation from the TestSQLHandler and fix any issues I see in jenkins.&lt;/p&gt;</comment>
                            <comment id="16575096" author="varunthacker" created="Thu, 9 Aug 2018 16:28:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think it will be very difficult to switch the test case to use schema.xml because DocValues are required for many of the SQL queries being tested.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We could perhaps use this to always ensure&#160;fields&#160;have doc-values&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(NUMERIC_DOCVALUES_SYSPROP,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The motivation for me is we have lots of test-specific schemas and the more we can reuse the better. New devs then just end up copy-pasting an existing test case but don&apos;t get the context to why a particular schema was used&lt;/p&gt;</comment>
                            <comment id="16575118" author="joel.bernstein" created="Thu, 9 Aug 2018 16:49:19 +0000"  >&lt;p&gt;We can try that. Let&apos;s do this in two tickets, In this ticket let&apos;s get this done:&lt;/p&gt;

&lt;p&gt;1) Get points working with /sql handler&lt;/p&gt;

&lt;p&gt;2) Add better tests that explicitly use points&lt;/p&gt;

&lt;p&gt;I&apos;ll get this committed and pushed out today.&lt;/p&gt;

&lt;p&gt;Then I&apos;ll open another ticket which looks at using the standard schema.xml. There may be more then one problem that needs to be fixed with this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16575291" author="joel.bernstein" created="Thu, 9 Aug 2018 19:24:34 +0000"  >&lt;p&gt;Patch with improved tests.&lt;/p&gt;</comment>
                            <comment id="16575293" author="joel.bernstein" created="Thu, 9 Aug 2018 19:26:44 +0000"  >&lt;p&gt;Latest patch is looking fairly good. The tests still need more work in general but they do exercise the points in different ways. I&apos;ll do some manual testing as well and then likely commit.&lt;/p&gt;

&lt;p&gt;I&apos;ll create another ticket to improve the tests in general to ensure the more cases are covered, in particular that both map_reduce and facet aggregationModes have enough coverage.&lt;/p&gt;</comment>
                            <comment id="16575593" author="jira-bot" created="Fri, 10 Aug 2018 00:05:58 +0000"  >&lt;p&gt;Commit 71310a4722f3e95a0e10a4ca4297d090ace3efd4 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=71310a4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=71310a4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11585&quot; title=&quot;Solr SQL does not work with point numeric fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11585&quot;&gt;&lt;del&gt;SOLR-11585&lt;/del&gt;&lt;/a&gt;: Solr SQL does not work with point numeric fields&lt;/p&gt;</comment>
                            <comment id="16575596" author="jira-bot" created="Fri, 10 Aug 2018 00:11:33 +0000"  >&lt;p&gt;Commit c5ea325e096a344b58cbf1df2ef167d4953c97b1 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c5ea325&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c5ea325&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11585&quot; title=&quot;Solr SQL does not work with point numeric fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11585&quot;&gt;&lt;del&gt;SOLR-11585&lt;/del&gt;&lt;/a&gt;: Solr SQL does not work with point numeric fields&lt;/p&gt;</comment>
                            <comment id="16576001" author="jira-bot" created="Fri, 10 Aug 2018 09:13:57 +0000"  >&lt;p&gt;Commit 71310a4722f3e95a0e10a4ca4297d090ace3efd4 in lucene-solr&apos;s branch refs/heads/jira/http2 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=71310a4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=71310a4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11585&quot; title=&quot;Solr SQL does not work with point numeric fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11585&quot;&gt;&lt;del&gt;SOLR-11585&lt;/del&gt;&lt;/a&gt;: Solr SQL does not work with point numeric fields&lt;/p&gt;</comment>
                            <comment id="16576088" author="joel.bernstein" created="Fri, 10 Aug 2018 10:40:10 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiranch&quot; class=&quot;user-hover&quot; rel=&quot;kiranch&quot;&gt;kiranch&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13063512">SOLR-10483</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12935027" name="SOLR-11585.patch" size="18252" author="jbernste" created="Thu, 9 Aug 2018 19:24:19 +0000"/>
                            <attachment id="12895047" name="SOLR-11585.patch" size="801" author="kiranch" created="Tue, 31 Oct 2017 19:18:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lxkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>