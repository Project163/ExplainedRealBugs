<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:28:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11449] MoveReplicaCmd mistakenly calls registerCollectionStateWatcher instead of unregisterCollectionStateWatcher</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11449</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Probably got in as a copy &amp;amp; paste error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--- a/solr/core/src/java/org/apache/solr/cloud/MoveReplicaCmd.java
+++ b/solr/core/src/java/org/apache/solr/cloud/MoveReplicaCmd.java
@@ -206,7 +206,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MoveReplicaCmd &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Cmd{
       log.warn(errorString);
       results.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;failure&quot;&lt;/span&gt;, errorString);
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (watcher != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;code-comment&quot;&gt;// unregister
&lt;/span&gt;-        ocmh.zkStateReader.registerCollectionStateWatcher(coll.getName(), watcher);
+        ocmh.zkStateReader.removeCollectionStateWatcher(coll.getName(), watcher);
       }
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13107978">SOLR-11449</key>
            <summary>MoveReplicaCmd mistakenly calls registerCollectionStateWatcher instead of unregisterCollectionStateWatcher</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ab">Andrzej Bialecki</assignee>
                                    <reporter username="ab">Andrzej Bialecki</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Oct 2017 13:45:01 +0000</created>
                <updated>Sat, 8 Jun 2019 15:16:08 +0000</updated>
                            <resolved>Tue, 10 Oct 2017 10:50:19 +0000</resolved>
                                    <version>7.0.1</version>
                    <version>7.1</version>
                    <version>8.0</version>
                                    <fixVersion>7.1</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16197205" author="ab" created="Mon, 9 Oct 2017 16:06:03 +0000"  >&lt;p&gt;I also noticed another issue related to leader replicas - there&apos;s a section of code in &lt;tt&gt;moveNormalReplica&lt;/tt&gt; that ensures that we don&apos;t lose a shard leader during move. There&apos;s no corresponding protection in &lt;tt&gt;moveHdfsReplica&lt;/tt&gt;, which means that moving a replica that is also a shard leader may potentially lead to data loss (eg. when replicationFactor=1).&lt;/p&gt;

&lt;p&gt;Also, there&apos;s no rollback strategy when &lt;tt&gt;moveHdfsReplica&lt;/tt&gt; partially fails, unlike in &lt;tt&gt;moveNormalReplica&lt;/tt&gt; where the code simply skips deleting the original replica - it seems that the code should attempt to restore the original replica in this case? When RF=1 and such failure occurs then not restoring the original replica means lost shard.&lt;/p&gt;</comment>
                            <comment id="16197441" author="ab" created="Mon, 9 Oct 2017 18:24:11 +0000"  >&lt;p&gt;Patch fixing the issue with watch (un)registration. The other issue (HDFS) is not fixed in this patch.&lt;/p&gt;</comment>
                            <comment id="16198501" author="jira-bot" created="Tue, 10 Oct 2017 10:43:48 +0000"  >&lt;p&gt;Commit 338a421175e86ae6ba6a3da6719edd0061150af7 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=338a421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=338a421&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11449&quot; title=&quot;MoveReplicaCmd mistakenly calls registerCollectionStateWatcher instead of unregisterCollectionStateWatcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11449&quot;&gt;&lt;del&gt;SOLR-11449&lt;/del&gt;&lt;/a&gt;: MoveReplicaCmd mistakenly called registerCollectionStateWatcher on failure.&lt;/p&gt;</comment>
                            <comment id="16198502" author="jira-bot" created="Tue, 10 Oct 2017 10:44:30 +0000"  >&lt;p&gt;Commit 71c57abdd8fc4da6da1ad2ab5b8b4cc4c2531e76 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=71c57ab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=71c57ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11449&quot; title=&quot;MoveReplicaCmd mistakenly calls registerCollectionStateWatcher instead of unregisterCollectionStateWatcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11449&quot;&gt;&lt;del&gt;SOLR-11449&lt;/del&gt;&lt;/a&gt;: MoveReplicaCmd mistakenly called registerCollectionStateWatcher on failure.&lt;/p&gt;</comment>
                            <comment id="16198503" author="jira-bot" created="Tue, 10 Oct 2017 10:44:56 +0000"  >&lt;p&gt;Commit ca469947000728b6e9ac3fc19b6b91cce699d5a3 in lucene-solr&apos;s branch refs/heads/branch_7_1 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca46994&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca46994&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11449&quot; title=&quot;MoveReplicaCmd mistakenly calls registerCollectionStateWatcher instead of unregisterCollectionStateWatcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11449&quot;&gt;&lt;del&gt;SOLR-11449&lt;/del&gt;&lt;/a&gt;: MoveReplicaCmd mistakenly called registerCollectionStateWatcher on failure.&lt;/p&gt;</comment>
                            <comment id="16198507" author="ab" created="Tue, 10 Oct 2017 10:50:19 +0000"  >&lt;p&gt;Fixed in master and in 7x / 7.1. Created a separate issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11458&quot; title=&quot;Bugs in MoveReplicaCmd handling of failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11458&quot;&gt;&lt;del&gt;SOLR-11458&lt;/del&gt;&lt;/a&gt;) to fix the buggy behavior in case of HDFS replica move failures.&lt;/p&gt;</comment>
                            <comment id="16207436" author="shalinmangar" created="Tue, 17 Oct 2017 11:04:11 +0000"  >&lt;p&gt;Bulk close after 7.1.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12891113" name="SOLR-11449.patch" size="8886" author="ab" created="Mon, 9 Oct 2017 18:23:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3l12v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>