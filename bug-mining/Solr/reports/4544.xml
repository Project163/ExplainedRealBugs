<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:45:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13205] StringIndexOutOfBoundsException in SolrQueryParserBase.getFieldQuery</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13205</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Requesting the following URL causes Solr to return an HTTP 500 error response:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://localhost:8983/solr/films/select?df=&amp;amp;explainOther=debug=all&amp;amp;debugQuery=on
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error response seems to be caused by the following uncaught exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.StringIndexOutOfBoundsException: String index out of range: 0
at java.lang.String.charAt(String.java:658)
at org.apache.solr.parser.SolrQueryParserBase.getFieldQuery(SolrQueryParserBase.java:1045)
at org.apache.solr.parser.SolrQueryParserBase.handleBareTokenQuery(SolrQueryParserBase.java:801)
at org.apache.solr.parser.QueryParser.Term(QueryParser.java:421)
at org.apache.solr.parser.QueryParser.Clause(QueryParser.java:278)
at org.apache.solr.parser.QueryParser.Query(QueryParser.java:162)
at org.apache.solr.parser.QueryParser.TopLevelQuery(QueryParser.java:131)
at org.apache.solr.parser.SolrQueryParserBase.parse(SolrQueryParserBase.java:255)
at org.apache.solr.search.LuceneQParser.parse(LuceneQParser.java:49)
at org.apache.solr.search.QParser.getQuery(QParser.java:173)
at org.apache.solr.util.SolrPluginUtils.doSimpleQuery(SolrPluginUtils.java:479)
at org.apache.solr.util.SolrPluginUtils.doStandardResultsDebug(SolrPluginUtils.java:390)
at org.apache.solr.util.SolrPluginUtils.doStandardDebug(SolrPluginUtils.java:343)
at org.apache.solr.handler.component.DebugComponent.process(DebugComponent.java:100)
at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:306)
at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:199)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &#8220;df&#8221; parameter means that we set the empty string as default field&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Since we do not give a field in the query, the default field is substituted in getFieldQuery. We then check if the field starts with &#8220;_&#8221; by using charAt(0).&lt;/p&gt;

&lt;p&gt;A trivial fix would be to replace field.charAt(0) == &#8216;&lt;em&gt;&#8217; with field.startsWith(&#8220;&lt;/em&gt;&#8221;).&lt;/p&gt;

&lt;p&gt;To set up an environment to reproduce this bug, follow the description in the &#8216;Environment&#8217; field.&lt;/p&gt;

&lt;p&gt;We automatically found this issue and ~70 more like this using &lt;a href=&quot;https://www.diffblue.com/labs/?utm_source=solr-br&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Diffblue Microservices Testing&lt;/a&gt;. Find more information on this &lt;a href=&quot;https://www.diffblue.com/blog/2018/12/19/diffblue-microservice-testing-a-sneak-peek-at-our-early-product-and-results?utm_source=solr-br&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fuzz testing campaign&lt;/a&gt;.&lt;/p&gt;</description>
                <environment>&lt;h1&gt;&lt;a name=&quot;Stepstoreproduce&quot;&gt;&lt;/a&gt;Steps to reproduce&lt;/h1&gt;

&lt;ul&gt;
	&lt;li&gt;Use a Linux machine.&lt;/li&gt;
	&lt;li&gt;Build commit &lt;tt&gt;ea2c8ba&lt;/tt&gt; of Solr as described in the section below.&lt;/li&gt;
	&lt;li&gt;Build the films collection as described below.&lt;/li&gt;
	&lt;li&gt;Start the server using the command &lt;tt&gt;./bin/solr start -f -p 8983 -s /tmp/home&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Request the URL given in the bug description.&lt;/li&gt;
&lt;/ul&gt;


&lt;h1&gt;&lt;a name=&quot;Compilingtheserver&quot;&gt;&lt;/a&gt;Compiling the server&lt;/h1&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;git clone https://github.com/apache/lucene-solr
cd lucene-solr
git checkout ea2c8ba
ant compile
cd solr
ant server
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h1&gt;&lt;a name=&quot;Buildingthecollectionandreproducingthebug&quot;&gt;&lt;/a&gt;Building the collection and reproducing the bug&lt;/h1&gt;

&lt;p&gt;We followed &lt;a href=&quot;http://lucene.apache.org/solr/guide/7_5/solr-tutorial.html#exercise-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Exercise 2&lt;/a&gt; from the &lt;a href=&quot;http://lucene.apache.org/solr/guide/7_5/solr-tutorial.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Solr Tutorial&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mkdir -p /tmp/home
echo &apos;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&amp;lt;solr&amp;gt;&amp;lt;/solr&amp;gt;&apos; &amp;gt; /tmp/home/solr.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In one terminal start a Solr instance in foreground:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;./bin/solr start -f -p 8983 -s /tmp/home
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In another terminal, create a collection of movies, with no shards and no replication, and initialize it:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;bin/solr create -c films
curl -X POST -H &apos;Content-type:application/json&apos; --data-binary &apos;{&quot;add-field&quot;: {&quot;name&quot;:&quot;name&quot;, &quot;type&quot;:&quot;text_general&quot;, &quot;multiValued&quot;:false, &quot;stored&quot;:true}}&apos; http://localhost:8983/solr/films/schema
curl -X POST -H &apos;Content-type:application/json&apos; --data-binary &apos;{&quot;add-copy-field&quot; : {&quot;source&quot;:&quot;*&quot;,&quot;dest&quot;:&quot;_text_&quot;}}&apos; http://localhost:8983/solr/films/schema
./bin/post -c films example/films/films.json
curl -v &#8220;URL_BUG&#8221;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please check the issue description below to find the &#8220;URL_BUG&#8221; that will allow you to reproduce the issue reported.&lt;/p&gt;</environment>
        <key id="13213084">SOLR-13205</key>
            <summary>StringIndexOutOfBoundsException in SolrQueryParserBase.getFieldQuery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gerlowskija">Jason Gerlowski</assignee>
                                    <reporter username="jkloos">Johannes Kloos</reporter>
                        <labels>
                            <label>diffblue</label>
                            <label>newdev</label>
                    </labels>
                <created>Thu, 31 Jan 2019 13:48:09 +0000</created>
                <updated>Wed, 4 Nov 2020 15:22:04 +0000</updated>
                            <resolved>Wed, 29 Jul 2020 14:42:08 +0000</resolved>
                                    <version>9.0</version>
                                    <fixVersion>8.7</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17147495" author="pramodkumar9@yahoo.com" created="Mon, 29 Jun 2020 01:59:48 +0000"  >&lt;p&gt;Hi - I am a newbie here. Looking to pick up this task as my first, and get a quick patch up.&lt;/p&gt;

&lt;p&gt;There are actually a couple of places with this issue.&lt;/p&gt;

&lt;p&gt;Can this be assigned to me (I can&apos;t seem to assign it to myself)?&lt;/p&gt;</comment>
                            <comment id="17147503" author="erickerickson" created="Mon, 29 Jun 2020 02:23:17 +0000"  >&lt;p&gt;Welcome and thanks!&lt;/p&gt;

&lt;p&gt;JIRAs can only be assigned to committers. So what happens is:&lt;/p&gt;

&lt;p&gt;1&amp;gt; you just add a comment like you already have saying you&apos;re working on it&lt;br/&gt;
2&amp;gt; when you&apos;re ready, add a patch or a PR&lt;br/&gt;
3&amp;gt; nudge committers to review/push to the repo.&lt;/p&gt;

&lt;p&gt;Make sure you look at the PR already attached BTW.&lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
Erick&lt;/p&gt;</comment>
                            <comment id="17147532" author="pramodkumar9@yahoo.com" created="Mon, 29 Jun 2020 04:10:39 +0000"  >&lt;p&gt;Thanks Erick.&lt;/p&gt;

&lt;p&gt;Will pick up the task.&lt;/p&gt;

&lt;p&gt;I did see the PR, but I would like to make a slightly more comprehensive fix.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17151430" author="pramodkumar9@yahoo.com" created="Sat, 4 Jul 2020 21:39:44 +0000"  >&lt;p&gt;Added a patch to fix this.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Updated the init method to not allow empty default fields or a bad parser.&lt;/li&gt;
	&lt;li&gt;Added checks on fields to check both null and emptiness.&lt;/li&gt;
	&lt;li&gt;Replaced charAt(0) with startsWith.&lt;/li&gt;
	&lt;li&gt;Added unit tests for the methods I touched.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17152021" author="gerlowskija" created="Mon, 6 Jul 2020 13:36:16 +0000"  >&lt;p&gt;Hey Pramod, thanks for the patch, and especially for making testing a first-class priority here.  This is a great candidate for unit tests - Solr has woefully few of them.  Always good to see new ones come in.&lt;/p&gt;

&lt;p&gt;I took a brief look at your patch and it didn&apos;t raise any red-flags content-wise, but I&apos;ll have time to review more thoroughly in the next day or two.  Will get back to you with more substantive stuff at that point.&lt;/p&gt;

&lt;p&gt;In terms of contributing, a few minor pointers for you:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If your most recent code is attached via patch, it&apos;s probably good to close out the PR you opened in Github, just to avoid confusion.&lt;/li&gt;
	&lt;li&gt;JIRA looks like it thinks your patch is an HTML file, and not a &quot;patch&quot; file.  It&apos;s not a real problem, because I can download that patch and read it locally.  But in the future, you probably want to name your patch files &quot;SOLR-#####.patch&quot; (note the extension), so the browser-reading experience is a little better for any reviewers.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17152094" author="pramodkumar9@yahoo.com" created="Mon, 6 Jul 2020 15:29:46 +0000"  >&lt;p&gt;Thanks for the feedback Jason.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I updated the patch to have the proper extension.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The PR is actually not mine.&#160;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17155706" author="gerlowskija" created="Fri, 10 Jul 2020 20:17:03 +0000"  >&lt;p&gt;Hey Pramod - got a chance to review your patch this afternoon.  It all looks great - with one partial exception: I don&apos;t fully understand why you made the changes you did to &lt;tt&gt;SolrQueryParserBase.init&lt;/tt&gt;.  Are those tied in some way to the IOOBE this patch resolves, or were you just improving things while you were in the file?  The two null/empty-check conditionals there seem like generally good defensive coding, so I&apos;m fine with them as long as the tests pass.  Just wanted to make sure I understood them in case there&apos;s something I&apos;m missing.&lt;/p&gt;

&lt;p&gt;Plan on running the tests and then committing this, as long as I hear back from you with confirmation about that logic.&lt;/p&gt;

&lt;p&gt;One last question - do you have a specific name/username you would like credited as in the solr/CHANGES.txt file?  I&apos;ll credit you as your JIRA name &quot;Pramod Kumar&quot; unless you want something else in particular.  Some people are particular about it, so it always pays to ask.&lt;/p&gt;</comment>
                            <comment id="17155717" author="pramodkumar9@yahoo.com" created="Fri, 10 Jul 2020 20:59:17 +0000"  >&lt;p&gt;Hey Jason,&lt;/p&gt;

&lt;p&gt;The change in init that checks the default field for emptiness is partly related. That check will ensure that a useless default field is not passed in, and we can error out early.&lt;/p&gt;

&lt;p&gt;The parser checks I ended up doing since I was touching that method anyway.&lt;/p&gt;

&lt;p&gt;Regarding CHANGES.txt, my alias (pramodkumar9) please!&lt;/p&gt;

&lt;p&gt;Thanks for taking a peek Jason.&lt;/p&gt;

&lt;p&gt;Pramod&lt;/p&gt;</comment>
                            <comment id="17161264" author="jira-bot" created="Mon, 20 Jul 2020 13:51:50 +0000"  >&lt;p&gt;Commit 48e92ba9c74ebf204308793d9a00bc48b2780136 in lucene-solr&apos;s branch refs/heads/master from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48e92ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48e92ba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13205&quot; title=&quot;StringIndexOutOfBoundsException in SolrQueryParserBase.getFieldQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13205&quot;&gt;&lt;del&gt;SOLR-13205&lt;/del&gt;&lt;/a&gt;: Improve empty-string handling in SolrQueryParserBase&lt;/p&gt;

&lt;p&gt;Contributed-By: pramodkumar9&lt;/p&gt;</comment>
                            <comment id="17161267" author="gerlowskija" created="Mon, 20 Jul 2020 13:56:57 +0000"  >&lt;p&gt;Thanks for the contribution Pramod.  Congrats on your first commit!&lt;/p&gt;

&lt;p&gt;I&apos;ve merged this to master which means it&apos;ll be in 9.0 for sure.  I also plan on merging to branch_8x so that this will be in 8.7, but want to keep an eye on test runs for a few days first - make sure nothing shakes out that worked locally but fails in other situations.  I&apos;ll close this out when I merge then.&lt;/p&gt;</comment>
                            <comment id="17161490" author="jira-bot" created="Mon, 20 Jul 2020 19:42:15 +0000"  >&lt;p&gt;Commit 48e92ba9c74ebf204308793d9a00bc48b2780136 in lucene-solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-9312&quot; title=&quot;Allow builds against arbitrary JVMs (even those unsupported by gradle)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-9312&quot;&gt;&lt;del&gt;LUCENE-9312&lt;/del&gt;&lt;/a&gt; from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48e92ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48e92ba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13205&quot; title=&quot;StringIndexOutOfBoundsException in SolrQueryParserBase.getFieldQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13205&quot;&gt;&lt;del&gt;SOLR-13205&lt;/del&gt;&lt;/a&gt;: Improve empty-string handling in SolrQueryParserBase&lt;/p&gt;

&lt;p&gt;Contributed-By: pramodkumar9&lt;/p&gt;</comment>
                            <comment id="17163533" author="jira-bot" created="Thu, 23 Jul 2020 12:55:05 +0000"  >&lt;p&gt;Commit 995a6125c246cfa4448eedae3851f9dbd20ef835 in lucene-solr&apos;s branch refs/heads/branch_8x from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=995a612&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=995a612&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13205&quot; title=&quot;StringIndexOutOfBoundsException in SolrQueryParserBase.getFieldQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13205&quot;&gt;&lt;del&gt;SOLR-13205&lt;/del&gt;&lt;/a&gt;: Improve empty-string handling in SolrQueryParserBase&lt;/p&gt;

&lt;p&gt;Contributed-By: pramodkumar9&lt;/p&gt;</comment>
                            <comment id="17163534" author="gerlowskija" created="Thu, 23 Jul 2020 12:55:25 +0000"  >&lt;p&gt;Tests looked clean so I backported this to 8x - will appear in 8.7.&lt;/p&gt;

&lt;p&gt;Thanks again Pramod and welcome to the community!&lt;/p&gt;</comment>
                            <comment id="17163967" author="jira-bot" created="Thu, 23 Jul 2020 21:26:46 +0000"  >&lt;p&gt;Commit 48e92ba9c74ebf204308793d9a00bc48b2780136 in lucene-solr&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14435&quot; title=&quot;createNodeSet and createNodeSet.shuffle parameters missing from Collection Restore RefGuide&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14435&quot;&gt;&lt;del&gt;SOLR-14435&lt;/del&gt;&lt;/a&gt; from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48e92ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48e92ba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13205&quot; title=&quot;StringIndexOutOfBoundsException in SolrQueryParserBase.getFieldQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13205&quot;&gt;&lt;del&gt;SOLR-13205&lt;/del&gt;&lt;/a&gt;: Improve empty-string handling in SolrQueryParserBase&lt;/p&gt;

&lt;p&gt;Contributed-By: pramodkumar9&lt;/p&gt;</comment>
                            <comment id="17164407" author="erickerickson" created="Fri, 24 Jul 2020 12:17:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt;&#160; The new test fails 100% of the time for me (I happened to be testing with branch_8x). Here&apos;s the partial stack trace:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; Throwable #1: java.lang.NullPointerException&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; at org.apache.solr.parser.SolrQueryParserBase.init(SolrQueryParserBase.java:251)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; at org.apache.solr.parser.SolrQueryParserBaseTest.testGetField(SolrQueryParserBaseTest.java:113)&lt;br/&gt;
 [&lt;/p&gt;

&lt;p&gt;SolrQueryParserBase&lt;span class=&quot;error&quot;&gt;&amp;#91;251&amp;#93;&lt;/span&gt; looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!parser.getReq().getCore().getSolrConfig().luceneMatchVersion.onOrAfter(Version.LUCENE_7_2_0)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The getCore() call returns null. IDK whether that should really be guarded against with null checks or whether the test is unrealistic...&lt;/p&gt;</comment>
                            <comment id="17164517" author="jira-bot" created="Fri, 24 Jul 2020 16:25:04 +0000"  >&lt;p&gt;Commit 61dd94540386ed6f9c0178ecae2a73346da50205 in lucene-solr&apos;s branch refs/heads/branch_8x from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=61dd945&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=61dd945&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13205&quot; title=&quot;StringIndexOutOfBoundsException in SolrQueryParserBase.getFieldQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13205&quot;&gt;&lt;del&gt;SOLR-13205&lt;/del&gt;&lt;/a&gt;: Improve empty-string handling in SolrQueryParserBase&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 995a6125c246cfa4448eedae3851f9dbd20ef835.&lt;/p&gt;</comment>
                            <comment id="17164520" author="gerlowskija" created="Fri, 24 Jul 2020 16:27:16 +0000"  >&lt;p&gt;Hey Erick, sorry about that.  I&apos;ve just reverted on branch_8x, so others aren&apos;t affected while I look into this.  This has been on master for a few days and hasn&apos;t failed there afaik, so I&apos;m going to leave it there, unless I hear others are having issues there as well.  It passes consistently for me on master, though &quot;works on my machine&quot; is a very low bar.&lt;/p&gt;

&lt;p&gt;Will look into this over the weekend, thanks for the heads up.&lt;/p&gt;</comment>
                            <comment id="17164632" author="erickerickson" created="Fri, 24 Jul 2020 21:14:04 +0000"  >&lt;p&gt;NP, from one who spammed the dev list with test failures on all Windows test runs recently. Like I should talk... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;If Miller&apos;s fast-n-robust testing works out, it might be less painful to run trunk and trunk-1 tests routinely after we cut 9.0...&lt;/p&gt;</comment>
                            <comment id="17166456" author="gerlowskija" created="Tue, 28 Jul 2020 14:17:31 +0000"  >&lt;p&gt;With this commit, the SolrQueryParserBaseTest fails on branch_8x at the line Erick pointed out above: specifically:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!parser.getReq().getCore().getSolrConfig().luceneMatchVersion.onOrAfter(Version.LUCENE_7_2_0)) { &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue is that the test uses Mockito but doesn&apos;t mock out the call to &lt;tt&gt;SolrQueryRequest.getCore()&lt;/tt&gt;.  This wasn&apos;t necessary on master because this conditional doesn&apos;t exist there.  In fact it looks like it shouldn&apos;t exist on &lt;tt&gt;branch_8x&lt;/tt&gt; either.  There&apos;s a TODO comment immediately preceding this line indicating that it can likely be removed in 8.0.  Now that we&apos;re on 8.7, I &lt;em&gt;think&lt;/em&gt; we&apos;ve run out the back-compat window with luceneMatch &amp;lt;7.2.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;, looks like you added the snippet below along with the TODO to remove it in &quot;8.0&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&quot;.  Do you recall if there was something in particular that gave you pause about the 8.0 removal, or were you possibly just hedging with your question mark in that comment?  If there&apos;s no concrete reason to avoid removal I&apos;ll take this clause out and get this fix back onto branch_8x.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// TODO in 8.0(?) remove &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.  Prior to 7.2 we defaulted to allowing sub-query parsing by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!parser.getReq().getCore().getSolrConfig().luceneMatchVersion.onOrAfter(Version.LUCENE_7_2_0)) {
      setAllowSubQueryParsing(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    } &lt;span class=&quot;code-comment&quot;&gt;// otherwise defaults to &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="17166640" author="dsmiley" created="Tue, 28 Jul 2020 19:11:52 +0000"  >&lt;p&gt;The check is obsolete. &#160;Checking a luceneMatchVersion is nice for a while but eventually it&apos;s too outdated. &#160;I suppose at major version boundaries, we should look for these old checks and remove them. &#160;In this case, I should have made the change only on branch_7x at that time, thus when 8.0 was released, there would be nothing to do. &#160;Looking at &quot;find usages&quot; in my IDE for the &lt;tt&gt;Version.onOrAfter&lt;/tt&gt; call, it appears this is what&apos;s usually done since I see much more calls in branch_8x than on master. &#160;Heck; the few I see remaining on master for specific version were added by me.&lt;/p&gt;</comment>
                            <comment id="17166645" author="gerlowskija" created="Tue, 28 Jul 2020 19:15:49 +0000"  >&lt;p&gt;Awesome, thanks for clarifying David - I wasn&apos;t quite sure what our back-compat expectations were around luceneMatchVersion.&lt;/p&gt;

&lt;p&gt;Will update this and commit to branch_8x shortly.&lt;/p&gt;</comment>
                            <comment id="17167272" author="jira-bot" created="Wed, 29 Jul 2020 14:40:42 +0000"  >&lt;p&gt;Commit c73db65dbf694305489f6d6d92e4c7fd71981a03 in lucene-solr&apos;s branch refs/heads/branch_8x from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c73db65&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c73db65&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13205&quot; title=&quot;StringIndexOutOfBoundsException in SolrQueryParserBase.getFieldQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13205&quot;&gt;&lt;del&gt;SOLR-13205&lt;/del&gt;&lt;/a&gt;: Improve empty-string handling in SolrQueryParserBase&lt;/p&gt;

&lt;p&gt;This was previously committed and reverted on branch_8x due to a test&lt;br/&gt;
failure in the backport.  This updated commit fixes that test failure by&lt;br/&gt;
removing an unnecessary/invalid &apos;luceneMatchVersion&apos; check that wasn&apos;t&lt;br/&gt;
present on other branches.&lt;/p&gt;

&lt;p&gt;Co-authored-by: pramodkumar9&lt;/p&gt;</comment>
                            <comment id="17167275" author="gerlowskija" created="Wed, 29 Jul 2020 14:42:08 +0000"  >&lt;p&gt;Got a fix back on branch_8x. Thanks everyone.&lt;/p&gt;</comment>
                            <comment id="17226151" author="atri" created="Wed, 4 Nov 2020 15:22:04 +0000"  >&lt;p&gt;Closing after the 8.7.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13007155" name="SOLR-13205.patch" size="8368" author="pramodkumar9@yahoo.com" created="Mon, 6 Jul 2020 15:25:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0j1c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>