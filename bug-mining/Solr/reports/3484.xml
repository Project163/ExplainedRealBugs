<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:24:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10832] Using &quot;indexed&quot; PointField for _version_ breaks VersionInfo.getMaxVersionFromIndex</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10832</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If someone configures &lt;tt&gt;&amp;#95;version_&lt;/tt&gt; using a &lt;tt&gt;LongPointField&lt;/tt&gt; which is &lt;tt&gt;indexed=&quot;true&quot;&lt;/tt&gt; then &lt;tt&gt;VersionInfo.getMaxVersionFromIndex()&lt;/tt&gt; will incorrectly assume...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; indexed, then we have terms to get the max from
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (versionField.indexed()) {
      LeafReader leafReader = SlowCompositeReaderWrapper.wrap(searcher.getIndexReader());
      Terms versionTerms = leafReader.terms(versionFieldName);
      &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; max = (versionTerms != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) ? LegacyNumericUtils.getMaxLong(versionTerms) : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...which will not work because Point based fields have no Terms.&lt;/p&gt;

&lt;p&gt;potential work around: configuring &lt;tt&gt;&amp;#95;version_&lt;/tt&gt; to use &lt;tt&gt;indexed=&quot;false&quot; docValues=&quot;true&quot;&lt;/tt&gt; should cause this branch to be skipped and the existing ValueSource/DocValues based fallback to be used.&lt;/p&gt;

&lt;p&gt;We should either:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;figure out if an alternative option exists for determining the &quot;max&quot; value of a LongPointField, and if so use that if &lt;tt&gt;versionField.indexed() &amp;amp;&amp;amp; versionField.getType().isPointField()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;change &lt;tt&gt;VersionInfo.getAndCheckVersionField()&lt;/tt&gt; to check if the version field &lt;tt&gt;IsPointField()&lt;/tt&gt; and if so error unless &lt;tt&gt;indexed=&quot;false&quot; &amp;amp;&amp;amp; docValues=&quot;true&quot;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13077837">SOLR-10832</key>
            <summary>Using &quot;indexed&quot; PointField for _version_ breaks VersionInfo.getMaxVersionFromIndex</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                            <label>numeric-tries-to-points</label>
                    </labels>
                <created>Tue, 6 Jun 2017 23:36:03 +0000</created>
                <updated>Sat, 8 Jun 2019 15:20:13 +0000</updated>
                            <resolved>Thu, 15 Jun 2017 23:10:18 +0000</resolved>
                                                    <fixVersion>6.7</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16039873" author="hossman" created="Tue, 6 Jun 2017 23:36:29 +0000"  >&lt;p&gt;Discovered while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10807&quot; title=&quot; Randomize PointFields in all tests unless explicit reason not to&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10807&quot;&gt;&lt;del&gt;SOLR-10807&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16039894" author="hossman" created="Tue, 6 Jun 2017 23:57:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;figure out if an alternative option exists for determining the &quot;max&quot; value of a LongPointField, ...&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;I haven&apos;t tried this, but i believe what we want is &lt;tt&gt;PointsValues.getMaxPackedValue(IndexReader reader, String field)&lt;/tt&gt; and then (if non-null) feed that into &lt;tt&gt;LongPoint.decodeDimension&lt;/tt&gt; &amp;#8211; although to not violate the FieldTYpe abstractions, we should probably use &lt;tt&gt;versionField.getType().toObject(...)&lt;/tt&gt; (and then assert it&apos;s a Number and use the &lt;tt&gt;longValue()&lt;/tt&gt; after casting)&lt;/p&gt;

&lt;p&gt;(digression: perhaps NumericValueFieldType should provide a &lt;tt&gt;T getMaxValue(SchemaField,IndexReader)&lt;/tt&gt; ?)&lt;/p&gt;</comment>
                            <comment id="16043564" author="hossman" created="Thu, 8 Jun 2017 22:47:12 +0000"  >
&lt;p&gt;I started looking into writting a test for this and noticed we already have a VersionInfoTest that purports to &lt;tt&gt;testMaxIndexedVersionFromIndex&lt;/tt&gt; and &lt;tt&gt;testMaxDocValuesVersionFromIndex&lt;/tt&gt; &amp;#8211; but for some reason this test didn&apos;t fail on my jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10807&quot; title=&quot; Randomize PointFields in all tests unless explicit reason not to&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10807&quot;&gt;&lt;del&gt;SOLR-10807&lt;/del&gt;&lt;/a&gt; branch (even though some CdCr tests, which use &lt;tt&gt;VersionInfo.getMaxVersionFromIndex&lt;/tt&gt;, did)&lt;/p&gt;

&lt;p&gt;Digging in a bit I realized this tests is very misleading: all it currently does is use &lt;tt&gt;UpdateLog.getMaxVersionFromIndex()&lt;/tt&gt; which is essentially just a wrapper around &lt;tt&gt;seedBucketsWithHighestVersion&lt;/tt&gt; that does use &lt;tt&gt;VersionInfo.getMaxVersionFromIndex&lt;/tt&gt; &lt;em&gt;but also looks at the max version from &lt;tt&gt;RecentUpdates&lt;/tt&gt; &lt;b&gt;AND&lt;/b&gt; from seeding a new clock if both are 0!&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In addition: the assertions made about the versions returned makes the test useless for finding this kind of bug: where &lt;tt&gt;VersionInfo.getMaxVersionFromIndex&lt;/tt&gt; always returns null.&lt;/p&gt;

&lt;p&gt;In the attached patch, I first beefed up the meat of the test to actually differentiate between the expected &quot;maxVersionFromUlog&quot; and &quot;vInfoMax&quot; in the case of committed &amp;amp; uncommited docs &amp;#8211; and verified this new test logic passes with Trie fields.  I then updated the 2 schema files used by this test to randomize in point fields, so &lt;tt&gt;testMaxDocValuesVersionFromIndex&lt;/tt&gt; now fails 50% of the time, or you can force it with &lt;tt&gt;-Dsolr.tests.preferPointFields=true&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Before I spend time trying to actaully fix this bug, it would be nice if someone could please sanity check: does these test changes make sense?  (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; &amp;#8211; you wrote this baby, am i misunderstanding anything about it&apos;s intent? any concerns with these changes so far?)&lt;/p&gt;</comment>
                            <comment id="16044489" author="thelabdude" created="Fri, 9 Jun 2017 14:23:59 +0000"  >&lt;p&gt;Changes look good, probably just a weak test originally.&lt;/p&gt;</comment>
                            <comment id="16049744" author="hossman" created="Wed, 14 Jun 2017 22:16:53 +0000"  >&lt;p&gt;hacked up patch showing that &lt;tt&gt;PointValues.getMaxPackedValue&lt;/tt&gt; gets the test working.&lt;/p&gt;

&lt;p&gt;Still need to figure out if it&apos;s worth while to try and abstract some of this decoding down into the FieldType.&lt;/p&gt;</comment>
                            <comment id="16051069" author="hossman" created="Thu, 15 Jun 2017 21:09:16 +0000"  >&lt;p&gt;revised path using the FieldType.toObject abstraction for the versionField.&lt;/p&gt;

&lt;p&gt;All tests and precommit pass on master.&lt;/p&gt;
</comment>
                            <comment id="16051190" author="jira-bot" created="Thu, 15 Jun 2017 23:09:59 +0000"  >&lt;p&gt;Commit 45af5576a5cbf2e20b9576a200b852042ad76ec1 in lucene-solr&apos;s branch refs/heads/branch_6x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=45af557&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=45af557&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10832&quot; title=&quot;Using &amp;quot;indexed&amp;quot; PointField for _version_ breaks VersionInfo.getMaxVersionFromIndex&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10832&quot;&gt;&lt;del&gt;SOLR-10832&lt;/del&gt;&lt;/a&gt;: Fixed VersionInfo.getMaxVersionFromIndex when using PointsField with indexed=&quot;true&quot;&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 274971c3e331b68e5f7ea2669024215b8017ff7a)&lt;/p&gt;</comment>
                            <comment id="16051191" author="jira-bot" created="Thu, 15 Jun 2017 23:10:01 +0000"  >&lt;p&gt;Commit 274971c3e331b68e5f7ea2669024215b8017ff7a in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=274971c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=274971c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10832&quot; title=&quot;Using &amp;quot;indexed&amp;quot; PointField for _version_ breaks VersionInfo.getMaxVersionFromIndex&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10832&quot;&gt;&lt;del&gt;SOLR-10832&lt;/del&gt;&lt;/a&gt;: Fixed VersionInfo.getMaxVersionFromIndex when using PointsField with indexed=&quot;true&quot;&lt;/p&gt;</comment>
                            <comment id="16095113" author="hossman" created="Thu, 20 Jul 2017 18:06:46 +0000"  >&lt;p&gt;Bulk editing 27 jiras matching the following JQL query to include the &quot;numeric-tries-to-points label...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(issue in linkedIssues(SOLR-10807) OR issue in linkedIssues(SOLR-8396) OR issue in linkedIssues(SOLR-9995)) AND project = SOLR AND status != CLOSED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;these 27 jiras can be identified by searching for the comment string &quot;20170720hossbulkeditlabel&quot;&lt;/p&gt;

&lt;p&gt;email notification is being suppressed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13077048">SOLR-10807</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13079254">SOLR-10872</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12873178" name="SOLR-10832.patch" size="18034" author="hossman" created="Thu, 15 Jun 2017 21:08:28 +0000"/>
                            <attachment id="12873043" name="SOLR-10832.patch" size="17745" author="hossman" created="Wed, 14 Jun 2017 22:15:36 +0000"/>
                            <attachment id="12872164" name="SOLR-10832.patch" size="13207" author="hossman" created="Thu, 8 Jun 2017 22:47:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fyfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>