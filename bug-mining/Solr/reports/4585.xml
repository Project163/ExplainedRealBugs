<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:46:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14576] HttpCacheHeaderUti.etagCoreCache should not use a SolrCore as key</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14576</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;GC performance is affected when the key is a complex data structure. We can make it&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; WeakIdentityMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, EtagCacheVal&amp;gt; etagCoreCache = WeakIdentityMap.newConcurrentHashMap();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;instead of&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; WeakIdentityMap&amp;lt;SolrCore, EtagCacheVal&amp;gt; etagCoreCache = WeakIdentityMap.newConcurrentHashMap();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13311838">SOLR-14576</key>
            <summary>HttpCacheHeaderUti.etagCoreCache should not use a SolrCore as key</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="noble.paul">Noble Paul</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jun 2020 23:29:21 +0000</created>
                <updated>Fri, 9 Oct 2020 13:58:28 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17142196" author="mdrob" created="Mon, 22 Jun 2020 15:42:47 +0000"  >&lt;p&gt;Do you have GC logs or a heap dump analysis highlighting it? I&apos;d be interested to learn more.&lt;/p&gt;</comment>
                            <comment id="17142500" author="noble.paul" created="Tue, 23 Jun 2020 00:13:13 +0000"  >&lt;p&gt;This was reported by a client and unfortunately I do not have the heap dump.&lt;/p&gt;</comment>
                            <comment id="17143935" author="mdrob" created="Wed, 24 Jun 2020 15:34:09 +0000"  >&lt;p&gt;I&apos;m worried about two things here -&lt;/p&gt;

&lt;p&gt;1) Using String as a key in an Identity HashMap seems dubious, but probably not any more dubious than the SolrCore itself.&lt;br/&gt;
2) Would the liveness of the the String be different than the liveness of the SolrCore? i.e. would it be possible that the SolrCore is GC&apos;d but that the String is still around because there are other references to it? I think this is fairly likely actually, but I don&apos;t have any analysis to prove it.&lt;/p&gt;

&lt;p&gt;I&apos;m -1 on this change as is. Would like to see some tests around it, or some profiler analysis that shows we should be worried about things here before we start making changes.&lt;/p&gt;</comment>
                            <comment id="17144561" author="noble.paul" created="Thu, 25 Jun 2020 00:40:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;Using String as a key in an Identity HashMap seems dubious, but probably not any more dubious than the SolrCore itself.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;True &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;. That&apos;s my concern as well. JVMs intern the Strings and there is a very good chance that the Object lingers on. I think we should have a &lt;tt&gt;new Object()&lt;/tt&gt; inside &lt;tt&gt;SolrCore&lt;/tt&gt; and use that as a key to avoid that problem&lt;/p&gt;</comment>
                            <comment id="17172059" author="noble.paul" created="Thu, 6 Aug 2020 06:24:31 +0000"  >&lt;p&gt;I&apos;ve changed it to UUID as the key. Plan to commit this soon&lt;/p&gt;</comment>
                            <comment id="17210149" author="jira-bot" created="Thu, 8 Oct 2020 11:09:02 +0000"  >&lt;p&gt;Commit 8c41418c0fb33fdc0ee6aedbd52917c63b447756 in lucene-solr&apos;s branch refs/heads/master from Noble Paul&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8c41418&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8c41418&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14576&quot; title=&quot;HttpCacheHeaderUti.etagCoreCache should not use a SolrCore as key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14576&quot;&gt;SOLR-14576&lt;/a&gt; : Do not use SolrCore as keys in a WeakHashMap (#1586)&lt;/p&gt;
</comment>
                            <comment id="17210154" author="jira-bot" created="Thu, 8 Oct 2020 11:28:11 +0000"  >&lt;p&gt;Commit ad7ad02238de8a61bc32673e553178792f711445 in lucene-solr&apos;s branch refs/heads/branch_8x from Noble Paul&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14576&quot; title=&quot;HttpCacheHeaderUti.etagCoreCache should not use a SolrCore as key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14576&quot;&gt;SOLR-14576&lt;/a&gt; : Do not use SolrCore as keys in a WeakHashMap (#1586)&lt;/p&gt;
</comment>
                            <comment id="17210157" author="jira-bot" created="Thu, 8 Oct 2020 11:31:06 +0000"  >&lt;p&gt;Commit ad7ad02238de8a61bc32673e553178792f711445 in lucene-solr&apos;s branch refs/heads/branch_8x from Noble Paul&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14576&quot; title=&quot;HttpCacheHeaderUti.etagCoreCache should not use a SolrCore as key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14576&quot;&gt;SOLR-14576&lt;/a&gt; : Do not use SolrCore as keys in a WeakHashMap (#1586)&lt;/p&gt;
</comment>
                            <comment id="17210159" author="jira-bot" created="Thu, 8 Oct 2020 11:32:51 +0000"  >&lt;p&gt;Commit ad7ad02238de8a61bc32673e553178792f711445 in lucene-solr&apos;s branch refs/heads/branch_8x from Noble Paul&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14576&quot; title=&quot;HttpCacheHeaderUti.etagCoreCache should not use a SolrCore as key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14576&quot;&gt;SOLR-14576&lt;/a&gt; : Do not use SolrCore as keys in a WeakHashMap (#1586)&lt;/p&gt;
</comment>
                            <comment id="17210160" author="jira-bot" created="Thu, 8 Oct 2020 11:34:03 +0000"  >&lt;p&gt;Commit ad7ad02238de8a61bc32673e553178792f711445 in lucene-solr&apos;s branch refs/heads/branch_8x from Noble Paul&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14576&quot; title=&quot;HttpCacheHeaderUti.etagCoreCache should not use a SolrCore as key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14576&quot;&gt;SOLR-14576&lt;/a&gt; : Do not use SolrCore as keys in a WeakHashMap (#1586)&lt;/p&gt;
</comment>
                            <comment id="17210161" author="jira-bot" created="Thu, 8 Oct 2020 11:34:12 +0000"  >&lt;p&gt;Commit ad7ad02238de8a61bc32673e553178792f711445 in lucene-solr&apos;s branch refs/heads/branch_8x from Noble Paul&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ad7ad02&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14576&quot; title=&quot;HttpCacheHeaderUti.etagCoreCache should not use a SolrCore as key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14576&quot;&gt;SOLR-14576&lt;/a&gt; : Do not use SolrCore as keys in a WeakHashMap (#1586)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fx2g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>