<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:33:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12314] ConcurrentUpdateSolrClient doesn&apos;t respect the timeout&apos;s defined in the solr.xml file</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12314</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In ConcurrentUpdateSolrClient we create an HttpPost Request which allows you to set a request config. If the request config is not provided httpclient will use the default request config.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.http.client.config.RequestConfig.Builder requestConfigBuilder = HttpClientUtil.createDefaultRequestConfigBuilder();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (soTimeout != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  requestConfigBuilder.setSocketTimeout(soTimeout);
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connectionTimeout != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  requestConfigBuilder.setConnectTimeout(connectionTimeout);
}

method.setConfig(requestConfigBuilder.build());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;While creating the httpclient object we ensure that the default request is set with the properties we care about.&#160; This happens in HttpClientUtils#setupBuilder&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RequestConfig requestConfig = requestConfigBuilder.build();

HttpClientBuilder retBuilder = builder.setDefaultRequestConfig(requestConfig);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So there is no need to set a per request config&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here is&#160;where the httpclient picks the request config is provided on the request itself : &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/4.5.3/httpclient/src/main/java/org/apache/http/impl/client/InternalHttpClient.java#L168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/4.5.3/httpclient/src/main/java/org/apache/http/impl/client/InternalHttpClient.java#L168&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And if it&apos;s not provided it uses the default here :&#160;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/4.5.3/httpclient/src/main/java/org/apache/http/impl/client/InternalHttpClient.java#L148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/4.5.3/httpclient/src/main/java/org/apache/http/impl/client/InternalHttpClient.java#L148&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13157330">SOLR-12314</key>
            <summary>ConcurrentUpdateSolrClient doesn&apos;t respect the timeout&apos;s defined in the solr.xml file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 May 2018 01:45:03 +0000</created>
                <updated>Sat, 8 Jun 2019 15:14:18 +0000</updated>
                            <resolved>Mon, 28 May 2018 18:37:25 +0000</resolved>
                                                    <fixVersion>7.4</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16464561" author="varunthacker" created="Sat, 5 May 2018 01:52:48 +0000"  >&lt;p&gt;Quick patch. I&apos;ll run some tests now.&#160;&lt;/p&gt;

&lt;p&gt;The other usages of HttpClientUtil.createDefaultRequestConfigBuilder() looked okay to me.&lt;/p&gt;</comment>
                            <comment id="16464573" author="markrmiller@gmail.com" created="Sat, 5 May 2018 02:29:44 +0000"  >&lt;p&gt;We can&apos;t just remove it though. The CUSC timeout setters still need to work until they are removed.&lt;/p&gt;

&lt;p&gt;They also need to work if set one or both of them - if neither are set, we can just skip the request config object, if both are set, we use it, and if one is set we have to get the right default for the other to set on the request config.&lt;/p&gt;

&lt;p&gt;I think this also breaks the time outs coming from the builder if set that way.&lt;/p&gt;

&lt;p&gt;If you set timeouts on the client itself, they should work - it should only come from elsewhere or a passed in HttpClient object if they are not explicitly set on the client itself.&lt;/p&gt;</comment>
                            <comment id="16464583" author="varunthacker" created="Sat, 5 May 2018 03:01:58 +0000"  >&lt;p&gt;Yeah as soon as you mentioned this on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11881&quot; title=&quot;Retry update requests from leaders to replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11881&quot;&gt;&lt;del&gt;SOLR-11881&lt;/del&gt;&lt;/a&gt; I knew this patch wasn&apos;t the right approach&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Cool - the tricky part is, if only one of the properties of the two is overridden on the client itself on the fly, we still want to pick up the default for the other one.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16466208" author="varunthacker" created="Mon, 7 May 2018 17:17:37 +0000"  >&lt;p&gt;CUSC is a SolrJ public API so as Mark pointed out we can simply omit the socket timeout&apos;s and connection timeout&apos;s that the user is specifying in the constructor.&lt;/p&gt;

&lt;p&gt;In this approach when&#160;StreamingSolrClients creates a CUSC object to send data , we basically read the socket timeout&apos;s and connection timeout&apos;s from the UpdateShardHandler / UpdateShardHandlerConfig and set it explicitly. If the user has specifying none/only one of them then default values will be used for the timeout&apos;s that weren&apos;t specified.&#160;&lt;/p&gt;</comment>
                            <comment id="16469645" author="varunthacker" created="Wed, 9 May 2018 22:59:42 +0000"  >&lt;p&gt;Updated patch with a test case.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mark.miller%40oblivion.ch&quot; class=&quot;user-hover&quot; rel=&quot;mark.miller@oblivion.ch&quot;&gt;mark.miller@oblivion.ch&lt;/a&gt;&#160;&#160;What do you think of this approach?&lt;/p&gt;</comment>
                            <comment id="16469715" author="markrmiller@gmail.com" created="Thu, 10 May 2018 00:01:55 +0000"  >&lt;p&gt;Did you attach latest patch?&lt;/p&gt;</comment>
                            <comment id="16469720" author="varunthacker" created="Thu, 10 May 2018 00:02:54 +0000"  >&lt;p&gt;I thought I had.. My bad.. It&apos;s uploaded now&lt;/p&gt;</comment>
                            <comment id="16469807" author="markrmiller@gmail.com" created="Thu, 10 May 2018 01:51:05 +0000"  >&lt;p&gt;Cool, yeah that looks good to me.&lt;/p&gt;</comment>
                            <comment id="16492878" author="jira-bot" created="Mon, 28 May 2018 18:34:41 +0000"  >&lt;p&gt;Commit 071df6e114c3af51de5545c9363189c8692311c1 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun_saxena&quot; class=&quot;user-hover&quot; rel=&quot;varun_saxena&quot;&gt;varun_saxena&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=071df6e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=071df6e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12314&quot; title=&quot;ConcurrentUpdateSolrClient doesn&amp;#39;t respect the timeout&amp;#39;s defined in the solr.xml file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12314&quot;&gt;&lt;del&gt;SOLR-12314&lt;/del&gt;&lt;/a&gt;: Use http timeout&apos;s defined in solr.xml for creating ConcurrentUpdateSolrClient during indexing requests between leader and replica&lt;/p&gt;</comment>
                            <comment id="16492879" author="jira-bot" created="Mon, 28 May 2018 18:36:53 +0000"  >&lt;p&gt;Commit caebf73758250191fa3895b52ebe1f14375892d0 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun_saxena&quot; class=&quot;user-hover&quot; rel=&quot;varun_saxena&quot;&gt;varun_saxena&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=caebf73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=caebf73&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12314&quot; title=&quot;ConcurrentUpdateSolrClient doesn&amp;#39;t respect the timeout&amp;#39;s defined in the solr.xml file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12314&quot;&gt;&lt;del&gt;SOLR-12314&lt;/del&gt;&lt;/a&gt;: Use http timeout&apos;s defined in solr.xml for creating ConcurrentUpdateSolrClient during indexing requests between leader and replica&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 071df6e)&lt;/p&gt;</comment>
                            <comment id="16492880" author="varunthacker" created="Mon, 28 May 2018 18:37:25 +0000"  >&lt;p&gt;Thanks Mark !&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13171833">SOLR-12550</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12922761" name="SOLR-12314.patch" size="4894" author="varun" created="Thu, 10 May 2018 00:02:40 +0000"/>
                            <attachment id="12922282" name="SOLR-12314.patch" size="3283" author="varun" created="Mon, 7 May 2018 17:14:42 +0000"/>
                            <attachment id="12922124" name="SOLR-12314.patch" size="1255" author="varun" created="Sat, 5 May 2018 01:51:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tdfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>