<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:44:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14595] json.facet subfacet &apos;sort:&quot;index asc&quot;, refine:true&apos; can return diff results using method:enum</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14595</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;jenkins found a failing seed for TestCloudJSONFacetSKGEquiv that has nothing to do with SKG &amp;#8211; it shows that using &lt;tt&gt;method:enum&lt;/tt&gt; can sometimes return different set of buckets then &lt;tt&gt;method:smart&lt;/tt&gt; when computing a facet that uses &lt;tt&gt;&quot;sort&quot;:&quot;index asc&quot;, &quot;refine&quot;:true&lt;/tt&gt; &lt;em&gt;as a subfacet&lt;/em&gt; of some other facet.&lt;/p&gt;

&lt;p&gt;(In all the cases i&apos;ve been able to trigger with more targetted testing, the &quot;parent facet&quot; needs to use a sort option that cause buckets to &quot;sort worse&quot; when more data is known about them &amp;#8211; ie: &quot;count asc&quot; or SKG &amp;#8211; but i haven&apos;t determined if that&apos;s actaully neccessary to trigger the fialure)&lt;/p&gt;

&lt;p&gt;original jenkins failure...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;master jenkins (@ 541fc984e90) ...

   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudJSONFacetSKGEquiv -Dtests.method=testRandom -Dtests.seed=356C5A0B17DE491 -Dtests.multiplier=2 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=en-KN -Dtests.timezone=Asia/Ho_Chi_Minh -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 1.05s | TestCloudJSONFacetSKGEquiv.testRandom &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: rows=0&amp;amp;q=(field_7_multi_sds:19+OR+field_11_multi_sdsS:61+OR+field_8_multi_sdsS:45+OR+field_10_multi_sds:21+OR+field_2_multi_sdsS:28+OR+field_8_multi_sdsS:33+OR+field_10_multi_sds:54+OR+field_12_multi_ss:41)&amp;amp;fore=(field_5_multi_sdsS:48+OR+field_7_multi_sds:24+OR+field_13_multi_sds:61+OR+field_10_multi_sds:32+OR+field_9_multi_ss:45+OR+field_10_multi_sds:16+OR+field_11_multi_sdsS:28+OR+field_2_multi_sdsS:33+OR+field_8_multi_sdsS:43+OR+field_7_multi_sds:9)&amp;amp;back=(field_2_multi_sdsS:5+OR+field_9_multi_ss:16+OR+field_0_multi_ss:40+OR+field_0_multi_ss:16+OR+field_10_multi_sds:34+OR+field_10_multi_sds:58+OR+field_9_multi_ss:15+OR+field_1_multi_sds:44+OR+field_13_multi_sds:51+OR+field_10_multi_sds:21)&amp;amp;json.facet={&quot;facet_1&quot;:{&quot;method&quot;:&quot;${method_val:smart}&quot;,&quot;limit&quot;:12,&quot;sort&quot;:&quot;count+asc&quot;,&quot;refine&quot;:true,&quot;type&quot;:&quot;terms&quot;,&quot;field&quot;:&quot;field_12_multi_ss&quot;,&quot;facet&quot;:{&quot;skg&quot;:{&quot;type&quot;:&quot;func&quot;,&quot;func&quot;:&quot;relatedness($fore,$back)&quot;},&quot;facet_2&quot;:{&quot;method&quot;:&quot;${method_val:smart}&quot;,&quot;limit&quot;:1,&quot;overrequest&quot;:38,&quot;prefix&quot;:&quot;2&quot;,&quot;sort&quot;:&quot;index+asc&quot;,&quot;refine&quot;:true,&quot;type&quot;:&quot;terms&quot;,&quot;field&quot;:&quot;field_3_multi_ss&quot;,&quot;facet&quot;:{&quot;skg&quot;:{&quot;type&quot;:&quot;func&quot;,&quot;func&quot;:&quot;relatedness($fore,$back)&quot;},&quot;facet_3&quot;:{&quot;method&quot;:&quot;${method_val:smart}&quot;,&quot;overrequest&quot;:0,&quot;perSeg&quot;:false,&quot;sort&quot;:&quot;skg+desc&quot;,&quot;refine&quot;:true,&quot;type&quot;:&quot;terms&quot;,&quot;field&quot;:&quot;field_8_multi_idsS&quot;,&quot;facet&quot;:{&quot;skg&quot;:{&quot;type&quot;:&quot;func&quot;,&quot;func&quot;:&quot;relatedness($fore,$back)&quot;}}}}}}}}&amp;amp;_stateVer_=org.apache.solr.search.facet.TestCloudJSONFacetSKGEquiv_collection:4 ===&amp;gt; Mismatch: .facet_1.buckets[8][facet_2].buckets.length:1!=0 using method_val=enum
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13313520">SOLR-14595</key>
            <summary>json.facet subfacet &apos;sort:&quot;index asc&quot;, refine:true&apos; can return diff results using method:enum</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="magibney">Michael Gibney</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Jun 2020 23:19:55 +0000</created>
                <updated>Thu, 12 May 2022 00:26:20 +0000</updated>
                            <resolved>Thu, 27 Jan 2022 02:19:23 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                                    <component>Facet Module</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17145916" author="hossman" created="Thu, 25 Jun 2020 23:22:41 +0000"  >&lt;p&gt;Attaching a test patch that helps demonstrate an example of this failure more succinctly.&lt;/p&gt;

&lt;p&gt;Still need to dig into exactly what&apos;s going wrong here ... it&apos;s giving me a lot of of De-Jae-Vue of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12343&quot; title=&quot;JSON Field Facet refinement can return incorrect counts/stats for sorted buckets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12343&quot;&gt;&lt;del&gt;SOLR-12343&lt;/del&gt;&lt;/a&gt;, but only as a sub-facet with method:enum???&lt;/p&gt;</comment>
                            <comment id="17148259" author="hossman" created="Tue, 30 Jun 2020 02:18:42 +0000"  >&lt;p&gt;Ok, here&apos;s what seems to be happening:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;there is a &quot;parent&quot; facet using a sort that can cause documents to &quot;move down&quot; after refinement (ex: &quot;count asc&quot; or &quot;sum(field) asc&quot;) and a &quot;refine:true&quot; child facet that sorts on &quot;index asc&quot; (which means it &lt;em&gt;may&lt;/em&gt; be processed by &quot;method:stream&quot; if requested)&lt;/li&gt;
	&lt;li&gt;during phase #1, the &quot;parent&quot; facet has some bucket &quot;P_X&quot; returned by both shards
	&lt;ul&gt;
		&lt;li&gt;depending on the shard, the list of buckets returned for the &quot;child&quot; facet under parent bucket &quot;P_X&quot; can be very different, with little/no overlap (ie: imagine all &quot;odd&quot; values&amp;lt;25 on shard1 and all &quot;even&quot; values&amp;lt;25 on shard2)
		&lt;ul&gt;
			&lt;li&gt;if we use &quot;method:stream&quot; then there is &lt;b&gt;no implicit (or user specified explicit) overrequest considered&lt;/b&gt; so fewer total buckets are returned by each shard &lt;em&gt;and there is a &lt;b&gt;higher&lt;/b&gt; chance the shard will return &quot;more:true&quot;&lt;/em&gt;
			&lt;ul&gt;
				&lt;li&gt;ie: &quot;limit:10&quot; with odd/even&amp;lt;25 shards will return 1,3,5,7,9,11,13,15,17,19,&lt;b&gt;more:true&lt;/b&gt; and 2,4,6,8,10,12,14,16,18,20,&lt;b&gt;more:true&lt;/b&gt; from our odd/even shards&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;if we use any other &quot;method&quot; then there is some overrequest done at the shard level (either implicitly or via an explicit param) so we get more buckets returnd by each shard &lt;em&gt;and there is a &lt;b&gt;lower&lt;/b&gt; chance the shard will return &quot;more:true&quot;&lt;/em&gt;
			&lt;ul&gt;
				&lt;li&gt;ie: limit:10 will cause overrequest=5 and our odd/even&amp;lt;25 shards will return 1,3,5,7,9,11,13,15,17,19,&lt;b&gt;21,23,more:false&lt;/b&gt; and 2,4,6,8,10,12,14,16,18,20,&lt;b&gt;22,24,more:false&lt;/b&gt; respectively&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;during phase #2 &quot;P_X&quot; may not be a &quot;competitive&quot; parent bucket, and it may not be considered for refinement
	&lt;ul&gt;
		&lt;li&gt;but after refinement, other buckets may &quot;move down&quot;, and &quot;P_X&quot; may &quot;move up&quot; in the sorted list making it a (complete) bucket to return&lt;/li&gt;
		&lt;li&gt;when considering some &quot;child&quot; facet bucket &quot;C_Y&quot;, to determine if it is &quot;complete&quot;, the only consideration is if we there are any shards that did not return bucket &quot;C_Y&quot; (under &quot;P_X&quot;) but indicated that they have &quot;more:true&quot;
		&lt;ul&gt;
			&lt;li&gt;if phase#1 used &quot;method:stream&quot; and got &quot;more:true&quot; then a bucket &quot;C_Y&quot; not returned by all shards will not be considered complete &lt;em&gt;even though the &quot;index asc&quot; garuntees there&apos;s no chance it exists on any shard that didn&apos;t return it&lt;/em&gt;&lt;/li&gt;
			&lt;li&gt;&lt;b&gt;BUT&lt;/b&gt; if phase#1 used some other &quot;method&quot; then it may have gotten &quot;more:false&quot; from more shards then &quot;method:stream&quot; would have because of the overrequest, and more buckets will be considered &quot;complete&quot;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;...i&apos;ve updated the attached patch to include the smallest possible test of this discrepency can think of in TestJsonFacetRefinement&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Depending on how you look at it, this is either:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;a FacetFieldProcessByTermEnum bug for not supporting/implementing overrequest (either using the implicit hueristic or checking for an explicit param) so we don&apos;t get consistent behavior between various processors during &quot;phase #1&quot;
	&lt;ul&gt;
		&lt;li&gt;&quot;Fixing&quot; this would be fairly straight forward, but would cause &quot;wasted work&quot; (and network traffic) in the per-shard requests for the &quot;common case&quot; usage of FacetFieldProcessByTermEnum&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;a FacetRequestSortedMerger.isBucketComplete() bug, because it only considers wether &quot;shardHasMoreBuckets&quot; but doesn&apos;t consider the sort order and wether or not &quot;having more buckets&quot; has anything to do with if/why a particulr bucket might be returned.
	&lt;ul&gt;
		&lt;li&gt;making this method sophisticated enough to consider wether a bucket &lt;em&gt;might&lt;/em&gt; be returned by a shard that &apos;hasMoreBuckets&quot; given what we know about the facet sort would be pretty hard&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is such an esoteric edge case thta isn&apos;t likely to come up in any &quot;real world&quot; usage of &quot;method:stream&quot; ... so I&apos;m not sure how much effort it&apos;s really worth to try and &quot;fix&quot; this (particularly since it doesn&apos;t cause any &quot;incorrect calculation&quot; type bugs, it only causes fewer buckets to be returned) in a way that won&apos;t hurt performance in the &quot;typical&quot; usage.&lt;/p&gt;

&lt;p&gt;I&apos;m going to think on this a little more, but i suspect that for now i&apos;ll just modify TestCloudJSONFacetSKGEquiv to work around this (either by never testing &quot;index asc&quot; combined with &quot;refine:true&quot;, or perhaps only ever testing &quot;index asc&quot; with &quot;overrequest:0&quot; ... not sure yet)&lt;/p&gt;</comment>
                            <comment id="17151656" author="jira-bot" created="Sun, 5 Jul 2020 20:28:23 +0000"  >&lt;p&gt;Commit fea6c1b9daa243e48297b4ba5a1ece68b8790a5b in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fea6c1b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fea6c1b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14595&quot; title=&quot;json.facet subfacet &amp;#39;sort:&amp;quot;index asc&amp;quot;, refine:true&amp;#39; can return diff results using method:enum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14595&quot;&gt;&lt;del&gt;SOLR-14595&lt;/del&gt;&lt;/a&gt;: add AwaitsFix test to TestJsonFacetRefinement demonstrating problem, and work around to randomized testing in TestCloudJSONFacetSKGEquiv&lt;/p&gt;</comment>
                            <comment id="17151676" author="jira-bot" created="Sun, 5 Jul 2020 22:51:58 +0000"  >&lt;p&gt;Commit 87436b0b9af2aedcf86904dbe78c0c4631d6c551 in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=87436b0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=87436b0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14595&quot; title=&quot;json.facet subfacet &amp;#39;sort:&amp;quot;index asc&amp;quot;, refine:true&amp;#39; can return diff results using method:enum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14595&quot;&gt;&lt;del&gt;SOLR-14595&lt;/del&gt;&lt;/a&gt;: add AwaitsFix test to TestJsonFacetRefinement demonstrating problem, and work around to randomized testing in TestCloudJSONFacetSKGEquiv&lt;/p&gt;

&lt;p&gt;(cherry picked from commit fea6c1b9daa243e48297b4ba5a1ece68b8790a5b)&lt;/p&gt;</comment>
                            <comment id="17151938" author="jira-bot" created="Mon, 6 Jul 2020 10:17:09 +0000"  >&lt;p&gt;Commit fea6c1b9daa243e48297b4ba5a1ece68b8790a5b in lucene-solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14354&quot; title=&quot;HttpShardHandler send requests in async&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14354&quot;&gt;&lt;del&gt;SOLR-14354&lt;/del&gt;&lt;/a&gt; from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fea6c1b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fea6c1b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14595&quot; title=&quot;json.facet subfacet &amp;#39;sort:&amp;quot;index asc&amp;quot;, refine:true&amp;#39; can return diff results using method:enum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14595&quot;&gt;&lt;del&gt;SOLR-14595&lt;/del&gt;&lt;/a&gt;: add AwaitsFix test to TestJsonFacetRefinement demonstrating problem, and work around to randomized testing in TestCloudJSONFacetSKGEquiv&lt;/p&gt;</comment>
                            <comment id="17454278" author="mgibney" created="Mon, 6 Dec 2021 22:42:37 +0000"  >&lt;p&gt;I had been inadvertently coming at this from a different direction: realizing that &lt;tt&gt;overrrequest&lt;/tt&gt; was (largely) irrelevant to the &quot;index sort&quot; case even in non-&quot;enum&quot; &lt;tt&gt;FacetFieldProcessor&lt;/tt&gt;, and actually had a branch lying around that I intended to propose as a PR/optimization.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/solr/pull/447&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR #447&lt;/a&gt; seeks to address this issue by a variant of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;&apos;s first proposal; but rather than causing &lt;tt&gt;FacetFieldProcessorByEnumTermsStream&lt;/tt&gt; to implement overrequest identical to base &lt;tt&gt;FacetFieldProcessor&lt;/tt&gt; (where overrequest doesn&apos;t really make sense anyway for &quot;index&quot; sort), this PR avoids pointless overrequest for &quot;index&quot; sort in the base &lt;tt&gt;FacetFieldProcessor&lt;/tt&gt; class (with the exception of &quot;index&quot; sort specified as &lt;tt&gt;prelim_sort&lt;/tt&gt; &amp;#8211; because maybe someone would do that?).&lt;/p&gt;

&lt;p&gt;Given the side-effect of &lt;tt&gt;overrequest&lt;/tt&gt; on &lt;tt&gt;isBucketComplete&lt;/tt&gt; (the essence of the inconsistency observed in this issue), I&apos;m inclined to think we should unconditionally respect &lt;em&gt;explicit&lt;/em&gt; (non-default) overrequest for the distrib case &amp;#8211; this would only require a minor change. Even if it the &quot;isBucketComplete&quot; side-effect of overrequest feels a little &quot;leaky&quot;, I also don&apos;t see much practical benefit in silently ignoring explicity specified &lt;tt&gt;overrequest&lt;/tt&gt; for &quot;index sort&quot; &amp;#8211; unless, as is &lt;em&gt;not&lt;/em&gt; the case here, ignoring the explicit &lt;tt&gt;overrequest&lt;/tt&gt; would be truly functionally equivalent.&lt;/p&gt;</comment>
                            <comment id="17481402" author="mgibney" created="Mon, 24 Jan 2022 21:24:37 +0000"  >&lt;p&gt;I&apos;d like to commit &lt;a href=&quot;https://github.com/apache/solr/pull/447&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR #447&lt;/a&gt; if possible (tidying up local branches). It&apos;s a fairly minor change, and as Hoss points out, should only practically affect the &quot;edgiest&quot; of edge cases. (In recent commits it also adds some comments that help clarify the logic of when/how default and explicit values are set for &lt;tt&gt;overrequest&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; since you opened this issue, I wanted to make sure you&apos;d seen this PR before I merge it (to make sure it does a decent job of addressing your concerns).&lt;/p&gt;</comment>
                            <comment id="17481479" author="hossman" created="Tue, 25 Jan 2022 01:00:37 +0000"  >&lt;p&gt;Michael: I didn&apos;t directly test your change, but your reasoning and proposed solution seem solid to me - i especially appreciate that you considered the possibility of people explicitly setting overrequest on a &lt;tt&gt;prelim_sort = index asc&lt;/tt&gt; type situation.&lt;/p&gt;

&lt;p&gt;In reading through the diff, i don&apos;t see any flaw with the substance of your change, but have 2 minor nits...&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;re: the situation with negative value that are not&#160; &quot; == -1&quot; ...
	&lt;ul&gt;
		&lt;li&gt;i agree completely this is an oversight, and not intentional behavior ... please don&apos;t document it&lt;/li&gt;
		&lt;li&gt;instead let&apos;s just &quot;fix&quot; overrequest to behave consistently for all values &quot;&amp;lt; 0&quot; (or throw an error if &quot;&amp;lt; -1&quot; if you&apos;d prefer)&lt;/li&gt;
		&lt;li&gt;I completely understand if you&apos;d like to punt this to it&apos;s own Jira for tracking/discussion purposes.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;re: &lt;tt&gt;testIndexAscRefineConsistency&lt;/tt&gt; ..
	&lt;ul&gt;
		&lt;li&gt;if &quot;all&quot; methods do in fact now now behave consistently, why did you change the test to loop over more explicitly listed method names, instead of just looping over &lt;tt&gt;EnumSet.allOf(FacetMethod.class)&lt;/tt&gt; as suggested in the comment you deleted?&lt;/li&gt;
		&lt;li&gt;as things stand, you are redundently testing &lt;tt&gt;&quot;stream&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17482048" author="mgibney" created="Tue, 25 Jan 2022 18:51:28 +0000"  >&lt;p&gt;Thanks, Hoss. I&apos;m happy to remove the explicit negative overrequest &quot;feature&quot; (I agree it&apos;s the best way to go), and I opted for a strict approach. Anyone who was specifying a negative overrequest in this way would likely get different behavior now, so better fail hard than have an insidious change in behavior.&lt;/p&gt;

&lt;p&gt;re: &lt;tt&gt;EnumSet.allOf(FacetMethod.class)&lt;/tt&gt;: yes no need to enumerate these, thanks for pointing that out. Looping over &lt;tt&gt;FacetMethod.values()&lt;/tt&gt; as of &lt;a href=&quot;https://github.com/apache/solr/pull/447/commits/b4f50ae87a3d0b4d0de3dd1aafca5c9566b4a5fe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;b4f50ae8&lt;/a&gt; (functionally equivalent, no need to construct an &lt;tt&gt;EnumSet&lt;/tt&gt;, I think).&lt;/p&gt;

&lt;p&gt;Hoping to commit shortly. I plan to backport to &lt;tt&gt;branch_9x&lt;/tt&gt; I think &amp;#8211; not sure about &lt;tt&gt;branch_9_0&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17482106" author="mgibney" created="Tue, 25 Jan 2022 21:04:40 +0000"  >&lt;p&gt;Pending further feedback, I plan to commit &lt;a href=&quot;https://github.com/apache/solr/pull/447&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR #447&lt;/a&gt; to &lt;tt&gt;main&lt;/tt&gt; tomorrow, and backport to &lt;tt&gt;branch_9x&lt;/tt&gt;. I also plan to backport to &lt;tt&gt;branch_9_0&lt;/tt&gt; unless anyone objects, because this is a very minor change, but paradoxically also one that (via strictly proscribing explicit negative &lt;tt&gt;overrequest&lt;/tt&gt;) could cause client failures in some very unorthodox edge case uses. In other words, backporting to &lt;tt&gt;branch_9_0&lt;/tt&gt; because: 1. a very minor change, and 2. potentially a backcompat issue due to fixing a minor oversight in the JSON Facet API.&lt;/p&gt;</comment>
                            <comment id="17482839" author="jira-bot" created="Thu, 27 Jan 2022 02:05:39 +0000"  >&lt;p&gt;Commit cfacd182dadaff75e8376afd85fa8396a854175e in solr&apos;s branch refs/heads/main from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=cfacd18&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=cfacd18&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14595&quot; title=&quot;json.facet subfacet &amp;#39;sort:&amp;quot;index asc&amp;quot;, refine:true&amp;#39; can return diff results using method:enum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14595&quot;&gt;&lt;del&gt;SOLR-14595&lt;/del&gt;&lt;/a&gt;: Consistent overrequest across different facet methods for `sort:index` JSON Facet field (#447)&lt;/p&gt;
</comment>
                            <comment id="17482840" author="jira-bot" created="Thu, 27 Jan 2022 02:14:09 +0000"  >&lt;p&gt;Commit 521b19c12784146923500505bf34f53f00ba3c68 in solr&apos;s branch refs/heads/branch_9x from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=521b19c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=521b19c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14595&quot; title=&quot;json.facet subfacet &amp;#39;sort:&amp;quot;index asc&amp;quot;, refine:true&amp;#39; can return diff results using method:enum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14595&quot;&gt;&lt;del&gt;SOLR-14595&lt;/del&gt;&lt;/a&gt;: Consistent overrequest across different facet methods for `sort:index` JSON Facet field (#447)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit cfacd182dadaff75e8376afd85fa8396a854175e)&lt;/p&gt;</comment>
                            <comment id="17482843" author="jira-bot" created="Thu, 27 Jan 2022 02:17:52 +0000"  >&lt;p&gt;Commit dbb88060ab62eb0200b0b7ade80cc65aa5748512 in solr&apos;s branch refs/heads/branch_9_0 from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=dbb8806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=dbb8806&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14595&quot; title=&quot;json.facet subfacet &amp;#39;sort:&amp;quot;index asc&amp;quot;, refine:true&amp;#39; can return diff results using method:enum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14595&quot;&gt;&lt;del&gt;SOLR-14595&lt;/del&gt;&lt;/a&gt;: Consistent overrequest across different facet methods for `sort:index` JSON Facet field (#447)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 521b19c12784146923500505bf34f53f00ba3c68)&lt;/p&gt;</comment>
                            <comment id="17483555" author="jira-bot" created="Fri, 28 Jan 2022 04:38:01 +0000"  >&lt;p&gt;Commit cfacd182dadaff75e8376afd85fa8396a854175e in solr&apos;s branch refs/heads/hlDeprecations from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=cfacd18&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=cfacd18&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14595&quot; title=&quot;json.facet subfacet &amp;#39;sort:&amp;quot;index asc&amp;quot;, refine:true&amp;#39; can return diff results using method:enum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14595&quot;&gt;&lt;del&gt;SOLR-14595&lt;/del&gt;&lt;/a&gt;: Consistent overrequest across different facet methods for `sort:index` JSON Facet field (#447)&lt;/p&gt;
</comment>
                            <comment id="17535351" author="janhoy" created="Thu, 12 May 2022 00:26:20 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13006702" name="SOLR-14595.patch" size="4922" author="hossman" created="Tue, 30 Jun 2020 02:17:25 +0000"/>
                            <attachment id="13006473" name="SOLR-14595.patch" size="2358" author="hossman" created="Thu, 25 Jun 2020 23:20:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g7ew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>