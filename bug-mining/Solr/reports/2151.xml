<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:58:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6610] ZkController.publishAndWaitForDownStates always times out when a new cluster is started</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6610</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Using stateFormat=2, our solr always takes a while to start up and spits out this warning line:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;WARN  - 2014-10-08 17:30:24.290; org.apache.solr.cloud.ZkController; Timed out waiting to see all nodes published as DOWN in our cluster state.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looking at the code, this is probably because ZkController.publishAndWaitForDownStates is called in ZkController.init, which gets called via ZkContainer.initZookeeper in CoreContainer.load before any of the stateFormat=2 collection watches are set in the CoreContainer.preRegisterInZk call a few lines later.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12746887">SOLR-6610</key>
            <summary>ZkController.publishAndWaitForDownStates always times out when a new cluster is started</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="mewmewball">Jessica Cheng Mallet</reporter>
                        <labels>
                            <label>solrcloud</label>
                    </labels>
                <created>Thu, 9 Oct 2014 00:57:02 +0000</created>
                <updated>Wed, 2 Oct 2019 17:24:56 +0000</updated>
                            <resolved>Mon, 1 Dec 2014 18:45:40 +0000</resolved>
                                                    <fixVersion>4.10.3</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14165418" author="noble.paul" created="Thu, 9 Oct 2014 17:46:00 +0000"  >&lt;p&gt;Is it in the trunk or in your own internal version?&lt;/p&gt;</comment>
                            <comment id="14165613" author="mewmewball" created="Thu, 9 Oct 2014 19:34:35 +0000"  >&lt;p&gt;We&apos;re seeing it manifested in our own build, but looks like the relevant code in trunk is the same. I did mis-describe it in that I said ZkController.init is called in ZkContainer.initZookeeper, but actually it&apos;s called in the constructor of ZKController, which is constructed in ZkContainer.initZookeeper.&lt;/p&gt;</comment>
                            <comment id="14187127" author="shalinmangar" created="Tue, 28 Oct 2014 17:19:36 +0000"  >&lt;p&gt;The way the ZkController.publishAndWaitForDownStates is written, it checks if the live_nodes exist and then it tries to publish and wait but that&apos;s not really correct. It should check if live_nodes exists and it has at least one childred. Then only we can be sure that there will be an overseer to process the state requests.&lt;/p&gt;

&lt;p&gt;I&apos;ve seen this problem on cluster restarts where ZK already has /live_nodes existing but without any children (which are ephemeral of course). But I&apos;ve never seen this problem on individual node restarts when an overseer exists in the cluster already.&lt;/p&gt;</comment>
                            <comment id="14187156" author="mewmewball" created="Tue, 28 Oct 2014 17:37:31 +0000"  >&lt;p&gt;Shalin, I think you&apos;re right. I misread the code in that publishAndWaitForDownStates&apos;s call to clusterState.getCollection(collectionName) doesn&apos;t actually require a watch since it&apos;ll call out to zookeeper on-demand. This also explains why most of our complaints come for 1 node dev clusters.&lt;/p&gt;</comment>
                            <comment id="14187162" author="noble.paul" created="Tue, 28 Oct 2014 17:39:39 +0000"  >&lt;p&gt;Now that makes sense. This particular problem &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; mentioned happens all the time and it happens when the entire cluster is restarted (in 1 node clusters that is always true)&lt;/p&gt;</comment>
                            <comment id="14187170" author="noble.paul" created="Tue, 28 Oct 2014 17:47:09 +0000"  >&lt;p&gt;This should fix the problem reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14188415" author="jira-bot" created="Wed, 29 Oct 2014 14:56:50 +0000"  >&lt;p&gt;Commit 1635163 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1635163&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1635163&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6610&quot; title=&quot;ZkController.publishAndWaitForDownStates always times out when a new cluster is started&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6610&quot;&gt;&lt;del&gt;SOLR-6610&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14188428" author="jira-bot" created="Wed, 29 Oct 2014 15:11:42 +0000"  >&lt;p&gt;Commit 1635168 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1635168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1635168&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6610&quot; title=&quot;ZkController.publishAndWaitForDownStates always times out when a new cluster is started&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6610&quot;&gt;&lt;del&gt;SOLR-6610&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14230197" author="shalinmangar" created="Mon, 1 Dec 2014 18:32:12 +0000"  >&lt;p&gt;Reopening to backport to 4.10.3&lt;/p&gt;</comment>
                            <comment id="14230221" author="jira-bot" created="Mon, 1 Dec 2014 18:45:29 +0000"  >&lt;p&gt;Commit 1642732 from shalin@apache.org in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1642732&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1642732&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6610&quot; title=&quot;ZkController.publishAndWaitForDownStates always times out when a new cluster is started&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6610&quot;&gt;&lt;del&gt;SOLR-6610&lt;/del&gt;&lt;/a&gt;: Slow startup of new clusters because ZkController.publishAndWaitForDownStates always times out&lt;/p&gt;</comment>
                            <comment id="14332795" author="anshumg" created="Mon, 23 Feb 2015 05:01:57 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12751161">SOLR-6665</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12677642" name="SOLR-6610.patch" size="809" author="noble.paul" created="Tue, 28 Oct 2014 17:47:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20ypz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>