<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:40:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13846] PreemptiveBasicAuthClientBuilderFactory use of static code blocks makes it unreliable in tests</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13846</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;PreemptiveBasicAuthClientBuilderFactory uses static code blocks to initialize global static variables in a way that makes it largely unusable in tests.&lt;/p&gt;

&lt;p&gt;Notably: it uses &lt;tt&gt;System.getProperty(...)&lt;/tt&gt; during classloading to read system properties that then affect the behavior of all future instances &amp;#8211; even if an individual test explicitly sets the system property in question before instaniating instances of this class.&lt;/p&gt;

&lt;p&gt;This means that if two tests that both use instances of PreemptiveBasicAuthClientBuilderFactory run in the same JVM, only the system properties set in the first test will be used by PreemptiveBasicAuthClientBuilderFactory in the &lt;b&gt;second&lt;/b&gt; test (even those the system properties get reset by the test framework between runs)&lt;/p&gt;

&lt;p&gt;There are currently two tests using PreemptiveBasicAuthClientBuilderFactory, and depending on the order they run, one will fail...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ant test -Dtests.jvms=1 &apos;-Dtests.class=*.TestQueryingOnDownCollection|*.BasicAuthOnSingleNodeTest&apos; -Dtests.seed=EC8FB67A91689F48 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=sl -Dtests.timezone=Asia/Baghdad -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
...
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=BasicAuthOnSingleNodeTest -Dtests.method=basicTest -Dtests.seed=EC8FB67A91689F48 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=sl -Dtests.timezone=Asia/Baghdad -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   4.05s | BasicAuthOnSingleNodeTest.basicTest &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.solr.client.solrj.impl.BaseHttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:37047/solr: Expected mime type application/octet-stream but got text/html. &amp;lt;html&amp;gt;
   [junit4]    &amp;gt; &amp;lt;head&amp;gt;
   [junit4]    &amp;gt; &amp;lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot;/&amp;gt;
   [junit4]    &amp;gt; &amp;lt;title&amp;gt;Error 401 Bad credentials&amp;lt;/title&amp;gt;
   [junit4]    &amp;gt; &amp;lt;/head&amp;gt;
   [junit4]    &amp;gt; &amp;lt;body&amp;gt;&amp;lt;h2&amp;gt;HTTP ERROR 401&amp;lt;/h2&amp;gt;
   [junit4]    &amp;gt; &amp;lt;p&amp;gt;Problem accessing /solr/authCollection/select. Reason:
   [junit4]    &amp;gt; &amp;lt;pre&amp;gt;    Bad credentials&amp;lt;/pre&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;hr&amp;gt;&amp;lt;a href=&quot;http://eclipse.org/jetty&quot;&amp;gt;Powered by Jetty:// 9.4.19.v20190610&amp;lt;/a&amp;gt;&amp;lt;hr/&amp;gt;
   [junit4]    &amp;gt; &amp;lt;/body&amp;gt;
   [junit4]    &amp;gt; &amp;lt;/html&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([EC8FB67A91689F48:1E7BA118D5CD927B]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.Http2SolrClient.processErrorsAndResponse(Http2SolrClient.java:696)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.Http2SolrClient.request(Http2SolrClient.java:402)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.Http2SolrClient.request(Http2SolrClient.java:754)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:207)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrClient.query(SolrClient.java:1003)
   [junit4]    &amp;gt; 	at org.apache.solr.security.BasicAuthOnSingleNodeTest.basicTest(BasicAuthOnSingleNodeTest.java:72)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
   [junit4]    &amp;gt; 	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
   [junit4]    &amp;gt; 	at java.base/java.lang.Thread.run(Thread.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13262430">SOLR-13846</key>
            <summary>PreemptiveBasicAuthClientBuilderFactory use of static code blocks makes it unreliable in tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Oct 2019 18:30:55 +0000</created>
                <updated>Tue, 21 Jan 2020 16:57:40 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16952199" author="hossman" created="Tue, 15 Oct 2019 18:33:16 +0000"  >&lt;p&gt;the really weird thing here, is that both of the tests that currently use PreemptiveBasicAuthClientBuilderFactory use the exact same user:pass combination, so even if the static initialization is bleeding over from one test to the other, it seems like they should still pass....&lt;/p&gt;

&lt;p&gt;Which means something else wonky is happening here.&lt;/p&gt;</comment>
                            <comment id="16952291" author="hossman" created="Tue, 15 Oct 2019 21:08:43 +0000"  >&lt;p&gt;i can&apos;t really wrap my head around how/why it fails the way it does &#8211; but more importantly: nothing in either of these 2 affected tests actual cares about using PreemptiveBasicAuthClientBuilderFactory:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;BasicAuthOnSingleNodeTest explicitly sets the credentials on most requests, and seems to use PreemptiveBasicAuthClientBuilderFactory purely as a way to ensure credentials are set when querying with the &lt;tt&gt;SolrQuery&lt;/tt&gt; API (which doesn&apos;t have credential realted methods
	&lt;ul&gt;
		&lt;li&gt;using the more full featured &lt;tt&gt;QueryRequest&lt;/tt&gt; API in it&apos;s place and setting credentials on those objects works just as well&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;TestQueryingOnDownCollection already explicitly sets the credentials on every request
	&lt;ul&gt;
		&lt;li&gt;removing the initialization of PreemptiveBasicAuthClientBuilderFactory from this test has zero impact on it&apos;s behavior.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;...so i&apos;m going to go ahead and remove PreemptiveBasicAuthClientBuilderFactory from these tests, and leave this issue open for the future to fix PreemptiveBasicAuthClientBuilderFactory so more then one instance could potentially be used in a single JVM.&lt;/p&gt;</comment>
                            <comment id="16952344" author="jira-bot" created="Tue, 15 Oct 2019 22:37:47 +0000"  >&lt;p&gt;Commit 939b3364e604a4a16b3c4c5f278c4d7f30f1354b in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=939b336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=939b336&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13846&quot; title=&quot;PreemptiveBasicAuthClientBuilderFactory use of static code blocks makes it unreliable in tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13846&quot;&gt;SOLR-13846&lt;/a&gt;: workaround - elliminate use of problematic PreemptiveBasicAuthClientBuilderFactory in tests that don&apos;t need it&lt;/p&gt;</comment>
                            <comment id="16952355" author="jira-bot" created="Tue, 15 Oct 2019 22:55:36 +0000"  >&lt;p&gt;Commit 59548c16d36523de61c75881fa5981a629c046cd in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=59548c1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=59548c1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13846&quot; title=&quot;PreemptiveBasicAuthClientBuilderFactory use of static code blocks makes it unreliable in tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13846&quot;&gt;SOLR-13846&lt;/a&gt;: workaround - elliminate use of problematic PreemptiveBasicAuthClientBuilderFactory in tests that don&apos;t need it&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 939b3364e604a4a16b3c4c5f278c4d7f30f1354b)&lt;/p&gt;</comment>
                            <comment id="16953284" author="jira-bot" created="Thu, 17 Oct 2019 00:23:52 +0000"  >&lt;p&gt;Commit 25968e3b75e5e9a4f2a64de10500aae10a257bdd in lucene-solr&apos;s branch refs/heads/branch_8_3 from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=25968e3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=25968e3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13846&quot; title=&quot;PreemptiveBasicAuthClientBuilderFactory use of static code blocks makes it unreliable in tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13846&quot;&gt;SOLR-13846&lt;/a&gt;: workaround - elliminate use of problematic PreemptiveBasicAuthClientBuilderFactory in tests that don&apos;t need it&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 939b3364e604a4a16b3c4c5f278c4d7f30f1354b)&lt;/p&gt;</comment>
                            <comment id="16953559" author="janhoy" created="Thu, 17 Oct 2019 09:38:30 +0000"  >&lt;p&gt;Do you think this test error can be caused by this?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Tests-8.3/56/testReport/junit/org.apache.solr.security/BasicAuthOnSingleNodeTest/basicTest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Tests-8.3/56/testReport/junit/org.apache.solr.security/BasicAuthOnSingleNodeTest/basicTest/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16953881" author="hossman" created="Thu, 17 Oct 2019 16:12:42 +0000"  >&lt;p&gt;Yeah, that&apos;s why i backported the workaround to branch_8_3 right after that failure.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07m7s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>