<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:29:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3428] SolrCmdDistributor flushAdds/flushDeletes problems</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3428</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;A few problems with SolrCmdDistributor.flushAdds/flushDeletes&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If number of AddRequests/DeleteRequests in alist/dlist is below limit for a specific node the method returns immediately and doesnt flush for subsequent nodes&lt;/li&gt;
	&lt;li&gt;When returning immediately because there is below limit requests for a given node, then previous nodes that have already been flushed/submitted are not removed from adds/deletes maps (causing them to be flushed/submitted again the next time flushAdds/flushDeletes is executed)&lt;/li&gt;
	&lt;li&gt;The idea about just combining params does not work for SEEN_LEADER params (and probably others as well). Since SEEN_LEADER cannot be expressed (unlike commitWithin and overwrite) for individual operations in the request, you need to sent two separate submits. One containing requests with SEEN_LEADER=true and one with SEEN_LEADER=false.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12553621">SOLR-3428</key>
            <summary>SolrCmdDistributor flushAdds/flushDeletes problems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="steff1193">Per Steffensen</assignee>
                                    <reporter username="steff1193">Per Steffensen</reporter>
                        <labels>
                            <label>add</label>
                            <label>delete</label>
                            <label>replica</label>
                            <label>solrcloud</label>
                            <label>update</label>
                    </labels>
                <created>Wed, 2 May 2012 13:00:14 +0000</created>
                <updated>Wed, 6 May 2015 14:17:56 +0000</updated>
                            <resolved>Wed, 6 May 2015 14:17:56 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                                    <component>replication (java)</component>
                    <component>SolrCloud</component>
                    <component>update</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13266527" author="steff1193" created="Wed, 2 May 2012 13:02:01 +0000"  >&lt;p&gt;Primitive patch comming up...&lt;/p&gt;</comment>
                            <comment id="13267472" author="steff1193" created="Thu, 3 May 2012 14:36:04 +0000"  >&lt;p&gt;Patch available as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3173&quot; title=&quot;Database semantics - insert and update&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3173&quot;&gt;SOLR-3173&lt;/a&gt;_3178_3382_3428_plus.patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3178&quot; title=&quot;Versioning - optimistic locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3178&quot;&gt;SOLR-3178&lt;/a&gt; - basically as most of the changes in SolrCmdDistributor.&lt;/p&gt;</comment>
                            <comment id="13267490" author="markrmiller@gmail.com" created="Thu, 3 May 2012 15:12:22 +0000"  >&lt;p&gt;Any chance you could break out a test case and fix for this from that? I&apos;d like to see this fixed sooner rather than later, and that patch is fairly large with a lot of unrelated changes in the other issue.&lt;/p&gt;</comment>
                            <comment id="13267858" author="steff1193" created="Thu, 3 May 2012 22:00:05 +0000"  >&lt;p&gt;Well first of all ClassicConsistencyHybridUpdateSemanticsSolrCloudTest (in the patch) is a test that protects the fix from being broken, because it depends on the issues mentioned in the description above being fixed. So if you commit the entire patch attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3178&quot; title=&quot;Versioning - optimistic locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3178&quot;&gt;SOLR-3178&lt;/a&gt; you will have the fix for the issues AND a good test (even though its core focus in not the issues in this &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3428&quot; title=&quot;SolrCmdDistributor flushAdds/flushDeletes problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3428&quot;&gt;&lt;del&gt;SOLR-3428&lt;/del&gt;&lt;/a&gt;) protecting if from being broken again by accident in the future.&lt;/p&gt;

&lt;p&gt;One reason that you probably never found the issues before now, is that it is really hard to detect that requests are forwarded (from non-leader to leader or from leader to replica) multiple times or not at all, if requests always result in idempotent-that-cant-fail-operations only is carried out on server-side. And that has always been the case for update requests until I introduced versioning and unique key constraint errors. Using those features update requests are no longer idempotent and fail-free - an update that succeeds nicely the first time it is carried out will not succeed if it is carried out a second time (DocumentAlreadyExists-, DocumentDoesNotExist- or VersionConflict-error will occur). Because of the fact that updates are idempotent and fail-free, and because we have not finegrained (per document) and typed error propagation (before my patch), it will be kinda hard to construct a (not too artificial, with a lot of mocking in order to simulate unrealistic behaviour) test showing those issues mentioned in the description above (and protecting the fix from being broken in the future). So I guess I would rather not try. &lt;/p&gt;

&lt;p&gt;Instead I really encourage you to have that patch committed. It provides well done features and fixes. I know it is a big patch covering many issues and I have learned for the future to try not to bring so big patches, but basically all the issues are kinda related - versioning and the ability to fail on unique key constraint violations (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3173&quot; title=&quot;Database semantics - insert and update&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3173&quot;&gt;SOLR-3173&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3178&quot; title=&quot;Versioning - optimistic locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3178&quot;&gt;SOLR-3178&lt;/a&gt;) is really not worth much without the ability to report the typed errors back to the client per document (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3382&quot; title=&quot;Finegrained error propagation (focus on multi-document updates)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3382&quot;&gt;SOLR-3382&lt;/a&gt;) and the bugs in this &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3428&quot; title=&quot;SolrCmdDistributor flushAdds/flushDeletes problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3428&quot;&gt;&lt;del&gt;SOLR-3428&lt;/del&gt;&lt;/a&gt; is kinda harmless and therefore hard to provoke in a test as long as everything behind an update request is idempotent and fail-free (which it is before &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3173&quot; title=&quot;Database semantics - insert and update&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3173&quot;&gt;SOLR-3173&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3178&quot; title=&quot;Versioning - optimistic locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3178&quot;&gt;SOLR-3178&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3382&quot; title=&quot;Finegrained error propagation (focus on multi-document updates)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3382&quot;&gt;SOLR-3382&lt;/a&gt;). I really think it is worth it that one or two of you committers spent a day or two understanding the features and fixes in the patch - it will save you much more than the one or two days later, if you have to make the features and fix the bugs yourself.&lt;/p&gt;

&lt;p&gt;So bacially I think it would be a waste of (a lot) of time trying to create a poor (because it will have to be very artificial and unrealistic) test for the issues in this &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3428&quot; title=&quot;SolrCmdDistributor flushAdds/flushDeletes problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3428&quot;&gt;&lt;del&gt;SOLR-3428&lt;/del&gt;&lt;/a&gt;. IMHO you should put your effort into doing whatever it takes to get the big patch committed.&lt;/p&gt;

&lt;p&gt;Regards, Per Steffensen &lt;/p&gt;</comment>
                            <comment id="13427463" author="markrmiller@gmail.com" created="Thu, 2 Aug 2012 17:11:40 +0000"  >&lt;p&gt;I&apos;ve committed the simple fix for the flush issue and added a test.&lt;/p&gt;</comment>
                            <comment id="13429850" author="rcmuir" created="Tue, 7 Aug 2012 03:43:35 +0000"  >&lt;p&gt;rmuir20120906-bulk-40-change&lt;/p&gt;</comment>
                            <comment id="13452225" author="rcmuir" created="Mon, 10 Sep 2012 17:41:59 +0000"  >&lt;p&gt;moving all 4.0 issues not touched in a month to 4.1&lt;/p&gt;</comment>
                            <comment id="13510132" author="markrmiller@gmail.com" created="Tue, 4 Dec 2012 23:51:48 +0000"  >&lt;p&gt;This can likely be closed - at some point I fixed 1 and 2 (adding Per to the CHANGES entries) and added targeted tests for them and I&apos;m not yet convinced that 3 is a problem (which doesn&apos;t guarantee it&apos;s not - but I have not found a situation where it is a problem).&lt;/p&gt;</comment>
                            <comment id="14530609" author="steff1193" created="Wed, 6 May 2015 14:17:56 +0000"  >&lt;p&gt;None of the problems are present in latest code (looking at 5.1.0 release)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237809</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03eqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>