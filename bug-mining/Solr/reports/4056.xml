<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:35:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7557] Solrj doesn&apos;t handle child documents when using queryAndStreamResponse</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7557</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Getting the results from a query that as child documents results in &quot;parsing error&quot; when using SolrClient&apos;s queryAndStreamResponse(), but not when using the regular query() method.&lt;/p&gt;

&lt;p&gt;The bug is caused by StreamingBinaryResponseParser&apos;s JavaBinCodec override of readSolrDocument which always returns null (the document is instead passed to the callback), but JavaBinCodec uses the method to also decode child documents.&lt;/p&gt;

&lt;p&gt;I have fixed this by using a simple nestedLevel variable that can be used to detect if the document being parsed is a child (and should be returned) or a parent (and should be passed to the callback).&lt;/p&gt;

&lt;p&gt;The fix feels kinda hacky, but it is simple. Link to a Github pull request to follow.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12830701">SOLR-7557</key>
            <summary>Solrj doesn&apos;t handle child documents when using queryAndStreamResponse</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="stiost">Stian &#216;sterhaug</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 May 2015 14:23:37 +0000</created>
                <updated>Thu, 14 Mar 2019 13:07:06 +0000</updated>
                            <resolved>Fri, 26 Oct 2018 14:16:44 +0000</resolved>
                                    <version>5.4</version>
                                    <fixVersion>7.6</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>SolrJ</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="14548071" author="githubbot" created="Mon, 18 May 2015 14:26:46 +0000"  >&lt;p&gt;GitHub user stiost opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/148&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7557&quot; title=&quot;Solrj doesn&amp;#39;t handle child documents when using queryAndStreamResponse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7557&quot;&gt;&lt;del&gt;SOLR-7557&lt;/del&gt;&lt;/a&gt;: Fix parsing of child documents using queryAndStreamResponse&lt;/p&gt;

&lt;p&gt;    Details in Jira: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7557&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-7557&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/stiost/lucene-solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stiost/lucene-solr&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/148.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/148.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #148&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3eb060e9d3aa9d3098d4d9043d009e4ee4f321de&lt;br/&gt;
Author: Stian &#216;sterhaug &amp;lt;stian.osterhaug@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-05-18T14:24:31Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7557&quot; title=&quot;Solrj doesn&amp;#39;t handle child documents when using queryAndStreamResponse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7557&quot;&gt;&lt;del&gt;SOLR-7557&lt;/del&gt;&lt;/a&gt;: Fix parsing of child documents using queryAndStreamResponse&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15110235" author="stiost" created="Thu, 21 Jan 2016 07:45:57 +0000"  >&lt;p&gt;The streaming bug with child docs is still present in Solrj 5.4.&lt;/p&gt;</comment>
                            <comment id="16547744" author="marvin.lillehaug" created="Wed, 18 Jul 2018 12:24:03 +0000"  >&lt;p&gt;This is still present in 7.4.0. The above pull request point to some other issue, so I created a new:&#160;&lt;a href=&quot;https://github.com/apache/lucene-solr/pull/421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/421&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16653041" author="marvin.lillehaug" created="Wed, 17 Oct 2018 06:32:02 +0000"  >&lt;p&gt;We have been running with a version of 7.4.0 with this change since my last comment, and this does work.&#160;&lt;/p&gt;

&lt;p&gt;Could anyone give some feedback and merge if no other solutions are suggested?&lt;/p&gt;</comment>
                            <comment id="16663642" author="janhoy" created="Thu, 25 Oct 2018 11:54:50 +0000"  >&lt;p&gt;I don&apos;t have any more elegant solution than this.&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; you may perhaps want to comment on this in light of the&#160;childDocs work you have been doing. Would there be a safer way to detect child docs than incrementing a level counter, and would this all&#160;change when allowing multiple children per master?&lt;/p&gt;

&lt;p&gt;Thanks for the patience even since 2015! Your bumping of the issue on the mailing list&#160;caught my attention, thanks&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marvin.lillehaug&quot; class=&quot;user-hover&quot; rel=&quot;marvin.lillehaug&quot;&gt;marvin.lillehaug&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The unit test is placed in `BasicHttpSolrClientTest`. The only other place I can find a test of the streaming binary writer is `SolrExampleTestsBase#testStreamingRequest`, but that is for testing streaming on request side. In lack of a separate BinaryResponseParserTest I guess it is as good location as any other.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16663790" author="dsmiley" created="Thu, 25 Oct 2018 14:08:49 +0000"  >&lt;p&gt;This PR looks good to me.  It should work both for &quot;anonymous&quot; child docs (as the test here is doing) and the newer field-labelled child docs at any nested depth.&lt;br/&gt;
I do think SolrExampleTestsBase is a better home for this &amp;#8211; either the provided test or extending testStreamingRequest to be more comprehensive for this case.&lt;/p&gt;</comment>
                            <comment id="16663921" author="marvin.lillehaug" created="Thu, 25 Oct 2018 15:38:01 +0000"  >&lt;p&gt;When moving the test as is to&#160;SolrExampleTestsBase it fails for&#160;SolrExampleEmbeddedTest and succeeds for the other five that inherrit&#160;SolrExampleTests.&lt;/p&gt;

&lt;p&gt;The field values when doing queryAndStreamResponse are instances of StoredField, not the value. So&lt;/p&gt;

&lt;p&gt;assertEquals(&quot;parent&quot;, parentDoc.getFieldValue(&quot;id&quot;));&lt;/p&gt;

&lt;p&gt;fails with&#160;&lt;/p&gt;

&lt;blockquote&gt;

&lt;p&gt;java.lang.AssertionError: &lt;br/&gt;
Expected :parent&lt;br/&gt;
Actual :stored,indexed,tokenized,omitNorms,indexOptions=DOCS&amp;lt;id:parent&amp;gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Which is issue&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10198&quot; title=&quot;EmbeddedSolrServer embedded behavior different from HttpSolrClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10198&quot;&gt;SOLR-10198&lt;/a&gt;.&#160;&lt;/p&gt;

&lt;p&gt;I will look into that issue, and may change the test for this issue to just check the number of child docs.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16665208" author="jira-bot" created="Fri, 26 Oct 2018 13:56:17 +0000"  >&lt;p&gt;Commit 6c419454a23dd8149b4dc90f8e5ad9427a2750bd in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marvin.lillehaug&quot; class=&quot;user-hover&quot; rel=&quot;marvin.lillehaug&quot;&gt;marvin.lillehaug&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6c41945&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6c41945&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7557&quot; title=&quot;Solrj doesn&amp;#39;t handle child documents when using queryAndStreamResponse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7557&quot;&gt;&lt;del&gt;SOLR-7557&lt;/del&gt;&lt;/a&gt;: Fix parsing of child documents using queryAndStreamResponse&lt;/p&gt;</comment>
                            <comment id="16665234" author="jira-bot" created="Fri, 26 Oct 2018 14:16:36 +0000"  >&lt;p&gt;Commit 0498cddb3e49bf3d6c1f449b1a0b07ddfe3955bf in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marvin.lillehaug&quot; class=&quot;user-hover&quot; rel=&quot;marvin.lillehaug&quot;&gt;marvin.lillehaug&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0498cdd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0498cdd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7557&quot; title=&quot;Solrj doesn&amp;#39;t handle child documents when using queryAndStreamResponse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7557&quot;&gt;&lt;del&gt;SOLR-7557&lt;/del&gt;&lt;/a&gt;: Fix parsing of child documents using queryAndStreamResponse&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 6c419454a23dd8149b4dc90f8e5ad9427a2750bd)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2evgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>