<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:50:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5983] HTMLStripCharFilter is treating CDATA sections incorrectly</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5983</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>
&lt;p&gt;I&apos;m hammering on this Solr Instance.  I&apos;ve got three cores that I&apos;m using to store millions of small bits of reference data.  I&apos;m using a heavily tweaked Tika to parse xml files and ingest them into Solr, while referencing this data.  So I&apos;m making hundreds of query requests against solr, while also making some substantial posts. (I queue up the posts, in general sending in 100 documents at a time). &lt;/p&gt;

&lt;p&gt;Stack Trace:&lt;/p&gt;

&lt;p&gt;4099640 &lt;span class=&quot;error&quot;&gt;&amp;#91;qtp39890933-24&amp;#93;&lt;/span&gt; WARN  org.eclipse.jetty.servlet.ServletHandler  &#8211; Error for /solr/us_patent_gran&lt;br/&gt;
t/update&lt;br/&gt;
java.lang.AssertionError: Attempting to read past the end of a segment.&lt;br/&gt;
        at org.apache.lucene.analysis.charfilter.HTMLStripCharFilter$TextSegment.nextChar(HTMLStripCharFi&lt;br/&gt;
lter.java:30885)&lt;br/&gt;
        at org.apache.lucene.analysis.charfilter.HTMLStripCharFilter.zzDoEOF(HTMLStripCharFilter.java:311&lt;br/&gt;
50)&lt;br/&gt;
        at org.apache.lucene.analysis.charfilter.HTMLStripCharFilter.nextChar(HTMLStripCharFilter.java:31&lt;br/&gt;
802)&lt;br/&gt;
        at org.apache.lucene.analysis.charfilter.HTMLStripCharFilter.read(HTMLStripCharFilter.java:30829)&lt;br/&gt;
        at org.apache.lucene.analysis.charfilter.HTMLStripCharFilter.read(HTMLStripCharFilter.java:30842)        at org.apache.lucene.analysis.standard.std40.StandardTokenizerImpl40.zzRefill(StandardTokenizerImpl40.java:916)&lt;br/&gt;
        at org.apache.lucene.analysis.standard.std40.StandardTokenizerImpl40.getNextToken(StandardTokenizerImpl40.java:1123)&lt;br/&gt;
        at org.apache.lucene.analysis.standard.StandardTokenizer.incrementToken(StandardTokenizer.java:17&lt;br/&gt;
5)&lt;br/&gt;
        at org.apache.lucene.analysis.payloads.TokenOffsetPayloadTokenFilter.incrementToken(TokenOffsetPa&lt;br/&gt;
yloadTokenFilter.java:45)&lt;br/&gt;
        at org.apache.lucene.analysis.core.LowerCaseFilter.incrementToken(LowerCaseFilter.java:54)&lt;br/&gt;
        at org.apache.lucene.index.DocInverterPerField.processFields(DocInverterPerField.java:182)&lt;br/&gt;
        at org.apache.lucene.index.DocFieldProcessor.processDocument(DocFieldProcessor.java:248)&lt;br/&gt;
        at org.apache.lucene.index.DocumentsWriterPerThread.updateDocument(DocumentsWriterPerThread.java:253)&lt;br/&gt;
        at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:455)&lt;br/&gt;
        at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:1534)&lt;br/&gt;
        at org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:236)&lt;br/&gt;
        at org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:160)&lt;br/&gt;
        at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:&lt;br/&gt;
69)&lt;br/&gt;
        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java&lt;br/&gt;
:51)&lt;br/&gt;
        at org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd(DistributedUpdateProces&lt;br/&gt;
sor.java:704)&lt;br/&gt;
        at org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProces&lt;br/&gt;
sor.java:858)&lt;br/&gt;
        at org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProces&lt;br/&gt;
sor.java:557)&lt;br/&gt;
        at org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:&lt;br/&gt;
100)&lt;br/&gt;
        at org.apache.solr.handler.loader.XMLLoader.processUpdate(XMLLoader.java:247)&lt;br/&gt;
        at org.apache.solr.handler.loader.XMLLoader.load(XMLLoader.java:174)&lt;br/&gt;
        at org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:92)&lt;br/&gt;
        at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.ja&lt;br/&gt;
va:74)&lt;br/&gt;
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)&lt;br/&gt;
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1916)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:780)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:427)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:217)&lt;br/&gt;
        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Rhat - running in AWS Large Instance (4processors, 16gb ram) working in attached storage.&lt;/p&gt;</environment>
        <key id="12708263">SOLR-5983</key>
            <summary>HTMLStripCharFilter is treating CDATA sections incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="danfunk">Dan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Apr 2014 13:53:46 +0000</created>
                <updated>Mon, 9 May 2016 18:53:00 +0000</updated>
                            <resolved>Thu, 17 Apr 2014 06:27:04 +0000</resolved>
                                    <version>4.7.1</version>
                                    <fixVersion>4.8</fixVersion>
                    <fixVersion>4.9</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13968380" author="steve_rowe" created="Mon, 14 Apr 2014 14:10:49 +0000"  >&lt;p&gt;Hi Dan,&lt;/p&gt;

&lt;p&gt;Do you know which document triggered the problem?  If so, can you post it here, ideally in the form you&apos;re indexing (after Tika etc. pre-processing)?&lt;/p&gt;

&lt;p&gt;Steve&lt;/p&gt;</comment>
                            <comment id="13968398" author="danfunk" created="Mon, 14 Apr 2014 14:43:51 +0000"  >&lt;p&gt;Steve, it is an intermittent issue.  I can go back and re-index the same document set without a problem.  &lt;/p&gt;</comment>
                            <comment id="13968407" author="danfunk" created="Mon, 14 Apr 2014 14:54:37 +0000"  >&lt;p&gt;Well, darn it, I just proved myself wrong.  I was able to reproduce it with the same data set.  Please give me a bit to track down the exact file.&lt;/p&gt;</comment>
                            <comment id="13968498" author="danfunk" created="Mon, 14 Apr 2014 16:34:11 +0000"  >&lt;p&gt;Here is the offending solr document that is causing the error.  &lt;/p&gt;</comment>
                            <comment id="13968500" author="danfunk" created="Mon, 14 Apr 2014 16:35:05 +0000"  >&lt;p&gt;Hi Steve, I&apos;ve attached the results of calling toString on the solr document that is causing this error.  &lt;/p&gt;</comment>
                            <comment id="13969036" author="steve_rowe" created="Tue, 15 Apr 2014 00:02:08 +0000"  >&lt;p&gt;Dan,&lt;/p&gt;

&lt;p&gt;Strings of this form (from the &lt;tt&gt;description_html&lt;/tt&gt; field) trigger the exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;!&#8201;[CDATA[Ultraflexible Series Cable]&#8201;]&#8201;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above string alone hits the assert.  The characters between &lt;tt&gt;&amp;lt;!&lt;/tt&gt; and &lt;tt&gt;[CDATA[&lt;/tt&gt;, &lt;tt&gt;]&lt;/tt&gt; and &lt;tt&gt;]&lt;/tt&gt;, and &lt;tt&gt;]&lt;/tt&gt; and &lt;tt&gt;&amp;gt;&lt;/tt&gt; are all U+2009 THIN SPACE.&lt;/p&gt;

&lt;p&gt;I&apos;m working on tracking down why - looks like it&apos;s related to the U+2009 char in front of &lt;tt&gt;[CDATA[&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;By the way, if you&apos;re inserting the U+2009 intentionally to block recognition of CDATA sections and force HTML stripping, an alternate technique is to run text through &lt;tt&gt;HTMLStripCharFilter&lt;/tt&gt; twice.&lt;/p&gt;</comment>
                            <comment id="13969073" author="steve_rowe" created="Tue, 15 Apr 2014 00:34:50 +0000"  >&lt;p&gt;Looks like there are two problems: &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Any chars between &lt;tt&gt;&amp;lt;!&lt;/tt&gt; and &lt;tt&gt;[CDATA[&lt;/tt&gt; should block recognition of a CDATA section, but those chars are now passed through to the output, and a CDATA section is improperly recognized.&lt;/li&gt;
	&lt;li&gt;The immediate cause of the assert is an unclosed CDATA section. &lt;tt&gt;HTMLStripCharFilter&lt;/tt&gt; requires the exact string &lt;tt&gt;]]&amp;gt;&lt;/tt&gt; to close out a CDATA section, following the XML spec.  When a CDATA section is started (even improperly, as in the first problem above), but the CDATA closing string is not found, the assert is hit at end-of-input.  So this is the minimal error-triggering string:&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;![CDATA[
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m working on a fix.&lt;/p&gt;</comment>
                            <comment id="13972331" author="steve_rowe" created="Thu, 17 Apr 2014 05:59:40 +0000"  >&lt;p&gt;Patch fixing the problem. Tests added to &lt;tt&gt;HTMLStripCharFilterTest&lt;/tt&gt;, and extracted redundant char filter testing out into &lt;tt&gt;HTMLStripCharFilterTest.assertHTMLStripsTo()&lt;/tt&gt; methods.&lt;/p&gt;

&lt;p&gt;Committing shortly.&lt;/p&gt;</comment>
                            <comment id="13972337" author="jira-bot" created="Thu, 17 Apr 2014 06:08:19 +0000"  >&lt;p&gt;Commit 1588136 from sarowe@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1588136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1588136&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5983&quot; title=&quot;HTMLStripCharFilter is treating CDATA sections incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5983&quot;&gt;&lt;del&gt;SOLR-5983&lt;/del&gt;&lt;/a&gt;: HTMLStripCharFilter is treating CDATA sections incorrectly&lt;/p&gt;</comment>
                            <comment id="13972341" author="jira-bot" created="Thu, 17 Apr 2014 06:15:32 +0000"  >&lt;p&gt;Commit 1588137 from sarowe@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1588137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1588137&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5983&quot; title=&quot;HTMLStripCharFilter is treating CDATA sections incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5983&quot;&gt;&lt;del&gt;SOLR-5983&lt;/del&gt;&lt;/a&gt;: HTMLStripCharFilter is treating CDATA sections incorrectly (merged trunk r1588136)&lt;/p&gt;</comment>
                            <comment id="13972343" author="jira-bot" created="Thu, 17 Apr 2014 06:24:13 +0000"  >&lt;p&gt;Commit 1588138 from sarowe@apache.org in branch &apos;dev/branches/lucene_solr_4_8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1588138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1588138&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5983&quot; title=&quot;HTMLStripCharFilter is treating CDATA sections incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5983&quot;&gt;&lt;del&gt;SOLR-5983&lt;/del&gt;&lt;/a&gt;: HTMLStripCharFilter is treating CDATA sections incorrectly (merged trunk r1588136)&lt;/p&gt;</comment>
                            <comment id="13972347" author="steve_rowe" created="Thu, 17 Apr 2014 06:27:04 +0000"  >&lt;p&gt;Committed to trunk, branch_4x, and the lucene_solr_4_8 branch.&lt;/p&gt;

&lt;p&gt;Thanks Dan!&lt;/p&gt;</comment>
                            <comment id="13982627" author="thetaphi" created="Sun, 27 Apr 2014 23:26:00 +0000"  >&lt;p&gt;Close issue after release of 4.8.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12640593" name="SOLR-5983.patch" size="28474" author="sarowe" created="Thu, 17 Apr 2014 05:59:40 +0000"/>
                            <attachment id="12640094" name="temp.txt" size="168455" author="danfunk" created="Mon, 14 Apr 2014 16:34:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 30 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ulhr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386850</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>