<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:21:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2116] TikaEntityProcessor does not find parser by default</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2116</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The TikaEntityProcessor does not find the correct document parser by default.&lt;br/&gt;
This is in a two-level DIH config file. I have attached pdflist-data-config.xml and pdflist.xml, the XML file list supplying. To test this, you will need the current 3.x branch or 4.0 trunk.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Set up a Tika-enabled Solr&lt;/li&gt;
	&lt;li&gt;copy any PDF file to /tmp/testfile.pdf&lt;/li&gt;
	&lt;li&gt;copy the pdflist-data-config.xml to your solr/conf&lt;/li&gt;
	&lt;li&gt;and add this snippet to your solrconfig.xml
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&amp;lt;requestHandler name=&lt;span class=&quot;code-quote&quot;&gt;&quot;/pdflist&quot;&lt;/span&gt;
      class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.handler.dataimport.DataImportHandler&quot;&lt;/span&gt;&amp;gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;defaults&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
              &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;config&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;pdflist-data-config.xml&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/requestHandler&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;a href=&quot;http://localhost:8983/solr/pdflist?command=full-import&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/pdflist?command=full-import&lt;/a&gt; will make one document with the id and text fields populated. If you remove this line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; parser=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.tika.parser.pdf.PDFParser&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;from the TikaEntityProcessor entity, the parser will not be found and you will get a document with the &quot;id&quot; field and nothing else.&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12473639">SOLR-2116</key>
            <summary>TikaEntityProcessor does not find parser by default</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="lancenorskog">Lance Norskog</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Sep 2010 00:22:16 +0000</created>
                <updated>Wed, 30 Mar 2011 15:45:38 +0000</updated>
                            <resolved>Sat, 19 Feb 2011 01:57:55 +0000</resolved>
                                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                    <component>contrib - Solr Cell (Tika extraction)</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12909030" author="lancenorskog" created="Mon, 13 Sep 2010 22:33:30 +0000"  >&lt;p&gt;It does not work if the parser= attribute is set to &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;parser=&quot;org.apache.tika.parser.AutoDetectParser
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, the AutoDetectParser does not work.&lt;/p&gt;

&lt;p&gt;Lance&lt;/p&gt;</comment>
                            <comment id="12976986" author="martijn" created="Mon, 3 Jan 2011 22:21:35 +0000"  >&lt;p&gt;I&apos;ve encountered the same issue in my Solr setup. After some digging I found the problem, it is simply not loading classes from the lib directory.&lt;/p&gt;

&lt;p&gt;When no tika config is specified in the data-config.xml, the TikaEntityProcessor tries to load the TikaConfig in the manner specified below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;....
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tikaConfigFile = context.getResolvedEntityAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;tikaConfig&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tikaConfigFile == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  tikaConfig = TikaConfig.getDefaultConfig();
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem with this way of loading the TIkaConfig is, that it doesn&apos;t use the classloader from the SolrResourceLoader and therefore not loading any jars from the solr lib directory. The attached patch resolves the issue that no content is parsed by Tika. I simply use the constructor that requires a ClassLoader as argument. I retrieve the classloader from the SolrCore.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tikaConfigFile = context.getResolvedEntityAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;tikaConfig&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tikaConfigFile == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
   &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; classLoader = context.getSolrCore().getResourceLoader().getClassLoader();
   tikaConfig = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TikaConfig(classLoader);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I haven&apos;t added a test that demonstrates this bug, since it only occurs when Tika libs (and its dependencies) are in the Solr lib directory and I don&apos;t know how to replicate this situation in the solr build. The TestTikaEntityProcessor class doesn&apos;t have this problem since all classes are on the normal classpath when the build is running.&lt;/p&gt;</comment>
                            <comment id="12977067" author="lancenorskog" created="Tue, 4 Jan 2011 01:52:57 +0000"  >&lt;p&gt;Great! I&apos;ll try it out on 3.x and trunk.&lt;/p&gt;

&lt;p&gt;Speaking of Tika, have you ever seen a tikaconfig file? I can&apos;t find on anywhere on the web or the Tika source.&lt;/p&gt;</comment>
                            <comment id="12977072" author="chrismattmann" created="Tue, 4 Jan 2011 02:03:07 +0000"  >&lt;p&gt;Hey Lance,&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Speaking of Tika, have you ever seen a tikaconfig file? I can&apos;t find on anywhere on the web or the Tika source&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In the later versions of Tika (I think since 0.7) we&apos;ve went to an all Service Provider Interface (SPI) mechanism for Parser config and resource loading, obviating the need to have a tika config.xml file:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-317&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-317&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However, you still have the option of specifying and using one. See:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/tika/tags/0.8/tika-core/src/main/java/org/apache/tika/config/TikaConfig.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/tika/tags/0.8/tika-core/src/main/java/org/apache/tika/config/TikaConfig.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can find an example of the XML-based Tika config here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/tika/tags/0.6/tika-core/src/main/resources/org/apache/tika/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/tika/tags/0.6/tika-core/src/main/resources/org/apache/tika/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Part of this is also due to the ParseContext which was introduced also as a configuration mechanism. See:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-275&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-275&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Chris&lt;/p&gt;

</comment>
                            <comment id="12994165" author="dsmiley" created="Sun, 13 Feb 2011 23:19:55 +0000"  >&lt;p&gt;I encountered this bug and fixed it independently just now, just as the patch file here does. This is how Solr Cell configures Tika too.  I encountered this on 3x by using the example-DIH that comes which Solr that includes a core named &quot;tika&quot;.&lt;/p&gt;

&lt;p&gt;Furthermore, I found a configuration bug in that core in solrconfig.xml in which the &amp;lt;dataDir&amp;gt; is specified as opposed to it just defaulting to the correct place. The result is that this core will erroneously use the sample example/solr/data directory which is bad.&lt;/p&gt;

&lt;p&gt;Can a committer please commit the patch and remove the dataDir in that tika core on branch 3x?  This is a bug after all.&lt;/p&gt;</comment>
                            <comment id="12996667" author="hossman" created="Sat, 19 Feb 2011 00:12:56 +0000"  >&lt;p&gt;I don&apos;t fully understand this yet, and it doens&apos;t have a test, but i see a patch and recent comments from david that the bug is really and the patch fixes the bug, so i&apos;m going to look into it.&lt;/p&gt;</comment>
                            <comment id="12996684" author="hossman" created="Sat, 19 Feb 2011 01:57:55 +0000"  >&lt;p&gt;Martijn: thank you very much for the patch.&lt;/p&gt;

&lt;p&gt;you are correct, the way the tests are all currently run, simulating class loader problems like this is pretty much impossible &amp;#8211; even using the hooks we have to spin up a JettyServer wouldn&apos;t really help since it still runs in the same JVM and all the libs are already loaded.&lt;/p&gt;
</comment>
                            <comment id="13013122" author="gsingers" created="Wed, 30 Mar 2011 15:45:38 +0000"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12473297">SOLR-2101</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12467372" name="SOLR-2116.patch" size="3191" author="martijn" created="Mon, 3 Jan 2011 22:21:35 +0000"/>
                            <attachment id="12454173" name="pdflist-data-config.xml" size="964" author="lancenorskog" created="Thu, 9 Sep 2010 00:23:15 +0000"/>
                            <attachment id="12454172" name="pdflist.xml" size="97" author="lancenorskog" created="Thu, 9 Sep 2010 00:23:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5389</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03mpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19112</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>