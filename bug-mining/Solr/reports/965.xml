<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:28:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3623] inconsistent treatment of lucene jars &amp; third-party deps in analysis-extras &amp; uima (in war and in lucene-libs)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3623</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Various dependencies for contrib/analysis-extras are packaged contrib/analysis-extras/lucene-libs (along with instructions in contrib/analysis-extras/README.txt that users need to include them explicitly) even though these jars are already hardcoded into the solr war file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12598865">SOLR-3623</key>
            <summary>inconsistent treatment of lucene jars &amp; third-party deps in analysis-extras &amp; uima (in war and in lucene-libs)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="lancenorskog">Lance Norskog</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Jul 2012 01:10:22 +0000</created>
                <updated>Mon, 9 May 2016 18:57:48 +0000</updated>
                            <resolved>Sun, 26 Aug 2012 21:17:48 +0000</resolved>
                                                    <fixVersion>4.0-BETA</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13417874" author="hossman" created="Thu, 19 Jul 2012 00:03:59 +0000"  >&lt;p&gt;I can&apos;t reproduce any problem with the packaging of analysis-extras.&lt;/p&gt;

&lt;p&gt;What i did...&lt;/p&gt;

&lt;p&gt;1) downloaded &amp;amp; uncompressed the binary package of Solr 4.0.0-ALPHA&lt;/p&gt;

&lt;p&gt;2) noted the following info in contrib/analysis-extras/README.txt ...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Relies upon the following lucene components (in lucene-libs/):

 * lucene-analyzers-icu-X.Y.jar
 * lucene-analyzers-smartcn-X.Y.jar
 * lucene-analyzers-stempel-X.Y.jar
 
And the ICU library (in lib/):

 * icu4j-X.Y.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3) noted the existence of the following jars...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@frisbee:~/tmp/solr-4.0.0-ALPHA-binary/apache-solr-4.0.0-ALPHA$ ls contrib/analysis-extras/lib/*.jar
contrib/analysis-extras/lib/icu4j-4.8.1.1.jar
hossman@frisbee:~/tmp/solr-4.0.0-ALPHA-binary/apache-solr-4.0.0-ALPHA$ ls contrib/analysis-extras/lucene-libs/*.jar
contrib/analysis-extras/lucene-libs/lucene-analyzers-icu-4.0.0-ALPHA.jar
contrib/analysis-extras/lucene-libs/lucene-analyzers-morfologik-4.0.0-ALPHA.jar
contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-4.0.0-ALPHA.jar
contrib/analysis-extras/lucene-libs/lucene-analyzers-stempel-4.0.0-ALPHA.jar
contrib/analysis-extras/lucene-libs/morfologik-fsa-1.5.2.jar
contrib/analysis-extras/lucene-libs/morfologik-polish-1.5.2.jar
contrib/analysis-extras/lucene-libs/morfologik-stemming-1.5.2.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4) made the following additions to the example solrconfig.xml...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;lib dir=&quot;../../contrib/analysis-extras/lib&quot; regex=&quot;.*\.jar&quot; /&amp;gt;
  &amp;lt;lib dir=&quot;../../contrib/analysis-extras/lucene-libs&quot; regex=&quot;.*\.jar&quot; /&amp;gt;
  &amp;lt;lib dir=&quot;../../dist/&quot; regex=&quot;apache-solr-analysis-extras-\d.*\.jar&quot; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;5) made the following additions to the example schema.xml...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   &amp;lt;field name=&quot;icufield&quot; type=&quot;icu&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;
...
    &amp;lt;fieldType name=&quot;icu&quot; class=&quot;solr.TextField&quot;&amp;gt;
      &amp;lt;analyzer&amp;gt;
	&amp;lt;tokenizer class=&quot;solr.ICUTokenizerFactory&quot;/&amp;gt;
      &amp;lt;/analyzer&amp;gt;
    &amp;lt;/fieldType&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;6) ran the example with &quot;java -jar start.jar&quot;&lt;/p&gt;

&lt;p&gt;7) observed no problems.&lt;/p&gt;</comment>
                            <comment id="13418045" author="lancenorskog" created="Thu, 19 Jul 2012 04:15:16 +0000"  >&lt;p&gt;4.0.0.0-ALPHA is old news &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; The build has been rearranged. Please retest against the trunk or 4.x branch. There is no contrib/xx/lucene-libs in the current trunk or 4.x. &lt;/p&gt;

&lt;p&gt;These two lines are the only &amp;lt;lib&amp;gt; directories in solrconfig.xml. This description of the classloader sequence suggests that the /browse VelocityWriter handler should throw exceptions. It works.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &amp;lt;lib dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;../../../dist/&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;apache-solr-velocity-\d.*\.jar&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;lib dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;../../../contrib/velocity/lib&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*\.jar&quot;&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Notice 3 dot-dot-slashes instead of two because the example changed to use collection1.)&lt;/p&gt;
</comment>
                            <comment id="13418096" author="lancenorskog" created="Thu, 19 Jul 2012 06:01:59 +0000"  >&lt;p&gt;The contrib/analysis-extras libraries have three kinds of jars: Solr factories, lucene analyzer classes, and some have external dependencies. In trunk &amp;amp; 4.x the lucene-analyzers-*.jar files are copied into the war file. The apache-solr-analysis-extras jar and the dependent jars are not.&lt;/p&gt;

&lt;p&gt;Except for morfologik&apos;s dependent jars. &lt;tt&gt;lucene/analysis/module-build.xml&lt;/tt&gt; defines a fileset property &lt;tt&gt;analyzers-morfologik.fileset&lt;/tt&gt;. &lt;tt&gt;solr/contrib/analysis-extras/build.xml&lt;/tt&gt; uses this property to copy the morfologik libraries into the war. And if fact a morfologik field type works if you include ../../../dist/apache-solr-analysis-extras-4.0-SNAPSHOT.jar and not the analysis-extras lib/ directory.&lt;/p&gt;

&lt;p&gt;The other analyzers packaged into analysis-extras are icu, phonetic, smartcn and stempel. icu and phonetic have dependent libraries. phonetic requires commons-codec which is already in solr/lib. icu requires icu4j which is not already added to solr. I have tried these two lines in both orders, and neither worked. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &amp;lt;lib dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;../../../contrib/analysis-extras/lib&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*\.jar&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;lib dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;../../../dist/&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;apache-solr-analysis-extras-\d.*\.jar&quot;&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Classloading is broken in the trunk and 4.x.&lt;/p&gt;</comment>
                            <comment id="13418540" author="hossman" created="Thu, 19 Jul 2012 18:27:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;There is no contrib/xx/lucene-libs in the current trunk or 4.x. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;They are created as part of the packaging process, they never exist in a source checkout.&lt;/p&gt;

&lt;p&gt;run &quot;ant create-package&quot; on the 4x branch, and then look inside the resulting package/apache-solr-4.0-SNAPSHOT.tgz...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;apache-solr-4.0-SNAPSHOT/contrib/analysis-extras/lib/icu4j-4.8.1.1.jar
apache-solr-4.0-SNAPSHOT/contrib/analysis-extras/lucene-libs/lucene-analyzers-icu-4.0-SNAPSHOT.jar
apache-solr-4.0-SNAPSHOT/contrib/analysis-extras/lucene-libs/lucene-analyzers-morfologik-4.0-SNAPSHOT.jar
apache-solr-4.0-SNAPSHOT/contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-4.0-SNAPSHOT.jar
apache-solr-4.0-SNAPSHOT/contrib/analysis-extras/lucene-libs/lucene-analyzers-stempel-4.0-SNAPSHOT.jar
apache-solr-4.0-SNAPSHOT/contrib/analysis-extras/lucene-libs/morfologik-fsa-1.5.3.jar
apache-solr-4.0-SNAPSHOT/contrib/analysis-extras/lucene-libs/morfologik-polish-1.5.3.jar
apache-solr-4.0-SNAPSHOT/contrib/analysis-extras/lucene-libs/morfologik-stemming-1.5.3.jar
apache-solr-4.0-SNAPSHOT/dist/apache-solr-analysis-extras-4.0-SNAPSHOT.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;In trunk &amp;amp; 4.x the lucene-analyzers-&amp;#42;.jar files are copied into the war file. The apache-solr-analysis-extras jar and the dependent jars are not.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That i can reproduce...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;WEB-INF/lib/lucene-analyzers-common-4.0-SNAPSHOT.jar
WEB-INF/lib/lucene-analyzers-kuromoji-4.0-SNAPSHOT.jar
WEB-INF/lib/lucene-analyzers-morfologik-4.0-SNAPSHOT.jar
WEB-INF/lib/lucene-analyzers-phonetic-4.0-SNAPSHOT.jar
WEB-INF/lib/morfologik-fsa-1.5.3.jar
WEB-INF/lib/morfologik-polish-1.5.3.jar
WEB-INF/lib/morfologik-stemming-1.5.3.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...and there is definitely an inconsistency here &amp;#8211; if some of the lucene-analyzers-&amp;#42;.jar files are being packaged in the war, then we should not also be putting them in contrib/&amp;#42;/lucene-libs and instructing people that they are a dependency in the README for that contrib.&lt;/p&gt;

&lt;p&gt;It appears that icu4j-&amp;#42;.jar and lucene-analyzers-icu-&amp;#42;.jar are the only two external libs needed to make contrib/analysis-extras work, and we just need to update contrib/analysis-extras/README and contrib/analysis-extras/build.xml to reflect this.&lt;/p&gt;

&lt;p&gt;I added the following to the (packaged) example/solr/collection1/conf/solrconfig.xml...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &amp;lt;lib dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;../../../contrib/analysis-extras/lib&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*\.jar&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;lib dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;../../../contrib/analysis-extras/lucene-libs&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;lucene-analyzers-icu.*\.jar&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;lib dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;../../../dist/&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;apache-solr-analysis-extras-\d.*\.jar&quot;&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...and the &quot;icu&quot; field type seemed to work fine.&lt;/p&gt;</comment>
                            <comment id="13418542" author="hossman" created="Thu, 19 Jul 2012 18:29:58 +0000"  >&lt;p&gt;updating description&lt;/p&gt;</comment>
                            <comment id="13418602" author="rcmuir" created="Thu, 19 Jul 2012 19:32:48 +0000"  >&lt;p&gt;I agree with Hossman. &lt;/p&gt;

&lt;p&gt;I saw this before, and forgot to do anything about it... sorry at some point the 4 morfologik jars moved into the war.&lt;br/&gt;
But this is redundant, if we want them in the jar, we should move the factories out of any contrib.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3977?focusedCommentId=13258480&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13258480&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-3977?focusedCommentId=13258480&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13258480&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The other jars (common, kuromoji, phonetic) are correct, their factories are in solr core.&lt;/p&gt;</comment>
                            <comment id="13419475" author="hossman" created="Fri, 20 Jul 2012 19:32:52 +0000"  >&lt;p&gt;Hmm .. ok, something wonky here i&apos;m missing.&lt;/p&gt;

&lt;p&gt;I started by trying to do the following....&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;svn mv solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/MorfologikFilterFactory.java solr/core/src/java/org/apache/solr/analysis/
svn mv solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/SmartChineseSentenceTokenizerFactory.java solr/core/src/java/org/apache/solr/analysis/
svn mv solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/SmartChineseWordTokenFilterFactory.java solr/core/src/java/org/apache/solr/analysis/
svn mv solr/contrib/analysis-extras/src/java/org/apache/solr/analysis/StempelPolishStemFilterFactory.java solr/core/src/java/org/apache/solr/analysis/
svn mv solr/contrib/analysis-extras/src/test/org/apache/solr/analysis/TestMorfologikFilterFactory.java solr/core/src/test/org/apache/solr/analysis/
svn mv solr/contrib/analysis-extras/src/test/org/apache/solr/analysis/TestSmartChineseFactories.java solr/core/src/test/org/apache/solr/analysis/
cd solr/core
ant test -Dtests.class=\*.analysis.\*
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...my understanding being that the morfologik jars and their lucene counterparts should already be in solr core, so these solr classes and tests should be able to move over w/o any other changes. right?&lt;/p&gt;

&lt;p&gt;But this is causing all sorts of compilation failures related to not finding packages/classes like morfologik.stemming.PolishStemmer, org.apache.lucene.analysis.cn.smart.&amp;#42;, org.apache.lucene.analysis.stempel.&amp;#42;, etc...&lt;/p&gt;

&lt;p&gt;So clearly i&apos;m missing something here in how these dependent jars and classpaths are setup (i haven&apos;t looked ath te build system closely since the ivy change) so i&apos;ll have to dig into this more later today.&lt;/p&gt;

&lt;p&gt;(posting this now in slim hope that sarowe or rmuir see it and say &quot;oh, yeah - the thing you are overlooking is...&quot;)&lt;/p&gt;</comment>
                            <comment id="13419546" author="rcmuir" created="Fri, 20 Jul 2012 20:43:29 +0000"  >&lt;p&gt;a few things:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;only the morfologik jars are misplaced. so there is no lucene-analyzers-smartcn etc in solr core.&lt;/li&gt;
	&lt;li&gt;the morfologik jars may be in the wrong place, but they are not configured in classpaths for solr core (e.g. solr.base.classpath)&lt;/li&gt;
	&lt;li&gt;a quick glance at that reveals other things in that classpath that shouldnt be in there like analyzers-uima.jar (which, should instead be configured in the uima contrib&apos;s classpath only)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13419662" author="hossman" created="Fri, 20 Jul 2012 22:56:32 +0000"  >&lt;p&gt;rmuir: sorry, but i&apos;m totally lost &amp;#8211; too many unspoken assumptions in my comment, and some vagueness in your comments has me turned around...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;only the morfologik jars are misplaced. so there is no lucene-analyzers-smartcn etc in solr core.&lt;/p&gt;&lt;/blockquote&gt;

&lt;ul&gt;
	&lt;li&gt;can you be specific as to what you mean by &quot;the morfologik jars&quot; ? because evidently i don&apos;t have a clue what that means and i missunderstood what you were including in that list originally (i thought you ment all of the anlysis-extra libs that weren&apos;t ICU).&lt;/li&gt;
	&lt;li&gt;can you clarify what you think the &quot;misplaced&quot; location(s) are?&lt;/li&gt;
	&lt;li&gt;are you saying it is good or bad that lucene-analyzers-smartcn is not currently in solr core? (ie: in your opinion, should SmartChinese&amp;#42;Factory move into solr/core ?)&lt;/li&gt;
&lt;/ul&gt;


&lt;blockquote&gt;&lt;p&gt;the morfologik jars may be in the wrong place, but they are not configured in classpaths for solr core (e.g. solr.base.classpath)&lt;/p&gt;&lt;/blockquote&gt;

&lt;ul&gt;
	&lt;li&gt;again: what exactly do you mean by &quot;wrong place&quot; ?&lt;/li&gt;
	&lt;li&gt;am i correct in understanding that you feel they &lt;em&gt;should&lt;/em&gt; be in the war file, but that it is a mistake they are not included in solr.base.classpath at compile time?&lt;/li&gt;
&lt;/ul&gt;


&lt;blockquote&gt;&lt;p&gt;a quick glance at that reveals other things in that classpath that shouldnt be in there like analyzers-uima.jar (which, should instead be configured in the uima contrib&apos;s classpath only)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Skimming the build files ... if i understand correctly how things work in the ivy world ... the crux of the problem appears to be that &quot;lucene-jars-to-solr&quot; uses a fileset which is not equivalent to the &quot;solr.base.classpath&quot; used for compilation &amp;amp; tests ... is that it?&lt;/p&gt;

&lt;p&gt;(A &lt;tt&gt;&amp;lt;path /&amp;gt;&lt;/tt&gt; can contain &quot;&lt;tt&gt;&amp;lt;fileset/&amp;gt;&lt;/tt&gt;&quot;s (and fileset references), and &quot;&lt;tt&gt;&amp;lt;path/&amp;gt;&lt;/tt&gt;&quot;s can be used inside &lt;tt&gt;&amp;lt;copy/&amp;gt;&lt;/tt&gt; &amp;#8211; so it should be easy to eliminate some redundancy here and have most of this in a single &quot;path&quot; refrenced by ID in both &quot;solr.base.classpath&quot; and the &quot;lucene-jars-to-solr&quot; &lt;tt&gt;&amp;lt;copy/&amp;gt;&lt;/tt&gt;)&lt;/p&gt;</comment>
                            <comment id="13419680" author="rcmuir" created="Fri, 20 Jul 2012 23:27:54 +0000"  >&lt;p&gt;Sorry... lemme try to explain in more detail:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;can you be specific as to what you mean by &quot;the morfologik jars&quot; ? because evidently i don&apos;t have a clue what that means and i missunderstood what you were including in that list originally (i thought you ment all of the anlysis-extra libs that weren&apos;t ICU).&lt;/p&gt;&lt;/blockquote&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;WEB-INF/lib/lucene-analyzers-morfologik-4.0-SNAPSHOT.jar &amp;lt;-- this is the lucene integration code (analyzer, tokenfilter)
WEB-INF/lib/morfologik-fsa-1.5.3.jar &amp;lt;-- these 3 jars are dependencies of the above
WEB-INF/lib/morfologik-polish-1.5.3.jar
WEB-INF/lib/morfologik-stemming-1.5.3.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But this does not good for solr users: because the factory (MorfologikFilterFactory.java) is in apache-solr-analysis-extras.jar. Furthermore, I think having this situation (where these files are in the war, but the factory as a plugin) causes classloader hell.&lt;/p&gt;

&lt;p&gt;So with the factory in this contrib module, the jar files should really be going in contrib/analysis-extras/lucene-libs as part of the packaging process just like the other dependencies this contrib module has, otherwise we should move the factory to core (see below)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;are you saying it is good or bad that lucene-analyzers-smartcn is not currently in solr core? (ie: in your opinion, should SmartChinese*Factory move into solr/core ?)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In my opinion, it would be nice because we could have a text_zh configured in the example that indexes chinese as words. Currently to do this, you have to deal with this huge hassle that is this crazy analysis-extras contrib which is a big barrier for indexing Chinese text.&lt;/p&gt;

&lt;p&gt;But thats just my opinion, i hate the contrib in general because I think its a pain to use. The reason it exists was because I initially wanted to integrate smartchinese with solr but there were concerns about it increasing the size of the .war file since the smart chinese jar is 3MB. So I created this contrib and added factories for any analyzers that didnt have factories just as a way of at least providing some help to make them usable. Just FYI: the solr.war is near 20MB now.&lt;/p&gt;

&lt;p&gt;Still, as it is, at least its some way to provide factories for these analyzers versus having none before.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;again: what exactly do you mean by &quot;wrong place&quot; ?&lt;br/&gt;
am i correct in understanding that you feel they should be in the war file, but that it is a mistake they are not included in solr.base.classpath at compile time?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Under the current setup, the factory is in contrib/analysis-extras. the contrib/analysis-extras build logic puts these dependencies into contrib/analysis-extras&apos; classpath so the tests will pass.&lt;/p&gt;

&lt;p&gt;If we want to move the factories to core, then we have to adjust the solr core classpath to then include the jar files instead.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;a quick glance at that reveals other things in that classpath that shouldnt be in there like analyzers-uima.jar (which, should instead be configured in the uima contrib&apos;s classpath only)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Here is contrib/uima/build.xml:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;path id=&quot;classpath&quot;&amp;gt;
    &amp;lt;pathelement path=&quot;${analyzers-uima.jar}&quot;/&amp;gt;
    &amp;lt;path refid=&quot;solr.base.classpath&quot;/&amp;gt;
  &amp;lt;/path&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So its useless to have analyzers-uima in the solr core classpath, because in the current packaging solr core code should not be depending on this jar. And contrib/uima already adds this itself. &lt;/p&gt;</comment>
                            <comment id="13419714" author="hossman" created="Sat, 21 Jul 2012 01:01:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;So with the factory in this contrib module, the jar files should really be going in contrib/analysis-extras/lucene-libs as part of the packaging process just like the other dependencies this contrib module has, otherwise we should move the factory to core (see below)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ok, cool.  part of my missunderstanding was thinking that &amp;#42;morfo&amp;#42;.jar was being included in the war because it was a dependency of something else that was already in solr core.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In my opinion, it would be nice because we could have a text_zh configured in the example that indexes chinese as words. Currently to do this, you have to deal with this huge hassle that is this crazy analysis-extras contrib which is a big barrier for indexing Chinese text.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve generally been a big proponent of the &quot;small war&quot; philosophy, but i certainly appreciate the value/importance of having a clean out of hte box experience for all langauges &amp;#8211; i would definitely be interested to hear what other people think &lt;/p&gt;

&lt;p&gt;For now, assuming that analysis-extras is the &quot;correct&quot; place for these factories to live... &lt;/p&gt;

&lt;p&gt;The attached patch rectifies the inconsistency and cleans up the core classpath / lucene-libs file copying issue (ie: remove the morfo &amp;amp; uima jars from the war) by ensuring that the classpath and copy sources use a common list of jar files (ie: you have to go out of your way to make them different).  A similar common list is used in the anslysis-extras build.xml to prevent them from every falling out of sync. I also included some minor fixes to the README files for both analysis-extras and uima&lt;/p&gt;

&lt;p&gt;I&apos;ve done some basic junit/package testing, and things &lt;b&gt;look&lt;/b&gt; like they are working as designed, ... but the one thing that still seems weird to me is the way the morfologik-&amp;#42;.jar files are treated differnetly then the icu4j&amp;#42;.jar...&lt;/p&gt;

&lt;p&gt;solr/contrib/analysis-extras/ivy.xml lists icu4j, and in the final Solr packaging that jar winds up in contrib/analysis-extras/lib (along with it&apos;s LICENSE/NOTICE) &amp;#8211; but for the morfologik-&amp;#42;.jar those are not listed in ivy.xml; instead the &quot;analyzers-morfologik.fileset&quot; is inherited from contrib-build.xml and those jars wind up in contrib/analysis-extras/lucene-libs &amp;#8211; w/o their LICENSE/NOTICE.&lt;/p&gt;

&lt;p&gt;shouldn&apos;t all those third-party jars be treated consistently?&lt;/p&gt;</comment>
                            <comment id="13419717" author="rcmuir" created="Sat, 21 Jul 2012 01:28:50 +0000"  >&lt;p&gt;patch looks good, except I agree with you about the 3rd party jars.&lt;/p&gt;

&lt;p&gt;Lets be consistent on that: &lt;/p&gt;

&lt;p&gt;I think it should be in the ivy.xml, with LICENSE/NOTICE in lib/ &lt;br/&gt;
It would then get pulled into the classpath because its in lib/&lt;/p&gt;</comment>
                            <comment id="13420365" author="hossman" created="Sun, 22 Jul 2012 23:34:48 +0000"  >&lt;p&gt;Yeah ... there&apos;s some risk of dependencies getting out of sync, but it&apos;s still better then not having licenses in the solr binary packages (i&apos;ll open a distinct issue to track brainstorming improvments)&lt;/p&gt;

&lt;p&gt;Ok, new patch, assumes the following svn copy commands which i left out of hte patch to keep it easily readable...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;svn cp ./lucene/analysis/morfologik/lib/morfologik*.sha1 solr/contrib/analysis-extras/lib/
svn cp ./lucene/analysis/morfologik/lib/morfologik*.txt solr/contrib/analysis-extras/lib/
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13420374" author="hossman" created="Mon, 23 Jul 2012 00:09:54 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3664&quot; title=&quot;risk of inconsistency in solr(contrib)-&amp;gt;module-&amp;gt;thirdparty dependencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3664&quot;&gt;&lt;del&gt;SOLR-3664&lt;/del&gt;&lt;/a&gt; to discuss better ways of dealing with this moving forward, but i didn&apos;t want that to slow down fixing this on 4x ASAP&lt;/p&gt;</comment>
                            <comment id="13420750" author="rcmuir" created="Mon, 23 Jul 2012 16:19:10 +0000"  >&lt;p&gt;+1 to commit. I agree lets fix this for now and move forward.&lt;/p&gt;

&lt;p&gt;I ran the svn moves and applied it locally, and did some &quot;tests&quot;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;top-level ant clean-jars + &apos;ant test&apos; from contrib/analysis-extras&lt;/li&gt;
	&lt;li&gt;top-level ant clean-jars + &apos;ant test&apos; from contrib/uima&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Same with the javadocs. All dependencies seem correct to me.&lt;br/&gt;
(one of these days i will look at the ant-unit stuff and figure out a way we can do these kinda checks from every module always to ensure this stuff is working).&lt;/p&gt;
</comment>
                            <comment id="13420822" author="hossman" created="Mon, 23 Jul 2012 17:56:22 +0000"  >&lt;p&gt;Committed revision 1364728. - trunk&lt;br/&gt;
Committed revision 1364738. - 4x&lt;/p&gt;</comment>
                            <comment id="13442195" author="lancenorskog" created="Sun, 26 Aug 2012 21:17:48 +0000"  >&lt;p&gt;Moving jar deployment problem to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3760&quot; title=&quot;Build packaging of complex contrib packages just plain does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3760&quot;&gt;&lt;del&gt;SOLR-3760&lt;/del&gt;&lt;/a&gt; because this issue drifted to licensing problems.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12599789">SOLR-3664</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12599589">SOLR-3653</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12497161">LUCENE-2899</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537529" name="SOLR-3623.patch" size="7267" author="hossman" created="Sun, 22 Jul 2012 23:34:48 +0000"/>
                            <attachment id="12537434" name="SOLR-3623.patch" size="6494" author="hossman" created="Sat, 21 Jul 2012 01:01:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243357</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03dl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17634</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>