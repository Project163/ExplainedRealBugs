<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:39:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13141] CDCR bootstrap does not replicate index to the replicas of target cluster</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13141</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;i have encountered some problems with CDCR that are related to the value of&#160;&lt;tt&gt;replicationFactor&lt;/tt&gt; param.&lt;/p&gt;

&lt;p&gt;I ran the solr cloud&#160;on two datacenters with 2 nodes on each:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;dca:
	&lt;ul&gt;
		&lt;li&gt;dca_node_1&lt;/li&gt;
		&lt;li&gt;dca_node_2&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;dcb
	&lt;ul&gt;
		&lt;li&gt;dcb_node_1&lt;/li&gt;
		&lt;li&gt;dcb_node_2&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Then in sequence:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I configured the CDCR on copy of &lt;b&gt;_default&lt;/b&gt; config set named &lt;b&gt;_default_cdcr&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;I created collection &quot;customer&quot; on both DC from &lt;b&gt;_default_cdcr&lt;/b&gt;&#160;config set with the following parameters:
	&lt;ul&gt;
		&lt;li&gt;&lt;tt&gt;numShards&lt;/tt&gt; = 2&lt;/li&gt;
		&lt;li&gt;&lt;tt&gt;maxShardsPerNode&lt;/tt&gt; = 2&lt;/li&gt;
		&lt;li&gt;&lt;tt&gt;replicationFactor&lt;/tt&gt; = 2&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;I disabled cdcr buffer on collections&lt;/li&gt;
	&lt;li&gt;I ran CDCR on both&#160;DC&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;CDCR has started without errors in logs. During indexation I&#160;have encountered problem&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12955064/12955064_type+2+-+only+few+documents+were+being+replicated.txt&quot; title=&quot;type 2 - only few documents were being replicated.txt attached to SOLR-13141&quot;&gt;type 2 - only few documents were being replicated.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;,&#160;restart didn&apos;t help (documents has not been&#160;synchronized between DC )&lt;/p&gt;

&lt;p&gt;Then:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I stopped CDCR on both DC&lt;/li&gt;
	&lt;li&gt;I stopped all solr nodes&lt;/li&gt;
	&lt;li&gt;I restarted zookeepers on both DC&lt;/li&gt;
	&lt;li&gt;I started all solr nodes one by one&lt;/li&gt;
	&lt;li&gt;few minutes later I stared CDCR on both DC&lt;/li&gt;
	&lt;li&gt;CDCR has starded with errors (replication between DC is not working) -&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12955065/12955065_type+1+-+replication+wasnt+working+at+all.txt&quot; title=&quot;type 1 - replication wasnt working at all.txt attached to SOLR-13141&quot;&gt;type 1 - replication wasnt working at all.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;I&apos;ve also discovered that problems appears only in case, when the &lt;tt&gt;replicationFactor&lt;/tt&gt; parameter is higher than one&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;This is system independent problem&#160;- exists on windows and linux - reproduced&#160;by independent developers&lt;/p&gt;</environment>
        <key id="13209844">SOLR-13141</key>
            <summary>CDCR bootstrap does not replicate index to the replicas of target cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="kwatral">Krzysztof Watral</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Jan 2019 10:04:06 +0000</created>
                <updated>Thu, 12 May 2022 00:26:45 +0000</updated>
                            <resolved>Fri, 9 Aug 2019 03:01:51 +0000</resolved>
                                    <version>7.5</version>
                    <version>7.6</version>
                                    <fixVersion>8.3</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>CDCR</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16743816" author="kwatral" created="Wed, 16 Jan 2019 10:05:46 +0000"  >&lt;p&gt;problem can be related with&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12998&quot; title=&quot;Race condition between requery recovery and the core load completing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12998&quot;&gt;SOLR-12998&lt;/a&gt; (same errors in logs), but in current case it&apos;s not a race condition&lt;/p&gt;</comment>
                            <comment id="16765087" author="timsolr" created="Mon, 11 Feb 2019 15:43:52 +0000"  >&lt;p&gt;Unfortunately I&apos;ve run into the same issues as well. Have not been able to find a work around. &lt;a href=&quot;http://lucene.472066.n3.nabble.com/CDCR-Unable-to-locate-core-td4423181.html#a4423708&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.472066.n3.nabble.com/CDCR-Unable-to-locate-core-td4423181.html#a4423708&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In 7.3 a fix was put in that once cdcr (leader to leader replication) had completed the source collection sends a core recovery command to the target collection&apos;s follower&#160;replicas. However it seems to be sending this to the wrong nodes (hence the unable to locate core error). The&#160;command being sent&#160;to the node of the leader replica instead of the node of the follower replica.&lt;/p&gt;</comment>
                            <comment id="16902877" author="shalinmangar" created="Thu, 8 Aug 2019 11:00:15 +0000"  >&lt;p&gt;Attached patch (originally at &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11724&quot; title=&quot;Cdcr Bootstrapping does not cause &amp;quot;index copying&amp;quot; to follower nodes on Target&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11724&quot;&gt;&lt;del&gt;SOLR-11724&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;A less brittle way than what was proposed for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11724&quot; title=&quot;Cdcr Bootstrapping does not cause &amp;quot;index copying&amp;quot; to follower nodes on Target&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11724&quot;&gt;&lt;del&gt;SOLR-11724&lt;/del&gt;&lt;/a&gt; would be to update the term for the leader once bootstrap finishes. This way the replicas will automatically go to recovery. This latest patch implements this idea.&lt;/p&gt;</comment>
                            <comment id="16903512" author="shalinmangar" created="Fri, 9 Aug 2019 02:42:25 +0000"  >&lt;p&gt;Latest patch that increments the term only if the bootstrap was successful.&lt;/p&gt;</comment>
                            <comment id="16903517" author="jira-bot" created="Fri, 9 Aug 2019 02:59:14 +0000"  >&lt;p&gt;Commit e59f41b6712b4feb9b810b34108a43281c33e515 in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e59f41b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e59f41b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13141&quot; title=&quot;CDCR bootstrap does not replicate index to the replicas of target cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13141&quot;&gt;&lt;del&gt;SOLR-13141&lt;/del&gt;&lt;/a&gt;: CDCR bootstrap does not replicate index to the replicas of target cluster.&lt;/p&gt;

&lt;p&gt;The leader node on the target cluster will now increment its term after bootstrap succeeds so that all replicas of this leader are forced to recover and fetch the latest index from the leader.&lt;/p&gt;</comment>
                            <comment id="16903518" author="jira-bot" created="Fri, 9 Aug 2019 03:00:23 +0000"  >&lt;p&gt;Commit f4dc168301cf5d3b582209c1a9420420ff1c3d64 in lucene-solr&apos;s branch refs/heads/branch_8x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f4dc168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f4dc168&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13141&quot; title=&quot;CDCR bootstrap does not replicate index to the replicas of target cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13141&quot;&gt;&lt;del&gt;SOLR-13141&lt;/del&gt;&lt;/a&gt;: CDCR bootstrap does not replicate index to the replicas of target cluster.&lt;/p&gt;

&lt;p&gt;The leader node on the target cluster will now increment its term after bootstrap succeeds so that all replicas of this leader are forced to recover and fetch the latest index from the leader.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit e59f41b6712b4feb9b810b34108a43281c33e515)&lt;/p&gt;</comment>
                            <comment id="16903519" author="shalinmangar" created="Fri, 9 Aug 2019 03:01:51 +0000"  >&lt;p&gt;Thanks to everyone who reported and investigated this problem.&lt;/p&gt;</comment>
                            <comment id="16957332" author="jsench" created="Tue, 22 Oct 2019 20:26:34 +0000"  >&lt;p&gt;As a temporary workaround, bootstrapping with 1 replica, and then scaling out to multiple replicas after CDCR is enabled appears to work.&lt;/p&gt;</comment>
                            <comment id="16959307" author="jsp08" created="Thu, 24 Oct 2019 23:52:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&#160;Is it possible to back port this fix to solr&#160; 7.7.x. We are running into this issue, and see this error show up whenever we do a server maintenance.&#160;&lt;/p&gt;</comment>
                            <comment id="16959714" author="elyograg" created="Fri, 25 Oct 2019 12:32:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it possible to back port this fix to solr 7.7.x.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The bar is set very high for backporting issues to the previous major version.&#160; Sometimes we will do it, but it must be a severe problem that has no workaround, or a trivial fix that has little chance of causing unintended side effects.&#160; It sounds like there IS a workaround for this problem.&#160; I&apos;m unfamiliar with the code that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; changed to fix the problem, so he will need to say whether the fix is trivial enough to qualify for a maintenance backport.&lt;/p&gt;

&lt;p&gt;One of the nice things about open source projects like this one is that you can do the backport yourself and build a snapshot version to use.&#160; I&apos;ve done this on several occasions.&#160; Just switch branches in a git checkout to branch_7x and apply it there, then in the solr directory, run &quot;ant clean package&quot; on a typical Linux or UNIX system with the JDK&#160; Typical OS tools like ant, zip, perl, and others will need to be installed.&#160; This build target will create .tgz and .zip files that will be similar to the binary Solr download.&lt;/p&gt;</comment>
                            <comment id="17535591" author="janhoy" created="Thu, 12 May 2022 00:26:45 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13122821">SOLR-11724</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12977093" name="SOLR-13141.patch" size="9862" author="shalin" created="Fri, 9 Aug 2019 02:41:46 +0000"/>
                            <attachment id="12977024" name="SOLR-13141.patch" size="9144" author="shalin" created="Thu, 8 Aug 2019 10:59:04 +0000"/>
                            <attachment id="12955065" name="type 1 - replication wasnt working at all.txt" size="18683" author="kwatral" created="Wed, 16 Jan 2019 09:59:53 +0000"/>
                            <attachment id="12955064" name="type 2 - only few documents were being replicated.txt" size="1500" author="kwatral" created="Wed, 16 Jan 2019 09:59:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|y0026g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>