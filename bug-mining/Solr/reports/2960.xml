<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:13:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9080] DateMath is broken before the year 1582</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9080</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In Solr 6.0, dates are parsed using the Java 8 java.time API.  It formerly was parsed using java.util.SimpleDateFormat which uses java.util.GregorianCalendar.  I&apos;ve learned that the java.time API does &lt;em&gt;not&lt;/em&gt; switch to a different algorithm at the Gregorian Change Date (year 1582) whereas GregorianCalendar does.  A ramification of this is that the milliseconds before epoch value is different between the APIs for dates prior to this year.  They both round-trip between themselves but not between each other prior to this date.  Thus, anyone indexing historical dates must re-index when moving to Solr 6.&lt;/p&gt;

&lt;p&gt;What was &lt;em&gt;not&lt;/em&gt; changed in the parsing code was Solr&apos;s date-math logic &amp;#8211; it still uses the Calendar API.  This works for dates after 1582 but before, it&apos;ll introduce discrepancies.  Here&apos;s an example showing weird behavior:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/techproducts/select?facet.range.end=1400-01-01T00:00:00Z&amp;amp;facet.range.gap=%2B10YEARS&amp;amp;facet.range.start=1300-01-01T00:00:00Z/YEAR&amp;amp;facet.range=manufacturedate_dt&amp;amp;facet=on&amp;amp;indent=on&amp;amp;q=*:*&amp;amp;rows=0&amp;amp;wt=json&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/techproducts/select?facet.range.end=1400-01-01T00:00:00Z&amp;amp;facet.range.gap=%2B10YEARS&amp;amp;facet.range.start=1300-01-01T00:00:00Z/YEAR&amp;amp;facet.range=manufacturedate_dt&amp;amp;facet=on&amp;amp;indent=on&amp;amp;q=*:*&amp;amp;rows=0&amp;amp;wt=json&lt;/a&gt;&lt;br/&gt;
Note that the year 1300 rounded down to the year, becomes 1299 January 8th (weird in and of itself) and that subsequent gaps start on the 9th.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;counts&quot;:[
          &quot;1299-01-08T00:00:00Z&quot;,0,
          &quot;1309-01-09T00:00:00Z&quot;,0,
          &quot;1319-01-09T00:00:00Z&quot;,0,  ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This weirdness will show itself for units at the year or month level, but not below that (from what I&apos;m seeing).  In other words, if facet.range.gap is at this amount, or otherwise using the date math syntax to round or add a year or month, there will be issues like this.  Otherwise there doesn&apos;t seem to be an issue.&lt;/p&gt;

&lt;p&gt;I think the solution is clearly to switch the date math code to use the java.time API.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12965708">SOLR-9080</key>
            <summary>DateMath is broken before the year 1582</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 May 2016 20:08:58 +0000</created>
                <updated>Sat, 28 May 2016 13:38:20 +0000</updated>
                            <resolved>Fri, 13 May 2016 14:06:41 +0000</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0.1</fixVersion>
                    <fixVersion>6.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15274732" author="dsmiley" created="Fri, 6 May 2016 21:12:43 +0000"  >&lt;p&gt;Hmmm; modifying DateMathParserTest to change most years to 1234 isn&apos;t showing an issue... need to investigate more.&lt;/p&gt;

&lt;p&gt;DateRangeField has some issues too that I have tests for, to be reported separately.&lt;/p&gt;</comment>
                            <comment id="15275283" author="dsmiley" created="Sat, 7 May 2016 16:00:12 +0000"  >&lt;p&gt;The test said (erroneously) all was well, when I changed the year to 1234 in most test methods, for any of two reasons (or both): the test itself uses SimpleDateFormatter (which uses Calendar) as a source of truth, and because it called directly into the Calendar based utility methods of DateMathParser instead of constructing a String date math expression.&lt;/p&gt;

&lt;p&gt;This patch addresses both of those issues in the test, and changes most years in the test to 1234. I left some where they were because specific dates were used to craft time zone offset functionality.&lt;/p&gt;

&lt;p&gt;And I fixed DateMathParser itself, which was kinda fun.  I removed or made non-public some things that weren&apos;t being used outside of itself or the test.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Note that a &lt;tt&gt;Locale&lt;/tt&gt; is no longer needed/used in this API and it&apos;s dubious if it ever had an effect before, at least based on a comment about impacting when a day of the week starts (who cares?).  Only the DIH DateFormatEvaluator passes something other than Locale.ROOT: it uses Locale.ENGLISH with the ability to pick something else, and it&apos;s not evident it&apos;s tested.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This patch is probably not the final patch as I want to change the DateMathParser&apos;s API that will affect some callers.  &lt;/p&gt;

&lt;p&gt;I&apos;m inclined to think DateMathParser should not be something constructed &amp;#8211; it just needs static methods.  And switch away from java.util.TimeZone to java.time.ZoneId in the API.  Maybe a separate issue for such things.&lt;/p&gt;</comment>
                            <comment id="15281226" author="dsmiley" created="Thu, 12 May 2016 05:42:03 +0000"  >&lt;p&gt;This patch adds a little more testing and it modified the constructor to not take a Locale, thus affecting some callers.  I removed two protected methods in DIH DateFormatEvaluator related to date processing that I don&apos;t think are necessary for subclasses to customize.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this Friday morning and then I&apos;ll post a follow-up issue to refine the DateMathParser API a bit to my liking.&lt;/p&gt;</comment>
                            <comment id="15282711" author="jira-bot" created="Fri, 13 May 2016 14:03:34 +0000"  >&lt;p&gt;Commit 4193e60b9fc1ff12df2267778213ae3b0f04fb84 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4193e60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4193e60&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9080&quot; title=&quot;DateMath is broken before the year 1582&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9080&quot;&gt;&lt;del&gt;SOLR-9080&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9085&quot; title=&quot;DateRangeField is broken before the year 1582&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9085&quot;&gt;&lt;del&gt;SOLR-9085&lt;/del&gt;&lt;/a&gt;: Fix date math before the year 1582.&lt;br/&gt;
note: DateMathParser no longer needs a Locale&lt;/p&gt;</comment>
                            <comment id="15282715" author="jira-bot" created="Fri, 13 May 2016 14:05:47 +0000"  >&lt;p&gt;Commit 9d826ffa2f767d5e75f0844531a5c194b0c04034 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9d826ff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9d826ff&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9080&quot; title=&quot;DateMath is broken before the year 1582&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9080&quot;&gt;&lt;del&gt;SOLR-9080&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9085&quot; title=&quot;DateRangeField is broken before the year 1582&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9085&quot;&gt;&lt;del&gt;SOLR-9085&lt;/del&gt;&lt;/a&gt;: Fix date math before the year 1582.&lt;br/&gt;
note: DateMathParser no longer needs a Locale&lt;br/&gt;
(cherry picked from commit 4193e60)&lt;/p&gt;</comment>
                            <comment id="15283412" author="jira-bot" created="Sat, 14 May 2016 04:26:42 +0000"  >&lt;p&gt;Commit 8309bae5ff11c6c9e5835c60b6f8b08bd810737d in lucene-solr&apos;s branch refs/heads/branch_6_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8309bae&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8309bae&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9080&quot; title=&quot;DateMath is broken before the year 1582&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9080&quot;&gt;&lt;del&gt;SOLR-9080&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9085&quot; title=&quot;DateRangeField is broken before the year 1582&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9085&quot;&gt;&lt;del&gt;SOLR-9085&lt;/del&gt;&lt;/a&gt;: Fix date math before the year 1582.&lt;br/&gt;
note: DateMathParser no longer needs a Locale&lt;br/&gt;
(cherry picked from commit 4193e60)&lt;br/&gt;
(cherry picked from commit 9d826ff)&lt;/p&gt;</comment>
                            <comment id="15305349" author="steve_rowe" created="Sat, 28 May 2016 13:38:20 +0000"  >&lt;p&gt;Bulk close issues included in the 6.0.1 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12965879">SOLR-9085</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12803575" name="SOLR_9080_DateMath_should_not_use_Calendar_API.patch" size="41295" author="dsmiley" created="Thu, 12 May 2016 05:42:03 +0000"/>
                            <attachment id="12802831" name="SOLR_9080_DateMath_should_not_use_Calendar_API.patch" size="26461" author="dsmiley" created="Sat, 7 May 2016 16:00:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2xa7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>