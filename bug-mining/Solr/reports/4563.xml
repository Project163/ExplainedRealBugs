<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:45:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14821] docValuesTermsFilter should support single-valued docValues fields</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14821</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13890&quot; title=&quot;Add postfilter support to {!terms} queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13890&quot;&gt;&lt;del&gt;SOLR-13890&lt;/del&gt;&lt;/a&gt;&#160;introduced&#160;a post-filter implementation for&#160;docValuesTermsFilter in&#160;&#160;TermsQParserPlugin. But now it supports only multi-valued docValues fields (i.e.&#160;SORTED_SET type DocValues)&lt;/p&gt;

&lt;p&gt;It doesn&apos;t work for single-valued docValues fields (i.e. SORTED type DocValues), though it should.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13325713">SOLR-14821</key>
            <summary>docValuesTermsFilter should support single-valued docValues fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gerlowskija">Jason Gerlowski</assignee>
                                    <reporter username="anatolii_siuniaev">Anatolii Siuniaev</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Sep 2020 10:46:35 +0000</created>
                <updated>Wed, 4 Nov 2020 15:21:26 +0000</updated>
                            <resolved>Tue, 8 Sep 2020 10:35:18 +0000</resolved>
                                                    <fixVersion>8.7</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17189242" author="anatolii_siuniaev" created="Wed, 2 Sep 2020 13:42:03 +0000"  >&lt;p&gt;This is a single line fix for SORTED type docValues - just added a method wrapping SortedDocValues into SortedSetDocValues.&lt;br/&gt;
 &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13010905/13010905_SOLR-14821.patch&quot; title=&quot;SOLR-14821.patch attached to SOLR-14821&quot;&gt;SOLR-14821.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17189243" author="gerlowskija" created="Wed, 2 Sep 2020 13:44:38 +0000"  >&lt;p&gt;Hi Anatolii, thanks for filing the bug and attaching a fix.  I&apos;m a little surprised by this as I thought we had tests for this case, but maybe they&apos;re not doing what I&apos;d intended?&lt;/p&gt;

&lt;p&gt;In any case I&apos;ve assigned this to myself and will take a look shortly.  Thanks for getting the ball rolling.&lt;/p&gt;</comment>
                            <comment id="17190701" author="gerlowskija" created="Fri, 4 Sep 2020 12:44:05 +0000"  >&lt;p&gt;We do have a test for this it turns out, here&apos;s the relevant bit from TestTermsQParserPlugin:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testTermsMethodEquivalency() {
    &lt;span class=&quot;code-comment&quot;&gt;// Run queries with a variety of &lt;span class=&quot;code-quote&quot;&gt;&apos;method&apos;&lt;/span&gt; and postfilter options.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TermsParams[] methods = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TermsParams[] {
        ...
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TermsParams(&lt;span class=&quot;code-quote&quot;&gt;&quot;docValuesTermsFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TermsParams(&lt;span class=&quot;code-quote&quot;&gt;&quot;docValuesTermsFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;),
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TermsParams(&lt;span class=&quot;code-quote&quot;&gt;&quot;docValuesTermsFilterTopLevel&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TermsParams(&lt;span class=&quot;code-quote&quot;&gt;&quot;docValuesTermsFilterTopLevel&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;),
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TermsParams(&lt;span class=&quot;code-quote&quot;&gt;&quot;docValuesTermsFilterPerSegment&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TermsParams(&lt;span class=&quot;code-quote&quot;&gt;&quot;docValuesTermsFilterPerSegment&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
    };

    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (TermsParams method : methods) {
      &lt;span class=&quot;code-comment&quot;&gt;// Single-valued field, single term value
&lt;/span&gt;      ModifiableSolrParams params = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ModifiableSolrParams();
      params.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;, method.buildQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;author_s&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Robert Jordan&quot;&lt;/span&gt;));
      params.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;sort&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id asc&quot;&lt;/span&gt;);
      assertQ(req(params, &lt;span class=&quot;code-quote&quot;&gt;&quot;indent&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;on&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;*[count(&lt;span class=&quot;code-comment&quot;&gt;//doc)=2]&quot;&lt;/span&gt;,
&lt;/span&gt;          &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//result/doc[1]/str[@name=&lt;span class=&quot;code-quote&quot;&gt;&apos;id&apos;&lt;/span&gt;][.=&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;]&quot;&lt;/span&gt;,
&lt;/span&gt;          &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//result/doc[2]/str[@name=&lt;span class=&quot;code-quote&quot;&gt;&apos;id&apos;&lt;/span&gt;][.=&lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;]&quot;&lt;/span&gt;
&lt;/span&gt;      );

      &lt;span class=&quot;code-comment&quot;&gt;// Single-valued field, multiple term values
&lt;/span&gt;      params = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ModifiableSolrParams();
      params.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;, method.buildQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;author_s&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Robert Jordan,Isaac Asimov&quot;&lt;/span&gt;));
      params.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;sort&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id asc&quot;&lt;/span&gt;);
      assertQ(req(params, &lt;span class=&quot;code-quote&quot;&gt;&quot;indent&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;on&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;*[count(&lt;span class=&quot;code-comment&quot;&gt;//doc)=3]&quot;&lt;/span&gt;,
&lt;/span&gt;          &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//result/doc[1]/str[@name=&lt;span class=&quot;code-quote&quot;&gt;&apos;id&apos;&lt;/span&gt;][.=&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;]&quot;&lt;/span&gt;,
&lt;/span&gt;          &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//result/doc[2]/str[@name=&lt;span class=&quot;code-quote&quot;&gt;&apos;id&apos;&lt;/span&gt;][.=&lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;]&quot;&lt;/span&gt;,
&lt;/span&gt;          &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//result/doc[3]/str[@name=&lt;span class=&quot;code-quote&quot;&gt;&apos;id&apos;&lt;/span&gt;][.=&lt;span class=&quot;code-quote&quot;&gt;&apos;7&apos;&lt;/span&gt;]&quot;&lt;/span&gt;
&lt;/span&gt;      );
      ...
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not able to reproduce locally on master either.  Do you have an easy way to reproduce this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anatolii_siuniaev&quot; class=&quot;user-hover&quot; rel=&quot;anatolii_siuniaev&quot;&gt;anatolii_siuniaev&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17190712" author="gerlowskija" created="Fri, 4 Sep 2020 13:24:27 +0000"  >&lt;p&gt;Ah, hmm, I can see it locally now - I initially couldn&apos;t because I was specifying &lt;tt&gt;docValuesTermsFIlter&lt;/tt&gt; but didn&apos;t have enough terms for &lt;tt&gt;docValuesTermsFilterTopLevel&lt;/tt&gt; to be chosen - which is where the actual problem is.  Trivial to reproduce locally if you specify dVTFTL as your method directly.  The test code I mentioned in my comment above must actually be multi-valued for &lt;tt&gt;author_s&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;In any case your fix is straightforward and correct.  Just need to fix the test up before committing.&lt;/p&gt;</comment>
                            <comment id="17191125" author="jira-bot" created="Sat, 5 Sep 2020 17:54:50 +0000"  >&lt;p&gt;Commit ecb8ca2fef7cf799e4c3921f0a8f271f5afe3c83 in lucene-solr&apos;s branch refs/heads/master from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ecb8ca2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ecb8ca2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14821&quot; title=&quot;docValuesTermsFilter should support single-valued docValues fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14821&quot;&gt;&lt;del&gt;SOLR-14821&lt;/del&gt;&lt;/a&gt;: &lt;/p&gt;
{!terms} dVTFTL supports single-valued strings&lt;br/&gt;
&lt;br/&gt;
Prior to this commit the docValuesTermsFilterTopLevel method of the{!terms}
&lt;p&gt; query parser would return zero results when run against a&lt;br/&gt;
single-valued String.  This commit fixes this by wrapping the&lt;br/&gt;
single-valued &apos;SortedDocValues&apos; in a &apos;SortedSetDocValues&apos; object.&lt;/p&gt;</comment>
                            <comment id="17191176" author="jira-bot" created="Sun, 6 Sep 2020 01:58:58 +0000"  >&lt;p&gt;Commit de06e660d2a82e272519977f669e42664b782605 in lucene-solr&apos;s branch refs/heads/branch_8x from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=de06e66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=de06e66&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14821&quot; title=&quot;docValuesTermsFilter should support single-valued docValues fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14821&quot;&gt;&lt;del&gt;SOLR-14821&lt;/del&gt;&lt;/a&gt;: &lt;/p&gt;
{!terms} dVTFTL supports single-valued strings&lt;br/&gt;
&lt;br/&gt;
Prior to this commit the docValuesTermsFilterTopLevel method of the{!terms}
&lt;p&gt; query parser would return zero results when run against a&lt;br/&gt;
single-valued String.  This commit fixes this by wrapping the&lt;br/&gt;
single-valued &apos;SortedDocValues&apos; in a &apos;SortedSetDocValues&apos; object.&lt;/p&gt;</comment>
                            <comment id="17192124" author="gerlowskija" created="Tue, 8 Sep 2020 10:35:18 +0000"  >&lt;p&gt;Thanks again Anatolli.  This will be in starting in 8.7 (or 9.0 if there&apos;s no 8.7)&lt;/p&gt;</comment>
                            <comment id="17226108" author="atri" created="Wed, 4 Nov 2020 15:21:26 +0000"  >&lt;p&gt;Closing after the 8.7.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13010905" name="SOLR-14821.patch" size="814" author="anatolii_siuniaev" created="Wed, 2 Sep 2020 13:41:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0iaao:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>