<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:34:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12541] Metrics handler throws an error if there are transient cores</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12541</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;My environment is as follows&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Solr 7.2.1 in standalone mode.&lt;/li&gt;
	&lt;li&gt;32GB heap&lt;/li&gt;
	&lt;li&gt;150 cores with data getting continuously ingested to ~10 cores and all of the cores queried.&lt;/li&gt;
	&lt;li&gt;transient cache size is set to 30.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The solr.xml is as follows&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt; ?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;solr&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;transientCacheSize&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;32&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;shareSchema&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;configSetBaseDir&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;${configSetBaseDir:configsets}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;

  &amp;lt;shardHandlerFactory name=&lt;span class=&quot;code-quote&quot;&gt;&quot;shardHandlerFactory&quot;&lt;/span&gt;
                       class=&lt;span class=&quot;code-quote&quot;&gt;&quot;HttpShardHandlerFactory&quot;&lt;/span&gt;&amp;gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;socketTimeout&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;${socketTimeout:600000}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;connTimeout&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;${connTimeout:60000}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/shardHandlerFactory&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/solr&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get the following error when I request for &quot;/solr/admin/metrics&quot;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;: 500,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;: 31
    },
    &lt;span class=&quot;code-quote&quot;&gt;&quot;error&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;msg&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Already closed&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.lucene.store.AlreadyClosedException: Already closed\n\tat org.apache.solr.core.CachingDirectoryFactory.get(CachingDirectoryFactory.java:337)\n\tat org.apache.solr.core.SolrCore.getNewIndexDir(SolrCore.java:351)\n\tat org.apache.solr.core.SolrCore.getIndexDir(SolrCore.java:330)\n\tat org.apache.solr.handler.ReplicationHandler.lambda$initializeMetrics$5(ReplicationHandler.java:849)\n\tat org.apache.solr.util.stats.MetricUtils.convertGauge(MetricUtils.java:488)\n\tat org.apache.solr.util.stats.MetricUtils.convertMetric(MetricUtils.java:274)\n\tat org.apache.solr.util.stats.MetricUtils.lambda$toMaps$4(MetricUtils.java:213)\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\n\tat java.util.TreeMap$KeySpliterator.forEachRemaining(TreeMap.java:2746)\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\n\tat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)\n\tat org.apache.solr.util.stats.MetricUtils.toMaps(MetricUtils.java:211)\n\tat org.apache.solr.handler.admin.MetricsHandler.handleRequestBody(MetricsHandler.java:108)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:177)\n\tat org.apache.solr.servlet.HttpSolrCall.handleAdmin(HttpSolrCall.java:735)\n\tat org.apache.solr.servlet.HttpSolrCall.handleAdminRequest(HttpSolrCall.java:716)\n\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:497)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:382)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:326)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1751)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n\tat org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:335)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:534)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108)\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589)\n\tat java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)\n&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;code&quot;&lt;/span&gt;: 500
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I validated that this problem happens on the default configset as well (no changes other than transientCacheSize).&lt;/p&gt;

&lt;p&gt;Debugger shows that the &lt;b&gt;getIndexDir()&lt;/b&gt;&#160;fails on a core which is unloaded. I confirmed that by checking &quot;isLoaded&quot; property in STATUS output for the core.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13171008">SOLR-12541</key>
            <summary>Metrics handler throws an error if there are transient cores</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ab">Andrzej Bialecki</assignee>
                                    <reporter username="nandakishorek17">Nandakishore Krishna</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jul 2018 23:19:11 +0000</created>
                <updated>Sat, 8 Jun 2019 15:01:58 +0000</updated>
                            <resolved>Tue, 7 Aug 2018 12:08:39 +0000</resolved>
                                    <version>7.2.1</version>
                                    <fixVersion>7.5</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16539078" author="nandakishorek17" created="Tue, 10 Jul 2018 18:41:34 +0000"  >&lt;p&gt;I have set the priority as blocker, since we are unable to export metrics over http in production.&lt;/p&gt;</comment>
                            <comment id="16539185" author="erickerickson" created="Tue, 10 Jul 2018 20:24:18 +0000"  >&lt;p&gt;Patches welcome!&lt;/p&gt;</comment>
                            <comment id="16545513" author="erickerickson" created="Mon, 16 Jul 2018 17:19:05 +0000"  >&lt;p&gt; Blockers are reserved for issues that will hold up a release of Solr. Metrics development was focused on SolrCloud and transient cores were never really considered. Therefore I&apos;m changing the priority. That would probably be a good enhancement if you (or anyone else) can come up with a solution that would be a good thing.&lt;/p&gt;</comment>
                            <comment id="16571472" author="jira-bot" created="Tue, 7 Aug 2018 11:21:56 +0000"  >&lt;p&gt;Commit 208d59b5e3dbc5207d9b150d56d70e53f81c0e3f in lucene-solr&apos;s branch refs/heads/master from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=208d59b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=208d59b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12541&quot; title=&quot;Metrics handler throws an error if there are transient cores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12541&quot;&gt;&lt;del&gt;SOLR-12541&lt;/del&gt;&lt;/a&gt;: Metrics handler throws an error if there are transient cores.&lt;/p&gt;</comment>
                            <comment id="16571542" author="jira-bot" created="Tue, 7 Aug 2018 12:08:26 +0000"  >&lt;p&gt;Commit 4d035a7461733f765e9f0dc091028d5d5376f33e in lucene-solr&apos;s branch refs/heads/branch_7x from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d035a7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d035a7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12541&quot; title=&quot;Metrics handler throws an error if there are transient cores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12541&quot;&gt;&lt;del&gt;SOLR-12541&lt;/del&gt;&lt;/a&gt;: Metrics handler throws an error if there are transient cores.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vp8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>