<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:34:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4138] currency field doesn&apos;t work with functions (ie: isn&apos;t compatible with frange query)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4138</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In general, using CurrencyField with FunctionQueries doesn&apos;t work&lt;/p&gt;

&lt;p&gt;In particular, as originally reported...&lt;/p&gt;

&lt;p&gt;Filtering using &lt;/p&gt;
{!frange}
&lt;p&gt; syntax isn&apos;t work properly. (rather at all)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12618552">SOLR-4138</key>
            <summary>currency field doesn&apos;t work with functions (ie: isn&apos;t compatible with frange query)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="gsobczyk">Grzegorz Sobczyk</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Dec 2012 11:21:06 +0000</created>
                <updated>Tue, 19 May 2020 20:14:06 +0000</updated>
                            <resolved>Mon, 4 Mar 2013 21:09:50 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>4.2</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13508658" author="gsobczyk" created="Mon, 3 Dec 2012 11:24:04 +0000"  >&lt;p&gt;example patch with test for CurrencyFieldTest&lt;/p&gt;</comment>
                            <comment id="13510125" author="hossman" created="Tue, 4 Dec 2012 23:40:57 +0000"  >&lt;p&gt;Thanks for reporting this Grzegorz,&lt;/p&gt;

&lt;p&gt;The general problem seems to be that while CurrencyField has a CurrencyValueSource that it uses for range queries and sorting, it doesn&apos;t override FieldType.getValueSource() to return one of these in cases when people use currency fields in functions. &lt;/p&gt;

&lt;p&gt;Even with this simple addition however, your test as written still doesn&apos;t pass, because CurrencyValueSource operates using the internal &quot;long&quot; values of the currency, based on Currency.getDefaultFractionDigits() for the default currency .. so if USD is the configured default, you get a value of &quot;500.0&quot; (cents) from the value source instead of &quot;5.0&quot; when a document is indexed with a value of &quot;5,USD&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a patch with the trivial getVaueSource() and tests showing the &lt;em&gt;current&lt;/em&gt; behavior, but i&apos;m not entirely certain if this is really the behavior we want ... changing it would probably require some meaty rewrites to CurrencyValueSource to take in options about whether the getDefaultFractionDigits() logic should be &quot;undone&quot; to produce the more human friendly values ... or perhaps just wrapping it in a special ValueSource that applies that logic in the getValueSource case so existing usages in getRangeQuery would be unaffected.&lt;/p&gt;</comment>
                            <comment id="13510127" author="hossman" created="Tue, 4 Dec 2012 23:42:52 +0000"  >&lt;p&gt;enhancing summary &amp;amp; description to reflect broader scope of issue&lt;/p&gt;</comment>
                            <comment id="13510131" author="hossman" created="Tue, 4 Dec 2012 23:50:02 +0000"  >&lt;p&gt;Thinking about it some more ... &lt;/p&gt;

&lt;p&gt;The current behavior of being as &quot;raw&quot; as possible when using a currency field in a function probably makes the most sense &amp;#8211; and then we should implement something like &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3239&quot; title=&quot;DocTransformer for formatting CurrencyField as a virtual field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3239&quot;&gt;SOLR-3239&lt;/a&gt; as a wrapper function people can use when they want to be able to apply functions (or frange) over the converted values.&lt;/p&gt;

&lt;p&gt;so you can choose between...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;q={!frange u=500}price_field

  or

q={!frange u=5}currency(price_field,USD)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13591574" author="hossman" created="Sun, 3 Mar 2013 00:10:42 +0000"  >&lt;p&gt;Updated previous patch to work with trunk, and to include a new &lt;tt&gt;currency(field_name,&lt;span class=&quot;error&quot;&gt;&amp;#91;currency_code&amp;#93;&lt;/span&gt;)&lt;/tt&gt; function like the one i hypothesized in my previous comment.&lt;/p&gt;

&lt;p&gt;still several nocommit&apos;s related to the docs to make it clear what&apos;s what &amp;#8211; but the tests all pass and the code seems complete to me.&lt;/p&gt;</comment>
                            <comment id="13592603" author="commit-tag-bot" created="Mon, 4 Mar 2013 20:29:12 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452483&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452483&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4138&quot; title=&quot;currency field doesn&amp;#39;t work with functions (ie: isn&amp;#39;t compatible with frange query)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4138&quot;&gt;&lt;del&gt;SOLR-4138&lt;/del&gt;&lt;/a&gt;: CurrencyField fields can now be used in a ValueSources. There is also a new currency(field,&lt;span class=&quot;error&quot;&gt;&amp;#91;CODE&amp;#93;&lt;/span&gt;) function&lt;/p&gt;</comment>
                            <comment id="13592642" author="hossman" created="Mon, 4 Mar 2013 21:09:50 +0000"  >&lt;p&gt;Committed revision 1452483.&lt;br/&gt;
Committed revision 1452508.&lt;br/&gt;
Committed revision 1452527.&lt;/p&gt;</comment>
                            <comment id="13592649" author="commit-tag-bot" created="Mon, 4 Mar 2013 21:20:18 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452527&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452527&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4138&quot; title=&quot;currency field doesn&amp;#39;t work with functions (ie: isn&amp;#39;t compatible with frange query)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4138&quot;&gt;&lt;del&gt;SOLR-4138&lt;/del&gt;&lt;/a&gt;: CurrencyField fields can now be used in a ValueSources. There is also a new currency(field,&lt;span class=&quot;error&quot;&gt;&amp;#91;CODE&amp;#93;&lt;/span&gt;) function (merge r1452483 and r1452508)&lt;/p&gt;</comment>
                            <comment id="13592650" author="commit-tag-bot" created="Mon, 4 Mar 2013 21:20:19 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452508&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4138&quot; title=&quot;currency field doesn&amp;#39;t work with functions (ie: isn&amp;#39;t compatible with frange query)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4138&quot;&gt;&lt;del&gt;SOLR-4138&lt;/del&gt;&lt;/a&gt;: doc typos&lt;/p&gt;</comment>
                            <comment id="13654283" author="thetaphi" created="Fri, 10 May 2013 10:34:39 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13305999">SOLR-14500</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12546220">SOLR-3239</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12555739" name="SOLR-4135-test.patch" size="728" author="gsobczyk" created="Mon, 3 Dec 2012 11:24:04 +0000"/>
                            <attachment id="12571769" name="SOLR-4138.patch" size="16339" author="hossman" created="Sun, 3 Mar 2013 00:10:42 +0000"/>
                            <attachment id="12556013" name="SOLR-4138.patch" size="3004" author="hossman" created="Tue, 4 Dec 2012 23:40:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>293385</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0szev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>167214</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>