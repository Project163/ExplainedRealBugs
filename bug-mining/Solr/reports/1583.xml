<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:40:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5363] NoClassDefFoundError when using Apache Log4J2</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5363</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Hey guys,&lt;/p&gt;

&lt;p&gt;I&apos;m using Log4J2 + SLF4J in my project. Unfortunately my embedded solr server throws this error when starting:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: org.springframework.beans.factory.BeanDefinitionStoreException: Factory method [&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; org.springframework.da
ta.solr.core.SolrOperations com.xxxxx.platform.core.config.SolrsearchConfig.defaultSolrTemplate() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; javax.xml.par
sers.ParserConfigurationException,java.io.IOException,org.xml.sax.SAXException] threw exception; nested exception is org
.springframework.beans.factory.BeanCreationException: Error creating bean with name &lt;span class=&quot;code-quote&quot;&gt;&apos;defaultSolrServer&apos;&lt;/span&gt; defined in class
 path resource [com/xxxxx/platform/core/config/SolrsearchConfig.class]: Instantiation of bean failed; nested exception
 is org.springframework.beans.factory.BeanDefinitionStoreException: Factory method [&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; org.apache.solr.client.solrj.
SolrServer com.xxxxxx.platform.core.config.SolrsearchConfig.defaultSolrServer() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; javax.xml.parsers.ParserConfigur
ationException,java.io.IOException,org.xml.sax.SAXException] threw exception; nested exception is java.lang.NoClassDefFo
undError: org/apache/log4j/Priority
        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy
.java:181)
        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolv
er.java:570)
        ... 105 more
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &lt;span class=&quot;code-quote&quot;&gt;&apos;defaultSolrServer&apos;&lt;/span&gt; de
fined in &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;path resource [com/xxxxxx/platform/core/config/SolrsearchConfig.class]: Instantiation of bean failed; ne
sted exception is org.springframework.beans.factory.BeanDefinitionStoreException: Factory method [&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; org.apache.solr
.client.solrj.SolrServer com.xxxxxxx.platform.core.config.SolrsearchConfig.defaultSolrServer() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; javax.xml.parsers.
ParserConfigurationException,java.io.IOException,org.xml.sax.SAXException] threw exception; nested exception is java.lan
g.NoClassDefFoundError: org/apache/log4j/Priority
        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolv
er.java:581)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(Ab
stractAutowireCapableBeanFactory.java:1025)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutow
ireCapableBeanFactory.java:921)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCap
ableBeanFactory.java:487)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapab
leBeanFactory.java:458)
        at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:295)
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegis
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;.java:223)
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:292)
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:194)
        at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(Configurati
onClassEnhancer.java:298)
        at com.xxxxxx.platform.core.config.SolrsearchConfig$$EnhancerByCGLIB$$c571c5a6.defaultSolrServer(&amp;lt;generated&amp;gt;)
        at com.xxxxx.platform.core.config.SolrsearchConfig.defaultSolrTemplate(SolrsearchConfig.java:37)
        at com.xxxxxx.platform.core.config.SolrsearchConfig$$EnhancerByCGLIB$$c571c5a6.CGLIB$defaultSolrTemplate$2(&amp;lt;gen
erated&amp;gt;)
        at com.xxxxx.platform.core.config.SolrsearchConfig$$EnhancerByCGLIB$$c571c5a6$$FastClassByCGLIB$$f67069c2.invo
ke(&amp;lt;generated&amp;gt;)
        at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:228)
        at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(Configurati
onClassEnhancer.java:286)
        at com.xxxxxx.platform.core.config.SolrsearchConfig$$EnhancerByCGLIB$$c571c5a6.defaultSolrTemplate(&amp;lt;generated&amp;gt;)

        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy
.java:160)
        ... 106 more
Caused by: org.springframework.beans.factory.BeanDefinitionStoreException: Factory method [&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; org.apache.solr.client
.solrj.SolrServer com.xxxxxxx.platform.core.config.SolrsearchConfig.defaultSolrServer() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; javax.xml.parsers.ParserC
onfigurationException,java.io.IOException,org.xml.sax.SAXException] threw exception; nested exception is java.lang.NoCla
ssDefFoundError: org/apache/log4j/Priority
        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy
.java:181)
        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolv
er.java:570)
        ... 127 more
Caused by: java.lang.NoClassDefFoundError: org/apache/log4j/Priority
        at org.apache.solr.core.CoreContainer.load(CoreContainer.java:433)
        at org.apache.solr.core.CoreContainer.load(CoreContainer.java:358)
        at org.apache.solr.core.CoreContainer.&amp;lt;init&amp;gt;(CoreContainer.java:160)
        at org.springframework.data.solr.server.support.EmbeddedSolrServerFactory.createPathConfiguredSolrServer(Embedde
dSolrServerFactory.java:101)
        at org.springframework.data.solr.server.support.EmbeddedSolrServerFactory.initSolrServer(EmbeddedSolrServerFacto
ry.java:77)
        at org.springframework.data.solr.server.support.EmbeddedSolrServerFactory.getSolrServer(EmbeddedSolrServerFactor
y.java:70)
        at com.xxxxxxx.platform.core.config.SolrsearchConfig.defaultSolrServer(SolrsearchConfig.java:32)
        at com.xxxxxx.platform.core.config.SolrsearchConfig$$EnhancerByCGLIB$$c571c5a6.CGLIB$defaultSolrServer$1(&amp;lt;gener
ated&amp;gt;)
        at com.xxxxxx.platform.core.config.SolrsearchConfig$$EnhancerByCGLIB$$c571c5a6$$FastClassByCGLIB$$f67069c2.invo
ke(&amp;lt;generated&amp;gt;)
        at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:228)
        at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(Configurati
onClassEnhancer.java:286)
        at com.xxxxxx.platform.core.config.SolrsearchConfig$$EnhancerByCGLIB$$c571c5a6.defaultSolrServer(&amp;lt;generated&amp;gt;)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy
.java:160)
        ... 128 more
Caused by: java.lang.ClassNotFoundException: org.apache.log4j.Priority
        at org.codehaus.plexus.classworlds.strategy.SelfFirstStrategy.loadClass(SelfFirstStrategy.java:50)
        at org.codehaus.plexus.classworlds.realm.ClassRealm.loadClass(ClassRealm.java:244)
        at org.codehaus.plexus.classworlds.realm.ClassRealm.loadClass(ClassRealm.java:230)
        at org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:430)
        at org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:383)
        ... 145 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems like Solr relies on Log4J version 1.x. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12674466">SOLR-5363</key>
            <summary>NoClassDefFoundError when using Apache Log4J2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="paranoiabla">Petar Tahchiev</reporter>
                        <labels>
                            <label>log4j2</label>
                    </labels>
                <created>Fri, 18 Oct 2013 08:11:53 +0000</created>
                <updated>Mon, 9 May 2016 18:48:33 +0000</updated>
                            <resolved>Wed, 23 Oct 2013 15:48:35 +0000</resolved>
                                    <version>4.5</version>
                                    <fixVersion>4.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13802912" author="paranoiabla" created="Wed, 23 Oct 2013 14:53:21 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;so It seems that the CoreContainer checks if the slf4j implementation name contains log4j and if so instantiates the Log4j watcher. The problem is that using the Log4J2 the slf4j implementation is: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.slf4j.helpers.Log4jLoggerFactory
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so you see it does contain &quot;Log4J&quot;, and thus SOLR will try to instantiate the Log4JWatcher, which was written for Log4J1. The Log4J1 slf4j implementation is called: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.slf4j.impl.Log4jLoggerFactory
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so what I have done is to change the if to include the full class name. If you apply this patch i guess the issue can be closed, but further on it might be a good idea to implement a Log4J2Watcher. &lt;/p&gt;</comment>
                            <comment id="13802926" author="shikhar" created="Wed, 23 Oct 2013 15:03:24 +0000"  >&lt;p&gt;Confirming the issue &amp;amp; Petar&apos;s assessment, ran into this as well&lt;/p&gt;</comment>
                            <comment id="13802939" author="romseygeek" created="Wed, 23 Oct 2013 15:20:02 +0000"  >&lt;p&gt;Hi Petar, thanks for this.  It looks as though your patch is against a slightly older version of Solr (the relevant code has moved out of CoreContainer and into LogWatcher now), but it&apos;s simple to apply it.&lt;/p&gt;</comment>
                            <comment id="13802965" author="jira-bot" created="Wed, 23 Oct 2013 15:47:01 +0000"  >&lt;p&gt;Commit 1535065 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535065&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1535065&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5363&quot; title=&quot;NoClassDefFoundError when using Apache Log4J2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5363&quot;&gt;&lt;del&gt;SOLR-5363&lt;/del&gt;&lt;/a&gt;: Solr doesn&apos;t start up properly with Log4J2&lt;/p&gt;</comment>
                            <comment id="13802966" author="jira-bot" created="Wed, 23 Oct 2013 15:48:05 +0000"  >&lt;p&gt;Commit 1535066 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535066&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1535066&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5363&quot; title=&quot;NoClassDefFoundError when using Apache Log4J2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5363&quot;&gt;&lt;del&gt;SOLR-5363&lt;/del&gt;&lt;/a&gt;: Solr doesn&apos;t start up properly with Log4J2&lt;/p&gt;</comment>
                            <comment id="13802967" author="romseygeek" created="Wed, 23 Oct 2013 15:48:35 +0000"  >&lt;p&gt;Thanks Petar!&lt;/p&gt;</comment>
                            <comment id="13808354" author="paranoiabla" created="Tue, 29 Oct 2013 19:28:55 +0000"  >&lt;p&gt;Hi Alan,&lt;/p&gt;

&lt;p&gt;I just used Solr 4.5.1 from m2 official repo and it seems like it is still not fixed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (slf4jImpl.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;Log4j&quot;&lt;/span&gt;) &amp;gt; 0) {
          fname = &lt;span class=&quot;code-quote&quot;&gt;&quot;Log4j&quot;&lt;/span&gt;;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (slf4jImpl.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;JDK&quot;&lt;/span&gt;) &amp;gt; 0) {
          fname = &lt;span class=&quot;code-quote&quot;&gt;&quot;JUL&quot;&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is inside the jar. Should I reopen the issue?&lt;/p&gt;</comment>
                            <comment id="13808356" author="romseygeek" created="Tue, 29 Oct 2013 19:31:40 +0000"  >&lt;p&gt;Hi Petar, this missed the 4.5.1 cutoff, I&apos;m afraid.  It will be in 4.6.&lt;/p&gt;</comment>
                            <comment id="13808362" author="steve_rowe" created="Tue, 29 Oct 2013 19:38:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;Hi Petar, this missed the 4.5.1 cutoff, I&apos;m afraid. It will be in 4.6.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Alan, can you set the fix version to 4.6 and 5.0?  I do this when I resolve issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12609865" name="SOLR-5363.patch" size="950" author="paranoiabla" created="Wed, 23 Oct 2013 14:53:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354088</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1p1ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>