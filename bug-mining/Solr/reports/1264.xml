<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:34:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4480] EDisMax parser blows up with query containing single plus or minus</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4480</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We are running solr with sunspot and when we set up a query containing a single plus, Solr blows up with the following error:&lt;br/&gt;
SOLR Request (5.0ms)  [ path=#&amp;lt;RSolr::Client:0x4c7464ac&amp;gt; parameters={data: fq=type%3A%28Attachment+OR+User+OR+GpdbDataSource+OR+HadoopInstance+OR+GnipInstance+OR+Workspace+OR+Workfile+OR+Tag+OR+Dataset+OR+HdfsEntry%29&amp;amp;fq=type_name_s%3A%28Attachment+OR+User+OR+Instance+OR+Workspace+OR+Workfile+OR+Tag+OR+Dataset+OR+HdfsEntry%29&amp;amp;fq=&lt;del&gt;%28security_type_name_sm%3A%28Dataset%29+AND+-instance_account_ids_im%3A%282+OR+1%29%29&amp;amp;fq=&lt;/del&gt;%28security_type_name_sm%3AChorusView+AND+&lt;del&gt;member_ids_im%3A1+AND+-public_b%3Atrue%29&amp;amp;fq=&lt;/del&gt;%28security_type_name_sm%3A%28Dataset%29+AND+&lt;del&gt;instance_account_ids_im%3A%282+OR+1%29%29&amp;amp;fq=&lt;/del&gt;%28security_type_name_sm%3AChorusView+AND+-member_ids_im%3A1+AND+-public_b%3Atrue%29&amp;amp;q=%2B&amp;amp;fl=%2A+score&amp;amp;qf=name_texts+first_name_texts+last_name_texts+file_name_texts&amp;amp;defType=edismax&amp;amp;hl=on&amp;amp;hl.simple.pre=%40%40%40hl%40%40%40&amp;amp;hl.simple.post=%40%40%40endhl%40%40%40&amp;amp;start=0&amp;amp;rows=3, method: post, params: {:wt=&amp;gt;:ruby}, query: wt=ruby, headers: &lt;/p&gt;
{&quot;Content-Type&quot;=&amp;gt;&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;}
&lt;p&gt;, path: select, uri: &lt;a href=&quot;http://localhost:8982/solr/select?wt=ruby&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8982/solr/select?wt=ruby&lt;/a&gt;, open_timeout: , read_timeout: } ]&lt;/p&gt;

&lt;p&gt;RSolr::Error::Http (RSolr::Error::Http - 400 Bad Request&lt;br/&gt;
Error:     org.apache.lucene.queryParser.ParseException: Cannot parse &apos;&apos;: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 0.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &amp;lt;NOT&amp;gt; ...&lt;br/&gt;
    &quot;+&quot; ...&lt;br/&gt;
    &quot;-&quot; ...&lt;br/&gt;
    &quot;(&quot; ...&lt;br/&gt;
    &quot;*&quot; ...&lt;br/&gt;
    &amp;lt;QUOTED&amp;gt; ...&lt;br/&gt;
    &amp;lt;TERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;PREFIXTERM&amp;gt; ...&lt;br/&gt;
    &amp;lt;WILDTERM&amp;gt; ...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12633305">SOLR-4480</key>
            <summary>EDisMax parser blows up with query containing single plus or minus</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fionatay">Fiona Tay</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Feb 2013 23:43:12 +0000</created>
                <updated>Mon, 9 May 2016 18:47:11 +0000</updated>
                            <resolved>Tue, 26 Feb 2013 19:51:31 +0000</resolved>
                                                    <fixVersion>4.2</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13582725" author="janhoy" created="Thu, 21 Feb 2013 00:33:36 +0000"  >&lt;p&gt;Thanks for reporting this. As EDismax is all about being robust and never crash, this must be fixed.&lt;/p&gt;</comment>
                            <comment id="13583014" author="janhoy" created="Thu, 21 Feb 2013 08:46:09 +0000"  >&lt;p&gt;What should be the logical behavior of a single &quot;+&quot; or &quot;-&quot;? If eDisMax discovers it as one of many words, it is treated as whitespace (I think by mistake since it is caught by the MUST&lt;span class=&quot;error&quot;&gt;&amp;#91;+&amp;#93;&lt;/span&gt;/NOT&lt;span class=&quot;error&quot;&gt;&amp;#91;-&amp;#93;&lt;/span&gt; logic).&lt;/p&gt;

&lt;p&gt;So the least surprising behavior would perhaps be to interpret it the same way - leadning to an empty &quot;q&quot; and fallback to &quot;q.alt&quot;.&lt;/p&gt;

&lt;p&gt;Another option would be to detect and escape with &quot;\&quot; to match literally. However for most eDisMax uses you would not expect or want this. It would also be inconsistent with behavior with multi term search. If you like literal match you can always escape yourself.&lt;/p&gt;</comment>
                            <comment id="13584478" author="fionatay" created="Fri, 22 Feb 2013 17:46:03 +0000"  >&lt;p&gt;&amp;gt; So the least surprising behavior would perhaps be to interpret it the same way - leadning to an empty &quot;q&quot; and fallback to &quot;q.alt&quot;.&lt;br/&gt;
This seems like a reasonable solution.&lt;/p&gt;</comment>
                            <comment id="13584781" author="janhoy" created="Fri, 22 Feb 2013 22:44:13 +0000"  >&lt;p&gt;Patch against trunk which treats single + and single - as empty q&lt;/p&gt;</comment>
                            <comment id="13586227" author="janhoy" created="Mon, 25 Feb 2013 20:02:29 +0000"  >&lt;p&gt;Updated patch, also catching exceptions in the case where the +/- comes after a leading whitespace.&lt;/p&gt;

&lt;p&gt;What do people think about the solution? Plan to commit soon.&lt;/p&gt;</comment>
                            <comment id="13586345" author="yseeley@gmail.com" created="Mon, 25 Feb 2013 21:57:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;What should be the logical behavior of a single &quot;+&quot; or &quot;-&quot;? If eDisMax discovers it as one of many words, it is treated as whitespace&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It shouldn&apos;t be, and a quick test shows that it is treated as a literal.&lt;br/&gt;
Are you forgetting to URL-encode the &quot;+&quot; when trying it from a browser, or perhaps the analysis of the default field is removing the character because it&apos;s not alphanumeric?&lt;/p&gt;

&lt;p&gt;Try this:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select?debug=query&amp;amp;defType=edismax&amp;amp;df=foo_s&amp;amp;q=hello+%2b+there&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?debug=query&amp;amp;defType=edismax&amp;amp;df=foo_s&amp;amp;q=hello+%2b+there&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13586368" author="janhoy" created="Mon, 25 Feb 2013 22:16:57 +0000"  >&lt;p&gt;So let&apos;s take the String field example. A single %2B crashes the Lucene query parser, and since we just pass it straight through it crashes eDisMax too.&lt;/p&gt;

&lt;p&gt;For the Lucene parser, it crashes for all query strings &lt;b&gt;ending&lt;/b&gt; in a single &quot;+&quot;&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select?debug=query&amp;amp;q=foo%20%2B&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?debug=query&amp;amp;q=foo%20%2B&lt;/a&gt;&lt;br/&gt;
but not for queries where there is a whitespace after the &quot;+&quot;&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select?debug=query&amp;amp;q=%2B%20foo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?debug=query&amp;amp;q=%2B%20foo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;eDismax is a bit different. It does not crash on ending &quot;+&quot; but it swallows it:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select?debug=query&amp;amp;defType=edismax&amp;amp;df=foo_s&amp;amp;q=%2B%20hello%20%2B&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?debug=query&amp;amp;defType=edismax&amp;amp;df=foo_s&amp;amp;q=%2B%20hello%20%2B&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is probably due to line 700-703 being too quick at guessing that the + or - means MUST or NOT&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ch==&lt;span class=&quot;code-quote&quot;&gt;&apos;+&apos;&lt;/span&gt; || ch==&lt;span class=&quot;code-quote&quot;&gt;&apos;-&apos;&lt;/span&gt;) {
        clause.must = ch;
        pos++;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m ok with saying that a single plus or minus should mean literal matching (given that field type supports it), and thus we add escaping. But then we should do the same at the end of a query string.&lt;/p&gt;</comment>
                            <comment id="13586380" author="yseeley@gmail.com" created="Mon, 25 Feb 2013 22:30:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m ok with saying that a single plus or minus should mean literal matching (given that field type supports it), and thus we add escaping. But then we should do the same at the end of a query string.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Correct.&lt;/p&gt;</comment>
                            <comment id="13586698" author="fionatay" created="Tue, 26 Feb 2013 03:43:24 +0000"  >&lt;p&gt;I&apos;m the person who originally reported the bug, and I just want to commend y&apos;all for the speedy response! You guys are amazing!&lt;/p&gt;</comment>
                            <comment id="13587415" author="yseeley@gmail.com" created="Tue, 26 Feb 2013 19:13:44 +0000"  >&lt;p&gt;I started off trying to modify the parser grammar, but it quickly went down a rat hole...&lt;/p&gt;

&lt;p&gt;Instead, here&apos;s a patch that lets the JavaCC parser fail, and makes the escaping better for edismax.&lt;/p&gt;</comment>
                            <comment id="13587444" author="commit-tag-bot" created="Tue, 26 Feb 2013 19:42:12 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Yonik Seeley&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1450369&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1450369&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4480&quot; title=&quot;EDisMax parser blows up with query containing single plus or minus&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4480&quot;&gt;&lt;del&gt;SOLR-4480&lt;/del&gt;&lt;/a&gt;: edismax - fix trailing +-&lt;/p&gt;</comment>
                            <comment id="13587459" author="commit-tag-bot" created="Tue, 26 Feb 2013 19:54:12 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Yonik Seeley&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1450371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1450371&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4480&quot; title=&quot;EDisMax parser blows up with query containing single plus or minus&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4480&quot;&gt;&lt;del&gt;SOLR-4480&lt;/del&gt;&lt;/a&gt;: edismax - fix trailing +-&lt;/p&gt;</comment>
                            <comment id="13653805" author="thetaphi" created="Fri, 10 May 2013 10:33:02 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12571030" name="SOLR-4480.patch" size="4881" author="yseeley@gmail.com" created="Tue, 26 Feb 2013 19:13:44 +0000"/>
                            <attachment id="12570846" name="SOLR-4480.patch" size="4347" author="janhoy" created="Mon, 25 Feb 2013 20:02:29 +0000"/>
                            <attachment id="12570551" name="SOLR-4480.patch" size="3880" author="janhoy" created="Fri, 22 Feb 2013 22:44:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313801</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i5h3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314146</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>