<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:28:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2824] Cross-Core Join doesn&apos;t parse fields against joining schema</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2824</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I have two cores with 2 different schema&apos;s&lt;br/&gt;
now I want to join between the 2 cores. where I filter on a field from one core that doesn&apos;t exist in the other core.&lt;br/&gt;
core1: &lt;/p&gt;
{childIds, name, id}
&lt;p&gt;, core2:&lt;/p&gt;
{id, type, specials}

&lt;p&gt;I have the following query&lt;br/&gt;
/core1/select?q=&lt;b&gt;:&lt;/b&gt;&amp;amp;fq=&lt;/p&gt;
{!join from=id to=childIds fromIndex=core2}
&lt;p&gt;specials:1&amp;amp;fl=id,name&lt;br/&gt;
I get this exception &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Looking at the debugger I see that&lt;br/&gt;
    at org.apache.solr.search.JoinQParserPlugin$1.parse(JoinQParserPlugin.java:60)&lt;br/&gt;
the parse is called  for the filterquery on the main core (core1). Not the core of the &apos;fromIndex&apos; (core2) &lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;br/&gt;
SEVERE: org.apache.solr.common.SolrException: undefined field specials&lt;br/&gt;
        at org.apache.solr.schema.IndexSchema.getDynamicFieldType(IndexSchema.java:1028)&lt;br/&gt;
        at org.apache.solr.schema.IndexSchema$SolrQueryAnalyzer.getWrappedAnalyzer(IndexSchema.java:335)&lt;br/&gt;
        at org.apache.lucene.analysis.AnalyzerWrapper.createComponents(AnalyzerWrapper.java:71)&lt;br/&gt;
        at org.apache.lucene.analysis.Analyzer.tokenStream(Analyzer.java:83)&lt;br/&gt;
        at org.apache.lucene.queryparser.classic.QueryParserBase.newFieldQuery(QueryParserBase.java:476)&lt;br/&gt;
        at org.apache.lucene.queryparser.classic.QueryParserBase.getFieldQuery(QueryParserBase.java:464)&lt;br/&gt;
        at org.apache.solr.search.SolrQueryParser.getFieldQuery(SolrQueryParser.java:134)&lt;br/&gt;
        at org.apache.lucene.queryparser.classic.QueryParserBase.handleBareTokenQuery(QueryParserBase.java:1052)&lt;br/&gt;
        at org.apache.lucene.queryparser.classic.QueryParser.Term(QueryParser.java:358)&lt;br/&gt;
        at org.apache.lucene.queryparser.classic.QueryParser.Clause(QueryParser.java:257)&lt;br/&gt;
        at org.apache.lucene.queryparser.classic.QueryParser.Query(QueryParser.java:181)&lt;br/&gt;
        at org.apache.lucene.queryparser.classic.QueryParser.TopLevelQuery(QueryParser.java:170)&lt;br/&gt;
        at org.apache.lucene.queryparser.classic.QueryParserBase.parse(QueryParserBase.java:118)&lt;br/&gt;
        at org.apache.solr.search.LuceneQParser.parse(LuceneQParserPlugin.java:74)&lt;br/&gt;
        at org.apache.solr.search.QParser.getQuery(QParser.java:143)&lt;br/&gt;
        at org.apache.solr.search.JoinQParserPlugin$1.parse(JoinQParserPlugin.java:60)&lt;br/&gt;
        at org.apache.solr.search.QParser.getQuery(QParser.java:143)&lt;br/&gt;
        at org.apache.solr.handler.component.QueryComponent.prepare(QueryComponent.java:138)&lt;br/&gt;
        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:180)&lt;br/&gt;
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)&lt;br/&gt;
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1452)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:353)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:248)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)&lt;br/&gt;
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)&lt;br/&gt;
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)&lt;br/&gt;
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)&lt;br/&gt;
        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:859)&lt;br/&gt;
        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)&lt;br/&gt;
        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12526815">SOLR-2824</key>
            <summary>Cross-Core Join doesn&apos;t parse fields against joining schema</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="thyzz">Thijs Vonk</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Oct 2011 08:38:47 +0000</created>
                <updated>Fri, 10 May 2013 10:40:15 +0000</updated>
                            <resolved>Mon, 14 May 2012 14:49:32 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>multicore</component>
                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13125918" author="yseeley@gmail.com" created="Wed, 12 Oct 2011 15:19:26 +0000"  >&lt;p&gt;You are correct... this is a bug because we should parse the nested query in the other core.&lt;/p&gt;</comment>
                            <comment id="13159731" author="hossman" created="Wed, 30 Nov 2011 01:26:31 +0000"  >&lt;p&gt;I hacked up a test case demonstrating the problem, but ran out of time before i could try fixing it.  (At the moment the test just demonstrates the problem of &lt;b&gt;parsing&lt;/b&gt; a cross index join, it doesn&apos;t actually try to utilize it - our Test framework does&apos;t make it easy to index/query multiple cores in a single test)&lt;/p&gt;

&lt;p&gt;At first glance, it seems fairly straight forward to fix the JoinQParser to get the &quot;fromIndex&quot; SolrCore via the CoreContainer and then ask it for a parser to parse the nested query, but a few things concern me:&lt;/p&gt;

&lt;p&gt;1) should local params from the &apos;&lt;/p&gt;
{!join...}
&lt;p&gt;&apos; expression (besides from,to, and fromIndex) be passed to the QParser fetched from the fromIndex ?&lt;/p&gt;

&lt;p&gt;2) Are there other bugs lurking in JoinQuery itself that need better cross-index testing?  In particular the JoinQuery.rewrite method smells fishy.&lt;/p&gt;</comment>
                            <comment id="13159735" author="yseeley@gmail.com" created="Wed, 30 Nov 2011 01:40:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;1) should local params from the &apos;{!join...}&apos; expression (besides from,to, and fromIndex) be passed to the QParser fetched from the fromIndex ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;defType is the only local param that would have an impact on the foreign qparser.&lt;br/&gt;
But... all the request parameters should be available to the foreign qparser.&lt;/p&gt;

&lt;p&gt;b1. 2) Are there other bugs lurking in JoinQuery itself that need better cross-index testing? In particular the JoinQuery.rewrite method smells fishy.&lt;/p&gt;

&lt;p&gt;Yep!&lt;/p&gt;</comment>
                            <comment id="13223916" author="hossman" created="Wed, 7 Mar 2012 02:24:22 +0000"  >&lt;p&gt;marking blocker for 4.0 ... if no one comes up with a fix for this problem in time for 4.0, then we should remove the cross-core join code (it&apos;s never been documented, and it&apos;s never really worked properly except in extremely trivial situations)&lt;/p&gt;</comment>
                            <comment id="13224085" author="thyzz" created="Wed, 7 Mar 2012 08:11:11 +0000"  >&lt;p&gt;I hope you don&apos;t remove it.&lt;br/&gt;
I&apos;m currently faking it by having the &apos;joined&apos; columns listed in both schema-files and that works. &lt;/p&gt;</comment>
                            <comment id="13274308" author="yseeley@gmail.com" created="Sun, 13 May 2012 18:09:47 +0000"  >&lt;p&gt;I just checked in a patch for the rewrite issue.  Still need a patch to parse the query in the correct core though.&lt;/p&gt;</comment>
                            <comment id="13274627" author="yseeley@gmail.com" created="Mon, 14 May 2012 14:49:32 +0000"  >&lt;p&gt;I just checked in a patch to parse the query in the correct core.&lt;/p&gt;</comment>
                            <comment id="13277067" author="yseeley@gmail.com" created="Wed, 16 May 2012 20:09:40 +0000"  >&lt;p&gt;Here&apos;s a patch for the last big issue with cross-join: caching of the join when the fromCore searcher has changed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12527690" name="SOLR-2824.patch" size="5003" author="yseeley@gmail.com" created="Wed, 16 May 2012 20:09:40 +0000"/>
                            <attachment id="12505564" name="SOLR-2824.patch" size="4760" author="hossman" created="Wed, 30 Nov 2011 01:26:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73873</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03icn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>