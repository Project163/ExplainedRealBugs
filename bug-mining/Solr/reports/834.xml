<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:26:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3244] New Admin UI doesn&apos;t work on tomcat</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3244</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I am currently unable to open admin interface when using war deployment under tomcat server.&lt;br/&gt;
The stack trace:&lt;/p&gt;

&lt;p&gt;SEVERE: Servlet.service() for servlet &lt;span class=&quot;error&quot;&gt;&amp;#91;LoadAdminUI&amp;#93;&lt;/span&gt; in context with path &lt;span class=&quot;error&quot;&gt;&amp;#91;/solr&amp;#93;&lt;/span&gt; threw exception&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at java.io.File.&amp;lt;init&amp;gt;(File.java:251)&lt;br/&gt;
	at org.apache.solr.servlet.LoadAdminUiServlet.doGet(LoadAdminUiServlet.java:50)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:621)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)&lt;br/&gt;
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:292)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)&lt;br/&gt;
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:224)&lt;br/&gt;
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)&lt;br/&gt;
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472)&lt;br/&gt;
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)&lt;br/&gt;
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)&lt;br/&gt;
	at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:928)&lt;br/&gt;
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)&lt;br/&gt;
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)&lt;br/&gt;
	at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:987)&lt;br/&gt;
	at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:539)&lt;br/&gt;
	at org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1815)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;/p&gt;

&lt;p&gt;Tomcat version: Apache Tomcat/7.0.23&lt;br/&gt;
Java version: jdk1.7.0_02&lt;/p&gt;

&lt;p&gt;I did some debugging and found that the problem related that &lt;br/&gt;
it delegates the resolving of resource path to the org.apache.naming.resources.WARDirContext which simply returns null for any input parameters:&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Return the real path for a given virtual path, if possible; otherwise&lt;/li&gt;
	&lt;li&gt;return &amp;lt;code&amp;gt;null&amp;lt;/code&amp;gt;.&lt;br/&gt;
  *&lt;/li&gt;
	&lt;li&gt;@param path The path to the desired resource&lt;br/&gt;
  */&lt;br/&gt;
@Override&lt;br/&gt;
protected String doGetRealPath(String path) {&lt;br/&gt;
  return null;&lt;br/&gt;
}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Need to check specification, because it may be actually the tomcat bug. We may try use the getResourceAsStream(java.lang.String path) method which should work even for war.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12546371">SOLR-3244</key>
            <summary>New Admin UI doesn&apos;t work on tomcat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uschindler">Uwe Schindler</assignee>
                                    <reporter username="zhygr">Aliaksandr Zhuhrou</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Mar 2012 09:37:44 +0000</created>
                <updated>Thu, 16 Feb 2017 15:55:12 +0000</updated>
                            <resolved>Wed, 14 Mar 2012 20:30:51 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>Admin UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13229109" author="thetaphi" created="Wed, 14 Mar 2012 09:57:35 +0000"  >&lt;p&gt;It seems that the file is missing in the WAR file?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;File f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(getServletContext().getRealPath(&lt;span class=&quot;code-quote&quot;&gt;&quot;admin.html&quot;&lt;/span&gt;));
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(f.exists()) {
  &lt;span class=&quot;code-comment&quot;&gt;// This attribute is set by the SolrDispatchFilter
&lt;/span&gt;  CoreContainer cores = (CoreContainer) request.getAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.CoreContainer&quot;&lt;/span&gt;);

  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; html = IOUtils.toString(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(f), &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In general I am a little bit sceptical about the whole code. In my opinion using File and getRealPath is not the best idea. The simpliest and filesystem-unspecific to get the file is (there may be a servlet container that does not extract WAR files at all and simply returns the resource from &lt;b&gt;inside&lt;/b&gt; the war file):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;InputStream in = getServletContext().getResourceAsStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin.html&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(in != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  &lt;span class=&quot;code-comment&quot;&gt;// This attribute is set by the SolrDispatchFilter
&lt;/span&gt;  CoreContainer cores = (CoreContainer) request.getAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.CoreContainer&quot;&lt;/span&gt;);

  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; html = IOUtils.toString(in, &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;);
  ...
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
  IOUtils.closeSafely(in);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please note the &quot;/&quot; in the path, accoring to JavaDocs of getResource:&lt;/p&gt;

&lt;p&gt;The path must begin with a / and is interpreted as relative to the current context root, or relative to the /META-INF/resources directory of a JAR file inside the web application&apos;s /WEB-INF/lib directory. This method will first search the document root of the web application for the requested resource, before searching any of the JAR files inside /WEB-INF/lib. The order in which the JAR files inside /WEB-INF/lib are searched is undefined.&lt;/p&gt;

&lt;p&gt;This also applies to getRealPath, so I think Tomcat is more picky about that than jetty.&lt;/p&gt;</comment>
                            <comment id="13229113" author="thetaphi" created="Wed, 14 Mar 2012 10:14:06 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;can you apply the attached patch and rebuild the WAR. This fixes this bug and also another security issue:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The inlined pathes are not correctly escaped according to JavaScript rules, this can lead to security problems if you deploy to a path with strange characters in it...&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13229115" author="thetaphi" created="Wed, 14 Mar 2012 10:14:51 +0000"  >&lt;p&gt;It would be nice if you could test this, I have no Tomcat available...&lt;/p&gt;</comment>
                            <comment id="13229167" author="zhygr" created="Wed, 14 Mar 2012 13:12:35 +0000"  >&lt;p&gt;Sure, I will test it at evening. Thank you very much.&lt;/p&gt;</comment>
                            <comment id="13229477" author="zhygr" created="Wed, 14 Mar 2012 18:35:20 +0000"  >&lt;p&gt;I checked your patch and it works on Tomcat.&lt;/p&gt;</comment>
                            <comment id="13229575" author="thetaphi" created="Wed, 14 Mar 2012 20:16:20 +0000"  >&lt;p&gt;Fine, I will commit this now!&lt;/p&gt;</comment>
                            <comment id="13229588" author="thetaphi" created="Wed, 14 Mar 2012 20:30:51 +0000"  >&lt;p&gt;Committed trunk revision: 1300710&lt;/p&gt;

&lt;p&gt;Thanks Aliaksandr!&lt;/p&gt;</comment>
                            <comment id="13229653" author="ryantxu" created="Wed, 14 Mar 2012 21:35:32 +0000"  >&lt;p&gt;Thanks Uwe &amp;#8211; I did not realize you could get the stream directly from ServletContext&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12546205">SOLR-3238</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12518308" name="SOLR-3244.patch" size="2404" author="uschindler" created="Wed, 14 Mar 2012 10:14:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03ftz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17998</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>