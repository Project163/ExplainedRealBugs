<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7259] lazy loading not thread safe</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7259</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;It looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7073&quot; title=&quot;Add an API to add a jar to a collection&amp;#39;s classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7073&quot;&gt;&lt;del&gt;SOLR-7073&lt;/del&gt;&lt;/a&gt; broke the thread safety of lazy loaded components, unsafely publishing the component.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12782621">SOLR-7259</key>
            <summary>lazy loading not thread safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Mar 2015 16:59:21 +0000</created>
                <updated>Wed, 18 Mar 2015 01:57:20 +0000</updated>
                            <resolved>Wed, 18 Mar 2015 01:57:20 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14365532" author="noble.paul" created="Tue, 17 Mar 2015 17:04:11 +0000"  >&lt;p&gt;How is it broken?&lt;/p&gt;</comment>
                            <comment id="14366281" author="yseeley@gmail.com" created="Tue, 17 Mar 2015 23:11:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;How is it broken?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There are a few issues...&lt;/p&gt;

&lt;p&gt;The most basic is that LazyPluginHolder uses the &quot;inst&quot; member directly in createInst().&lt;br/&gt;
This means that even without considering complex reordering and memory barrier issues, the code is incorrect.  It publishes the object as soon as it is created.  Another thread coming along can thus use that object before initInstance() has been called, or even during the execution of initInstance().&lt;/p&gt;

&lt;p&gt;But when we do take the java memory model into account, we need to publish objects safely (i.e. avoid the classic trap behind double-checked locking)&lt;br/&gt;
&lt;a href=&quot;http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Depending on how close() is called (i.e. the possible contexts of it&apos;s use), there&apos;s a race where one thread may be constructing an object and another thread goes through and closes everything, missing the object under construction that will then presumably never have close() called on it.  This last one may not actually be an issue if it&apos;s never called concurrently with other methods.&lt;/p&gt;</comment>
                            <comment id="14366307" author="yseeley@gmail.com" created="Tue, 17 Mar 2015 23:35:04 +0000"  >&lt;p&gt;Here&apos;s a draft patch... I&apos;m kicking off tests now.&lt;br/&gt;
it would be nice if someone would add some concurrency tests to catch this stuff!&lt;/p&gt;</comment>
                            <comment id="14366478" author="jira-bot" created="Wed, 18 Mar 2015 01:53:42 +0000"  >&lt;p&gt;Commit 1667431 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1667431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1667431&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7259&quot; title=&quot;lazy loading not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7259&quot;&gt;&lt;del&gt;SOLR-7259&lt;/del&gt;&lt;/a&gt;: fix thread safety of lazy loaded plugins&lt;/p&gt;</comment>
                            <comment id="14366480" author="jira-bot" created="Wed, 18 Mar 2015 01:55:12 +0000"  >&lt;p&gt;Commit 1667432 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1667432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1667432&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7259&quot; title=&quot;lazy loading not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7259&quot;&gt;&lt;del&gt;SOLR-7259&lt;/del&gt;&lt;/a&gt;: fix thread safety of lazy loaded plugins&lt;/p&gt;</comment>
                            <comment id="14366483" author="yseeley@gmail.com" created="Wed, 18 Mar 2015 01:57:20 +0000"  >&lt;p&gt;committed.&lt;br/&gt;
I&apos;ve just left the comment in close() for future review.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12772299">SOLR-7073</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12705219" name="SOLR-7259.patch" size="4074" author="yseeley@gmail.com" created="Tue, 17 Mar 2015 23:35:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26vk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>