<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:22:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2422] Improve reliability of ZkSolrClientTest</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2422</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The ZKSolrClient test is pretty unreliable, it seems to fail a significant portion of the time on hudson (often on my local as well).&lt;/p&gt;

&lt;p&gt;Additionally it seems to somehow sometimes (maybe depending upon retry loop?) leave a lot of zookeeper threads running.&lt;/p&gt;

&lt;p&gt;I ran into these issues when i discovered that trying to interrupt() these threads after the test completed was triggering a JRE bug, but by working through it I saw how unreliable the test is.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12501223">SOLR-2422</key>
            <summary>Improve reliability of ZkSolrClientTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 Mar 2011 01:39:57 +0000</created>
                <updated>Fri, 27 Sep 2024 17:40:54 +0000</updated>
                            <resolved>Fri, 27 Sep 2024 17:40:54 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                                    <component>Build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13005975" author="rcmuir" created="Sat, 12 Mar 2011 02:24:39 +0000"  >&lt;p&gt;The first problem I found here is in testConnect, it has a timeout of 100ms&lt;/p&gt;

&lt;p&gt;Our lucene slave is pretty busy (lots of cores, so lots of tests going on at once in parallel).&lt;/p&gt;

&lt;p&gt;By changing this timeout to AbstractZkTestCase.TIMEOUT (10000ms), I found the test to be significantly more reliable. This is consistent with the other test cases, they seem to use this timeout.&lt;/p&gt;

&lt;p&gt;I tested this on hudson and it seems a big improvement, so I committed the trivial change in r1080852 (sorry for the heavy-commit, I know we are all sick of the hudson instability).&lt;/p&gt;</comment>
                            <comment id="13005976" author="rcmuir" created="Sat, 12 Mar 2011 02:38:35 +0000"  >&lt;p&gt;There&apos;s definitely something up with the exception message here, but maybe something else going on with reconnection or similar?&lt;/p&gt;

&lt;p&gt;Because I noticed when the test failed before with the 100ms timeout, it would print:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1 tests failed.
FAILED:  org.apache.solr.cloud.ZkSolrClientTest.testConnect

Error Message:
Could not connect to ZooKeeper 127.0.0.1:30762/solr within 30000 ms
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this is what made it hard to debug problems, it made me think it was actually waiting 30000ms, but in fact was only waiting 100ms.&lt;/p&gt;

&lt;p&gt;Looking at ConnectionManager, I think this might indicate a bug (at least in the exception message, but the use of &quot;two timeouts&quot; seems wrong)... i added my comments to the source snippet:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;try {
        // zkClientTimeout = 100ms
        connectionStrategy.reconnect(zkServerAddress, zkClientTimeout, this, new ZkClientConnectionStrategy.ZkUpdate() {
          @Override
          public void update(SolrZooKeeper keeper) throws InterruptedException, TimeoutException, IOException {
           // DEFAULT_CLIENT_CONNECT_TIMEOUT = 30000ms
           waitForConnected(SolrZkClient.DEFAULT_CLIENT_CONNECT_TIMEOUT);
           client.updateKeeper(keeper);
           if(onReconnect != null) {
             onReconnect.command();
           }
           ConnectionManager.this.connected = true;
          }
        });
      } catch (Exception e) {
        log.error(&quot;&quot;, e); // fails after 100ms, but says it waited 30000ms?!
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17885126" author="JIRAUSER305622" created="Thu, 26 Sep 2024 18:11:48 +0000"  >&lt;p&gt;SolrZooKeeper was removed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16114&quot; title=&quot;Get rid of SolrZookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16114&quot;&gt;&lt;del&gt;SOLR-16114&lt;/del&gt;&lt;/a&gt;, default timeout has been increased to 45000ms and reliability of ZkSolrClientTest seems have improved since 4.0-alpha. Therefore, can this ticket be resolved?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5112</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03kun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18811</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>