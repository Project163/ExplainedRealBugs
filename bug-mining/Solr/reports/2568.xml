<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7829] Pivot Facet Bug: facet.missing=true + facet.sort=index facet.pivot.mincount &gt; ? == incorrect &quot;missing&quot; count</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7829</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Following up on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7804&quot; title=&quot;TestCloudPivotFacet failures: expected:&amp;lt;X&amp;gt; but was:&amp;lt;Y&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7804&quot;&gt;SOLR-7804&lt;/a&gt; lead to this error which i&apos;m splitting off into it&apos;s own issue.  the nuthsell is that if you combine facet.missing, facet.pivot.mincount, and facet.sort=index you might get incorrect counts (or no counts at all) for the missing value of a pivot.&lt;/p&gt;

&lt;p&gt;fairly easy to reproduce the most extreme aspect of the problem (not getting a missing count back even though it&apos;s above the minumum)...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;bin/solr -e cloud -noprompt
bin/post -c gettingstarted example/exampledocs/*.xml

http://localhost:8983/solr/gettingstarted/query?rows=0&amp;amp;q=*:*&amp;amp;facet=true&amp;amp;facet.pivot=inStock&amp;amp;facet.missing=true
...
    &quot;facet_pivot&quot;:{
      &quot;inStock&quot;:[{
          &quot;field&quot;:&quot;inStock&quot;,
          &quot;value&quot;:true,
          &quot;count&quot;:17},
        {
          &quot;field&quot;:&quot;inStock&quot;,
          &quot;value&quot;:false,
          &quot;count&quot;:4},
        {
          &quot;field&quot;:&quot;inStock&quot;,
          &quot;value&quot;:null,
          &quot;count&quot;:11}]}}}

http://localhost:8983/solr/gettingstarted/query?rows=0&amp;amp;q=*:*&amp;amp;facet=true&amp;amp;facet.pivot=inStock&amp;amp;facet.missing=true&amp;amp;facet.pivot.mincount=10
...
    &quot;facet_pivot&quot;:{
      &quot;inStock&quot;:[{
          &quot;field&quot;:&quot;inStock&quot;,
          &quot;value&quot;:true,
          &quot;count&quot;:17},
        {
          &quot;field&quot;:&quot;inStock&quot;,
          &quot;value&quot;:null,
          &quot;count&quot;:11}]}}}

http://localhost:8983/solr/gettingstarted/query?rows=0&amp;amp;q=*:*&amp;amp;facet=true&amp;amp;facet.pivot=inStock&amp;amp;facet.missing=true&amp;amp;facet.pivot.mincount=10&amp;amp;facet.sort=index
...
    &quot;facet_pivot&quot;:{
      &quot;inStock&quot;:[{
          &quot;field&quot;:&quot;inStock&quot;,
          &quot;value&quot;:true,
          &quot;count&quot;:17}]}}}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...note that in the last example, the &apos;null&apos; count is gone (even though it&apos;s above the minimum) just because we changed the facet.sort.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12848969">SOLR-7829</key>
            <summary>Pivot Facet Bug: facet.missing=true + facet.sort=index facet.pivot.mincount &gt; ? == incorrect &quot;missing&quot; count</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jul 2015 18:39:03 +0000</created>
                <updated>Mon, 9 May 2016 18:59:01 +0000</updated>
                            <resolved>Tue, 28 Jul 2015 04:20:32 +0000</resolved>
                                                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14641307" author="hossman" created="Sat, 25 Jul 2015 01:08:51 +0000"  >&lt;p&gt;Huh.&lt;/p&gt;

&lt;p&gt;Well apparently the pivot refinement code has incorrectly never bothered to refining the &quot;missing&quot; count ... weird.&lt;/p&gt;

&lt;p&gt;Because the missing count isn&apos;t affected by the facet.limit, this only affects indexes &amp;amp; queries where facet.sort=index and at least one shard has a missing count that falls below the &quot;per shard&quot; mincount (facet.mincount / numShards).&lt;/p&gt;

&lt;p&gt;The attached patch has...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;DistributedFacetPivotSmallTest
	&lt;ul&gt;
		&lt;li&gt;trivially little change that i made the harden that test &amp;#8211; doesn&apos;t catch this error because the number of docs is too small&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;DistributedFacetPivotLargeTest
	&lt;ul&gt;
		&lt;li&gt;non-randomized test that demonstrates the problem&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;PivotFacetField
	&lt;ul&gt;
		&lt;li&gt;fix for the bug to do proper refinement of the missing count&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll let my laptop hammer on this over the weekend and plan to commit monday.&lt;/p&gt;</comment>
                            <comment id="14643807" author="jira-bot" created="Tue, 28 Jul 2015 03:32:22 +0000"  >&lt;p&gt;Commit 1692983 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1692983&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1692983&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7829&quot; title=&quot;Pivot Facet Bug: facet.missing=true + facet.sort=index facet.pivot.mincount &amp;gt; ? == incorrect &amp;quot;missing&amp;quot; count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7829&quot;&gt;&lt;del&gt;SOLR-7829&lt;/del&gt;&lt;/a&gt;: Fixed a bug in distributed pivot faceting that could result in a facet.missing=true count which was lower then the correct count if facet.sort=index and facet.pivot.mincount &amp;gt; 1&lt;/p&gt;</comment>
                            <comment id="14643828" author="jira-bot" created="Tue, 28 Jul 2015 04:20:05 +0000"  >&lt;p&gt;Commit 1692987 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1692987&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1692987&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7829&quot; title=&quot;Pivot Facet Bug: facet.missing=true + facet.sort=index facet.pivot.mincount &amp;gt; ? == incorrect &amp;quot;missing&amp;quot; count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7829&quot;&gt;&lt;del&gt;SOLR-7829&lt;/del&gt;&lt;/a&gt;: Fixed a bug in distributed pivot faceting that could result in a facet.missing=true count which was lower then the correct count if facet.sort=index and facet.pivot.mincount &amp;gt; 1 (merge r1692983)&lt;/p&gt;</comment>
                            <comment id="14713335" author="shalinmangar" created="Wed, 26 Aug 2015 13:06:28 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12845887">SOLR-7804</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12747139" name="SOLR-7829.patch" size="7874" author="hossman" created="Sat, 25 Jul 2015 01:08:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hwq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>