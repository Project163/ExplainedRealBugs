<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:33:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12354] org.apache.solr.security.PKIAuthenticationPlugin does not check response code when retrieving remotePublicKey</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12354</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;in decipherHeader(), if&#160;keyCache does not contain the key of interest, then a remote call is made to retrieve the key from the remote host, by calling&#160;getRemotePublicKey, which fails if the server returns an html error page.&lt;/p&gt;

&lt;p&gt;e.g.:&lt;/p&gt;

&lt;p&gt;org.noggit.JSONParser$ParseException: JSON Parse Error: char=&amp;lt;,position=0 BEFORE=&apos;&amp;lt;&apos; AFTER=&apos;html&amp;gt; &amp;lt;head&amp;gt; &amp;lt;meta http-equiv=&quot;Content-&apos; at org.noggit.JSONParser.err(JSONParser.java:356) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;noggit-0.6.jar:?&amp;#93;&lt;/span&gt; at org.noggit.JSONParser.handleNonDoubleQuoteString(JSONParser.java:712) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;noggit-0.6.jar:?&amp;#93;&lt;/span&gt; at org.noggit.JSONParser.next(JSONParser.java:886) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;noggit-0.6.jar:?&amp;#93;&lt;/span&gt; at org.noggit.JSONParser.nextEvent(JSONParser.java:930) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;noggit-0.6.jar:?&amp;#93;&lt;/span&gt; at org.noggit.ObjectBuilder.&amp;lt;init&amp;gt;(ObjectBuilder.java:44) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;noggit-0.6.jar:?&amp;#93;&lt;/span&gt; at org.noggit.ObjectBuilder.getVal(ObjectBuilder.java:37) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;noggit-0.6.jar:?&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13159229">SOLR-12354</key>
            <summary>org.apache.solr.security.PKIAuthenticationPlugin does not check response code when retrieving remotePublicKey</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="hamadaCA">hamada</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 May 2018 23:08:52 +0000</created>
                <updated>Sat, 8 Jun 2019 15:15:07 +0000</updated>
                            <resolved>Tue, 5 Jun 2018 02:10:42 +0000</resolved>
                                    <version>6.6.2</version>
                    <version>6.6.3</version>
                                    <fixVersion>7.4</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>Authentication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16486648" author="noble.paul" created="Wed, 23 May 2018 03:20:15 +0000"  >&lt;p&gt;It is not very useful to handle this exception because it is not supposed top happen in the first place. Can you give steps to reproduce this?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16497897" author="noble.paul" created="Fri, 1 Jun 2018 12:00:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;The initiator triggers this request with the server lifecycle init(), where the initiator isn&apos;t accepting requests quite yet, hence the exception&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, if any node make any request to other nodes before initializing the public key, those requests fail.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So, I have&#160;made&#160; the public key initiation as the very first step in the CoreContainer startup&lt;/p&gt;</comment>
                            <comment id="16498262" author="varunthacker" created="Fri, 1 Jun 2018 17:14:07 +0000"  >&lt;p&gt;Hi Noble,&lt;/p&gt;

&lt;p&gt;In SolrDispatchFilter we create&#160;a CoreContainer object and then call the load method&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; CoreContainer createCoreContainer(Path solrHome, Properties extraProperties) {
  NodeConfig nodeConfig = loadNodeConfig(solrHome, extraProperties);
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CoreContainer coreContainer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CoreContainer(nodeConfig, extraProperties, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
  coreContainer.load();
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; coreContainer;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In&#160;CoreContainer#load we create the ZooKeeper container object and register this node as a live node under /live_nodes&lt;/p&gt;

&lt;p&gt;So by moving&#160;the public key initialization from CoreContrainer#load to the constructor we ensure that the handler is available before a node is registered as a live node&lt;/p&gt;

&lt;p&gt;There will always be a race between when the solr port get&apos;s initialized and the CoreContainer object get&apos;s created. We expect all clients to only issue a request to a node if it&apos;s registered under /live_nodes&#160;&lt;/p&gt;

&lt;p&gt;Is my understanding of the issue correct here?&lt;/p&gt;

&lt;p&gt;If it is then can we simply move the handler initialization before this statement in CoreContainer#load . It should have the same effect right?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
zkSys.initZooKeeper(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, solrHome, cfg.getCloudConfig());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;On a side note CoreContainer has unused imports which would break precommit&lt;/p&gt;</comment>
                            <comment id="16499068" author="lucenesolrqa" created="Sat, 2 Jun 2018 13:33:34 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; patch &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;  0m  6s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12354&quot; title=&quot;org.apache.solr.security.PKIAuthenticationPlugin does not check response code when retrieving remotePublicKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12354&quot;&gt;&lt;del&gt;SOLR-12354&lt;/del&gt;&lt;/a&gt; does not apply to master. Rebase required? Wrong Branch? See &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&lt;/a&gt; for help. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12354&quot; title=&quot;org.apache.solr.security.PKIAuthenticationPlugin does not check response code when retrieving remotePublicKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12354&quot;&gt;&lt;del&gt;SOLR-12354&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12926081/SOLR-12354.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12926081/SOLR-12354.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/110/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/110/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16499912" author="noble.paul" created="Mon, 4 Jun 2018 08:53:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;There will always be a race between when the solr port get&apos;s initialized and the CoreContainer object get&apos;s created. We expect all clients to only issue a request to a node if it&apos;s registered under /live_nodes&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, the requests may or may not fail while the node is starting up. it&apos;s unavoidable for any system to fail requests until it&apos;s completely started up. But, it&apos;s unacceptable if requests &lt;em&gt;not triggered by users&lt;/em&gt; fail because it&apos;s not fully started up&lt;/p&gt;</comment>
                            <comment id="16500136" author="jira-bot" created="Mon, 4 Jun 2018 12:14:56 +0000"  >&lt;p&gt;Commit 727da63f4affca3a7001c19322dfa936ab507bc3 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=727da63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=727da63&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12354&quot; title=&quot;org.apache.solr.security.PKIAuthenticationPlugin does not check response code when retrieving remotePublicKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12354&quot;&gt;&lt;del&gt;SOLR-12354&lt;/del&gt;&lt;/a&gt;: Register the /admin/info/key end-point at the startup time to avoid 404&lt;/p&gt;</comment>
                            <comment id="16500175" author="jira-bot" created="Mon, 4 Jun 2018 13:01:34 +0000"  >&lt;p&gt;Commit 90b7244e2b114f10876bda286320de051eb9dfb1 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=90b7244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=90b7244&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12354&quot; title=&quot;org.apache.solr.security.PKIAuthenticationPlugin does not check response code when retrieving remotePublicKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12354&quot;&gt;&lt;del&gt;SOLR-12354&lt;/del&gt;&lt;/a&gt;: Register the /admin/info/key end-point at the startup time to avoid 404&lt;/p&gt;</comment>
                            <comment id="16500176" author="jira-bot" created="Mon, 4 Jun 2018 13:01:35 +0000"  >&lt;p&gt;Commit baf343461ee8b1003ad5c927d345654086dbbc53 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=baf3434&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=baf3434&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12354&quot; title=&quot;org.apache.solr.security.PKIAuthenticationPlugin does not check response code when retrieving remotePublicKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12354&quot;&gt;&lt;del&gt;SOLR-12354&lt;/del&gt;&lt;/a&gt;: Register the /admin/info/key end-point at the startup time to avoid 404&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12926081" name="SOLR-12354.patch" size="18487" author="noble.paul" created="Fri, 1 Jun 2018 12:00:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tp3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>