<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:41:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13924] MoveReplica failures when using HDFS (NullPointerException)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13924</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Based on recent jenkins test failures, it appears that attemping to use the &quot;MoveReplica&quot; command on HDFS has a high chance of failure due to an underlying NPE.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if this bug &lt;b&gt;only&lt;/b&gt; affects HDFS, or if it&apos;s just more likly to occur when using HDFS due to some timing quirks.&lt;/p&gt;

&lt;p&gt;It&apos;s also possible that the bug impacts non-HDFS users just as much as HDFS users, but only manifests in our tests due to some quick of our &lt;tt&gt;cloud-hdfs&lt;/tt&gt; test configs.&lt;/p&gt;

&lt;p&gt;The problem appears to be new in 8.3 as a result of changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13843&quot; title=&quot;The MOVEREPLICA API ignores replica type and always adds &amp;#39;nrt&amp;#39; replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13843&quot;&gt;&lt;del&gt;SOLR-13843&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13267795">SOLR-13924</key>
            <summary>MoveReplica failures when using HDFS (NullPointerException)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Nov 2019 18:17:55 +0000</created>
                <updated>Mon, 17 Feb 2025 09:36:51 +0000</updated>
                            <resolved>Mon, 17 Feb 2025 09:36:51 +0000</resolved>
                                    <version>8.3</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16972677" author="hossman" created="Tue, 12 Nov 2019 18:19:36 +0000"  >&lt;p&gt;Reviewing the logs for &lt;tt&gt;MoveReplicaHDFSTest&lt;/tt&gt; jenkins failures from the past 7 days shows a similar pattern in every failure...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Test ultimately fails with...
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4] FAILURE 19.4s J0 | MoveReplicaHDFSTest.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected not same
   [junit4]    &amp;gt;        at __randomizedtesting.SeedInfo.seed([7631F50DBFD47AFA:FE65CAD711281702]:0)
   [junit4]    &amp;gt;        at org.apache.solr.cloud.MoveReplicaTest.test(MoveReplicaTest.java:147)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
	&lt;ul&gt;
		&lt;li&gt;This assertion comes from a loop checking the async status of a &lt;tt&gt;MoveReplica&lt;/tt&gt; replica request...
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      assertNotSame(rsp.getRequestStatus(), RequestStatusState.FAILED);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Looking back in the logs we see...
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 1325710 ERROR (OverseerThreadFactory-2562-thread-3-processing-n:127.0.0.1:37772_solr) [n:127.0.0.1:37772_solr c:MoveReplicaHDFSTest_coll_true  r:core_node8  ] o.a.s.c.a.c.O
verseerCollectionMessageHandler Collection: MoveReplicaHDFSTest_coll_true operation: movereplica failed:java.lang.NullPointerException
   [junit4]   2&amp;gt;        at org.apache.solr.cloud.api.collections.MoveReplicaCmd.moveHdfsReplica(MoveReplicaCmd.java:220)
   [junit4]   2&amp;gt;        at org.apache.solr.cloud.api.collections.MoveReplicaCmd.moveReplica(MoveReplicaCmd.java:160)
   [junit4]   2&amp;gt;        at org.apache.solr.cloud.api.collections.MoveReplicaCmd.call(MoveReplicaCmd.java:70)
   [junit4]   2&amp;gt;        at org.apache.solr.cloud.api.collections.OverseerCollectionMessageHandler.processMessage(OverseerCollectionMessageHandler.java:263)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If we look back at the long term stats, we see a significant uptick in jenkins failures from this test starting around 2019-10-18.  Note the number of jenkins failures from this test every day in 2019 (skipping days where there were &apos;0&apos; failures)...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;~/jenkins-reports/output/html/reports/archive/daily$ zgrep -c MoveReplicaHDFSTest 2019-*method-failures.csv.gz | grep -v &apos;:0$&apos;
2019-03-13.method-failures.csv.gz:1
2019-10-18.method-failures.csv.gz:1
2019-10-19.method-failures.csv.gz:1
2019-10-20.method-failures.csv.gz:8
2019-10-21.method-failures.csv.gz:5
2019-10-23.method-failures.csv.gz:1
2019-10-24.method-failures.csv.gz:2
2019-10-25.method-failures.csv.gz:1
2019-10-26.method-failures.csv.gz:1
2019-10-27.method-failures.csv.gz:2
2019-10-28.method-failures.csv.gz:6
2019-10-29.method-failures.csv.gz:4
2019-10-30.method-failures.csv.gz:2
2019-10-31.method-failures.csv.gz:7
2019-11-01.method-failures.csv.gz:3
2019-11-02.method-failures.csv.gz:2
2019-11-03.method-failures.csv.gz:3
2019-11-04.method-failures.csv.gz:2
2019-11-05.method-failures.csv.gz:7
2019-11-06.method-failures.csv.gz:6
2019-11-08.method-failures.csv.gz:6
2019-11-09.method-failures.csv.gz:6
2019-11-10.method-failures.csv.gz:1
2019-11-11.method-failures.csv.gz:9
2019-11-12.method-failures.csv.gz:10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That date corrispond closely to when &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13843&quot; title=&quot;The MOVEREPLICA API ignores replica type and always adds &amp;#39;nrt&amp;#39; replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13843&quot;&gt;&lt;del&gt;SOLR-13843&lt;/del&gt;&lt;/a&gt; was commited (86a40c1cd5691ce8c9c233c9a8186a4f50aa4f5f on master)&lt;/p&gt;

&lt;p&gt;If I compare &lt;tt&gt;git co master&lt;/tt&gt;, &lt;tt&gt;git co 86a40c1cd5691ce8c9c233c9a8186a4f50aa4f5f&lt;/tt&gt; and &lt;tt&gt;git co 86a40c1cd5691ce8c9c233c9a8186a4f50aa4f5f~1&lt;/tt&gt; I see that beasting this seed just a few times fails reliably on &lt;tt&gt;HEAD&lt;/tt&gt;, and @ &lt;tt&gt;86a40c1cd56&lt;/tt&gt; but passess reliably one SHA prior to the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13843&quot; title=&quot;The MOVEREPLICA API ignores replica type and always adds &amp;#39;nrt&amp;#39; replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13843&quot;&gt;&lt;del&gt;SOLR-13843&lt;/del&gt;&lt;/a&gt; commit....&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@slate:~/lucene/dev/solr/core [j11] [master] $ ant beast -Dbeast.iters=10  -Dtestcase=MoveReplicaHDFSTest -Dtests.nightly=true -Dtests.slow=true -Dtests.seed=7631F50DBFD47AFA
...
  [beaster] Tests with failures [seed: 7631F50DBFD47AFA]:
  [beaster]   - org.apache.solr.cloud.MoveReplicaHDFSTest.test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@slate:~/lucene/dev/solr/core [j11] [86a40c1cd56] $ ant beast -Dbeast.iters=10  -Dtestcase=MoveReplicaHDFSTest -Dtests.nightly=true -Dtests.slow=true -Dtests.seed=7631F50DBFD47AFA
...
  [beaster] Tests with failures [seed: 7631F50DBFD47AFA]:
  [beaster]   - org.apache.solr.cloud.MoveReplicaHDFSTest.test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@slate:~/lucene/dev/solr/core [j11] [63e9bcf5d15] $ ant beast -Dbeast.iters=10  -Dtestcase=MoveReplicaHDFSTest -Dtests.nightly=true -Dtests.slow=true -Dtests.seed=7631F50DBFD47AFA
...
  [beaster] Beast round 10 results: /home/hossman/lucene/dev/solr/build/solr-core/test/10
  [beaster] Beasting finished Successfully.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="16972864" author="shalinmangar" created="Tue, 12 Nov 2019 22:52:58 +0000"  >&lt;p&gt;The changes to the MoveReplicaTest in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13843&quot; title=&quot;The MOVEREPLICA API ignores replica type and always adds &amp;#39;nrt&amp;#39; replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13843&quot;&gt;&lt;del&gt;SOLR-13843&lt;/del&gt;&lt;/a&gt; started adding either a TLOG or a PULL replica to the collection in addition to the NRT replica. This exposed a genuine bug. Move replica operation does not work for PULL replicas stored on HDFS. We just didn&apos;t know so far because there were no tests for it.&lt;/p&gt;

&lt;p&gt;Basically move replica operation for HDFS assumes that each replica has an update log directory containing the tlog files but the PULL type replicas do not have them. This causes the NPE.&lt;/p&gt;</comment>
                            <comment id="16976702" author="jira-bot" created="Mon, 18 Nov 2019 16:58:28 +0000"  >&lt;p&gt;Commit f9076d85cf4804db3eedb23f9ef616f050d328db in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f9076d8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f9076d8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13924&quot; title=&quot;MoveReplica failures when using HDFS (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13924&quot;&gt;&lt;del&gt;SOLR-13924&lt;/del&gt;&lt;/a&gt;: AwaitsFix: MoveReplicaHDFSTest&lt;/p&gt;</comment>
                            <comment id="16976715" author="jira-bot" created="Mon, 18 Nov 2019 17:16:09 +0000"  >&lt;p&gt;Commit 3b7e33790a487026f590199efd148de011128a3b in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3b7e337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3b7e337&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13924&quot; title=&quot;MoveReplica failures when using HDFS (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13924&quot;&gt;&lt;del&gt;SOLR-13924&lt;/del&gt;&lt;/a&gt;: AwaitsFix: MoveReplicaHDFSTest&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f9076d85cf4804db3eedb23f9ef616f050d328db)&lt;/p&gt;</comment>
                            <comment id="16976716" author="hossman" created="Mon, 18 Nov 2019 17:17:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13924&quot; title=&quot;MoveReplica failures when using HDFS (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13924&quot;&gt;&lt;del&gt;SOLR-13924&lt;/del&gt;&lt;/a&gt;: AwaitsFix: MoveReplicaHDFSTest&lt;/p&gt;

&lt;p&gt;I&apos;ve AwaitsFix&apos;ed the entire class due to this bug so it no longer triggers jenkins failures, but I should point out that some of the individual test methods have already been BadApple&apos;ed with an annotation pointing at &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12028&quot; title=&quot;BadApple and AwaitsFix annotations usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12028&quot;&gt;&lt;del&gt;SOLR-12028&lt;/del&gt;&lt;/a&gt;, however:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12028&quot; title=&quot;BadApple and AwaitsFix annotations usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12028&quot;&gt;&lt;del&gt;SOLR-12028&lt;/del&gt;&lt;/a&gt; BadApple annotations were added ~2018-10&lt;/li&gt;
	&lt;li&gt;Prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13843&quot; title=&quot;The MOVEREPLICA API ignores replica type and always adds &amp;#39;nrt&amp;#39; replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13843&quot;&gt;&lt;del&gt;SOLR-13843&lt;/del&gt;&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13924&quot; title=&quot;MoveReplica failures when using HDFS (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13924&quot;&gt;&lt;del&gt;SOLR-13924&lt;/del&gt;&lt;/a&gt; failures, the last jenkins failure from this class was 2019-03-13
	&lt;ul&gt;
		&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt; did a lot of general HDFS test improvements, including modifications to this class, in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13330&quot; title=&quot;Improve HDFS tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13330&quot;&gt;&lt;del&gt;SOLR-13330&lt;/del&gt;&lt;/a&gt; ~2019-03 which where probably related to the drop off in failures&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;So once &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13924&quot; title=&quot;MoveReplica failures when using HDFS (NullPointerException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13924&quot;&gt;&lt;del&gt;SOLR-13924&lt;/del&gt;&lt;/a&gt; is fixed, the entire test should be re-evaluated to confirm if all the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12028&quot; title=&quot;BadApple and AwaitsFix annotations usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12028&quot;&gt;&lt;del&gt;SOLR-12028&lt;/del&gt;&lt;/a&gt; annotations can be removed.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17927657" author="epugh" created="Mon, 17 Feb 2025 09:36:51 +0000"  >&lt;p&gt;HDFS has been removed in Solr 10.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13262138">SOLR-13843</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08iuw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>