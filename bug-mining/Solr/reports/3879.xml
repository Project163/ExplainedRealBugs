<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:32:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12201] TestReplicationHandler.doTestIndexFetchOnMasterRestart(): unexpected replication failures</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12201</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This is a BadApple&apos;d test, and in local beasting failed 31/100 iterations.&lt;/p&gt;

&lt;p&gt;E.g. from &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-BadApples-Tests-master/24/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-BadApples-Tests-master/24/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   1&amp;gt; SHALIN: {responseHeader={status=0,QTime=150},details={indexSize=11.2 KB,indexPath=/home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/solr/build/solr-core/test/J1/temp/solr.handler.TestReplicationHandler_C1A11EE85E7B0C57-001/solr-instance-008/./collection1/data/index/,commits=[{indexVersion=1523043739675,generation=2,filelist=[_0.fdt, _0.fdx, _0.fnm, _0.nvd, _0.nvm, _0.si, _0_FSTOrd50_0.doc, _0_FSTOrd50_0.tbk, _0_FSTOrd50_0.tix, segments_2]}],isMaster=false,isSlave=true,indexVersion=1523043739675,generation=2,slave={masterDetails={indexSize=11.27 KB,indexPath=/home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/solr/build/solr-core/test/J1/temp/solr.handler.TestReplicationHandler_C1A11EE85E7B0C57-001/solr-instance-007/./collection1/data/index/,commits=[{indexVersion=0,generation=1,filelist=[segments_1]}, {indexVersion=1523043739675,generation=2,filelist=[_0.fdt, _0.fdx, _0.fnm, _0.nvd, _0.nvm, _0.si, _0_FSTOrd50_0.doc, _0_FSTOrd50_0.tbk, _0_FSTOrd50_0.tix, segments_2]}],isMaster=true,isSlave=false,indexVersion=1523043739675,generation=2,master={confFiles=schema.xml,replicateAfter=[commit, startup],replicationEnabled=true,replicableVersion=1523043739675,replicableGeneration=2}},masterUrl=http://127.0.0.1:36880/solr/collection1,pollInterval=00:00:01,nextExecutionAt=Fri Apr 06 20:42:21 BST 2018,indexReplicatedAt=Fri Apr 06 20:42:20 BST 2018,indexReplicatedAtList=[Fri Apr 06 20:42:20 BST 2018, Fri Apr 06 20:42:17 BST 2018],replicationFailedAtList=[Fri Apr 06 20:42:17 BST 2018],timesIndexReplicated=2,lastCycleBytesDownloaded=11650,timesFailed=1,replicationFailedAt=Fri Apr 06 20:42:17 BST 2018,previousCycleTimeInSeconds=0,currentDate=Fri Apr 06 20:42:21 BST 2018,isPollingDisabled=false,isReplicating=false}}}
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestIndexFetchOnMasterRestart -Dtests.seed=C1A11EE85E7B0C57 -Dtests.multiplier=2 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=en -Dtests.timezone=Europe/Isle_of_Man -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 9.39s J1 | TestReplicationHandler.doTestIndexFetchOnMasterRestart &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([C1A11EE85E7B0C57:1956DA0CF5A0CE0B]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.TestReplicationHandler.doTestIndexFetchOnMasterRestart(TestReplicationHandler.java:666)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The failed assertion is on line 666:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;TestReplicationHandler.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
666:    assertEquals(1, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(getSlaveDetails(&lt;span class=&quot;code-quote&quot;&gt;&quot;timesIndexReplicated&quot;&lt;/span&gt;)));
667:    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; timesFailed = getSlaveDetails(&lt;span class=&quot;code-quote&quot;&gt;&quot;timesFailed&quot;&lt;/span&gt;);
668:    assertEquals(0, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(timesFailed != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ?  timesFailed : &lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;getSlaveDetails()&lt;/tt&gt; prints out the properties it retrieves as JSON following &quot;SHALIN:&quot; &amp;#8211; see the log excerpt above.  &lt;tt&gt;timesIndexReplicated&lt;/tt&gt; is 2 instead of 1 because there was an unexpected replication failure: &lt;tt&gt;timesFailed&lt;/tt&gt; is 1; if the assertion at line 666 were not there, then the one asserting zero replication failures, at line 668, would fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13150732">SOLR-12201</key>
            <summary>TestReplicationHandler.doTestIndexFetchOnMasterRestart(): unexpected replication failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Sat, 7 Apr 2018 00:32:30 +0000</created>
                <updated>Sat, 8 Jun 2019 15:12:21 +0000</updated>
                            <resolved>Wed, 11 Apr 2018 02:16:20 +0000</resolved>
                                                    <fixVersion>7.4</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16429174" author="steve_rowe" created="Sat, 7 Apr 2018 00:42:50 +0000"  >&lt;p&gt;I temporarily put another assertion at the top of the failing test to make sure that the replication failure count is zero, and it is in all the test runs I&apos;ve done; these failures are not the result of other test methods&apos; failing to cleanup properly.&lt;/p&gt;</comment>
                            <comment id="16429313" author="mkhludnev" created="Sat, 7 Apr 2018 11:10:31 +0000"  >&lt;p&gt;reproduced locally&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestIndexFetchOnMasterRestart -Dtests.seed=C1A11EE85E7B0C57 -Dtests.multiplier=2 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=en -Dtests.timezone=Europe/Isle_of_Man -Dtests.asserts=true -Dtests.file.encoding=UTF-8&lt;/p&gt;&lt;/blockquote&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestIndexFetchOnMasterRestart -Dtests.seed=C1A11EE85E7B0C57 -Dtests.multiplier=2 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.badapples=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=en -Dtests.timezone=Europe/Isle_of_Man -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=UTF-8
   [junit4] FAILURE  145s | TestReplicationHandler.doTestIndexFetchOnMasterRestart &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;3&amp;gt;
   [junit4]    &amp;gt;        at __randomizedtesting.SeedInfo.seed([C1A11EE85E7B0C57:1956DA0CF5A0CE0B]:0)
   [junit4]    &amp;gt;        at org.apache.solr.handler.TestReplicationHandler.doTestIndexFetchOnMasterRestart(TestReplicationHandler.java:666)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16433303" author="steve_rowe" created="Wed, 11 Apr 2018 02:14:57 +0000"  >&lt;p&gt;Attached patch allows for the possibility that prior to restarting master, replication may have failed, e.g. because master was still loading when slave wanted to replicate:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 41046 WARN  (indexFetcher-265-thread-1) [    ] o.a.s.h.IndexFetcher Master at: http://127.0.0.1:50479/solr/collection1 is not available. Index 
fetch failed by exception: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:50479/solr/collection1: SolrCore is loading
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the patch 100 beasting iterations succeeded for me. &#160;The patch also removes the BadApple annotation from the test.&lt;/p&gt;

&lt;p&gt;Committing shortly.&lt;/p&gt;</comment>
                            <comment id="16433308" author="jira-bot" created="Wed, 11 Apr 2018 02:15:59 +0000"  >&lt;p&gt;Commit 66816b045147806b49d99d3f252989674f610441 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=66816b0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=66816b0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12201&quot; title=&quot;TestReplicationHandler.doTestIndexFetchOnMasterRestart(): unexpected replication failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12201&quot;&gt;&lt;del&gt;SOLR-12201&lt;/del&gt;&lt;/a&gt;: TestReplicationHandler.doTestIndexFetchOnMasterRestart(): handle unexpected replication failures&lt;/p&gt;</comment>
                            <comment id="16433309" author="jira-bot" created="Wed, 11 Apr 2018 02:16:01 +0000"  >&lt;p&gt;Commit fe0da9e8d5d9680e79e99139a5b136fae1f7ce6f in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fe0da9e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fe0da9e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12201&quot; title=&quot;TestReplicationHandler.doTestIndexFetchOnMasterRestart(): unexpected replication failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12201&quot;&gt;&lt;del&gt;SOLR-12201&lt;/del&gt;&lt;/a&gt;: TestReplicationHandler.doTestIndexFetchOnMasterRestart(): handle unexpected replication failures&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12962275">SOLR-9036</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13144105">SOLR-12078</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12918496" name="SOLR-12201.patch" size="2534" author="sarowe" created="Wed, 11 Apr 2018 02:10:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s9cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>