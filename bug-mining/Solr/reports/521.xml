<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:19:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-1630] StringIndexOutOfBoundsException in SpellCheckComponent</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1630</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;For some documents/search strings, the SpellCheckComponent throws StringIndexOutOfBoundsException&lt;br/&gt;
See: &lt;a href=&quot;http://www.lucidimagination.com/search/document/3be6555227e031fc/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.lucidimagination.com/search/document/3be6555227e031fc/&lt;/a&gt;&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;Replication&quot;&gt;&lt;/a&gt;Replication&lt;/h2&gt;

&lt;ul&gt;
	&lt;li&gt;Save attached schema.xml and solrconfig.xml in apache-solr-1.4.0/example/solr/conf&lt;/li&gt;
	&lt;li&gt;Start Solr&lt;/li&gt;
	&lt;li&gt;Index attached bug.xml&lt;/li&gt;
	&lt;li&gt;Query &lt;a href=&quot;http://localhost:8983/solr/select/?q=awehjse-wjkekw&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select/?q=awehjse-wjkekw&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It throws a StringIndexOutOfBoundsException&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; String index out of range: -7

java.lang.StringIndexOutOfBoundsException: String index out of range: -7
	at java.lang.AbstractStringBuilder.replace(Unknown Source)
	at java.lang.StringBuilder.replace(Unknown Source)
	at org.apache.solr.handler.component.SpellCheckComponent.toNamedList(SpellCheckComponent.java:248)
	at org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:143)
	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:195)
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:1316)
	at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:338)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:241)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </description>
                <environment>&lt;p&gt;Solr 1.4&lt;br/&gt;
Lucene 2.9.1&lt;br/&gt;
Win XP&lt;br/&gt;
java version &quot;1.6.0_14&quot;&lt;/p&gt;</environment>
        <key id="12442640">SOLR-1630</key>
            <summary>StringIndexOutOfBoundsException in SpellCheckComponent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="robin.wojciki@gmail.com">Robin Wojciki</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Dec 2009 16:24:51 +0000</created>
                <updated>Fri, 10 May 2013 10:39:05 +0000</updated>
                            <resolved>Fri, 20 Aug 2010 14:01:42 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>Schema and Analysis</component>
                    <component>spellchecker</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="12786978" author="robin.wojciki@gmail.com" created="Mon, 7 Dec 2009 16:39:35 +0000"  >&lt;p&gt;Solr config and Solr doc for replicating the issue&lt;/p&gt;</comment>
                            <comment id="12790816" author="glebourg" created="Tue, 15 Dec 2009 16:54:35 +0000"  >&lt;p&gt;Hi, it seems I&apos;ve encountered the same bug. All queries using the - char, or the _ char make solr throw an exception when using the SpellCheckComponent. It is possible to temporary fix it by setting accuracy parameter to 1.0 (which makes the spellcheck pretty useless, but avoid exceptions).&lt;/p&gt;</comment>
                            <comment id="12791318" author="shalinmangar" created="Wed, 16 Dec 2009 11:05:54 +0000"  >&lt;p&gt;I&apos;m not able to reproduce this issue. I used Robin&apos;s document, schema and solrconfig.xml in the form of a unit test and it gives an empty spell check response but no exceptions.&lt;/p&gt;</comment>
                            <comment id="12791325" author="glebourg" created="Wed, 16 Dec 2009 11:12:56 +0000"  >&lt;p&gt;Ok, i&apos;lm gonna try to upload my own config in case it can help.&lt;/p&gt;</comment>
                            <comment id="12791334" author="glebourg" created="Wed, 16 Dec 2009 11:35:56 +0000"  >&lt;p&gt;This file provide a spellcheck configuration and a requesthandler which may raise an exception when making queries&lt;/p&gt;

&lt;p&gt;    Example of queries which work fine :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;?q=test&lt;/li&gt;
	&lt;li&gt;?q=my+name+is+henry&lt;/li&gt;
	&lt;li&gt;?q=&#233;l&#233;phant&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Example of queries which throw an exception :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;?q=sous-marin&lt;/li&gt;
	&lt;li&gt;?q=sous-marin+russe&lt;/li&gt;
	&lt;li&gt;?q=sous_marin&lt;/li&gt;
	&lt;li&gt;?q=&#233;l&#233;phant-blanc&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;   It may be linked to the content of the index, and/or the spellcheck index.&lt;/p&gt;

&lt;p&gt;Here is the stack :&lt;/p&gt;

&lt;p&gt;	at java.lang.AbstractStringBuilder.replace(AbstractStringBuilder.java:797)&lt;br/&gt;
	at java.lang.StringBuilder.replace(StringBuilder.java:271)&lt;br/&gt;
	at org.apache.solr.handler.component.SpellCheckComponent.toNamedList(SpellCheckComponent.java:248)&lt;br/&gt;
	at org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:143)&lt;br/&gt;
	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:195)&lt;br/&gt;
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)&lt;br/&gt;
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:1316)&lt;br/&gt;
	at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:338)&lt;br/&gt;
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:241)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1089)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:365)&lt;br/&gt;
	at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)&lt;br/&gt;
	at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712)&lt;br/&gt;
	at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:211)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)&lt;br/&gt;
	at org.mortbay.jetty.Server.handle(Server.java:285)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:502)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:821)&lt;br/&gt;
	at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:513)&lt;br/&gt;
	at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:208)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:378)&lt;br/&gt;
	at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:226)&lt;br/&gt;
	at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)&lt;/p&gt;</comment>
                            <comment id="12791342" author="shalinmangar" created="Wed, 16 Dec 2009 12:09:40 +0000"  >&lt;p&gt;Thanks Guillaume, can you give me an example document too?&lt;/p&gt;</comment>
                            <comment id="12791360" author="glebourg" created="Wed, 16 Dec 2009 13:25:07 +0000"  >&lt;p&gt;I&apos;ve been trying to reproduce the bug with a &quot;one-document index&quot;, but I fail... on the other hand, on index of 500k+ documents this issue is &quot;automatic&quot;. Maybe it&apos;s linked with some kinds of documents ? I don&apos;t know, I&apos;m gonna test some other possibilities in case it can help.&lt;/p&gt;</comment>
                            <comment id="12800622" author="ralf_kraus" created="Fri, 15 Jan 2010 08:46:55 +0000"  >&lt;p&gt;We have found an hint to the problem:&lt;/p&gt;

&lt;p&gt;We run into into this problem ONLY when the search result includes words with &quot;-&quot; in it! &lt;br/&gt;
For example &quot;t-bone-steak&quot;.&lt;/p&gt;

&lt;p&gt;When I search with &quot;t-bone-steak&quot; the error occurs every time !&lt;/p&gt;

&lt;p&gt;I hope we could help!&lt;/p&gt;</comment>
                            <comment id="12802630" author="jayallenhill@gmail.com" created="Wed, 20 Jan 2010 02:44:34 +0000"  >&lt;p&gt;I have seen another case of a production system hitting this exact same exception. However I&apos;m unable to reproduce it outside of production. However it is occurring on all queries with hyphenated words. For a search on: ochoa-brillembourg&lt;/p&gt;

&lt;p&gt;SEVERE: java.lang.StringIndexOutOfBoundsException: String index out of range: -14&lt;br/&gt;
        at java.lang.AbstractStringBuilder.replace(AbstractStringBuilder.java:797)&lt;br/&gt;
        at java.lang.StringBuilder.replace(StringBuilder.java:271)&lt;br/&gt;
        at org.apache.solr.handler.component.SpellCheckComponent.toNamedList(SpellCheckComponent.java:248)&lt;br/&gt;
        at org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:143)&lt;br/&gt;
        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:195)&lt;br/&gt;
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)&lt;br/&gt;
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1316)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:338)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:241)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)&lt;br/&gt;
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)&lt;br/&gt;
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)&lt;br/&gt;
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)&lt;br/&gt;
        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:849)&lt;br/&gt;
        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)&lt;br/&gt;
        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:454)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</comment>
                            <comment id="12858474" author="grahamp" created="Mon, 19 Apr 2010 12:39:02 +0000"  >&lt;p&gt;We get the same StringIndexOutOfBoundsException with hyphenated query strings, on production and development - Solr 1.4.0 on CentOS 5.4 x86_64 using 32-bit Java 1.6.0_12&lt;/p&gt;</comment>
                            <comment id="12874765" author="khaledh" created="Wed, 2 Jun 2010 19:55:22 +0000"  >&lt;p&gt;We just hit this bug as well. To reproduce, you must index a document that contains a hyphen (or underscore) and then search with a misspelled version of the indexed text; e.g.&lt;/p&gt;

&lt;p&gt;document contains: mid-term&lt;br/&gt;
query: mis-term&lt;br/&gt;
result: exception thrown&lt;/p&gt;

&lt;p&gt;I looked at the code of where this is happening and it seems to be related to token offsets (of the tokenized query) in conjunction with a feature of the spellcheck component called collation. Basically collation tries to replace the original query with the top suggested words. It relies on the tokenizer to remove the original misspelled words and insert the suggested ones (using StringBuilder.replace). Unfortunately the token offsets look weird for words with hyphens (or underscore); for example:&lt;/p&gt;

&lt;p&gt;query: abc_def&lt;br/&gt;
1st token: value = abc; startOffset = 0; endOffset = 7&lt;br/&gt;
2nd token: value = def; startOffset = 0; endOffset = 7&lt;/p&gt;

&lt;p&gt;Because the two tokens occupy the same range (0-7) this messes up the replacement logic. I&apos;m not sure if this tokenizer behavior is the correct one, but it&apos;s part of the problem.&lt;/p&gt;

&lt;p&gt;Having said that, I tried to change the spellcheck tokenizer from standard to whitespace and this actually solved the problem; no errors and I get correct suggestions.&lt;/p&gt;

&lt;p&gt;So, until this gets fixed you can either:&lt;/p&gt;

&lt;p&gt;1) Disable spellchecker collation, or&lt;br/&gt;
2) Use a whitespace tokenizer for the spellchecker component&lt;/p&gt;</comment>
                            <comment id="12895001" author="rcmuir" created="Tue, 3 Aug 2010 19:39:45 +0000"  >&lt;p&gt;attached is a patch with a testcase for the issue (and maybe a fix/workaround, though it still doesnt seem really right to me and i dont completely understand what this spellcheck collate should do)&lt;/p&gt;

&lt;p&gt;I was able to trigger it easily by using synonymfilter + wdf at querytime, which i know will muck with the offsets.&lt;/p&gt;</comment>
                            <comment id="12900687" author="gsingers" created="Fri, 20 Aug 2010 13:24:27 +0000"  >&lt;p&gt;I&apos;m fine w/ the fix, but it should be noted that we say in &lt;a href=&quot;http://wiki.apache.org/solr/SpellCheckingAnalysis&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/solr/SpellCheckingAnalysis&lt;/a&gt;, which is linked from the &lt;a href=&quot;http://wiki.apache.org/solr/SpellCheckComponent#Spell_Checking_Analysis&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/solr/SpellCheckComponent#Spell_Checking_Analysis&lt;/a&gt; page that the analysis used for spelling should be dead simple, even stemming is not recommended.&lt;/p&gt;</comment>
                            <comment id="12900694" author="gsingers" created="Fri, 20 Aug 2010 14:01:42 +0000"  >&lt;p&gt;Trunk: Committed revision 987509.&lt;/p&gt;

&lt;p&gt;3.x: Committed revision 987511.&lt;/p&gt;</comment>
                            <comment id="12900704" author="rcmuir" created="Fri, 20 Aug 2010 14:24:15 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I&apos;m fine w/ the fix, but it should be noted that we say in &lt;a href=&quot;http://wiki.apache.org/solr/SpellCheckingAnalysis&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/solr/SpellCheckingAnalysis&lt;/a&gt;, which is linked from the &lt;a href=&quot;http://wiki.apache.org/solr/SpellCheckComponent#Spell_Checking_Analysis&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/solr/SpellCheckComponent#Spell_Checking_Analysis&lt;/a&gt; page that the analysis used for spelling should be dead simple, even stemming is not recommended.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks Grant, that was the gist of my concern with the fix. It didn&apos;t seem obvious to me what the &quot;correct&quot; behavior of collation should be with this sort of analysis, but this answers my question. &lt;/p&gt;

&lt;p&gt;At least we have the &quot;defensive&quot; measure in case someone configures it like this, thinks its working for the most part, but then a user enters a hyphen.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12451147" name="SOLR-1630.patch" size="4696" author="rcmuir" created="Tue, 3 Aug 2010 19:39:45 +0000"/>
                            <attachment id="12428157" name="SOLR-1630.patch" size="3920" author="shalin" created="Wed, 16 Dec 2009 11:05:54 +0000"/>
                            <attachment id="12427198" name="bug.xml" size="140" author="robin.wojciki@gmail.com" created="Mon, 7 Dec 2009 16:39:35 +0000"/>
                            <attachment id="12427199" name="schema.xml" size="4081" author="robin.wojciki@gmail.com" created="Mon, 7 Dec 2009 16:39:35 +0000"/>
                            <attachment id="12427200" name="solrconfig.xml" size="13279" author="robin.wojciki@gmail.com" created="Mon, 7 Dec 2009 16:39:35 +0000"/>
                            <attachment id="12428160" name="spellcheckconfig.xml" size="3252" author="glebourg" created="Wed, 16 Dec 2009 11:35:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6042</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03pkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19577</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>