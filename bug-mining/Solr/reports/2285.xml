<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:01:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6640] Replication can cause index corruption.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6640</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Test failure found on jenkins:&lt;br/&gt;
&lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Linux/11333/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Linux/11333/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1 tests failed.
REGRESSION:  org.apache.solr.cloud.ChaosMonkeySafeLeaderTest.testDistribSearch

Error Message:
shard2 is not consistent.  Got 62 from http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:57436/collection1lastClient and got 24 from http://127.0.0.1:53065/collection1
&lt;/span&gt;
Stack Trace:
java.lang.AssertionError: shard2 is not consistent.  Got 62 from http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:57436/collection1lastClient and got 24 from http://127.0.0.1:53065/collection1
&lt;/span&gt;        at __randomizedtesting.SeedInfo.seed([F4B371D421E391CD:7555FFCC56BCF1F1]:0)
        at org.junit.Assert.fail(Assert.java:93)
        at org.apache.solr.cloud.AbstractFullDistribZkTestBase.checkShardConsistency(AbstractFullDistribZkTestBase.java:1255)
        at org.apache.solr.cloud.AbstractFullDistribZkTestBase.checkShardConsistency(AbstractFullDistribZkTestBase.java:1234)
        at org.apache.solr.cloud.ChaosMonkeySafeLeaderTest.doTest(ChaosMonkeySafeLeaderTest.java:162)
        at org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:869)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cause of inconsistency is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: org.apache.lucene.index.CorruptIndexException: file mismatch, expected segment id=yhq3vokoe1den2av9jbd3yp8, got=yhq3vokoe1den2av9jbd3yp7 (resource=BufferedChecksumIndexInput(MMapIndexInput(path=&lt;span class=&quot;code-quote&quot;&gt;&quot;/mnt/ssd/jenkins/workspace/Lucene-Solr-5.x-Linux/solr/build/solr-core/test/J0/temp/solr.cloud.ChaosMonkeySafeLeaderTest-F4B371D421E391CD-001/tempDir-001/jetty3/index/_1_2.liv&quot;&lt;/span&gt;)))
   [junit4]   2&amp;gt; 		at org.apache.lucene.codecs.CodecUtil.checkSegmentHeader(CodecUtil.java:259)
   [junit4]   2&amp;gt; 		at org.apache.lucene.codecs.lucene50.Lucene50LiveDocsFormat.readLiveDocs(Lucene50LiveDocsFormat.java:88)
   [junit4]   2&amp;gt; 		at org.apache.lucene.codecs.asserting.AssertingLiveDocsFormat.readLiveDocs(AssertingLiveDocsFormat.java:64)
   [junit4]   2&amp;gt; 		at org.apache.lucene.index.SegmentReader.&amp;lt;init&amp;gt;(SegmentReader.java:102)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12749620">SOLR-6640</key>
            <summary>Replication can cause index corruption.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Oct 2014 21:06:46 +0000</created>
                <updated>Wed, 2 Oct 2019 17:24:30 +0000</updated>
                            <resolved>Mon, 9 Feb 2015 18:49:35 +0000</resolved>
                                    <version>5.0</version>
                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>replication (java)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14179101" author="shalinmangar" created="Tue, 21 Oct 2014 21:07:20 +0000"  >&lt;p&gt;The test logs from jenkins are attached.&lt;/p&gt;</comment>
                            <comment id="14179322" author="rcmuir" created="Tue, 21 Oct 2014 23:38:28 +0000"  >&lt;p&gt;This exception translates to: &quot;this file _1_2.liv is mismatched and does not belong to this segment _1, instead it belongs to another segment (likely _0)&quot;&lt;/p&gt;

&lt;p&gt;You can see via the suppressed checksum exception from the full stacktrace that the contents are themselves consistent and not corrupt (checksum passes), its just mismatched.&lt;/p&gt;
</comment>
                            <comment id="14186676" author="shalinmangar" created="Tue, 28 Oct 2014 10:25:02 +0000"  >&lt;p&gt;Thanks Robert. In order to make sure that we are actually downloading files belonging to the correct segment, we need access to the segment version but it doesn&apos;t seem like there&apos;s an easy way to read them? Can the segment ids be exposed in the IndexCommit object? Also, can we provide a custom segment id instead of having Lucene generate them? As it stands today, we have no way of controlling the segment ids generated by replicas and therefore I&apos;m afraid that replica recovery might end up downloading the complete index.&lt;/p&gt;</comment>
                            <comment id="14186746" author="rcmuir" created="Tue, 28 Oct 2014 12:15:01 +0000"  >&lt;blockquote&gt;
&lt;p&gt; In order to make sure that we are actually downloading files belonging to the correct segment, we need access to the segment version but it doesn&apos;t seem like there&apos;s an easy way to read them? Can the segment ids be exposed in the IndexCommit object?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;SegmentInfos infos = SegmentInfos.readCommit(directory, commit.getSegmentsFileName());&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Also, can we provide a custom segment id instead of having Lucene generate them?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No: this is an internal safety mechanism from lucene. Its detecting that solr replicates the wrong file (again: in this case, the wrong deletes generation). Apparently, we cannot entrust apps to not mismatch up our index files.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;As it stands today, we have no way of controlling the segment ids generated by replicas and therefore I&apos;m afraid that replica recovery might end up downloading the complete index.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Maybe instead of worrying about optimizing this, its best to start with &quot;not corrupting the index&quot;.&lt;/p&gt;</comment>
                            <comment id="14232641" author="varunthacker" created="Wed, 3 Dec 2014 06:08:50 +0000"  >&lt;p&gt;This is interesting - When I was running the test a few weeks back it was reproducible all the time on my local machine . I ran it a few times against branch_5x right now and it passed every time. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant test  -Dtestcase=ChaosMonkeySafeLeaderTest -Dtests.method=testDistribSearch -Dtests.seed=F4B371D421E391CD -Dtests.multiplier=3 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=pt_BR -Dtests.timezone=Africa/Douala -Dtests.file.encoding=US-ASCII
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am digging more into what changed. Anyways I will upload a patch I have on my machine which uses the lucene segment-ids to verify what files need to be downloaded.&lt;/p&gt;</comment>
                            <comment id="14238193" author="varunthacker" created="Mon, 8 Dec 2014 18:20:41 +0000"  >&lt;p&gt;Rough patch.&lt;/p&gt;

&lt;p&gt;compareFile() checks if the file is present and also if the length and checksum for each file matches . Used instead of slowFileExists.&lt;/p&gt;

&lt;p&gt;Small refactoring -&lt;br/&gt;
Removed createTempindexDir&lt;br/&gt;
moveAFile() never utilized  List&amp;lt;String&amp;gt; copiedfiles. So I removed it.&lt;br/&gt;
Modified the DirectoryFileFetcher ctor to take only the necessary params&lt;br/&gt;
In DirectoryFileFetcher saveAs was always the fileName. So I removed it.&lt;/p&gt;

&lt;p&gt;We need to see if we need to download all files in a segment when they are out of sync as opposed to just downloading the missing files as we do currently.&lt;/p&gt;</comment>
                            <comment id="14239783" author="markrmiller@gmail.com" created="Tue, 9 Dec 2014 18:19:04 +0000"  >&lt;p&gt;Cool - this is a very important issue to solve.&lt;/p&gt;</comment>
                            <comment id="14248456" author="varunthacker" created="Tue, 16 Dec 2014 16:32:48 +0000"  >&lt;p&gt;This test passes with the patch - &lt;tt&gt;ant test  -Dtestcase=ChaosMonkeySafeLeaderTest -Dtests.method=testDistribSearch -Dtests.seed=EDA082CD42EB33E3 -Dtests.slow=true -Dtests.locale=hi_IN -Dtests.timezone=Asia/KuchingDtests.asserts=true -Dtests.file.encoding=ISO-8859-1&lt;/tt&gt; &lt;/p&gt;

&lt;p&gt;The patch does something very simple - Before we begin to download segment files, check against the current commit point which files are extra and remove them.&lt;/p&gt;

&lt;p&gt;For example -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-001/jetty3/index.20141216162501726
   [junit4]   2&amp;gt; 22194 T113 C7 P59775 oash.SnapPuller.fetchLatestIndex SOLR-6640:: indexDir.listAll() pre remove _0.cfe _0.cfs _0.si _0_1.liv _1.fdt _1.fdx segments_1 
   [junit4]   2&amp;gt; 22195 T79 C6 P59766 oasup.LogUpdateProcessor.finish [collection1] webapp=/_ path=/update params={wt=javabin&amp;amp;version=2} {add=[0-19 (1487664160941539328)]} 0 1
   [junit4]   2&amp;gt; 22196 T113 C7 P59775 oash.SnapPuller.fetchLatestIndex SOLR-6640:: indexDir.listAll() post remove segments_1 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it&apos;s these files which are not getting removed when we do IW.rollback that were causing the problem - &lt;br/&gt;
&lt;tt&gt;_0.cfe _0.cfs _0.si _0_1.liv _1.fdt _1.fdx&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I am yet to figure out whether these files should have been removed by IW.rollback() or not? &lt;/p&gt;</comment>
                            <comment id="14249708" author="shalinmangar" created="Wed, 17 Dec 2014 10:56:04 +0000"  >&lt;p&gt;I am looking at this failure too and I see another bug. I was wondering why the replica had these writes in the first place considering that recovery on startup had not completed.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;RecoveryStrategy publishes the state of the replica as &apos;recovering&apos; before it sets the update log to buffering mode which is why the leader sends updates to this replica that affect the index.&lt;/li&gt;
	&lt;li&gt;The test itself doesn&apos;t wait for a steady state e.g. by calling waitForRecovery or waitForThingsToLevelOut before starting the indexing threads. This is probably a good thing because that&apos;s what has helped us find this problem.&lt;/li&gt;
	&lt;li&gt;Shouldn&apos;t the peersync also be done while update log is set to buffering mode?&lt;/li&gt;
&lt;/ol&gt;


&lt;blockquote&gt;
&lt;p&gt;So it&apos;s these files which are not getting removed when we do IW.rollback that were causing the problem - &lt;br/&gt;
_0.cfe _0.cfs _0.si _0_1.liv _1.fdt _1.fdx&lt;br/&gt;
I am yet to figure out whether these files should have been removed by IW.rollback() or not?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;These files hang around because an IndexReader is open using the IndexWriter due to soft commit(s).&lt;/p&gt;</comment>
                            <comment id="14249771" author="shalinmangar" created="Wed, 17 Dec 2014 12:07:13 +0000"  >&lt;p&gt;So what is the right way to implement partial replication in this case? Force deleting the file (Varun&apos;s patch) probably won&apos;t work on windows and/or not play well with the open searchers. In SolrCloud we could just close the searcher before rollback because a replica in recovery won&apos;t get any search requests but that&apos;s not practical in standalone Solr because it&apos;d cause downtime.&lt;/p&gt;</comment>
                            <comment id="14260134" author="shalinmangar" created="Mon, 29 Dec 2014 14:41:17 +0000"  >&lt;p&gt;I had a discussion with Varun about this issue. We have two problems here&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Solr corrupts the index during replication recovery&lt;/li&gt;
	&lt;li&gt;Such a corrupt index puts Solr into an infinite recovery loop&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For #1 the problem is clear &amp;#8211; we have open searchers on uncommitted/flushed files which are mixed with files from the leader causing corruption.&lt;/p&gt;

&lt;p&gt;Possible solutions for #1 are either a) switch to a different index dir and move/copy files from committed segments and use the index.properties approach to open a searcher on the new index dir or b) close the searcher then rollback the writer and then download the necessary files.&lt;/p&gt;

&lt;p&gt;Closing the searcher.... is not as simple as it sounds because the searcher is ref counted and close() doesn&apos;t really close immediately. Also, at any time, a request might open a new searcher so it is a very involved change.&lt;/p&gt;

&lt;p&gt;For #2, every where we open a reader/searcher or writer, we should be ready to handle the corrupt index exceptions.&lt;/p&gt;

&lt;p&gt;I think we should first try to first solve the problem of corrupting the index. So let&apos;s try the deletion approach that Varun outlined. If that fails then we should switch to a new index dir, move/copy over files from commit points, fetch the missing segments from the leader and use the index.properties approach to completely move to a new index directory.&lt;/p&gt;

&lt;p&gt;The second problem that we need to solve is that a corrupted index trashes the server. We should be able to recover from such a scenario instead of going into an infinite recovery loop.&lt;/p&gt;

&lt;p&gt;Let&apos;s fix these two problems (in that order) and then figure out ways to optimize recovery.&lt;/p&gt;

&lt;p&gt;Longer term we need to change our code such that we can close the searchers, rollback the writer and delete uncommitted files and then attempt replication recovery.&lt;/p&gt;

&lt;p&gt;Also my earlier comment on non-cloud Solr was wrong:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;In SolrCloud we could just close the searcher before rollback because a replica in recovery won&apos;t get any search requests but that&apos;s not practical in standalone Solr because it&apos;d cause downtime.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In stand alone Solr this is not a problem because indexing and soft-commits do not happen on slaves. But anyway changing to close the searcher etc is a big change.&lt;/p&gt;</comment>
                            <comment id="14261293" author="varunthacker" created="Tue, 30 Dec 2014 17:44:16 +0000"  >&lt;p&gt;This patch uses the following approach - Download all missing files from leader into the tempIndexDir and then copy over the remaining files from the current index directory into the tempIndexDir. Now use the index.properties method to switch to the new index. &lt;/p&gt;

&lt;p&gt;Main changes are in moveIndexFiles() method.&lt;/p&gt;

&lt;p&gt;Still very rough and needs refactoring, but wanted to share this approach and get some thoughts on it.&lt;/p&gt;</comment>
                            <comment id="14264971" author="shalinmangar" created="Mon, 5 Jan 2015 19:35:28 +0000"  >&lt;p&gt;Here&apos;s a better patch which:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Re-opens IW after rolling back the previous one&lt;/li&gt;
	&lt;li&gt;Re-opens the searcher using the new IW (we can&apos;t re-open the old one because it was created using the previous IW which will be closed on rollback)&lt;/li&gt;
	&lt;li&gt;Calls IW.deleteUnusedFiles repeatedly with a 1 second sleep until all unused files have been cleaned up. This may take some time because the old searcher or a virus scanner may be using these files.&lt;/li&gt;
	&lt;li&gt;If we could not clean up files within 30 seconds then we fall back to a full replication&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14266716" author="markrmiller@gmail.com" created="Tue, 6 Jan 2015 20:38:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;a searcher might be using some flushed but committed segments&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;shouldn&apos;t that be &apos;not committed&apos;?&lt;/p&gt;</comment>
                            <comment id="14266814" author="shalinmangar" created="Tue, 6 Jan 2015 21:32:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;shouldn&apos;t that be &apos;not committed&apos;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Umm yeah but who are you quoting? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14266870" author="markrmiller@gmail.com" created="Tue, 6 Jan 2015 22:16:01 +0000"  >&lt;p&gt;I&apos;m quoting from the patch that was attached yesterday.&lt;/p&gt;</comment>
                            <comment id="14266906" author="shalinmangar" created="Tue, 6 Jan 2015 22:48:45 +0000"  >&lt;p&gt;Ah, okay, yes you&apos;re right. I&apos;ll fix that comment.&lt;/p&gt;</comment>
                            <comment id="14267403" author="varunthacker" created="Wed, 7 Jan 2015 08:29:21 +0000"  >&lt;p&gt;Shouldn&apos;t the logic be a try-finally block instead of try-with-resource ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            IndexWriter indexWriter = writer.get();
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; c = 0;
            indexWriter.deleteUnusedFiles();
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (hasUnusedFiles(indexDir, commit)) {
              indexWriter.deleteUnusedFiles();
              LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Sleeping &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 1000ms to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; unused lucene index files to be delete-able&quot;&lt;/span&gt;);
              &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
              c++;
              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (c &amp;gt;= 30)  {
                LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;SnapPuller unable to cleanup unused lucene index files so we must &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; a full copy instead&quot;&lt;/span&gt;);
                isFullCopyNeeded = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
              }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (c &amp;gt; 0)  {
              LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;SnapPuller slept &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; + (c * 1000) + &lt;span class=&quot;code-quote&quot;&gt;&quot;ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; unused lucene index files to be delete-able&quot;&lt;/span&gt;);
            }
          } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (writer != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
              writer.decref();
            }
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14272617" author="markrmiller@gmail.com" created="Sat, 10 Jan 2015 17:35:09 +0000"  >&lt;p&gt;Something similar to this corrupted index issue also causes this test to timeout sometimes because a sever will never recover. It keeps trying, but keeps ending up with a corrupted index problem and eventually the test framework hard kills it.&lt;/p&gt;</comment>
                            <comment id="14274233" author="markrmiller@gmail.com" created="Mon, 12 Jan 2015 21:54:16 +0000"  >&lt;p&gt;Can we get this in? I&apos;d love to see it&apos;s affect on some common test fails over some time before 5.0 hits and see that nothing else pops out.&lt;/p&gt;</comment>
                            <comment id="14274380" author="anshumg" created="Mon, 12 Jan 2015 23:15:13 +0000"  >&lt;p&gt;Changing this to a Blocker for 5.0 as I think it needs to go in for 5.0.&lt;/p&gt;</comment>
                            <comment id="14283706" author="shalinmangar" created="Tue, 20 Jan 2015 11:07:20 +0000"  >&lt;p&gt;Here&apos;s a new test called RecoveryAfterSoftCommitTest which reproduces these failures.&lt;/p&gt;

&lt;p&gt;My last fix isn&apos;t quite right; it leaks recovery threads and increases the recovery time by a lot. I am trying to figure out a better way.&lt;/p&gt;</comment>
                            <comment id="14283938" author="shalinmangar" created="Tue, 20 Jan 2015 15:36:43 +0000"  >&lt;p&gt;Thanks Varun for catching my mistake. The try-with-resource was wrong and I should have used try/finally to decref the writer. This patch does that.&lt;/p&gt;

&lt;p&gt;This patch closes the searcher itself in cloud mode and did away with re-opening the searcher. All tests pass. I&apos;ll commit this shortly and bake it on jenkins for a while.&lt;/p&gt;</comment>
                            <comment id="14283967" author="jira-bot" created="Tue, 20 Jan 2015 16:19:40 +0000"  >&lt;p&gt;Commit 1653281 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1653281&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1653281&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Close searchers before rollback and recovery to avoid index corruption&lt;/p&gt;</comment>
                            <comment id="14283972" author="jira-bot" created="Tue, 20 Jan 2015 16:22:51 +0000"  >&lt;p&gt;Commit 1653283 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1653283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1653283&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: No need for SSL in this test&lt;/p&gt;</comment>
                            <comment id="14287376" author="jira-bot" created="Thu, 22 Jan 2015 12:59:34 +0000"  >&lt;p&gt;Commit 1653837 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1653837&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1653837&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Add changelog entry&lt;/p&gt;</comment>
                            <comment id="14287377" author="jira-bot" created="Thu, 22 Jan 2015 13:00:19 +0000"  >&lt;p&gt;Commit 1653838 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1653838&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1653838&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Close searchers before rollback and recovery to avoid index corruption&lt;/p&gt;</comment>
                            <comment id="14287380" author="jira-bot" created="Thu, 22 Jan 2015 13:02:03 +0000"  >&lt;p&gt;Commit 1653839 from shalin@apache.org in branch &apos;dev/branches/lucene_solr_5_0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1653839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1653839&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Close searchers before rollback and recovery to avoid index corruption&lt;/p&gt;</comment>
                            <comment id="14287393" author="jira-bot" created="Thu, 22 Jan 2015 13:12:47 +0000"  >&lt;p&gt;Commit 1653844 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1653844&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1653844&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Exclude lock files from unused file check&lt;/p&gt;</comment>
                            <comment id="14287395" author="jira-bot" created="Thu, 22 Jan 2015 13:13:37 +0000"  >&lt;p&gt;Commit 1653845 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1653845&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1653845&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Exclude lock files from unused file check&lt;/p&gt;</comment>
                            <comment id="14287397" author="jira-bot" created="Thu, 22 Jan 2015 13:14:18 +0000"  >&lt;p&gt;Commit 1653846 from shalin@apache.org in branch &apos;dev/branches/lucene_solr_5_0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1653846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1653846&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Exclude lock files from unused file check&lt;/p&gt;</comment>
                            <comment id="14291244" author="markrmiller@gmail.com" created="Sun, 25 Jan 2015 20:04:06 +0000"  >&lt;p&gt;The Chaos Monkey tests are already in much better shape - I run a variety of them in normal and nightly mode on my local jenkins machine, and the 3 day performance is great.&lt;/p&gt;

&lt;p&gt;There are a couple things to look into with ChaosMonkeyNothingIsSafeTest, but that appears unrelated to this change.&lt;/p&gt;</comment>
                            <comment id="14291248" author="markrmiller@gmail.com" created="Sun, 25 Jan 2015 20:11:48 +0000"  >&lt;p&gt;Spoke too soon - one of the jobs did hit a corrupt index yesterday. I&apos;ll post the logs.&lt;/p&gt;</comment>
                            <comment id="14291993" author="varunthacker" created="Mon, 26 Jan 2015 16:04:30 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I was unable to reproduce it just by running this on branch_5x - &lt;tt&gt;ant test  -Dtestcase=ChaosMonkeySafeLeaderTest -Dtests.seed=22E5E46764398970&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Also I don&apos;t see this line which generally comes with the the fail - &quot;NOTE: reproduce with: ant test....&quot;&lt;/p&gt;

&lt;p&gt;Are you able to reproduce it? If yes then can you tell me how? I&apos;d also like to test it out and see why it got corrupted.&lt;/p&gt;</comment>
                            <comment id="14293425" author="shalinmangar" created="Tue, 27 Jan 2015 12:20:49 +0000"  >&lt;p&gt;Thanks Mark. I am trying to figure out the failure and create a smaller reproducible test case.&lt;/p&gt;</comment>
                            <comment id="14294934" author="jira-bot" created="Wed, 28 Jan 2015 09:41:50 +0000"  >&lt;p&gt;Commit 1655249 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1655249&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1655249&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Fixing the comment&lt;/p&gt;</comment>
                            <comment id="14294936" author="jira-bot" created="Wed, 28 Jan 2015 09:43:12 +0000"  >&lt;p&gt;Commit 1655250 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1655250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1655250&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Fixing the comment (merge from trunk)&lt;/p&gt;</comment>
                            <comment id="14294937" author="jira-bot" created="Wed, 28 Jan 2015 09:45:09 +0000"  >&lt;p&gt;Commit 1655251 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1655251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1655251&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Fixing the comment (merge from branch_5x)&lt;/p&gt;</comment>
                            <comment id="14298195" author="markrmiller@gmail.com" created="Fri, 30 Jan 2015 04:44:47 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;, shouldn&apos;t&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Collection&amp;lt;String&amp;gt; files = info.info.files(); // All files that belong to this segment&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;be&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Collection&amp;lt;String&amp;gt; files = info.files(); // All files that belong to this segment&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The former skips some logic in the later - one note in particular in info.files() mentions adding live files, and in tests, I&apos;m seeing this exhibit bad behavior and timeout waiting for .liv files to be deletable.&lt;/p&gt;</comment>
                            <comment id="14301444" author="shalinmangar" created="Mon, 2 Feb 2015 16:49:34 +0000"  >&lt;p&gt;I had been ill last week so I am resuming work on this today. &lt;/p&gt;

&lt;p&gt;I suspect you&apos;re right, Mark. I should use the info.files(). Better yet, we can use SegmentInfos.files(Directory dir, boolean includeSegmentsFile) method and avoid iterating through SegmentCommitInfo objects.&lt;/p&gt;</comment>
                            <comment id="14302857" author="jira-bot" created="Tue, 3 Feb 2015 06:55:03 +0000"  >&lt;p&gt;Commit 1656630 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1656630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1656630&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Use SegmentInfos.files in unused file check&lt;/p&gt;</comment>
                            <comment id="14302858" author="jira-bot" created="Tue, 3 Feb 2015 06:56:11 +0000"  >&lt;p&gt;Commit 1656631 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1656631&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1656631&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Use SegmentInfos.files in unused file check&lt;/p&gt;</comment>
                            <comment id="14305909" author="anshumg" created="Wed, 4 Feb 2015 20:44:54 +0000"  >&lt;p&gt;I spoke to Shalin and he suggested me to wait until Friday to see if all stays good after the last commit. If nothing fails, I&apos;ll continue with the next RC for Solr 5.0.&lt;br/&gt;
By the time we get done with the vote, we&apos;d have given the fix even more time.&lt;/p&gt;</comment>
                            <comment id="14306762" author="jira-bot" created="Thu, 5 Feb 2015 06:57:09 +0000"  >&lt;p&gt;Commit 1657490 from shalin@apache.org in branch &apos;dev/branches/lucene_solr_5_0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1657490&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1657490&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Use SegmentInfos.files in unused file check&lt;/p&gt;</comment>
                            <comment id="14309044" author="shalinmangar" created="Fri, 6 Feb 2015 12:07:08 +0000"  >&lt;p&gt;I have found another failure. This time on HdfsBasicDistributedZk2Test and it is easily reproducible with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant test  -Dtestcase=HdfsBasicDistributedZk2Test -Dtests.method=test -Dtests.seed=A7C02AE49EA55A58 -Dtests.nigly=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=iw_IL -Dtests.timezone=America/St_Vincent -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=UTF-8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;d appreciate some help in tracking down the root cause.&lt;/p&gt;</comment>
                            <comment id="14309328" author="markrmiller@gmail.com" created="Fri, 6 Feb 2015 15:32:35 +0000"  >&lt;p&gt;I&apos;m taking a look.&lt;/p&gt;</comment>
                            <comment id="14309347" author="markrmiller@gmail.com" created="Fri, 6 Feb 2015 15:54:19 +0000"  >&lt;p&gt;Those troublesome .si files...&lt;/p&gt;

&lt;p&gt;We don&apos;t download because we think we already have the right one I believe.&lt;/p&gt;

&lt;p&gt;Varun&apos;s nice issue fixes this: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;: During replication use checksums to verify if files are the same&lt;/p&gt;</comment>
                            <comment id="14309350" author="markrmiller@gmail.com" created="Fri, 6 Feb 2015 15:55:59 +0000"  >&lt;p&gt;Of course that only works if your segments are new enough to have checksum info in that patch.&lt;/p&gt;</comment>
                            <comment id="14309557" author="markrmiller@gmail.com" created="Fri, 6 Feb 2015 18:17:28 +0000"  >&lt;p&gt;I&apos;ve been focusing on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt; with Varun. I think that is the right path to remove the rest of these issues.&lt;/p&gt;</comment>
                            <comment id="14309769" author="varunthacker" created="Fri, 6 Feb 2015 19:58:36 +0000"  >&lt;p&gt;1. Changed the log message in &lt;tt&gt;SnapPuller.compareFile()&lt;/tt&gt; since checksum won&apos;t be present in case of exception.&lt;br/&gt;
From - &lt;tt&gt;LOG.warn(&quot;File {} did not match. expected checksum is {} and actual is checksum {}. &quot; + &quot;expected length is {} and actual length is {}&quot;, filename, backupIndexFileChecksum indexFileChecksum, backupIndexFileLen, indexFileLen);&lt;/tt&gt;&lt;br/&gt;
To - &lt;tt&gt;LOG.warn(&quot;File {} did not match. expected length is {} and actual length is {}&quot;, filename,backupIndexFileLen, indexFileLen);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;2. In &lt;tt&gt;SnapPuller.downloadIndexFiles&lt;/tt&gt; made &lt;tt&gt;(String) file.get(NAME))&lt;/tt&gt; into a variable for better readibility.&lt;/p&gt;

&lt;p&gt;3. The if condition still needs tweaking? We could still have a non checksummed/checksum threw error .si/.liv/segments_n file of equal length and we wouldn&apos;t re-download?&lt;/p&gt;

&lt;p&gt;Maybe the condition could be the check you initially proposed -&lt;br/&gt;
1. If file is a .si/.liv/segments_n file download regardless&lt;br/&gt;
2. else if  if (!compareResult.equal || downloadCompleteIndex) then re-download?&lt;/p&gt;</comment>
                            <comment id="14309772" author="varunthacker" created="Fri, 6 Feb 2015 19:59:32 +0000"  >&lt;p&gt;Sorry this was supposed to go in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;. I&apos;ll repost it there.&lt;/p&gt;</comment>
                            <comment id="14309982" author="jira-bot" created="Fri, 6 Feb 2015 21:44:04 +0000"  >&lt;p&gt;Commit 1657969 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1657969&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1657969&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: A replicated index can end up corrupted when small files end up with the same file name and size.&lt;/p&gt;</comment>
                            <comment id="14310808" author="markrmiller@gmail.com" created="Sat, 7 Feb 2015 16:39:05 +0000"  >&lt;p&gt;Since committing that to trunk, my trunk runs are looking pretty good and I still see some nasty fails on 5x. So far, so good.&lt;/p&gt;</comment>
                            <comment id="14310819" author="jira-bot" created="Sat, 7 Feb 2015 17:05:16 +0000"  >&lt;p&gt;Commit 1658078 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658078&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658078&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: When we so not have a checksum for a file, always download files under 100kb and other small improvements.&lt;/p&gt;</comment>
                            <comment id="14310837" author="jira-bot" created="Sat, 7 Feb 2015 17:38:02 +0000"  >&lt;p&gt;Commit 1658083 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658083&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: A replicated index can end up corrupted when small files end up with the same file name and size.&lt;/p&gt;</comment>
                            <comment id="14310840" author="markrmiller@gmail.com" created="Sat, 7 Feb 2015 17:46:08 +0000"  >&lt;p&gt;Anyone that can help with review of these commits, please do.&lt;/p&gt;</comment>
                            <comment id="14310846" author="markrmiller@gmail.com" created="Sat, 7 Feb 2015 17:58:14 +0000"  >&lt;p&gt;We should not log an error when the compare method does not see the file locally - that is an expected path.&lt;/p&gt;</comment>
                            <comment id="14310855" author="jira-bot" created="Sat, 7 Feb 2015 18:17:20 +0000"  >&lt;p&gt;Commit 1658089 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658089&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Do not log an error when a file does not exist for comparison.&lt;/p&gt;</comment>
                            <comment id="14310858" author="jira-bot" created="Sat, 7 Feb 2015 18:22:25 +0000"  >&lt;p&gt;Commit 1658090 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658090&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658090&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Do not log an error when a file does not exist for comparison.&lt;/p&gt;</comment>
                            <comment id="14310917" author="gchanan" created="Sat, 7 Feb 2015 20:30:27 +0000"  >&lt;p&gt;Did a quick pass, looks good.&lt;/p&gt;

&lt;p&gt;One suggestion I would make is renaming the function filesToAlwaysDownloadIfChecksumFails.  Checksum fails sounds like the checksum didn&apos;t match up in which case I&apos;d hope we&apos;d download every file, not that the checksum wasn&apos;t present.  Maybe filesToAlwaysDownloadIfNoChecksums? filesToAlwaysDownloadIfNoChecksumsPresent?&lt;/p&gt;</comment>
                            <comment id="14311034" author="markrmiller@gmail.com" created="Sun, 8 Feb 2015 00:15:03 +0000"  >&lt;p&gt;Thanks Greg, I&apos;ll incorporate - wasn&apos;t very happy with the name myself.&lt;/p&gt;

&lt;p&gt;I don&apos;t know that it&apos;s critical for this blocker issue, but another change we should probably make is: if the replication into an existing index fails, don&apos;t keep trying that - move to replicating to a new index folder.&lt;/p&gt;</comment>
                            <comment id="14311091" author="markrmiller@gmail.com" created="Sun, 8 Feb 2015 03:46:57 +0000"  >&lt;p&gt;I&apos;ve had my local jenkins machine push it&apos;s 10 chaos monkey tests on this all day. So far so good in terms of index corruption. I&apos;ll add in the rename mentioned above and let jenkins crank overnight - let&apos;s look at moving to 5.0 in the morning when we have some more confidence.&lt;/p&gt;</comment>
                            <comment id="14311099" author="jira-bot" created="Sun, 8 Feb 2015 03:58:47 +0000"  >&lt;p&gt;Commit 1658129 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658129&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Rename method to filesToAlwaysDownloadIfNoChecksums.&lt;/p&gt;</comment>
                            <comment id="14311102" author="jira-bot" created="Sun, 8 Feb 2015 04:03:53 +0000"  >&lt;p&gt;Commit 1658130 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658130&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658130&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Rename method to filesToAlwaysDownloadIfNoChecksums.&lt;/p&gt;</comment>
                            <comment id="14311134" author="shalinmangar" created="Sun, 8 Feb 2015 06:13:41 +0000"  >&lt;p&gt;Thanks Mark. This has helped a lot. I wrote a test which would hit corruption at least once in 10 iterations before &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt; but I can&apos;t get it to fail anymore.&lt;/p&gt;</comment>
                            <comment id="14311358" author="markrmiller@gmail.com" created="Sun, 8 Feb 2015 15:10:39 +0000"  >&lt;p&gt;Thanks shalin - my chaosmonkey jobs went well overnight too.&lt;/p&gt;

&lt;p&gt;I&apos;ll look at the merge into 5.0 shortly.&lt;/p&gt;

&lt;p&gt;More review wouldn&apos;t hurt if anyone has time.&lt;/p&gt;</comment>
                            <comment id="14311492" author="jira-bot" created="Sun, 8 Feb 2015 18:54:32 +0000"  >&lt;p&gt;Commit 1658240 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658240&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: A replicated index can end up corrupted when small files end up with the same file name and size.&lt;/p&gt;</comment>
                            <comment id="14311548" author="anshumg" created="Sun, 8 Feb 2015 20:33:25 +0000"  >&lt;p&gt;Thanks for wrapping this one up Mark. Looks good! &lt;/p&gt;

&lt;p&gt;I think it&apos;d be good to declare a final int MIN_FILE_SIZE or something to use in filesToAlwaysDownloadIfNoChecksums. Also, the comment says files &amp;lt; 100kb would be copied but the check seems to be for 100,000 bytes or about 97kb? It&apos;s ok but I think but we should either change the comment or the number (nothing pressing).&lt;/p&gt;

&lt;p&gt;Also, I think the concat of 2 strings while logging was an IDE issue&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;SnapPuller.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;LOG.warn(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;File {} did not match. &quot;&lt;/span&gt;  + &lt;span class=&quot;code-quote&quot;&gt;&quot;expected length is {} and actual length is {}&quot;&lt;/span&gt;,
                filename, backupIndexFileChecksum, indexFileChecksum,
            
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14311555" author="markrmiller@gmail.com" created="Sun, 8 Feb 2015 20:55:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;&amp;lt; 100kb would be copied but the check seems to be for 100,000 bytes or about 97kb? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I went with Google&apos;s conversion using digital storage: 100000 bytes to kb = 100 kilobytes&lt;/p&gt;</comment>
                            <comment id="14311557" author="anshumg" created="Sun, 8 Feb 2015 21:20:58 +0000"  >&lt;p&gt;I think we use the standard 1024 conversion factor everywhere but I think it&apos;s ok and probably not worth debating about.&lt;/p&gt;</comment>
                            <comment id="14311600" author="markrmiller@gmail.com" created="Sun, 8 Feb 2015 22:40:19 +0000"  >&lt;p&gt;Yeah, I&apos;m not really arguing one way or another - I think that debate has been had &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Eithet way - I simply went with Google is all. &lt;/p&gt;</comment>
                            <comment id="14311611" author="anshumg" created="Sun, 8 Feb 2015 23:04:43 +0000"  >&lt;p&gt;With you on that anyways. I think this issue is now handled and I can cut an RC later in the day today/tomorrow morning. What do you think?&lt;/p&gt;</comment>
                            <comment id="14311626" author="markrmiller@gmail.com" created="Sun, 8 Feb 2015 23:49:05 +0000"  >&lt;p&gt;Yeah, I think we are prob good. I&apos;ll make the improvement suggested on trunk and 5x. &lt;/p&gt;</comment>
                            <comment id="14312607" author="jira-bot" created="Mon, 9 Feb 2015 18:44:43 +0000"  >&lt;p&gt;Commit 1658519 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658519&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658519&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Make constant and fix logging.&lt;/p&gt;</comment>
                            <comment id="14312614" author="markrmiller@gmail.com" created="Mon, 9 Feb 2015 18:49:35 +0000"  >&lt;p&gt;Thanks to all involved in this. Long time, bad time issue.&lt;/p&gt;</comment>
                            <comment id="14312617" author="jira-bot" created="Mon, 9 Feb 2015 18:50:58 +0000"  >&lt;p&gt;Commit 1658524 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658524&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658524&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Make constant and fix logging.&lt;/p&gt;</comment>
                            <comment id="14312635" author="jira-bot" created="Mon, 9 Feb 2015 18:58:39 +0000"  >&lt;p&gt;Commit 1658526 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1658526&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1658526&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6920&quot; title=&quot;During replication use checksums to verify if files are the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6920&quot;&gt;&lt;del&gt;SOLR-6920&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6640&quot; title=&quot;Replication can cause index corruption.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6640&quot;&gt;&lt;del&gt;SOLR-6640&lt;/del&gt;&lt;/a&gt;: Make constant and fix logging.&lt;/p&gt;</comment>
                            <comment id="14332804" author="anshumg" created="Mon, 23 Feb 2015 05:01:59 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12766499">SOLR-6942</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12773542">SOLR-7093</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12776611">SOLR-7134</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12765310">SOLR-6920</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12676178" name="Lucene-Solr-5.x-Linux-64bit-jdk1.8.0_20-Build-11333.txt" size="910303" author="shalin" created="Tue, 21 Oct 2014 21:07:20 +0000"/>
                            <attachment id="12693283" name="SOLR-6640-test.patch" size="4025" author="shalin" created="Tue, 20 Jan 2015 11:07:20 +0000"/>
                            <attachment id="12693312" name="SOLR-6640.patch" size="8378" author="shalin" created="Tue, 20 Jan 2015 15:36:43 +0000"/>
                            <attachment id="12690126" name="SOLR-6640.patch" size="4578" author="shalin" created="Mon, 5 Jan 2015 19:35:28 +0000"/>
                            <attachment id="12687514" name="SOLR-6640.patch" size="3314" author="varun" created="Tue, 16 Dec 2014 16:32:48 +0000"/>
                            <attachment id="12685801" name="SOLR-6640.patch" size="37113" author="varun" created="Mon, 8 Dec 2014 18:20:41 +0000"/>
                            <attachment id="12689536" name="SOLR-6640_new_index_dir.patch" size="11934" author="varun" created="Tue, 30 Dec 2014 17:44:16 +0000"/>
                            <attachment id="12697107" name="SOLR-6920.patch" size="16755" author="varun" created="Fri, 6 Feb 2015 19:58:36 +0000"/>
                            <attachment id="12694442" name="corruptindex.log" size="4687104" author="markrmiller@gmail.com" created="Sun, 25 Jan 2015 20:13:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21f6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>