<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:56:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4406] RawResponseWriter - doesn&apos;t use the configured &quot;base&quot; writer.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4406</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The RawResponseWriter accepts a configuration value for a &quot;base&quot; ResponseWriter if no ContentStream can be detected. The line of code is commented out that would allow this secondary response writer to work. It would be great to uncomment the line and provide an OutputStreamWriter as the writer argument.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12630985">SOLR-4406</key>
            <summary>RawResponseWriter - doesn&apos;t use the configured &quot;base&quot; writer.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="sdavids">Steve Davids</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Feb 2013 01:58:42 +0000</created>
                <updated>Mon, 9 May 2016 18:54:34 +0000</updated>
                            <resolved>Wed, 3 Sep 2014 19:33:11 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Response Writers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14101785" author="sdavids" created="Tue, 19 Aug 2014 03:24:06 +0000"  >&lt;p&gt;Attached a patch which allows the RawResponseWriter to honor it&apos;s contract:&lt;/p&gt;

&lt;p&gt;-&lt;del&gt;snip&lt;/del&gt;-&lt;br/&gt;
..if no such ContentStream has been added, then a &quot;base&quot; QueryResponseWriter will be used to write the response according to the usual contract...&lt;br/&gt;
-&lt;del&gt;snip&lt;/del&gt;-&lt;/p&gt;

&lt;p&gt;Performed some minor refactoring to provide a single method to write query responses to an output stream.&lt;/p&gt;</comment>
                            <comment id="14101790" author="sdavids" created="Tue, 19 Aug 2014 03:28:16 +0000"  >&lt;p&gt;Oops, didn&apos;t add the new utility class to SVN - patch updated.&lt;/p&gt;</comment>
                            <comment id="14101852" author="hossman" created="Tue, 19 Aug 2014 04:59:12 +0000"  >&lt;p&gt;Interesting ... looks like this bit of the contract was broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2263&quot; title=&quot;RawResponseWriter should properly stream binary as well as textual files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2263&quot;&gt;&lt;del&gt;SOLR-2263&lt;/del&gt;&lt;/a&gt; &amp;#8211; i&apos;m guessing it didn&apos;t occur to folks at the time that making the RawResponeWriter implement BinaryQueryResponseWriter would essentially cause the Writer based method to be effectively dead code (and since they couldn&apos;t assume the &quot;base&quot; writer would support BinaryResponseWriter, throwing an exception probably seemed appropriate)&lt;/p&gt;

&lt;p&gt;Steve: at first glance, your patch looks fine and straight forward to me ... but i&apos;m hesitant to commit it w/o some tests to verify it works and help ensure we don&apos;t break this again in the future.  I don&apos;t suppose you&apos;d be interested in writing some unit tests to help excercise this feature with both code-paths of base writers (bin and non-bin?)&lt;/p&gt;

&lt;p&gt;something along the lines of...&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;2 mock writers, one extending BinaryQueryResponseWriter, both throwing UnSupOp for the method that shouldn&apos;t be used&lt;/li&gt;
	&lt;li&gt;3 instances of RawResponseWriter, one each with the base and one w/o any base&lt;/li&gt;
	&lt;li&gt;2 mock QueryResponses, one with a CONTENT stream of a spcial Content-Type and one with simple data&lt;/li&gt;
	&lt;li&gt;assert expected Content-Type returned, and expected input recieved by the methods on the mock writers, for all 3*2 permutations of RawResponesWriter instances and QueryResponses&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;what do you think?&lt;/p&gt;</comment>
                            <comment id="14101858" author="sdavids" created="Tue, 19 Aug 2014 05:08:31 +0000"  >&lt;p&gt;Yea, this is a somewhat obscure bug I came across since I wanted to send back a raw stream but if an exception occurred I wanted to apply a velocity template to the response instead. I will throw some tests together in the next day or two.&lt;/p&gt;</comment>
                            <comment id="14106403" author="sdavids" created="Fri, 22 Aug 2014 03:21:48 +0000"  >&lt;p&gt;Added tests which provides complete code coverage of the RawResponseWriter. I didn&apos;t go the mocking route, instead it is an integration test by spinning up a core to assert 3 different cases:&lt;/p&gt;

&lt;p&gt;1) If a content stream is provided send that back in the writer &amp;amp; output stream&lt;br/&gt;
2) If no content stream is provided and no base writer is specified verify the response is serialized with the default writer (XML)&lt;br/&gt;
3) If no content stream is provided and a base writer is specified serialize with the specified writer&lt;/p&gt;</comment>
                            <comment id="14106411" author="sdavids" created="Fri, 22 Aug 2014 03:31:58 +0000"  >&lt;p&gt;Made a small tweak to use the Java 7 auto-closeable for the Writer/Output streams.&lt;/p&gt;</comment>
                            <comment id="14114631" author="sdavids" created="Fri, 29 Aug 2014 00:03:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; Does the supplied tests fit the bill?&lt;/p&gt;</comment>
                            <comment id="14119358" author="hossman" created="Wed, 3 Sep 2014 05:15:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;...I didn&apos;t go the mocking route, instead it is an integration test by spinning up a core to assert 3 different cases:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re reasoning makes sense, but it was hard to really see that that&apos;s what your tests was doing the way you had it organized &amp;#8211; and none of your existing tests really dealt with the situation where the base writer was &lt;em&gt;also&lt;/em&gt; implemented BinaryQueryResponseWriter.  There was also a bit of a code smell for me in the way you constructed the RawResponseWriter in one place, but called init() on it (sometimes) in another.&lt;/p&gt;

&lt;p&gt;So i took a stab at refactoring it to have test methods that more directly modeled the list of situations you identified, in addition to adding more comments spelling out exactly what each method is doing.&lt;/p&gt;

&lt;p&gt;I also made a few trivial tweaks to QueryResponseWriterUtil...&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;license at top of file - not class doc&lt;/li&gt;
	&lt;li&gt;brief class doc&lt;/li&gt;
	&lt;li&gt;switch class to final w/private constructor&lt;/li&gt;
	&lt;li&gt;beef up method javadocs&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="14119803" author="sdavids" created="Wed, 3 Sep 2014 12:21:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;So i took a stab at refactoring it to have test methods that more directly modeled the list of situations you identified&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Personally I prefer having small, self describing test method names instead of having 3 methods that do everything and making you really dig in there if any one of the tests actually fail. That&apos;s why I went the route of building 3 test methods per case I described above:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;If a content stream is provided send that back in the writer &amp;amp; output stream
	&lt;ul&gt;
		&lt;li&gt;testGetContentType&lt;/li&gt;
		&lt;li&gt;testWriteContentStreamViaWriter&lt;/li&gt;
		&lt;li&gt;testWriteContentStreamViaOutputStream&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;If no content stream is provided and no base writer is specified verify the response is serialized with the default writer (XML)
	&lt;ul&gt;
		&lt;li&gt;testDefaultBaseWriterGetContentType&lt;/li&gt;
		&lt;li&gt;testDefaultBaseWriterViaWriter&lt;/li&gt;
		&lt;li&gt;testDefaultBaseWriterViaOutputStream&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;If no content stream is provided and a base writer is specified serialize with the specified writer
	&lt;ul&gt;
		&lt;li&gt;testJsonBaseWriterGetContentType&lt;/li&gt;
		&lt;li&gt;testJsonBaseWriterViaWriter&lt;/li&gt;
		&lt;li&gt;testJsonBaseWriterViaOutputStream&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Personally I think this is one of those &quot;beauty is in the eye of the beholder&quot;, I kind of prefer the original test but cleanliness and clarity can sometimes be subjective (though &quot;initRawResponseWriter&quot; was a poor naming choice, perhaps &quot;setBaseWriter&quot; would have been better). &lt;/p&gt;

&lt;p&gt;You are testing a couple more cases that I wasn&apos;t looking for before, which is always a good thing. All the other changes look good, I&apos;m not hung up on any of the test changes.&lt;/p&gt;</comment>
                            <comment id="14120290" author="jira-bot" created="Wed, 3 Sep 2014 19:18:21 +0000"  >&lt;p&gt;Commit 1622321 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1622321&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1622321&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4406&quot; title=&quot;RawResponseWriter - doesn&amp;#39;t use the configured &amp;quot;base&amp;quot; writer.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4406&quot;&gt;&lt;del&gt;SOLR-4406&lt;/del&gt;&lt;/a&gt;: Fix RawResponseWriter to respect &apos;base&apos; writer&lt;/p&gt;</comment>
                            <comment id="14120299" author="jira-bot" created="Wed, 3 Sep 2014 19:28:33 +0000"  >&lt;p&gt;Commit 1622326 from hossman@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1622326&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1622326&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4406&quot; title=&quot;RawResponseWriter - doesn&amp;#39;t use the configured &amp;quot;base&amp;quot; writer.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4406&quot;&gt;&lt;del&gt;SOLR-4406&lt;/del&gt;&lt;/a&gt;: Fix RawResponseWriter to respect &apos;base&apos; writer (merge r1622321)&lt;/p&gt;</comment>
                            <comment id="14120302" author="hossman" created="Wed, 3 Sep 2014 19:33:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Personally I prefer having small, self describing test method names...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, to me the tests as you had them were too small to really have any context as to what was going on - i&apos;d rather the individual tests be readable as a &quot;story&quot; (you start with x, you do y, you expect a, b, and c) ... but yeah, it&apos;s largely subjective.&lt;/p&gt;

&lt;p&gt;in any case, thank you very much for the patch and the tests!&lt;/p&gt;</comment>
                            <comment id="14332884" author="anshumg" created="Mon, 23 Feb 2015 05:02:25 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12492017">SOLR-2263</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12666153" name="SOLR-4406.patch" size="20054" author="hossman" created="Wed, 3 Sep 2014 05:15:56 +0000"/>
                            <attachment id="12663585" name="SOLR-4406.patch" size="15859" author="sdavids" created="Fri, 22 Aug 2014 04:01:41 +0000"/>
                            <attachment id="12663582" name="SOLR-4406.patch" size="15975" author="sdavids" created="Fri, 22 Aug 2014 03:31:58 +0000"/>
                            <attachment id="12663579" name="SOLR-4406.patch" size="14886" author="sdavids" created="Fri, 22 Aug 2014 03:21:48 +0000"/>
                            <attachment id="12662681" name="SOLR-4406.patch" size="9450" author="sdavids" created="Tue, 19 Aug 2014 03:28:16 +0000"/>
                            <attachment id="12662680" name="SOLR-4406.patch" size="6753" author="sdavids" created="Tue, 19 Aug 2014 03:24:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311481</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hr5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311827</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>