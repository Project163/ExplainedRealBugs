<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:45:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10814] Solr RuleBasedAuthorization config doesn&apos;t work seamlessly with kerberos authentication</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10814</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Solr allows configuring roles to control user access to the system. This is accomplished through rule-based permission definitions which are assigned to users.&lt;/p&gt;

&lt;p&gt;The authorization framework in Solr passes the information about the request (to be authorized) using an instance of AuthorizationContext class. Currently the only way to extract authenticated user is via getUserPrincipal() method which returns an instance of java.security.Principal class. The RuleBasedAuthorizationPlugin implementation invokes getName() method on the Principal instance to fetch the list of associated roles.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/2271e73e763b17f971731f6f69d6ffe46c40b944/solr/core/src/java/org/apache/solr/security/RuleBasedAuthorizationPlugin.java#L156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/2271e73e763b17f971731f6f69d6ffe46c40b944/solr/core/src/java/org/apache/solr/security/RuleBasedAuthorizationPlugin.java#L156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In case of basic authentication mechanism, the principal is the userName. Hence it works fine. But in case of kerberos authentication, the user principal also contains the RELM information e.g. instead of foo, it would return foo@EXAMPLE.COM. This means if the user changes the authentication mechanism, he would also need to change the user-role mapping in authorization section to use foo@EXAMPLE.COM instead of foo. This is not good from usability perspective.   &lt;/p&gt;</description>
                <environment></environment>
        <key id="13077270">SOLR-10814</key>
            <summary>Solr RuleBasedAuthorization config doesn&apos;t work seamlessly with kerberos authentication</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mdrob">Mike Drob</assignee>
                                    <reporter username="hgadre">Hrishikesh Gadre</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Jun 2017 15:52:04 +0000</created>
                <updated>Thu, 12 May 2022 00:26:48 +0000</updated>
                            <resolved>Wed, 8 Jul 2020 15:27:13 +0000</resolved>
                                    <version>6.2</version>
                                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16037127" author="hgadre" created="Mon, 5 Jun 2017 15:55:34 +0000"  >&lt;p&gt;Upon investigation, I found that we can utilize getRemoteUser() method in HttpServletRequest class to fetch the name of the authenticated user.&lt;br/&gt;
&lt;a href=&quot;http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html#getRemoteUser(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html#getRemoteUser(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Currently Hadoop authentication framework returns appropriate information for this method. So we should add an API in AuthorizationContext class to return this information as well (along with relevant changes in RuleBasedAuthorizationPlugin).&lt;/p&gt;</comment>
                            <comment id="16037673" author="githubbot" created="Mon, 5 Jun 2017 21:57:03 +0000"  >&lt;p&gt;GitHub user hgadre opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/210&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10814&quot; title=&quot;Solr RuleBasedAuthorization config doesn&amp;#39;t work seamlessly with kerberos authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10814&quot;&gt;&lt;del&gt;SOLR-10814&lt;/del&gt;&lt;/a&gt; Solr RuleBasedAuthorizationPlugin works seamlessly with &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;Kerberos authentication&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hgadre/lucene-solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hgadre/lucene-solr&lt;/a&gt; solr10814&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/210.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/210.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #210&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c76333f221ab927904d3e4f07e06c83b56e8e007&lt;br/&gt;
Author: Hrishikesh Gadre &amp;lt;hgadre@cloudera.com&amp;gt;&lt;br/&gt;
Date:   2017-06-05T20:14:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10814&quot; title=&quot;Solr RuleBasedAuthorization config doesn&amp;#39;t work seamlessly with kerberos authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10814&quot;&gt;&lt;del&gt;SOLR-10814&lt;/del&gt;&lt;/a&gt; Solr RuleBasedAuthorizationPlugin works seamlessly with Kerberos authentication&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16037675" author="hgadre" created="Mon, 5 Jun 2017 21:57:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; can you please take a look?&lt;/p&gt;</comment>
                            <comment id="16038506" author="ichattopadhyaya" created="Tue, 6 Jun 2017 09:57:45 +0000"  >&lt;p&gt;Hi Hrishikesh, I shall be able to take a look at it by end of day, Wednesday. Pinging &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noblepaul&quot; class=&quot;user-hover&quot; rel=&quot;noblepaul&quot;&gt;noblepaul&lt;/a&gt; here, in case he can do it before me.&lt;/p&gt;</comment>
                            <comment id="16041730" author="ichattopadhyaya" created="Wed, 7 Jun 2017 22:00:30 +0000"  >&lt;p&gt;Just had a brief look at the patch. Here are my observations / concerns:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;In general, I agree that the admin shouldn&apos;t need to reconfigure his authorization configurations to add the realm name to the usernames.&lt;/li&gt;
	&lt;li&gt;However, I don&apos;t think we should deprecate getUserPrincipal() in AuthorizationContext, since many admins who only want kerberos would prefer to keep the realm in their authorization configurations.&lt;/li&gt;
	&lt;li&gt;Also, I don&apos;t think dropping the realm is a good idea for an organization that has setup cross realm authorization. Imagine that ishan@REALM1 and ishan@REALM2 maybe completely different users.&lt;/li&gt;
	&lt;li&gt;Also, this is a significant backcompat break for kerberos+authorization setups that would prevent them from upgrading.&lt;/li&gt;
	&lt;li&gt;How about using the getUserPrincipal or getUserName based on some configuration / property? That is, if someone wants to setup Solr for a variety of authentication mechanisms, he could enable some configuration property after which the getUserName() would be used instead of getPrincipal (or other way around)?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16041860" author="hgadre" created="Wed, 7 Jun 2017 23:07:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, this is a significant backcompat break for kerberos+authorization setups that would prevent them from upgrading.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;How about using the getUserPrincipal or getUserName based on some configuration / property? That is, if someone wants to setup Solr for a variety of authentication mechanisms, he could enable some configuration property after which the getUserName() would be used instead of getPrincipal (or other way around)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree. We can make this behavior &lt;b&gt;configurable&lt;/b&gt; for RuleBasedAuthorizationPlugin&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, I don&apos;t think dropping the realm is a good idea for an organization that has setup cross realm authorization. Imagine that ishan@REALM1 and ishan@REALM2 maybe completely different users.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I disagree. We are not dropping the RELM from the principal name. The kerberos authentication plugin applies a set of &quot;kerberos name rules&quot; to the authenticated principal and uses the result as the &quot;short user name&quot;. Hence it is possible for the system administrators to tweak the output of this process by modifying the kerberos name rules parameter. Here are few pointers for more details,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.1/doc/krb5-admin/realms--krb5.conf-.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.1/doc/krb5-admin/realms--krb5.conf-.html&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_sg_kerbprin_to_sn.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_sg_kerbprin_to_sn.html&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;However, I don&apos;t think we should deprecate getUserPrincipal() in AuthorizationContext, since many admins who only want kerberos would prefer to keep the realm in their authorization configurations.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I disagree. This is not just restricted to RuleBasedAuthorizationPlugin, but it applies to all future implementations of AuthorizationPlugin (e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-1475&quot; title=&quot;Integrate Sentry with Solr 7 authorization framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-1475&quot;&gt;&lt;del&gt;SENTRY-1475&lt;/del&gt;&lt;/a&gt;). Specifically - if AuthorizationContext provides both user_principal and user_name, which of these should be used by the plugin implementation? &lt;/p&gt;

&lt;p&gt;I know that Apache Sentry &lt;b&gt;always&lt;/b&gt; uses short user name for configuring permissions (even when kerberos is used). &lt;/p&gt;

&lt;p&gt;I found that Apache Ranger is converting the kerberos principal to the short username as part of the authorization plugin implementation,&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/ranger/blob/16f3dd3c350ac9ea85b157b81ceddfcdb761e128/plugin-solr/src/main/java/org/apache/ranger/authorization/solr/authorizer/RangerSolrAuthorizer.java#L170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/ranger/blob/16f3dd3c350ac9ea85b157b81ceddfcdb761e128/plugin-solr/src/main/java/org/apache/ranger/authorization/solr/authorizer/RangerSolrAuthorizer.java#L170&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The problem I have with this implementation in Apache Ranger is that the details of authentication mechanism are spilling into the authorization logic. e.g. take a look at following comment,&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/ranger/blame/16f3dd3c350ac9ea85b157b81ceddfcdb761e128/agents-audit/src/main/java/org/apache/ranger/audit/provider/MiscUtil.java#L560&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/ranger/blame/16f3dd3c350ac9ea85b157b81ceddfcdb761e128/agents-audit/src/main/java/org/apache/ranger/audit/provider/MiscUtil.java#L560&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Ideally I would expect the authorization plugin to deal with just short user names and be completely agnostic of underlying authentication mechanism. &lt;/p&gt;

&lt;p&gt;So to summarize - here is my proposal,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I agree that we need to be backwards compatible with respect to RuleBasedAuthorizationPlugin. Hence we should make the switch from principal name to user_name configurable.&lt;/li&gt;
	&lt;li&gt;I don&apos;t agree with the rationale of not deprecating getUserPrincipal(). Most of the role based authorization solutions are using short user names. Hence if we deprecate getUserPrincipal() for Solr 7.0 (and/or 6.x), we can wait until 8.0 to clean this up. That will provide sufficient time for the administrators to migrate their authorization settings to user short user-names.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please let me know your thoughts.&lt;/p&gt;

</comment>
                            <comment id="16063398" author="hgadre" created="Mon, 26 Jun 2017 16:56:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; any thoughts? This bugfix is needed for Solr/Sentry integration. Hence any feedback would be great...&lt;/p&gt;</comment>
                            <comment id="16068447" author="hgadre" created="Thu, 29 Jun 2017 15:04:21 +0000"  >&lt;p&gt;ping...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; Any thoughts?&lt;/p&gt;</comment>
                            <comment id="16069520" author="noble.paul" created="Fri, 30 Jun 2017 05:38:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hgadre&quot; class=&quot;user-hover&quot; rel=&quot;hgadre&quot;&gt;hgadre&lt;/a&gt; Yes, in case of Kerberos &lt;tt&gt;foo@EXAMPLE.COM&lt;/tt&gt; has to be specified in the user role mapping. So what is wrong with that ? How do you want it to be changed? do you wish to use just &lt;tt&gt;foo&lt;/tt&gt; instead of  &lt;tt&gt;user@EXAMPLE.COM&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;So, is the objective of the ticket is to &quot;use simple names instead of full name&quot;?&lt;/p&gt;</comment>
                            <comment id="16070777" author="ichattopadhyaya" created="Fri, 30 Jun 2017 21:59:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noblepaul&quot; class=&quot;user-hover&quot; rel=&quot;noblepaul&quot;&gt;noblepaul&lt;/a&gt;, I think the objective is to be able to re-use the authorization configs across BasicAuth and Kerberos. Kerberos requires that principals have the realm, but basicAuth usernames are simple ones.&lt;/p&gt;

&lt;p&gt;I agree with the objectives and the patch in general. However, as I mentioned, my major concerns are (a) backward compatibility (maybe the latest patch takes care of it) and (b) I don&apos;t think we should be deprecating getUserPrincipal(), which the authorization plugins have had available till now &amp;#8211; I don&apos;t mind getUsername() being used in out of the box authz plugins going forward, but I don&apos;t want to break or forcefully upgrade any third party using plugin that uses the full user principal; e.g. Ranger plugin maybe?  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bosco&quot; class=&quot;user-hover&quot; rel=&quot;bosco&quot;&gt;bosco&lt;/a&gt;, any thoughts?.&lt;/p&gt;

&lt;p&gt;Noble, what do you think on the latter issue?&lt;/p&gt;</comment>
                            <comment id="16070780" author="ichattopadhyaya" created="Fri, 30 Jun 2017 22:02:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hgadre&quot; class=&quot;user-hover&quot; rel=&quot;hgadre&quot;&gt;hgadre&lt;/a&gt;, actually, looking at your above comment on Ranger, I am less sure about not wanting to deprecate.&lt;br/&gt;
I&apos;ll be able to take a fresh look at it on Tuesday. Thanks for your patience and apologies for the delay.&lt;/p&gt;</comment>
                            <comment id="16070799" author="hgadre" created="Fri, 30 Jun 2017 22:24:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; Thanks for your feedback. &lt;/p&gt;

&lt;p&gt;Note - I have not yet updated the patch as I was wanted to ensure that we all agree on the approach. Here is the summary of my thinking so far,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;we need to be backwards compatible with respect to RuleBasedAuthorizationPlugin. Hence we should make the switch from principal name to user_name configurable.&lt;/li&gt;
	&lt;li&gt;We should use short user name instead of principal as most of the role based authorization solutions are using short user names. Here we have two options,&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;option (a)&lt;/b&gt; Expose both short user-name and principal&lt;/p&gt;

&lt;p&gt;Advantages&lt;br/&gt;
(a) No need to worry about backwards incompatibility&lt;/p&gt;

&lt;p&gt;Disadvantages&lt;br/&gt;
(a) Confusing for the third party integrators (Since similar information is available from both these APIs, which one should be used?) Clearly using getPrincipal() will require updating authorization metadata every time authentication mechanism is changed from/to kerberos. Hence most likely everyone will end up using getUserName() and will leave getPrincipal() unused for most part.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;option (b)&lt;/b&gt; Expose short user-name and deprecate getPrincipal() method&lt;/p&gt;

&lt;p&gt;Advantages&lt;br/&gt;
(a) No confusion with respect to which APIs to use.&lt;br/&gt;
(b) The API result will be consistent across authentication mechanisms.&lt;/p&gt;

&lt;p&gt;Disadvantages&lt;br/&gt;
(a) May have backwards incompatibility concerns further down the line (e.g. during Solr 8.0 release).&lt;/p&gt;

&lt;p&gt;Let me know your thoughts and I will update the patch accordingly.&lt;/p&gt;</comment>
                            <comment id="16070826" author="ichattopadhyaya" created="Fri, 30 Jun 2017 22:56:19 +0000"  >&lt;p&gt;My preference is option a, with properly worded javadocs (which includes details on which authentication plugins return what, etc.) to help the third party plugin writer to take the right decision.&lt;/p&gt;</comment>
                            <comment id="16070859" author="noble.paul" created="Fri, 30 Jun 2017 23:29:45 +0000"  >&lt;p&gt;This should be a configuration for the kerberos plugin . It can return appropriate name based on that configuration. Then, we don&apos;t need to touch the RuleBasedAuthorizationPlugin&lt;/p&gt;</comment>
                            <comment id="16087737" author="hgadre" created="Fri, 14 Jul 2017 18:19:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; I don&apos;t think any changes in the kerberos plugin are required. The representation of the user principal is a property of KERBEROS protocol and the KerberosPlugin is correctly reflecting it. The approach suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; is safer from backwards compatibility perspective. Let me update the patch...&lt;/p&gt;</comment>
                            <comment id="16087788" author="hgadre" created="Fri, 14 Jul 2017 18:50:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; I have updated the pull request. Note that&lt;/p&gt;

&lt;p&gt;TestRuleBasedAuthorizationPlugin -&amp;gt; Uses the getUserPrincipal() API (For testing backwards compatibility)&lt;br/&gt;
TestRuleBasedAuthorizationWithKerberos -&amp;gt; Uses the getUserName() API &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; This is the jira that I mentioned yesterday during the Solr meetup. Assuming that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; is happy with the latest patch, can we please consider back-porting it to 7.0 branch? This is very important for Solr/Sentry integration that I am working on (&lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-1475&quot; title=&quot;Integrate Sentry with Solr 7 authorization framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-1475&quot;&gt;&lt;del&gt;SENTRY-1475&lt;/del&gt;&lt;/a&gt;) &lt;/p&gt;</comment>
                            <comment id="16090791" author="anshumg" created="Mon, 17 Jul 2017 23:28:36 +0000"  >&lt;p&gt;I don&apos;t think I&apos;ll have the time to take a look at this, but I&apos;ll wait for Ishan to comment on this one. Also, can both of you weigh in on it&apos;s potential impact on existing code? I ask because I know that the Kerberos tests weren&apos;t the best ones, for multiple reasons &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. &lt;/p&gt;</comment>
                            <comment id="16090805" author="hgadre" created="Mon, 17 Jul 2017 23:42:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, can both of you weigh in on it&apos;s potential impact on existing code? I ask because I know that the Kerberos tests weren&apos;t the best ones, for multiple reasons&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;With my latest patch, there is no impact on the existing code. I have added a unit test verifying RuleBasedAuthorizationPlugin with Kerberos. Also all the unit tests are passing locally.&lt;/p&gt;</comment>
                            <comment id="16099759" author="bosco" created="Tue, 25 Jul 2017 09:17:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hgadre&quot; class=&quot;user-hover&quot; rel=&quot;hgadre&quot;&gt;hgadre&lt;/a&gt; thanks for keeping the getUserPrincipal() API. We are using it in Ranger and it helps us to use the same auth to local rules from Hadoop UGI.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

</comment>
                            <comment id="16099862" author="noble.paul" created="Tue, 25 Jul 2017 11:00:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hgadre&quot; class=&quot;user-hover&quot; rel=&quot;hgadre&quot;&gt;hgadre&lt;/a&gt; can you tell us which is the latest pull request&lt;/p&gt;</comment>
                            <comment id="16099868" author="noble.paul" created="Tue, 25 Jul 2017 11:16:56 +0000"  >&lt;p&gt;I talked to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; and I still believe the following is the best solution&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;KerBerosPlugin will emit a KerberoPrincipal which has 2 extra methods &lt;tt&gt;getRealm()&lt;/tt&gt; and &lt;tt&gt;getFullName()&lt;/tt&gt; .&lt;/li&gt;
	&lt;li&gt;The &lt;tt&gt;Principal#getName(&lt;/tt&gt;) will continue to return the long name&lt;/li&gt;
	&lt;li&gt;Add an extra flag fro kerberosPlugin say &lt;tt&gt;kerberos.useShortName&lt;/tt&gt; . If that flag is set to true  &lt;tt&gt;Principal#getName()&lt;/tt&gt; returns short names else it will continue to return the long name as it does today&lt;/li&gt;
	&lt;li&gt;This solution is backward compatible and we don&apos;t need to touch any other plugin other than the &lt;tt&gt;KerberosPlugin&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16099913" author="bosco" created="Tue, 25 Jul 2017 11:48:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;, what will be the default value for kerberos.useShortName flag?&lt;/p&gt;</comment>
                            <comment id="16099917" author="noble.paul" created="Tue, 25 Jul 2017 11:50:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Noble Paul, what will be the default value for kerberos.useShortName flag?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;tt&gt;false&lt;/tt&gt;. If it is &lt;tt&gt;true&lt;/tt&gt;, it will be incompatible with all users who use kerberos today&lt;/p&gt;</comment>
                            <comment id="16099925" author="bosco" created="Tue, 25 Jul 2017 11:57:54 +0000"  >&lt;p&gt;Great, this should work for Apache Ranger with no changes.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="16100222" author="hgadre" created="Tue, 25 Jul 2017 15:39:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;can you tell us which is the latest pull request&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have only one pull request. (Updated the same with the review feedback). &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/210&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;KerBerosPlugin will emit a KerberoPrincipal which has 2 extra methods getRealm() and getFullName() .&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;BTW KerberosPlugin is not the only option for using kerberos with Solr. We have recently added HadoopAuthPlugin which allows configuring any authentication mechanism provided by underlying Hadoop framework (e.g. LDAP, OAuth etc.). Your suggestion will not work in that case (without adding hacks to identify Kerberos auth type).&lt;/p&gt;

&lt;p&gt;What are your thoughts on adding getUserName() method to AuthorizationContext ? Since we are keeping getPrincipal() method as well, the latest patch is perfectly backwards compatible. Please review the pull request and let me know what you think.&lt;/p&gt;</comment>
                            <comment id="16100249" author="hgadre" created="Tue, 25 Jul 2017 15:51:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Just to clarify - even though I have worded this jira as related RuleBasedAuthorizationPlugin + Kerberos, it can be a problem for any authentication mechanism which provides a Principal string other than the short user name.  &lt;/p&gt;</comment>
                            <comment id="16100258" author="noble.paul" created="Tue, 25 Jul 2017 15:55:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;BTW KerberosPlugin is not the only option for using kerberos with Solr. We have recently added HadoopAuthPlugin which allows configuring any authentication mechanism provided by underlying Hadoop framework (e.g. LDAP, OAuth etc.). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;All authentication plugins should extend the &lt;tt&gt;AuthenticationPlugin&lt;/tt&gt; class. So, it should decide what details it should return. This has nothing to do with what underlying authentication is used. The authorization plugin should be agnostic of authentication mechanism&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What are your thoughts on adding getUserName() method to AuthorizationContext ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How do you expect &lt;tt&gt;RuleBasedAuthorizationPlugin&lt;/tt&gt; to work w/o changes. What about other users who already relies on &lt;tt&gt;getUserPrincipal()&lt;/tt&gt; &lt;/p&gt;
</comment>
                            <comment id="16100260" author="hgadre" created="Tue, 25 Jul 2017 15:56:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bosco&quot; class=&quot;user-hover&quot; rel=&quot;bosco&quot;&gt;bosco&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;and it helps us to use the same auth to local rules from Hadoop UGI.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In my patch, we are using the short username provided by Hadoop authentication layer itself. So we would be using the same auth to local rules from the Hadoop UGI.&lt;/p&gt;</comment>
                            <comment id="16100273" author="noble.paul" created="Tue, 25 Jul 2017 16:02:45 +0000"  >&lt;p&gt;The problem with the solution is, the configuration for what feature of authentication to use is set in the authorization plugin. Every plugin will need to have a special flag to achieve this. This makes no sense to me. The framework is supposed to take care of these things. &lt;/p&gt;

&lt;p&gt;If there is a Ranger Authorization plugin, you want them to implement this flag as well?&lt;/p&gt;</comment>
                            <comment id="16100832" author="hgadre" created="Tue, 25 Jul 2017 21:36:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If there is a Ranger Authorization plugin, you want them to implement this flag as well?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;AFAIK Ranger plugin does not need this flag (or this fix in general) since they have already implemented logic to parse Kerberos principal -&amp;gt; short userName. &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/ranger/blame/16f3dd3c350ac9ea85b157b81ceddfcdb761e128/agents-audit/src/main/java/org/apache/ranger/audit/provider/MiscUtil.java#L560&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/ranger/blame/16f3dd3c350ac9ea85b157b81ceddfcdb761e128/agents-audit/src/main/java/org/apache/ranger/audit/provider/MiscUtil.java#L560&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The concern here is that it &quot;assumes&quot; kerberos authentication. I don&apos;t know if this works for any authentication type other than Kerberos (e.g. basic auth).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The framework is supposed to take care of these things.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree. In the hindsight, it was a mistake for Solr authorization framework to provide java.security.Principal as part of AuthorizationContext (instead of short userName) since the Principal representation depends upon the type of the authentication scheme. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;All authentication plugins should extend the AuthenticationPlugin class. So, it should decide what details it should return. This has nothing to do with what underlying authentication is used. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How would we do that? By overriding getUserPrincipal() method in the HttpServletRequest class ? I would be concerned with that. Since  getUserPrincipal() is a public method and can be used by downstream components (e.g. custom request handlers, plugins etc.), this would be a backwards incompatible change.&lt;/p&gt;

&lt;p&gt;A safer alternative may be to let authorization framework handle this global flag and return short username (or user principal) accordingly.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/10875143b2eb4c6cd72c7a93e657833444498b66/solr/core/src/java/org/apache/solr/servlet/HttpSolrCall.java#L1034&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/10875143b2eb4c6cd72c7a93e657833444498b66/solr/core/src/java/org/apache/solr/servlet/HttpSolrCall.java#L1034&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Principal getUserPrincipal() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.getBoolean(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.authorization.useShortName&quot;&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicUserPrincipal(getReq().getRemoteUser());
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getReq().getUserPrincipal();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;




</comment>
                            <comment id="16101137" author="noble.paul" created="Wed, 26 Jul 2017 03:57:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;A safer alternative may be to let authorization framework handle this global flag and return short username (or user principal) accordingly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This looks OK. But where does a user set this &lt;tt&gt;solr.authorization.useShortName&lt;/tt&gt;? in a system property? No . We must avoid system properties as much as possible. It could be a global property at the same level as &lt;tt&gt;authentication&lt;/tt&gt; &amp;amp; &lt;tt&gt;authorization&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;security.json&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
&lt;span class=&quot;code-quote&quot;&gt;&quot;useShortUserName&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;authentication&quot;&lt;/span&gt;:{},
&lt;span class=&quot;code-quote&quot;&gt;&quot;authorization&quot;&lt;/span&gt;:{}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We will need to add a command to toggle this flag &lt;/p&gt;</comment>
                            <comment id="16101408" author="bosco" created="Wed, 26 Jul 2017 09:15:00 +0000"  >&lt;p&gt;After going again through the discussion, I personally feel, option A is a good option. &lt;br/&gt;
&amp;gt; option (a) Expose both short user-name and principal&lt;br/&gt;
It should be the authentication plugins responsibility to set/derive the short name, but also expose the security Principal, so that the authorization module (or others) if it wants to, it can process the Principals as it wishes. &lt;/p&gt;

&lt;p&gt;So in the future, if we start supporting certificate based two way SSL authentication, then the SSLAuthPlugin will be responsible for getting the CN from the certificate and derive the shortUserName from it, but also make the entire DN available in the getPrincipal() API.&lt;/p&gt;

&lt;p&gt;In most cases, all the code should use getShortName(), which should be user friendly and printable string. So that we can use it in logs and other places.&lt;/p&gt;

&lt;p&gt;This approach will give provide both backward compatibility and also we don&apos;t have to do any property hacks. And make it future proof for any new authentication plugins.&lt;/p&gt;
</comment>
                            <comment id="16101510" author="noble.paul" created="Wed, 26 Jul 2017 10:27:04 +0000"  >&lt;p&gt;No. getShortName() is not backward compatible. How are you going to switch between the both?&lt;/p&gt;</comment>
                            <comment id="16101521" author="bosco" created="Wed, 26 Jul 2017 10:34:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;No. getShortName() is not backward compatible. How are you going to switch between the both?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;What I meant was, all existing code will continue using getPrincipal(). And for anyone writing new authorization plugin, they can use either of the two methods. Those who want to keep to play it safe, can use getShortName()  and not worry about the underlying authentication mode. And those who want to do additional processing then can use getPrincipal(). &lt;/p&gt;



</comment>
                            <comment id="16117059" author="hgadre" created="Mon, 7 Aug 2017 18:53:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;What I meant was, all existing code will continue using getPrincipal(). And for anyone writing new authorization plugin, they can use either of the two methods. Those who want to keep to play it safe, can use getShortName() and not worry about the underlying authentication mode. And those who want to do additional processing then can use getPrincipal().&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bosco&quot; class=&quot;user-hover&quot; rel=&quot;bosco&quot;&gt;bosco&lt;/a&gt; Thanks for your feedback. I think it make sense. I would prefer to use short userName for Sentry plugin (instead of requiring some special configuration from user).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; it looks like Apache Ranger and Sentry plugins would not need special flag if the short username is exposed via AuthorizationContext. But as you said RuleBasedAuthorizationPlugin (and other third-party implementations) may benefit from a global flag. After thinking about it, I am not sure if we can have one solution which would benefit all plugins.&lt;/p&gt;

&lt;p&gt;So I suggest following approach,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Expose short userName via AuthorizationContext. This will allow new plugin implementations to work without any special configuration.&lt;/li&gt;
	&lt;li&gt;Add a parameter in security.json which can define the result of the AuthorizationContext#getPrincipal() API (i.e. a fully qualified principal name vs short userName). This will allow RuleBasedAuthorization plugin as well as other third party implementations to work without any changes. (Note - user will need to set this parameter for that though).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Does that make sense?&lt;/p&gt;</comment>
                            <comment id="16118197" author="noble.paul" created="Tue, 8 Aug 2017 11:13:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;Expose short userName via AuthorizationContext. This will allow new plugin implementations to work without any special configuration.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Tell me , how will the new plugin implementation know whether to use a short name or a long name? &lt;/p&gt;

&lt;p&gt;Anyway, I personally am ambivalent about how third party plugins are written. &lt;/p&gt;

&lt;p&gt;The flag anyway lets the user switch between long and short name easily. &lt;tt&gt;RuleBasedAuthorizationPlugin&lt;/tt&gt; does not have to be modified. &lt;/p&gt;</comment>
                            <comment id="16118434" author="hgadre" created="Tue, 8 Aug 2017 15:03:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Tell me , how will the new plugin implementation know whether to use a short name or a long name?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We will just use the short name all the time (and ignore the long name). Obviously this means that the plugin can only work for Solr releases which contain this fix. But I think that is ok.&lt;/p&gt;</comment>
                            <comment id="16118477" author="noble.paul" created="Tue, 8 Aug 2017 15:35:09 +0000"  >&lt;p&gt;I think we have reached a consensus&lt;/p&gt;</comment>
                            <comment id="16118574" author="bosco" created="Tue, 8 Aug 2017 16:26:13 +0000"  >&lt;p&gt;+1&lt;br/&gt;
Seems reasonable to me also. Thanks&lt;/p&gt;</comment>
                            <comment id="16118958" author="hgadre" created="Tue, 8 Aug 2017 20:20:08 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bosco&quot; class=&quot;user-hover&quot; rel=&quot;bosco&quot;&gt;bosco&lt;/a&gt; for your feedback!&lt;/p&gt;

&lt;p&gt;I have updated the pull request based on our discussion: &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/210&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BTW I found that SecurityConfHandler in Solr does not support configuring top-level elements of the security.json file. Users are expected to upload the security.json file manually to Zookeeper. Once this is done, the individual authentication/authorization plugins can edit their own configuration via Solr HTTP APIs. Hence I think the ability to update this flag (as well as initial configuration of plugins) via HTTP API should be handled as part of a separate jira. Does that make sense?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; Please include this fix in the Solr 7.0 branch as it will simplify the Solr/Sentry integration. &lt;/p&gt;
</comment>
                            <comment id="16119496" author="noble.paul" created="Wed, 9 Aug 2017 06:51:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;BTW I found that SecurityConfHandler in Solr does not support configuring top-level elements of the security.json file &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;correct and we need to add it&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please include this fix in the Solr 7.0 branch as it will simplify the Solr/Sentry integration.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We have already frozen 7.0 branch. This can go in 7.1 which will be released pretty soon&lt;/p&gt;</comment>
                            <comment id="16124178" author="hgadre" created="Fri, 11 Aug 2017 22:08:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; OK I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11230&quot; title=&quot;Support configuring global properties in security.json via HTTP API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11230&quot;&gt;SOLR-11230&lt;/a&gt; for introducing the HTTP APIs for configuring global properties in security.json. If you get a chance, can you please review (and commit) the patch for this jira?&lt;/p&gt;</comment>
                            <comment id="16125737" author="noble.paul" created="Mon, 14 Aug 2017 14:21:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;If you get a chance, can you please review (and commit) the patch for this jira?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;where is the patch?&lt;/p&gt;</comment>
                            <comment id="16126006" author="hgadre" created="Mon, 14 Aug 2017 17:16:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; I had opened a github pull request. Anyway I am uploading a patch as well. Please take a look and let me have your feedback.&lt;/p&gt;</comment>
                            <comment id="16133465" author="hgadre" created="Fri, 18 Aug 2017 18:55:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; could you please review the attached patch?&lt;/p&gt;</comment>
                            <comment id="16141918" author="hgadre" created="Fri, 25 Aug 2017 17:17:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; ping &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16142641" author="noble.paul" created="Sat, 26 Aug 2017 06:19:06 +0000"  >&lt;p&gt;There should be  a command to edit this property at &lt;tt&gt;/security&lt;/tt&gt; endpoint &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;curl  http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/admin/authentication -H &lt;span class=&quot;code-quote&quot;&gt;&apos;Content-type:application/json&apos;&lt;/span&gt; -d  &apos;{
&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;set-useShortNames&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This should be implemented in &lt;tt&gt;SecurityConfHandler.java&lt;/tt&gt; instead of the Authentication Plugin&lt;/p&gt;

&lt;p&gt;The variable &lt;tt&gt;useShortNames&lt;/tt&gt; must be stored in &lt;tt&gt;SecurityConfHandler.SecurityConfig&lt;/tt&gt; instead of &lt;tt&gt;CoreContainer&lt;/tt&gt;&lt;/p&gt;
</comment>
                            <comment id="17097668" author="mdrob" created="Fri, 1 May 2020 20:45:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hgadre&quot; class=&quot;user-hover&quot; rel=&quot;hgadre&quot;&gt;hgadre&lt;/a&gt; - do you have any interest in picking this up again? I&apos;d be happy to help review and get it included.&lt;/p&gt;</comment>
                            <comment id="17106690" author="janhoy" created="Wed, 13 May 2020 21:51:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12131&quot; title=&quot;Authorization plugin support for getting user&amp;#39;s roles from the outside&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12131&quot;&gt;&lt;del&gt;SOLR-12131&lt;/del&gt;&lt;/a&gt; is now merged.&lt;/p&gt;</comment>
                            <comment id="17146600" author="mdrob" created="Fri, 26 Jun 2020 19:43:11 +0000"  >&lt;p&gt;I&apos;ve been looking at this again, and have been thinking about the design a lot. I don&apos;t think that the shortName flag should be on coreContainer, that feels too broad. So I was trying to put it on the Auth plugin, as shown in my draft PR, but I am not sure that&apos;s right either. The PR isn&apos;t fully implemented yet anyway - the tests fail and there needs to be some more plumbing through the configuration options.&lt;/p&gt;

&lt;p&gt;But maybe this makes sense on the authn plugin instead? The auth plugin shouldn&apos;t be tasked with figuring out where to find the user... it should be on the authentication plugin to create the correct principal in the first place?&lt;/p&gt;</comment>
                            <comment id="17146628" author="mdrob" created="Fri, 26 Jun 2020 20:42:59 +0000"  >&lt;p&gt;The other side is that all of the authentication plugins that support short names should be setting them anyway, and then the decision to use them or not really does fall back to the authz plugin?&lt;/p&gt;</comment>
                            <comment id="17152884" author="jira-bot" created="Tue, 7 Jul 2020 16:39:27 +0000"  >&lt;p&gt;Commit d3f4b21deb0056098e9e888a6b9d72e0bf2d0834 in lucene-solr&apos;s branch refs/heads/master from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d3f4b21&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d3f4b21&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10814&quot; title=&quot;Solr RuleBasedAuthorization config doesn&amp;#39;t work seamlessly with kerberos authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10814&quot;&gt;&lt;del&gt;SOLR-10814&lt;/del&gt;&lt;/a&gt; Add short-name feature to RuleBasedAuthz plugin&lt;/p&gt;

&lt;p&gt;Additional-Author: Hrishikesh Gadre &amp;lt;hgadre@cloudera.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17153689" author="jira-bot" created="Wed, 8 Jul 2020 15:24:46 +0000"  >&lt;p&gt;Commit fc5887181b75d7e622ca31ebf0531f8d3b7599d8 in lucene-solr&apos;s branch refs/heads/master from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fc58871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fc58871&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10814&quot; title=&quot;Solr RuleBasedAuthorization config doesn&amp;#39;t work seamlessly with kerberos authentication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10814&quot;&gt;&lt;del&gt;SOLR-10814&lt;/del&gt;&lt;/a&gt; changes entry&lt;/p&gt;</comment>
                            <comment id="17153691" author="mdrob" created="Wed, 8 Jul 2020 15:27:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; - responding to your question on the PR - the public touch points are covered in the ref guide. If the example there is insufficient, please let me know.&lt;/p&gt;</comment>
                            <comment id="17535623" author="janhoy" created="Thu, 12 May 2022 00:26:48 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12881792" name="SOLR-10814.patch" size="20541" author="hgadre" created="Mon, 14 Aug 2017 17:16:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fvpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>