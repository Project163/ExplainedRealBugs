<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:05:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7512] SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7512</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Sometime after Solr 4.9, the `MapReduceIndexerTool` got busted because invalid `solr.xml` contents were being written to the solr home dir zip. My guess is that a 5.0 change made the invalid file start to matter. &lt;/p&gt;

&lt;p&gt;The error manifests as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Error: java.lang.IllegalStateException: Failed to initialize record writer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; org.apache.solr.hadoop.MapReduceIndexerTool/SolrMapper, attempt_1430953999892_0012_r_000001_1
        at org.apache.solr.hadoop.SolrRecordWriter.&amp;lt;init&amp;gt;(SolrRecordWriter.java:126)
        at org.apache.solr.hadoop.SolrOutputFormat.getRecordWriter(SolrOutputFormat.java:163)
        at org.apache.hadoop.mapred.ReduceTask$NewTrackingRecordWriter.&amp;lt;init&amp;gt;(ReduceTask.java:569)
        at org.apache.hadoop.mapred.ReduceTask.runNewReducer(ReduceTask.java:643)
        at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:394)
        at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:175)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:415)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548)
        at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:170)
Caused by: org.apache.solr.common.SolrException: org.xml.sax.SAXParseException; Premature end of file.
        at org.apache.solr.core.Config.&amp;lt;init&amp;gt;(Config.java:156)
        at org.apache.solr.core.SolrXmlConfig.fromInputStream(SolrXmlConfig.java:127)
        at org.apache.solr.core.SolrXmlConfig.fromFile(SolrXmlConfig.java:110)
        at org.apache.solr.core.SolrXmlConfig.fromSolrHome(SolrXmlConfig.java:138)
        at org.apache.solr.core.CoreContainer.&amp;lt;init&amp;gt;(CoreContainer.java:142)
        at org.apache.solr.hadoop.SolrRecordWriter.createEmbeddedSolrServer(SolrRecordWriter.java:162)
        at org.apache.solr.hadoop.SolrRecordWriter.&amp;lt;init&amp;gt;(SolrRecordWriter.java:119)
        ... 9 more
Caused by: org.xml.sax.SAXParseException; Premature end of file.
        at org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException(Unknown Source)
        at org.apache.xerces.util.ErrorHandlerWrapper.fatalError(Unknown Source)
        at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
        at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
        at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
        at org.apache.xerces.impl.XMLVersionDetector.determineDocVersion(Unknown Source)
        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
        at org.apache.xerces.parsers.DOMParser.parse(Unknown Source)
        at org.apache.xerces.jaxp.DocumentBuilderImpl.parse(Unknown Source)
        at org.apache.solr.core.Config.&amp;lt;init&amp;gt;(Config.java:145)
        ... 15 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The last version that I&apos;ve successfully used `MapReduceIndexerTool` was 4.9, and I verified that this patch resolves the issue for me (testing on 5.1). I spent a couple hours trying to write a simple test case to exhibit the error, but I haven&apos;t quite figured out how to deal with the &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.security.AccessControlException: java.io.FilePermission ...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; errors. &lt;/p&gt;

&lt;p&gt;Pull request for bugfix &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/147&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12828195">SOLR-7512</key>
            <summary>SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="amcelwee">Adam McElwee</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 May 2015 23:54:51 +0000</created>
                <updated>Mon, 9 May 2016 18:58:10 +0000</updated>
                            <resolved>Tue, 16 Jun 2015 11:45:36 +0000</resolved>
                                    <version>5.1</version>
                                    <fixVersion>5.2.1</fixVersion>
                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>contrib - MapReduce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14533879" author="amcelwee" created="Fri, 8 May 2015 05:15:10 +0000"  >&lt;p&gt;I&apos;ve updated the PR to include the test case, but I&apos;m still wrestling with the security manager, and have to disable it to successfully execute the test.&lt;/p&gt;</comment>
                            <comment id="14565038" author="thetaphi" created="Fri, 29 May 2015 16:36:36 +0000"  >&lt;p&gt;There are some problems with the patch:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-        Path targetFile = destDir.resolve(entry.getName());
-        
+        Path targetFile = new File(destDir.toFile(), entry.getName()).toPath();
+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a no-go with Lucene/Solr: java.io.File is not allowed to be aused anywhere in Lucene code.&lt;/p&gt;</comment>
                            <comment id="14565047" author="markrmiller@gmail.com" created="Fri, 29 May 2015 16:48:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;but I haven&apos;t quite figured out how to deal with the &lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.security.AccessControlException: java.io.FilePermission ...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; errors.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s a known current problem - a couple tests have to be run via IDE or without a security manager because a Hadoop piece tries to write in an illegal location for tests.&lt;/p&gt;</comment>
                            <comment id="14565050" author="markrmiller@gmail.com" created="Fri, 29 May 2015 16:50:35 +0000"  >&lt;p&gt;Though if you are writing a new test, perhaps it&apos;s just your new code as Uwe points out.&lt;/p&gt;

&lt;p&gt;There are two tests that are currently generally skipped because of what I mention above - they are likely the tests that would catch this.&lt;/p&gt;</comment>
                            <comment id="14565058" author="amcelwee" created="Fri, 29 May 2015 16:56:34 +0000"  >&lt;p&gt;Patch updated to remove usage of `java.io.File`. &lt;/p&gt;

&lt;p&gt;For some reason that method in `TestUtil` wasn&apos;t correctly unpacking the zip and using relative paths. Maybe that&apos;s another issue, in itself. I switched to the hadoop fs `FileUtil.unZip`.&lt;/p&gt;</comment>
                            <comment id="14565063" author="thetaphi" created="Fri, 29 May 2015 17:02:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;For some reason that method in `TestUtil` wasn&apos;t correctly unpacking the zip and using relative paths. Maybe that&apos;s another issue, in itself. I switched to the hadoop fs `FileUtil.unZip`.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The reason could be a &quot;incorrectly packed ZIP file&quot;. There are some ZIP files out there that use backslashes as separator. Maybe the one you uses had this problem.&lt;/p&gt;</comment>
                            <comment id="14565070" author="amcelwee" created="Fri, 29 May 2015 17:06:34 +0000"  >&lt;p&gt;Hmm, possibly. The zip in question is the one created as part of the existing MRIndexerTool in `SolrOutputFormat`. A quick look at it shows that it&apos;s simply doing substring manipulation for creating the zip entries. Seems a bit questionable. At any rate, the hadoop `FileUtil.unZip` unpacks it w/ no issues.&lt;/p&gt;</comment>
                            <comment id="14577066" author="markrmiller@gmail.com" created="Mon, 8 Jun 2015 11:50:33 +0000"  >&lt;p&gt;I&apos;ve been working on getting this in. First dealing with a bunch of issues around the tests that would have already picked this up but can&apos;t run with a security manager - they couldnt run without additional dependencies and fixes due to recent hadoop upgrades it seems. Once I finished getting that straightened out, I&apos;ll pull in the new test.&lt;/p&gt;</comment>
                            <comment id="14577726" author="amcelwee" created="Mon, 8 Jun 2015 19:47:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;, if there&apos;s something that you think a newb solr contributor can help out w/, just let me know.&lt;/p&gt;</comment>
                            <comment id="14579169" author="markrmiller@gmail.com" created="Tue, 9 Jun 2015 16:25:49 +0000"  >&lt;p&gt;Okay, this patch gets things back up to speed. I&apos;ll look at integrating the new test next.&lt;/p&gt;</comment>
                            <comment id="14579261" author="markrmiller@gmail.com" created="Tue, 9 Jun 2015 17:21:05 +0000"  >&lt;p&gt;I&apos;m having some trouble with the new test, so I&apos;ll commit the standard cleanup first - I want to make sure that get&apos;s into 5.2.1.&lt;/p&gt;

&lt;p&gt;Recent hadoop lib updates allow us to properly run a couple tests that required no security manager to run - that should prevent this from popping up again.&lt;/p&gt;

&lt;p&gt;We do actually have to write the solr.xml file out - 6x requires a solr.xml file.&lt;/p&gt;</comment>
                            <comment id="14579350" author="jira-bot" created="Tue, 9 Jun 2015 18:18:13 +0000"  >&lt;p&gt;Commit 1684494 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1684494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1684494&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7512&quot; title=&quot;SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7512&quot;&gt;&lt;del&gt;SOLR-7512&lt;/del&gt;&lt;/a&gt;: SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool.&lt;/p&gt;</comment>
                            <comment id="14579362" author="jira-bot" created="Tue, 9 Jun 2015 18:31:12 +0000"  >&lt;p&gt;Commit 1684495 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1684495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1684495&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7512&quot; title=&quot;SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7512&quot;&gt;&lt;del&gt;SOLR-7512&lt;/del&gt;&lt;/a&gt;: SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool.&lt;/p&gt;</comment>
                            <comment id="14579473" author="jira-bot" created="Tue, 9 Jun 2015 19:46:54 +0000"  >&lt;p&gt;Commit 1684509 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_2&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1684509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1684509&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7512&quot; title=&quot;SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7512&quot;&gt;&lt;del&gt;SOLR-7512&lt;/del&gt;&lt;/a&gt;: SolrOutputFormat creates an invalid solr.xml in the solr home zip for MapReduceIndexerTool.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12738623" name="SOLR-7512.patch" size="67707" author="markrmiller@gmail.com" created="Tue, 9 Jun 2015 17:34:54 +0000"/>
                            <attachment id="12738604" name="SOLR-7512.patch" size="62823" author="markrmiller@gmail.com" created="Tue, 9 Jun 2015 16:25:49 +0000"/>
                            <attachment id="12736184" name="SOLR-7512.patch" size="11092" author="amcelwee" created="Fri, 29 May 2015 16:56:34 +0000"/>
                            <attachment id="12736172" name="SOLR-7512.patch" size="12204" author="amcelwee" created="Fri, 29 May 2015 16:27:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ega7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>