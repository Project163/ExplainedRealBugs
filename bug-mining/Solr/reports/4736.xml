<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:48:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15628] SolrException.log doesn&apos;t pass Throwable to Logger correctly</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15628</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Having recently started using JSON based logging, I noticed that in many code paths situations where an error involving a &quot;Throwable&quot;  are logged isn&apos;t happening correctly (This is also noticeable using the default solr log4j2.xml configuration - but only subtly)&lt;/p&gt;

&lt;p&gt;The problem is that &lt;tt&gt;SolrException.log(...)&lt;/tt&gt; has some very old (pre Solr 1.0, certainly pre SLF4j/Log4j) and hackish logic/code in it to support &lt;tt&gt;SolrException.ignorePatterns&lt;/tt&gt; (which was designed for tests that wanted &quot;quieter&quot; output when they were intentionally triggering error situations.  This logic &quot;stringifies&quot; the entire Throwable (including stack trace) to test against any &lt;tt&gt;ignorePatterns&lt;/tt&gt; that exist (even if there are no ignore patterns) before handing the resulting string off to the &lt;tt&gt;loggger.error(...)&lt;/tt&gt; call &amp;#8211; &lt;em&gt;as a log message string&lt;/em&gt; - w/o the normal &quot;structure&quot; context of the original Throwable instance.&lt;/p&gt;

&lt;p&gt;This causes the full exception stack trace to come through as the log &quot;message&quot; &amp;#8211; even in log appenders that have been configured to only log partial stack trace details, or log them in special fields (ie: JSON Logging)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13400866">SOLR-15628</key>
            <summary>SolrException.log doesn&apos;t pass Throwable to Logger correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Sep 2021 18:45:50 +0000</created>
                <updated>Wed, 17 Nov 2021 14:22:46 +0000</updated>
                            <resolved>Tue, 14 Sep 2021 17:47:43 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                    <fixVersion>8.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17414515" author="hossman" created="Mon, 13 Sep 2021 18:57:12 +0000"  >&lt;p&gt;We should probably re-think the entire existence of &lt;tt&gt;SolrException.log()&lt;/tt&gt; and the API design of &lt;tt&gt;SolrException.ignorePatterns&lt;/tt&gt;&#160;&#8211; replacing all callers of&#160;&lt;tt&gt;SolrException.log()&lt;/tt&gt; with&#160;&lt;tt&gt;logger.error()&lt;/tt&gt; and use a new test-only log4j Filter/Appdener &#8211; but I don&apos;t really have a sense of exactly what that can/should look like just yet, and it would break back compat for any end-user solrj/solr tests that may depend on those methods.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;In the mean time, we can &quot;fix&quot; the behavior of &lt;tt&gt;SolrException.log()&lt;/tt&gt; in a way that doesn&apos;t pay the price of the &quot;stringification&quot; in non-test code (where there are no &lt;tt&gt;SolrException.ignorePatterns&lt;/tt&gt; in a way that correctly passes the exception to the Logger &amp;#8211; see attached patch.&lt;/p&gt;

&lt;p&gt;This should also improve the performance of &lt;tt&gt;SolrException.log()&lt;/tt&gt; calls in non-test code using default solr log4j2.xml configuration, becuase of the AsyncLoggers (if/when the logger decides to produce the full stacktrace, it should be happening asynchronously).&lt;/p&gt;

&lt;p&gt;The only (minor) downside i see to this patch is that now when we are running tests, the stack traces of the Throwables being logged by this code path can be converted to Strings twice: once for the regex check, and (now) once again by the Logger &amp;#8211; but AFAICT this doesn&apos;t noticeably slow down test times, because the tests also use AsyncLoggers&lt;/p&gt;</comment>
                            <comment id="17415078" author="jira-bot" created="Tue, 14 Sep 2021 17:47:26 +0000"  >&lt;p&gt;Commit b60642c719f73f998d5130837b0fbaa1b91687a7 in solr&apos;s branch refs/heads/main from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=b60642c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=b60642c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15628&quot; title=&quot;SolrException.log doesn&amp;#39;t pass Throwable to Logger correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15628&quot;&gt;&lt;del&gt;SOLR-15628&lt;/del&gt;&lt;/a&gt;: The SolrException.log() helper method has been fixed to correctly passes the Throwable to the Logger w/o stringification&lt;/p&gt;</comment>
                            <comment id="17433933" author="jira-bot" created="Mon, 25 Oct 2021 19:00:07 +0000"  >&lt;p&gt;Commit eac7e9efc054357d7219040b1e36a9dc202deea1 in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=eac7e9e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=eac7e9e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15628&quot; title=&quot;SolrException.log doesn&amp;#39;t pass Throwable to Logger correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15628&quot;&gt;&lt;del&gt;SOLR-15628&lt;/del&gt;&lt;/a&gt;: The SolrException.log() helper method has been fixed to correctly passes the Throwable to the Logger w/o stringification&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b60642c719f73f998d5130837b0fbaa1b91687a7)&lt;/p&gt;</comment>
                            <comment id="17433936" author="jira-bot" created="Mon, 25 Oct 2021 19:02:42 +0000"  >&lt;p&gt;Commit d65a69df611ad698022378c300ff4182d6a7074d in solr&apos;s branch refs/heads/main from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=d65a69d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=d65a69d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15628&quot; title=&quot;SolrException.log doesn&amp;#39;t pass Throwable to Logger correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15628&quot;&gt;&lt;del&gt;SOLR-15628&lt;/del&gt;&lt;/a&gt;: Update changes on main branch to reflect backport to 8x for 8.11&lt;/p&gt;</comment>
                            <comment id="17445218" author="jpountz" created="Wed, 17 Nov 2021 14:22:46 +0000"  >&lt;p&gt;Closing after the 8.11 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13400903">SOLR-15629</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13406860">SOLR-15697</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13033428" name="SOLR-15628.patch" size="5956" author="hossman" created="Mon, 13 Sep 2021 18:57:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0uvc8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>