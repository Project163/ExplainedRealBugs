<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:50:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16122] TestLeaderElectionZkExpiry failing frequently</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16122</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Failing in 10% of runs - marking as &lt;tt&gt;@BadApple&lt;/tt&gt; before the 9.0 release&lt;/p&gt;</description>
                <environment></environment>
        <key id="13436376">SOLR-16122</key>
            <summary>TestLeaderElectionZkExpiry failing frequently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Mar 2022 09:21:29 +0000</created>
                <updated>Mon, 3 Jun 2024 22:24:41 +0000</updated>
                                            <version>9.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17513954" author="jira-bot" created="Tue, 29 Mar 2022 09:26:11 +0000"  >&lt;p&gt;Commit 60aa6693ba2fab2af71e83bc24c1c408d1d23d7b in solr&apos;s branch refs/heads/main from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=60aa669&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=60aa669&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16122&quot; title=&quot;TestLeaderElectionZkExpiry failing frequently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16122&quot;&gt;SOLR-16122&lt;/a&gt; Bad-apple TestLeaderElectionZkExpiry test&lt;/p&gt;</comment>
                            <comment id="17513955" author="jira-bot" created="Tue, 29 Mar 2022 09:26:51 +0000"  >&lt;p&gt;Commit b6f6cf1b23da5ad61d9e451ba6a6dd7e3e9f0a3d in solr&apos;s branch refs/heads/branch_9x from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=b6f6cf1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=b6f6cf1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16122&quot; title=&quot;TestLeaderElectionZkExpiry failing frequently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16122&quot;&gt;SOLR-16122&lt;/a&gt; Bad-apple TestLeaderElectionZkExpiry test&lt;/p&gt;</comment>
                            <comment id="17513956" author="jira-bot" created="Tue, 29 Mar 2022 09:27:14 +0000"  >&lt;p&gt;Commit 4ea6ecc35c0f6585c76e0713acfe917ccfe3b8cf in solr&apos;s branch refs/heads/branch_9_0 from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=4ea6ecc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=4ea6ecc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16122&quot; title=&quot;TestLeaderElectionZkExpiry failing frequently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16122&quot;&gt;SOLR-16122&lt;/a&gt; Bad-apple TestLeaderElectionZkExpiry test&lt;/p&gt;</comment>
                            <comment id="17851833" author="dsmiley" created="Mon, 3 Jun 2024 22:24:41 +0000"  >&lt;p&gt;This test seems to fail due to thread leaks.&lt;/p&gt;

&lt;p&gt;Happened yesterday in CI:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  2&amp;gt; INFO: All leaked threads terminated.
   &amp;gt;     com.carrotsearch.randomizedtesting.ThreadLeakError: 2 threads leaked from SUITE scope at org.apache.solr.cloud.TestLeaderElectionZkExpiry: 
   &amp;gt;        1) Thread[id=9557, name=zkConnectionManagerCallback-5960-thread-1-EventThread, state=WAITING, group=TGRP-TestLeaderElectionZkExpiry]
   &amp;gt;             at java.base@11.0.16.1/jdk.internal.misc.Unsafe.park(Native Method)
   &amp;gt;             at java.base@11.0.16.1/java.util.concurrent.locks.LockSupport.park(LockSupport.java:194)
   &amp;gt;             at java.base@11.0.16.1/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2081)
   &amp;gt;             at java.base@11.0.16.1/java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:433)
   &amp;gt;             at app//org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:535)
   &amp;gt;        2) Thread[id=9549, name=zkConnectionManagerCallback-5960-thread-1-EventThread, state=WAITING, group=TGRP-TestLeaderElectionZkExpiry]
   &amp;gt;             at java.base@11.0.16.1/java.lang.Object.wait(Native Method)
   &amp;gt;             at java.base@11.0.16.1/java.lang.Object.wait(Object.java:328)
   &amp;gt;             at app//org.apache.zookeeper.ClientCnxn.submitRequest(ClientCnxn.java:1583)
   &amp;gt;             at app//org.apache.zookeeper.ClientCnxn.submitRequest(ClientCnxn.java:1555)
   &amp;gt;             at app//org.apache.zookeeper.ClientCnxn.close(ClientCnxn.java:1522)
   &amp;gt;             at app//org.apache.zookeeper.ZooKeeper.close(ZooKeeper.java:1227)
   &amp;gt;             at app//org.apache.solr.common.cloud.SolrZkClient.updateKeeper(SolrZkClient.java:863)
   &amp;gt;             at app//org.apache.solr.common.cloud.ConnectionManager$1.update(ConnectionManager.java:190)
   &amp;gt;             at app//org.apache.solr.common.cloud.DefaultConnectionStrategy.reconnect(DefaultConnectionStrategy.java:59)
   &amp;gt;             at app//org.apache.solr.common.cloud.ConnectionManager.process(ConnectionManager.java:179)
   &amp;gt;             at app//org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:564)
   &amp;gt;             at app//org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:539)
   &amp;gt;         at __randomizedtesting.SeedInfo.seed([B35AE6C0068D8659]:0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And also for me on Crave recently (this time the OverseerShutdownThread):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2&amp;gt; SEVERE: 1 thread leaked from SUITE scope at org.apache.solr.cloud.TestLeaderElectionZkExpiry: 
  2&amp;gt;    1) Thread[id=349, name=OverseerExitThread, state=TIMED_WAITING, group=Overseer state updater.]
  2&amp;gt;         at java.base@11.0.23/java.lang.Thread.sleep(Native Method)
  2&amp;gt;         at app//org.apache.solr.common.cloud.ZkCmdExecutor.retryDelay(ZkCmdExecutor.java:101)
  2&amp;gt;         at app//org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:80)
  2&amp;gt;         at app//org.apache.solr.common.cloud.SolrZkClient.delete(SolrZkClient.java:345)
  2&amp;gt;         at app//org.apache.solr.cloud.LeaderElector.checkIfIamLeader(LeaderElector.java:118)
  2&amp;gt;         at app//org.apache.solr.cloud.LeaderElector.joinElection(LeaderElector.java:310)
  2&amp;gt;         at app//org.apache.solr.cloud.LeaderElector.retryElection(LeaderElector.java:395)
  2&amp;gt;         at app//org.apache.solr.cloud.LeaderElector.checkIfIamLeader(LeaderElector.java:133)
  2&amp;gt;         at app//org.apache.solr.cloud.LeaderElector.joinElection(LeaderElector.java:310)
  2&amp;gt;         at app//org.apache.solr.cloud.LeaderElector.retryElection(LeaderElector.java:395)
  2&amp;gt;         at app//org.apache.solr.cloud.ZkController.rejoinOverseerElection(ZkController.java:2364)
  2&amp;gt;         at app//org.apache.solr.cloud.Overseer$ClusterStateUpdater.checkIfIamStillLeader(Overseer.java:511)
  2&amp;gt;         at app//org.apache.solr.cloud.Overseer$ClusterStateUpdater$$Lambda$1667/0x000000010099b840.run(Unknown Source)
  2&amp;gt;         at java.base@11.0.23/java.lang.Thread.run(Thread.java:829)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This one above seems clear to me how it could happen since a new Thread is spawned with no wait &lt;a href=&quot;https://github.com/apache/solr/blob/70b6e4f6952cb7f9b3647865404487c68264668d/solr/core/src/java/org/apache/solr/cloud/Overseer.java#L417&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13430023">SOLR-16046</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10x8o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>