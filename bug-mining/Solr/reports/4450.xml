<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:43:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14247] IndexSizeTriggerMixedBoundsTest does a lot of sleeping</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14247</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When I run tests locally, the slowest reported test is always IndexSizeTriggerMixedBoundsTest  coming in at around 2 minutes.&lt;/p&gt;

&lt;p&gt;I took a look at the code and discovered that at least 80s of that is all sleeps!&lt;/p&gt;

&lt;p&gt;There might need to be more synchronization and ordering added back in, but when I removed all of the sleeps the test still passed locally for me, so I&apos;m not too sure what the point was or why we were slowing the system down so much.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13283794">SOLR-14247</key>
            <summary>IndexSizeTriggerMixedBoundsTest does a lot of sleeping</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mdrob">Mike Drob</assignee>
                                    <reporter username="mdrob">Mike Drob</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Feb 2020 22:23:26 +0000</created>
                <updated>Thu, 12 May 2022 00:26:31 +0000</updated>
                            <resolved>Wed, 12 Feb 2020 18:52:16 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17032929" author="erickerickson" created="Sat, 8 Feb 2020 16:46:50 +0000"  >&lt;p&gt;I&apos;ll beast this over this weekend....&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17033197" author="erickerickson" created="Sun, 9 Feb 2020 13:21:08 +0000"  >&lt;p&gt;No failures beasting it 1,000 times. This makes me a little nervous, in that those sleeps were put in for a reason. That said, if we run into problems, we can go back in and put in a timer and check the condition every, say, 100 ms rather than stick a sleep in and hope it&apos;s long enough. I usually put a timer in that has unreasonably long upper bound (say 30 seconds) on the theory that I don&apos;t care if the test takes a long time in the (hopefully) rare failure cases.&lt;/p&gt;</comment>
                            <comment id="17034104" author="jira-bot" created="Tue, 11 Feb 2020 03:14:10 +0000"  >&lt;p&gt;Commit 71b869381ef0090a6e96eccbc9924ebdb4f57306 in lucene-solr&apos;s branch refs/heads/master from Mike&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=71b8693&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=71b8693&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14247&quot; title=&quot;IndexSizeTriggerMixedBoundsTest does a lot of sleeping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14247&quot;&gt;&lt;del&gt;SOLR-14247&lt;/del&gt;&lt;/a&gt; Remove unneeded sleeps (#1244)&lt;/p&gt;
</comment>
                            <comment id="17034105" author="mdrob" created="Tue, 11 Feb 2020 03:15:16 +0000"  >&lt;p&gt;Thanks for the additional testing, Erick!&lt;/p&gt;

&lt;p&gt;I committed the changes, if this ends up failing on Jenkins due to less powerful hardware, then we will go back and revisit.&lt;/p&gt;</comment>
                            <comment id="17034466" author="erickerickson" created="Tue, 11 Feb 2020 13:59:17 +0000"  >&lt;p&gt;What I usually do here is set up a mail filter to put any e-mails that mention this test into a special folder, I&apos;ll do that too. There are some false positives there, but it&apos;s manageable.&lt;/p&gt;

&lt;p&gt;I ran a beast session with 12 parallel executors to try to simulate putting a load on the hardware, but that&apos;s a shot in the dark compared to having this out in the real world.&lt;/p&gt;</comment>
                            <comment id="17035588" author="hossman" created="Wed, 12 Feb 2020 18:28:17 +0000"  >&lt;p&gt;Why did this issue modify SolrTestCase.java ? ? ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For reasons i don&apos;t understand, this issue removed the Logger from SolrTestCase &#8211; which (again for reasons i don&apos;t undestand) seems to be causing suite level thread leaks of Log4j AsyncLogger threads from any test that does not define it&apos;s own loggers &#8211; ie: something about how we are using async logging means that any SolrCloudTestCase that doesn&apos;t initialize a logger anywhere will leak a logger thread &#8211; and evidently the SolrCloudTestCase Logger was ensuring this didn&apos;t happen until it was removed by this jira...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As an example, starting with 71b869381ef0090a6e96eccbc9924ebdb4f57306 the trivial &lt;tt&gt;NamedListTest&lt;/tt&gt; fails for me 100% of the time with leaked threads (regardless of seed) ...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=NamedListTest -Dtests.seed=F67D0AB0258C4521 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=yue-Hant -Dtests.timezone=Antarctica/South_Pole -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.00s | NamedListTest (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.common.util.NamedListTest: 
   [junit4]    &amp;gt;    1) Thread[id=16, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-NamedListTest]
   [junit4]    &amp;gt;         at java.base@11.0.4/jdk.internal.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.base@11.0.4/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:234)
   [junit4]    &amp;gt;         at java.base@11.0.4/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2123)
   [junit4]    &amp;gt;         at app//com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at app//com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at app//com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:159)
   [junit4]    &amp;gt;         at app//com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
   [junit4]    &amp;gt;         at java.base@11.0.4/java.lang.Thread.run(Thread.java:834)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([F67D0AB0258C4521]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
   [junit4]    &amp;gt;    1) Thread[id=16, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-NamedListTest]
   [junit4]    &amp;gt;         at java.base@11.0.4/jdk.internal.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.base@11.0.4/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:234)
   [junit4]    &amp;gt;         at java.base@11.0.4/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2123)
   [junit4]    &amp;gt;         at app//com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at app//com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at app//com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:159)
   [junit4]    &amp;gt;         at app//com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
   [junit4]    &amp;gt;         at java.base@11.0.4/java.lang.Thread.run(Thread.java:834)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([F67D0AB0258C4521]:0)
   [junit4] Completed [1/1 (1!)] in 23.32s, 6 tests, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;These failures do not happen w/ b21312f411bdfb069114846f31f45dcc6ec6ecb8 (the prior commit on the master branch) checked out.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17035615" author="jira-bot" created="Wed, 12 Feb 2020 18:51:46 +0000"  >&lt;p&gt;Commit f1fc3e7ba204d7211e9920639fb525d100614886 in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f1fc3e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f1fc3e7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14247&quot; title=&quot;IndexSizeTriggerMixedBoundsTest does a lot of sleeping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14247&quot;&gt;&lt;del&gt;SOLR-14247&lt;/del&gt;&lt;/a&gt;: Revert SolrTestCase Logger removal&lt;/p&gt;</comment>
                            <comment id="17410370" author="markrmiller" created="Mon, 6 Sep 2021 04:27:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;which (again for reasons i don&apos;t undestand) seems to be causing suite level thread leaks of Log4j AsyncLogger threads&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;m going to guess it&apos;s because log4j has not actually been shutdown for years. Which must have bothered me a lot more than anyone else since I must have been annoyed by it and fixed it 3-4 times since then. Though I guess to be fair, when the tests regularly hang out for long periods doing nothing when they are finished, that probably feels like a nice async shutdown much of the time.&lt;/p&gt;</comment>
                            <comment id="17410684" author="markrmiller" created="Mon, 6 Sep 2021 15:33:32 +0000"  >&lt;p&gt;Here it is ...&lt;/p&gt;

&lt;p&gt;This looks for log4j 1.x&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isLog4jActive() {
 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
 &lt;span class=&quot;code-comment&quot;&gt;// Make sure we have log4j LogManager in classpath
&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.log4j.LogManager&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This changes it to look for log4j2.x&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isLog4jActive() {
 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
 &lt;span class=&quot;code-comment&quot;&gt;// Make sure we have log4j LogManager in classpath
&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.LogManager&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17535466" author="janhoy" created="Thu, 12 May 2022 00:26:31 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0b8k0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>