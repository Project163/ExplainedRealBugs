<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:23:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10698] StreamHandler should allow connections to be closed early </title>
                <link>https://issues.apache.org/jira/browse/SOLR-10698</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Before a stream is drained out, if we call close() we get an exception like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;at
org.apache.http.impl.io.ChunkedInputStream.read(ChunkedInputStream.java:215)
at
org.apache.http.impl.io.ChunkedInputStream.close(ChunkedInputStream.java:316)
at
org.apache.http.impl.execchain.ResponseEntityProxy.streamClosed(ResponseEntityProxy.java:128)
at
org.apache.http.conn.EofSensorInputStream.checkClose(EofSensorInputStream.java:228)
at
org.apache.http.conn.EofSensorInputStream.close(EofSensorInputStream.java:174)
at sun.nio.cs.StreamDecoder.implClose(StreamDecoder.java:378)
at sun.nio.cs.StreamDecoder.close(StreamDecoder.java:193)
at java.io.InputStreamReader.close(InputStreamReader.java:199)
at
org.apache.solr.client.solrj.io.stream.JSONTupleStream.close(JSONTupleStream.java:91)
at
org.apache.solr.client.solrj.io.stream.SolrStream.close(SolrStream.java:186)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As quoted from &lt;a href=&quot;https://www.mail-archive.com/solr-user@lucene.apache.org/msg130676.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/solr-user@lucene.apache.org/msg130676.html&lt;/a&gt; the problem seems to when we hit an exception the /steam handler does not close the stream.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13072632">SOLR-10698</key>
            <summary>StreamHandler should allow connections to be closed early </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 May 2017 23:56:51 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:04 +0000</updated>
                            <resolved>Wed, 31 May 2017 03:48:41 +0000</resolved>
                                                    <fixVersion>6.6.1</fixVersion>
                    <fixVersion>7.0</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16016328" author="joel.bernstein" created="Thu, 18 May 2017 19:38:27 +0000"  >&lt;p&gt;I started to dig into this ticket. What I found straight off is that when a client disconnects, the streaming code continues to write data to the outputstream and and an exception is never thrown. The expected behavior would be to receive an org.eclipse.jetty.io.EofException. I&apos;m currently investigating how this could be happening. One possible reason for this is that the exception is being swallowed somewhere in Jetty&apos;s outputstream stack, so that client disconnects don&apos;t throw exceptions. I&apos;ll dig into this and see what I find. &lt;/p&gt;

</comment>
                            <comment id="16017775" author="joel.bernstein" created="Fri, 19 May 2017 18:10:12 +0000"  >&lt;p&gt;Update on this ticket. It turned out the problem had nothing to do with jetty. The issue is that the HttpClient continues to consume the stream even after the inputstream from the httpclient has been closed. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;, noticed the odd looking &lt;b&gt;read&lt;/b&gt; following the &lt;b&gt;close&lt;/b&gt; in the stack trace. This is the ChunkedInputStream close behavior, which is to consume the entire stream when close is called.&lt;/p&gt;

&lt;p&gt;I&apos;ll post a patch shortly that closes the HttpResponse rather then the inputstream. The patch also catches all exceptions that occur while writing to the client and closes the underlying tuple stream. &lt;/p&gt;

&lt;p&gt;The effect of these two changes should be that when the client closes a TupleStream:&lt;/p&gt;

&lt;p&gt;1) The server writing the tuples will get a broken pipe exception and close it&apos;s underlying TupleStream.&lt;br/&gt;
2) This will cause a chain reaction of broken pipes and stream closings that will eventually shut down all streams and stop the /export handler with a broken pipe exception.&lt;/p&gt;

&lt;p&gt;This patch has not yet been tested.&lt;/p&gt;

</comment>
                            <comment id="16017873" author="joel.bernstein" created="Fri, 19 May 2017 19:14:10 +0000"  >&lt;p&gt;In my local testing it looks like the patch resolves the issue. I&apos;ll do some more testing but it looks promising.&lt;/p&gt;</comment>
                            <comment id="16019673" author="jira-bot" created="Mon, 22 May 2017 15:05:51 +0000"  >&lt;p&gt;Commit 02b1c8aa360c8c87bf4cc20b688d7993ec6d7b1b in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=02b1c8a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=02b1c8a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10698&quot; title=&quot;StreamHandler should allow connections to be closed early &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10698&quot;&gt;&lt;del&gt;SOLR-10698&lt;/del&gt;&lt;/a&gt;: StreamHandler should allow connections to be closed early&lt;/p&gt;</comment>
                            <comment id="16019674" author="jira-bot" created="Mon, 22 May 2017 15:05:54 +0000"  >&lt;p&gt;Commit c71ce16bb90c5fc58acbc8f9ee2e74249f11f3ac in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c71ce16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c71ce16&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10698&quot; title=&quot;StreamHandler should allow connections to be closed early &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10698&quot;&gt;&lt;del&gt;SOLR-10698&lt;/del&gt;&lt;/a&gt;: Fix precommit&lt;/p&gt;</comment>
                            <comment id="16019684" author="joel.bernstein" created="Mon, 22 May 2017 15:12:12 +0000"  >&lt;p&gt;There is now a fix for this in master. We should discuss the backporting of this ticket. A couple of things to think about:&lt;/p&gt;

&lt;p&gt;1) Will there be a Lucene/Solr 6.7. Even though 7.0 is imminent I think a 6.7 would be useful for users that will not be able to immediately upgrade to 7.0.&lt;/p&gt;

&lt;p&gt;2) If there is not going to be a 6.7 do we need a bug fix release on 6.6 for this issue.&lt;/p&gt;

&lt;p&gt;3) There may be a need to backport this even further to a build prior to the refactoring for binary transport. If that&apos;s the case then it&apos;s not a straight backport and will involve different classes. We can discuss what classes need to be changed in this scenario.&lt;/p&gt;</comment>
                            <comment id="16019700" author="erickerickson" created="Mon, 22 May 2017 15:24:40 +0000"  >&lt;p&gt;My vote would be to back-port for 6.7. I suspect that there will be one just to wrap up the 6x code line with a bow. If a 6.6.x is released we can back port then I should think if we want.&lt;/p&gt;</comment>
                            <comment id="16019702" author="joel.bernstein" created="Mon, 22 May 2017 15:26:55 +0000"  >&lt;p&gt;+1. This should be a simple backport.&lt;/p&gt;</comment>
                            <comment id="16019713" author="yseeley@gmail.com" created="Mon, 22 May 2017 15:32:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;My vote would be to back-port for 6.7. I suspect that there will be one just to wrap up the 6x code line with a bow. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree - there&apos;s no reason any release needs to be particularly large, so having 6.7 as just a wrap-up release (probably concurrently with 7.0?) makes sense.&lt;/p&gt;</comment>
                            <comment id="16030090" author="erickerickson" created="Tue, 30 May 2017 20:46:04 +0000"  >&lt;p&gt;Grabbed to back-port to 6.7&lt;/p&gt;</comment>
                            <comment id="16030579" author="jira-bot" created="Wed, 31 May 2017 03:48:11 +0000"  >&lt;p&gt;Commit a8db3701e93bca385bf15058c1abdbfd786a88ae in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a8db370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a8db370&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10698&quot; title=&quot;StreamHandler should allow connections to be closed early &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10698&quot;&gt;&lt;del&gt;SOLR-10698&lt;/del&gt;&lt;/a&gt;: StreamHandler should allow connections to be closed early&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 02b1c8a)&lt;/p&gt;</comment>
                            <comment id="16030580" author="jira-bot" created="Wed, 31 May 2017 03:48:15 +0000"  >&lt;p&gt;Commit f9f64a9574d6da18a7395a22ce73c40438899c11 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9f64a9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9f64a9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10698&quot; title=&quot;StreamHandler should allow connections to be closed early &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10698&quot;&gt;&lt;del&gt;SOLR-10698&lt;/del&gt;&lt;/a&gt;: Fix precommit&lt;/p&gt;

&lt;p&gt;(cherry picked from commit c71ce16)&lt;/p&gt;</comment>
                            <comment id="16030840" author="shalinmangar" created="Wed, 31 May 2017 08:36:27 +0000"  >&lt;p&gt;Just for some additional context &amp;#8211; The close method tries to consume the entire stream because if you don&apos;t do that, the connection can no longer be re-used and must be discarded. So in normal cases, this behavior of consuming the stream is a good thing because it allows you the connection to go back to the pool and be reused. But obviously for long running requests that receive huge amounts of data from StreamHandler or ExportHandler, attempting to consume the stream fully on abort is a problem.&lt;/p&gt;</comment>
                            <comment id="16126387" author="varunthacker" created="Mon, 14 Aug 2017 21:01:44 +0000"  >&lt;p&gt;Hi Joel,&lt;/p&gt;

&lt;p&gt;Should we add a CHANGES.txt entry for this?&lt;/p&gt;</comment>
                            <comment id="16127174" author="joel.bernstein" created="Tue, 15 Aug 2017 12:52:05 +0000"  >&lt;p&gt;Yes, let&apos;s add this to CHANGES.txt. I&apos;ll be working on docs and updates to CHANGES for the 7.0 release today. I&apos;ll include this ticket.&lt;/p&gt;</comment>
                            <comment id="16128176" author="jira-bot" created="Wed, 16 Aug 2017 01:10:35 +0000"  >&lt;p&gt;Commit 5786d092545f323c0c13adcb4633d949d08b1bd3 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5786d09&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5786d09&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10698&quot; title=&quot;StreamHandler should allow connections to be closed early &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10698&quot;&gt;&lt;del&gt;SOLR-10698&lt;/del&gt;&lt;/a&gt;: Updated CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16128179" author="jira-bot" created="Wed, 16 Aug 2017 01:13:20 +0000"  >&lt;p&gt;Commit 92f3caf8cfc93b8525895d4d2fa9a2c383b90c08 in lucene-solr&apos;s branch refs/heads/branch_7_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=92f3caf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=92f3caf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10698&quot; title=&quot;StreamHandler should allow connections to be closed early &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10698&quot;&gt;&lt;del&gt;SOLR-10698&lt;/del&gt;&lt;/a&gt;: Updated CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16128180" author="jira-bot" created="Wed, 16 Aug 2017 01:13:43 +0000"  >&lt;p&gt;Commit 39ac9def8529347a3b0c3912b2797f4021ac72cb in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=39ac9de&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=39ac9de&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10698&quot; title=&quot;StreamHandler should allow connections to be closed early &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10698&quot;&gt;&lt;del&gt;SOLR-10698&lt;/del&gt;&lt;/a&gt;: Updated CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16134664" author="jira-bot" created="Mon, 21 Aug 2017 03:21:22 +0000"  >&lt;p&gt;Commit f31c5a2906efb92900bf66373ecdd4d21ba4110e in lucene-solr&apos;s branch refs/heads/branch_6_6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f31c5a2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f31c5a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10698&quot; title=&quot;StreamHandler should allow connections to be closed early &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10698&quot;&gt;&lt;del&gt;SOLR-10698&lt;/del&gt;&lt;/a&gt;: StreamHandler should allow connections to be closed early&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12869022" name="SOLR-10698.patch" size="4529" author="jbernste" created="Fri, 19 May 2017 18:12:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f33j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>