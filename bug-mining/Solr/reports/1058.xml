<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:30:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3875] Document boost does not work correctly when using multi-valued fields</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3875</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In Solr 4 BETA &amp;amp; trunk, document boosts skews the ranking for documents with multi value fields tremendously. A document boost of 5 combined with 15 values in a multi value field results in scores above 1,000,000,000, while a boost of 0,5 results in scores below 0,001. The error is not present in Solr 3.6.&lt;/p&gt;

&lt;p&gt;Thomas Egense and I have tracked it down to a change in Solr DocumentBuilder committed 20110827 (@1162347) by Mike McCandless, as part of work done on &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2308&quot; title=&quot;Separately specify a field&amp;#39;s type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-2308&quot;&gt;&lt;del&gt;LUCENE-2308&lt;/del&gt;&lt;/a&gt;. The problem is that Lucene multiplies the boosts of multiple instances of the same field when updating the index.&lt;/p&gt;

&lt;p&gt;The old DocumentBuilder, used in Lucene 3.6, handled this by calculating the score for the field (docBoost*fieldBoost) and assigning it to the first instance of the field, then setting the boost to 1.0f and assigning that to subsequent instances of the field. This effectively assigned docBoost*fieldBoost to the field, regardless of the number of instances.&lt;/p&gt;

&lt;p&gt;The updated DocumentBuilder (see &lt;a href=&quot;https://svn.apache.org/viewvc/lucene/dev/branches/lucene_solr_4_0/solr/core/src/java/org/apache/solr/update/DocumentBuilder.java?revision=1388778&amp;amp;view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/viewvc/lucene/dev/branches/lucene_solr_4_0/solr/core/src/java/org/apache/solr/update/DocumentBuilder.java?revision=1388778&amp;amp;view=markup&lt;/a&gt;), used in Lucene 4 BETA &amp;amp; trunk, also assigns docBoost*fieldBoost to the first instance of the field. Then it sets fieldBoost = docBoost and continues to assign docBoost*fieldBoost to subsequent instances. Using the example mentioned above, the generated IndexableFields will get assigned boosts of 5, 5*5, 5*5... 5*5. As Lucene multiplies all the values, 15 instances of the same field will have a collective boost of 5*25^14.&lt;/p&gt;

&lt;p&gt;This can be demonstrated with the Solr tutorial example by indexing the sample documents and adding the document &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;add&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc boost=&lt;span class=&quot;code-quote&quot;&gt;&quot;5&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;Insane score Example. Score = 10E9 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;Document boost broken for multivalued fields&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;manu&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;Thomas Egense and Toke Eskildsen&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;manu_id_s&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;Test&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;cat&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;bug&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;insane_boost&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;something else&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/field&amp;gt;&lt;/span&gt;  
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/add&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;em&gt;manu&lt;/em&gt; &amp;amp; &lt;em&gt;features&lt;/em&gt;-fields gets copied to &lt;em&gt;text&lt;/em&gt; and a search for &lt;em&gt;thomas&lt;/em&gt; matches the &lt;em&gt;text&lt;/em&gt;-field with query explanation&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Insane score Example. Score = 10E10 &quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
2.44373361E10 = (MATCH) weight(text:thomas in 0) [DefaultSimilarity], result of:
  2.44373361E10 = fieldWeight in 0, product of:
    1.0 = tf(freq=1.0), with freq of:
      1.0 = termFreq=1.0
    3.2512918 = idf(docFreq=3, maxDocs=38)
    7.5161928E9 = fieldNorm(doc=0)
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thomas and I are too pressed for time to attempt a proper patch at the moment, but we guess that a reversion to the old algorithm of assigning the combined boost to the first instance and 1.0f to all subsequent instances would work?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608868">SOLR-3875</key>
            <summary>Document boost does not work correctly when using multi-valued fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="toke">Toke Eskildsen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Sep 2012 13:39:42 +0000</created>
                <updated>Mon, 9 May 2016 18:48:50 +0000</updated>
                            <resolved>Mon, 24 Sep 2012 23:54:47 +0000</resolved>
                                    <version>4.0-BETA</version>
                                    <fixVersion>4.0</fixVersion>
                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                    <component>update</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13461850" author="janhoy" created="Mon, 24 Sep 2012 15:14:41 +0000"  >&lt;p&gt;Upgrading to Critical. I seldom use document boosts, but could be a showstopper for some people upgrading.&lt;/p&gt;

&lt;p&gt;If a fix is not included, the release notes should mention it as a known bug and fix in next release.&lt;/p&gt;</comment>
                            <comment id="13462075" author="hossman" created="Mon, 24 Sep 2012 20:15:54 +0000"  >&lt;p&gt;patch with proposed test &amp;amp; fix ... i&apos;m still running the full test sweet, but posting here for other folks to review early.&lt;/p&gt;</comment>
                            <comment id="13462080" author="hossman" created="Mon, 24 Sep 2012 20:18:33 +0000"  >&lt;p&gt;removing 4.0-beta from the fix version (we don&apos;t go back in time) and any affects versions that are in the future&lt;/p&gt;</comment>
                            <comment id="13462096" author="yseeley@gmail.com" created="Mon, 24 Sep 2012 20:39:41 +0000"  >&lt;p&gt;+1, fix looks good!&lt;/p&gt;</comment>
                            <comment id="13462105" author="markrmiller@gmail.com" created="Mon, 24 Sep 2012 20:48:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;patch with proposed test &amp;amp; fix &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I applied the patch, inspected the fix, inspected the test. It looks right to me.&lt;/p&gt;

&lt;p&gt;I also ran all tests, and verified the new test fails as expected without the fix.&lt;/p&gt;</comment>
                            <comment id="13462115" author="mikemccand" created="Mon, 24 Sep 2012 20:56:20 +0000"  >&lt;p&gt;Thanks Hoss, patch looks great!&lt;/p&gt;</comment>
                            <comment id="13462191" author="hossman" created="Mon, 24 Sep 2012 22:14:33 +0000"  >&lt;p&gt;ok ... planning to commit &amp;amp; backport for 4.0 respin (or 4.0.1), bear with me while i test on every branch&lt;/p&gt;</comment>
                            <comment id="13462199" author="hossman" created="Mon, 24 Sep 2012 22:23:09 +0000"  >&lt;p&gt;Committed revision 1389628. - trunk&lt;/p&gt;</comment>
                            <comment id="13462210" author="hossman" created="Mon, 24 Sep 2012 22:37:40 +0000"  >&lt;p&gt;Committed revision 1389636. -4x&lt;/p&gt;</comment>
                            <comment id="13462224" author="rcmuir" created="Mon, 24 Sep 2012 22:50:04 +0000"  >&lt;p&gt;Is it possible we can improve tests somehow in this area? &lt;/p&gt;

&lt;p&gt;Both Mike and I have been ensnared by this file recently and introduced sneaky bugs.&lt;/p&gt;

&lt;p&gt;Additional tests showing we didnt introduce any regressions (especially with the crazy field types) would make me very happy.&lt;br/&gt;
Additional tests that just make this less fragile would be very good for the future.&lt;/p&gt;</comment>
                            <comment id="13462243" author="hossman" created="Mon, 24 Sep 2012 23:16:16 +0000"  >&lt;p&gt;Committed revision 1389648. - 4.0&lt;/p&gt;</comment>
                            <comment id="13462272" author="hossman" created="Mon, 24 Sep 2012 23:54:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it possible we can improve tests somehow in this area? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m open to suggestsion, but i&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3885&quot; title=&quot;audit solr DocumentBuilder logic &amp;amp; tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3885&quot;&gt;SOLR-3885&lt;/a&gt; to track it since we&apos;ve already good a well vetted test for this specific problem commited and on track for a 4.0 respin.&lt;/p&gt;

&lt;p&gt;If other good tests pop up in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3885&quot; title=&quot;audit solr DocumentBuilder logic &amp;amp; tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3885&quot;&gt;SOLR-3885&lt;/a&gt; before 4.0 final then we can certainly commit them, but it&apos;s not an area i&apos;m likely to be focusing much attention right now.&lt;/p&gt;</comment>
                            <comment id="13462568" author="thomas_egense" created="Tue, 25 Sep 2012 08:39:16 +0000"  >&lt;p&gt;Thank you for the fast response and fix! Great job.&lt;/p&gt;</comment>
                            <comment id="13462661" author="mikemccand" created="Tue, 25 Sep 2012 11:29:35 +0000"  >&lt;p&gt;Thanks Hoss.&lt;/p&gt;</comment>
                            <comment id="13482233" author="toke" created="Tue, 23 Oct 2012 09:43:07 +0000"  >&lt;p&gt;Unfortunately, the bug is only partly solved. Thomas and I encountered strange scores again. While boosting of multi-value fields is handled correctly in Solr 4.0.0, boosting for copyFields are not. A sample document:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   &amp;lt;add&amp;gt;&amp;lt;doc boost=&lt;span class=&quot;code-quote&quot;&gt;&quot;10.0&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;Insane score Example. Score = 10E9 &amp;lt;/field&amp;gt;
  &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;&amp;gt;Document boost broken &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; copyFields&amp;lt;/field&amp;gt;
  &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;manu&quot;&lt;/span&gt; &amp;gt;video ThomasEgense and Toke Eskildsen&amp;lt;/field&amp;gt;
  &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;manu_id_s&quot;&lt;/span&gt;&amp;gt;Test&amp;lt;/field&amp;gt;
  &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;cat&quot;&lt;/span&gt;&amp;gt;bug&amp;lt;/field&amp;gt;
  &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;&amp;gt;something &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;&amp;lt;/field&amp;gt;
  &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;keywords&quot;&lt;/span&gt;&amp;gt;bug&amp;lt;/field&amp;gt;
  &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;content&quot;&lt;/span&gt;&amp;gt;bug&amp;lt;/field&amp;gt;
  &amp;lt;/doc&amp;gt;&amp;lt;/add&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The fields &lt;em&gt;name&lt;/em&gt;, &lt;em&gt;manu&lt;/em&gt;, &lt;em&gt;cat&lt;/em&gt;, &lt;em&gt;features&lt;/em&gt;, keywords and &lt;em&gt;content&lt;/em&gt; gets copied to text and a search for thomasegense matches the text-field with query explanation&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;70384.67 = (MATCH) weight(text:thomasegense in 0) [DefaultSimilarity], result of:
  70384.67 = fieldWeight in 0, product of:
    1.0 = tf(freq=1.0), with freq of:
      1.0 = termFreq=1.0
    0.30685282 = idf(docFreq=1, maxDocs=1)
    229376.0 = fieldNorm(doc=0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the two last fields &lt;em&gt;keywords&lt;/em&gt; and &lt;em&gt;content&lt;/em&gt; are removed from the sample document, the score is reduced by a factor 100 (docBoost^2).&lt;/p&gt;

&lt;p&gt;The current DocumentBuilder &lt;a href=&quot;https://svn.apache.org/viewvc/lucene/dev/branches/lucene_solr_4_0/solr/core/src/java/org/apache/solr/update/DocumentBuilder.java?revision=1389648&amp;amp;view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/viewvc/lucene/dev/branches/lucene_solr_4_0/solr/core/src/java/org/apache/solr/update/DocumentBuilder.java?revision=1389648&amp;amp;view=markup&lt;/a&gt; works roughly like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;foreach (field) {
  boost = docBoost*fieldBoost
  foreach (value) {
    assignField(field, value, boost)
    foreach (copyField) {
      assignField(copyField, value, boost)
    }
    boost = 1f
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When all fields share the same copyField (&lt;em&gt;text&lt;/em&gt; in this example), the copyField will have the full boost assigned for each directly specified field which uses that copyField. That&apos;s 5 times with the provided sample, so the total boost for the field &lt;em&gt;text&lt;/em&gt; will be 10^5.&lt;/p&gt;

&lt;p&gt;One solution would be to keep track of used fields (directly specified as well as copyFields) and only assign the full boost once per document. If the number of unique fields/document is low, a simple list would probably be the fastest and with low GC impact. For a higher number of unique fields, a Set might be better. An optimization would be to only create the tracking structure once a boost != 1.0f is encountered and only store the fields with boost != 1.0f, so that an update without boosts would not get a performance penalty.&lt;/p&gt;</comment>
                            <comment id="13482746" author="hossman" created="Tue, 23 Oct 2012 22:11:33 +0000"  >&lt;p&gt;Toke: thanks for following up - too bad we didn&apos;t catch this other problem before 4.0.&lt;/p&gt;

&lt;p&gt;I&apos;ve spun off &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3981&quot; title=&quot;docBoost is compounded on copyField&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3981&quot;&gt;&lt;del&gt;SOLR-3981&lt;/del&gt;&lt;/a&gt; to work on this since &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3875&quot; title=&quot;Document boost does not work correctly when using multi-valued fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3875&quot;&gt;&lt;del&gt;SOLR-3875&lt;/del&gt;&lt;/a&gt; is already resolved and listed as fixed in 4.0 (we can&apos;t (sanely) re-open issues that were recorded in CHANGES.txt for official releases since it would leave users confused as to what parts of those issues were resolved in each version)&lt;/p&gt;</comment>
                            <comment id="13610769" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:33:56 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1389636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1389636&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3875&quot; title=&quot;Document boost does not work correctly when using multi-valued fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3875&quot;&gt;&lt;del&gt;SOLR-3875&lt;/del&gt;&lt;/a&gt;: Fixed index boosts on multi-valued fields when docBoost is used (merge r1389628)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12608945">SOLR-3885</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12613206">SOLR-3981</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12546368" name="SOLR-3875.patch" size="4335" author="hossman" created="Mon, 24 Sep 2012 20:15:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243121</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03c4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17398</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>