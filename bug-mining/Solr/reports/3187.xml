<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:18:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9843] DocValuesNotIndexedTest failures indicating exepected documents aren&apos;t found</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9843</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I&apos;ll have to do a few iterations on the Jenkins builds since I can&apos;t get this to fail locally. Marking as &quot;blocker&quot; since I&apos;ll probably have to put some extra code in that I want to be sure is removed before we cut any new releases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13027211">SOLR-9843</key>
            <summary>DocValuesNotIndexedTest failures indicating exepected documents aren&apos;t found</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Sat, 10 Dec 2016 19:15:00 +0000</created>
                <updated>Thu, 12 May 2022 00:26:14 +0000</updated>
                            <resolved>Fri, 22 Feb 2019 21:21:13 +0000</resolved>
                                                    <fixVersion>8.1</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15738559" author="jira-bot" created="Sat, 10 Dec 2016 22:03:32 +0000"  >&lt;p&gt;Commit d75abe1a3022b5d596b7fca4c7e8623782010a88 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d75abe1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d75abe1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9843&quot; title=&quot;DocValuesNotIndexedTest failures indicating exepected documents aren&amp;#39;t found&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9843&quot;&gt;&lt;del&gt;SOLR-9843&lt;/del&gt;&lt;/a&gt;: Fix up DocValuesNotIndexedTest failures. Debugging code&lt;/p&gt;</comment>
                            <comment id="15738573" author="jira-bot" created="Sat, 10 Dec 2016 22:12:48 +0000"  >&lt;p&gt;Commit 9096d4cb2a8064acdc214e51c817ce669033c524 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9096d4c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9096d4c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9843&quot; title=&quot;DocValuesNotIndexedTest failures indicating exepected documents aren&amp;#39;t found&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9843&quot;&gt;&lt;del&gt;SOLR-9843&lt;/del&gt;&lt;/a&gt;: Fix up DocValuesNotIndexedTest failures. Debugging code&lt;/p&gt;

&lt;p&gt;(cherry picked from commit d75abe1a3022b5d596b7fca4c7e8623782010a88)&lt;/p&gt;</comment>
                            <comment id="15738576" author="erickerickson" created="Sat, 10 Dec 2016 22:14:14 +0000"  >&lt;p&gt;Patch for debugging. There&apos;s nothing here that couldn&apos;t be in production so I&apos;ll check it in to both trunk and 6x so it&apos;ll (I hope) hit the failure mode faster.&lt;/p&gt;

&lt;p&gt;One failure is &quot;impossible&quot;. The test indexes 4 docs, commits and then does a &lt;b&gt;:&lt;/b&gt; query which only finds three docs. The message is &quot;Should have exactly 4 documents returned expected:&amp;lt;4&amp;gt; but was:&amp;lt;3&amp;gt;&quot;. (line 263 called from line 244 after the patch is applied). The process is&lt;br/&gt;
1&amp;gt; in @Before, DBQ on &lt;b&gt;:&lt;/b&gt; and commit&lt;br/&gt;
2&amp;gt; add some docs&lt;br/&gt;
3&amp;gt; test.&lt;/p&gt;

&lt;p&gt;Now the document IDs are re-used so I&apos;m wondering if it&apos;s vaguely possible that we&apos;re somehow (tm) DBQ is partly at issue? Hmmm, I&apos;ll write a stressor for that one just for yucks.&lt;/p&gt;

&lt;p&gt;I did incorporate David&apos;s suggestions, and there was one initialization issue that I dont&apos;t &lt;em&gt;think&lt;/em&gt; matters that I changed. None of those changes seems like it even could be related to the &quot;impossible&quot; test failure above, which just means I must be missing something.&lt;/p&gt;</comment>
                            <comment id="15742595" author="erickerickson" created="Mon, 12 Dec 2016 17:55:06 +0000"  >&lt;p&gt;Attaching triage of the output from Jenkins. The difficult bit is that shard3_replica 1 apparently gets 2 docs added (2,3) but then only returns 1 if them (id=2). From what I see, the sequence of events is fine.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fail.txt is the snippet around this test from the failure on Jenkins (Windows 32 bit). I &lt;em&gt;think&lt;/em&gt; I&apos;ve seen Jenkins failures on OS X, but don&apos;t have the record now.&lt;/li&gt;
	&lt;li&gt;shard3_replica1.txt is all the mentions of shard3_replica1 from fail.txt&lt;/li&gt;
	&lt;li&gt;shard_3_searchers.txt shows all of the searchers opening from shard3_replica1.txt.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here&apos;s the sequence in the test:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the DBQ of &lt;tt&gt;&lt;b&gt;:&lt;/b&gt;&lt;/tt&gt; happens in @Before&lt;/li&gt;
	&lt;li&gt;commit happens in @Before&lt;/li&gt;
	&lt;li&gt;the update for docs 2 and 3 going to shard3_replica1 happens&lt;/li&gt;
	&lt;li&gt;commit happens&lt;/li&gt;
	&lt;li&gt;a new searcher is opened&lt;/li&gt;
	&lt;li&gt;a &lt;b&gt;:&lt;/b&gt; query goes to shard3_replica1&lt;/li&gt;
	&lt;li&gt;shard3_replica1 only returns doc 2 (ids=2).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I looked at successful tests and the &quot;expected&quot; thing happens, i.e. shard3_replica1 &lt;b&gt;:&lt;/b&gt; returns ids=2,3&lt;/p&gt;

&lt;p&gt;So this looks like something that&apos;s not just an artifact of this test, nor something reproducible with the seeds. Maybe something fundamental to Solr, maybe something in the test framework. Maybe a race condition. Maybe I&apos;m hallucinating.&lt;/p&gt;

&lt;p&gt;I&apos;m starting to think this test exposes some race condition that&apos;s been lurking in the code for a while. There&apos;s a user&apos;s list question about not returning docs that may be relevant too, the title is &quot;empty result set for a sort query&quot; from moscovig that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; responded to.&lt;/p&gt;</comment>
                            <comment id="15746185" author="jira-bot" created="Tue, 13 Dec 2016 20:30:21 +0000"  >&lt;p&gt;Commit d75abe1a3022b5d596b7fca4c7e8623782010a88 in lucene-solr&apos;s branch refs/heads/feature/metrics from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d75abe1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d75abe1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9843&quot; title=&quot;DocValuesNotIndexedTest failures indicating exepected documents aren&amp;#39;t found&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9843&quot;&gt;&lt;del&gt;SOLR-9843&lt;/del&gt;&lt;/a&gt;: Fix up DocValuesNotIndexedTest failures. Debugging code&lt;/p&gt;</comment>
                            <comment id="15773464" author="erickerickson" created="Fri, 23 Dec 2016 18:48:00 +0000"  >&lt;p&gt;I haven&apos;t seen any test failures lately. Nothing in the extra logging I checked in &quot;should have changed anything&quot;. Given what I found earlier, I don&apos;t think the test failures were either a problem with the test or the code.&lt;/p&gt;

&lt;p&gt;So I&apos;ll wave my hands and say &quot;something someone else fixed must have fixed the underlying problem&quot;. If there aren&apos;t any failures by Jan I&apos;ll just take out the extra logging and close this.&lt;/p&gt;

&lt;p&gt;Probably take out the system variable restore rule since it&apos;s apparently unnecessary too.&lt;/p&gt;</comment>
                            <comment id="15786654" author="erickerickson" created="Fri, 30 Dec 2016 02:11:36 +0000"  >&lt;p&gt;Removed extraneous logging.&lt;/p&gt;</comment>
                            <comment id="15786656" author="jira-bot" created="Fri, 30 Dec 2016 02:12:14 +0000"  >&lt;p&gt;Commit f6a3557ee287868fc864182ff5d2023542e29d0c in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f6a3557&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f6a3557&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9843&quot; title=&quot;DocValuesNotIndexedTest failures indicating exepected documents aren&amp;#39;t found&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9843&quot;&gt;&lt;del&gt;SOLR-9843&lt;/del&gt;&lt;/a&gt; Fix up DocValuesNotIndexedTest failures&lt;/p&gt;</comment>
                            <comment id="15786661" author="jira-bot" created="Fri, 30 Dec 2016 02:14:47 +0000"  >&lt;p&gt;Commit 3ccd15a7658ad2821e8a2d2916781265db6f3afe in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3ccd15a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3ccd15a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9843&quot; title=&quot;DocValuesNotIndexedTest failures indicating exepected documents aren&amp;#39;t found&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9843&quot;&gt;&lt;del&gt;SOLR-9843&lt;/del&gt;&lt;/a&gt; Fix up DocValuesNotIndexedTest failures&lt;br/&gt;
(cherry picked from commit f6a3557)&lt;/p&gt;</comment>
                            <comment id="15786663" author="erickerickson" created="Fri, 30 Dec 2016 02:16:36 +0000"  >&lt;p&gt;OK, it&apos;s not January, but it&apos;s close enough. Given that the situation is &quot;impossible&quot;, this appears to be a test artifact and/or something fixed by someone else.&lt;/p&gt;

&lt;p&gt;Somehow I committed this to 6x &lt;em&gt;then&lt;/em&gt; trunk, but I doubt it matters.&lt;/p&gt;</comment>
                            <comment id="16078903" author="hossman" created="Sat, 8 Jul 2017 01:55:14 +0000"  >&lt;p&gt;I&apos;m re-opening this issue since the underlying test failures are still possible - the existing log files attached show the same pattern as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11035&quot; title=&quot;(at least) 2 distinct failures possible when clients attempt searches during SolrCore reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11035&quot;&gt;&lt;del&gt;SOLR-11035&lt;/del&gt;&lt;/a&gt;, with the SolrCore reloads triggered by the Schema API usage to add the fields (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11034&quot; title=&quot;Redundent/Unneccessary SolrCore reload when ManagedIndexSchema changes are made in cloud mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11034&quot;&gt;SOLR-11034&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;ve updated the summary to note the type of failure that can .&lt;/p&gt;</comment>
                            <comment id="16079682" author="hossman" created="Sun, 9 Jul 2017 18:21:38 +0000"  >&lt;p&gt;whoops ... thought i reopened this the other day?&lt;/p&gt;</comment>
                            <comment id="16079718" author="erickerickson" created="Sun, 9 Jul 2017 20:55:31 +0000"  >&lt;p&gt;Seems like it may well be related. At any rate, when any fix for any of these is ready to be tested we should test them all.&lt;/p&gt;</comment>
                            <comment id="16625922" author="erickerickson" created="Mon, 24 Sep 2018 14:51:58 +0000"  >&lt;p&gt;This is at least in the right ball park, I have no evidence that these are the same issue. Mostly marking this in case 10110 gets fixed and this test&#160;stops failing.&lt;/p&gt;

&lt;p&gt;Hoss&apos; rollups still show this test failing (2018-09-18)&#160;&lt;/p&gt;</comment>
                            <comment id="16775620" author="erickerickson" created="Fri, 22 Feb 2019 21:21:13 +0000"  >&lt;p&gt;This hasn&apos;t failed in the last 6 weeks, and I couldn&apos;t get it to fail in 1,000 runs. So closing for now, I&apos;ll be monitoring build failures to see if it recurs.&lt;/p&gt;</comment>
                            <comment id="17535301" author="janhoy" created="Thu, 12 May 2022 00:26:14 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13085638">SOLR-11035</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="13041760">SOLR-10110</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13085637">SOLR-11034</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13066459">SOLR-10562</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12845139" name="SOLR-9843.patch" size="1985" author="erickerickson" created="Fri, 30 Dec 2016 02:11:36 +0000"/>
                            <attachment id="12842682" name="SOLR-9843.patch" size="9653" author="erickerickson" created="Sat, 10 Dec 2016 22:14:14 +0000"/>
                            <attachment id="12842833" name="fail.txt" size="86866" author="erickerickson" created="Mon, 12 Dec 2016 17:55:06 +0000"/>
                            <attachment id="12842834" name="shard3_replica1.txt" size="25532" author="erickerickson" created="Mon, 12 Dec 2016 17:55:06 +0000"/>
                            <attachment id="12842832" name="shard_3_searchers.txt" size="3836" author="erickerickson" created="Mon, 12 Dec 2016 17:55:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37fvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>