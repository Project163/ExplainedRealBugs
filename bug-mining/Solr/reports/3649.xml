<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:28:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11297] Message &quot;Lock held by this virtual machine&quot; during startup.  Solr is trying to start some cores twice</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11297</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Sometimes when Solr is restarted, I get some &quot;lock held by this virtual machine&quot; messages in the log, and the admin UI has messages about a failure to open a new searcher.  It doesn&apos;t happen on all cores, and the list of cores that have the problem changes on subsequent restarts.  The cores that exhibit the problems are working just fine &amp;#8211; the first core load is successful, the failure to open a new searcher is on a second core load attempt, which fails.&lt;/p&gt;

&lt;p&gt;None of the cores in the system are sharing an instanceDir or dataDir.  This has been verified several times.&lt;/p&gt;

&lt;p&gt;The index is sharded manually, and the servers are not running in cloud mode.&lt;/p&gt;

&lt;p&gt;One critical detail to this issue: The cores are all perfectly functional.  If somebody is seeing an error message that results in a core not working at all, then it is likely a different issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13098406">SOLR-11297</key>
            <summary>Message &quot;Lock held by this virtual machine&quot; during startup.  Solr is trying to start some cores twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="elyograg">Shawn Heisey</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Aug 2017 22:28:37 +0000</created>
                <updated>Tue, 15 Dec 2020 05:51:49 +0000</updated>
                            <resolved>Mon, 25 Sep 2017 20:05:09 +0000</resolved>
                                    <version>6.6</version>
                                    <fixVersion>6.6.2</fixVersion>
                    <fixVersion>7.0.1</fixVersion>
                    <fixVersion>7.1</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="16146255" author="elyograg" created="Tue, 29 Aug 2017 22:29:45 +0000"  >&lt;p&gt;Attaching a solr logfile showing the most recent startup.  The &quot;s1live&quot; and &quot;spark5live&quot; cores have logged the problem message.&lt;/p&gt;</comment>
                            <comment id="16146353" author="erickerickson" created="Tue, 29 Aug 2017 23:45:29 +0000"  >&lt;p&gt;I have some anecdotal evidence that specifying&lt;br/&gt;
&amp;lt;writeLockTimeout&amp;gt;5000&amp;lt;/writeLockTimeout&amp;gt;&lt;br/&gt;
in solrconfig.xml (the time is an estimate) will make this problem go away. That&apos;s not a proper fix, but if anyone interested in this JIRA could test it and report it&apos;d help track this down.&lt;/p&gt;
</comment>
                            <comment id="16147529" author="elyograg" created="Wed, 30 Aug 2017 16:15:10 +0000"  >&lt;p&gt;With the writeLockTimeout setting inside indexConfig, problem still happened.  Just in case that was the wrong place, I also added it to the top level of solrconfig.xml, still no change.&lt;/p&gt;</comment>
                            <comment id="16147549" author="elyograg" created="Wed, 30 Aug 2017 16:28:55 +0000"  >&lt;p&gt;I found &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-6525&quot; title=&quot;Deprecate IndexWriterConfig&amp;#39;s write lock timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-6525&quot;&gt;&lt;del&gt;LUCENE-6525&lt;/del&gt;&lt;/a&gt;, and so far I haven&apos;t found any evidence to indicate that the writeLockTimeout value actually gets &lt;b&gt;used&lt;/b&gt; for anything (currently have branch_7_0 checked out).&lt;/p&gt;</comment>
                            <comment id="16147624" author="erickerickson" created="Wed, 30 Aug 2017 17:14:03 +0000"  >&lt;p&gt;Hmmmm, on a quick look I don&apos;t see it either. I was looking at this in 6x. I&apos;ll look further. There&apos;s a hint in the test where there&apos;s something about: getters.add(&quot;getWriteLockTimeout&quot;);&lt;/p&gt;

&lt;p&gt;Anyone have a clue?&lt;/p&gt;

&lt;p&gt;Erick&lt;/p&gt;</comment>
                            <comment id="16151045" author="erickerickson" created="Fri, 1 Sep 2017 19:23:33 +0000"  >&lt;p&gt;I poked around a little more and &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-6525&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-6525&lt;/a&gt; started the deprecation process for writeLockTimeout.  Most of the references to it were removed in 7x and even 6x doesn&apos;t use it for all it can be set. In master there&apos;s still a single reference in a test... I&apos;ve pinged the dev list about whether we should remove them all.&lt;/p&gt;

&lt;p&gt;But the net-net is that changing that in any 7x version and even 6x doesn&apos;t use it (didn&apos;t check early 6 versions, just current 6x). I was looking at 5x code when I saw it had an effect.&lt;/p&gt;

&lt;p&gt;So it&apos;s no surprise that it didn&apos;t have any effect for you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg&quot; class=&quot;user-hover&quot; rel=&quot;elyograg&quot;&gt;elyograg&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Anyway, that was just to see if you were seeing something I was looking at in 5x to see how pervasive this was as I was starting to dig as to why it is happening. The JIRA talks about using SleepingLockWrapper, but that&apos;s not exposed in Solr at this point and I don&apos;t see any point in exposing it for this problem since it&apos;s a band-aid not a proper fix.&lt;/p&gt;

&lt;p&gt;Sorry for the misdirection&lt;/p&gt;

&lt;p&gt;Erick&lt;/p&gt;</comment>
                            <comment id="16151118" author="elyograg" created="Fri, 1 Sep 2017 20:45:35 +0000"  >&lt;p&gt;Repeating something I said on the mailing list, and expanding on it:&lt;/p&gt;

&lt;p&gt;I have never seen messages for this problem on my &quot;build&quot; cores or my &quot;broker&quot; cores, only on &quot;live&quot; cores.  The build cores are used for full index rebuilds and then swapped with live cores.  They do not receive any requests unless a (rare) full index rebuild is underway.  Because full index rebuilds involve DIH, the build cores are almost never getting requests (other than DIH status requests) after a Solr restart. The broker cores have the shards parameter in the request handler &quot;defaults&quot; section, so clients do not need to know that they are accessing a distributed index.&lt;/p&gt;

&lt;p&gt;I think there may be a race condition.  Best idea is that it starts when the core opens its searcher (or possibly slightly offset from that moment), and ends when the core is fully functional.  If requests are received for the index during that timeframe, it appears to cause Solr to try to create the core again.  The second creation fails because the first is already underway and has opened a searcher.  In my case, it only seems to affect shard requests, but this might simply be a result of the fact that requests to the broker cores don&apos;t involve the local index in that core (which is empty), only indexes on the shard cores.&lt;/p&gt;

&lt;p&gt;I typically see &quot;Lock held&quot; messages in the log for more cores than are shown in the admin UI as having failed to start, and sometimes the message appears MANY times for one core.  I think there is an example of that in the log that I attached to the issue.&lt;/p&gt;</comment>
                            <comment id="16151125" author="elyograg" created="Fri, 1 Sep 2017 20:48:51 +0000"  >&lt;p&gt;If you would like me to build a special 6.6 version with extra logging to try and pinpoint the problem, give me a patch and I can do that.  The system with the problem is my dev server, I can fiddle with it.&lt;/p&gt;</comment>
                            <comment id="16169349" author="odie3" created="Sun, 17 Sep 2017 16:43:06 +0000"  >&lt;p&gt;I think my issue ( &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11361&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-11361&lt;/a&gt; ) is basically a duplicate of this reported issue.  In my testing I can shut my Solr/Core down (I only have one) and then bring it up on a new port number and there are no locking errors.  If I close Solr/Core again and go to the original port number the lock error is back.  Lastly, I think if I just close Solr/Core and wait a fair amount of time, the lock error goes away.&lt;/p&gt;

&lt;p&gt;I updated from 6.2.1 to 6.6.1 last night (and long ago on 4.10 before that).  I then moved down to 6.6.0 and while I get the lock error, the core is operational (6.6.1 is will not even show in the drop down for cores once the lock error kicks in).&lt;/p&gt;</comment>
                            <comment id="16170301" author="niqbal" created="Mon, 18 Sep 2017 17:03:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg&quot; class=&quot;user-hover&quot; rel=&quot;elyograg&quot;&gt;elyograg&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
I am curious about how frequently this behavior is reproducible. Is rest of the world running 6.6.1 totally fine and only 4 of us seeing this issue?&lt;br/&gt;
I see &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-7959&quot; title=&quot;Throw more helpful error messages from failures in obtainFSLock, at least in NativeFSLockFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-7959&quot;&gt;&lt;del&gt;LUCENE-7959&lt;/del&gt;&lt;/a&gt; was fixed to give a better error, however in my case the file is actually getting created so I am not hitting the permission issue. One way to debug will be to downgrade to an earlier version and try to reproduce the error. Can someone suggest which version should I start with? &lt;/p&gt;</comment>
                            <comment id="16170333" author="odie3" created="Mon, 18 Sep 2017 17:23:03 +0000"  >&lt;p&gt;I can say for my test bed using 6.6.0 / 6.6.1 it&apos;s pretty reproducible.  I am running Windows 10 1703 for my testing.  I go back to 6.2.1 and it stable as a rock.&lt;/p&gt;

&lt;p&gt;When the problem kicks in, all I have to do is shutdown Solr and restart it on a different port and it loads up fine.  Then I shutdown for a bit of time and I can then restart on the port that I really want Solr running on.&lt;/p&gt;</comment>
                            <comment id="16170355" author="elyograg" created="Mon, 18 Sep 2017 17:26:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=niqbal&quot; class=&quot;user-hover&quot; rel=&quot;niqbal&quot;&gt;niqbal&lt;/a&gt;, Every time I restart 6.6.0, I see the problem described in this issue.&lt;/p&gt;

&lt;p&gt;Version 6.6.1 may have a separate issue in addition to this issue, described in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11361&quot; title=&quot;After Restarting Solr 6.6.1 Seems to cause Error if Application is Reading/Writing?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11361&quot;&gt;&lt;del&gt;SOLR-11361&lt;/del&gt;&lt;/a&gt;.  I saw a similar message in the logs with 6.6.2-SNAPSHOT, and in that version, some of my cores that do not work at all.  For the problem I have described here, every core actually works, I just get annoying notifications in the admin UI and errors in the log.&lt;/p&gt;</comment>
                            <comment id="16170402" author="elyograg" created="Mon, 18 Sep 2017 18:01:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;, the release notes for 6.6.1 indicate a bunch of changes in that version on the creation, loading, and reloading of cores.  Those changes look like yours.  With all the current and past work you&apos;ve done on core loading, I think you&apos;re in the best position to understand the code.&lt;/p&gt;

&lt;p&gt;The problem I have reported on this issue isn&apos;t a &quot;real&quot; problem, because it doesn&apos;t affect usability at all, just logging ... but 6.6.1 seems to have a separate (and very real) problem.&lt;/p&gt;</comment>
                            <comment id="16170411" author="elyograg" created="Mon, 18 Sep 2017 18:10:37 +0000"  >&lt;p&gt;Minor correction to that last statement: 6.6.1 seems to have a &quot;real&quot; problem, which may or may not be related to this problem.&lt;/p&gt;</comment>
                            <comment id="16170429" author="odie3" created="Mon, 18 Sep 2017 18:18:08 +0000"  >&lt;p&gt;agreed.  6.6.0 seems to load my core okay - even though WebGUI has &lt;span class=&quot;error&quot;&gt;&amp;#91;Red&amp;#93;&lt;/span&gt; Fault errors for me.  Which that is enough for me not to use 6.6.0 as a Production candidate.&lt;/p&gt;</comment>
                            <comment id="16170618" author="erickerickson" created="Mon, 18 Sep 2017 20:20:56 +0000"  >&lt;p&gt;Possibly related, we need to check when we address this.&lt;/p&gt;</comment>
                            <comment id="16172145" author="luiz.armesto" created="Tue, 19 Sep 2017 18:37:22 +0000"  >&lt;p&gt;I&apos;ve been working on this issue for a few days now. The problem occurs when you start making requests (e.g. ping) before the cores are completely loaded. In this scenario two threads try to load the same core at the same time, one executing `CoreContainer#load` as part of Solr init process and another executing `CoreContainer#getCore` to respond the HTTP request.&lt;/p&gt;

&lt;p&gt;The `getCore` method uses the `waitAddPendingCoreOps` method to wait pending core operations before trying to create the core if it isn&apos;t loaded. That&apos;s OK. But the `load` method doesn&apos;t put an entry in pending core ops before it tries to create the core.&lt;/p&gt;

&lt;p&gt;The solution is to surround the call to the method `createFromDescriptor` with `waitAddPendingCoreOps` and `removeFromPendingOps`.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a shell script showing how to reproduce this issue and a draft patch adding the missing methods calls. I tried to write an unit test but I couldn&apos;t figure out how to handle the execution of two or more threads to make sure the test is deterministic.&lt;/p&gt;</comment>
                            <comment id="16172156" author="odie3" created="Tue, 19 Sep 2017 18:43:09 +0000"  >&lt;p&gt;So it&apos;s possible my &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11361&quot; title=&quot;After Restarting Solr 6.6.1 Seems to cause Error if Application is Reading/Writing?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11361&quot;&gt;&lt;del&gt;SOLR-11361&lt;/del&gt;&lt;/a&gt; is a real issue?  That Jan fellow made me feel a little dumb, though to be honest I likely did not write up my issue properly (as it was my 1st one here on this site).&lt;/p&gt;</comment>
                            <comment id="16172236" author="elyograg" created="Tue, 19 Sep 2017 19:45:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=luiz.armesto&quot; class=&quot;user-hover&quot; rel=&quot;luiz.armesto&quot;&gt;luiz.armesto&lt;/a&gt;, I don&apos;t see the code that you&apos;ve patched in CoreContainer.java in the 6.6.0 release tag checkout.  I can&apos;t figure out in that branch where to apply your changes.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Odie3&quot; class=&quot;user-hover&quot; rel=&quot;Odie3&quot;&gt;Odie3&lt;/a&gt;, if any of your cores will not function once Solr has finished its startup work, but did work before the restart, then I do not think the problem is this issue.  On my server where I have this problem, every single core works, even though the admin UI and the log claim that some of the cores didn&apos;t initialize correctly.&lt;/p&gt;</comment>
                            <comment id="16172243" author="elyograg" created="Tue, 19 Sep 2017 19:50:28 +0000"  >&lt;p&gt;By switching to master briefly, finding the code, and then switching back to the 6.6.0 tag, I was able to figure out where to put the extra lines.  Now I need to build and install it, see if it solves the issue.&lt;/p&gt;</comment>
                            <comment id="16172265" author="elyograg" created="Tue, 19 Sep 2017 20:06:56 +0000"  >&lt;p&gt;With the patch in place on the 6.6.0 code, the errors in the admin UI appear while startup is finishing, but then eventually disappear.  The logfile still contains many instances of the error message.&lt;/p&gt;</comment>
                            <comment id="16172292" author="erickerickson" created="Tue, 19 Sep 2017 20:31:20 +0000"  >&lt;p&gt;Luiz:&lt;/p&gt;

&lt;p&gt;Nice sleuthing! This looks quite promising, I can see where this would be a problem. I looked through the code and I think I see some other places this could happen, so I&apos;m going to put up some changes.&lt;/p&gt;

&lt;p&gt;I want particularly to look at other createCoreFromDescriptor calls and see if we can move the locking via waitAddPendingCoreOps could be moved there, although on a quick glance I&apos;m not sure.&lt;/p&gt;

&lt;p&gt;More soon.&lt;/p&gt;
</comment>
                            <comment id="16172298" author="niqbal" created="Tue, 19 Sep 2017 20:34:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=luiz.armesto&quot; class=&quot;user-hover&quot; rel=&quot;luiz.armesto&quot;&gt;luiz.armesto&lt;/a&gt;&apos;s repro is very similar to mine. I had run solr6.6.1 in a standalone environment without any issue. I stumbled on this issue while trying to start cores on a server which was constantly being pinged by haproxy, even before it had loaded the (empty) cores.&lt;/p&gt;</comment>
                            <comment id="16172310" author="elyograg" created="Tue, 19 Sep 2017 20:42:04 +0000"  >&lt;p&gt;My dev server is also pinged frequently by haproxy.  I also have a status servlet that provides a bunch of information from my Solr installs, including the dev server.  If that servlet is open in a browser, it will refresh once a minute.&lt;/p&gt;</comment>
                            <comment id="16173022" author="janhoy" created="Wed, 20 Sep 2017 11:06:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Odie3&quot; class=&quot;user-hover&quot; rel=&quot;Odie3&quot;&gt;Odie3&lt;/a&gt;, it was certainly not intentional to make you feel dumb &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; we tend to close issues that look like a user question rather than a new bug, and the bar should always be low to re-open. In this case I may have jumped the trigger prematurely, but it is always a good idea to run your problem with the user-list to determine if others also believe it to be a new issue. In this case we can hope that this one will solve your case too...&lt;/p&gt;

&lt;p&gt;If you later re-open &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11361&quot; title=&quot;After Restarting Solr 6.6.1 Seems to cause Error if Application is Reading/Writing?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11361&quot;&gt;&lt;del&gt;SOLR-11361&lt;/del&gt;&lt;/a&gt; then please shorten down the issue description to just a few paragraphs. Long stack traces are best shared by enclosing in &lt;b&gt;noformat&lt;/b&gt; tags or sharing via a Gist url. Feel free to ask any question on the users list!&lt;/p&gt;</comment>
                            <comment id="16173562" author="erickerickson" created="Wed, 20 Sep 2017 17:42:19 +0000"  >&lt;p&gt;OK, I poked at this yesterday and my bright idea of moving things to createCoreFromDescriptor doesn&apos;t work. getCore is the problem, it depends on getting the core back from waitAddPendingCoreOps if some other thread is opening the core. If we put some kind of test in getCore instead (say isCoreInPending() or something), then later in that method called createCoreFromDescriptor (assuming the core wasn&apos;t in pending ops), it&apos;d be possible that another process would open the core between the calls.&lt;/p&gt;

&lt;p&gt;There are three places in CoreContainer that call createCoreFromDescriptor without being surrounded by a waitAddPendingCoreOps/removeFromPendingOps, I&apos;m working up a patch for the other two.&lt;/p&gt;

&lt;p&gt;We&apos;ll see if it fixes Shawn&apos;s problem too, vetting it a bit more now and will put up a patch later today if all goes well.&lt;/p&gt;</comment>
                            <comment id="16174896" author="erickerickson" created="Thu, 21 Sep 2017 15:02:25 +0000"  >&lt;p&gt;This passes the shell script test (Thanks Luiz!) All tests pass.&lt;/p&gt;

&lt;p&gt;This surrounds all the instances of createFromDescriptor with a call to waitAddPendingCoreOps/removeFromPendingOps. I think there were several more potential problems, create, load and reload all were unprotected.&lt;/p&gt;

&lt;p&gt;Also added a fairly detailed comment on why moving this to createFromDescriptor won&apos;t work.&lt;/p&gt;

&lt;p&gt;Shawn: &lt;br/&gt;
Can you give this a spin? If you still see the errors let me know, plus a little more detail about your setup. Or is it just you have a bunch of cores and are pinging when starting Solr?&lt;/p&gt;</comment>
                            <comment id="16174900" author="erickerickson" created="Thu, 21 Sep 2017 15:06:35 +0000"  >&lt;p&gt;P.S. I spent probably more time than I should have trying to make an automated test for this too, but failed miserably. It &lt;em&gt;seems&lt;/em&gt; like a pair of threads that queried/pinged/reloaded should have tripped this but somehow it didn&apos;t work for me.&lt;/p&gt;</comment>
                            <comment id="16175113" author="niqbal" created="Thu, 21 Sep 2017 17:05:27 +0000"  >&lt;p&gt;FWIW, on my cluster with constant haproxy pings, i was hitting this issue 9/10 times. And the core was not even usable. So my issue was slightly different from Shawn, but I hope that your fix will cover for all the issues. Looking forward for the fix. &lt;/p&gt;</comment>
                            <comment id="16175513" author="erickerickson" created="Thu, 21 Sep 2017 21:45:28 +0000"  >&lt;p&gt;Well, the patch should apply pretty cleanly to the 6.6 branch, although I admit I created it against Master. Is there any way you can apply it and give it a try?&lt;/p&gt;
</comment>
                            <comment id="16176719" author="niqbal" created="Fri, 22 Sep 2017 17:00:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; i would have loved to test it, but my test cluster which naturally hit this issue has been reclaimed and i will not have access to another for another week. I am looking forward to solr 7.0; as we haven&apos;t rolled solr 6 to production yet. &lt;br/&gt;
Locally, I can mock the repeated pings by Luiz&apos;s script but if you have already tested with it, then that is not much useful. &lt;/p&gt;</comment>
                            <comment id="16176841" author="odie3" created="Fri, 22 Sep 2017 18:11:13 +0000"  >&lt;p&gt;so, all this stuff about patching is this in a Solr 6.1.x download?&lt;/p&gt;</comment>
                            <comment id="16179443" author="elyograg" created="Mon, 25 Sep 2017 17:58:22 +0000"  >&lt;p&gt;With the latest patch applied to branch_6_6 and installing from solr-6.6.2-SNAPSHOT.tgz, everything works as expected.  There are no errors in the admin UI, and the &quot;Lock held by this virtual machine&quot; message is not in the log.  The only errors I see in the log are those generated by accessing cores while they are loading.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;title&amp;gt;Error 503 {metadata={error-class=org.apache.solr.common.SolrException,root-error-class=org.apache.solr.common.SolrException},msg=SolrCore is loading,code=503}&amp;lt;/title&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16179465" author="elyograg" created="Mon, 25 Sep 2017 18:08:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;so, all this stuff about patching is this in a Solr 6.1.x download?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s just a patch attached to a Jira issue right now.   To be seen in a downloaded version, a change must be committed to one or more code branches, and then somebody must volunteer to be the release manager for a new version built from a branch with the fix.&lt;/p&gt;

&lt;p&gt;At this time, I think the earliest release that &lt;b&gt;might&lt;/b&gt; get this issue resolved will be 7.1.0.  The problems seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11361&quot; title=&quot;After Restarting Solr 6.6.1 Seems to cause Error if Application is Reading/Writing?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11361&quot;&gt;&lt;del&gt;SOLR-11361&lt;/del&gt;&lt;/a&gt; (which I think Erick&apos;s patch also fixes) might be severe enough to justify a 6.6.2 release, but that&apos;s not something I would count on.&lt;/p&gt;

&lt;p&gt;Side note: Just like a user on IRC, I was having a problem accessing /solr/admin/metrics with 6.6.0 and a 6.6.2-SNAPSHOT version that I had built previously, but that problem seems to be fixed now.  I do not know if Erick&apos;s patch is what made that work, or if it was another change made to the 6.6 branch.&lt;/p&gt;</comment>
                            <comment id="16179603" author="erickerickson" created="Mon, 25 Sep 2017 19:13:59 +0000"  >&lt;p&gt;Final patch, just the last patch I uploaded with CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16179604" author="jira-bot" created="Mon, 25 Sep 2017 19:14:22 +0000"  >&lt;p&gt;Commit 6391a75a50ecc05db0d7a5ed9adc9fe187a4f57e in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6391a75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6391a75&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11297&quot; title=&quot;Message &amp;quot;Lock held by this virtual machine&amp;quot; during startup.  Solr is trying to start some cores twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11297&quot;&gt;&lt;del&gt;SOLR-11297&lt;/del&gt;&lt;/a&gt;: Message &apos;Lock held by this virtual machine&apos; during startup.  Solr is trying to start some cores twice&lt;/p&gt;</comment>
                            <comment id="16179623" author="jira-bot" created="Mon, 25 Sep 2017 19:25:01 +0000"  >&lt;p&gt;Commit 2e0529532896c966ad11b55575de119fd8f2be3b in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2e05295&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2e05295&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11297&quot; title=&quot;Message &amp;quot;Lock held by this virtual machine&amp;quot; during startup.  Solr is trying to start some cores twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11297&quot;&gt;&lt;del&gt;SOLR-11297&lt;/del&gt;&lt;/a&gt;: Message &apos;Lock held by this virtual machine&apos; during startup.  Solr is trying to start some cores twice&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 6391a75)&lt;/p&gt;</comment>
                            <comment id="16179689" author="erickerickson" created="Mon, 25 Sep 2017 20:05:09 +0000"  >&lt;p&gt;Many thanks Luiz and Shawn!&lt;/p&gt;

&lt;p&gt;Richard:&lt;br/&gt;
This will never be back-ported to 6.1, did you mean 6.6.1? And its not there either. If there&apos;s ever  a 6.6.2 (and there are no plans for one) then we could backport it.&lt;/p&gt;

&lt;p&gt;I did try applying the patch to 6.6.1 and compiling and running Luiz&apos;s test and it works like a champ so that&apos;s an option.&lt;/p&gt;</comment>
                            <comment id="16179704" author="odie3" created="Mon, 25 Sep 2017 20:20:07 +0000"  >&lt;p&gt;I meant in 6.6.1 (which would spawn 6.6.2?) - which was the next version I wanted to test and where I ran into problems. &lt;/p&gt;</comment>
                            <comment id="16179831" author="niqbal" created="Mon, 25 Sep 2017 21:42:51 +0000"  >&lt;p&gt;It seems that this error is difficult to reproduce. I tried Luiz&apos;s script on my Mac laptop and wasn&apos;t able to reproduce this issue even after decreasing the &apos;sleep&apos; between iteration to `0.005`. I tried it on a production like machine (which is similar to what I had done last month although using an haproxy instead of a command line script) and I was able to hit the above error however my cores were still loaded by the &apos;Core&apos; thread and were functional. Last month when initially I hit this issue, my server was giving the above &apos;Lock held by this virtual machine&apos; error and also they were *&lt;b&gt;not&lt;/b&gt;* usable. Unfortunately, I don&apos;t have access to those specific machines anymore. &lt;/p&gt;
</comment>
                            <comment id="16184570" author="jira-bot" created="Thu, 28 Sep 2017 18:05:26 +0000"  >&lt;p&gt;Commit 614b807fc29685696ecfd09f92f312fd92a01c54 in lucene-solr&apos;s branch refs/heads/branch_7_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=614b807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=614b807&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11297&quot; title=&quot;Message &amp;quot;Lock held by this virtual machine&amp;quot; during startup.  Solr is trying to start some cores twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11297&quot;&gt;&lt;del&gt;SOLR-11297&lt;/del&gt;&lt;/a&gt;: Message &apos;Lock held by this virtual machine&apos; during startup.  Solr is trying to start some cores twice&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 6391a75a50ecc05db0d7a5ed9adc9fe187a4f57e)&lt;/p&gt;</comment>
                            <comment id="16195298" author="steve_rowe" created="Fri, 6 Oct 2017 21:56:45 +0000"  >&lt;p&gt;Closing after 7.0.1 release.&lt;/p&gt;</comment>
                            <comment id="16204397" author="jira-bot" created="Sat, 14 Oct 2017 00:55:24 +0000"  >&lt;p&gt;Commit d8e587e227a414d2c991f6fd740073112b9a1cf5 in lucene-solr&apos;s branch refs/heads/branch_6x from Erick&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8e587e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8e587e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11297&quot; title=&quot;Message &amp;quot;Lock held by this virtual machine&amp;quot; during startup.  Solr is trying to start some cores twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11297&quot;&gt;&lt;del&gt;SOLR-11297&lt;/del&gt;&lt;/a&gt;: Message &apos;Lock held by this virtual machine&apos; during startup. Solr is trying to start some cores twice&lt;/p&gt;</comment>
                            <comment id="16204663" author="jira-bot" created="Sat, 14 Oct 2017 15:20:41 +0000"  >&lt;p&gt;Commit 51e0959eaea9dd07ffd0cf6919d99c6b8eca7fa4 in lucene-solr&apos;s branch refs/heads/branch_6_6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51e0959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51e0959&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11297&quot; title=&quot;Message &amp;quot;Lock held by this virtual machine&amp;quot; during startup.  Solr is trying to start some cores twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11297&quot;&gt;&lt;del&gt;SOLR-11297&lt;/del&gt;&lt;/a&gt;: Message &apos;Lock held by this virtual machine&apos; during startup.  Solr is trying to start some cores twice&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13102828">SOLR-11361</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12888928" name="SOLR-11297.patch" size="4541" author="erickerickson" created="Mon, 25 Sep 2017 19:13:41 +0000"/>
                            <attachment id="12888314" name="SOLR-11297.patch" size="4032" author="erickerickson" created="Thu, 21 Sep 2017 14:56:53 +0000"/>
                            <attachment id="12887945" name="SOLR-11297.patch" size="1117" author="luiz.armesto" created="Tue, 19 Sep 2017 18:36:02 +0000"/>
                            <attachment id="12887946" name="SOLR-11297.sh" size="1487" author="luiz.armesto" created="Tue, 19 Sep 2017 18:35:18 +0000"/>
                            <attachment id="12884353" name="solr6_6-startup.log" size="526940" author="elyograg" created="Tue, 29 Aug 2017 22:28:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jfc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>