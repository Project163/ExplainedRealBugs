<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:05:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7655] Perf bug- DefaultSolrHighlighter.getSpanQueryScorer triggers MultiFields.getMergedFieldInfos</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7655</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;It appears grabbing the FieldInfos from the SlowCompositeReaderWrapper is slow.  It isn&apos;t cached.  The DefaultSolrHighligher in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6196&quot; title=&quot;The overseerstatus collection API should instrument amILeader and ZK update calls as well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6196&quot;&gt;&lt;del&gt;SOLR-6196&lt;/del&gt;&lt;/a&gt; (v5.0) uses it to ascertain if there are payloads.  Instead it can grab it from the Terms instance, which is cached.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12836637">SOLR-7655</key>
            <summary>Perf bug- DefaultSolrHighlighter.getSpanQueryScorer triggers MultiFields.getMergedFieldInfos</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jun 2015 19:47:57 +0000</created>
                <updated>Wed, 2 Oct 2019 17:25:00 +0000</updated>
                            <resolved>Wed, 10 Jun 2015 13:00:26 +0000</resolved>
                                    <version>5.0</version>
                                    <fixVersion>5.2.1</fixVersion>
                                    <component>highlighter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14579476" author="dsmiley" created="Tue, 9 Jun 2015 19:49:04 +0000"  >&lt;p&gt;Suggested fix:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      scorer.setUsePayloads(request.getParams().getFieldBool(fieldName, HighlightParams.PAYLOADS,
          request.getSearcher().getLeafReader().fields().terms(fieldName).hasPayloads()));
      &lt;span class=&quot;code-comment&quot;&gt;// It&lt;span class=&quot;code-quote&quot;&gt;&apos;d be nice to know &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; payloads are on the tokenStream but the presence of the attribute isn&apos;&lt;/span&gt;t a good
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// indicator.
&lt;/span&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(e);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m going to try this now with Solr&apos;s tests, then post a patch.&lt;/p&gt;</comment>
                            <comment id="14579478" author="dsmiley" created="Tue, 9 Jun 2015 19:50:17 +0000"  >&lt;p&gt;This was discovered via a commenter here: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5855?focusedCommentId=14578437&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14578437&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-5855?focusedCommentId=14578437&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14578437&lt;/a&gt;  (the purpose of that issue is unrelated to the discovery in the stack traces posted)&lt;/p&gt;</comment>
                            <comment id="14579970" author="dsmiley" created="Wed, 10 Jun 2015 03:26:37 +0000"  >&lt;p&gt;Here&apos;s a patch; a little better than the &quot;suggested fix&quot;: the Terms returned could be null, and if an exception somehow gets thrown then we can log it without re-throwing.&lt;/p&gt;

&lt;p&gt;I did a little performance testing on a project I have.  It seems this perf bug is most pronounced if you attempt to highlight on a ton of fields (e.g. via &lt;tt&gt;hl.fl=*&lt;/tt&gt;), and if there are a lot of Lucene segments.  And furthermore if you don&apos;t have a lot of text to highlight per field then the overhead here is proportionally higher to the overall task.&lt;/p&gt;

&lt;p&gt;Precommit is happy and the tests pass.  It&apos;d be nice to get this into 5.2.1 but would like to see a +1 from someone.  What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; (you&apos;re the RM I believe).&lt;/p&gt;

&lt;p&gt;As a side note... I&apos;m wondering if SlowCompositeReaderWrapper ought to cache FieldInfos too; maybe lazyily.  &lt;/p&gt;</comment>
                            <comment id="14580127" author="shalinmangar" created="Wed, 10 Jun 2015 06:51:43 +0000"  >&lt;p&gt;Looks good to me. I don&apos;t know if you&apos;re online but if not, I&apos;ll commit your patch in a couple of hours and create the RC.&lt;/p&gt;</comment>
                            <comment id="14580428" author="emaijala" created="Wed, 10 Jun 2015 11:58:28 +0000"  >&lt;p&gt;Took me a while to get a build environment up, but results look very promising. My very unscientific benchmark shows that the highlighter may now be even a bit faster than in Solr 4.10.2 at least in some cases. Thanks for the great work, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14580494" author="jira-bot" created="Wed, 10 Jun 2015 12:54:37 +0000"  >&lt;p&gt;Commit 1684665 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1684665&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1684665&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7655&quot; title=&quot;Perf bug- DefaultSolrHighlighter.getSpanQueryScorer triggers MultiFields.getMergedFieldInfos&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7655&quot;&gt;&lt;del&gt;SOLR-7655&lt;/del&gt;&lt;/a&gt;: Speed up DefaultSolrHighlighter&apos;s check for the existence of payloads&lt;/p&gt;</comment>
                            <comment id="14580499" author="jira-bot" created="Wed, 10 Jun 2015 12:56:29 +0000"  >&lt;p&gt;Commit 1684667 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1684667&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1684667&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7655&quot; title=&quot;Perf bug- DefaultSolrHighlighter.getSpanQueryScorer triggers MultiFields.getMergedFieldInfos&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7655&quot;&gt;&lt;del&gt;SOLR-7655&lt;/del&gt;&lt;/a&gt;: Speed up DefaultSolrHighlighter&apos;s check for the existence of payloads.&lt;/p&gt;</comment>
                            <comment id="14580502" author="jira-bot" created="Wed, 10 Jun 2015 12:59:12 +0000"  >&lt;p&gt;Commit 1684668 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_2&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1684668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1684668&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7655&quot; title=&quot;Perf bug- DefaultSolrHighlighter.getSpanQueryScorer triggers MultiFields.getMergedFieldInfos&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7655&quot;&gt;&lt;del&gt;SOLR-7655&lt;/del&gt;&lt;/a&gt;: Speed up DefaultSolrHighlighter&apos;s check for the existence of payloads.&lt;/p&gt;</comment>
                            <comment id="14580505" author="dsmiley" created="Wed, 10 Jun 2015 13:00:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; I didn&apos;t see you online and I saw it wasn&apos;t committed yet so I did so now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12738737" name="SOLR-7655.patch" size="1878" author="dsmiley" created="Wed, 10 Jun 2015 03:26:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fuhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>