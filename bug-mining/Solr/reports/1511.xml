<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:38:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5168] BJQParserTest reproducible failures</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5168</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;two recent Jenkins builds have uncovered some test seeds that cause failures in multiple test methods in BJQParserTest.  These seeds reproduce reliably (as of trunk r1514815) ...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ant test  -Dtestcase=BJQParserTest -Dtests.seed=7A613F321CE87F5B -Dtests.multiplier=3 -Dtests.slow=true

ant test  -Dtestcase=BJQParserTest -Dtests.seed=1DC8055F837E437E -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12664115">SOLR-5168</key>
            <summary>BJQParserTest reproducible failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Aug 2013 17:53:14 +0000</created>
                <updated>Mon, 9 May 2016 18:57:13 +0000</updated>
                            <resolved>Wed, 4 Sep 2013 15:55:47 +0000</resolved>
                                                    <fixVersion>4.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13742467" author="hossman" created="Fri, 16 Aug 2013 18:02:58 +0000"  >&lt;p&gt;One of those seeds (1DC8055F837E437E) causes MockRandomMergePolicy &amp;#8211; but a cursory review of hte test (and my cursory udnderstanding of the block join queries) doesn&apos;t suggest any reason why that should cause a problem for this test &amp;#8211; the only ever time a commit &lt;b&gt;might&lt;/b&gt; happen in the test is at the end of an entire block.&lt;/p&gt;

&lt;p&gt;The other seed (7A613F321CE87F5B) just uses LogDocMergePolicy, so even if my cusory understandings above are incorrect, there really seems to be a bug when this seed is used.&lt;/p&gt;</comment>
                            <comment id="13742569" author="mkhludnev" created="Fri, 16 Aug 2013 20:28:12 +0000"  >&lt;p&gt;I wonder, how it could work (it seems I wrote it myself - my fault).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/test/org/apache/solr/search/join/BJQParserTest.java#L56&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/test/org/apache/solr/search/join/BJQParserTest.java#L56&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;test doesn&apos;t use block add, but adds docs one by one, hence a block can be broken by commit&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void createIndex()
...
   assertU(add(doc(idDoc)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="13742607" author="yseeley@gmail.com" created="Fri, 16 Aug 2013 21:14:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;test doesn&apos;t use block add&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I thought that was on purpose to test the query separately from any block indexing.&lt;br/&gt;
Simplest fix would be to disable the random IW stuff for this test (it would always work if the buffering in IW is enough such that the docs are flushed to a single segment).  Optimizing after that fact in conjunction with the log merge policy would also work.&lt;/p&gt;</comment>
                            <comment id="13742645" author="mkhludnev" created="Fri, 16 Aug 2013 22:06:20 +0000"  >&lt;p&gt;first patch. it solves most of tests but testGrandChildren() still fails on broken block. &lt;/p&gt;</comment>
                            <comment id="13742907" author="mkhludnev" created="Sat, 17 Aug 2013 11:53:17 +0000"  >&lt;p&gt;ok. checked it again. I propose either apply that one-liner patch or trigger forceMerge() in test. After that testGrandChildren() still fails and it&apos;s fairly reasonable, though gives a subject for considerations:&lt;/p&gt;

&lt;p&gt;right now BJQParserTest.addGrandChildren() places &lt;em&gt;grand children&lt;/em&gt; before &lt;em&gt;their parents&lt;/em&gt; (i.e children). It sounds like user is aware of physical layout which is necessary for bjq and enforces it. Unfortunately, AddUpdateCommand.flatten(SolrInputDocument) reverses docs in a block quite unreasonably. &lt;br/&gt;
So, there might be two vision on it:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;we can allow users to be aware about physical layout of docs, and need to remove useless reverse in AddUpdateCommand.flatten() - not a big deal;&lt;/li&gt;
	&lt;li&gt;we don&apos;t want users to rely, and oblige them to nest grand children into children as well as children are nested into parents. (in this case, how to prevent them from relying on reversing?)&lt;br/&gt;
Please raise a separate issue for testGrandChildren(). it can be temporarily ignored for a while. &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks. &lt;/p&gt;</comment>
                            <comment id="13744016" author="hossman" created="Mon, 19 Aug 2013 17:24:42 +0000"  >&lt;p&gt;Mikhail: I don&apos;t fully understand what&apos;s going on here yet, but i know Yonik is on vaca for a week or so &amp;#8211; so i&apos;ll go ahead and commit your patch along with an &lt;tt&gt;@Ignore&lt;/tt&gt; on testGrandChildren&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;we can allow users to be aware about physical layout of docs&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think we should &lt;em&gt;expect&lt;/em&gt; users to be aware of the layout. if we wnat to have low level &quot;grey box&quot; tests that know about those details then so be it &amp;#8211; but the non-test code shouldn&apos;t assume end users know anything about the implementation details unless we have no other choice.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;we don&apos;t want users to rely, and oblige them to nest grand children into children as well as children are nested into parents.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This sounds like the right course of action: if you have child docs, use addChildDocument on your parent doc; if you have grandchildren, use addChildDocument on the appropriate existing child that is the parent of the grand-child you want to add.  &lt;/p&gt;

&lt;p&gt;Based on the current API of SolrInputDocument, I can&apos;t imagine it working any other way.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please raise a separate issue for testGrandChildren(). it can be temporarily ignored for a while. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d prefer to leave this issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5168&quot; title=&quot;BJQParserTest reproducible failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5168&quot;&gt;&lt;del&gt;SOLR-5168&lt;/del&gt;&lt;/a&gt;) open for now to track the test failures until they are resolved (that&apos;s the point of it&apos;s existence).  &lt;/p&gt;

&lt;p&gt;It&apos;s not clear to me if you are saying that fixing the &quot;grandchildren&quot; issue requires fixing AddUpdateCommand.flatten() &amp;#8211; in which case please open a new issue to specifically address that.  (if the fix for the new issue automatically fixes this issue then great).  If however the remaining problem is simply bad assumptions in this test, then we can continue to use this issue to track it.&lt;/p&gt;</comment>
                            <comment id="13744017" author="jira-bot" created="Mon, 19 Aug 2013 17:25:19 +0000"  >&lt;p&gt;Commit 1515521 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1515521&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1515521&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5168&quot; title=&quot;BJQParserTest reproducible failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5168&quot;&gt;&lt;del&gt;SOLR-5168&lt;/del&gt;&lt;/a&gt;: test improvements and @Ignore still broken test&lt;/p&gt;</comment>
                            <comment id="13744036" author="jira-bot" created="Mon, 19 Aug 2013 17:35:29 +0000"  >&lt;p&gt;Commit 1515526 from hossman@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1515526&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1515526&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5168&quot; title=&quot;BJQParserTest reproducible failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5168&quot;&gt;&lt;del&gt;SOLR-5168&lt;/del&gt;&lt;/a&gt;: test improvements and @Ignore still broken test (merge r1515521)&lt;/p&gt;</comment>
                            <comment id="13744193" author="mkhludnev" created="Mon, 19 Aug 2013 20:45:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;fixing the &quot;grandchildren&quot; issue requires fixing AddUpdateCommand.flatten() &#8211; in which case please open a new issue to specifically address that. (if the fix for the new issue automatically fixes this issue then great).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;welcome &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5175&quot; title=&quot;Don&amp;#39;t reorder children document&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5175&quot;&gt;&lt;del&gt;SOLR-5175&lt;/del&gt;&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="13745812" author="mkhludnev" created="Wed, 21 Aug 2013 06:10:26 +0000"  >&lt;p&gt;pls also consider &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5177&quot; title=&quot;test covers overwrite true/false for block updates &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5177&quot;&gt;&lt;del&gt;SOLR-5177&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13757884" author="mkhludnev" created="Wed, 4 Sep 2013 15:43:00 +0000"  >&lt;p&gt;Ignore is removed at &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5175&quot; title=&quot;Don&amp;#39;t reorder children document&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5175&quot;&gt;&lt;del&gt;SOLR-5175&lt;/del&gt;&lt;/a&gt;. &lt;br/&gt;
see &lt;a href=&quot;https://svn.apache.org/viewvc/lucene/dev/trunk/solr/core/src/test/org/apache/solr/search/join/BJQParserTest.java?r1=1520042&amp;amp;r2=1520041&amp;amp;pathrev=1520042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/viewvc/lucene/dev/trunk/solr/core/src/test/org/apache/solr/search/join/BJQParserTest.java?r1=1520042&amp;amp;r2=1520041&amp;amp;pathrev=1520042&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;feel free to close this one. &lt;/p&gt;</comment>
                            <comment id="13757888" author="yseeley@gmail.com" created="Wed, 4 Sep 2013 15:45:47 +0000"  >&lt;p&gt;Right - I was just running the test in a loop locally first to ensure everything was actually fixed.&lt;/p&gt;</comment>
                            <comment id="13787107" author="jpountz" created="Sat, 5 Oct 2013 10:19:15 +0000"  >&lt;p&gt;4.5 release -&amp;gt; bulk close&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12663507">SOLR-5142</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12664444">SOLR-5175</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12540363">SOLR-3076</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12598540" name="BJQTest.patch" size="1272" author="mkhl" created="Fri, 16 Aug 2013 22:06:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>344116</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ncdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>344418</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>