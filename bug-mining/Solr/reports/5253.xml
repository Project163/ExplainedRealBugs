<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:11:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17519] CloudSolrClient with HTTP ClusterState can forget live nodes and then fail</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17519</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using CloudSolrClient with HTTP URLs to Solr for the cluster state:&lt;br/&gt;
If all live nodes disappear temporarily (hard cluster restart?), the client can permanently fail to talk to the cluster, and thus would need to be restarted to recover.&lt;/p&gt;

&lt;p&gt;Credit &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ilan&quot; class=&quot;user-hover&quot; rel=&quot;ilan&quot;&gt;ilan&lt;/a&gt; on the dev list:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The current implementation removes non live nodes from the set of nodes to connect to. Getting the live nodes requires connecting to a specific node in the cluster that is therefore live when that happens. Worst case, if there is a single node up in the cluster, the client ends with a single node in its connection candidates list. For the issue to manifest, that Solr node then has to go down. Subsequently, even if other nodes are up, the client only has the address of a down node and can&apos;t connect.&lt;/p&gt;

&lt;p&gt;The fix is not a big deal. Nodes initially passed as configuration to the client should never be removed from the set of candidate nodes to connect to, even if they are not live. Other live nodes could be added to that set (and removed from it if we so desire when they are no longer live) to increase resiliency in case the cluster does have live nodes but all initially configured nodes are not live. The design issue is treating the configured set of nodes to connect to and the set of live nodes as one thing.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;See org.apache.solr.client.solrj.impl.BaseHttpClusterStateProvider&lt;/p&gt;</description>
                <environment></environment>
        <key id="13596867">SOLR-17519</key>
            <summary>CloudSolrClient with HTTP ClusterState can forget live nodes and then fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                            <label>newdev</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 27 Oct 2024 21:52:04 +0000</created>
                <updated>Thu, 24 Jul 2025 22:50:52 +0000</updated>
                            <resolved>Wed, 29 Jan 2025 06:08:54 +0000</resolved>
                                                    <fixVersion>9.9</fixVersion>
                                    <component>SolrCloud</component>
                    <component>SolrJ</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="22200">6h 10m</timespent>
                                <comments>
                            <comment id="17912109" author="dsmiley" created="Fri, 10 Jan 2025 20:24:09 +0000"  >&lt;p&gt;Here&apos;s another proposal that I&apos;d like an opinion on, designed to both simplify and actually give the deployer a bit of control that they don&apos;t have today: &#160; Only use the configured URLs for all cluster state API interactions. &#160;Easy. &#160;No need to even convert a &quot;liveNode&quot; url-ish thing to a URL. &#160;The deployer&apos;s job is to pick the node list wisely &#8211; nodes that will always be there, notwithstanding restarts. &#160;But that&apos;s true today as well. &#160;Perhaps the deployer designates a node-0 node (and one or two others fallback) that already has a node role to be the Overseer and/or for doing coordinator stuff. &#160;The risk with my proposal is that by &lt;b&gt;not&lt;/b&gt; considering live nodes (those returned from Solr), perhaps the initial list becomes inaccessible. &#160;But that&apos;s a risk anyway at the time a client starts.&lt;br/&gt;
CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbiscocho&quot; class=&quot;user-hover&quot; rel=&quot;mbiscocho&quot;&gt;mbiscocho&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17912139" author="JIRAUSER300090" created="Fri, 10 Jan 2025 22:24:08 +0000"  >&lt;p&gt;Using a static set of URLs would simplify ClusterStateProvider but losing that &quot;dynamic node discovery&quot; changes the way the user is probably used to using this. Correct me if I am wrong, but CloudSolrClient used to get live nodes from ZK directly so this probably was never an issue even with nodes movements or migrations? If I want cluster state, I would assume CloudSolrClient has the latest nodes that Solr knows and not just the ones passed but this can be documented to change. Like if I initialize&#160; node-0 and ask for cluster state and get back &quot;node-0 and node-1:, I assumed CloudSolrClient knows about node-1 to get state even if node-0 is gone because clusterstate returned it. Or maybe thats wrong way of thinking.&lt;/p&gt;

&lt;p&gt;We do node migrations regularly, so this would put the maintaining of the Solr nodes on the user and their point of failure if the list becomes stale which maybe can be cumbersome at scale but its debatable that it should be maintained by the user anyways. I think the proposal makes sense though and is easily documentable, understandable for the user and can be easily maintained going forward which would have probably avoided this bug all together which is a plus.&lt;/p&gt;</comment>
                            <comment id="17912145" author="dsmiley" created="Fri, 10 Jan 2025 23:05:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;(ZK) so this probably was never an issue even with nodes movements or migrations&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes; assuming the ZK nodes are stable.&lt;/p&gt;

&lt;p&gt;Another reason to exclusively use the configured Solr URLs (s) is that the operator might want to use a load balancer (may even &lt;em&gt;already&lt;/em&gt; be using one),  not actually directly a Solr node itself.  It might be a single dependable URL.&lt;/p&gt;</comment>
                            <comment id="17912675" author="JIRAUSER300090" created="Mon, 13 Jan 2025 23:29:51 +0000"  >&lt;p&gt;Any consensus on the direction for this Jira? Was planning on updating the current PR depending on the what is agreed upon here&lt;/p&gt;</comment>
                            <comment id="17913086" author="houston" created="Tue, 14 Jan 2025 22:26:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Another reason to exclusively use the configured Solr URLs (s) is that the operator might want to use a load balancer (may even &lt;em&gt;already&lt;/em&gt; be using one), not actually directly a Solr node itself. It might be a single dependable URL.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is absolutely true, but then the user shouldn&apos;t be using the &quot;CloudSolrClient&quot; correct? I think the naming is bad here. If I&apos;m not mistaken, the &quot;CloudSolrClient&quot;s act more like &quot;LiveNodeSolrClients&quot;. Instead of the LoadBalancingSolrClient which just load balances between a set of URLs. So in this case, the operator or people using a single load balancer shouldn&apos;t use the &quot;CloudSolrClient&quot;, correct? Maybe this requires a better name or better documentation. I&apos;m not sure.&lt;/p&gt;

&lt;p&gt;While I think this is true, I also don&apos;t think that the HttpClusterStateProvider should be locked into this pattern, even if this is the only use case for it (Not sure what else it&apos;s used for). The HttpClusterStateProvider should have the option to use dynamic node discovery, or just stick with its initial set of urls (as David is pushing for). The CloudSolrClient should probably then use the dynamic reloading, for the reasons listed above.&lt;/p&gt;

&lt;p&gt;To summarize, I like the PR, but I think the dynamic part should be opt-out-able in the HttpClusterStateProvider&lt;/p&gt;</comment>
                            <comment id="17913105" author="dsmiley" created="Tue, 14 Jan 2025 23:36:25 +0000"  >&lt;p&gt;Houston:&lt;br/&gt;
When I said &quot;the operator might want to use a load balancer&quot; I meant the user/deployer, not &lt;em&gt;necessarily&lt;/em&gt; the k8s Solr Operator. &#160;You imply a load balancer invalidates the utility of CloudSolrClient but CSC is designed to reduce network hops. &#160;You don&apos;t know what HttpClusterStateProvider is for... See the parent issue for an explanation but I suspect I misunderstand you. &#160;You are making a distinction between CSC and the provider; the provider&apos;s sole job is to provide the ClusterState (including live nodes). &#160;CSC&apos;s job is to route user requests to the optimal node.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I think the dynamic part should be opt-out-able in the HttpClusterStateProvider&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But since it exists, still need to deal with the accompanying implementation details &amp;amp; test. So we don&apos;t get a simplicity win. &#160;Ah well; shrug.&lt;/p&gt;</comment>
                            <comment id="17914583" author="ab" created="Mon, 20 Jan 2025 09:10:01 +0000"  >&lt;p&gt;The original use case for HttpClusterStateProvider was to be able to use CloudSolrClient and its load-balancing and routing logic in a situation when Solr&apos;s ZK is locked down, i.e. when only Solr nodes are exposed for indexing/search but the client has no access to the cluster&apos;s ZK.&lt;/p&gt;

&lt;p&gt;In such situations it would make sense to keep the &quot;bootstrap&quot; Solr URLs around, even if they are not live at the moment, to be able to again bootstrap the current list of live nodes - because the client doesn&apos;t have access to any other method for discovering the current live nodes.&lt;/p&gt;</comment>
                            <comment id="17916567" author="jira-bot" created="Fri, 24 Jan 2025 02:41:14 +0000"  >&lt;p&gt;Commit b1fe883991e59e8bed449655e9db1d5cbc77f1de in solr&apos;s branch refs/heads/main from Matthew Biscocho&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=b1fe883991e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=b1fe883991e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17519&quot; title=&quot;CloudSolrClient with HTTP ClusterState can forget live nodes and then fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17519&quot;&gt;&lt;del&gt;SOLR-17519&lt;/del&gt;&lt;/a&gt;: CloudSolrClient&apos;s HTTP ClusterStateProvider now uses configured URLs as backup (#2935)&lt;/p&gt;

&lt;p&gt;SolrJ CloudSolrClient configured with Solr URLs can fail to request cluster state if its current live nodes list are all unavailable.  The HttpClusterStateProvider now retains the initial configured list of passed URLs as backup.&lt;/p&gt;

&lt;p&gt;Utils.getBaseUrlForNodeName moved to URLUtil.&lt;br/&gt;
MiniSolrCloudCluster.startJettySolrRunner is overloaded now to choose to reuse the port.&lt;/p&gt;</comment>
                            <comment id="17921263" author="jira-bot" created="Mon, 27 Jan 2025 03:20:47 +0000"  >&lt;p&gt;Commit 916ae15387e368ac546a8174955e4d33fca37239 in solr&apos;s branch refs/heads/branch_9x from Matthew Biscocho&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=916ae15387e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=916ae15387e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17519&quot; title=&quot;CloudSolrClient with HTTP ClusterState can forget live nodes and then fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17519&quot;&gt;&lt;del&gt;SOLR-17519&lt;/del&gt;&lt;/a&gt;: CloudSolrClient&apos;s HTTP ClusterStateProvider now uses configured URLs as backup (#2935)&lt;/p&gt;

&lt;p&gt;SolrJ CloudSolrClient configured with Solr URLs can fail to request cluster state if its current live nodes list are all unavailable.  The HttpClusterStateProvider now retains the initial configured list of passed URLs as backup.&lt;/p&gt;

&lt;p&gt;Utils.getBaseUrlForNodeName moved to URLUtil.&lt;br/&gt;
MiniSolrCloudCluster.startJettySolrRunner is overloaded now to choose to reuse the port.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b1fe883991e59e8bed449655e9db1d5cbc77f1de)&lt;/p&gt;</comment>
                            <comment id="17921996" author="dsmiley" created="Wed, 29 Jan 2025 06:08:54 +0000"  >&lt;p&gt;Merged and done.  Thanks for your contribution here Matthew!&lt;/p&gt;</comment>
                            <comment id="18009738" author="houston" created="Thu, 24 Jul 2025 22:50:52 +0000"  >&lt;p&gt;Closing after the 9.9.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13602762">SOLR-17605</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1s8ew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>