<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:02:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16871] Race condition for coordinator node init</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16871</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;From a unit test case &lt;a href=&quot;https://github.com/cowpaths/fullstory-solr/blob/e4226eb8fa2afb01d7615f7faea01f71b144cd58/solr/core/src/test/org/apache/solr/search/TestCoordinatorRole.java#L486&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;that issue concurrent select queries to coordinator nodes&lt;/a&gt;, it&#8217;s found that there could be 3 race condition issues:&lt;/p&gt;

&lt;p&gt;1. If multiple concurrent requests find the synthetic collection is not yet created, they might all attempt to create the synthetic collection. This could trigger SolrException on `collection already exists`&lt;/p&gt;

&lt;p&gt;2. Similarly, if multiple concurrent requests find there&#8217;s no replica of the synthetic collection for current node (multiple coordinator node scenario), then CoordinatorHttpSolrCall#addReplica could be invoked multiple times. This should not trigger any exception, but would create multiple replicas for the same node in the synthetic collection&lt;/p&gt;

&lt;p&gt;3. The existing logic &lt;a href=&quot;https://github.com/cowpaths/fullstory-solr/blob/6c8531f08301a291478502c262499abed0d5075c/solr/core/src/java/org/apache/solr/servlet/CoordinatorHttpSolrCall.java#L102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; assumes if syntheticColl.getReplicas(solrCall.cores.getZkController().getNodeName()) returns non empty result, then the following call in &lt;a href=&quot;https://github.com/cowpaths/fullstory-solr/blob/6c8531f08301a291478502c262499abed0d5075c/solr/core/src/java/org/apache/solr/servlet/CoordinatorHttpSolrCall.java#L112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; should return a core. Unfortunately, the first call can return a non empty list but with a DOWN replica if another request is in the progress of creating such replica. In this case, the solrCall.getCoreByCollection(syntheticCollectionName, isPreferLeader) would call super.getCoreByCollection at &lt;a href=&quot;https://github.com/cowpaths/fullstory-solr/blob/6c8531f08301a291478502c262499abed0d5075c/solr/core/src/java/org/apache/solr/servlet/CoordinatorHttpSolrCall.java#L69&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; which would return a null (since super impl only returns active replica). So CoordinatorHttpSolrCall#getCoreByCollection would end up calling CoordinatorHttpSolrCall#getCore , introducing an infinite loop and cause stack overflow&lt;/p&gt;</description>
                <environment></environment>
        <key id="13542740">SOLR-16871</key>
            <summary>Race condition for coordinator node init</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="patson">Patson Luk</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Jul 2023 21:54:32 +0000</created>
                <updated>Thu, 3 Oct 2024 15:42:09 +0000</updated>
                            <resolved>Tue, 12 Sep 2023 17:34:26 +0000</resolved>
                                                    <fixVersion>9.4</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13800">3h 50m</timespent>
                                <comments>
                            <comment id="17742707" author="jira-bot" created="Thu, 13 Jul 2023 08:33:51 +0000"  >&lt;p&gt;Commit fa024e8cbcde73aba91c34b7aa47bbed795d8b79 in solr&apos;s branch refs/heads/main from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=fa024e8cbcd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=fa024e8cbcd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16871&quot; title=&quot;Race condition for coordinator node init&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16871&quot;&gt;&lt;del&gt;SOLR-16871&lt;/del&gt;&lt;/a&gt;: Race condition in `CoordinatorHttpSolrCall` synthetic collection/replica init (#1762)&lt;/p&gt;
</comment>
                            <comment id="17742710" author="jira-bot" created="Thu, 13 Jul 2023 08:46:46 +0000"  >&lt;p&gt;Commit 1b74bc9e1856e416ea1ec4418dd776a3b8774c17 in solr&apos;s branch refs/heads/branch_9x from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=1b74bc9e185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=1b74bc9e185&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16871&quot; title=&quot;Race condition for coordinator node init&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16871&quot;&gt;&lt;del&gt;SOLR-16871&lt;/del&gt;&lt;/a&gt;: Race condition in `CoordinatorHttpSolrCall` synthetic collection/replica init (#1762)&lt;/p&gt;
</comment>
                            <comment id="17743308" author="hossman" created="Fri, 14 Jul 2023 22:07:00 +0000"  >&lt;p&gt;FYI: The new &lt;tt&gt;testConcurrentAccess()&lt;/tt&gt; added by this issue has failed in roughly 33% of all jenkins builds that have run it since it was committed&lt;/p&gt;</comment>
                            <comment id="17744607" author="jira-bot" created="Wed, 19 Jul 2023 12:47:26 +0000"  >&lt;p&gt;Commit 9cdf0e4c13eefb7fc2ec1771b5a41888f0102568 in solr&apos;s branch refs/heads/main from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=9cdf0e4c13e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=9cdf0e4c13e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16871&quot; title=&quot;Race condition for coordinator node init&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16871&quot;&gt;&lt;del&gt;SOLR-16871&lt;/del&gt;&lt;/a&gt;: Fix for duplicated replica added from first coordinator node (#1794)&lt;/p&gt;
</comment>
                            <comment id="17744610" author="jira-bot" created="Wed, 19 Jul 2023 12:49:07 +0000"  >&lt;p&gt;Commit 32e16cb05f72cb1b51e1fe24ecc705e73d054909 in solr&apos;s branch refs/heads/branch_9x from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=32e16cb05f7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=32e16cb05f7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16871&quot; title=&quot;Race condition for coordinator node init&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16871&quot;&gt;&lt;del&gt;SOLR-16871&lt;/del&gt;&lt;/a&gt;: Fix for duplicated replica added from first coordinator node (#1794)&lt;/p&gt;
</comment>
                            <comment id="17746392" author="jira-bot" created="Mon, 24 Jul 2023 11:02:21 +0000"  >&lt;p&gt;Commit ccc7ca65f12ee604c2194105b1b7c44822ad15ae in solr&apos;s branch refs/heads/main from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=ccc7ca65f12&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=ccc7ca65f12&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16871&quot; title=&quot;Race condition for coordinator node init&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16871&quot;&gt;&lt;del&gt;SOLR-16871&lt;/del&gt;&lt;/a&gt;: Synchronize on a larger block to avoid race condition in CoordinatorHttpSolrCall init (#1800)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Synchronize to avoid race condition in CoordinatorHttpSolrCall&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;./gradlew tidy&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17746394" author="jira-bot" created="Mon, 24 Jul 2023 11:03:49 +0000"  >&lt;p&gt;Commit 848f1b04165bdb7e84c811b571a65719a0e3bb2c in solr&apos;s branch refs/heads/branch_9x from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=848f1b04165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=848f1b04165&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16871&quot; title=&quot;Race condition for coordinator node init&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16871&quot;&gt;&lt;del&gt;SOLR-16871&lt;/del&gt;&lt;/a&gt;: Synchronize on a larger block to avoid race condition in CoordinatorHttpSolrCall init (#1800)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Synchronize to avoid race condition in CoordinatorHttpSolrCall&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;./gradlew tidy&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 16 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1j0co:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>