<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:43:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14172] Collection metadata remains in zookeeper if too many shards requested</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14172</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When I try to create a collection and request too many shards, collection creation fails with the expected error message:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ curl -i --retry 5 -s -L -k --negotiate -u : &apos;http://asalamon-cdpd-rebase831-a-1.vpc.cloudera.com:8983/solr/admin/collections?action=CREATE&amp;amp;name=TooManyShardstest1&amp;amp;numShards=4&amp;amp;collection.configName=zk_init_too&amp;amp;maxShardsPerNode=1&apos;
HTTP/1.1 400 Bad Request
Content-Type: application/json;charset=utf-8
Content-Length: 1562


{
  &quot;responseHeader&quot;:{
    &quot;status&quot;:400,
    &quot;QTime&quot;:122},
  &quot;Operation create caused exception:&quot;:&quot;org.apache.solr.common.SolrException:org.apache.solr.common.SolrException: Cannot create collection TooManyShardstest1. Value of maxShardsPerNode is 1, and the number of nodes currently live or live and part of your createNodeSet is 3. This allows a maximum of 3 to be created. Value of numShards is 4, value of nrtReplicas is 1, value of tlogReplicas is 0 and value of pullReplicas is 0. This requires 4 shards to be created (higher than the allowed number)&quot;,
  &quot;exception&quot;:{
    &quot;msg&quot;:&quot;Cannot create collection TooManyShardstest1. Value of maxShardsPerNode is 1, and the number of nodes currently live or live and part of your createNodeSet is 3. This allows a maximum of 3 to be created. Value of numShards is 4, value of nrtReplicas is 1, value of tlogReplicas is 0 and value of pullReplicas is 0. This requires 4 shards to be created (higher than the allowed number)&quot;,
    &quot;rspCode&quot;:400},
  &quot;error&quot;:{
    &quot;metadata&quot;:[
      &quot;error-class&quot;,&quot;org.apache.solr.common.SolrException&quot;,
      &quot;root-error-class&quot;,&quot;org.apache.solr.common.SolrException&quot;],
    &quot;msg&quot;:&quot;Cannot create collection TooManyShardstest1. Value of maxShardsPerNode is 1, and the number of nodes currently live or live and part of your createNodeSet is 3. This allows a maximum of 3 to be created. Value of numShards is 4, value of nrtReplicas is 1, value of tlogReplicas is 0 and value of pullReplicas is 0. This requires 4 shards to be created (higher than the allowed number)&quot;,
    &quot;code&quot;:400}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Although the collection creation was not successful if I list the collections it shows the new collection:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ solr&#160; collection --list&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;
TooManyShardstest1 (1) 
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Looks like metadata remains in Zookeeper:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ zkcli.sh -zkhost asalamon-cdpd-rebase831-a-1.vpc.cloudera.com:2181/solr -cmd ls /collections
INFO  - 2020-01-06 04:54:01.851; org.apache.solr.common.cloud.ConnectionManager; Waiting for client to connect to ZooKeeper
INFO  - 2020-01-06 04:54:01.880; org.apache.solr.common.cloud.ConnectionManager; zkClient has connected
INFO  - 2020-01-06 04:54:01.881; org.apache.solr.common.cloud.ConnectionManager; Client is connected to ZooKeeper
/collections (1)
 /collections/TooManyShardstest1 (1)
 DATA:
     {&quot;configName&quot;:&quot;zk_init_too&quot;}
  /collections/TooManyShardstest1/state.json (0)
  DATA:
      {&quot;TooManyShardstest1&quot;:{
          &quot;pullReplicas&quot;:&quot;0&quot;,
          &quot;replicationFactor&quot;:&quot;1&quot;,
          &quot;router&quot;:{&quot;name&quot;:&quot;compositeId&quot;},
          &quot;maxShardsPerNode&quot;:&quot;1&quot;,
          &quot;autoAddReplicas&quot;:&quot;false&quot;,
          &quot;nrtReplicas&quot;:&quot;1&quot;,
          &quot;tlogReplicas&quot;:&quot;0&quot;,
          &quot;shards&quot;:{
            &quot;shard1&quot;:{
              &quot;range&quot;:&quot;80000000-bfffffff&quot;,
              &quot;state&quot;:&quot;active&quot;,
              &quot;replicas&quot;:{}},
            &quot;shard2&quot;:{
              &quot;range&quot;:&quot;c0000000-ffffffff&quot;,
              &quot;state&quot;:&quot;active&quot;,
              &quot;replicas&quot;:{}},
            &quot;shard3&quot;:{
              &quot;range&quot;:&quot;0-3fffffff&quot;,
              &quot;state&quot;:&quot;active&quot;,
              &quot;replicas&quot;:{}},
            &quot;shard4&quot;:{
              &quot;range&quot;:&quot;40000000-7fffffff&quot;,
              &quot;state&quot;:&quot;active&quot;,
              &quot;replicas&quot;:{}}}}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13277916">SOLR-14172</key>
            <summary>Collection metadata remains in zookeeper if too many shards requested</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="asalamon74">Andras Salamon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jan 2020 12:26:22 +0000</created>
                <updated>Tue, 24 Mar 2020 12:45:47 +0000</updated>
                            <resolved>Thu, 23 Jan 2020 09:56:47 +0000</resolved>
                                    <version>8.3.1</version>
                                    <fixVersion>8.5</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17009670" author="asalamon74" created="Tue, 7 Jan 2020 12:28:03 +0000"  >&lt;p&gt;A similar problem was fixed in this commit:&#160;&lt;a href=&quot;https://github.com/apache/lucene-solr/commit/5670d612e3f2512d85c972b5fc717586118a19d5#diff-992163d381222cc6d8640b791b030a0b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/commit/5670d612e3f2512d85c972b5fc717586118a19d5#diff-992163d381222cc6d8640b791b030a0b&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17021869" author="shalinmangar" created="Thu, 23 Jan 2020 08:59:33 +0000"  >&lt;p&gt;This patch incorporates the test added by Andras Salamon in PR #1152 but the actual fix is slightly different.&lt;/p&gt;

&lt;p&gt;This patch changes the buildReplicaPositions method to throw an AssignmentException instead of SolrException in case the maxShardsPerNode is insufficient. It also changes the Create Collection API to return a BAD_REQUEST code instead of SERVER_ERROR in case of assignment exception. I&apos;ll note this behavior change in the upgrade notes.&lt;/p&gt;</comment>
                            <comment id="17021890" author="shalinmangar" created="Thu, 23 Jan 2020 09:44:09 +0000"  >&lt;p&gt;I attached a new patch which adds a failure message in case the collection creation request is successful.&lt;/p&gt;</comment>
                            <comment id="17021903" author="jira-bot" created="Thu, 23 Jan 2020 09:50:08 +0000"  >&lt;p&gt;Commit 84270dc6cfae79efccea188175b07e43c6b5d5b7 in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=84270dc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=84270dc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14172&quot; title=&quot;Collection metadata remains in zookeeper if too many shards requested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14172&quot;&gt;&lt;del&gt;SOLR-14172&lt;/del&gt;&lt;/a&gt;: Collection metadata remains in zookeeper if too many shards are requested.&lt;/p&gt;

&lt;p&gt;This also fixes a bug where an inability to assign a node based on existing autoscaling policy resulted in a server error instead of a bad request.&lt;/p&gt;

&lt;p&gt;This closes #1152.&lt;/p&gt;</comment>
                            <comment id="17021904" author="jira-bot" created="Thu, 23 Jan 2020 09:51:36 +0000"  >&lt;p&gt;Commit 6458d4f63e38dfb37356b29c5bb8a72f6ce73398 in lucene-solr&apos;s branch refs/heads/branch_8x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=6458d4f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=6458d4f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14172&quot; title=&quot;Collection metadata remains in zookeeper if too many shards requested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14172&quot;&gt;&lt;del&gt;SOLR-14172&lt;/del&gt;&lt;/a&gt;: Collection metadata remains in zookeeper if too many shards are requested.&lt;/p&gt;

&lt;p&gt;This also fixes a bug where an inability to assign a node based on existing autoscaling policy resulted in a server error instead of a bad request.&lt;/p&gt;

&lt;p&gt;This closes #1152.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 84270dc6cfae79efccea188175b07e43c6b5d5b7)&lt;/p&gt;</comment>
                            <comment id="17021906" author="shalinmangar" created="Thu, 23 Jan 2020 09:56:47 +0000"  >&lt;p&gt;Thanks Andras for the PR and Kevin for his review!&lt;/p&gt;</comment>
                            <comment id="17065664" author="romseygeek" created="Tue, 24 Mar 2020 12:45:47 +0000"  >&lt;p&gt;Bulk close for 8.5.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12991625" name="SOLR-14172.patch" size="4231" author="shalin" created="Thu, 23 Jan 2020 09:43:20 +0000"/>
                            <attachment id="12991617" name="SOLR-14172.patch" size="4120" author="shalin" created="Thu, 23 Jan 2020 08:56:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0a9ao:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>