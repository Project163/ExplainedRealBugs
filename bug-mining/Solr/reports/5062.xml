<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:01:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16809] Converge sysProp redaction logic in PropertiesRequestHandler and MetricsAPI</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16809</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently there are two APIs to get the sysProps from a Solr process.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/admin/info/properties&lt;/li&gt;
	&lt;li&gt;/admin/info/metrics&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Unfortunately the logic for redacting sensitive information is different and configured separately for these two endpoints.&lt;/p&gt;

&lt;p&gt;For /admin/info/properties redaction occurs if &quot;solr.redaction.system.enabled&quot; is set to true, which it is by default. Then a reg-ex matcher for the sysProp key can be configured by &quot;solr.redaction.system.pattern&quot;, and the default is &quot;.&lt;b&gt;password.&lt;/b&gt;&quot; (case-insensitive).&lt;/p&gt;

&lt;p&gt;For /admin/info/metrics, redaction always occurs. The default list of sensitive properties is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&quot;javax.net.ssl.keyStorePassword&quot;&lt;/li&gt;
	&lt;li&gt;&quot;javax.net.ssl.trustStorePassword&quot;&lt;/li&gt;
	&lt;li&gt;&quot;basicauth&quot;&lt;/li&gt;
	&lt;li&gt;&quot;zkDigestPassword&quot;&lt;/li&gt;
	&lt;li&gt;&quot;zkDigestReadonlyPassword&quot;&lt;/li&gt;
	&lt;li&gt;&quot;aws.secretKey&quot; // AWS SDK v1&lt;/li&gt;
	&lt;li&gt;&quot;aws.secretAccessKey&quot; // AWS SDK v2&lt;/li&gt;
	&lt;li&gt;&quot;http.proxyPassword&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Notice that a few of these do not include the word &quot;password&quot;. So the &quot;basicauth&quot; and &quot;aws.secretKey&quot; and &quot;aws.secretAccessKey&quot; options will be passed to the AdminUI by default.&lt;/p&gt;

&lt;p&gt;I suggest that we merge the logic between these two and have them be configurable the same way. I think having this list is important, but also having a blanket &quot;&lt;b&gt;(password|secret)&lt;/b&gt;&quot; filter is also safe.&lt;/p&gt;

&lt;p&gt;Unfortunately the Metrics API redaction list is only configurable in the solr.xml under the &amp;lt;metrics&amp;gt; tag, which doesn&apos;t really apply to /info/properties. So we will probably want to move that out from metrics (back-compat for 9x of course) and add an envVar/sysProp that will make it easier for users to configure.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13536765">SOLR-16809</key>
            <summary>Converge sysProp redaction logic in PropertiesRequestHandler and MetricsAPI</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houston">Houston Putman</assignee>
                                    <reporter username="houston">Houston Putman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 May 2023 16:41:16 +0000</created>
                <updated>Fri, 9 Feb 2024 16:44:33 +0000</updated>
                            <resolved>Wed, 5 Jul 2023 16:00:17 +0000</resolved>
                                                    <fixVersion>9.3</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17724022" author="houston" created="Thu, 18 May 2023 20:52:36 +0000"  >&lt;p&gt;I have an initial patch, but it needs documentation. Both for the new options, and the upgrade notes for the deprecations of the previous options.&lt;/p&gt;</comment>
                            <comment id="17724054" author="risdenk" created="Thu, 18 May 2023 23:39:49 +0000"  >&lt;p&gt;The approach to combine looks good. &lt;/p&gt;</comment>
                            <comment id="17725550" author="dsmiley" created="Tue, 23 May 2023 19:29:56 +0000"  >&lt;p&gt;Thanks for working on this.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Is &#8220;hiddenSysProps&#8221; the right terminology or would &#8220;redactedSysProps&#8221; make more sense?&lt;/li&gt;
	&lt;li&gt;getHiddenSysProps:  Should call Pattern.quote on each value before joining with a comma.  They used to not be regular expressions but now they are (right?).&lt;/li&gt;
	&lt;li&gt;DEFAULT_HIDDEN_SYS_PROPS: Can you use Set.of here instead of new HashSet(ArrayList.asList(&#8230;)) ?  I know it pre-existed this... I thought one of Kevin&apos;s grand refactorings caught these but maybe not some.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Do we know why the Metrics API exposed this, given it was redundant with something pre-existing?  It doesn&apos;t seem like a &quot;metric&quot;.  CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17737314" author="houston" created="Mon, 26 Jun 2023 19:08:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do we know why the Metrics API exposed this, given it was redundant with something pre-existing? It doesn&apos;t seem like a &quot;metric&quot;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It is for the placement plugins, notably the affinityPlacementPlugin. I guess Andrzej added it to the metrics API, since other information, such as Core Count, Disk Space, etc, was coming from the metrics API. But ultimately it probably shouldn&apos;t live in the metrics API...&lt;/p&gt;

&lt;p&gt;As for your suggestions, I don&apos;t have a preference between hidden and redacted. Both make sense because it&apos;s redacted in the Admin UI and hidden in the Metrics API. I can refactor to use either.&lt;/p&gt;

&lt;p&gt;I will fix the other two though.&lt;/p&gt;</comment>
                            <comment id="17737321" author="houston" created="Mon, 26 Jun 2023 19:41:28 +0000"  >&lt;p&gt;I have also documented the new option (which wasn&apos;t even documented before...), and included upgrade notes for deprecation and removal.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed your two comments David, besides the rename (which we can do, but I have no real opinion).&lt;/p&gt;</comment>
                            <comment id="17737351" author="dsmiley" created="Mon, 26 Jun 2023 21:27:20 +0000"  >&lt;p&gt;Thanks.&lt;br/&gt;
A concern I have is using String when really Pattern is a more accurate reflection of its type.&lt;/p&gt;</comment>
                            <comment id="17739230" author="houston" created="Fri, 30 Jun 2023 21:16:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Do you mean in the SolrXml code? Because the Strings get compiled to a Pattern in the NodeConfig constructor. I&apos;d have multiple pattern matchers, but apparently it&apos;s quicker to have one pattern with the individual cases separated by &quot;|&quot;s.&#160;&lt;/p&gt;</comment>
                            <comment id="17739233" author="dsmiley" created="Fri, 30 Jun 2023 21:48:26 +0000"  >&lt;p&gt;For example NodeConfig.getHiddenSysProps returns a Set&amp;lt;String&amp;gt;.&lt;br/&gt;
Anyway, as long as you have thought about where it&apos;s best to use Pattern, I&apos;m good with it.&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="17739234" author="houston" created="Fri, 30 Jun 2023 21:50:03 +0000"  >&lt;p&gt;Oh yeah, thought that might be the culprit. We can remove the method if we want, nothing uses it anymore. I just left it in case something wants more information down the line.&lt;/p&gt;

&lt;p&gt;Anyways I&apos;ll commit and backport this for the 9.3 release.&lt;/p&gt;</comment>
                            <comment id="17745724" author="houston" created="Fri, 21 Jul 2023 20:40:32 +0000"  >&lt;p&gt;Closing after the 9.3.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="13551140">SOLR-16984</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13060872" name="SOLR-16809-1.patch" size="36153" author="houston" created="Mon, 26 Jun 2023 19:40:20 +0000"/>
                            <attachment id="13058333" name="SOLR-16809.patch" size="30558" author="houston" created="Thu, 18 May 2023 20:51:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1hzmg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>