<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:37:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4933] org.apache.solr.cloud.ShardSplitTest.testDistribSearch fails often with a 500 error.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4933</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description></description>
                <environment></environment>
        <key id="12653287">SOLR-4933</key>
            <summary>org.apache.solr.cloud.ShardSplitTest.testDistribSearch fails often with a 500 error.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jun 2013 22:18:59 +0000</created>
                <updated>Mon, 9 May 2016 18:45:17 +0000</updated>
                            <resolved>Fri, 5 Jul 2013 05:19:32 +0000</resolved>
                                                    <fixVersion>4.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13686090" author="markrmiller@gmail.com" created="Mon, 17 Jun 2013 22:19:12 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1 tests failed.
REGRESSION:  org.apache.solr.cloud.ShardSplitTest.testDistribSearch

Error Message:
Server at http://127.0.0.1:41393/fo/l returned non ok status:500, message:Server Error

Stack Trace:
org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: Server at http://127.0.0.1:41393/fo/l returned non ok status:500, message:Server Error
	at __randomizedtesting.SeedInfo.seed([B325BB39D1A2EAEE:32C33521A6FD8AD2]:0)
	at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:385)
	at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:180)
	at org.apache.solr.cloud.ShardSplitTest.splitShard(ShardSplitTest.java:228)
	at org.apache.solr.cloud.ShardSplitTest.doTest(ShardSplitTest.java:150)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13686097" author="markrmiller@gmail.com" created="Mon, 17 Jun 2013 22:27:33 +0000"  >&lt;p&gt;On a first pass the 500 error &lt;b&gt;looks&lt;/b&gt; like it&apos;s coming from...&lt;/p&gt;

&lt;p&gt;A sub shard that is created on the split command has just become a leader - it says it has no replicas during the sync phase.&lt;/p&gt;

&lt;p&gt;At around the same time, a request to wait on seeing a certain state fails because the node that it is made to complains it is not the leader.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;oasc.OverseerCollectionProcessor.processResponse ERROR Error from shard: 127.0.0.1:41393/fo/l org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: We are not the leader
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The wait that fails here seems to be:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        // wait for parent leader to acknowledge the sub-shard core
        log.info(&quot;Asking parent leader to wait for: &quot; + subShardName + &quot; to be alive on: &quot; + nodeName);
        CoreAdminRequest.WaitForState cmd = new CoreAdminRequest.WaitForState();
        cmd.setCoreName(subShardName);
        cmd.setNodeName(nodeName);
        cmd.setCoreNodeName(nodeName + &quot;_&quot; + subShardName);
        cmd.setState(ZkStateReader.ACTIVE);
        cmd.setCheckLive(true);
        cmd.setOnlyIfLeader(true);
        sendShardRequest(nodeName, new ModifiableSolrParams(cmd.getParams()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There a variety of reasons the leader might be briefly changing. There may be more to dig up here, but it looks like it also might be a good idea to be willing to retry this on this type of error.&lt;/p&gt;</comment>
                            <comment id="13686888" author="shalinmangar" created="Tue, 18 Jun 2013 16:18:56 +0000"  >&lt;p&gt;I marked &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4929&quot; title=&quot;(ChaosMonkey)ShardSplitTest fails often on jenkins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4929&quot;&gt;&lt;del&gt;SOLR-4929&lt;/del&gt;&lt;/a&gt; as duplicate to have all comments in one issue.&lt;/p&gt;

&lt;p&gt;It only happens on slow machines I think. I have never been able to reproduce it on my box.&lt;/p&gt;

&lt;p&gt;If this happens in a real production environment then the leader may be on a different box so we&apos;ll need to go and create the sub shard cores again (on the new leader box) so failing the split is correct. The split itself will be retried by the Overseer Collection Processor again but the test does not take that into account.&lt;/p&gt;</comment>
                            <comment id="13686892" author="markrmiller@gmail.com" created="Tue, 18 Jun 2013 16:23:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;The split itself will be retried by the Overseer Collection Processor again but the test does not take that into account.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh, okay - so the fix is really just fixing the test.&lt;/p&gt;

&lt;p&gt;Is it the same thing with the chaos monkey shard split test?&lt;/p&gt;
</comment>
                            <comment id="13686895" author="shalinmangar" created="Tue, 18 Jun 2013 16:26:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it the same thing with the chaos monkey shard split test?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes though there are other (separate) issues with the chaos monkey test. We need to start killing the overseer in there.&lt;/p&gt;</comment>
                            <comment id="13697354" author="markrmiller@gmail.com" created="Tue, 2 Jul 2013 00:13:07 +0000"  >&lt;p&gt;This fails constantly on my jenkins and pretty often on the other jenkins machines - what change has to be made to the test? I can take a crack at it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The split itself will be retried by the Overseer Collection Processor again but the test does not take that into account.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It seems like the this is not just a test problem then - it&apos;s the call to submit the cmd through the collections api that returns a failure - if the overseer is going to retry, I don&apos;t think that command should return a fail. It should probably wait until the split is done (taking into account retries) and then return the result when it actually knows it. Otherwise it claims the call failed, but it may succeed on the retry.&lt;/p&gt;

</comment>
                            <comment id="13697453" author="jira-bot" created="Tue, 2 Jul 2013 03:10:46 +0000"  >&lt;p&gt;Commit 1498763 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1498763&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1498763&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4933&quot; title=&quot;org.apache.solr.cloud.ShardSplitTest.testDistribSearch fails often with a 500 error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4933&quot;&gt;&lt;del&gt;SOLR-4933&lt;/del&gt;&lt;/a&gt;: if shard split fails with 500, wait a while to see if it succeeds on a retry&lt;/p&gt;</comment>
                            <comment id="13697456" author="jira-bot" created="Tue, 2 Jul 2013 03:13:31 +0000"  >&lt;p&gt;Commit 1498764 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1498764&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1498764&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4933&quot; title=&quot;org.apache.solr.cloud.ShardSplitTest.testDistribSearch fails often with a 500 error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4933&quot;&gt;&lt;del&gt;SOLR-4933&lt;/del&gt;&lt;/a&gt;: if shard split fails with 500, wait a while to see if it succeeds on a retry&lt;/p&gt;</comment>
                            <comment id="13697459" author="markrmiller@gmail.com" created="Tue, 2 Jul 2013 03:22:36 +0000"  >&lt;p&gt;side note: just hit a rare fail here - like 1 out of 40:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: Wrong doc count on shard1_1 expected:&amp;lt;85&amp;gt; but was:&amp;lt;84&amp;gt;
	at __randomizedtesting.SeedInfo.seed([9515158A26713D9D:85D3018DA6DAAC74]:0)
	at org.junit.Assert.fail(Assert.java:93)
	at org.junit.Assert.failNotEquals(Assert.java:647)
	at org.junit.Assert.assertEquals(Assert.java:128)
	at org.junit.Assert.assertEquals(Assert.java:472)
	at org.apache.solr.cloud.ShardSplitTest.checkDocCountsAndShardStates(ShardSplitTest.java:235)
	at org.apache.solr.cloud.ShardSplitTest.doTest(ShardSplitTest.java:163)
	at org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:835)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13697545" author="shalinmangar" created="Tue, 2 Jul 2013 06:20:59 +0000"  >&lt;p&gt;I was wrong. The split is not retried automatically by the overseer because the exception from coreadmin is just added to the response and not really thrown in OverseerCollectionProcessor. I&apos;ll take a stab at fixing the test.&lt;/p&gt;</comment>
                            <comment id="13697769" author="jira-bot" created="Tue, 2 Jul 2013 13:22:51 +0000"  >&lt;p&gt;Commit 1498923 from shalin@apache.org&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1498923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1498923&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4933&quot; title=&quot;org.apache.solr.cloud.ShardSplitTest.testDistribSearch fails often with a 500 error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4933&quot;&gt;&lt;del&gt;SOLR-4933&lt;/del&gt;&lt;/a&gt;: Retry splitshard three times before giving up&lt;/p&gt;</comment>
                            <comment id="13697780" author="jira-bot" created="Tue, 2 Jul 2013 13:27:13 +0000"  >&lt;p&gt;Commit 1498928 from shalin@apache.org&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1498928&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1498928&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4933&quot; title=&quot;org.apache.solr.cloud.ShardSplitTest.testDistribSearch fails often with a 500 error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4933&quot;&gt;&lt;del&gt;SOLR-4933&lt;/del&gt;&lt;/a&gt;: Retry splitshard three times before giving up&lt;/p&gt;</comment>
                            <comment id="13699337" author="markrmiller@gmail.com" created="Wed, 3 Jul 2013 19:11:52 +0000"  >&lt;p&gt;This seems to have solved things for me.&lt;/p&gt;</comment>
                            <comment id="13700460" author="shalinmangar" created="Fri, 5 Jul 2013 05:19:32 +0000"  >&lt;p&gt;There have not been any failures in jenkins since the commit.&lt;/p&gt;</comment>
                            <comment id="13716889" author="steve_rowe" created="Tue, 23 Jul 2013 18:38:53 +0000"  >&lt;p&gt;Bulk close resolved 4.4 issues&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12653028">SOLR-4929</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333610</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ljsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333938</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>