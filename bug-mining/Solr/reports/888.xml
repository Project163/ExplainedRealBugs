<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:27:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3392] searcher leak when openSearcher=false</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3392</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;It appears we have a searcher leak where SolrIndexSearcher instances are sometimes not being closed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12552003">SOLR-3392</key>
            <summary>searcher leak when openSearcher=false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Sat, 21 Apr 2012 18:44:55 +0000</created>
                <updated>Fri, 10 May 2013 10:40:33 +0000</updated>
                            <resolved>Sun, 22 Apr 2012 15:08:46 +0000</resolved>
                                                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13258916" author="dweiss" created="Sat, 21 Apr 2012 18:51:03 +0000"  >&lt;p&gt;Are you talking about the &quot;searchers opened: N, closed: N - Y&quot; errors? This has been relatively frequent but I couldn&apos;t reproduce.&lt;/p&gt;</comment>
                            <comment id="13258919" author="yseeley@gmail.com" created="Sat, 21 Apr 2012 18:55:48 +0000"  >&lt;p&gt;While trying to reproduce the file descriptor leak that Sami and others have reported, I went to&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/#/singlecore/plugins/core&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/#/singlecore/plugins/core&lt;/a&gt;&lt;br/&gt;
and noticed that I had 4 open SolrIndexSearcher instances - which means we have a searcher leak somehow.&lt;/p&gt;

&lt;p&gt;I&apos;m still trying to track down exactly what&apos;s causing it, and why none of our tests catch it (and all of our tests check the number of opens/closes of SolrIndexSearcher instances)&lt;/p&gt;</comment>
                            <comment id="13258920" author="dweiss" created="Sat, 21 Apr 2012 18:59:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;and why none of our tests catch it &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But they do? There were a number of failures when the number of closes/opens mismatched and failed the build. Maybe I don&apos;t understand what you mean.&lt;/p&gt;</comment>
                            <comment id="13258924" author="dweiss" created="Sat, 21 Apr 2012 19:02:29 +0000"  >&lt;p&gt;This one is quite old, I just found it first &amp;#8211; &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;build	14-Apr-2012 06:17:47	    [junit] 149810 T1 oas.SolrTestCaseJ4.endTrackingSearchers SEVERE ERROR: SolrIndexSearcher opens=70 closes=69
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I always assumed this is something to worry about but never could reproduce it with the same seed.&lt;/p&gt;</comment>
                            <comment id="13258929" author="yseeley@gmail.com" created="Sat, 21 Apr 2012 19:08:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;But they do? There were a number of failures when the number of closes/opens mismatched and failed the build.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Those normally don&apos;t fail on my box - just our Jenkins box which is really slow + has weird stuff like blackhole configured.  Talking to Mark, it sounds like the cause of those open/close searcher mismatches are because another thread is still running (like a recovery/replication thread) and still has a searcher open (hence it doesn&apos;t look like a searcher management bug).&lt;/p&gt;

&lt;p&gt;The type of bug I&apos;m looking at would be a searcher management bug not related to thread safety and should be 100% reproducible.&lt;/p&gt;</comment>
                            <comment id="13258932" author="dweiss" created="Sat, 21 Apr 2012 19:13:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;Those normally don&apos;t fail on my box - just our Jenkins box which is really slow +&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok, thanks for clarification. Those I mentioned happened on our server where I was running Lucene tests for some time too (and that isn&apos;t slow). But maybe they were side effects of something else.&lt;/p&gt;</comment>
                            <comment id="13259089" author="yseeley@gmail.com" created="Sun, 22 Apr 2012 15:08:46 +0000"  >&lt;p&gt;I just committed a fix - it was a really simple silly bug. When openSearcher=false, we requested a new searcher but then never decremented it when we were done.  Although the getSearcher() code itself had good test coverage (that&apos;s the more complicated code I was worried about), the caller in this specific case (DirectUpdateHandler2) did not.&lt;/p&gt;</comment>
                            <comment id="13259159" author="dweiss" created="Sun, 22 Apr 2012 16:01:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-tests-only-trunk/13383/consoleText&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-tests-only-trunk/13383/consoleText&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Just a note &amp;#8211; a recent build with &quot;SolrIndexSearcher opens=74 closes=73&quot; mismatch (suite level).&lt;/p&gt;</comment>
                            <comment id="13259164" author="yseeley@gmail.com" created="Sun, 22 Apr 2012 16:21:46 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]    &amp;gt; (@AfterClass output)
   [junit4]   2&amp;gt; 35484 T1048 oash.SnapPuller.fetchLatestIndex SEVERE Master at: http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:40685/solr/replication is not available. Index fetch failed. Exception: Connect to localhost:40685 timed out
&lt;/span&gt;   [junit4]   2&amp;gt; 153931 T846 oas.SolrTestCaseJ4.endTrackingSearchers SEVERE ERROR: SolrIndexSearcher opens=74 closes=73
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s often the case that an earlier failure can cause tests to abort in such ways that not everything is cleaned up and you&apos;ll also see a searcher mismatch error.&lt;/p&gt;

&lt;p&gt;Perhaps there&apos;s a way to tell if a test has already failed, then this open/closed searcher test can be skipped?&lt;/p&gt;</comment>
                            <comment id="13259165" author="rcmuir" created="Sun, 22 Apr 2012 16:26:22 +0000"  >&lt;p&gt;I think LuceneTestCase.testsFailed boolean variable should work?&lt;/p&gt;

&lt;p&gt;LuceneTestCase.afterClass uses this logic too, for the same reason.&lt;/p&gt;</comment>
                            <comment id="13259174" author="dweiss" created="Sun, 22 Apr 2012 16:40:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;Perhaps there&apos;s a way to tell if a test has already failed, then this open/closed searcher test can be skipped?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What Robert pointed to is ok. The &quot;nicest&quot; way to cleanup-on-success only is to write a test rule and cleanup/ make assertions if the sub-statement passes without throwing an exception. @Before*/After* hooks are always executed, regardless of the test output (failure or no failure).&lt;/p&gt;

&lt;p&gt;I realize the number of nested stack entries from rules can bother some, but it is really a clean separation of concerns and the ordering is then explicit (both in the code and at runtime) which is nice.&lt;/p&gt;

&lt;p&gt;I&apos;m not asking you to fix this &amp;#8211; I will be biting into LuceneTestCase at some point (have some urgent stuff piled up right now) and I will try to clean up @Before/@After* hooks as well so that they&apos;re not a single blob of various checks and things.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236972</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03exz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17854</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>