<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:36:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13091] REBALANCELEADERS is broken</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13091</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;From the user&apos;s list, the REBALANCELEADERS API doesn&apos;t seem to work correctly. Manual testing shows the problem.&lt;/p&gt;

&lt;p&gt;It&apos;s disturbing that the unit test doesn&apos;t catch this. That&apos;ll be the first thing to fix.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13206062">SOLR-13091</key>
            <summary>REBALANCELEADERS is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Dec 2018 01:06:30 +0000</created>
                <updated>Sat, 8 Jun 2019 15:00:44 +0000</updated>
                            <resolved>Sun, 20 Jan 2019 03:38:18 +0000</resolved>
                                    <version>7.6</version>
                                    <fixVersion>7.7</fixVersion>
                    <fixVersion>8.0</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16729729" author="erickerickson" created="Thu, 27 Dec 2018 16:56:06 +0000"  >&lt;p&gt;This is a test-only patch illustrating the problem with distributing any shardUnique property. It doesn&apos;t matter whether the property is an arbitrary one with the shardUnique flag explicitly set or preferredLeader without shardUnique set.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t matter whether the property is capitalized or not.&lt;/p&gt;

&lt;p&gt;Unfortunately, it doesn&apos;t reproduce with a particular seed, It does fail about 25% of the time when I beasted it overnight.&lt;/p&gt;

&lt;p&gt;What&apos;s particularly interesting is that when the test runs, it uses one of two methods to&#160;set the property, one with the admin API and one just making a request setting parameters. ONLY the one setting parameters fails, see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
setPropWithStandardRequest&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;All the failures are in: testBalancePropertySliceUnique&lt;/p&gt;

&lt;p&gt;I&apos;ll be digging more later, but wanted to preserve this. NOTE: the other test that sets a shardUnique property manually (and repeatedly) using one of those two methods works all the time, it&apos;s only the test that tries to have the properties distributed manually that fails.&#160;&lt;/p&gt;

&lt;p&gt;The test code is not complete, has nocommits in it and the like as well as extraneous output....&lt;/p&gt;

&lt;p&gt;What you get is a shard with the supposedly unique property twice, e.g.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&quot;shard2&quot;:{&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; &quot;range&quot;:&quot;c0000000-ffffffff&quot;,&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; &quot;state&quot;:&quot;active&quot;,&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; &quot;replicas&quot;:&lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
 [junit4] &amp;gt; &amp;quot;core_node10&amp;quot;}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;,&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; &quot;core_node11&quot;:&lt;br/&gt;
Unknown macro: { &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; &quot;core&quot;}&lt;br/&gt;
,&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; &quot;core_node13&quot;:&lt;br/&gt;
Unknown macro: { &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; &amp;gt; &quot;core&quot;}&lt;br/&gt;
}},&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16730342" author="erickerickson" created="Fri, 28 Dec 2018 16:02:19 +0000"  >&lt;p&gt;Bah, the tests weren&apos;t doing what I thought, ignore it for now. Still can&apos;t reproduce problems via a test&#160;and now I can&apos;t manually either.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16741739" author="erickerickson" created="Mon, 14 Jan 2019 03:21:16 +0000"  >&lt;p&gt;Preliminary patch. Lots of nocommits and extra cruft laying around.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Significantly improved test, should&lt;/p&gt;

&lt;p&gt;&amp;gt; stop allowing more than one unique property per shard&lt;/p&gt;

&lt;p&gt;&amp;gt; successfully rebalance&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Definitely a WIP, haven&apos;t run precommit or full test suite, putting up to record progress and invite comments.&lt;/p&gt;

&lt;p&gt;NOTE: Much of the code in RebalanceLeader.java is a result of refactoring into more bite-sized chunks.&lt;/p&gt;

&lt;p&gt;More to come.&lt;/p&gt;</comment>
                            <comment id="16747324" author="jira-bot" created="Sun, 20 Jan 2019 03:20:50 +0000"  >&lt;p&gt;Commit a692d05a909e1ce385c56c087cb62911c27b5f5b in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a692d05&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a692d05&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13091&quot; title=&quot;REBALANCELEADERS is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13091&quot;&gt;&lt;del&gt;SOLR-13091&lt;/del&gt;&lt;/a&gt;: REBALANCELEADERS is broken&lt;/p&gt;</comment>
                            <comment id="16747326" author="jira-bot" created="Sun, 20 Jan 2019 03:33:36 +0000"  >&lt;p&gt;Commit 571ae2670a2435fb6e6bed2a6e9287cba6218a3e in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=571ae26&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=571ae26&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13091&quot; title=&quot;REBALANCELEADERS is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13091&quot;&gt;&lt;del&gt;SOLR-13091&lt;/del&gt;&lt;/a&gt;: REBALANCELEADERS is broken&lt;/p&gt;

&lt;p&gt;(cherry picked from commit a692d05a909e1ce385c56c087cb62911c27b5f5b)&lt;/p&gt;</comment>
                            <comment id="16747327" author="jira-bot" created="Sun, 20 Jan 2019 03:36:50 +0000"  >&lt;p&gt;Commit c11718d191286d2548160b12a1d1675afcdb5100 in lucene-solr&apos;s branch refs/heads/branch_7x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c11718d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c11718d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13091&quot; title=&quot;REBALANCELEADERS is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13091&quot;&gt;&lt;del&gt;SOLR-13091&lt;/del&gt;&lt;/a&gt;: REBALANCELEADERS is broken&lt;/p&gt;

&lt;p&gt;(cherry picked from commit a692d05a909e1ce385c56c087cb62911c27b5f5b)&lt;/p&gt;</comment>
                            <comment id="16747329" author="erickerickson" created="Sun, 20 Jan 2019 03:38:18 +0000"  >&lt;p&gt;Final patch attached.&lt;/p&gt;

&lt;p&gt;The code changes for this fix in RebalanceLeaders isn&apos;t as extensive as they look, I did some refactoring.&lt;/p&gt;

&lt;p&gt;The test file, OTOH, is pretty much rewritten. If we have similar breaks in the future I think the tests will catch them now.&lt;/p&gt;

&lt;p&gt;This also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10935&quot; title=&quot;BALANCESHARDUNIQUE does not distribute properties correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10935&quot;&gt;&lt;del&gt;SOLR-10935&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve changed the response. It should be more useful now. Probably tomorrow I&apos;ll fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11998&quot; title=&quot;RebalanceLeaders API broken response format with wt=JSON&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11998&quot;&gt;&lt;del&gt;SOLR-11998&lt;/del&gt;&lt;/a&gt; and write up more of the documentation in the reference guide. The short form is:&lt;/p&gt;

&lt;p&gt;1&amp;gt; I&apos;ve added an overall &quot;success&quot; entry which gives the status of the actual leadership .vs. the preferredLeader. Before, the code manipulated the leader election queue and assumed that if those manipulations worked OK, then the leadership would actually change. This version tests that directly.&lt;/p&gt;

&lt;p&gt;2&amp;gt; One question is what &quot;success&quot; is. In this case, success is returned if all the &lt;em&gt;active&lt;/em&gt; replicas that should be the leader are. So say you have a node that&apos;s down that has a replica on it that has the &quot;preferredLeader&quot; property set. &quot;success&quot; will be returned, along with an explanation.&lt;/p&gt;

&lt;p&gt;When I fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11998&quot; title=&quot;RebalanceLeaders API broken response format with wt=JSON&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11998&quot;&gt;&lt;del&gt;SOLR-11998&lt;/del&gt;&lt;/a&gt;, probably tomorrow I&apos;ll also update the ref guide with examples.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13081699">SOLR-10935</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12955538" name="SOLR-13091.patch" size="74345" author="erickerickson" created="Sun, 20 Jan 2019 03:31:29 +0000"/>
                            <attachment id="12954775" name="SOLR-13091.patch" size="60493" author="erickerickson" created="Mon, 14 Jan 2019 03:19:01 +0000"/>
                            <attachment id="12953160" name="SOLR-13091.patch" size="28676" author="erickerickson" created="Thu, 27 Dec 2018 16:38:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u008z4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>