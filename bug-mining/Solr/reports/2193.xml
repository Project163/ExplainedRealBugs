<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:59:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6510] select?collapse=... - fix NPE in Collapsing(FieldValue|Score)Collector</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6510</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Affects branch_4x but not trunk, collapse field must be docValues=true and shard empty (or with nothing indexed for the field?).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12741094">SOLR-6510</key>
            <summary>select?collapse=... - fix NPE in Collapsing(FieldValue|Score)Collector</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="cpoerschke">Christine Poerschke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Sep 2014 16:40:59 +0000</created>
                <updated>Tue, 12 Jan 2016 19:04:52 +0000</updated>
                            <resolved>Mon, 1 Dec 2014 02:54:03 +0000</resolved>
                                    <version>4.8.1</version>
                                    <fixVersion>4.10.3</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14131731" author="githubbot" created="Fri, 12 Sep 2014 16:41:55 +0000"  >&lt;p&gt;GitHub user cpoerschke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/94&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    select?collapse=... - fix NPE in Collapsing(FieldValue|Score)Collector&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/i#browse/SOLR-6510&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/i#browse/SOLR-6510&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Patch is against branch_4x where CollapsingQParserPlugin line 230&apos;s searcher.getAtomicReader().getSortedDocValues call could return null. On trunk the line 230 call has been replaced (by &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-5666&quot; title=&quot;Add UninvertingReader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-5666&quot;&gt;&lt;del&gt;LUCENE-5666&lt;/del&gt;&lt;/a&gt;) and so the CollapsingQParserPlugin part of the patch is not required.&lt;/p&gt;

&lt;p&gt;    The TestCollapseQParserPlugin change could go to branch_4x only or branch_4x and trunk.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/bloomberg/lucene-solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bloomberg/lucene-solr&lt;/a&gt; branch_4x-collapse-empty&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/94.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/94.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #94&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5e2968541221307a6ca7b397c61a040289421ac1&lt;br/&gt;
Author: Christine Poerschke &amp;lt;cpoerschke@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   2014-09-05T17:00:38Z&lt;/p&gt;

&lt;p&gt;    solr: select?collapse=... - fix NPE in Collapsing(FieldValue|Score)Collector&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14131883" author="joel.bernstein" created="Fri, 12 Sep 2014 18:29:30 +0000"  >&lt;p&gt;Thanks for the patch Christine. &lt;/p&gt;

&lt;p&gt;It looks I can call the FieldCache.getTermsIndex() and it should protect against the null. I&apos;ll test that out. If that works, I&apos;ll just remove the direct call to AtomicReader.getSortedDocValues(), which was probably never needed in the first place.&lt;/p&gt;</comment>
                            <comment id="14156773" author="dsmiley" created="Thu, 2 Oct 2014 17:14:27 +0000"  >&lt;p&gt;I&apos;d like to see this get fixed for the next Solr release.  Joel; if you&apos;re not going to be able to do it, I&apos;ll step in.  Just let me know.&lt;/p&gt;</comment>
                            <comment id="14156815" author="joel.bernstein" created="Thu, 2 Oct 2014 17:30:26 +0000"  >&lt;p&gt;If I&apos;ve been following things correctly the next release will be cut from branch_5x. The CollapsingQParserPlugin has a different implementation for 5.0 that uses the DocValues class, which I believe does not have this issue.&lt;/p&gt;

&lt;p&gt;More testing needs to be done with 5.0 implementation to understand the full effect of this change. The change was made as part of a large patch when the new DocValues class was introduced to Lucene.&lt;/p&gt;

&lt;p&gt;I&apos;ll open another ticket as a review for the CollapsingQParserPlugin 5.0. &lt;/p&gt;

&lt;p&gt;We can probably close this ticket though.&lt;/p&gt;</comment>
                            <comment id="14156822" author="joel.bernstein" created="Thu, 2 Oct 2014 17:32:20 +0000"  >&lt;p&gt;If there is going to be a 4.10.2, then we could fix this bug for that release though.&lt;/p&gt;</comment>
                            <comment id="14157794" author="andyetitmoves" created="Fri, 3 Oct 2014 08:26:15 +0000"  >&lt;p&gt;I see bugs getting tagged for a 4.10.2, though that may not be indicative of a release..&lt;/p&gt;</comment>
                            <comment id="14157927" author="joel.bernstein" created="Fri, 3 Oct 2014 12:17:24 +0000"  >&lt;p&gt;Ok, let&apos;s assume they&apos;ll be a 4.10.2. &lt;/p&gt;

&lt;p&gt;David, if you can take this one that will be great. Trunk and 5x shouldn&apos;t be affected by this though and I&apos;ll confirm this while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6581&quot; title=&quot;Efficient DocValues support and numeric collapse field implementations for Collapse and Expand&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6581&quot;&gt;&lt;del&gt;SOLR-6581&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14175514" author="dsmiley" created="Fri, 17 Oct 2014 20:45:26 +0000"  >&lt;p&gt;I looked into this a bit, applying Christine&apos;s patch.  It appears that there may be a bug in MultiDocValues (a DocValues view over multiple atomic segments).  If there is no value, you &lt;b&gt;don&apos;t&lt;/b&gt; get -1 for the ord, and hence the test complains.  The BytesRef shows to be the empty string.  I&apos;ll dig into this more later.&lt;/p&gt;</comment>
                            <comment id="14190867" author="dsmiley" created="Thu, 30 Oct 2014 21:20:49 +0000"  >&lt;p&gt;It&apos;ll take awhile for me to return to this, but the reproducing test failure for me is:  &lt;tt&gt;-Dtests.seed=1EFA19CE63B33EA:4C1BC8B5A1E50CDA&lt;/tt&gt;   The first query in testCollapseQueries failed.  I ran the test a bunch of times previously without failure, so this trip isn&apos;t common.&lt;/p&gt;</comment>
                            <comment id="14229265" author="dsmiley" created="Sun, 30 Nov 2014 22:46:20 +0000"  >&lt;p&gt;Aha.  The problem is that all the codecs are in rotation, to include Lucene42 which didn&apos;t support DocValues with empty values.  I&apos;ll add a suitable &amp;#64;SuppressCodecs list to the test and get this committed tonight.&lt;/p&gt;</comment>
                            <comment id="14229353" author="jira-bot" created="Mon, 1 Dec 2014 02:39:22 +0000"  >&lt;p&gt;Commit 1642620 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1642620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1642620&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6510&quot; title=&quot;select?collapse=... - fix NPE in Collapsing(FieldValue|Score)Collector&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6510&quot;&gt;&lt;del&gt;SOLR-6510&lt;/del&gt;&lt;/a&gt;: add tests for collapse on docvalues&lt;/p&gt;</comment>
                            <comment id="14229364" author="jira-bot" created="Mon, 1 Dec 2014 02:45:11 +0000"  >&lt;p&gt;Commit 1642621 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1642621&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1642621&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6510&quot; title=&quot;select?collapse=... - fix NPE in Collapsing(FieldValue|Score)Collector&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6510&quot;&gt;&lt;del&gt;SOLR-6510&lt;/del&gt;&lt;/a&gt;: add tests for collapse on docvalues&lt;/p&gt;</comment>
                            <comment id="14229372" author="jira-bot" created="Mon, 1 Dec 2014 02:52:46 +0000"  >&lt;p&gt;Commit 1642624 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1642624&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1642624&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6510&quot; title=&quot;select?collapse=... - fix NPE in Collapsing(FieldValue|Score)Collector&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6510&quot;&gt;&lt;del&gt;SOLR-6510&lt;/del&gt;&lt;/a&gt;: fix collapse on docvalues, empty index&lt;/p&gt;</comment>
                            <comment id="15094530" author="githubbot" created="Tue, 12 Jan 2016 19:04:52 +0000"  >&lt;p&gt;Github user cpoerschke closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/94&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12746742">SOLR-6604</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12684320" name="SOLR-6510_collapse_empty_docvalues.patch" size="17260" author="dsmiley" created="Sun, 30 Nov 2014 22:49:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zzbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>