<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:10:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8373] KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8373</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Kerberized solr nodes accept negotiate/spnego/kerberos requests and processes them. It also passes back to the client a cookie called &quot;hadoop.auth&quot; (which is currently unused, but will eventually be used for delegation tokens). &lt;/p&gt;

&lt;p&gt;If two or more nodes are on the same machine, they all send out the cookie which have the same domain (hostname) and same path, but different cookie values.&lt;/p&gt;

&lt;p&gt;Upon receipt at the client, if a cookie is rejected (which in this case will be), the client gets a&#8203;&#8203; TGT from the KDC. This is causing the heavy traffic at the KDC, plus intermittent &quot;Request is a replay&quot; (which indicates race condition at KDC while handing out the TGT for the same principal). I think having a (well configured) ticket cache is a potential solution, but having cookies get rejected is bad enough.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12919088">SOLR-8373</key>
            <summary>KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="ichattopadhyaya">Ishan Chattopadhyaya</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Dec 2015 21:20:56 +0000</created>
                <updated>Mon, 9 May 2016 18:45:05 +0000</updated>
                            <resolved>Tue, 29 Dec 2015 07:31:54 +0000</resolved>
                                                    <fixVersion>5.3.2</fixVersion>
                    <fixVersion>5.4.1</fixVersion>
                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15042250" author="ichattopadhyaya" created="Fri, 4 Dec 2015 21:22:19 +0000"  >&lt;p&gt;I&apos;m testing this patch that lets the clients ignore the cookies when talking to the kerberized Solr nodes.&lt;/p&gt;</comment>
                            <comment id="15045239" author="ichattopadhyaya" created="Mon, 7 Dec 2015 17:01:10 +0000"  >&lt;p&gt;It seems if ticket caching (credentials cache) isn&apos;t set up properly, ignoring cookies always (as in this patch) will have the client fetch the TGT from the KDC again. &lt;/p&gt;

&lt;p&gt;Since, fetching the ticket from the KDC (or even the ticket cache) and sending again and again isn&apos;t ideal, I am now looking to have a modified cookie spec implemented within the realms of HttpClient (which SolrJ depends on), which will restrict the cookies by host &lt;b&gt;and port&lt;/b&gt;, since the standard cookie RFCs and the browsers are okay to share cookies for the same host across different applications running on different ports. This will allow multiple solr nodes on the same host to work properly without the clients going to the KDC (or even ticket cache) for the tickets.&lt;/p&gt;

&lt;p&gt;I shall post a patch for this approach in a while.&lt;/p&gt;</comment>
                            <comment id="15045478" author="ichattopadhyaya" created="Mon, 7 Dec 2015 18:54:37 +0000"  >&lt;p&gt;Here&apos;s a patch I&apos;m working on. &lt;/p&gt;

&lt;p&gt;As of this patch, to invoke this, Solr nodes (that are on a shared hosting, so to speak) need to start Solr using the port number as part of the cookie domain:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;bin/solr -c -p 8983 -Dsolr.kerberos.cookie.domain=hostname:8983&lt;/tt&gt;&lt;br/&gt;
(This, obviously, cannot go into the solr.in.sh, and hence needs to be removed from there).&lt;/p&gt;

&lt;p&gt;Looking to see if there&apos;s something better that can be done to pass the port number to the kerberos authentication plugin.&lt;/p&gt;</comment>
                            <comment id="15045877" author="ichattopadhyaya" created="Mon, 7 Dec 2015 22:19:27 +0000"  >&lt;p&gt;Updated patch.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;All authentication plugins are CoreContainer aware. This was needed for letting the plugin know the port number on which Solr was started.&lt;/li&gt;
	&lt;li&gt;Introduces a new startup parameter, &lt;tt&gt;solr.kerberos.cookie.portaware=true&lt;/tt&gt;. When using SolrCloud, and this parameter is true, the cookies use both the host and the port to identify the domain. This should be enabled only on hosts where more than one solr node needs to be setup. This can go in the &lt;tt&gt;bin/solr.in.sh&lt;/tt&gt;.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15046540" author="ichattopadhyaya" created="Tue, 8 Dec 2015 07:56:03 +0000"  >&lt;p&gt;Added test cases, minor refactoring here and there. I did some end to end testing and the changes look good to me thus far.&lt;/p&gt;

&lt;p&gt;Was just wondering if the change to have all authentication and authorization plugins now accept a CoreContainer warrants a separate issue?&lt;/p&gt;</comment>
                            <comment id="15046568" author="noble.paul" created="Tue, 8 Dec 2015 08:24:18 +0000"  >&lt;p&gt;smaller patch eliminating the backward incompatible change to the &lt;tt&gt;init()&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15048661" author="jira-bot" created="Wed, 9 Dec 2015 13:21:58 +0000"  >&lt;p&gt;Commit 1718852 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1718852&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1718852&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8373&quot; title=&quot;KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8373&quot;&gt;&lt;del&gt;SOLR-8373&lt;/del&gt;&lt;/a&gt;: KerberosPlugin: Using multiple nodes on same machine leads clients to&lt;br/&gt;
  fetch TGT for every request&lt;/p&gt;</comment>
                            <comment id="15048670" author="jira-bot" created="Wed, 9 Dec 2015 13:34:00 +0000"  >&lt;p&gt;Commit 1718854 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1718854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1718854&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8373&quot; title=&quot;KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8373&quot;&gt;&lt;del&gt;SOLR-8373&lt;/del&gt;&lt;/a&gt;: KerberosPlugin: Using multiple nodes on same machine leads clients to&lt;br/&gt;
  fetch TGT for every request&lt;/p&gt;</comment>
                            <comment id="15070759" author="ichattopadhyaya" created="Thu, 24 Dec 2015 08:41:09 +0000"  >&lt;p&gt;Reopening for backporting to 5.3.2. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;, can you please commit the backport? Thanks.&lt;/p&gt;</comment>
                            <comment id="15071612" author="jira-bot" created="Fri, 25 Dec 2015 13:32:56 +0000"  >&lt;p&gt;Commit 1721679 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_3&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1721679&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1721679&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8373&quot; title=&quot;KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8373&quot;&gt;&lt;del&gt;SOLR-8373&lt;/del&gt;&lt;/a&gt;: KerberosPlugin: Using multiple nodes on same machine leads clients to&lt;br/&gt;
  fetch TGT for every request&lt;/p&gt;</comment>
                            <comment id="15071614" author="ichattopadhyaya" created="Fri, 25 Dec 2015 13:38:36 +0000"  >&lt;p&gt;Thanks Noble. Merry Christmas!&lt;/p&gt;</comment>
                            <comment id="15073574" author="jira-bot" created="Tue, 29 Dec 2015 07:14:03 +0000"  >&lt;p&gt;Commit 1722060 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1722060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1722060&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8373&quot; title=&quot;KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8373&quot;&gt;&lt;del&gt;SOLR-8373&lt;/del&gt;&lt;/a&gt;: Add change log entry to 5.3.2 section on trunk&lt;/p&gt;</comment>
                            <comment id="15073576" author="jira-bot" created="Tue, 29 Dec 2015 07:15:39 +0000"  >&lt;p&gt;Commit 1722061 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1722061&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1722061&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8373&quot; title=&quot;KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8373&quot;&gt;&lt;del&gt;SOLR-8373&lt;/del&gt;&lt;/a&gt;: Add change log entry to 5.3.2 section (merge from trunk)&lt;/p&gt;</comment>
                            <comment id="15093573" author="jira-bot" created="Tue, 12 Jan 2016 09:11:09 +0000"  >&lt;p&gt;Commit 1724179 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_4&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1724179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1724179&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8373&quot; title=&quot;KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8373&quot;&gt;&lt;del&gt;SOLR-8373&lt;/del&gt;&lt;/a&gt;: KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request&lt;/p&gt;</comment>
                            <comment id="15137877" author="jira-bot" created="Mon, 8 Feb 2016 22:35:42 +0000"  >&lt;p&gt;Commit 9ef144ddefe21f30c1c9ebd5246e7e03387488e1 in lucene-solr&apos;s branch refs/heads/branch_5_4 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9ef144d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9ef144d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8460&quot; title=&quot;/analysis/field doesn&amp;#39;t always handle custom attributes correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8460&quot;&gt;&lt;del&gt;SOLR-8460&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8373&quot; title=&quot;KerberosPlugin: Using multiple nodes on same machine leads clients to fetch TGT for every request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8373&quot;&gt;&lt;del&gt;SOLR-8373&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8422&quot; title=&quot;Basic Authentication plugin is not working correctly in solrcloud&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8422&quot;&gt;&lt;del&gt;SOLR-8422&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7462&quot; title=&quot;ArrayIndexOutOfBoundsException in RecordingJSONParser.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7462&quot;&gt;&lt;del&gt;SOLR-7462&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8470&quot; title=&quot;Make TTL of PKIAuthenticationPlugin&amp;#39;s tokens configurable through a system property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8470&quot;&gt;&lt;del&gt;SOLR-8470&lt;/del&gt;&lt;/a&gt;: Add CHANGES entries for 5.4.1.&lt;/p&gt;


&lt;p&gt;git-svn-id: &lt;a href=&quot;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene_solr_5_4@1724198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene_solr_5_4@1724198&lt;/a&gt; 13f79535-47bb-0310-9956-ffa450edef68&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12776271" name="SOLR-8373.patch" size="19262" author="noble.paul" created="Tue, 8 Dec 2015 08:24:18 +0000"/>
                            <attachment id="12776266" name="SOLR-8373.patch" size="23465" author="ichattopadhyaya" created="Tue, 8 Dec 2015 07:56:03 +0000"/>
                            <attachment id="12776195" name="SOLR-8373.patch" size="15435" author="ichattopadhyaya" created="Mon, 7 Dec 2015 22:19:27 +0000"/>
                            <attachment id="12776153" name="SOLR-8373.patch" size="5258" author="ichattopadhyaya" created="Mon, 7 Dec 2015 18:54:37 +0000"/>
                            <attachment id="12775858" name="SOLR-8373.patch" size="1062" author="ichattopadhyaya" created="Fri, 4 Dec 2015 21:22:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pfiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>