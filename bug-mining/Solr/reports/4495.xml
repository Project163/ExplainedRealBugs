<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:44:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14456] Compressed requests fail in SolrCloud when the request is routed internally by the serving solr node</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14456</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Solrclustersetup&quot;&gt;&lt;/a&gt;Solr cluster setup&lt;/h3&gt;
&lt;ul&gt;
	&lt;li&gt;Solr version: 7.7.2&lt;/li&gt;
	&lt;li&gt;Solr cloud enabled&lt;/li&gt;
	&lt;li&gt;Cluster topology: 6 nodes, 1 single collection, 10 shards and 3 replicas. 1 HTTP LB using Round Robin over all nodes&lt;/li&gt;
	&lt;li&gt;All cluster nodes have gzip enabled for all paths, all HTTP verbs and all MIME types.&lt;/li&gt;
	&lt;li&gt;Solr client: HttpSolrClient targeting the HTTP LB&lt;/li&gt;
&lt;/ul&gt;


&lt;h3&gt;&lt;a name=&quot;Problemdescription&quot;&gt;&lt;/a&gt;Problem description&lt;/h3&gt;

&lt;p&gt;When the Solr node that receives the request has to forward it&lt;br/&gt;
to a Solr Node that can actually perform the query, the response headers are added incorrectly to the response, causing any HTTP client to fail, whether it&apos;s a SolrClient or a basic HTTP client implementation with any other SDK.&lt;/p&gt;

&lt;p&gt;To simplify the case, let&apos;s try to start from the following repro scenario:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Start one node with cloud mode and port 8983&lt;/li&gt;
	&lt;li&gt;Create one single collection (1 shard, 1 replica)&lt;/li&gt;
	&lt;li&gt;Start another node with port 8984 and the previusly started zk (-z localhost:9983)&lt;/li&gt;
	&lt;li&gt;Start a java application and query the cluster using the node on port 8984 (the one that doesn&apos;t host the collection)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, then something like this happens:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The application queries node:8984 with compression enabled (&quot;Accept-Encoding: gzip&quot;)&lt;br/&gt;
and wt=javabin&lt;/li&gt;
	&lt;li&gt;Node:8984 can&apos;t perform the query and creates a http request behind the scenes to node:8983&lt;/li&gt;
	&lt;li&gt;Node:8983 returns a gzipped response with &quot;Content-Encoding: gzip&quot; and &quot;Content-Type:&lt;br/&gt;
application/octet-stream&quot;&lt;br/&gt;
Node:8984 adds the &quot;Content-Encoding: gzip&quot; header as character stream to the response&lt;br/&gt;
(it should be forwarded as &quot;Content-Encoding&quot; header, not character encoding)&lt;/li&gt;
	&lt;li&gt;HttpSolrClient receives a &quot;Content-Type: application/octet-stream;charset=gzip&quot;, causing&lt;br/&gt;
an exception.&lt;/li&gt;
	&lt;li&gt;HttpSolrClient tries to quietly close the connection, but since the stream is broken,&lt;br/&gt;
the Utils.consumeFully fails to actually consume the entity (it throws another exception in&lt;br/&gt;
GzipDecompressingEntity#getContent() with &quot;not in GZIP format&quot;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The exception thrown by HttpSolrClient is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.nio.charset.UnsupportedCharsetException: gzip
 at java.nio.charset.Charset.forName(Charset.java:531)
 at org.apache.http.entity.ContentType.create(ContentType.java:271)
 at org.apache.http.entity.ContentType.create(ContentType.java:261)
 at org.apache.http.entity.ContentType.parse(ContentType.java:319)
 at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:591)
 at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
 at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
 at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
 at org.apache.solr.client.solrj.SolrClient.query(SolrClient.java:1015)
 at org.apache.solr.client.solrj.SolrClient.query(SolrClient.java:1031)
 at org.apache.solr.client.solrj.SolrClient$$FastClassBySpringCGLIB$$7fcf36a0.invoke(&amp;lt;generated&amp;gt;)
 at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Solr version: 7.7.2&lt;/p&gt;

&lt;p&gt;Solr cloud enabled&lt;/p&gt;

&lt;p&gt;Cluster topology: 6 nodes, 1 single collection, 10 shards and 3 replicas. 1 HTTP LB using Round Robin over all nodes&lt;/p&gt;

&lt;p&gt;All cluster nodes have gzip enabled for all paths, all HTTP verbs and all MIME types.&lt;/p&gt;

&lt;p&gt;Solr client: HttpSolrClient targeting the HTTP LB&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;%C2%A0&quot;&gt;&lt;/a&gt;&#160;&lt;/h3&gt;</environment>
        <key id="13302413">SOLR-14456</key>
            <summary>Compressed requests fail in SolrCloud when the request is routed internally by the serving solr node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houston">Houston Putman</assignee>
                                    <reporter username="samuelgmartinez">Samuel Garc&#237;a Mart&#237;nez</reporter>
                        <labels>
                    </labels>
                <created>Sat, 2 May 2020 09:11:09 +0000</created>
                <updated>Wed, 15 Jul 2020 15:09:51 +0000</updated>
                            <resolved>Wed, 13 May 2020 19:32:16 +0000</resolved>
                                    <version>7.7.2</version>
                                    <fixVersion>8.6</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="9600">2h 40m</timespent>
                                <comments>
                            <comment id="17105770" author="jira-bot" created="Tue, 12 May 2020 21:50:22 +0000"  >&lt;p&gt;Commit adddab9d1466675cd79fd06c37592000a56841d2 in lucene-solr&apos;s branch refs/heads/master from Samuel Garc&#237;a Mart&#237;nez&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=adddab9d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=adddab9d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14456&quot; title=&quot;Compressed requests fail in SolrCloud when the request is routed internally by the serving solr node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14456&quot;&gt;&lt;del&gt;SOLR-14456&lt;/del&gt;&lt;/a&gt;: Fix Content-Type header forwarding on compressed requests (#1480)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Samuel Garc&#237;a Mart&#237;nez &amp;lt;samuelgma@inditex.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17106613" author="jira-bot" created="Wed, 13 May 2020 19:30:39 +0000"  >&lt;p&gt;Commit 7b32e68d054adb511999a97da8bcc2ad5a8a2428 in lucene-solr&apos;s branch refs/heads/branch_8x from Samuel Garc&#237;a Mart&#237;nez&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=7b32e68&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=7b32e68&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14456&quot; title=&quot;Compressed requests fail in SolrCloud when the request is routed internally by the serving solr node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14456&quot;&gt;&lt;del&gt;SOLR-14456&lt;/del&gt;&lt;/a&gt;: Fix Content-Type header forwarding on compressed requests (#1480)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Samuel Garc&#237;a Mart&#237;nez &amp;lt;samuelgma@inditex.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17158316" author="broustant" created="Wed, 15 Jul 2020 15:09:51 +0000"  >&lt;p&gt;Closing after the 8.6.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13302421">SOLR-14457</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ebc8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>