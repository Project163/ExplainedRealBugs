<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:33:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12309] CloudSolrClient.Builder constructors are not well documented</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12309</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I was having a lot of trouble figuring out how to create a CloudSolrClient object without using deprecated code.&lt;/p&gt;

&lt;p&gt;The no-arg constructor on the Builder object is deprecated, and the two remaining methods have similar signatures to each other.  It is not at all obvious how to successfully call the one that uses ZooKeeper to connect.  The javadoc is silent on the issue.  I did finally figure it out with a lot of googling, and I would like to save others the hassle.&lt;/p&gt;

&lt;p&gt;I believe that this is what the javadoc for the third ctor should say:&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;Provide a series of ZooKeeper hosts which will be used when configuring CloudSolrClient instances.  Optionally, include a chroot to be used when accessing the ZooKeeper database.&lt;/p&gt;

&lt;p&gt;Here are a couple of examples.  The first one has no chroot, the second one does:&lt;/p&gt;

&lt;p&gt;new CloudSolrClient.Builder(zkHosts, Optional.empty())&lt;br/&gt;
new CloudSolrClient.Builder(zkHosts, Optional.of(&quot;/solr&quot;))&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;The javadoc for the URL-based method should probably say something to indicate that it is easy to confuse with the ZK-based method.&lt;/p&gt;

&lt;p&gt;I have not yet looked at the current reference guide to see if that has any clarification.&lt;/p&gt;

&lt;p&gt;Is it a good idea to completely eliminate the ability to create a cloud client using a single string that matches the zkHost value used when starting Solr in cloud mode?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13156972">SOLR-12309</key>
            <summary>CloudSolrClient.Builder constructors are not well documented</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="elyograg">Shawn Heisey</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 May 2018 21:20:54 +0000</created>
                <updated>Wed, 8 Jul 2020 17:22:32 +0000</updated>
                            <resolved>Wed, 8 Jul 2020 17:22:32 +0000</resolved>
                                    <version>7.3</version>
                                                    <component>clients - java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16465806" author="gerlowskija" created="Mon, 7 May 2018 11:32:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it a good idea to completely eliminate the ability to create a cloud client using a single string that matches the zkHost value used when starting Solr in cloud mode?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I added the two new constructors over on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11629&quot; title=&quot;CloudSolrClient.Builder should accept a zk host&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11629&quot;&gt;&lt;del&gt;SOLR-11629&lt;/del&gt;&lt;/a&gt;.  They were added in an effort to make it clearer to users that these arguments were required, and that they weren&apos;t &quot;just another Builder setting&quot;, but truly required arguments.  But since they&apos;re both strings, an &lt;tt&gt;Optional&lt;/tt&gt;  was introduced on the ZK-based constructor (both to distinguish the method signatures, and because the chroot is a conceptually separate thing).&lt;/p&gt;

&lt;p&gt;So, if you consider the added &lt;tt&gt;Optional&lt;/tt&gt; param an evil; I&apos;d at least argue it&apos;s a necessary one, because it allows us to distinguish the conn string/URL options from the other 6 or 7 setters that aren&apos;t required in any way.&lt;/p&gt;

&lt;p&gt;Hope that clarifies things a bit.&lt;/p&gt;

&lt;p&gt;But I do agree with your main point that the Javadocs can be improved, and that an example or two would be particularly helpful.  I&apos;m happy to help draft up some text for this, unless you have already been thinking about it a lot and want to see it through?&lt;/p&gt;

&lt;p&gt;Do you remember trying any particular constructor arguments that didn&apos;t work out for you the first time?  Any missteps or false-impressions you had reading the existing Javadocs might be good to know, as guides for what needs added/corrected in the Javadocs.&lt;/p&gt;</comment>
                            <comment id="16465984" author="elyograg" created="Mon, 7 May 2018 14:51:33 +0000"  >&lt;p&gt;I&apos;m not saying that the use of Optional was bad.  Just that I couldn&apos;t figure it out how to use it by looking at the Builder javadoc.  I had to go searching for docs on Optional &amp;#8211; it was a object type I had never encountered before.  I suspect that this will be relatively common.&lt;/p&gt;

&lt;p&gt;A java developer gets to know the more basic objects really quickly and they become second nature.  Things like Optional are not so common.  Of course we can&apos;t provide documentation for EVERY native object we use, but when we use something outside what developers use every day, we ought to provide some simple examples.&lt;/p&gt;

&lt;p&gt;At first I just tried a List&amp;lt;String&amp;gt; with the individual zkHost values in it, which naturally failed, because it tried to interpret those strings as URLs.  I hadn&apos;t even quite noticed that the URL-based constructor was there when I did this.  I was using my IDE&apos;s language-specific capabilities to find the constructor, not reading the javadocs directly.  When I did a closer examination of the javadoc after that trial didn&apos;t work, I saw my mistake, but still didn&apos;t know how to actually create an Optional object to use the correct constructor.&lt;/p&gt;

&lt;p&gt;I think I did try &quot;null&quot; for the Optional argument.  If I did, I don&apos;t remember what the error for that was.  I can see what it does.&lt;/p&gt;

&lt;p&gt;The Optional could have been replaced with a simple String value to differentiate it from the URL-based constructor.  Most java developers already know how to deal with String.&lt;/p&gt;

&lt;p&gt;I&apos;m curious why the no-arg constructor and the fluent methods for providing the ZK definition were deprecated.  The Fluent paradigm that the builders use is pretty straightforward and still present, so that still seems like a relevant way to use the builder.&lt;/p&gt;</comment>
                            <comment id="16466035" author="elyograg" created="Mon, 7 May 2018 15:31:22 +0000"  >&lt;p&gt;I can understand the desire to not have lots of constructors.  We&apos;re using the fluent paradigm, so the most straighforward option is only one constructor &amp;#8211; the one with no arguments.  Complexity can then happen in the fluent methods, making confusion a lot less likely.  We could have signatures like these, where using one of them is required before build() will work:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;withZkHosts(List&amp;lt;String&amp;gt; zkHosts)&lt;/li&gt;
	&lt;li&gt;withZkHosts(List&amp;lt;String&amp;gt; zkHosts, String chroot)&lt;/li&gt;
	&lt;li&gt;withZkConnectString(String connectString)&lt;/li&gt;
	&lt;li&gt;withUrls(List&amp;lt;String&amp;gt; urls)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16480691" author="gerlowskija" created="Fri, 18 May 2018 14:01:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m curious why the no-arg constructor and the fluent methods for providing the ZK definition were deprecated.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Pre &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11629&quot; title=&quot;CloudSolrClient.Builder should accept a zk host&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11629&quot;&gt;&lt;del&gt;SOLR-11629&lt;/del&gt;&lt;/a&gt;, a new SolrJ user could type &lt;tt&gt;new CloudSolrClient.Builder().build()&lt;/tt&gt;, and wouldn&apos;t have an inkling that was wrong until they went to run or test their app and got an IllegalStateException and a so-so error message.  So Varun thought (and I agreed): if we could get users that correcting information sooner by enforcing it at compile time, then why wouldn&apos;t we?  Isn&apos;t the more intuitive API the one that&apos;s harder to take mis-steps with?&lt;/p&gt;

&lt;p&gt;In short: A 100% fluent API nudges users towards &quot;Runtime Exception Driven Development&quot; when some subset of the &lt;tt&gt;with*&lt;/tt&gt; APIs are actually mandatory.&lt;/p&gt;

&lt;p&gt;That said: I&apos;m not against the fluent API in general.  In fact, I added most of it back in the day.  But it&apos;s not the best way to handle arguments that are either (1) required, or (2) are mutually exclusive with another argument.  And Solr URL/ZK-string args fall into both of these categories.&lt;/p&gt;

&lt;p&gt;To get back to things I think we&apos;re already in agreement on though, I see your points about what&apos;s missing from the Javadocs for these constructors.  I took familiarity with java.util.Optional for granted, which was a mistake.  And some examples would go a long way.  (Particularly one with &lt;tt&gt;Optional.empty()&lt;/tt&gt; as the chroot).  I&apos;ll attach some Javadocs this weekend that hopefully improve things.&lt;/p&gt;</comment>
                            <comment id="16481368" author="elyograg" created="Fri, 18 May 2018 23:58:29 +0000"  >&lt;p&gt;I went looking for a way to have a completely fluent builder fail at compile time if it is not used correctly.  I actually found a way to do it.  The code is more complicated than exception-based failure, but I found it pretty easy to grasp after a few minutes.  SolrClient implementations thankfully only have one required parameter, which makes the implementation easier.&lt;/p&gt;

&lt;p&gt;I&apos;ve got a VERY incomplete patch that I&apos;ve been working on.  Will attach it.  Needs a lot of work and testing.  Here&apos;s an example of how it would be used:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; zkHosts = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
&lt;span class=&quot;code-comment&quot;&gt;// populate the zkHosts list
&lt;/span&gt;CloudSolrClient client1 = CloudSolrClient.zkBuilder().zkHosts(zkHosts).build();
CloudSolrClient client2 = CloudSolrClient.zkBuilder().zkHosts(zkHosts).zkChroot(&lt;span class=&quot;code-quote&quot;&gt;&quot;/solr&quot;&lt;/span&gt;).build();
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; urls = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
&lt;span class=&quot;code-comment&quot;&gt;// populate the urls list
&lt;/span&gt;CloudSolrClient client3 = CloudSolrClient.urlBuilder().solrUrls(urls).build();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the mandatory method (zkHosts or solrUrls) is omitted, an IDE will flag it as a compile error.  At the moment I don&apos;t have comments in the new code to explain its operation, but if I do this for real, it will be liberally documented with comments and I will make sure it all gets tested.&lt;/p&gt;</comment>
                            <comment id="16482726" author="gerlowskija" created="Mon, 21 May 2018 16:55:18 +0000"  >&lt;p&gt;Hmm, it&apos;s an interesting idea.  And I appreciate your humoring me in getting back the compile-time guidance/errors.  I guess I&apos;m just stuck understanding your underlying motivation for wanting to get the no-arg ctors back.  I can see few reasons that&apos;d make sense, I&apos;m just wondering which ones you&apos;re interested in, and how this patch helps them.&lt;/p&gt;

&lt;p&gt;Is your concern a slippery-slope explosion of ctors if SolrJ gains some more required arguments in the future?  Is your goal to make the Builder more fluent, and you see eliminating ctor arguments as a step towards that?  Or do you think this is more intuitive from an end-user perspective than the currently committed ctors/approach?  Or is there some other motivation?&lt;/p&gt;

&lt;p&gt;You patch does regain a no-arg ctor of sorts, but the next method call MUST be to provide the zk-host/url-list- you can&apos;t call setters in whatever order you please.  IMO that undercuts any gains in &quot;fluent&quot;-ness and leaves things looking oddly similar to the interface/ctors we have currently. &lt;/p&gt;

&lt;p&gt;Maybe you prefer this approach because of it prevents a potential ctor explosion if other SolrClient arguments become required.  But I&apos;m not sure whether it prevents the explosion, or just shuffles the &quot;bomb&quot; around to other types (tiny Builder implementations).&lt;/p&gt;

&lt;p&gt;I guess at this point my vote is still to improve the Javadocs and other documentation around this, rather than reworking the interface.  But I&apos;m happy to be overruled or have my misconceptions corrected.  I&apos;ll unassign myself in case you want to pursue a non-documentation solution.  I&apos;ll still work on Javadocs independently- they&apos;ll be useful for devs in the interim even if we end up changing the interface going forward.&lt;/p&gt;</comment>
                            <comment id="16482814" author="elyograg" created="Mon, 21 May 2018 17:53:59 +0000"  >&lt;p&gt;This issue started out as confusion over how Optional worked, and desiring better javadoc.  And maybe that&apos;s where it should stay.  Design shifts can happen in another issue.&lt;/p&gt;

&lt;p&gt;On the design:  I think the mix of constructors and fluent methods confuses the situation and gives an impression that we&apos;re undecided about whether we want fluent or not.&lt;/p&gt;

&lt;p&gt;Here&apos;s another idea, sort of a meld of both approaches, abandoning the use of constructors, and a lot less complicated than what I last proposed.  Implement these static methods, as the only non-deprecated ways of obtaining a Builder object:&lt;/p&gt;

&lt;p&gt;CloudSolrClient.builder(Collection&amp;lt;String&amp;gt; zkHosts, String chroot)&lt;br/&gt;
CloudSolrClient.builder(Collection&amp;lt;String&amp;gt; solrUrls)&lt;/p&gt;

&lt;p&gt;If there&apos;s no chroot, that argument can be null, which most Java developers understand fully.  There may still be situations where using certain fluent methods might throw Illegal* exceptions, but there wouldn&apos;t be very many situations like that.&lt;/p&gt;

&lt;p&gt;I think the other SolrClient implementations can get by with one builder() method that includes all required arguments.&lt;/p&gt;</comment>
                            <comment id="16528864" author="gerlowskija" created="Sat, 30 Jun 2018 19:14:25 +0000"  >&lt;p&gt;I&apos;ve finally gotten around to getting some examples together to add to the &lt;tt&gt;CloudSolrClient.Builder&lt;/tt&gt; javadocs.  Let me know if you&apos;ve got any feedback. Happy to tweak things.  Also, don&apos;t take these Javadocs as cementing the constructor-signatures.  I&apos;m +0 on changing the method signatures if you&apos;re interested in that.  But while the current ones exist, there&apos;s value in beefing up the Javadocs.&lt;/p&gt;</comment>
                            <comment id="16533673" author="jira-bot" created="Thu, 5 Jul 2018 13:44:43 +0000"  >&lt;p&gt;Commit 98768d9825c5a72043113166a4f462eb17b5e8db in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=98768d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=98768d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12309&quot; title=&quot;CloudSolrClient.Builder constructors are not well documented&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12309&quot;&gt;&lt;del&gt;SOLR-12309&lt;/del&gt;&lt;/a&gt;: Improve CloudSolrClient.Builder constructor Javadocs&lt;/p&gt;</comment>
                            <comment id="16533674" author="jira-bot" created="Thu, 5 Jul 2018 13:46:39 +0000"  >&lt;p&gt;Commit 7b6662c3d7e2f51cd2605ae567332f5dd5d014ac in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7b6662c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7b6662c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12309&quot; title=&quot;CloudSolrClient.Builder constructors are not well documented&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12309&quot;&gt;&lt;del&gt;SOLR-12309&lt;/del&gt;&lt;/a&gt;: Improve CloudSolrClient.Builder constructor Javadocs&lt;/p&gt;</comment>
                            <comment id="17153716" author="asalamon74" created="Wed, 8 Jul 2020 16:00:48 +0000"  >&lt;p&gt;It seems to me javadoc has been updated two years ago. I think this jira can be resolved.&lt;/p&gt;</comment>
                            <comment id="17153771" author="epugh" created="Wed, 8 Jul 2020 17:21:22 +0000"  >&lt;p&gt;Makes sense to me!   &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg&quot; class=&quot;user-hover&quot; rel=&quot;elyograg&quot;&gt;elyograg&lt;/a&gt; please reopen this if you disagree.&lt;/p&gt;</comment>
                            <comment id="17153775" author="epugh" created="Wed, 8 Jul 2020 17:22:32 +0000"  >&lt;p&gt;Not providing a version since it was way back in 7x branch this was fixed...&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12929830" name="SOLR-12309.patch" size="3409" author="gerlowskija" created="Sat, 30 Jun 2018 19:13:15 +0000"/>
                            <attachment id="12924224" name="fluent-builder-fail-compile-time.patch" size="13148" author="elyograg" created="Fri, 18 May 2018 23:58:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tbkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>