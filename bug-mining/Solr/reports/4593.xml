<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:46:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14969] Prevent creating multiple cores with the same name which leads to instabilities (race condition)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14969</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;CoreContainer#create does not correctly handle concurrent requests to create the same core. There&apos;s a race condition (see also existing TODO comment in the code), and CoreContainer#createFromDescriptor may be called subsequently for the same core name.&lt;/p&gt;

&lt;p&gt;The &lt;em&gt;second call&lt;/em&gt; then fails to create an IndexWriter, and exception handling causes an inconsistent CoreContainer state.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-10-27 00:29:25.350 ERROR (qtp2029754983-24) [   ] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: Error CREATEing SolrCore &apos;blueprint_acgqqafsogyc_comments&apos;: Unable to create core [blueprint_acgqqafsogyc_comments] Caused by: Lock held by this virtual machine: /var/solr/data/blueprint_acgqqafsogyc_comments/data/index/write.lock

         at org.apache.solr.core.CoreContainer.create(CoreContainer.java:1312)
         at org.apache.solr.handler.admin.CoreAdminOperation.lambda$static$0(CoreAdminOperation.java:95)
         at org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:367)
...
Caused by: org.apache.solr.common.SolrException: Unable to create core [blueprint_acgqqafsogyc_comments]
         at org.apache.solr.core.CoreContainer.createFromDescriptor(CoreContainer.java:1408)
         at org.apache.solr.core.CoreContainer.create(CoreContainer.java:1273)
         ... 47 more
Caused by: org.apache.solr.common.SolrException: Error opening new searcher
         at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:1071)
         at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:906)
         at org.apache.solr.core.CoreContainer.createFromDescriptor(CoreContainer.java:1387)
         ... 48 more
Caused by: org.apache.solr.common.SolrException: Error opening new searcher
         at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:2184)
         at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:2308)
         at org.apache.solr.core.SolrCore.initSearcher(SolrCore.java:1130)
         at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:1012)
         ... 50 more
Caused by: org.apache.lucene.store.LockObtainFailedException: Lock held by this virtual machine: /var/solr/data/blueprint_acgqqafsogyc_comments/data/index/write.lock
         at org.apache.lucene.store.NativeFSLockFactory.obtainFSLock(NativeFSLockFactory.java:139)
         at org.apache.lucene.store.FSLockFactory.obtainLock(FSLockFactory.java:41)
         at org.apache.lucene.store.BaseDirectory.obtainLock(BaseDirectory.java:45)
         at org.apache.lucene.store.FilterDirectory.obtainLock(FilterDirectory.java:105)
         at org.apache.lucene.index.IndexWriter.&amp;lt;init&amp;gt;(IndexWriter.java:785)
         at org.apache.solr.update.SolrIndexWriter.&amp;lt;init&amp;gt;(SolrIndexWriter.java:126)
         at org.apache.solr.update.SolrIndexWriter.create(SolrIndexWriter.java:100)
         at org.apache.solr.update.DefaultSolrCoreState.createMainIndexWriter(DefaultSolrCoreState.java:261)
         at org.apache.solr.update.DefaultSolrCoreState.getIndexWriter(DefaultSolrCoreState.java:135)
         at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:2145) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;CoreContainer#createFromDescriptor removes the CoreDescriptor when handling this exception. The SolrCore created for the first successful call is still registered in SolrCores.cores, but now there&apos;s no corresponding CoreDescriptor for that name anymore.&lt;/p&gt;

&lt;p&gt;This inconsistency leads to subsequent NullPointerExceptions, for example when using CoreAdmin STATUS with the core name: CoreAdminOperation#getCoreStatus first gets the non-null SolrCore (cores.getCore(cname)) but core.getInstancePath() throws an NPE, because the CoreDescriptor is not registered anymore:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-10-27 00:29:25.353 INFO  (qtp2029754983-19) [   ] o.a.s.s.HttpSolrCall [admin] webapp=null path=/admin/cores params={core=blueprint_acgqqafsogyc_comments&amp;amp;action=STATUS&amp;amp;indexInfo=false&amp;amp;wt=javabin&amp;amp;version=2} status=500 QTime=0
2020-10-27 00:29:25.353 ERROR (qtp2029754983-19) [   ] o.a.s.s.HttpSolrCall null:org.apache.solr.common.SolrException: Error handling &apos;STATUS&apos; action
         at org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:372)
         at org.apache.solr.handler.admin.CoreAdminHandler$CallInfo.call(CoreAdminHandler.java:397)
         at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:181)
...
Caused by: java.lang.NullPointerException
         at org.apache.solr.core.SolrCore.getInstancePath(SolrCore.java:333)
         at org.apache.solr.handler.admin.CoreAdminOperation.getCoreStatus(CoreAdminOperation.java:329)
         at org.apache.solr.handler.admin.StatusOp.execute(StatusOp.java:54)
         at org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:367)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;STATUS keeps failing until Solr is restarted.&lt;/p&gt;

&lt;p&gt;The NPE for CoreAdmin STATUS is a regression in 8.6. It seems to be caused by &lt;a href=&quot;https://github.com/apache/lucene-solr/commit/17ae79b0905b2bf8635c1b260b30807cae2f5463#diff-9652fe8353b7eff59cd6f128bb2699d88361e670b840ee5ca1018b1bc45584d1R324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/commit/17ae79b0905b2bf8635c1b260b30807cae2f5463#diff-9652fe8353b7eff59cd6f128bb2699d88361e670b840ee5ca1018b1bc45584d1R324&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13337874">SOLR-14969</key>
            <summary>Prevent creating multiple cores with the same name which leads to instabilities (race condition)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="ahubold">Andreas Hubold</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Oct 2020 13:44:15 +0000</created>
                <updated>Sat, 13 Feb 2021 00:08:50 +0000</updated>
                            <resolved>Sun, 1 Nov 2020 00:18:51 +0000</resolved>
                                    <version>8.6</version>
                    <version>8.6.3</version>
                                    <fixVersion>8.8</fixVersion>
                                    <component>multicore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17222908" author="ahubold" created="Thu, 29 Oct 2020 13:45:57 +0000"  >&lt;p&gt;I&apos;ve also asked on solr-user ml: &lt;a href=&quot;https://mail-archives.apache.org/mod_mbox/lucene-solr-user/202010.mbox/%3c92cd6d7a-310b-08d5-f928-c4890fb6e31d@coremedia.com%3e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mail-archives.apache.org/mod_mbox/lucene-solr-user/202010.mbox/%3c92cd6d7a-310b-08d5-f928-c4890fb6e31d@coremedia.com%3e&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17222947" author="erickerickson" created="Thu, 29 Oct 2020 15:12:50 +0000"  >&lt;p&gt;First, thanks for raising this. While we might be able to get around this in the CoreAdmin STATUS command (I haven&apos;t looked), the fact that the Solr needs to be reloaded is scary enough that the root cause should be addressed.&lt;/p&gt;

&lt;p&gt;This&apos;ll be somewhat tricky to fix. Much of the complexity here is because of &quot;transient&quot; and &quot;lazy&quot; cores. On a quick look at the change, I don&apos;t see anything obvious that would have changed the behavior of the create code, but perhaps it exposed an underlying issue.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;background&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;There are two use-cases:&lt;/p&gt;

&lt;p&gt;1&amp;gt; An installation has, say, 1,000 cores but only 100 of them are in use at any given time. Given enough disk space, hardware costs can be reduced by a factor of 10 if they can have cores load and unload dynamically on an LRU basis. This is the &quot;transient&quot; case.&lt;/p&gt;

&lt;p&gt;2&amp;gt; An installation has 1,000 cores that can all be loaded at once, but startup time is prohibitive if Solr waits for all 1,000 cores to be loaded.&#160; The &quot;lazy&quot; case is if they can afford to take the hit for loading when the first request is made to a core.&lt;/p&gt;

&lt;p&gt;So at startup, all the CoreDescriptors are read through &quot;core discovery&quot;, but the cores may or may not be loaded. Which means that there&apos;s lots of synchronization code and a bewildering variety of lists (pendingCoreOps, currentlyLoadingCores, similar lists in the TransientSolrCoreCache). currentlyLoadingCores is tempting, but it&apos;s for async core loading.&lt;/p&gt;

&lt;p&gt;All the above is to emphasize that this code is gnarly for some non-obvious reasons, tread with care &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;On to this problem&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;CoreContainer.create checks at the top for pre-existing cores and throws an error if it finds one, which if fine and good for cores that exist already &apos;cause all the CoreDescriptors are read at CoreContainer initialization. &lt;/p&gt;

&lt;p&gt;However, when creating a new core, the new core descriptor is invisible to any other thread that comes in here and does the above check until sometime during core creation, which is where this problem arises. The check at the top won&apos;t &quot;see&quot; the core being created until it&apos;s added to some other list in SolrCores eventually.&lt;/p&gt;

&lt;p&gt;I suppose we could add in something like the following: Add a new member variable.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; inFlightCores = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then wrap the entirety of CoreContainer.create in a try/finally block&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (inFlightCores) {
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (inFlightCores.contains(newCoreName) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException);
    inFlightCores.add(newCoreName);
  }
  &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; of CoreContainer.create code
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (inFlightCores) {
    inFlightCores.remove(newCoreName)
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A significant amount of the complexity there is a result of lessons learned when a client made extensive use of transient cores that were created and destroyed, but obviously not two at once with the same name.&lt;/p&gt;

&lt;p&gt;I&apos;m not excited about adding an ad-hoc fix like above, but I can say with certainty that a more intrusive change would be difficult to get right. Pending a more extensive revisiting of all the core admin operations, maybe something like this would be the best way to go...&lt;/p&gt;

&lt;p&gt;I&apos;d intended just to write this up, but now that I&apos;ve thought about it I&apos;ll see if I can work up a fix like above. Could you test a fix if I come up with one? I should be able to write a test though...&lt;/p&gt;</comment>
                            <comment id="17222974" author="ahubold" created="Thu, 29 Oct 2020 15:48:22 +0000"  >&lt;p&gt;Thank you! I&apos;m not too familiar with all this code, but your suggestion sounds reasonable. I just thought about a similar fix in a custom CoreAdminHandler, but I still have to check if that&apos;s customizable.&lt;/p&gt;

&lt;p&gt;I don&apos;t have a stable reproducer yet, but I can still try to test a proposed fix. However, I will be unavailable next week.&lt;/p&gt;</comment>
                            <comment id="17223288" author="erickerickson" created="Fri, 30 Oct 2020 00:37:59 +0000"  >&lt;p&gt;It&apos;s worse than I thought. Not the fix, just how weird this could get.&lt;/p&gt;

&lt;p&gt;I started by writing a test that spawns two threads, each of which creates a core with the same name. I was going to try to send the admin status command, not particularly easy actually when you don&apos;t have a SolrClient readily available. A ways into this a lightbulb went off, &quot;hey! How come I&apos;m successfully creating two cores with the same name in the first place?&quot;.&lt;/p&gt;

&lt;p&gt;I can actually get two cores to be &lt;em&gt;successfully&lt;/em&gt; created with the same name all the time and the same object. What the &lt;em&gt;actual&lt;/em&gt; state of Solr is at that point IDK, but it can&apos;t be right &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. For instance, I get the same object back. So if I try to close the cores returned by create, the second close fails because it&apos;s already been closed.&lt;/p&gt;

&lt;p&gt;If I start one thread, wait 500ms (longer than it needs to be) then start the second thread, I get the expected error on the second thread. This with the current code.&lt;/p&gt;

&lt;p&gt;I&apos;ll have a PR shortly, I&apos;ll run the full suite after the PR is up so night-owls have a chance to look at it. I&apos;ll push this tomorrow sometime if tests pass.&lt;/p&gt;</comment>
                            <comment id="17223492" author="ahubold" created="Fri, 30 Oct 2020 08:41:25 +0000"  >&lt;p&gt;Thanks for the fast response. The PR still contains a small error that the coreName is removed from inFlightCores, even if it was added by a previous call. Funny thing is, I made exactly the same error in my first attempt for a workaround in a custom CoreAdminHandler.&lt;/p&gt;</comment>
                            <comment id="17223501" author="ahubold" created="Fri, 30 Oct 2020 08:50:20 +0000"  >&lt;p&gt;For reference, I&apos;ve attached my workaround (tested with Solr 8.6.3) in the form of a custom CoreAdminHandler subclass: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13014405/13014405_CmCoreAdminHandler.java&quot; title=&quot;CmCoreAdminHandler.java attached to SOLR-14969&quot;&gt;CmCoreAdminHandler.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;
It works similar to Erick&apos;s fix, but it can&apos;t fix the problem for async CREATE request. If anybody wants to use it, please change the package name, and register it in your solr.xml with &lt;tt&gt;&amp;lt;str name=&quot;adminHandler&quot;&amp;gt;...&amp;lt;/str&amp;gt;&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17223612" author="erickerickson" created="Fri, 30 Oct 2020 12:20:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ahubold&quot; class=&quot;user-hover&quot; rel=&quot;ahubold&quot;&gt;ahubold&lt;/a&gt; I disagree, the core name must be removed from inflightCreations without fail. Its only purpose is to keep any other create request from starting to create the same core &lt;em&gt;for the duration of that create call only&lt;/em&gt;. If the coreName was left in that structure, then the list would grow forever. And you couldn&apos;t create a core, delete it, then recreate it. Nor could you get partway through core creation, have an error, fix the error and then create the core.&lt;/p&gt;

&lt;p&gt;A second simultaneous call won&apos;t add the coreName to inflightCreations, it&apos;ll throw an exception at the top. So the originator is the only one who can, and must, remove it.&lt;/p&gt;

&lt;p&gt;If a core is created successfully and &lt;em&gt;another&lt;/em&gt; call is made to try to create the same core later, it fails this test a little later.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getAllCoreNames().contains(coreName)) {
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Creating a core with existing name is not allowed&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;// TODO: Shouldn&apos;t &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; be a BAD_REQUEST?
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException(ErrorCode.SERVER_ERROR, &lt;span class=&quot;code-quote&quot;&gt;&quot;Core with name &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + coreName + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt; already exists.&quot;&lt;/span&gt;);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you still think the name should not be removed, we need to figure out why we disagree.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17223623" author="ahubold" created="Fri, 30 Oct 2020 12:42:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; It seems you&apos;ve misunderstood my point. The core name must of course be removed in the finally block, if but only if it was added by the very same invocation. However, it &lt;b&gt;must not&lt;/b&gt; be removed by an invocation, that didn&apos;t add the core name itself. Currently, with your fix, the following scenario is possible:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;first call is made, and adds coreName to inFlightCreations&lt;/li&gt;
	&lt;li&gt;second simultaneous call detects that the core is already being created, and correctly throws an exception, but it also removes the core from inFlightCreations.&lt;/li&gt;
	&lt;li&gt;third simultaneous call is made, does not see coreName in inFlightCreations, and proceeds even though the first call is still not finished&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I hope this makes it more clear. In my attached workaround, this situation is handled by setting the variable &quot;createCore&quot; to null if a previous create call is still in progress, and an additional &quot;if (createCore!=null)&quot; condition in the finally block. This is of course not directly applicable to your fix, but the pattern could be similar.&lt;/p&gt;</comment>
                            <comment id="17223638" author="erickerickson" created="Fri, 30 Oct 2020 13:09:18 +0000"  >&lt;p&gt;Ah, thanks for the explanation. You&apos;re right, I&apos;ll fix that up. Good catch!&lt;/p&gt;</comment>
                            <comment id="17224208" author="jira-bot" created="Sun, 1 Nov 2020 00:17:44 +0000"  >&lt;p&gt;Commit b27c8b90213cd388a9aa79deec7be753d10c9bb9 in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b27c8b9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b27c8b9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14969&quot; title=&quot;Prevent creating multiple cores with the same name which leads to instabilities (race condition)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14969&quot;&gt;&lt;del&gt;SOLR-14969&lt;/del&gt;&lt;/a&gt;: Prevent creating multiple cores with the same name which leads to instabilities (race condition)&lt;/p&gt;</comment>
                            <comment id="17224209" author="jira-bot" created="Sun, 1 Nov 2020 00:18:00 +0000"  >&lt;p&gt;Commit 2c49c4a27d99316c9d962a50171f728de58bfa2a in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2c49c4a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2c49c4a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14969&quot; title=&quot;Prevent creating multiple cores with the same name which leads to instabilities (race condition)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14969&quot;&gt;&lt;del&gt;SOLR-14969&lt;/del&gt;&lt;/a&gt;: Prevent creating multiple cores with the same name which leads to instabilities (race condition)&lt;/p&gt;</comment>
                            <comment id="17228529" author="ahubold" created="Mon, 9 Nov 2020 11:32:20 +0000"  >&lt;p&gt;I&apos;ve tested concurrent core creation for branch_8x, and can confirm that the bug is fixed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
Thanks a lot for fixing this issue, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, logging is quite ugly. Maybe it would had been better to throw a SolrException with ErrorCode.CONFLICT in case of concurrent core creation, and not the currently used ErrorCode.SERVER_ERROR. If I understand logging in RequestHandlerBase correctly, this would avoid the ERROR message with stack trace that appears in addition to the WARN message. FYI, maybe this is still worth changing.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-11-09 11:10:03.104 WARN  (qtp1033348658-69) [   x:test-0.5753008886962022-71] o.a.s.c.CoreContainer Already creating a core with name &apos;test-0.5753008886962022-71&apos;, call aborted &apos;
2020-11-09 11:10:03.104 ERROR (qtp1033348658-126) [   x:test-0.5753008886962022-71] o.a.s.s.HttpSolrCall null:org.apache.solr.common.SolrException: Already creating a core with name &apos;test-0.5753008886962022-71&apos;, call aborted &apos;
        at org.apache.solr.core.CoreContainer.create(CoreContainer.java:1284)
        at org.apache.solr.handler.admin.CoreAdminOperation.lambda$static$0(CoreAdminOperation.java:95)
        at org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:367)
        at org.apache.solr.handler.admin.CoreAdminHandler$CallInfo.call(CoreAdminHandler.java:397)
        at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:181)
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:214) 
...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17228572" author="jira-bot" created="Mon, 9 Nov 2020 13:17:04 +0000"  >&lt;p&gt;Commit be19432b750b94c4703ee7b19ef681ebf771a95a in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=be19432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=be19432&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14969&quot; title=&quot;Prevent creating multiple cores with the same name which leads to instabilities (race condition)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14969&quot;&gt;&lt;del&gt;SOLR-14969&lt;/del&gt;&lt;/a&gt;: Prevent creating multiple cores with the same name which leads to instabilities (race condition) changed error code&lt;/p&gt;</comment>
                            <comment id="17228583" author="jira-bot" created="Mon, 9 Nov 2020 13:28:43 +0000"  >&lt;p&gt;Commit 91ef1c0fe8854db04e42b9095437b3186ff8038e in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=91ef1c0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=91ef1c0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14969&quot; title=&quot;Prevent creating multiple cores with the same name which leads to instabilities (race condition)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14969&quot;&gt;&lt;del&gt;SOLR-14969&lt;/del&gt;&lt;/a&gt;: Prevent creating multiple cores with the same name which leads to instabilities (race condition) changed error code&lt;/p&gt;

&lt;p&gt;(cherry picked from commit be19432b750b94c4703ee7b19ef681ebf771a95a)&lt;/p&gt;</comment>
                            <comment id="17228593" author="ahubold" created="Mon, 9 Nov 2020 13:47:56 +0000"  >&lt;p&gt;Works, no logged ERROR messages anymore. Thank you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13014405" name="CmCoreAdminHandler.java" size="2185" author="ahubold" created="Fri, 30 Oct 2020 09:07:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0k4b4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>