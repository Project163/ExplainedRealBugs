<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:54:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6312] CloudSolrServer doesn&apos;t honor updatesToLeaders constructor argument</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6312</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The CloudSolrServer doesn&apos;t use the updatesToLeaders property - all SolrJ requests are being sent to the shard leaders.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12731387">SOLR-6312</key>
            <summary>CloudSolrServer doesn&apos;t honor updatesToLeaders constructor argument</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="sdavids">Steve Davids</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Aug 2014 18:50:51 +0000</created>
                <updated>Fri, 17 Oct 2025 20:05:38 +0000</updated>
                            <resolved>Fri, 20 Jan 2023 20:41:44 +0000</resolved>
                                    <version>4.9</version>
                    <version>7.5</version>
                                    <fixVersion>9.2</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                    <component>clients - java</component>
                    <component>SolrJ</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>16</watches>
                                                                                                                <comments>
                            <comment id="14093490" author="hossman" created="Mon, 11 Aug 2014 23:17:54 +0000"  >&lt;p&gt;Steve: can you elaborate a bit more on what exactly your code looks like, and what behavior you are seeing that you think is incorrect? (it&apos;s not clear if you are saying all requests, including queries, are only being sent to leaders when updatesToLeaders==true; or if you are saying that regardless of whether updatesToLeaders==true, updates are only going to hte leaders.&lt;/p&gt;

&lt;p&gt;from what i can tell, updatesToLeaders is completely ignored in 4.9, and i &lt;em&gt;think&lt;/em&gt; should have been marked deprecated a while ago.&lt;/p&gt;

&lt;p&gt;from what i remember of the history, updatesToLeaders was a feature in early versions of CloudSolrServer that, instead of picking a random server from the pool of all servers, would cause the code to pick a random server from one of the current leaders - which would increase the odds of saving a &quot;hop&quot; in the case where we were sending a commit or deleteByQuery, or we got lucky and picked the &quot;right&quot; leader for a doc add/delete.&lt;/p&gt;

&lt;p&gt;But once CloudSolrServer became smart enough to be able to ask ZooKeeper for  the DocRouter being used, we no longer needed to randomly pick a leader - we know exactly which leader to use for each update &amp;#8211; making that setting unneccessary...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/viewvc?view=revision&amp;amp;revision=r1521713&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/viewvc?view=revision&amp;amp;revision=r1521713&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So, if my understanding is correct, what you should be seeing is that &lt;em&gt;queries&lt;/em&gt; are randomly distributed to any 1 solr node, while updates are always targeted at the correct leader.&lt;/p&gt;

&lt;p&gt;does that jive with what you are seeing?&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;I think the bug here is mark the updatesToLeaders option deprecated, and remove it in trunk.  (either that, or: if there is still some code path where CloudSolrServer may not be able to figure out the DocRouter, then in &lt;em&gt;that&lt;/em&gt; situation i guess it might still make sense to round robin just among the known leaders?)&lt;/p&gt;</comment>
                            <comment id="14093503" author="steve_rowe" created="Mon, 11 Aug 2014 23:32:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think the bug here is mark the updatesToLeaders option deprecated, and remove it in trunk.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The updatesToLeader option has been disconnected from the way CloudSolrServer operates for 11 months now, 5 feature releases ago - what&apos;s the point of deprecating non-existent functionality?&lt;/p&gt;

&lt;p&gt;(Jessica Cheng noted this problem a ways back &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4816?focusedCommentId=13792911&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13792911&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;on SOLR-4816&lt;/a&gt;.) &lt;/p&gt;

&lt;p&gt;I vote for outright removal - that should have happened when &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4816&quot; title=&quot;Add document routing to CloudSolrServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4816&quot;&gt;&lt;del&gt;SOLR-4816&lt;/del&gt;&lt;/a&gt; was committed in &lt;a href=&quot;http://svn.apache.org/r1521713&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1521713&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14093508" author="hossman" created="Mon, 11 Aug 2014 23:35:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;what&apos;s the point of deprecating non-existent functionality?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;correct compilation w/o modification of existing client code on upgrade.&lt;/p&gt;
</comment>
                            <comment id="14093524" author="anshumg" created="Tue, 12 Aug 2014 00:00:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;correct compilation w/o modification of existing client code on upgrade&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 for that. The public methods/constructor shouldn&apos;t be broken (even if they were superficial) in a single release.&lt;/p&gt;</comment>
                            <comment id="14093533" author="sdavids" created="Tue, 12 Aug 2014 00:11:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;So, if my understanding is correct, what you should be seeing is that queries are randomly distributed to any 1 solr node, while updates are always targeted at the correct leader.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; You are correct, that is what I am seeing as well. Though I have a re-indexing use-case where I would actually like to distribute update requests to more than just the leader. I am currently performing XPath extraction logic in the update chain before distributed the requests to replicas, the problem I am running into is that the leader&apos;s CPU is completely pegged running the XPaths while the replicas are almost idle (~20%). I looked to this feature to allow more throughput by load balancing the extraction logic to the replicas and just forwarding the complete/hydrated document to the leader. I know this is a somewhat fringe case but still think it can be useful.&lt;/p&gt;</comment>
                            <comment id="14093752" author="andyetitmoves" created="Tue, 12 Aug 2014 05:19:00 +0000"  >&lt;p&gt;It&apos;s unlikely you will see a difference by sending to all replicas instead of targeting the leaders, as the replicas will internally forward your requests to the leader anyway, that&apos;s the way SolrCloud is designed &amp;#8211; updates always go to the leader. All CSS is trying to do is save you the extra hop (and some cpu/latency savings in the process).&lt;/p&gt;</comment>
                            <comment id="14093983" author="sdavids" created="Tue, 12 Aug 2014 11:38:18 +0000"  >&lt;p&gt;Yes, I understand that all updates will always go to the leader, the CPU intensive task in this entire process is running extraction logic using XPaths in the update processor chain before any requests are distributed to the leader/replicas. When the request is distributed to the leader, the leader doesn&apos;t need to start the update processor from scratch, instead it continues where the other machine left off in the processing pipeline at the DistributedUpdateProcessor. So if I am able to load balance requests to all replicas the CPU intensive tasks (early update processors) will be shared by multiple machines not just the leader and should result in increased throughput.&lt;/p&gt;</comment>
                            <comment id="14094170" author="erickerickson" created="Tue, 12 Aug 2014 15:30:27 +0000"  >&lt;p&gt;Hmmm, interesting problem here. This is why, for scaling purposes, I vastly&lt;br/&gt;
prefer doing any such heavy lifting on the clients so I can scale up by racking&lt;br/&gt;
N clients together rather than have a Solr node be a bottleneck due to the&lt;br/&gt;
parsing. Is that a possibility?&lt;/p&gt;

&lt;p&gt;So I suspect we can close this JIRA? You&apos;re correct that updatesToLeaders&lt;br/&gt;
is not respected, but it&apos;s also not going to be. Or perhaps change the title&lt;br/&gt;
to &quot;depecrate CloudSolrServer updatesToLeaders constructor argument&quot;.&lt;/p&gt;
</comment>
                            <comment id="14094182" author="hossman" created="Tue, 12 Aug 2014 15:42:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;So I suspect we can close this JIRA? You&apos;re correct that updatesToLeaders is not respected, but it&apos;s also not going to be.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Steve&apos;s use case (and similar usecases like it, ie: using the ExtractingRequestHandler on large binary data files) actually strikes me as a really good reason to make upatesToLeaders==false meaningful again: randomize updates to all &quot;up&quot; replicas in the collection regardless of leader status.  (the default is &lt;br/&gt;
upatesToLeaders=true, no reason that would change, no reason it would impact anyone except people like steve trying to distribute the load of early logic to non-leaders)&lt;/p&gt;</comment>
                            <comment id="14101828" author="sdavids" created="Tue, 19 Aug 2014 04:26:25 +0000"  >&lt;p&gt;Added patch to re-enable the updatesToLeader flag and perhaps spur additional commentary &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14113827" author="markrmiller@gmail.com" created="Thu, 28 Aug 2014 15:06:12 +0000"  >&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="14942743" author="markrmiller@gmail.com" created="Sun, 4 Oct 2015 18:00:32 +0000"  >&lt;p&gt;Interesting - I think I&apos;m seeing lots of fails of our partition tests fail if I make this change. Just to have to verify I&apos;m not seeing that without the change.&lt;/p&gt;</comment>
                            <comment id="14942752" author="markrmiller@gmail.com" created="Sun, 4 Oct 2015 18:16:37 +0000"  >&lt;p&gt;Yeah, seems to be the case. I know it&apos;s more strain on the cluster to not send directly to leaders, but I wonder if some setting somewhere needs to be relaxed so that we don&apos;t keep hitting this &apos;no healthy nodes found&apos; fail.&lt;/p&gt;</comment>
                            <comment id="14942841" author="markrmiller@gmail.com" created="Sun, 4 Oct 2015 22:35:39 +0000"  >&lt;p&gt;Actually I think the tests just need a little hardening.&lt;/p&gt;</comment>
                            <comment id="14942843" author="markrmiller@gmail.com" created="Sun, 4 Oct 2015 22:46:00 +0000"  >&lt;p&gt;Interesting - just got a replica out of sync issue with the shard split test with sendUpdatesToLeaders=false. Don&apos;t think I&apos;ve seen that in some time without. I&apos;ll keep an eye on it.&lt;/p&gt;</comment>
                            <comment id="15352997" author="cpoerschke" created="Tue, 28 Jun 2016 13:45:39 +0000"  >&lt;p&gt;Refreshed patch file for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9090&quot; title=&quot;solrj CloudSolrClient: add directUpdatesToLeadersOnly support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9090&quot;&gt;&lt;del&gt;SOLR-9090&lt;/del&gt;&lt;/a&gt; (which is related to this ticket but also slightly different), with a view towards committing the change towards the end of this or beginning of next week. Questions, comments, reviews etc. welcome as usual. Thank you.&lt;/p&gt;</comment>
                            <comment id="15755215" author="anshumg" created="Fri, 16 Dec 2016 18:49:14 +0000"  >&lt;p&gt;Is this still an open issue? Considering only the builder pattern is now a non-deprecated way to construct the client, do we still end up with this when we use &lt;em&gt;sendDirectUpdatesToAnyShardReplica()&lt;/em&gt; ?&lt;/p&gt;</comment>
                            <comment id="16208362" author="jwartes" created="Tue, 17 Oct 2017 21:26:43 +0000"  >&lt;p&gt;As of 7.0.1, three years later, yes, I think it is still an open issue.&lt;br/&gt;
CloudSolrServer.Builder has two functions that have no effect: sendUpdatesOnlyToShardLeaders and sendUpdatesToAllReplicasInShard. They are not marked depreciated, and the javadoc implies functionality.&lt;/p&gt;</comment>
                            <comment id="16647987" author="gerlowskija" created="Fri, 12 Oct 2018 14:44:43 +0000"  >&lt;p&gt;Wanted to re-bring this to people&apos;s attention if I could.  It&apos;s gotta be really confusing for our users that &lt;tt&gt;CloudSolrClient.Builder&lt;/tt&gt; has 4 different methods all involving how updates are sent to shards.  None of them are well documented, and 2 of them have had no effect for the last 4 years or so.&lt;/p&gt;

&lt;p&gt;I came to this because I wanted to add Javadocs to these methods and was surprised to find that they don&apos;t do anything.  I felt like it would be a little silly to have javadocs saying: &quot;These methods don&apos;t have any effect.  They used to have an effect, but now we&apos;re just keeping them around as a vestigial organ&quot;, so I thought I would maybe poke this thread again.&lt;/p&gt;

&lt;p&gt;I don&apos;t have a strong preference what we do with these methods.  I buy Steve&apos;s and Hoss&apos; point that having this setting would be beneficial for those doing work in their update-request-chains that they want to spread around different nodes.  But it&apos;s unclear when someone will have the time/priority to make this happen and in the meantime I&apos;d hate to see us let the &quot;perfect&quot; (this cool new functionality) get in the way of the &quot;good&quot; (less confusing interface).&lt;/p&gt;

&lt;p&gt;Would anyone care if I added a deprecation warning to these methods?  Deprecation doesn&apos;t need to be final...if someone gets around to implementing this functionality, we can always remove the deprecation.  We should do &lt;em&gt;something&lt;/em&gt; to steer users away from using the methods in their current state.  I&apos;d vote for temporary-deprecation since that catches the eye a little more than a Javadoc that you don&apos;t see unless think to go look it up.  But if others still object I&apos;ll just add a little javadoc warning.  &lt;/p&gt;
</comment>
                            <comment id="16649408" author="markrmiller@gmail.com" created="Sun, 14 Oct 2018 14:13:59 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17553729" author="hossman" created="Mon, 13 Jun 2022 17:31:22 +0000"  >&lt;p&gt;FWIW, this bit me in the ass recently with a new usecase for why it was problematic and i wished i could turn it off. I also realized there is a &quot;client only&quot; workaround that wasn&apos;t too painful that I thought i&apos;d share, and have some revised thoughts on how CloudSolrClient should &lt;em&gt;ideally&lt;/em&gt; work&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;MyNewUsecase&quot;&gt;&lt;/a&gt;My New Usecase&lt;/h3&gt;

&lt;p&gt;I&apos;m working on a custom request handler that takes as it&apos;s input whole documents &#8211; along the same lines as MTLHandler, or the DocumentAnalysisHandler, but I don&apos;t want to &lt;em&gt;only&lt;/em&gt; take in a stream of text for a single field, or only a hackish subset of the XML request like those handlers. I want to take in (multiple) real documents, using ContentLoaders, and feed them through URPs and then use those doucments.&lt;br/&gt;
Writing the handler is easy, and I thought using &lt;tt&gt;UpdateRequest&lt;/tt&gt; on the solrj client side would also be easy &#8211; but then my unit tests failed when using CloudSolrCLient but not when using HttpSolrCLient &#8211; and i remembered this jira.&lt;/p&gt;

&lt;p&gt;(FWIW: My failures weren&apos;t even because the leaders were the only nodes getting the request &#8211; i probably wouldn&apos;t have noticed that until much later &#8211; my test failures were because the &lt;tt&gt;directUpdates&lt;/tt&gt; logic splits apart the UpdateRequest and then stiches the responses from each leader back together bsaed on what it expects from &lt;tt&gt;UpdateRequestHandler&lt;/tt&gt; &#8211; but it didn&apos;t know about the diff response data my custom request handler was returninging.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;MyClientWorkaround&quot;&gt;&lt;/a&gt;My Client Workaround&lt;/h3&gt;

&lt;p&gt;instead of using &lt;tt&gt;new UpdateRequest&lt;/tt&gt; I&apos;m using a wrapper class that looks like this (generalized psuedo code, my actual class has a slightly more limited surface API since i don&apos;t care about things like deletes)...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// important that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is NOT an instance of IsUpdateRequest
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;NonRoutedUpdate &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GenericSolrRequest {
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; UpdateRequest updates;
  
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; NonRoutedUpdate(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SolrParams params, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; UpdateRequest updates) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(METHOD.POST, path, params);
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.updates = updates 
  }

  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getRequestType() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;non-routed-update&quot;&lt;/span&gt;;
  }

  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; RequestWriter.ContentWriter getContentWriter(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; expectedType) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UpdateContentWriter(updates);
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Collection&amp;lt;ContentStream&amp;gt; getContentStreams() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UnsupportedOperationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bug in some assumption: we shouldn&apos;t be asked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a stream&quot;&lt;/span&gt;);
  }
    
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;UpdateContentWriter &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; RequestWriter.ContentWriter {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; UpdateRequest updates;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; UpdateContentWriter(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; UpdateRequest updates) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.updates = updates;
    }
      
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void write(OutputStream os) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
      &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JavaBinUpdateRequestCodec().marshal(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.updates, os);
    }
      
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getContentType() {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; CommonParams.JAVABIN_MIME;
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(something similar could be done to wrap a &lt;tt&gt;ContentStreamUpdateRequest&lt;/tt&gt; )&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Revisedopiniononidealfunctionality&quot;&gt;&lt;/a&gt;Revised opinion on ideal functionality&lt;/h3&gt;

&lt;p&gt;My 8+ year old comments still ring true to me ... but i actually think we should go farther.&lt;/p&gt;

&lt;p&gt;It strikes me that there is really no reason why &lt;tt&gt;CloudSolrClient.updatesToLeaders&lt;/tt&gt; should really be (only a) Client setting &#8211; it seems like it should really be a request option &#8211; some updates i know are best sent only to leaders, other requests that are &lt;tt&gt;instanceOf IsUpdateRequest&lt;/tt&gt; I know should really just be round robined (or obey my &lt;tt&gt;shards.preferences&lt;/tt&gt;) and i&apos;d like to be able use one client to send both requests.&lt;/p&gt;

&lt;p&gt;In an ideal world i think we would have:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;a &lt;tt&gt;default boolean isSendToLeaders()&lt;/tt&gt; to the &lt;tt&gt;IsUpdateRequest&lt;/tt&gt; interface that defaults to returning true
	&lt;ul&gt;
		&lt;li&gt;&lt;tt&gt;AbstractUpdateRequest.isSendToLeaders()&lt;/tt&gt; would override that default impl backed by a &lt;tt&gt;AbstractUpdateRequest.setSendToLeaders(boolean)&lt;/tt&gt; (which a value that defaults to true)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;CloudSolrClient.sendRequest&lt;/tt&gt; the &lt;tt&gt;request instanceof IsUpdateRequest&lt;/tt&gt; block should skip out of this entire bock, and leave the local variable &lt;tt&gt;sendToLeaders = false&lt;/tt&gt; unless &lt;tt&gt;request.isSendToLeaders() &amp;amp;&amp;amp; this.isUpdatesToLeaders()&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17655611" author="jira-bot" created="Sat, 7 Jan 2023 00:54:12 +0000"  >&lt;p&gt;Commit 029260f9888be3093797ba8adce0b3d091c718e4 in solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt; from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=029260f9888&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=029260f9888&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge branch &apos;main&apos; into jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17655612" author="hossman" created="Sat, 7 Jan 2023 00:56:00 +0000"  >&lt;p&gt;I&apos;ve been working on this a bit over the past few weeks, and just pushed a new &lt;tt&gt;jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt;&lt;/tt&gt; branch with my suggested changes, tests, and improved javadocs.&lt;/p&gt;</comment>
                            <comment id="17655860" author="epugh" created="Mon, 9 Jan 2023 01:01:13 +0000"  >&lt;p&gt;Thanks for pushing this up...    It looks like it makes sense, though I&apos;ll be honest this area is pretty complex/daunting to me!   One nit, &quot;receive&quot; instead of &quot;recieve&quot;  in javadocs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17656384" author="dsmiley" created="Tue, 10 Jan 2023 02:44:31 +0000"  >&lt;p&gt;Where is the PR?&lt;br/&gt;
BTW it&apos;s discouraged to create feature/issue branches unless you expect lots of collaboration of might be long-lived.  Even contributor PRs on their forks can be collaborated on by committers.  Branches need to be groomed; so easy to forget and leave them forever, polluting a namespace.&lt;/p&gt;</comment>
                            <comment id="17679284" author="jira-bot" created="Fri, 20 Jan 2023 18:48:00 +0000"  >&lt;p&gt;Commit fe8a8dddfd29dcb34e51b33d060311f44d91a7c9 in solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt; from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=fe8a8dddfd2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=fe8a8dddfd2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge branch &apos;main&apos; into jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17679300" author="jira-bot" created="Fri, 20 Jan 2023 19:30:46 +0000"  >&lt;p&gt;Commit afb980bc217cb492b24e002c99695e28794aceb9 in solr&apos;s branch refs/heads/main from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=afb980bc217&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=afb980bc217&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt;: SolrJ Cloud clients now correctly support isUpdatesToLeaders() being false.&lt;/p&gt;

&lt;p&gt;This behavior can also be configured per AbstractUpdateRequest instance.&lt;/p&gt;</comment>
                            <comment id="17679314" author="jira-bot" created="Fri, 20 Jan 2023 20:37:24 +0000"  >&lt;p&gt;Commit 6d3aadb96bcdc43a94ec727d1e95134a45c41e85 in solr&apos;s branch refs/heads/branch_9x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=6d3aadb96bc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=6d3aadb96bc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt;: SolrJ Cloud clients now correctly support isUpdatesToLeaders() being false.&lt;/p&gt;

&lt;p&gt;This behavior can also be configured per AbstractUpdateRequest instance.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit afb980bc217cb492b24e002c99695e28794aceb9)&lt;/p&gt;</comment>
                            <comment id="17679315" author="hossman" created="Fri, 20 Jan 2023 20:41:08 +0000"  >&lt;p&gt;I don&apos;t have a personal github fork because i don&apos;t use github for solr work&lt;br/&gt;
I created a branch because the last time i posted a big patch touching multiple files people asked me to create a branch so it was easier to review&lt;br/&gt;
I&apos;ve fixed the jdoc typo, committed to main w/backport to 9x, and deleted the jira branch&lt;/p&gt;</comment>
                            <comment id="17679462" author="jira-bot" created="Sat, 21 Jan 2023 17:41:54 +0000"  >&lt;p&gt;Commit 2acd5ca0a86cae995fed26063d965a40bba6c602 in solr&apos;s branch refs/heads/main from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=2acd5ca0a86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=2acd5ca0a86&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt;: Add missing override&lt;/p&gt;</comment>
                            <comment id="17679463" author="jira-bot" created="Sat, 21 Jan 2023 17:46:59 +0000"  >&lt;p&gt;Commit 2dc585eb6412e359ff19537e90511d0d17997737 in solr&apos;s branch refs/heads/branch_9x from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=2dc585eb641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=2dc585eb641&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6312&quot; title=&quot;CloudSolrServer doesn&amp;#39;t honor updatesToLeaders constructor argument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6312&quot;&gt;&lt;del&gt;SOLR-6312&lt;/del&gt;&lt;/a&gt;: Add missing override&lt;/p&gt;</comment>
                            <comment id="17679478" author="hossman" created="Sat, 21 Jan 2023 20:58:53 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt; - i forgot errorprone is disabled by default.&lt;/p&gt;</comment>
                            <comment id="17705541" author="houston" created="Mon, 27 Mar 2023 18:04:18 +0000"  >&lt;p&gt;Closing after the 9.2.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12965035">SOLR-9067</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12966037">SOLR-9090</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12737140">SOLR-6442</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12662689" name="SOLR-6312.patch" size="708" author="sdavids" created="Tue, 19 Aug 2014 04:26:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409459</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yg8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409455</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>