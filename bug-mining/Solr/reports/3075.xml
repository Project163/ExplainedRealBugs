<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:15:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9439] Shard split clean up logic for older failed splits is faulty</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9439</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In case a split finds that previous sub-shards exist in construction or recovery state. it tries to clean them up by invoking deleteshard API. However, the clean up logic tries to invoke deleteshard on the same sub-shards as many times as the requested number of sub-ranges. Such repeat calls to deleteshard fail and therefore fail the entire shard split operation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12999805">SOLR-9439</key>
            <summary>Shard split clean up logic for older failed splits is faulty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Aug 2016 21:11:11 +0000</created>
                <updated>Wed, 2 Oct 2019 17:25:05 +0000</updated>
                            <resolved>Mon, 12 Sep 2016 11:55:38 +0000</resolved>
                                    <version>4.10.4</version>
                    <version>5.5.2</version>
                    <version>6.1</version>
                                    <fixVersion>6.2.1</fixVersion>
                    <fixVersion>6.3</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15435722" author="shalinmangar" created="Wed, 24 Aug 2016 21:20:26 +0000"  >&lt;p&gt;Trivial fix is attached. The test which tickled this bug is part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9438&quot; title=&quot;Shard split can lose data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9438&quot;&gt;&lt;del&gt;SOLR-9438&lt;/del&gt;&lt;/a&gt; but I&apos;ll try to write a minimal test case here as well.&lt;/p&gt;</comment>
                            <comment id="15439868" author="shalinmangar" created="Fri, 26 Aug 2016 21:11:54 +0000"  >&lt;ol&gt;
	&lt;li&gt;Uses TestInjection to inject failure into the split process before creating additional replicas&lt;/li&gt;
	&lt;li&gt;New TestInjection#injectSplitFailureBeforeReplicaCreation method for above&lt;/li&gt;
	&lt;li&gt;New test ShardSplitTest#testSplitAfterFailedSplit which fails without the fix but passes with.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;ll commit shortly.&lt;/p&gt;</comment>
                            <comment id="15440526" author="shalinmangar" created="Sat, 27 Aug 2016 02:53:03 +0000"  >&lt;p&gt;The last patch didn&apos;t handle exceptions due to non-existent cores. This patch adds metadata to the SolrException if a non-existent core is deleted. We check for this metadata and abort only if the cause is null or not non-existent.&lt;/p&gt;</comment>
                            <comment id="15440528" author="shalinmangar" created="Sat, 27 Aug 2016 02:54:30 +0000"  >&lt;p&gt;With the right patch this time.&lt;/p&gt;</comment>
                            <comment id="15440587" author="jira-bot" created="Sat, 27 Aug 2016 03:39:21 +0000"  >&lt;p&gt;Commit 7d2f42e5436dc669cd48df8dafd45036bd6f9d76 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7d2f42e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7d2f42e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9439&quot; title=&quot;Shard split clean up logic for older failed splits is faulty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9439&quot;&gt;&lt;del&gt;SOLR-9439&lt;/del&gt;&lt;/a&gt;: Shard split clean up logic for older failed splits is faulty&lt;/p&gt;</comment>
                            <comment id="15440593" author="jira-bot" created="Sat, 27 Aug 2016 03:41:57 +0000"  >&lt;p&gt;Commit 97b62160e90a262e7b05883d13b8af45d9052705 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=97b6216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=97b6216&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9439&quot; title=&quot;Shard split clean up logic for older failed splits is faulty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9439&quot;&gt;&lt;del&gt;SOLR-9439&lt;/del&gt;&lt;/a&gt;: Shard split clean up logic for older failed splits is faulty&lt;br/&gt;
(cherry picked from commit 7d2f42e)&lt;/p&gt;</comment>
                            <comment id="15446306" author="steve_rowe" created="Mon, 29 Aug 2016 16:12:07 +0000"  >&lt;p&gt;My Jenkins has seen &lt;tt&gt;TestShardSplit.testSplitAfterFailedSplit()&lt;/tt&gt; (new test committed under this issue) fail 4 times (links below).  I tried a couple of the repro lines and they did not reproduce for me (on the same machine where my Jenkins runs).&lt;/p&gt;

&lt;p&gt;One of the failures - I&apos;m also attaching a gzipped excerpt from the build log for this run (&lt;tt&gt;Lucene-Solr-tests-master.8015.log.gz&lt;/tt&gt;):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=ShardSplitTest -Dtests.method=testSplitAfterFailedSplit -Dtests.seed=F8621B62A68543EC -Dtests.slow=true -Dtests.locale=mt-MT -Dtests.timezone=America/Costa_Rica -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 34.6s J10 | ShardSplitTest.testSplitAfterFailedSplit &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: Shard split did not succeed after a previous failed split attempt left sub-shards in construction state
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([F8621B62A68543EC:12F88CD9AF00E66]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.ShardSplitTest.testSplitAfterFailedSplit(ShardSplitTest.java:138)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:985)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:960)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Links to all 4 failing runs (in case more logs would be helpful):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-6.x/2194/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-6.x/2194/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-master/8015/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-master/8015/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-6.x/2207/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-6.x/2207/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-6.x/2214/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-6.x/2214/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15446345" author="shalinmangar" created="Mon, 29 Aug 2016 16:25:39 +0000"  >&lt;p&gt;Thanks Steve, that is very helpful. I&apos;m seeing related failures in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9438&quot; title=&quot;Shard split can lose data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9438&quot;&gt;&lt;del&gt;SOLR-9438&lt;/del&gt;&lt;/a&gt; so this might have a clue.&lt;/p&gt;</comment>
                            <comment id="15447993" author="shalinmangar" created="Tue, 30 Aug 2016 04:32:21 +0000"  >&lt;p&gt;The root cause of these test failures is that the deleteshard API is not resilient against non-existent cores. If it fails trying to delete a core which is already deleted then it fails to remove the slice from the cluster state.&lt;/p&gt;</comment>
                            <comment id="15448710" author="shalinmangar" created="Tue, 30 Aug 2016 10:44:07 +0000"  >&lt;p&gt;Actually the fixes for ignoring unload failures for non-existent cores that I had done in this issue are not necessary if the deleteshard API can internally call delete replica API which does the right thing. Now that we have a parallel mode for the delete replica API, we can just invoke it and then clear the slice from the cluster state. I&apos;ll put up a patch.&lt;/p&gt;</comment>
                            <comment id="15448968" author="shalinmangar" created="Tue, 30 Aug 2016 13:08:08 +0000"  >&lt;p&gt;Patch which reverts some of the changes I made earlier to track and ignore unload failures non-existent cores because they are no longer necessary. This patch changes the delete shard API to call deletereplica API for all replicas in parallel instead of custom delete logic.&lt;/p&gt;

&lt;p&gt;I am going to beast this test for a bit before committing.&lt;/p&gt;</comment>
                            <comment id="15449644" author="shalinmangar" created="Tue, 30 Aug 2016 17:45:36 +0000"  >&lt;p&gt;The last patch failed CollectionsAPISolrJTest.testCreateAndDeleteShard because the changed implementation did not return the &quot;success&quot; flag. I beasted this test 50 times but couldn&apos;t get it to fail.&lt;/p&gt;</comment>
                            <comment id="15449717" author="jira-bot" created="Tue, 30 Aug 2016 18:14:37 +0000"  >&lt;p&gt;Commit 02b97a29b747e439bba8ad95a0269f959bea965e in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=02b97a2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=02b97a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9439&quot; title=&quot;Shard split clean up logic for older failed splits is faulty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9439&quot;&gt;&lt;del&gt;SOLR-9439&lt;/del&gt;&lt;/a&gt;: The delete shard API has been made more resilient against failures resulting from non-existent cores.&lt;/p&gt;</comment>
                            <comment id="15449719" author="jira-bot" created="Tue, 30 Aug 2016 18:15:24 +0000"  >&lt;p&gt;Commit 6bf9513b9385a53557dc0849eb36a062aceb8e8c in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6bf9513&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6bf9513&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9439&quot; title=&quot;Shard split clean up logic for older failed splits is faulty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9439&quot;&gt;&lt;del&gt;SOLR-9439&lt;/del&gt;&lt;/a&gt;: The delete shard API has been made more resilient against failures resulting from non-existent cores.&lt;br/&gt;
(cherry picked from commit 02b97a2)&lt;/p&gt;</comment>
                            <comment id="15449721" author="shalinmangar" created="Tue, 30 Aug 2016 18:15:53 +0000"  >&lt;p&gt;Thanks Steve!&lt;/p&gt;</comment>
                            <comment id="15482801" author="shalinmangar" created="Mon, 12 Sep 2016 02:12:38 +0000"  >&lt;p&gt;Re-opened to back-port to 6.2.1&lt;/p&gt;</comment>
                            <comment id="15508547" author="shalinmangar" created="Wed, 21 Sep 2016 03:03:26 +0000"  >&lt;p&gt;Closing after 6.2.1 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12999801">SOLR-9438</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12826027" name="Lucene-Solr-tests-master.8015.log.gz" size="351020" author="sarowe" created="Mon, 29 Aug 2016 16:12:07 +0000"/>
                            <attachment id="12826214" name="SOLR-9439-fix-deleteshard.patch" size="10782" author="shalin" created="Tue, 30 Aug 2016 17:45:36 +0000"/>
                            <attachment id="12826179" name="SOLR-9439-fix-deleteshard.patch" size="9611" author="shalin" created="Tue, 30 Aug 2016 13:08:07 +0000"/>
                            <attachment id="12825759" name="SOLR-9439.patch" size="11229" author="shalin" created="Sat, 27 Aug 2016 02:54:30 +0000"/>
                            <attachment id="12825712" name="SOLR-9439.patch" size="9033" author="shalin" created="Fri, 26 Aug 2016 21:11:54 +0000"/>
                            <attachment id="12825338" name="SOLR-9439.patch" size="2203" author="shalin" created="Wed, 24 Aug 2016 21:20:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32qzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>