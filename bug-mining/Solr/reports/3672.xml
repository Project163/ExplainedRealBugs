<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:29:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11445] Overseer should not hang when process bad message</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11445</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>
&lt;p&gt;So we had the following stack trace with a customer:&lt;/p&gt;

&lt;p&gt;2017-10-04 11:25:30.339 ERROR (xxxx) [ ] o.a.s.c.Overseer Exception in Overseer main queue loop&lt;br/&gt;
org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /collections/xxxx/state.json&lt;br/&gt;
    at org.apache.zookeeper.KeeperException.create(KeeperException.java:111)&lt;br/&gt;
    at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)&lt;br/&gt;
    at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:783)&lt;br/&gt;
    at org.apache.solr.common.cloud.SolrZkClient$9.execute(SolrZkClient.java:391)&lt;br/&gt;
    at org.apache.solr.common.cloud.SolrZkClient$9.execute(SolrZkClient.java:388)&lt;br/&gt;
    at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:60)&lt;br/&gt;
    at org.apache.solr.common.cloud.SolrZkClient.create(SolrZkClient.java:388)&lt;br/&gt;
    at org.apache.solr.cloud.overseer.ZkStateWriter.writePendingUpdates(ZkStateWriter.java:235)&lt;br/&gt;
    at org.apache.solr.cloud.overseer.ZkStateWriter.enqueueUpdate(ZkStateWriter.java:152)&lt;br/&gt;
    at org.apache.solr.cloud.Overseer$ClusterStateUpdater.processQueueItem(Overseer.java:271)&lt;br/&gt;
    at org.apache.solr.cloud.Overseer$ClusterStateUpdater.run(Overseer.java:199)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;

&lt;p&gt;I want to highlight: &lt;br/&gt;
  at org.apache.solr.cloud.overseer.ZkStateWriter.enqueueUpdate(ZkStateWriter.java:152)&lt;br/&gt;
    at org.apache.solr.cloud.Overseer$ClusterStateUpdater.processQueueItem(Overseer.java:271)&lt;/p&gt;

&lt;p&gt;This ends up coming from Overseer:&lt;br/&gt;
while (data != null)  {&lt;br/&gt;
                final ZkNodeProps message = ZkNodeProps.load(data);&lt;br/&gt;
                log.debug(&quot;processMessage: workQueueSize: {}, message = {}&quot;, workQueue.getStats().getQueueLength(), message);&lt;br/&gt;
                // force flush to ZK after each message because there is no fallback if workQueue items&lt;br/&gt;
                // are removed from workQueue but fail to be written to ZK&lt;br/&gt;
                *clusterState = processQueueItem(message, clusterState, zkStateWriter, false, null);&lt;br/&gt;
                workQueue.poll(); // poll-ing removes the element we got by peek-ing*&lt;br/&gt;
                data = workQueue.peek();&lt;br/&gt;
              }&lt;/p&gt;

&lt;p&gt;Note: The processQueueItem comes before the poll, therefore upon a thrown exception the same node/message that won&apos;t process becomes stuck. This made a large cluster unable to come up on it&apos;s own without deleting the problem node. &lt;/p&gt;
</description>
                <environment></environment>
        <key id="13107634">SOLR-11445</key>
            <summary>Overseer should not hang when process bad message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="caomanhdat">Cao Manh Dat</assignee>
                                    <reporter username="harrisgreg07">Greg Harris</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Oct 2017 21:44:16 +0000</created>
                <updated>Sat, 8 Jun 2019 15:24:04 +0000</updated>
                            <resolved>Fri, 13 Oct 2017 01:19:20 +0000</resolved>
                                    <version>6.6.1</version>
                    <version>7.0</version>
                    <version>8.0</version>
                                    <fixVersion>7.2</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16200025" author="caomanhdat" created="Wed, 11 Oct 2017 09:42:05 +0000"  >&lt;p&gt;Here is a patch for this ticket, which will poll out the message from the workQueue when encountering an exception.&lt;/p&gt;</comment>
                            <comment id="16200061" author="shalinmangar" created="Wed, 11 Oct 2017 10:12:09 +0000"  >&lt;p&gt;I think it is better that we explicitly check for NoNode or NodeExists exceptions in the isBadMessageOrInvalidState() method. Most other KeeperExceptions shouldn&apos;t cause us to poll items off the queue. Also, the same kind of handling should be done for exceptions thrown when processing messages from state update queue.&lt;/p&gt;</comment>
                            <comment id="16201324" author="caomanhdat" created="Thu, 12 Oct 2017 01:47:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think it is better that we explicitly check for NoNode or NodeExists exceptions in the isBadMessageOrInvalidState() method.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah, that&apos;s a good idea.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, the same kind of handling should be done for exceptions thrown when processing messages from state update queue.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We can&apos;t do this. We process state update queue in batch, so we don&apos;t know which message is the bad message. So we must fall-back on using workqueue + reread cluster state from Zk.&lt;/p&gt;</comment>
                            <comment id="16201513" author="shalinmangar" created="Thu, 12 Oct 2017 06:25:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;We process state update queue in batch, so we don&apos;t know which message is the bad message. So we must fall-back on using workqueue + reread cluster state from Zk.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Okay, sounds good to me.&lt;/p&gt;</comment>
                            <comment id="16201551" author="caomanhdat" created="Thu, 12 Oct 2017 07:18:27 +0000"  >&lt;p&gt;Updated patch, including test. These are some changes&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Refactoring logic of how Overseer catching Exception&lt;/li&gt;
	&lt;li&gt;The bad message will be polled out from the queue ( message that causes NoNodeException || NodeExistException || Any other exceptions - except InterruptedException and KeeperException )&lt;/li&gt;
	&lt;li&gt;After poll out the bad message, we will continue processing workqueue&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Will commit soon.&lt;/p&gt;</comment>
                            <comment id="16201602" author="jira-bot" created="Thu, 12 Oct 2017 08:09:05 +0000"  >&lt;p&gt;Commit df5fefb0dbfca1783126798df9c7e303d40ace16 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=df5fefb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=df5fefb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11445&quot; title=&quot;Overseer should not hang when process bad message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11445&quot;&gt;&lt;del&gt;SOLR-11445&lt;/del&gt;&lt;/a&gt;: Overseer should not hang when process bad message&lt;/p&gt;</comment>
                            <comment id="16202912" author="jira-bot" created="Fri, 13 Oct 2017 01:17:22 +0000"  >&lt;p&gt;Commit 4bc7fd2bd54c6a06f88c9aa2de9d3b94f5a77efb in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4bc7fd2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4bc7fd2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11445&quot; title=&quot;Overseer should not hang when process bad message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11445&quot;&gt;&lt;del&gt;SOLR-11445&lt;/del&gt;&lt;/a&gt;: Upgrade CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16202914" author="jira-bot" created="Fri, 13 Oct 2017 01:18:39 +0000"  >&lt;p&gt;Commit fc981dd5acee6962ff1d35e8238af4e47829e4b5 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fc981dd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fc981dd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11445&quot; title=&quot;Overseer should not hang when process bad message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11445&quot;&gt;&lt;del&gt;SOLR-11445&lt;/del&gt;&lt;/a&gt;: Overseer should not hang when process bad message&lt;/p&gt;</comment>
                            <comment id="16202915" author="jira-bot" created="Fri, 13 Oct 2017 01:18:42 +0000"  >&lt;p&gt;Commit 2795287b0e56148102ae802259a59d80907e4d1a in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2795287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2795287&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11445&quot; title=&quot;Overseer should not hang when process bad message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11445&quot;&gt;&lt;del&gt;SOLR-11445&lt;/del&gt;&lt;/a&gt;: Upgrade CHANGES.txt&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12891653" name="SOLR-11445.patch" size="9637" author="caomanhdat" created="Thu, 12 Oct 2017 07:11:42 +0000"/>
                            <attachment id="12891448" name="SOLR-11445.patch" size="2287" author="caomanhdat" created="Wed, 11 Oct 2017 09:38:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kzgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>