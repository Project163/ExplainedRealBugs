<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:21:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2339] No error reported when sorting on a multiValued field</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2339</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In the past, Solr has relied on the underlying FieldCache to throw an error in situations where sorting on a field was not possible.  however &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2142&quot; title=&quot;FieldCache.getStringIndex should not throw exception if term count exceeds doc count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-2142&quot;&gt;&lt;del&gt;LUCENE-2142&lt;/del&gt;&lt;/a&gt; has changed this, so that FieldCache never throws an error.&lt;/p&gt;

&lt;p&gt;In order to maintain the functionality of past Solr releases (ie: error when users attempt to sort on a field that we known will produce meaningless results) we should add some sort of check at the Solr level.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12497007">SOLR-2339</key>
            <summary>No error reported when sorting on a multiValued field</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Jan 2011 02:04:06 +0000</created>
                <updated>Tue, 17 May 2011 01:58:53 +0000</updated>
                            <resolved>Fri, 4 Feb 2011 00:11:20 +0000</resolved>
                                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12987888" author="hossman" created="Fri, 28 Jan 2011 02:17:40 +0000"  >&lt;p&gt;I&apos;m not sure the best way to go about this ... we could reimplement the basic termcount vs doccount check that use to be done at a higher level before using the FieldCache &amp;#8211; but that may be overkill and i&apos;m not convinced we need to behave in exactly the same way as before.&lt;/p&gt;

&lt;p&gt;At a minimum we should probably start logging a warning if someone does a sort on a field that is configured to be multiValued=true.&lt;/p&gt;

&lt;p&gt;Alternately: we could consider adding a property to the StringIndex and DocTermsIndex classes (on their respective branches) so that FieldCache could indicate when it suspects there may be a problem (using simple doccount &amp;lt; termcount, or something more complex if it&apos;s easy), and Solr could error/log if that property is set.&lt;/p&gt;</comment>
                            <comment id="12989016" author="hossman" created="Tue, 1 Feb 2011 03:06:13 +0000"  >&lt;p&gt;yonik pointed out on IRC that the main motivation behind &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2142&quot; title=&quot;FieldCache.getStringIndex should not throw exception if term count exceeds doc count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-2142&quot;&gt;&lt;del&gt;LUCENE-2142&lt;/del&gt;&lt;/a&gt; could easily apply to solr users as well...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So this means... you could happily think all is good, until some day, well into production, once you&apos;ve updated enough docs, suddenly the check will catch you and throw an unhandled exception, stopping all searches &lt;span class=&quot;error&quot;&gt;&amp;#91;that need to sort by this string field&amp;#93;&lt;/span&gt; in their tracks. It&apos;s not gracefully degrading.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;...arguing that for solr users as well: the loss of this particular check is a feature and not a bug.&lt;/p&gt;

&lt;p&gt;i feel like the user bases and use cases are different enough that the &quot;default&quot; behavior should be different &amp;#8211; but not enough to fight strongly for it.&lt;/p&gt;

&lt;p&gt;if anyone else has an opinion, please comment &amp;#8211; for now i&apos;m going to just tackle the case where there is not doubt you have a problem: sorting on a multiValued field &lt;/p&gt;

</comment>
                            <comment id="12989498" author="hossman" created="Wed, 2 Feb 2011 02:48:26 +0000"  >&lt;p&gt;patch that forces failure for multivalued fields, along with an example of how i think we should call this behavior change out in CHANGES.txt&lt;/p&gt;

&lt;p&gt;this uncovered a lot of tests that were missusing fields declared as multivalued &amp;#8211; BasicDistributedZkTest and TestDistributedSearch are still failing in this patch, largely because i&apos;m so confused about how they work it&apos;s not even clear to me what schema.xml file they are using to try and fix it.&lt;/p&gt;</comment>
                            <comment id="12989499" author="hossman" created="Wed, 2 Feb 2011 02:52:20 +0000"  >&lt;p&gt;I should have mentioned when i attached the patch: the approach i took here was to add a &quot;void checkSortability()&quot; method to SchemaField that tests isMultivalued &amp;#8211; i also moved the &quot;is this field indexed?&quot; check here (it use to be part of QueryParsing.parseSortSpec) and changed all the out of hte box FieldTypes to call this method in their getSortField implementation &amp;#8211; this way we have acommon (documented) hook point where we can add future helper tests for things that don&apos;t make sense of in sorting, but it&apos;s still up to the FieldType to decide what to do if someone wants to make a really exotic one (RandomSortField for example doesn&apos;t even care if it&apos;s indexed).&lt;/p&gt;

&lt;p&gt;If anyone has any better suggestions please chime in.&lt;/p&gt;</comment>
                            <comment id="12989500" author="hossman" created="Wed, 2 Feb 2011 02:55:06 +0000"  >&lt;p&gt;It also occurs to me that we should probably put this same check in for dealing with ValueSources that are FieldCache based ... not in ValueSource.getSortField, but in FieldType.getValueSource for the affected FieldTypes.&lt;/p&gt;</comment>
                            <comment id="12989929" author="hossman" created="Thu, 3 Feb 2011 00:51:20 +0000"  >&lt;p&gt;Updated patch that fixes the remaining sort related test failures.&lt;/p&gt;

&lt;p&gt;TestDistributedSearch and BasicDistributedZkTest were fundementally flawed in that they expected to get deterministic sort orderings on fields that they were deliberately putting multiple values into (ie: not just sorting on a multivalued field; sorting on a multivalued field that was actually used to store multiple values for each doc)&lt;/p&gt;

&lt;p&gt;I&apos;m amazed they ever passed. &lt;/p&gt;</comment>
                            <comment id="12990367" author="hossman" created="Thu, 3 Feb 2011 23:16:30 +0000"  >&lt;p&gt;i spun of the ValueSource issue into &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2348&quot; title=&quot;No error reported when using a FieldCached backed ValueSource for a field Solr knows won&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2348&quot;&gt;&lt;del&gt;SOLR-2348&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12990369" author="hossman" created="Thu, 3 Feb 2011 23:20:23 +0000"  >&lt;p&gt;narrowing issue summary to be specific about multiValued fields since that&apos;s all we&apos;ve decided to tackle for now.&lt;/p&gt;</comment>
                            <comment id="12990378" author="hossman" created="Thu, 3 Feb 2011 23:39:09 +0000"  >&lt;p&gt;Committed revision 1067030. - trunk&lt;/p&gt;

&lt;p&gt;Still working on the backport to 3x (this is hte first time svn has ever given me a &quot;Tree conflict&quot; for a file) &lt;/p&gt;</comment>
                            <comment id="12990397" author="hossman" created="Fri, 4 Feb 2011 00:11:20 +0000"  >&lt;p&gt;Committed revision 1067042.&lt;/p&gt;

&lt;p&gt;backported to 3x&lt;/p&gt;</comment>
                            <comment id="13013108" author="gsingers" created="Wed, 30 Mar 2011 15:45:33 +0000"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                            <comment id="13034492" author="billnbell" created="Tue, 17 May 2011 01:48:04 +0000"  >&lt;p&gt;Guys,&lt;/p&gt;

&lt;p&gt;How are we going to support sorting on multiValued fields?&lt;/p&gt;

&lt;p&gt;Would a function work for this?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12480640">SOLR-2249</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12497636">SOLR-2348</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12443006">LUCENE-2142</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12507438">SOLR-2522</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12470094" name="SOLR-2339.patch" size="56843" author="hossman" created="Thu, 3 Feb 2011 00:51:20 +0000"/>
                            <attachment id="12470011" name="SOLR-2339.patch" size="51880" author="hossman" created="Wed, 2 Feb 2011 02:48:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5186</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03ldb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18895</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>