<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:43:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14073] Fix segment look ahead NPE in CollapsingQParserPlugin</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14073</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The CollapsingQParserPlugin has a bug that if every segment is not visited during the collect it throws an NPE. This causes the CollapsingQParserPlugin to not work when used with any feature that short circuits the segments during the collect. This includes using the CollapsingQParserPlugin twice in the same query and the time limiting collector.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13274149">SOLR-14073</key>
            <summary>Fix segment look ahead NPE in CollapsingQParserPlugin</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10003">Resolved</resolution>
                                        <assignee username="jbernste">Joel Bernstein</assignee>
                                    <reporter username="jbernste">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Dec 2019 13:28:01 +0000</created>
                <updated>Tue, 24 Mar 2020 12:44:37 +0000</updated>
                            <resolved>Mon, 9 Mar 2020 23:29:48 +0000</resolved>
                                                    <fixVersion>8.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16994739" author="joel.bernstein" created="Thu, 12 Dec 2019 14:28:36 +0000"  >&lt;p&gt;This is an untested patch. I&apos;m going to do a whole lot of testing to see if this fully resolves issues with using CollapsingQParserPlugin twice in the same query.&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17018150" author="joel.bernstein" created="Fri, 17 Jan 2020 16:02:53 +0000"  >&lt;p&gt;The initial patch seems to work but it&apos;s quite hard to reason about.&lt;/p&gt;

&lt;p&gt;I&apos;m going to try a different approach which is easier to reason about which is to pre-populate the contexts array rather then populating it as the segments are visited. This should eliminate the look-ahead NPE as well.&lt;/p&gt;</comment>
                            <comment id="17054578" author="jira-bot" created="Mon, 9 Mar 2020 00:51:23 +0000"  >&lt;p&gt;Commit 01688cd8f108609b2c250e67b380bce396818001 in lucene-solr&apos;s branch refs/heads/master from Joel Bernstein&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=01688cd8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=01688cd8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14073&quot; title=&quot;Fix segment look ahead NPE in CollapsingQParserPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14073&quot;&gt;&lt;del&gt;SOLR-14073&lt;/del&gt;&lt;/a&gt;: Fix segment look ahead NPE in CollapsingQParserPlugin&lt;/p&gt;</comment>
                            <comment id="17054586" author="jira-bot" created="Mon, 9 Mar 2020 01:12:37 +0000"  >&lt;p&gt;Commit 904407f0b640ef5135c3940aec80225d7aee7165 in lucene-solr&apos;s branch refs/heads/branch_8x from Joel Bernstein&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=904407f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=904407f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14073&quot; title=&quot;Fix segment look ahead NPE in CollapsingQParserPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14073&quot;&gt;&lt;del&gt;SOLR-14073&lt;/del&gt;&lt;/a&gt;: Fix segment look ahead NPE in CollapsingQParserPlugin&lt;/p&gt;</comment>
                            <comment id="17055453" author="jira-bot" created="Mon, 9 Mar 2020 23:12:03 +0000"  >&lt;p&gt;Commit e6616ba7a3ca64195108a3a3ef2809be20920741 in lucene-solr&apos;s branch refs/heads/master from Joel Bernstein&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e6616ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e6616ba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14073&quot; title=&quot;Fix segment look ahead NPE in CollapsingQParserPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14073&quot;&gt;&lt;del&gt;SOLR-14073&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="17055458" author="jira-bot" created="Mon, 9 Mar 2020 23:18:40 +0000"  >&lt;p&gt;Commit a8b03cd96e7b1ea95e0f97b5eaaff23ff598300f in lucene-solr&apos;s branch refs/heads/branch_8x from Joel Bernstein&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a8b03cd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a8b03cd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14073&quot; title=&quot;Fix segment look ahead NPE in CollapsingQParserPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14073&quot;&gt;&lt;del&gt;SOLR-14073&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="17055460" author="jira-bot" created="Mon, 9 Mar 2020 23:26:23 +0000"  >&lt;p&gt;Commit b056f2f167a0afbea5b0e7f5ca6ebad43686980a in lucene-solr&apos;s branch refs/heads/branch_8_5 from Joel Bernstein&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b056f2f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b056f2f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14073&quot; title=&quot;Fix segment look ahead NPE in CollapsingQParserPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14073&quot;&gt;&lt;del&gt;SOLR-14073&lt;/del&gt;&lt;/a&gt;: Fix segment look ahead NPE in CollapsingQParserPlugin&lt;/p&gt;</comment>
                            <comment id="17055461" author="jira-bot" created="Mon, 9 Mar 2020 23:26:25 +0000"  >&lt;p&gt;Commit 0ae8db0aa0d21508adce12c9926269a69c089520 in lucene-solr&apos;s branch refs/heads/branch_8_5 from Joel Bernstein&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=0ae8db0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=0ae8db0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14073&quot; title=&quot;Fix segment look ahead NPE in CollapsingQParserPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14073&quot;&gt;&lt;del&gt;SOLR-14073&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="17058449" author="munendrasn" created="Fri, 13 Mar 2020 06:15:21 +0000"  >&lt;p&gt;Since multiple Collapse  are supported should we update the documentation saying with multiple collapse and expand=true, one of the  collapse filter would be chosen(I think it would be the last one).&lt;/p&gt;

&lt;p&gt;Also, expand.field is not documented. Should we add it documentation? (This is separate topic, just wanted share here)&lt;/p&gt;</comment>
                            <comment id="17058807" author="joel.bernstein" created="Fri, 13 Mar 2020 14:57:03 +0000"  >&lt;p&gt;You can control the order of multiple collapses with the &quot;cost&quot; parameter. The cost parameter should be set to above 100 in all cases, but lower cost collapses will come before higher cost collapses:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
fq={!collapse cost=200 field=a}&amp;amp;fq={!collapse cost=300 field=b}  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17058883" author="munendrasn" created="Fri, 13 Mar 2020 16:09:26 +0000"  >&lt;p&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12996669/12996669_SOLR-14073-expand.patch&quot; title=&quot;SOLR-14073-expand.patch attached to SOLR-14073&quot;&gt;SOLR-14073-expand.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;  (not a complete test no assertion as came up in lesser time, ran in debug mode to check picked collapse  field)&lt;br/&gt;
cost would control the order of execution and when it is greater than 100 it would  be executed as postFilter&lt;/p&gt;

&lt;p&gt;My query was  more related to how expand component will behave in case of multiple collapse filters. It  would be pick the only one collapse. The question is which collapse field would  be picked&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/apache/lucene-solr/blob/0f10b5f0424d592ed319e1b90d91f28c3a8625a9/solr/core/src/java/org/apache/solr/handler/component/ExpandComponent.java#L147&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Based on this, the last collapse field is picked for expand irrespective of the cost. Here, we can make change such that field is picked up based on cost instead of order or maybe for trunk support expand for all collapse fields(if possible)&lt;br/&gt;
I&apos;m not sure if above things come under this issue or not, just wanted to share my  thoughts.&lt;br/&gt;
Thanks for fixing multiple collapse issue. Also, I&apos;m going to resolve the related issues, as they look similar&lt;br/&gt;
Sincere apologies, if I wasn&apos;t clear in  the initial comment&lt;/p&gt;</comment>
                            <comment id="17059679" author="munendrasn" created="Sun, 15 Mar 2020 14:11:19 +0000"  >&lt;p&gt;I have created &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14329&quot; title=&quot;Add support to choose field for expand component from multiple collapse groups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14329&quot;&gt;&lt;del&gt;SOLR-14329&lt;/del&gt;&lt;/a&gt; for changes in expand component.&lt;/p&gt;</comment>
                            <comment id="17061409" author="jira-bot" created="Wed, 18 Mar 2020 05:35:09 +0000"  >&lt;p&gt;Commit 7f37a55a8c00f7560e4199ae464523162380f5e3 in lucene-solr&apos;s branch refs/heads/master from Munendra S N&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=7f37a55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=7f37a55&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13944&quot; title=&quot;CollapsingQParserPlugin throws NPE instead of bad request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13944&quot;&gt;&lt;del&gt;SOLR-13944&lt;/del&gt;&lt;/a&gt;: remove redundant checks in SpellCheckCollator&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14073&quot; title=&quot;Fix segment look ahead NPE in CollapsingQParserPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14073&quot;&gt;&lt;del&gt;SOLR-14073&lt;/del&gt;&lt;/a&gt;, these checks become redundant and add&lt;br/&gt;
  additional tests for spellcheck with collapse&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17061423" author="jira-bot" created="Wed, 18 Mar 2020 05:48:46 +0000"  >&lt;p&gt;Commit 22a91af96d4aa88cfba181cc5cb324bd593426f5 in lucene-solr&apos;s branch refs/heads/branch_8x from Munendra S N&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=22a91af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=22a91af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13944&quot; title=&quot;CollapsingQParserPlugin throws NPE instead of bad request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13944&quot;&gt;&lt;del&gt;SOLR-13944&lt;/del&gt;&lt;/a&gt;: remove redundant checks in SpellCheckCollator&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14073&quot; title=&quot;Fix segment look ahead NPE in CollapsingQParserPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14073&quot;&gt;&lt;del&gt;SOLR-14073&lt;/del&gt;&lt;/a&gt;, these checks become redundant and add&lt;br/&gt;
  additional tests for spellcheck with collapse&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17065577" author="romseygeek" created="Tue, 24 Mar 2020 12:44:37 +0000"  >&lt;p&gt;Bulk close for 8.5.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12967426">SOLR-9104</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13057972">SOLR-10336</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12822596">SOLR-7435</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13291817">SOLR-14329</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12996669" name="SOLR-14073-expand.patch" size="2134" author="munendrasn" created="Fri, 13 Mar 2020 15:57:59 +0000"/>
                            <attachment id="12995890" name="SOLR-14073.patch" size="7298" author="jbernste" created="Fri, 6 Mar 2020 17:58:21 +0000"/>
                            <attachment id="12991245" name="SOLR-14073.patch" size="4218" author="jbernste" created="Fri, 17 Jan 2020 18:47:53 +0000"/>
                            <attachment id="12988699" name="SOLR-14073.patch" size="5376" author="jbernste" created="Thu, 12 Dec 2019 14:25:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09m28:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>