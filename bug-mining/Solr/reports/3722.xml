<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:29:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11616] Backup failing on a constantly changing index with NoSuchFileException</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11616</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As reported by several users on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9120&quot; title=&quot;LukeRequestHandler logs WARN &amp;quot;Error getting file length for [segments_NNN]&amp;quot; for inconsequential NoSuchFileException situations -- looks scary but is not a problem, logging should be reduced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9120&quot;&gt;&lt;del&gt;SOLR-9120&lt;/del&gt;&lt;/a&gt; , Solr backups fail with NoSuchFileException on a constantly changing index. &lt;/p&gt;

&lt;p&gt;Users linked &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9120&quot; title=&quot;LukeRequestHandler logs WARN &amp;quot;Error getting file length for [segments_NNN]&amp;quot; for inconsequential NoSuchFileException situations -- looks scary but is not a problem, logging should be reduced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9120&quot;&gt;&lt;del&gt;SOLR-9120&lt;/del&gt;&lt;/a&gt; to the root cause as the stack trace is the same , but the fix proposed there won&apos;t fix backups to stop failing.&lt;/p&gt;

&lt;p&gt;We need to implement a similar fix in &lt;tt&gt;SnapShooter#createSnapshot&lt;/tt&gt; to fix the problem&lt;/p&gt;</description>
                <environment></environment>
        <key id="13116767">SOLR-11616</key>
            <summary>Backup failing on a constantly changing index with NoSuchFileException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Nov 2017 18:24:03 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:26 +0000</updated>
                            <resolved>Tue, 5 Dec 2017 18:04:30 +0000</resolved>
                                                    <fixVersion>7.2</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="16242588" author="varunthacker" created="Tue, 7 Nov 2017 18:32:30 +0000"  >&lt;p&gt;Completely untested patch copying the solution that was used in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9120&quot; title=&quot;LukeRequestHandler logs WARN &amp;quot;Error getting file length for [segments_NNN]&amp;quot; for inconsequential NoSuchFileException situations -- looks scary but is not a problem, logging should be reduced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9120&quot;&gt;&lt;del&gt;SOLR-9120&lt;/del&gt;&lt;/a&gt; . &lt;/p&gt;

&lt;p&gt;I will test it out later in the week but wanted to put the fix out there &lt;/p&gt;</comment>
                            <comment id="16242983" author="hossman" created="Tue, 7 Nov 2017 21:57:36 +0000"  >&lt;p&gt;1) Repeating here some key comments i just made in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9120&quot; title=&quot;LukeRequestHandler logs WARN &amp;quot;Error getting file length for [segments_NNN]&amp;quot; for inconsequential NoSuchFileException situations -- looks scary but is not a problem, logging should be reduced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9120&quot;&gt;&lt;del&gt;SOLR-9120&lt;/del&gt;&lt;/a&gt; since there are very relevant...&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;And FWIW: The more i read up on all of these issues: No one has ever actually posted any explicit logs, or steps to reproduce, of any failures with backup (or ReplicationHandler) to this (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9120&quot; title=&quot;LukeRequestHandler logs WARN &amp;quot;Error getting file length for [segments_NNN]&amp;quot; for inconsequential NoSuchFileException situations -- looks scary but is not a problem, logging should be reduced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9120&quot;&gt;&lt;del&gt;SOLR-9120&lt;/del&gt;&lt;/a&gt;) issue (or for that matter: to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8587&quot; title=&quot;Add segments file information to core admin status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8587&quot;&gt;&lt;del&gt;SOLR-8587&lt;/del&gt;&lt;/a&gt;, or to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8793&quot; title=&quot;Fix stale commit files&amp;#39; size computation in LukeRequestHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8793&quot;&gt;&lt;del&gt;SOLR-8793&lt;/del&gt;&lt;/a&gt;, &lt;b&gt;OR&lt;/b&gt; to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11616&quot; title=&quot;Backup failing on a constantly changing index with NoSuchFileException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11616&quot;&gt;&lt;del&gt;SOLR-11616&lt;/del&gt;&lt;/a&gt;) ... AFAICT there is only anecdotal information claiming that these exceptions (logged by LukeRequestHandler) are also a &quot;similar problem&quot; to doing backups/replication.&lt;/p&gt;

&lt;p&gt;If anyone has can provide &lt;b&gt;Actual logs&lt;/b&gt; from an error occuring during backup/replication &amp;#8211; along with configs / steps to reproduce: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11616&quot; title=&quot;Backup failing on a constantly changing index with NoSuchFileException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11616&quot;&gt;&lt;del&gt;SOLR-11616&lt;/del&gt;&lt;/a&gt; is the place to post them.&lt;/p&gt;

&lt;p&gt;AFAIK there is &lt;b&gt;NO&lt;/b&gt; code in LukeRequestHandler that is used by any backup/replication based code &amp;#8211; it is purely for &lt;em&gt;status&lt;/em&gt; purposes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;2) specifically in regards to the current &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11616&quot; title=&quot;Backup failing on a constantly changing index with NoSuchFileException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11616&quot;&gt;&lt;del&gt;SOLR-11616&lt;/del&gt;&lt;/a&gt;.patch ...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Completely untested patch copying the solution that was used in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9120&quot; title=&quot;LukeRequestHandler logs WARN &amp;quot;Error getting file length for [segments_NNN]&amp;quot; for inconsequential NoSuchFileException situations -- looks scary but is not a problem, logging should be reduced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9120&quot;&gt;&lt;del&gt;SOLR-9120&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To be very clear: there is no indication/evidence that this is a &quot;solution&quot; to anything &amp;#8211; the patch that this &quot;copies&quot; from very much does not address the fundmental source of the NoSuchFileExceptions in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9120&quot; title=&quot;LukeRequestHandler logs WARN &amp;quot;Error getting file length for [segments_NNN]&amp;quot; for inconsequential NoSuchFileException situations -- looks scary but is not a problem, logging should be reduced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9120&quot;&gt;&lt;del&gt;SOLR-9120&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3) Before we go considering changes to which IndexCommit point the backup code looks at, it would be nice to have:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;some actual logs w/stack traces showing an actual problem&lt;/li&gt;
	&lt;li&gt;some details of how to reproduce (even if vague or not 100% reproducible) the problem that manifested those logs/exceptions&lt;/li&gt;
	&lt;li&gt;an explanation &amp;#8211; in words &amp;#8211; as to &lt;b&gt;why&lt;/b&gt; folks &lt;em&gt;feel&lt;/em&gt; like changing the source of the IndexCommit used by SnapShooter is &quot;more correct&quot; then the current code
	&lt;ul&gt;
		&lt;li&gt;ideally i&apos;d love to see a formal proof (w/junit test) that &lt;b&gt;proves&lt;/b&gt; the patch is &quot;correct&quot; but i&apos;ll settle for an explanation of a feeling&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16243062" author="varunthacker" created="Tue, 7 Nov 2017 22:55:33 +0000"  >&lt;p&gt;I was able to reproduce it very easily on Solr 6.3&lt;/p&gt;

&lt;p&gt;Just kept continuous index running with commits and open searchers and then ran the backup command. &lt;/p&gt;

&lt;p&gt;Response from the API call&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;response&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;&amp;gt;
&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;500&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;&amp;gt;636&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;failure&quot;&lt;/span&gt;&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;172.16.0.83:8983_solr&quot;&lt;/span&gt;&amp;gt;org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException:Error from server at http:&lt;span class=&quot;code-comment&quot;&gt;//172.16.0.83:8983/solr: Failed to backup core=gettingstarted_shard1_replica1 because java.nio.file.NoSuchFileException: /Users/varunthacker/Downloads/search-downloads/solr-6.3.0/example/cloud/node1/solr/gettingstarted_shard1_replica1/data/index/segments_32&amp;lt;/str&amp;gt;
&lt;/span&gt;&amp;lt;/lst&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Operation backup caused exception:&quot;&lt;/span&gt;&amp;gt;org.apache.solr.common.SolrException:org.apache.solr.common.SolrException: Could not backup all replicas&amp;lt;/str&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;exception&quot;&lt;/span&gt;&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;msg&quot;&lt;/span&gt;&amp;gt;Could not backup all replicas&amp;lt;/str&amp;gt;
&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;rspCode&quot;&lt;/span&gt;&amp;gt;500&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;error&quot;&lt;/span&gt;&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;metadata&quot;&lt;/span&gt;&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;error-class&quot;&lt;/span&gt;&amp;gt;org.apache.solr.common.SolrException&amp;lt;/str&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;root-error-class&quot;&lt;/span&gt;&amp;gt;org.apache.solr.common.SolrException&amp;lt;/str&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;msg&quot;&lt;/span&gt;&amp;gt;Could not backup all replicas&amp;lt;/str&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt;&amp;gt;org.apache.solr.common.SolrException: Could not backup all replicas	at org.apache.solr.handler.admin.CollectionsHandler.handleResponse(CollectionsHandler.java:287)	at org.apache.solr.handler.admin.CollectionsHandler.handleRequestBody(CollectionsHandler.java:218)	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:153)	at org.apache.solr.servlet.HttpSolrCall.handleAdminRequest(HttpSolrCall.java:660)	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:441)	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:303)	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:254)	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1668)	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)	at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)	at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)	at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)	at org.eclipse.jetty.server.Server.handle(Server.java:518)	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)	at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)	at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)&amp;lt;/str&amp;gt;
&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;code&quot;&lt;/span&gt;&amp;gt;500&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;/response&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;I wasn&apos;t able to reproduce this on Solr 7.1 . As soon as I issue a backup command I see updates come to a grinding halt i.e the backup took 2 minutes and i only saw 4 update requests come in . Before the after the backup docs were being added every 200 milliseconds. So something was blocking updates during the backup command and hence the call succeeded? Very strange . I&apos;ll dig into this more&lt;/p&gt;</comment>
                            <comment id="16243069" author="varunthacker" created="Tue, 7 Nov 2017 23:06:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;Before the after the backup docs were being added every 200 milliseconds. So something was blocking updates during the backup command and hence the call succeeded? Very strange . I&apos;ll dig into this more&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s not true. I think the log file might have rotated or something. I do see updates coming in.&lt;/p&gt;

&lt;p&gt;But I&apos;ve been able to successfully backup in Solr 7.1 several times but with Solr 6.3 it failed on my first attempt&lt;/p&gt;</comment>
                            <comment id="16243078" author="varunthacker" created="Tue, 7 Nov 2017 23:17:06 +0000"  >&lt;p&gt;Okay I kept trying and after a few attempts in reproduced on Solr 7.1 as well . I played around with the soft commit time and reduced it to 100ms and then ran into the error&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
responseHeader: {
status: 500,
QTime: 23019
},
failure: {
172.16.0.83:8983_solr: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException:Error from server at http:&lt;span class=&quot;code-comment&quot;&gt;//172.16.0.83:8983/solr: Failed to backup core=gettingstarted_shard2_replica_n6 because java.nio.file.NoSuchFileException: /Users/varunthacker/solr-7.1.0/example/cloud/node1/solr/gettingstarted_shard2_replica_n6/data/index/_i9_Lucene50_0.tip&quot;&lt;/span&gt;
&lt;/span&gt;},
Operation backup caused exception:: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.common.SolrException:org.apache.solr.common.SolrException: Could not backup all replicas&quot;&lt;/span&gt;,
exception: {
msg: &lt;span class=&quot;code-quote&quot;&gt;&quot;Could not backup all replicas&quot;&lt;/span&gt;,
rspCode: 500
},
error: {
metadata: [
&lt;span class=&quot;code-quote&quot;&gt;&quot;error-class&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.common.SolrException&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;root-error-class&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.common.SolrException&quot;&lt;/span&gt;
],
msg: &lt;span class=&quot;code-quote&quot;&gt;&quot;Could not backup all replicas&quot;&lt;/span&gt;,
trace: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.common.SolrException: Could not backup all replicas at org.apache.solr.handler.admin.CollectionsHandler.handleResponse(CollectionsHandler.java:306) at org.apache.solr.handler.admin.CollectionsHandler.invokeAction(CollectionsHandler.java:243) at org.apache.solr.handler.admin.CollectionsHandler.handleRequestBody(CollectionsHandler.java:221) at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:177) at org.apache.solr.servlet.HttpSolrCall.handleAdmin(HttpSolrCall.java:745) at org.apache.solr.servlet.HttpSolrCall.handleAdminRequest(HttpSolrCall.java:726) at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:507) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:382) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:326) at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1751) at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548) at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180) at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512) at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213) at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134) at org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:335) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134) at org.eclipse.jetty.server.Server.handle(Server.java:534) at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320) at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251) at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283) at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108) at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93) at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303) at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148) at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671) at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589) at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:844) &quot;&lt;/span&gt;,
code: 500
}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16243079" author="varunthacker" created="Tue, 7 Nov 2017 23:19:28 +0000"  >&lt;p&gt;Looking at the logs although you see NoSuchFileException it has nothing to do with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9120&quot; title=&quot;LukeRequestHandler logs WARN &amp;quot;Error getting file length for [segments_NNN]&amp;quot; for inconsequential NoSuchFileException situations -- looks scary but is not a problem, logging should be reduced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9120&quot;&gt;&lt;del&gt;SOLR-9120&lt;/del&gt;&lt;/a&gt; . The snapshot code needs to reserve the commit point on which it&apos;s copying files over &lt;/p&gt;</comment>
                            <comment id="16244152" author="ilamgumaran" created="Wed, 8 Nov 2017 15:30:02 +0000"  >&lt;p&gt;Another issue - Not sure if you want to track it separately but the `async` call will report the backup process to be `completed` but I think it should be in `failed` state.&lt;/p&gt;

&lt;p&gt;If `completed` in `async` mode refers to the task being complete (either failed or success does not matter) then we should have a way to find out about the status of the task (either completed successfully or completed but failed) with different status or a different lookup. &lt;/p&gt;</comment>
                            <comment id="16248645" author="varunthacker" created="Sat, 11 Nov 2017 20:17:39 +0000"  >&lt;p&gt;Patch with a test case which will fail all the time if we don&apos;t fold the SnapShooter changes.&lt;/p&gt;

&lt;p&gt;For the test I am invoking the backup-core directly . It makes the BACKUPCORE API available to standalone solr users. SolrCloud users could always access it .&lt;/p&gt;

&lt;p&gt;I think it&apos;s not a big deal. It&apos;s a much cleaner API and we maybe this pushes us to implement &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9239&quot; title=&quot;Deprecate  backup/restore via replication handler in favour of an equvalent core admin api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9239&quot;&gt;SOLR-9239&lt;/a&gt; sooner&lt;/p&gt;</comment>
                            <comment id="16275394" author="jira-bot" created="Sat, 2 Dec 2017 03:39:26 +0000"  >&lt;p&gt;Commit 864ce90d2cd9bfae66506f38823278738afe6c4a in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=864ce90&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=864ce90&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11616&quot; title=&quot;Backup failing on a constantly changing index with NoSuchFileException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11616&quot;&gt;&lt;del&gt;SOLR-11616&lt;/del&gt;&lt;/a&gt;: Snapshot the segments more robustly such that segments created during a backup does does not fail the&lt;br/&gt;
operation&lt;/p&gt;</comment>
                            <comment id="16275395" author="jira-bot" created="Sat, 2 Dec 2017 03:41:05 +0000"  >&lt;p&gt;Commit 62b35006780009758376d9e22b2c1a08e25b83a6 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=62b3500&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=62b3500&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11616&quot; title=&quot;Backup failing on a constantly changing index with NoSuchFileException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11616&quot;&gt;&lt;del&gt;SOLR-11616&lt;/del&gt;&lt;/a&gt;: Snapshot the segments more robustly such that segments created during a backup does does not fail the operation&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 864ce90)&lt;/p&gt;</comment>
                            <comment id="16477719" author="dsmiley" created="Wed, 16 May 2018 16:52:26 +0000"  >&lt;p&gt;Looking at the code for SnapShooter.getIndexCommit, I see we are getting the refcounted searcher but forgetting to decref it. &#160;This looks like a bug and if it isn&apos;t then definitely deserves a comment:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/864ce90d2cd9bfae66506f38823278738afe6c4a/solr/core/src/java/org/apache/solr/handler/SnapShooter.java#L173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/864ce90d2cd9bfae66506f38823278738afe6c4a/solr/core/src/java/org/apache/solr/handler/SnapShooter.java#L173&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As an aside, this incref, decref business is error-prone. &#160;I propose the following new method on SolrCore:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Executes the lambda with the {@link SolrIndexSearcher}.  This is more convenient than using
   * {@link #getSearcher()} since there is no ref-counting business to worry about.
   * Example:
   * &amp;lt;pre class=&lt;span class=&quot;code-quote&quot;&gt;&quot;prettyprint&quot;&lt;/span&gt;&amp;gt;
   *   IndexReader reader = h.getCore().withSearcher(SolrIndexSearcher::getIndexReader);
   * &amp;lt;/pre&amp;gt;
   */
  @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;R&amp;gt; R withSearcher(Function&amp;lt;SolrIndexSearcher,R&amp;gt; lambda) {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RefCounted&amp;lt;SolrIndexSearcher&amp;gt; refCounted = getSearcher();
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; lambda.apply(refCounted.get());
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      refCounted.decref();
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16484430" author="varunthacker" created="Tue, 22 May 2018 19:09:32 +0000"  >&lt;p&gt;+1&#160; . Curious how you ran into this?&#160;&lt;/p&gt;</comment>
                            <comment id="16484468" author="dsmiley" created="Tue, 22 May 2018 19:48:31 +0000"  >&lt;p&gt;I simply found by code inspection/reviewing all callers of getSearcher.  See &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12374&quot; title=&quot;Add SolrCore.withSearcher(lambda accepting SolrIndexSearcher)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12374&quot;&gt;&lt;del&gt;SOLR-12374&lt;/del&gt;&lt;/a&gt;.  We can continue this discussion there.&lt;/p&gt;</comment>
                            <comment id="16522445" author="mkhludnev" created="Mon, 25 Jun 2018 15:39:49 +0000"  >&lt;p&gt;Hello,&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;, can&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11616&quot; title=&quot;Backup failing on a constantly changing index with NoSuchFileException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11616&quot;&gt;&lt;del&gt;SOLR-11616&lt;/del&gt;&lt;/a&gt; cause &quot;incomplete&quot; backups as well?&#160;&lt;/p&gt;</comment>
                            <comment id="16522450" author="varunthacker" created="Mon, 25 Jun 2018 15:44:04 +0000"  >&lt;p&gt;Hi Mikhail,&lt;/p&gt;

&lt;p&gt;I don&apos;t believe so. This would lead to a leaking SolrIndexSearcher under a condition which I am not sure when can it happen.&lt;/p&gt;</comment>
                            <comment id="16901938" author="macros" created="Wed, 7 Aug 2019 09:52:26 +0000"  >&lt;p&gt;&#160;It seems like this issue is back in 7.7.2. We are using the official 7.7.2 container, and we see this during backups sometimes:&lt;/p&gt;

&lt;p&gt;Is it a regression, or there&apos;s something new ?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;level\&quot;:\&quot;ERROR\&quot;, \&quot;collection\&quot;:\&quot;\&quot;, \&quot;shard\&quot;:\&quot;\&quot;, \&quot;replica\&quot;:\&quot;\&quot;, \&quot;core\&quot;:\&quot;\&quot;, \&quot;location\&quot;:\&quot;org.apache.solr.handler.SnapShooter\&quot;, \&quot;message\&quot;:\&quot;Exception while creating snapshot\&quot; ,\&quot;stacktrace\&quot;:\&quot; java.nio.file.NoSuchFileException:
 /store/data/indexname_shard6_0_replica_n53/data/index.20190729153842861/_vngz.fdt\
java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)\
java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)\
java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116)\
java.base/sun.nio.fs.UnixFileSystemProvider.newFileChannel(UnixFileSystemProvider.java:178)\
java.base/java.nio.channels.FileChannel.open(FileChannel.java:292)\
java.base/java.nio.channels.FileChannel.open(FileChannel.java:345)\
org.apache.lucene.store.MMapDirectory.openInput(MMapDirectory.java:238)\
org.apache.lucene.store.NRTCachingDirectory.openInput(NRTCachingDirectory.java:181)\
org.apache.lucene.store.Directory.copyFrom(Directory.java:182)\

org.apache.solr.core.backup.repository.LocalFileSystemRepository.copyFileFrom(LocalFileSystemRepository.java:145)\
org.apache.solr.handler.SnapShooter.createSnapshot(SnapShooter.java:238)\
org.apache.solr.handler.SnapShooter.lambda$createSnapAsync$2(SnapShooter.java:205)\
java.base/java.lang.Thread.run(Thread.java:834)\
\&quot;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is also worth mentioning that this mainly happens when Solr is under load, mostly with READ requests. With no load everything works fine.&lt;/p&gt;</comment>
                            <comment id="16913507" author="montenegro" created="Thu, 22 Aug 2019 17:03:17 +0000"  >&lt;p&gt;It looks this is back in 8.0.0 as well, and we can&apos;t create a backup for our main collection, it always file after one or two minutes:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-08-22 16:47:33.300 ERROR (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-74) [ ] o.a.s.h.SnapShooter Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; creating snapshot
 java.nio.file.NoSuchFileException: /mnt/orcid_data/solr_data/profile/index/_6gne_Lucene50_0.tip
 at sun.nio.fs.UnixException.translateToIOException(UnixException.java:92) ~[?:?]
 at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111) ~[?:?]
 at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116) ~[?:?]
 at sun.nio.fs.UnixFileSystemProvider.newFileChannel(UnixFileSystemProvider.java:178) ~[?:?]
 at java.nio.channels.FileChannel.open(FileChannel.java:292) ~[?:?]
 at java.nio.channels.FileChannel.open(FileChannel.java:345) ~[?:?]
 at org.apache.lucene.store.MMapDirectory.openInput(MMapDirectory.java:238) ~[lucene-core-8.0.0.jar:8.0.0 2ae4746365c1ee72a0047ced7610b2096e438979 - jimczi - 2019-03-08 11:58:55]
 at org.apache.lucene.store.NRTCachingDirectory.openInput(NRTCachingDirectory.java:181) ~[lucene-core-8.0.0.jar:8.0.0 2ae4746365c1ee72a0047ced7610b2096e438979 - jimczi - 2019-03-08 11:58:55]
 at org.apache.lucene.store.Directory.copyFrom(Directory.java:182) ~[lucene-core-8.0.0.jar:8.0.0 2ae4746365c1ee72a0047ced7610b2096e438979 - jimczi - 2019-03-08 11:58:55]
 at org.apache.solr.core.backup.repository.LocalFileSystemRepository.copyFileFrom(LocalFileSystemRepository.java:145) ~[solr-core-8.0.0.jar:8.0.0 2ae4746365c1ee72a0047ced7610b2096e438979 - jimczi - 2019-03-08 12:06:06]
 at org.apache.solr.handler.SnapShooter.createSnapshot(SnapShooter.java:238) ~[solr-core-8.0.0.jar:8.0.0 2ae4746365c1ee72a0047ced7610b2096e438979 - jimczi - 2019-03-08 12:06:06]
 at org.apache.solr.handler.SnapShooter.lambda$createSnapAsync$2(SnapShooter.java:205) [solr-core-8.0.0.jar:8.0.0 2ae4746365c1ee72a0047ced7610b2096e438979 - jimczi - 2019-03-08 12:06:06]
 at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834) [?:?]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16959337" author="hossman" created="Fri, 25 Oct 2019 01:01:15 +0000"  >&lt;p&gt;For folks watching this issue who have noted the problem still seems to exist in recent versions of Solr, I have confirmed that and posted steps to reproduce in a new jira: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13872&quot; title=&quot; Backup can fail to read index files w/NoSuchFileException during merges (SOLR-11616 regression)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13872&quot;&gt;&lt;del&gt;SOLR-13872&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(since &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11616&quot; title=&quot;Backup failing on a constantly changing index with NoSuchFileException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11616&quot;&gt;&lt;del&gt;SOLR-11616&lt;/del&gt;&lt;/a&gt; is already marked as &quot;Fixed&quot; in the CHANGES of a past release, we use a new jira for tracking problems that continue/regress in solr versions after that)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13264384">SOLR-13872</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12897215" name="SOLR-11616.patch" size="12303" author="varun" created="Sat, 11 Nov 2017 20:16:10 +0000"/>
                            <attachment id="12896473" name="SOLR-11616.patch" size="1545" author="varun" created="Tue, 7 Nov 2017 18:31:38 +0000"/>
                            <attachment id="12896526" name="solr-6.3.log" size="2534042" author="varun" created="Tue, 7 Nov 2017 22:52:16 +0000"/>
                            <attachment id="12896531" name="solr-7.1.log" size="2248587" author="varun" created="Tue, 7 Nov 2017 23:16:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mi9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>