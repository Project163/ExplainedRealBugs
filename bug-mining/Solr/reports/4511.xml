<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:44:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14520] json.facets: allBucket:true can cause server errors when combined with refine:true</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14520</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Another bug that was discovered while testing &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14467&quot; title=&quot;json.facet&amp;#39;s relatedness() should not cause server errors or nonsense results when combined with allBuckets:true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14467&quot;&gt;&lt;del&gt;SOLR-14467&lt;/del&gt;&lt;/a&gt;...&lt;br/&gt;
In some situations, using &lt;tt&gt;allBuckets:true&lt;/tt&gt; in conjunction with &lt;tt&gt;refine:true&lt;/tt&gt; can cause server errors during the &quot;refinement&quot; requests to the individual shards &amp;#8211; either NullPointerExceptions from some (nested) SlotAccs when SpecialSlotAcc tries to collect them, or ArrayIndexOutOfBoundsException from CountSlotArrAcc.incrementCount because it&apos;s asked to collect to &quot;large&quot; slot# values even though it&apos;s been initialized with a size of &apos;1&apos;&lt;/p&gt;

&lt;p&gt;NOTE: these problems may be specific to FacetFieldProcessorByArrayDV - i have not yet seen similar failures from FacetFieldProcessorByArrayUIF (those are the only 2 used when doing refinement) but that may just be a fluke of testing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13307873">SOLR-14520</key>
            <summary>json.facets: allBucket:true can cause server errors when combined with refine:true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 May 2020 01:17:52 +0000</created>
                <updated>Wed, 15 Jul 2020 15:09:00 +0000</updated>
                            <resolved>Wed, 3 Jun 2020 17:34:55 +0000</resolved>
                                                    <fixVersion>8.6</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>Facet Module</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17118216" author="hossman" created="Thu, 28 May 2020 01:36:48 +0000"  >&lt;p&gt;attaching a patch file with small changes to TestJsonFacetRefinement that easily demonstrates one of these types of problems...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 8945 ERROR (qtp561920109-35) [    x:collection1 ] o.a.s.h.RequestHandlerBase org.apache.solr.client.solrj.impl.BaseHttpSolrClient$RemoteSolrException: Error from server at null: java.lang.NullPointerException
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.SlotAcc$SumSlotAcc.collect(SlotAcc.java:401)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessor$SpecialSlotAcc.collect(FacetFieldProcessor.java:778)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessorByArrayDV.collect(FacetFieldProcessorByArrayDV.java:335)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessorByArrayDV.collectDocs(FacetFieldProcessorByArrayDV.java:266)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessorByArrayDV.collectDocs(FacetFieldProcessorByArrayDV.java:161)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessorByArray.calcFacets(FacetFieldProcessorByArray.java:90)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessorByArray.process(FacetFieldProcessorByArray.java:62)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetRequest.process(FacetRequest.java:414)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetProcessor.processSubs(FacetProcessor.java:478)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetProcessor.fillBucket(FacetProcessor.java:434)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessor.refineBucket(FacetFieldProcessor.java:922)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessor.refineFacets(FacetFieldProcessor.java:887)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessorByArray.calcFacets(FacetFieldProcessorByArray.java:70)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetFieldProcessorByArray.process(FacetFieldProcessorByArray.java:62)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetRequest.process(FacetRequest.java:414)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetProcessor.processSubs(FacetProcessor.java:478)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetProcessor.fillBucket(FacetProcessor.java:434)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetQueryProcessor.process(FacetQuery.java:65)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetRequest.process(FacetRequest.java:414)
   [junit4]   2&amp;gt; 	at org.apache.solr.search.facet.FacetModule.process(FacetModule.java:150)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:329)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:209)
   [junit4]   2&amp;gt; 	at org.apache.solr.core.SolrCore.execute(SolrCore.java:2591)
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:803)
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:582)
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:415)
   [junit4]   2&amp;gt; 	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:345)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1604)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:166)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1604)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:545)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1610)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1300)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:485)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1580)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1215)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:322)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:717)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.Server.handle(Server.java:500)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:383)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:547)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:375)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.server.HttpChannel.run(HttpChannel.java:335)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:806)
   [junit4]   2&amp;gt; 	at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:938)
   [junit4]   2&amp;gt; 	at java.base/java.lang.Thread.run(Thread.java:834)
   [junit4]   2&amp;gt; 
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.Http2SolrClient.processErrorsAndResponse(Http2SolrClient.java:721)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.Http2SolrClient.request(Http2SolrClient.java:410)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.impl.Http2SolrClient.request(Http2SolrClient.java:740)
   [junit4]   2&amp;gt; 	at org.apache.solr.client.solrj.SolrClient.request(SolrClient.java:1290)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.component.HttpShardHandler.request(HttpShardHandler.java:208)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.component.HttpShardHandler.lambda$submit$0(HttpShardHandler.java:170)
   [junit4]   2&amp;gt; 	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
   [junit4]   2&amp;gt; 	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
   [junit4]   2&amp;gt; 	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
   [junit4]   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedRunnable.run(InstrumentedExecutorService.java:180)
   [junit4]   2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:210)
   [junit4]   2&amp;gt; 	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
   [junit4]   2&amp;gt; 	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
   [junit4]   2&amp;gt; 	at java.base/java.lang.Thread.run(Thread.java:834)
   [junit4]   2&amp;gt; 
   [junit4]   2&amp;gt; 8945 INFO  (qtp561920109-35) [    x:collection1 ] o.a.s.c.S.Request [collection1]  webapp=/solr path=/select params={cat_i=cat_i&amp;amp;date=cat_dt&amp;amp;indent=true&amp;amp;cat_s=cat_s&amp;amp;xy_s=xy_s&amp;amp;version=2.2&amp;amp;er_s=er_s&amp;amp;num_d=num_d&amp;amp;qw_s=qw_s&amp;amp;shards=127.0.0.1:40101/solr/collection1,127.0.0.1:33705/solr/collection1,127.0.0.1:37179/solr/collection1&amp;amp;shards=debugQuery&amp;amp;shards=false&amp;amp;q=*:*&amp;amp;json.facet={++cat0:{${terms}+type:terms,+field:${cat_s},+limit:1,+overrequest:0,+refine:false,+allBuckets:true,+facet:{++xy:{${terms}+type:terms,+field:${xy_s},+limit:1,+overrequest:0,+allBuckets:true,+refine:false}++}++},+cat1:{${terms}+type:terms,+field:${cat_s},+limit:1,+overrequest:0,+refine:true,+allBuckets:true,+sort:&apos;f+asc&apos;,+facet:{++f:&apos;min(${num_d})&apos;+}++},+cat2:{${terms}+type:terms,+field:${cat_s},+limit:1,+overrequest:0,+refine:true+,+allBuckets:true,+facet:{++xy:{${terms}+type:terms,+field:${xy_s},+limit:1,+overrequest:0,+allBuckets:true,+refine:true+}++}++},+cat3:{${terms}+type:terms,+field:${cat_s},+limit:1,+overrequest:0,+refine:true+,+allBuckets:true,+facet:{++xy:{${terms}+type:terms,+field:${xy_s},+limit:1,+overrequest:0,+allBuckets:true,+refine:true+,+facet:{f:&apos;sum(${num_d})&apos;}+++}++}++},+cat4:{${terms}+type:terms,+field:${cat_s},+limit:1,+overrequest:0,+refine:true+,+allBuckets:true,+facet:{++xy:{${terms}+type:terms,+field:${xy_s},+limit:1,+overrequest:0,+allBuckets:true,+refine:true+,+sort:&apos;f+asc&apos;,+facet:{f:&apos;sum(${num_d})&apos;}+++}++}++}}&amp;amp;wt=json} hits=8 status=500 QTime=13
...
   [junit4] ERROR   0.62s | TestJsonFacetRefinement.testBasicRefinement &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.solr.client.solrj.impl.BaseHttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:40101/solr/collection1: Server Error
   [junit4]    &amp;gt; request: http://127.0.0.1:40101/solr/collection1/select?shards=127.0.0.1:40101/solr/collection1,127.0.0.1:33705/solr/collection1,127.0.0.1:37179/solr/collection1&amp;amp;shards=debugQuery&amp;amp;shards=false&amp;amp;cat_s=cat_s&amp;amp;cat_i=cat_i&amp;amp;date=cat_dt&amp;amp;xy_s=xy_s&amp;amp;num_d=num_d&amp;amp;qw_s=qw_s&amp;amp;er_s=er_s&amp;amp;q=*:*&amp;amp;json.facet={  cat0:{${terms} type:terms, field:${cat_s}, limit:1, overrequest:0, refine:false, allBuckets:true, facet:{  xy:{${terms} type:terms, field:${xy_s}, limit:1, overrequest:0, allBuckets:true, refine:false}  }  }, cat1:{${terms} type:terms, field:${cat_s}, limit:1, overrequest:0, refine:true, allBuckets:true, sort:&apos;f asc&apos;, facet:{  f:&apos;min(${num_d})&apos; }  }, cat2:{${terms} type:terms, field:${cat_s}, limit:1, overrequest:0, refine:true , allBuckets:true, facet:{  xy:{${terms} type:terms, field:${xy_s}, limit:1, overrequest:0, allBuckets:true, refine:true }  }  }, cat3:{${terms} type:terms, field:${cat_s}, limit:1, overrequest:0, refine:true , allBuckets:true, facet:{  xy:{${terms} type:terms, field:${xy_s}, limit:1, overrequest:0, allBuckets:true, refine:true , facet:{f:&apos;sum(${num_d})&apos;}   }  }  }, cat4:{${terms} type:terms, field:${cat_s}, limit:1, overrequest:0, refine:true , allBuckets:true, facet:{  xy:{${terms} type:terms, field:${xy_s}, limit:1, overrequest:0, allBuckets:true, refine:true , sort:&apos;f asc&apos;, facet:{f:&apos;sum(${num_d})&apos;}   }  }  }}&amp;amp;wt=json&amp;amp;indent=true&amp;amp;version=2.2
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([BBFA81426E659210:A96E13741F03B528]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:663)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:265)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:248)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrClient.request(SolrClient.java:1290)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseHS.getQueryResponse(SolrTestCaseHS.java:229)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseHS.getJSON(SolrTestCaseHS.java:250)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseHS.assertJQ(SolrTestCaseHS.java:144)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseHS$Client$Tester.assertJQ(SolrTestCaseHS.java:280)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseHS$Client.testJQ(SolrTestCaseHS.java:326)
   [junit4]    &amp;gt; 	at org.apache.solr.search.facet.TestJsonFacetRefinement.doBasicRefinement(TestJsonFacetRefinement.java:1365)
   [junit4]    &amp;gt; 	at org.apache.solr.search.facet.TestJsonFacetRefinement.testBasicRefinement(TestJsonFacetRefinement.java:1025)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
   [junit4]    &amp;gt; 	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
   [junit4]    &amp;gt; 	at java.base/java.lang.Thread.run(Thread.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The other type of failure i&apos;ve seen i have not yet been able to reproduce in small scale ... you can be see an example found by looking at some of the beast log attachments in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14467&quot; title=&quot;json.facet&amp;#39;s relatedness() should not cause server errors or nonsense results when combined with allBuckets:true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14467&quot;&gt;&lt;del&gt;SOLR-14467&lt;/del&gt;&lt;/a&gt;,but those are based on the ptach in that jira, so some of hte line numbers won&apos;t be exactly accurate.&lt;/p&gt;

&lt;p&gt;one example is ...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  [beaster]   2&amp;gt; 10513 ERROR (qtp144184226-64) [n:127.0.0.1:43085_solr c:org.apache.solr.search.facet.TestCloudJSONFacetSKGEquiv_collection s:shard2 r:core_node4 x:org.apache.solr.search.facet.TestCloudJSONFacetSKGEquiv_collection_shard2_replica_n2 ] o.a.s.h.RequestHandlerBase java.lang.ArrayIndexOutOfBoundsException: Index 7 out of bounds for length 1
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.SlotAcc$CountSlotArrAcc.incrementCount(SlotAcc.java:636)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessorByArrayDV.collect(FacetFieldProcessorByArrayDV.java:330)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessorByArrayDV.collectDocs(FacetFieldProcessorByArrayDV.java:303)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessorByArrayDV.collectDocs(FacetFieldProcessorByArrayDV.java:171)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessorByArray.calcFacets(FacetFieldProcessorByArray.java:90)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessorByArray.process(FacetFieldProcessorByArray.java:62)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetRequest.process(FacetRequest.java:414)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetProcessor.processSubs(FacetProcessor.java:478)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetProcessor.fillBucket(FacetProcessor.java:434)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessor.refineBucket(FacetFieldProcessor.java:938)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessor.refineFacets(FacetFieldProcessor.java:903)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessorByArray.calcFacets(FacetFieldProcessorByArray.java:70)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetFieldProcessorByArray.process(FacetFieldProcessorByArray.java:62)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetRequest.process(FacetRequest.java:414)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetProcessor.processSubs(FacetProcessor.java:478)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetProcessor.fillBucket(FacetProcessor.java:434)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetQueryProcessor.process(FacetQuery.java:65)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetRequest.process(FacetRequest.java:414)
  [beaster]   2&amp;gt;        at org.apache.solr.search.facet.FacetModule.process(FacetModule.java:150)
  [beaster]   2&amp;gt;        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:329)
...
  [beaster]   2&amp;gt; 10513 INFO  (qtp144184226-64) [n:127.0.0.1:43085_solr c:org.apache.solr.search.facet.TestCloudJSONFacetSKGEquiv_collection s:shard2 r:core_node4 x:org.apache.solr.search.facet.TestCloudJSONFacetSKGEquiv_collection_shard2_replica_n2 ] o.a.s.c.S.Request [org.apache.solr.search.facet.TestCloudJSONFacetSKGEquiv_collection_shard2_replica_n2]  webapp=/solr path=/select params={df=text&amp;amp;distrib=false&amp;amp;_facet_={&quot;refine&quot;:{&quot;facet_1&quot;:{&quot;_p&quot;:[[29,{&quot;facet_2&quot;:{&quot;_l&quot;:[&quot;23&quot;,&quot;31&quot;,&quot;42&quot;,&quot;43&quot;,&quot;50&quot;,&quot;54&quot;]}}],[10,{&quot;facet_2&quot;:{&quot;_l&quot;:[&quot;23&quot;,&quot;31&quot;,&quot;34&quot;,&quot;42&quot;,&quot;43&quot;,&quot;50&quot;]}}],[14,{&quot;facet_2&quot;:{&quot;_l&quot;:[&quot;13&quot;,&quot;14&quot;,&quot;18&quot;,&quot;53&quot;,&quot;8&quot;]}}],[24,{&quot;facet_2&quot;:{&quot;_l&quot;:[&quot;15&quot;,&quot;23&quot;,&quot;34&quot;,&quot;42&quot;,&quot;47&quot;,&quot;48&quot;,&quot;7&quot;]}}],[48,{&quot;facet_2&quot;:{&quot;_l&quot;:[&quot;44&quot;,&quot;47&quot;,&quot;48&quot;]}}],[13,{&quot;facet_2&quot;:{&quot;_l&quot;:[&quot;54&quot;]}}],[23,{&quot;facet_2&quot;:{&quot;_l&quot;:[&quot;54&quot;]}}],[35,{&quot;facet_2&quot;:{&quot;_l&quot;:[&quot;15&quot;,&quot;23&quot;,&quot;29&quot;,&quot;30&quot;,&quot;31&quot;,&quot;36&quot;,&quot;42&quot;,&quot;43&quot;,&quot;48&quot;,&quot;50&quot;]}}]]}}}&amp;amp;shards.purpose=2097152&amp;amp;back=(field_9_multi_ss:58+OR+field_6_multi_ss:32+OR+field_11_multi_sdsS:15)&amp;amp;shard.url=http://127.0.0.1:43085/solr/org.apache.solr.search.facet.TestCloudJSONFacetSKGEquiv_collection_shard2_replica_n2/&amp;amp;rows=0&amp;amp;fore=(field_8_multi_sdsS:29+OR+field_14_multi_sdsS:30+OR+field_7_multi_sds:26+OR+field_2_multi_sdsS:9+OR+field_1_multi_sds:11+OR+field_3_multi_ss:15+OR+field_10_multi_sds:45)&amp;amp;version=2&amp;amp;q=(field_2_multi_sdsS:6+OR+field_2_multi_sdsS:33+OR+field_2_multi_sdsS:26+OR+field_8_multi_sdsS:10+OR+field_6_multi_ss:50+OR+field_6_multi_ss:19+OR+field_12_multi_ss:50+OR+field_12_multi_ss:56+OR+field_3_multi_ss:23+OR+field_4_multi_sds:5)&amp;amp;json.facet={&quot;facet_1&quot;:{&quot;method&quot;:&quot;smart&quot;,&quot;sort&quot;:&quot;skg+asc&quot;,&quot;allBuckets&quot;:true,&quot;refine&quot;:true,&quot;type&quot;:&quot;terms&quot;,&quot;field&quot;:&quot;field_0_multi_is&quot;,&quot;facet&quot;:{&quot;skg&quot;:{&quot;type&quot;:&quot;func&quot;,&quot;func&quot;:&quot;relatedness($fore,$back)&quot;},&quot;facet_2&quot;:{&quot;method&quot;:&quot;smart&quot;,&quot;limit&quot;:63,&quot;overrequest&quot;:5,&quot;allBuckets&quot;:true,&quot;refine&quot;:true,&quot;type&quot;:&quot;terms&quot;,&quot;field&quot;:&quot;field_4_multi_sds&quot;,&quot;facet&quot;:{&quot;skg&quot;:{&quot;type&quot;:&quot;func&quot;,&quot;func&quot;:&quot;relatedness($fore,$back)&quot;},&quot;skg0&quot;:{&quot;min_popularity&quot;:&quot;0.001&quot;,&quot;type&quot;:&quot;func&quot;,&quot;func&quot;:&quot;relatedness($fore,$back)&quot;},&quot;sum&quot;:&quot;sum(field_9_multi_is)&quot;}}}},&quot;facet_3&quot;:{&quot;method&quot;:&quot;smart&quot;,&quot;limit&quot;:25,&quot;overrequest&quot;:0,&quot;sort&quot;:&quot;count+asc&quot;,&quot;allBuckets&quot;:false,&quot;refine&quot;:true,&quot;type&quot;:&quot;terms&quot;,&quot;field&quot;:&quot;field_1_solo_id&quot;,&quot;facet&quot;:{&quot;skg&quot;:{&quot;type&quot;:&quot;func&quot;,&quot;func&quot;:&quot;relatedness($fore,$back)&quot;}}}}&amp;amp;omitHeader=false&amp;amp;NOW=1590620938809&amp;amp;isShard=true&amp;amp;facet=false&amp;amp;wt=javabin} hits=22 status=500 QTime=1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The meat of that problem seems aparent when looking at the imple of &lt;tt&gt;FacetFieldProcessorByArray.calcFacets()&lt;/tt&gt; ...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (refineResult != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (freq.allBuckets) {
        createAccs(nDocs, 1); &lt;span class=&quot;code-comment&quot;&gt;// ##### NOTE X ###########################
&lt;/span&gt;        allBucketsAcc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpecialSlotAcc(fcontext, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, -1, accs, 0);
        collectDocs(); &lt;span class=&quot;code-comment&quot;&gt;// ##### NOTE Y ###########################
&lt;/span&gt;
        SimpleOrderedMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; allBuckets = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleOrderedMap&amp;lt;&amp;gt;();
        allBuckets.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;, allBucketsAcc.getSpecialCount());
        allBucketsAcc.setValues(allBuckets, -1); &lt;span class=&quot;code-comment&quot;&gt;// -1 slotNum is unused &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SpecialSlotAcc
&lt;/span&gt;        refineResult.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;allBuckets&quot;&lt;/span&gt;, allBuckets);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; refineResult;
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&quot;NOTE Y&quot; is &quot;&lt;tt&gt;calcFacets(FacetFieldProcessorByArray.java:90)&lt;/tt&gt;&quot; from the stack trace above, and results in FacetFieldProcessorByArrayDV trying call &lt;tt&gt;collect(int,int,LongValues)&lt;/tt&gt; over &lt;b&gt;all&lt;/b&gt; of the DV terms (using the ord as the slotNum) not just for &lt;tt&gt;allBucketsAcc&lt;/tt&gt; but also &lt;tt&gt;countAcc&lt;/tt&gt; ... even though the call to &lt;tt&gt;createAccs(nDocs, 1)&lt;/tt&gt; at &quot;NOTE X&quot; results in &lt;tt&gt;countAcc&lt;/tt&gt; only having a single slot&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m not really sure how this is &lt;em&gt;suppose&lt;/em&gt; to work, or why it doesn&apos;t fail more often, let alone what the best &quot;fix&quot; is.&lt;/p&gt;</comment>
                            <comment id="17121463" author="hossman" created="Tue, 2 Jun 2020 01:23:55 +0000"  >&lt;p&gt;Attaching an updated patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;small correction to the &quot;expected&quot; results in TestJsonFacetRefinement&lt;/li&gt;
	&lt;li&gt;fix proposed by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgibney&quot; class=&quot;user-hover&quot; rel=&quot;mgibney&quot;&gt;mgibney&lt;/a&gt; in his &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;^SOLR-14467_allBuckets_refine.patch&amp;#93;&lt;/span&gt;&quot; attachment to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14467&quot; title=&quot;json.facet&amp;#39;s relatedness() should not cause server errors or nonsense results when combined with allBuckets:true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14467&quot;&gt;&lt;del&gt;SOLR-14467&lt;/del&gt;&lt;/a&gt; (where this bug was first found).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I still need to review &amp;amp; think about michael&apos;s solution a bit more before commiting &#8211; my initial impression is that it&apos;s better then what we have now, but i want to think through if it introduces any diff/new bugs.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Michael: one concern i have that&apos;s still nagging me is how to reproduce the 2nd type of failure i mentioned above &#8211; i believe it&apos;s also intrinsicly &quot;fixed&quot; in your patch by the nature of changing out hte &lt;tt&gt;countAcc&lt;/tt&gt; to something that will just flat out ignore the slot, but i&apos;m still perplexed why my attempts at updating the tests to isolate it couldn&apos;t seem to trigger it &#8211; do you have any idea what a simple reproducible test case for that failure might look like?&lt;/p&gt;</comment>
                            <comment id="17121522" author="mgibney" created="Tue, 2 Jun 2020 03:13:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;one concern i have that&apos;s still nagging me is how to reproduce the 2nd type of failure i mentioned above&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, I&apos;m not exactly sure. Looking just now, we only reach the problematic part of the code if &lt;tt&gt;facetInfo!=null&lt;/tt&gt; &lt;em&gt;and&lt;/em&gt; &lt;tt&gt;skipFacet==false&lt;/tt&gt;, which only happens for &quot;partial&quot; refinement buckets, which I don&apos;t understand well at the moment. Perhaps the key to reproducing might be to figure out how/when &lt;tt&gt;partialBuckets&lt;/tt&gt; for subs are initially populated (&lt;tt&gt;&quot;_p&quot;&lt;/tt&gt;), which it looks like happens in &lt;tt&gt;FacetRequestSortedMerger.getRefinement(...)&lt;/tt&gt;? Although I don&apos;t understand it at the moment, it does look like it&apos;s indirectly determined by a bunch of conditional logic ... i.e., conditions that have to be satisfied in order for that part of the code to be exercised ... which at least could explain why it&apos;s hard to reproduce the problem?&#160;&lt;/p&gt;</comment>
                            <comment id="17124343" author="hossman" created="Tue, 2 Jun 2020 21:54:35 +0000"  >
&lt;blockquote&gt;&lt;p&gt;Perhaps the key to reproducing might be to figure out how/when partialBuckets for subs are initially populated...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The tests i added in the last patch were already triggering the partialBuckets refinement &amp;#8211; the important bits i was overlooking was that in order to trigger the ArrayIndexOutOfBoundsException we needed &lt;b&gt;BOTH&lt;/b&gt; of the following to be true when refining a facet of a partial bucket...&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;the facet uses default sort by count (so that we collect against the countAcc, collecting against the acc from some other stat leads to the other NPE alreayd accounted for in the test)&lt;/li&gt;
	&lt;li&gt;we trigger refinement of a bucket that has a slot number &amp;gt; 0&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I had considered #1, but didn&apos;t really grasp that the existing test data was so small all noe of the requests were tickling #2.&lt;/p&gt;

&lt;p&gt;The attached patch just adds a &apos;cat5&apos; example facet that would trigger the AIOOBE &amp;#8211; but doesn&apos;t because the fix works.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I still need to review &amp;amp; think about michael&apos;s solution a bit more before commiting ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m feeling more confident, but still beasting for a bit in conjunction with the other test improvements in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14467&quot; title=&quot;json.facet&amp;#39;s relatedness() should not cause server errors or nonsense results when combined with allBuckets:true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14467&quot;&gt;&lt;del&gt;SOLR-14467&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Unless i run into any problems, or there are any objections, I&apos;ll probably move forward &amp;amp; commit tomorow.&lt;/p&gt;
</comment>
                            <comment id="17124573" author="lucenesolrqa" created="Wed, 3 Jun 2020 03:36:03 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 1 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  3s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  4s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  4s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  4s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  4s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  4s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 46m 49s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; 50m 48s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14520&quot; title=&quot;json.facets: allBucket:true can cause server errors when combined with refine:true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14520&quot;&gt;&lt;del&gt;SOLR-14520&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13004656/SOLR-14520.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/13004656/SOLR-14520.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene1-us-west 4.15.0-54-generic #58-Ubuntu SMP Mon Jun 24 10:55:24 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / a06f57c7e16 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.10.5 compiled on March 28 2019 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; LTS &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/759/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/759/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: solr/core U: solr/core &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/759/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/759/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="17125082" author="jira-bot" created="Wed, 3 Jun 2020 16:10:06 +0000"  >&lt;p&gt;Commit fb58f433fbed8f961bce88961084202428ef287a in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fb58f43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fb58f43&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14520&quot; title=&quot;json.facets: allBucket:true can cause server errors when combined with refine:true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14520&quot;&gt;&lt;del&gt;SOLR-14520&lt;/del&gt;&lt;/a&gt;: Fixed server errors from the json.facet allBuckets:true option when combined with refine:true&lt;/p&gt;</comment>
                            <comment id="17125149" author="jira-bot" created="Wed, 3 Jun 2020 17:22:21 +0000"  >&lt;p&gt;Commit bbcd43366e873918b065297654dccfbfc899dc9f in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=bbcd433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=bbcd433&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14520&quot; title=&quot;json.facets: allBucket:true can cause server errors when combined with refine:true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14520&quot;&gt;&lt;del&gt;SOLR-14520&lt;/del&gt;&lt;/a&gt;: Fixed server errors from the json.facet allBuckets:true option when combined with refine:true&lt;/p&gt;

&lt;p&gt;(cherry picked from commit fb58f433fbed8f961bce88961084202428ef287a)&lt;/p&gt;</comment>
                            <comment id="17125160" author="hossman" created="Wed, 3 Jun 2020 17:34:56 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgibney&quot; class=&quot;user-hover&quot; rel=&quot;mgibney&quot;&gt;mgibney&lt;/a&gt; !&lt;/p&gt;</comment>
                            <comment id="17158256" author="broustant" created="Wed, 15 Jul 2020 15:09:00 +0000"  >&lt;p&gt;Closing after the 8.6.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13303512">SOLR-14467</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13004656" name="SOLR-14520.patch" size="6513" author="hossman" created="Tue, 2 Jun 2020 21:52:42 +0000"/>
                            <attachment id="13004530" name="SOLR-14520.patch" size="6513" author="hossman" created="Tue, 2 Jun 2020 01:16:14 +0000"/>
                            <attachment id="13004185" name="SOLR-14520.patch" size="3331" author="hossman" created="Thu, 28 May 2020 01:20:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0f8pk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>