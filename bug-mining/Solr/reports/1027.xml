<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:30:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3628] SolrDocument uses user-provided collections unsafely</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3628</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Adding a RO Collection as the value of a field (ie. SolrDocument or SolrInputField) will result in an UnsupportedOperationException later on when adding more values to that field.&lt;/p&gt;

&lt;p&gt;This happens because no defensive copy of collections are made. Instead, if a collection is given first, then it becomes the backing collection for the field. This can cause problems if the collection is modified after the fact or if a read-only collection is given (eg. Collection.unmodifiableList(...)).&lt;/p&gt;

&lt;p&gt;It can be reproduced with:&lt;/p&gt;

&lt;p&gt;SolrDocument doc = new SolrDocument()&lt;br/&gt;
doc.addField(&quot;v&quot;, Collections.unmodifiableList(new ArrayList&amp;lt;Object&amp;gt;()))&lt;br/&gt;
doc.addField(&quot;v&quot;, &quot;a&quot;)&lt;/p&gt;

&lt;p&gt;I&apos;ve created a patch that includes a fix and a test with, essentially, the above. The patch just ensures that SolrDocument and SolrInputField always use a Collection they created as the value, rather than relying on what was given to them.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS X 10.7.4, Java 6&lt;/p&gt;</environment>
        <key id="12599025">SOLR-3628</key>
            <summary>SolrDocument uses user-provided collections unsafely</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="tixxit">Tom Switzer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Jul 2012 19:17:44 +0000</created>
                <updated>Mon, 9 May 2016 18:57:29 +0000</updated>
                            <resolved>Tue, 11 Sep 2012 18:50:16 +0000</resolved>
                                    <version>3.6</version>
                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>clients - java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13415553" author="tixxit" created="Mon, 16 Jul 2012 19:18:27 +0000"  >&lt;p&gt;A patch to the current trunk. Includes test case.&lt;/p&gt;</comment>
                            <comment id="13417642" author="hossman" created="Wed, 18 Jul 2012 20:18:00 +0000"  >&lt;p&gt;I seem to recall more then a few discussions in the past about how &quot;defensive&quot; APIs like this should be with respect to user provided collections and arrays &amp;#8211; the trade off being GC overhead (if the client code and the solrj code both make defensive copies, we&apos;ve doubled the number of shot lived objects)&lt;/p&gt;

&lt;p&gt;Either way: before 4.0 we should either commit this patch, or significantly improve the docs for SolrInputDocument and SolrInputField to make it clear that no copying is done and the code may modify the underlying Objects addded as fields&lt;/p&gt;</comment>
                            <comment id="13418295" author="tixxit" created="Thu, 19 Jul 2012 13:58:09 +0000"  >&lt;p&gt;One problem, I think, is that addValue (field) and addField (doc) are overloaded. It behaves different depending on if the call is the first time a value is being added, if it&apos;s an array, if it&apos;s a collection, or some other value. Perhaps a less contentious solution would be to make addValue/addField ALWAYS defensively copy collections, but keep the current setValue/setField behaviour. If I am setting a value to a collection, then I can see how a defensive copy may not be done. However, if I am &quot;adding&quot; a collection, it would seem I am appending the value to an already existing set.&lt;/p&gt;

&lt;p&gt;This solution (and more documentation would be good too) would let people who are worried about excessive GC use setValue/setField to get what they want and those who just don&apos;t want to think about it use add/addField.&lt;/p&gt;</comment>
                            <comment id="13418321" author="tixxit" created="Thu, 19 Jul 2012 14:22:11 +0000"  >&lt;p&gt;Here is a patch which changes SolrInputField#addValue&apos;s &amp;amp; SolrDocument#addField&apos;s behaviour to always copy collection, but keeps SolrInputField#setValue&apos;s &amp;amp; SolrDocument#setField&apos;s behaviour to use whatever it is given. Also added a bit more to the docs.&lt;/p&gt;</comment>
                            <comment id="13429742" author="rcmuir" created="Tue, 7 Aug 2012 03:42:37 +0000"  >&lt;p&gt;rmuir20120906-bulk-40-change&lt;/p&gt;</comment>
                            <comment id="13451168" author="hossman" created="Sat, 8 Sep 2012 00:18:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;Perhaps a less contentious solution would be to make addValue/addField ALWAYS defensively copy collections, but keep the current setValue/setField behaviour. If I am setting a value to a collection, then I can see how a defensive copy may not be done. However, if I am &quot;adding&quot; a collection, it would seem I am appending the value to an already existing set&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That sounds like a good approach ... assigning to myself to remind me to do a more thorough review of your patch and try to get this into 4.0&lt;/p&gt;</comment>
                            <comment id="13453254" author="hossman" created="Tue, 11 Sep 2012 18:20:59 +0000"  >&lt;p&gt;updated patch to include a test that the field really is backed by the collection (since we now explicitly document it)&lt;/p&gt;

&lt;p&gt;will commit a soon as full test run finishes&lt;/p&gt;</comment>
                            <comment id="13453291" author="hossman" created="Tue, 11 Sep 2012 18:50:16 +0000"  >&lt;p&gt;Committed revision 1383520. - trunk&lt;br/&gt;
Committed revision 1383533. - 4x&lt;/p&gt;

&lt;p&gt;Thanks Tom!&lt;/p&gt;</comment>
                            <comment id="13610879" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:41:58 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1383533&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1383533&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3628&quot; title=&quot;SolrDocument uses user-provided collections unsafely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3628&quot;&gt;&lt;del&gt;SOLR-3628&lt;/del&gt;&lt;/a&gt;: SolrInputField and SolrInputDocument are now consistently backed by Collections passed in to setValue/setField, and defensively copy values from Collections passed to addValue/addField (merge r1383520)&lt;/p&gt;</comment>
                            <comment id="13654173" author="thetaphi" created="Fri, 10 May 2013 10:34:17 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544682" name="SOLR-3628.patch" size="4941" author="hossman" created="Tue, 11 Sep 2012 18:20:59 +0000"/>
                            <attachment id="12537179" name="solrdoc-ro-list-bug-comp.patch" size="4335" author="tixxit" created="Thu, 19 Jul 2012 14:22:11 +0000"/>
                            <attachment id="12536697" name="solrdoc-ro-list-bug.patch" size="2026" author="tixxit" created="Mon, 16 Jul 2012 19:18:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03dk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17630</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>