<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:52:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16412] Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16412</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;h2&gt;&lt;a name=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h2&gt;

&lt;p&gt;Exception below is observed while updating the `completedMap` field in `OverseerTaskProcessor` :&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;o.a.s.c.OverseerTaskProcessor :org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /overseer/collection-map-completed/mn-736f6c726d616e2d312d31383930383730393837313333303932353331&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.zookeeper.KeeperException.create(KeeperException.java:118)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.zookeeper.ZooKeeper.delete(ZooKeeper.java:2001)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.solr.common.cloud.SolrZkClient.lambda$delete$1(SolrZkClient.java:264)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:71)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.solr.common.cloud.SolrZkClient.delete(SolrZkClient.java:263)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.solr.cloud.SizeLimitedDistributedMap.put(SizeLimitedDistributedMap.java:76)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.solr.cloud.OverseerTaskProcessor$Runner.run(OverseerTaskProcessor.java:538)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:218)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)&lt;/tt&gt;&lt;/p&gt;


&lt;h2&gt;&lt;a name=&quot;Cause&quot;&gt;&lt;/a&gt;Cause&lt;/h2&gt;

&lt;p&gt;Based on the stack trace, `SizeLimitedDistributedMap` had reached the limit and attempted to cleanup entries:&lt;br/&gt;
&lt;a href=&quot;https://github.com/fullstorydev/lucene-solr/blob/75e89929eb360b513ee864aeb23a80c049747246/solr/core/src/java/org/apache/solr/cloud/SizeLimitedDistributedMap.java#L73-L80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fullstorydev/lucene-solr/blob/75e89929eb360b513ee864aeb23a80c049747246/solr/core/src/java/org/apache/solr/cloud/SizeLimitedDistributedMap.java#L73-L80&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However, when it performs the actual deletion, it failed with `NoNodeException`&lt;/p&gt;

&lt;p&gt;This is likely caused by race condition as multiple threads can enter the same code block and try to delete same list of children which the slower threads can delete on child node that no longer exists.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Such condition can be reproduced by unit test case, which will be included in the PR&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;Solution&quot;&gt;&lt;/a&gt;Solution&lt;/h2&gt;

&lt;p&gt;Although we could enforce synchronization to prevent threads from purging the same set of child nodes, it might not be desirable to add extra blocking.&lt;/p&gt;

&lt;p&gt;Instead, it&apos;s probably safe to ignore the `KeeperException.NoNodeException` if such node is no longer there for the purge operation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13481810">SOLR-16412</key>
            <summary>Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ichattopadhyaya">Ishan Chattopadhyaya</assignee>
                                    <reporter username="patson">Patson Luk</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Sep 2022 04:17:57 +0000</created>
                <updated>Fri, 17 Oct 2025 20:05:47 +0000</updated>
                            <resolved>Wed, 26 Oct 2022 01:59:30 +0000</resolved>
                                    <version>8.8</version>
                    <version>9.1</version>
                    <version>10.0</version>
                                    <fixVersion>9.1</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6600">1h 50m</timespent>
                                <comments>
                            <comment id="17621337" author="risdenk" created="Thu, 20 Oct 2022 19:37:45 +0000"  >&lt;p&gt;duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16175&quot; title=&quot;race condition SizeLimitedDistributedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16175&quot;&gt;&lt;del&gt;SOLR-16175&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17621338" author="risdenk" created="Thu, 20 Oct 2022 19:38:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16175&quot; title=&quot;race condition SizeLimitedDistributedMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16175&quot;&gt;&lt;del&gt;SOLR-16175&lt;/del&gt;&lt;/a&gt; has a branch but not PR with this commit. &lt;a href=&quot;https://github.com/apache/solr/commit/c1ae998e7ad3650229449ff7b2a55ef222ec8b8c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/commit/c1ae998e7ad3650229449ff7b2a55ef222ec8b8c&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="17622374" author="JIRAUSER291114" created="Fri, 21 Oct 2022 17:25:54 +0000"  >&lt;p&gt;Thank you so much for checking! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt; I totally missed the other jira issue &lt;/p&gt;</comment>
                            <comment id="17624074" author="JIRAUSER291114" created="Tue, 25 Oct 2022 22:40:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noblepaul&quot; class=&quot;user-hover&quot; rel=&quot;noblepaul&quot;&gt;noblepaul&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; It&apos;s probably a good idea to push this to 9_x and 9_1 too?&lt;/p&gt;</comment>
                            <comment id="17624083" author="jira-bot" created="Wed, 26 Oct 2022 00:07:59 +0000"  >&lt;p&gt;Commit babcb9e633d1e36e0c866fef27d5a97bc10cea91 in solr&apos;s branch refs/heads/main from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=babcb9e633d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=babcb9e633d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16412&quot; title=&quot;Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16412&quot;&gt;&lt;del&gt;SOLR-16412&lt;/del&gt;&lt;/a&gt; : Race condition in SizeLimitedDistributedMap for cleanup (#1032)&lt;/p&gt;
</comment>
                            <comment id="17624084" author="jira-bot" created="Wed, 26 Oct 2022 00:09:54 +0000"  >&lt;p&gt;Commit a98faa932b92a07f71a7331dabca7ac24fc0808d in solr&apos;s branch refs/heads/branch_9x from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=a98faa932b9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=a98faa932b9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16412&quot; title=&quot;Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16412&quot;&gt;&lt;del&gt;SOLR-16412&lt;/del&gt;&lt;/a&gt; : Race condition in SizeLimitedDistributedMap for cleanup (#1032)&lt;/p&gt;
</comment>
                            <comment id="17624085" author="jira-bot" created="Wed, 26 Oct 2022 00:10:19 +0000"  >&lt;p&gt;Commit 5294c82c3cd535604be5fce48f86f6ecedc187bc in solr&apos;s branch refs/heads/branch_9_1 from patsonluk&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=5294c82c3cd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=5294c82c3cd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16412&quot; title=&quot;Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16412&quot;&gt;&lt;del&gt;SOLR-16412&lt;/del&gt;&lt;/a&gt; : Race condition in SizeLimitedDistributedMap for cleanup (#1032)&lt;/p&gt;
</comment>
                            <comment id="17624124" author="jira-bot" created="Wed, 26 Oct 2022 01:51:11 +0000"  >&lt;p&gt;Commit 2f6818886e90f8edebf3b71e0a96ccc0c9b6947e in solr&apos;s branch refs/heads/main from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=2f6818886e9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=2f6818886e9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16412&quot; title=&quot;Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16412&quot;&gt;&lt;del&gt;SOLR-16412&lt;/del&gt;&lt;/a&gt;: Fix TestSizeLimitedDistributedMap LinkedList compilation error&lt;/p&gt;</comment>
                            <comment id="17624128" author="jira-bot" created="Wed, 26 Oct 2022 01:58:37 +0000"  >&lt;p&gt;Commit 85772c206f75ea44e267b7679b724f4f65ab40be in solr&apos;s branch refs/heads/branch_9x from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=85772c206f7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=85772c206f7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16412&quot; title=&quot;Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16412&quot;&gt;&lt;del&gt;SOLR-16412&lt;/del&gt;&lt;/a&gt;: Fix TestSizeLimitedDistributedMap LinkedList compilation error&lt;/p&gt;</comment>
                            <comment id="17624132" author="jira-bot" created="Wed, 26 Oct 2022 02:07:24 +0000"  >&lt;p&gt;Commit 6340a4abba37d535831b74703a7ca390eff167b7 in solr&apos;s branch refs/heads/branch_9_1 from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=6340a4abba3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=6340a4abba3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16412&quot; title=&quot;Race condition could trigger error on concurrent SizeLimitedDistributedMap cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16412&quot;&gt;&lt;del&gt;SOLR-16412&lt;/del&gt;&lt;/a&gt;: Fix TestSizeLimitedDistributedMap LinkedList compilation error&lt;/p&gt;</comment>
                            <comment id="17656927" author="ishan" created="Tue, 10 Jan 2023 20:45:36 +0000"  >&lt;p&gt;Bulk closing 9.1 issues.&lt;/p&gt;</comment>
                            <comment id="17722938" author="dsmiley" created="Mon, 15 May 2023 22:00:41 +0000"  >&lt;p&gt;It&apos;s not mutually exclusive, but I&apos;d prefer to see a prevention of multiple cleanups happening concurrently.  In the description you imply this would be blocking but it need not be.  For example, if the data structure is currently being cleaned up, then the other thread can just proceed to add data.  &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13442787">SOLR-16175</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13484937">SOLR-16454</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18ltk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>