<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:14:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8812] ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8812</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The edismax parser ignores Boolean OR in queries when q.op=AND. This behavior is new to Solr 5.5.0 and an unexpected major change.&lt;/p&gt;

&lt;p&gt;Example:&lt;br/&gt;
      &quot;q&quot;: &quot;id:12345 OR zzzzzzzzzz&quot;,&lt;br/&gt;
      &quot;defType&quot;: &quot;edismax&quot;,&lt;br/&gt;
      &quot;q.op&quot;: &quot;AND&quot;,&lt;br/&gt;
where &quot;12345&quot; is a known document ID and &quot;zzzzzzzzzz&quot; is a string NOT present in my data&lt;/p&gt;

&lt;p&gt;Version 5.5.0 produces zero results:&lt;br/&gt;
    &quot;rawquerystring&quot;: &quot;id:12345 OR zzzzzzzzzz&quot;,&lt;br/&gt;
    &quot;querystring&quot;: &quot;id:12345 OR zzzzzzzzzz&quot;,&lt;br/&gt;
    &quot;parsedquery&quot;: &quot;(+((id:12345 DisjunctionMaxQuery((text:zzzzzzzzzz)))~2))/no_coord&quot;,&lt;br/&gt;
    &quot;parsedquery_toString&quot;: &quot;+((id:12345 (text:zzzzzzzzzz))~2)&quot;,&lt;br/&gt;
    &quot;explain&quot;: {},&lt;br/&gt;
    &quot;QParser&quot;: &quot;ExtendedDismaxQParser&quot;&lt;/p&gt;

&lt;p&gt;Version 5.4.0 produces one result as expected&lt;br/&gt;
  &quot;rawquerystring&quot;: &quot;id:12345 OR zzzzzzzzzz&quot;,&lt;br/&gt;
    &quot;querystring&quot;: &quot;id:12345 OR zzzzzzzzzz&quot;,&lt;br/&gt;
    &quot;parsedquery&quot;: &quot;(+(id:12345 DisjunctionMaxQuery((text:zzzzzzzzzz))))/no_coord&quot;,&lt;br/&gt;
    &quot;parsedquery_toString&quot;: &quot;+(id:12345 (text:zzzzzzzzzz))&quot;&lt;br/&gt;
    &quot;explain&quot;: {},&lt;br/&gt;
    &quot;QParser&quot;: &quot;ExtendedDismaxQParser&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12948480">SOLR-8812</key>
            <summary>ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="ryanmax">Ryan Steinberg</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 18:30:47 +0000</created>
                <updated>Fri, 30 Mar 2018 00:47:30 +0000</updated>
                            <resolved>Fri, 10 Jun 2016 07:17:48 +0000</resolved>
                                    <version>5.5</version>
                                    <fixVersion>5.5.2</fixVersion>
                    <fixVersion>5.6</fixVersion>
                    <fixVersion>6.0.2</fixVersion>
                    <fixVersion>6.1</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>8</votes>
                                    <watches>20</watches>
                                                                                                                <comments>
                            <comment id="15188158" author="jkrupan" created="Wed, 9 Mar 2016 22:12:33 +0000"  >&lt;p&gt;The difference in the generated query appears to be the &quot;))~2&quot; which indicates a BooleanQuery with a minShouldMatch of 2 which means that both OR/SHOULD terms MUST match, effectively turning SHOULD/OR into MUST/AND.&lt;/p&gt;

&lt;p&gt;I&apos;m guessing it was this 5.5 change: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;* SOLR-2649: MM ignored in edismax queries with operators.
  (Greg Pendlebury, Jan H&#248;ydahl et. al. via Erick Erickson)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think q.op=AND simply sets MM=100%, effectively overriding the explicit OR.&lt;/p&gt;
</comment>
                            <comment id="15188444" author="ryanmax" created="Thu, 10 Mar 2016 01:25:37 +0000"  >&lt;p&gt;I agree: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; likely introduced this new behavior. I just read through the comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; and I&apos;m still not sure this was intended: effectively, explicit OR is no longer possible when q.op=AND, even in the absence of an explicit mm param. After reading this &lt;a href=&quot;https://lucidworks.com/blog/2011/12/28/why-not-and-or-and-not/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;helpful blog post&lt;/a&gt; referenced in the ExtendedDismaxQParser unit test, I now understand that AND takes precedence over OR but I&apos;m not sure this is a clearly documented or anticipated consequence of this recent change.&lt;/p&gt;</comment>
                            <comment id="15201362" author="janhoy" created="Fri, 18 Mar 2016 11:53:43 +0000"  >&lt;p&gt;Attaching patch with a failing test case. It is quite shocking that we apparently did not have test coverage of basic OR with q.op=AND already??&lt;/p&gt;</comment>
                            <comment id="15201372" author="janhoy" created="Fri, 18 Mar 2016 12:03:34 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Promoting this bug as Blocker for now, as it directly affects correctness of many edismax queries, and likely to hit a large part of users upgrading to 5.5.0.&lt;/p&gt;</comment>
                            <comment id="15201388" author="janhoy" created="Fri, 18 Mar 2016 12:20:37 +0000"  >&lt;p&gt;Problem lies in &lt;tt&gt;SolrPluginUtils.setMinShouldMatch(BooleanQuery.Builder q, String spec, boolean mmAutoRelax)&lt;/tt&gt;, which before &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; was only ever called if the query did not contain explicit &lt;tt&gt;OR&lt;/tt&gt; or &lt;tt&gt;NOT&lt;/tt&gt;, while now it is called always, but is not designed to handle those cases. The failing test has two clauses &lt;tt&gt;(text_sw:oil) (text_sw:stock)&lt;/tt&gt; both of which are &lt;tt&gt;SHOULD&lt;/tt&gt;. But still we return mm=2.&lt;/p&gt;</comment>
                            <comment id="15201408" author="janhoy" created="Fri, 18 Mar 2016 12:36:50 +0000"  >&lt;p&gt;Also, in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; we have&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ExtendedSolrQueryParser(QParser parser, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; defaultField) {
       &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(parser, defaultField);
-      &lt;span class=&quot;code-comment&quot;&gt;// don&lt;span class=&quot;code-quote&quot;&gt;&apos;t trust that our parent &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;won&apos;&lt;/span&gt;t ever change its &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;-      setDefaultOperator(QueryParser.Operator.OR);
+      &lt;span class=&quot;code-comment&quot;&gt;// Respect the q.op parameter before mm will be applied later
&lt;/span&gt;+      SolrParams defaultParams = SolrParams.wrapDefaults(parser.getLocalParams(), parser.getParams());
+      QueryParser.Operator defaultOp = QueryParsing.getQueryParserDefaultOperator(
+          parser.getReq().getSchema(), defaultParams.get(QueryParsing.OP));
+      setDefaultOperator(defaultOp);
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This means the mm calculations may now get REQUIRED clauses as input, while before &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; when defaultOperator was forced to OR, all clauses would enter as OPTIONAL. Since &lt;tt&gt;minShouldMatch&lt;/tt&gt; is supposed to be calculated only between optional clauses, this will fail.&lt;/p&gt;</comment>
                            <comment id="15201525" author="rjosal" created="Fri, 18 Mar 2016 14:17:10 +0000"  >&lt;p&gt;On the topic of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;, I just upgraded to 5.5 yesterday and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; broke one of our test cases which was &quot;hair ties -barbie&quot; should return hair ties but not barbie hair ties, and now it matches nothing.  I assume this is intended, but if not, maybe this ticket also addresses it?&lt;/p&gt;</comment>
                            <comment id="15217914" author="janhoy" created="Wed, 30 Mar 2016 12:45:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; Should we attempt a fix for 5.5.1 or do you prefer to revert &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; until there is a better patch available?&lt;/p&gt;</comment>
                            <comment id="15218104" author="erickerickson" created="Wed, 30 Mar 2016 15:06:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt; I could go either way on this. As I stated in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;, though, I&apos;m out of my depth when dealing with the parsing here, plus I&apos;m kind of slammed for the next while.&lt;/p&gt;

&lt;p&gt;So unless someone volunteers to create a patch, I&apos;ll revert &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; before any 5.5.1 release.&lt;/p&gt;</comment>
                            <comment id="15218894" author="janhoy" created="Wed, 30 Mar 2016 21:26:33 +0000"  >&lt;p&gt;Perhaps, after reverting, we could spend some effort adding better test coverage to edismax, to prevent similar regressions in the future.&lt;br/&gt;
Then also add a bunch more tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;, defining wanted behavior for all kind of corner cases.&lt;/p&gt;</comment>
                            <comment id="15219086" author="gpendleb" created="Thu, 31 Mar 2016 00:00:23 +0000"  >&lt;p&gt;I am happy to take a look at any issues, since I was involved in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;. I need to get a new copy of the code first, but in the interim, can someone confirm that explicitly setting mm to 0 does not fix this? I believe mm defaults to 100%, so that may be the real culprit, as opposed to q.op=AND. Before &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; was resolved, setting an OR operator would have caused mm to be ignored. Now it will use the default value unless you set it explicitly.&lt;/p&gt;

&lt;p&gt;Our production servers are using 5.1 with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; applied, and we have q.op=AND, with perfectly functional OR operators and mm=0%. All of the obvious queries work, including the cases referenced above.&lt;/p&gt;

&lt;p&gt;From memory there are a lot of subtle cliffs to fall off here, such as making sure we are talking about top level clauses and ultimately remembering that Solr does not use boolean logic... and there are some edge cases where it simply doesn&apos;t work the same way as the occurs flags. SHOULD vs OR is the main culprit.&lt;/p&gt;</comment>
                            <comment id="15219120" author="ryanmax" created="Thu, 31 Mar 2016 00:29:11 +0000"  >&lt;p&gt;I tested explicitly setting mm to 0 and all of my tests passed. I also added a mm=0 to the failing test case from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt; and it passed too.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gpendleb&quot; class=&quot;user-hover&quot; rel=&quot;gpendleb&quot;&gt;gpendleb&lt;/a&gt;, I think your suspicion about mm defaulting to 100% is correct.&lt;/p&gt;</comment>
                            <comment id="15219133" author="gpendleb" created="Thu, 31 Mar 2016 00:35:15 +0000"  >&lt;p&gt;Thanks. Hopefully that is ok. I just installed git and started cloning trunk... now to upgrade to Java 8.&lt;/p&gt;

&lt;p&gt;I think it is all working as intended, it is just that there is a confusing legacy of not having to worry about what mm was set to for some use cases. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; will force people to check what the parameters are, but all queries are now supported.&lt;/p&gt;

&lt;p&gt;It would be nice if it was less disruptive, but given that pre-patch there was no way to get edismax to do certain queries, no matter what parameters you set, I think it is still an improvement.&lt;/p&gt;</comment>
                            <comment id="15219210" author="erickerickson" created="Thu, 31 Mar 2016 02:17:05 +0000"  >&lt;p&gt;Thanks to you both for jumping in here. I&apos;ll see what I can do to get this into any 5.5.1 and also 6.0 (and trunk of course).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt; What do you think? We can raise adding tests as a separate JIRA...&lt;/p&gt;</comment>
                            <comment id="15219758" author="janhoy" created="Thu, 31 Mar 2016 11:27:15 +0000"  >&lt;p&gt;Setting &lt;tt&gt;q.op=AND&lt;/tt&gt;&#160;or &lt;tt&gt;mm=100%&lt;/tt&gt; should result in exactly the same behavior. The fact that setting &lt;tt&gt;mm=0&lt;/tt&gt; passes the test could be a coincidence more than a general workaround, perhaps an issue of the order things are done in the code. Would be interesting to see which code path is executed with &lt;tt&gt;q.op=AND&amp;amp;mm=0&lt;/tt&gt; though...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; We can add more general tests in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8926&quot; title=&quot;Better test coverage for edismax&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8926&quot;&gt;SOLR-8926&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15219765" author="janhoy" created="Thu, 31 Mar 2016 11:40:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think your suspicion about mm defaulting to 100% is correct.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not entirely. The method &lt;tt&gt;DisMaxQParser#parseMinShouldMatch&lt;/tt&gt; &quot;Applies the appropriate default rules for the &quot;mm&quot; param based on the effective value of the &quot;q.op&quot; param&quot;, i.e. if mm is not explicitly set, it is set i 0 for q.op=OR and 100% for q.op=AND.&lt;/p&gt;</comment>
                            <comment id="15220391" author="erickerickson" created="Thu, 31 Mar 2016 18:26:29 +0000"  >&lt;p&gt;OK, just to see if we&apos;re all on the same page. I can make this not a blocker since we have a work-around (set mm=0 when mixing q.op=AND with OR top-level clauses) and work is ongoing to clarify the interaction between q.op and mm.&lt;/p&gt;

&lt;p&gt;The code Jan pointed out sure makes this confusing. Am I correct in that the OR is honored (without setting mm=0) in a query like  q.op=AND&amp;amp;q=A and (B OR C)?&lt;/p&gt;</comment>
                            <comment id="15220618" author="janhoy" created="Thu, 31 Mar 2016 20:31:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can make this not a blocker since we have a work-around&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Isn&apos;t it premature to proclaim a generic workaround, at least without more test coverage to prove so? &lt;br/&gt;
The majority of edismax users have not upgraded to 5.5.0 yet, and for many of them, existing applications and existing queries will start producing wrong results. If there is a generic workaround to add &lt;tt&gt;mm=0&lt;/tt&gt; in solrconfig.xml to get back the correct behavior, we can declare a workaround. But we cannot assume it is acceptable for people to write custom logic to conditionally change the request depending on how the user-entered query looks like. &lt;br/&gt;
That&apos;s why I lean towards reverting, since a revert will only affect the very few 5.5.0 users who rely upon the new stuff. And they have a workaround in building a custom Solr version with the patch, or waiting until 5.5.x or 6.x where a proper fix is introduced.&lt;/p&gt;</comment>
                            <comment id="15220854" author="gpendleb" created="Thu, 31 Mar 2016 23:25:13 +0000"  >&lt;p&gt;I don&apos;t know that what we are talking about here is a &apos;workaround&apos; at all. Solr is doing exactly what it is being asked to do. I know it is disrupting an existing user base, so it warrants discussion and maybe even a &apos;fix&apos;... but the existing user base were leaving a non-configured parameter at its default value (which probably didn&apos;t match their use case) and it only worked because the parameter was being ignored by edismax. The fact that parameter was ignored introduced the real bugs in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think there has always been confusion over how this works under the hood, and that still continues. q.op and mm apply to two different parts of the query, and each of them has other factors that come into play.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;q.op is a boolean operator, which happens pre-parse (or in the very earliest stages of parsing)&lt;/li&gt;
	&lt;li&gt;mm applies to (top level) clauses which have the SHOULD occur flag &lt;b&gt;after&lt;/b&gt; Solr translates all the boolean operators&lt;/li&gt;
	&lt;li&gt;if mm is not explicitly set, the default value is determined by q.op (? I haven&apos;t verified this, but that is Jan&apos;s input above). The old doco says it is always 100% default... but I personally have always set it explicitly... no experience.&lt;/li&gt;
	&lt;li&gt;Solr translates boolean operators into occurs flags differently depending on the value of q.op. In particular q.op=AND causes non-intuitive generation of occurs flags if looked at from a purely boolean perspective.&lt;/li&gt;
	&lt;li&gt;mm does not make much sense at all if you think about search as a purely boolean query (ie. the result either matches or doesn&apos;t) instead of occurs flags (ie. the score of the result is either higher or lower)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So now that &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; has come along, it slightly muddies the water because:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;q.op is no longer hard coded to OR. Pre-patch the user could say q.op=AND, but it didn&apos;t do anything to the query&lt;/li&gt;
	&lt;li&gt;The presence of an operator no longer turns off the mm feature&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;My take on the issue is that users who want to use boolean operators in edismax should pay attention to the mm parameter, and make sure their choice matches their use case&lt;/b&gt;. Previously they didn&apos;t have to... but the presence of the boolean operators when using edismax was buggy (? debatable... it has been argued that it simply wasn&apos;t the use case edismax was first written for).&lt;/p&gt;

&lt;p&gt;Having said that, IF anything was to change, I would simply play subtly with choosing the default value of mm. Maybe something like this:&lt;/p&gt;

&lt;p&gt;IF (the query contains a boolean operator) AND (mm has not been explicitly set) THEN (mm = 0%)&lt;/p&gt;

&lt;p&gt;It is a tweak on the work Jan did in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;, so that instead of turning off mm in response to a boolean operator being present, we instead influence the default value. We still let users ultimately set up their parameters however they want though. If the user has a use case that includes both boolean parameters and mm logic... have fun.&lt;/p&gt;</comment>
                            <comment id="15220908" author="janhoy" created="Fri, 1 Apr 2016 00:17:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gpendleb&quot; class=&quot;user-hover&quot; rel=&quot;gpendleb&quot;&gt;gpendleb&lt;/a&gt; looks like you have a good command on the logic and interactions here, so feel free to throw up a patch...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;IF (the query contains a boolean operator) AND (mm has not been explicitly set) THEN (mm = 0%)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In my experience some users may set mm=100% while others achieved the same with q.op=AND. Advising users to favor the use of only q.op to get boolean operators working makes the distinction hard to explain.&lt;/p&gt;

&lt;p&gt;I&apos;m positive to applying a fix that focuses on getting the pure AND/OR 0%/100% case fixed (if that could be achieved with your proposed method), and then worry about other mm&apos;s combined with explicit operators later.&lt;/p&gt;</comment>
                            <comment id="15220925" author="gpendleb" created="Fri, 1 Apr 2016 00:31:18 +0000"  >&lt;p&gt;Ok, I will try to find some time over the next week or so. I freely confess it doesn&apos;t look great on a Friday afternoon and school holidays begin here after next week. It might be a rough contribution someone else can carry over the line.&lt;/p&gt;

&lt;p&gt;With regards to mixed cases of q.op and mm where users are explicitly setting them, I think they are already covered if you look in the unit test testDefaultOperatorWithMm(). The problem here seems to be the use case where people do not explicitly set mm and fall back to the default. This is treading on some expected behaviour from existing users.&lt;/p&gt;</comment>
                            <comment id="15221073" author="gpendleb" created="Fri, 1 Apr 2016 03:16:08 +0000"  >&lt;p&gt;Attaching possible &apos;fix&apos; that defaults mm to 0% if the users has declared no explicit mm, but has boolean operators in their query.&lt;/p&gt;

&lt;p&gt;First time I have generated a patch using git, so hopefully it is ok.&lt;/p&gt;</comment>
                            <comment id="15221079" author="gpendleb" created="Fri, 1 Apr 2016 03:19:58 +0000"  >&lt;p&gt;I also confirmed (for my own sanity) that q.op does indeed influence the default value of mm, as per &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;. Personally I don&apos;t like that, and perhaps it isn&apos;t relevant anymore since &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;... but I left it alone.&lt;/p&gt;</comment>
                            <comment id="15221407" author="janhoy" created="Fri, 1 Apr 2016 09:07:08 +0000"  >&lt;p&gt;Should we add a test case for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rjosal&quot; class=&quot;user-hover&quot; rel=&quot;rjosal&quot;&gt;rjosal&lt;/a&gt;&apos;s issue above as well? &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&quot;hair ties -barbie&quot; should return hair ties but not barbie hair ties, and now it matches nothing.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="15222676" author="erickerickson" created="Sat, 2 Apr 2016 03:10:30 +0000"  >&lt;p&gt;We&apos;ve got something of a time problem here. 6.0 is being released (there was an RC1, but it&apos;s being re-spun) and this JIRA is marked as a blocker.&lt;/p&gt;

&lt;p&gt;I don&apos;t think that this &lt;em&gt;should&lt;/em&gt; be a blocker for 6.0 since it&apos;s already in 5.5. And I&apos;m reluctant to hurry a fix in to 6.0 at this late date given the discussion so far. I suspect that practically 6.0 won&apos;t be rushed into production before we get a fix for this issue (6.0.1 or 6.1 or whatever).&lt;/p&gt;

&lt;p&gt;We should fix it ASAP, but not at the expense of holding up 6.0.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="15223238" author="ichattopadhyaya" created="Sun, 3 Apr 2016 12:14:32 +0000"  >&lt;p&gt;How about initiating a 5.5.1 and 6.0.1 release immediately after the 6.0 release?&lt;/p&gt;</comment>
                            <comment id="15223568" author="gpendleb" created="Mon, 4 Apr 2016 00:35:53 +0000"  >&lt;p&gt;Adding a &apos;hair ties -barbie&apos; example to unit tests. Not sure it demonstrates anything new, but it does work as I would expect.&lt;/p&gt;

&lt;p&gt;I can&apos;t get git to generate a combined patch the way I would have in svn... my git-fu is weak.&lt;/p&gt;</comment>
                            <comment id="15223581" author="gpendleb" created="Mon, 4 Apr 2016 00:58:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;, personally, I am ambivalent with regards to timing and versions. I am still not convinced there is actually an issue here, but I don&apos;t want to be a dick and dismiss it out-of-hand.&lt;/p&gt;

&lt;p&gt;The patches provided are simply about choosing default parameter values that disrupt the least number of users who did not have mm set to an appropriate value. Any user (risky, broad generalisation incoming) who puts a boolean OR operator into an edismax query string would not want mm=100%, but that is what is happening here.&lt;/p&gt;</comment>
                            <comment id="15259298" author="erickerickson" created="Wed, 27 Apr 2016 01:07:36 +0000"  >&lt;p&gt;Since this hasn&apos;t really reached any sort of resolution, and since this behavior is out there in the field already I changed its status. I&apos;ll keep it on my back burner.&lt;/p&gt;

&lt;p&gt;I suspect that Jan&apos;s comments about beefing up the test cases is well taken. When I Get Some Time (tm) I&apos;ll see about beefing up the test cases (all volunteers welcome). I think it&apos;ll be easier to discuss specific test cases and whether the behavior they&apos;re testing is the desired behavior...&lt;/p&gt;</comment>
                            <comment id="15259660" author="janhoy" created="Wed, 27 Apr 2016 06:59:01 +0000"  >&lt;p&gt;Relevant user@ email thread, confirming the impression that this indeed must be treated as a bug: &lt;a href=&quot;http://search-lucene.com/m/eHNlru3hR1b74Oz&amp;amp;subj=How+can+I+set+the+defaultOperator+to+be+AND+&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search-lucene.com/m/eHNlru3hR1b74Oz&amp;amp;subj=How+can+I+set+the+defaultOperator+to+be+AND+&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15279729" author="stephlag" created="Wed, 11 May 2016 07:47:35 +0000"  >&lt;p&gt;Can you remove this issue from version 5.5.1 as this version is packaged without a fix for this issue?&lt;/p&gt;</comment>
                            <comment id="15323952" author="steve_rowe" created="Fri, 10 Jun 2016 06:26:40 +0000"  >&lt;p&gt;Patch combining both of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=greg.pendlebury&quot; class=&quot;user-hover&quot; rel=&quot;greg.pendlebury&quot;&gt;greg.pendlebury&lt;/a&gt;&apos;s patches, beefing up the tests, simplifying the change a bit, and putting things back where they were prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Some of the comment text was skeptical about what&apos;s currently supported, so I changed it to more neutral language.  I also tried to regularize the failure text in the tests.&lt;/p&gt;

&lt;p&gt;I also added one test to demonstrate that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&apos;s &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9174&quot; title=&quot;After Solr 5.5, mm parameter doesn&amp;#39;t work properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9174&quot;&gt;SOLR-9174&lt;/a&gt; mm issue is (still) handled properly.&lt;/p&gt;

&lt;p&gt;All Solr tests and procommit passes.  Committing shortly.&lt;/p&gt;</comment>
                            <comment id="15323985" author="jira-bot" created="Fri, 10 Jun 2016 07:01:51 +0000"  >&lt;p&gt;Commit 5bc34949adc911dacba29c08f1e522de4679aee6 in lucene-solr&apos;s branch refs/heads/branch_5_5 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5bc3494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5bc3494&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15323987" author="jira-bot" created="Fri, 10 Jun 2016 07:01:55 +0000"  >&lt;p&gt;Commit 508f8f83e1ed3bb8c7f8ca37d767e95b5b7b87c3 in lucene-solr&apos;s branch refs/heads/branch_5_5 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=508f8f8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=508f8f8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: CHANGES.txt entry&lt;/p&gt;</comment>
                            <comment id="15323988" author="jira-bot" created="Fri, 10 Jun 2016 07:01:56 +0000"  >&lt;p&gt;Commit e88a64a0490ac2139e0aa55a8ca8b3588ce41395 in lucene-solr&apos;s branch refs/heads/branch_5x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e88a64a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e88a64a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15323990" author="jira-bot" created="Fri, 10 Jun 2016 07:01:59 +0000"  >&lt;p&gt;Commit 1dff75c643f17c5447264fecb9b71530e05f017f in lucene-solr&apos;s branch refs/heads/branch_5x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1dff75c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1dff75c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: CHANGES.txt entry&lt;/p&gt;</comment>
                            <comment id="15323991" author="jira-bot" created="Fri, 10 Jun 2016 07:02:01 +0000"  >&lt;p&gt;Commit 202b993335a370be06db02b866c62a876350b01d in lucene-solr&apos;s branch refs/heads/branch_6_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=202b993&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=202b993&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15323993" author="jira-bot" created="Fri, 10 Jun 2016 07:02:04 +0000"  >&lt;p&gt;Commit d5712fea6058ed5fe905f4e157466d117a1f38c0 in lucene-solr&apos;s branch refs/heads/branch_6_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d5712fe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d5712fe&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: CHANGES.txt entry&lt;/p&gt;</comment>
                            <comment id="15323994" author="jira-bot" created="Fri, 10 Jun 2016 07:02:05 +0000"  >&lt;p&gt;Commit c2aac7d005424094e129045e834aa6ffb2c7aa82 in lucene-solr&apos;s branch refs/heads/branch_6_1 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c2aac7d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c2aac7d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15323996" author="jira-bot" created="Fri, 10 Jun 2016 07:02:08 +0000"  >&lt;p&gt;Commit e0c6762de8dd91e02a79a6d12b3164a052bf07ff in lucene-solr&apos;s branch refs/heads/branch_6_1 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e0c6762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e0c6762&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15323998" author="jira-bot" created="Fri, 10 Jun 2016 07:02:11 +0000"  >&lt;p&gt;Commit 3c789e9d274fb670c53c8eb6eb9dfceace2cd120 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3c789e9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3c789e9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15324000" author="jira-bot" created="Fri, 10 Jun 2016 07:02:14 +0000"  >&lt;p&gt;Commit 74d94ec26585d57d6991f99c892f7be1278346f9 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=74d94ec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=74d94ec&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15324002" author="jira-bot" created="Fri, 10 Jun 2016 07:02:16 +0000"  >&lt;p&gt;Commit 38714399760889d2d7b188a87341aade6139ffef in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3871439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3871439&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8812&quot; title=&quot;ExtendedDismaxQParser (edismax) ignores Boolean OR when q.op=AND and mm is not explicitly set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8812&quot;&gt;&lt;del&gt;SOLR-8812&lt;/del&gt;&lt;/a&gt;: edismax: turn off mm processing if no explicit mm spec is provided and there are explicit operators (except for AND) - addresses problems caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15324063" author="gpendleb" created="Fri, 10 Jun 2016 08:24:56 +0000"  >&lt;p&gt;Sounds (tentatively) ok to me. I was quite concerned when you said it puts things back to pre-&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; functionality, but from looking at what got committed it seems that q.op=OR is no longer hardcoded in setDefaultOperator() (which was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;). I haven&apos;t executed anything, but this seems like a good step with regards to mm handling.&lt;/p&gt;</comment>
                            <comment id="15324415" author="dsmiley" created="Fri, 10 Jun 2016 13:04:48 +0000"  >&lt;p&gt;Thanks so much for getting this done &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; (and others)!&lt;/p&gt;</comment>
                            <comment id="15324542" author="erickerickson" created="Fri, 10 Jun 2016 14:41:31 +0000"  >&lt;p&gt;Big thanks Steve! This has been contributing to my &quot;guilt load&quot; for a really long time.&lt;/p&gt;</comment>
                            <comment id="15324602" author="steve_rowe" created="Fri, 10 Jun 2016 15:12:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;Sounds (tentatively) ok to me. I was quite concerned when you said it puts things back to pre-&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; functionality, but from looking at what got committed it seems that q.op=OR is no longer hardcoded in setDefaultOperator() (which was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt;). I haven&apos;t executed anything, but this seems like a good step with regards to mm handling.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Greg, what I committed is behaviorally the same as your patch - check the unit tests: I included all of the ones you wrote, but added more to cover all permutations of operator and &lt;tt&gt;q.op&lt;/tt&gt;.  &lt;/p&gt;

&lt;p&gt;What I meant by &quot;put things back&quot; was that I attempted to minimize the diff between what I committed and the pre-&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2649&quot; title=&quot;MM ignored in edismax queries with operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2649&quot;&gt;&lt;del&gt;SOLR-2649&lt;/del&gt;&lt;/a&gt; code, so I put your &lt;tt&gt;foundOperators()&lt;/tt&gt; back in the same location that it was when it was named &lt;tt&gt;doMinMatched()&lt;/tt&gt; - your patch put it in a different location in the source file.&lt;/p&gt;

&lt;p&gt;Thanks for the work you did on this issue!&lt;/p&gt;</comment>
                            <comment id="15325638" author="gpendleb" created="Sat, 11 Jun 2016 01:57:37 +0000"  >&lt;p&gt;Sounds great. Add my thanks to the those you&apos;ve already received.&lt;/p&gt;</comment>
                            <comment id="15326691" author="janhoy" created="Sun, 12 Jun 2016 23:43:14 +0000"  >&lt;p&gt;Thanks Steve for pushing this through!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12950739">SOLR-8853</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12947640">SOLR-8796</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12974063">SOLR-9174</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13149058">SOLR-12165</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12513780">SOLR-2649</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12796761" name="SOLR-8812-barbie.patch" size="2753" author="gpendleb" created="Mon, 4 Apr 2016 00:35:53 +0000"/>
                            <attachment id="12809370" name="SOLR-8812.patch" size="10153" author="sarowe" created="Fri, 10 Jun 2016 06:26:40 +0000"/>
                            <attachment id="12796457" name="SOLR-8812.patch" size="5191" author="gpendleb" created="Fri, 1 Apr 2016 03:16:08 +0000"/>
                            <attachment id="12794179" name="SOLR-8812.patch" size="997" author="janhoy" created="Fri, 18 Mar 2016 11:53:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uexz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>