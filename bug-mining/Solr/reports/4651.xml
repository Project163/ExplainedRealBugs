<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:47:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15191] Faceting on EnumFieldType does not work if allBuckets, numBuckets or missing is set</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15191</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Due to Solr-14514 FacetFieldProcessorByEnumTermsStream is not used if allBuckets, numBuckets or missing parma is true.&lt;/p&gt;

&lt;p&gt;As fallback FacetFieldProcessorByHashDV is used which FacetRangeProcessor.getNumericCalc(sf) on the field. EnumFileType is not handled currently, so a SolrException is thrown with BAD_REQUEST and &apos;Expected numeric field type&apos;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13360609">SOLR-15191</key>
            <summary>Faceting on EnumFieldType does not work if allBuckets, numBuckets or missing is set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="thomas.woeckinger">Thomas W&#246;ckinger</reporter>
                        <labels>
                            <label>easy-fix</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 24 Feb 2021 12:22:33 +0000</created>
                <updated>Wed, 23 Jun 2021 13:43:00 +0000</updated>
                            <resolved>Tue, 30 Mar 2021 12:30:17 +0000</resolved>
                                    <version>8.7</version>
                    <version>8.8</version>
                    <version>8.8.1</version>
                                    <fixVersion>8.9</fixVersion>
                                    <component>Facet Module</component>
                    <component>FacetComponent</component>
                    <component>faceting</component>
                    <component>search</component>
                    <component>streaming expressions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17289895" author="thomas.woeckinger" created="Wed, 24 Feb 2021 12:34:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=munendrasn&quot; class=&quot;user-hover&quot; rel=&quot;munendrasn&quot;&gt;munendrasn&lt;/a&gt; you may have a short look on it because the streaming fixes were done by you.&lt;/p&gt;

&lt;p&gt;May also &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; can provide feedback because he was also working in the same code area.&lt;/p&gt;</comment>
                            <comment id="17292211" author="jira-bot" created="Sat, 27 Feb 2021 19:34:03 +0000"  >&lt;p&gt;Commit 319d06977dd909edd28927a6d7224635d5aca230 in lucene-solr&apos;s branch refs/heads/branch_8x from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=319d069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=319d069&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15191&quot; title=&quot;Faceting on EnumFieldType does not work if allBuckets, numBuckets or missing is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15191&quot;&gt;&lt;del&gt;SOLR-15191&lt;/del&gt;&lt;/a&gt;: Fix JSON faceting on EnumFieldType (#2426)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Fix JSON Faceting on EnumFieldType if allBuckets, numBuckets or missing is set.&lt;/li&gt;
	&lt;li&gt;Enhance hash method of JSON faceting to support EnumFieldType and perhaps some other/custom field types&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Co-authored-by: Thomas W&#246;ckinger &amp;lt;two@silbergrau.com&amp;gt;&lt;br/&gt;
Co-authored-by: David Smiley &amp;lt;dsmiley@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17292228" author="jira-bot" created="Sat, 27 Feb 2021 20:06:48 +0000"  >&lt;p&gt;Commit 988a16fe95d01125392a29365818f94bce0f98df in lucene-solr&apos;s branch refs/heads/master from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=988a16f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=988a16f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15191&quot; title=&quot;Faceting on EnumFieldType does not work if allBuckets, numBuckets or missing is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15191&quot;&gt;&lt;del&gt;SOLR-15191&lt;/del&gt;&lt;/a&gt;: Fix JSON faceting on EnumFieldType (#2426)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Fix JSON Faceting on EnumFieldType if allBuckets, numBuckets or missing is set.&lt;/li&gt;
	&lt;li&gt;Enhance hash method of JSON faceting to support EnumFieldType and perhaps some other/custom field types&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Co-authored-by: Thomas W&#246;ckinger &amp;lt;two@silbergrau.com&amp;gt;&lt;br/&gt;
Co-authored-by: David Smiley &amp;lt;dsmiley@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17292237" author="dsmiley" created="Sat, 27 Feb 2021 21:07:09 +0000"  >&lt;p&gt;Thanks for contributing Thomas!&lt;/p&gt;</comment>
                            <comment id="17293947" author="dsmiley" created="Tue, 2 Mar 2021 19:40:57 +0000"  >&lt;p&gt;Test failure:&lt;br/&gt;
&lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Windows/9730/testReport/junit/org.apache.solr.schema/EnumFieldTest/testFacetEnumSearch/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Windows/9730/testReport/junit/org.apache.solr.schema/EnumFieldTest/testFacetEnumSearch/&lt;/a&gt;&lt;br/&gt;
Can you please look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.woeckinger&quot; class=&quot;user-hover&quot; rel=&quot;thomas.woeckinger&quot;&gt;thomas.woeckinger&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17294307" author="thomas.woeckinger" created="Wed, 3 Mar 2021 06:37:00 +0000"  >&lt;p&gt;The return value for facets count is long at the master rather than int from branch 8.x.&lt;/p&gt;

&lt;p&gt;So changing:&lt;/p&gt;

&lt;p&gt;&quot;//*&lt;span class=&quot;error&quot;&gt;&amp;#91;@name=&amp;#39;facets&amp;#39;&amp;#93;&lt;/span&gt;/int/text()=6&quot;,&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;&quot;//*&lt;span class=&quot;error&quot;&gt;&amp;#91;@name=&amp;#39;facets&amp;#39;&amp;#93;&lt;/span&gt;/long/text()=6&quot;,&lt;/p&gt;

&lt;p&gt;should fix the test&lt;/p&gt;</comment>
                            <comment id="17294953" author="jira-bot" created="Thu, 4 Mar 2021 02:42:00 +0000"  >&lt;p&gt;Commit 8d62e2723aa20bf961615189604ae9b6d5445ac0 in lucene-solr&apos;s branch refs/heads/master from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8d62e27&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8d62e27&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15191&quot; title=&quot;Faceting on EnumFieldType does not work if allBuckets, numBuckets or missing is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15191&quot;&gt;&lt;del&gt;SOLR-15191&lt;/del&gt;&lt;/a&gt;: Fix EnumFieldTest&lt;br/&gt;
(9x/8x difference)&lt;/p&gt;</comment>
                            <comment id="17306367" author="hossman" created="Mon, 22 Mar 2021 16:46:24 +0000"  >&lt;p&gt;Test is still failing for some seeds...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   &amp;gt;         Caused by:
   &amp;gt;         java.lang.RuntimeException: REQUEST FAILED: xpath=//*[@name=&apos;facets&apos;]/long/text()=6
   &amp;gt;            xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
   &amp;gt;         &amp;lt;response&amp;gt;
   &amp;gt;         &amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;&amp;lt;int name=&quot;status&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;int name=&quot;QTime&quot;&amp;gt;19&amp;lt;/int&amp;gt;&amp;lt;lst name=&quot;params&quot;&amp;gt;&amp;lt;str name=&quot;q&quot;&amp;gt;severity:*&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;json.facet&quot;&amp;gt;{ severity : { type : terms, field : severity, missing : true, exists : true, allBuckets : true, method : enum }}&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;fl&quot;&amp;gt;severity&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;wt&quot;&amp;gt;xml&amp;lt;/str&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;0&quot; start=&quot;0&quot; numFoundExact=&quot;true&quot;&amp;gt;&amp;lt;/result&amp;gt;&amp;lt;lst name=&quot;facets&quot;&amp;gt;&amp;lt;long name=&quot;count&quot;&amp;gt;0&amp;lt;/long&amp;gt;&amp;lt;/lst&amp;gt;
   &amp;gt;         &amp;lt;/response&amp;gt;
   &amp;gt; 
   &amp;gt;            request was:q=severity:*&amp;amp;json.facet={+severity+:+{+type+:+terms,+field+:+severity,+missing+:+true,+exists+:+true,+allBuckets+:+true,+method+:+enum+}}&amp;amp;fl=severity&amp;amp;wt=xml
   &amp;gt;             at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:1001)
   &amp;gt;             ... 46 more
  2&amp;gt; NOTE: reproduce with: gradlew test --tests EnumFieldTest.testFacetEnumSearch -Dtests.seed=B5293E76967BD250 -Dtests.multiplier=2 -Dtests.slow=true -Dtests.locale=bez-TZ -Dtests.timezone=Africa/Porto-Novo -Dtests.asserts=true -Dtests.file.encoding=UTF-8
 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17306383" author="thomas.woeckinger" created="Mon, 22 Mar 2021 17:00:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; can you provide the used settings of the particular run?&lt;/p&gt;

&lt;p&gt;The result looks like no values are indexed, so maybe an additional assume at the start of the test is requred.&lt;/p&gt;</comment>
                            <comment id="17306388" author="hossman" created="Mon, 22 Mar 2021 17:02:04 +0000"  >&lt;p&gt;you mean the reproduce line? ... that i posted above?&lt;/p&gt;</comment>
                            <comment id="17306401" author="thomas.woeckinger" created="Mon, 22 Mar 2021 17:05:17 +0000"  >&lt;p&gt;The relevant properties are solr.tests.EnumFieldTest.indexed and solr.tests.numeric.dv&lt;/p&gt;</comment>
                            <comment id="17308347" author="dsmiley" created="Thu, 25 Mar 2021 04:24:56 +0000"  >&lt;p&gt;Apparently the test infrastructure randomly picks not only &lt;tt&gt;EnumFieldType&lt;/tt&gt; but also &lt;tt&gt;EnumField&lt;/tt&gt;.  The &lt;tt&gt;assumeFalse&lt;/tt&gt; only checks for one of them.  I suggest checking for neither, and thus merely demand that there is docValues.  I&apos;m not sure if this test could work with other scenarios but it was designed specifically for EnumFieldType.  Makes sense?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.woeckinger&quot; class=&quot;user-hover&quot; rel=&quot;thomas.woeckinger&quot;&gt;thomas.woeckinger&lt;/a&gt; why did you pick &lt;tt&gt;method : enum&lt;/tt&gt; for the JSON facet algorithm?  If I recall (my memory is hazy on this), we&apos;re going to use the hash algorithm so why specify enum?  Just to show that it picks one that can actually work based on the field&apos;s config?&lt;/p&gt;</comment>
                            <comment id="17308417" author="thomas.woeckinger" created="Thu, 25 Mar 2021 06:35:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; I encounter the failure because of our integration tests while upgrading to 8.8.1, we have to support it because of legacy reasons.&lt;/p&gt;

&lt;p&gt;So I think you are right, most of the other tests have the same assumeFalse.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17309705" author="jira-bot" created="Fri, 26 Mar 2021 20:23:39 +0000"  >&lt;p&gt;Commit 7ab60a2b83916afedaecd8bd7843f7d8859ebdaa in solr&apos;s branch refs/heads/main from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=7ab60a2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=7ab60a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15191&quot; title=&quot;Faceting on EnumFieldType does not work if allBuckets, numBuckets or missing is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15191&quot;&gt;&lt;del&gt;SOLR-15191&lt;/del&gt;&lt;/a&gt;: Fix testFacetEnumSearch&lt;/p&gt;</comment>
                            <comment id="17309706" author="jira-bot" created="Fri, 26 Mar 2021 20:25:39 +0000"  >&lt;p&gt;Commit bbc0804f5fede4ca9eb3665cfccd477b0351bbce in lucene-solr&apos;s branch refs/heads/branch_8x from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=bbc0804&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=bbc0804&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15191&quot; title=&quot;Faceting on EnumFieldType does not work if allBuckets, numBuckets or missing is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15191&quot;&gt;&lt;del&gt;SOLR-15191&lt;/del&gt;&lt;/a&gt;: Fix testFacetEnumSearch&lt;/p&gt;</comment>
                            <comment id="17368208" author="mayya" created="Wed, 23 Jun 2021 13:43:00 +0000"  >&lt;p&gt;Closing after the 8.9.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13307555">SOLR-14514</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13382644">SOLR-15457</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0o0ig:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>