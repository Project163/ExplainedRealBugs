<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:05:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7602] Frequent MultiThreadedOCPTest failures on Jenkins</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7602</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The number of failed MultiThreadedOCPTest runs on Jenkins has gone up drastically since Apr 30, 2015.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;REGRESSION:  org.apache.solr.cloud.MultiThreadedOCPTest.test

Error Message:
Captured an uncaught exception in thread: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=6313, name=parallelCoreAdminExecutor-1988-thread-15, state=RUNNABLE, group=TGRP-MultiThreadedOCPTest]

Stack Trace:
com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=6313, name=parallelCoreAdminExecutor-1988-thread-15, state=RUNNABLE, group=TGRP-MultiThreadedOCPTest]
        at __randomizedtesting.SeedInfo.seed([1FD11A82D96D185B:97852558779175A3]:0)
Caused by: java.lang.AssertionError: Too many closes on SolrCore
        at __randomizedtesting.SeedInfo.seed([1FD11A82D96D185B]:0)
        at org.apache.solr.core.SolrCore.close(SolrCore.java:1138)
        at org.apache.solr.common.util.IOUtils.closeQuietly(IOUtils.java:31)
        at org.apache.solr.core.CoreContainer.create(CoreContainer.java:535)
        at org.apache.solr.core.CoreContainer.create(CoreContainer.java:494)
        at org.apache.solr.handler.admin.CoreAdminHandler.handleCreateAction(CoreAdminHandler.java:598)
        at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestInternal(CoreAdminHandler.java:212)
        at org.apache.solr.handler.admin.CoreAdminHandler$ParallelCoreAdminHandlerThread.run(CoreAdminHandler.java:1219)
        at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor$1.run(ExecutorUtil.java:148)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Last failure:&lt;br/&gt;
Build: &lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Linux/12665/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Linux/12665/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12833160">SOLR-7602</key>
            <summary>Frequent MultiThreadedOCPTest failures on Jenkins</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="anshum">Anshum Gupta</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 May 2015 19:53:41 +0000</created>
                <updated>Thu, 20 Aug 2015 17:56:53 +0000</updated>
                            <resolved>Thu, 20 Aug 2015 17:56:53 +0000</resolved>
                                                    <fixVersion>5.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14562220" author="anshumg" created="Thu, 28 May 2015 02:59:29 +0000"  >&lt;p&gt;Seems like the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7408&quot; title=&quot;Let SolrCore be the only thing which registers/unregisters a config directory listener&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7408&quot;&gt;&lt;del&gt;SOLR-7408&lt;/del&gt;&lt;/a&gt; triggered this. Since that change, solrCore.close() is called for every failed creation attempt i.e. in case of an exception during Core creation.&lt;br/&gt;
SolrCore.close has this check:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count = refCount.decrementAndGet(); &lt;span class=&quot;code-comment&quot;&gt;// #1
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (count &amp;gt; 0) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// close is called often, and only actually closes &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; nothing is using it.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (count &amp;lt; 0) {
      log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Too many close [count:{}] on {}. Please report &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; exception to solr-user@lucene.apache.org&quot;&lt;/span&gt;, count, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; );
      &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Too many closes on SolrCore&quot;&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When the core creation fails, #1 could return -1.&lt;/p&gt;

&lt;p&gt;We should bypass this check in such cases or increment the refCount as the first thing during creation.&lt;/p&gt;</comment>
                            <comment id="14562457" author="noble.paul" created="Thu, 28 May 2015 08:02:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;We should bypass this check in such cases or increment the refCount as the first thing during creation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Reply&lt;/p&gt;

&lt;p&gt;It is initialized with a value of 1 . So , that should not be a problem. The recent changes would have added a &lt;tt&gt;SolrCore.close()&lt;/tt&gt; somewhere &lt;/p&gt;</comment>
                            <comment id="14562480" author="anshumg" created="Thu, 28 May 2015 08:16:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; you&apos;re correct.&lt;/p&gt;

&lt;p&gt;There&apos;s a close in the SolrCore constructor, so that calls a close in case of an exception and also rethrows the exception.&lt;br/&gt;
The coreContainer.create method also tries to close the same core in the catch block, which causes this issue when an exception occurs while creating a new SolrCore.&lt;/p&gt;</comment>
                            <comment id="14562636" author="noble.paul" created="Thu, 28 May 2015 10:21:29 +0000"  >&lt;p&gt;Yes, that is the problem. We should just check the refcount before calling a close in the CoreContainer.&lt;/p&gt;</comment>
                            <comment id="14562837" author="markrmiller@gmail.com" created="Thu, 28 May 2015 12:48:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;There&apos;s a close in the SolrCore constructor, so that calls a close in case of an exception and also rethrows the exception.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The coreContainer.create method also tries to close the same core in the catch block, which causes this issue when an exception occurs while creating a new SolrCore.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How would the CoreContainer get a reference to call close on if an exception was thrown from the constructor of the SolrCore?&lt;/p&gt;</comment>
                            <comment id="14563377" author="anshumg" created="Thu, 28 May 2015 18:07:43 +0000"  >&lt;p&gt;hmmm, I&apos;m looking at other code paths now. Plan to get this into the next 5.2 RC.&lt;/p&gt;</comment>
                            <comment id="14563495" author="anshumg" created="Thu, 28 May 2015 19:06:06 +0000"  >&lt;p&gt;I think just checking if a core is closed already before calling a close on it should be a good solution.&lt;/p&gt;

&lt;p&gt;The problem here is that registerCore fails, as the coreContainer is closed. This exception is then caught and an attempt is made to close the core whereas the core would already be closed by this time, causing the ref count to be -1.&lt;/p&gt;</comment>
                            <comment id="14563530" author="anshumg" created="Thu, 28 May 2015 19:25:52 +0000"  >&lt;p&gt;Added a null check.&lt;/p&gt;</comment>
                            <comment id="14563542" author="noble.paul" created="Thu, 28 May 2015 19:31:57 +0000"  >&lt;p&gt;It&apos;s fine&lt;/p&gt;</comment>
                            <comment id="14563625" author="jira-bot" created="Thu, 28 May 2015 20:28:03 +0000"  >&lt;p&gt;Commit 1682323 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1682323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1682323&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7602&quot; title=&quot;Frequent MultiThreadedOCPTest failures on Jenkins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7602&quot;&gt;&lt;del&gt;SOLR-7602&lt;/del&gt;&lt;/a&gt;: Check if SolrCore object is already closed before trying to close it in case of an exception during Core creation.&lt;/p&gt;</comment>
                            <comment id="14563697" author="jira-bot" created="Thu, 28 May 2015 21:15:02 +0000"  >&lt;p&gt;Commit 1682336 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1682336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1682336&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7602&quot; title=&quot;Frequent MultiThreadedOCPTest failures on Jenkins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7602&quot;&gt;&lt;del&gt;SOLR-7602&lt;/del&gt;&lt;/a&gt;: Check if SolrCore object is already closed before trying to close it in case of an exception during Core creation.(merge from trunk)&lt;/p&gt;</comment>
                            <comment id="14563757" author="jira-bot" created="Thu, 28 May 2015 21:54:34 +0000"  >&lt;p&gt;Commit 1682346 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_2&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1682346&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1682346&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7602&quot; title=&quot;Frequent MultiThreadedOCPTest failures on Jenkins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7602&quot;&gt;&lt;del&gt;SOLR-7602&lt;/del&gt;&lt;/a&gt;: Check if SolrCore object is already closed before trying to close it in case of an exception during Core creation.(merge from branch_5x)&lt;/p&gt;</comment>
                            <comment id="14705399" author="shalinmangar" created="Thu, 20 Aug 2015 17:48:45 +0000"  >&lt;p&gt;I guess these commits fixed the problem. Can we close this issue?&lt;/p&gt;</comment>
                            <comment id="14705428" author="anshumg" created="Thu, 20 Aug 2015 17:56:53 +0000"  >&lt;p&gt;Marking this as resolved as we haven&apos;t seen these since fix was committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12818698">SOLR-7354</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12735951" name="SOLR-7602.patch" size="1281" author="anshum" created="Thu, 28 May 2015 19:25:52 +0000"/>
                            <attachment id="12735945" name="SOLR-7602.patch" size="1234" author="anshum" created="Thu, 28 May 2015 19:06:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f9x3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>