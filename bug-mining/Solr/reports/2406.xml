<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7338] A reloaded core will never register itself as active after a ZK session expiration</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7338</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If a collection gets reloaded, then a core&apos;s isReloaded flag is always true. If a core experiences a ZK session expiration after a reload, then it won&apos;t ever be able to set itself to active because of the check in &lt;tt&gt;ZkController#register&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        UpdateLog ulog = core.getUpdateHandler().getUpdateLog();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!core.isReloaded() &amp;amp;&amp;amp; ulog != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-comment&quot;&gt;// disable recovery in &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; shard is in construction state (&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; shard splits)
&lt;/span&gt;          Slice slice = getClusterState().getSlice(collection, shardId);
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (slice.getState() != Slice.State.CONSTRUCTION || !isLeader) {
            Future&amp;lt;UpdateLog.RecoveryInfo&amp;gt; recoveryFuture = core.getUpdateHandler().getUpdateLog().recoverFromLog();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (recoveryFuture != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
              log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Replaying tlog &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; + ourUrl + &lt;span class=&quot;code-quote&quot;&gt;&quot; during startup... NOTE: This can take a &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;.&quot;&lt;/span&gt;);
              recoveryFuture.get(); &lt;span class=&quot;code-comment&quot;&gt;// NOTE: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; could potentially block &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
&lt;/span&gt;              &lt;span class=&quot;code-comment&quot;&gt;// minutes or more!
&lt;/span&gt;              &lt;span class=&quot;code-comment&quot;&gt;// TODO: &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; as recovering in the mean time?
&lt;/span&gt;              &lt;span class=&quot;code-comment&quot;&gt;// TODO: in the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; we could &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; peersync in parallel with recoverFromLog
&lt;/span&gt;            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
              log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;No LogReplay needed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; core=&quot;&lt;/span&gt; + core.getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; baseURL=&quot;&lt;/span&gt; + baseUrl);
            }
          }
          &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; didRecovery = checkRecovery(coreName, desc, recoverReloadedCores, isLeader, cloudDesc,
              collection, coreZkNodeName, shardId, leaderProps, core, cc);
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!didRecovery) {
            publish(desc, ZkStateReader.ACTIVE);
          }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can easily simulate this on trunk by doing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bin/solr -c -z localhost:2181
bin/solr create -c foo
bin/post -c foo example/exampledocs/*.xml
curl &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/admin/collections?action=RELOAD&amp;amp;name=foo&quot;&lt;/span&gt;
&lt;/span&gt;kill -STOP &amp;lt;PID&amp;gt; &amp;amp;&amp;amp; sleep &amp;lt;PAUSE_SECONDS&amp;gt; &amp;amp;&amp;amp; kill -CONT &amp;lt;PID&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Where &amp;lt;PID&amp;gt; is the process ID of the Solr node. Here are the logs after the CONT command. As you can see below, the core never gets to setting itself as active again. I think the bug is that the isReloaded flag needs to get set back to false once the reload is successful, but I don&apos;t understand what this flag is needed for anyway???&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  - 2015-04-01 17:28:50.962; org.apache.solr.common.cloud.ConnectionManager; Watcher org.apache.solr.common.cloud.ConnectionManager@5519dba0 name:ZooKeeperConnection Watcher:localhost:2181 got event WatchedEvent state:Disconnected type:None path:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; type:None
INFO  - 2015-04-01 17:28:50.963; org.apache.solr.common.cloud.ConnectionManager; zkClient has disconnected
INFO  - 2015-04-01 17:28:51.107; org.apache.solr.common.cloud.ConnectionManager; Watcher org.apache.solr.common.cloud.ConnectionManager@5519dba0 name:ZooKeeperConnection Watcher:localhost:2181 got event WatchedEvent state:Expired type:None path:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; type:None
INFO  - 2015-04-01 17:28:51.107; org.apache.solr.common.cloud.ConnectionManager; Our previous ZooKeeper session was expired. Attempting to reconnect to recover relationship with ZooKeeper...
INFO  - 2015-04-01 17:28:51.108; org.apache.solr.cloud.Overseer; Overseer (id=93579450724974592-192.168.1.2:8983_solr-n_0000000000) closing
INFO  - 2015-04-01 17:28:51.108; org.apache.solr.cloud.ZkController$WatcherImpl; A node got unwatched &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /configs/foo
INFO  - 2015-04-01 17:28:51.108; org.apache.solr.cloud.Overseer$ClusterStateUpdater; Overseer Loop exiting : 192.168.1.2:8983_solr
INFO  - 2015-04-01 17:28:51.109; org.apache.solr.cloud.OverseerCollectionProcessor; According to ZK I (id=93579450724974592-192.168.1.2:8983_solr-n_0000000000) am no longer a leader.
INFO  - 2015-04-01 17:28:51.108; org.apache.solr.cloud.ZkController$4; Running listeners &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /configs/foo
INFO  - 2015-04-01 17:28:51.109; org.apache.solr.common.cloud.DefaultConnectionStrategy; Connection expired - starting a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; one...
INFO  - 2015-04-01 17:28:51.109; org.apache.solr.core.SolrCore$11; config update listener called &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; core foo_shard1_replica1
INFO  - 2015-04-01 17:28:51.110; org.apache.solr.common.cloud.ConnectionManager; Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; client to connect to ZooKeeper
ERROR - 2015-04-01 17:28:51.110; org.apache.solr.common.SolrException; OverseerAutoReplicaFailoverThread had an error in its thread work loop.:org.apache.solr.common.SolrException: Error reading cluster properties
	at org.apache.solr.common.cloud.ZkStateReader.getClusterProps(ZkStateReader.java:772)
	at org.apache.solr.cloud.OverseerAutoReplicaFailoverThread.doWork(OverseerAutoReplicaFailoverThread.java:150)
	at org.apache.solr.cloud.OverseerAutoReplicaFailoverThread.run(OverseerAutoReplicaFailoverThread.java:129)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.InterruptedException: sleep interrupted
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method)
	at org.apache.solr.common.cloud.ZkCmdExecutor.retryDelay(ZkCmdExecutor.java:108)
	at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:76)
	at org.apache.solr.common.cloud.SolrZkClient.exists(SolrZkClient.java:308)
	at org.apache.solr.common.cloud.ZkStateReader.getClusterProps(ZkStateReader.java:765)
	... 3 more

WARN  - 2015-04-01 17:28:51.110; org.apache.solr.cloud.ZkController$4; listener &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; error
org.apache.solr.common.SolrException: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /configs/foo/params.json
	at org.apache.solr.core.RequestParams.getFreshRequestParams(RequestParams.java:160)
	at org.apache.solr.core.SolrConfig.refreshRequestParams(SolrConfig.java:907)
	at org.apache.solr.core.SolrCore$11.run(SolrCore.java:2503)
	at org.apache.solr.cloud.ZkController$4.run(ZkController.java:2351)
Caused by: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /configs/foo/params.json
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:127)
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)
	at org.apache.zookeeper.ZooKeeper.exists(ZooKeeper.java:1045)
	at org.apache.solr.common.cloud.SolrZkClient$4.execute(SolrZkClient.java:294)
	at org.apache.solr.common.cloud.SolrZkClient$4.execute(SolrZkClient.java:291)
	at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:61)
	at org.apache.solr.common.cloud.SolrZkClient.exists(SolrZkClient.java:291)
	at org.apache.solr.core.RequestParams.getFreshRequestParams(RequestParams.java:150)
	... 3 more
ERROR - 2015-04-01 17:28:51.110; org.apache.solr.cloud.Overseer$ClusterStateUpdater; could not read the data
org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /overseer_elect/leader
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:127)
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)
	at org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1155)
	at org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:345)
	at org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:342)
	at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:61)
	at org.apache.solr.common.cloud.SolrZkClient.getData(SolrZkClient.java:342)
	at org.apache.solr.cloud.Overseer$ClusterStateUpdater.checkIfIamStillLeader(Overseer.java:298)
	at org.apache.solr.cloud.Overseer$ClusterStateUpdater.access$300(Overseer.java:83)
	at org.apache.solr.cloud.Overseer$ClusterStateUpdater$2.run(Overseer.java:259)
INFO  - 2015-04-01 17:28:51.114; org.apache.solr.common.cloud.ConnectionManager; Watcher org.apache.solr.common.cloud.ConnectionManager@5519dba0 name:ZooKeeperConnection Watcher:localhost:2181 got event WatchedEvent state:SyncConnected type:None path:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; type:None
INFO  - 2015-04-01 17:28:51.115; org.apache.solr.common.cloud.ConnectionManager; Client is connected to ZooKeeper
INFO  - 2015-04-01 17:28:51.115; org.apache.solr.common.cloud.ConnectionManager$1; Connection with ZooKeeper reestablished.
INFO  - 2015-04-01 17:28:51.115; org.apache.solr.cloud.ZkController$1; ZooKeeper session re-connected ... refreshing core states after session expiration.
INFO  - 2015-04-01 17:28:51.115; org.apache.solr.cloud.ZkController; publishing core=foo_shard1_replica1 state=down collection=foo
INFO  - 2015-04-01 17:28:51.118; org.apache.solr.cloud.ElectionContext; canceling election /overseer_elect/election/93579450724974592-192.168.1.2:8983_solr-n_0000000000
WARN  - 2015-04-01 17:28:51.119; org.apache.solr.cloud.ElectionContext; cancelElection did not find election node to remove /overseer_elect/election/93579450724974592-192.168.1.2:8983_solr-n_0000000000
INFO  - 2015-04-01 17:28:51.121; org.apache.solr.cloud.OverseerElectionContext; I am going to be the leader 192.168.1.2:8983_solr
INFO  - 2015-04-01 17:28:51.121; org.apache.solr.common.cloud.SolrZkClient; makePath: /overseer_elect/leader
INFO  - 2015-04-01 17:28:51.122; org.apache.solr.cloud.Overseer; Overseer (id=93579450724974594-192.168.1.2:8983_solr-n_0000000001) starting
INFO  - 2015-04-01 17:28:51.128; org.apache.solr.cloud.OverseerAutoReplicaFailoverThread; Starting OverseerAutoReplicaFailoverThread autoReplicaFailoverWorkLoopDelay=10000 autoReplicaFailoverWaitAfterExpiration=30000 autoReplicaFailoverBadNodeExpiration=60000
INFO  - 2015-04-01 17:28:51.128; org.apache.solr.cloud.OverseerCollectionProcessor; &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; current queue of collection creations
INFO  - 2015-04-01 17:28:51.128; org.apache.solr.common.cloud.ZkStateReader; Updating cluster state from ZooKeeper... 
INFO  - 2015-04-01 17:28:51.129; org.apache.solr.cloud.Overseer$ClusterStateUpdater; Starting to work on the main queue
INFO  - 2015-04-01 17:28:51.130; org.apache.solr.common.cloud.ZkStateReader; addZkWatch foo
INFO  - 2015-04-01 17:28:51.131; org.apache.solr.common.cloud.ZkStateReader; Updating collection state at /collections/foo/state.json from ZooKeeper... 
INFO  - 2015-04-01 17:28:51.131; org.apache.solr.common.cloud.ZkStateReader; Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; foo to ver 4 
INFO  - 2015-04-01 17:28:51.131; org.apache.solr.cloud.ZkController; Register node as live in ZooKeeper:/live_nodes/192.168.1.2:8983_solr
INFO  - 2015-04-01 17:28:51.132; org.apache.solr.common.cloud.SolrZkClient; makePath: /live_nodes/192.168.1.2:8983_solr
INFO  - 2015-04-01 17:28:51.133; org.apache.solr.cloud.ZkController; Register replica - core:foo_shard1_replica1 address:http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.2:8983/solr collection:foo shard:shard1
&lt;/span&gt;INFO  - 2015-04-01 17:28:51.133; org.apache.solr.common.cloud.ZkStateReader; Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; foo to ver 4 
INFO  - 2015-04-01 17:28:51.133; org.apache.solr.cloud.ElectionContext; canceling election /collections/foo/leader_elect/shard1/election/93579450724974592-core_node1-n_0000000000
WARN  - 2015-04-01 17:28:51.134; org.apache.solr.cloud.ElectionContext; cancelElection did not find election node to remove /collections/foo/leader_elect/shard1/election/93579450724974592-core_node1-n_0000000000
INFO  - 2015-04-01 17:28:51.134; org.apache.solr.cloud.Overseer$ClusterStateUpdater; processMessage: queueSize: 1, message = {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo_shard1_replica1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;core_node1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.2:8983/solr&quot;&lt;/span&gt;,
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;192.168.1.2:8983_solr&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;numShards&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;down&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;} current state version: 1
INFO  - 2015-04-01 17:28:51.135; org.apache.solr.cloud.overseer.ReplicaMutator; Update state numShards=1 message={
  &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo_shard1_replica1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;core_node1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.2:8983/solr&quot;&lt;/span&gt;,
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;192.168.1.2:8983_solr&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;numShards&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;down&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;}
INFO  - 2015-04-01 17:28:51.136; org.apache.solr.cloud.ShardLeaderElectionContext; Running the leader process &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; shard shard1
INFO  - 2015-04-01 17:28:51.136; org.apache.solr.cloud.overseer.ZkStateWriter; going to update_collection /collections/foo/state.json version: 4
INFO  - 2015-04-01 17:28:51.136; org.apache.solr.cloud.ActionThrottle; The last leader attempt started 198060ms ago.
INFO  - 2015-04-01 17:28:51.137; org.apache.solr.common.cloud.ZkStateReader$7; A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/foo/state.json &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection foo has occurred - updating... (live nodes size: 1)
INFO  - 2015-04-01 17:28:51.137; org.apache.solr.common.cloud.ZkStateReader; Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; foo to ver 5 
INFO  - 2015-04-01 17:28:51.138; org.apache.solr.cloud.DistributedQueue$LatchWatcher; NodeChildrenChanged fired on path /overseer/queue state SyncConnected
INFO  - 2015-04-01 17:28:51.138; org.apache.solr.cloud.ShardLeaderElectionContext; Enough replicas found to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;.
INFO  - 2015-04-01 17:28:51.138; org.apache.solr.cloud.ShardLeaderElectionContext; I may be the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; leader - &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and sync
INFO  - 2015-04-01 17:28:51.138; org.apache.solr.cloud.SyncStrategy; Sync replicas to http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.2:8983/solr/foo_shard1_replica1/
&lt;/span&gt;INFO  - 2015-04-01 17:28:51.138; org.apache.solr.cloud.SyncStrategy; Sync Success - now sync replicas to me
INFO  - 2015-04-01 17:28:51.138; org.apache.solr.cloud.SyncStrategy; http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.2:8983/solr/foo_shard1_replica1/ has no replicas
&lt;/span&gt;INFO  - 2015-04-01 17:28:51.139; org.apache.solr.cloud.ShardLeaderElectionContext; I am the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; leader: http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.2:8983/solr/foo_shard1_replica1/ shard1
&lt;/span&gt;INFO  - 2015-04-01 17:28:51.139; org.apache.solr.common.cloud.SolrZkClient; makePath: /collections/foo/leaders/shard1
INFO  - 2015-04-01 17:28:51.139; org.apache.solr.cloud.Overseer$ClusterStateUpdater; processMessage: queueSize: 1, message = {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;leader&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;} current state version: 1
INFO  - 2015-04-01 17:28:51.140; org.apache.solr.cloud.overseer.ZkStateWriter; going to update_collection /collections/foo/state.json version: 5
INFO  - 2015-04-01 17:28:51.141; org.apache.solr.common.cloud.ZkStateReader$7; A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/foo/state.json &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection foo has occurred - updating... (live nodes size: 1)
INFO  - 2015-04-01 17:28:51.142; org.apache.solr.cloud.DistributedQueue$LatchWatcher; NodeChildrenChanged fired on path /overseer/queue state SyncConnected
INFO  - 2015-04-01 17:28:51.142; org.apache.solr.common.cloud.ZkStateReader; Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; foo to ver 6 
INFO  - 2015-04-01 17:28:51.144; org.apache.solr.cloud.Overseer$ClusterStateUpdater; processMessage: queueSize: 1, message = {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;leader&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.2:8983/solr&quot;&lt;/span&gt;,
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo_shard1_replica1&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;} current state version: 1
INFO  - 2015-04-01 17:28:51.145; org.apache.solr.cloud.overseer.ZkStateWriter; going to update_collection /collections/foo/state.json version: 6
INFO  - 2015-04-01 17:28:51.145; org.apache.solr.common.cloud.ZkStateReader$7; A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/foo/state.json &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection foo has occurred - updating... (live nodes size: 1)
INFO  - 2015-04-01 17:28:51.146; org.apache.solr.common.cloud.ZkStateReader; Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; foo to ver 7 
INFO  - 2015-04-01 17:28:51.147; org.apache.solr.cloud.DistributedQueue$LatchWatcher; NodeChildrenChanged fired on path /overseer/queue state SyncConnected
INFO  - 2015-04-01 17:28:51.196; org.apache.solr.cloud.ZkController; We are http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.2:8983/solr/foo_shard1_replica1/ and leader is http://192.168.1.2:8983/solr/foo_shard1_replica1/
&lt;/span&gt;INFO  - 2015-04-01 17:28:51.196; org.apache.solr.cloud.ZkController; 

 In register, core.isReloaded? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; 


INFO  - 2015-04-01 17:28:51.199; org.apache.solr.common.cloud.ZkStateReader; Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; foo to ver 7 
INFO  - 2015-04-01 17:28:51.199; org.apache.solr.cloud.ZkController; watch zkdir /configs/foo
INFO  - 2015-04-01 17:28:51.199; org.apache.solr.schema.ZkIndexSchemaReader; Creating ZooKeeper watch &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the managed schema at /configs/foo/managed-schema
INFO  - 2015-04-01 17:28:51.199; org.apache.solr.cloud.ZkController$4; Running listeners &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /configs/foo
INFO  - 2015-04-01 17:28:51.200; org.apache.solr.core.SolrCore$11; config update listener called &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; core foo_shard1_replica1
INFO  - 2015-04-01 17:28:51.200; org.apache.solr.schema.ZkIndexSchemaReader; Current schema version 5 is already the latest
INFO  - 2015-04-01 17:28:51.200; org.apache.solr.schema.ZkIndexSchemaReader; Creating ZooKeeper watch &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the managed schema at /configs/foo/managed-schema
INFO  - 2015-04-01 17:28:51.200; org.apache.solr.core.SolrConfig; current version of requestparams : 0
INFO  - 2015-04-01 17:28:51.201; org.apache.solr.schema.ZkIndexSchemaReader; Current schema version 5 is already the latest
INFO  - 2015-04-01 17:28:51.201; org.apache.solr.common.cloud.DefaultConnectionStrategy; Reconnected to ZooKeeper
INFO  - 2015-04-01 17:28:51.202; org.apache.solr.common.cloud.ConnectionManager; Connected:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
INFO  - 2015-04-01 17:28:51.211; org.apache.solr.cloud.ZkController$WatcherImpl; A node got unwatched &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /configs/foo
INFO  - 2015-04-01 17:28:51.211; org.apache.solr.cloud.ZkController$4; Running listeners &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /configs/foo
INFO  - 2015-04-01 17:28:51.211; org.apache.solr.core.SolrCore$11; config update listener called &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; core foo_shard1_replica1
INFO  - 2015-04-01 17:28:51.212; org.apache.solr.core.SolrConfig; current version of requestparams : 0
INFO  - 2015-04-01 17:29:07.080; org.apache.solr.servlet.SolrDispatchFilter; [admin] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=/admin/cores params={indexInfo=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=json&amp;amp;_=1427909347078} status=0 QTime=0 
INFO  - 2015-04-01 17:29:07.112; org.apache.solr.servlet.SolrDispatchFilter; [admin] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=/admin/info/system params={wt=json&amp;amp;_=1427909347099} status=0 QTime=11 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12787411">SOLR-7338</key>
            <summary>A reloaded core will never register itself as active after a ZK session expiration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="thelabdude">Timothy Potter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Apr 2015 17:36:21 +0000</created>
                <updated>Mon, 9 May 2016 18:57:22 +0000</updated>
                            <resolved>Tue, 7 Apr 2015 21:16:37 +0000</resolved>
                                                    <fixVersion>5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14391258" author="thelabdude" created="Wed, 1 Apr 2015 19:09:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;but I don&apos;t understand what this flag is needed for anyway???&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, I wasn&apos;t clear ... I get the idea of having a flag to tell that a core is in the process of reloading, so that we can make various decisions about what to do with the tlogs, etc, however, I think that flag should be set back to false after a core is fully reloaded and active again, no? I can&apos;t see a reason why after a successful reload is complete, that flag should stay == true.&lt;/p&gt;</comment>
                            <comment id="14391279" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 19:26:20 +0000"  >&lt;p&gt;looks like some broken refactoring or something.&lt;/p&gt;

&lt;p&gt;Look at what it used to be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      UpdateLog ulog = core.getUpdateHandler().getUpdateLog();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!core.isReloaded() &amp;amp;&amp;amp; ulog != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        Future&amp;lt;UpdateLog.RecoveryInfo&amp;gt; recoveryFuture = core.getUpdateHandler()
            .getUpdateLog().recoverFromLog();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (recoveryFuture != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          recoveryFuture.get(); &lt;span class=&quot;code-comment&quot;&gt;// NOTE: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; could potentially block &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// minutes or more!
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// TODO: &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; as recovering in the mean time?
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// TODO: in the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; we could &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; peersync in parallel with recoverFromLog
&lt;/span&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;No LogReplay needed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; core=&quot;&lt;/span&gt;+core.getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; baseURL=&quot;&lt;/span&gt; + baseUrl);
        }
      }      
      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; didRecovery = checkRecovery(coreName, desc, recoverReloadedCores, isLeader, cloudDesc,
          collection, coreZkNodeName, shardId, leaderProps, core, cc);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!didRecovery) {
        publish(desc, ZkStateReader.ACTIVE);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14391284" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 19:29:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can&apos;t see a reason why after a successful reload is complete, that flag should stay == true.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why not? A reloaded core should never do various things like replay it&apos;s transaction log in register. I don&apos;t see how it makes any sense if it doesn&apos;t stay true. The core has either been reloaded before or it has not.&lt;/p&gt;</comment>
                            <comment id="14391292" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 19:33:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;looks like some broken refactoring or something.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Or an incomplete attempt at a bug fix. We also do not want to recover on a reload, so this is probably an incomplete attempt at fixing that. It just didn&apos;t take into account that we still need that ACTIVE publish.&lt;/p&gt;
</comment>
                            <comment id="14391301" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 19:40:36 +0000"  >&lt;p&gt;Okay, so, total story looks like:&lt;/p&gt;

&lt;p&gt;The isReloaded call was originally just used to prevent tlog replay other than on first startup.&lt;/p&gt;

&lt;p&gt;Recovery was always done, even on a reload.&lt;/p&gt;

&lt;p&gt;Later, it was noticed we should not be recovering on reload and the recovery check was also brought under isReloaded. &lt;/p&gt;

&lt;p&gt;This was not okay - the recovery check, unlike the tlog replay check, needs to know if this register attempt is the result of a reload - not if the core has ever been reloaded.&lt;/p&gt;

&lt;p&gt;We need a test that can catch this.&lt;/p&gt;</comment>
                            <comment id="14391329" author="thelabdude" created="Wed, 1 Apr 2015 19:57:53 +0000"  >&lt;p&gt;Thanks for digging that up. I still don&apos;t understand why we have to keep track of whether a core has ever been reloaded as part of the long term state of a core. Using a flag to decide that we don&apos;t need to replay the tlog after a reload, while the reloaded core is initializing is one thing, but what&apos;s the point of remembering core A has been reloaded at some point in the past after core A has fully initialized and become active? I guess my point is it seems like a temporary state and not part of the long term state of a core. But that&apos;s orthogonal to this issue anyway, so I&apos;ll fix the register code and add a test for this.&lt;/p&gt;</comment>
                            <comment id="14391470" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 21:10:20 +0000"  >&lt;p&gt;The flag is &quot;has this core been reloaded before&quot; - how is that a temporary state?&lt;/p&gt;

&lt;p&gt;That whole change I show above was indeed a bug. You can see that in checkRecovery, that is where we deal with skipping the recovery on a reloaded core. The calling code just got mangled.&lt;/p&gt;</comment>
                            <comment id="14391475" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 21:13:18 +0000"  >&lt;p&gt;A related bug is &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6583&quot; title=&quot;Resuming connection with ZooKeeper causes log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6583&quot;&gt;&lt;del&gt;SOLR-6583&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We should be skipping tlog replay on &apos;afterExpiration==true&apos; as well.&lt;/p&gt;</comment>
                            <comment id="14391503" author="thelabdude" created="Wed, 1 Apr 2015 21:33:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;The flag is &quot;has this core been reloaded before&quot; - how is that a temporary state?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not saying it&apos;s temporary, I&apos;m saying I can&apos;t see what possible value knowing that provides long term? I can see how that would be useful for reporting if it were a timestamp of some sort, such as last reloaded on, but a simple boolean makes no sense to me, nor do I see it being used anywhere in the code other than determining if things like tlog replay should be skipped while the core is initializing. Once it is fully active, the flag seems useless from either a reporting perspective or a state management perspective. But I think we&apos;ve wasted enough time on this one ...&lt;/p&gt;</comment>
                            <comment id="14391537" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 21:46:38 +0000"  >&lt;p&gt;I think this is a lot closer to how it&apos;s supposed to work, though I&apos;m sure it could all be cleaned up to be a little more clear.&lt;/p&gt;</comment>
                            <comment id="14391543" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 21:49:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m saying I can&apos;t see what possible value knowing that provides long term?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For example, the value it provides in the specific code we are talking about? If the core has been reloaded and its not afterExpiration, then it is a core reload register call. I don&apos;t understand how it doesn&apos;t provide value...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not saying it&apos;s temporary,&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But you said that a couple times...&lt;/p&gt;</comment>
                            <comment id="14391552" author="thelabdude" created="Wed, 1 Apr 2015 21:53:24 +0000"  >&lt;p&gt;whatever ... I also said several times I&apos;m talking about after register runs, not during ... of course I see value up until register happens, but you win &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14391557" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 21:57:37 +0000"  >&lt;p&gt;Also keep in mind, a reloaded SolrCore has differences from a non reloaded core as well - for example, a reloaded core did not create it&apos;s index writer or SolrCoreState like a new core does - it inherits them. &lt;/p&gt;</comment>
                            <comment id="14391559" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 21:59:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;I also said several times I&apos;m talking about after register runs, not during&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I guess I just don&apos;t understand that all. Being able to tell if a core is a reloaded core has absolutely nothing to do with register. Register just happens to use that call because it allows register to tell if the register is coming from a new core or a reloaded one.&lt;/p&gt;

&lt;p&gt;I am unable to spot the issue.&lt;/p&gt;</comment>
                            <comment id="14391567" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 22:05:24 +0000"  >&lt;p&gt;If you do a call hierarchy on the SolrCore#isReloaded call, you can find a couple other uses for it as well. It&apos;s just kind of info we have to know. I guess we could use a different method of figuring out what we want in register, but this call works, is available, and is generally necessary.&lt;/p&gt;</comment>
                            <comment id="14392603" author="yseeley@gmail.com" created="Thu, 2 Apr 2015 11:42:03 +0000"  >&lt;p&gt;Without looking at the code/patches &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I understand what Tim is saying, and agree.  &quot;isReloaded&quot; feels more like &quot;isReloading&quot; (i.e. it&apos;s state that is only temporarily used to make other decisions during initialization.)  I don&apos;t know how hard it would be to factor out though... prob not worth it.&lt;/p&gt;</comment>
                            <comment id="14392724" author="thelabdude" created="Thu, 2 Apr 2015 13:56:59 +0000"  >&lt;p&gt;Not sure if it&apos;s useful to you, but here&apos;s the unit test I started working on (basically implements the scenario I described in the issue description) ... it currently fails as expected until the register code is fixed up ... it passes with your patch applied though.&lt;/p&gt;</comment>
                            <comment id="14392763" author="markrmiller@gmail.com" created="Thu, 2 Apr 2015 14:32:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;&quot;isReloaded&quot; feels more like &quot;isReloading&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What&apos;s the gain, what&apos;s the point, what&apos;s the alternative?&lt;/p&gt;

&lt;p&gt;I don&apos;t get that at all. It tells you if the core has been reloaded. This is often useful in things that happen on creating a new SolrCore.&lt;/p&gt;

&lt;p&gt;Who cares about isReloading? I&apos;m lost.&lt;/p&gt;

&lt;p&gt;Is it just too difficult to understand what isReloaded means?&lt;/p&gt;

&lt;p&gt;I&apos;d be more confused with this temporary isReloading call - seems so easy for that to be tricky. isReloaded is so permanent and easy to understand. The core has been reloaded or it hasn&apos;t. How the heck does trying to track exactly when the core is actually in the process of reload or not more useful?&lt;/p&gt;

&lt;p&gt;Anyone else?&lt;/p&gt;</comment>
                            <comment id="14392770" author="markrmiller@gmail.com" created="Thu, 2 Apr 2015 14:38:54 +0000"  >&lt;p&gt;Anyway, we can spin that off into a new issue if someone wants to try and refactor it. I just don&apos;t yet get the impetus for it. Onlookers feel free to chime in here until/unless a new issue is made.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;but here&apos;s the unit test I started working on&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Cool.&lt;/p&gt;
</comment>
                            <comment id="14394640" author="thelabdude" created="Fri, 3 Apr 2015 16:16:06 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;, do you think anything else needs to be done on this one? I&apos;d actually like to get this into the 5.1 release - patch looks good to me. If you&apos;re comfortable with the unit test I posted, I can combine them and commit. Thanks.&lt;/p&gt;</comment>
                            <comment id="14394840" author="dsmiley" created="Fri, 3 Apr 2015 18:23:37 +0000"  >&lt;p&gt;Here&apos;s a question for you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;: If every core were to be reloaded, would that change anything?  What if I go and do that too all my cores.  Can we just assume that all cores may have been reloaded at some point in the past?  If we do assume that, we do we lose anything?  &amp;#8211; other than complexity &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14395200" author="markrmiller@gmail.com" created="Fri, 3 Apr 2015 22:45:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can combine them and commit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Go ahead. I think that&apos;s the right current fix and it also addresses &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6583&quot; title=&quot;Resuming connection with ZooKeeper causes log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6583&quot;&gt;&lt;del&gt;SOLR-6583&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14481319" author="jira-bot" created="Mon, 6 Apr 2015 15:42:14 +0000"  >&lt;p&gt;Commit 1671554 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1671554&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1671554&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7338&quot; title=&quot;A reloaded core will never register itself as active after a ZK session expiration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7338&quot;&gt;&lt;del&gt;SOLR-7338&lt;/del&gt;&lt;/a&gt;: A reloaded core will never register itself as active after a ZK session expiration, also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6583&quot; title=&quot;Resuming connection with ZooKeeper causes log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6583&quot;&gt;&lt;del&gt;SOLR-6583&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14481345" author="jira-bot" created="Mon, 6 Apr 2015 15:56:58 +0000"  >&lt;p&gt;Commit 1671562 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1671562&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1671562&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7338&quot; title=&quot;A reloaded core will never register itself as active after a ZK session expiration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7338&quot;&gt;&lt;del&gt;SOLR-7338&lt;/del&gt;&lt;/a&gt;: A reloaded core will never register itself as active after a ZK session expiration, also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6583&quot; title=&quot;Resuming connection with ZooKeeper causes log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6583&quot;&gt;&lt;del&gt;SOLR-6583&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14481364" author="jira-bot" created="Mon, 6 Apr 2015 16:14:27 +0000"  >&lt;p&gt;Commit 1671570 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_1&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1671570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1671570&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7338&quot; title=&quot;A reloaded core will never register itself as active after a ZK session expiration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7338&quot;&gt;&lt;del&gt;SOLR-7338&lt;/del&gt;&lt;/a&gt;: A reloaded core will never register itself as active after a ZK session expiration, also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6583&quot; title=&quot;Resuming connection with ZooKeeper causes log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6583&quot;&gt;&lt;del&gt;SOLR-6583&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14481910" author="markrmiller@gmail.com" created="Mon, 6 Apr 2015 20:51:51 +0000"  >&lt;p&gt;Given RecoveryZkTest and ChaosMonkey test fails I&apos;ve seen since this went in, I think it either broke something or exposed something.&lt;/p&gt;</comment>
                            <comment id="14481921" author="thelabdude" created="Mon, 6 Apr 2015 21:00:10 +0000"  >&lt;p&gt;good catch ... going to try to get the failure to reproduce locally now&lt;/p&gt;</comment>
                            <comment id="14482033" author="thelabdude" created="Mon, 6 Apr 2015 21:53:18 +0000"  >&lt;p&gt;running beast with 20 iters ... haven&apos;t been able to reproduce with 10 ... the logs from the failed test make it seem like the recovery process succeeded OK:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[junit4]   2&amp;gt; added docs:1022 with 0 fails deletes:510
   [junit4]   2&amp;gt; 956835 T6623 C:collection1 S:shard1 c:collection1 oasc.AbstractFullDistribZkTestBase.waitForThingsToLevelOut Wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; recoveries to finish - wait 120 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; each attempt
   [junit4]   2&amp;gt; 956836 T6623 C:collection1 S:shard1 c:collection1 oasc.AbstractDistribZkTestBase.waitForRecoveriesToFinish Wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; recoveries to finish - collection: collection1 failOnTimeout:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; timeout (sec):120
   [junit4]   2&amp;gt; 959842 T6734 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.RecoveryStrategy.doRecovery Attempting to PeerSync from http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10050/p_/z/collection1/ core=collection1 - recoveringAfterStartup=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/span&gt;   [junit4]   2&amp;gt; 959843 T6734 C:collection1 S:shard1 c:collection1 C1144 P10059 oasu.PeerSync.sync PeerSync: core=collection1 url=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z START replicas=[http://127.0.0.1:10050/p_/z/collection1/] nUpdates=100
&lt;/span&gt;   [junit4]   2&amp;gt; 959845 T6734 C:collection1 S:shard1 c:collection1 C1144 P10059 oasu.PeerSync.sync WARN no frame of reference to tell &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we&apos;ve missed updates
   [junit4]   2&amp;gt; 959846 T6734 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.RecoveryStrategy.doRecovery PeerSync Recovery was not successful - trying replication. core=collection1
   [junit4]   2&amp;gt; 959846 T6734 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.RecoveryStrategy.doRecovery Recovery was cancelled
   [junit4]   2&amp;gt; 959846 T6734 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.RecoveryStrategy.doRecovery Finished recovery process. core=collection1
   [junit4]   2&amp;gt; 959846 T6737 oasc.ActionThrottle.minimumWaitBetweenActions The last recovery attempt started 7015ms ago.
   [junit4]   2&amp;gt; 959846 T6737 oasc.ActionThrottle.minimumWaitBetweenActions Throttling recovery attempts - waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 2984ms
   [junit4]   2&amp;gt; 959847 T6672 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasc.SolrCore.execute [collection1] webapp=/p_/z path=/get params={version=2&amp;amp;getVersions=100&amp;amp;distrib=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;qt=/get&amp;amp;wt=javabin} status=0 QTime=1 
   [junit4]   2&amp;gt; 962833 T6739 C1144 P10059 oasc.RecoveryStrategy.run Starting recovery process.  core=collection1 recoveringAfterStartup=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
   [junit4]   2&amp;gt; 962834 T6739 C1144 P10059 oasc.RecoveryStrategy.doRecovery Publishing state of core collection1 as recovering, leader is http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10050/p_/z/collection1/ and I am http://127.0.0.1:10059/p_/z/collection1/
&lt;/span&gt;   [junit4]   2&amp;gt; 962834 T6739 C:collection1 c:collection1 C1144 P10059 oasc.ZkController.publish publishing core=collection1 state=recovering collection=collection1
   [junit4]   2&amp;gt; 962834 T6739 C:collection1 c:collection1 C1144 P10059 oasc.ZkController.publish numShards not found on descriptor - reading it from system property
   [junit4]   2&amp;gt; 962836 T6649 oasc.DistributedQueue$LatchWatcher.process NodeChildrenChanged fired on path /overseer/queue state SyncConnected
   [junit4]   2&amp;gt; 962837 T6650 oasc.Overseer$ClusterStateUpdater.run processMessage: queueSize: 1, message = {
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;core_node2&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;recovering&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z&quot;&lt;/span&gt;,
&lt;/span&gt;   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:10059_p_%2Fz&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;numShards&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;} current state version: 5
   [junit4]   2&amp;gt; 962837 T6650 oasco.ReplicaMutator.updateState Update state numShards=1 message={
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;core_node2&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;recovering&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z&quot;&lt;/span&gt;,
&lt;/span&gt;   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:10059_p_%2Fz&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;numShards&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;}
   [junit4]   2&amp;gt; 962837 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.RecoveryStrategy.sendPrepRecoveryCmd Sending prep recovery command to http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10050/p_/z; WaitForState: action=PREPRECOVERY&amp;amp;core=collection1&amp;amp;nodeName=127.0.0.1%3A10059_p_%252Fz&amp;amp;coreNodeName=core_node2&amp;amp;state=recovering&amp;amp;checkLive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;onlyIfLeader=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;onlyIfLeaderActive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/span&gt;   [junit4]   2&amp;gt; 962838 T6650 oasco.ZkStateWriter.writePendingUpdates going to update_collection /collections/collection1/state.json version: 10
   [junit4]   2&amp;gt; 962839 T6671 oasha.CoreAdminHandler.handleWaitForStateAction Going to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; coreNodeName: core_node2, state: recovering, checkLive: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, onlyIfLeader: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, onlyIfLeaderActive: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
   [junit4]   2&amp;gt; 962839 T6678 oascc.ZkStateReader$7.process A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/collection1/state.json &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection collection1 has occurred - updating... (live nodes size: 3)
   [junit4]   2&amp;gt; 962839 T6728 C:collection1 S:shard1 c:collection1 oascc.ZkStateReader$7.process A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/collection1/state.json &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection collection1 has occurred - updating... (live nodes size: 3)
   [junit4]   2&amp;gt; 962840 T6728 C:collection1 S:shard1 c:collection1 oascc.ZkStateReader.updateWatchedCollection Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection1 to ver 11 
   [junit4]   2&amp;gt; 962841 T6671 oascc.ZkStateReader.updateWatchedCollection Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection1 to ver 11 
   [junit4]   2&amp;gt; 962841 T6671 oasha.CoreAdminHandler.handleWaitForStateAction Will wait a max of 183 seconds to see collection1 (shard1 of collection1) have state: recovering
   [junit4]   2&amp;gt; 962842 T6678 oascc.ZkStateReader.updateWatchedCollection Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection1 to ver 11 
   [junit4]   2&amp;gt; 962842 T6671 oasha.CoreAdminHandler.handleWaitForStateAction In WaitForState(recovering): collection=collection1, shard=shard1, thisCore=collection1, leaderDoesNotNeedRecovery=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, isLeader? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, live=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, checkLive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, currentState=recovering, localState=active, nodeName=127.0.0.1:10059_p_%2Fz, coreNodeName=core_node2, onlyIfActiveCheckResult=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, nodeProps: core_node2:{&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;recovering&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:10059_p_%2Fz&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;}
&lt;/span&gt;   [junit4]   2&amp;gt; 962842 T6671 oasha.CoreAdminHandler.handleWaitForStateAction Waited coreNodeName: core_node2, state: recovering, checkLive: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, onlyIfLeader: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: 0 seconds.
   [junit4]   2&amp;gt; 962843 T6671 oass.SolrDispatchFilter.handleAdminRequest [admin] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=/admin/cores params={version=2&amp;amp;onlyIfLeader=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;checkLive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;coreNodeName=core_node2&amp;amp;state=recovering&amp;amp;nodeName=127.0.0.1:10059_p_%252Fz&amp;amp;onlyIfLeaderActive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;core=collection1&amp;amp;action=PREPRECOVERY&amp;amp;wt=javabin} status=0 QTime=5 
   [junit4]   2&amp;gt; 969843 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.RecoveryStrategy.doRecovery Attempting to PeerSync from http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10050/p_/z/collection1/ core=collection1 - recoveringAfterStartup=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;   [junit4]   2&amp;gt; 969844 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasu.PeerSync.sync PeerSync: core=collection1 url=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z START replicas=[http://127.0.0.1:10050/p_/z/collection1/] nUpdates=100
&lt;/span&gt;   [junit4]   2&amp;gt; 969847 T6672 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasc.SolrCore.execute [collection1] webapp=/p_/z path=/get params={version=2&amp;amp;getVersions=100&amp;amp;distrib=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;qt=/get&amp;amp;wt=javabin} status=0 QTime=0 
   [junit4]   2&amp;gt; 969848 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasu.PeerSync.handleVersions PeerSync: core=collection1 url=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z  Received 100 versions from http://127.0.0.1:10050/p_/z/collection1/
&lt;/span&gt;   [junit4]   2&amp;gt; 969849 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasu.PeerSync.handleVersions PeerSync: core=collection1 url=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z  Our versions are newer. ourLowThreshold=1497723899508424704 otherHigh=1497723899760082944
&lt;/span&gt;   [junit4]   2&amp;gt; 969849 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasu.PeerSync.sync PeerSync: core=collection1 url=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z DONE. sync succeeded
&lt;/span&gt;   [junit4]   2&amp;gt; 969849 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasu.DirectUpdateHandler2.commit start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt; 969865 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.SolrDeletionPolicy.onCommit SolrDeletionPolicy.onCommit: commits: num=2
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@e80270f lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@7f845138),segFN=segments_1,generation=1}
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@e80270f lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@7f845138),segFN=segments_2,generation=2}
   [junit4]   2&amp;gt; 969866 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.SolrDeletionPolicy.updateCommits newest commit generation = 2
   [junit4]   2&amp;gt; 969869 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oass.SolrIndexSearcher.&amp;lt;init&amp;gt; Opening Searcher@46806cf3[collection1] main
   [junit4]   2&amp;gt; 969869 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasu.DirectUpdateHandler2.commit end_commit_flush
   [junit4]   2&amp;gt; 969870 T6730 C:collection1 S:shard1 c:collection1 oasc.SolrCore.registerSearcher [collection1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@46806cf3[collection1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(5.2.0):C115/43:delGen=1) Uninverting(_1(5.2.0):C360/137:delGen=1)))}
   [junit4]   2&amp;gt; 969870 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.RecoveryStrategy.doRecovery PeerSync Recovery was successful - registering as Active. core=collection1
   [junit4]   2&amp;gt; 969871 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.ZkController.publish publishing core=collection1 state=active collection=collection1
   [junit4]   2&amp;gt; 969871 T6739 C:collection1 S:shard1 c:collection1 C1144 P10059 oasc.ZkController.publish numShards not found on descriptor - reading it from system property
   [junit4]   2&amp;gt; 969872 T6649 oasc.DistributedQueue$LatchWatcher.process NodeChildrenChanged fired on path /overseer/queue state SyncConnected
   [junit4]   2&amp;gt; 969874 T6650 oasc.Overseer$ClusterStateUpdater.run processMessage: queueSize: 1, message = {
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;core_node2&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z&quot;&lt;/span&gt;,
&lt;/span&gt;   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:10059_p_%2Fz&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;numShards&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;} current state version: 5
   [junit4]   2&amp;gt; 969875 T6650 oasco.ReplicaMutator.updateState Update state numShards=1 message={
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;core_node2&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z&quot;&lt;/span&gt;,
&lt;/span&gt;   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:10059_p_%2Fz&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt; 	  &lt;span class=&quot;code-quote&quot;&gt;&quot;numShards&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;}
   [junit4]   2&amp;gt; 969876 T6650 oasco.ZkStateWriter.writePendingUpdates going to update_collection /collections/collection1/state.json version: 11
   [junit4]   2&amp;gt; 969876 T6728 C:collection1 S:shard1 c:collection1 oascc.ZkStateReader$7.process A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/collection1/state.json &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection collection1 has occurred - updating... (live nodes size: 3)
   [junit4]   2&amp;gt; 969876 T6678 oascc.ZkStateReader$7.process A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/collection1/state.json &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection collection1 has occurred - updating... (live nodes size: 3)
   [junit4]   2&amp;gt; 969877 T6728 C:collection1 S:shard1 c:collection1 oascc.ZkStateReader.updateWatchedCollection Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection1 to ver 12 
   [junit4]   2&amp;gt; 969877 T6678 oascc.ZkStateReader.updateWatchedCollection Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection1 to ver 12 
   [junit4]   2&amp;gt; 970870 T6623 C:collection1 S:shard1 c:collection1 oasc.AbstractDistribZkTestBase.waitForRecoveriesToFinish Recoveries finished - collection: collection1
   [junit4]   2&amp;gt; 970873 T6638 C:control_collection S:shard1 R:core_node1 c:collection1 C1146 P10043 oasu.DirectUpdateHandler2.commit start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt; 970920 T6638 C:control_collection S:shard1 R:core_node1 c:collection1 C1146 P10043 oasc.SolrDeletionPolicy.onCommit SolrDeletionPolicy.onCommit: commits: num=2
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@25082424 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@397cca7a),segFN=segments_1,generation=1}
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@25082424 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@397cca7a),segFN=segments_2,generation=2}
   [junit4]   2&amp;gt; 970921 T6638 C:control_collection S:shard1 R:core_node1 c:collection1 C1146 P10043 oasc.SolrDeletionPolicy.updateCommits newest commit generation = 2
   [junit4]   2&amp;gt; 970924 T6638 C:control_collection S:shard1 R:core_node1 c:collection1 C1146 P10043 oass.SolrIndexSearcher.&amp;lt;init&amp;gt; Opening Searcher@1508b423[collection1] main
   [junit4]   2&amp;gt; 970925 T6638 C:control_collection S:shard1 R:core_node1 c:collection1 C1146 P10043 oasu.DirectUpdateHandler2.commit end_commit_flush
   [junit4]   2&amp;gt; 970926 T6654 C:control_collection c:collection1 oasc.SolrCore.registerSearcher [collection1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@1508b423[collection1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(5.2.0):C1303/622:delGen=1) Uninverting(_1(5.2.0):C740/398:delGen=1)))}
   [junit4]   2&amp;gt; 970926 T6638 C:control_collection S:shard1 R:core_node1 c:collection1 C1146 P10043 oasup.LogUpdateProcessor.finish [collection1] webapp=/p_/z path=/update params={version=2&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;} {commit=} 0 53
   [junit4]   2&amp;gt; 970931 T6668 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasu.DirectUpdateHandler2.commit start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt;  C1144_STATE=coll:collection1 core:collection1 props:{state=active, base_url=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10059/p_/z, node_name=127.0.0.1:10059_p_%2Fz, core=collection1}
&lt;/span&gt;   [junit4]   2&amp;gt; 970932 T6717 C:collection1 S:shard1 R:core_node2 c:collection1 C1144 P10059 oasu.DirectUpdateHandler2.commit start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
   [junit4]   2&amp;gt; 970933 T6717 C:collection1 S:shard1 R:core_node2 c:collection1 C1144 P10059 oasu.DirectUpdateHandler2.commit No uncommitted changes. Skipping IW.commit.
   [junit4]   2&amp;gt; 970933 T6717 C:collection1 S:shard1 R:core_node2 c:collection1 C1144 P10059 oasc.SolrCore.openNewSearcher SolrIndexSearcher has not changed - not re-opening: org.apache.solr.search.SolrIndexSearcher
   [junit4]   2&amp;gt; 970934 T6717 C:collection1 S:shard1 R:core_node2 c:collection1 C1144 P10059 oasu.DirectUpdateHandler2.commit end_commit_flush
   [junit4]   2&amp;gt; 970934 T6717 C:collection1 S:shard1 R:core_node2 c:collection1 C1144 P10059 oasup.LogUpdateProcessor.finish [collection1] webapp=/p_/z path=/update params={version=2&amp;amp;commit_end_point=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;update.distrib=FROMLEADER&amp;amp;openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;distrib.from=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10050/p_/z/collection1/&amp;amp;expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;} {commit=} 0 2
&lt;/span&gt;   [junit4]   2&amp;gt; 970978 T6668 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasc.SolrDeletionPolicy.onCommit SolrDeletionPolicy.onCommit: commits: num=2
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@5b80c596 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@632c29c8),segFN=segments_1,generation=1}
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@5b80c596 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@632c29c8),segFN=segments_2,generation=2}
   [junit4]   2&amp;gt; 970979 T6668 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasc.SolrDeletionPolicy.updateCommits newest commit generation = 2
   [junit4]   2&amp;gt; 970982 T6668 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oass.SolrIndexSearcher.&amp;lt;init&amp;gt; Opening Searcher@4273e191[collection1] main
   [junit4]   2&amp;gt; 970983 T6668 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasu.DirectUpdateHandler2.commit end_commit_flush
   [junit4]   2&amp;gt; 970983 T6680 C:collection1 c:collection1 oasc.SolrCore.registerSearcher [collection1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@4273e191[collection1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_0(5.2.0):C861/415:delGen=1) Uninverting(_1(5.2.0):C1182/605:delGen=1)))}
   [junit4]   2&amp;gt; 970984 T6668 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasup.LogUpdateProcessor.finish [collection1] webapp=/p_/z path=/update params={version=2&amp;amp;commit_end_point=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;update.distrib=FROMLEADER&amp;amp;openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;distrib.from=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10050/p_/z/collection1/&amp;amp;expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;} {commit=} 0 53
&lt;/span&gt;   [junit4]   2&amp;gt; 970986 T6670 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasup.LogUpdateProcessor.finish [collection1] webapp=/p_/z path=/update params={version=2&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;_stateVer_=collection1:6&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;} {commit=} 0 57
   [junit4]   2&amp;gt; 970991 T6666 C:collection1 S:shard1 R:core_node1 c:collection1 C1145 P10050 oasc.SolrCore.execute [collection1] webapp=/p_/z path=/select params={version=2&amp;amp;tests=checkShardConsistency&amp;amp;distrib=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;rows=0&amp;amp;q=*:*&amp;amp;wt=javabin} hits=1023 status=0 QTime=1 
   [junit4]   2&amp;gt; 970993 T6721 C:collection1 S:shard1 R:core_node2 c:collection1 C1144 P10059 oasc.SolrCore.execute [collection1] webapp=/p_/z path=/select params={version=2&amp;amp;tests=checkShardConsistency&amp;amp;distrib=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;rows=0&amp;amp;q=*:*&amp;amp;wt=javabin} hits=295 status=0 QTime=0 
   [junit4]   2&amp;gt; 970994 T6623 C:collection1 S:shard1 c:collection1 oasc.AbstractFullDistribZkTestBase.waitForThingsToLevelOut shard inconsistency - waiting ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14482068" author="thelabdude" created="Mon, 6 Apr 2015 22:15:01 +0000"  >&lt;p&gt;hmmm ... no failures with -Dbeast.iters=20 either ... not much jumping out at me in the logs either. The replica with missing data definitely received the update that is being reported at the end of the test as missing, for instance:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;###### Only in http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10050/p_/z/collection1: [{_version_=1497723893329166337, id=2-472}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but earlier in the logs, we see:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[junit4]   2&amp;gt; 949616 T6637 C:control_collection S:shard1 R:core_node1 c:collection1 C1136 P10043 oasup.LogUpdateProcessor.finish [collection1] webapp=/p_/z path=/update params={version=2&amp;amp;CONTROL=TRUE&amp;amp;wt=javabin} {add=[2-472 (1497723893326020609)]} 0 0
   [junit4]   2&amp;gt; 949621 T6686 C:collection1 S:shard1 R:core_node2 c:collection1 C1134 P10059 oasup.LogUpdateProcessor.finish [collection1] webapp=/p_/z path=/update params={version=2&amp;amp;update.distrib=FROMLEADER&amp;amp;distrib.from=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:10050/p_/z/collection1/&amp;amp;wt=javabin} {add=[2-472 (1497723893329166337)]} 0 0
&lt;/span&gt;   [junit4]   2&amp;gt; 949622 T6670 C:collection1 S:shard1 R:core_node1 c:collection1 C1135 P10050 oasup.LogUpdateProcessor.finish [collection1] webapp=/p_/z path=/update params={version=2&amp;amp;wt=javabin} {add=[2-472 (1497723893329166337)]} 0 3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I used the same seed as the failed build as well - FBFBECE5D5AABA29&lt;/p&gt;

&lt;p&gt;You see anything on your side &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14482127" author="markrmiller@gmail.com" created="Mon, 6 Apr 2015 22:51:04 +0000"  >&lt;p&gt;A lot of my ChaosMonkey test runs on my local jenkins machine starting failing after that commit. I have not had a chance to dig into the logs yet though.&lt;/p&gt;</comment>
                            <comment id="14482399" author="markrmiller@gmail.com" created="Tue, 7 Apr 2015 01:51:54 +0000"  >&lt;p&gt;May have been coincidental fails (still, bad new(ish) replicas out of sync fails) - I&apos;ll spend some time tomorrow looking closer and post what I find or close this issue again. &lt;/p&gt;</comment>
                            <comment id="14482493" author="thelabdude" created="Tue, 7 Apr 2015 02:59:46 +0000"  >&lt;p&gt;Ok cool - I have RC built for 5.1 with this fix in, but will do it if needed ... can&apos;t get it to reproduce with 50 beasts!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant beast -Dbeast.iters=50  -Dtestcase=RecoveryZkTest -Dtests.method=test -Dtests.seed=FBFBECE5D5AABA29 -Dtests.multiplier=2 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=ar_SD -Dtests.timezone=America/Marigot -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=US-ASCII
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14484005" author="thelabdude" created="Tue, 7 Apr 2015 20:40:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; I don&apos;t think the RecoveryZkTest failure is due to this ticket as it failed in a similar fashion prior to that commit:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Tests-5.x-Java7/2888/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Tests-5.x-Java7/2888/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve actually beast&apos;d that test with 5.1 100 times w/o failure so I&apos;d like to move forward with the RC candidate I&apos;ve already built and staged unless you advise otherwise &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14484013" author="markrmiller@gmail.com" created="Tue, 7 Apr 2015 20:45:38 +0000"  >&lt;p&gt;Same status as yesterday - I&apos;ll look into this today.&lt;/p&gt;</comment>
                            <comment id="14484064" author="markrmiller@gmail.com" created="Tue, 7 Apr 2015 21:16:37 +0000"  >&lt;p&gt;Okay - I&apos;ve looked through my Jenkins logs. There are some concerning new fails, but just looks like coincidence that they and the regular jenkins &apos;replica out of sync&apos; popped up together after this commit. Nothing to indicate an ongoing problem started by this commit looking deeper.&lt;/p&gt;</comment>
                            <comment id="14495382" author="thelabdude" created="Wed, 15 Apr 2015 00:30:53 +0000"  >&lt;p&gt;Bulk close after 5.1 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12745704">SOLR-6583</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12708813" name="SOLR-7338.patch" size="2766" author="markrmiller@gmail.com" created="Wed, 1 Apr 2015 21:46:38 +0000"/>
                            <attachment id="12708985" name="SOLR-7338_test.patch" size="8673" author="thelabdude" created="Thu, 2 Apr 2015 13:56:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27nlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>