<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:35:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12868] Request forwarding for v2 API is broken</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12868</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I was working with Noble Paul to investigate test failures seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12806&quot; title=&quot;when strict=false is specified, prioritize node allocation using non strict rules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12806&quot;&gt;&lt;del&gt;SOLR-12806&lt;/del&gt;&lt;/a&gt; where we found this issue. Due to a bug, replicas of a collection weren&apos;t spread evenly so there were some nodes which did not have any replicas at all. In such cases, when a v2 API call hits an empty node, it is not forwarded to the right path on the remote node causing test failures.&lt;/p&gt;

&lt;p&gt;e.g. a call to &lt;tt&gt;/c/collection/_introspect&lt;/tt&gt; is forwarded as &lt;tt&gt;&lt;a href=&quot;http://127.0.0.1:63326/solr/collection1/_introspect?method=POST&amp;amp;wt=javabin&amp;amp;version=2&amp;amp;command=XXXX&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://127.0.0.1:63326/solr/collection1/_introspect?method=POST&amp;amp;wt=javabin&amp;amp;version=2&amp;amp;command=XXXX&lt;/a&gt;&lt;/tt&gt; and &lt;tt&gt;/c/collection1/abccdef&lt;/tt&gt; is forwarded as &lt;tt&gt;&lt;a href=&quot;http://127.0.0.1:63326/solr/collection1/abccdef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://127.0.0.1:63326/solr/collection1/abccdef&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;In summary, a remote query for v2 API from an empty node is converted to a v1 style call which may not be a valid path. We should forward v2 API calls as-is without changing the paths.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13191504">SOLR-12868</key>
            <summary>Request forwarding for v2 API is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Oct 2018 07:15:07 +0000</created>
                <updated>Wed, 10 Nov 2021 12:08:16 +0000</updated>
                            <resolved>Wed, 10 Nov 2021 12:08:16 +0000</resolved>
                                                    <fixVersion>7.6</fixVersion>
                                    <component>SolrCloud</component>
                    <component>v2 API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16664524" author="jira-bot" created="Fri, 26 Oct 2018 01:51:04 +0000"  >&lt;p&gt;Commit f33be7a172d7b4596530d8cb925ba6dd1f1f53f0 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f33be7a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f33be7a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12868&quot; title=&quot;Request forwarding for v2 API is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12868&quot;&gt;&lt;del&gt;SOLR-12868&lt;/del&gt;&lt;/a&gt;: Request forwarding for v2 API is broken&lt;/p&gt;</comment>
                            <comment id="16664526" author="jira-bot" created="Fri, 26 Oct 2018 01:51:59 +0000"  >&lt;p&gt;Commit 329252fb9e5fbf0f8bba64cc320e34de4b83fa81 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=329252f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=329252f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12868&quot; title=&quot;Request forwarding for v2 API is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12868&quot;&gt;&lt;del&gt;SOLR-12868&lt;/del&gt;&lt;/a&gt;: Request forwarding for v2 API is broken&lt;/p&gt;</comment>
                            <comment id="16665342" author="steve_rowe" created="Fri, 26 Oct 2018 15:59:45 +0000"  >&lt;p&gt;As of commit &lt;tt&gt;f33be7a&lt;/tt&gt; on this issue, &lt;tt&gt;TestV2Request&lt;/tt&gt; is failing nearly 100% of the time, e.g. from &lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Windows/7585&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Windows/7585&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Checking out Revision f33be7a172d7b4596530d8cb925ba6dd1f1f53f0 (refs/remotes/origin/master)
[...]
   [junit4] Suite: org.apache.solr.client.solrj.request.TestV2Request
[...]
   [junit4]   1&amp;gt; livenodes: [127.0.0.1:61086_solr, 127.0.0.1:61091_solr, 127.0.0.1:61096_solr, 127.0.0.1:61105_solr]
   [junit4]   1&amp;gt; 04:51:45.352 [qtp14589558-428] ERROR org.apache.solr.api.V2HttpCall - &amp;gt;&amp;gt; path: &apos;/c/_introspect&apos;
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestV2Request -Dtests.method=testHttpSolrClient -Dtests.seed=F4038E7A593F7B4D -Dtests.slow=true -Dtests.locale=lv -Dtests.timezone=America/Winnipeg -Dtests.asserts=true -Dtests.file.encoding=Cp1252
   [junit4] FAILURE 6.31s J0 | TestV2Request.testHttpSolrClient &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;0&amp;gt; but was:&amp;lt;1&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([F4038E7A593F7B4D:2C1B9650F80B696A]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.request.TestV2Request.doTest(TestV2Request.java:105)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.request.TestV2Request.testHttpSolrClient(TestV2Request.java:70)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
   [junit4]   1&amp;gt; 04:51:51.726 [qtp4981319-439] ERROR org.apache.solr.api.V2HttpCall - &amp;gt;&amp;gt; path: &apos;/c/_introspect&apos;
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestV2Request -Dtests.method=testCloudSolrClient -Dtests.seed=F4038E7A593F7B4D -Dtests.slow=true -Dtests.locale=lv -Dtests.timezone=America/Winnipeg -Dtests.asserts=true -Dtests.file.encoding=Cp1252
   [junit4] FAILURE 6.02s J0 | TestV2Request.testCloudSolrClient &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;0&amp;gt; but was:&amp;lt;1&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([F4038E7A593F7B4D:6DF505CAFC8CF326]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.request.TestV2Request.doTest(TestV2Request.java:105)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.request.TestV2Request.testCloudSolrClient(TestV2Request.java:77)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
   [junit4]   1&amp;gt; 04:51:53.783 [SUITE-TestV2Request-seed#[F4038E7A593F7B4D]-worker] ERROR org.apache.zookeeper.server.ZooKeeperServer - ZKShutdownHandler is not registered, so ZooKeeper server won&apos;t take any action on ERROR or SHUTDOWN server state changes
   [junit4]   2&amp;gt; NOTE: leaving temporary files on disk at: C:\Users\jenkins\workspace\Lucene-Solr-master-Windows\solr\build\solr-solrj\test\J0\temp\solr.client.solrj.request.TestV2Request_F4038E7A593F7B4D-001
   [junit4]   2&amp;gt; Oct 26, 2018 4:51:53 AM com.carrotsearch.randomizedtesting.ThreadLeakControl checkThreadLeaks
   [junit4]   2&amp;gt; WARNING: Will linger awaiting termination of 10 leaked thread(s).
   [junit4]   2&amp;gt; Oct 26, 2018 4:53:13 AM com.carrotsearch.randomizedtesting.ThreadLeakControl checkThreadLeaks
   [junit4]   2&amp;gt; SEVERE: 1 thread leaked from SUITE scope at org.apache.solr.client.solrj.request.TestV2Request: 
   [junit4]   2&amp;gt;    1) Thread[id=550, name=Connection evictor, state=TIMED_WAITING, group=TGRP-TestV2Request]
   [junit4]   2&amp;gt;         at java.lang.Thread.sleep(Native Method)
   [junit4]   2&amp;gt;         at org.apache.http.impl.client.IdleConnectionEvictor$1.run(IdleConnectionEvictor.java:66)
   [junit4]   2&amp;gt;         at java.lang.Thread.run(Thread.java:748)
   [junit4]   2&amp;gt; Oct 26, 2018 4:53:13 AM com.carrotsearch.randomizedtesting.ThreadLeakControl tryToInterruptAll
   [junit4]   2&amp;gt; INFO: Starting to interrupt leaked threads:
   [junit4]   2&amp;gt;    1) Thread[id=550, name=Connection evictor, state=TIMED_WAITING, group=TGRP-TestV2Request]
   [junit4]   2&amp;gt; Oct 26, 2018 4:53:13 AM com.carrotsearch.randomizedtesting.ThreadLeakControl tryToInterruptAll
   [junit4]   2&amp;gt; INFO: All leaked threads terminated.
   [junit4]   2&amp;gt; NOTE: test params are: codec=CheapBastard, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@1e6d741), locale=lv, timezone=America/Winnipeg
   [junit4]   2&amp;gt; NOTE: Windows 10 10.0 x86/Oracle Corporation 1.8.0_172 (32-bit)/cpus=3,threads=1,free=87644232,total=185597952
   [junit4]   2&amp;gt; NOTE: All tests run in this JVM: [TestFastWriter, CollectionAdminRequestRequiredParamsTest, UniformDistributionEvaluatorTest, ArcCosineEvaluatorTest, LessThanEqualToEvaluatorTest, SolrExampleEmbeddedTest, TestTimeSource, TestXMLEscaping, GraphExpressionTest, DivideEvaluatorTest, CloudSolrClientBuilderTest, AscEvaluatorTest, FieldAnalysisResponseTest, TestV2Request]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestV2Request -Dtests.seed=F4038E7A593F7B4D -Dtests.slow=true -Dtests.locale=lv -Dtests.timezone=America/Winnipeg -Dtests.asserts=true -Dtests.file.encoding=Cp1252
   [junit4] ERROR   0.00s J0 | TestV2Request (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.client.solrj.request.TestV2Request: 
   [junit4]    &amp;gt;    1) Thread[id=550, name=Connection evictor, state=TIMED_WAITING, group=TGRP-TestV2Request]
   [junit4]    &amp;gt;         at java.lang.Thread.sleep(Native Method)
   [junit4]    &amp;gt;         at org.apache.http.impl.client.IdleConnectionEvictor$1.run(IdleConnectionEvictor.java:66)
   [junit4]    &amp;gt;         at java.lang.Thread.run(Thread.java:748)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([F4038E7A593F7B4D]:0)
   [junit4] Completed [67/162 (1!)] on J0 in 97.96s, 4 tests, 2 failures, 1 error &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16665783" author="jira-bot" created="Sat, 27 Oct 2018 00:11:20 +0000"  >&lt;p&gt;Commit 575d3dac0ff12bc66e4cd7a211661307d43f3348 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=575d3da&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=575d3da&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12868&quot; title=&quot;Request forwarding for v2 API is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12868&quot;&gt;&lt;del&gt;SOLR-12868&lt;/del&gt;&lt;/a&gt;: test was making wrong assumption&lt;/p&gt;</comment>
                            <comment id="16665785" author="jira-bot" created="Sat, 27 Oct 2018 00:12:13 +0000"  >&lt;p&gt;Commit a298802516ad3e4ff7445ea0ccbbc06b150042fd in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a298802&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a298802&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12868&quot; title=&quot;Request forwarding for v2 API is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12868&quot;&gt;&lt;del&gt;SOLR-12868&lt;/del&gt;&lt;/a&gt;: test was making wrong assumption&lt;/p&gt;</comment>
                            <comment id="16744568" author="ctargett" created="Thu, 17 Jan 2019 00:44:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;, here&apos;s &lt;b&gt;another&lt;/b&gt; issue that appears in CHANGES.txt for 7.6 but isn&apos;t marked as resolved. Can it be resolved?&lt;/p&gt;

&lt;p&gt;It seems to happen frequently that we find issues that should have been resolved months ago. Any way you could modify the way you work with issues so these are resolved closer to the time of your commits, like the rest of us do?&lt;/p&gt;</comment>
                            <comment id="16845149" author="ctargett" created="Tue, 21 May 2019 19:00:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; - please see my earlier comment about this appearing in 7.6 CHANGES. Is it resolved? Since the RM process automatically bumps versions, this now appears as though it&apos;s slated to be in 8.2, although from what I can tell - but can&apos;t be sure - it seems this was fixed in 7.6.&lt;/p&gt;</comment>
                            <comment id="17434549" author="gerlowskija" created="Tue, 26 Oct 2021 20:11:11 +0000"  >&lt;p&gt;Gentle reminder to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; to close this out assuming there&apos;s nothing outstanding to be done here.&lt;/p&gt;</comment>
                            <comment id="17441698" author="gerlowskija" created="Wed, 10 Nov 2021 12:08:07 +0000"  >&lt;p&gt;Closing this out, since V2 requests (seem to) no longer suffer from this bug.&#160; Please make sure to close out your tickets in the future &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3z6m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>