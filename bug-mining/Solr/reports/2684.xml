<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:08:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8192] SubFacets allBuckets  not woring with measures on tokenized fields</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8192</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Subfacets are not working when you ask for allBuckets on a tokenized fields with measures&lt;br/&gt;
Here is the request:&lt;br/&gt;
{&lt;br/&gt;
  hs: {&lt;br/&gt;
    field: hs,&lt;br/&gt;
    type: terms,&lt;br/&gt;
     allBuckets:true,&lt;br/&gt;
    sort: &quot;mostrar_bill_price desc&quot;,&lt;br/&gt;
    facet:&lt;/p&gt;
{
      mostrar_bill_price: &quot;sum(mostrar_bill_price)&quot;
    }
&lt;p&gt;  }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Here is the response:&lt;br/&gt;
{&lt;br/&gt;
&quot;responseHeader&quot;: {&lt;br/&gt;
&quot;status&quot;: 500,&lt;br/&gt;
&quot;QTime&quot;: 92,&lt;br/&gt;
&quot;params&quot;: {&lt;br/&gt;
&quot;indent&quot;: &quot;true&quot;,&lt;br/&gt;
&quot;q&quot;: &quot;&lt;b&gt;:&lt;/b&gt;&quot;,&lt;br/&gt;
&quot;json.facet&quot;: &quot;{ hs: { field: hs, type: terms, allBuckets:true, sort: \&quot;mostrar_bill_price desc\&quot;, facet:&lt;/p&gt;
{ mostrar_bill_price: \&quot;sum(mostrar_bill_price)\&quot; }
&lt;p&gt; } }&quot;,&lt;br/&gt;
&quot;wt&quot;: &quot;json&quot;,&lt;br/&gt;
&quot;rows&quot;: &quot;0&quot;&lt;br/&gt;
}&lt;br/&gt;
},&lt;br/&gt;
&quot;response&quot;: {&lt;br/&gt;
&quot;numFound&quot;: 35422188,&lt;br/&gt;
&quot;start&quot;: 0,&lt;br/&gt;
&quot;docs&quot;: []&lt;br/&gt;
},&lt;br/&gt;
&quot;error&quot;: {&lt;br/&gt;
&quot;trace&quot;: &quot;java.lang.ArrayIndexOutOfBoundsException\n&quot;,&lt;br/&gt;
&quot;code&quot;: 500&lt;br/&gt;
}&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;hs fields is defined as:&lt;br/&gt;
&amp;lt;field name=&quot;hs&quot; type=&quot;text_ws&quot; indexed=&quot;true&quot; stored=&quot;false&quot; required=&quot;false&quot; multiValued=&quot;false&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;mostrar_bill_price is defined as:&lt;br/&gt;
 &amp;lt;field name=&quot;mostrar_bill_price&quot; type=&quot;tdouble&quot; indexed=&quot;true&quot; stored=&quot;false&quot; required=&quot;false&quot; multiValued=&quot;false&quot; /&amp;gt;&lt;/p&gt;


&lt;p&gt;A part from text_ws, it also happens with text_classic (these are the only ones I&apos;ve tested it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12907430">SOLR-8192</key>
            <summary>SubFacets allBuckets  not woring with measures on tokenized fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="anzorena.fing@gmail.com">Pablo Anzorena</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Oct 2015 14:59:00 +0000</created>
                <updated>Tue, 15 Dec 2015 13:54:53 +0000</updated>
                            <resolved>Sun, 25 Oct 2015 20:16:04 +0000</resolved>
                                                    <fixVersion>5.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14972263" author="yseeley@gmail.com" created="Sat, 24 Oct 2015 01:46:49 +0000"  >&lt;p&gt;Thanks Pablo, I&apos;ve reproduced this issue and am looking into a fix.&lt;/p&gt;</comment>
                            <comment id="14973376" author="yseeley@gmail.com" created="Sun, 25 Oct 2015 18:41:40 +0000"  >&lt;p&gt;Here&apos;s a patch that fixes the issue, as well as &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8206&quot; title=&quot;facet limit:0 doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8206&quot;&gt;&lt;del&gt;SOLR-8206&lt;/del&gt;&lt;/a&gt;, which I discovered while investigating this.&lt;/p&gt;</comment>
                            <comment id="14973381" author="jira-bot" created="Sun, 25 Oct 2015 18:50:13 +0000"  >&lt;p&gt;Commit 1710476 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1710476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1710476&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8192&quot; title=&quot;SubFacets allBuckets  not woring with measures on tokenized fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8192&quot;&gt;&lt;del&gt;SOLR-8192&lt;/del&gt;&lt;/a&gt;: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8206&quot; title=&quot;facet limit:0 doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8206&quot;&gt;&lt;del&gt;SOLR-8206&lt;/del&gt;&lt;/a&gt;: fix allBuckets for multi-valued fields, fix limit:0 and normalize offset to 0 when limit==0&lt;/p&gt;</comment>
                            <comment id="14973401" author="anzorena.fing@gmail.com" created="Sun, 25 Oct 2015 19:35:21 +0000"  >&lt;p&gt;Excellent!&lt;/p&gt;

&lt;p&gt;One more thing, is there any performance improvement(response time) when you ask for two subfacets on the same request (i.e. ask for subfacets on dimension1 and dimension 2, where q=banana)? Or is it better to ask for subfacets on dimension1, where q=banana and another simultaneous subfacets request on dimension2, where q=banana?&lt;br/&gt;
I&apos;ve made some tests, and the second option is better than the first one, in terms of response time.  But I would like to hear your opinion.&lt;/p&gt;

&lt;p&gt;Thank you very much.&lt;/p&gt;
</comment>
                            <comment id="14973410" author="jira-bot" created="Sun, 25 Oct 2015 19:54:45 +0000"  >&lt;p&gt;Commit 1710480 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1710480&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1710480&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8192&quot; title=&quot;SubFacets allBuckets  not woring with measures on tokenized fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8192&quot;&gt;&lt;del&gt;SOLR-8192&lt;/del&gt;&lt;/a&gt;: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8206&quot; title=&quot;facet limit:0 doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8206&quot;&gt;&lt;del&gt;SOLR-8206&lt;/del&gt;&lt;/a&gt;: fix allBuckets for multi-valued fields, fix limit:0 and normalize offset to 0 when limit==0&lt;/p&gt;</comment>
                            <comment id="14973430" author="yseeley@gmail.com" created="Sun, 25 Oct 2015 20:29:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;One more thing, is there any performance improvement(response time) when you ask for two subfacets on the same request (i.e. ask for subfacets on dimension1 and dimension 2, where q=banana)? Or is it better to ask for subfacets on dimension1, where q=banana and another simultaneous subfacets request on dimension2, where q=banana?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When you say &quot;simultaneous&quot;, are you issuing two completely separate Solr requests at the same time? If so, that&apos;s less efficient and causes more work for the system over all, but it can currently lower latency because of the parallelism that is introduced (the faceting code is currently single threaded... only one thread will be used per request).&lt;/p&gt;

&lt;p&gt;We should really develop multi-threaded faceting code!&lt;/p&gt;</comment>
                            <comment id="14973438" author="anzorena.fing@gmail.com" created="Sun, 25 Oct 2015 21:07:00 +0000"  >&lt;p&gt;Yes, I was talking about two independent processes.&lt;/p&gt;

&lt;p&gt;It would be fantastic to have multi-threaded subfacets!&lt;/p&gt;

&lt;p&gt;The core idea would be to get all the documents that matched the query, and then one thread per request?&lt;/p&gt;

&lt;p&gt;Speaking from my ignorance, nowadays in the single threaded version, can&apos;t you take any advantage when you iterate the documents that matched the query and get the values on dimension1 and dimension2 on the same iteration?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12768620" name="SOLR-8192.patch" size="5986" author="yseeley@gmail.com" created="Sun, 25 Oct 2015 18:41:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nfun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>