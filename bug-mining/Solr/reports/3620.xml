<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:27:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11164] OriginalScoreFeature causes NullPointerException during feature logging with SolrCloud mode.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11164</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In FeatureTransfer, OriginalScoreFeature uses original Query instance preserved in LTRScoringQuery for the evaluation.&lt;br/&gt;
This query is set in RankQuery#wrap during QueryComponent#process.&lt;/p&gt;

&lt;p&gt;With SolrCloud mode, document searches take two steps: finding top-N document ids, and filling documents of found ids.&lt;br/&gt;
In this case, FeatureTransformer works in the second step and tries to extract features with LTRScoringQuery built in QueryComponent#prepare.&lt;br/&gt;
However, because the second step doesn&apos;t call QueryComponent#process, the original query of LTRScoringQuery remains null and this causes NullPointerException while evaluating OriginalScoreFeature.&lt;/p&gt;

&lt;p&gt;We can get the original query from ResultContext which is an argument of DocTransformer#setContext, thus this problem can solve by using it if LTRScoringQuery doesn&apos;t have correct original query.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13090677">SOLR-11164</key>
            <summary>OriginalScoreFeature causes NullPointerException during feature logging with SolrCloud mode.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpoerschke">Christine Poerschke</assignee>
                                    <reporter username="yuyano">Yuki Yano</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Jul 2017 03:14:29 +0000</created>
                <updated>Sat, 8 Jun 2019 15:20:21 +0000</updated>
                            <resolved>Fri, 25 Aug 2017 14:52:41 +0000</resolved>
                                    <version>6.6</version>
                                    <fixVersion>7.1</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>contrib - LTR</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16117235" author="jonathan gv" created="Mon, 7 Aug 2017 20:46:46 +0000"  >&lt;p&gt;I have tested the provided patch, despite it is indeed returning a score, it is not the score from the original query.  Having said that, it will return the calculation of the 2nd phase query, while doing the re-ranking applying the model, rather than the original query.&lt;/p&gt;</comment>
                            <comment id="16117698" author="yuyano" created="Tue, 8 Aug 2017 01:29:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Jonathan+GV&quot; class=&quot;user-hover&quot; rel=&quot;Jonathan GV&quot;&gt;Jonathan GV&lt;/a&gt;&lt;br/&gt;
Thank you for testing the patch! As you say, it will return the calculation of the 2nd phase query. However, in my understanding, this query is built from the parameter of &quot;q&quot; and thus it should be same as 1st phase query.&lt;/p&gt;

&lt;p&gt;Details are as below. In short, both 1st phase request and 2nd phase request have same &quot;q&quot; parameter and it will be set to &lt;tt&gt;ResultContext&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;1. &lt;tt&gt;OriginalScoreFeature&lt;/tt&gt; uses &lt;tt&gt;rb.getQuery()&lt;/tt&gt; for calculating the original score, which is given by &lt;tt&gt;RankQuery#wrap&lt;/tt&gt;.&lt;br/&gt;
  &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/contrib/ltr/src/java/org/apache/solr/ltr/search/LTRQParserPlugin.java#L220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/contrib/ltr/src/java/org/apache/solr/ltr/search/LTRQParserPlugin.java#L220&lt;/a&gt;&lt;br/&gt;
  &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/ResponseBuilder.java#L427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/ResponseBuilder.java#L427&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2. As following codes, &lt;tt&gt;ResultContext&lt;/tt&gt; is built from &lt;tt&gt;ResponseBuilder&lt;/tt&gt; and it use &lt;tt&gt;rb.getQuery()&lt;/tt&gt; as the query.&lt;br/&gt;
  &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L367&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L367&lt;/a&gt;&lt;br/&gt;
  &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/response/BasicResultContext.java#L42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/response/BasicResultContext.java#L42&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3. &lt;tt&gt;Query&lt;/tt&gt; parsed from &quot;q&quot; is set the query of &lt;tt&gt;ResponseBuilder&lt;/tt&gt; during preparing phase, which is executed in both 1st and 2nd phase.&lt;br/&gt;
  &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L160-L167&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L160-L167&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;4. In distributed process, &lt;tt&gt;QueryComponent&lt;/tt&gt; sets original parameters when builds the 2nd phase request as following codes (i.e., same &quot;q&quot; parameter as 1st phase).&lt;br/&gt;
  &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L1287-L1288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L1287-L1288&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16122167" author="cpoerschke" created="Thu, 10 Aug 2017 19:27:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuyano&quot; class=&quot;user-hover&quot; rel=&quot;yuyano&quot;&gt;yuyano&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Jonathan+GV&quot; class=&quot;user-hover&quot; rel=&quot;Jonathan GV&quot;&gt;Jonathan GV&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ryac&quot; class=&quot;user-hover&quot; rel=&quot;ryac&quot;&gt;ryac&lt;/a&gt;&lt;br/&gt;
Thank you for reporting and looking into this here (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11164&quot; title=&quot;OriginalScoreFeature causes NullPointerException during feature logging with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11164&quot;&gt;&lt;del&gt;SOLR-11164&lt;/del&gt;&lt;/a&gt;) and on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11180&quot; title=&quot;OriginalScoreFeature always returns 0.0 with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11180&quot;&gt;&lt;del&gt;SOLR-11180&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11220&quot; title=&quot;Extracting original score (OriginalScoreFeature) will return 0.0 in SolrCloud&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11220&quot;&gt;&lt;del&gt;SOLR-11220&lt;/del&gt;&lt;/a&gt; tickets.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;... it is not the score from the original query. ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Perhaps we could extend the test to compare the &lt;tt&gt;original&lt;/tt&gt; feature value returned in the &lt;tt&gt;fl&lt;/tt&gt; with the &lt;tt&gt;score&lt;/tt&gt; returned in &lt;tt&gt;fl&lt;/tt&gt; when LTR was not used?&lt;br/&gt;
(With that in mind in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11223&quot; title=&quot;expand TestLTROnSolrCloud test coverage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11223&quot;&gt;&lt;del&gt;SOLR-11223&lt;/del&gt;&lt;/a&gt; i went and extended the TestLTROnSolrCloud coverage in two parts: part 1 includes the addition of local &lt;em&gt;original_resultX_score&lt;/em&gt; variables capturing the original &lt;tt&gt;score&lt;/tt&gt; but part 2 is unexpectedly failing i.e. if &lt;tt&gt;rq&lt;/tt&gt; is not specified then no features are returned.)&lt;/p&gt;</comment>
                            <comment id="16125251" author="yuyano" created="Mon, 14 Aug 2017 05:09:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Jonathan+GV&quot; class=&quot;user-hover&quot; rel=&quot;Jonathan GV&quot;&gt;Jonathan GV&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ryac&quot; class=&quot;user-hover&quot; rel=&quot;ryac&quot;&gt;ryac&lt;/a&gt;&lt;br/&gt;
I investigated these issues and found that &lt;tt&gt;score=0.0&lt;/tt&gt; has special meaning for &lt;tt&gt;DocTransformer&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In SolrCloud, scores are calculated in the first-trip and score fields are filled after the second-trip by the distributed node.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L1359&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L1359&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;By this reason, in the second-trip, &lt;tt&gt;DocSlice&lt;/tt&gt; is created with empty scores.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L356&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;While transforming documents, scores of &lt;tt&gt;DocSlice&lt;/tt&gt; is referred by &lt;tt&gt;DocStreamer&lt;/tt&gt; and set &lt;tt&gt;0.0&lt;/tt&gt; if scores are missing.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/response/DocsStreamer.java#L170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/6.6.0/solr/core/src/java/org/apache/solr/response/DocsStreamer.java#L170&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Because &lt;tt&gt;DocSlice&lt;/tt&gt; doesn&apos;t have scores, 0.0 is always passed to &lt;tt&gt;DocTransformer#transform&lt;/tt&gt; as the score. Without &lt;tt&gt;rq&lt;/tt&gt; parameter, &lt;tt&gt;docsWereNotReranked=true&lt;/tt&gt; and this causes the issue reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11180&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SOLR-11180&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11220&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SOLR-11220&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In conclusion, there are two problems with transforming &lt;tt&gt;OriginalScoreFeature&lt;/tt&gt; in SolrCloud mode.&lt;/p&gt;

&lt;p&gt;1. Without &lt;tt&gt;rq&lt;/tt&gt;, &lt;tt&gt;OriginalScoreFeature&lt;/tt&gt; always returns 0.0 because the correct score isn&apos;t passed to &lt;tt&gt;DocTransformer#transform&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;2. With &lt;tt&gt;rq&lt;/tt&gt;, &lt;tt&gt;FeatureTransformer&lt;/tt&gt; causes NPE because the original query isn&apos;t set correctly in &lt;tt&gt;LTRScoringQuery&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16125254" author="yuyano" created="Mon, 14 Aug 2017 05:13:18 +0000"  >&lt;p&gt;I attached new patch (generated by &lt;tt&gt;git diff branch_6x&lt;/tt&gt;). This patch contains changes of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11223&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SOLR-11223&lt;/a&gt; and tests for comparing original scores.&lt;/p&gt;</comment>
                            <comment id="16125457" author="yuyano" created="Mon, 14 Aug 2017 09:26:50 +0000"  >&lt;p&gt;With new patch, the reported case of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11180&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SOLR-11180&lt;/a&gt; seems to work fine.&lt;/p&gt;

&lt;p&gt;without re-ranking : &lt;tt&gt;&lt;a href=&quot;http://localhost:8983/solr/gettingstarted/query?q=test&amp;amp;fl=id,score,%5Bfeatures%5D&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/gettingstarted/query?q=test&amp;amp;fl=id,score,%5Bfeatures%5D&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;zkConnected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:10,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:{
      &lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;id,score,[features]&quot;&lt;/span&gt;}},
  &lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;numFound&quot;&lt;/span&gt;:2,&lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;maxScore&quot;&lt;/span&gt;:1.7527907,&lt;span class=&quot;code-quote&quot;&gt;&quot;docs&quot;&lt;/span&gt;:[
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;GB18030TEST&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;[features]&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;originalScore=1.7527907&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;score&quot;&lt;/span&gt;:1.7527907},
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF8TEST&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;[features]&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;originalScore=1.5209608&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;score&quot;&lt;/span&gt;:1.5209608}]
  }}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with re-ranking : &lt;tt&gt;&lt;a href=&quot;http://localhost:8983/solr/gettingstarted/query?q=test&amp;amp;rq=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/gettingstarted/query?q=test&amp;amp;rq=\&lt;/a&gt;{!ltr%20model=model%20reRankDocs=100}&amp;amp;fl=id,score,&lt;span class=&quot;error&quot;&gt;&amp;#91;features&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;zkConnected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:12,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:{
      &lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;id,score,[features]&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;rq&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;{!ltr model=model reRankDocs=100}&quot;&lt;/span&gt;}},
  &lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;numFound&quot;&lt;/span&gt;:2,&lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;maxScore&quot;&lt;/span&gt;:0.87639534,&lt;span class=&quot;code-quote&quot;&gt;&quot;docs&quot;&lt;/span&gt;:[
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;GB18030TEST&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;[features]&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;originalScore=1.7527907&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;score&quot;&lt;/span&gt;:0.87639534},
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF8TEST&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;[features]&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;originalScore=1.5209608&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;score&quot;&lt;/span&gt;:0.7604804}]
  }}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16128158" author="yuyano" created="Wed, 16 Aug 2017 00:42:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
Is it better to create the patch from the master branch?&lt;/p&gt;</comment>
                            <comment id="16128629" author="cpoerschke" created="Wed, 16 Aug 2017 11:00:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it better to create the patch from the master branch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good question. Yes, I think so, typically patches are against master branch (unless the issue is broken only in (say) branch_7x) and once committed to master branch it would be cherry-pick backported to other branches. &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute&lt;/a&gt; has (much) more detailed info e.g. including &lt;em&gt;ant precommit&lt;/em&gt; etc.&lt;/p&gt;</comment>
                            <comment id="16130000" author="yuyano" created="Thu, 17 Aug 2017 06:25:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
Thank you for your reply! I refactored codes and recreated new patch &lt;tt&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11164&quot; title=&quot;OriginalScoreFeature causes NullPointerException during feature logging with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11164&quot;&gt;&lt;del&gt;SOLR-11164&lt;/del&gt;&lt;/a&gt;_master.patch&lt;/tt&gt; from the master branch. This patch resolves the problem of this issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11164&quot; title=&quot;OriginalScoreFeature causes NullPointerException during feature logging with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11164&quot;&gt;&lt;del&gt;SOLR-11164&lt;/del&gt;&lt;/a&gt;) and also related issues (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11180&quot; title=&quot;OriginalScoreFeature always returns 0.0 with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11180&quot;&gt;&lt;del&gt;SOLR-11180&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11220&quot; title=&quot;Extracting original score (OriginalScoreFeature) will return 0.0 in SolrCloud&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11220&quot;&gt;&lt;del&gt;SOLR-11220&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="16130976" author="cpoerschke" created="Thu, 17 Aug 2017 18:33:25 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuyano&quot; class=&quot;user-hover&quot; rel=&quot;yuyano&quot;&gt;yuyano&lt;/a&gt; for the new patch against master branch!&lt;/p&gt;

&lt;p&gt;(It will work of course but I have doubts re: hard-coding the special interpretation of &lt;em&gt;0.0f&lt;/em&gt; meaning &lt;em&gt;&quot;no score&quot;&lt;/em&gt; in another place and therefore have proposed &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11254&quot; title=&quot;add score-less (abstract) DocTransformer.transform method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11254&quot;&gt;&lt;del&gt;SOLR-11254&lt;/del&gt;&lt;/a&gt; &lt;em&gt;DocTransformer.transform&lt;/em&gt; signature change as a way to avoid that.)&lt;/p&gt;</comment>
                            <comment id="16131536" author="yuyano" created="Fri, 18 Aug 2017 00:35:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
I agree with you. Using 0.0f as &quot;no score&quot; implicitly make codes hard to understand. I&apos;ll wait for merging &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11254&quot; title=&quot;add score-less (abstract) DocTransformer.transform method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11254&quot;&gt;&lt;del&gt;SOLR-11254&lt;/del&gt;&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16141057" author="yuyano" created="Fri, 25 Aug 2017 01:51:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
I attached new patch based on the change of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11254&quot; title=&quot;add score-less (abstract) DocTransformer.transform method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11254&quot;&gt;&lt;del&gt;SOLR-11254&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16141484" author="cpoerschke" created="Fri, 25 Aug 2017 11:02:20 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuyano&quot; class=&quot;user-hover&quot; rel=&quot;yuyano&quot;&gt;yuyano&lt;/a&gt; for the rebased patch!&lt;/p&gt;

&lt;p&gt;I&apos;m attaching patch with two more small revisions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;removal of duplicate setOriginalQuery call&lt;/li&gt;
	&lt;li&gt;in TestLTROnSolrCloud keep the variable number of shards/replica/shards-per-node but adjust shards-per-node and numberOfNodes logic&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Will run &lt;tt&gt;ant precommit&lt;/tt&gt; and re-run tests after lunch, and then commit to master and branch_7x (for 7.1 release).&lt;/p&gt;</comment>
                            <comment id="16141691" author="jira-bot" created="Fri, 25 Aug 2017 14:35:08 +0000"  >&lt;p&gt;Commit 492265014b549d5517e5ec25ffdd0e5557a4ed39 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4922650&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4922650&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11164&quot; title=&quot;OriginalScoreFeature causes NullPointerException during feature logging with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11164&quot;&gt;&lt;del&gt;SOLR-11164&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11180&quot; title=&quot;OriginalScoreFeature always returns 0.0 with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11180&quot;&gt;&lt;del&gt;SOLR-11180&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11220&quot; title=&quot;Extracting original score (OriginalScoreFeature) will return 0.0 in SolrCloud&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11220&quot;&gt;&lt;del&gt;SOLR-11220&lt;/del&gt;&lt;/a&gt;: Fix NullPointerException and always-returns-zero contrib/ltr OriginalScoreFeature issues in SolrCloud mode.&lt;br/&gt;
(Yuki Yano, Jonathan Gonzalez, Ryan Yacyshyn, Christine Poerschke)&lt;/p&gt;</comment>
                            <comment id="16141705" author="jira-bot" created="Fri, 25 Aug 2017 14:50:43 +0000"  >&lt;p&gt;Commit f4b3d5644a98191ef2b18b3a6604774abaf0c339 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f4b3d56&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f4b3d56&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11164&quot; title=&quot;OriginalScoreFeature causes NullPointerException during feature logging with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11164&quot;&gt;&lt;del&gt;SOLR-11164&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11180&quot; title=&quot;OriginalScoreFeature always returns 0.0 with SolrCloud mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11180&quot;&gt;&lt;del&gt;SOLR-11180&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11220&quot; title=&quot;Extracting original score (OriginalScoreFeature) will return 0.0 in SolrCloud&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11220&quot;&gt;&lt;del&gt;SOLR-11220&lt;/del&gt;&lt;/a&gt;: Fix NullPointerException and always-returns-zero contrib/ltr OriginalScoreFeature issues in SolrCloud mode.&lt;br/&gt;
(Yuki Yano, Jonathan Gonzalez, Ryan Yacyshyn, Christine Poerschke)&lt;/p&gt;</comment>
                            <comment id="16141710" author="cpoerschke" created="Fri, 25 Aug 2017 14:52:41 +0000"  >&lt;p&gt;Thanks everyone!&lt;/p&gt;</comment>
                            <comment id="16207324" author="shalinmangar" created="Tue, 17 Oct 2017 11:03:30 +0000"  >&lt;p&gt;Bulk close after 7.1.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13091954">SOLR-11180</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13093636">SOLR-11220</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12883702" name="SOLR-11164.patch" size="7071" author="cpoerschke" created="Fri, 25 Aug 2017 10:58:19 +0000"/>
                            <attachment id="12881684" name="SOLR-11164.patch" size="10261" author="yuyano" created="Mon, 14 Aug 2017 04:37:08 +0000"/>
                            <attachment id="12879288" name="SOLR-11164.patch" size="3609" author="yuyano" created="Fri, 28 Jul 2017 03:15:28 +0000"/>
                            <attachment id="12882274" name="SOLR-11164_master.patch" size="7092" author="yuyano" created="Thu, 17 Aug 2017 06:13:56 +0000"/>
                            <attachment id="12883643" name="SOLR-11164_master_v2.patch" size="6987" author="yuyano" created="Fri, 25 Aug 2017 01:50:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i487:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>