<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:01:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6856] regression in /update/extract ? ref guide examples of fmap &amp; xpath don&apos;t seem to be working </title>
                <link>https://issues.apache.org/jira/browse/SOLR-6856</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I updated this page to know about hte new bin/solr and example/exampledocs structure/contents...&lt;br/&gt;
&lt;a href=&quot;https://cwiki.apache.org/confluence/display/solr/Uploading+Data+with+Solr+Cell+using+Apache+Tika&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/solr/Uploading+Data+with+Solr+Cell+using+Apache+Tika&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;however i noticed that several of the examples listed on that page didn&apos;t seem to work any more &amp;#8211; notably...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;examples using &quot;fmap&quot; don&apos;t seem to create the fields they say they will&lt;/li&gt;
	&lt;li&gt;examples using &quot;xpath&quot; don&apos;t seem to create any docs at all&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Specific examples i had problems with...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;curl &quot;http://localhost:8983/solr/techproducts/update/extract?literal.id=doc2&amp;amp;captureAttr=true&amp;amp;defaultField=text&amp;amp;fmap.div=foo_t&amp;amp;capture=div&amp;amp;commit=true&quot; -F &quot;sample=@example/exampledocs/sample.html&quot;
curl &quot;http://localhost:8983/solr/techproducts/update/extract?literal.id=doc3&amp;amp;captureAttr=true&amp;amp;defaultField=text&amp;amp;capture=div&amp;amp;fmap.div=foo_t&amp;amp;boost.foo_t=3&amp;amp;commit=true&quot; -F &quot;sample=@example/exampledocs/sample.html&quot;
curl &quot;http://localhost:8983/solr/techproducts/update/extract?literal.id=doc4&amp;amp;captureAttr=true&amp;amp;defaultField=text&amp;amp;capture=div&amp;amp;fmap.div=foo_t&amp;amp;boost.foo_t=3&amp;amp;literal.blah_s=Bah&amp;amp;commit=true&quot; -F &quot;sample=@example/exampledocs/sample.html&quot;
curl &quot;http://localhost:8983/solr/techproducts/update/extract?literal.id=doc5&amp;amp;captureAttr=true&amp;amp;defaultField=text&amp;amp;capture=div&amp;amp;fmap.div=foo_t&amp;amp;boost.foo_t=3&amp;amp;literal.id=id&amp;amp;xpath=/xhtml:html/xhtml:body/xhtml:div/descendant:node()&amp;amp;commit=true&quot; -F &quot;sample=@example/exampledocs/sample.html&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...none of these example commands produced an error, but they also didn&apos;t seem to create the fields/docs they said they would (ie: no &quot;foo_t&quot; field was created)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12762154">SOLR-6856</key>
            <summary>regression in /update/extract ? ref guide examples of fmap &amp; xpath don&apos;t seem to be working </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshum">Anshum Gupta</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Dec 2014 00:40:04 +0000</created>
                <updated>Mon, 9 May 2016 18:56:09 +0000</updated>
                            <resolved>Thu, 26 Feb 2015 17:33:21 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>4.10.4</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>contrib - Solr Cell (Tika extraction)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14289469" author="anshumg" created="Fri, 23 Jan 2015 16:28:45 +0000"  >&lt;p&gt;Is anyone looking at this yet? This is the only blocker for 5.0. now.&lt;/p&gt;</comment>
                            <comment id="14289547" author="steve_rowe" created="Fri, 23 Jan 2015 17:23:27 +0000"  >&lt;p&gt;I&apos;m looking into the fmap issue, and I found that the same error is tripped whether &lt;tt&gt;defaultField&lt;/tt&gt; or &lt;tt&gt;uprefix&lt;/tt&gt; is used.&lt;/p&gt;

&lt;p&gt;However, when I switch to capturing &lt;tt&gt;&amp;lt;p&amp;gt;&lt;/tt&gt; elements&apos; content rather than &lt;tt&gt;&amp;lt;div&amp;gt;&lt;/tt&gt; elements&apos;, using &lt;tt&gt;&amp;amp;fmap.p=foo_t&amp;amp;capture=p&lt;/tt&gt;, the failure goes away.  Looks like the problem is with the capturing phase, not the mapping phase.&lt;/p&gt;

&lt;p&gt;So maybe this is about block vs. inline elements?&lt;/p&gt;

&lt;p&gt;Digging more.&lt;/p&gt;</comment>
                            <comment id="14289631" author="steve_rowe" created="Fri, 23 Jan 2015 18:09:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;So maybe this is about block vs. inline elements?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That actually doesn&apos;t make any sense, since both &lt;tt&gt;&amp;lt;p&amp;gt;&lt;/tt&gt; and &lt;tt&gt;div&lt;/tt&gt; are block elements.&lt;/p&gt;

&lt;p&gt;I looked at the SAX events sent into &lt;tt&gt;SolrContentHandler.startElement()&lt;/tt&gt;, where the capture mechanism is invoked, and it never sees &lt;tt&gt;&amp;lt;div&amp;gt;&lt;/tt&gt; start-tag events, but &lt;tt&gt;&amp;lt;p&amp;gt;&lt;/tt&gt; start-tags come through.&lt;/p&gt;</comment>
                            <comment id="14289762" author="steve_rowe" created="Fri, 23 Jan 2015 19:12:41 +0000"  >&lt;p&gt;The &lt;tt&gt;&amp;lt;div&amp;gt;&lt;/tt&gt; capture issue (also a mapping issue since there&apos;s nothing to map) is that in Tika 0.6 (Solr 3.1 upgraded Tika from 0.4 to 0.8), a &lt;tt&gt;DefaultHtmlMapper&lt;/tt&gt; was introduced that only creates events for a subset of HTML tags - when &lt;a href=&quot;http://tika.apache.org/1.7/api/org/apache/tika/parser/html/HtmlMapper.html#mapSafeElement(java.lang.String)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;HtmlMapper.mapSafeElement()&lt;/tt&gt;&lt;/a&gt; returns null for a tag (as it does for any non-mapped tags), its child content is processed, but no event is created for it.  &lt;tt&gt;HtmlParser&lt;/tt&gt; uses &lt;tt&gt;DefaultHtmlMapper&lt;/tt&gt; if no &lt;tt&gt;HtmlMapper.class&lt;/tt&gt; mapping is supplied with &lt;tt&gt;ParseContext&lt;/tt&gt;.  Here&apos;s the 1.7 &lt;tt&gt;DefaultHtmlMapper.SAFE_ELEMENTS&lt;/tt&gt; definition, where the mappings are initialized: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/tags/1.7/tika-parsers/src/main/java/org/apache/tika/parser/html/DefaultHtmlMapper.java?view=markup#l33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/tika/tags/1.7/tika-parsers/src/main/java/org/apache/tika/parser/html/DefaultHtmlMapper.java?view=markup#l33&lt;/a&gt; - no &lt;tt&gt;&amp;lt;div&amp;gt;&lt;/tt&gt; in there.&lt;/p&gt;

&lt;p&gt;The attached patch maps the &lt;tt&gt;HtmlMapper.class&lt;/tt&gt; in &lt;tt&gt;ParseContext&lt;/tt&gt; to &lt;a href=&quot;http://tika.apache.org/1.7/api/org/apache/tika/parser/html/IdentityHtmlMapper.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;IdentityHtmlMapper&lt;/tt&gt;&lt;/a&gt;, which creates events for every HTML element.  A new test is added to check that elements including &lt;tt&gt;&amp;lt;div&amp;gt;&lt;/tt&gt; are captured and mapped properly.&lt;/p&gt;</comment>
                            <comment id="14289764" author="steve_rowe" created="Fri, 23 Jan 2015 19:17:10 +0000"  >&lt;p&gt;I&apos;m looking into the xpath examples now to see if they are caused by the same issue.&lt;/p&gt;</comment>
                            <comment id="14289777" author="thetaphi" created="Fri, 23 Jan 2015 19:21:51 +0000"  >&lt;p&gt;So this issue exists since Solr 3.1... Strange that nobody ever complained. I would prefer to cleanup the HTML as this mapper does, but the IdentityMapper is also fine to me. I think nobody ever wished to capture useless dif elements &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks Steve for investigating the problem!&lt;/p&gt;</comment>
                            <comment id="14289805" author="hossman" created="Fri, 23 Jan 2015 19:39:01 +0000"  >&lt;p&gt;my main concern when filing this issue is that examples from the ref guide (which presumably worked at some point) did not work (now).&lt;/p&gt;

&lt;p&gt;if folks think the current behavior is &quot;better&quot; then the &quot;fixed&quot; behavior in steve&apos;s patch &amp;#8211; that&apos;s fine with me, we can just resolve the issue by fixing hte docs to use better examples.&lt;/p&gt;

&lt;p&gt;i don&apos;t understand the diff in behavior enough to have an opinion.&lt;/p&gt;</comment>
                            <comment id="14289892" author="arafalov" created="Fri, 23 Jan 2015 20:21:10 +0000"  >&lt;p&gt;I fixed something similar for DIH in 4.3 &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4530&quot; title=&quot;DIH: Provide configuration to use Tika&amp;#39;s IdentityHtmlMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4530&quot;&gt;&lt;del&gt;SOLR-4530&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14289999" author="steve_rowe" created="Fri, 23 Jan 2015 21:21:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;I fixed something similar for DIH in 4.3 &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4530&quot; title=&quot;DIH: Provide configuration to use Tika&amp;#39;s IdentityHtmlMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4530&quot;&gt;&lt;del&gt;SOLR-4530&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for the pointer &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arafalov&quot; class=&quot;user-hover&quot; rel=&quot;arafalov&quot;&gt;arafalov&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14290131" author="steve_rowe" created="Fri, 23 Jan 2015 22:30:47 +0000"  >&lt;p&gt;I noticed when using &lt;tt&gt;IdentityHtmlMapper&lt;/tt&gt; that the &lt;tt&gt;&amp;lt;br/&amp;gt;&lt;/tt&gt; tag causes the string &quot;none\n&quot; to show up in the catch-all &lt;tt&gt;content&lt;/tt&gt; field Tika produces, e.g. for &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;distinct&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;br/&amp;gt;&lt;/span&gt;words&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the following is extracted in the catch-all field:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; distinctnone
words
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suspect this is a Tika bug, but I didn&apos;t track down why this happens.&lt;/p&gt;

&lt;p&gt;I addressed this problem by copy/pasting &lt;tt&gt;IdentityHtmlMapper&lt;/tt&gt; into a nested class of &lt;tt&gt;ExtractingDocumentLoader&lt;/tt&gt; and overriding &lt;tt&gt;mapSafeElement(String name)&lt;/tt&gt; to return &lt;tt&gt;null&lt;/tt&gt; when &lt;tt&gt;name&lt;/tt&gt; is &lt;tt&gt;br&lt;/tt&gt; - this causes Tika to not output the &quot;none\n&quot; string in the catch-all field.&lt;/p&gt;

&lt;p&gt;I noticed that &lt;tt&gt;DefaultHtmlMapper&lt;/tt&gt; excludes &lt;tt&gt;&amp;lt;SCRIPT&amp;gt;&lt;/tt&gt; and &lt;tt&gt;&amp;lt;STYLE&amp;gt;&lt;/tt&gt; tags and their content, while &lt;tt&gt;IdentityHtmlMapper&lt;/tt&gt; does not.  I thought I would need to also address this, because a general-purpose HTML extraction facility should not include that &lt;tt&gt;&amp;lt;SCRIPT&amp;gt;&lt;/tt&gt; or &lt;tt&gt;&amp;lt;STYLE&amp;gt;&lt;/tt&gt; content.  But apparently Tika handles exclusion of these tags and their content at some location other than the &lt;tt&gt;HtmlMapper&lt;/tt&gt; - even when using &lt;tt&gt;IdentityHtmlMapper&lt;/tt&gt;, no start-element events are created for these tags.  Nevertheless, I added a test to make sure that &lt;tt&gt;&amp;lt;SCRIPT&amp;gt;&lt;/tt&gt; and &lt;tt&gt;&amp;lt;STYLE&amp;gt;&lt;/tt&gt; content is not extracted.&lt;/p&gt;

&lt;p&gt;I added a new test to more fully demonstrate that &lt;tt&gt;xpath&lt;/tt&gt; handling works properly.&lt;/p&gt;

&lt;p&gt;I think it&apos;s ready to go. I&apos;m running all Solr tests now.&lt;/p&gt;</comment>
                            <comment id="14290143" author="anshumg" created="Fri, 23 Jan 2015 22:36:38 +0000"  >&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;. It&apos;s a blocker but doesn&apos;t have a fix version. 5.0 ?&lt;/p&gt;</comment>
                            <comment id="14290145" author="steve_rowe" created="Fri, 23 Jan 2015 22:38:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m running all Solr tests now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;BUILD SUCCESSFUL
Total time: 22 minutes 23 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll go and run all the ref guide examples before I commit.&lt;/p&gt;</comment>
                            <comment id="14290214" author="steve_rowe" created="Fri, 23 Jan 2015 23:34:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll go and run all the ref guide examples before I commit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;They all run properly, though a couple need adjustment - I&apos;ll fix them in a minute.&lt;/p&gt;

&lt;p&gt;Committing shortly.&lt;/p&gt;</comment>
                            <comment id="14290223" author="jira-bot" created="Fri, 23 Jan 2015 23:44:47 +0000"  >&lt;p&gt;Commit 1654431 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarowe%40syr.edu&quot; class=&quot;user-hover&quot; rel=&quot;sarowe@syr.edu&quot;&gt;sarowe@syr.edu&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1654431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1654431&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6856&quot; title=&quot;regression in /update/extract ? ref guide examples of fmap &amp;amp; xpath don&amp;#39;t seem to be working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6856&quot;&gt;&lt;del&gt;SOLR-6856&lt;/del&gt;&lt;/a&gt;: Restore ExtractingRequestHandler&apos;s ability to capture all HTML tags when parsing (X)HTML.&lt;/p&gt;</comment>
                            <comment id="14290228" author="jira-bot" created="Fri, 23 Jan 2015 23:50:13 +0000"  >&lt;p&gt;Commit 1654432 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarowe%40syr.edu&quot; class=&quot;user-hover&quot; rel=&quot;sarowe@syr.edu&quot;&gt;sarowe@syr.edu&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1654432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1654432&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6856&quot; title=&quot;regression in /update/extract ? ref guide examples of fmap &amp;amp; xpath don&amp;#39;t seem to be working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6856&quot;&gt;&lt;del&gt;SOLR-6856&lt;/del&gt;&lt;/a&gt;: Restore ExtractingRequestHandler&apos;s ability to capture all HTML tags when parsing (X)HTML. (merged trunk r1654431)&lt;/p&gt;</comment>
                            <comment id="14290230" author="jira-bot" created="Fri, 23 Jan 2015 23:51:34 +0000"  >&lt;p&gt;Commit 1654433 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarowe%40syr.edu&quot; class=&quot;user-hover&quot; rel=&quot;sarowe@syr.edu&quot;&gt;sarowe@syr.edu&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1654433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1654433&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6856&quot; title=&quot;regression in /update/extract ? ref guide examples of fmap &amp;amp; xpath don&amp;#39;t seem to be working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6856&quot;&gt;&lt;del&gt;SOLR-6856&lt;/del&gt;&lt;/a&gt;: Restore ExtractingRequestHandler&apos;s ability to capture all HTML tags when parsing (X)HTML. (merged trunk r1654431)&lt;/p&gt;</comment>
                            <comment id="14290263" author="anshumg" created="Sat, 24 Jan 2015 00:26:36 +0000"  >&lt;p&gt;Thanks for fixing this Steve!&lt;/p&gt;</comment>
                            <comment id="14290305" author="steve_rowe" created="Sat, 24 Jan 2015 01:04:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org&quot; class=&quot;user-hover&quot; rel=&quot;hossman_lucene@fucit.org&quot;&gt;hossman_lucene@fucit.org&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; figured out why &lt;tt&gt;&amp;lt;br/&amp;gt;&lt;/tt&gt; caused &quot;none\n&quot; to be dumped into the catch-all field. See the #lucene-dev IRC conversation &lt;a href=&quot;http://colabti.org/irclogger/irclogger_log/lucene-dev?date=2015-01-23#l113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In short, the tagsoup parser used by Tika exposes default attributes on (some?) elements, and the &lt;tt&gt;&amp;lt;br&amp;gt;&lt;/tt&gt; tag has a default attribute &lt;tt&gt;clear&lt;/tt&gt; with value &lt;tt&gt;none&lt;/tt&gt;.  When solr-cell&apos;s &lt;tt&gt;captureAttr&lt;/tt&gt; param is &lt;tt&gt;false&lt;/tt&gt;, all attribute values are dumped into the catch-all text field.  Uwe pointed out that this is terrible, since lots of junk like style and class attributes will get dumped there.  We did identify several useful attributes though: href, title, alt, summary.  I&apos;ll make another issue for post-5.0 to try to improve the situation.&lt;/p&gt;

&lt;p&gt;As noted above, the &quot;none\n&quot; (and all other attribute values) pasted into the catch-all field has no preceding whitespace, so tokenization will break.  Uwe provided a patch to fix this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: solr/contrib/extraction/src/java/org/apache/solr/handler/extraction/SolrContentHandler.java
===================================================================
--- solr/contrib/extraction/src/java/org/apache/solr/handler/extraction/SolrContentHandler.java	(revision 1654430)
+++ solr/contrib/extraction/src/java/org/apache/solr/handler/extraction/SolrContentHandler.java	(working copy)
@@ -280,7 +280,7 @@
       }
     } else {
       for (int i = 0; i &amp;lt; attributes.getLength(); i++) {
-        bldrStack.getLast().append(attributes.getValue(i)).append(&apos; &apos;);
+        bldrStack.getLast().append(&apos; &apos;).append(attributes.getValue(i));
       }
     }
     bldrStack.getLast().append(&apos; &apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Committing shortly.&lt;/p&gt;</comment>
                            <comment id="14290312" author="jira-bot" created="Sat, 24 Jan 2015 01:07:09 +0000"  >&lt;p&gt;Commit 1654444 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarowe%40syr.edu&quot; class=&quot;user-hover&quot; rel=&quot;sarowe@syr.edu&quot;&gt;sarowe@syr.edu&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1654444&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1654444&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6856&quot; title=&quot;regression in /update/extract ? ref guide examples of fmap &amp;amp; xpath don&amp;#39;t seem to be working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6856&quot;&gt;&lt;del&gt;SOLR-6856&lt;/del&gt;&lt;/a&gt;: fix preceding whitespace for attribute values dumped into the catch-all field.&lt;/p&gt;</comment>
                            <comment id="14290313" author="jira-bot" created="Sat, 24 Jan 2015 01:07:47 +0000"  >&lt;p&gt;Commit 1654445 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarowe%40syr.edu&quot; class=&quot;user-hover&quot; rel=&quot;sarowe@syr.edu&quot;&gt;sarowe@syr.edu&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1654445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1654445&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6856&quot; title=&quot;regression in /update/extract ? ref guide examples of fmap &amp;amp; xpath don&amp;#39;t seem to be working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6856&quot;&gt;&lt;del&gt;SOLR-6856&lt;/del&gt;&lt;/a&gt;: fix preceding whitespace for attribute values dumped into the catch-all field. (merged trunk r1654444)&lt;/p&gt;</comment>
                            <comment id="14290314" author="jira-bot" created="Sat, 24 Jan 2015 01:08:20 +0000"  >&lt;p&gt;Commit 1654446 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarowe%40syr.edu&quot; class=&quot;user-hover&quot; rel=&quot;sarowe@syr.edu&quot;&gt;sarowe@syr.edu&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1654446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1654446&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6856&quot; title=&quot;regression in /update/extract ? ref guide examples of fmap &amp;amp; xpath don&amp;#39;t seem to be working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6856&quot;&gt;&lt;del&gt;SOLR-6856&lt;/del&gt;&lt;/a&gt;: fix preceding whitespace for attribute values dumped into the catch-all field. (merged trunk r1654444)&lt;/p&gt;</comment>
                            <comment id="14290330" author="steve_rowe" created="Sat, 24 Jan 2015 01:23:41 +0000"  >&lt;p&gt;Here&apos;s the issue for improving catch-all attribute extraction: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7027&quot; title=&quot;ExtractingRequestHandler indiscriminantly dumps all source HTML attributes into the catch-all field when captureAttr=false, but it should be more selective, something like only href, title, alt, etc. attributes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7027&quot;&gt;SOLR-7027&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14333002" author="anshumg" created="Mon, 23 Feb 2015 05:03:02 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                            <comment id="14338635" author="anshumg" created="Thu, 26 Feb 2015 16:21:18 +0000"  >&lt;p&gt;Reopening for back porting to 4.10.4&lt;/p&gt;</comment>
                            <comment id="14338730" author="jira-bot" created="Thu, 26 Feb 2015 17:26:29 +0000"  >&lt;p&gt;Commit 1662499 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1662499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1662499&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6856&quot; title=&quot;regression in /update/extract ? ref guide examples of fmap &amp;amp; xpath don&amp;#39;t seem to be working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6856&quot;&gt;&lt;del&gt;SOLR-6856&lt;/del&gt;&lt;/a&gt;: Restore ExtractingRequestHandler&apos;s ability to capture all HTML tags when parsing (X)HTML and fix preceding whitespace for attribute values dumped into the catch-all field. (merge from 5x)&lt;/p&gt;</comment>
                            <comment id="14348896" author="mikemccand" created="Thu, 5 Mar 2015 15:36:24 +0000"  >&lt;p&gt;Bulk close for 4.10.4 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12769794">SOLR-7027</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12694267" name="SOLR-6856.patch" size="8120" author="sarowe" created="Fri, 23 Jan 2015 22:30:47 +0000"/>
                            <attachment id="12694219" name="SOLR-6856.patch" size="3816" author="sarowe" created="Fri, 23 Jan 2015 19:12:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23i5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>