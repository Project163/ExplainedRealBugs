<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7756] ExactStatsCache and LRUStatsCache will throw an NPE when a term is not present on a shard</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7756</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If a term doesn&apos;t exist on a shard &lt;tt&gt;ExactStatsCache#getPerShardTermStats&lt;/tt&gt; throws an NullPointerException. &lt;/p&gt;

&lt;p&gt;Attaching a test and a patch shortly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12842915">SOLR-7756</key>
            <summary>ExactStatsCache and LRUStatsCache will throw an NPE when a term is not present on a shard</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Jul 2015 15:25:43 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:35 +0000</updated>
                            <resolved>Wed, 5 Aug 2015 12:15:05 +0000</resolved>
                                    <version>5.0</version>
                    <version>5.0.1</version>
                    <version>5.1</version>
                    <version>5.2</version>
                    <version>5.2.1</version>
                    <version>5.2.2</version>
                                    <fixVersion>5.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14616696" author="varunthacker" created="Tue, 7 Jul 2015 13:26:32 +0000"  >&lt;p&gt;Updated patch with more tests.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; can you please review this.&lt;/p&gt;
</comment>
                            <comment id="14622554" author="anshumg" created="Fri, 10 Jul 2015 16:33:36 +0000"  >&lt;p&gt;Thanks for the patch Varun. What makes you change the following code to be executed for every term, accidental?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; termStatsString = StatsUtil.termStatsMapToString(statsMap);
rb.rsp.add(TERM_STATS_KEY, termStatsString);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14625955" author="varunthacker" created="Tue, 14 Jul 2015 07:09:09 +0000"  >&lt;p&gt;Updated patch:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What makes you change the following code to be executed for every term, accidental?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Reverted this change.&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;ExactStatsCache#mergeToGlobalStats&lt;/tt&gt; we insert the terms n times ( n number of shards ). Now when a shard doesn&apos;t have a term  &lt;tt&gt;List&amp;lt;Object&amp;gt; terms = nl.getAll(TERMS_KEY)&lt;/tt&gt; will return empty and not null since &lt;tt&gt;NamedList#getAll&lt;/tt&gt; works like that. Thus depending on the order in which the shards get hit, if the last shard had no terms the &lt;tt&gt;terms&lt;/tt&gt; key was overwritten with blank causing distributed idf to not get calculated correctly. Fixed this in the patch by changing the condition appropriately.&lt;/p&gt;

&lt;p&gt;Minor refactoring&lt;/p&gt;

&lt;p&gt;All tests pass now.&lt;/p&gt;</comment>
                            <comment id="14625971" author="varunthacker" created="Tue, 14 Jul 2015 07:23:32 +0000"  >&lt;p&gt;New patch where the test picks either LRUStatsCache or ExactStatsCache randomly. &lt;/p&gt;

&lt;p&gt;The patch also fixes the NPE found in LRUStatsCache&lt;/p&gt;</comment>
                            <comment id="14634841" author="anshumg" created="Tue, 21 Jul 2015 09:30:58 +0000"  >&lt;p&gt;Thanks Varun. Looks good. Here are a few suggestions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;You should reset solr.test.sys.* system properties during teardown.&lt;/li&gt;
	&lt;li&gt;It&apos;d be good to refactor the test a little bit (nothing pressing)&lt;/li&gt;
	&lt;li&gt;Do we really need 3 shards in the test? I think we can do with just 2 and save time for the test run.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There&apos;s also a bunch of formatting changes that&apos;s a part of the patch. I just glanced through it, but in case it&apos;s something that&apos;s not required, it&apos;d be good to not refactor those.&lt;br/&gt;
P.S: If the current formatting is screwed up, by all means clean it up.&lt;/p&gt;</comment>
                            <comment id="14636414" author="varunthacker" created="Wed, 22 Jul 2015 07:10:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;You should reset solr.test.sys.* system properties during teardown.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do we really need 3 shards in the test? I think we can do with just 2 and save time for the test run.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Only testSimpleQuery uses 3 shards in which one is empty. The idea of having an extra shard is that shard will not contain terms and expose bugs like &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7818&quot; title=&quot;Distributed stats only calculates with the terms that are present in the last shard of the distributed request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7818&quot;&gt;&lt;del&gt;SOLR-7818&lt;/del&gt;&lt;/a&gt;. We could do with 2 shards with if we indexed something like &quot;football world&quot; instead of &quot;football&quot; in one of the documents. But then we&apos;ll have no way to compare scores of the two returned docuemnts and we can&apos;t do an equality check on the score. Maybe we could once &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7759&quot; title=&quot;DebugComponent&amp;#39;s explain should be implemented as a distributed query&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7759&quot;&gt;&lt;del&gt;SOLR-7759&lt;/del&gt;&lt;/a&gt; is fixed thereby checking debug output and not comparing scores.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There&apos;s also a bunch of formatting changes that&apos;s a part of the patch. I just glanced through it, but in case it&apos;s something that&apos;s not required, it&apos;d be good to not refactor those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Some of this got formatted with the code style that was added for Intellij which got fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-6514&quot; title=&quot;&amp;#39;ant idea&amp;#39; no longer includes code style settings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-6514&quot;&gt;&lt;del&gt;LUCENE-6514&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In ExactStatsCache#mergeToGlobalStats we insert the terms n times ( n number of shards ). Now when a shard doesn&apos;t have a term List&amp;lt;Object&amp;gt; terms = nl.getAll(TERMS_KEY) will return empty and not null since NamedList#getAll works like that. Thus depending on the order in which the shards get hit, if the last shard had no terms the terms key was overwritten with blank causing distributed idf to not get calculated correctly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let&apos;s fix this as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7818&quot; title=&quot;Distributed stats only calculates with the terms that are present in the last shard of the distributed request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7818&quot;&gt;&lt;del&gt;SOLR-7818&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14636442" author="anshumg" created="Wed, 22 Jul 2015 07:38:20 +0000"  >&lt;p&gt;Thanks for addressing my comments. LGTM now.&lt;/p&gt;</comment>
                            <comment id="14654992" author="varunthacker" created="Wed, 5 Aug 2015 08:17:51 +0000"  >&lt;p&gt;One change in this patch. &lt;tt&gt;TestDistribIDF#testMultiCollectionQuery&lt;/tt&gt; is not added here. I&apos;ll add that as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7818&quot; title=&quot;Distributed stats only calculates with the terms that are present in the last shard of the distributed request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7818&quot;&gt;&lt;del&gt;SOLR-7818&lt;/del&gt;&lt;/a&gt; since we&apos;re tacking them separately.&lt;/p&gt;

&lt;p&gt;I&apos;m running the tests and will commit it after that.&lt;/p&gt;</comment>
                            <comment id="14655235" author="jira-bot" created="Wed, 5 Aug 2015 11:40:14 +0000"  >&lt;p&gt;Commit 1694182 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1694182&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7756&quot; title=&quot;ExactStatsCache and LRUStatsCache will throw an NPE when a term is not present on a shard&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7756&quot;&gt;&lt;del&gt;SOLR-7756&lt;/del&gt;&lt;/a&gt;: ExactStatsCache and LRUStatsCache will throw an NPE when a term is not present on a shard&lt;/p&gt;</comment>
                            <comment id="14655257" author="jira-bot" created="Wed, 5 Aug 2015 12:07:31 +0000"  >&lt;p&gt;Commit 1694193 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1694193&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7756&quot; title=&quot;ExactStatsCache and LRUStatsCache will throw an NPE when a term is not present on a shard&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7756&quot;&gt;&lt;del&gt;SOLR-7756&lt;/del&gt;&lt;/a&gt;: ExactStatsCache and LRUStatsCache will throw an NPE when a term is not present on a shard (merged trunk r1694182)&lt;/p&gt;</comment>
                            <comment id="14655262" author="varunthacker" created="Wed, 5 Aug 2015 12:15:05 +0000"  >&lt;p&gt;Thanks Anshum for the review.&lt;/p&gt;</comment>
                            <comment id="14658234" author="jira-bot" created="Wed, 5 Aug 2015 13:44:09 +0000"  >&lt;p&gt;Commit 1694213 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694213&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1694213&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7818&quot; title=&quot;Distributed stats only calculates with the terms that are present in the last shard of the distributed request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7818&quot;&gt;&lt;del&gt;SOLR-7818&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7756&quot; title=&quot;ExactStatsCache and LRUStatsCache will throw an NPE when a term is not present on a shard&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7756&quot;&gt;&lt;del&gt;SOLR-7756&lt;/del&gt;&lt;/a&gt; Added better descriptions in the CHANGES entry for these two issues&lt;/p&gt;</comment>
                            <comment id="14658236" author="jira-bot" created="Wed, 5 Aug 2015 13:46:24 +0000"  >&lt;p&gt;Commit 1694214 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1694214&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7818&quot; title=&quot;Distributed stats only calculates with the terms that are present in the last shard of the distributed request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7818&quot;&gt;&lt;del&gt;SOLR-7818&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7756&quot; title=&quot;ExactStatsCache and LRUStatsCache will throw an NPE when a term is not present on a shard&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7756&quot;&gt;&lt;del&gt;SOLR-7756&lt;/del&gt;&lt;/a&gt; Added better descriptions in the CHANGES entry for these two issues (merged from trunk r1694213)&lt;/p&gt;</comment>
                            <comment id="14713284" author="shalinmangar" created="Wed, 26 Aug 2015 13:06:18 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                            <comment id="15388602" author="steve_rowe" created="Thu, 21 Jul 2016 23:23:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9328&quot; title=&quot;TestDistribIDF.testMultiCollectionQuery() failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9328&quot;&gt;SOLR-9328&lt;/a&gt; has a reproducible test failure for &lt;tt&gt;TestDistribIDF.testMultiCollectionQuery()&lt;/tt&gt;, which fails on the 5.3.0 release&apos;s source, which is when the test was introduced by this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13077663">SOLR-10824</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12923999">SOLR-8459</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12748807" name="SOLR-7756.patch" size="26666" author="varun" created="Wed, 5 Aug 2015 08:17:51 +0000"/>
                            <attachment id="12746485" name="SOLR-7756.patch" size="29195" author="varun" created="Wed, 22 Jul 2015 07:10:41 +0000"/>
                            <attachment id="12745208" name="SOLR-7756.patch" size="28301" author="varun" created="Tue, 14 Jul 2015 07:23:32 +0000"/>
                            <attachment id="12745207" name="SOLR-7756.patch" size="25165" author="varun" created="Tue, 14 Jul 2015 07:09:09 +0000"/>
                            <attachment id="12743958" name="SOLR-7756.patch" size="16613" author="varun" created="Tue, 7 Jul 2015 13:26:32 +0000"/>
                            <attachment id="12743739" name="SOLR-7756.patch" size="4359" author="varun" created="Mon, 6 Jul 2015 15:30:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gw4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>