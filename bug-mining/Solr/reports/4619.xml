<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:46:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14950] schema api sometimes fails to replace-field-type</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14950</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When updating a schema via POST to&#160;&#160;&lt;tt&gt;/solr/COLLECTION/schema&lt;/tt&gt;&#160;using&#160;&#160;&lt;tt&gt;replace-field-type&lt;/tt&gt;&#160;, the call fails if the schema has existing copy-fields whose destination references a non-dynamic field of the&#160;&#160;&lt;tt&gt;field-type&lt;/tt&gt;&#160;which is being updated.&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
Example steps: # on a blank schema, add a field type and copy-field by POSTing&lt;/p&gt;

&lt;p&gt;{&lt;br/&gt;
  &quot;add-field-type&quot;: [&lt;br/&gt;
    {&lt;br/&gt;
      &quot;name&quot;: &quot;spellcheck&quot;, &quot;class&quot;: &quot;solr.TextField&quot;,&quot;positionIncrementGap&quot;: &quot;100&quot;,&lt;br/&gt;
      &quot;analyzer&quot;: {&lt;br/&gt;
        &quot;tokenizer&quot;: &lt;/p&gt;
{
          &quot;class&quot;: &quot;solr.StandardTokenizerFactory&quot;
        }
&lt;p&gt;      }&lt;br/&gt;
    }&lt;br/&gt;
  ],&lt;br/&gt;
  &quot;add-field&quot;: [&lt;/p&gt;
    {
      &quot;name&quot;: &quot;spellcheck&quot;,  &quot;type&quot;: &quot;spellcheck&quot;,
      &quot;multiValued&quot;: true, &quot;indexed&quot;: true, &quot;stored&quot;: true
    }
&lt;p&gt;  ],&lt;br/&gt;
  &quot;add-copy-field&quot;: [&lt;/p&gt;
    {
      &quot;source&quot;: &quot;important_data_s&quot;,
      &quot;dest&quot;: &quot;spellcheck&quot;
    }
&lt;p&gt;  ]&lt;br/&gt;
}&lt;br/&gt;
2. Later, send an update for the field type&lt;br/&gt;
{&lt;br/&gt;
  &quot;replace-field-type&quot;: [&lt;br/&gt;
    {&lt;br/&gt;
      &quot;name&quot;: &quot;spellcheck&quot;, &quot;class&quot;: &quot;solr.TextField&quot;,&quot;positionIncrementGap&quot;: &quot;100&quot;,&lt;br/&gt;
      &quot;analyzer&quot;: {&lt;br/&gt;
        &quot;tokenizer&quot;: &lt;/p&gt;
{
          &quot;class&quot;: &quot;solr.StandardTokenizerFactory&quot;
        }
&lt;p&gt;      }&lt;br/&gt;
    }&lt;br/&gt;
  ]&lt;br/&gt;
}&lt;br/&gt;
This results in&#160;&lt;tt&gt;&quot;errorMessages&quot;:&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;Source or Destination SchemaField can&amp;#39;t be NULL.\n&amp;quot;&amp;#93;&lt;/span&gt;}],}}The error does not trigger if, as mentioned above, the destination of the existing copy-field is dynamic OR if the source field mapping contains a wildcard e.g.&#160;{{*foo_s&lt;/tt&gt;&#160;(edited)&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13336156">SOLR-14950</key>
            <summary>schema api sometimes fails to replace-field-type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="munendrasn">Munendra S N</assignee>
                                    <reporter username="aeshumway">Andrew Shumway</reporter>
                        <labels>
                            <label>schema</label>
                    </labels>
                <created>Mon, 19 Oct 2020 22:32:08 +0000</created>
                <updated>Sat, 13 Feb 2021 00:08:56 +0000</updated>
                            <resolved>Sat, 9 Jan 2021 14:20:48 +0000</resolved>
                                    <version>8.4.1</version>
                                    <fixVersion>8.8</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17244412" author="munendrasn" created="Sat, 5 Dec 2020 06:35:16 +0000"  >&lt;p&gt;During regeneration of copyFields, only fields map is used to fetch SchemaField but in the give copyField, source might match dynamic rule.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aeshumway&quot; class=&quot;user-hover&quot; rel=&quot;aeshumway&quot;&gt;aeshumway&lt;/a&gt; could you please the above PR and let me know if that fixes your issue?&lt;/p&gt;</comment>
                            <comment id="17260625" author="jira-bot" created="Thu, 7 Jan 2021 16:32:09 +0000"  >&lt;p&gt;Commit 0846da5c22809a749d6dd858100df415eed544e4 in lucene-solr&apos;s branch refs/heads/master from Munendra S N&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=0846da5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=0846da5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14950&quot; title=&quot;schema api sometimes fails to replace-field-type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14950&quot;&gt;&lt;del&gt;SOLR-14950&lt;/del&gt;&lt;/a&gt;: fix regenerating of copyfield with explicit src/dest matching dyn rule&lt;/p&gt;

&lt;p&gt;CopyFields are regenerated in case of replace-field or replace-field-type.&lt;br/&gt;
While regenerating, source and destionation are checked against fields but source/dest&lt;br/&gt;
could match dynamic rule too.&lt;br/&gt;
For example,&lt;br/&gt;
&amp;lt;copyField source=&quot;something_s&quot; dest=&quot;spellcheck&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;dynamicField name=&quot;*_s&quot; type=&quot;string&quot;/&amp;gt;&lt;br/&gt;
here, something_s is not present in schema but matches the dynamic rule.&lt;/p&gt;

&lt;p&gt;To handle the above case, need to check dynamicFieldCache too while regenerating the&lt;br/&gt;
copyFields&lt;/p&gt;</comment>
                            <comment id="17260639" author="jira-bot" created="Thu, 7 Jan 2021 16:47:54 +0000"  >&lt;p&gt;Commit 35ef6d2a41bc4ebf54a473998fcffeaf03293aca in lucene-solr&apos;s branch refs/heads/branch_8x from Munendra S N&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=35ef6d2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=35ef6d2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14950&quot; title=&quot;schema api sometimes fails to replace-field-type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14950&quot;&gt;&lt;del&gt;SOLR-14950&lt;/del&gt;&lt;/a&gt;: fix regenerating of copyfield with explicit src/dest matching dyn rule&lt;/p&gt;

&lt;p&gt;CopyFields are regenerated in case of replace-field or replace-field-type.&lt;br/&gt;
While regenerating, source and destionation are checked against fields but source/dest&lt;br/&gt;
could match dynamic rule too.&lt;br/&gt;
For example,&lt;br/&gt;
&amp;lt;copyField source=&quot;something_s&quot; dest=&quot;spellcheck&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;dynamicField name=&quot;*_s&quot; type=&quot;string&quot;/&amp;gt;&lt;br/&gt;
here, something_s is not present in schema but matches the dynamic rule.&lt;/p&gt;

&lt;p&gt;To handle the above case, need to check dynamicFieldCache too while regenerating the&lt;br/&gt;
copyFields&lt;/p&gt;</comment>
                            <comment id="17260642" author="munendrasn" created="Thu, 7 Jan 2021 16:48:42 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aeshumway&quot; class=&quot;user-hover&quot; rel=&quot;aeshumway&quot;&gt;aeshumway&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17260702" author="hossman" created="Thu, 7 Jan 2021 18:23:28 +0000"  >&lt;p&gt;reliably reproducing test failures on branch_8x, first noted by tim potter on the mailing list, and easily reproducible by me...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestBulkSchemaAPI -Dtests.method=testCopyFieldWithReplace -Dtests.seed=7657D4FA16A76DC8 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-UY -Dtests.timezone=America/Resolute -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 3.11s | TestBulkSchemaAPI.testCopyFieldWithReplace &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {
   [junit4]    &amp;gt;   &quot;responseHeader&quot;:{
   [junit4]    &amp;gt;     &quot;status&quot;:400,
   [junit4]    &amp;gt;     &quot;QTime&quot;:26},
   [junit4]    &amp;gt;   &quot;error&quot;:{
   [junit4]    &amp;gt;     &quot;metadata&quot;:[
   [junit4]    &amp;gt;       &quot;error-class&quot;,&quot;org.apache.solr.api.ApiBag$ExceptionWithErrObject&quot;,
   [junit4]    &amp;gt;       &quot;root-error-class&quot;,&quot;org.apache.solr.api.ApiBag$ExceptionWithErrObject&quot;],
   [junit4]    &amp;gt;     &quot;details&quot;:[{
   [junit4]    &amp;gt;         &quot;add-field-type&quot;:{
   [junit4]    &amp;gt;           &quot;name&quot;:&quot;myNewTextField&quot;,
   [junit4]    &amp;gt;           &quot;class&quot;:&quot;solr.TextField&quot;,
   [junit4]    &amp;gt;           &quot;analyzer&quot;:{
   [junit4]    &amp;gt;             &quot;charFilters&quot;:[{
   [junit4]    &amp;gt;                 &quot;name&quot;:&quot;patternReplace&quot;,
   [junit4]    &amp;gt;                 &quot;replacement&quot;:&quot;$1$1&quot;,
   [junit4]    &amp;gt;                 &quot;pattern&quot;:&quot;([a-zA-Z])\\\\1+&quot;}],
   [junit4]    &amp;gt;             &quot;tokenizer&quot;:{&quot;name&quot;:&quot;whitespace&quot;},
   [junit4]    &amp;gt;             &quot;filters&quot;:[{&quot;name&quot;:&quot;asciiFolding&quot;}]}},
   [junit4]    &amp;gt;         &quot;errorMessages&quot;:[&quot;Every charFilter must define a class property!\n&quot;]}],
   [junit4]    &amp;gt;     &quot;msg&quot;:&quot;error processing commands&quot;,
   [junit4]    &amp;gt;     &quot;code&quot;:400}}
   [junit4]    &amp;gt;  expected null, but was:&amp;lt;{metadata=[error-class, org.apache.solr.api.ApiBag$ExceptionWithErrObject, root-error-class, org.apache.solr.api.ApiBag$ExceptionWithErrObject], details=[{add-field-type={name=myNewTextField, class=solr.TextField, analyzer={charFilters=[{name=patternReplace, replacement=$1$1, pattern=([a-zA-Z])\\1+}], tokenizer={name=whitespace}, filters=[{name=asciiFolding}]}}, errorMessages=[Every charFilter must define a class property!
   [junit4]    &amp;gt; ]}], msg=error processing commands, code=400}&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([7657D4FA16A76DC8:B096864C3F5D3F33]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.rest.schema.TestBulkSchemaAPI.testCopyFieldWithReplace(TestBulkSchemaAPI.java:734)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
   [junit4]   2&amp;gt; NOTE: leaving temporary files on disk at: /home/hossman/lucene/alt_dev/solr/build/solr-core/test/J0/temp/solr.rest.schema.TestBulkSchemaAPI_7657D4FA16A76DC8-001
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene87): {}, docValues:{}, maxPointsInLeafNode=252, maxMBSortInHeap=5.5044488302753045, sim=Asserting(RandomSimilarity(queryNorm=false): {}), locale=es-UY, timezone=America/Resolute
   [junit4]   2&amp;gt; NOTE: Linux 5.4.0-47-generic amd64/AdoptOpenJDK 1.8.0_222 (64-bit)/cpus=8,threads=1,free=460545360,total=521142272
   [junit4]   2&amp;gt; NOTE: All tests run in this JVM: [TestBulkSchemaAPI]
   [junit4] Completed [1/1 (1!)] in 4.11s, 1 test, 1 failure &amp;lt;&amp;lt;&amp;lt; FAILURES!
   [junit4] 
   [junit4] 
   [junit4] Tests with failures [seed: 7657D4FA16A76DC8]:
   [junit4]   - org.apache.solr.rest.schema.TestBulkSchemaAPI.testCopyFieldWithReplace

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(The particular seed does not seem to matter at all)&lt;/p&gt;</comment>
                            <comment id="17260707" author="munendrasn" created="Thu, 7 Jan 2021 18:29:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; Thanks for reporting, looking into it&lt;/p&gt;</comment>
                            <comment id="17260724" author="jira-bot" created="Thu, 7 Jan 2021 18:43:16 +0000"  >&lt;p&gt;Commit 514c4b1e491c1c93b7b928731437dcbe932237f9 in lucene-solr&apos;s branch refs/heads/branch_8x from Munendra S N&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=514c4b1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=514c4b1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14950&quot; title=&quot;schema api sometimes fails to replace-field-type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14950&quot;&gt;&lt;del&gt;SOLR-14950&lt;/del&gt;&lt;/a&gt;: fix failing test for Bulk Schema update&lt;/p&gt;</comment>
                            <comment id="17260726" author="munendrasn" created="Thu, 7 Jan 2021 18:45:19 +0000"  >&lt;p&gt;Above commit fixes the failures, will wait for a day and close this issue again&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jtq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>