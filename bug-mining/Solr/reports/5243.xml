<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:11:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17575] Solr Langid backwards compatibility with the legacy &quot;langid.whitelist&quot; is broken</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17575</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I&#8217;m seeking your feedback regarding an issue I&#8217;ve encountered when configuring the Solr Langid module, specifically when using the deprecated&#160;&lt;tt&gt;langid.whitelist&lt;/tt&gt;&#160;property instead of Solr&#8217;s newer&#160;&lt;tt&gt;langid.allowlist&lt;/tt&gt;&#160;property to define allowed language codes.&lt;/p&gt;

&lt;p&gt;As you are likely aware, the&#160;&lt;tt&gt;langid.whitelist&lt;/tt&gt;&#160;property has been deprecated since Solr 9.0.0, and the recommended approach is to use&#160;&lt;tt&gt;langid.allowlist&lt;/tt&gt;&#160;instead. I am indeed using the&#160;&lt;tt&gt;langid.allowlist&lt;/tt&gt;&#160;property, but I would like to bring attention to an issue I&#8217;ve observed with the legacy support for&#160;&lt;tt&gt;langid.whitelist&lt;/tt&gt;. I believe there is a bug in the backward compatibility code that could cause unintended behavior when the&#160;&lt;tt&gt;langid.whitelist&lt;/tt&gt;&#160;property is configured.&lt;/p&gt;

&lt;p&gt;To illustrate the problem, I&#8217;ll provide a detailed example based on the code:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;The check for&#160;&lt;tt&gt;legacyAllowList&lt;/tt&gt;&lt;/b&gt;: In the Solr code, specifically in the&#160;&lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/modules/langid/src/java/org/apache/solr/update/processor/LanguageIdentifierUpdateProcessor.java#L123-L127&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/main/solr/modules/langid/src/java/org/apache/solr/update/processor/LanguageIdentifierUpdateProcessor.java#L123-L127&lt;/a&gt;, there is a check for the length of the&#160;&lt;tt&gt;legacyAllowList&lt;/tt&gt;&#160;string. However, the&#160;&lt;tt&gt;legacyAllowList&lt;/tt&gt;&#160;is never actually used after the length check in the code. Instead, an empty string (&lt;tt&gt;&quot;&quot;&lt;/tt&gt;) is used as the default value when fetching the&#160;&lt;tt&gt;LANG_ALLOWLIST&lt;/tt&gt;&#160;parameter.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;Resulting issue with the&#160;&lt;tt&gt;langAllowlist&lt;/tt&gt;&#160;set&lt;/b&gt;: As a result, the&#160;&lt;tt&gt;Set&amp;lt;String&amp;gt; langAllowlist&lt;/tt&gt;&#160;is populated with a single element: an empty string (&lt;tt&gt;&quot;&quot;&lt;/tt&gt;). This causes an issue when the code checks if the&#160;&lt;tt&gt;langAllowlist&lt;/tt&gt;&#160;is empty in the later part of the code (&lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/modules/langid/src/java/org/apache/solr/update/processor/LanguageIdentifierUpdateProcessor.java#L385-L405&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/main/solr/modules/langid/src/java/org/apache/solr/update/processor/LanguageIdentifierUpdateProcessor.java#L385-L405&lt;/a&gt;) , specifically in&#160;this section. The check&#160;&lt;tt&gt;langAllowlist.isEmpty()&lt;/tt&gt;&#160;incorrectly returns&#160;&lt;tt&gt;false&lt;/tt&gt;&#160;because the set does contain an element - the empty string.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;Unexpected fallback behavior&lt;/b&gt;: Consequently, even though the language of the document might be correctly detected (for instance, if the document is identified as being in German), the flow incorrectly enters the &quot;else&quot; clause. This results in the log message:&#160;&lt;em&gt;&quot;Detected a language not in allowlist (de), using fallback en&quot;&lt;/em&gt;&#160;and the fallback language is set to English (&lt;tt&gt;en&lt;/tt&gt;), even though the document language was correctly identified as German.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I believe this behavior stems from a bug in the backwards compatibility handling for the deprecated&#160;&lt;tt&gt;langid.whitelist&lt;/tt&gt;&#160;property. If the&#160;&lt;tt&gt;legacyAllowList&lt;/tt&gt;&#160;value is not being properly used or passed to the&#160;&lt;tt&gt;langAllowlist&lt;/tt&gt;&#160;set, it leads to incorrect fallback behavior.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13600119">SOLR-17575</key>
            <summary>Solr Langid backwards compatibility with the legacy &quot;langid.whitelist&quot; is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="azagniotov">Alexander Zagniotov</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 27 Nov 2024 04:29:30 +0000</created>
                <updated>Thu, 30 Jan 2025 18:10:50 +0000</updated>
                            <resolved>Thu, 28 Nov 2024 21:56:22 +0000</resolved>
                                    <version>9.1</version>
                    <version>9.2</version>
                    <version>9.3</version>
                    <version>9.4</version>
                    <version>9.5</version>
                    <version>9.6</version>
                                    <fixVersion>9.8</fixVersion>
                                    <component>contrib - LangId</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7200">2h</timespent>
                                <comments>
                            <comment id="17901651" author="jira-bot" created="Thu, 28 Nov 2024 09:01:51 +0000"  >&lt;p&gt;Commit cebdb2d790a656b949e0f1fcb6893333c63602e1 in solr&apos;s branch refs/heads/main from Alexander Zagniotov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=cebdb2d790a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=cebdb2d790a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17575&quot; title=&quot;Solr Langid backwards compatibility with the legacy &amp;quot;langid.whitelist&amp;quot; is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17575&quot;&gt;&lt;del&gt;SOLR-17575&lt;/del&gt;&lt;/a&gt;: Fixed broken backwards compatibility with the legacy &quot;langid.whitelist&quot; config in Solr Langid (#2886)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Alexander Zagniotov &amp;lt;azagniotov@box.com&amp;gt;&lt;br/&gt;
Co-authored-by: Jan H&#248;ydahl &amp;lt;janhoy@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17901670" author="jira-bot" created="Thu, 28 Nov 2024 09:26:14 +0000"  >&lt;p&gt;Commit 8ad8b59a88ab35f745148952e3d45f72188d514c in solr&apos;s branch refs/heads/branch_9x from Alexander Zagniotov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=8ad8b59a88a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=8ad8b59a88a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17575&quot; title=&quot;Solr Langid backwards compatibility with the legacy &amp;quot;langid.whitelist&amp;quot; is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17575&quot;&gt;&lt;del&gt;SOLR-17575&lt;/del&gt;&lt;/a&gt;: Fixed broken backwards compatibility with the legacy &quot;langid.whitelist&quot; config in Solr Langid (#2886)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Alexander Zagniotov &amp;lt;azagniotov@box.com&amp;gt;&lt;br/&gt;
Co-authored-by: Jan H&#248;ydahl &amp;lt;janhoy@apache.org&amp;gt;&lt;br/&gt;
(cherry picked from commit cebdb2d790a656b949e0f1fcb6893333c63602e1)&lt;/p&gt;</comment>
                            <comment id="17921887" author="anshumg" created="Tue, 28 Jan 2025 22:17:47 +0000"  >&lt;p&gt;Closing after the 9.8.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ssbs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>