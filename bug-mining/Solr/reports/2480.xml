<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:05:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7361] Main Jetty thread blocked by core loading delays HTTP listener from binding if core loading is slow</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7361</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;During server startup, the CoreContainer uses an ExecutorService to load cores in multiple back-ground threads but then blocks until cores are loaded, see: CoreContainer#load around line 290 on trunk (invokeAll). From the JavaDoc on that method, we have:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Executes the given tasks, returning a list of Futures holding their status and results when all complete. Future.isDone() is true for each element of the returned list.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In other words, this is a blocking call.&lt;/p&gt;

&lt;p&gt;This delays the Jetty HTTP listener from binding and accepting requests until all cores are loaded. Do we need to block the main thread?&lt;/p&gt;

&lt;p&gt;Also, prior to this happening, the node is registered as a live node in ZK, which makes it a candidate for receiving requests from the Overseer, such as to service a create collection request. The problem of course is that the node listed in /live_nodes isn&apos;t accepting requests yet. So we either need to unblock the main thread during server loading or maybe wait longer before we register as a live node ... not sure which is the better way forward?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12819020">SOLR-7361</key>
            <summary>Main Jetty thread blocked by core loading delays HTTP listener from binding if core loading is slow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="thelabdude">Timothy Potter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Apr 2015 18:44:15 +0000</created>
                <updated>Mon, 9 May 2016 18:54:06 +0000</updated>
                            <resolved>Fri, 29 May 2015 14:29:21 +0000</resolved>
                                                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="14483898" author="andyetitmoves" created="Tue, 7 Apr 2015 19:41:22 +0000"  >&lt;p&gt;Isn&apos;t it a problem that live_nodes is set up but the cores aren&apos;t, only when the core isn&apos;t marked down? I see currently that &lt;tt&gt;ZkController.preRegister&lt;/tt&gt; happens async in the threadpool, if that happened synchronously, we should be free to block main jetty thread or free it up as we deem fit. At that point, might as well free it up, but I admit I am not an expert on if there are other interactions we need to worry about..&lt;/p&gt;</comment>
                            <comment id="14483920" author="thelabdude" created="Tue, 7 Apr 2015 19:54:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;Isn&apos;t it a problem that live_nodes is set up but the cores aren&apos;t, only when the core isn&apos;t marked down?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re right about requests being sent to cores, but I think the problem here is admin type requests, such as those coming from the overseer to create a new collection. This is actually how we found this in a big cluster after a restart, some cores were slow to load (due the the suggester dictionary issue) and create collection requests started to fail.&lt;/p&gt;

&lt;p&gt;In general, I don&apos;t think all cores should be blocked from being accessed until the slowest core is loaded, so I&apos;m thinking we need to re-think how cores are loaded in the background in cloud mode.&lt;/p&gt;</comment>
                            <comment id="14483985" author="mewmewball" created="Tue, 7 Apr 2015 20:24:00 +0000"  >&lt;p&gt;I think I have also seen cases where if we bounced two nodes holding two replicas of a particular collection/shard, then they both can&apos;t complete their recovery because they can&apos;t talk to each other. This fixes itself eventually when they time out waiting for each other, but before that happens they&apos;re basically &quot;deadlocked&quot;. (Unfortunately I don&apos;t have logs to back that up anymore, so it&apos;s more of an anecdotal account.)&lt;/p&gt;</comment>
                            <comment id="14484146" author="andyetitmoves" created="Tue, 7 Apr 2015 21:49:03 +0000"  >&lt;p&gt;Tim, I understand. What I meant is that we can&apos;t currently let through any requests because you are not guaranteed that cores will be in a sensible state for accepting requests before the core loading threads finish. That&apos;s why at least the preRegister for all cores needs to finish (and that shouldn&apos;t take long) before we start accepting requests. Once that happens, I think cores can load up in the background (or at least we can try, stumble and fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;</comment>
                            <comment id="14484188" author="thelabdude" created="Tue, 7 Apr 2015 22:11:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andyetitmoves&quot; class=&quot;user-hover&quot; rel=&quot;andyetitmoves&quot;&gt;andyetitmoves&lt;/a&gt; ah ok, I misunderstood, what you&apos;re saying makes sense. I&apos;ll try to tackle this on Thursday or Friday this week as I&apos;m focused on a couple of other issues first, so if someone else can pick this up sooner, that would be great.&lt;/p&gt;</comment>
                            <comment id="14484225" author="markrmiller@gmail.com" created="Tue, 7 Apr 2015 22:31:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;what you&apos;re saying makes sense. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14484766" author="andyetitmoves" created="Wed, 8 Apr 2015 05:49:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;preRegister for all cores needs to finish (that shouldn&apos;t take long) before we start accepting requests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This should become even faster btw once we get to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7281&quot; title=&quot;Add an overseer action to publish an entire node as &amp;#39;down&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7281&quot;&gt;&lt;del&gt;SOLR-7281&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Jessica: I have a feeling what you are saying might happen because of the same reason as above &amp;#8211; if two nodes go down uncleanly as active, they would come back as live and active before the async core loading actually marks them as down.&lt;/p&gt;

&lt;p&gt;This is the sequence I propose (again, without looking at the code too deeply, so I might have missed something)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Mark all cores down, also make sure direct requests from outside Solr for all cores suitably fail.&lt;/li&gt;
	&lt;li&gt;Add to live nodes&lt;/li&gt;
	&lt;li&gt;Start accepting requests&lt;/li&gt;
	&lt;li&gt;Load cores in background and enable requests for cores as they finish loading.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14490285" author="thelabdude" created="Fri, 10 Apr 2015 20:09:35 +0000"  >&lt;p&gt;heh - now tons of tests fail because the main thread isn&apos;t blocked and finishes before cores are initialized ... knee-jerk reaction would be to activate this true async loading method using a System property, e.g. solr.cloud.loadCoresAsync, which defaults to true but is set to false in most tests ... other ideas?&lt;/p&gt;</comment>
                            <comment id="14490391" author="elyograg" created="Fri, 10 Apr 2015 21:22:33 +0000"  >&lt;p&gt;I like the idea of having access to the admin UI responsive immediately on startup ... if nothing else, to be able to see the progress of the startup.&lt;/p&gt;

&lt;p&gt;Obviously any requests to cores that are not yet started must fail, but cores that have started, as well as any functionality that doesn&apos;t depend on core startup, should work.&lt;/p&gt;

&lt;p&gt;There&apos;s probably more to think about and tweak.  During startup, CoreAdmin and CollectionsAdmin requests will require careful vetting.  My thought here is that about the only operation that should be allowed on things that haven&apos;t yet started is DELETE, if we can find a way to do so safely.  If deleting a core can remove it from the startup queue entirely, it&apos;s a slight optimization.&lt;/p&gt;

&lt;p&gt;If we aren&apos;t already doing so, this will require that we enumerate all the cores and/or the clusterstate before listening to any kind of request on CoreAdmin/CollectionsAdmin.&lt;/p&gt;

&lt;p&gt;A disabling property for tests is a good interim step, but I think that the long term goal should be to modify both the async startup and the tests so everything works right.&lt;/p&gt;</comment>
                            <comment id="14490404" author="thelabdude" created="Fri, 10 Apr 2015 21:35:08 +0000"  >&lt;p&gt;Actually, if we go with the idea that non-cloud mode continues to block the main thread until cores are loaded, then all tests pass. I think that makes sense anyway, since there isn&apos;t anything like replica state in non-cloud mode to determine if a core is active, so the listener not being up until cores are loaded seems like a good thing for non-cloud mode. For cloud mode, it appears that we don&apos;t need a flag for the tests to pass.&lt;/p&gt;</comment>
                            <comment id="14490437" author="elyograg" created="Fri, 10 Apr 2015 21:59:48 +0000"  >&lt;p&gt;If we can pull the same thing off in non-cloud mode, I would like that ... but cloud mode is where it&apos;s a big problem.&lt;/p&gt;</comment>
                            <comment id="14490623" author="dk" created="Sat, 11 Apr 2015 00:32:20 +0000"  >&lt;p&gt;Regarding loading the cores in the background, I&apos;ve made a few tweaks to work with thousands of cores (See &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7191&quot; title=&quot;Improve stability and startup performance of SolrCloud with thousands of collections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7191&quot;&gt;&lt;del&gt;SOLR-7191&lt;/del&gt;&lt;/a&gt;):&lt;br/&gt;
1. Load cores in fixed threadPool. Cores are registered in background threads, so no reason to load all cores at once!&lt;br/&gt;
2. Register cores in corename order with a fixed 128 threadPool. This is to not flood the DistributedQueue.&lt;br/&gt;
3. Publish an entire node as &apos;down&apos; (4.10 branch)&lt;br/&gt;
4. Cache ConfigSetService.createIndexSchema() in cloud mode.&lt;/p&gt;

&lt;p&gt;So, my questions are:&lt;br/&gt;
What threadPool size will be used to load the cores?&lt;br/&gt;
What order will cores be loaded in?&lt;br/&gt;
Will cores be registered as they are loaded, or offloaded to another threadPool?&lt;/p&gt;

&lt;p&gt;My initial thought was to register as a live node after cores are loaded.&lt;/p&gt;</comment>
                            <comment id="14490930" author="andyetitmoves" created="Sat, 11 Apr 2015 11:27:55 +0000"  >&lt;p&gt;May be provide for a method in CoreContainer to wait till cores are initialized?&lt;/p&gt;</comment>
                            <comment id="14492853" author="thelabdude" created="Mon, 13 Apr 2015 18:57:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=damienka&quot; class=&quot;user-hover&quot; rel=&quot;damienka&quot;&gt;damienka&lt;/a&gt; All good questions, but this ticket is not intended to address any of those and it sounds like you&apos;re tackling them as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7191&quot; title=&quot;Improve stability and startup performance of SolrCloud with thousands of collections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7191&quot;&gt;&lt;del&gt;SOLR-7191&lt;/del&gt;&lt;/a&gt;. I&apos;m close to posting a patch for this, which will only address the problem of blocking the main thread (which activates the Jetty listener) during core loading.&lt;/p&gt;</comment>
                            <comment id="14493203" author="thelabdude" created="Mon, 13 Apr 2015 22:32:38 +0000"  >&lt;p&gt;Patch that blocks the main thread until cores are pre-registered with ZK, but then loads cores in the background, allowing the main thread to progress and activate the Jetty listener. Only works in SolrCloud mode; the main thread will continue to be blocked by core loading in non-cloud mode. Cores will come online asynchronously when they are loaded.&lt;/p&gt;</comment>
                            <comment id="14493690" author="andyetitmoves" created="Tue, 14 Apr 2015 06:57:49 +0000"  >&lt;p&gt;Looks like a good start..&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;What does a client get back when sending a request to a core which is not yet loaded? It should be a sensible 5xx error, but would be good to test that..&lt;/li&gt;
	&lt;li&gt;Do we still need the sysprop for tests? As I mention above, we could use a CoreContainer call to synchronize ourselves in tests..&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14501271" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 11:12:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;solr.cloud.loadCoresAsync, which defaults to true but is set to false in most tests ... other ideas?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That doesn&apos;t seem right - we end up testing the wrong stuff mostly then - I&apos;m working on a similar problem - let me see if I can get something better.&lt;/p&gt;</comment>
                            <comment id="14501272" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 11:14:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;What does a client get back when sending a request to a core which is not yet loaded? It should be a sensible 5xx error, but would be good to test that..&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If it doesn&apos;t block, it will be a behavior back compat break we have to think about. I don&apos;t want to make this an option, so just simulating the block may be one way to go.&lt;/p&gt;</comment>
                            <comment id="14501303" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 11:43:22 +0000"  >&lt;p&gt;I breezed over this a while back and it didn&apos;t stick with me. Ran into a situation I needed to solve myself and started tackling this how I would approach it in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7416&quot; title=&quot;Slow loading SolrCores should not hold up all other SolrCores that have finished loading from serving requests.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7416&quot;&gt;&lt;del&gt;SOLR-7416&lt;/del&gt;&lt;/a&gt;. Here is the patch I hacked out. I would actually still like to wait for quick loading cores in most cases for up to N seconds and just have slow loading stragglers come in later. I&apos;d also like to avoid any switch around the behaviour if possible. We have enough complication and varying code paths in this area.&lt;/p&gt;</comment>
                            <comment id="14501329" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 12:21:39 +0000"  >&lt;p&gt;Still a beta, but here is patch v2.&lt;/p&gt;</comment>
                            <comment id="14501358" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 13:35:09 +0000"  >&lt;p&gt;Here is a good version for comment with passing tests. &lt;/p&gt;

&lt;p&gt;Note: I had to fix an issue with how UpdateLog gets closed. Been trying to track that one down for a while I think!&lt;/p&gt;</comment>
                            <comment id="14501370" author="thelabdude" created="Sat, 18 Apr 2015 13:57:37 +0000"  >&lt;p&gt;Thanks for picking this one up. I like this approach better as well, since it avoids the cloud vs. non-cloud switch. And sorry about leaving that flag in there on my last patch as that caused some confusion for you and Ram (it wasn&apos;t being used anymore). I&apos;ll kick the tires on this patch a bit myself but +1 to the approach.&lt;/p&gt;</comment>
                            <comment id="14501371" author="thelabdude" created="Sat, 18 Apr 2015 13:58:20 +0000"  >&lt;p&gt;Assigning to Mark as he&apos;s proposed a better solution for this moving forward.&lt;/p&gt;</comment>
                            <comment id="14501577" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 20:44:47 +0000"  >&lt;p&gt;Here is another iteration that polishes up some areas.&lt;/p&gt;</comment>
                            <comment id="14501847" author="markrmiller@gmail.com" created="Sun, 19 Apr 2015 13:24:00 +0000"  >&lt;p&gt;This does change behavior a bit of course - all of your cores were loaded when you came out of CC#load before. I think it does a good enough job of simulating the old behavior though. Attempting to access a loading core specifically will block until it&apos;s ready to serve. I think given that this does seem like a big enough limitation that it enters bug territory, it&apos;s well worth making the change.&lt;/p&gt;</comment>
                            <comment id="14505218" author="andyetitmoves" created="Tue, 21 Apr 2015 16:28:02 +0000"  >&lt;p&gt;Sorry for the late feedback.&lt;/p&gt;

&lt;p&gt;My concern with this approach is that this can be trappy for client code. When you are developing/testing, you might always have the cores up and running by the time you issue requests &amp;#8211; and then the edge case will be exposed one day on production when slow disk IO or a bad GC pause strikes..&lt;/p&gt;

&lt;p&gt;If we are breaking compat anyway, why not always break it (instead of in some cases outside developer control &amp;#8211; which imo is no better) and return immediately without sleeping? In any case, at the very minimum, we would want to do that in our tests so that we account for that situation..&lt;/p&gt;</comment>
                            <comment id="14505305" author="markrmiller@gmail.com" created="Tue, 21 Apr 2015 17:17:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;you might always have the cores up and running by the time you issue requests&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Other requests will block until the core is ready - what will that break? That is how it works now if requests come in before the cores are loaded. Do you have a concrete example?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we are breaking compat anyway, why not always break it&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If the cores are just going to load quickly, I think it&apos;s simply nicer to wait for them to load and only have outliers straggle in later, as the system did work. Unless there are outliers, I think it&apos;s a nicer system experience. This is a simple simulation of that approach.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t matter how long that wait is - you can set it to 0 and all the tests will pass fine. You can certainly randomly set that to 0 in test runs.&lt;/p&gt;</comment>
                            <comment id="14505359" author="andyetitmoves" created="Tue, 21 Apr 2015 17:47:15 +0000"  >&lt;p&gt;I haven&apos;t synthetically tried this to confirm, happy to do that, I am just away from keyboard this instant. But here&apos;s my concern..&lt;/p&gt;

&lt;p&gt;Before: I would have got a 5xx error for unloaded cores since all load at once before Jetty binds, which every client should consider normal in a distributed setup at least and try alternatives.&lt;/p&gt;

&lt;p&gt;Now: I would block till the loading is done. This could trigger timeouts which usually is not normal (would usually indicate slow queries), or worse, backlog requests in a busy server if its using a threadpool and sync http requests &amp;#8211; even if timeouts are not hit.&lt;/p&gt;

&lt;p&gt;Again, my understanding might be off, let me confirm this soon, and I can update if I am spewing nonsense..&lt;/p&gt;</comment>
                            <comment id="14505387" author="markrmiller@gmail.com" created="Tue, 21 Apr 2015 18:02:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Before: I would have got a 5xx error for unloaded cores since all load at once before Jetty binds&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Would you? I thought the request just blocked until the SolrDispatchFilter was ready...we should confirm it&apos;s a 5xx error - if that is the case, that is what we should be emulating.&lt;/p&gt;</comment>
                            <comment id="14519770" author="markrmiller@gmail.com" created="Wed, 29 Apr 2015 17:25:18 +0000"  >&lt;p&gt;Okay, with SolrCloud, if you hit a core that is loaded and one is not, you get:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;response&amp;gt;
&amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;&amp;lt;int name=&quot;status&quot;&amp;gt;503&amp;lt;/int&amp;gt;&amp;lt;int name=&quot;QTime&quot;&amp;gt;3&amp;lt;/int&amp;gt;&amp;lt;lst name=&quot;params&quot;/&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;lst name=&quot;error&quot;&amp;gt;&amp;lt;str name=&quot;msg&quot;&amp;gt;no servers hosting shard: &amp;lt;/str&amp;gt;&amp;lt;int name=&quot;code&quot;&amp;gt;503&amp;lt;/int&amp;gt;&amp;lt;/lst&amp;gt;
&amp;lt;/response&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you hit the core that is loading you get:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;curl: (7) Failed to connect to localhost port 8902: Connection refused&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll work up a new patch.&lt;/p&gt;</comment>
                            <comment id="14520221" author="markrmiller@gmail.com" created="Wed, 29 Apr 2015 20:55:53 +0000"  >&lt;p&gt;Made some good progress this afternoon. I&apos;ll post a patch relatively soon.&lt;/p&gt;</comment>
                            <comment id="14521374" author="markrmiller@gmail.com" created="Thu, 30 Apr 2015 11:55:09 +0000"  >&lt;p&gt;Here is my current progress.&lt;/p&gt;

&lt;p&gt;By default CoreContainer still waits on load, but has a new async load option.&lt;/p&gt;

&lt;p&gt;JettySolrServer still waits on load, but has a new async load option.&lt;/p&gt;

&lt;p&gt;SolrDispatchFilter turns on the async load option and also returns a 503 on request while a core is loading (though it seems perhaps you can get a 510 instead depending on timing due to the stateformat=2 stuff).&lt;/p&gt;

&lt;p&gt;I think that is back compat and gives us the new behavior we want.&lt;/p&gt;</comment>
                            <comment id="14528318" author="markrmiller@gmail.com" created="Tue, 5 May 2015 11:56:36 +0000"  >&lt;p&gt;Any comments on the latest patch?&lt;/p&gt;</comment>
                            <comment id="14529182" author="andyetitmoves" created="Tue, 5 May 2015 20:07:07 +0000"  >&lt;p&gt;Sorry I started looking at this over weekend before getting distracted. +1 overall.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does your test in TestMiniCloud assume that by the time you assert the loading wouldn&apos;t have async done? Seems like we are relying on a timing detail. May be we could at least check for if the core is loaded at that point (still a race since it won&apos;t be an atomic check but probably less likely to hit).&lt;/li&gt;
	&lt;li&gt;Minor: Would be nice for JettyConfig to instead take a Integer waitForLoadingMs (can be null) so that it can be tweaked instead of a boolean. Its hard anyway to assume a default for this.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14529254" author="thelabdude" created="Tue, 5 May 2015 20:57:08 +0000"  >&lt;p&gt;+1 LGTM ... although the recent dispatch filter refactoring has broken the latest patch on trunk&lt;/p&gt;</comment>
                            <comment id="14546083" author="markrmiller@gmail.com" created="Fri, 15 May 2015 19:50:54 +0000"  >&lt;p&gt;Regaining a bit of use of my right hand for hunt and peck - I&apos;ll see if I can update this on Sunday.&lt;/p&gt;</comment>
                            <comment id="14550427" author="markrmiller@gmail.com" created="Tue, 19 May 2015 13:28:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;May be we could at least check for if the core is loaded at that point&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just another timing detail with false fails? &lt;/p&gt;</comment>
                            <comment id="14550444" author="markrmiller@gmail.com" created="Tue, 19 May 2015 13:36:17 +0000"  >&lt;p&gt;Updated to trunk.&lt;/p&gt;</comment>
                            <comment id="14550456" author="markrmiller@gmail.com" created="Tue, 19 May 2015 13:44:04 +0000"  >&lt;p&gt;I have to work out why TestMiniSolrCloudCluster#testBasics is failing due to 510, stale cluster state responses. Something off in the merge up or some change I pulled in altered behavior.&lt;/p&gt;</comment>
                            <comment id="14550467" author="markrmiller@gmail.com" created="Tue, 19 May 2015 13:50:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;Just another timing detail with false fails?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think I was misunderstanding. You are saying only do the check if the core is not loaded by then?  That almost seems like we are just adding nothing to that test then - it wouldn&apos;t fail without the change like the current one does. I think if we start seeing false fails in the jenkins cluster, we should do something more invasive. &lt;/p&gt;</comment>
                            <comment id="14550550" author="markrmiller@gmail.com" created="Tue, 19 May 2015 14:43:34 +0000"  >&lt;p&gt;Cleans up the remaining issues except the quality of the test.&lt;/p&gt;</comment>
                            <comment id="14551049" author="andyetitmoves" created="Tue, 19 May 2015 19:16:33 +0000"  >&lt;p&gt;It would still check if you correctly return a 5xx when you are not loaded, but I see your point. In order to properly test for the async nature, you would need to pass down a latch which prevents completion till you release it from the test, aka the invasive bit you refer to &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Okay, +1 from me then..&lt;/p&gt;</comment>
                            <comment id="14561158" author="jira-bot" created="Wed, 27 May 2015 15:37:31 +0000"  >&lt;p&gt;Commit 1682060 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1682060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1682060&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7361&quot; title=&quot;Main Jetty thread blocked by core loading delays HTTP listener from binding if core loading is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7361&quot;&gt;&lt;del&gt;SOLR-7361&lt;/del&gt;&lt;/a&gt;: Slow loading SolrCores should not hold up all other SolrCores that have finished loading from serving requests.&lt;/p&gt;</comment>
                            <comment id="14561175" author="jira-bot" created="Wed, 27 May 2015 15:50:18 +0000"  >&lt;p&gt;Commit 1682065 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1682065&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1682065&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7361&quot; title=&quot;Main Jetty thread blocked by core loading delays HTTP listener from binding if core loading is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7361&quot;&gt;&lt;del&gt;SOLR-7361&lt;/del&gt;&lt;/a&gt;: Slow loading SolrCores should not hold up all other SolrCores that have finished loading from serving requests.&lt;/p&gt;</comment>
                            <comment id="14564888" author="markrmiller@gmail.com" created="Fri, 29 May 2015 14:29:21 +0000"  >&lt;p&gt;Thanks all! This is a great improvement.&lt;/p&gt;</comment>
                            <comment id="14713227" author="shalinmangar" created="Wed, 26 Aug 2015 13:06:08 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12821991">SOLR-7416</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12733828" name="SOLR-7361.patch" size="33453" author="markrmiller@gmail.com" created="Tue, 19 May 2015 14:43:34 +0000"/>
                            <attachment id="12733813" name="SOLR-7361.patch" size="33039" author="markrmiller@gmail.com" created="Tue, 19 May 2015 13:36:17 +0000"/>
                            <attachment id="12729472" name="SOLR-7361.patch" size="32309" author="markrmiller@gmail.com" created="Thu, 30 Apr 2015 11:55:09 +0000"/>
                            <attachment id="12726392" name="SOLR-7361.patch" size="14991" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 20:44:47 +0000"/>
                            <attachment id="12726360" name="SOLR-7361.patch" size="14357" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 13:35:09 +0000"/>
                            <attachment id="12726358" name="SOLR-7361.patch" size="14279" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 12:21:39 +0000"/>
                            <attachment id="12726354" name="SOLR-7361.patch" size="8766" author="markrmiller@gmail.com" created="Sat, 18 Apr 2015 11:44:13 +0000"/>
                            <attachment id="12725073" name="SOLR-7361.patch" size="7929" author="thelabdude" created="Mon, 13 Apr 2015 22:32:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cx9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>