<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:30:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3831] atomic updates do not distribute correctly to other nodes</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3831</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;After setting up two independent solr nodes using the SolrCloud tutorial, atomic updates to a field of type &quot;payloads&quot; gives an error when updating the destination node.&lt;/p&gt;

&lt;p&gt;The error is:&lt;/p&gt;

&lt;p&gt;SEVERE: java.lang.NumberFormatException: For input string: &quot;100}&quot;&lt;/p&gt;

&lt;p&gt;The input sent to the first node is in the expected default format for a payload field (eg &quot;foo|100&quot;) and that update succeeds. I&apos;ve found that the update always works for the first node, but never the second.&lt;/p&gt;

&lt;p&gt;I&apos;ve tested each server running independently and found that this update works as expected.&lt;/p&gt;


</description>
                <environment>&lt;p&gt;linux&lt;/p&gt;</environment>
        <key id="12607344">SOLR-3831</key>
            <summary>atomic updates do not distribute correctly to other nodes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="jimtronic">Jim Musil</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Sep 2012 21:35:38 +0000</created>
                <updated>Mon, 9 May 2016 18:59:10 +0000</updated>
                            <resolved>Sat, 15 Sep 2012 17:49:01 +0000</resolved>
                                    <version>4.0-BETA</version>
                                    <fixVersion>4.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13455361" author="jimtronic" created="Thu, 13 Sep 2012 22:13:06 +0000"  >&lt;p&gt;Actually, it appears that atomic updates to any type of field do not distribute correctly to the other nodes.&lt;/p&gt;

&lt;p&gt;The root problem seems to be that when the subsequent node receives the update request, it does not apply any of the atomic update logic that&apos;s been added to DistributedUpdateProccessor.getUpdatedDocument(). Instead it tries to use the string representation of the Map object (eg &quot;&lt;/p&gt;
{set=1}
&lt;p&gt;&quot;) as the value.&lt;/p&gt;

&lt;p&gt;If I send the following json to update &lt;span class=&quot;error&quot;&gt;&amp;#91;{&amp;quot;id&amp;quot;:&amp;quot;1&amp;quot;, &amp;quot;cat_s&amp;quot;:{&amp;quot;set&amp;quot;:&amp;quot;999&amp;quot;}}&amp;#93;&lt;/span&gt; The leader sets it correctly without deleting the other fields. Node 2, however, sets the value of cat_s to be &quot;&lt;/p&gt;
{set=999}
&lt;p&gt;&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;ve hacked a solution by forcing all update requests to use getUpdatedDocument(), but I&apos;m not clear what other effects this may have.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what the correct solution should be, but I&apos;m willing to try to patch it.&lt;/p&gt;
</comment>
                            <comment id="13455502" author="yseeley@gmail.com" created="Fri, 14 Sep 2012 00:57:15 +0000"  >&lt;p&gt;Thanks for the report Jim, this looks serious.  I&apos;ve marked this as a blocker for 4.0.&lt;/p&gt;

&lt;p&gt;There are some very basic tests for cloud mode in BasicDistributedZkTest.doOptimisticLockingAndUpdating(), but it should have been enough to catch an issue like this.&lt;/p&gt;</comment>
                            <comment id="13455508" author="yseeley@gmail.com" created="Fri, 14 Sep 2012 01:10:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;The root problem seems to be that when the subsequent node receives the update request, it does not apply any of the atomic update logic&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We shouldn&apos;t need to at that point.&lt;br/&gt;
The current logic is for the leader to retrieve the correct document, apply the updates, then index as a normal document as well as forward to all replicas.&lt;/p&gt;</comment>
                            <comment id="13455958" author="jimtronic" created="Fri, 14 Sep 2012 17:21:24 +0000"  >&lt;p&gt;Ok, that makes sense. I don&apos;t think that&apos;s what the code is doing, however. The logic appears to be:&lt;/p&gt;

&lt;p&gt;1. clone the input doc&lt;br/&gt;
2. apply atomic update logic to produce full doc&lt;br/&gt;
3. add the full doc locally&lt;br/&gt;
4. revert back to the original input doc&lt;br/&gt;
5. distribute the command to other nodes&lt;/p&gt;

&lt;p&gt;A problem occurs deep within #5 because there&apos;s no atomic update logic built into the distribAdd() chain for converting &quot;add&quot;, &quot;set&quot;, or &quot;inc&quot; into a proper LuceneDocument.&lt;/p&gt;

&lt;p&gt;By simply commenting out this line (343 on trunk) in DistributedUpdateProcessor.java, the updates go through correctly.&lt;/p&gt;

&lt;p&gt;   &lt;tt&gt;cmd.solrDoc = clonedDoc;&lt;/tt&gt;&lt;/p&gt;



</comment>
                            <comment id="13456052" author="yseeley@gmail.com" created="Fri, 14 Sep 2012 19:22:44 +0000"  >&lt;p&gt;Thanks for investigating Jim - the &quot;clone the input doc&quot; definitely doesn&apos;t belong first!&lt;/p&gt;</comment>
                            <comment id="13456122" author="jimtronic" created="Fri, 14 Sep 2012 20:31:44 +0000"  >&lt;p&gt;No problem. I&apos;m very eager to start using them. Let me know if there&apos;s something I can do to help.&lt;/p&gt;</comment>
                            <comment id="13456231" author="markrmiller@gmail.com" created="Fri, 14 Sep 2012 23:43:21 +0000"  >&lt;p&gt;patch that moves the clone - also only does it if we are actually going to distribute the update&lt;/p&gt;</comment>
                            <comment id="13456456" author="markrmiller@gmail.com" created="Sat, 15 Sep 2012 17:49:01 +0000"  >&lt;p&gt;Fix committed - thanks Jim!&lt;/p&gt;</comment>
                            <comment id="13494980" author="commit-tag-bot" created="Sun, 11 Nov 2012 20:28:01 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1385138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1385138&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3831&quot; title=&quot;atomic updates do not distribute correctly to other nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3831&quot;&gt;&lt;del&gt;SOLR-3831&lt;/del&gt;&lt;/a&gt;: Atomic updates do not distribute correctly to other nodes.&lt;/p&gt;
</comment>
                            <comment id="13495157" author="markus17" created="Mon, 12 Nov 2012 08:48:02 +0000"  >&lt;p&gt;Hi - i&apos;ve seen some issues being committed to 4x branch but not for trunk yet this and other issues are marked as resolved. Are they going to be committed to trunk? thanks&lt;/p&gt;</comment>
                            <comment id="13495280" author="markrmiller@gmail.com" created="Mon, 12 Nov 2012 14:21:13 +0000"  >&lt;p&gt;This should be in trunk.&lt;/p&gt;

&lt;p&gt;You may be confused by the above commit bot message?&lt;/p&gt;

&lt;p&gt;New tool I&apos;m working on, and yesterday I accidentally triggered it for my name in the last 400 or so commits, but only for 4x - I stopped it before it did 5x.&lt;/p&gt;

&lt;p&gt;So if you know something is not on 5x that is on 4x, we need to fix it. But don&apos;t go by the commit bot messages for these past issues - hoping that&apos;s something you can count on in the future, but it&apos;s in development at the moment.&lt;/p&gt;</comment>
                            <comment id="13495294" author="markus17" created="Mon, 12 Nov 2012 14:37:19 +0000"  >&lt;p&gt;I was indeed confused. Thanks!&lt;/p&gt;</comment>
                            <comment id="13610832" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:38:38 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1385138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1385138&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3831&quot; title=&quot;atomic updates do not distribute correctly to other nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3831&quot;&gt;&lt;del&gt;SOLR-3831&lt;/del&gt;&lt;/a&gt;: Atomic updates do not distribute correctly to other nodes.&lt;/p&gt;</comment>
                            <comment id="13653977" author="thetaphi" created="Fri, 10 May 2013 10:33:37 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545242" name="SOLR-3831.patch" size="2445" author="markrmiller@gmail.com" created="Fri, 14 Sep 2012 23:45:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243162</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03cdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>