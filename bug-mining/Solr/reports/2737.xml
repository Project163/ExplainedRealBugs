<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:10:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7304] Spellcheck.collate Sometimes Invalidates Range Queries</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7304</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I have an error with SpellCheckComponent since I have added this SearchComponent to /select RequestHandler (see solrconfig.xml).&lt;/p&gt;

&lt;p&gt;  &amp;lt;requestHandler name=&quot;/select&quot; class=&quot;solr.SearchHandler&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;!-- default values for query parameters can be specified, these&lt;br/&gt;
         will be overridden by parameters in the request&lt;br/&gt;
      --&amp;gt;&lt;br/&gt;
     &amp;lt;lst name=&quot;defaults&quot;&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;echoParams&quot;&amp;gt;explicit&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;int name=&quot;rows&quot;&amp;gt;10&amp;lt;/int&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;df&quot;&amp;gt;titre&amp;lt;/str&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;!-- h4k1m: configure spellcheck if enabled --&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck&quot;&amp;gt;on&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.dictionary&quot;&amp;gt;default&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.extendedResults&quot;&amp;gt;true&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.count&quot;&amp;gt;3&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.alternativeTermCount&quot;&amp;gt;3&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.maxResultsForSuggest&quot;&amp;gt;5&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.collate&quot;&amp;gt;true&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.collateExtendedResults&quot;&amp;gt;true&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.maxCollationTries&quot;&amp;gt;10&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.maxCollations&quot;&amp;gt;1&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;spellcheck.onlyMorePopular&quot;&amp;gt;false&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;combineWords&quot;&amp;gt;false&amp;lt;/str&amp;gt;&lt;br/&gt;
     &amp;lt;/lst&amp;gt;&lt;/p&gt;

&lt;p&gt;The error seems to be related to range queries, with the &lt;span class=&quot;error&quot;&gt;&amp;#91;.. to ..&amp;#93;&lt;/span&gt; written in lowercase. The query performed by the SpellCheck component using &apos;to&apos; in lower case throws the RANGE_GOOP error.&lt;/p&gt;

&lt;p&gt;101615 &lt;span class=&quot;error&quot;&gt;&amp;#91;qtp2145626092-38&amp;#93;&lt;/span&gt; WARN  org.apache.solr.spelling.SpellCheckCollator  - Exception trying to re-query to check if a spell check possibility would return any hits.&lt;br/&gt;
org.apache.solr.common.SolrException: org.apache.solr.search.SyntaxError: Cannot parse &apos;offredemande:offre AND categorieparente:&quot;audi&quot; AND prix:[2000016 to 2250008} AND anneemodele:[2003 to 2008} AND etat:&quot;nauf&quot;&apos;: Encountered &quot; &amp;lt;RANGE_GOOP&amp;gt; &quot;2250008 &quot;&quot; at line 1, column 68.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &quot;]&quot; ...&lt;br/&gt;
    &quot;}&quot; ...&lt;/p&gt;

&lt;p&gt;        at org.apache.solr.handler.component.QueryComponent.prepare(QueryComponent.java:205)&lt;br/&gt;
        at org.apache.solr.spelling.SpellCheckCollator.collate(SpellCheckCollator.java:141)&lt;br/&gt;
        at org.apache.solr.handler.component.SpellCheckComponent.addCollationsToResponse(SpellCheckComponent.java:230)&lt;br/&gt;
        at org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:197)&lt;br/&gt;
        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:218)&lt;br/&gt;
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)&lt;br/&gt;
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1962)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:777)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:418)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:207)&lt;br/&gt;
        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1645)&lt;br/&gt;
        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:564)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)&lt;br/&gt;
        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:578)&lt;br/&gt;
        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:221)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1111)&lt;br/&gt;
        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:498)&lt;br/&gt;
        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:183)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1045)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:199)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.IPAccessHandler.handle(IPAccessHandler.java:220)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:109)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:98)&lt;br/&gt;
        at org.eclipse.jetty.server.Server.handle(Server.java:461)&lt;br/&gt;
        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:284)&lt;br/&gt;
        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)&lt;br/&gt;
        at org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:534)&lt;br/&gt;
        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:607)&lt;br/&gt;
        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:536)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
Caused by: org.apache.solr.search.SyntaxError: Cannot parse &apos;offredemande:offre AND categorieparente:&quot;audi&quot; AND prix:[2000016 to 2250008} AND anneemodele:[2003 to 2008} AND etat:&quot;nauf&quot;&apos;: Encountered &quot; &amp;lt;RANGE_GOOP&amp;gt; &quot;2250008 &quot;&quot; at line 1, column 68.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &quot;]&quot; ...&lt;br/&gt;
    &quot;}&quot; ...&lt;/p&gt;

&lt;p&gt;        at org.apache.solr.parser.SolrQueryParserBase.parse(SolrQueryParserBase.java:156)&lt;br/&gt;
        at org.apache.solr.search.LuceneQParser.parse(LuceneQParser.java:50)&lt;br/&gt;
        at org.apache.solr.search.QParser.getQuery(QParser.java:141)&lt;br/&gt;
        at org.apache.solr.handler.component.QueryComponent.prepare(QueryComponent.java:148)&lt;br/&gt;
        ... 30 more&lt;br/&gt;
Caused by: org.apache.solr.parser.ParseException: Encountered &quot; &amp;lt;RANGE_GOOP&amp;gt; &quot;2250008 &quot;&quot; at line 1, column 68.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &quot;]&quot; ...&lt;br/&gt;
    &quot;}&quot; ...&lt;/p&gt;

&lt;p&gt;        at org.apache.solr.parser.QueryParser.generateParseException(QueryParser.java:649)&lt;br/&gt;
        at org.apache.solr.parser.QueryParser.jj_consume_token(QueryParser.java:531)&lt;br/&gt;
        at org.apache.solr.parser.QueryParser.Term(QueryParser.java:358)&lt;br/&gt;
        at org.apache.solr.parser.QueryParser.Clause(QueryParser.java:185)&lt;br/&gt;
        at org.apache.solr.parser.QueryParser.Query(QueryParser.java:139)&lt;br/&gt;
        at org.apache.solr.parser.QueryParser.TopLevelQuery(QueryParser.java:96)&lt;br/&gt;
        at org.apache.solr.parser.SolrQueryParserBase.parse(SolrQueryParserBase.java:152)&lt;br/&gt;
        ... 33 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;Jetty&lt;br/&gt;
Debian&lt;/p&gt;</environment>
        <key id="12785482">SOLR-7304</key>
            <summary>Spellcheck.collate Sometimes Invalidates Range Queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdyer">James Dyer</assignee>
                                    <reporter username="h4k1m">Hakim</reporter>
                        <labels>
                            <label>range</label>
                            <label>spellchecker</label>
                    </labels>
                <created>Wed, 25 Mar 2015 11:07:33 +0000</created>
                <updated>Tue, 23 Feb 2016 10:40:00 +0000</updated>
                            <resolved>Mon, 7 Dec 2015 15:59:05 +0000</resolved>
                                    <version>4.9</version>
                                    <fixVersion>4.9</fixVersion>
                    <fixVersion>5.5</fixVersion>
                                    <component>spellchecker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14381803" author="h4k1m" created="Thu, 26 Mar 2015 12:37:44 +0000"  >&lt;p&gt;It seems that spellcheck.collate is causing this error, because when I set it to false the error disappeared from log files.&lt;/p&gt;</comment>
                            <comment id="14384061" author="jdyer" created="Fri, 27 Mar 2015 16:11:59 +0000"  >&lt;p&gt;Can you post the original query request here?  Are you saying the collator is making the word &quot;to&quot; lowercase so that when it tries to test the collation, the query is invalid?  Or did the original query have invalid range syntax as well?  Also, it looks like the closing bracket in incorrect?  I&apos;m seeing a } instead of a ] .  Did the original query have incorrect brackets as well or did this get introduced by the collator? (or did jira corrupt this?)&lt;/p&gt;</comment>
                            <comment id="14385689" author="h4k1m" created="Sun, 29 Mar 2015 09:49:09 +0000"  >&lt;p&gt;Actually, the collator is making all the query lowercase.&lt;br/&gt;
No, the original query work well (the range work well too, Square brackets (in Lucene) are supposed to represent an inclusive range and Curly brackets represent an exclusive range).&lt;/p&gt;

&lt;p&gt; I bypassed this error by setting this property in the spellcheck searchComponent &amp;lt;str name=&quot;queryAnalyzerFieldType&quot;&amp;gt;text_suggest&amp;lt;/str&amp;gt;. Note that text_suggest is a custom field type I created which is a copy of text_general without the solr.LowerCaseFilterFactory filter in the query analyzer:&lt;/p&gt;

&lt;p&gt;    &amp;lt;fieldType name=&quot;text_suggest&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;analyzer type=&quot;query&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;tokenizer class=&quot;solr.StandardTokenizerFactory&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.StopFilterFactory&quot; ignoreCase=&quot;true&quot; words=&quot;stopwords.txt&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.SynonymFilterFactory&quot; synonyms=&quot;synonyms.txt&quot; ignoreCase=&quot;true&quot; expand=&quot;true&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;!-- h4k1m: no lower case on query (fix bug with spellcheck queries) --&amp;gt;&lt;br/&gt;
        &amp;lt;!-- &amp;lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&amp;gt; --&amp;gt;&lt;br/&gt;
      &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
    &amp;lt;/fieldType&amp;gt;&lt;/p&gt;

&lt;p&gt;I think that&apos;s what caused the spellcheck query to be lowercased.&lt;/p&gt;</comment>
                            <comment id="14548330" author="pparsons" created="Mon, 18 May 2015 17:21:47 +0000"  >&lt;p&gt;I&apos;m getting the same problem on version 5.0&lt;/p&gt;</comment>
                            <comment id="15042237" author="jdyer" created="Fri, 4 Dec 2015 21:06:17 +0000"  >&lt;p&gt;Attached is a patch with a failing unit test.  To reproduce this issue we use &quot;spellcheck.alternativeTermCount&quot; while having the word &quot;to&quot; in the index.  We also use a &quot;queryAnalyzerFieldType&quot; that performs lowercasing.&lt;/p&gt;

&lt;p&gt;The test case queries:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;id:&lt;span class=&quot;error&quot;&gt;&amp;#91;1 TO 10&amp;#93;&lt;/span&gt; AND lowerfilt:lovw&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;And expects back:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;id:&lt;span class=&quot;error&quot;&gt;&amp;#91;1 TO 10&amp;#93;&lt;/span&gt; AND lowerfilt:love&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But instead gets:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;id:&lt;span class=&quot;error&quot;&gt;&amp;#91;1 to 10&amp;#93;&lt;/span&gt; AND lowerfilt:love&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Both &quot;to&quot; and &quot;and&quot; are in the index.  However, SpellingQueryConverter treats the boolean AND/OR/NOT operators special.  I think the easiest fix here is to have S.Q.C. also treat &quot;TO&quot; special, at least in cases where it occurs somewhat after [ or &lt;/p&gt;
{ and somewhat before ] or }
&lt;p&gt;.&lt;/p&gt;</comment>
                            <comment id="15042318" author="jdyer" created="Fri, 4 Dec 2015 22:12:59 +0000"  >&lt;p&gt;Here is a patch with the fix.  I will commit this next week if everything checks out ok.&lt;/p&gt;</comment>
                            <comment id="15045116" author="jira-bot" created="Mon, 7 Dec 2015 15:55:42 +0000"  >&lt;p&gt;Commit 1718415 from jdyer@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1718415&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1718415&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7304&quot; title=&quot;Spellcheck.collate Sometimes Invalidates Range Queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7304&quot;&gt;&lt;del&gt;SOLR-7304&lt;/del&gt;&lt;/a&gt;: SpellingQueryConverter to ignore &quot;TO&quot; as a possible range query operator&lt;/p&gt;</comment>
                            <comment id="15045125" author="jira-bot" created="Mon, 7 Dec 2015 15:58:26 +0000"  >&lt;p&gt;Commit 1718416 from jdyer@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1718416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1718416&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7304&quot; title=&quot;Spellcheck.collate Sometimes Invalidates Range Queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7304&quot;&gt;&lt;del&gt;SOLR-7304&lt;/del&gt;&lt;/a&gt;: SpellingQueryConverter to ignore &quot;TO&quot; as a possible range query operator&lt;/p&gt;</comment>
                            <comment id="15045126" author="jdyer" created="Mon, 7 Dec 2015 15:59:05 +0000"  >&lt;p&gt;Thanks Hakim for reporting this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12775867" name="SOLR-7304.patch" size="3621" author="jdyer" created="Fri, 4 Dec 2015 22:12:59 +0000"/>
                            <attachment id="12775854" name="SOLR-7304.patch" size="2467" author="jdyer" created="Fri, 4 Dec 2015 21:06:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27bx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>