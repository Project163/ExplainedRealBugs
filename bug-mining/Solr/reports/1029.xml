<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:30:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3595] Currency types do not support range queries when multiValued</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3595</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;You can define the currency type as multiValued. However, if you do (and have more than one value), range queries, at least, do not work. See the thread titled &quot;Filtering a query by range returning unexpected results&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;m not at all sure that currency type &lt;em&gt;should&lt;/em&gt; support multivalued. For instance, how would one handle storing multiple values for a currency type in different currencies (e.g. USD and EUR)? I don&apos;t know enough about the internals to understand if it&apos;s possible, this JIRA is the result of a question on the users list.&lt;/p&gt;

&lt;p&gt;If we decide that currency should &lt;em&gt;not&lt;/em&gt; support multiValued, it seems a check at startup is in order on the &quot;fail early, fail loudly&quot; principle.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597662">SOLR-3595</key>
            <summary>Currency types do not support range queries when multiValued</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                            <label>CurrencyField</label>
                    </labels>
                <created>Thu, 5 Jul 2012 22:14:01 +0000</created>
                <updated>Mon, 9 May 2016 18:52:57 +0000</updated>
                            <resolved>Tue, 11 Sep 2012 23:21:20 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13407547" author="thetaphi" created="Thu, 5 Jul 2012 22:17:22 +0000"  >&lt;p&gt;Multivalued does not work with fields that consist of more than one Lucene field behind, because the field vales cannot be corelated. We should disallow multi value and throw exception. This is similar to LatLong fields I think.&lt;/p&gt;</comment>
                            <comment id="13410900" author="janhoy" created="Tue, 10 Jul 2012 21:05:02 +0000"  >&lt;p&gt;+1&lt;br/&gt;
Disallowing multivalue sounds like the right approach, then if anyone figures out how to support it in the future it can be done then, not now.&lt;/p&gt;</comment>
                            <comment id="13412106" author="hossman" created="Wed, 11 Jul 2012 22:26:02 +0000"  >&lt;p&gt;bulk fixing the version info for 4.0-ALPHA and 4.0 all affected issues have &quot;hoss20120711-bulk-40-change&quot; in comment&lt;/p&gt;</comment>
                            <comment id="13414815" author="erickerickson" created="Mon, 16 Jul 2012 00:33:58 +0000"  >&lt;p&gt;This can be done pretty easily by overriding isMultiValued in CurrencyField and hard-coding returning false. Seems a little harsh and is confusing. I can define a field with multiValued=&quot;true&quot; and then get an error saying &quot;multiple values encountered for non multiValued field.....&quot; Huh?.&lt;/p&gt;

&lt;p&gt;One way to handle this would be to also provide a default method in FieldType, something about &quot;getNonMultivaluedMsg()&quot; (what a bad name!) and overriding that too. Kludgy but minimal code.&lt;/p&gt;

&lt;p&gt;We can also just change the test around line 241 in DocumentBuilder to check for isPolyField, but I&apos;d have to wash my hands afterward...&lt;br/&gt;
replace&lt;br/&gt;
if( sfield!=null &amp;amp;&amp;amp; !sfield.multiValued() &amp;amp;&amp;amp; field.getValueCount() &amp;gt; 1 ) {&lt;br/&gt;
with&lt;br/&gt;
if( sfield!=null &amp;amp;&amp;amp; (!sfield.multiValued() || sfield.isPolyField()) &amp;amp;&amp;amp; field.getValueCount() &amp;gt; 1 ) {&lt;br/&gt;
This kind of awful hack would probably be really bad for polygons in spatial, but I haven&apos;t looked.&lt;/p&gt;

&lt;p&gt;I&apos;d prefer to &quot;fail early, fail often&quot; and catch this when the schema file was being parsed, but I don&apos;t see a convenient place to do that. Am I overlooking the obvious again?&lt;/p&gt;

&lt;p&gt;Or is there another way to approach this altogether?&lt;/p&gt;</comment>
                            <comment id="13424237" author="hossman" created="Sat, 28 Jul 2012 00:39:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;d prefer to &quot;fail early, fail often&quot; and catch this when the schema file was being parsed, but I don&apos;t see a convenient place to do that. Am I overlooking the obvious again?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;can&apos;t we just put hte logic in CurrencyField.init(), after the call to super.init() ... &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isMultiValued()) { 
 &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException(&lt;span class=&quot;code-quote&quot;&gt;&quot;CurrencyField&apos;s can not be multivalued: &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.typeName) 
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;?&lt;/p&gt;

&lt;p&gt;(see BadIndexSchemaTest for an example of how to test that it fails properly)&lt;/p&gt;</comment>
                            <comment id="13429774" author="rcmuir" created="Tue, 7 Aug 2012 03:42:54 +0000"  >&lt;p&gt;rmuir20120906-bulk-40-change&lt;/p&gt;</comment>
                            <comment id="13451147" author="hossman" created="Fri, 7 Sep 2012 23:51:53 +0000"  >&lt;p&gt;assigning to myself to try my suggestion when i have some more time, anyone with an itch to deal with this should not hesitate to take it from me&lt;/p&gt;</comment>
                            <comment id="13453509" author="hossman" created="Tue, 11 Sep 2012 22:44:57 +0000"  >&lt;p&gt;My suggestion addressed the situation of trying to decalre the fieldType as multiValued, but did nothing to address fields &amp;amp; dynamic fields that were explicitly declared multiValued.&lt;/p&gt;

&lt;p&gt;So in the attached patch i introduce a new method into the FieldType api called &quot;checkSchemaField&quot; which the SchemaField constructor uses to let the FieldType check the instance for errors that violate any invariants about hte field type.  the default impl is a NOOP and CurrencyField overrides this.&lt;/p&gt;

&lt;p&gt;Would like someone to sanity check that this approach is a good idea (seems like it would definitely have other uses moving forward) otherwise i think it&apos;s feasible solution to the currency multivalued problem and we should get it in for 4.0&lt;/p&gt;</comment>
                            <comment id="13453519" author="yseeley@gmail.com" created="Tue, 11 Sep 2012 22:56:33 +0000"  >&lt;p&gt;Relatively unobtrusive... seems fine to me.&lt;/p&gt;</comment>
                            <comment id="13453542" author="hossman" created="Tue, 11 Sep 2012 23:21:20 +0000"  >&lt;p&gt;r1383648 - 4x&lt;br/&gt;
r1383653 - trunk&lt;/p&gt;</comment>
                            <comment id="13453546" author="hossman" created="Tue, 11 Sep 2012 23:24:42 +0000"  >&lt;p&gt;Annnnnnnnd i had the wrong issue# in changes, now fixed...&lt;/p&gt;

&lt;p&gt;Committed revision 1383654.&lt;br/&gt;
Committed revision 1383655.&lt;/p&gt;</comment>
                            <comment id="13610877" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:41:49 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1383655&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1383655&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3595&quot; title=&quot;Currency types do not support range queries when multiValued&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3595&quot;&gt;&lt;del&gt;SOLR-3595&lt;/del&gt;&lt;/a&gt;: fix incorrect issue number in CHANGES.txt (merge r1383654)&lt;/p&gt;</comment>
                            <comment id="13654225" author="thetaphi" created="Fri, 10 May 2013 10:34:27 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544727" name="SOLR-3595.patch" size="11574" author="hossman" created="Tue, 11 Sep 2012 22:44:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243385</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03drb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>