<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:29:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3229] TermVectorComponent does not return terms in distributed search</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3229</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;TermVectorComponent does not return terms in distributed search, the distributedProcess() incorrectly uses Solr Unique Key to do subrequests, while process() expects Lucene document ids. Also, parameters are transferred in different format thus making distributed search returns no result.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 11.10, openjdk-6&lt;/p&gt;</environment>
        <key id="12545934">SOLR-3229</key>
            <summary>TermVectorComponent does not return terms in distributed search</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="xiehang">Hang Xie</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Sat, 10 Mar 2012 01:16:16 +0000</created>
                <updated>Mon, 9 May 2016 18:58:37 +0000</updated>
                            <resolved>Wed, 8 Aug 2012 18:23:45 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SearchComponents - other</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13226676" author="xiehang" created="Sat, 10 Mar 2012 01:17:27 +0000"  >&lt;p&gt;patch to TermVectorComponent.java&lt;/p&gt;</comment>
                            <comment id="13226677" author="xiehang" created="Sat, 10 Mar 2012 01:18:49 +0000"  >&lt;p&gt;Patch attached, tested in 4.0 environment (both distributed and non-distributed), it should work with 3.x but I didn&apos;t test.&lt;/p&gt;

&lt;p&gt;Everything is compatible with previous except name of lst, which used to be &quot;doc-&amp;lt;doc id&amp;gt;&quot;, and I changed it to Solr Unique Key as former may not be unique in multi-shard environment.&lt;/p&gt;</comment>
                            <comment id="13227736" author="xiehang" created="Mon, 12 Mar 2012 18:18:40 +0000"  >&lt;p&gt;Revised patch, no longer fails unit test.&lt;/p&gt;</comment>
                            <comment id="13228110" author="xiehang" created="Tue, 13 Mar 2012 00:59:34 +0000"  >&lt;p&gt;Revised, it seems distributedProcess() is unnecessary and can be removed, the only major change is add finishStage() to merge responses for subrequests to shards.&lt;/p&gt;</comment>
                            <comment id="13412128" author="hossman" created="Wed, 11 Jul 2012 22:26:06 +0000"  >&lt;p&gt;bulk fixing the version info for 4.0-ALPHA and 4.0 all affected issues have &quot;hoss20120711-bulk-40-change&quot; in comment&lt;/p&gt;</comment>
                            <comment id="13429847" author="rcmuir" created="Tue, 7 Aug 2012 03:43:33 +0000"  >&lt;p&gt;rmuir20120906-bulk-40-change&lt;/p&gt;</comment>
                            <comment id="13430859" author="hossman" created="Wed, 8 Aug 2012 04:28:53 +0000"  >&lt;p&gt;Hang: Thank you for your patch.&lt;/p&gt;

&lt;p&gt;I agree, the &quot;docid&quot; as a key is dangerous and misleading in distributed mode, and we should switch to using the uniqueKey when available, but if we leave things as you had it in your patch, existing (single node) users who don&apos;t have a uniqueKey field would no longer be able to get term vectors at all.&lt;/p&gt;

&lt;p&gt;I updated your patch to leave the key alone if there is no uniqueKey, and eliminate the &quot;doc-&quot; prefix when there is one.  I also added a new distributed test to prove that everything is working, and that turned up a few problems - some of which i fixed (dealing with warnings, and ensuring that TVC results are in the correct order for the result documents).&lt;/p&gt;

&lt;p&gt;One thing i discovered that i&apos;m not sure about is what to do about the &quot;df&quot; and &quot;tf-idf&quot; values when requested. in the test they have to be ignored because the way the distributed test works is to create a single node instance and compare it with a multi-node instance that has identical documents, and in the distributed TVC code, these won&apos;t match up &amp;#8211; but i&apos;m not sure if that&apos;s a bug (because the df &amp;amp; tf-idf values aren&apos;t &quot;merged&quot; from all nodes) or a feature (because you get the real df &amp;amp; tf-idf values for that term for that doc from the shard it lives in) ... either way it shouldn&apos;t stop fixing the basic problem of TVC failing painfully in a distributed request, so i&apos;ve opened &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3720&quot; title=&quot;TermVectorComponent: distributed results give raw df &amp;amp; tf-idf for terms, would be nice to also include &amp;quot;merged&amp;quot; aggregates from all shards&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3720&quot;&gt;SOLR-3720&lt;/a&gt; to track this in the future.&lt;/p&gt;

&lt;p&gt;feedback on this revised patch/test would be appreciated&lt;/p&gt;</comment>
                            <comment id="13430876" author="xiehang" created="Wed, 8 Aug 2012 05:24:05 +0000"  >&lt;p&gt;I use &quot;doc-0&quot; to make it compatible with single node mode so far as I can recall, as my client was expecting that for parser. It&apos;s all up to you to keep &quot;doc-&quot; or not - it seems to me if you keep it, you can reduce lots of changes in tests. Other than that I don&apos;t have any comment on test thinking of my little to no knowledge on solr&apos;s test framework.&lt;/p&gt;

&lt;p&gt;I remember I read something regarding df/tf-idf in distributed mode is a highly anticipated feature, I don&apos;t expect that can be done easily, I&apos;m good to have a bug there.&lt;/p&gt;</comment>
                            <comment id="13431199" author="hossman" created="Wed, 8 Aug 2012 16:18:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;I use &quot;doc-0&quot; to make it compatible with single node mode so far as I can recall ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;well, the biggest problem as i mentioned was thta you were &lt;b&gt;only&lt;/b&gt; including the vector information in the reqponse if there was a uniqueKey value&lt;/p&gt;

&lt;p&gt;the format might have looked consistent, and the resulting string values were consistent in the test &amp;#8211; but that was only a fluke of the fact that the uniqueKey values for the test docs were monotomicly increasing integers starting at &quot;0&quot; &amp;#8211; so they just happened to correspond with the internal lucene docids.&lt;/p&gt;

&lt;p&gt;i think changing the format to only use the &quot;doc-&quot; when there is not uniqueKeyField in the schema makes the most sense &amp;#8211; both because it helps make it clear when the output key is coming from the uniqueKey instead of the docid, and because moving forward that&apos;s the most logical thing for most users (who use a uniqueKey field)&lt;/p&gt;
</comment>
                            <comment id="13431269" author="hossman" created="Wed, 8 Aug 2012 18:23:45 +0000"  >&lt;p&gt;Committed revision 1370870. - trunk&lt;br/&gt;
Committed revision 1370871. - 4x&lt;/p&gt;
</comment>
                            <comment id="13653903" author="thetaphi" created="Fri, 10 May 2013 10:33:21 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                            <comment id="15058557" author="dsmiley" created="Tue, 15 Dec 2015 19:04:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; HighlightComponent, DebugComponent, and TermVectorComponent have a very similar bit of code in their finishStage() method. HighlightComponent &amp;amp; DebugComponent&apos;s version was recently found to be buggy &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8060&quot; title=&quot;NPE distributed HighlightComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8060&quot;&gt;&lt;del&gt;SOLR-8060&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8059&quot; title=&quot;NPE distributed DebugComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8059&quot;&gt;&lt;del&gt;SOLR-8059&lt;/del&gt;&lt;/a&gt;.  The Highlight side was recently fixed and I&apos;m about to do the same for Debug side.  But I&apos;d like to refactor out some common lines of code between all 3 to ease maintenance.  However the TV side has this odd bit where it if it can&apos;t lookup the shard doc by it&apos;s unique key, that it adds this to the response any way (~line 458).  &lt;em&gt;I would rather we remove this; I think it&apos;s not something we should support.  UniqueKey should be required for distributed-search to get TV info back&lt;/em&gt;.  The code that&apos;s here now incorrectly assumes that if it was unable to lookup the key in the resultIds that it&apos;s because the schema has no uniqueKey.  But another reason is just that it&apos;s a distrib.singlePass distributed search (related to the 2 bugs I&apos;m looking at in Highlight &amp;amp; Debug components).  Do you support my recommendation?&lt;/p&gt;</comment>
                            <comment id="15058606" author="hossman" created="Tue, 15 Dec 2015 19:24:01 +0000"  >&lt;p&gt;I don&apos;t remember this issue at all, and w/o digging into it&apos;s history or looking at teh commits, i&apos;m going to reply simply to this sentence...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;UniqueKey should be required for distributed-search to get TV info back. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have no objection to this.  if that&apos;s not how it works now, then i&apos;m surprised and If i&apos;m responsible for the code/decision in question then my suspicion is that it&apos;s simply because this issue predated SolrCloud and most of the other current &quot;rules&quot; regarding &quot;distributed search&quot; &amp;#8211; back when it was a query time only concept and people manually partitioned their shards.  it certainly pre-dates distrib.singlePass.&lt;/p&gt;

&lt;p&gt;open/link a new jira w/whatever changes you think make sense to the existing functionality.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12601672">SOLR-3718</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12922121">SOLR-8419</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12539769" name="SOLR-3229.patch" size="24924" author="hossman" created="Wed, 8 Aug 2012 04:28:53 +0000"/>
                            <attachment id="12518132" name="TermVectorComponent.patch" size="3552" author="xiehang" created="Tue, 13 Mar 2012 00:59:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231115</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03fxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18013</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>