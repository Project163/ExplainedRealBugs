<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:28:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2796] AddUpdateCommand.getIndexedId doesn&apos;t work with schema configured defaults/copyField - UUIDField/copyField can not be used as uniqueKey field</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2796</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;in Solr 1.4, and the HEAD of the 3x branch, the UUIDField can be used as the uniqueKey field even if documents do not specify a value by taking advantage of the &lt;tt&gt;default=&quot;NEW&quot;&lt;/tt&gt; feature of UUIDField.&lt;/p&gt;

&lt;p&gt;Similarly, a copyField can be used to populate the uniqueKey field with data from some field with another name &amp;#8211; multiple copyFields can even be used if there is no overlap (ie: if you have two differnet types of documents with no overlap in their id space, you can copy from companyId-&amp;gt;id and from productId-&amp;gt;id and use &quot;id&quot; as your uniqueKey field in solr)&lt;/p&gt;

&lt;p&gt;Neither of these approaches work in Solr trunk because of how &lt;tt&gt;AddUpdateCommand.getIndexedId&lt;/tt&gt; is currently used by the DirectUpdateHander2 (see &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1152500&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1152500&lt;/a&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12524767">SOLR-2796</key>
            <summary>AddUpdateCommand.getIndexedId doesn&apos;t work with schema configured defaults/copyField - UUIDField/copyField can not be used as uniqueKey field</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Sep 2011 00:00:44 +0000</created>
                <updated>Fri, 10 May 2013 10:40:37 +0000</updated>
                            <resolved>Fri, 1 Jun 2012 22:25:04 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>update</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13115053" author="hossman" created="Tue, 27 Sep 2011 00:02:40 +0000"  >&lt;p&gt;Example config...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;uuid&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.UUIDField&quot;&lt;/span&gt; indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
...
&amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;uuid&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;uuid&quot;&lt;/span&gt; indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; required=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;NEW&quot;&lt;/span&gt; /&amp;gt; 
...
&amp;lt;uniqueKey&amp;gt;uuid&amp;lt;/uniqueKey&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Resulting error when posting example docs...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SEVERE: org.apache.solr.common.SolrException: Document is missing mandatory uniqueKey field: uuid
	at org.apache.solr.update.AddUpdateCommand.getIndexedId(AddUpdateCommand.java:80)
	at org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:151)
	at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:60)
	at org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:115)
	at org.apache.solr.handler.XMLLoader.processUpdate(XMLLoader.java:133)
	at org.apache.solr.handler.XMLLoader.load(XMLLoader.java:78)
	at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:58)
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:1451)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13115078" author="hossman" created="Tue, 27 Sep 2011 00:35:18 +0000"  >&lt;p&gt;test only patch demonstrating problem &amp;#8211; passes on 3x, fails on trunk&lt;/p&gt;</comment>
                            <comment id="13182257" author="markrmiller@gmail.com" created="Sun, 8 Jan 2012 17:57:32 +0000"  >&lt;p&gt;We should fix this. Looks like it was introduced with extra error checking in in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2685&quot; title=&quot;always use SolrInputDocument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2685&quot;&gt;&lt;del&gt;SOLR-2685&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13251642" author="hossman" created="Wed, 11 Apr 2012 14:50:29 +0000"  >&lt;p&gt;as noted in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3349&quot; title=&quot;Required field cannot be satisfied by copyField&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3349&quot;&gt;&lt;del&gt;SOLR-3349&lt;/del&gt;&lt;/a&gt; the problem also exists if you use copyField to populate the uniqueKey.&lt;/p&gt;</comment>
                            <comment id="13281332" author="hossman" created="Wed, 23 May 2012 00:31:52 +0000"  >&lt;p&gt;Updating descriptiong after looking into it a bit more.&lt;/p&gt;

&lt;p&gt;Even if we reverted some of the logic in &lt;tt&gt;AddUpdateCommand.getIndexedId&lt;/tt&gt; to work the way &lt;tt&gt;DirectUpdateHandler.getIndexedId(Document)&lt;/tt&gt; did in the 3x branch, this defered/delayed creating of the uniqueKey field just fundamentally can&apos;t work in SolrCloud because we have to be able to determine the value for the uniqueKey field well before any schema defaults/copyFields so that the distrib processor knows which shard to forward to.&lt;/p&gt;

&lt;p&gt;I think we should bite the bullet and say &quot;Starting with Solr 4, schema defaults and copyFields can not be used to populate the uniqueKey field&quot; (we can even enforce this when parsing the schema - error if the uniqueKey field has a declared default or is the dest of a copyField) and provide UpdateProcessor alternatives for the behaviors that were previously possible with schema options...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;FielCopyUpdateProcessor - &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2599&quot; title=&quot;CloneFieldUpdateProcessor (copyField-equse equivilent)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2599&quot;&gt;&lt;del&gt;SOLR-2599&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;UUIDFieldUpdateProcessor - generates a new UUID for a configured field name if it doesn&apos;t already have a value in it&lt;/li&gt;
	&lt;li&gt;TimestampUpdateProcessor - generates a new Date for a configured field name if it doesn&apos;t already have a value in it (unlikely anyone is useing a DateField as their uniqueKey, but it&apos;s possible and fairly easy to offer this just in case)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;thoughts?&lt;/p&gt;</comment>
                            <comment id="13285237" author="hossman" created="Tue, 29 May 2012 23:01:02 +0000"  >&lt;p&gt;linking dependent issues.&lt;/p&gt;

&lt;p&gt;in addition to these, we&apos;ll also need new error checking for the copyField/defaultValue cases that are not going to be supported and a test that thye work properly&lt;/p&gt;</comment>
                            <comment id="13287741" author="hossman" created="Fri, 1 Jun 2012 22:25:05 +0000"  >&lt;p&gt;Committed revision 1345376. - trunk&lt;br/&gt;
Committed revision 1345378. - 4x&lt;/p&gt;

&lt;p&gt;Committed checking for these situations in IndexSchema along with explicit error messages.   Commit also includes a CHANGES.txt upgrading not about using UUIDUpdateProcessorFactory to have uniqueKey values generated automatically, note will need to be updated once copy-field-esque update processor is available (tracked in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2599&quot; title=&quot;CloneFieldUpdateProcessor (copyField-equse equivilent)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2599&quot;&gt;&lt;del&gt;SOLR-2599&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12510505">SOLR-2599</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12558508">SOLR-3495</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12550498">SOLR-3349</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12496598" name="SOLR-2796.patch" size="3748" author="hossman" created="Tue, 27 Sep 2011 00:35:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4134</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03iiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>