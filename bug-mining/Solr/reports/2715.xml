<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:09:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8309] TestRandomRequestDistribution test failures</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8309</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;There have been a couple of Jenkins failures for TestRandomRequestDistribution .&lt;/p&gt;

&lt;p&gt;Creating a Jira to track it&lt;/p&gt;</description>
                <environment></environment>
        <key id="12913919">SOLR-8309</key>
            <summary>TestRandomRequestDistribution test failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Nov 2015 23:38:27 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:26 +0000</updated>
                            <resolved>Fri, 20 Nov 2015 03:15:44 +0000</resolved>
                                                    <fixVersion>5.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15009865" author="varunthacker" created="Tue, 17 Nov 2015 23:52:37 +0000"  >&lt;p&gt;Build #3224:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Tests-5.x-Java7/3774/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Tests-5.x-Java7/3774/&lt;/a&gt;&lt;br/&gt;
seed: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant test  -Dtestcase=TestRandomRequestDistribution -Dtests.method=test -Dtests.seed=93AFEA957FE7F2C4 -Dtests.multiplier=2 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=en_SG -Dtests.timezone=Asia/Tehran -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=ISO-8859-1&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Build #624:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Tests-trunk-Java8/624/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Tests-trunk-Java8/624/&lt;/a&gt;&lt;br/&gt;
seed: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant test  -Dtestcase=TestRandomRequestDistribution -Dtests.method=test -Dtests.seed=A0F2F7B493EFD7DE -Dtests.multiplier=2 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=lt -Dtests.timezone=America/Anchorage -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=UTF-8&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Both seeds didn&apos;t reproduce for me. &lt;/p&gt;


&lt;p&gt;Excerpt from build #3224 . core= football_shard1_replica1 is in down state and the test is intentionally firing a query against it ( indicated with the &quot;Firing query against ...&quot; log line ) . The query should be executed by the other replica as football_shard1_replica1 is down ( it should be executed as a remote query ) . But it&apos;s failing to do so.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 200180 INFO  (OverseerStateUpdate-94882318989852676-127.0.0.1:55649_-n_0000000000) [n:127.0.0.1:55649_    ] o.a.s.c.Overseer processMessage: queueSize: 1, message = {
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:52095&quot;&lt;/span&gt;,
&lt;/span&gt;   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:52095_&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;football&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;football_shard1_replica1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&quot;&quot;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;down&quot;&lt;/span&gt;} current state version: 13
   [junit4]   2&amp;gt; 200180 INFO  (OverseerStateUpdate-94882318989852676-127.0.0.1:55649_-n_0000000000) [n:127.0.0.1:55649_    ] o.a.s.c.o.ReplicaMutator Update state numShards=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; message={
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:52095&quot;&lt;/span&gt;,
&lt;/span&gt;   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:52095_&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;football&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;football_shard1_replica1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&quot;&quot;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;down&quot;&lt;/span&gt;}
   
   [junit4]   2&amp;gt; 200283 INFO  (TEST-TestRandomRequestDistribution.test-seed#[93AFEA957FE7F2C4]) [    ] o.a.s.c.AbstractFullDistribZkTestBase Firing query against path=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:52095/football
&lt;/span&gt;
   [junit4]   2&amp;gt; 200286 INFO  (qtp388526047-770) [n:127.0.0.1:52095_ c:football s:shard1 r:core_node1 x:football_shard1_replica1] o.a.s.c.S.Request [football_shard1_replica1] webapp= path=/select params={q=*:*&amp;amp;wt=javabin&amp;amp;version=2} hits=0 status=0 QTime=0 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15009991" author="varunthacker" created="Wed, 18 Nov 2015 01:21:25 +0000"  >&lt;p&gt;This is an excerpt from a successful test run:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 283122 INFO  (zkCallback-171-thread-1-processing-n:127.0.0.1:56703_u_rq) [n:127.0.0.1:56703_u_rq    ] o.a.s.c.c.ZkStateReader Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; football from 6 to 7 
   [junit4]   2&amp;gt; 283122 INFO  (zkCallback-175-thread-1-processing-n:127.0.0.1:56707_u_rq) [n:127.0.0.1:56707_u_rq    ] o.a.s.c.c.ZkStateReader Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; football from 6 to 7 
   [junit4]   2&amp;gt; 283176 INFO  (TEST-TestRandomRequestDistribution.test-seed#[A0F2F7B493EFD7DE]) [n:127.0.0.1:56637_u_rq c:collection1 s:shard2 r:core_node3 x:collection1] o.a.s.c.AbstractFullDistribZkTestBase Firing query against path=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:56707/u_rq/football&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is an excerpt from build #624&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 555088 INFO  (TEST-TestRandomRequestDistribution.test-seed#[A0F2F7B493EFD7DE]) [    ] o.a.s.c.AbstractFullDistribZkTestBase Firing query against path=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:59394/u_rq/football
&lt;/span&gt;   [junit4]   2&amp;gt; 555091 INFO  (zkCallback-357-thread-1-processing-n:127.0.0.1:43311_u_rq) [n:127.0.0.1:43311_u_rq    ] o.a.s.c.c.ZkStateReader Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; football from 6 to 7 
   [junit4]   2&amp;gt; 555091 INFO  (zkCallback-353-thread-1-processing-n:127.0.0.1:59394_u_rq) [n:127.0.0.1:59394_u_rq    ] o.a.s.c.c.ZkStateReader Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; football from 6 to 7 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The difference seems to be that the zkCallback happens after the query is fired in the failed test runs ( same in build 3774 ) vs before in successful test runs.&lt;/p&gt;

&lt;p&gt;So essentially the cluster state does not know about the change when the query is fired hence it executes it against the down replica. &lt;/p&gt;

&lt;p&gt;Telling the test to sleep for sometime before executing the query will probably solve the problem but is there a better way to solve the problem?&lt;/p&gt;</comment>
                            <comment id="15012848" author="varunthacker" created="Thu, 19 Nov 2015 05:33:18 +0000"  >&lt;p&gt;Patch which waits for the cluster state to be updated by checking how the queries are being processed&lt;/p&gt;</comment>
                            <comment id="15015045" author="jira-bot" created="Fri, 20 Nov 2015 02:17:33 +0000"  >&lt;p&gt;Commit 1715314 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1715314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1715314&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8309&quot; title=&quot;TestRandomRequestDistribution test failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8309&quot;&gt;&lt;del&gt;SOLR-8309&lt;/del&gt;&lt;/a&gt;: the test waits for the cluster state to get updated locally before checking correctness of routing requests&lt;/p&gt;</comment>
                            <comment id="15015114" author="jira-bot" created="Fri, 20 Nov 2015 03:13:34 +0000"  >&lt;p&gt;Commit 1715316 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1715316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1715316&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8309&quot; title=&quot;TestRandomRequestDistribution test failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8309&quot;&gt;&lt;del&gt;SOLR-8309&lt;/del&gt;&lt;/a&gt;: the test waits for the cluster state to get updated locally before checking correctness of routing requests (merged trunk r1715314)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12855812">SOLR-7919</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12773176" name="SOLR-8309.patch" size="3451" author="varun" created="Thu, 19 Nov 2015 05:33:18 +0000"/>
                            <attachment id="12772871" name="build-3774.txt" size="1131722" author="varun" created="Tue, 17 Nov 2015 23:52:37 +0000"/>
                            <attachment id="12772870" name="build-624.txt" size="1113048" author="varun" created="Tue, 17 Nov 2015 23:52:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ojnr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>