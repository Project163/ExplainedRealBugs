<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:30:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12021] Utils.fromJSONResource(...) and ValidatingJsonMap.parse(...) open (resourse) InputStreams they don&apos;t close</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12021</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;A recurring theme that pops up now and then in non-reproducible test failures is for an error like this to show up in the log files when a core/collection is being created...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 674805 ERROR (qtp1337497394-5597) [n:127.0.0.1:55380_np_zxw c:collection2 s:shard6  x:collection2_shard6_replica_n29] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: Error CREATEing SolrCore &apos;collection2_shard6_replica_n29&apos;: Unable to create core [collection2_shard6_replica_n29] Caused by: invalid API spec: apispec/core.config.Commands.json
...
   [junit4]   2&amp;gt; Caused by: java.lang.RuntimeException: invalid API spec: apispec/core.config.Commands.json
   [junit4]   2&amp;gt;        at org.apache.solr.common.util.ValidatingJsonMap.parse(ValidatingJsonMap.java:318)
   [junit4]   2&amp;gt;        at org.apache.solr.common.util.Utils.lambda$getSpec$0(Utils.java:427)
   [junit4]   2&amp;gt;        at org.apache.solr.api.Api.getSpec(Api.java:65)
   [junit4]   2&amp;gt;        at org.apache.solr.api.ApiBag.register(ApiBag.java:73)
   [junit4]   2&amp;gt;        at org.apache.solr.core.PluginBag.put(PluginBag.java:217)
   [junit4]   2&amp;gt;        at org.apache.solr.core.PluginBag.init(PluginBag.java:274)
   [junit4]   2&amp;gt;        at org.apache.solr.core.RequestHandlers.initHandlersFromConfig(RequestHandlers.java:130)
   [junit4]   2&amp;gt;        at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:966)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I &lt;em&gt;believe&lt;/em&gt; that the root cause of these types of failures is that these API spec files are being loaded with &lt;tt&gt;ValidatingJsonMap.class.getClassLoader().getResourceAsStream(resourceName)&lt;/tt&gt; &amp;#8211; but nothing is ever closing the stream, so it can eventually (depending on what test classes run in each JVM and how many files they try to open like this) cause the JVM to hit the ulimit for open file handles &amp;#8211; but that specific cause of the failure is never reported, because &lt;tt&gt;ClassLoader.getResourseAsStream(...)&lt;/tt&gt; is explicity designed to swallow any IOExceptions encountered and just returns &quot;null&quot; (which triggers the &quot;invalid API spec: &quot; thrown by ValidatingJsonMap)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;tt&gt;ValidatingJsonMap.parse(...)&lt;/tt&gt; and the very similarly looking &lt;tt&gt;Utils.fromJSONResource(...)&lt;/tt&gt; should be modified to:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;ensure they always close the streams they open&lt;/li&gt;
	&lt;li&gt;use &lt;tt&gt;ClassLoader.getResource()&lt;/tt&gt; + &lt;tt&gt;URL.openConnection()&lt;/tt&gt; so that they can properly log if/when an underlying IOException occurs w/details&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13140354">SOLR-12021</key>
            <summary>Utils.fromJSONResource(...) and ValidatingJsonMap.parse(...) open (resourse) InputStreams they don&apos;t close</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Feb 2018 23:08:02 +0000</created>
                <updated>Sat, 8 Jun 2019 15:16:19 +0000</updated>
                            <resolved>Fri, 23 Feb 2018 18:53:06 +0000</resolved>
                                                    <fixVersion>7.3</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16373781" author="hossman" created="Fri, 23 Feb 2018 01:22:54 +0000"  >&lt;p&gt;I&apos;ve attached a patch i&apos;ll plan on committing tommorow unless there are objections.&lt;/p&gt;</comment>
                            <comment id="16374721" author="jira-bot" created="Fri, 23 Feb 2018 17:43:57 +0000"  >&lt;p&gt;Commit 9e0e301f9fe4a1b5e33925ae4d2848ead71cca25 in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9e0e301&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9e0e301&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12021&quot; title=&quot;Utils.fromJSONResource(...) and ValidatingJsonMap.parse(...) open (resourse) InputStreams they don&amp;#39;t close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12021&quot;&gt;&lt;del&gt;SOLR-12021&lt;/del&gt;&lt;/a&gt;: Fixed a bug in ApiSpec and other JSON resource loading that was causing unclosed file handles&lt;/p&gt;</comment>
                            <comment id="16374835" author="jira-bot" created="Fri, 23 Feb 2018 18:52:07 +0000"  >&lt;p&gt;Commit 378c743bd286478236bd5ba18d2fc3535afc3b08 in lucene-solr&apos;s branch refs/heads/branch_7x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=378c743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=378c743&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12021&quot; title=&quot;Utils.fromJSONResource(...) and ValidatingJsonMap.parse(...) open (resourse) InputStreams they don&amp;#39;t close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12021&quot;&gt;&lt;del&gt;SOLR-12021&lt;/del&gt;&lt;/a&gt;: Fixed a bug in ApiSpec and other JSON resource loading that was causing unclosed file handles&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 9e0e301f9fe4a1b5e33925ae4d2848ead71cca25)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13161179">SOLR-12386</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12911647" name="SOLR-12021.patch" size="3361" author="hossman" created="Fri, 23 Feb 2018 01:18:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qhxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>