<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:36:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13126] Multiplicative boost of isn&apos;t applied when one of the summed or multiplied queries doesn&apos;t match </title>
                <link>https://issues.apache.org/jira/browse/SOLR-13126</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Under certain circumstances search results from queries with multiple multiplicative boosts using the Solr functions &lt;tt&gt;product()&lt;/tt&gt; and &lt;tt&gt;query()&lt;/tt&gt; result in a score that is inconsistent with the one from the debugQuery information. Also only the debug score is correct while the actual search results show a wrong score.&lt;/p&gt;

&lt;p&gt;This seems somewhat similar to the behaviour described in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-7132&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-7132&lt;/a&gt;, though this issue has been resolved a while ago.&lt;/p&gt;

&lt;p&gt;A little background: we are using Solr as a search platform for the e-commerce framework SAP Hybris. There the shop administrator can create multiplicative boost rules (see below for an example) where a value like 2.0 means that an item gets boosted to 200%. This works fine in the demo shop distributed by SAP but breaks in our shop. We encountered the issue when Upgrading from Solr 7.2.1 / Hybris 6.7 to Solr 7.5 / Hybris 18.8.3 (which would have been named Hybris 6.8 but the version naming schema changed).&lt;/p&gt;

&lt;p&gt;We reduced the Solr query generated by Hybris to the relevant parts and could reproduce the issue in the Solr admin without any Hybris connection.&lt;/p&gt;

&lt;p&gt;I attached the JSON result of a test query but here&apos;s a description of the parts that seemed most relevant to me.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;responseHeader.params&lt;/tt&gt; reads (slightly rearranged):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;{!boost b=$ymb}(+{!lucene v=$yq})&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;ymb&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;product(query({!v=\&quot;&lt;/span&gt;name_text_de\\:Netzteil\\^=2.0\&lt;span class=&quot;code-quote&quot;&gt;&quot;},1),query({!v=\&quot;&lt;/span&gt;name_text_de\\:Sony\\^=3.0\&lt;span class=&quot;code-quote&quot;&gt;&quot;},1))&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;yq&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;sort&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;score desc&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;debugQuery&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
&lt;span class=&quot;code-comment&quot;&gt;// Added to keep the output small but probably unrelated to the actual issue
&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;score,id,code_string,name_text_de&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;catalogId:\&quot;&lt;/span&gt;someProducts\&quot;&quot;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;10&quot;&lt;/span&gt;,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This example boosts the German product name (field &lt;tt&gt;name_text_de&lt;/tt&gt;) in case in contains certain terms:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&quot;Netzteil&quot; (power supply) is boosted to 200%&lt;/li&gt;
	&lt;li&gt;&quot;Sony&quot; is boosted to 300%&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Consequently a product containing both terms should be boosted to 600%.&lt;/p&gt;

&lt;p&gt;Also the query function has the value 1 specified as default in case the name does not contain the respective term resulting in a pseudo boost that preserves the score.&lt;/p&gt;

&lt;p&gt;According to the debug information the parser used is the LuceneQParser, which translates this to the following parsed query:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;FunctionScoreQuery(FunctionScoreQuery(+&lt;b&gt;:&lt;/b&gt;, scored by boost(product(query((ConstantScore(name_text_de:netzteil))^2.0,def=1.0),query((ConstantScore(name_text_de:sony))^3.0,def=1.0)))))&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;And the translated boost is:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;org.apache.lucene.queries.function.valuesource.ProductFloatFunction:product(query((ConstantScore(name_text_de:netzteil))^2.0,def=1.0),query((ConstantScore(name_text_de:sony))^3.0,def=1.0))&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When taking a look at the search result, among other the following products are included (see the JSON comments for an analysis of each result):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;
     {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;someProducts/Online/test7111111&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;name_text_de&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Original Sony Vaio Netzteil&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;code_string&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test7111111&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-comment&quot;&gt;// CORRECT, both &lt;span class=&quot;code-quote&quot;&gt;&quot;Netzteil&quot;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;Sony&quot;&lt;/span&gt; are included &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; the name
&lt;/span&gt;        &lt;span class=&quot;code-quote&quot;&gt;&quot;score&quot;&lt;/span&gt;:6.0},
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;someProducts/Online/taxTestingProductThree&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;name_text_de&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Steuertestprodukt Zwei&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;code_string&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;taxTestingProductThree&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-comment&quot;&gt;// CORRECT, neither &lt;span class=&quot;code-quote&quot;&gt;&quot;Netzteil&quot;&lt;/span&gt; nor &lt;span class=&quot;code-quote&quot;&gt;&quot;Sony&quot;&lt;/span&gt; are included &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; the name
&lt;/span&gt;        &lt;span class=&quot;code-quote&quot;&gt;&quot;score&quot;&lt;/span&gt;:1.0},
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;someProducts/Online/797856300000&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;name_text_de&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;GS-Netzteil 20W schwarz&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;code_string&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;797856300000&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-comment&quot;&gt;// WRONG, &lt;span class=&quot;code-quote&quot;&gt;&quot;Netzteil&quot;&lt;/span&gt; is part of the name; 
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// note that we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; split words on hyphen because 
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// WordDelimiterGraphFilterFactory.generateWordParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;code-quote&quot;&gt;&quot;score&quot;&lt;/span&gt;:1.0},
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So apparently the multiplicative boost works for product names where all the boosted terms are included but fails if only one of the terms matches.&lt;/p&gt;

&lt;p&gt;There are also other products in the result that contain either &quot;Netzteil&quot; or &quot;Sony&quot; but still get a score of 1.0 instead of 2.0 resp. 3.0.&lt;/p&gt;

&lt;p&gt;Surprisingly in the &lt;tt&gt;explain&lt;/tt&gt; segment the score for the product with &quot;Netzteil&quot; but without &quot;Sony&quot; correctly is 2.0:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2.0 = product of:
  1.0 = boost
  2.0 = product of:
    1.0 = *:*
    2.0 = product(query((ConstantScore(name_text_de:netzteil))^2.0,def=1.0)=2.0,query((ConstantScore(name_text_de:sony))^3.0,def=1.0)=1.0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The type definition of &lt;tt&gt;text_de&lt;/tt&gt; in the &lt;tt&gt;schema.xml&lt;/tt&gt; (which is used for &quot;name_text_de&quot;) includes the following filters:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;text_de&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;analyzer&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
        &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WordDelimiterGraphFilterFactory&quot;&lt;/span&gt;  preserveOriginal=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;
                generateWordParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; generateNumberParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateWords=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;
                catenateNumbers=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateAll=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; splitOnCaseChange=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; /&amp;gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/analyzer&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/fieldType&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &lt;tt&gt;solrconfig.xml&lt;/tt&gt; mostly is taken form the Hybris defaults and AFAIK does not do anything kinky. The following lines might be of interest:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;luceneMatchVersion&amp;gt;&lt;/span&gt;7.5.0&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/luceneMatchVersion&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;queryParser name=&lt;span class=&quot;code-quote&quot;&gt;&quot;multiMaxScore&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;de.hybris.platform.solr.search.MultiMaxScoreQParserPlugin&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To sum it up, my expectation would have been:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The score in the result and explain section are identical.&lt;/li&gt;
	&lt;li&gt;Names matching only one of the two multiplied boost terms are receive the respective single boost instead of the default score 1.0.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Reproduced with macOS 10.14.1, a quick test with Windows 10 showed the same result.&lt;/p&gt;</environment>
        <key id="13208071">SOLR-13126</key>
            <summary>Multiplicative boost of isn&apos;t applied when one of the summed or multiplied queries doesn&apos;t match </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="roskakori">Thomas Aglassinger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Jan 2019 16:20:50 +0000</created>
                <updated>Thu, 7 Nov 2019 19:16:08 +0000</updated>
                            <resolved>Fri, 15 Feb 2019 11:31:23 +0000</resolved>
                                    <version>7.3</version>
                    <version>7.4</version>
                    <version>7.5</version>
                    <version>7.6</version>
                    <version>7.7</version>
                    <version>7.7.1</version>
                                    <fixVersion>7.7.2</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>16</watches>
                                                                                                                <comments>
                            <comment id="16742343" author="roskakori" created="Mon, 14 Jan 2019 17:39:24 +0000"  >&lt;p&gt;We&apos;ve been digging into this and managed to somewhat track the issue down although unfortunately our knowledge of the inner workings of Solr and Lucene in particular is not sufficient to fix it and provide a patch.&lt;/p&gt;

&lt;p&gt;We did however add logging statements that showcase the difference in the scoring for some trivial queries. To make the logging easier to read we refactored several anonymous classes to inner classes with expressive names and added several &lt;tt&gt;toString()&lt;/tt&gt; functions. The log messages are deliberately written with level warning so we can easily separate them from Solr&apos;s own info and debug messages.&lt;/p&gt;

&lt;p&gt;If it helps we can make these changes available although it&apos;s not feasible to merge them because they are only debug hacks.&lt;/p&gt;

&lt;p&gt;Here&apos;s what we found out so far:&lt;/p&gt;

&lt;p&gt;As described in the initial issue description we can reproduce that the score of a query result is computed correctly in the explain segments but incorrectly in the actual result if only one of two multiplicative boost conditions match. We now further simplified our query by splitting it into 3 separate queries with a filter query on one specific document. The cases are:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;name matches both boost (netzteil and sony): Original Sony Vaio Netzteil&lt;/li&gt;
	&lt;li&gt;name matches one boost (netzteil but not sony): GS-Netzteil 20W schwarz&lt;/li&gt;
	&lt;li&gt;name matches no boost (neither netzteil nor sony): Camcorderband DV 100min (2)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Attached you find the log files for these queries and the JSON of the queries themselves. This time we did not enable debugQuery in order to log only the incorrect score of the actual result.&lt;/p&gt;

&lt;p&gt;Each request was executed on a freshly restarted server (local, no replication, no shards) to ensure caching does not pollute the findings.&lt;/p&gt;

&lt;p&gt;We made the following observations:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Both matches: lucene detects both matches with &lt;tt&gt;QueryDocValues.exists()&lt;/tt&gt; and then computes scores for them using QueryDocValues.floatValue(). This seems to be called eventually by the scorer utilized by the result of &lt;tt&gt;org.apache.lucene.search.DoubleValues#withDefault()&lt;/tt&gt; based on a formerly anonymous class renamed to DoubleValues_DoubleValuesWithDefault()&lt;/li&gt;
	&lt;li&gt;Single match: &lt;tt&gt;QueryDocValues.exists()&lt;/tt&gt; detects one match and considers the other false (which seems correct). After that however it only seems to work with various variants of a constant score of 1.0, which in the end results in 1.0. Notice that this query uses the same &lt;tt&gt;withDefault()&lt;/tt&gt; as above but performs a very different computation mostly based on constant values. There is no call to &lt;tt&gt;QueryDocValues.floatVal()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;No match: &lt;tt&gt;QueryDocValues.exists()&lt;/tt&gt; does not find anything and results in a score of 1.0 as expected.&lt;/li&gt;
	&lt;li&gt;All logs seems to compute the score for a document with the ID -1, which utilizes &lt;tt&gt;QueryDocValues.floatVal()&lt;/tt&gt;. As far as we understand this seems to be some initialization step independent of the actual query that happens only for the first query sent to the server.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Interestingly when you compare the logs for single and no match the are almost identical apart from the &lt;tt&gt;QueryDocValues.exists()&lt;/tt&gt;, an additional &lt;tt&gt;BooleanWeight()&lt;/tt&gt; and various &lt;tt&gt;toString()&lt;/tt&gt; hashes.&lt;/p&gt;

&lt;p&gt;Our expectation would have been that queries for single and both matches would have produced a fairly similar log using similar scorers but different scores (2.0 vs 6.0).&lt;/p&gt;

&lt;p&gt;As we can reproduce these results consistently in a small testing environment we currently see the following options to proceed further:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;With some hints on where to further dig into the source code we might be able to find the real culprit causing the inconsistent score. Any pointers?&lt;/li&gt;
	&lt;li&gt;We could make the solrconfig.xml, schema.xml and the core files for Solr 7.5 available for someone else to debug who has a better grasp of the inner workings. Again, this is small test environment with only a few documents, and we could probably reduce this further (e.g. by removing Solr fields unrelated to this issue).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Any help would be much appreciated,&lt;br/&gt;
 Thomas&lt;/p&gt;</comment>
                            <comment id="16744256" author="roskakori" created="Wed, 16 Jan 2019 17:05:59 +0000"  >&lt;p&gt;We digged in further and seem to have found the culprit. The test case in the attached patch &lt;tt&gt;0002-&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13126&quot; title=&quot;Multiplicative boost of isn&amp;#39;t applied when one of the summed or multiplied queries doesn&amp;#39;t match &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13126&quot;&gt;&lt;del&gt;SOLR-13126&lt;/del&gt;&lt;/a&gt;-Added-test-case.patch&lt;/tt&gt; reproduces the bug. The last working version is Solr 7.2.1.&lt;/p&gt;

&lt;p&gt;Using &lt;tt&gt;git bisect&lt;/tt&gt; we found out that the issue got introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8099&quot; title=&quot;Deprecate CustomScoreQuery, BoostedQuery and BoostingQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8099&quot;&gt;&lt;del&gt;LUCENE-8099&lt;/del&gt;&lt;/a&gt; (a refactoring). There&apos;s two changes that break the scoring in different ways:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/commit/b01e6023e1cd3c62260b38c05c8d145ba143a2ac&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LUCENE-8099: Deprecate CustomScoreQuery, BoostedQuery, BoostingQuery&lt;/a&gt; -&amp;gt; partial match is scored with 0 instead of 2&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/commit/0744fea821366a853b8e239e766b9786ef96cb27&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LUCENE-8099: Replace BoostQParserPlugin.boostQuery() with FunctionScoreQuery.boostByValue()&lt;/a&gt;  -&amp;gt; partial match is scored with 1 instead of 2, which is the current behavior on master&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The attached patch &lt;tt&gt;0001-use-deprecated-classes-to-fix-regression-introduced-.patch&lt;/tt&gt; includes an experimental fix by reverting some parts of the code to its previous version based on a deprecated class the refactoring of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8099&quot; title=&quot;Deprecate CustomScoreQuery, BoostedQuery and BoostingQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8099&quot;&gt;&lt;del&gt;LUCENE-8099&lt;/del&gt;&lt;/a&gt; tried to replace (among other things).&lt;/p&gt;

&lt;p&gt;This is a rough initial patch with the following known issues:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The patch goes towards solr 7.5.0. This is the version we currently experience the issues with and attempt to get back to working for production use. Ideally of course the patch would go towards the master and then merged back to earlier versions.&lt;/li&gt;
	&lt;li&gt;The fix uses a deprecated class. Ideally it would fix the refactored classes from &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8099&quot; title=&quot;Deprecate CustomScoreQuery, BoostedQuery and BoostingQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8099&quot;&gt;&lt;del&gt;LUCENE-8099&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;The patches are a bit bigger than the should be due to some automatic white space reformatting in the IDE. The actual number of changed lines per file is very small.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Nevertheless the test case is generic enough to run on all branches, including the current master.&lt;/p&gt;</comment>
                            <comment id="16767308" author="tom burgmans" created="Wed, 13 Feb 2019 15:28:20 +0000"  >&lt;p&gt;I could reproduce this with 2 cases:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Multiplicative boost with &lt;em&gt;field&lt;/em&gt; function query:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://localhost:8983/solr/test/select?defType=edismax&amp;amp;fl=sku,score,[explain style=text]&amp;amp;q=:&amp;amp;boost=sum(field(price),4)&amp;amp;fq=dictionary_id:cheetah
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12958590/12958590_image-2019-02-13-16-17-56-272.png&quot; height=&quot;439&quot; width=&quot;1090&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Multiplicative boost with &lt;em&gt;query&lt;/em&gt; function query:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://localhost:8983/solr/test/select?defType=edismax&amp;amp;fl=sku,min_term,score,[explain%20style=text]&amp;amp;q=min_term:shelter&amp;amp;boost=sum(3,query($BoostQuery))&amp;amp;BoostQuery={!edismax%20boost=3%20bf=}min_term:(%22xxxdoesnexistxxx%22)&amp;amp;fq=dictionary_id:cheetah
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12958593/12958593_screenshot-1.png&quot; height=&quot;640&quot; width=&quot;1258&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &#160;&lt;/p&gt;

&lt;p&gt;Our analysis is that the EXPLAIN provides the correct value but the actual score is wrong.&lt;/p&gt;

&lt;p&gt;Since we rely heavily on multiplicative boost by various function queries, this is a showstopper for us to upgrade from Solr 6.&lt;/p&gt;</comment>
                            <comment id="16767647" author="mkhludnev" created="Wed, 13 Feb 2019 22:29:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roskakori&quot; class=&quot;user-hover&quot; rel=&quot;roskakori&quot;&gt;roskakori&lt;/a&gt;, thanks for the representative test. I&apos;m just wondering about configs. Why these ones? &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;, wdyt abt &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12958842/12958842_SOLR-13126.patch&quot; title=&quot;SOLR-13126.patch attached to SOLR-13126&quot;&gt;SOLR-13126.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;? &lt;/p&gt;</comment>
                            <comment id="16767853" author="tibounig" created="Thu, 14 Feb 2019 03:25:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev&quot; class=&quot;user-hover&quot; rel=&quot;mkhludnev&quot;&gt;mkhludnev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Testcase was derived from SampleTest where these configs are used, we just didn&apos;t change them.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/test/org/apache/solr/SampleTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/master/solr/core/src/test/org/apache/solr/SampleTest.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16768001" author="mkhludnev" created="Thu, 14 Feb 2019 08:46:54 +0000"  >&lt;p&gt;It seems to me that &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8099&quot; title=&quot;Deprecate CustomScoreQuery, BoostedQuery and BoostingQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8099&quot;&gt;&lt;del&gt;LUCENE-8099&lt;/del&gt;&lt;/a&gt; replaced the plain multiplicative boost at JS with conditional logic &lt;tt&gt;DoubleValues.withDefault()&lt;/tt&gt;, which drops boost score when one one of multiplied queries doesn&apos;t match to a doc. see &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12958842/12958842_SOLR-13126.patch&quot; title=&quot;SOLR-13126.patch attached to SOLR-13126&quot;&gt;SOLR-13126.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16768021" author="roskakori" created="Thu, 14 Feb 2019 08:59:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev&quot; class=&quot;user-hover&quot; rel=&quot;mkhludnev&quot;&gt;mkhludnev&lt;/a&gt;: The values and queries for the test cases are simplified versions of the situation we encountered in production. The actual query is a lot more complex and generated by an&#160;&lt;a href=&quot;https://www.sap.com/products/crm/e-commerce-platforms/technical-information.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;e-commerce framework from SAP&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Does is this answer your question or do you need more information on a specific part?&lt;/p&gt;</comment>
                            <comment id="16768024" author="mkhludnev" created="Thu, 14 Feb 2019 09:06:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roskakori&quot; class=&quot;user-hover&quot; rel=&quot;roskakori&quot;&gt;roskakori&lt;/a&gt;, got it. Do you have an ability to verify the fix &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12958842/12958842_SOLR-13126.patch&quot; title=&quot;SOLR-13126.patch attached to SOLR-13126&quot;&gt;SOLR-13126.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;?&lt;/p&gt;</comment>
                            <comment id="16768301" author="aliaksandr_asiptsou" created="Thu, 14 Feb 2019 14:18:24 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev&quot; class=&quot;user-hover&quot; rel=&quot;mkhludnev&quot;&gt;mkhludnev&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;We&apos;ve verified our case (see comment from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Tom+Burgmans&quot; class=&quot;user-hover&quot; rel=&quot;Tom Burgmans&quot;&gt;Tom Burgmans&lt;/a&gt;&#160; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13126?focusedCommentId=16767308&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16767308&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-13126?focusedCommentId=16767308&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16767308&lt;/a&gt;) and found it working fine with the latest patch.&lt;/p&gt;

&lt;p&gt;query:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/OTSTests_A/select?defType=edismax&amp;amp;fl=*,score,[explain%20style=text]&amp;amp;q=title:tax&amp;amp;boost=sum(3,query($BoostQuery))&amp;amp;BoostQuery={!edismax%20boost=3%20bf=}min_term:(%22xxxdoesnexistxxx%22)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;result:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12958726/12958726_2019-02-14_1715.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The values in &lt;em&gt;score&lt;/em&gt; and &lt;em&gt;explain&lt;/em&gt; are now the same.&lt;/p&gt;</comment>
                            <comment id="16768378" author="roskakori" created="Thu, 14 Feb 2019 15:10:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev&quot; class=&quot;user-hover&quot; rel=&quot;mkhludnev&quot;&gt;mkhludnev&lt;/a&gt;, I still should have my test environment around but I&apos;m currently in a scrum sprint working on some other tasks. But I should be able to take a look at it early on next week and integrate a patched Solr in a SAP commerce environment for testing. BTW our hackish fix has been in production use for a couple of weeks and has been working fine so far. AFAIU your fix does the same in a cleaner way, so the general direction of the suggested solution seems promising.&lt;/p&gt;</comment>
                            <comment id="16768692" author="mkhludnev" created="Thu, 14 Feb 2019 20:32:02 +0000"  >&lt;p&gt;I&apos;ve done one more review. &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;FunctionScoreQuery&lt;/tt&gt; code does exactly what&apos;s expected in &lt;tt&gt;boostByValue&lt;/tt&gt; javadoc
&lt;blockquote&gt;&lt;p&gt;If the source has no value for a particular document, the score for that document is preserved as-is.&lt;/p&gt;&lt;/blockquote&gt;&lt;/li&gt;
	&lt;li&gt;there&apos;s no assert for that case at &lt;tt&gt;TestFunctionScoreQuery.testScoreModifyingSource()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;as I understand all Solr&apos;s multiplicative boosts expect boost score is applied regardless it has values or not. (Don&apos;t ask me how it boosts when value is absent, it does and people relies on it)&lt;br/&gt;
So, the proposal is &lt;/li&gt;
	&lt;li&gt;keep &lt;tt&gt;FunctionScoreQuery.MultiplicativeBoostValuesSource&lt;/tt&gt; as is.&lt;/li&gt;
	&lt;li&gt;introduce &lt;em&gt;some static method&lt;/em&gt; like &lt;tt&gt;FunctionScoreQuery.boostByValueRegardlessExistence(Query, DoubleValuesSource)&lt;/tt&gt;. Better names are welcome.&lt;/li&gt;
	&lt;li&gt;move all Solr&apos;s boost on it&lt;/li&gt;
	&lt;li&gt;don&apos;t try to catch 8.0 respin&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="16769109" author="romseygeek" created="Fri, 15 Feb 2019 09:11:43 +0000"  >&lt;p&gt;I think the problem here is a mismatch between how ValueSource and DoubleValuesSource access their underlying data.&#160; DVS exposes an iterator and expects to jump over missing documents, while VS has an exists() method but still returns a value even if exists() is false.&#160; The wrapper code to convert VS to DVS checks whether or not the value exists, but instead it should always return `true`.&lt;/p&gt;

&lt;p&gt;I&apos;ll work on a patch and include the above tests.&lt;/p&gt;</comment>
                            <comment id="16769215" author="jira-bot" created="Fri, 15 Feb 2019 11:31:03 +0000"  >&lt;p&gt;Commit 03945a9f5932ee78bbaa46becb551f348bca509e in lucene-solr&apos;s branch refs/heads/branch_8_0 from Alan Woodward&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=03945a9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=03945a9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13126&quot; title=&quot;Multiplicative boost of isn&amp;#39;t applied when one of the summed or multiplied queries doesn&amp;#39;t match &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13126&quot;&gt;&lt;del&gt;SOLR-13126&lt;/del&gt;&lt;/a&gt;: Correctly combine multiplicative query boosts&lt;/p&gt;</comment>
                            <comment id="16769216" author="jira-bot" created="Fri, 15 Feb 2019 11:31:04 +0000"  >&lt;p&gt;Commit 249dfdae0179bd9b0df543b98f5bf02baa464afc in lucene-solr&apos;s branch refs/heads/branch_8x from Alan Woodward&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=249dfda&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=249dfda&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13126&quot; title=&quot;Multiplicative boost of isn&amp;#39;t applied when one of the summed or multiplied queries doesn&amp;#39;t match &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13126&quot;&gt;&lt;del&gt;SOLR-13126&lt;/del&gt;&lt;/a&gt;: Correctly combine multiplicative query boosts&lt;/p&gt;</comment>
                            <comment id="16769217" author="jira-bot" created="Fri, 15 Feb 2019 11:31:06 +0000"  >&lt;p&gt;Commit 10acaf02f82f4fc9c08884a7d249658ca6a590c1 in lucene-solr&apos;s branch refs/heads/master from Alan Woodward&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=10acaf0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=10acaf0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13126&quot; title=&quot;Multiplicative boost of isn&amp;#39;t applied when one of the summed or multiplied queries doesn&amp;#39;t match &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13126&quot;&gt;&lt;del&gt;SOLR-13126&lt;/del&gt;&lt;/a&gt;: Correctly combine multiplicative query boosts&lt;/p&gt;</comment>
                            <comment id="16769382" author="tibounig" created="Fri, 15 Feb 2019 14:49:17 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev&quot; class=&quot;user-hover&quot; rel=&quot;mkhludnev&quot;&gt;mkhludnev&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16770063" author="lucenesolrqa" created="Sat, 16 Feb 2019 09:55:56 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; patch &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;  0m  6s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13126&quot; title=&quot;Multiplicative boost of isn&amp;#39;t applied when one of the summed or multiplied queries doesn&amp;#39;t match &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13126&quot;&gt;&lt;del&gt;SOLR-13126&lt;/del&gt;&lt;/a&gt; does not apply to master. Rebase required? Wrong Branch? See &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&lt;/a&gt; for help. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13126&quot; title=&quot;Multiplicative boost of isn&amp;#39;t applied when one of the summed or multiplied queries doesn&amp;#39;t match &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13126&quot;&gt;&lt;del&gt;SOLR-13126&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12958842/SOLR-13126.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12958842/SOLR-13126.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/304/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/304/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16785624" author="awislowski" created="Wed, 6 Mar 2019 13:21:46 +0000"  >&lt;p&gt;I wonder whether this fix (return true) should be added also on&#160;WrappedLongValuesSource&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/5f91670a496275167d7699c24ee7df61d7e2f7e6/lucene/queries/src/java/org/apache/lucene/queries/function/ValueSource.java#L141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/5f91670a496275167d7699c24ee7df61d7e2f7e6/lucene/queries/src/java/org/apache/lucene/queries/function/ValueSource.java#L141&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16786608" author="mkhludnev" created="Thu, 7 Mar 2019 10:38:58 +0000"  >&lt;p&gt;ccing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;. WDYT about &lt;tt&gt;WrappedLongValuesSource&lt;/tt&gt; ? &lt;/p&gt;</comment>
                            <comment id="16786635" author="romseygeek" created="Thu, 7 Mar 2019 11:11:36 +0000"  >&lt;p&gt;&amp;gt;&#160;I wonder whether this fix (return true) should be added also on&#160;WrappedLongValuesSource&lt;/p&gt;

&lt;p&gt;It should - can you open a separate issue for it?&#160; I don&apos;t think that&apos;s actually used anywhere in Solr yet, but it will be needed in future.&lt;/p&gt;</comment>
                            <comment id="16786733" author="awislowski" created="Thu, 7 Mar 2019 12:55:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; I have created:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13303&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-13303&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16825954" author="janhoy" created="Thu, 25 Apr 2019 10:49:11 +0000"  >&lt;p&gt;I plan to back-port this to 7.7.2 (branch_7_7).&lt;/p&gt;</comment>
                            <comment id="16825983" author="jira-bot" created="Thu, 25 Apr 2019 11:40:45 +0000"  >&lt;p&gt;Commit 53d48e21b499c321c4ebd2dc55b24565a72f6e0c in lucene-solr&apos;s branch refs/heads/branch_7_7 from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=53d48e2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=53d48e2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13126&quot; title=&quot;Multiplicative boost of isn&amp;#39;t applied when one of the summed or multiplied queries doesn&amp;#39;t match &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13126&quot;&gt;&lt;del&gt;SOLR-13126&lt;/del&gt;&lt;/a&gt;: Correctly combine multiplicative query boosts&lt;/p&gt;

&lt;p&gt;(Cherry pick 03945a9f5932ee78bbaa46becb551f348bca509e and backport, fix CHANGES)&lt;/p&gt;</comment>
                            <comment id="16838310" author="tomzi" created="Mon, 13 May 2019 06:35:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt; could this also be backported to Solr 7.3 - 7.5?&lt;/p&gt;</comment>
                            <comment id="16838607" author="janhoy" created="Mon, 13 May 2019 15:05:52 +0000"  >&lt;p&gt;There will not be any further releases for 7.3 or 7.5. We&#8217;ll soon release 7.7.2 with this fix and you should consider upgrading to that version which is backward compatible with all 7.x versions.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="13220190">SOLR-13303</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13210146">SOLR-13143</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13124937">LUCENE-8099</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12955126" name="0001-use-deprecated-classes-to-fix-regression-introduced-.patch" size="43951" author="roskakori" created="Wed, 16 Jan 2019 17:06:12 +0000"/>
                            <attachment id="12955127" name="0002-SOLR-13126-Added-test-case.patch" size="2459" author="roskakori" created="Wed, 16 Jan 2019 17:06:12 +0000"/>
                            <attachment id="12958726" name="2019-02-14_1715.png" size="12954" author="aliaksandr_asiptsou" created="Thu, 14 Feb 2019 14:15:58 +0000"/>
                            <attachment id="12958842" name="SOLR-13126.patch" size="2367" author="romseygeek" created="Fri, 15 Feb 2019 09:30:38 +0000"/>
                            <attachment id="12958689" name="SOLR-13126.patch" size="3083" author="mkhl" created="Thu, 14 Feb 2019 08:42:19 +0000"/>
                            <attachment id="12954021" name="debugQuery.json" size="6691" author="roskakori" created="Mon, 7 Jan 2019 16:19:19 +0000"/>
                            <attachment id="12958590" name="image-2019-02-13-16-17-56-272.png" size="78764" author="Tom Burgmans" created="Wed, 13 Feb 2019 15:17:57 +0000"/>
                            <attachment id="12958593" name="screenshot-1.png" size="108264" author="Tom Burgmans" created="Wed, 13 Feb 2019 15:23:44 +0000"/>
                            <attachment id="12954858" name="solr_match_neither_nextteil_nor_sony.json" size="671" author="roskakori" created="Mon, 14 Jan 2019 17:37:38 +0000"/>
                            <attachment id="12954862" name="solr_match_neither_nextteil_nor_sony.txt" size="23603" author="roskakori" created="Mon, 14 Jan 2019 17:37:39 +0000"/>
                            <attachment id="12954859" name="solr_match_netzteil_and_sony.json" size="674" author="roskakori" created="Mon, 14 Jan 2019 17:37:38 +0000"/>
                            <attachment id="12954861" name="solr_match_netzteil_and_sony.txt" size="30426" author="roskakori" created="Mon, 14 Jan 2019 17:37:39 +0000"/>
                            <attachment id="12954857" name="solr_match_netzteil_only.json" size="667" author="roskakori" created="Mon, 14 Jan 2019 17:37:38 +0000"/>
                            <attachment id="12954860" name="solr_match_netzteil_only.txt" size="23803" author="roskakori" created="Mon, 14 Jan 2019 17:37:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00l48:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>