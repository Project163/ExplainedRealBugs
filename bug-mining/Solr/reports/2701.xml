<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:09:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8254] HttpSolrCall.getCoreByCollection can throw NPE if there are no leaders up</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8254</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Windows/5254/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Windows/5254/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12911498">SOLR-8254</key>
            <summary>HttpSolrCall.getCoreByCollection can throw NPE if there are no leaders up</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="romseygeek">Alan Woodward</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Nov 2015 10:04:02 +0000</created>
                <updated>Tue, 15 Dec 2015 13:54:43 +0000</updated>
                            <resolved>Mon, 9 Nov 2015 16:18:34 +0000</resolved>
                                                    <fixVersion>5.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14996313" author="romseygeek" created="Mon, 9 Nov 2015 10:09:57 +0000"  >&lt;p&gt;Lines 781-794:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-comment&quot;&gt;//Hitting the leaders is useful when it&apos;s an update request.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//For queries it doesn&lt;span class=&quot;code-quote&quot;&gt;&apos;t matter and hence we don&apos;&lt;/span&gt;t distinguish here.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Slice&amp;gt; entry : entries) {
      &lt;span class=&quot;code-comment&quot;&gt;// first see &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we have the leader
&lt;/span&gt;      Replica leaderProps = clusterState.getLeader(collection, entry.getKey());    &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;----- CAN RETURN NULL IF THERE&apos;S NO LEADER
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (liveNodes.contains(leaderProps.getNodeName()) &amp;amp;&amp;amp; leaderProps.getState() == Replica.State.ACTIVE) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (leaderProps != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          core = checkProps(leaderProps);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (core != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; core;
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The leaderProps null check should be part of the outer if statement, I think, but I don&apos;t grok this bit of code well enough to know what to do if the leader is in fact null.&lt;/p&gt;

&lt;p&gt;It also strikes me that this method probably belongs on CoreContainer, rather than as a private method in HttpSolrCall?&lt;/p&gt;</comment>
                            <comment id="14996462" author="ichattopadhyaya" created="Mon, 9 Nov 2015 12:41:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;The leaderProps null check should be part of the outer if statement&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can static analysis of code help here uncover such bugs? I mean tools like FindBugs or the one from JetBrains etc.?&lt;/p&gt;</comment>
                            <comment id="14996601" author="markrmiller@gmail.com" created="Mon, 9 Nov 2015 14:34:24 +0000"  >&lt;p&gt;+1, I hit this working on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6237&quot; title=&quot;An option to have only leaders write and replicas read when using a shared file system with SolrCloud.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6237&quot;&gt;SOLR-6237&lt;/a&gt; as well. Same fix.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: solr/core/src/java/org/apache/solr/servlet/HttpSolrCall.java
===================================================================
--- solr/core/src/java/org/apache/solr/servlet/HttpSolrCall.java	(revision 1712839)
+++ solr/core/src/java/org/apache/solr/servlet/HttpSolrCall.java	(working copy)
@@ -783,12 +783,12 @@
     for (Map.Entry&amp;lt;String, Slice&amp;gt; entry : entries) {
       // first see if we have the leader
       Replica leaderProps = clusterState.getLeader(collection, entry.getKey());
-      if (liveNodes.contains(leaderProps.getNodeName()) &amp;amp;&amp;amp; leaderProps.getState() == Replica.State.ACTIVE) {
-        if (leaderProps != null) {
+      if (leaderProps != null) {
+        if (liveNodes.contains(leaderProps.getNodeName()) &amp;amp;&amp;amp; leaderProps.getState() == Replica.State.ACTIVE) {
           core = checkProps(leaderProps);
-        }
-        if (core != null) {
-          return core;
+          if (core != null) {
+            return core;
+          }
         }
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;It also strikes me that this method probably belongs on CoreContainer, rather than as a private method in HttpSolrCall?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t know, we do not tend to put a lot of SolrCloud specific methods on CoreContainer.&lt;/p&gt;</comment>
                            <comment id="14996790" author="romseygeek" created="Mon, 9 Nov 2015 16:14:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t know, we do not tend to put a lot of SolrCloud specific methods on CoreContainer.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fair enough, I&apos;ll leave it where it is.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can static analysis of code help here uncover such bugs?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Almost certainly - IntelliJ showed me the error immediately when I looked at the code.  I have a feeling that this has come up before, but getting the whole codebase to pass will be a pretty big job.&lt;/p&gt;</comment>
                            <comment id="14996796" author="jira-bot" created="Mon, 9 Nov 2015 16:17:22 +0000"  >&lt;p&gt;Commit 1713468 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1713468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1713468&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8254&quot; title=&quot;HttpSolrCall.getCoreByCollection can throw NPE if there are no leaders up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8254&quot;&gt;&lt;del&gt;SOLR-8254&lt;/del&gt;&lt;/a&gt;: HttpSolrCore.getCoreByCollection() can throw NPE&lt;/p&gt;</comment>
                            <comment id="14996800" author="jira-bot" created="Mon, 9 Nov 2015 16:18:21 +0000"  >&lt;p&gt;Commit 1713471 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1713471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1713471&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8254&quot; title=&quot;HttpSolrCall.getCoreByCollection can throw NPE if there are no leaders up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8254&quot;&gt;&lt;del&gt;SOLR-8254&lt;/del&gt;&lt;/a&gt;: HttpSolrCore.getCoreByCollection() can throw NPE&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2o4s7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>