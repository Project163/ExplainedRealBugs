<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:30:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4019] Service Unavailable errors not being logged</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4019</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Due to changes introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2124&quot; title=&quot;SEVERE exceptions are being logged for expected PingRequestHandler SERVICE_UNAVAILABLE exceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2124&quot;&gt;&lt;del&gt;SOLR-2124&lt;/del&gt;&lt;/a&gt;, Service Unavailable (503) errors intentionally not logged. This was introduced to avoid the PingRequestHandler to generate exceptions in logs for requests that are not really exceptions for Solr, see &lt;a href=&quot;http://www.gossamer-threads.com/lists/lucene/java-dev/171982&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.gossamer-threads.com/lists/lucene/java-dev/171982&lt;/a&gt; The problem with this now is that in some cases (like when using SolrCloud), 503 are critic problem and an exception should be logged. &lt;br/&gt;
Per hoss comment:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The crux of the problem historically, and how we got into the weird&lt;br/&gt;
situation with the Ping handler is that we wnat to return to the &lt;b&gt;client&lt;/b&gt;&lt;br/&gt;
the 503, so we threw an exception that would propogate up and result in&lt;br/&gt;
SolrDispatchFilter returning the 503 &amp;#8211; but in the meantime we had to jump&lt;br/&gt;
through a bunch of hoops to deal with the logging because for &lt;b&gt;solr&lt;/b&gt; it&apos;s&lt;br/&gt;
not really an error and we shouldn&apos;t freak out about logging. (ie: we want&lt;br/&gt;
the client to know there is an 503 error, but on the server we don&apos;t&lt;br/&gt;
relaly care.&lt;/p&gt;

&lt;p&gt;and the hoops we&apos;ve jumped through for logging are now hurting us in a&lt;br/&gt;
differnet situation where the 503 really is a serious problem.&lt;/p&gt;

&lt;p&gt;We have a similar situation in the ShowFileHandler where we want the&lt;br/&gt;
&lt;b&gt;client&lt;/b&gt; to ge a 404 error, so we throw a SolrException witha 404 error,&lt;br/&gt;
but as a result Solr logs loud and ugly that a 404 error happened.&lt;/p&gt;

&lt;p&gt;I &lt;b&gt;think&lt;/b&gt; the cleanest way to deal with this now, would be to change&lt;br/&gt;
PingRequestHandler and ShowFileRequestHandler so that instead of&lt;br/&gt;
&lt;b&gt;throwing&lt;/b&gt; a SolrException, their handleRequest methods just construct a&lt;br/&gt;
new SolrException with the appropraite status code, put that exception in&lt;br/&gt;
the SolrQueryResponse, and then return.  I &lt;em&gt;think&lt;/em&gt; that would ypass&lt;br/&gt;
the loud conspicous logging that currently happens when exceptions are&lt;br/&gt;
thrown (and would let us remove the &quot;ignore SERVICE_UNAVAILABLE&lt;br/&gt;
exceptions&quot; kludge that is huring us in SolrCloud so those exceptions&lt;br/&gt;
would be logged loud and conspicuously)&lt;/p&gt;

&lt;p&gt;This type of solution is something that we &lt;b&gt;might&lt;/b&gt; have been able to do&lt;br/&gt;
along time ago except that it would have been complicated because of the&lt;br/&gt;
different code paths arround writting successful output using hte response&lt;br/&gt;
writers vs delegating error responses to the servlet container &amp;#8211; but now&lt;br/&gt;
it doesn&apos;t matter, we use the response writters either way, so i &lt;b&gt;think&lt;/b&gt;&lt;br/&gt;
itwould be relatively striaght forward (although there may be some&lt;br/&gt;
vestigal &quot;oh no, we found an exception, we must log it&quot; logic in the&lt;br/&gt;
request dispatcher that might need to be tweaked to only do that if the&lt;br/&gt;
exception is &lt;b&gt;thrown&lt;/b&gt; and not just an object in the response)&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12614167">SOLR-4019</key>
            <summary>Service Unavailable errors not being logged</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdyer">James Dyer</assignee>
                                    <reporter username="tflobbe">Tomas Eduardo Fernandez Lobbe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Oct 2012 13:02:33 +0000</created>
                <updated>Mon, 9 May 2016 18:54:22 +0000</updated>
                            <resolved>Mon, 5 Nov 2012 17:54:39 +0000</resolved>
                                                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13488269" author="tomasflobbe" created="Wed, 31 Oct 2012 21:53:04 +0000"  >&lt;p&gt;Here is an initial patch. I would like to test/review it more as this could impact many places. &lt;br/&gt;
It does sound to me that in most cases you would want Service Unavailable exceptions to be logged, the &quot;ping&quot; command is a specific case where you wouldn&apos;t. &lt;br/&gt;
I couldn&apos;t find 503 exceptions in ShowFileRequestHandler.&lt;br/&gt;
I intentionally left some &quot;Service Unavailable&quot; exceptions being throw in the PingRequestHandler in cases where I think ARE unexpected errors (like when trying to enable/disable without a healthcheck file defined).&lt;/p&gt;</comment>
                            <comment id="13488289" author="hossman" created="Wed, 31 Oct 2012 22:06:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;I couldn&apos;t find 503 exceptions in ShowFileRequestHandler.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;the analogous situation i was refering to in ShowFileRequestHandler was when it returns 404s&lt;/p&gt;</comment>
                            <comment id="13488743" author="tomasflobbe" created="Thu, 1 Nov 2012 15:09:36 +0000"  >&lt;p&gt;Updated patch. In the ShowFileRequestHandler I also avoid throwing the exception for the cases where the file has been intentionally hidden.&lt;br/&gt;
I also think there is a bug in the log(Logger log, String msg, Throwable e) method of the SolrException. The code is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void log(Logger log, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg, Throwable e) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; SolrException
        &amp;amp;&amp;amp; ((SolrException) e).code() == ErrorCode.SERVICE_UNAVAILABLE.code) {
      log(log, msg);
    }
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; stackTrace = msg + &lt;span class=&quot;code-quote&quot;&gt;&apos;:&apos;&lt;/span&gt; + toStr(e);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ignore = doIgnore(e, stackTrace);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ignore != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      log.info(ignore);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    log.error(stackTrace);
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void log(Logger log, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; stackTrace = msg;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ignore = doIgnore(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, stackTrace);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ignore != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      log.info(ignore);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    log.error(stackTrace);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like exceptions that are logged with this method and have the code 503 are going to be logged twice (the second time with the stacktrace) where the intention was to only log the message. This patch also removes that double logging.&lt;/p&gt;</comment>
                            <comment id="13489749" author="jdyer" created="Fri, 2 Nov 2012 21:05:47 +0000"  >&lt;p&gt;Tomas, your patch keeps PingRequestHandler quiet, Kludge-free.  I appreciate your pointing out SolrQueryResponse#setException, a handy method I wasn&apos;t aware of.  Your change to ShowFileRequestHandler, while unrelated, seems reasonable.  I would think that any other logging tweaks like these can be handled as they are found, right?  If you are satisfied enough for now, I will go ahead and commit this.&lt;/p&gt;</comment>
                            <comment id="13489760" author="tomasflobbe" created="Fri, 2 Nov 2012 21:16:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Your change to ShowFileRequestHandler, while unrelated, seems reasonable.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yes, maybe this should have been implemented on a different issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I would think that any other logging tweaks like these can be handled as they are found, right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed. &lt;/p&gt;


&lt;p&gt;Should I create a patch for 4.x too?&lt;/p&gt;</comment>
                            <comment id="13489766" author="jdyer" created="Fri, 2 Nov 2012 21:29:48 +0000"  >&lt;p&gt;I think svn will merge this just fine so we don&apos;t need a 4.x patch.  &lt;/p&gt;</comment>
                            <comment id="13490771" author="jdyer" created="Mon, 5 Nov 2012 17:54:39 +0000"  >&lt;p&gt;committed.&lt;/p&gt;

&lt;p&gt;Trunk: r1405893&lt;br/&gt;
4x: r1405894&lt;/p&gt;</comment>
                            <comment id="13610598" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:20:18 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; James Dyer&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1405920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1405920&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4019&quot; title=&quot;Service Unavailable errors not being logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4019&quot;&gt;&lt;del&gt;SOLR-4019&lt;/del&gt;&lt;/a&gt;: Fix tests that are invalid due to logging change&lt;/p&gt;</comment>
                            <comment id="13610599" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:20:23 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; James Dyer&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1405913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1405913&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4019&quot; title=&quot;Service Unavailable errors not being logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4019&quot;&gt;&lt;del&gt;SOLR-4019&lt;/del&gt;&lt;/a&gt;:  Ignore tests that are invalid due to logging change&lt;/p&gt;</comment>
                            <comment id="13610600" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:20:29 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; James Dyer&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1405894&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1405894&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4019&quot; title=&quot;Service Unavailable errors not being logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4019&quot;&gt;&lt;del&gt;SOLR-4019&lt;/del&gt;&lt;/a&gt;:  Log 503 stack traces unless from PingRequestHandler.  Suppress logging some stack traces with ShowFileRequestHandler.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12612804">SOLR-3972</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12551717" name="SOLR-4019.patch" size="3705" author="tflobbe" created="Thu, 1 Nov 2012 15:09:36 +0000"/>
                            <attachment id="12551632" name="SOLR-4019.patch" size="1607" author="tflobbe" created="Wed, 31 Oct 2012 21:53:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253298</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0desv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76327</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>