<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:34:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4505] Deadlock around SolrCoreState update lock.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4505</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Erick found a deadlock with his core stress tool - see &lt;a href=&quot;http://markmail.org/message/aq5hghbqia2uimgl&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/aq5hghbqia2uimgl&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12634064">SOLR-4505</key>
            <summary>Deadlock around SolrCoreState update lock.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Feb 2013 05:40:33 +0000</created>
                <updated>Mon, 9 May 2016 18:50:44 +0000</updated>
                            <resolved>Fri, 1 Mar 2013 19:01:56 +0000</resolved>
                                                    <fixVersion>4.2</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13586806" author="markrmiller@gmail.com" created="Tue, 26 Feb 2013 05:43:11 +0000"  >&lt;p&gt;The attached patch deals with the update lock the same as the commit lock (which we changed when a previous deadlock case was found).&lt;/p&gt;

&lt;p&gt;While waiting for the Writer to be unused, we yield the lock, and then reacquire it when the wait is done.&lt;/p&gt;</comment>
                            <comment id="13587068" author="erickerickson" created="Tue, 26 Feb 2013 12:27:28 +0000"  >&lt;p&gt;I&apos;m testing this now, it&apos;s been running for 5 minutes so all is well &amp;lt;G&amp;gt;. Actually, it&apos;s been taking a couple of hours to hit the race condition. I&apos;ll run it today in the background, and overnight tonight. If all goes well, I&apos;ll check it in tomorrow morning unless someone thinks it&apos;s a bad idea. Thanks a million!&lt;/p&gt;

&lt;p&gt;I&apos;ll assign this JIRA to myself just for bookeeping since I&apos;ve got the stress test tool set up. Take it back if you want of course.&lt;/p&gt;</comment>
                            <comment id="13587197" author="erickerickson" created="Tue, 26 Feb 2013 15:30:33 +0000"  >&lt;p&gt;No joy, here&apos;s the latest stack trace. Haven&apos;t looked at it yet, won&apos;t have time until tonight....&lt;/p&gt;</comment>
                            <comment id="13587911" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 02:18:29 +0000"  >&lt;p&gt;Same type of issue, different method. Please try this patch.&lt;/p&gt;</comment>
                            <comment id="13588588" author="erickerickson" created="Wed, 27 Feb 2013 18:26:10 +0000"  >&lt;p&gt;Unfortunately, same thing. It&apos;s so similar that I had to double-check to see if I&apos;d actually applied the latest patch....&lt;/p&gt;</comment>
                            <comment id="13588611" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 18:42:13 +0000"  >&lt;p&gt;The lines from your stack traces dont line up with the code I have in DefaultSolrCoreState, so it seems something must be different...&lt;/p&gt;</comment>
                            <comment id="13588613" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 18:43:15 +0000"  >&lt;p&gt;Hmm...or I&apos;m just reading it wrong - it must be waiting on the sync of the getIndexWriter itself...let me think about it for a bit.&lt;/p&gt;</comment>
                            <comment id="13588642" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 19:04:51 +0000"  >&lt;p&gt;We need an alternate approach it seems. Can you try this patch?&lt;/p&gt;</comment>
                            <comment id="13588708" author="erickerickson" created="Wed, 27 Feb 2013 20:15:21 +0000"  >&lt;p&gt;As long as you&apos;re willing to do the heavy lifting, I&apos;m willing to test &amp;lt;G&amp;gt;....&lt;/p&gt;

&lt;p&gt;Trying now.&lt;/p&gt;</comment>
                            <comment id="13588874" author="erickerickson" created="Wed, 27 Feb 2013 22:50:03 +0000"  >&lt;p&gt;Latest lockup stack....&lt;/p&gt;</comment>
                            <comment id="13588878" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 23:03:31 +0000"  >&lt;p&gt;Hmm...this time the lines are diff slightly off from my src - do you have any custom changes in those couple classes?&lt;/p&gt;</comment>
                            <comment id="13588885" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 23:05:05 +0000"  >&lt;p&gt;Do you have the latest of your test up, or can you put it up? Then I can try some various things more quickly perhaps.&lt;/p&gt;</comment>
                            <comment id="13588924" author="erickerickson" created="Wed, 27 Feb 2013 23:47:35 +0000"  >&lt;p&gt;I&apos;m more than happy to run the tests, no problem there. I did attach the latest patch that I&apos;m running with to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4196&quot; title=&quot;Untangle XML-specific nature of Config and Container classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4196&quot;&gt;&lt;del&gt;SOLR-4196&lt;/del&gt;&lt;/a&gt; just now, along with the stress test code. Note that it took a bit over 2 hours to hit the condition running flat out on my machine....&lt;/p&gt;</comment>
                            <comment id="13588928" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 23:51:28 +0000"  >&lt;p&gt;Yeah, I&apos;m happy to have your help &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Once I get something that looks better I&apos;ll ask you to blast it too - but at this rate, I&apos;d like to be able to try some things out - I&apos;ve also noticed sometimes I different hardware can trigger these things faster. My suped up linux box could cause the previous deadlock you found pretty fast.&lt;/p&gt;</comment>
                            <comment id="13588938" author="erickerickson" created="Thu, 28 Feb 2013 00:01:48 +0000"  >&lt;p&gt;P.S. I&apos;ll see what I can do to get the stress-test program in as a unit test by Monday FWIW.&lt;/p&gt;</comment>
                            <comment id="13589895" author="markrmiller@gmail.com" created="Thu, 28 Feb 2013 20:28:20 +0000"  >&lt;p&gt;Sorry - I put up the wrong patch! It was the same as the last one. Right one coming.&lt;/p&gt;</comment>
                            <comment id="13589896" author="markrmiller@gmail.com" created="Thu, 28 Feb 2013 20:29:01 +0000"  >&lt;p&gt;Here it is - dropbox must have sync&apos;d it slow on me - half the time i make the patch one machine and upload it from another.&lt;/p&gt;</comment>
                            <comment id="13590090" author="erickerickson" created="Fri, 1 Mar 2013 00:11:38 +0000"  >&lt;p&gt;Life is getting better. I ran for 3 hours with the latest patch and no problems. That&apos;s longer than I&apos;ve ever been able to run my stress test program before. I&apos;ll give it a whirl running overnight, but I don&apos;t anticipate anything changing. If the stress test succeeds, I&apos;ll check this in. Trunk and 4x? Or Trunk and bake for a little the 4x?&lt;/p&gt;

&lt;p&gt;Thanks a million for your efforts here....&lt;/p&gt;</comment>
                            <comment id="13590096" author="markrmiller@gmail.com" created="Fri, 1 Mar 2013 00:20:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Trunk and 4x? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d go with both.&lt;/p&gt;</comment>
                            <comment id="13590741" author="commit-tag-bot" created="Fri, 1 Mar 2013 17:29:07 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1451653&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1451653&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4505&quot; title=&quot;Deadlock around SolrCoreState update lock.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4505&quot;&gt;&lt;del&gt;SOLR-4505&lt;/del&gt;&lt;/a&gt;: Possible deadlock around SolrCoreState update lock.&lt;/p&gt;</comment>
                            <comment id="13590752" author="commit-tag-bot" created="Fri, 1 Mar 2013 17:38:13 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1451654&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1451654&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4505&quot; title=&quot;Deadlock around SolrCoreState update lock.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4505&quot;&gt;&lt;del&gt;SOLR-4505&lt;/del&gt;&lt;/a&gt;: Possible deadlock around SolrCoreState update lock.&lt;/p&gt;</comment>
                            <comment id="13590754" author="markrmiller@gmail.com" created="Fri, 1 Mar 2013 17:41:57 +0000"  >&lt;p&gt;I&apos;ve committed this - I&apos;m juggling too many local issues and I want these things to bake as long as they possibly can before the 4.2 release.&lt;/p&gt;</comment>
                            <comment id="13590760" author="commit-tag-bot" created="Fri, 1 Mar 2013 17:46:13 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1451657&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1451657&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4505&quot; title=&quot;Deadlock around SolrCoreState update lock.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4505&quot;&gt;&lt;del&gt;SOLR-4505&lt;/del&gt;&lt;/a&gt;: CHANGES entry&lt;/p&gt;</comment>
                            <comment id="13590762" author="commit-tag-bot" created="Fri, 1 Mar 2013 17:46:15 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1451656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1451656&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4505&quot; title=&quot;Deadlock around SolrCoreState update lock.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4505&quot;&gt;&lt;del&gt;SOLR-4505&lt;/del&gt;&lt;/a&gt;: CHANGES entry&lt;/p&gt;</comment>
                            <comment id="13590825" author="erickerickson" created="Fri, 1 Mar 2013 18:53:08 +0000"  >&lt;p&gt;You beat me to to it. My stress test ran all night last night without any problems, so we&apos;re good here as far as I can see.&lt;/p&gt;</comment>
                            <comment id="13592229" author="commit-tag-bot" created="Mon, 4 Mar 2013 14:22:15 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Erick Erickson&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452321&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452321&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4505&quot; title=&quot;Deadlock around SolrCoreState update lock.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4505&quot;&gt;&lt;del&gt;SOLR-4505&lt;/del&gt;&lt;/a&gt;, another place where I missed closing the stream&lt;/p&gt;</comment>
                            <comment id="13592250" author="erickerickson" created="Mon, 4 Mar 2013 14:50:22 +0000"  >&lt;p&gt;Tagged &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452321&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1452321&lt;/a&gt; to the wrong JIRA, should have been &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4525&quot; title=&quot;Test failures as a result of SOLR-4196&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4525&quot;&gt;&lt;del&gt;SOLR-4525&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13654180" author="thetaphi" created="Fri, 10 May 2013 10:34:18 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12571461" name="SOLR-4505.patch" size="2800" author="markrmiller@gmail.com" created="Thu, 28 Feb 2013 20:29:01 +0000"/>
                            <attachment id="12571246" name="SOLR-4505.patch" size="8625" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 19:04:51 +0000"/>
                            <attachment id="12571122" name="SOLR-4505.patch" size="8625" author="markrmiller@gmail.com" created="Wed, 27 Feb 2013 02:34:05 +0000"/>
                            <attachment id="12570930" name="SOLR-4505.patch" size="7203" author="markrmiller@gmail.com" created="Tue, 26 Feb 2013 05:42:03 +0000"/>
                            <attachment id="12571290" name="newstack.txt" size="2133109" author="erickerickson" created="Wed, 27 Feb 2013 22:50:03 +0000"/>
                            <attachment id="12571238" name="newstack.txt" size="2877373" author="erickerickson" created="Wed, 27 Feb 2013 18:26:10 +0000"/>
                            <attachment id="12570989" name="newstack.txt" size="434342" author="erickerickson" created="Tue, 26 Feb 2013 15:30:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ia4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314901</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>