<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:31:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4075] Upon removing the last core of a shard, the shard is not removed from the cluster state.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4075</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Simple Repro of this issue: which now I thought was related to the decision made in: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3080&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-3080&lt;/a&gt; but Mark tells me might have been a problem during the zk layout refactoring right before 4.0.&lt;/p&gt;

&lt;p&gt;1.	Download SOLR 4 production and extract.&lt;br/&gt;
2.	Replace solr.xml in apache-solr-4.0.0/example/solr/solr.xml with:&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&lt;br/&gt;
&amp;lt;solr persistent=&quot;true&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;cores adminPath=&quot;/admin/cores&quot; defaultCoreName=&quot;collection1&quot; host=&quot;${host:}&quot; hostPort=&quot;${jetty.port:}&quot; hostContext=&quot;${hostContext:}&quot; zkClientTimeout=&quot;${zkClientTimeout:15000}&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;core shard=&quot;shard1&quot; instanceDir=&quot;collection1/&quot; name=&quot;collection1&quot; collection=&quot;polecat&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;core shard=&quot;shard1&quot; instanceDir=&quot;collection2/&quot; name=&quot;collection2&quot; collection=&quot;polecat&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;core schema=&quot;schema.xml&quot; shard=&quot;core3&quot; instanceDir=&quot;core3/&quot; name=&quot;core3&quot; config=&quot;solrconfig.xml&quot; collection=&quot;polecat&quot; dataDir=&quot;data&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/cores&amp;gt;&lt;br/&gt;
&amp;lt;/solr&amp;gt;&lt;/p&gt;

&lt;p&gt;3.	Start solr with: java -Dbootstrap_confdir=./solr/collection1/conf -Dcollection.configName=myconf -DzkRun -Dsolrcloud.skip.autorecovery=true  -jar start.jar&lt;br/&gt;
	(skip.autorecovery is used because the shards don&apos;t exist previously)&lt;/p&gt;

&lt;p&gt;Then run this:&lt;br/&gt;
	Sanity query:  &lt;a href=&quot;http://localhost:8983/solr/polecat/select?q=*%3A*&amp;amp;wt=xml&amp;amp;distrib=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/polecat/select?q=*%3A*&amp;amp;wt=xml&amp;amp;distrib=true&lt;/a&gt;&lt;br/&gt;
	Remove the core: &lt;a href=&quot;http://localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=core3&amp;amp;deleteIndex=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=core3&amp;amp;deleteIndex=true&lt;/a&gt;&lt;br/&gt;
	Error query: &lt;a href=&quot;http://localhost:8983/solr/polecat/select?q=*%3A*&amp;amp;wt=xml&amp;amp;distrib=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/polecat/select?q=*%3A*&amp;amp;wt=xml&amp;amp;distrib=true&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And the sanity query, we will receive 0 records, the error query &quot;no servers hosting shard:&quot;.   And in the clusterstate.json:  &quot;core3&quot;:{&quot;replicas&quot;:{}}}}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12616065">SOLR-4075</key>
            <summary>Upon removing the last core of a shard, the shard is not removed from the cluster state.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="comeaugilles">Gilles Comeau</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Wed, 14 Nov 2012 14:07:20 +0000</created>
                <updated>Mon, 9 May 2016 18:44:25 +0000</updated>
                            <resolved>Mon, 19 Nov 2012 22:16:08 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13497405" author="markrmiller@gmail.com" created="Wed, 14 Nov 2012 20:18:03 +0000"  >&lt;p&gt;Hmm - well, adding a quick test that creates 6 cores in a collection and then unloads them shows the collection go away in clusterstate.json. So something interesting must be happening here...&lt;/p&gt;</comment>
                            <comment id="13497484" author="comeaugilles" created="Wed, 14 Nov 2012 21:36:55 +0000"  >&lt;p&gt;Agree.. I&apos;ve done a similar test using:&lt;/p&gt;

&lt;p&gt;SOLR.XML -&amp;gt; &lt;br/&gt;
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&lt;br/&gt;
&amp;lt;solr persistent=&quot;true&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;cores adminPath=&quot;/admin/cores&quot; defaultCoreName=&quot;collection1&quot; host=&quot;${host:}&quot; hostPort=&quot;${jetty.port:}&quot; hostContext=&quot;${hostContext:}&quot; zkClientTimeout=&quot;${zkClientTimeout:15000}&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;core shard=&quot;shard1&quot; instanceDir=&quot;collection1/&quot; name=&quot;collection1&quot; collection=&quot;polecat&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;core shard=&quot;shard1&quot; instanceDir=&quot;collection2/&quot; name=&quot;collection2&quot; collection=&quot;polecat&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;core schema=&quot;schema.xml&quot; shard=&quot;core3&quot; instanceDir=&quot;core3/&quot; name=&quot;core3&quot; config=&quot;solrconfig.xml&quot; collection=&quot;polecat&quot; dataDir=&quot;data&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;core schema=&quot;schema.xml&quot; shard=&quot;core4&quot; instanceDir=&quot;core4/&quot; name=&quot;core4&quot; config=&quot;solrconfig.xml&quot; collection=&quot;polecat2&quot; dataDir=&quot;data&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;core schema=&quot;schema.xml&quot; shard=&quot;core5&quot; instanceDir=&quot;core5/&quot; name=&quot;core5&quot; config=&quot;solrconfig.xml&quot; collection=&quot;polecat2&quot; dataDir=&quot;data&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/cores&amp;gt;&lt;br/&gt;
&amp;lt;/solr&amp;gt;&lt;/p&gt;

&lt;p&gt;and &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=core4&amp;amp;deleteIndex=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=core4&amp;amp;deleteIndex=true&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=core5&amp;amp;deleteIndex=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=core5&amp;amp;deleteIndex=true&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and the polecat2 collection is removed with core5.&lt;/p&gt;

&lt;p&gt;I do get the &quot;no servers hosting shard:&quot; error after removing core4 and before removing core5.  &lt;/p&gt;

&lt;p&gt;So it&apos;s a &quot;removing last core does not remove shard&quot; while &quot;removing last core removes collection&quot; is working fine?&lt;/p&gt;</comment>
                            <comment id="13497814" author="markrmiller@gmail.com" created="Thu, 15 Nov 2012 07:20:13 +0000"  >&lt;p&gt;Ah, yes, I bet that is it.&lt;/p&gt;</comment>
                            <comment id="13497826" author="markrmiller@gmail.com" created="Thu, 15 Nov 2012 07:56:18 +0000"  >&lt;p&gt;Here is a first patch with a fix - test is visual - I have to add some checks to it.&lt;/p&gt;</comment>
                            <comment id="13498218" author="comeaugilles" created="Thu, 15 Nov 2012 18:35:36 +0000"  >&lt;p&gt;This worked perfectly for us in test today, and we&apos;re going to put it into production quite shortly.  Thank you Mark!&lt;/p&gt;</comment>
                            <comment id="13500675" author="commit-tag-bot" created="Mon, 19 Nov 2012 22:08:13 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1411450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1411450&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4075&quot; title=&quot;Upon removing the last core of a shard, the shard is not removed from the cluster state.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4075&quot;&gt;&lt;del&gt;SOLR-4075&lt;/del&gt;&lt;/a&gt;: A logical shard that has had all of it&apos;s SolrCores unloaded should be removed from the cluster state.&lt;/p&gt;
</comment>
                            <comment id="13500683" author="commit-tag-bot" created="Mon, 19 Nov 2012 22:14:19 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1411451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1411451&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4075&quot; title=&quot;Upon removing the last core of a shard, the shard is not removed from the cluster state.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4075&quot;&gt;&lt;del&gt;SOLR-4075&lt;/del&gt;&lt;/a&gt;: A logical shard that has had all of it&apos;s SolrCores unloaded should be removed from the cluster state.&lt;/p&gt;
</comment>
                            <comment id="13500685" author="markrmiller@gmail.com" created="Mon, 19 Nov 2012 22:16:08 +0000"  >&lt;p&gt;Thanks for the detailed report Gilles!&lt;/p&gt;</comment>
                            <comment id="13610536" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:16:08 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1411451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1411451&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4075&quot; title=&quot;Upon removing the last core of a shard, the shard is not removed from the cluster state.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4075&quot;&gt;&lt;del&gt;SOLR-4075&lt;/del&gt;&lt;/a&gt;: A logical shard that has had all of it&apos;s SolrCores unloaded should be removed from the cluster state.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12553627" name="SOLR-4075.patch" size="4051" author="markrmiller@gmail.com" created="Thu, 15 Nov 2012 07:56:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257766</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0kjvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>118036</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>