<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:50:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16205] Span operationName for v2 APIs should include collection/core names</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16205</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;HttpSolrCall and V2HttpSolrCall are responsible for populating the opentracing &quot;spans&quot; that track individual API calls.  A big piece of this is assigning each span an &quot;operationName&quot;, which typically consists of a HTTP verb and a normalized copy of the URL path (separated by a colon).&lt;/p&gt;

&lt;p&gt;It looks like the intention is that these URL paths should be complete.  i.e. They&apos;re not just the request handler name or whatever follows the collection name, but the full URL path.&lt;/p&gt;

&lt;p&gt;But for some AnnotatedApis, we do end up using an incomplete path.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/core/src/java/org/apache/solr/api/V2HttpCall.java#L429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;span population logic&lt;/a&gt; for v2 APIs has a special check for AA instances - if the API call in question is an AA, we grab the first path off the AA &quot;Endpoint&quot; as a shortcut to save us the work of joining and normalizing each of the path segments held by the HttpSolrCall/V2HttpCall.&lt;/p&gt;

&lt;p&gt;This works great for AA&apos;s registered at the CoreContainer level: the annotations for those AA&apos;s include the full path (e.g. &lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/core/src/java/org/apache/solr/handler/admin/api/ReloadCollectionAPI.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ReloadCollectionAPI&lt;/a&gt;).  But this &lt;em&gt;isn&apos;t&lt;/em&gt; the case for AA&apos;s registered at the individual-core level, the annotations on these AA&apos;s only includes the path segments that follows the core/collection name.  (e.g. &lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/core/src/java/org/apache/solr/handler/admin/api/RealTimeGetAPI.java#L42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RealTimeGetAPI&lt;/a&gt;).  As a result, core-level AA&apos;s produce spans with operationName&apos;s like &lt;tt&gt;get:/get&lt;/tt&gt;, instead of the fuller &lt;tt&gt;get:/c/{collection}/get&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure this is a huge deal either way, but it&apos;d be a nice consistency thing to straighten out.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13445874">SOLR-16205</key>
            <summary>Span operationName for v2 APIs should include collection/core names</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gerlowskija">Jason Gerlowski</assignee>
                                    <reporter username="gerlowskija">Jason Gerlowski</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 May 2022 16:27:36 +0000</created>
                <updated>Fri, 17 Oct 2025 20:05:20 +0000</updated>
                            <resolved>Tue, 31 May 2022 16:28:35 +0000</resolved>
                                    <version>9.0</version>
                                    <fixVersion>9.1</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                    <component>v2 API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17539657" author="gerlowskija" created="Thu, 19 May 2022 16:40:36 +0000"  >&lt;p&gt;There are a few ways we could handle this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;change core-level AA registration in a way that&apos;d allow us to specify full paths on AA&apos;s&lt;/li&gt;
	&lt;li&gt;add a getCanonicalPath method to the Api or AnnotatedApi interface, and have V2HttpCall use that&lt;/li&gt;
	&lt;li&gt;leave the AA paths as-is, but add logic to V2HttpCall to detect when an AA is registered at the core-level and add a path prefix based on that.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But maybe the simplest and best approach here is to get rid of the AnnotatedApi special-case altogether, and always compute the full path from individual segments as we do in the &quot;normal&quot; case &lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/core/src/java/org/apache/solr/api/V2HttpCall.java#L431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Any chance you have thoughts on what makes the most sense here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;?  I think you added the AnnotatedApi special case in your work on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15392&quot; title=&quot;Improve Tracing operation names and tags&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15392&quot;&gt;&lt;del&gt;SOLR-15392&lt;/del&gt;&lt;/a&gt;.  Was it an optimization just to save us some cycles?  Do you expect it to be significant enough that you&apos;d have qualms if we ditched it?&lt;/p&gt;</comment>
                            <comment id="17539794" author="dsmiley" created="Thu, 19 May 2022 20:45:25 +0000"  >&lt;p&gt;I don&apos;t have a strong opinion, but I suppose my preference is removing the special case.  This is ultimately less code/complexity.  We might later do any of the other options you identified.&lt;/p&gt;</comment>
                            <comment id="17540145" author="gerlowskija" created="Fri, 20 May 2022 14:24:19 +0000"  >&lt;p&gt;Alright, that&apos;s my preference as well, just wanted to make sure it wasn&apos;t &quot;load bearing&quot; performance-wise before I take it out.  Thanks for weighing in!&lt;/p&gt;

&lt;p&gt;It might still make sense to give the Api interface some notion of what level they&apos;re registered at (global vs core), but I&apos;d rather punt on that for now until we see another need for it rather than complicate things.&lt;/p&gt;

&lt;p&gt;I&apos;ve opened up a PR and will merge it after the weekend as long as test runs look good.&lt;/p&gt;</comment>
                            <comment id="17541175" author="jira-bot" created="Mon, 23 May 2022 21:20:23 +0000"  >&lt;p&gt;Commit c38ef272d7bcae7425e00fc8649de6f351440d0b in solr&apos;s branch refs/heads/main from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=c38ef272d7b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=c38ef272d7b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16205&quot; title=&quot;Span operationName for v2 APIs should include collection/core names&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16205&quot;&gt;&lt;del&gt;SOLR-16205&lt;/del&gt;&lt;/a&gt;: Simplify v2 API span-population logic (#873)&lt;/p&gt;

&lt;p&gt;Prior to this commit, V2HttpCall populated the &quot;operationName&quot; of&lt;br/&gt;
tracing spans differently depending on whether the API was implemented&lt;br/&gt;
as an AnnotatedApi or not.  A special code path for AnnotatedApi&apos;s had&lt;br/&gt;
the operationName come primarily from the path value specified on the&lt;br/&gt;
@Endpoint annotation.&lt;/p&gt;

&lt;p&gt;This works well for AnnotatedApis registered at the CoreContainer level,&lt;br/&gt;
but actually produces the wrong path for AnnotatedApis registered on&lt;br/&gt;
individual cores.  This commit removes this optimized code path, so that&lt;br/&gt;
per-core AnnotatedApis produce spans consistent with everything else.&lt;/p&gt;</comment>
                            <comment id="17541178" author="jira-bot" created="Mon, 23 May 2022 21:29:12 +0000"  >&lt;p&gt;Commit 324a878b0b93d872c02523add2e65d481ccffe14 in solr&apos;s branch refs/heads/branch_9x from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=324a878b0b9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=324a878b0b9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16205&quot; title=&quot;Span operationName for v2 APIs should include collection/core names&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16205&quot;&gt;&lt;del&gt;SOLR-16205&lt;/del&gt;&lt;/a&gt;: Simplify v2 API span-population logic&lt;/p&gt;

&lt;p&gt;Prior to this commit, V2HttpCall populated the &quot;operationName&quot; of&lt;br/&gt;
tracing spans differently depending on whether the API was implemented&lt;br/&gt;
as an AnnotatedApi or not.  A special code path for AnnotatedApi&apos;s had&lt;br/&gt;
the operationName come primarily from the path value specified on the&lt;br/&gt;
@Endpoint annotation.&lt;/p&gt;

&lt;p&gt;This works well for AnnotatedApis registered at the CoreContainer level,&lt;br/&gt;
but actually produces the wrong path for AnnotatedApis registered on&lt;br/&gt;
individual cores.  This commit removes this optimized code path, so that&lt;br/&gt;
per-core AnnotatedApis produce spans consistent with everything else.&lt;/p&gt;</comment>
                            <comment id="17656862" author="ishan" created="Tue, 10 Jan 2023 20:45:30 +0000"  >&lt;p&gt;Bulk closing 9.1 issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z12iq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>