<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:22:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10047] Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10047</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The configuration of UninvertingReader in SolrIndexSearch creates a global mapping for the directory for fields to uninvert. If docvalues are enabled on a field the creation of a new segment will cause the query to fail when faceting/sorting on the recently docvalue enabled field. This happens because the UninvertingReader is configured globally across the entire directory, and a single segment containing DVs for a field will incorrectly indicate that all segments contain DVs.&lt;/p&gt;

&lt;p&gt;This patch addresses the incorrect behavior by determining the fields to be uninverted on a per-segment basis.&lt;/p&gt;

&lt;p&gt;With the fix, it is still recommended that a reindexing occur as data loss will when a DV and non-DV segment are merged, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10046&quot; title=&quot;Create UninvertDocValuesMergePolicy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10046&quot;&gt;&lt;del&gt;SOLR-10046&lt;/del&gt;&lt;/a&gt; addresses this behavior. This fix is to be a stop gap for the time between enabling docvalues and the duration of a reindex. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13038295">SOLR-10047</key>
            <summary>Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="k317h">Keith Laban</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jan 2017 22:27:05 +0000</created>
                <updated>Wed, 2 Oct 2019 17:24:40 +0000</updated>
                            <resolved>Mon, 24 Apr 2017 19:03:54 +0000</resolved>
                                                    <fixVersion>6.6</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15840577" author="githubbot" created="Thu, 26 Jan 2017 22:30:29 +0000"  >&lt;p&gt;GitHub user kelaban opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/145&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - SolrIndexSearcher, UninvertingReader, uninvert docvalues&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230; per segment&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kelaban/lucene-solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kelaban/lucene-solr&lt;/a&gt; jira/master/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;/uninverting-reader-per-segment&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/145.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/145.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #145&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2898c46613f2708ce8c472f821ac4f2c42cd8b48&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   2017-01-18T21:39:51Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - SolrIndexSearcher, UninvertingReader, uninvert docvalues per segment&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15956712" author="shalinmangar" created="Wed, 5 Apr 2017 11:44:53 +0000"  >&lt;p&gt;Thanks Keith.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I merged the pull request to latest master to try this out locally and the UninvertingDirectoryReaderMappingPerSegment requires an implementation of IndexReader#getReaderCacheHelper method which was added to IndexReader in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-7410&quot; title=&quot;Make cache keys and closed listeners less trappy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-7410&quot;&gt;&lt;del&gt;LUCENE-7410&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;I find the javadocs for UninvertingDirectoryReaderMappingPerSegment a little confusing. I made an attempt to rewrite them to convey the intention and implementation better. Use if you see fit:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   * If docvalues are enabled or disabled after data has already been indexed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a field, such that
   * only some segments have docvalues, uninverting on the top level reader will cause 
   * IllegalStateException to be thrown when trying to use a field with such mixed data. This is because
   * the {@link IndexSchema#getUninversionMap(IndexReader)} method decides to put a field 
   * into the uninverteding map only &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; *NO* segment in the index contains docvalues &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; that field.
   * 
   * Therefore, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;provides a uninverting map per segment such that &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; any field, 
   * DocValues are used from segments &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; they exist and uninversion of the field is performed on the &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;
   * of the segments.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Perhaps we can rename UninvertingDirectoryReaderMappingPerSegment to PerSegmentUninvertingDirectoryReader or UninvertingDirectoryReaderPerSegmentMapping?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The rest of the changes looks good to me.&lt;/p&gt;</comment>
                            <comment id="15957449" author="k317h" created="Wed, 5 Apr 2017 19:00:35 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;updated javadoc&lt;/li&gt;
	&lt;li&gt;renamed class to &lt;tt&gt;UninvertingDirectoryReaderPerSegmentMapping&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;added IndexReader#getReaderCacheHelper (copied note from UninvertingDirectoryReader)&lt;/li&gt;
	&lt;li&gt;removed old now unsued UninvertingDirectoryReader&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15958585" author="shalinmangar" created="Thu, 6 Apr 2017 08:53:53 +0000"  >&lt;p&gt;Hi Keith, the UninvertingReader#wrap method is used in multiple tests so we can&apos;t remove it. We should audit the uses and use UninvertingDirectoryReaderPerSegmentMapping.&lt;/p&gt;</comment>
                            <comment id="15959865" author="k317h" created="Thu, 6 Apr 2017 22:10:10 +0000"  >&lt;p&gt;Shalin, based on your comment I did a bit of an overhaul to the original PR.&lt;/p&gt;

&lt;p&gt;Instead of deleting UninvertingReader#wrap I changed the interface from accepting &lt;tt&gt;Map&lt;/tt&gt; to &lt;tt&gt;Function&amp;lt;LeafReader,Map&amp;gt;&lt;/tt&gt;. With this change I updated SolrIndexSearcher to use this interface instead of creating a new static class. I also updated all of the places where the original static function &lt;tt&gt;wrap&lt;/tt&gt; was being used.&lt;/p&gt;

&lt;p&gt;If you think updating all of the test to the new interface is too much overkill/not backcompat I can overload the &lt;tt&gt;UninvertingReader#wrap&lt;/tt&gt; function to accept the original static mapping and delegate to the new impl.&lt;/p&gt;</comment>
                            <comment id="15964620" author="shalinmangar" created="Tue, 11 Apr 2017 16:41:43 +0000"  >&lt;p&gt;Thanks Keith, I think we need to keep the old wrap function around for backcompat in 6.x but it should be fine to remove it in the master branch. Rest looks good to me.&lt;/p&gt;</comment>
                            <comment id="15964985" author="k317h" created="Tue, 11 Apr 2017 21:28:31 +0000"  >&lt;p&gt;Shalin, I wasn&apos;t sure exactly how you wanted me to submit the diff between 6.x and master.&lt;/p&gt;

&lt;p&gt;In this PR:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/kelaban/lucene-solr/commit/806f33e092491cc6a2ee292d2934c76171e40dc7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Commit&lt;/a&gt; adds new and old interface, and modifies all the tests to use the new interface&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/kelaban/lucene-solr/commit/c38f4cabc2828ee83b53b931dd829e29a3e1701c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Commit&lt;/a&gt; reverts the tests to using the old interface.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If you want to keep both interfaces as a convenience method and tests unmodified you can squash them all down. Otherwise use HEAD for 6.x (tests not updated) and reset to HEAD^ for master (tests updated). &lt;/p&gt;

&lt;p&gt;I did not write specific tests to explicitly use new/old signature because they all use the new signature under the hood. The test I added in the original commit tests the updated intended behavior.&lt;/p&gt;</comment>
                            <comment id="15970821" author="shalinmangar" created="Mon, 17 Apr 2017 07:56:17 +0000"  >&lt;p&gt;Thanks Keith. Let&apos;s keep both interfaces and the tests unmodified. I&apos;ll squash merge your pull request to master and backport to 6x.&lt;/p&gt;</comment>
                            <comment id="15970840" author="jira-bot" created="Mon, 17 Apr 2017 08:29:46 +0000"  >&lt;p&gt;Commit 4da901a0728239ac4e87b662533f966158991948 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4da901a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4da901a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;: Mismatched Docvalues segments cause exception in Sorting/Faceting. Solr now uninverts per segment to avoid such exceptions&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit c38f4cabc2828ee83b53b931dd829e29a3e1701c&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:17:05 2017 -0400&lt;/p&gt;

&lt;p&gt;    reverted tests to using old wrap interface&lt;/p&gt;

&lt;p&gt;commit 806f33e092491cc6a2ee292d2934c76171e40dc7&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:13:34 2017 -0400&lt;/p&gt;

&lt;p&gt;    updated UninvertingReader.wrap / tests&lt;/p&gt;

&lt;p&gt;commit b10bcab338b362b909491fea1cf13de66f5f17c0&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Apr 5 14:57:28 2017 -0400&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - Updated javadoc/renamed class/added getReaderCacheHelper&lt;/p&gt;

&lt;p&gt;commit 90ecf5a4ae4feaf3efc42a1ed8643ad21e1c73ce&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Jan 18 16:39:51 2017 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - SolrIndexSearcher, UninvertingReader, uninvert docvalues per segment&lt;/p&gt;</comment>
                            <comment id="15970841" author="jira-bot" created="Mon, 17 Apr 2017 08:29:50 +0000"  >&lt;p&gt;Commit 4da901a0728239ac4e87b662533f966158991948 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4da901a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4da901a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;: Mismatched Docvalues segments cause exception in Sorting/Faceting. Solr now uninverts per segment to avoid such exceptions&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit c38f4cabc2828ee83b53b931dd829e29a3e1701c&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:17:05 2017 -0400&lt;/p&gt;

&lt;p&gt;    reverted tests to using old wrap interface&lt;/p&gt;

&lt;p&gt;commit 806f33e092491cc6a2ee292d2934c76171e40dc7&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:13:34 2017 -0400&lt;/p&gt;

&lt;p&gt;    updated UninvertingReader.wrap / tests&lt;/p&gt;

&lt;p&gt;commit b10bcab338b362b909491fea1cf13de66f5f17c0&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Apr 5 14:57:28 2017 -0400&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - Updated javadoc/renamed class/added getReaderCacheHelper&lt;/p&gt;

&lt;p&gt;commit 90ecf5a4ae4feaf3efc42a1ed8643ad21e1c73ce&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Jan 18 16:39:51 2017 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - SolrIndexSearcher, UninvertingReader, uninvert docvalues per segment&lt;/p&gt;</comment>
                            <comment id="15970842" author="jira-bot" created="Mon, 17 Apr 2017 08:29:53 +0000"  >&lt;p&gt;Commit 4da901a0728239ac4e87b662533f966158991948 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4da901a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4da901a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;: Mismatched Docvalues segments cause exception in Sorting/Faceting. Solr now uninverts per segment to avoid such exceptions&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit c38f4cabc2828ee83b53b931dd829e29a3e1701c&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:17:05 2017 -0400&lt;/p&gt;

&lt;p&gt;    reverted tests to using old wrap interface&lt;/p&gt;

&lt;p&gt;commit 806f33e092491cc6a2ee292d2934c76171e40dc7&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:13:34 2017 -0400&lt;/p&gt;

&lt;p&gt;    updated UninvertingReader.wrap / tests&lt;/p&gt;

&lt;p&gt;commit b10bcab338b362b909491fea1cf13de66f5f17c0&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Apr 5 14:57:28 2017 -0400&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - Updated javadoc/renamed class/added getReaderCacheHelper&lt;/p&gt;

&lt;p&gt;commit 90ecf5a4ae4feaf3efc42a1ed8643ad21e1c73ce&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Jan 18 16:39:51 2017 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - SolrIndexSearcher, UninvertingReader, uninvert docvalues per segment&lt;/p&gt;</comment>
                            <comment id="15970859" author="jira-bot" created="Mon, 17 Apr 2017 08:46:05 +0000"  >&lt;p&gt;Commit 3e4629b8dfc6942fe391b741a8fb7d7baaeb854d in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3e4629b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3e4629b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;: Mismatched Docvalues segments cause exception in Sorting/Faceting. Solr now uninverts per segment to avoid such exceptions&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit c38f4cabc2828ee83b53b931dd829e29a3e1701c&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:17:05 2017 -0400&lt;/p&gt;

&lt;p&gt;    reverted tests to using old wrap interface&lt;/p&gt;

&lt;p&gt;commit 806f33e092491cc6a2ee292d2934c76171e40dc7&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:13:34 2017 -0400&lt;/p&gt;

&lt;p&gt;    updated UninvertingReader.wrap / tests&lt;/p&gt;

&lt;p&gt;commit b10bcab338b362b909491fea1cf13de66f5f17c0&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Apr 5 14:57:28 2017 -0400&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - Updated javadoc/renamed class/added getReaderCacheHelper&lt;/p&gt;

&lt;p&gt;commit 90ecf5a4ae4feaf3efc42a1ed8643ad21e1c73ce&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Jan 18 16:39:51 2017 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - SolrIndexSearcher, UninvertingReader, uninvert docvalues per segment&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 4da901a0728239ac4e87b662533f966158991948)&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;solr/core/src/test/org/apache/solr/schema/DocValuesTest.java&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15970860" author="jira-bot" created="Mon, 17 Apr 2017 08:46:08 +0000"  >&lt;p&gt;Commit 3e4629b8dfc6942fe391b741a8fb7d7baaeb854d in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3e4629b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3e4629b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;: Mismatched Docvalues segments cause exception in Sorting/Faceting. Solr now uninverts per segment to avoid such exceptions&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit c38f4cabc2828ee83b53b931dd829e29a3e1701c&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:17:05 2017 -0400&lt;/p&gt;

&lt;p&gt;    reverted tests to using old wrap interface&lt;/p&gt;

&lt;p&gt;commit 806f33e092491cc6a2ee292d2934c76171e40dc7&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:13:34 2017 -0400&lt;/p&gt;

&lt;p&gt;    updated UninvertingReader.wrap / tests&lt;/p&gt;

&lt;p&gt;commit b10bcab338b362b909491fea1cf13de66f5f17c0&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Apr 5 14:57:28 2017 -0400&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - Updated javadoc/renamed class/added getReaderCacheHelper&lt;/p&gt;

&lt;p&gt;commit 90ecf5a4ae4feaf3efc42a1ed8643ad21e1c73ce&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Jan 18 16:39:51 2017 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - SolrIndexSearcher, UninvertingReader, uninvert docvalues per segment&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 4da901a0728239ac4e87b662533f966158991948)&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;solr/core/src/test/org/apache/solr/schema/DocValuesTest.java&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15970861" author="jira-bot" created="Mon, 17 Apr 2017 08:46:12 +0000"  >&lt;p&gt;Commit 3e4629b8dfc6942fe391b741a8fb7d7baaeb854d in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3e4629b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3e4629b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;: Mismatched Docvalues segments cause exception in Sorting/Faceting. Solr now uninverts per segment to avoid such exceptions&lt;/p&gt;

&lt;p&gt;Squashed commit of the following:&lt;/p&gt;

&lt;p&gt;commit c38f4cabc2828ee83b53b931dd829e29a3e1701c&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:17:05 2017 -0400&lt;/p&gt;

&lt;p&gt;    reverted tests to using old wrap interface&lt;/p&gt;

&lt;p&gt;commit 806f33e092491cc6a2ee292d2934c76171e40dc7&lt;br/&gt;
Author: Keith Laban &amp;lt;kelaban17@gmail.com&amp;gt;&lt;br/&gt;
Date:   Tue Apr 11 17:13:34 2017 -0400&lt;/p&gt;

&lt;p&gt;    updated UninvertingReader.wrap / tests&lt;/p&gt;

&lt;p&gt;commit b10bcab338b362b909491fea1cf13de66f5f17c0&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Apr 5 14:57:28 2017 -0400&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - Updated javadoc/renamed class/added getReaderCacheHelper&lt;/p&gt;

&lt;p&gt;commit 90ecf5a4ae4feaf3efc42a1ed8643ad21e1c73ce&lt;br/&gt;
Author: Keith Laban &amp;lt;klaban1@bloomberg.net&amp;gt;&lt;br/&gt;
Date:   Wed Jan 18 16:39:51 2017 -0500&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - SolrIndexSearcher, UninvertingReader, uninvert docvalues per segment&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 4da901a0728239ac4e87b662533f966158991948)&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;solr/core/src/test/org/apache/solr/schema/DocValuesTest.java&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15970943" author="shalinmangar" created="Mon, 17 Apr 2017 10:28:31 +0000"  >&lt;p&gt;Thanks Keith!&lt;/p&gt;

&lt;p&gt;I forgot to add the magic line to the commit which auto-closes the PR so you have to do that manually, sorry!&lt;/p&gt;</comment>
                            <comment id="15974706" author="steve_rowe" created="Wed, 19 Apr 2017 13:55:33 +0000"  >&lt;p&gt;Policeman Jenkins failure reproduces for me &lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/19429/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/19429/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Checking out Revision 48d54ac45860a1b75bfd79aaffe9d4d24c2ad5a8 (refs/remotes/origin/master)
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=DocValuesTest -Dtests.method=testHalfAndHalfDocValues -Dtests.seed=D4C321F7B9F8C0F3 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=hu-HU -Dtests.timezone=WET -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 0.04s J1 | DocValuesTest.testHalfAndHalfDocValues &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;3&amp;gt; but was:&amp;lt;2&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([D4C321F7B9F8C0F3:1B0859436D75536E]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.schema.DocValuesTest.testHalfAndHalfDocValues(DocValuesTest.java:192)
[...]
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene70), sim=RandomSimilarity(queryNorm=false): {}, locale=hu-HU, timezone=WET
   [junit4]   2&amp;gt; NOTE: Linux 4.4.0-72-generic i386/Oracle Corporation 1.8.0_121 (32-bit)/cpus=12,threads=1,free=146280496,total=518979584
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I run the repro line on my Linux box, the actual value was &lt;tt&gt;1&lt;/tt&gt; instead of the &lt;tt&gt;2&lt;/tt&gt; though, so at a minimum there&apos;s some flakiness here:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;3&amp;gt; but was:&amp;lt;1&amp;gt;&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15975006" author="k317h" created="Wed, 19 Apr 2017 16:24:56 +0000"  >&lt;p&gt;Thanks Steve, I am able to reproduce this using this seed. The test commits three documents and relies on them not being merged into a single segment to verify the behavior of this patch works correctly. It seems like with this seed the merge policy is merging these three segments. &lt;/p&gt;

&lt;p&gt;What is the best way to setup this test to assure that no merges occur?&lt;/p&gt;</comment>
                            <comment id="15979028" author="hossman" created="Fri, 21 Apr 2017 16:34:23 +0000"  >&lt;p&gt;MergePolicy settings are normally randomized by the solr test configs.&lt;/p&gt;

&lt;p&gt;If a test is dependent on controlling exact when a merge does/doesn&apos;t happen, you&apos;ll need to force the mergepolicy using something like &lt;tt&gt;NoMergePolicyFactory&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Example from TestInPlaceUpdatesDistrib...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// we need consistent segments that aren&lt;span class=&quot;code-quote&quot;&gt;&apos;t re-ordered on merge because we&apos;&lt;/span&gt;re
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// asserting inplace updates happen by checking the internal [docid]
&lt;/span&gt;systemSetPropertySolrTestsMergePolicyFactory(NoMergePolicyFactory.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName());

&lt;span class=&quot;code-comment&quot;&gt;// HACK: Don&lt;span class=&quot;code-quote&quot;&gt;&apos;t use a RandomMergePolicy, but only use the mergePolicyFactory that we&apos;&lt;/span&gt;ve just set
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(SYSTEM_PROPERTY_SOLR_TESTS_USEMERGEPOLICYFACTORY, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(SYSTEM_PROPERTY_SOLR_TESTS_USEMERGEPOLICY, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(the last two lines are only needed because we&apos;re phasing out MergePolicy for MergePolicyFactory)&lt;/p&gt;</comment>
                            <comment id="15981155" author="shalinmangar" created="Mon, 24 Apr 2017 13:28:18 +0000"  >&lt;p&gt;Re-opening due to test failures. I&apos;ll put up a patch with the fix suggested by Hoss.&lt;/p&gt;</comment>
                            <comment id="15981389" author="k317h" created="Mon, 24 Apr 2017 15:44:12 +0000"  >&lt;p&gt;Thanks Hoss, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; &amp;#8211; no need, I will take a look at it today.&lt;/p&gt;</comment>
                            <comment id="15981397" author="shalinmangar" created="Mon, 24 Apr 2017 15:52:59 +0000"  >&lt;p&gt;Thanks Keith but I have already prepared the patch. I&apos;m just waiting for the results of a round of beasting before I commit.&lt;/p&gt;

&lt;p&gt;Attached patch moves the new test into its own class so that we can use NoMergePolicy.&lt;/p&gt;</comment>
                            <comment id="15981421" author="githubbot" created="Mon, 24 Apr 2017 16:09:04 +0000"  >&lt;p&gt;Github user kelaban closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/145&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15981422" author="githubbot" created="Mon, 24 Apr 2017 16:09:12 +0000"  >&lt;p&gt;GitHub user kelaban opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/195&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt; - Fix test: Use NoMergePolicy in testing&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kelaban/lucene-solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kelaban/lucene-solr&lt;/a&gt; jira/master/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;/fix-tests-uninverting-reader-per-semnet&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/195.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/195.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #195&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="15981427" author="k317h" created="Mon, 24 Apr 2017 16:11:22 +0000"  >&lt;p&gt;Funny, I did the same thing. I closed the old PR and put in a new one &amp;#8211; &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/195/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/195/files&lt;/a&gt; . This can be closed if you find your patch to be satisfactory.&lt;/p&gt;</comment>
                            <comment id="15981544" author="githubbot" created="Mon, 24 Apr 2017 17:18:22 +0000"  >&lt;p&gt;Github user chatman commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/195#discussion_r113005049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/195#discussion_r113005049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: solr/core/src/test/org/apache/solr/schema/DocValuesEnabledLaterTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,140 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
    + * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
    + * this work for additional information regarding copyright ownership.&lt;br/&gt;
    + * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
    + * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
    + * the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +package org.apache.solr.schema;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.lang.invoke.MethodHandles;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.lucene.document.Document;&lt;br/&gt;
    +import org.apache.lucene.index.DirectoryReader;&lt;br/&gt;
    +import org.apache.lucene.index.DocValuesType;&lt;br/&gt;
    +import org.apache.lucene.index.FieldInfos;&lt;br/&gt;
    +import org.apache.lucene.index.LeafReader;&lt;br/&gt;
    +import org.apache.lucene.index.LeafReaderContext;&lt;br/&gt;
    +import org.apache.lucene.index.MultiFields;&lt;br/&gt;
    +import org.apache.solr.SolrTestCaseJ4;&lt;br/&gt;
    +import org.apache.solr.core.SolrCore;&lt;br/&gt;
    +import org.apache.solr.index.NoMergePolicyFactory;&lt;br/&gt;
    +import org.apache.solr.search.SolrIndexSearcher;&lt;br/&gt;
    +import org.apache.solr.util.RefCounted;&lt;br/&gt;
    +import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +public class DocValuesEnabledLaterTest extends SolrTestCaseJ4 {&lt;br/&gt;
    +&lt;br/&gt;
    +  private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());&lt;br/&gt;
    +&lt;br/&gt;
    +  @BeforeClass&lt;br/&gt;
    +  public static void beforeTests() throws Exception {&lt;br/&gt;
    +    initCore(&quot;solrconfig-basic.xml&quot;, &quot;schema-docValues.xml&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +   // we need consistent segments that aren&apos;t re-ordered on merge because we&apos;re&lt;br/&gt;
    +   // asserting inplace updates happen by checking the internal &lt;span class=&quot;error&quot;&gt;&amp;#91;docid&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Lets remove references to inplace updates here.&lt;/p&gt;</comment>
                            <comment id="15981675" author="jira-bot" created="Mon, 24 Apr 2017 18:56:32 +0000"  >&lt;p&gt;Commit 56e1ad484a2c7431932a95e442bc1a584f60698e in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56e1ad4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56e1ad4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;: Move test into its own test class and force use of NoMergePolicy to fix test failures&lt;/p&gt;

&lt;p&gt;This closes #195&lt;/p&gt;</comment>
                            <comment id="15981679" author="githubbot" created="Mon, 24 Apr 2017 18:57:36 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/195&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15981686" author="jira-bot" created="Mon, 24 Apr 2017 19:01:14 +0000"  >&lt;p&gt;Commit ef56f3868834243071b0d663aaab19fa21212495 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ef56f38&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ef56f38&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10047&quot; title=&quot;Mismatched Docvalue segments cause exception in Sorting/Facting; Uninvert per segment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10047&quot;&gt;&lt;del&gt;SOLR-10047&lt;/del&gt;&lt;/a&gt;: Move test into its own test class and force use of NoMergePolicy to fix test failures&lt;/p&gt;

&lt;p&gt;This closes #195&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 56e1ad4)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12864783" name="SOLR_10047_test.patch" size="9834" author="shalin" created="Mon, 24 Apr 2017 15:52:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 30 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i399vr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>