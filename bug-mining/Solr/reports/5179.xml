<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:10:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16866] CachingDirectoryFactory Throwing Error When Closing</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16866</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Observed occasional ERROR log entries when &lt;tt&gt;CachingDirectryFactory#close()&lt;/tt&gt; is called. The respective snippet from the log is this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2023-07-06 08:43:37.618 DEBUG (qtp212011969-1801) [   blueprint_gnylctsgemcz_users] o.a.s.c.CachingDirectoryFactory Removing directory after core close: /var/solr/data/blueprint_gnylctsgemcz_users/data
2023-07-06 08:43:37.620 DEBUG (qtp212011969-1801) [   blueprint_gnylctsgemcz_users] o.a.s.c.CachingDirectoryFactory Removing directory after core close: /var/solr/data/blueprint_gnylctsgemcz_users/data/index
2023-07-06 08:43:37.620 ERROR (qtp212011969-1801) [   blueprint_gnylctsgemcz_users] o.a.s.c.CachingDirectoryFactory Error removing directory =&amp;gt; java.nio.file.NoSuchFileException: /var/solr/data/blueprint_gnylctsgemcz_users/data/index
java.nio.file.NoSuchFileException: /var/solr/data/blueprint_gnylctsgemcz_users/data/index
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems like the order of directory removal is causing this (first parent dir &lt;em&gt;data&lt;/em&gt;, then sub-dir &lt;em&gt;data/index&lt;/em&gt;). Entries should be re-arranged or just the parent dir be handled.&lt;/p&gt;

&lt;p&gt;Full log with entries dealing with the respective core is attached.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13542703">SOLR-16866</key>
            <summary>CachingDirectoryFactory Throwing Error When Closing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="magibney">Michael Gibney</assignee>
                                    <reporter username="stefan.pieper">Stefan Pieper</reporter>
                        <labels>
                            <label>core</label>
                    </labels>
                <created>Thu, 6 Jul 2023 13:42:21 +0000</created>
                <updated>Wed, 22 May 2024 21:08:28 +0000</updated>
                            <resolved>Fri, 19 Apr 2024 21:09:46 +0000</resolved>
                                    <version>9.2.1</version>
                                    <fixVersion>9.6</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="14400">4h</timespent>
                                <comments>
                            <comment id="17784757" author="ahubold" created="Fri, 10 Nov 2023 10:13:45 +0000"  >&lt;p&gt;This bug did not occur with Solr 8.11.2. It&apos;s a regression that was introduced with &lt;a href=&quot;https://github.com/apache/solr/commit/3c3fb1df82c5144c0d6b36b7c0fd3bc0343cf15b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/commit/3c3fb1df82c5144c0d6b36b7c0fd3bc0343cf15b&lt;/a&gt; for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16074&quot; title=&quot;Reproducible failure TestReplicationHandler.doTestStressReplication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16074&quot;&gt;&lt;del&gt;SOLR-16074&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;org.apache.solr.core.StandardDirectoryFactory#removeDirectory was changed to use org.apache.commons.io.file.PathUtils#deleteDirectory(java.nio.file.Path) instead of org.apache.commons.io.FileUtils#deleteDirectory.&lt;/p&gt;

&lt;p&gt;The previously used method from commons-io returns without an error, if the directory to delete does not exist.&lt;/p&gt;

&lt;p&gt;We should add a check in StandardDirectoryFactory#removeDirectory and not call PathUtils#deleteDirectory for non-existing directories.&lt;/p&gt;</comment>
                            <comment id="17784761" author="ahubold" created="Fri, 10 Nov 2023 10:24:54 +0000"  >&lt;p&gt;BTW, FileUtils#deleteDirectory was replaced with PathUtils#deleteDirectory at quite a number of places. I haven&apos;t checked it, but maybe the missing existence check could cause new exceptions at other places as well.&lt;/p&gt;</comment>
                            <comment id="17824530" author="houston" created="Thu, 7 Mar 2024 20:36:40 +0000"  >&lt;p&gt;I made a PR for this. Was seeing it in the Solr Operator integration tests.&lt;/p&gt;</comment>
                            <comment id="17839120" author="jira-bot" created="Fri, 19 Apr 2024 21:02:42 +0000"  >&lt;p&gt;Commit 72793f5b9d9b1c611c8806eb2fa3bf5cc493f651 in solr&apos;s branch refs/heads/main from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=72793f5b9d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=72793f5b9d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16866&quot; title=&quot;CachingDirectoryFactory Throwing Error When Closing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16866&quot;&gt;&lt;del&gt;SOLR-16866&lt;/del&gt;&lt;/a&gt;: Reorder nested directory deletions to avoid logging spurious NoSuchFileException (#2349)&lt;/p&gt;
</comment>
                            <comment id="17839122" author="jira-bot" created="Fri, 19 Apr 2024 21:06:25 +0000"  >&lt;p&gt;Commit da6fc5adddc653256050c2ae8870513456c5f00a in solr&apos;s branch refs/heads/branch_9x from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=da6fc5adddc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=da6fc5adddc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16866&quot; title=&quot;CachingDirectoryFactory Throwing Error When Closing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16866&quot;&gt;&lt;del&gt;SOLR-16866&lt;/del&gt;&lt;/a&gt;: Reorder nested directory deletions to avoid logging spurious NoSuchFileException (#2349)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 72793f5b9d9b1c611c8806eb2fa3bf5cc493f651)&lt;/p&gt;</comment>
                            <comment id="17839123" author="jira-bot" created="Fri, 19 Apr 2024 21:09:00 +0000"  >&lt;p&gt;Commit e07799ea4ef726e533d9181d64ab30844fcac388 in solr&apos;s branch refs/heads/branch_9_6 from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=e07799ea4ef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=e07799ea4ef&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16866&quot; title=&quot;CachingDirectoryFactory Throwing Error When Closing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16866&quot;&gt;&lt;del&gt;SOLR-16866&lt;/del&gt;&lt;/a&gt;: Reorder nested directory deletions to avoid logging spurious NoSuchFileException (#2349)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 72793f5b9d9b1c611c8806eb2fa3bf5cc493f651)&lt;/p&gt;</comment>
                            <comment id="17841696" author="gus_heck" created="Sun, 28 Apr 2024 19:22:36 +0000"  >&lt;p&gt;Closing after the 9.6.0 release&lt;/p&gt;</comment>
                            <comment id="17843281" author="hossman" created="Fri, 3 May 2024 17:06:04 +0000"  >&lt;p&gt;The &lt;tt&gt;CachingDirectoryFactoryTest.reorderingTest&lt;/tt&gt; method added by this issue appears to be failing on many (every?) Windows jenkins build since it was committed.&lt;/p&gt;

&lt;p&gt;A recent main failure...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; org.apache.solr.core.CachingDirectoryFactoryTest &amp;gt; reorderingTest FAILED
&#160; &#160; java.lang.AssertionError
&#160; &#160; &#160; &#160; at __randomizedtesting.SeedInfo.seed([85529424332B55D9:FDFFFBBE80E21597]:0)
&#160; &#160; &#160; &#160; at app//org.junit.Assert.fail(Assert.java:87)
&#160; &#160; &#160; &#160; at app//org.junit.Assert.assertTrue(Assert.java:42)
&#160; &#160; &#160; &#160; at app//org.junit.Assert.assertTrue(Assert.java:53)
&#160; &#160; &#160; &#160; at app//org.apache.solr.core.CachingDirectoryFactoryTest.reorderingTest(CachingDirectoryFactoryTest.java:97)
&#160; &#160; &#160; &#160; at java.base@20.0.2/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Line 97...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      assertTrue(pathA.toFile().exists()); &lt;span class=&quot;code-comment&quot;&gt;// we know there are subdirs that should prevent removal&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17847046" author="houston" created="Thu, 16 May 2024 17:41:56 +0000"  >&lt;p&gt;I think this is due to a bad &lt;tt&gt;isSubPath()&lt;/tt&gt; method, which used &apos;/&apos; instead of File.separator. I&apos;ll put up a PR, but I can&apos;t test this locally since I don&apos;t have a windows machine.&lt;/p&gt;</comment>
                            <comment id="17847048" author="houston" created="Thu, 16 May 2024 17:44:15 +0000"  >&lt;p&gt;This might actually be a problem on Windows, not just testing, so maybe we should have a separate Jira for this? So it can be tagged to the 9.6.1 release&lt;/p&gt;</comment>
                            <comment id="17847081" author="hossman" created="Thu, 16 May 2024 19:29:49 +0000"  >&lt;p&gt;if you have to modify code outside of a test to fix this then it definitely needs a new Jira since 9.6 is already released.&lt;/p&gt;</comment>
                            <comment id="17847106" author="hossman" created="Thu, 16 May 2024 21:49:50 +0000"  >&lt;p&gt;Also, FWIW: I&apos;m not familiar enough with the code paths involved to know if switching to &lt;tt&gt;File.separatorChar&lt;/tt&gt; is the right fix (are these Strings filesystem paths, or &quot;conceptual&quot; paths that have been &quot;normalized&quot; ) but given the windows test failures i&apos;m going to assume your latest patch is valid.&lt;/p&gt;

&lt;p&gt;If no one with a windows box (or better confidence in the code) can validate, i suggest you commit to main and watch the Windows jenkins builds like a hawk, and if it starts passing then merge to 9x / 9.6.1&lt;/p&gt;</comment>
                            <comment id="17847422" author="mgibney" created="Fri, 17 May 2024 19:12:11 +0000"  >&lt;p&gt;Thanks for catching/fixing this.&lt;/p&gt;

&lt;p&gt;It definitely makes sense to include this in 9.6.1, but fwiw I don&apos;t think the actual behavior will have changed with 9.6.0, functionally, for Windows users.&lt;/p&gt;

&lt;p&gt;IIUC &lt;tt&gt;isSubPath()&lt;/tt&gt; would always return &lt;tt&gt;false&lt;/tt&gt; on Windows, both before and after &lt;a href=&quot;https://github.com/apache/solr/pull/2349&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR #2349&lt;/a&gt;. The functional consequence of this is that both before and after that PR, on Windows anytime a cache entry is closed it would be deleted immediately, regardless of whether it has yet-unclosed subpaths. This was the status quo before &lt;a href=&quot;https://github.com/apache/solr/pull/2349&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR #2349&lt;/a&gt; for both Windows and non-Windows, with arbitrary HashMap iteration order causing parent directories to be deleted before their child entries, leading NoSuchFileExceptions to be logged, e.g. on core removal.&lt;/p&gt;

&lt;p&gt;So although 9.6.0 fixed the behavior for non-Windows, the latent path-separator issue prevented it from being fixed for Windows, and the added test surfaced the issue for Windows (as well as demonstrating that the issue is fixed for non-Windows).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13431753">SOLR-16074</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13061111" name="solr.blueprint_gnylctsgemcz_users.log" size="310209" author="stefan.pieper" created="Thu, 6 Jul 2023 13:41:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1j04o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>