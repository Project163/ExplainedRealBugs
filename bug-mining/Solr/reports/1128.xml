<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:31:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4032] Files larger than an internal buffer size fail to replicate</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4032</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Please see: &lt;a href=&quot;http://lucene.472066.n3.nabble.com/trunk-is-unable-to-replicate-between-nodes-Unable-to-download-completely-td4017049.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.472066.n3.nabble.com/trunk-is-unable-to-replicate-between-nodes-Unable-to-download-completely-td4017049.html&lt;/a&gt; and &lt;br/&gt;
&lt;a href=&quot;http://lucene.472066.n3.nabble.com/Possible-memory-leak-in-recovery-td4017833.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.472066.n3.nabble.com/Possible-memory-leak-in-recovery-td4017833.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;5.0-SNAPSHOT 1366361:1404534M - markus - 2012-11-01 12:37:38&lt;br/&gt;
Debian Squeeze, Tomcat 6, Sun Java 6, 10 nodes, 10 shards, rep. factor 2.&lt;/p&gt;</environment>
        <key id="12614766">SOLR-4032</key>
            <summary>Files larger than an internal buffer size fail to replicate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="markus17">Markus Jelsma</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Nov 2012 10:25:50 +0000</created>
                <updated>Mon, 9 May 2016 18:56:01 +0000</updated>
                            <resolved>Tue, 27 Nov 2012 22:10:05 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13502069" author="markrmiller@gmail.com" created="Wed, 21 Nov 2012 15:47:43 +0000"  >&lt;p&gt;Markus - any chance you can give a slightly longer stack trace on the sizeOf issue that is using the wrong directory?&lt;/p&gt;

&lt;p&gt;The provided trace is teasingly short:&lt;/p&gt;

&lt;p&gt;2012-10-30 16:32:26,578 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;handler.admin.CoreAdminHandler&amp;#93;&lt;/span&gt; - &lt;span class=&quot;error&quot;&gt;&amp;#91;http-8080-exec-2&amp;#93;&lt;/span&gt; - : IO error while trying to get the size of the Directory:org.apache.lucene.store.NoSuchDirectoryException: directory &apos;/opt/solr/cores/shard_a/data/index&apos; does not exist &lt;br/&gt;
        at org.apache.lucene.store.FSDirectory.listAll(FSDirectory.java:220) &lt;br/&gt;
        at org.apache.lucene.store.FSDirectory.listAll(FSDirectory.java:243) &lt;br/&gt;
        at org.apache.lucene.store.NRTCachingDirectory.listAll(NRTCachingDirectory.java:132) &lt;br/&gt;
        at org.apache.solr.core.DirectoryFactory.sizeOfDirectory(DirectoryFactory.java:146) &lt;/p&gt;</comment>
                            <comment id="13502070" author="markrmiller@gmail.com" created="Wed, 21 Nov 2012 15:48:13 +0000"  >&lt;p&gt;Also, how easy is this to reproduce? I added some more robust tests to the replication test at one point to try and tickle this, but had no initial luck.&lt;/p&gt;</comment>
                            <comment id="13502072" author="markrmiller@gmail.com" created="Wed, 21 Nov 2012 15:49:04 +0000"  >&lt;p&gt;Finally, you marked this as affects 4 and fix 4.1 - but we don&apos;t know this is more than a trunk issue at the moment do we?&lt;/p&gt;</comment>
                            <comment id="13502084" author="markus17" created="Wed, 21 Nov 2012 16:03:08 +0000"  >&lt;p&gt;I&apos;m not exactly sure on how to precisely reproduce this condition but i&apos;ve been three times successful in doing so by randomly shutting down some nodes cleanly and make sure at least one node still has the shard while indexing a few million documents from a few reducers in Hadoop.&lt;/p&gt;

&lt;p&gt;Here&apos;s one snippet where a node cannot download:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2012-11-20 14:44:17,365 INFO [solr.handler.ReplicationHandler] - [RecoveryThread] - : Commits will be reserved &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  10000
2012-11-20 14:44:17,365 INFO [solrj.impl.HttpClientUtil] - [RecoveryThread] - : Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; http client, config:connTimeout=5000&amp;amp;socketTimeout=20000&amp;amp;allowCompression=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;maxConnections=10000&amp;amp;maxConnect
ionsPerHost=10000
2012-11-20 14:44:17,367 INFO [solr.core.SolrCore] - [http-8080-exec-4] - : [shard_a] webapp=/solr path=/admin/ping params={} status=503 QTime=0 
2012-11-20 14:44:17,377 INFO [solr.handler.SnapPuller] - [RecoveryThread] - :  No value set &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;pollInterval&apos;&lt;/span&gt;. Timer Task not started.
2012-11-20 14:44:17,440 INFO [solr.handler.SnapPuller] - [RecoveryThread] - : Master&apos;s generation: 62
2012-11-20 14:44:17,440 INFO [solr.handler.SnapPuller] - [RecoveryThread] - : Slave&apos;s generation: 62
2012-11-20 14:44:17,440 INFO [solr.handler.SnapPuller] - [RecoveryThread] - : Starting replication process
2012-11-20 14:44:17,449 INFO [solr.handler.SnapPuller] - [RecoveryThread] - : &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of files in latest index in master: 287
2012-11-20 14:44:17,450 WARN [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : No lockType configured &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/opt/solr/cores/shard_j/data/index.20121120144417450 lockFactory=org.apache.lucene.store.NativeFSLockFactory@5166b0df; maxCacheMB=48.0 maxMergeSizeMB=4.0) assuming &lt;span class=&quot;code-quote&quot;&gt;&apos;simple&apos;&lt;/span&gt;
2012-11-20 14:44:17,450 INFO [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; directory &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /opt/solr/cores/shard_j/data/index.20121120144417450 forceNew:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2012-11-20 14:44:17,450 INFO [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : Releasing directory:/opt/solr/cores/shard_j/data
2012-11-20 14:44:17,451 INFO [solr.handler.SnapPuller] - [RecoveryThread] - : Starting download to NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/opt/solr/cores/shard_j/data/index.20121120144417450 lockFactory=org.apache.lucene.store.SimpleFSLockFactory@3ade1b36; maxCacheMB=48.0 maxMergeSizeMB=4.0) fullCopy=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2012-11-20 14:44:18,298 WARN [solr.handler.SnapPuller] - [RecoveryThread] - : Error in fetching packets 
java.io.EOFException
        at org.apache.solr.common.util.FastInputStream.readFully(FastInputStream.java:151)
        at org.apache.solr.common.util.FastInputStream.readFully(FastInputStream.java:144)
        at org.apache.solr.handler.SnapPuller$DirectoryFileFetcher.fetchPackets(SnapPuller.java:1143)
        at org.apache.solr.handler.SnapPuller$DirectoryFileFetcher.fetchFile(SnapPuller.java:1107)
        at org.apache.solr.handler.SnapPuller.downloadIndexFiles(SnapPuller.java:716)
        at org.apache.solr.handler.SnapPuller.fetchLatestIndex(SnapPuller.java:387)
        at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:273)
        at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:152)
        at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:407)
        at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:222)
2012-11-20 14:44:18,314 INFO [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : Releasing directory:/opt/solr/cores/shard_j/data/index
2012-11-20 14:44:18,314 INFO [solr.handler.SnapPuller] - [RecoveryThread] - : removing temporary index download directory files NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/opt/solr/cores/shard_j/data/index.20121120144417450 lockFactory=org.apache.lucene.store.SimpleFSLockFactory@3ade1b36; maxCacheMB=48.0 maxMergeSizeMB=4.0)
2012-11-20 14:44:18,372 INFO [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : Releasing directory:/opt/solr/cores/shard_j/data/index.20121120144417450
2012-11-20 14:44:18,374 INFO [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : Releasing directory:/opt/solr/cores/shard_j/data/index
2012-11-20 14:44:18,374 ERROR [solr.handler.ReplicationHandler] - [RecoveryThread] - : SnapPull failed :org.apache.solr.common.SolrException: Unable to download _1t6.fdt completely. Downloaded 9437184!=9501680
        at org.apache.solr.handler.SnapPuller$DirectoryFileFetcher.cleanup(SnapPuller.java:1237)
        at org.apache.solr.handler.SnapPuller$DirectoryFileFetcher.fetchFile(SnapPuller.java:1118)
        at org.apache.solr.handler.SnapPuller.downloadIndexFiles(SnapPuller.java:716)
        at org.apache.solr.handler.SnapPuller.fetchLatestIndex(SnapPuller.java:387)
        at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:273)
        at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:152)
        at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:407)
        at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:222)

2012-11-20 14:44:18,374 ERROR [solr.cloud.RecoveryStrategy] - [RecoveryThread] - : Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to recover:org.apache.solr.common.SolrException: Replication &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; recovery failed.
        at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:155)
        at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:407)
        at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:222)

2012-11-20 14:44:18,374 INFO [solr.update.UpdateLog] - [RecoveryThread] - : Dropping buffered updates FSUpdateLog{state=BUFFERING, tlog=tlog{file=/opt/solr/cores/shard_j/data/tlog/tlog.0000000000000000059 refcount=1}}
2012-11-20 14:44:18,374 ERROR [solr.cloud.RecoveryStrategy] - [RecoveryThread] - : Recovery failed - trying again... (0) core=shard_j
2012-11-20 14:44:18,374 INFO [solr.cloud.RecoveryStrategy] - [RecoveryThread] - : Wait 2.0 seconds before trying to recover again (1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And here&apos;s a snippet where a node has trouble with it&apos;s core instance directory:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2012-11-20 14:45:54,863 ERROR [solr.core.DirectoryFactory] - [RecoveryThread] - : Error deleting files from Directory:org.apache.lucene.store.NoSuchDirectoryException: directory &lt;span class=&quot;code-quote&quot;&gt;&apos;/opt/solr/cores/shard_b/data/index.20121120144554468&apos;&lt;/span&gt; does not exist
        at org.apache.lucene.store.FSDirectory.listAll(FSDirectory.java:217)
        at org.apache.lucene.store.FSDirectory.listAll(FSDirectory.java:240)
        at org.apache.lucene.store.NRTCachingDirectory.listAll(NRTCachingDirectory.java:132)
        at org.apache.solr.core.DirectoryFactory.empty(DirectoryFactory.java:174)
        at org.apache.solr.handler.SnapPuller.fetchLatestIndex(SnapPuller.java:469)
        at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:273)
        at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:152)
        at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:407)
        at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:222)

2012-11-20 14:45:54,866 INFO [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : Releasing directory:/opt/solr/cores/shard_b/data/index.20121120144554468
2012-11-20 14:45:54,866 INFO [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : Releasing directory:/opt/solr/cores/shard_b/data/index.20121120122241377
2012-11-20 14:45:54,866 ERROR [solr.handler.ReplicationHandler] - [RecoveryThread] - : SnapPull failed :org.apache.solr.common.SolrException: Unable to download _22j_Lucene41_0.tim completely. Downloaded 4194304!=4498323
        at org.apache.solr.handler.SnapPuller$DirectoryFileFetcher.cleanup(SnapPuller.java:1237)
        at org.apache.solr.handler.SnapPuller$DirectoryFileFetcher.fetchFile(SnapPuller.java:1118)
        at org.apache.solr.handler.SnapPuller.downloadIndexFiles(SnapPuller.java:716)
        at org.apache.solr.handler.SnapPuller.fetchLatestIndex(SnapPuller.java:387)
        at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:273)
        at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:152)
        at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:407)
        at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:222)

2012-11-20 14:45:54,866 ERROR [solr.cloud.RecoveryStrategy] - [RecoveryThread] - : Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to recover:org.apache.solr.common.SolrException: Replication &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; recovery failed.
        at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:155)
        at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:407)
        at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:222)

2012-11-20 14:45:54,866 INFO [solr.update.UpdateLog] - [RecoveryThread] - : Dropping buffered updates FSUpdateLog{state=BUFFERING, tlog=tlog{file=/opt/solr/cores/shard_b/data/tlog/tlog.0000000000000000059 refcount=1}}
2012-11-20 14:45:54,867 ERROR [solr.cloud.RecoveryStrategy] - [RecoveryThread] - : Recovery failed - trying again... (0) core=shard_b
2012-11-20 14:45:54,867 INFO [solr.cloud.RecoveryStrategy] - [RecoveryThread] - : Wait 2.0 seconds before trying to recover again (1)
2012-11-20 14:45:54,979 WARN [solr.handler.SnapPuller] - [RecoveryThread] - : Error in fetching packets 
java.io.EOFException
        at org.apache.solr.common.util.FastInputStream.readFully(FastInputStream.java:151)
        at org.apache.solr.common.util.FastInputStream.readFully(FastInputStream.java:144)
        at org.apache.solr.handler.SnapPuller$DirectoryFileFetcher.fetchPackets(SnapPuller.java:1143)
        at org.apache.solr.handler.SnapPuller$DirectoryFileFetcher.fetchFile(SnapPuller.java:1107)
        at org.apache.solr.handler.SnapPuller.downloadIndexFiles(SnapPuller.java:716)
        at org.apache.solr.handler.SnapPuller.fetchLatestIndex(SnapPuller.java:387)
        at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:273)
        at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:152)
        at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:407)
        at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:222)
2012-11-20 14:45:54,985 INFO [solr.core.CachingDirectoryFactory] - [RecoveryThread] - : Releasing directory:/opt/solr/cores/shard_a/data/index
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There AIOOBException seems to sometimes accompany when other exceptions occur.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2012-11-20 14:46:06,963 INFO [solr.handler.ReplicationHandler] - [http-8080-exec-6] - : Commits will be reserved &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  10000
2012-11-20 14:46:06,963 INFO [solr.core.SolrCore] - [http-8080-exec-6] - : [shard_a] webapp=/solr path=/replication params={command=indexversion&amp;amp;wt=javabin&amp;amp;qt=/replication&amp;amp;version=2} status=0 QTime=1 
2012-11-20 14:46:06,967 INFO [solr.core.CachingDirectoryFactory] - [http-8080-exec-1] - : Releasing directory:/opt/solr/cores/shard_a/data
2012-11-20 14:46:06,971 INFO [solr.core.CachingDirectoryFactory] - [http-8080-exec-1] - : Releasing directory:/opt/solr/cores/shard_a/data/index
2012-11-20 14:46:06,971 INFO [solr.core.SolrCore] - [http-8080-exec-1] - : [shard_a] webapp=/solr path=/replication params={command=filelist&amp;amp;generation=63&amp;amp;wt=javabin&amp;amp;qt=/replication&amp;amp;version=2} status=0 QTime=4 
2012-11-20 14:46:06,982 INFO [solr.core.SolrCore] - [http-8080-exec-2] - : [shard_a] webapp=/solr path=/replication params={file=_216_Lucene41_0.doc&amp;amp;command=filecontent&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;generation=63&amp;amp;qt=/replication&amp;amp;wt=filestream} status=0 QTime=2 
2012-11-20 14:46:06,989 INFO [solr.core.CachingDirectoryFactory] - [http-8080-exec-5] - : Releasing directory:/opt/solr/cores/shard_a/data/index
2012-11-20 14:46:06,997 INFO [solr.core.CachingDirectoryFactory] - [http-8080-exec-5] - : Releasing directory:/opt/solr/cores/shard_j/data/index
2012-11-20 14:46:07,018 INFO [solr.core.SolrCore] - [http-8080-exec-6] - : [shard_a] webapp=/solr path=/admin/system params={wt=json} status=0 QTime=5 
2012-11-20 14:46:07,031 INFO [solr.core.SolrCore] - [http-8080-exec-4] - : [shard_a] webapp=/solr path=/replication params={file=_216_Lucene41_0.pos&amp;amp;command=filecontent&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;generation=63&amp;amp;qt=/replication&amp;amp;wt=filestream} status=0 QTime=0 
2012-11-20 14:46:07,067 INFO [solr.core.SolrCore] - [http-8080-exec-2] - : [shard_a] webapp=/solr path=/replication params={file=_22q_Lucene41_0.tip&amp;amp;command=filecontent&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;generation=63&amp;amp;qt=/replication&amp;amp;wt=filestream} status=0 QTime=0 
2012-11-20 14:46:07,070 INFO [solr.core.SolrCore] - [http-8080-exec-1] - : [shard_a] webapp=/solr path=/replication params={file=_1tu_Lucene41_0.doc&amp;amp;command=filecontent&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;generation=63&amp;amp;qt=/replication&amp;amp;wt=filestream} status=0 QTime=0 
2012-11-20 14:46:07,132 INFO [solr.core.SolrCore] - [http-8080-exec-6] - : [shard_a] webapp=/solr path=/replication params={file=_1t6.fdt&amp;amp;command=filecontent&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;generation=63&amp;amp;qt=/replication&amp;amp;wt=filestream} status=0 QTime=0 
2012-11-20 14:46:07,334 INFO [solr.core.SolrCore] - [http-8080-exec-2] - : [shard_a] webapp=/solr path=/admin/ping params={} hits=29 status=0 QTime=15 
2012-11-20 14:46:07,334 INFO [solr.core.SolrCore] - [http-8080-exec-2] - : [shard_a] webapp=/solr path=/admin/ping params={} status=0 QTime=15 
2012-11-20 14:46:07,353 INFO [solr.core.SolrCore] - [http-8080-exec-1] - : [shard_a] webapp=/solr path=/admin/ping params={} hits=29 status=0 QTime=17 
2012-11-20 14:46:07,353 INFO [solr.core.SolrCore] - [http-8080-exec-1] - : [shard_a] webapp=/solr path=/admin/ping params={} status=0 QTime=17 
2012-11-20 14:46:07,483 WARN [solr.handler.ReplicationHandler] - [http-8080-exec-6] - : Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; writing response &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; params: file=_1t6.fdt&amp;amp;command=filecontent&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;generation=63&amp;amp;qt=/replication&amp;amp;wt=filestream
java.io.EOFException: read past EOF: MMapIndexInput(path=&lt;span class=&quot;code-quote&quot;&gt;&quot;/opt/solr/cores/shard_a/data/index/_1t6.fdt&quot;&lt;/span&gt;)
        at org.apache.lucene.store.ByteBufferIndexInput.readBytes(ByteBufferIndexInput.java:100)
        at org.apache.solr.handler.ReplicationHandler$DirectoryFileStream.write(ReplicationHandler.java:1065)
        at org.apache.solr.handler.ReplicationHandler$3.write(ReplicationHandler.java:932)
        at org.apache.solr.servlet.SolrDispatchFilter.writeResponse(SolrDispatchFilter.java:425)
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:289)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
        at org.apache.coyote.http11.Http11NioProcessor.process(Http11NioProcessor.java:889)
        at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:744)
        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:2274)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
2012-11-20 14:46:07,494 INFO [solr.core.SolrCore] - [http-8080-exec-2] - : [shard_a] webapp=/solr path=/replication params={file=_1t6.fdt&amp;amp;command=filecontent&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;offset=4194304&amp;amp;generation=63&amp;amp;qt=/replication&amp;amp;wt=filestream} status=0 QTime=1 
2012-11-20 14:46:07,495 ERROR [solr.servlet.SolrDispatchFilter] - [http-8080-exec-2] - : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;:java.lang.IndexOutOfBoundsException
        at java.nio.Buffer.checkBounds(Buffer.java:530)
        at java.nio.DirectByteBuffer.get(DirectByteBuffer.java:218)
        at org.apache.lucene.store.ByteBufferIndexInput.readBytes(ByteBufferIndexInput.java:91)
        at org.apache.solr.handler.ReplicationHandler$DirectoryFileStream.write(ReplicationHandler.java:1065)
        at org.apache.solr.handler.ReplicationHandler$3.write(ReplicationHandler.java:932)
        at org.apache.solr.servlet.SolrDispatchFilter.writeResponse(SolrDispatchFilter.java:425)
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:289)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
        at org.apache.coyote.http11.Http11NioProcessor.process(Http11NioProcessor.java:889)
        at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:744)
        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:2274)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m positive that the above exceptions do not occur when i index a few million docs without taking down nodes.&lt;/p&gt;

&lt;p&gt;You&apos;re right, it&apos;s on trunk indeed, not 4.x.&lt;/p&gt;</comment>
                            <comment id="13504751" author="markrmiller@gmail.com" created="Tue, 27 Nov 2012 16:51:05 +0000"  >&lt;p&gt;Okay, I can reproduce this in a test now - the test just has to index many docs - I tried 1 million just to be sure and I see issues - I think I was trying in the 10&apos;s of thousands before.&lt;/p&gt;</comment>
                            <comment id="13504859" author="eksdev" created="Tue, 27 Nov 2012 19:26:56 +0000"  >&lt;p&gt;We see it as well, &lt;/p&gt;

&lt;p&gt;it looks like it only happens with NRTCachingDirectory, but take this statement with healthy  suspicion. It went ok only once without NRTCachingDirectory. &lt;/p&gt;

</comment>
                            <comment id="13504875" author="markrmiller@gmail.com" created="Tue, 27 Nov 2012 19:42:13 +0000"  >&lt;p&gt;I&apos;ll try and make a fix soon.&lt;/p&gt;</comment>
                            <comment id="13504961" author="markus17" created="Tue, 27 Nov 2012 21:27:12 +0000"  >&lt;p&gt;Might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4033&quot; title=&quot;No lockType configured for NRTCachingDirectory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4033&quot;&gt;&lt;del&gt;SOLR-4033&lt;/del&gt;&lt;/a&gt; regarding NRTDir.&lt;/p&gt;</comment>
                            <comment id="13504987" author="markrmiller@gmail.com" created="Tue, 27 Nov 2012 21:57:47 +0000"  >&lt;p&gt;It&apos;s just silly bugs because the tests never replicated a file larger than the buffer size. I&apos;ve added a @Nightly test that does.&lt;/p&gt;</comment>
                            <comment id="13505000" author="commit-tag-bot" created="Tue, 27 Nov 2012 22:09:02 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1414428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1414428&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4032&quot; title=&quot;Files larger than an internal buffer size fail to replicate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4032&quot;&gt;&lt;del&gt;SOLR-4032&lt;/del&gt;&lt;/a&gt;: Files larger than an internal buffer size fail to replicate.&lt;/p&gt;
</comment>
                            <comment id="13505003" author="markrmiller@gmail.com" created="Tue, 27 Nov 2012 22:10:05 +0000"  >&lt;p&gt;Thanks Markus!&lt;/p&gt;</comment>
                            <comment id="13505378" author="markus17" created="Wed, 28 Nov 2012 11:37:24 +0000"  >&lt;p&gt;Great work, it seems this issue is resolved indeed as i cannot reproduce this exact problem. But another EOF exception pops up, i&apos;ll open a new issue.&lt;br/&gt;
edit: another issue popped up as well, added &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4116&quot; title=&quot;Log Replay [recoveryExecutor-8-thread-1] - : java.io.EOFException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4116&quot;&gt;&lt;del&gt;SOLR-4116&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4117&quot; title=&quot;IO error while trying to get the size of the Directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4117&quot;&gt;&lt;del&gt;SOLR-4117&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13782641" author="shalinmangar" created="Tue, 1 Oct 2013 05:22:05 +0000"  >&lt;p&gt;The fix was released in 4.1&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12614926">SOLR-4038</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12617967">SOLR-4117</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12555071" name="SOLR-4032.patch" size="4100" author="markrmiller@gmail.com" created="Tue, 27 Nov 2012 21:51:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0eq5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83999</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>