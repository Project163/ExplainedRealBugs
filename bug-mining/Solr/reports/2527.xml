<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7693] &quot;bin/solr start -e cloud&quot; will not work if lsof is not installed - script exits as soon as 1st node is started</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7693</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If bin/solr is used on a system which does not have lsof available a code path is used when starting up solr nodes that causes bin/solr to exist as soon as the first solr node is launched.&lt;/p&gt;

&lt;p&gt;the work around is to either install lsof, or manually start up each of the additional nodes, and create the collection, after the &quot;-e cloud&quot; command exits...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;solr start -cloud -s example/cloud/node2/solr -p XXXX -z localhost:9983
solr start -cloud -s example/cloud/node3/solr -p YYYY -z localhost:9983
...
bin/solr create -c gettingstarted -replicationFactor N -shards M -d data_driven_schema_configs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Original bug report...&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Extract from the command prompt on starting up solr cloud :&lt;/p&gt;

&lt;p&gt;-------------------------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;appuser@mysolrsandbox ~&amp;#93;&lt;/span&gt;$ cd $HOME/softwares/solr-5.2.1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;appuser@mysolrsandbox solr-5.2.1&amp;#93;&lt;/span&gt;$ bin/solr start -e cloud -noprompt -m 1g&lt;/p&gt;

&lt;p&gt;Welcome to the SolrCloud example!&lt;/p&gt;


&lt;p&gt;Starting up 2 Solr nodes for your example SolrCloud cluster.&lt;br/&gt;
Creating Solr home directory /home/appuser/softwares/solr-5.2.1/example/cloud/node1/solr&lt;br/&gt;
Cloning Solr home directory /home/appuser/softwares/solr-5.2.1/example/cloud/node1 into /home/appuser/softwares/solr-5.2.1/example/cloud/node2&lt;/p&gt;

&lt;p&gt;Starting up SolrCloud node1 on port 8983 using command:&lt;/p&gt;

&lt;p&gt;solr start -cloud -s example/cloud/node1/solr -p 8983  -m 1g&lt;/p&gt;



&lt;p&gt;Started Solr server on port 8983 (pid=102). Happy searching!&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;appuser@mysolrsandbox solr-5.2.1&amp;#93;&lt;/span&gt;$&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;The second node is not starting up.&lt;/p&gt;


&lt;p&gt;Possible issue :&lt;br/&gt;
File : $SOLR_HOME/bin/solr&lt;br/&gt;
Line number : 1431&lt;br/&gt;
&amp;#8211; The &quot;exit;&quot; command is causing the shell scrip to exit.&lt;/p&gt;

&lt;p&gt;Line 1428 - 1432&lt;br/&gt;
    else&lt;br/&gt;
      SOLR_PID=`ps auxww | grep start\.jar | grep -w $SOLR_PORT | grep -v grep | awk &apos;&lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {print $2}&lt;/span&gt; &lt;p&gt;&apos; | sort -r`&lt;br/&gt;
      echo -e &quot;\nStarted Solr server on port $SOLR_PORT (pid=$SOLR_PID). Happy searching!\n&quot;&lt;br/&gt;
      exit;&lt;br/&gt;
    fi&lt;/p&gt;

&lt;p&gt;Work Around :&lt;br/&gt;
Comment line 1431 in the shell script&lt;br/&gt;
Line 1428 - 1432&lt;br/&gt;
    else&lt;br/&gt;
      SOLR_PID=`ps auxww | grep start\.jar | grep -w $SOLR_PORT | grep -v grep | awk &apos;&lt;/p&gt;&lt;/div&gt;
&lt;p&gt;&apos; | sort -r`&lt;br/&gt;
      echo -e &quot;\nStarted Solr server on port $SOLR_PORT (pid=$SOLR_PID). Happy searching!\n&quot;&lt;br/&gt;
      #exit;&lt;br/&gt;
    fi&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment>&lt;p&gt;Boot2Docker, Docker container with Oracle Linux, JDK 8, Solr 5.2.1&lt;/p&gt;</environment>
        <key id="12838218">SOLR-7693</key>
            <summary>&quot;bin/solr start -e cloud&quot; will not work if lsof is not installed - script exits as soon as 1st node is started</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thelabdude">Timothy Potter</assignee>
                                    <reporter username="raagavj.iyer">Raghavan Janakiraman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jun 2015 16:57:18 +0000</created>
                <updated>Mon, 9 May 2016 18:48:45 +0000</updated>
                            <resolved>Wed, 17 Jun 2015 21:29:10 +0000</resolved>
                                    <version>5.2.1</version>
                                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14588520" author="hossman" created="Tue, 16 Jun 2015 18:27:02 +0000"  >&lt;p&gt;if you are only seeing this in your docker container that sounds like a shell discrepancy.&lt;/p&gt;

&lt;p&gt;what exactly is the output of &lt;tt&gt;/usr/bin/env bash -version&lt;/tt&gt; on these containers?&lt;/p&gt;</comment>
                            <comment id="14588536" author="hossman" created="Tue, 16 Jun 2015 18:35:37 +0000"  >&lt;p&gt;Hmm... my initial impression was that this was an issue of exit on a sub-shell process, but looking closer this could be a big in some conditional logic depending on whether lsof is available on the system?&lt;/p&gt;

&lt;p&gt;My bash is rusty, but IIUC it looks like the launch_solr function will &quot;exit&quot; the script completely in the &quot;no lsof found&quot; case, but simply return in the &quot;lsof found&quot; case.&lt;/p&gt;

&lt;p&gt;Raghavan: can you please confirm the output of &lt;tt&gt;hash lsof; echo $?&lt;/tt&gt; on the machine where you see this problem?&lt;/p&gt;

</comment>
                            <comment id="14588570" author="hossman" created="Tue, 16 Jun 2015 18:56:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;My bash is rusty, but IIUC it looks like the launch_solr function will &quot;exit&quot; the script completely in the &quot;no lsof found&quot; case, but simply return in the &quot;lsof found&quot; case.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nope - i&apos;m blind. the launch_solr function calls &lt;tt&gt;exit&lt;/tt&gt; regardless of whether lsof exists ... i&apos;m back to my initial hypothesis regarding something wonky with bash to explain why you&apos;re seeing this.&lt;/p&gt;</comment>
                            <comment id="14588603" author="raagavj.iyer" created="Tue, 16 Jun 2015 19:24:05 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;appuser@mysolrsandbox ~&amp;#93;&lt;/span&gt;$ /usr/bin/env bash -version&lt;br/&gt;
GNU bash, version 4.2.46(1)-release (x86_64-redhat-linux-gnu)&lt;br/&gt;
Copyright (C) 2011 Free Software Foundation, Inc.&lt;br/&gt;
License GPLv3+: GNU GPL version 3 or later &amp;lt;&lt;a href=&quot;http://gnu.org/licenses/gpl.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://gnu.org/licenses/gpl.html&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;This is free software; you are free to change and redistribute it.&lt;br/&gt;
There is NO WARRANTY, to the extent permitted by law.&lt;/p&gt;


&lt;p&gt;--------------------------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;appuser@mysolrsandbox ~&amp;#93;&lt;/span&gt;$ hash lsof; echo $?&lt;br/&gt;
bash: hash: lsof: not found&lt;br/&gt;
1&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="14588617" author="raagavj.iyer" created="Tue, 16 Jun 2015 19:34:25 +0000"  >&lt;p&gt;The way I understand the launch_solr function&lt;/p&gt;

&lt;p&gt;1. If to be launched in back ground&lt;br/&gt;
    1.1.  Launch the java process in nohup&lt;br/&gt;
    1.2.  If OS supports lsof (list of open files) function&lt;br/&gt;
        1.2.1. Open a sub shell&lt;br/&gt;
        1.2.2. Poll the list of open files for the port on which the java process is launched till 30 seconds or the port becomes active which ever is earlier&lt;br/&gt;
        1.2.3. Display the launch message&lt;br/&gt;
        1.2.4. Exit sub shell&lt;br/&gt;
    1.3. Else // if OS does not support lsof&lt;br/&gt;
         1.3.1. Try a grep to get the process id of the java process launched&lt;br/&gt;
         1.3.2. Display the launch message&lt;br/&gt;
         1.3.3. Eixt // (Actually this should be a return and not exit, as the else clause is not launched in a sub shell)&lt;br/&gt;
   1.4 End If&lt;/p&gt;
</comment>
                            <comment id="14588877" author="hossman" created="Tue, 16 Jun 2015 22:04:20 +0000"  >&lt;p&gt;Ah.... yes, the part i was overlooking is that a sub-shell &lt;b&gt;is&lt;/b&gt; used in the lsof case.&lt;/p&gt;

&lt;p&gt;updated summary &amp;amp;description to clarify root cause (systems w/o lsof) and list workarround.&lt;/p&gt;</comment>
                            <comment id="14588930" author="hossman" created="Tue, 16 Jun 2015 22:33:41 +0000"  >&lt;p&gt;untested patch (not really interesting in deleting lsof from my machine at the moment)&lt;/p&gt;</comment>
                            <comment id="14588932" author="hossman" created="Tue, 16 Jun 2015 22:34:27 +0000"  >&lt;p&gt;Tim: please review &amp;amp; commit (unless i&apos;ve made some horrible mistake)&lt;/p&gt;</comment>
                            <comment id="14589119" author="thelabdude" created="Wed, 17 Jun 2015 01:00:58 +0000"  >&lt;p&gt;Thanks for fixing Hoss. I spun up an instance in EC2 and uninstalled lsof. I had to add a 10 second wait to the block that handles the case where lsof is not installed, otherwise the script progressed to trying to create the collection too quickly (before the nodes were up). I also added a note to let users know they should install lsof for this script.&lt;/p&gt;</comment>
                            <comment id="14589130" author="upayavira" created="Wed, 17 Jun 2015 01:16:52 +0000"  >&lt;p&gt;Throwaway comment/thought - reimplementing the LSOF behaviour we depend upon in Java wouldn&apos;t take much effort, and if Java isn&apos;t present, we&apos;ve got bigger problems!&lt;/p&gt;</comment>
                            <comment id="14590635" author="jira-bot" created="Wed, 17 Jun 2015 21:27:13 +0000"  >&lt;p&gt;Commit 1686113 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686113&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7693&quot; title=&quot;&amp;quot;bin/solr start -e cloud&amp;quot; will not work if lsof is not installed - script exits as soon as 1st node is started&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7693&quot;&gt;&lt;del&gt;SOLR-7693&lt;/del&gt;&lt;/a&gt;: Fix the bin/solr -e cloud example to work if lsof is not installed&lt;/p&gt;</comment>
                            <comment id="14590637" author="jira-bot" created="Wed, 17 Jun 2015 21:28:07 +0000"  >&lt;p&gt;Commit 1686114 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686114&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7693&quot; title=&quot;&amp;quot;bin/solr start -e cloud&amp;quot; will not work if lsof is not installed - script exits as soon as 1st node is started&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7693&quot;&gt;&lt;del&gt;SOLR-7693&lt;/del&gt;&lt;/a&gt;: Fix the bin/solr -e cloud example to work if lsof is not installed&lt;/p&gt;</comment>
                            <comment id="14713096" author="shalinmangar" created="Wed, 26 Aug 2015 13:05:45 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12740006" name="SOLR-7693.patch" size="1107" author="thelabdude" created="Wed, 17 Jun 2015 01:00:58 +0000"/>
                            <attachment id="12739988" name="SOLR-7693.patch" size="992" author="hossman" created="Tue, 16 Jun 2015 22:33:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2g41r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>