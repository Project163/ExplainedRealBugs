<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:00:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6766] Switch o.a.s.store.blockcache.Metrics to use JMX</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6766</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The Metrics class currently reports to hadoop metrics, but it would be better to report to JMX.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12756524">SOLR-6766</key>
            <summary>Switch o.a.s.store.blockcache.Metrics to use JMX</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="mdrob">Mike Drob</reporter>
                        <labels>
                            <label>metrics</label>
                    </labels>
                <created>Wed, 19 Nov 2014 20:25:30 +0000</created>
                <updated>Mon, 9 May 2016 18:50:33 +0000</updated>
                            <resolved>Tue, 6 Jan 2015 20:33:21 +0000</resolved>
                                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14219623" author="mdrob" created="Thu, 20 Nov 2014 17:29:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; - Continuing discussion from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6752&quot; title=&quot;Buffer Cache allocate/lost metrics should be exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6752&quot;&gt;&lt;del&gt;SOLR-6752&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I fired up Solr on HDFS with JMX enabled and took a look at the exported mbeans with JConsole. I did not see anything for the block cache.&lt;/p&gt;

&lt;p&gt;I&apos;d look at how SolrResourceLoader adds the plugins that it loads to the JmxMonitoredMap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Been digging deeper into this... metrics are tracked on a per-core basis. Each core has an &lt;tt&gt;infoRegistry&lt;/tt&gt; that is populated in the constructor either directly or from beans that the SolrResourceLoader had previously created. So instead of creating a new Metrics object directly, we will need to create one through the &lt;tt&gt;SolrResourceLoader.newInstance()&lt;/tt&gt;, which is I think what you were suggesting.&lt;/p&gt;

&lt;p&gt;The trick here is that we need to create the bean before the &lt;tt&gt;SolrCore&lt;/tt&gt; finishes constructing, but after the &lt;tt&gt;HdfsDirectoryFactory&lt;/tt&gt; (HDF) exists to make sure that it gets registered in time. So basically, in the no-arg HDF constructor is our only option. The problem is that HDF (or any implementation of &lt;tt&gt;DirectoryFactory&lt;/tt&gt;) is not aware of the resource loader or even a &lt;tt&gt;SolrConfig&lt;/tt&gt; to be able to acquire a reference to the resource loader. I&apos;m hesitant to add a &lt;tt&gt;setResourceLoader&lt;/tt&gt; method or similar on &lt;tt&gt;DirectoryFactory&lt;/tt&gt; because that is starting to feel very intrusive, but I also don&apos;t see another way to plumb this through.&lt;/p&gt;</comment>
                            <comment id="14221011" author="markrmiller@gmail.com" created="Fri, 21 Nov 2014 15:08:40 +0000"  >&lt;p&gt;The block cache should normally just be one now that the global block cache is enabled by default. The per directory version should be special case at best. Perhaps the HdfsDirectoryFactory could simply track all the Metrics objects and spit out the stats for the caches (normally 1) that it tracks. If everything is keyed on HdfsDirectoryFactory as the info bean, nothing else has to be changed. Just spitballing though.&lt;/p&gt;</comment>
                            <comment id="14221101" author="mdrob" created="Fri, 21 Nov 2014 16:42:25 +0000"  >&lt;p&gt;This patch depends on the one on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6752&quot; title=&quot;Buffer Cache allocate/lost metrics should be exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6752&quot;&gt;&lt;del&gt;SOLR-6752&lt;/del&gt;&lt;/a&gt; being applied first.&lt;/p&gt;

&lt;p&gt;Make HdfsDirctoryFactory implement SolrInfoMBean and expose metrics that way. I think it works for both the global cache and local cache options because it uses the same Metrics object for everything.&lt;/p&gt;</comment>
                            <comment id="14221115" author="markrmiller@gmail.com" created="Fri, 21 Nov 2014 16:54:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think it works for both the global cache and local cache options because it uses the same Metrics object for everything.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh cool, well that simplifies things. I&apos;ll take a look at this shortly.&lt;/p&gt;</comment>
                            <comment id="14221124" author="mdrob" created="Fri, 21 Nov 2014 17:01:15 +0000"  >&lt;p&gt;I didn&apos;t rename any of the metrics yet because that should be a fairly easy change to make. Trying to get the structure of the changeset correct, first.&lt;/p&gt;</comment>
                            <comment id="14223491" author="markrmiller@gmail.com" created="Mon, 24 Nov 2014 20:50:15 +0000"  >&lt;p&gt;+1 - shaping up nicely.&lt;/p&gt;</comment>
                            <comment id="14223750" author="mdrob" created="Mon, 24 Nov 2014 23:22:02 +0000"  >&lt;p&gt;Renamed some of the metrics, based on what the other caches use. Could not figure out what would be tracking &quot;inserts&quot; into the block cache.&lt;/p&gt;

&lt;p&gt;The other caches also track cumulative metrics, should we track those here as well?&lt;/p&gt;</comment>
                            <comment id="14223754" author="otis" created="Mon, 24 Nov 2014 23:24:16 +0000"  >&lt;p&gt;Is this aimed at 4.10.3?&lt;/p&gt;</comment>
                            <comment id="14223785" author="mdrob" created="Mon, 24 Nov 2014 23:52:45 +0000"  >&lt;p&gt;I build the patch against trunk, but it could probably go into branch-5. I think it applies pretty cleanly to branch-4 as well, but I haven&apos;t looked at it that closely.&lt;/p&gt;</comment>
                            <comment id="14229845" author="markrmiller@gmail.com" created="Mon, 1 Dec 2014 14:33:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is this aimed at 4.10.3?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;4.10.3 is a bug fix release - the fact that the code exists but is not hooked up could allow one to try and stretch it to 4.10.3 - along with the idea that there will be no more 4.x releases. No plans on it right now though.&lt;/p&gt;</comment>
                            <comment id="14229857" author="markrmiller@gmail.com" created="Mon, 1 Dec 2014 14:45:56 +0000"  >&lt;p&gt;Here is a patch cleaning up a couple small things. Looks good overall - I just have to do a manual check to make sure everything shows up in the jmx output as expected and do a brief check of all the key names.&lt;/p&gt;</comment>
                            <comment id="14266702" author="jira-bot" created="Tue, 6 Jan 2015 20:29:18 +0000"  >&lt;p&gt;Commit 1649939 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1649939&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1649939&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6766&quot; title=&quot;Switch o.a.s.store.blockcache.Metrics to use JMX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6766&quot;&gt;&lt;del&gt;SOLR-6766&lt;/del&gt;&lt;/a&gt;: Expose HdfsDirectoryFactory Block Cache statistics via JMX.&lt;/p&gt;</comment>
                            <comment id="14266708" author="jira-bot" created="Tue, 6 Jan 2015 20:32:40 +0000"  >&lt;p&gt;Commit 1649941 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1649941&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1649941&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6766&quot; title=&quot;Switch o.a.s.store.blockcache.Metrics to use JMX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6766&quot;&gt;&lt;del&gt;SOLR-6766&lt;/del&gt;&lt;/a&gt;: Expose HdfsDirectoryFactory Block Cache statistics via JMX.&lt;/p&gt;</comment>
                            <comment id="14266710" author="markrmiller@gmail.com" created="Tue, 6 Jan 2015 20:33:21 +0000"  >&lt;p&gt;Thanks Mike!&lt;/p&gt;</comment>
                            <comment id="14332928" author="anshumg" created="Mon, 23 Feb 2015 05:02:39 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12755845">SOLR-6752</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12684413" name="SOLR-6766.patch" size="13860" author="markrmiller@gmail.com" created="Mon, 1 Dec 2014 14:45:56 +0000"/>
                            <attachment id="12683442" name="SOLR-6766.patch" size="14479" author="mdrob" created="Mon, 24 Nov 2014 23:22:02 +0000"/>
                            <attachment id="12682906" name="SOLR-6766.patch" size="14516" author="mdrob" created="Fri, 21 Nov 2014 16:42:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22ksv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>