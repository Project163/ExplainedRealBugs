<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:34:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12523] Confusing error reporting if backup attempted on non-shared FS</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12523</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;So I have a large collection with 4 shards across 2 nodes. When I try to back it up with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

curl &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8984/solr/admin/collections?action=BACKUP&amp;amp;name=sigs&amp;amp;collection=foo_signals&amp;amp;async=5&amp;amp;location=backups&quot;&lt;/span&gt;
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I either get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-quote&quot;&gt;&quot;5170256188349065&quot;&lt;/span&gt;:{

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{

&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,

&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:0},

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;STATUS&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;failed&quot;&lt;/span&gt;,

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;Response&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to backup core=foo_signals_shard1_replica_n2 because org.apache.solr.common.SolrException: Directory to contain snapshots doesn&apos;t exist: file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/cloud84/backups/sigs&quot;&lt;/span&gt;},
&lt;/span&gt;
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;5170256187999044&quot;&lt;/span&gt;:{

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{

&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,

&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:0},

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;STATUS&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;failed&quot;&lt;/span&gt;,

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;Response&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to backup core=foo_signals_shard3_replica_n10 because org.apache.solr.common.SolrException: Directory to contain snapshots doesn&apos;t exist: file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/cloud84/backups/sigs&quot;&lt;/span&gt;},
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or if I create the directory, then I get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

{

&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:2},

&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;Operation backup caused exception:&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.common.SolrException:org.apache.solr.common.SolrException: The backup directory already exists: file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/cloud84/backups/sigs/&quot;&lt;/span&gt;,
&lt;/span&gt;
&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;exception&quot;&lt;/span&gt;:{

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;msg&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;The backup directory already exists: file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/cloud84/backups/sigs/&quot;&lt;/span&gt;,
&lt;/span&gt;
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;rspCode&quot;&lt;/span&gt;:400},

&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:{

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;failed&quot;&lt;/span&gt;,

&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;msg&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;found [2] in failed tasks&quot;&lt;/span&gt;}}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m thinking this has to do with having 2 cores from the same collection on the same node but I can&apos;t get a collection with 1 shard on each node to work either:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-quote&quot;&gt;&quot;ec2-52-90-245-38.compute-1.amazonaws.com:8984_solr&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException:Error from server at http:&lt;span class=&quot;code-comment&quot;&gt;//ec2-52-90-245-38.compute-1.amazonaws.com:8984/solr: Failed to backup core=system_jobs_history_shard2_replica_n6 because org.apache.solr.common.SolrException: Directory to contain snapshots doesn&apos;t exist: file:///vol1/cloud84/backups/ugh1&quot;&lt;/span&gt;}
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What&apos;s weird is that&#160;replica&#160;(system_jobs_history_shard2_replica_n6) is not even on the&#160;ec2-52-90-245-38.compute-1.amazonaws.com node! It lives on a different node.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13168702">SOLR-12523</key>
            <summary>Confusing error reporting if backup attempted on non-shared FS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="thelabdude">Timothy Potter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jun 2018 19:04:02 +0000</created>
                <updated>Sat, 8 Jun 2019 15:01:39 +0000</updated>
                            <resolved>Wed, 15 Aug 2018 12:09:12 +0000</resolved>
                                    <version>7.3.1</version>
                                    <fixVersion>7.5</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>Backup/Restore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16525594" author="thelabdude" created="Wed, 27 Jun 2018 20:39:31 +0000"  >&lt;p&gt;some logs:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

2018-06-27 20:36:49.739 INFO&#160; (qtp853119666-19) [ &#160; ] o.a.s.h.a.CollectionsHandler Invoked Collection Action :backup with params name=tim1&amp;amp;action=BACKUP&amp;amp;location=/vol1/backups&amp;amp;collection=foo_signals and sendToOCPQueue=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;

&#160;

2018-06-27 20:36:49.751 ERROR (qtp853119666-18) [ &#160; ] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: Failed to backup core=foo_signals_shard2_replica_n4 because org.apache.solr.common.SolrException: Directory to contain snapshots doesn&apos;t exist: file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/backups/tim1
&lt;/span&gt;
&#160;

2018-06-27 20:36:49.751 INFO&#160; (qtp853119666-18) [ &#160; ] o.a.s.s.HttpSolrCall [admin] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=/admin/cores params=\{core=foo_signals_shard2_replica_n4&amp;amp;qt=/admin/cores&amp;amp;name=shard2&amp;amp;action=BACKUPCORE&amp;amp;location=file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/backups/tim1&amp;amp;wt=javabin&amp;amp;version=2} status=500 QTime=1
&lt;/span&gt;
&#160;

2018-06-27 20:36:49.752 ERROR (qtp853119666-18) [ &#160; ] o.a.s.s.HttpSolrCall &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;:org.apache.solr.common.SolrException: Failed to backup core=foo_signals_shard2_replica_n4 because org.apache.solr.common.SolrException: Directory to contain snapshots doesn&apos;t exist: file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/backups/tim1
&lt;/span&gt;
&#160;

2018-06-27 20:36:49.754 ERROR (qtp853119666-23) [ &#160; ] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: Failed to backup core=foo_signals_shard3_replica_n10 because org.apache.solr.common.SolrException: Directory to contain snapshots doesn&apos;t exist: file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/backups/tim1
&lt;/span&gt;
&#160;

2018-06-27 20:36:49.754 INFO&#160; (qtp853119666-23) [ &#160; ] o.a.s.s.HttpSolrCall [admin] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=/admin/cores params=\{core=foo_signals_shard3_replica_n10&amp;amp;qt=/admin/cores&amp;amp;name=shard3&amp;amp;action=BACKUPCORE&amp;amp;location=file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/backups/tim1&amp;amp;wt=javabin&amp;amp;version=2} status=500 QTime=0
&lt;/span&gt;
&#160;

2018-06-27 20:36:49.754 ERROR (qtp853119666-23) [ &#160; ] o.a.s.s.HttpSolrCall &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;:org.apache.solr.common.SolrException: Failed to backup core=foo_signals_shard3_replica_n10 because org.apache.solr.common.SolrException: Directory to contain snapshots doesn&apos;t exist: file:&lt;span class=&quot;code-comment&quot;&gt;///vol1/backups/tim1
&lt;/span&gt;
&#160;

2018-06-27 20:36:49.781 INFO&#160; (qtp853119666-19) [ &#160; ] o.a.s.s.HttpSolrCall [admin] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=/admin/collections params=\{name=tim1&amp;amp;action=BACKUP&amp;amp;location=/vol1/backups&amp;amp;collection=foo_signals} status=500 QTime=42

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16525603" author="thelabdude" created="Wed, 27 Jun 2018 20:56:34 +0000"  >&lt;p&gt;so sounds like Solr is expecting a shared location across nodes here?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

SnapShooter snapShooter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SnapShooter(repository, core, locationUri, name, commitName);
&lt;span class=&quot;code-comment&quot;&gt;// validateCreateSnapshot will create parent dirs instead of &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt;; that choice is dubious.
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// But we want to &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt;. One reason is that
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; dir really should, in fact must, already exist here &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; triggered via a collection backup on a shared
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// file system. Otherwise, perhaps the FS location isn&apos;t shared -- we want an error.
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!snapShooter.getBackupRepository().exists(snapShooter.getLocation())) {
 &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException(SolrException.ErrorCode.BAD_REQUEST,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;Directory to contain snapshots doesn&apos;t exist: &quot;&lt;/span&gt; + snapShooter.getLocation());
}
snapShooter.validateCreateSnapshot();
snapShooter.createSnapshot();

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16525628" author="janhoy" created="Wed, 27 Jun 2018 21:20:20 +0000"  >&lt;p&gt;Yes, you need a shared file system with the same file path across nodes. The error messages is not very helpful.&lt;/p&gt;

&lt;p&gt;The reference Guide at &lt;a href=&quot;https://lucene.apache.org/solr/guide/7_4/collections-api.html#backup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lucene.apache.org/solr/guide/7_4/collections-api.html#backup&lt;/a&gt;&#160;says:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Backs up Solr collections and associated configurations to a shared filesystem - for example a Network File System.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We should probably add a CAUTION box in the refGuide for the shared fs requirement. We should also improve the error messages. Perhaps the &lt;tt&gt;BackupCmd&lt;/tt&gt;&#160;could do a pre-check before starting the backup by writing a file with random file name into the backup root folder and then ask each node to check for the existence of that file - if it fails we&apos;d abort the backup with some sane error message.&lt;/p&gt;

&lt;p&gt;The error message you quoted above will only be printed in case of an issue with non-shared FS, right? So perhaps a quick fix is to improve that error message and mention the shared FS requirement right there?&lt;/p&gt;</comment>
                            <comment id="16525644" author="thelabdude" created="Wed, 27 Jun 2018 21:32:11 +0000"  >&lt;p&gt;why does it need a shared filesystem? that&apos;s very uncloud like ... I&apos;d use S3 but it&apos;s too slow to move these files one-by-one to S3 and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9958&quot; title=&quot;The FileSystem used by HdfsBackupRepository gets closed before the backup completes.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9958&quot;&gt;&lt;del&gt;SOLR-9958&lt;/del&gt;&lt;/a&gt; prevents that from working correctly anyway ... but I&apos;ve moved on and am just using BACKUPCORE and then using a bulk copy solution to move the files to cloud storage&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16525654" author="janhoy" created="Wed, 27 Jun 2018 21:41:26 +0000"  >&lt;p&gt;The backup repository implementations are pluggable, so perhaps it would be possible to make one that can be smart with local storage and then do some post-action in order to move the generated backups for each shard leader somewhere?&lt;/p&gt;

&lt;p&gt;Or perhaps an &lt;tt&gt;S3BackupRepository&lt;/tt&gt; which &lt;del&gt;uses local FS as a buffer&lt;/del&gt; streams the index folder using &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/index.html?java/util/zip/ZipOutputStream.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ZipOutputStream&lt;/a&gt;&#160;and over to s3. The restore command would do the opposite.&lt;/p&gt;</comment>
                            <comment id="16525669" author="thelabdude" created="Wed, 27 Jun 2018 22:11:42 +0000"  >&lt;p&gt;Good ideas! I&apos;ll try to get the S3AFileSystem working again ... I forget what all the issues are with that besides 9958, then we can iterate from there.&lt;/p&gt;</comment>
                            <comment id="16526117" author="janhoy" created="Thu, 28 Jun 2018 08:47:46 +0000"  >&lt;p&gt;Have you seen&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9952&quot; title=&quot;S3BackupRepository&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9952&quot;&gt;&lt;del&gt;SOLR-9952&lt;/del&gt;&lt;/a&gt;? It uses HdfsDirectory to write to s3. Also I found&#160;&lt;a href=&quot;https://github.com/alexmojaki/s3-stream-upload&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt;&#160;which seems to allow smart buffering and parallell streaming of data to s3. But I think such effort should continue in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9952&quot; title=&quot;S3BackupRepository&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9952&quot;&gt;&lt;del&gt;SOLR-9952&lt;/del&gt;&lt;/a&gt; or new JIRAs. Let&apos;s use this one to improve docs and error messages for 7.x.&lt;/p&gt;</comment>
                            <comment id="16526128" author="janhoy" created="Thu, 28 Jun 2018 09:01:09 +0000"  >&lt;p&gt;Changed issue title. See attached patch for suggested improvements&lt;/p&gt;</comment>
                            <comment id="16526389" author="dsmiley" created="Thu, 28 Jun 2018 14:52:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;why does it need a shared filesystem?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you explain how you thought or hoped this mechanism worked?  Perhaps you thought of it more as as an in-place snapshot mechanism &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9038&quot; title=&quot;Support snapshot management functionality for a solr collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9038&quot;&gt;&lt;del&gt;SOLR-9038&lt;/del&gt;&lt;/a&gt;.  This feature is conceived of a way to back up everything to one place, and that one place needs to accessible to all nodes in the cluster &amp;#8211; hence a shared file system requirement.  It could be interesting if just one node has access to the backup destination and somehow you indicate which node that is.  &lt;/p&gt;

&lt;p&gt;Also FYI Jeff Wartes / Whitepages.com has some cool utilities here: &lt;a href=&quot;https://github.com/whitepages/solrcloud_manager#cluster-commands&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/whitepages/solrcloud_manager#cluster-commands&lt;/a&gt; &quot;backupindex&quot;, &quot;restoreindex&quot;.&lt;/p&gt;

&lt;p&gt;Thanks Jan for clarifying this issue is about the need for better error messages / documentation.&lt;/p&gt;</comment>
                            <comment id="16526566" author="thelabdude" created="Thu, 28 Jun 2018 17:15:20 +0000"  >&lt;p&gt;When I&apos;m working on a cloud platform like EC2 or Google cloud, I don&apos;t want to deal with NFS when I have cloud storage like S3. I haven&apos;t had much luck in the past with using the Hdfs directory factory with S3 (I&apos;ll checkout &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9952&quot; title=&quot;S3BackupRepository&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9952&quot;&gt;&lt;del&gt;SOLR-9952&lt;/del&gt;&lt;/a&gt;), so I figured I would just create the backup using Solr and then move the files out to cloud storage using tools optimized for S3. In the past, I think using an S3 destination for backup worked OK, but RESTORE took forever (all the check summing / sanity checking per file serially vs. concurrently) and given backup is usually part of a disaster recovery strategy, I don&apos;t want RESTORE taking hours to restore my index. If I pull that down from cloud storage to the local disks using some tool that&apos;s optimized for reading in bulk from S3 (multi-threaded) and then restore from local, it&apos;s much faster. So for me, separating the concerns of creating the snapshot for each shard (Solr&apos;s job) and moving big files out to cloud storage (Solr needs to do much better in this regard or punt) is what I&apos;m looking for.&lt;/p&gt;</comment>
                            <comment id="16527029" author="hgadre" created="Fri, 29 Jun 2018 01:50:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;So for me, separating the concerns of creating the snapshot for each shard (Solr&apos;s job) and moving big files out to cloud storage (Solr needs to do much better in this regard or punt) is what I&apos;m looking for.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; this is the exact use case for which we added snapshots mechanism (Ref:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9038&quot; title=&quot;Support snapshot management functionality for a solr collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9038&quot;&gt;&lt;del&gt;SOLR-9038&lt;/del&gt;&lt;/a&gt;). As part of Cloudera Search, we use this functionality to provide backup and disaster recovery functionality for Solr,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.cloudera.com/blog/2017/05/how-to-backup-and-disaster-recovery-for-apache-solr-part-i/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blog.cloudera.com/blog/2017/05/how-to-backup-and-disaster-recovery-for-apache-solr-part-i/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When user creates a snapshot, Solr associates user specified snapshot name with the latest commit point for each core associated with the given collection. Once the snapshot is created, Solr ensures that the files associated with the commit point associated with the snapshot name are not deleted (e.g. as part of optimize operation). It also records the snapshot metadata in Zookeeper and provides access to it via Collections API. Now you are free to use any mechanism to copy these index files to remote location (e.g. in our case we use DistCp - a tool specifically designed for large scale data copy&#160;which&#160;also works well with cloud object stores). I agree with your point about slow restore operation. May be we can extend the snapshot API to restore in-place ? e.g. create index.xxx directory automatically and copy the files. Once this is done, we can just switch the index directory on-the-fly (just the way we do at the time of full replication as part of core recovery).&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16527310" author="varunthacker" created="Fri, 29 Jun 2018 08:20:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;I agree with your point about slow restore operation. May be we can extend the snapshot API to restore in-place&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah I think providing a way to restore the snapshots in place would be great!&lt;/p&gt;</comment>
                            <comment id="16527505" author="janhoy" created="Fri, 29 Jun 2018 11:52:33 +0000"  >&lt;p&gt;Tested the patch, and it passes precommit. Here&apos;s the new&#160;error text from the API when attempting a backup across two nodes that do NOT share the backup drive. The same error will also be logged in the logs on both nodes. Will commit soon.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
&quot;responseHeader&quot;: {
&quot;status&quot;: 500, &quot;QTime&quot;: 135
}, &quot;failure&quot;: {
&quot;10.5.0.5:8983_solr&quot;: &quot;org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException:Error from server at http://10.5.0.5:8983/solr: Failed to backup core=coll2_shard1_replica_n2 because org.apache.solr.common.SolrException: Directory to contain snapshots doesn&apos;t exist: file:///back/myback2. Backup folder must already exist. Note also that Backup/Restore of a SolrCloud collection requires a shared file system mounted at the same path on all nodes!&quot;
}, &quot;Operation backup caused exception:&quot;: &quot;org.apache.solr.common.SolrException:org.apache.solr.common.SolrException: Could not backup all replicas&quot;, &quot;exception&quot;: {
&quot;msg&quot;: &quot;Could not backup all replicas&quot;, &quot;rspCode&quot;: 500
}, &quot;error&quot;: {
&quot;metadata&quot;: [
&quot;error-class&quot;, &quot;org.apache.solr.common.SolrException&quot;, &quot;root-error-class&quot;, &quot;org.apache.solr.common.SolrException&quot;
], &quot;msg&quot;: &quot;Could not backup all replicas&quot;, &quot;trace&quot;: &quot;org.apache.solr.common.SolrException: Could not backup all replicas\n\tat org.apache.solr.client.solrj.SolrResponse.getException(SolrResponse.java:53)\n\tat 
[...snip...]
}
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;One unrelated observation here. Part of the error response says: &lt;b&gt;Could not backup all replicas&lt;/b&gt;. While we might call any core a &quot;replica&quot;, it would perhaps in the context of a collection backup be more precise to say &lt;b&gt;Could not backup all shards&lt;/b&gt;? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; it&apos;s your code line &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16578021" author="janhoy" created="Mon, 13 Aug 2018 09:39:53 +0000"  >&lt;p&gt;Planning to change text &quot;Could not backup all replicas&quot; to &quot;Could not backup all shards&quot; and then commit.&lt;/p&gt;</comment>
                            <comment id="16580968" author="jira-bot" created="Wed, 15 Aug 2018 11:49:10 +0000"  >&lt;p&gt;Commit f3339d14c9ff11163dd89b1b03529ef53ee29b49 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f3339d1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f3339d1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12523&quot; title=&quot;Confusing error reporting if backup attempted on non-shared FS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12523&quot;&gt;&lt;del&gt;SOLR-12523&lt;/del&gt;&lt;/a&gt;: Improve error reporting and docs regarding Collection backup feature shared-fs requirement&lt;/p&gt;</comment>
                            <comment id="16580988" author="jira-bot" created="Wed, 15 Aug 2018 12:09:04 +0000"  >&lt;p&gt;Commit 806d087adf9ab5f3afd45714686ad3a29e6aa508 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=806d087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=806d087&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12523&quot; title=&quot;Confusing error reporting if backup attempted on non-shared FS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12523&quot;&gt;&lt;del&gt;SOLR-12523&lt;/del&gt;&lt;/a&gt;: Improve error reporting and docs regarding Collection backup feature shared-fs requirement&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f3339d1)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12929544" name="SOLR-12523.patch" size="2865" author="janhoy" created="Thu, 28 Jun 2018 08:59:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vb3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>