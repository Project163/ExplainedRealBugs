<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:51:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6145] Concurrent Schema API field additions can result in endless loop</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6145</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The optimistic concurrency loop in &lt;tt&gt;ManagedIndexSchema.addFields()&lt;/tt&gt; is the likely culprit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12718751">SOLR-6145</key>
            <summary>Concurrent Schema API field additions can result in endless loop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Jun 2014 23:56:10 +0000</created>
                <updated>Wed, 30 Oct 2019 17:49:03 +0000</updated>
                            <resolved>Tue, 10 Jun 2014 21:28:38 +0000</resolved>
                                                    <fixVersion>4.9</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14019431" author="steve_rowe" created="Thu, 5 Jun 2014 23:58:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexey.serba&quot; class=&quot;user-hover&quot; rel=&quot;alexey.serba&quot;&gt;alexey.serba&lt;/a&gt; gave me the attached patch, to &lt;tt&gt;TestCloudManagedSchemaAddField&lt;/tt&gt;, that triggers the problem.&lt;/p&gt;</comment>
                            <comment id="14020380" author="gchanan" created="Fri, 6 Jun 2014 21:09:32 +0000"  >&lt;p&gt;Here&apos;s a patch that fixes the test.&lt;/p&gt;

&lt;p&gt;The basic idea is that retrying on a BadVersionException won&apos;t help the ManagedIndexSchema, since the version will always be past our version.  Instead, we just throw an exception that can be caught by the callers and retried.  I only put the retry logic in FieldResource for now, but there&apos;s a few more places where it should go if we like this approach.&lt;/p&gt;

&lt;p&gt;I originally thought of doing the retry logic inside of ManagedIndexSchema, so we wouldn&apos;t need to put it in as many places, but that seemed not as clean, since the older schema would be getting the newer schema (presumably from the core), which seems wrong since a schema should exist independently of a core.&lt;/p&gt;</comment>
                            <comment id="14020648" author="gchanan" created="Sat, 7 Jun 2014 02:08:47 +0000"  >&lt;p&gt;Two patches:&lt;/p&gt;

&lt;p&gt;The tests patch is just taking the existing test as a template and testing copyFields and adding fields via POST.  I verified that these tests fail consistently without the patch.&lt;/p&gt;

&lt;p&gt;The v2 patch handles the copyfields and adding fields via POST cases.  The POST case has a bit of extra logic for making the optimistic concurrency control failure look like what would happen if the concurrent schema changes were actually serialized.&lt;/p&gt;</comment>
                            <comment id="14025864" author="steve_rowe" created="Mon, 9 Jun 2014 22:35:33 +0000"  >&lt;p&gt;+1, looks good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gchanan&quot; class=&quot;user-hover&quot; rel=&quot;gchanan&quot;&gt;gchanan&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This patch includes your tests patch and your non-test patch.  I removed some commented out test code, and added a verification step to &lt;tt&gt;TestCloudManagedSchemaCopyFields&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I noticed that adding the same copy field directive multiple times results in multiple identical copies of the same directive in the schema.  This is wrong.  I&apos;ll open a separate issue.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this in a day or so.&lt;/p&gt;</comment>
                            <comment id="14025874" author="steve_rowe" created="Mon, 9 Jun 2014 22:44:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;I noticed that adding the same copy field directive multiple times results in multiple identical copies of the same directive in the schema. This is wrong. I&apos;ll open a separate issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6155&quot; title=&quot;Multiple copy field directives are created in a mutable managed schema when identical copy field directives are added&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6155&quot;&gt;&lt;del&gt;SOLR-6155&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14026887" author="steve_rowe" created="Tue, 10 Jun 2014 19:38:51 +0000"  >&lt;p&gt;Patch, removes the useless optimistic concurrency loops from ManagedIndexSchema.add(Copy)Fields(), and also modifies the consumers of those methods to handle failures that won&apos;t benefit from retrying.&lt;/p&gt;

&lt;p&gt;Committing shortly. &lt;/p&gt;</comment>
                            <comment id="14026994" author="steve_rowe" created="Tue, 10 Jun 2014 20:56:25 +0000"  >&lt;p&gt;Final patch, added no-op catch clause for &lt;tt&gt;SchemaChangedInZkException&lt;/tt&gt; to the optimistic concurrency loop in &lt;tt&gt;AddSchemaFieldsUpdateProcessor.processAdd()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Committing now.&lt;/p&gt;</comment>
                            <comment id="14026995" author="jira-bot" created="Tue, 10 Jun 2014 20:57:01 +0000"  >&lt;p&gt;Commit 1601770 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1601770&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1601770&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6145&quot; title=&quot;Concurrent Schema API field additions can result in endless loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6145&quot;&gt;&lt;del&gt;SOLR-6145&lt;/del&gt;&lt;/a&gt;: Fix Schema API optimistic concurrency by moving it out of ManagedIndexSchema.add(Copy)Fields() into the consumers of those methods: CopyFieldCollectionResource, FieldCollectionResource, FieldResource, and AddSchemaFieldsUpdateProcessorFactory.&lt;/p&gt;</comment>
                            <comment id="14027056" author="jira-bot" created="Tue, 10 Jun 2014 21:23:10 +0000"  >&lt;p&gt;Commit 1601775 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1601775&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1601775&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6145&quot; title=&quot;Concurrent Schema API field additions can result in endless loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6145&quot;&gt;&lt;del&gt;SOLR-6145&lt;/del&gt;&lt;/a&gt;: In AddSchemaFieldsUpdateProcessor.processAdd(), handle ManagedIndexSchema.addFields() failures that won&apos;t benefit from retrying.&lt;/p&gt;</comment>
                            <comment id="14027063" author="jira-bot" created="Tue, 10 Jun 2014 21:27:47 +0000"  >&lt;p&gt;Commit 1601776 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1601776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1601776&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6145&quot; title=&quot;Concurrent Schema API field additions can result in endless loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6145&quot;&gt;&lt;del&gt;SOLR-6145&lt;/del&gt;&lt;/a&gt;: Fix Schema API optimistic concurrency by moving it out of ManagedIndexSchema.add(Copy)Fields() into the consumers of those methods: CopyFieldCollectionResource, FieldCollectionResource, FieldResource, and AddSchemaFieldsUpdateProcessorFactory. (merged trunk r1601770 and r1601775)&lt;/p&gt;</comment>
                            <comment id="14027067" author="steve_rowe" created="Tue, 10 Jun 2014 21:28:38 +0000"  >&lt;p&gt;Committed to trunk and branch_4x.&lt;/p&gt;

&lt;p&gt;Thanks Gregory and Alexey!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12648787" name="SOLR-6145-tests.patch" size="20898" author="gchanan" created="Sat, 7 Jun 2014 02:08:47 +0000"/>
                            <attachment id="12649663" name="SOLR-6145.patch" size="36652" author="sarowe" created="Tue, 10 Jun 2014 20:56:25 +0000"/>
                            <attachment id="12649646" name="SOLR-6145.patch" size="34551" author="sarowe" created="Tue, 10 Jun 2014 19:38:51 +0000"/>
                            <attachment id="12649480" name="SOLR-6145.patch" size="23946" author="sarowe" created="Mon, 9 Jun 2014 22:35:33 +0000"/>
                            <attachment id="12648726" name="SOLR-6145.patch" size="3622" author="gchanan" created="Fri, 6 Jun 2014 21:09:32 +0000"/>
                            <attachment id="12648788" name="SOLR-6145v2.patch" size="8979" author="gchanan" created="Sat, 7 Jun 2014 02:08:47 +0000"/>
                            <attachment id="12648570" name="concurrent_updates_and_schema_api.patch" size="2884" author="sarowe" created="Thu, 5 Jun 2014 23:58:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>396950</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wc8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>