<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:23:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9527] Solr RESTORE api doesn&apos;t distribute the replicas uniformly </title>
                <link>https://issues.apache.org/jira/browse/SOLR-9527</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Please refer to this email thread for details,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://lucene.markmail.org/message/ycun4x5nx7lwj5sk?q=solr+list:org%2Eapache%2Elucene%2Esolr-user+order:date-backward&amp;amp;page=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.markmail.org/message/ycun4x5nx7lwj5sk?q=solr+list:org%2Eapache%2Elucene%2Esolr-user+order:date-backward&amp;amp;page=1&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13005601">SOLR-9527</key>
            <summary>Solr RESTORE api doesn&apos;t distribute the replicas uniformly </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="hgadre">Hrishikesh Gadre</reporter>
                        <labels>
                    </labels>
                <created>Sat, 17 Sep 2016 04:28:35 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:16 +0000</updated>
                            <resolved>Wed, 10 May 2017 14:49:03 +0000</resolved>
                                    <version>6.1</version>
                                    <fixVersion>6.6</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>9</votes>
                                    <watches>14</watches>
                                                                                                                <comments>
                            <comment id="15508211" author="steviebee" created="Wed, 21 Sep 2016 00:11:34 +0000"  >&lt;p&gt;This patch accomplishes two things in the branch branch_6_2.&lt;/p&gt;

&lt;p&gt;(a) It fixes the issue of replica distribution for the leaders&lt;br/&gt;
(b) Simultaneously, supports the CreateNodeSet parameter for collection restore.&lt;/p&gt;</comment>
                            <comment id="15508535" author="hgadre" created="Wed, 21 Sep 2016 03:02:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steviebee&quot; class=&quot;user-hover&quot; rel=&quot;steviebee&quot;&gt;steviebee&lt;/a&gt; Thanks for the patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I updated your patch with a unit test which reproduces the problem (without your patch) and passes with your patch.&lt;/p&gt;

&lt;p&gt;The failure can be reproduced with this command,&lt;/p&gt;

&lt;p&gt;ant test  -Dtestcase=TestLocalFSCloudBackupRestore -Dtests.method=test -Dtests.seed=F465CD94BAC9633C -Dtests.slow=true -Dtests.locale=lt -Dtests.timezone=America/Inuvik -Dtests.asserts=true -Dtests.file.encoding=UTF-8&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; Could you please take a look?&lt;/p&gt;</comment>
                            <comment id="15511121" author="steviebee" created="Wed, 21 Sep 2016 20:44:24 +0000"  >&lt;p&gt;This update removes some extra logging I&apos;d meant to rip and passes through the createNodeSet param from the request to the function call.&lt;/p&gt;</comment>
                            <comment id="15537223" author="hgadre" created="Fri, 30 Sep 2016 22:17:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Can you review this patch please? &lt;/p&gt;</comment>
                            <comment id="15537773" author="dsmiley" created="Sat, 1 Oct 2016 03:20:39 +0000"  >&lt;p&gt;FYI When I originally worked on the backup capability, I didn&apos;t add support for createNodeSet because I wasn&apos;t yet sure how to resolve the possibility of duplicating logic with regular collection creation.  I gave a cursory look at the patch here; it&apos;s interesting that the patch is actually kinda small.  I should look at it more when I have time.  I noticed this doesn&apos;t seem to be tested; right?  I saw a test modification but it doesn&apos;t seem to test the distribution.&lt;/p&gt;</comment>
                            <comment id="15648793" author="hgadre" created="Tue, 8 Nov 2016 21:07:18 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I noticed this doesn&apos;t seem to be tested; right? I saw a test modification but it doesn&apos;t seem to test the distribution.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I added assertion in the test to verify that the number of replicas per host are in-line with the expected value of max_shards_per_node param. I think this is sufficient to test the distribution &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Although I have not added any test for &quot;createNodeSet&quot; functionality. Let me add that test as well.&lt;/p&gt;</comment>
                            <comment id="15880507" author="dewaldv" created="Thu, 23 Feb 2017 14:23:55 +0000"  >&lt;p&gt;I&apos;ve run smack dab straight into this issue recently. I was wondering what the progress is on this patch?&lt;/p&gt;

&lt;p&gt;I&apos;m currently running Solr 6.4.1 and would really like to take advantage of the Collections Backup/Restore functionality in combination with HDFS. All works well until I restore the collection and all my shards end up on one of my SolrCloud nodes. I can specify a replicationFactor of 2 and then though some other API calls make the replica&apos;s the leaders and rebalance everything but it&apos;s a bit of a mess.&lt;/p&gt;

&lt;p&gt;I&apos;m happy to lend my efforts to get this issue resolved.&lt;/p&gt;</comment>
                            <comment id="15959792" author="rohitcse" created="Thu, 6 Apr 2017 21:30:03 +0000"  >&lt;p&gt;Trying to refine the replica placement to be more uniform across multiple nodes if we have sufficient amount of live_nodes in Solr available,&lt;br/&gt;
1. When we have live_nodes in excess of the replication factor which existed during the time to backup we can do away with creating multiple replicas for same shard on the same live_node to ensure better distribution.&lt;/p&gt;

&lt;p&gt;2. User should be given warning or, option to go ahead with the Restore API if the number of live_nodes is less that what the collection was originally created.&lt;/p&gt;

&lt;p&gt;Details of the two issue in the attached PDF and initial patch attached with the ticket.&lt;/p&gt;</comment>
                            <comment id="15979043" author="jove4015" created="Fri, 21 Apr 2017 16:40:18 +0000"  >&lt;p&gt;Any chance we can get this patch merged in?  We really need this issue fixed, and it&apos;s made upgrading a serious pain.   Every new version we have to recompile our own Solr for this one little detail.  If you need it to be tested... well... we&apos;ve used it in production for months and it&apos;s great.  What&apos;s actually in master is no good.  Why didn&apos;t that need to be tested as much?&lt;/p&gt;</comment>
                            <comment id="15979271" author="dsmiley" created="Fri, 21 Apr 2017 19:41:01 +0000"  >&lt;p&gt;+1 to the patch&lt;/p&gt;</comment>
                            <comment id="15979276" author="dsmiley" created="Fri, 21 Apr 2017 19:47:35 +0000"  >&lt;p&gt;+1 to the patch&lt;/p&gt;</comment>
                            <comment id="15979277" author="varunthacker" created="Fri, 21 Apr 2017 19:48:16 +0000"  >&lt;p&gt;Thanks David for the review. I&apos;ll go through it and commit in on Monday&lt;/p&gt;</comment>
                            <comment id="15981674" author="varunthacker" created="Mon, 24 Apr 2017 18:55:10 +0000"  >&lt;p&gt;I reviewed the latest patch ( 6th April ) and here are a few things I believe we should fix:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Should we rename &lt;tt&gt;DocCollection#getReplicaCount&lt;/tt&gt; to &lt;tt&gt;DocCollection#getNodeCount&lt;/tt&gt; ?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;RestoreCmd has an unused import. We should generally remove all unused imports to make &quot;ant precommit&quot; happy&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; createNodeArg = message.getStr(CREATE_NODE_SET, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (createNodeArg == CREATE_NODE_SET_EMPTY) {
  &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException(
      SolrException.ErrorCode.BAD_REQUEST,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot restore with a CREATE_NODE_SET of CREATE_NODE_SET_EMPTY.&quot;&lt;/span&gt;
  );
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Can we move this check from RestoreCmd to the CollectionsHandler#RESTORE_OP?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In line 206 of RestoreCmd , shouldn&apos;t&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;tt&gt;int repFactor = backupCollectionState.getReplicaCount();&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;be &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;int repFactor = message.getInt(REPLICATION_FACTOR, backupCollectionState.getReplicaCount());&lt;/tt&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We should also allow users to pass &lt;tt&gt;createNodeSet.shuffle&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15999287" author="hgadre" created="Sat, 6 May 2017 05:02:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; I have addressed all the review comments. In addition I also added a unit test to verify createNodeSet functionality. I made few changes along the way,&lt;/p&gt;

&lt;p&gt;(a) Added support for configuring createNodeSet.shuffle parameter for restore command.&lt;br/&gt;
(b) The logic in RestoreCmd.java comparing the current num_live_nodes against the num_nodes for backup collection was not quite correct since it was not considering the createNodeSet as well as maxShardsPerNode parameters. So I fixed that logic.&lt;br/&gt;
(c) Fixed UpdateRequestProcessorFactoryTest (unrelated to these changes). It was failing for following combination of parameters,&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ant test  -Dtestcase=UpdateRequestProcessorFactoryTest -Dtests.method=testRequestTimeUrp -Dtests.seed=91817E95F0748507 -Dtests.slow=true -Dtests.locale=be-BY -Dtests.timezone=America/Indiana/Vevay -Dtests.asserts=true -Dtests.file.encoding=UTF-8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Can you take a look and let me know your feedback?&lt;/p&gt;</comment>
                            <comment id="15999325" author="mkhludnev" created="Sat, 6 May 2017 07:26:56 +0000"  >&lt;p&gt;testRequestTimeUrp has been fixed. Just pull&lt;/p&gt;</comment>
                            <comment id="16002445" author="varunthacker" created="Tue, 9 May 2017 10:27:25 +0000"  >&lt;p&gt;Hi Hrishikesh,&lt;/p&gt;

&lt;p&gt;Starting to look at it right now.&lt;/p&gt;</comment>
                            <comment id="16004551" author="varunthacker" created="Wed, 10 May 2017 12:01:43 +0000"  >&lt;p&gt;Hi Hrishikesh,&lt;/p&gt;

&lt;p&gt;Patch looks good. Attaching a new patch without the changes to &lt;tt&gt;UpdateRequestProcessorFactoryTest&lt;/tt&gt; as that&apos;s already been committed. &lt;/p&gt;

&lt;p&gt;I&apos;m going to run all the tests and commit this soon.&lt;/p&gt;</comment>
                            <comment id="16004794" author="jira-bot" created="Wed, 10 May 2017 14:40:24 +0000"  >&lt;p&gt;Commit b1efd37ba7b57cc01b3e2ac740b4f1d13fb86cd2 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b1efd37&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b1efd37&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9527&quot; title=&quot;Solr RESTORE api doesn&amp;#39;t distribute the replicas uniformly &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9527&quot;&gt;&lt;del&gt;SOLR-9527&lt;/del&gt;&lt;/a&gt;: Improve distribution of replicas when restoring a collection&lt;/p&gt;</comment>
                            <comment id="16004807" author="jira-bot" created="Wed, 10 May 2017 14:48:26 +0000"  >&lt;p&gt;Commit 1adeebdd92a96233836f83f6144da9eead65a2cf in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1adeebd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1adeebd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9527&quot; title=&quot;Solr RESTORE api doesn&amp;#39;t distribute the replicas uniformly &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9527&quot;&gt;&lt;del&gt;SOLR-9527&lt;/del&gt;&lt;/a&gt;: Improve distribution of replicas when restoring a collection&lt;/p&gt;</comment>
                            <comment id="16004810" author="varunthacker" created="Wed, 10 May 2017 14:49:22 +0000"  >&lt;p&gt;Thanks all for contributing!&lt;/p&gt;</comment>
                            <comment id="16004912" author="jira-bot" created="Wed, 10 May 2017 15:57:48 +0000"  >&lt;p&gt;Commit 201e2125f4db3b4fd1ecfe5ddef5471f305fc1f0 in lucene-solr&apos;s branch refs/heads/branch_6_6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=201e212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=201e212&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9527&quot; title=&quot;Solr RESTORE api doesn&amp;#39;t distribute the replicas uniformly &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9527&quot;&gt;&lt;del&gt;SOLR-9527&lt;/del&gt;&lt;/a&gt;: Improve distribution of replicas when restoring a collection&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13033380">SOLR-9952</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12867316" name="SOLR-9527.patch" size="18836" author="varun" created="Wed, 10 May 2017 12:01:43 +0000"/>
                            <attachment id="12866720" name="SOLR-9527.patch" size="21649" author="hgadre" created="Sat, 6 May 2017 05:02:19 +0000"/>
                            <attachment id="12862374" name="SOLR-9527.patch" size="9851" author="rohitcse" created="Thu, 6 Apr 2017 21:26:22 +0000"/>
                            <attachment id="12829683" name="SOLR-9527.patch" size="9240" author="steviebee" created="Wed, 21 Sep 2016 20:44:24 +0000"/>
                            <attachment id="12829490" name="SOLR-9527.patch" size="7501" author="hgadre" created="Wed, 21 Sep 2016 03:02:50 +0000"/>
                            <attachment id="12829474" name="SOLR-9527.patch" size="6781" author="steviebee" created="Wed, 21 Sep 2016 00:11:34 +0000"/>
                            <attachment id="12862375" name="Solr 9527.pdf" size="248234" author="rohitcse" created="Thu, 6 Apr 2017 21:26:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33qq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>