<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:08:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7843] Importing Delta create a memory leak</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7843</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The org.apache.solr.handler.dataimport.SolrWriter is not correctly cleaning itself after finishing importing Deltas as the &quot;Set&amp;lt;Object&amp;gt; deltaKeys&quot; is not being cleaned after the process has finished. &lt;/p&gt;

&lt;p&gt;When using a custom importer or DataSource for my case I need to add additional parameters to the delta keys.&lt;/p&gt;

&lt;p&gt;When the data import finishes the DeltaKeys is not set back to null and the DataImporter, DocBuilder and the SolrWriter are mantained as live objects because there are being referenced by the &quot;infoRegistry&quot; of the SolrCore which seems to be used for Jmx information.&lt;/p&gt;

&lt;p&gt;It appears that starting a second delta import did not freed the memory which may cause on the long run an OutOfMemory, I have not checked if starting a full import would break the references and free the memory.&lt;/p&gt;

&lt;p&gt;An easy fix is possible which  would be to add to the SolrWriter &quot;deltaKeys = null;&quot; on the close method.&lt;br/&gt;
Or nullify the writer on DocBuilder after being used on the method execute();&lt;/p&gt;</description>
                <environment></environment>
        <key id="12849667">SOLR-7843</key>
            <summary>Importing Delta create a memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="Altaflux">Pablo Lozano</reporter>
                        <labels>
                            <label>memory-leak</label>
                    </labels>
                <created>Tue, 28 Jul 2015 16:52:07 +0000</created>
                <updated>Mon, 9 May 2016 18:45:50 +0000</updated>
                            <resolved>Thu, 22 Oct 2015 19:17:27 +0000</resolved>
                                    <version>5.2.1</version>
                                    <fixVersion>5.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14969374" author="joekiller" created="Thu, 22 Oct 2015 16:15:57 +0000"  >&lt;p&gt;Why is this not a problem?&lt;/p&gt;</comment>
                            <comment id="14969701" author="jira-bot" created="Thu, 22 Oct 2015 19:14:25 +0000"  >&lt;p&gt;Commit 1710078 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1710078&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1710078&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7843&quot; title=&quot;Importing Delta create a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7843&quot;&gt;&lt;del&gt;SOLR-7843&lt;/del&gt;&lt;/a&gt;: DataImportHandler&apos;s delta imports leak memory because the delta keys are kept in memory and not cleared after the process is finished&lt;/p&gt;</comment>
                            <comment id="14969705" author="jira-bot" created="Thu, 22 Oct 2015 19:16:35 +0000"  >&lt;p&gt;Commit 1710079 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1710079&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1710079&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7843&quot; title=&quot;Importing Delta create a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7843&quot;&gt;&lt;del&gt;SOLR-7843&lt;/del&gt;&lt;/a&gt;: DataImportHandler&apos;s delta imports leak memory because the delta keys are kept in memory and not cleared after the process is finished&lt;/p&gt;</comment>
                            <comment id="14969709" author="shalinmangar" created="Thu, 22 Oct 2015 19:17:27 +0000"  >&lt;p&gt;Thanks for the nudge, Joseph and to Pablo for reporting. This fix will be released in 5.4.&lt;/p&gt;</comment>
                            <comment id="14970114" author="joekiller" created="Thu, 22 Oct 2015 23:41:02 +0000"  >&lt;p&gt;Does this affect 5.3+ as well? If I&apos;m using DIH I&apos;m currently assuming 5.2.0 is the only safe version. Is that a correct assumption?&lt;/p&gt;</comment>
                            <comment id="14970509" author="shalinmangar" created="Fri, 23 Oct 2015 06:10:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joekiller&quot; class=&quot;user-hover&quot; rel=&quot;joekiller&quot;&gt;joekiller&lt;/a&gt; - yes, I&apos;d expect that 5.3.0 is affected as well. And, even though the bug is marked as affecting 5.2.1, I don&apos;t think 5.2 is any better either. You may need to patch and run a custom build of Solr until 5.4 is released.&lt;/p&gt;</comment>
                            <comment id="14973453" author="altaflux" created="Sun, 25 Oct 2015 22:00:16 +0000"  >&lt;p&gt;Thanks for fixing it.&lt;br/&gt;
I closed it before because I was starting to think it could have been my fault as I was using the import-handler on a very unorthodox way. Later on I did realize it was a real issue and it should be fixed but by that time I was using a different method of delta import that did not trigger this behavior. I forgot to reopen it again.&lt;br/&gt;
This issue only happens when the delta import is huge or use the import-handler on a very unorthodox way like I did but it should definitely needed to be fixed.&lt;/p&gt;

&lt;p&gt;Maybe this discussion should be for other day but even thoe the import-handler is very good I think it is missing some flexibility  to avoid this type of issues. I think most of the time developers would want to use it as a base and not as full fledged component. Most of the times use cases are very specific to business cases and the default implementation looks like something that has tried to adapt to all possible cases possible. This has constrained the flexibility on this plugin by adding inflexible edge cases rules, made strange abstractions and forces a very opinionated workflow. &lt;br/&gt;
In my opinion this plugin should serve as a base for developers to implement their own import functionality and set of tools to help them manage the state of the import. It is easier for a developer to implement an api than try to work around a framework.&lt;/p&gt;

&lt;p&gt;That is just my two cents of an overall great plugin.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i0zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>