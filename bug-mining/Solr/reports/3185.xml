<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:18:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9832] Schema modifications are not immediately visible on the coordinating node</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9832</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As noted on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9751&quot; title=&quot;PreAnalyzedField can cause managed schema corruption&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9751&quot;&gt;&lt;del&gt;SOLR-9751&lt;/del&gt;&lt;/a&gt;, &lt;tt&gt;PreAnalyzedFieldManagedSchemaCloudTest.testAdd2Fields()&lt;/tt&gt; has been failing on Jenkins.  When I beast this test on my Jenkins box, it fails about 1% of the time.  E.g. from &lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Linux/2247/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Linux/2247/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=PreAnalyzedFieldManagedSchemaCloudTest -Dtests.method=testAdd2Fields -Dtests.seed=CD72F125201C0C76 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=is -Dtests.timezone=Antarctica/McMurdo -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
  [junit4] ERROR   0.09s J0 | PreAnalyzedFieldManagedSchemaCloudTest.testAdd2Fields &amp;lt;&amp;lt;&amp;lt;
  [junit4]    &amp;gt; Throwable #1: org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request:[https://127.0.0.1:39011/solr/managed-preanalyzed, https://127.0.0.1:33343/solr/managed-preanalyzed]
  [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([CD72F125201C0C76:656743CEFC1A9F80]:0)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:414)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1292)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:1062)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:1004)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:149)
  [junit4]    &amp;gt; 	at org.apache.solr.schema.PreAnalyzedFieldManagedSchemaCloudTest.addField(PreAnalyzedFieldManagedSchemaCloudTest.java:61)
  [junit4]    &amp;gt; 	at org.apache.solr.schema.PreAnalyzedFieldManagedSchemaCloudTest.testAdd2Fields(PreAnalyzedFieldManagedSchemaCloudTest.java:52)
  [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
  [junit4]    &amp;gt; Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at https://127.0.0.1:39011/solr/managed-preanalyzed: No such path /schema/fields/field2
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:593)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:262)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:251)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:435)
  [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:387)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13026023">SOLR-9832</key>
            <summary>Schema modifications are not immediately visible on the coordinating node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Dec 2016 16:42:00 +0000</created>
                <updated>Sat, 8 Jun 2019 15:29:27 +0000</updated>
                            <resolved>Tue, 13 Dec 2016 21:02:45 +0000</resolved>
                                                    <fixVersion>6.4</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15726081" author="steve_rowe" created="Tue, 6 Dec 2016 17:08:38 +0000"  >&lt;p&gt;Patch with a new test that fails about 4% of the time on my Jenkins box, and a fix.  The new test doesn&apos;t involve PreAnalyzedField(Type).&lt;/p&gt;

&lt;p&gt;The issue appears to be that a schema modification request will persist the new schema to ZooKeeper, then wait up to a configurable amount of time (10 minutes by default) for all replicas to get the new schema, and then return success.  A ZooKeeper watch on the coordinating core&apos;s config directory eventually triggers a core reload for the persisted schema changes, but sometimes a request sent to a different node will trigger a reload for an older schema.  As a result, after returning success for a schema modification, the coordinating node will briefly host an &lt;b&gt;older&lt;/b&gt; schema.&lt;/p&gt;

&lt;p&gt;The attached patch triggers an immediate core reload after schema changes are successfully persisted to ZooKeeper, and once that&apos;s finished, checks that other replicas have the new schema.  The patch also: forces a schema staleness check &amp;amp; update when the ZK watch is created for the new core&apos;s schema in &lt;tt&gt;ManagedIndexSchemaFactory.inform()&lt;/tt&gt;; and removes an unnecessary schema download just prior to reloading the core in the listener created in &lt;tt&gt;SolrCore.getConfListener()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I beasted the new test for 500 iterations with the patch, and it did not fail.  I also beasted &lt;tt&gt;PreAnalyzedFieldManagedSchemaCloudTest.testAdd2Fields()&lt;/tt&gt; for 300 iterations with the patch, and it did not fail.&lt;/p&gt;

&lt;p&gt;Precommit and all Solr tests pass with the patch; I think it&apos;s ready.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit to master and let it soak for a couple days.&lt;/p&gt;</comment>
                            <comment id="15726184" author="dsmiley" created="Tue, 6 Dec 2016 17:44:49 +0000"  >&lt;p&gt;Nice investigation; I bet this was a doozy to figure out.&lt;/p&gt;</comment>
                            <comment id="15726245" author="steve_rowe" created="Tue, 6 Dec 2016 18:07:30 +0000"  >&lt;p&gt;Staring at logs, coordinating ports/timings/zkversions, imagining transient failure modes, and a frosty beverage: heaven!!!&lt;/p&gt;</comment>
                            <comment id="15726256" author="jira-bot" created="Tue, 6 Dec 2016 18:12:44 +0000"  >&lt;p&gt;Commit bf3a3137be8a70ceed884e87c3ada276e82b187b in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bf3a313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bf3a313&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9832&quot; title=&quot;Schema modifications are not immediately visible on the coordinating node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9832&quot;&gt;&lt;del&gt;SOLR-9832&lt;/del&gt;&lt;/a&gt;: Schema modifications are not immediately visible on the coordinating node&lt;/p&gt;</comment>
                            <comment id="15727039" author="jira-bot" created="Tue, 6 Dec 2016 23:13:13 +0000"  >&lt;p&gt;Commit bf3a3137be8a70ceed884e87c3ada276e82b187b in lucene-solr&apos;s branch refs/heads/apiv2 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bf3a313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bf3a313&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9832&quot; title=&quot;Schema modifications are not immediately visible on the coordinating node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9832&quot;&gt;&lt;del&gt;SOLR-9832&lt;/del&gt;&lt;/a&gt;: Schema modifications are not immediately visible on the coordinating node&lt;/p&gt;</comment>
                            <comment id="15746231" author="jira-bot" created="Tue, 13 Dec 2016 20:52:45 +0000"  >&lt;p&gt;Commit 765ea6f5a8dea0377420d975053e8583ae74d98e in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=765ea6f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=765ea6f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9832&quot; title=&quot;Schema modifications are not immediately visible on the coordinating node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9832&quot;&gt;&lt;del&gt;SOLR-9832&lt;/del&gt;&lt;/a&gt;: Schema modifications are not immediately visible on the coordinating node&lt;/p&gt;</comment>
                            <comment id="15746262" author="steve_rowe" created="Tue, 13 Dec 2016 21:02:45 +0000"  >&lt;p&gt;After the push to master, no test failures there, but since there were a few failures on branch_6x in that time, the change seems to be positive.  I cherry-picked to branch_6x.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13020009">SOLR-9751</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12841995" name="SOLR-9832.patch" size="8609" author="sarowe" created="Tue, 6 Dec 2016 17:08:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i378jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>