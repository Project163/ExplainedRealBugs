<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:08:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8215] SolrCloud can select a core not in active state for querying</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8215</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;A query can be served by a core which is not in active state if the request hits the node which hosts these non active cores.&lt;/p&gt;

&lt;p&gt;We explicitly check for only active cores to search against  in &lt;tt&gt;CloudSolrClient#sendRequest&lt;/tt&gt; Line 1043 on trunk.&lt;/p&gt;

&lt;p&gt;But we don&apos;t check this if someone uses the REST APIs &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;HttpSolrCall#getCoreByCollection&lt;/tt&gt; should only pick cores which are active on line 794 on trunk. &lt;/p&gt;

&lt;p&gt;We however check it on line 882/883 in HttpSolrCall, when we try to find cores on other nodes when it&apos;s not present locally.&lt;/p&gt;

&lt;p&gt;So let&apos;s fix &lt;tt&gt;HttpSolrCall#getCoreByCollection&lt;/tt&gt; to make the active check as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12908081">SOLR-8215</key>
            <summary>SolrCloud can select a core not in active state for querying</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Oct 2015 00:45:12 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:26 +0000</updated>
                            <resolved>Wed, 4 Nov 2015 19:10:51 +0000</resolved>
                                                    <fixVersion>5.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14977257" author="markrmiller@gmail.com" created="Tue, 27 Oct 2015 22:06:52 +0000"  >&lt;p&gt;Would be great if we could get a test that could catch this.&lt;/p&gt;</comment>
                            <comment id="14977298" author="varunthacker" created="Tue, 27 Oct 2015 22:41:46 +0000"  >&lt;p&gt;I was just working on one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Patch which only allows incoming requests against a collection to be served by a local core if it&apos;s in active state.&lt;/p&gt;

&lt;p&gt;The test fails without the fix to HttpSolrCall.&lt;/p&gt;</comment>
                            <comment id="14980795" author="markrmiller@gmail.com" created="Thu, 29 Oct 2015 16:59:03 +0000"  >&lt;p&gt;Cool, good catch!&lt;/p&gt;

&lt;p&gt;Patch LGTM.&lt;/p&gt;</comment>
                            <comment id="14980838" author="varunthacker" created="Thu, 29 Oct 2015 17:18:17 +0000"  >&lt;p&gt;Thanks Mark for the review!&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this shortly.&lt;/p&gt;</comment>
                            <comment id="14981223" author="ichattopadhyaya" created="Thu, 29 Oct 2015 20:38:01 +0000"  >&lt;p&gt;I&apos;m just wondering if this would mean that if a replica gets marked as down (due to bugs / by mistake), one wouldn&apos;t be able to issue core admin commands to bring it back up if this patch (and please correct me if I misunderstand this) short circuits the requests at the HttpSolrCall layer. One such command is under discussion / development in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7569&quot; title=&quot;Create an API to force a leader election between nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7569&quot;&gt;&lt;del&gt;SOLR-7569&lt;/del&gt;&lt;/a&gt; (last few comments), which will let the replica change its last published state. I&apos;m not suggesting right away that we don&apos;t do this patch, but do you have any thoughts around it (and recovery of such replicas, in general)? Fyi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14981241" author="varunthacker" created="Thu, 29 Oct 2015 20:46:15 +0000"  >&lt;p&gt;Hi Ishan,&lt;/p&gt;

&lt;p&gt;This code is only triggered when we issue a request against a collection. So for example &lt;tt&gt;/gettingstarted/update/&lt;/tt&gt; or &lt;tt&gt;/gettingstarted/select&lt;/tt&gt; . It should not effect any core admin / collection api calls. &lt;/p&gt;</comment>
                            <comment id="14981266" author="ichattopadhyaya" created="Thu, 29 Oct 2015 21:00:34 +0000"  >&lt;p&gt;Ah, I knew I was missing something. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Sorry for the noise, please go ahead!&lt;/p&gt;</comment>
                            <comment id="14990027" author="varunthacker" created="Wed, 4 Nov 2015 17:50:59 +0000"  >&lt;p&gt;Some tweaks to the patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Moved &lt;tt&gt;verifyReplicaStatus&lt;/tt&gt; to &lt;tt&gt;AbstractDistribZkTestBase&lt;/tt&gt; so that it can be reused.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SolrCore core = cores.getCore(leader.getStr(ZkStateReader.CORE_NAME_PROP));&lt;/tt&gt; in the previous patch was causing the test code to leave the core open hence the test was failing.  It was weird that running the tests from the IDE never hit this . So that code is fixed&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14990045" author="jira-bot" created="Wed, 4 Nov 2015 17:59:39 +0000"  >&lt;p&gt;Commit 1712601 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1712601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1712601&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8215&quot; title=&quot;SolrCloud can select a core not in active state for querying&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8215&quot;&gt;&lt;del&gt;SOLR-8215&lt;/del&gt;&lt;/a&gt;: Only active replicas should handle incoming requests against a collection&lt;/p&gt;</comment>
                            <comment id="14990197" author="jira-bot" created="Wed, 4 Nov 2015 19:09:55 +0000"  >&lt;p&gt;Commit 1712614 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1712614&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1712614&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8215&quot; title=&quot;SolrCloud can select a core not in active state for querying&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8215&quot;&gt;&lt;del&gt;SOLR-8215&lt;/del&gt;&lt;/a&gt;: Only active replicas should handle incoming requests against a collection (merged trunk 1712601)&lt;/p&gt;</comment>
                            <comment id="14990199" author="varunthacker" created="Wed, 4 Nov 2015 19:10:51 +0000"  >&lt;p&gt;Thanks Mark for the review!&lt;/p&gt;</comment>
                            <comment id="14990469" author="jira-bot" created="Wed, 4 Nov 2015 21:31:05 +0000"  >&lt;p&gt;Commit 1712658 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1712658&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1712658&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8215&quot; title=&quot;SolrCloud can select a core not in active state for querying&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8215&quot;&gt;&lt;del&gt;SOLR-8215&lt;/del&gt;&lt;/a&gt;: fixed typo. Class name is back to TestRandomRequestDistribution&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12770639" name="SOLR-8215.patch" size="15321" author="varun" created="Wed, 4 Nov 2015 17:50:59 +0000"/>
                            <attachment id="12769139" name="SOLR-8215.patch" size="8263" author="varun" created="Tue, 27 Oct 2015 22:41:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2njuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>