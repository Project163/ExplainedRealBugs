<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:22:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2571] IndexBasedSpellChecker &quot;thresholdTokenFrequency&quot; fails with a ClassCastException on startup</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2571</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When parsing the configuration for thresholdTokenFrequency&quot;, the IndexBasedSpellChecker tries to pull a Float from the DataConfig.xml-derrived NamedList.  However, this comes through as a String.  Therefore, a ClassCastException is always thrown whenever this parameter is specified.  The code ought to be doing &quot;Float.parseFloat(...)&quot; on the value.&lt;/p&gt;

&lt;p&gt;This looks like a nice feature to use in cases the data contains misspelled or rare words leading to spurious &quot;correct&quot; queries.  I would have liked to have used this with a project we just completed however this bug prevented that.  This issue came up recently in the User&apos;s mailing list so I am raising an issue now.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509014">SOLR-2571</key>
            <summary>IndexBasedSpellChecker &quot;thresholdTokenFrequency&quot; fails with a ClassCastException on startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rcmuir">Robert Muir</assignee>
                                    <reporter username="jdyer">James Dyer</reporter>
                        <labels>
                            <label>whereIsHossManWhenYouNeedHim</label>
                    </labels>
                <created>Wed, 1 Jun 2011 19:39:20 +0000</created>
                <updated>Sat, 2 Jul 2011 02:43:16 +0000</updated>
                            <resolved>Tue, 7 Jun 2011 02:58:22 +0000</resolved>
                                    <version>1.4.1</version>
                    <version>3.1</version>
                    <version>4.0-ALPHA</version>
                                    <fixVersion>3.3</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>spellchecker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13042388" author="jdyer" created="Wed, 1 Jun 2011 19:50:37 +0000"  >&lt;p&gt;Patches attached for Trunk &amp;amp; 3.x .&lt;/p&gt;

&lt;p&gt;This patch fixes the problem for IndexBasedSpellChecker.  DirectSolrSpellChecker (Trunk only) appears to be correct already.&lt;/p&gt;

&lt;p&gt;Should this patch be committed, I will add documentation for &quot;thresholdTokenFrequency&quot; to the wiki.  Currently it is absent from the wiki (although documented in Smiley&amp;amp;Pugh).&lt;/p&gt;</comment>
                            <comment id="13042683" author="rcmuir" created="Thu, 2 Jun 2011 10:25:37 +0000"  >&lt;p&gt;Hi James, I&apos;m confused about this one a little bit. Perhaps DirectSolrSpellChecker is actually wrong?&lt;/p&gt;

&lt;p&gt;If I configure the thing like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;float name=&quot;thresholdTokenFrequency&quot;&amp;gt;0.07&amp;lt;/float&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then it does apply the parameter. I guess what I&apos;m asking is, if in general we should be using int/float/etc in these types and not &amp;lt;str&amp;gt; (especially DirectSolrSpellChecker which takes a lot of numeric parameters but expects them all to be &amp;lt;str&amp;gt;). Just glancing through solrconfig.xml its not clear that there is a precedent, it appears inconsistent as far as numeric parameters.&lt;/p&gt;</comment>
                            <comment id="13042810" author="jdyer" created="Thu, 2 Jun 2011 15:04:02 +0000"  >&lt;p&gt;ha...I was unaware solrconfig.xml could take &amp;lt;float /&amp;gt; elements at all.  But now that you mention it, there&apos;s a couple of them in the example config file.  I tried this for myself and it works.&lt;/p&gt;

&lt;p&gt;I guess with this being the case, I would agree that its better to change DirectSolrSpellChecker to require a Float, not a String.  Once we decide &quot;correctness&quot; on this I&apos;ll also add this parameter to the wiki as its pretty much an undocumented feature...&lt;/p&gt;</comment>
                            <comment id="13043165" author="sokolov" created="Fri, 3 Jun 2011 01:11:06 +0000"  >&lt;p&gt;sounds like a good case for a config schema&lt;/p&gt;</comment>
                            <comment id="13043168" author="rcmuir" created="Fri, 3 Jun 2011 01:19:51 +0000"  >&lt;p&gt;Mike, I think I agree: currently we are relying upon examples in the wiki, but in this case one did not exist and it was/is totally confusing.&lt;/p&gt;</comment>
                            <comment id="13043172" author="sokolov" created="Fri, 3 Jun 2011 01:29:26 +0000"  >&lt;p&gt;I posted a patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1758&quot; title=&quot;schema definition for configuration files (validation, XSD)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1758&quot;&gt;SOLR-1758&lt;/a&gt; that has a preliminary schema and implements schema-checking when loading config files that could help&lt;/p&gt;</comment>
                            <comment id="13043427" author="jdyer" created="Fri, 3 Jun 2011 15:58:39 +0000"  >&lt;p&gt;I&apos;m betting the jury will rule we keep this a &amp;lt;float /&amp;gt; element, so here&apos;s a patch that changes DirectSolrSpellChecker.  I also added a unit test for thresholdTokenFrequency and added a (commented-out) line for it in the example solrconfig.xml.&lt;/p&gt;

&lt;p&gt;There are 3 TODO&apos;s in the unit test code:&lt;br/&gt;
1. My ignorance of the expression language used in unit-tests lead mem write an old-style long-form unit test.  If someone can show me how to convert this to a 1-liner I would be very appreciative.&lt;/p&gt;

&lt;p&gt;2. I found that DirectSolrSpellChecker returns results in a slightly different format than IndexBasedSpellChecker.  Is this OK?  Can SOLRJ handle this or do we need to tweak there?&lt;/p&gt;

&lt;p&gt;3. Also, in one case IndexBasedSpellChecker returns &quot;correctlySpelled=false&quot; while DirectSolrSpellChecker returns &quot;correctlySpelled=true&quot;.  Is this discrepancy valid?&lt;/p&gt;</comment>
                            <comment id="13043431" author="rcmuir" created="Fri, 3 Jun 2011 16:04:46 +0000"  >&lt;p&gt;Thanks for updating the patch!&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I found that DirectSolrSpellChecker returns results in a slightly different format than IndexBasedSpellChecker. Is this OK? Can SOLRJ handle this or do we need to tweak there?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure, I have used DirectSolrSpellChecker with solrj and I didn&apos;t have any problems... but that&apos;s not saying there isn&apos;t one.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Also, in one case IndexBasedSpellChecker returns &quot;correctlySpelled=false&quot; while DirectSolrSpellChecker returns &quot;correctlySpelled=true&quot;. Is this discrepancy valid?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t know, what makes this &apos;decision&apos; of correctlySpelled? Do you know? Remember also the DirectSolrSpellChecker is a different spellchecker totally than IndexBasedSpellChecker (it uses a fundamentally different algorithm), although I tried to keep some of the parameters consistent.&lt;/p&gt;

&lt;p&gt;Another question is, there are lots of other float/int arguments to DirectSolrSpellChecker, maybe we should cut all of these over to &amp;lt;int&amp;gt; and &amp;lt;float&amp;gt; while we are here?&lt;/p&gt;</comment>
                            <comment id="13044909" author="jdyer" created="Mon, 6 Jun 2011 15:23:34 +0000"  >&lt;p&gt;This version takes all of DirectSolrSpellChecker&apos;s parameters as Integer and Float objects rather than Strings, as appropriate.  Also, I changed the &quot;accuracy&quot; parameter to use SpellingParams.SPELLCHECK_ACCURACY ... I&apos;m not sure if this would have validated any unit tests (I didn&apos;t see any tests that use DirectSolrSpellChecker).&lt;/p&gt;

&lt;p&gt;I think this will make DirectSolrSpellChecker more consistent with the rest of &quot;solrconfig.xml&quot;s parameter requirements.  The only better option than this, maybe, would to make it flexible and allow either the Int/Float or String in these cases.  I think this later option is not necessary however.&lt;/p&gt;</comment>
                            <comment id="13044917" author="jdyer" created="Mon, 6 Jun 2011 15:47:04 +0000"  >&lt;blockquote&gt;
&lt;p&gt;what makes this &apos;decision&apos; of correctlySpelled? Do you know?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I took a quick look to find out.  Its more complicated than I thought!  Here&apos;s the basic jist (I think!) :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If the instance of SolrSpellChecker returns frequency data and all suggestions have frequency &amp;gt;0, TRUE.&lt;/li&gt;
	&lt;li&gt;If the instance of SolrSpellChecker returns frequency data and any suggestion have frequency == 0, FALSE.&lt;/li&gt;
	&lt;li&gt;If the instance of SolrSpellChecker returns NO frequency data but has suggestions, OMIT.&lt;/li&gt;
	&lt;li&gt;If the instance of SolrSpellChecker returns NO suggestions, FALSE.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Possibly this isn&apos;t fully accurate but I&apos;m at least mostly correct here.  Seems like the discrepency with DirectSolrSpellChecker is because it isn&apos;t returning Frequency info?&lt;/p&gt;

&lt;p&gt;This all happens in SpellCheckComponent.toNamedList() ... I&apos;m guessing the code here uses the presence or absence of frequency data as kind of a proxy indicator whether or not its dealing with IndexBasedSpellChecker or FileBasedSpellChecker.  Possibly it would be better if each instance of SolrSpellChecker had a &quot;isCorrectlySpelled()&quot; method that toNamedList() could call?  Maybe I should I go open another jira issue for that?&lt;/p&gt;</comment>
                            <comment id="13045029" author="rcmuir" created="Mon, 6 Jun 2011 18:58:07 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This version takes all of DirectSolrSpellChecker&apos;s parameters as Integer and Float objects rather than Strings, as appropriate. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Did you maybe upload an older patch? I took a look and it only seems to cutover the threshold param.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I&apos;m not sure if this would have validated any unit tests (I didn&apos;t see any tests that use DirectSolrSpellChecker).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There is a test (DirectSolrSpellCheckerTest), but its probably not that great &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13045031" author="rcmuir" created="Mon, 6 Jun 2011 18:59:59 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Possibly this isn&apos;t fully accurate but I&apos;m at least mostly correct here. Seems like the discrepency with DirectSolrSpellChecker is because it isn&apos;t returning Frequency info?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This sounds like a bug, care to open a separate issue on it? (we can resolve the int/float stuff here on this one).&lt;/p&gt;

&lt;p&gt;The thing certainly intends to return freq info...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SuggestWord[] suggestions = checker.suggestSimilar(new Term(field, token.toString()), 
          options.count, options.reader, options.onlyMorePopular, accuracy);
      for (SuggestWord suggestion : suggestions)
        result.add(token, suggestion.string, suggestion.freq);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13045069" author="jdyer" created="Mon, 6 Jun 2011 20:24:07 +0000"  >&lt;p&gt;Here is that patch with Ints/Floats instead of Strings.  I made a tiny adjustment to the unit test also.&lt;/p&gt;</comment>
                            <comment id="13045246" author="rcmuir" created="Tue, 7 Jun 2011 02:58:22 +0000"  >&lt;p&gt;Committed revision 1132855 (trunk).&lt;br/&gt;
I organized the constants in DirectSolrSpellchecker a bit, so its easy to see which ones are &apos;shared&apos; with the others and which ones are unique to it.&lt;/p&gt;

&lt;p&gt;Committed revision 1132856 (branch_3x).&lt;br/&gt;
I backported the test and example here. In the case of this test, it needed to clearIndex() in setup() like trunk does, so I merged these bits also.&lt;/p&gt;

&lt;p&gt;Thanks James!&lt;/p&gt;</comment>
                            <comment id="13045523" author="jdyer" created="Tue, 7 Jun 2011 16:30:22 +0000"  >&lt;p&gt;I added &quot;thresholdTokenFrequency&quot; to the SpellCheckComponent wiki page.&lt;/p&gt;</comment>
                            <comment id="13058968" author="rcmuir" created="Sat, 2 Jul 2011 02:43:16 +0000"  >&lt;p&gt;Bulk close for 3.3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12481615" name="SOLR-2571.patch" size="10031" author="jdyer" created="Mon, 6 Jun 2011 20:24:07 +0000"/>
                            <attachment id="12481577" name="SOLR-2571.patch" size="6894" author="jdyer" created="Mon, 6 Jun 2011 15:23:34 +0000"/>
                            <attachment id="12481361" name="SOLR-2571.patch" size="6894" author="jdyer" created="Fri, 3 Jun 2011 15:58:39 +0000"/>
                            <attachment id="12481137" name="SOLR-2571.patch" size="742" author="jdyer" created="Wed, 1 Jun 2011 19:50:37 +0000"/>
                            <attachment id="12481138" name="SOLR-2571.solr3.2.patch" size="690" author="jdyer" created="Wed, 1 Jun 2011 19:50:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4972</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03jyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18666</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>