<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:14:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8657] SolrRequestInfo logs an error if QuerySenderListener is being used</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8657</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This is the stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;at org.apache.solr.request.SolrRequestInfo.setRequestInfo(SolrRequestInfo.java:59)
	  at org.apache.solr.core.QuerySenderListener.newSearcher(QuerySenderListener.java:68)
	  at org.apache.solr.core.SolrCore$6.call(SolrCore.java:1859)
	  at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	  at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor$1.run(ExecutorUtil.java:232)
	  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SolrRequestInfo is being set in MDCAwareThreadPoolExecutor.execute() and later in QuerySenderListener.newSearcher() in the same thread.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12937540">SOLR-8657</key>
            <summary>SolrRequestInfo logs an error if QuerySenderListener is being used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tflobbe">Tomas Eduardo Fernandez Lobbe</assignee>
                                    <reporter username="pchollet">Pascal Chollet</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Feb 2016 15:49:28 +0000</created>
                <updated>Wed, 28 Sep 2016 08:13:10 +0000</updated>
                            <resolved>Wed, 29 Jun 2016 17:12:46 +0000</resolved>
                                    <version>5.4.1</version>
                                    <fixVersion>6.2</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15140509" author="pchollet" created="Wed, 10 Feb 2016 08:47:28 +0000"  >&lt;p&gt;I attached a screenshot of how this is polluting the logs. Every commit triggers warm-up, which leads then to writing this error messages.&lt;/p&gt;</comment>
                            <comment id="15141993" author="tomasflobbe" created="Thu, 11 Feb 2016 00:10:36 +0000"  >&lt;p&gt;I&apos;m a bit confused by this error, where in &lt;tt&gt;MDCAwareThreadPoolExecutor.execute()&lt;/tt&gt; do you say this is being set? I can&apos;t find that. Also, from the screen shot you showed it says that the previous request is the commit request and the warming is happening on a different thread.&lt;br/&gt;
I looked briefly at some tests that could hit this and they didn&apos;t, but I may be missing something. Maybe you can provide a test case? Maybe some modification in &lt;tt&gt;TestIndexSearcher&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="15142641" author="pchollet" created="Thu, 11 Feb 2016 12:03:17 +0000"  >&lt;p&gt;We are doing manual commit requests, and not auto-commits. Maybe this makes a difference.&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;SolrCore.getSearcher(...)&lt;/tt&gt; there is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (currSearcher != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = searcherExecutor.submit(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Callable() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; call() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
              &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (SolrEventListener listener : newSearcherListeners) {
                  listener.newSearcher(newSearcher, currSearcher);
                }
              } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
                SolrException.log(log, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, e);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Error) {
                  &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; (Error) e;
                }
              }
              &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            }
          });
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; which calls &lt;tt&gt;MDCAwareThreadPoolExecutor.execute()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;And in &lt;tt&gt;MDCAwareThreadPoolExecutor.execute()&lt;/tt&gt; there is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; providersCopy.size(); i++) providersCopy.get(i).set(ctx.get(i));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; with &lt;tt&gt;SolrRequestInfo.getInheritableThreadLocalProvider()&lt;/tt&gt; being contained in providersCopy. So this is setting SolrRequestInfo the first time.&lt;/p&gt;

&lt;p&gt;Then within the same thread &lt;tt&gt;QuerySenderListener.newSearcher()&lt;/tt&gt; is called, which sets SolrRequestInfo the second time.&lt;/p&gt;
</comment>
                            <comment id="15142825" author="pchollet" created="Thu, 11 Feb 2016 14:46:47 +0000"  >&lt;p&gt;To summarize, this is what happens:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;HttpSolrCall&lt;/tt&gt; sets &lt;tt&gt;SolrRequestInfo&lt;/tt&gt; for the manual commit request&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SolrCore.getSearcher(...)&lt;/tt&gt; calls &lt;tt&gt;MDCAwareThreadPoolExecutor.execute(...)&lt;/tt&gt; for all the listeners&lt;/li&gt;
	&lt;li&gt;before running a new thread, &lt;tt&gt;MDCAwareThreadPoolExecutor.execute(...)&lt;/tt&gt; stores &lt;tt&gt;SolrRequestInfo&lt;/tt&gt; (containing the initial commit request) in &lt;tt&gt;ctx&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;super.execute(...)&lt;/tt&gt; is called to start a new thread and &lt;tt&gt;SolrRequestInfo.getInheritableThreadLocalProvider().set()&lt;/tt&gt; sets &lt;tt&gt;ctx&lt;/tt&gt; as &lt;tt&gt;SolrRequestInfo&lt;/tt&gt; for this thread&lt;/li&gt;
	&lt;li&gt;in that same thread &lt;tt&gt;QuerySenderListener&lt;/tt&gt; also sets &lt;tt&gt;SolrRequestInfo&lt;/tt&gt;, which then causes the error message&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15285124" author="joekiller" created="Mon, 16 May 2016 19:19:28 +0000"  >&lt;p&gt;Some examples of this problem in the mailing list:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201511.mbox/%3C564ADA6B.6080505%40elyograg.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201511.mbox/%3C564ADA6B.6080505%40elyograg.org%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also seems related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8068&quot; title=&quot;NPE in SolrDispatchFilter.authenticateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8068&quot;&gt;&lt;del&gt;SOLR-8068&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m also hitting this on 6.0.0.&lt;/p&gt;

&lt;p&gt;Seems to happen after updating some documents and then doing a commit followed by an optimize.&lt;/p&gt;</comment>
                            <comment id="15348879" author="tomasflobbe" created="Fri, 24 Jun 2016 23:32:54 +0000"  >&lt;p&gt;I updated the test to hit this issue and added a trivial fix. I need to check other paths that could cause this problem (as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9244&quot; title=&quot;Lots of &amp;quot;Previous SolrRequestInfo was not closed&amp;quot; in Solr log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9244&quot;&gt;&lt;del&gt;SOLR-9244&lt;/del&gt;&lt;/a&gt;) , maybe there is a more general fix to do.&lt;/p&gt;</comment>
                            <comment id="15353527" author="tomasflobbe" created="Tue, 28 Jun 2016 18:54:31 +0000"  >&lt;p&gt;Slightly updated patch that considers when to cleanup the SolrRequestInfo in the QuerySenderListener. Will commit this soon.&lt;/p&gt;</comment>
                            <comment id="15353633" author="jira-bot" created="Tue, 28 Jun 2016 20:12:23 +0000"  >&lt;p&gt;Commit 4070bdd8d8b2095b406c404720e5f2c347596350 in lucene-solr&apos;s branch refs/heads/master from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4070bdd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4070bdd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8657&quot; title=&quot;SolrRequestInfo logs an error if QuerySenderListener is being used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8657&quot;&gt;&lt;del&gt;SOLR-8657&lt;/del&gt;&lt;/a&gt;: Fix SolrRequestInfo error logs if QuerySenderListener is being used&lt;/p&gt;</comment>
                            <comment id="15353805" author="jira-bot" created="Tue, 28 Jun 2016 22:27:25 +0000"  >&lt;p&gt;Commit eaabb9dc77621cd9386a3b522f23280f52cbb5ce in lucene-solr&apos;s branch refs/heads/branch_6x from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eaabb9d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eaabb9d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8657&quot; title=&quot;SolrRequestInfo logs an error if QuerySenderListener is being used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8657&quot;&gt;&lt;del&gt;SOLR-8657&lt;/del&gt;&lt;/a&gt;: Fix SolrRequestInfo error logs if QuerySenderListener is being used&lt;/p&gt;</comment>
                            <comment id="15439016" author="mikemccand" created="Fri, 26 Aug 2016 13:59:59 +0000"  >&lt;p&gt;Bulk close resolved issues after 6.2.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12982122">SOLR-9244</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12814164" name="SOLR-8657.patch" size="5814" author="tflobbe" created="Tue, 28 Jun 2016 18:54:31 +0000"/>
                            <attachment id="12813153" name="SOLR-8657.patch" size="4448" author="tflobbe" created="Fri, 24 Jun 2016 23:32:54 +0000"/>
                            <attachment id="12787227" name="Screen Shot 2016-02-10 at 09.43.56.png" size="438716" author="pchollet" created="Wed, 10 Feb 2016 08:45:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sk9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>