<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:14:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9235] NPE  when using non-numeric range query in deleteByQuery</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9235</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Upgrading from Solr 4.0.0 to 6.0.1/6.1.0, this old query suddenly got our indexing stuck:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;delete&amp;gt;&amp;lt;query&amp;gt;lastdate_a:{* TO 20160620} AND lastdate_p:{* TO 20160620} AND country:9&amp;lt;/query&amp;gt;&amp;lt;/delete&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with this error logged:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-06-20 02:20:36.429 ERROR (commitScheduler-15-thread-1) [   x:mycore] o.a.s.u.CommitTracker auto commit error...:java.lang.NullPointerException
        at org.apache.solr.query.SolrRangeQuery.createDocSet(SolrRangeQuery.java:156)
        at org.apache.solr.query.SolrRangeQuery.access$200(SolrRangeQuery.java:57)
        at org.apache.solr.query.SolrRangeQuery$ConstWeight.getSegState(SolrRangeQuery.java:412)
        at org.apache.solr.query.SolrRangeQuery$ConstWeight.scorer(SolrRangeQuery.java:484)
        at org.apache.lucene.search.LRUQueryCache$CachingWrapperWeight.scorer(LRUQueryCache.java:617)
        at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:389)
        at org.apache.solr.update.DeleteByQueryWrapper$1.scorer(DeleteByQueryWrapper.java:89)
        at org.apache.lucene.index.BufferedUpdatesStream.applyQueryDeletes(BufferedUpdatesStream.java:694)
        at org.apache.lucene.index.BufferedUpdatesStream.applyDeletesAndUpdates(BufferedUpdatesStream.java:262)
        at org.apache.lucene.index.IndexWriter.applyAllDeletesAndUpdates(IndexWriter.java:3187)
        at org.apache.lucene.index.IndexWriter.maybeApplyDeletes(IndexWriter.java:3173)
        at org.apache.lucene.index.IndexWriter.prepareCommitInternal(IndexWriter.java:2825)
        at org.apache.lucene.index.IndexWriter.commitInternal(IndexWriter.java:2989)
        at org.apache.lucene.index.IndexWriter.commit(IndexWriter.java:2956)
        at org.apache.solr.update.DirectUpdateHandler2.commit(DirectUpdateHandler2.java:619)
        at org.apache.solr.update.CommitTracker.run(CommitTracker.java:217)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The types were:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;fieldType name=&quot;string&quot; class=&quot;solr.StrField&quot; sortMissingLast=&quot;true&quot; omitNorms=&quot;true&quot;/&amp;gt;
  &amp;lt;field name=&quot;lastdate_a&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;false&quot; /&amp;gt;
  &amp;lt;field name=&quot;lastdate_p&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;false&quot; /&amp;gt;
  &amp;lt;field name=&quot;country&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;true&quot; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but changing the date fields into &quot;integer&quot; seems to avoid the problem:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;fieldType name=&quot;integer&quot; class=&quot;solr.TrieIntField&quot; omitNorms=&quot;true&quot;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12981342">SOLR-9235</key>
            <summary>NPE  when using non-numeric range query in deleteByQuery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="andersm">Anders Melchiorsen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jun 2016 13:09:47 +0000</created>
                <updated>Fri, 26 Aug 2016 13:59:56 +0000</updated>
                            <resolved>Tue, 5 Jul 2016 21:37:52 +0000</resolved>
                                    <version>6.0</version>
                    <version>6.1</version>
                                    <fixVersion>6.2</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15343910" author="andersm" created="Wed, 22 Jun 2016 08:34:59 +0000"  >&lt;p&gt;I forgot to mention that the exception is from version 6.0.1. I did test with 6.1.0 and saw the same issue.&lt;/p&gt;</comment>
                            <comment id="15344298" author="mkhludnev" created="Wed, 22 Jun 2016 13:26:22 +0000"  >&lt;p&gt;my gut feeling, you can only use ranges in delete query with 5.5.x and earlier. &lt;/p&gt;</comment>
                            <comment id="15358738" author="andersm" created="Fri, 1 Jul 2016 10:03:05 +0000"  >&lt;p&gt;You are obviously right, I cannot use it when it breaks like that. But are you suggesting that the feature has been removed intentionally? Even if ranges are indeed unsupported, crashing the core is a bit of a harsh way to report that.&lt;/p&gt;

&lt;p&gt;As I said, it still works for integers &#8211; so my problem is solved, though the bug is not.&lt;/p&gt;</comment>
                            <comment id="15359887" author="hossman" created="Sat, 2 Jul 2016 01:15:00 +0000"  >&lt;p&gt;an NPE would never be intentional - Mikhail is just pointing out when he thiks it broke, and from what i can tell he&apos;s right.&lt;/p&gt;

&lt;p&gt;Attached patch beefs up TestRangeQuery to demonstrate this bug (and in general to better exercise more code paths in SolrRangeQuery which can vary based on whether the number of terms is mall enough to re-write to a BooleanQuery or not).&lt;/p&gt;

&lt;p&gt;The added tests can ail very easily demonstrating the same problem reported here, and i added (what seems to me like) a trivial fix - if we don&apos;t have a SolrIndexSearcher (which we don&apos;t when IndexWriter processes a DBQ) then completley bypass all the &quot;doCheck&quot; logic and fall through the the more classic TermEnum + DocIdSetBuilder iteration.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; - does this look correct to you?&lt;/p&gt;</comment>
                            <comment id="15363234" author="yseeley@gmail.com" created="Tue, 5 Jul 2016 20:58:11 +0000"  >&lt;p&gt;Yeah, looks good!&lt;/p&gt;</comment>
                            <comment id="15363297" author="jira-bot" created="Tue, 5 Jul 2016 21:36:00 +0000"  >&lt;p&gt;Commit 5abdcb8fa5d7263c45159eef42ec4f995d45728c in lucene-solr&apos;s branch refs/heads/branch_6x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5abdcb8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5abdcb8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9235&quot; title=&quot;NPE  when using non-numeric range query in deleteByQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9235&quot;&gt;&lt;del&gt;SOLR-9235&lt;/del&gt;&lt;/a&gt;: Fixed NPE when using non-numeric range query in deleteByQuery&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 54b3945572acc9fd155740d5e6f628bfb2b3848f)&lt;/p&gt;</comment>
                            <comment id="15363298" author="jira-bot" created="Tue, 5 Jul 2016 21:36:02 +0000"  >&lt;p&gt;Commit 54b3945572acc9fd155740d5e6f628bfb2b3848f in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54b3945&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54b3945&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9235&quot; title=&quot;NPE  when using non-numeric range query in deleteByQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9235&quot;&gt;&lt;del&gt;SOLR-9235&lt;/del&gt;&lt;/a&gt;: Fixed NPE when using non-numeric range query in deleteByQuery&lt;/p&gt;</comment>
                            <comment id="15363299" author="hossman" created="Tue, 5 Jul 2016 21:37:52 +0000"  >&lt;p&gt;thanks for reporting this anders!&lt;/p&gt;</comment>
                            <comment id="15439013" author="mikemccand" created="Fri, 26 Aug 2016 13:59:55 +0000"  >&lt;p&gt;Bulk close resolved issues after 6.2.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12863271">SOLR-8037</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12815843" name="SOLR-9235.patch" size="9513" author="hossman" created="Sat, 2 Jul 2016 01:15:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zt6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>