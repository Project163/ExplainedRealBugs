<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:11:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8420] Date statistics: sumOfSquares overflows long</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8420</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The values for Dates are large enough that squaring them overflows a &quot;long&quot; field. This should be converted to a double. &lt;/p&gt;

&lt;p&gt;StatsValuesFactory.java, line 755 DateStatsValues#updateTypeSpecificStats Add a cast to double &lt;/p&gt;

&lt;p&gt;sumOfSquares += ( (double)value * value * count);&lt;/p&gt;</description>
                <environment></environment>
        <key id="12922128">SOLR-8420</key>
            <summary>Date statistics: sumOfSquares overflows long</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tflobbe">Tomas Eduardo Fernandez Lobbe</assignee>
                                    <reporter username="tomsolr">Tom Hill</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Dec 2015 20:20:07 +0000</created>
                <updated>Mon, 9 May 2016 18:57:07 +0000</updated>
                            <resolved>Thu, 21 Apr 2016 22:31:19 +0000</resolved>
                                    <version>5.4</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SearchComponents - other</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15064346" author="tomsolr" created="Fri, 18 Dec 2015 18:00:03 +0000"  >&lt;p&gt;Fixes overflow in stddev, too.&lt;/p&gt;

&lt;p&gt;Not ready to commit. I still have to fix a rounding error in TestDistributed.&lt;/p&gt;</comment>
                            <comment id="15068793" author="tomsolr" created="Tue, 22 Dec 2015 22:01:44 +0000"  >&lt;p&gt;Just a quick demo of why TestDistributedSearch is failing, when running with the patch.&lt;/p&gt;

&lt;p&gt;When TestDistributedSearch#test is run with two partitions, it gets a slightly different value than when run on one partition. &lt;/p&gt;

&lt;p&gt;The two results are &lt;br/&gt;
100010100011010110010111011100111101011001010000011100001000110&lt;br/&gt;
100010100011010110010111011100111101011001010000011100001000101&lt;/p&gt;

&lt;p&gt;This matches the numbers seen in TestDistributedSearch.&lt;/p&gt;

&lt;p&gt;It looks like we need to add some delta into the compare for doubles in &lt;/p&gt;

&lt;p&gt;BaseDistributedSearchTestCase#public static String compare(Object a, Object b, int flags, Map&amp;lt;String, Integer&amp;gt; handle)&lt;/p&gt;</comment>
                            <comment id="15069489" author="cpoerschke" created="Wed, 23 Dec 2015 10:29:27 +0000"  >&lt;p&gt;sumOfSquares overflow, interesting. I wonder if &lt;tt&gt;DateStatsValues&lt;/tt&gt;&apos;s &lt;tt&gt;private long sum = 0;&lt;/tt&gt; might perhaps become &lt;tt&gt;double&lt;/tt&gt; also (similar to &lt;tt&gt;NumericStatsValues&lt;/tt&gt;&apos;s sum being a double already).&lt;/p&gt;</comment>
                            <comment id="15073165" author="tomsolr" created="Mon, 28 Dec 2015 21:28:32 +0000"  >&lt;p&gt;Certainly could be changed. Looks like it currently would overflow if you are looking at more than 6 million+ dates, which is a pretty small number today.&lt;/p&gt;

&lt;p&gt;Downside is small loss of precision for smaller datasets.&lt;/p&gt;

&lt;p&gt;I think it probably should be changed. I&apos;ll update the patch.&lt;/p&gt;
</comment>
                            <comment id="15107737" author="tomasflobbe" created="Wed, 20 Jan 2016 00:28:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;I wonder if DateStatsValues&apos;s private long sum = 0; might perhaps become double also (similar to NumericStatsValues&apos;s sum being a double already).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, I think it should. This should also change the output, currently it&apos;s a date like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;date name=&lt;span class=&quot;code-quote&quot;&gt;&quot;sum&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;122366-06-12T21:06:06Z&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15141720" author="tomasflobbe" created="Wed, 10 Feb 2016 21:38:20 +0000"  >&lt;p&gt;I created &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8671&quot; title=&quot;Date statistics: make &amp;quot;sum&amp;quot; a double instead of a long/date&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8671&quot;&gt;&lt;del&gt;SOLR-8671&lt;/del&gt;&lt;/a&gt; for this particular change&lt;/p&gt;</comment>
                            <comment id="15142019" author="tomasflobbe" created="Thu, 11 Feb 2016 00:24:20 +0000"  >&lt;p&gt;While looking at this patch I noticed that in the line 841 of &lt;tt&gt;TestDistributedSearch&lt;/tt&gt; it says:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;rsp = query(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;stats&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but was intended to be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;rsp = query(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;, q, &lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;stats&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should fix that as part of this Jira too.&lt;/p&gt;</comment>
                            <comment id="15159469" author="tomsolr" created="Tue, 23 Feb 2016 19:17:58 +0000"  >&lt;p&gt;This latest version of the path adds an allowance in tests for floating point errors in computations for specific stats. &lt;/p&gt;

&lt;p&gt;It also fixes the error in the test that Tomas noted.&lt;/p&gt;</comment>
                            <comment id="15160003" author="tomasflobbe" created="Wed, 24 Feb 2016 01:13:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomsolr&quot; class=&quot;user-hover&quot; rel=&quot;tomsolr&quot;&gt;tomsolr&lt;/a&gt;, patch looks good to me, will commit shortly&lt;/p&gt;</comment>
                            <comment id="15166625" author="tomasflobbe" created="Thu, 25 Feb 2016 02:52:51 +0000"  >&lt;p&gt;Minor change, FUZZY comparison passes in case of both numbers being NaN, made the accepted ratio a constant and added some javadocs to FUZZY flag&lt;/p&gt;</comment>
                            <comment id="15166636" author="jira-bot" created="Thu, 25 Feb 2016 03:04:50 +0000"  >&lt;p&gt;Commit 730d10f145378b164a93d63b82a02dcf7f2fdf14 in lucene-solr&apos;s branch refs/heads/master from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=730d10f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=730d10f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8420&quot; title=&quot;Date statistics: sumOfSquares overflows long&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8420&quot;&gt;&lt;del&gt;SOLR-8420&lt;/del&gt;&lt;/a&gt;: Fix long overflow in sumOfSquares for Date statistics&lt;/p&gt;

&lt;p&gt;Casted operations to double. Changed the test to support a percentage error given the FUZZY flag in doubles&lt;/p&gt;</comment>
                            <comment id="15252721" author="anshumg" created="Thu, 21 Apr 2016 21:01:00 +0000"  >&lt;p&gt;Reopening to back port for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252816" author="jira-bot" created="Thu, 21 Apr 2016 21:49:27 +0000"  >&lt;p&gt;Commit 2beccf469f9e07eb5a05fef9ec3f869d6da4008a in lucene-solr&apos;s branch refs/heads/branch_5x from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2beccf4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2beccf4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8420&quot; title=&quot;Date statistics: sumOfSquares overflows long&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8420&quot;&gt;&lt;del&gt;SOLR-8420&lt;/del&gt;&lt;/a&gt;: Fix long overflow in sumOfSquares for Date statistics&lt;/p&gt;

&lt;p&gt;Casted operations to double. Changed the test to support a percentage error given the FUZZY flag in doubles&lt;/p&gt;</comment>
                            <comment id="15252869" author="jira-bot" created="Thu, 21 Apr 2016 22:14:54 +0000"  >&lt;p&gt;Commit f9acafbd917b7970b29f12e0c637612d2cd216f7 in lucene-solr&apos;s branch refs/heads/branch_5_5 from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9acafb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f9acafb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8420&quot; title=&quot;Date statistics: sumOfSquares overflows long&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8420&quot;&gt;&lt;del&gt;SOLR-8420&lt;/del&gt;&lt;/a&gt;: Fix long overflow in sumOfSquares for Date statistics&lt;/p&gt;

&lt;p&gt;Casted operations to double. Changed the test to support a percentage error given the FUZZY flag in doubles&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12789275" name="0001-Fix-overflow-in-date-statistics.patch" size="7995" author="tomsolr" created="Tue, 23 Feb 2016 19:17:58 +0000"/>
                            <attachment id="12778530" name="0001-Fix-overflow-in-date-statistics.patch" size="3918" author="tomsolr" created="Fri, 18 Dec 2015 18:00:03 +0000"/>
                            <attachment id="12777818" name="0001-Fix-overflow-in-date-statistics.patch" size="3641" author="tomsolr" created="Tue, 15 Dec 2015 20:20:54 +0000"/>
                            <attachment id="12789853" name="SOLR-8420.patch" size="8263" author="tflobbe" created="Thu, 25 Feb 2016 02:52:51 +0000"/>
                            <attachment id="12779138" name="StdDev.java" size="1314" author="tomsolr" created="Tue, 22 Dec 2015 22:01:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pxqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>