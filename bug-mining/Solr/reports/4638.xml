<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:47:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15122] ClusterEventProducerTest.testEvents is unstable</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15122</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This test looks to be unstable according to Jenkins since about Nov 5. I just started seeing occasional failures locally when running the whole suite but cannot reproduce when running in isolation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://lists.apache.org/thread.html/rf0c16b257bc3236ea414be51451806352b55f15d4949f4fd54a3b71a%40%3Cbuilds.lucene.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/rf0c16b257bc3236ea414be51451806352b55f15d4949f4fd54a3b71a%40%3Cbuilds.lucene.apache.org%3E&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13355523">SOLR-15122</key>
            <summary>ClusterEventProducerTest.testEvents is unstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ab">Andrzej Bialecki</assignee>
                                    <reporter username="mdrob">Mike Drob</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Jan 2021 20:28:40 +0000</created>
                <updated>Thu, 12 May 2022 00:26:06 +0000</updated>
                            <resolved>Fri, 19 Mar 2021 15:15:52 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="12600">3.5h</timespent>
                                <comments>
                            <comment id="17275377" author="mdrob" created="Fri, 29 Jan 2021 21:47:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt; - looks like this has been flaky since is was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14749&quot; title=&quot;Provide a clean API for cluster-level event processing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14749&quot;&gt;&lt;del&gt;SOLR-14749&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17275380" author="jira-bot" created="Fri, 29 Jan 2021 21:49:58 +0000"  >&lt;p&gt;Commit 5cca4645177e68dcfd47641d7b7afa172137ee21 in lucene-solr&apos;s branch refs/heads/master from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5cca464&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5cca464&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15122&quot; title=&quot;ClusterEventProducerTest.testEvents is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15122&quot;&gt;&lt;del&gt;SOLR-15122&lt;/del&gt;&lt;/a&gt; Debug Logging&lt;/p&gt;</comment>
                            <comment id="17276255" author="ab" created="Mon, 1 Feb 2021 10:55:11 +0000"  >&lt;p&gt;Hmm. I suspect this is caused by the plugin config update being sent to ZK via different node than the Overseer, and then the node going down before the Overseer node synchronizes with ZK. I&apos;ll work on a fix.&lt;/p&gt;</comment>
                            <comment id="17277041" author="jira-bot" created="Tue, 2 Feb 2021 11:06:57 +0000"  >&lt;p&gt;Commit 4cb1000ea0a1f6c0d7be2486a709fc82dc94616b in lucene-solr&apos;s branch refs/heads/master from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4cb1000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4cb1000&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15122&quot; title=&quot;ClusterEventProducerTest.testEvents is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15122&quot;&gt;&lt;del&gt;SOLR-15122&lt;/del&gt;&lt;/a&gt;: Tentative fix for the test failure - the node in the test could go down&lt;br/&gt;
before the new plugin was active on the Overseer.&lt;/p&gt;</comment>
                            <comment id="17277044" author="ab" created="Tue, 2 Feb 2021 11:08:07 +0000"  >&lt;p&gt;I&apos;ll leave this open to see if the fix works.&lt;/p&gt;</comment>
                            <comment id="17277129" author="mdrob" created="Tue, 2 Feb 2021 13:46:43 +0000"  >&lt;p&gt;I had just gone through and replaced a bunch of busy wait loops with real conditional tools, it would be good to do the same here. Perhaps the test code can set a monitor and then if a monitor is not null, the event producer can notify on it whenever the version changes. &lt;/p&gt;</comment>
                            <comment id="17277353" author="mdrob" created="Tue, 2 Feb 2021 17:54:51 +0000"  >&lt;p&gt;I put up a PR to demonstrate what I meant, I think the same pattern should be applied to the DelegatingPlacementPlugin code, if this was based on that.&lt;/p&gt;

&lt;p&gt;I trust that the design here is correct for accomplishing what we need, but the implementation needed a few touch ups from what you did.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;We shouldn&apos;t use postfix increment with a volatile variable, as that is not an atomic operation.&lt;/li&gt;
	&lt;li&gt;Using wait/notify is going to be more efficient use of resources than a busy wait.&lt;/li&gt;
	&lt;li&gt;You weren&apos;t saving the new value of version on subsequent calls, so I updated that too.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please take a look and confirm that this still maintains the intent of what you were trying to do.&lt;/p&gt;</comment>
                            <comment id="17277360" author="murblanc" created="Tue, 2 Feb 2021 18:15:54 +0000"  >&lt;p&gt;&lt;cite&gt;We shouldn&apos;t use postfix increment with a volatile variable, as that is not an atomic operation&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;I wouldn&apos;t make this a blanket statement. One reason to use a volatile is to conform to the Java Memory Model and not require synchronization for access from different threads. In some cases atomocity is not needed.&lt;/p&gt;

&lt;p&gt;Also, using an AtomicInteger and using it only from within a synchronized section seems a bit overkill. Any Integer would do (or even an integer if the mutex block is using another object).&lt;/p&gt;</comment>
                            <comment id="17277399" author="mdrob" created="Tue, 2 Feb 2021 18:56:08 +0000"  >&lt;p&gt;I&apos;m pretty comfortable with that blanket statement. If you&apos;re using volatile, that means you expect multiple threads accessing, and if you have multiple threads writing then you shouldn&apos;t be using non-atomic postfix increment. If you can guarantee that you only have one writer, and the volatile is for the readers, then... maybe it&apos;s ok? It&apos;s still trappy and can lead to issues down the line.&lt;/p&gt;

&lt;p&gt;I used AtomicInteger because we don&apos;t have a mutable Integer and needed an object anyway for the sync block. I can rewrite that with an Object and an int if you prefer.&lt;/p&gt;</comment>
                            <comment id="17277406" author="murblanc" created="Tue, 2 Feb 2021 19:11:39 +0000"  >&lt;p&gt;You&apos;re right about no mutable Integer.&lt;/p&gt;

&lt;p&gt;Would there be a way for the test code to pass a synchronization object (a latch? that would be null for non test code) that prod code would use so that we don&apos;t end up with large methods in production classes that are only used for tests?&lt;/p&gt;</comment>
                            <comment id="17277423" author="mdrob" created="Tue, 2 Feb 2021 19:40:58 +0000"  >&lt;p&gt;Refactored the code in anticipation of working over DelegatingPlacementPluginFactory as well, moved the wait logic to test sources with an int and an Object instead of Atomic Integer. Please take a look before I consolidate the other implementation&lt;/p&gt;</comment>
                            <comment id="17277448" author="murblanc" created="Tue, 2 Feb 2021 20:54:36 +0000"  >&lt;p&gt;Added a few comments. I like this approach much better. Thanks.&lt;/p&gt;</comment>
                            <comment id="17277519" author="mdrob" created="Tue, 2 Feb 2021 23:09:10 +0000"  >&lt;p&gt;I was thinking about this some more, and think we should use a Phaser instead of rolling our own concurrency implementation. Thoughts?&lt;/p&gt;</comment>
                            <comment id="17277529" author="murblanc" created="Tue, 2 Feb 2021 23:26:36 +0000"  >&lt;p&gt;I&apos;ve never used this specific class but if you make it so that it&apos;s hidden behind the &lt;tt&gt;StateChangeListener&lt;/tt&gt; interface (i.e. it is a test writer implementation choice) then I&apos;m perfectly fine with it.&lt;/p&gt;

&lt;p&gt;I&apos;d be much more hesitant to expose a specific concurrency class in the interface though.&lt;/p&gt;</comment>
                            <comment id="17278333" author="mdrob" created="Wed, 3 Feb 2021 20:03:49 +0000"  >&lt;p&gt;If we&apos;re not building our own concurrency logic, then I think it&apos;s fine to expose directly on the delegate classes. I&apos;ll add docs about the expected usage.&lt;/p&gt;</comment>
                            <comment id="17278462" author="jira-bot" created="Thu, 4 Feb 2021 01:39:27 +0000"  >&lt;p&gt;Commit 8fccdfe3530cd556270af08e1b51f13f8a1d8eb2 in lucene-solr&apos;s branch refs/heads/master from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8fccdfe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8fccdfe&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15122&quot; title=&quot;ClusterEventProducerTest.testEvents is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15122&quot;&gt;&lt;del&gt;SOLR-15122&lt;/del&gt;&lt;/a&gt; Replace sleeps with phaser await (#2291)&lt;/p&gt;
</comment>
                            <comment id="17278465" author="mdrob" created="Thu, 4 Feb 2021 01:42:08 +0000"  >&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt; for identifying where he suspected the issue was, and to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ilan&quot; class=&quot;user-hover&quot; rel=&quot;ilan&quot;&gt;ilan&lt;/a&gt; for the thorough reviews. I&apos;ll follow AB&apos;s model here and continue to leave this open for another few days until we can confirm the fix.&lt;/p&gt;</comment>
                            <comment id="17298116" author="ab" created="Tue, 9 Mar 2021 15:29:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; I think we can close this, the changes that you implemented seem to be working well.&lt;/p&gt;</comment>
                            <comment id="17535226" author="janhoy" created="Thu, 12 May 2022 00:26:06 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13322515">SOLR-14749</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0n5aw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>