<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:25:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11011] Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11011</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Here are the case&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;shard1 : {
    node1 : shard1_replica1,
    node2 : shard1_replica2
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;node2 go down, autoAddReplicasPlanAction is executed&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;shard1 : {
    node1 : shard1_replica1,
    node3 : shard1_replica3
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;node2 back alive, because shard1_replica2 is removed from &lt;tt&gt;states.json&lt;/tt&gt; so that core won&apos;t be loaded ( but it won&apos;t be removed neither ). Then node1 go down, Assign.buildCoreName will create a core with name=shard1_replica2 which lead to a failure.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13084869">SOLR-11011</key>
            <summary>Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="caomanhdat">Cao Manh Dat</assignee>
                                    <reporter username="caomanhdat">Cao Manh Dat</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jul 2017 15:20:48 +0000</created>
                <updated>Wed, 2 Oct 2019 17:24:10 +0000</updated>
                            <resolved>Mon, 18 Sep 2017 23:06:10 +0000</resolved>
                                                    <fixVersion>7.1</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16075033" author="varunthacker" created="Wed, 5 Jul 2017 16:22:55 +0000"  >&lt;p&gt;Nice catch!&lt;/p&gt;</comment>
                            <comment id="16075934" author="shalinmangar" created="Thu, 6 Jul 2017 05:02:01 +0000"  >&lt;p&gt;Nice Dat! Although this was caught while testing &lt;tt&gt;autoAddReplicasPlanAction&lt;/tt&gt; for autoscaling, it can happen today in the wild if a user uses the DELETEREPLICA or MOVEREPLICA or REPLACENODE API to delete replicas and then a new replica is created on the same node with the same core name.&lt;/p&gt;</comment>
                            <comment id="16080033" author="caomanhdat" created="Mon, 10 Jul 2017 08:47:44 +0000"  >&lt;p&gt;A patch for this ticket.&lt;/p&gt;</comment>
                            <comment id="16090968" author="caomanhdat" created="Tue, 18 Jul 2017 01:53:38 +0000"  >&lt;p&gt;A patch for this ticket, use a global counter for generating unique ids.&lt;/p&gt;</comment>
                            <comment id="16091013" author="shalinmangar" created="Tue, 18 Jul 2017 02:29:30 +0000"  >&lt;p&gt;Thanks Dat.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Can you move the &lt;tt&gt;incAndGetId&lt;/tt&gt; method to Assign. That&apos;s the only place which needs this method and ZkController is a kitchen-sink already so let&apos;s not add another one there.&lt;/li&gt;
	&lt;li&gt;Instead of adding new &lt;tt&gt;intToBytes&lt;/tt&gt; and &lt;tt&gt;bytesToInt&lt;/tt&gt; methods, why don&apos;t you store the number as a string and use Integer.parseInt?&lt;/li&gt;
	&lt;li&gt;The warning logged on BadVersionException should be a debug. We don&apos;t want to scare people unnecessarily if there was a conflict.&lt;/li&gt;
	&lt;li&gt;There&apos;s no need to catch InterruptedException, let it propagate up as it is.&lt;/li&gt;
	&lt;li&gt;The changes in &lt;tt&gt;addReplicaTest&lt;/tt&gt; of &lt;tt&gt;CollectionsAPIDistributedZkTest&lt;/tt&gt; do not seem to be related to this issue? Same for the changes in CollectionsAPISolrJTest.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16091426" author="caomanhdat" created="Tue, 18 Jul 2017 11:22:18 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
1. Sure, if we want to use this implementation in the future we can easily move it to ZkController&lt;br/&gt;
2. I think the implementation for &lt;tt&gt;intToBytes&lt;/tt&gt; and &lt;tt&gt;bytesToInt&lt;/tt&gt; is trivial, even we store the number as a string, we still have to convert the string to bytes, I kinda like current approach.&lt;br/&gt;
3. Sure, I will do that.&lt;br/&gt;
4. If we throw &lt;tt&gt;InterruptedException&lt;/tt&gt;, so we have to throw &lt;tt&gt;InterruptedException&lt;/tt&gt; in Assign methods too which are propagated to several other methods. &lt;br/&gt;
5. The changes are necessary because whenever we call Assign methods, we will increase the counter ( then the newReplicaName does not match with precomputed one ). So I solved the problem by grab replica name from the response.&lt;/p&gt;</comment>
                            <comment id="16094139" author="caomanhdat" created="Thu, 20 Jul 2017 03:45:52 +0000"  >&lt;p&gt;Update patch, make path &quot;/collections/coll&quot; if it is not exist.&lt;/p&gt;</comment>
                            <comment id="16094170" author="jira-bot" created="Thu, 20 Jul 2017 04:50:07 +0000"  >&lt;p&gt;Commit 227eeefcd09fd5e6d33e8073768b2dd17f310536 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=227eeef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=227eeef&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11011&quot; title=&quot;Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11011&quot;&gt;&lt;del&gt;SOLR-11011&lt;/del&gt;&lt;/a&gt;: Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false&lt;/p&gt;</comment>
                            <comment id="16094171" author="jira-bot" created="Thu, 20 Jul 2017 04:51:10 +0000"  >&lt;p&gt;Commit 17779485e75f3f390d7b852ceea12b8748f2012e in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1777948&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1777948&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11011&quot; title=&quot;Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11011&quot;&gt;&lt;del&gt;SOLR-11011&lt;/del&gt;&lt;/a&gt;: Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false&lt;/p&gt;</comment>
                            <comment id="16097164" author="caomanhdat" created="Sat, 22 Jul 2017 08:02:04 +0000"  >&lt;p&gt;A patch for fixing some problems with precommit :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fix backward compatibility problem&lt;/li&gt;
	&lt;li&gt;audit the usage of &lt;tt&gt;Assign.buildCoreName(String collectionName, String shard, Replica.Type type, int replicaNum)&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; Can you take a look?&lt;/p&gt;</comment>
                            <comment id="16097908" author="caomanhdat" created="Mon, 24 Jul 2017 03:44:28 +0000"  >&lt;p&gt;Add test for backward compatibility problem.&lt;/p&gt;</comment>
                            <comment id="16099678" author="jira-bot" created="Tue, 25 Jul 2017 08:04:25 +0000"  >&lt;p&gt;Commit f087c5acae1b1a62b75f4d0caac660088f03ed35 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f087c5a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f087c5a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11011&quot; title=&quot;Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11011&quot;&gt;&lt;del&gt;SOLR-11011&lt;/del&gt;&lt;/a&gt;: Fix backward compatibility problem + audit the usage of old Assign.buildCoreName(String collectionName, String shard, Replica.Type type, int replicaNum)&lt;/p&gt;</comment>
                            <comment id="16099680" author="jira-bot" created="Tue, 25 Jul 2017 08:05:12 +0000"  >&lt;p&gt;Commit 43c92378475905d9fd63f30103f3a2a2c4514f22 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=43c9237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=43c9237&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11011&quot; title=&quot;Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11011&quot;&gt;&lt;del&gt;SOLR-11011&lt;/del&gt;&lt;/a&gt;: Fix backward compatibility problem + audit the usage of old Assign.buildCoreName(String collectionName, String shard, Replica.Type type, int replicaNum)&lt;/p&gt;</comment>
                            <comment id="16111071" author="caomanhdat" created="Wed, 2 Aug 2017 15:03:15 +0000"  >&lt;p&gt;A patch that fix the &lt;tt&gt;AssignTest.testIdIsUnique()&lt;/tt&gt; failure&lt;/p&gt;</comment>
                            <comment id="16112074" author="jira-bot" created="Thu, 3 Aug 2017 02:16:21 +0000"  >&lt;p&gt;Commit f80f1c0962014e086c932685e2cfc46a5cf0371d in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f80f1c0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f80f1c0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11011&quot; title=&quot;Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11011&quot;&gt;&lt;del&gt;SOLR-11011&lt;/del&gt;&lt;/a&gt;: Fix AssignTest.testIdIsUnique() failure&lt;/p&gt;</comment>
                            <comment id="16112076" author="jira-bot" created="Thu, 3 Aug 2017 02:17:07 +0000"  >&lt;p&gt;Commit b4d91fa238c40e942e85fee25dc7a91794bfbf54 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4d91fa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4d91fa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11011&quot; title=&quot;Assign.buildCoreName can lead to error in creating a new core when legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11011&quot;&gt;&lt;del&gt;SOLR-11011&lt;/del&gt;&lt;/a&gt;: Fix AssignTest.testIdIsUnique() failure&lt;/p&gt;</comment>
                            <comment id="16170595" author="shalinmangar" created="Mon, 18 Sep 2017 20:06:42 +0000"  >&lt;p&gt;Can this be closed now?&lt;/p&gt;</comment>
                            <comment id="16207326" author="shalinmangar" created="Tue, 17 Oct 2017 11:03:31 +0000"  >&lt;p&gt;Bulk close after 7.1.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13060699">SOLR-10397</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12878568" name="SOLR-11011.2.patch" size="29574" author="caomanhdat" created="Mon, 24 Jul 2017 03:44:15 +0000"/>
                            <attachment id="12878461" name="SOLR-11011.2.patch" size="25751" author="caomanhdat" created="Sat, 22 Jul 2017 08:00:37 +0000"/>
                            <attachment id="12880054" name="SOLR-11011.3.patch" size="6840" author="caomanhdat" created="Wed, 2 Aug 2017 15:02:19 +0000"/>
                            <attachment id="12878089" name="SOLR-11011.patch" size="24370" author="caomanhdat" created="Thu, 20 Jul 2017 03:44:55 +0000"/>
                            <attachment id="12878084" name="SOLR-11011.patch" size="23452" author="caomanhdat" created="Thu, 20 Jul 2017 02:05:08 +0000"/>
                            <attachment id="12877718" name="SOLR-11011.patch" size="24209" author="caomanhdat" created="Tue, 18 Jul 2017 01:53:00 +0000"/>
                            <attachment id="12876386" name="SOLR-11011.patch" size="9563" author="caomanhdat" created="Mon, 10 Jul 2017 08:47:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3h4wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>