<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:53:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6180] Callers of ManagedIndexSchema mutators should hold the schemaUpdateLock</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6180</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Consider the code in FieldResource.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SchemaField newField = oldSchema.newField(fieldName, fieldType, map);
IndexSchema newSchema = oldSchema.addField(newField, copyFieldNames);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != newSchema) {
  getSolrCore().setLatestSchema(newSchema);
  success = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException(ErrorCode.SERVER_ERROR, &lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to add field.&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The schema update lock is only held during the call to addField, so there is no guarantee that the schema we are setting later is actually the latest schema.  This would rarely happen, but it&apos;s possible that between the time we gave up the lock and the time we set the schema that we got a new schema from ZK.  We&apos;d end up overwriting the new schema, possibly missing newly added fields.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12722388">SOLR-6180</key>
            <summary>Callers of ManagedIndexSchema mutators should hold the schemaUpdateLock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="gchanan">Gregory Chanan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Jun 2014 00:50:59 +0000</created>
                <updated>Mon, 9 May 2016 18:43:11 +0000</updated>
                            <resolved>Tue, 8 Jul 2014 03:48:40 +0000</resolved>
                                                    <fixVersion>4.10</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14036759" author="gchanan" created="Thu, 19 Jun 2014 00:54:00 +0000"  >&lt;p&gt;Here&apos;s a modified version of TestCloudManagedSchemaConcurrent that tests for the issue.  To trigger the issue, I put a sleep between the end of the call to addField and the call to setLatestSchema &amp;#8211; I doubt it will trigger often without that and so the test itself should just be considered a demonstration not worth committing.&lt;/p&gt;</comment>
                            <comment id="14036761" author="gchanan" created="Thu, 19 Jun 2014 00:56:31 +0000"  >&lt;p&gt;Here&apos;s a patch that exposes getSchemaUpdateLock at the IndexSchema level, and moves synchronizing on the lock from ManagedIndexSchema itself to the callers (this is consistent with how ZkIndexSchemaReader works).&lt;/p&gt;</comment>
                            <comment id="14039585" author="markrmiller@gmail.com" created="Sat, 21 Jun 2014 00:14:30 +0000"  >&lt;p&gt;+1, nice catch! Doesn&apos;t seem like a bad idea to add the test to me. Even without that 10ms sleep (which we could perhaps randomly do?), I wouldn&apos;t be surprised if this doesn&apos;t fail sometimes on the jenkins cluster, which is hammering these tests over and over as fast as it can in a variety of slow envs.&lt;/p&gt;</comment>
                            <comment id="14039589" author="gchanan" created="Sat, 21 Jun 2014 00:20:18 +0000"  >&lt;p&gt;thanks for taking a look, Mark.&lt;/p&gt;

&lt;p&gt;FWIW the sleep I put in (&quot;between the end of the call to addField and the call to setLatestSchema&quot;), was random between 1 and 10 seconds.  I didn&apos;t investigate shorter sleeps to see if it might trigger randomly.&lt;/p&gt;</comment>
                            <comment id="14054460" author="steve_rowe" created="Tue, 8 Jul 2014 03:19:24 +0000"  >&lt;p&gt;Looks good.&lt;/p&gt;

&lt;p&gt;The attached patch combines the schema lock test with Gregory&apos;s other patch.  When I ran the new test without the other patch I got a roughly 50% failure rate when I put a 50ms sleep between &lt;tt&gt;addField()&lt;/tt&gt; and &lt;tt&gt;SolrCore.setLatestSchema()&lt;/tt&gt; in &lt;tt&gt;FieldResource.put()&lt;/tt&gt;, and 100% at 125ms.&lt;/p&gt;

&lt;p&gt;Committing shortly.&lt;/p&gt;</comment>
                            <comment id="14054462" author="jira-bot" created="Tue, 8 Jul 2014 03:20:56 +0000"  >&lt;p&gt;Commit 1608646 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1608646&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1608646&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6180&quot; title=&quot;Callers of ManagedIndexSchema mutators should hold the schemaUpdateLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6180&quot;&gt;&lt;del&gt;SOLR-6180&lt;/del&gt;&lt;/a&gt;: Callers of ManagedIndexSchema mutators should hold the schemaUpdateLock.&lt;/p&gt;</comment>
                            <comment id="14054475" author="jira-bot" created="Tue, 8 Jul 2014 03:34:01 +0000"  >&lt;p&gt;Commit 1608650 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1608650&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1608650&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6180&quot; title=&quot;Callers of ManagedIndexSchema mutators should hold the schemaUpdateLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6180&quot;&gt;&lt;del&gt;SOLR-6180&lt;/del&gt;&lt;/a&gt;: Callers of ManagedIndexSchema mutators should hold the schemaUpdateLock. (merged trunk r1608646)&lt;/p&gt;</comment>
                            <comment id="14054489" author="steve_rowe" created="Tue, 8 Jul 2014 03:48:40 +0000"  >&lt;p&gt;Committed to trunk and branch_4x.&lt;/p&gt;

&lt;p&gt;Thanks Gregory!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12654452" name="SOLR-6180.patch" size="21421" author="sarowe" created="Tue, 8 Jul 2014 03:19:24 +0000"/>
                            <attachment id="12651331" name="SOLR-6180.patch" size="15173" author="gchanan" created="Thu, 19 Jun 2014 00:56:31 +0000"/>
                            <attachment id="12651330" name="SchemaLockTest.java" size="11130" author="gchanan" created="Thu, 19 Jun 2014 00:54:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400579</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wyen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400673</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>