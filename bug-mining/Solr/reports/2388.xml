<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7203] NoHttpResponseException handling in HttpSolrClient is wrong</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7203</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We&apos;ve got logic in HttpSolrClient to catch NoHttpResponseException and retry.  However, this logic appears to be in the wrong place - it&apos;s in the createMethod function, which doesn&apos;t actually execute any http requests at all.  It ought to be in executeMethod.&lt;/p&gt;

&lt;p&gt;Fixing this might help sort out the persistent Jenkins failures as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12780079">SOLR-7203</key>
            <summary>NoHttpResponseException handling in HttpSolrClient is wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="romseygeek">Alan Woodward</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Mar 2015 14:18:03 +0000</created>
                <updated>Wed, 15 Apr 2015 00:30:24 +0000</updated>
                            <resolved>Thu, 26 Mar 2015 10:55:14 +0000</resolved>
                                                    <fixVersion>5.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14350380" author="romseygeek" created="Fri, 6 Mar 2015 14:33:30 +0000"  >&lt;p&gt;Quick n dirty patch moving the retry logic.  Would be good to get some more eyes on this though.&lt;/p&gt;</comment>
                            <comment id="14350607" author="markrmiller@gmail.com" created="Fri, 6 Mar 2015 17:34:40 +0000"  >&lt;p&gt;We have to be careful here - we can&apos;t auto retry on NoHttpResponseException with updates - it means you don&apos;t know if the update was accepted or not.&lt;/p&gt;</comment>
                            <comment id="14351785" author="romseygeek" created="Sat, 7 Mar 2015 20:35:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;we can&apos;t auto retry on NoHttpResponseException with updates&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was thinking about this - I&apos;m not sure this is actually true.  Updates in Solr are idempotent, aren&apos;t they?  If you add a document twice, then the second addition just overwrites the first.  And if you delete a document twice, then the second deletion just has no effect.  So automatically retrying is actually fine.&lt;/p&gt;</comment>
                            <comment id="14351805" author="romseygeek" created="Sat, 7 Mar 2015 21:16:19 +0000"  >&lt;p&gt;Better patch, with a test.  I&apos;ve refactored executeMethod into two parts, executeMethod and parseResponse, mainly to make testing easier.&lt;/p&gt;

&lt;p&gt;I&apos;ve noticed some other problems here, like the fact that we&apos;re wrapping IOExceptions in SolrServerExceptions, which sort of defeats the point of the SolrClient.request() contract, but that can be dealt with separately, I think.&lt;/p&gt;</comment>
                            <comment id="14351841" author="grishick" created="Sat, 7 Mar 2015 23:58:23 +0000"  >&lt;p&gt;This is practically a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6724&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-6724&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14351842" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 00:06:27 +0000"  >&lt;p&gt;No there will be races and chaos monkey test runs will fail. At most it can be an option that defaults to false. &lt;/p&gt;</comment>
                            <comment id="14351979" author="romseygeek" created="Sun, 8 Mar 2015 09:12:43 +0000"  >&lt;p&gt;maxRetries is set to 0 by default, so it does default to false (at the moment).  I&apos;m still not clear on where the races are though - can you give an example of a failure that this could cause?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=grishick&quot; class=&quot;user-hover&quot; rel=&quot;grishick&quot;&gt;grishick&lt;/a&gt; hah, synchronicity!  I&apos;ll merge your patch into this one, thanks.&lt;/p&gt;</comment>
                            <comment id="14352022" author="romseygeek" created="Sun, 8 Mar 2015 12:19:12 +0000"  >&lt;p&gt;OK, I&apos;ve had a closer look at the partition tests that are failing, and they already try and handle these errors with custom retry logic.  Which suggests that the HttpClient persists in using dead connections even for retries.&lt;/p&gt;

&lt;p&gt;What I think we need to do is to call ClientConnectionManager.closeExpiredConnections() when we hit a NoHttpResponseException.  That way the retry should be guaranteed not to use a dead connection.&lt;/p&gt;</comment>
                            <comment id="14352165" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 17:59:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;can you give an example of a failure that this could cause?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You can&apos;t have requests retrying in the background between nodes, into nodes, whatever when there is more than one client, unless you can guarantee the behavior of the clients. That&apos;s why this must be on the user.&lt;/p&gt;

&lt;p&gt;And even if we default to it false and allow one to turn it on, it must come with the warning that the user must guarantee this or else risk inconsistency and data loss.&lt;/p&gt;</comment>
                            <comment id="14352166" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 18:00:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;and they already try and handle these errors with custom retry logic&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, in the user code! Where it needs to be.&lt;/p&gt;</comment>
                            <comment id="14352167" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 18:01:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;(at the moment). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d have to -1 anything else since it breaks the system &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14352228" author="romseygeek" created="Sun, 8 Mar 2015 20:14:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;d have to -1 anything else since it breaks the system &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fussy, fussy.&lt;/p&gt;

&lt;p&gt;The patch as it stands just moves the retry logic to the right place, and leaves the default number of retries as 0.  I think that should be OK to go in?&lt;/p&gt;</comment>
                            <comment id="14352240" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 20:38:45 +0000"  >&lt;p&gt;I&apos;m just not okay with introducing data loss &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; It&apos;s kind of a big deal in the hardening of SolrCloud. If that is fussy, sue me. Especially when it&apos;s an issue that has already been fixed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think that should be OK to go in?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it&apos;s fine to have as an option that defaults to false - for many users, a simple retry is the option they will pick -  but I&apos;m going to add javadoc to it that explains using it is not safe unless you can gaurantee your clients won&apos;t fight each other.&lt;/p&gt;

&lt;p&gt;Leaving it off by default will also ensure inter node communication doesn&apos;t use it, which is important to avoid replica inconsistency (which is the same as data loss).&lt;/p&gt;</comment>
                            <comment id="14352241" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 20:40:16 +0000"  >&lt;p&gt;Also, as I said, if the default was not off, random legit chaos monkey tests will fail - also a no no.&lt;/p&gt;</comment>
                            <comment id="14352244" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 20:46:34 +0000"  >&lt;p&gt;To define what I mean by data loss:&lt;/p&gt;

&lt;p&gt;This means that data you added to the system and got an ack for goes away. It means we can lie to the user and they can&apos;t trust important data to our system. The only way that should happen is if a user says it&apos;s okay or if there is a bug.&lt;/p&gt;</comment>
                            <comment id="14352247" author="romseygeek" created="Sun, 8 Mar 2015 20:51:25 +0000"  >&lt;p&gt;Sorry, British sense of humour not coming across in text there.  I agree with everything you&apos;ve said.&lt;/p&gt;</comment>
                            <comment id="14352259" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 21:05:43 +0000"  >&lt;p&gt;I took it as, mention -1, dont be a dick &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Not a lot of text there to go on.&lt;/p&gt;

&lt;p&gt;In either case, I meant it as, &quot;i&apos;m really positive this is a problem!&quot;&lt;/p&gt;</comment>
                            <comment id="14352332" author="markrmiller@gmail.com" created="Sun, 8 Mar 2015 23:11:32 +0000"  >&lt;p&gt;Since we seem to have gotten past that, moving on:&lt;/p&gt;

&lt;p&gt;In some cases, if we can properly detect certain things, we do want an auto retry. On read only operations, this makes complete sense. I also think, if its an update or a delete and optimistic locking is being used, that may be okay too. The part with holes is when a new doc comes in, some other client doing periodic updates to docs that match a certain criteria updates it, and then retry number 3 hits and undoes the update that was acked against a doc that was already part of the system according to client 2. If you do that type of auto retry on internode communication, it may also vary replica to replica which update survives - and once a replica gets out of sync, unless you have a very simple add only system, fixing the issue without data loss is almost impossible in all cases.&lt;/p&gt;

&lt;p&gt;Finally, overall, we probably want the retry behavior centered in one spot - the retryhandler used by the HttpClient. Having retry logic there and at a higher level gets confusing.&lt;/p&gt;</comment>
                            <comment id="14353469" author="romseygeek" created="Mon, 9 Mar 2015 19:44:38 +0000"  >&lt;p&gt;Maybe the best way forward here then is to just remove the broken code, and deprecate setMaxRetries() on HttpSolrClient (seeing as it doesn&apos;t do anything now anyway)?&lt;/p&gt;</comment>
                            <comment id="14353494" author="grishick" created="Mon, 9 Mar 2015 20:03:45 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14353613" author="elyograg" created="Mon, 9 Mar 2015 21:12:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;and deprecate setMaxRetries() on HttpSolrClient (seeing as it doesn&apos;t do anything now anyway)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I admit that my grasp of the code may not be very good, but in both branch_5x and trunk, maxRetries does seem to be used to control a while loop that contains the http request.  When I read this, it looks to me like setMaxRetries &lt;b&gt;does&lt;/b&gt; do something, so what am I missing?&lt;/p&gt;</comment>
                            <comment id="14353663" author="romseygeek" created="Mon, 9 Mar 2015 21:35:27 +0000"  >&lt;p&gt;Patch removing the dead code and deprecating setMaxRetries().&lt;/p&gt;

&lt;p&gt;Shawn: the retry logic is wrapping code that creates an Http method, but it doesn&apos;t actually execute it.  So it&apos;s essentially a no-op.&lt;/p&gt;</comment>
                            <comment id="14353667" author="grishick" created="Mon, 9 Mar 2015 21:36:32 +0000"  >&lt;p&gt;Shawn, if you look closely at what is happening in the while loop, you will see that the request object is being created in it, but is not actually being sent. The request is being sent in HttpSolrClient::executeMethod and maxRetries is being used in createMethod. FWIF, there isn&apos;t anything in that while look that can throw NoHttpResponseException &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14353742" author="elyograg" created="Mon, 9 Mar 2015 22:10:24 +0000"  >&lt;p&gt;Thanks for the explanation.  I did not grok it fully, because I&apos;m only familiar with HttpClient on a very shallow basis.  I should remedy that, but there&apos;s never enough time to learn everything.&lt;/p&gt;</comment>
                            <comment id="14381682" author="jira-bot" created="Thu, 26 Mar 2015 10:42:24 +0000"  >&lt;p&gt;Commit 1669313 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1669313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1669313&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7203&quot; title=&quot;NoHttpResponseException handling in HttpSolrClient is wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7203&quot;&gt;&lt;del&gt;SOLR-7203&lt;/del&gt;&lt;/a&gt;: Remove buggy no-op retries in HttpSolrClient&lt;/p&gt;</comment>
                            <comment id="14381697" author="jira-bot" created="Thu, 26 Mar 2015 10:54:34 +0000"  >&lt;p&gt;Commit 1669316 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1669316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1669316&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7203&quot; title=&quot;NoHttpResponseException handling in HttpSolrClient is wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7203&quot;&gt;&lt;del&gt;SOLR-7203&lt;/del&gt;&lt;/a&gt;: Remove buggy no-op retries in HttpSolrClient&lt;/p&gt;</comment>
                            <comment id="14495282" author="thelabdude" created="Wed, 15 Apr 2015 00:30:24 +0000"  >&lt;p&gt;Bulk close after 5.1 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12754287">SOLR-6724</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12703502" name="SOLR-7203.patch" size="13939" author="romseygeek" created="Mon, 9 Mar 2015 21:35:27 +0000"/>
                            <attachment id="12703259" name="SOLR-7203.patch" size="20634" author="romseygeek" created="Sat, 7 Mar 2015 21:16:19 +0000"/>
                            <attachment id="12703061" name="SOLR-7203.patch" size="13473" author="romseygeek" created="Fri, 6 Mar 2015 14:33:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26g8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>