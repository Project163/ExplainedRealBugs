<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:00:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6496] LBHttpSolrClient should stop server retries after the timeAllowed threshold is met</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6496</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The LBHttpSolrServer will continue to perform retries for each server it was given without honoring the timeAllowed request parameter. Once the threshold has been met, you should no longer perform retries and allow the exception to bubble up and allow the request to either error out or return partial results per the shards.tolerant request parameter.&lt;/p&gt;

&lt;p&gt;For a little more context on how this is can be extremely problematic please see the comment here: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5986?focusedCommentId=14100991&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14100991&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-5986?focusedCommentId=14100991&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14100991&lt;/a&gt; (#2)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12740256">SOLR-6496</key>
            <summary>LBHttpSolrClient should stop server retries after the timeAllowed threshold is met</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshum">Anshum Gupta</assignee>
                                    <reporter username="sdavids">Steve Davids</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Sep 2014 22:57:16 +0000</created>
                <updated>Mon, 9 May 2016 18:49:55 +0000</updated>
                            <resolved>Mon, 12 Jan 2015 23:56:06 +0000</resolved>
                                    <version>4.9</version>
                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14127750" author="sdavids" created="Tue, 9 Sep 2014 23:08:04 +0000"  >&lt;p&gt;Initial patch that honors the timeAllowed request parameter. There aren&apos;t any tests included &amp;#8211; is there any objections to perhaps using a mocking library, it sure would make it much easier to perform unit testing on these negative cases. Mockito is my personal preference and is currently being used in Morphlines, but it will need to be included in the SolrJ test dependencies.&lt;/p&gt;</comment>
                            <comment id="14127870" author="sdavids" created="Wed, 10 Sep 2014 00:48:00 +0000"  >&lt;p&gt;Fixed patch for null safe SolrParams check.&lt;/p&gt;</comment>
                            <comment id="14128168" author="anshumg" created="Wed, 10 Sep 2014 07:17:33 +0000"  >&lt;p&gt;Thanks for creating this JIRA and providing a patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sdavids&quot; class=&quot;user-hover&quot; rel=&quot;sdavids&quot;&gt;sdavids&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here are a few changes that I&apos;d recommend:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Use System.nanoTime() for calculating elapsed time. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5734&quot; title=&quot;We should use System.nanoTime rather than System.currentTimeMillis when calculating elapsed time. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5734&quot;&gt;&lt;del&gt;SOLR-5734&lt;/del&gt;&lt;/a&gt; was recently an attempt at standardizing the same.&lt;/li&gt;
	&lt;li&gt;Tests are always helpful for confirming that the change works as expected &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I&apos;m personally against mocking unless there&apos;s no other way out as it generally has led to code that is difficult to understand for newer developers when they want to change something.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14142325" author="sdavids" created="Sun, 21 Sep 2014 04:14:28 +0000"  >&lt;p&gt;Updated patch to use nano time. Still thinking of some potential tricks to &lt;b&gt;not&lt;/b&gt; use mocks, are there any tests out there that may screw with the jetty server to make the socket connection arbitrarily long then somehow throw an exception and verify that the next request isn&apos;t made?&lt;/p&gt;

&lt;p&gt;On the mocking front I would do something like (note: redundant static Mockito.* accessors only showed for demonstrative purposes):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testNoRetryOnTimeout() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    LBHttpSolrServer testServer = Mockito.spy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LBHttpSolrServer(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//test1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;http://test2&quot;&lt;/span&gt;));
&lt;/span&gt;    Mockito.doAnswer(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Answer&amp;lt;Exception&amp;gt;() {
      @Override
      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Exception answer(InvocationOnMock invocation) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrServerException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Mock error.&quot;&lt;/span&gt;);
      }}).when(testServer).doRequest(Mockito.any(HttpSolrServer.class), Mockito.any(Req.class), Mockito.any(Rsp.class), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyString());
    testServer.query(SolrTestCaseJ4.params(CommonParams.Q, &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, CommonParams.TIME_ALLOWED, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;));
    Mockito.verify(testServer, Mockito.times(1)).doRequest(Mockito.any(HttpSolrServer.class), Mockito.any(Req.class), Mockito.any(Rsp.class), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyString());
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This test actually showed some strange behavior that there are multiple implemented methods trying to do the same thing. See LBHttpSolrServer&apos;s:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;public Rsp request(Req req) throws SolrServerException, IOException&lt;/li&gt;
	&lt;li&gt;public NamedList&amp;lt;Object&amp;gt; request(final SolrRequest request) throws SolrServerException, IOException&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So, depending on if you are using the CloudSolrServer or the HttpShardHandlerFactory you are going to get different request behavior. We should probably try to refactor this code to provide consistent behavior perhaps in a different ticket. &lt;/p&gt;</comment>
                            <comment id="14142332" author="shalinmangar" created="Sun, 21 Sep 2014 04:45:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;are there any tests out there that may screw with the jetty server to make the socket connection arbitrarily long then somehow throw an exception and verify that the next request isn&apos;t made?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There&apos;s a SocketProxy class which can be used to disallow connections to a jetty server but there&apos;s no rate limiting in there. See HttpPartitionTest for an example.&lt;/p&gt;</comment>
                            <comment id="14270120" author="markrmiller@gmail.com" created="Thu, 8 Jan 2015 22:11:28 +0000"  >&lt;p&gt;This is an important one to get into 5 - we should get it committed even if we have to a make a new JIRA to work on testing in this area.&lt;/p&gt;</comment>
                            <comment id="14270659" author="anshumg" created="Fri, 9 Jan 2015 06:53:37 +0000"  >&lt;p&gt;Patch updated to be in sync with LBHttpSolrServer -&amp;gt; LBHttpSolrClient changes. Will just run a few more rounds of tests and commit.&lt;br/&gt;
Will also create another issue for adding tests.&lt;/p&gt;</comment>
                            <comment id="14270661" author="anshumg" created="Fri, 9 Jan 2015 06:55:37 +0000"  >&lt;p&gt;The correct attachment.&lt;/p&gt;</comment>
                            <comment id="14270712" author="anshumg" created="Fri, 9 Jan 2015 07:48:33 +0000"  >&lt;p&gt;Working on fixing a failing test.&lt;/p&gt;</comment>
                            <comment id="14270747" author="anshumg" created="Fri, 9 Jan 2015 08:19:19 +0000"  >&lt;p&gt;Fixed a failing test.&lt;/p&gt;</comment>
                            <comment id="14270996" author="sdavids" created="Fri, 9 Jan 2015 13:19:48 +0000"  >&lt;p&gt;The LB Client has duplicate implementations defined in both:&lt;/p&gt;

&lt;p&gt;1. public Rsp request(Req req) throws SolrServerException, IOException&lt;br/&gt;
2. public NamedList&amp;lt;Object&amp;gt; request(final SolrRequest request) throws SolrServerException, IOException&lt;/p&gt;

&lt;p&gt;The original patch was only dealing with one of the two, we need to either a) copy the same code into the other or b) refactor the methods to have a single implementation that both methods call. Option B is my personal preference, though we might want to just do that in a separate ticket and go with option A to get it in as soon as possible. I can work on either tonight after I get back from work if anyone has a route they would like to go.&lt;/p&gt;</comment>
                            <comment id="14271776" author="anshumg" created="Fri, 9 Jan 2015 19:47:50 +0000"  >&lt;p&gt;You&apos;re right. I&apos;ll let you get to it as I&apos;m not sure if I&apos;d get time to work on it today.&lt;br/&gt;
If you&apos;re unable to get to it, I&apos;ll try handling it over the weekend.&lt;/p&gt;

&lt;p&gt;About the approaches, ideally, it&apos;d be good to refactor but that certainly is more invasive. With the rc a week away, I&apos;d like it to be less invasive at this point and work on refactoring (and adding tests) separately with the next release.&lt;/p&gt;</comment>
                            <comment id="14272303" author="sdavids" created="Sat, 10 Jan 2015 03:16:58 +0000"  >&lt;p&gt;Updated the patch to provide the same exiting functionality in the duplicate request implementation. I created &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6949&quot; title=&quot;Refactor LBHttpSolrClient to consolidate the two different request implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6949&quot;&gt;SOLR-6949&lt;/a&gt; to capture the refactoring that should be done to consolidate the two implementations.&lt;/p&gt;</comment>
                            <comment id="14273732" author="anshumg" created="Mon, 12 Jan 2015 16:19:27 +0000"  >&lt;p&gt;Thanks Steve. I&apos;ll commit this later today.&lt;br/&gt;
I&apos;ll just change the logic to compute &lt;em&gt;timeOutTime = System.nanoTime() + timeOutNano&lt;/em&gt; once and use it to compare and exit.&lt;/p&gt;</comment>
                            <comment id="14274427" author="jira-bot" created="Mon, 12 Jan 2015 23:52:12 +0000"  >&lt;p&gt;Commit 1651236 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1651236&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1651236&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6496&quot; title=&quot;LBHttpSolrClient should stop server retries after the timeAllowed threshold is met&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6496&quot;&gt;&lt;del&gt;SOLR-6496&lt;/del&gt;&lt;/a&gt;: LBHttpSolrClient stops retrying after the timeAllowed threshold is met&lt;/p&gt;</comment>
                            <comment id="14274429" author="jira-bot" created="Mon, 12 Jan 2015 23:53:02 +0000"  >&lt;p&gt;Commit 1651237 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1651237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1651237&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6496&quot; title=&quot;LBHttpSolrClient should stop server retries after the timeAllowed threshold is met&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6496&quot;&gt;&lt;del&gt;SOLR-6496&lt;/del&gt;&lt;/a&gt;: LBHttpSolrClient stops retrying after the timeAllowed threshold is met (merge from trunk)&lt;/p&gt;</comment>
                            <comment id="14332672" author="anshumg" created="Mon, 23 Feb 2015 05:01:15 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12838302">SOLR-7694</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12691472" name="SOLR-6496.patch" size="5142" author="sdavids" created="Sat, 10 Jan 2015 03:16:58 +0000"/>
                            <attachment id="12691082" name="SOLR-6496.patch" size="3550" author="anshum" created="Fri, 9 Jan 2015 08:19:19 +0000"/>
                            <attachment id="12691060" name="SOLR-6496.patch" size="2022" author="anshum" created="Fri, 9 Jan 2015 06:55:37 +0000"/>
                            <attachment id="12670271" name="SOLR-6496.patch" size="2009" author="sdavids" created="Sun, 21 Sep 2014 04:14:28 +0000"/>
                            <attachment id="12667557" name="SOLR-6496.patch" size="1940" author="sdavids" created="Wed, 10 Sep 2014 00:48:00 +0000"/>
                            <attachment id="12667529" name="SOLR-6496.patch" size="1921" author="sdavids" created="Tue, 9 Sep 2014 23:08:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zut3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>