<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:48:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13900] Permissions deleting works wrong</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13900</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Permissions indexes in security.json file do not correspond to indexes while deleting.&lt;/p&gt;

&lt;p&gt;The line&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;(141) setIndex(p);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;in &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/security/AutorizationEditOperation.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/security/AutorizationEditOperation.java&lt;/a&gt;&#160;makes indexes renumber before deleting and it leads to wrong behavior.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;USE CASE 1:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;There are 2 new permissions added to security.json (with indexes 13 and 14):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
....
      { 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;schema-edit&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:12},
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;collectionName&amp;gt;&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/schema/*&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test-role&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:13},
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin/collections&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;testCollection&quot;&lt;/span&gt;]},
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test-role&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:14}
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Step 1: remove the permission with index=13; result: permission is deleted correctly, security.json is next:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
....
      { 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;schema-edit&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:12,
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin/collections&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;testCollection&quot;&lt;/span&gt;]},
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test-role&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:14}
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Step 2: try to remove the permission with index=14; result: &quot;No such index: 14&quot; error is returned.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;USE CASE 2:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;There are 3 new permissions added to security.json (with indexes 13, 14 and 15):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-json&quot;&gt;
....
      { 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;schema-edit&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:12},
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;collectionName&amp;gt;&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/schema/*&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test-role&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:13},
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin/collections&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;testCollection&quot;&lt;/span&gt;]},
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test-role&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:14}, 
      { 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin/collections&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:\{&lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;anotherTestCollection&quot;&lt;/span&gt;]}, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test-role&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:15}
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Step 1: remove the permission with index=13; result: permission is deleted correctly, security.json becomes next:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-json&quot;&gt;
....
       { 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;schema-edit&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:12},
       {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin/collections&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;testCollection&quot;&lt;/span&gt;]}, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test-role&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:14}, 
       { 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin/collections&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;anotherTestCollection&quot;&lt;/span&gt;]}, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;role&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test-role&quot;&lt;/span&gt;, 
        &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;:15}
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
 Step 2: try to remove the permission with index=14; result: permission with index 15 is deleted, which is &lt;b&gt;wrong&lt;/b&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13266605">SOLR-13900</key>
            <summary>Permissions deleting works wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thelabdude">Timothy Potter</assignee>
                                    <reporter username="yul">Yuliia Sydoruk</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Nov 2019 14:50:01 +0000</created>
                <updated>Thu, 16 Dec 2021 14:14:55 +0000</updated>
                            <resolved>Tue, 30 Nov 2021 15:44:35 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                    <fixVersion>8.11.1</fixVersion>
                                    <component>Authorization</component>
                    <component>security</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16968673" author="janhoy" created="Wed, 6 Nov 2019 20:23:03 +0000"  >&lt;p&gt;Thanks for your report. I suspect you use the authorization REST API to edit permissions.&lt;/p&gt;

&lt;p&gt;Do you think you are able to propose a fix in a Pull Request?&lt;/p&gt;</comment>
                            <comment id="16969305" author="yul" created="Thu, 7 Nov 2019 14:34:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;&#160;Yes, I mean deleting permissions via Authorization API.&lt;/p&gt;

&lt;p&gt;My propose is just to remove&#160;setIndex(p) call, but I can&apos;t understand why it was added there and what would be the impact of removing this line.&lt;/p&gt;</comment>
                            <comment id="17439119" author="janhoy" created="Fri, 5 Nov 2021 09:25:23 +0000"  >&lt;p&gt;I managed to reproduce this with the new Security edit UI screen.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;I added a permission to the end. This writes a security.json without index params&lt;/li&gt;
	&lt;li&gt;Then edited that permission, to move it to position 2 (now security.json is written with indexes)&lt;/li&gt;
	&lt;li&gt;Then I deleted permission 2 again - this leaves a hole, so it is now 1, 3, 4, 5, 6, 7&lt;/li&gt;
	&lt;li&gt;Then I tried to delete the last permission in the list (7). Nothing happens, no errors&lt;/li&gt;
	&lt;li&gt;Then I tried to delete the second to last (6). That caused (7) to be deleted. Now the security.json was re-written with new indices&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So I believe you found the problem. I think perhaps that every edit action, including delete-by-index should re-order the index numbers for all permissions before a write. Alternatively, never re-order the indexes, but that sounds a bit strange.&lt;/p&gt;</comment>
                            <comment id="17446138" author="thelabdude" created="Thu, 18 Nov 2021 20:46:04 +0000"  >&lt;p&gt;I&apos;ll take this up for 8.11.1 as this is pretty ridiculous behavior for something as critical as authorization rules!&lt;/p&gt;</comment>
                            <comment id="17451198" author="jira-bot" created="Tue, 30 Nov 2021 15:42:09 +0000"  >&lt;p&gt;Commit 7ea2530e31d7c7e9ec109018568b17f6209d12d7 in solr&apos;s branch refs/heads/main from Timothy Potter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=7ea2530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=7ea2530&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13900&quot; title=&quot;Permissions deleting works wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13900&quot;&gt;&lt;del&gt;SOLR-13900&lt;/del&gt;&lt;/a&gt;: Reset index values on authorization rules after deleting by index (#434)&lt;/p&gt;
</comment>
                            <comment id="17452074" author="jira-bot" created="Wed, 1 Dec 2021 22:51:25 +0000"  >&lt;p&gt;Commit fd6a057b2fe84fd39dae638c092af1f50385709f in lucene-solr&apos;s branch refs/heads/branch_8_11 from Timothy Potter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fd6a057&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fd6a057&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13900&quot; title=&quot;Permissions deleting works wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13900&quot;&gt;&lt;del&gt;SOLR-13900&lt;/del&gt;&lt;/a&gt;: Reset index values on authorization rules after deleting by index (#434) (#2617)&lt;/p&gt;
</comment>
                            <comment id="17460749" author="janhoy" created="Thu, 16 Dec 2021 14:14:55 +0000"  >&lt;p&gt;Closing after the 8.11.1 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08big:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>