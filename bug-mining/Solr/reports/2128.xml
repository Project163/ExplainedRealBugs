<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:57:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6151] Intermittent TestReplicationHandlerBackup failures</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6151</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[junit4]   2&amp;gt; 4236563 T14503 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4236567 T14502 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=backup&amp;amp;name=cphlpigzwamrxxekj} status=0 QTime=5 
   [junit4]   2&amp;gt; 4236567 T14511 oash.SnapShooter.createSnapshot Creating backup snapshot...
   [junit4]   2&amp;gt; 4236682 T14505 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4237270 T14503 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4237275 T14502 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=backup&amp;amp;name=zviqwpynhbjdbiqofwa} status=0 QTime=4 
   [junit4]   2&amp;gt; 4237277 T14513 oash.SnapShooter.createSnapshot Creating backup snapshot...
   [junit4]   2&amp;gt; 4237390 T14504 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4237508 T14500 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4237626 T14505 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=1 
   [junit4]   2&amp;gt; 4237743 T14503 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4237861 T14502 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4237979 T14504 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4238097 T14500 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4238214 T14505 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4238332 T14503 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4238450 T14502 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=1 
   [junit4]   2&amp;gt; 4238567 T14504 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4238686 T14500 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4238804 T14505 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4238922 T14503 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=1 
   [junit4]   2&amp;gt; 4239039 T14502 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4239158 T14504 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4239276 T14500 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4239394 T14505 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=1 
   [junit4]   2&amp;gt; 4239511 T14503 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4239629 T14502 C3403 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 4239747 T14496 oas.SolrTestCaseJ4.tearDown ###Ending doTestBackup
   [junit4]   2&amp;gt; 4239756 T14496 oasc.CoreContainer.shutdown Shutting down CoreContainer instance=5885809
   [junit4]   2&amp;gt; 4239757 T14496 oasc.SolrCore.close [collection1]  CLOSING SolrCore org.apache.solr.core.SolrCore@16f7ab1
   [junit4]   2&amp;gt; 4239757 T14496 oasu.DirectUpdateHandler2.close closing DirectUpdateHandler2{commits=1,autocommits=0,soft autocommits=0,optimizes=0,rollbacks=0,expungeDeletes=0,docsPending=0,adds=0,deletesById=0,deletesByQuery=0,errors=0,cumulative_adds=78,cumulative_deletesById=0,cumulative_deletesByQuery=1,cumulative_errors=0}
   [junit4]   2&amp;gt; 4239757 T14496 oasu.SolrCoreState.decrefSolrCoreState Closing SolrCoreState
   [junit4]   2&amp;gt; 4239757 T14496 oasu.DefaultSolrCoreState.closeIndexWriter SolrCoreState ref count has reached 0 - closing IndexWriter
   [junit4]   2&amp;gt; 4239757 T14496 oasu.DefaultSolrCoreState.closeIndexWriter closing IndexWriter with IndexWriterCloser
   [junit4]   2&amp;gt; 4239758 T14496 oasc.SolrCore.closeSearcher [collection1] Closing main searcher on request.
   [junit4]   2&amp;gt; 4239758 T14496 oasc.CachingDirectoryFactory.close Closing MockDirectoryFactory - 2 directories currently being tracked
   [junit4]   2&amp;gt; 4239758 T14496 oasc.CachingDirectoryFactory.closeCacheValue looking to close C:\Users\JenkinsSlave\workspace\Lucene-Solr-trunk-Windows\solr\build\solr-core\test\J0\.\temp\solr.handler.TestReplicationHandlerBackup-DCCC360504A48D2D-001\solr-instance-001\collection1\data\index [CachedDir&amp;lt;&amp;lt;refCount=0;path=C:\Users\JenkinsSlave\workspace\Lucene-Solr-trunk-Windows\solr\build\solr-core\test\J0\.\temp\solr.handler.TestReplicationHandlerBackup-DCCC360504A48D2D-001\solr-instance-001\collection1\data\index;done=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;gt;&amp;gt;]
   [junit4]   2&amp;gt; 4239758 T14496 oasc.CachingDirectoryFactory.close Closing directory: C:\Users\JenkinsSlave\workspace\Lucene-Solr-trunk-Windows\solr\build\solr-core\test\J0\.\temp\solr.handler.TestReplicationHandlerBackup-DCCC360504A48D2D-001\solr-instance-001\collection1\data\index
   [junit4]   2&amp;gt; 4239758 T14496 oasc.CachingDirectoryFactory.closeCacheValue looking to close C:\Users\JenkinsSlave\workspace\Lucene-Solr-trunk-Windows\solr\build\solr-core\test\J0\.\temp\solr.handler.TestReplicationHandlerBackup-DCCC360504A48D2D-001\solr-instance-001\collection1\data\ [CachedDir&amp;lt;&amp;lt;refCount=0;path=C:\Users\JenkinsSlave\workspace\Lucene-Solr-trunk-Windows\solr\build\solr-core\test\J0\.\temp\solr.handler.TestReplicationHandlerBackup-DCCC360504A48D2D-001\solr-instance-001\collection1\data\;done=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;gt;&amp;gt;]
   [junit4]   2&amp;gt; 4239758 T14496 oasc.CachingDirectoryFactory.close Closing directory: C:\Users\JenkinsSlave\workspace\Lucene-Solr-trunk-Windows\solr\build\solr-core\test\J0\.\temp\solr.handler.TestReplicationHandlerBackup-DCCC360504A48D2D-001\solr-instance-001\collection1\data\
   [junit4]   2&amp;gt; 4239761 T14496 oejsh.ContextHandler.doStop stopped o.e.j.s.ServletContextHandler{/solr,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandlerBackup -Dtests.method=doTestBackup -Dtests.seed=DCCC360504A48D2D -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=it_CH -Dtests.timezone=Asia/Jerusalem -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 3.64s | TestReplicationHandlerBackup.doTestBackup &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: Backup success not detected:&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
   [junit4]    &amp;gt; &amp;lt;response&amp;gt;
   [junit4]    &amp;gt; &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;0&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;&amp;gt;0&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;details&quot;&lt;/span&gt;&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;indexSize&quot;&lt;/span&gt;&amp;gt;3.1 KB&amp;lt;/str&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;indexPath&quot;&lt;/span&gt;&amp;gt;C:\Users\JenkinsSlave\workspace\Lucene-Solr-trunk-Windows\solr\build\solr-core\test\J0\.\temp\solr.handler.TestReplicationHandlerBackup-DCCC360504A48D2D-001\solr-instance-001\collection1\data\index/&amp;lt;/str&amp;gt;&amp;lt;arr name=&lt;span class=&quot;code-quote&quot;&gt;&quot;commits&quot;&lt;/span&gt;&amp;gt;&amp;lt;lst&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;indexVersion&quot;&lt;/span&gt;&amp;gt;1402224615148&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;generation&quot;&lt;/span&gt;&amp;gt;2&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&amp;gt;&amp;lt;arr name=&lt;span class=&quot;code-quote&quot;&gt;&quot;filelist&quot;&lt;/span&gt;&amp;gt;&amp;lt;str&amp;gt;_0.cfe&amp;lt;/str&amp;gt;&amp;lt;str&amp;gt;_0.cfs&amp;lt;/str&amp;gt;&amp;lt;str&amp;gt;_0.si&amp;lt;/str&amp;gt;&amp;lt;str&amp;gt;segments_2&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;isMaster&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/str&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;isSlave&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/str&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;indexVersion&quot;&lt;/span&gt;&amp;gt;1402224615148&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;generation&quot;&lt;/span&gt;&amp;gt;2&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&amp;gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;master&quot;&lt;/span&gt;&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;confFiles&quot;&lt;/span&gt;&amp;gt;schema-replication2.xml:schema.xml&amp;lt;/str&amp;gt;&amp;lt;arr name=&lt;span class=&quot;code-quote&quot;&gt;&quot;replicateAfter&quot;&lt;/span&gt;&amp;gt;&amp;lt;str&amp;gt;commit&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;replicationEnabled&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/str&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;replicableVersion&quot;&lt;/span&gt;&amp;gt;1402224615148&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;replicableGeneration&quot;&lt;/span&gt;&amp;gt;2&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;backup&quot;&lt;/span&gt;&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;startTime&quot;&lt;/span&gt;&amp;gt;Sun Jun 08 13:50:15 IDT 2014&amp;lt;/str&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileCount&quot;&lt;/span&gt;&amp;gt;4&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;success&amp;lt;/str&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;snapshotCompletedAt&quot;&lt;/span&gt;&amp;gt;Sun Jun 08 13:50:15 IDT 2014&amp;lt;/str&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;WARNING&quot;&lt;/span&gt;&amp;gt;This response format is experimental.  It is likely to change in the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.&amp;lt;/str&amp;gt;
   [junit4]    &amp;gt; &amp;lt;/response&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([DCCC360504A48D2D:9D471660231A7E62]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.TestReplicationHandlerBackup.doTestBackup(TestReplicationHandlerBackup.java:171)
   [junit4]    &amp;gt; 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
   [junit4]   2&amp;gt; 4239841 T14496 oas.SolrTestCaseJ4.deleteCore ###deleteCore
   [junit4]   2&amp;gt; NOTE: leaving temporary files on disk at: C:\Users\JenkinsSlave\workspace\Lucene-Solr-trunk-Windows\solr\build\solr-core\test\J0\.\temp\solr.handler.TestReplicationHandlerBackup-DCCC360504A48D2D-001
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12719088">SOLR-6151</key>
            <summary>Intermittent TestReplicationHandlerBackup failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dweiss">Dawid Weiss</assignee>
                                    <reporter username="dweiss">Dawid Weiss</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Jun 2014 20:31:37 +0000</created>
                <updated>Wed, 2 Oct 2019 17:30:33 +0000</updated>
                            <resolved>Tue, 7 Apr 2015 14:06:05 +0000</resolved>
                                                    <fixVersion>5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14023390" author="varunthacker" created="Mon, 9 Jun 2014 12:17:43 +0000"  >&lt;p&gt;The logic here is it checks for the status 20 times to confirm if the backup for successful. Looks like it didn&apos;t complete in 20 retries for the second snapshot which caused the failure.&lt;/p&gt;

&lt;p&gt;it&apos;s probably because of &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What would the best approach be here? Increase the retry count?&lt;/p&gt;</comment>
                            <comment id="14025217" author="dweiss" created="Mon, 9 Jun 2014 14:27:18 +0000"  >&lt;p&gt;Is there any way to detect backup progress? If it&apos;s still progressing then we should keep on waiting. Otherwise fail. Hardcoded constants (and time-dependent checks) are destined to fail sooner or later.&lt;/p&gt;</comment>
                            <comment id="14026169" author="varunthacker" created="Tue, 10 Jun 2014 06:37:55 +0000"  >&lt;p&gt;It doesn&apos;t seem like there is any way currently to figure of backup progress unless we add hooks to the file copy code to check how many bytes have been written etc.&lt;/p&gt;

&lt;p&gt;Looking at SnapShooter#createSnapshot the only two responses which are possible are - success or snapShootException. &lt;/p&gt;

&lt;p&gt;In the patch CheckBackupStatus#fetchStatus fails on snapShootException and removed the 20 time retry logic. Similarly for delete snapshot a similar logic is applied.&lt;/p&gt;

&lt;p&gt;Is this the right approach? Maybe we should still keep a hard limit to prevent it from running infinitely?&lt;/p&gt;</comment>
                            <comment id="14026175" author="dweiss" created="Tue, 10 Jun 2014 06:47:28 +0000"  >&lt;p&gt;Hi Varun, &lt;/p&gt;

&lt;p&gt;I think we can let it run indefinitely since there is already a timeout for any test at the suite level (and this should be way longer than needed to create that backup).&lt;/p&gt;</comment>
                            <comment id="14026587" author="varunthacker" created="Tue, 10 Jun 2014 15:38:49 +0000"  >&lt;p&gt;Patch which removes the retry logic and depends on error response/test suite timeout for failure. Also in my manual testing I realised that the check in CheckDeleteBackupStatus#fetchStatus &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(response.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;str name=\&quot;&lt;/span&gt;status\&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;success&amp;lt;/str&amp;gt;&quot;&lt;/span&gt;)) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is not enough as that is the response left behind from the 2nd backup output. Fixed that by adding &quot;snapshotDeletedAt&apos; and checking against that too.&lt;/p&gt;</comment>
                            <comment id="14032377" author="jira-bot" created="Mon, 16 Jun 2014 12:17:58 +0000"  >&lt;p&gt;Commit 1602854 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dawidweiss&quot; class=&quot;user-hover&quot; rel=&quot;dawidweiss&quot;&gt;dawidweiss&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1602854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1602854&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6151&quot; title=&quot;Intermittent TestReplicationHandlerBackup failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6151&quot;&gt;&lt;del&gt;SOLR-6151&lt;/del&gt;&lt;/a&gt;: Intermittent TestReplicationHandlerBackup failures.&lt;/p&gt;</comment>
                            <comment id="14032378" author="jira-bot" created="Mon, 16 Jun 2014 12:18:44 +0000"  >&lt;p&gt;Commit 1602855 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dawidweiss&quot; class=&quot;user-hover&quot; rel=&quot;dawidweiss&quot;&gt;dawidweiss&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1602855&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1602855&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6151&quot; title=&quot;Intermittent TestReplicationHandlerBackup failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6151&quot;&gt;&lt;del&gt;SOLR-6151&lt;/del&gt;&lt;/a&gt;: Intermittent TestReplicationHandlerBackup failures.&lt;/p&gt;</comment>
                            <comment id="14032379" author="dweiss" created="Mon, 16 Jun 2014 12:19:20 +0000"  >&lt;p&gt;Committed. Thanks Varun. &lt;/p&gt;</comment>
                            <comment id="14053402" author="dweiss" created="Mon, 7 Jul 2014 07:29:29 +0000"  >&lt;p&gt;Issues still, this time unreleased socket connection threads.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     [exec]    [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandlerBackup -Dtests.seed=692B0B903749E7F0 -Dtests.locale=lt_LT -Dtests.timezone=America/Indiana/Knox -Dtests.file.encoding=UTF-8
     [exec]    [junit4] ERROR   0.00s J1 | TestReplicationHandlerBackup (suite) &amp;lt;&amp;lt;&amp;lt;
     [exec]    [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.handler.TestReplicationHandlerBackup: 
     [exec]    [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=526, name=&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-215, state=RUNNABLE, group=TGRP-TestReplicationHandlerBackup]
     [exec]    [junit4]    &amp;gt;         at java.net.PlainSocketImpl.socketConnect(Native Method)
     [exec]    [junit4]    &amp;gt;         at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
     [exec]    [junit4]    &amp;gt;         at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
     [exec]    [junit4]    &amp;gt;         at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
     [exec]    [junit4]    &amp;gt;         at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
     [exec]    [junit4]    &amp;gt;         at java.net.Socket.connect(Socket.java:579)
     [exec]    [junit4]    &amp;gt;         at java.net.Socket.connect(Socket.java:528)
     [exec]    [junit4]    &amp;gt;         at sun.net.NetworkClient.doConnect(NetworkClient.java:180)
     [exec]    [junit4]    &amp;gt;         at sun.net.www.http.HttpClient.openServer(HttpClient.java:432)
     [exec]    [junit4]    &amp;gt;         at sun.net.www.http.HttpClient.openServer(HttpClient.java:527)
     [exec]    [junit4]    &amp;gt;         at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:652)
     [exec]    [junit4]    &amp;gt;         at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1323)
     [exec]    [junit4]    &amp;gt;         at java.net.URL.openStream(URL.java:1037)
     [exec]    [junit4]    &amp;gt;         at org.apache.solr.handler.TestReplicationHandlerBackup$BackupThread.run(TestReplicationHandlerBackup.java:314)
     [exec]    [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([692B0B903749E7F0]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
     [exec]    [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=526, name=&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-215, state=RUNNABLE, group=TGRP-TestReplicationHandlerBackup]
     [exec]    [junit4]    &amp;gt;         at java.net.PlainSocketImpl.socketConnect(Native Method)
     [exec]    [junit4]    &amp;gt;         at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
     [exec]    [junit4]    &amp;gt;         at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
     [exec]    [junit4]    &amp;gt;         at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
     [exec]    [junit4]    &amp;gt;         at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
     [exec]    [junit4]    &amp;gt;         at java.net.Socket.connect(Socket.java:579)
     [exec]    [junit4]    &amp;gt;         at java.net.Socket.connect(Socket.java:528)
     [exec]    [junit4]    &amp;gt;         at sun.net.NetworkClient.doConnect(NetworkClient.java:180)
     [exec]    [junit4]    &amp;gt;         at sun.net.www.http.HttpClient.openServer(HttpClient.java:432)
     [exec]    [junit4]    &amp;gt;         at sun.net.www.http.HttpClient.openServer(HttpClient.java:527)
     [exec]    [junit4]    &amp;gt;         at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:652)
     [exec]    [junit4]    &amp;gt;         at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1323)
     [exec]    [junit4]    &amp;gt;         at java.net.URL.openStream(URL.java:1037)
     [exec]    [junit4]    &amp;gt;         at org.apache.solr.handler.TestReplicationHandlerBackup$BackupThread.run(TestReplicationHandlerBackup.java:314)
     [exec]    [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([692B0B903749E7F0]:0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This may be FreeBSD&apos;s issue though.&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-SmokeRelease-trunk/181/consoleFull&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-SmokeRelease-trunk/181/consoleFull&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14173978" author="tomasflobbe" created="Thu, 16 Oct 2014 17:18:47 +0000"  >&lt;p&gt;I don&apos;t see why this test creates new threads for doing the &quot;backup&quot; command. The command is asynchronous &lt;/p&gt;</comment>
                            <comment id="14174028" author="tomasflobbe" created="Thu, 16 Oct 2014 17:52:32 +0000"  >&lt;p&gt;Patch that calls the &quot;backup&quot; command in the same thread as the test.&lt;/p&gt;</comment>
                            <comment id="14174113" author="tomasflobbe" created="Thu, 16 Oct 2014 19:11:20 +0000"  >&lt;p&gt;This is a snippet of the last failure:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 3316267 T6966 oash.SnapShooter.createSnapshot Creating backup snapshot...
   [junit4]   2&amp;gt; 3316283 T6966 oash.SnapShooter.createSnapshot Done creating backup snapshot: hrpqfjrct
   [junit4]   2&amp;gt; 3316460 T6955 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=1 
   [junit4]   2&amp;gt; 3317471 T6955 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=1 
   [junit4]   2&amp;gt; 3317473 T6956 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=backup&amp;amp;name=cceluxuxgbxuvpqnvyp} status=0 QTime=3 
   [junit4]   2&amp;gt; 3317473 T6968 oash.SnapShooter.createSnapshot Creating backup snapshot...
   [junit4]   2&amp;gt; 3317480 T6968 oash.SnapShooter.createSnapshot Done creating backup snapshot: cceluxuxgbxuvpqnvyp
   [junit4]   2&amp;gt; 3317673 T6956 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 3317681 T6955 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 3317687 T6956 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=deletebackup&amp;amp;name=hrpqfjrct} status=0 QTime=8 
   [junit4]   2&amp;gt; 3317687 T6970 oash.SnapShooter.deleteNamedSnapshot Deleting snapshot: hrpqfjrct
   [junit4]   2&amp;gt; 3317883 T6956 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 3317885 T6956 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 3317886 T6951 oas.SolrTestCaseJ4.tearDown ###Ending doTestBackup
   [junit4]   2&amp;gt; 3317886 T6972 oash.SnapShooter.deleteNamedSnapshot Deleting snapshot: cceluxuxgbxuvpqnvyp
   [junit4]   2&amp;gt; 3317886 T6955 C9819 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=deletebackup&amp;amp;name=cceluxuxgbxuvpqnvyp} status=0 QTime=1 
   [junit4]   2&amp;gt; 3317886 T6951 oasc.CoreContainer.shutdown Shutting down CoreContainer instance=1745412867
   [junit4]   2&amp;gt; 3317889 T6951 oejsh.ContextHandler.doStop stopped o.e.j.s.ServletContextHandler{/solr,null}
   [junit4]   2&amp;gt; 3317889 T6955 C9819 oasc.SolrException.log ERROR null:org.eclipse.jetty.io.EofException
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:142)
   [junit4]   2&amp;gt; 		at org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:107)
   [junit4]   2&amp;gt; 		at sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:221)
   [junit4]   2&amp;gt; 		at sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:291)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like the test finished before the last &quot;deletebackup&quot;, I suspect this may be a race condition:&lt;br/&gt;
1) MainThread creates Thread1 and starts it&lt;br/&gt;
2) Thread1: calls &quot;deletebackup&quot; on backup1&lt;br/&gt;
3) MainThread: call &quot;details&quot; continuously until it sees &quot;success&quot;, however, it doesn&apos;t check for a backup name (not sure it &quot;details&quot; provides that information)&lt;br/&gt;
4) MainThread: creates Thread2 and starts it&lt;br/&gt;
5) MainThread: call &quot;details&quot; continuously until it sees &quot;success&quot;. It sees it on the first attempt, because it sees the success of &quot;backup1&quot;.&lt;br/&gt;
6) MainThread: test continues (and finishes), starts the tearDown process&lt;br/&gt;
7) Thread2: calls &quot;deletebackup&quot; on backup2&lt;br/&gt;
8) Server shuts down while waiting for the backup to happen, causing IO exception. &lt;/p&gt;

&lt;p&gt;I think doing the &quot;deletebackup&quot; command on the MainThread will help, however I think it could still happen that the command starts, but the snapshot details are not yet updated when the MainThread asks for them, and still sees the success of the previous command. I&apos;ll see if I can fix that case.&lt;/p&gt;</comment>
                            <comment id="14174200" author="tomasflobbe" created="Thu, 16 Oct 2014 20:33:57 +0000"  >&lt;p&gt;This patch validates that the &quot;details&quot; command doesn&apos;t see an old success.&lt;br/&gt;
I&apos;ll run this test some times with beast and commit if I see no failures&lt;/p&gt;</comment>
                            <comment id="14174504" author="jira-bot" created="Fri, 17 Oct 2014 00:07:09 +0000"  >&lt;p&gt;Commit 1632449 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1632449&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1632449&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6151&quot; title=&quot;Intermittent TestReplicationHandlerBackup failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6151&quot;&gt;&lt;del&gt;SOLR-6151&lt;/del&gt;&lt;/a&gt;: Improved TestReplicationHandlerBackup&lt;/p&gt;</comment>
                            <comment id="14174694" author="jira-bot" created="Fri, 17 Oct 2014 03:39:38 +0000"  >&lt;p&gt;Commit 1632469 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1632469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1632469&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6151&quot; title=&quot;Intermittent TestReplicationHandlerBackup failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6151&quot;&gt;&lt;del&gt;SOLR-6151&lt;/del&gt;&lt;/a&gt;: Improved TestReplicationHandlerBackup&lt;/p&gt;</comment>
                            <comment id="14175209" author="tomasflobbe" created="Fri, 17 Oct 2014 16:25:41 +0000"  >&lt;p&gt;I&apos;ll keep this Jira open for a couple of days to see if we see the failures again in jenkins.&lt;/p&gt;</comment>
                            <comment id="14177016" author="tomasflobbe" created="Mon, 20 Oct 2014 15:47:23 +0000"  >&lt;p&gt;There was a new failure of this test in Jenkins: &lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Windows/4377/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Windows/4377/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14177055" author="varunthacker" created="Mon, 20 Oct 2014 16:13:03 +0000"  >&lt;p&gt;Hi Tomas,&lt;/p&gt;

&lt;p&gt;It&apos;s a timeout issue again unfortunately. Probably because of -Dtests.slow=true&lt;/p&gt;

&lt;p&gt;Earlier this test had a max retry count but Dawid suggested that we should let the test suite handle it instead. We&apos;re not even creating a huge index to backup, so I am now confused how to solve these timeout failures. What do you think we should do to tackle this problem?&lt;/p&gt;</comment>
                            <comment id="14177068" author="tomasflobbe" created="Mon, 20 Oct 2014 16:20:36 +0000"  >&lt;p&gt;Yes, I saw it&apos;s a timeout, but as you said, the index created is very small, should be backed up fast enough, something must be stuck/locked. Also, it looks like the first backup of the test succeeded immediately, and the second took forever, the index is the same, so the time should be similar. &lt;br/&gt;
The test failure was in Windows, so maybe we are not handling some cases correctly in that specific OS? I didn&apos;t start looking at the test again. &lt;/p&gt;</comment>
                            <comment id="14177079" author="varunthacker" created="Mon, 20 Oct 2014 16:31:15 +0000"  >&lt;p&gt;It&apos;s late here so I can look into the test tomorrow morning my time. Hopefully we can fix the test once and for all.&lt;/p&gt;</comment>
                            <comment id="14203996" author="thetaphi" created="Sun, 9 Nov 2014 17:08:54 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I just ping here. After &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-5953&quot; title=&quot;Refactor LockFactory usage in Directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-5953&quot;&gt;&lt;del&gt;LUCENE-5953&lt;/del&gt;&lt;/a&gt; was comitted, the failures on this test are still there. They are not related to the refactoring, but seem to be caused by snapshooter trying to create a backup, but another run is deleting the index directory while a snapshot is running,&lt;/p&gt;</comment>
                            <comment id="14203999" author="thetaphi" created="Sun, 9 Nov 2014 17:15:21 +0000"  >&lt;p&gt;Here another failure by Jenkins:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 218994 T761 oash.SnapShooter.createSnapshot Creating backup snapshot...
   [junit4]   2&amp;gt; 218996 T761 oash.SnapShooter.createSnapshot ERROR Exception while creating snapshot java.nio.file.NoSuchFileException: /mnt/ssd/jenkins/workspace/Lucene-Solr-trunk-Linux/solr/build/solr-core/test/J1/temp/solr.handler.TestReplicationHandlerBackup-2B253ACE4326502E-001/solr-instance-001/collection1/data/snapshot.20141109233419686/_0.cfe
   [junit4]   2&amp;gt; 	at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)
   [junit4]   2&amp;gt; 	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
   [junit4]   2&amp;gt; 	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
   [junit4]   2&amp;gt; 	at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)
   [junit4]   2&amp;gt; 	at java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:434)
   [junit4]   2&amp;gt; 	at java.nio.file.Files.newOutputStream(Files.java:216)
   [junit4]   2&amp;gt; 	at org.apache.lucene.store.FSDirectory$FSIndexOutput.&amp;lt;init&amp;gt;(FSDirectory.java:285)
   [junit4]   2&amp;gt; 	at org.apache.lucene.store.FSDirectory.createOutput(FSDirectory.java:220)
   [junit4]   2&amp;gt; 	at org.apache.lucene.store.Directory.copy(Directory.java:150)
   [junit4]   2&amp;gt; 	at org.apache.lucene.store.MockDirectoryWrapper.copy(MockDirectoryWrapper.java:1030)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.SnapShooter.copyFile(SnapShooter.java:234)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.SnapShooter.copyFiles(SnapShooter.java:229)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.SnapShooter.createSnapshot(SnapShooter.java:139)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.SnapShooter$1.run(SnapShooter.java:88)
   [junit4]   2&amp;gt; 
   [junit4]   2&amp;gt; 219000 T754 C133 oasc.SolrCore.execute [collection1] webapp=/solr path=/replication params={command=details} status=0 QTime=0 
   [junit4]   2&amp;gt; 219002 T748 oas.SolrTestCaseJ4.tearDown ###Ending doTestBackup
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To my underdstanding the failures are caused by the following: One thread is starting to do a snapshot but the snapshot directory is deleted by another thread.&lt;/p&gt;</comment>
                            <comment id="14204000" author="thetaphi" created="Sun, 9 Nov 2014 17:18:34 +0000"  >&lt;p&gt;In fact, this happens on all operating systems! Not just Windows!&lt;/p&gt;

&lt;p&gt;My last commit on &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-5953&quot; title=&quot;Refactor LockFactory usage in Directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-5953&quot;&gt;&lt;del&gt;LUCENE-5953&lt;/del&gt;&lt;/a&gt; was to remove the buggy locking in SnapShooter.java. The whole index directory copying is broken with recent changes in Lucene. We have to fix SnapShooter or remove it - that&apos;s all I can say.&lt;/p&gt;

&lt;p&gt;In my opinion, Solr should move to the new Lucene module for Index Replication.&lt;/p&gt;</comment>
                            <comment id="14204107" author="thetaphi" created="Sun, 9 Nov 2014 20:51:43 +0000"  >&lt;p&gt;I think the main problem is caused by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&apos;s commit:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Revision: 1592957
Author: noble
Date: Mittwoch, 7. Mai 2014 12:12:29
Message:
SOLR-5340: Add support for named snapshots
----
Modified : /lucene/dev/trunk/solr/CHANGES.txt
Modified : /lucene/dev/trunk/solr/core/src/java/org/apache/solr/handler/ReplicationHandler.java
Modified : /lucene/dev/trunk/solr/core/src/java/org/apache/solr/handler/SnapShooter.java
Modified : /lucene/dev/trunk/solr/core/src/test/org/apache/solr/handler/TestReplicationHandler.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This one seems to cause all the trouble here. This commit broke the locking of Snapshooter. Due to my changes this morning this got worse, because I removed the remaining locking (which was useless). I will now look into SnapShooter and try to fix it. The test seems not to be the issue.&lt;/p&gt;</comment>
                            <comment id="14204130" author="thetaphi" created="Sun, 9 Nov 2014 21:37:34 +0000"  >&lt;p&gt;I improved the situation again, because I reverted most changed I did in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-5953&quot; title=&quot;Refactor LockFactory usage in Directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-5953&quot;&gt;&lt;del&gt;LUCENE-5953&lt;/del&gt;&lt;/a&gt; and just removed the locking code (which was now useless). In fact the problems were caused by the broken locking. The revert of my commits just fixed this by creating the snapshot directory directly before file copying. The problem causing the disappearing folder is, as said before, incomplete locking. When the snapshot is created the snapshot directory should be locked (fully locked with locking impl used by DirectoryFactory) and deleting and overwriting snapshots should check the lock before.&lt;/p&gt;

&lt;p&gt;If I have time, I can look into this, for now everything is like it was before &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-5953&quot; title=&quot;Refactor LockFactory usage in Directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-5953&quot;&gt;&lt;del&gt;LUCENE-5953&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14288432" author="shalinmangar" created="Thu, 22 Jan 2015 23:22:07 +0000"  >&lt;p&gt;Another failure on jenkins today (on windows): &lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Windows/4436/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Windows/4436/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FAILED:  org.apache.solr.handler.TestReplicationHandlerBackup.doTestBackup

Error Message:
Test abandoned because suite timeout was reached.

Stack Trace:
java.lang.Exception: Test abandoned because suite timeout was reached.
        at __randomizedtesting.SeedInfo.seed([516A7445BB4FC9A7]:0)


FAILED:  junit.framework.TestSuite.org.apache.solr.handler.TestReplicationHandlerBackup

Error Message:
Suite timeout exceeded (&amp;gt;= 7200000 msec).

Stack Trace:
java.lang.Exception: Suite timeout exceeded (&amp;gt;= 7200000 msec).
        at __randomizedtesting.SeedInfo.seed([516A7445BB4FC9A7]:0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14483178" author="varunthacker" created="Tue, 7 Apr 2015 13:52:27 +0000"  >&lt;p&gt;I think we can close this issue. Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7156&quot; title=&quot;Fix BasicDistributedZk2Test and TestReplicationHandlerBackup failures on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7156&quot;&gt;&lt;del&gt;SOLR-7156&lt;/del&gt;&lt;/a&gt; fixed these failures. I could not find any recent Jenkins failures for this either.&lt;/p&gt;</comment>
                            <comment id="14495406" author="thelabdude" created="Wed, 15 Apr 2015 00:30:59 +0000"  >&lt;p&gt;Bulk close after 5.1 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12741616">LUCENE-5953</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12675340" name="SOLR-6151.patch" size="6760" author="tflobbe" created="Thu, 16 Oct 2014 20:33:57 +0000"/>
                            <attachment id="12675315" name="SOLR-6151.patch" size="5345" author="tflobbe" created="Thu, 16 Oct 2014 17:52:32 +0000"/>
                            <attachment id="12649595" name="SOLR-6151.patch" size="6745" author="varun" created="Tue, 10 Jun 2014 15:38:49 +0000"/>
                            <attachment id="12649537" name="SOLR-6151.patch" size="4474" author="varun" created="Tue, 10 Jun 2014 06:37:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wedj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397414</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>