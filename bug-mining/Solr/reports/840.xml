<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:26:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3260] Improve exception handling / logging for ScriptTransformer.init()</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3260</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This came up on the user-list.  ScriptTransformer logs the same &quot;need a &amp;gt;=1.6 jre&quot; message for several problems, making debugging difficult for users.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12547221">SOLR-3260</key>
            <summary>Improve exception handling / logging for ScriptTransformer.init()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdyer">James Dyer</assignee>
                                    <reporter username="jdyer">James Dyer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Mar 2012 16:07:02 +0000</created>
                <updated>Fri, 10 May 2013 10:39:10 +0000</updated>
                            <resolved>Wed, 21 Mar 2012 17:25:31 +0000</resolved>
                                    <version>3.5</version>
                    <version>4.0-ALPHA</version>
                                    <fixVersion>3.6</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13233516" author="jdyer" created="Tue, 20 Mar 2012 16:08:05 +0000"  >&lt;p&gt;I will commit this shortly.&lt;/p&gt;</comment>
                            <comment id="13233613" author="jdyer" created="Tue, 20 Mar 2012 17:49:46 +0000"  >&lt;p&gt;committed.&lt;/p&gt;

&lt;p&gt;Trunk: r1302972&lt;br/&gt;
Branch_3x: r1303042 &lt;/p&gt;</comment>
                            <comment id="13233851" author="steve_rowe" created="Tue, 20 Mar 2012 22:00:23 +0000"  >&lt;p&gt;Hi James,&lt;/p&gt;

&lt;p&gt;The branch_3x Maven Jenkins job is now failing in &lt;tt&gt;TestScriptTransformer&lt;/tt&gt; as a result of your commit from this issue, e.g. &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Maven-3.x/432/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Maven-3.x/432/testReport/&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;d like to expand the set of exception message checked in the JUnit assumptions that allow tests to be skipped to include the two new messages your changes on this issue introduced:&lt;/p&gt;

&lt;p&gt;Currently:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;} catch (DataImportHandlerException e) {
  assumeFalse(&quot;JRE does not contain a JavaScript engine (OpenJDK)&quot;, e.getMessage().startsWith(&quot;&amp;lt;script&amp;gt; can be used only in java 6 or above&quot;));
  throw e;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expanded:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;} catch (DataImportHandlerException e) {
  assumeFalse(&quot;JRE does not contain a JavaScript engine (OpenJDK)&quot;, 
              e.getMessage().startsWith(&quot;&amp;lt;script&amp;gt; can be used only in java 6 or above&quot;)
              || e.getMessage().startsWith(&quot;Cannot load Script Engine for language:&quot;)
              || e.getMessage().startsWith(&quot;&apos;eval&apos; failed with language:&quot;));
  throw e;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13233860" author="jdyer" created="Tue, 20 Mar 2012 22:07:59 +0000"  >&lt;p&gt;That is probably the right thing to do.  If its using a JRE that supports the class &quot;javax.script.ScriptEngineManager&quot; but there are nop ScriptingEngines installed, you&apos;ll get the &quot;Cannot load Script Engine...&quot; message.  I am a bit confused why it is giving the &quot;eval failed...&quot; message though.&lt;/p&gt;

&lt;p&gt;Why don&apos;t you make the fix you&apos;ve proposed and I&apos;ll look later to see if there is something less-blunt we can do.  Sound ok?&lt;/p&gt;</comment>
                            <comment id="13233871" author="steve_rowe" created="Tue, 20 Mar 2012 22:17:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;I am a bit confused why it is giving the &quot;eval failed...&quot; message though.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s an NPE, but beyond that I&apos;m not sure what&apos;s happening.&lt;/p&gt;

&lt;p&gt;The branch_3x Maven job compiles under a 1.5 JDK, then runs tests via Maven&apos;s Surefire plugin under a 1.6 (OpenJDK) JVM.  &lt;/p&gt;

&lt;p&gt;These tests appear to pass on the Solr_3x job under the same 1.6 JVM, though, so there&apos;s something weird going on here.  (The Solr_3x job runs under Ant, but I&apos;m not sure why the Ant/Maven difference would be the cause of this.)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why don&apos;t you make the fix you&apos;ve proposed and I&apos;ll look later to see if there is something less-blunt we can do. Sound ok?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, I&apos;ll commit those changes now.&lt;/p&gt;</comment>
                            <comment id="13233876" author="steve_rowe" created="Tue, 20 Mar 2012 22:22:04 +0000"  >&lt;p&gt;I committed the test skipping changes to branch_3x.  I haven&apos;t seen the same problem (yet) on trunk, so I&apos;ll hold off there.&lt;/p&gt;</comment>
                            <comment id="13234036" author="jdyer" created="Wed, 21 Mar 2012 02:17:53 +0000"  >&lt;p&gt;Thanks, Steven!  I&apos;ll look a little bit more at this tomorrow.  Sorry to break the build.&lt;/p&gt;</comment>
                            <comment id="13234382" author="jdyer" created="Wed, 21 Mar 2012 14:35:34 +0000"  >&lt;p&gt;In light of the maven 3.x failure, I think I need to move some of the reflection calls from the 3nd try/catch to the 2nd.  This means we can ignore 2 of the 3 exceptions instead of all 3.&lt;/p&gt;

&lt;p&gt;For trunk, I can change this to not use reflection at all since we require a 1.6+ jvm.  However, this can still fail if the scripting engines are not in the jvms so these checks need to stay in place.&lt;/p&gt;</comment>
                            <comment id="13234449" author="steve_rowe" created="Wed, 21 Mar 2012 16:04:31 +0000"  >&lt;p&gt;I see we got the same failures on the trunk Maven build today: &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Maven-trunk/431/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Maven-trunk/431/testReport/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll forward-port my test-skipping changes to trunk.&lt;/p&gt;</comment>
                            <comment id="13234451" author="steve_rowe" created="Wed, 21 Mar 2012 16:05:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;In light of the maven 3.x failure, I think I need to move some of the reflection calls from the 3nd try/catch to the 2nd. This means we can ignore 2 of the 3 exceptions instead of all 3.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13234472" author="ryantxu" created="Wed, 21 Mar 2012 16:38:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;class &quot;javax.servlet.FilterRegistration&quot;&apos;s signer information does not match signer information of other classes in the same package&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have seen this before when servlet-2.5 and servlet-api 3.0 are both in the classpath&lt;/p&gt;</comment>
                            <comment id="13234477" author="steve_rowe" created="Wed, 21 Mar 2012 16:43:00 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;class &quot;javax.servlet.FilterRegistration&quot;&apos;s signer information does not match signer information of other classes in the same package&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have seen this before when servlet-2.5 and servlet-api 3.0 are both in the classpath&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I&apos;m testing a change to the solr-core POM that would make the servlet dependency use the &quot;provided&quot; scope, which would exclude it from the runtime classpath.&lt;/p&gt;

&lt;p&gt;Seems to fix the trunk failures you&apos;re referring to in the DIH tests.  Running all Solr tests locally now before I commit the change.&lt;/p&gt;</comment>
                            <comment id="13234540" author="jdyer" created="Wed, 21 Mar 2012 17:25:32 +0000"  >&lt;p&gt;Trunk: r1303470 - Removed reflection as Trunk uses JRE 1.6+.  Unit Test no longer ignores exceptions.&lt;/p&gt;

&lt;p&gt;Branch_3x: r1303464 - moved things in try/catch blocks so as to be able to ignore 1 fewer exception (also better from a user&apos;s perspective)&lt;/p&gt;

&lt;p&gt;Hopefully this is it!&lt;/p&gt;</comment>
                            <comment id="13234854" author="steve_rowe" created="Wed, 21 Mar 2012 18:51:49 +0000"  >&lt;blockquote&gt;
&lt;p&gt;&amp;gt; &amp;gt; class &quot;javax.servlet.FilterRegistration&quot;&apos;s signer information does not&lt;br/&gt;
&amp;gt; &amp;gt; match signer information of other classes in the same package&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; I have seen this before when servlet-2.5 and servlet-api 3.0 are both in the classpath&lt;/p&gt;

&lt;p&gt;Yeah, I&apos;m testing a change to the solr-core POM that would make the servlet dependency use the &quot;provided&quot; scope, which would exclude it from the runtime classpath.&lt;/p&gt;

&lt;p&gt;Seems to fix the trunk failures you&apos;re referring to in the DIH tests. Running all Solr tests locally now before I commit the change.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3263&quot; title=&quot;Stop including more than one servlet-api jar version in the test classpath in the Maven build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3263&quot;&gt;&lt;del&gt;SOLR-3263&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13235600" author="steve_rowe" created="Thu, 22 Mar 2012 14:36:04 +0000"  >&lt;p&gt;James, the trunk Maven build is still unhappy:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Build: https://builds.apache.org/job/Lucene-Solr-Maven-trunk/433/

1 tests failed.
FAILED:  org.apache.solr.handler.dataimport.TestScriptTransformer.testOneparam

Error Message:
Cannot load Script Engine for language: JavaScript

Stack Trace:
org.apache.solr.handler.dataimport.DataImportHandlerException: Cannot load Script Engine for language: JavaScript
	at org.apache.solr.handler.dataimport.ScriptTransformer.initEngine(ScriptTransformer.java:76)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13235609" author="jdyer" created="Thu, 22 Mar 2012 14:57:22 +0000"  >&lt;p&gt;I missed one.  Sorry about that.  Should be fixed now.&lt;/p&gt;</comment>
                            <comment id="13235688" author="steve_rowe" created="Thu, 22 Mar 2012 16:27:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;I missed one. Sorry about that. Should be fixed now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks James, I think it&apos;s fixed - just now in the console output from the Jenkins Maven trunk job (still running as I write this), I saw:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Running org.apache.solr.handler.dataimport.TestScriptTransformer
NOTE: Assume failed in &apos;testCheckScript(org.apache.solr.handler.dataimport.TestScriptTransformer)&apos; (ignored): got: &amp;lt;org.apache.lucene.util.InternalAssumptionViolatedException: failed assumption: This JVM does not have Rhino installed.  Test Skipped.&amp;gt;, expected: null
NOTE: Assume failed in &apos;testBasic(org.apache.solr.handler.dataimport.TestScriptTransformer)&apos; (ignored): got: &amp;lt;org.apache.lucene.util.InternalAssumptionViolatedException: failed assumption: This JVM does not have Rhino installed.  Test Skipped.&amp;gt;, expected: null
NOTE: Assume failed in &apos;testOneparam(org.apache.solr.handler.dataimport.TestScriptTransformer)&apos; (ignored): got: &amp;lt;org.apache.lucene.util.InternalAssumptionViolatedException: failed assumption: This JVM does not have Rhino installed.  Test Skipped.&amp;gt;, expected: null
Tests run: 4, Failures: 0, Errors: 0, Skipped: 3, Time elapsed: 0.023 sec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12519091" name="SOLR-3260.patch" size="2340" author="jdyer" created="Tue, 20 Mar 2012 16:08:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232379</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03fqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17982</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>