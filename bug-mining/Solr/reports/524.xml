<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:19:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2034] javabin should use UTF-8, not modified UTF-8</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2034</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;for better interoperability, javabin should use standard UTF-8 instead of modified UTF-8 (&lt;a href=&quot;http://www.unicode.org/reports/tr26/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.unicode.org/reports/tr26/&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12471143">SOLR-2034</key>
            <summary>javabin should use UTF-8, not modified UTF-8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rcmuir">Robert Muir</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Aug 2010 19:59:20 +0000</created>
                <updated>Fri, 10 May 2013 10:38:56 +0000</updated>
                            <resolved>Fri, 27 Aug 2010 16:00:06 +0000</resolved>
                                                    <fixVersion>3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12898391" author="hossman" created="Fri, 13 Aug 2010 19:46:21 +0000"  >&lt;p&gt;+1 to the patch&lt;/p&gt;

&lt;p&gt;My only concern is upgrade compatibility &amp;#8211; it would be preferable if people upgrading either Solr or their SolrJ client (but not both at the exact same moment) would still have a functioning system.&lt;/p&gt;

&lt;p&gt;As i recall, the BinaryResponseWriter / Parser use a version param and version metadata in the response (just like the XmlResponseWriter) to indicate the codec version requested and the code version returned &amp;#8211; this seems like the kind of thing that should probably warrant a new coden impl with a new version number.&lt;/p&gt;

&lt;p&gt;that said: i didn&apos;t follow the details of the binary response writer / parser / codec implementation very closely, so i have no idea how hard it will be to make it all work smoothly for people: if it&apos;s a pain in the ass then i&apos;m totally fine with saying that SolrJ 3.x can&apos;t talk to Solr 1.x (and vice versa) ... but we should still probably update the binary code version info to make it clear there is a difference&lt;/p&gt;</comment>
                            <comment id="12898405" author="rcmuir" created="Fri, 13 Aug 2010 20:19:38 +0000"  >&lt;p&gt;Hoss, thanks, I agree with regards to backwards compat, unfortunately its not immediately obvious to me how to implement the versioning (seamless like you said, would be preferable).&lt;/p&gt;

&lt;p&gt;the only thing i see is the version in the response parser, but i will play some and see if i can do it in a versioned way (any more pointers would be very helpful).&lt;/p&gt;

&lt;p&gt;ultimately the goal would be to make it easier for non-java clients to implement this protocol. although the wiki says only the java client implements this, i found an issue for the .NET client here: &lt;a href=&quot;http://code.google.com/p/solrnet/issues/detail?id=71&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.google.com/p/solrnet/issues/detail?id=71&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I took a look at the github source code (&lt;a href=&quot;http://github.com/mausch/SolrNet/blob/javabin/SolrNet/Impl/JavaBinCodec.cs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://github.com/mausch/SolrNet/blob/javabin/SolrNet/Impl/JavaBinCodec.cs&lt;/a&gt;) and was a little concerned to see writeChars implemented with Encoding.UTF8.GetBytes... I know its likely a work in progress etc, but I think it illustrates the benefits of standard UTF-8.&lt;/p&gt;
</comment>
                            <comment id="12899193" author="rcmuir" created="Mon, 16 Aug 2010 23:43:07 +0000"  >&lt;p&gt;I bumped the BinaryResponseParser version (only version i can find here).&lt;/p&gt;

&lt;p&gt;its not really obvious to me if this is actually written over the wire / how to conditionalize modified-UTF-8 based on it, and seems risky.&lt;/p&gt;

&lt;p&gt;I think its best to just go to UTF-8 and never look back (but if someone knows how to support modified UTF-8 when version=1, thats great, I just don&apos;t have the heart)&lt;/p&gt;</comment>
                            <comment id="12899730" author="ryantxu" created="Wed, 18 Aug 2010 05:24:31 +0000"  >&lt;p&gt;I don&apos;t think adding many hoops for back compatibility is worth the trouble.  Note that that does not mean people can not use solrj to talk across different versions &amp;#8211; they may have to use xml though.&lt;/p&gt;</comment>
                            <comment id="12900076" author="rcmuir" created="Wed, 18 Aug 2010 22:35:52 +0000"  >&lt;p&gt;Thanks Ryan, I&apos;ll wait a few days before committing to see if there are any objections.&lt;/p&gt;

&lt;p&gt;If there aren&apos;t, i&apos;ll update wiki / CHANGES loud and clear that the binary format has changed.&lt;/p&gt;</comment>
                            <comment id="12900423" author="hossman" created="Thu, 19 Aug 2010 20:03:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t think adding many hoops for back compatibility is worth the trouble. Note that that does not mean people can not use solrj to talk across different versions - they may have to use xml though....&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, my chief concern is what happens when someone tries to use SolrJ 1.4 to talk to Solr 3.1 w/javabin (or vice versa).&lt;/p&gt;

&lt;p&gt;A) If they get an error: great, i&apos;m totaly fine with that &amp;#8211; we just document that they should use XML in this case.&lt;/p&gt;

&lt;p&gt;B) If the commands succeed, but the string data is &lt;em&gt;always&lt;/em&gt; corrupted, that&apos;s not ideal &amp;#8211; but not totally horrible since the probably should be immediately obvious and should have read the documentation and known not to do that.&lt;/p&gt;

&lt;p&gt;C) if the commands succeed, but the string data is &lt;em&gt;sometimes&lt;/em&gt; corrupted (as i recall, not every character is different in UTF8 vs Java&apos;s  modified UTF8, correct?) then that seems really bad ... people may start using javabin to update their index and not notice for quite some time that big hard to identify chunks of their data are corrupted.&lt;/p&gt;

&lt;p&gt;as long a someone sanity checks that the situation is either #A or #B before committing, i&apos;m totally cool with it ... but #C scares the bejesus out of me.&lt;/p&gt;

&lt;p&gt;(i&apos;ll try to run some tests myself in the next few days if no one else gets a chance)&lt;/p&gt;</comment>
                            <comment id="12900432" author="yseeley@gmail.com" created="Thu, 19 Aug 2010 20:23:59 +0000"  >&lt;p&gt;Seems OK.  I think modified UTF-8 was originally used so that the string chars could be directly written to the output stream instead of to a temp buffer.  But copying to a temp buffer first shouldn&apos;t have that much overhead.&lt;/p&gt;

&lt;p&gt;JavaBinCodec.VERSION should be bumped.&lt;br/&gt;
It is serialized and verified when decoding, and currently an exception is thrown if it does not match the current version.&lt;/p&gt;</comment>
                            <comment id="12900442" author="rcmuir" created="Thu, 19 Aug 2010 20:31:41 +0000"  >&lt;p&gt;Hoss man, I hear your concerns but i don&apos;t understand how we can address any of this.&lt;/p&gt;

&lt;p&gt;This is really one of the problems of modified-UTF8, and really my big concern with using it (that clients will be wrongly written, see my example above). Its not really possible or reasonable to address it at the javabin layer: it needs to be done at a higher protocol level.&lt;/p&gt;

&lt;p&gt;of course, if we can figure this out, then maybe it would be easy to provide back compat too, but i didnt see any obvious places in the code where any versioning is written over the wire.&lt;/p&gt;</comment>
                            <comment id="12900443" author="rcmuir" created="Thu, 19 Aug 2010 20:34:07 +0000"  >&lt;blockquote&gt;
&lt;p&gt;JavaBinCodec.VERSION should be bumped.&lt;br/&gt;
It is serialized and verified when decoding, and currently an exception is thrown if it does not match the current version.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ahhh, I totally missed that version byte. So did I bump the wrong version in the patch (BinaryResponseParser&apos;s)? I&apos;ll fix&lt;/p&gt;</comment>
                            <comment id="12900451" author="rcmuir" created="Thu, 19 Aug 2010 20:54:49 +0000"  >&lt;p&gt;OK, i bumped the byte version as Yonik suggested, and tried to use an old client.&lt;/p&gt;

&lt;p&gt;Here&apos;s the exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.RuntimeException: Invalid version or the data in not in &apos;javabin&apos; format
	at org.apache.solr.common.util.JavaBinCodec.unmarshal(JavaBinCodec.java:99)
	at org.apache.solr.client.solrj.impl.BinaryResponseParser.processResponse(BinaryResponseParser.java:39)
	at org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:477)
	at org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:244)
	at org.apache.solr.client.solrj.request.QueryRequest.process(QueryRequest.java:89)
	at org.apache.solr.client.solrj.SolrServer.query(SolrServer.java:118)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12901204" author="hossman" created="Sun, 22 Aug 2010 19:57:53 +0000"  >&lt;p&gt;beautiful.&lt;/p&gt;

&lt;p&gt;+1 commit&lt;/p&gt;</comment>
                            <comment id="12901225" author="rcmuir" created="Mon, 23 Aug 2010 00:14:41 +0000"  >&lt;p&gt;thanks hoss, ill commit tomorrow if there are no objections.&lt;/p&gt;</comment>
                            <comment id="12901347" author="rcmuir" created="Mon, 23 Aug 2010 10:54:15 +0000"  >&lt;p&gt;well, i object to my own patch, because i think it would suck to have solrj depend on the lucene jar.&lt;/p&gt;

&lt;p&gt;here&apos;s a modified version with its own utf-8 conversion and no bytesref/unicodeutil&lt;/p&gt;</comment>
                            <comment id="12902744" author="rcmuir" created="Thu, 26 Aug 2010 02:11:26 +0000"  >&lt;p&gt;if no one objects to the latest patch, i&apos;d like to commit in a day or two.&lt;/p&gt;</comment>
                            <comment id="12903455" author="rcmuir" created="Fri, 27 Aug 2010 16:00:06 +0000"  >&lt;p&gt;Committed revision 990180 (trunk), 990183 (3x), and updated the &apos;javabin&apos; page on the wiki.&lt;/p&gt;

&lt;p&gt;I tried to make the change easy to understand in CHANGES/wiki, if you have improvements to&lt;br/&gt;
the wording please do not hesitate.&lt;/p&gt;</comment>
                            <comment id="12903940" author="noble.paul" created="Sun, 29 Aug 2010 06:35:56 +0000"  >&lt;p&gt;Is interoperability the issue? The question is , is there any other client using javabin format? Or is it just to be standards compliant?&lt;/p&gt;</comment>
                            <comment id="12903964" author="rcmuir" created="Sun, 29 Aug 2010 12:56:22 +0000"  >&lt;p&gt;Noble, please see my comment: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2034?focusedCommentId=12898405&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12898405&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-2034?focusedCommentId=12898405&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12898405&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;thats an example of another client trying to implement javabin, and wrongly implementing the modified-utf8 conversion... but there doesn&apos;t need to be any justification to not use modified utf-8 over the wire, its just wrong.&lt;/p&gt;</comment>
                            <comment id="12903974" author="noble.paul" created="Sun, 29 Aug 2010 14:37:38 +0000"  >&lt;p&gt;ok. I was wondering if we are planning to implement javabin in any other languages&lt;/p&gt;</comment>
                            <comment id="12904002" author="rcmuir" created="Sun, 29 Aug 2010 18:08:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;ok. I was wondering if we are planning to implement javabin in any other languages&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I can&apos;t speak for this, except to say that if we wanted to, I think implementing the encoding&lt;br/&gt;
portion would now be significantly easier, especially for languages that don&apos;t use an&lt;br/&gt;
internal UTF-16 representation like Java does.&lt;/p&gt;</comment>
                            <comment id="12925576" author="elyograg" created="Wed, 27 Oct 2010 22:03:30 +0000"  >&lt;p&gt;I started upgrading my slave shards today from 1.4.1 to 3.1 and ran into a bit of a showstopper:&lt;/p&gt;

&lt;p&gt;SEVERE: Master at: &lt;a href=&quot;http://HOST:8983/solr/live/replication&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://HOST:8983/solr/live/replication&lt;/a&gt; is not available. Index fetch failed. Exception: Invalid version or the data in not in &apos;javabin&apos; format&lt;/p&gt;

&lt;p&gt;What advice do you have?  I can&apos;t upgrade both master and slave at the same time - we have to be able to fully test against the new version.  I would rather not do the testing with completely static indexes, it would be better to have data being added and deleted normally.&lt;/p&gt;</comment>
                            <comment id="12925614" author="ryantxu" created="Thu, 28 Oct 2010 00:20:50 +0000"  >&lt;p&gt;Can you switch to xml format?  then when everythign is upgraded, switch back?&lt;/p&gt;</comment>
                            <comment id="12925638" author="elyograg" created="Thu, 28 Oct 2010 01:23:23 +0000"  >&lt;p&gt;I would be happy to take that route.  You&apos;ll have to tell me how to switch to XML.  I have already tried a couple of things that didn&apos;t work.&lt;/p&gt;</comment>
                            <comment id="12925642" author="ryantxu" created="Thu, 28 Oct 2010 01:30:00 +0000"  >&lt;p&gt;try:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;server.setParser(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XMLResponseParser()); 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You may also have to set:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
server.setRequestWriter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RequestWriter());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12925648" author="elyograg" created="Thu, 28 Oct 2010 01:49:45 +0000"  >&lt;p&gt;So it requires modifying the code?  I am not a Java programmer, nor am I familiar with Solr internals and objects.  I do understand programming principles and know a few other languages, so I can sometimes muddle my way through the unfamiliar.&lt;/p&gt;

&lt;p&gt;I took a look at ReplicationHandler.java and RequestHandlerBase.java and was not able to find anything having to do with javabin or looking remotely like what you mentioned.  I did find a reference to BinaryQueryResponseWriter, but the section of code that uses it also has this in it, suggesting that replication and javabin might be heavily intertwined:&lt;/p&gt;

&lt;p&gt;throw new RuntimeException(&quot;This is a binary writer , Cannot write to a characterstream&quot;);&lt;/p&gt;</comment>
                            <comment id="13197286" author="janhoy" created="Tue, 31 Jan 2012 21:25:35 +0000"  >&lt;p&gt;Adding correct fixed version&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12478533">SOLR-2204</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12452802" name="SOLR-2034.patch" size="8867" author="rcmuir" created="Mon, 23 Aug 2010 10:54:15 +0000"/>
                            <attachment id="12452573" name="SOLR-2034.patch" size="6930" author="rcmuir" created="Thu, 19 Aug 2010 20:54:49 +0000"/>
                            <attachment id="12452230" name="SOLR-2034.patch" size="4596" author="rcmuir" created="Mon, 16 Aug 2010 23:43:07 +0000"/>
                            <attachment id="12451620" name="SOLR-2034.patch" size="6215" author="rcmuir" created="Mon, 9 Aug 2010 19:59:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5456</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03n6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19190</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>