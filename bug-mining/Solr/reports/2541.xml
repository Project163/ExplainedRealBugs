<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6686] facet.threads can return wrong results when using facet.prefix multiple times on same field</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6686</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using facet.threads, SimpleFacets can return the wrong results when using facet.prefix multiple times on the same field.&lt;/p&gt;

&lt;p&gt;The problem is that SimpleFacets essentially stores the prefix value in a global variable, rather than passing the current prefix value into the Callable. So, the prefix value that is used when getting the term counts is whichever one was the last one parsed.&lt;/p&gt;

&lt;p&gt;STEPS TO REPRODUCE:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create a document with a string field named &quot;myFieldName&quot; and value &quot;foo&quot;&lt;/li&gt;
	&lt;li&gt;Create another document with a string field named &quot;myFieldName&quot; and value &quot;bar&quot;&lt;/li&gt;
	&lt;li&gt;Run this query: 
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;q=*:*&amp;amp;rows=0&amp;amp;facet=true&amp;amp;facet.field={!key=key1 facet.prefix=foo}myFieldName&amp;amp;facet.field={!key=key2 facet.prefix=bar}myFieldName&amp;amp;facet.threads=1&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;EXPECTED:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;lst name=&quot;facet_fields&quot;&amp;gt;
  &amp;lt;lst name=&quot;key1&quot;&amp;gt;
    &amp;lt;int name=&quot;foo&quot;&amp;gt;1&amp;lt;/int&amp;gt;
  &amp;lt;/lst&amp;gt;
  &amp;lt;lst name=&quot;key2&quot;&amp;gt;
    &amp;lt;int name=&quot;bar&quot;&amp;gt;1&amp;lt;/int&amp;gt;
  &amp;lt;/lst&amp;gt;
&amp;lt;/lst&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ACTUAL:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;lst name=&quot;facet_fields&quot;&amp;gt;
  &amp;lt;lst name=&quot;key1&quot;&amp;gt;
    &amp;lt;int name=&quot;bar&quot;&amp;gt;1&amp;lt;/int&amp;gt;
  &amp;lt;/lst&amp;gt;
  &amp;lt;lst name=&quot;key2&quot;&amp;gt;
    &amp;lt;int name=&quot;bar&quot;&amp;gt;1&amp;lt;/int&amp;gt;
  &amp;lt;/lst&amp;gt;
&amp;lt;/lst&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m using 4.9, but I think this affects all versions.&lt;/p&gt;

&lt;p&gt;A user previously reported this here:&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201405.mbox/%3CBAY169-W52CEF09187A88286DE5417D5270@phx.gbl%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201405.mbox/%3CBAY169-W52CEF09187A88286DE5417D5270@phx.gbl%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think this affects parameters other than facet.prefix, but I have not tried that yet.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12752039">SOLR-6686</key>
            <summary>facet.threads can return wrong results when using facet.prefix multiple times on same field</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="michaelryan">Michael Ryan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 31 Oct 2014 18:57:13 +0000</created>
                <updated>Mon, 9 May 2016 18:47:27 +0000</updated>
                            <resolved>Fri, 26 Jun 2015 17:06:40 +0000</resolved>
                                    <version>4.9</version>
                                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14351863" author="tpunder" created="Sun, 8 Mar 2015 02:00:08 +0000"  >&lt;p&gt;I just ran into this issue on 5.0.0.&lt;/p&gt;

&lt;p&gt;When using facet.threads=-1 I was seeing inconsistent counts or random 400 errors saying &quot;facet.prefix is not supported on numeric types&quot; when refreshing the same query.&lt;/p&gt;</comment>
                            <comment id="14353247" author="tpunder" created="Mon, 9 Mar 2015 17:38:59 +0000"  >&lt;p&gt;Initial attempt at fixing this.  I&apos;ve removed the mutable state from SimpleFacets and changed the parsedParams() method to return an instance of a new static inner class called ParsedParams.  This ParsedParams instance is then passed around the the various methods.&lt;/p&gt;

&lt;p&gt;It&apos;s not the cleanest fix but it is working so far for me.  A better fix probably involves a larger refactoring of SimpleFacets.&lt;/p&gt;</comment>
                            <comment id="14496335" author="tpunder" created="Wed, 15 Apr 2015 15:22:27 +0000"  >&lt;p&gt;Any feedback on the patch?&lt;/p&gt;

&lt;p&gt;Any chance of this making it into 5.2?&lt;/p&gt;</comment>
                            <comment id="14499593" author="shalinmangar" created="Fri, 17 Apr 2015 10:27:05 +0000"  >&lt;p&gt;Hi Tim, this will go into 5.2. I was about to do something similar for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6353&quot; title=&quot;Let Range Facets Hang off of Pivots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6353&quot;&gt;&lt;del&gt;SOLR-6353&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4212&quot; title=&quot;Let facet queries hang off of pivots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4212&quot;&gt;&lt;del&gt;SOLR-4212&lt;/del&gt;&lt;/a&gt; so I incorporated your changes to my patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4212&quot; title=&quot;Let facet queries hang off of pivots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4212&quot;&gt;&lt;del&gt;SOLR-4212&lt;/del&gt;&lt;/a&gt;. It&apos;s almost ready and should be committed next week.&lt;/p&gt;</comment>
                            <comment id="14600029" author="tpunder" created="Wed, 24 Jun 2015 19:50:48 +0000"  >&lt;p&gt;Does it make sense fix this issue (which is a bug) separately from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6353&quot; title=&quot;Let Range Facets Hang off of Pivots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6353&quot;&gt;&lt;del&gt;SOLR-6353&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4212&quot; title=&quot;Let facet queries hang off of pivots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4212&quot;&gt;&lt;del&gt;SOLR-4212&lt;/del&gt;&lt;/a&gt; (which as far as I can tell are new features)?&lt;/p&gt;</comment>
                            <comment id="14601682" author="shalinmangar" created="Thu, 25 Jun 2015 18:30:21 +0000"  >&lt;p&gt;You&apos;re right Tim. I&apos;ll commit this separately. TBH, I didn&apos;t think &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4212&quot; title=&quot;Let facet queries hang off of pivots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4212&quot;&gt;&lt;del&gt;SOLR-4212&lt;/del&gt;&lt;/a&gt; would take so long.&lt;/p&gt;</comment>
                            <comment id="14602946" author="shalinmangar" created="Fri, 26 Jun 2015 14:33:32 +0000"  >&lt;p&gt;Here&apos;s a patch which applies on trunk.&lt;/p&gt;</comment>
                            <comment id="14603045" author="shalinmangar" created="Fri, 26 Jun 2015 15:31:49 +0000"  >&lt;p&gt;Added a test that fails without the fix. I&apos;ll commit shortly.&lt;/p&gt;</comment>
                            <comment id="14603056" author="tpunder" created="Fri, 26 Jun 2015 15:38:33 +0000"  >&lt;p&gt;Cool.  Thank you!&lt;/p&gt;</comment>
                            <comment id="14603099" author="jira-bot" created="Fri, 26 Jun 2015 16:00:23 +0000"  >&lt;p&gt;Commit 1687791 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1687791&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1687791&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6686&quot; title=&quot;facet.threads can return wrong results when using facet.prefix multiple times on same field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6686&quot;&gt;&lt;del&gt;SOLR-6686&lt;/del&gt;&lt;/a&gt;: facet.threads can return wrong results when using facet.prefix multiple times on same field&lt;/p&gt;</comment>
                            <comment id="14603204" author="jira-bot" created="Fri, 26 Jun 2015 17:05:42 +0000"  >&lt;p&gt;Commit 1687811 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1687811&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1687811&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6686&quot; title=&quot;facet.threads can return wrong results when using facet.prefix multiple times on same field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6686&quot;&gt;&lt;del&gt;SOLR-6686&lt;/del&gt;&lt;/a&gt;: facet.threads can return wrong results when using facet.prefix multiple times on same field&lt;/p&gt;</comment>
                            <comment id="14603208" author="shalinmangar" created="Fri, 26 Jun 2015 17:06:40 +0000"  >&lt;p&gt;Thanks Michael and Tim!&lt;/p&gt;</comment>
                            <comment id="14713154" author="shalinmangar" created="Wed, 26 Aug 2015 13:05:55 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12508465">SOLR-2548</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12742142" name="SOLR-6686.patch" size="74695" author="shalin" created="Fri, 26 Jun 2015 15:31:49 +0000"/>
                            <attachment id="12742128" name="SOLR-6686.patch" size="37129" author="shalin" created="Fri, 26 Jun 2015 14:33:32 +0000"/>
                            <attachment id="12703448" name="SOLR-6686.patch" size="33608" author="tpunder" created="Mon, 9 Mar 2015 17:38:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21tv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>