<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:35:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12243] Edismax missing phrase queries when phrases contain multiterm synonyms</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12243</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;synonyms.txt:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
allergic, hypersensitive
aspirin, acetylsalicylic acid
dog, canine, canis familiris, k 9
rat, rattus
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;request handler:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;requestHandler name=&lt;span class=&quot;code-quote&quot;&gt;&quot;/test_qparse_error&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.SearchHandler&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;defaults&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!-- Query settings --&amp;gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;defType&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;edismax&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;tie&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; 0.4&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;qf&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;title^100&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;pf&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;title~20^5000&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;pf2&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;title~11&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;pf3&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;title~22^1000&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;df&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;text&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &amp;lt;!-- mm If two or fewer clauses exist, they all must match. 
 If three to five clauses exist, one can be missing. If six to eight clauses exist, all but three must match. 
 If more than nine clauses exist, only require 30% to match.--&amp;gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;mm&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;3&amp;amp;lt;-1 6&amp;amp;lt;-3 9&amp;amp;lt;30%&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;q.alt&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;*:*&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;25&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/requestHandler&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Phrase queries (pf, pf2, pf3) containing &quot;dog&quot; or &quot;aspirin&quot; &#160;against the above list will not be generated.&lt;/p&gt;

&lt;p&gt;&quot;allergic reaction dog&quot; will generate pf2: &quot;allergic reaction&quot;, but not pf:&quot;allergic reaction dog&quot;, pf2: &quot;reaction dog&quot;, or pf3: &quot;allergic reaction dog&quot;&lt;/p&gt;

&lt;p&gt;&quot;aspirin dose in rats&quot; will generate pf3: &quot;dose ? rats&quot; but not pf2: &quot;aspirin dose&quot; or pf3:&quot;aspirin dose ?&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;RHEL, MacOS X&lt;/p&gt;

&lt;p&gt;Do not believe this is environment-specific.&lt;/p&gt;</environment>
        <key id="13153777">SOLR-12243</key>
            <summary>Edismax missing phrase queries when phrases contain multiterm synonyms</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="ehaubert">Elizabeth Haubert</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Apr 2018 17:29:22 +0000</created>
                <updated>Sat, 15 Feb 2020 23:43:48 +0000</updated>
                            <resolved>Mon, 5 Nov 2018 17:20:27 +0000</resolved>
                                    <version>7.1</version>
                                    <fixVersion>7.6</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>10</votes>
                                    <watches>16</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16444682" author="ehaubert" created="Thu, 19 Apr 2018 19:42:34 +0000"  >&lt;p&gt;I think the problem is&#160;EdismaxQParser:: ln 1393. &#160;super.getFieldQuery returns a SpanNearQuery, which is not an instanceof type BooleanQuery or PhraseQuery or MultiPhraseQuery. &#160;So the query parser decides it didn&apos;t get a legit phrase query back, and throws it out.&#160;&lt;/p&gt;

&lt;p&gt;What is the history around what query types are allowed as a phrase query and which aren&apos;t?&#160;&lt;/p&gt;

&lt;p&gt;private Query getQuery() {&lt;br/&gt;
 try {&lt;/p&gt;

&lt;p&gt; switch (type) {&lt;br/&gt;
 case FIELD: // fallthrough&lt;br/&gt;
 case PHRASE:&lt;br/&gt;
 Query query;&lt;br/&gt;
 if (val == null) &lt;/p&gt;
{
 query = super.getFieldQuery(field, vals, false);
 }
&lt;p&gt; else &lt;/p&gt;
{
 query = super.getFieldQuery(field, val, type == QType.PHRASE, false);
 }
&lt;p&gt; // Boolean query on a whitespace-separated string&lt;br/&gt;
 // If these were synonyms we would have a SynonymQuery&lt;br/&gt;
 if (query instanceof BooleanQuery) &lt;/p&gt;
{
 BooleanQuery bq = (BooleanQuery) query;
 query = SolrPluginUtils.setMinShouldMatch(bq, minShouldMatch, false);
 }
&lt;p&gt; if (query instanceof PhraseQuery) {&lt;br/&gt;
 PhraseQuery pq = (PhraseQuery)query;&lt;br/&gt;
 if (minClauseSize &amp;gt; 1 &amp;amp;&amp;amp; pq.getTerms().length &amp;lt; minClauseSize) return null;&lt;br/&gt;
 PhraseQuery.Builder builder = new PhraseQuery.Builder();&lt;br/&gt;
 Term[] terms = pq.getTerms();&lt;br/&gt;
 int[] positions = pq.getPositions();&lt;br/&gt;
 for (int i = 0; i &amp;lt; terms.length; ++i) &lt;/p&gt;
{
 builder.add(terms[i], positions[i]);
 }
&lt;p&gt; builder.setSlop(slop);&lt;br/&gt;
 query = builder.build();&lt;br/&gt;
 } else if (query instanceof MultiPhraseQuery) {&lt;br/&gt;
 MultiPhraseQuery mpq = (MultiPhraseQuery)query;&lt;br/&gt;
 if (minClauseSize &amp;gt; 1 &amp;amp;&amp;amp; mpq.getTermArrays().length &amp;lt; minClauseSize) return null;&lt;br/&gt;
 if (slop != mpq.getSlop()) &lt;/p&gt;
{
 query = new MultiPhraseQuery.Builder(mpq).setSlop(slop).build();
 }
&lt;p&gt; &lt;b&gt;} else if (minClauseSize &amp;gt; 1) {&lt;/b&gt;&lt;br/&gt;
 &lt;b&gt;// if it&apos;s not a type of phrase query, it doesn&apos;t meet the minClauseSize requirements&lt;/b&gt;&lt;br/&gt;
 &lt;b&gt;return null;&lt;/b&gt;&lt;br/&gt;
 &lt;b&gt;}&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16448067" author="ehaubert" created="Mon, 23 Apr 2018 12:40:41 +0000"  >&lt;p&gt;OK. Patch pending &#160;to handle that else if.&lt;/p&gt;

&lt;p&gt;Duplicated&#160;the tests&#160;from TestEdismaxQParser.testPsPf with a multiterm synonym &quot;bar, tropical cyclone&quot;, which is mostly passing except for those where the queryphrase is re-ordered with slop. &#160;Default on those SpanNear queries is inorder=true, which is very different semantics from existing phrase queries with slop.&lt;/p&gt;

&lt;p&gt;Looking into that.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16448649" author="ehaubert" created="Mon, 23 Apr 2018 18:28:20 +0000"  >&lt;p&gt;Patch:&lt;/p&gt;

&lt;p&gt;(1) allows span queries to be returned for phrase query clauses&lt;/p&gt;

&lt;p&gt;(2) sets &quot;inOrder&quot; = false if phrase slop is set, to be consistent with semantics for pf clauses&lt;/p&gt;

&lt;p&gt;(3) Unit tests for pf, pf2 and pf3 clauses containing multi-term synonyms.&#160;&lt;/p&gt;</comment>
                            <comment id="16449639" author="lucenesolrqa" created="Tue, 24 Apr 2018 10:55:38 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 1 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m  2s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 55s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 55s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 34s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 30s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 30s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 16m 10s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 57m 37s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; 80m 49s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12920318/SOLR-12243.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12920318/SOLR-12243.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene1-us-west 3.13.0-88-generic #135-Ubuntu SMP Wed Jun 8 21:10:42 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 0d969ab &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.3 compiled on April 8 2014 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.8.0_152 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/66/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/66/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: lucene/core solr/core U: . &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/66/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/66/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16452972" author="ehaubert" created="Wed, 25 Apr 2018 19:54:24 +0000"  >&lt;p&gt;I&apos;d really like to make a bugfix release of the 7_1 branch with this, although the problem is still present on 7.x as well. &#160;Thoughts?&lt;/p&gt;

&lt;p&gt;The actual change is quite small.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16453324" author="elyograg" created="Thu, 26 Apr 2018 01:16:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehaubert&quot; class=&quot;user-hover&quot; rel=&quot;ehaubert&quot;&gt;ehaubert&lt;/a&gt;, even if the patch is accepted and committed, it is extremely unlikely that there will be a new 7.1.x release.  It&apos;s far more likely that it will be released with 7.4.0 or later.  You&apos;re always free to build your own snapshot release from the 7.1.x source.&lt;/p&gt;

&lt;p&gt;I do not know anything about the change or the problem you&apos;ve encountered, so I can&apos;t comment there.&lt;/p&gt;</comment>
                            <comment id="16453738" author="ehaubert" created="Thu, 26 Apr 2018 09:21:14 +0000"  >&lt;p&gt;Yes, &#160;I&apos;m making a snapshot build with the patch already. &#160;I started with 7.1, because that is where I found the issue. &#160;What&#160;is the current development branch? branch_7x? master? &#160;&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16454186" author="elyograg" created="Thu, 26 Apr 2018 13:26:40 +0000"  >&lt;p&gt;In general, we make changes to master.  Then we backport to the current stable development branch.&lt;/p&gt;

&lt;p&gt;The current stable development branch is branch_7x.&lt;/p&gt;

&lt;p&gt;If there are any releases currently underway or due to be underway shortly, and the release manager for that version agrees with the change, the change MIGHT be backported to a more specific branch, such as branch_7_3.&lt;/p&gt;

&lt;p&gt;At some point in the future that has not yet been determined, we will create branch_8x from master and begin the process of releasing 8.0.0.  At that point, work on branch_7x is likely to stop.&lt;/p&gt;</comment>
                            <comment id="16454309" author="ehaubert" created="Thu, 26 Apr 2018 14:30:28 +0000"  >&lt;p&gt;OK; making a patch against master then. &#160;The &quot;how to contribute&quot; doc says that patches should be named by the Jira ticket. &#160;Is there a convention to specify what point in time a patch was made? In this case, the code change is so small I doubt it matters, and I&apos;ll just replace the existing patch. &#160; &#160;But for anything substantial, it might.&lt;/p&gt;

&lt;p&gt;Who is the release manager for 7.4 or 8?&lt;/p&gt;</comment>
                            <comment id="16454413" author="elyograg" created="Thu, 26 Apr 2018 15:45:37 +0000"  >&lt;p&gt;The convention is to name all patches the same for any issue.  So any patch you would upload for this issue would be named &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt;.patch.  Jira will keep all of them available, and it will be easy to determine which one is the latest.&lt;/p&gt;

&lt;p&gt;There isn&apos;t a release manager yet for the versions you mentioned.  Until somebody volunteers for the work, nobody has that role.&lt;/p&gt;</comment>
                            <comment id="16456352" author="ehaubert" created="Fri, 27 Apr 2018 12:59:46 +0000"  >&lt;p&gt;No change to the patch against master, &#160;there isn&apos;t that much to it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16456670" author="alessandro.benedetti" created="Fri, 27 Apr 2018 16:03:18 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehaubert&quot; class=&quot;user-hover&quot; rel=&quot;ehaubert&quot;&gt;ehaubert&lt;/a&gt;, how ere you able to generate the&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lucenesolrqa&quot; class=&quot;user-hover&quot; rel=&quot;lucenesolrqa&quot;&gt;lucenesolrqa&lt;/a&gt;&#160;report ?&lt;br/&gt;
Did that happen automatically ?&lt;/p&gt;</comment>
                            <comment id="16456720" author="ehaubert" created="Fri, 27 Apr 2018 16:45:29 +0000"  >&lt;p&gt;My understanding from the &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;HowToContribute&lt;/a&gt;&#160;is that is supposed to happen automagically if the patch is named correctly, but I didn&apos;t knowingly do anything to cause it to happen. &#160;Code is pretty straightforward, but I&apos;m having a&#160;bit&#160;of a learning curve on the non-code things that need to happen.&lt;/p&gt;</comment>
                            <comment id="16456834" author="alessandro.benedetti" created="Fri, 27 Apr 2018 17:54:09 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehaubert&quot; class=&quot;user-hover&quot; rel=&quot;ehaubert&quot;&gt;ehaubert&lt;/a&gt;, thanks for the reply.&lt;/p&gt;

&lt;p&gt;I think the current patch could be completed adding a test that verifies the actual query (building) parsing.&lt;br/&gt;
 The bug affects the query (building) parsing in the end, so, testing on results per query&#160;can be effective, but it&apos;s not testing the bugfix.&lt;/p&gt;

&lt;p&gt;I will just post a brutal copy and paste here, If the Jira is still open I will push a PR with the fix in the next days.&lt;/p&gt;

&lt;p&gt;Adding something like this should work :&lt;/p&gt;

&lt;p&gt;public void testEdismaxQueryParsing_multiTermWithPf_shouldParseCorrectPhraseQueries() throws Exception&lt;/p&gt;

&lt;p&gt;{ Query q = QParser.getParser(&quot;foo a b bar&quot;,&quot;edismax&quot;,true, req(params(&quot;sow&quot;, &quot;false&quot;,&quot;qf&quot;, &quot;text^10&quot;,&quot;pf&quot;, &quot;text^10&quot;,&quot;pf2&quot;, &quot;text^5&quot;,&quot;pf3&quot;, &quot;text^8&quot;))).getQuery(); assertEquals(&quot;&lt;ins&gt;(&quot; + &quot;((text:foo)^10.0) ((text:a)^10.0) ((text:b)^10.0) (((+text:tropical +text:cyclone) text:bar)^10.0)) &quot; + &quot;((spanNear([text:foo, text:a, text:b, spanOr([spanNear(&lt;span class=&quot;error&quot;&gt;&amp;#91;text:tropical, text:cyclone&amp;#93;&lt;/span&gt;, 0, true), text:bar])], 0, true))^10.0) &quot; + &quot;(((text:\&quot;foo a\&quot;)^5.0) ((text:\&quot;a b\&quot;)^5.0) ((spanNear([text:b, spanOr([spanNear(&lt;span class=&quot;error&quot;&gt;&amp;#91;text:tropical, text:cyclone&amp;#93;&lt;/span&gt;, 0, true), text:bar])], 0, true))^5.0)) &quot; + &quot;(((text:\&quot;foo a b\&quot;)^8.0) ((spanNear([text:a, text:b, spanOr([spanNear(&lt;span class=&quot;error&quot;&gt;&amp;#91;text:tropical, text:cyclone&amp;#93;&lt;/span&gt;, 0, true), text:bar])], 0, true))^8.0))&quot;, q.toString()); q = QParser.getParser(&quot;foo a b tropical cyclone&quot;,&quot;edismax&quot;,true, req(params(&quot;qf&quot;, &quot;text^10&quot;,&quot;pf&quot;, &quot;text^10&quot;,&quot;pf2&quot;, &quot;text^5&quot;,&quot;pf3&quot;, &quot;text^8&quot;))).getQuery(); assertEquals(&quot;&lt;/ins&gt;(&quot; + &quot;((text:foo)^10.0) ((text:a)^10.0) ((text:b)^10.0) ((text:bar (+text:tropical +text:cyclone))^10.0)) &quot; + &quot;((spanNear([text:foo, text:a, text:b, spanOr([text:bar, spanNear(&lt;span class=&quot;error&quot;&gt;&amp;#91;text:tropical, text:cyclone&amp;#93;&lt;/span&gt;, 0, true)])], 0, true))^10.0) &quot; + &quot;(((text:\&quot;foo a\&quot;)^5.0) ((text:\&quot;a b\&quot;)^5.0) ((text:\&quot;b tropical\&quot;)^5.0)) &lt;font color=&quot;#ff0000&quot;&gt;&lt;b&gt;(spanOr([text:bar, spanNear(&lt;span class=&quot;error&quot;&gt;&amp;#91;text:tropical, text:cyclone&amp;#93;&lt;/span&gt;, 0, true)]))^5.0))&quot;&lt;/b&gt;&lt;/font&gt; + &quot;(((text:\&quot;foo a b\&quot;)^8.0) ((text:\&quot;a b tropical\&quot;)^8.0) ((spanNear([text:b, spanOr([text:bar, spanNear(&lt;span class=&quot;error&quot;&gt;&amp;#91;text:tropical, text:cyclone&amp;#93;&lt;/span&gt;, 0, true)])], 0, true))^8.0))&quot;, q.toString()); }&lt;/p&gt;

&lt;p&gt;&lt;b&gt;N.B.&lt;/b&gt; The second part is failing for pf2, because for the query &quot;foo a b tropical cyclone&quot; , pf2 is generating just :&lt;br/&gt;
 ((text:\&quot;foo a\&quot;)^5.0) ((text:\&quot;a b\&quot;)^5.0) ((text:\&quot;b tropical\&quot;)^5.0)), which I believe is incorrect as an additional span query should be generated &#160;( (spanOr([text:bar, spanNear(&lt;span class=&quot;error&quot;&gt;&amp;#91;text:tropical, text:cyclone&amp;#93;&lt;/span&gt;, 0, true)]))^5.0)).&lt;br/&gt;
 I will investigate further in the next days, just wanted to post it here to the community attention &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16456929" author="ehaubert" created="Fri, 27 Apr 2018 19:13:17 +0000"  >&lt;p&gt;The fix I pushed up really only handles the case where you&apos;re starting with the single-word synonym well for pf2. &#160;So matching &quot;foo bar&quot; queries to &quot;foo tropical cyclone&quot; documents. &#160;This was a real problem for my use case, because the pf clauses weren&apos;t being generated at all.&lt;/p&gt;

&lt;p&gt;The other direction,&#160;to match &quot;foo tropical cyclone&quot; queries to &quot;foo bar&quot; documents is harder. &#160; I&apos;ve gone a little ways into the pf2 &quot;b tropical&quot; problem, but it is a deeper problem than the spans getting thrown out because they were the wrong type of query.&#160;Start small.&lt;/p&gt;

&lt;p&gt;Here&apos;s what I&apos;ve got for the other direction:&lt;/p&gt;

&lt;p&gt;One of&#160;first thing edismax does is generate a list of different kinds of clauses off the user query, and that seems to be unaffected by the sow flag. So &quot;foo tropical cyclone&quot; has three bareword clauses: &quot;foo&quot;, &quot;tropical&quot;, and &quot;cyclone&quot;. But &apos;foo &quot;tropical cyclone&quot;&apos; (with quotes) has two: a bareword foo and a phrase &quot;tropical cyclone&quot;. &#160; When it goes to construct pf2 and pf3, edismax re-assembles the bareword clauses, then makes the 2- and 3- word shingles. So &quot;foo tropical cyclone&quot; would get&#160;pf2=&quot;foo tropical&quot; and &quot;tropical cyclone&quot;, pf2=&quot;foo tropical&quot; can&apos;t get expanded, because it is missing cyclone, and will go through such as it is; &#160;&quot;tropical cyclone&quot; will get expanded, but then removed as not a phrase, not just because it is a Span. &#160;That seems consistent if we think of &quot;tropical cyclone&quot; as a single entity. &#160;So to do anything, we need to address how the shingle queries are being constructed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I opened Jira-12260 to start looping in the phrases to pf clauses, not just the barewords, because that has some other weird semantics. &#160;So &apos;foo &quot;tropical cyclone&quot; baz&apos; (with quotes) would generate pf=&quot;foo baz&quot;, which is unintuitive - it would make more sense if it became &quot;foo &quot;tropical cyclone&quot;&quot; and &quot;tropical cyclone&quot; baz. Beyond looking a little into whether the graph queries could handle the phrase, I haven&apos;t really dug how to do that&#160;yet.&lt;/p&gt;

&lt;p&gt;That matters here, because if that works and the semantics are acceptable, multi-word synoynms are already handled as quoted in the logic that creates the graph queries. &#160; So it would (probably) be safe to take that another step to stuff the multiword synonyms into a single phrase clause, rather than individual bareword clauses. &#160;Maybe.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16457168" author="alessandro.benedetti" created="Fri, 27 Apr 2018 22:21:07 +0000"  >&lt;p&gt;Actually the solution seems easier than expected :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I generalised your additional condition&#160;to include SpanOrQuery ( checking SpanQuery actually)&lt;/li&gt;
	&lt;li&gt;I added the test checking the query is correctly (built) parsed&lt;/li&gt;
	&lt;li&gt;I haven&apos;t touched anything else, I left your tests un-touched, in the end they are additional tests, so even if they check the bug-fix indirectly they are not harmful&#160;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I attached the extended patch and created a PR via Github.&lt;br/&gt;
My only suggestion would be to re-word slightly the messages if your are going that way (I personally prefer to split the unit tests &lt;br/&gt;
e.g.&#160;testEdismaxQueryParsing_multiTermSynonymWithPfAndPs_shouldParseCorrectSpanQueries() but it is your call if you want to do so).&lt;/p&gt;




&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16457172" author="ehaubert" created="Fri, 27 Apr 2018 22:27:13 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="16463831" author="alessandro.benedetti" created="Fri, 4 May 2018 12:46:58 +0000"  >&lt;p&gt;Apparently there are some issues with auto generated github patches and the Jenkins job validating the patch.&lt;/p&gt;

&lt;p&gt;In theory it should just work straightforward :&lt;br/&gt;
Github Pull Request -&amp;gt; patch extracted -&amp;gt; patch validated through Jenkins job&lt;/p&gt;

&lt;p&gt;But the process is not smooth and I had to push various version of the same patch ( this is valid for others issues as well) .&lt;br/&gt;
Attaching the latest patch ( generated from git diff)&lt;/p&gt;</comment>
                            <comment id="16464990" author="lucenesolrqa" created="Sun, 6 May 2018 06:30:22 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 1 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  5m 21s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  5m  3s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  5m  3s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 39s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 27s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 27s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 46m  4s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;120m 59s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; core in the patch failed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;185m 13s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Reason &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Failed junit tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.update.MaxSizeAutoCommitTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.autoscaling.ScheduledMaintenanceTriggerTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.autoscaling.sim.TestTriggerIntegration &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.autoscaling.sim.TestLargeCluster &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.autoscaling.SearchRateTriggerTest &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12921951/SOLR-12243.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12921951/SOLR-12243.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene2-us-west.apache.org 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 89fc02a &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.6 compiled on July 8 2015 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.8.0_172 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/80/artifact/out/patch-unit-solr_core.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/80/artifact/out/patch-unit-solr_core.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/80/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/80/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: lucene/core solr/core U: . &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/80/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/80/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16465791" author="alessandro.benedetti" created="Mon, 7 May 2018 11:05:28 +0000"  >&lt;p&gt;I am a little bit surprised by the jenkins checks :&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Failed junit tests&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;solr.update.MaxSizeAutoCommitTest&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;solr.cloud.autoscaling.ScheduledMaintenanceTriggerTest&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;solr.cloud.autoscaling.sim.TestTriggerIntegration&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;solr.cloud.autoscaling.sim.TestLargeCluster&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;solr.cloud.autoscaling.SearchRateTriggerTest&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I can not reproduce these failures and given the modules involved are extremely unlikely to be related with the query parsing fix in object of the patch ...&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg&quot; class=&quot;user-hover&quot; rel=&quot;elyograg&quot;&gt;elyograg&lt;/a&gt; any view on this ?&lt;/p&gt;</comment>
                            <comment id="16465801" author="ehaubert" created="Mon, 7 May 2018 11:19:58 +0000"  >&lt;p&gt;FWIW, I was seeing the&#160;MaxSizeAutoCommitTest fail against master locally both with and without the patch, but not after running with badapples turned off.&lt;/p&gt;

&lt;p&gt;Don&apos;t know anything about the others, though.&lt;/p&gt;</comment>
                            <comment id="16466049" author="elyograg" created="Mon, 7 May 2018 15:43:51 +0000"  >&lt;p&gt;I have not been following code changes on this issue.  But I have been seeing frequent failures in Solr tests even with a completely unmodified code checkout.  This is what Erick is trying to fix with his recent work on tests.&lt;/p&gt;

&lt;p&gt;Until tests reach the point where they pass on virtually all runs, test failures in the automatic patch validation are to be expected, and it&apos;s not straightforward to know whether they indicate a problem in the patch.  That DOES mean that automatic patch validation isn&apos;t as useful as it could be.  The problem is known and is not being ignored.&lt;/p&gt;</comment>
                            <comment id="16467714" author="alessandro.benedetti" created="Tue, 8 May 2018 17:21:26 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg&quot; class=&quot;user-hover&quot; rel=&quot;elyograg&quot;&gt;elyograg&lt;/a&gt;, the code changes were minimal ( 1 line changed + 1 test added) but I agree with you about the inconsistency of the current testing framework.&lt;br/&gt;
I have another 3 patches pending, all of them with random tests failures ( very unlikely to be related the change itself).&lt;br/&gt;
You mentioned Erick is working on that, is there any Jira issue tracking that ?&lt;br/&gt;
Any way we could help ?&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="16467881" author="elyograg" created="Tue, 8 May 2018 19:52:48 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12028&quot; title=&quot;BadApple and AwaitsFix annotations usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12028&quot;&gt;&lt;del&gt;SOLR-12028&lt;/del&gt;&lt;/a&gt;.  This issue refers to another one that was deleted for some reason &amp;#8211; SOLR-12016.  I can see all the history for that issue in my mail archive, but it&apos;s not on the Internet any more unless you want to delve into things like the web archive.&lt;/p&gt;

&lt;p&gt;There is also an extensive discussion on the dev list, and a number of status messages from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; detailing the work he&apos;s doing on an ongoing basis.&lt;/p&gt;</comment>
                            <comment id="16479714" author="alessandro.benedetti" created="Thu, 17 May 2018 21:12:03 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg&quot; class=&quot;user-hover&quot; rel=&quot;elyograg&quot;&gt;elyograg&lt;/a&gt;, I read about that issue and there&apos;s plenty of work going on in that direction...&lt;br/&gt;
Anything we can do our side to speed up the review and contribution of this one ?&lt;/p&gt;</comment>
                            <comment id="16493928" author="alessandro.benedetti" created="Tue, 29 May 2018 17:41:03 +0000"  >&lt;p&gt;Sorry to be boring, but is anything we can do to speed up a review and contribution of this one ?&lt;/p&gt;</comment>
                            <comment id="16550867" author="alessandro.benedetti" created="Fri, 20 Jul 2018 15:07:49 +0000"  >&lt;p&gt;Hi community,&lt;/p&gt;

&lt;p&gt;if this bug-fix is not of interest could we have an explanation why and have this Jira issue closed ?&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="16551617" author="lucenesolrqa" created="Sat, 21 Jul 2018 11:03:40 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 1 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  3m 17s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  4m 32s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  4m 32s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 23s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 19s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 19s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 30m 12s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; 77m 51s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; core in the patch failed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;121m  9s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Reason &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Failed junit tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.handler.component.InfixSuggestersTest &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12921951/SOLR-12243.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12921951/SOLR-12243.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene2-us-west.apache.org 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 1bea1da &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.6 compiled on July 8 2015 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.8.0_172 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/148/artifact/out/patch-unit-solr_core.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/148/artifact/out/patch-unit-solr_core.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/148/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/148/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: lucene/core solr/core U: . &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/148/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/148/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16570402" author="thetaphi" created="Mon, 6 Aug 2018 16:00:46 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I can take care about this issue. Sorry for the ever failing patch validator, that&apos;s a known issue. IMHO, the patch is quite easy and should not break any other feature, so I have no problem with committing it. If we have better features later, we can fix the issue in a better way, but as a quick fix this looks perfectly fine.&lt;/p&gt;

&lt;p&gt;I will verify the patch the &quot;conventional way&quot; and fix it. But we won&apos;t backport this to older Lucene/Solr versions like 7.1. You have to update then!&lt;/p&gt;</comment>
                            <comment id="16571670" author="ehaubert" created="Tue, 7 Aug 2018 13:43:41 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="16571827" author="thetaphi" created="Tue, 7 Aug 2018 15:19:18 +0000"  >&lt;p&gt;Would it be possible to add a test into oal.util.TestQueryBuilder, because it changes the semantics of span queries depending on slop? I&apos;d like to have a test for it, so we can verify that it behaves exactly like conventional phrase queries.&lt;/p&gt;

&lt;p&gt;I think it should be as simple as the 2 tests about graph queries in there.&lt;/p&gt;

&lt;p&gt;About the test in Solr: I am not happy with the test that prints out the query as string and compares it with an expected string representation. This relies on the exact output of toString() which is not standardized in Lucene and might change. I can live with it if its done in the same way in other tests, but just just be done as a fallback.&lt;/p&gt;</comment>
                            <comment id="16571831" author="thetaphi" created="Tue, 7 Aug 2018 15:20:31 +0000"  >&lt;p&gt;As this test changes also behaviour of LUCENE code, I will add a changes log entry also on Lucene&apos;s side. It&apos;s a bug, but I want to be sure that nobody misses this change.&lt;/p&gt;</comment>
                            <comment id="16571896" author="dsmiley" created="Tue, 7 Aug 2018 16:06:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;About the test in Solr: I am not happy with the test that prints out the query as string and compares it with an expected string representation. This relies on the exact output of toString() which is not standardized in Lucene and might change.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s a trade-off for sure. &#160;I prefer this style as I find it easy to read. &#160;I&apos;ve seen tests that break out each object of the Query and do a bunch of comparisons&#160;(sometimes declaring intermediate variables)&#160;and my eyes just gloss over reading it. &#160;If the toString changes (and we don&apos;t take those changes lightly), then it&apos;s pretty safe to blindly update such test strings since a change to the toString() ought not to be making other changes to query structure. &#160;Conceptually this argument can be had about other things like the structure of a SolrDocument (compare toString vs compare part by part) or Highlighting snippet as well &#8211; same tradeoffs in test assertion&#160;methodology.&lt;/p&gt;</comment>
                            <comment id="16587262" author="thetaphi" created="Tue, 21 Aug 2018 10:25:06 +0000"  >&lt;p&gt;I am looking into committing this soon. Unfortunately we do not have a test for the Lucene part. I may have time at end of week to work on it.&lt;/p&gt;</comment>
                            <comment id="16650777" author="ehaubert" created="Mon, 15 Oct 2018 20:51:11 +0000"  >&lt;p&gt;After talking to Steve Rowe, there is a new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8531&quot; title=&quot;QueryBuilder hard-codes inOrder=true for generated sloppy span near queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8531&quot;&gt;&lt;del&gt;LUCENE-8531&lt;/del&gt;&lt;/a&gt; to handle the current Span requirement that sloppy queries be inOrder.&lt;/p&gt;

&lt;p&gt;Since the core issue with this ticket was that the span clauses prevents pf/pf2/pf3 from being generated entirely, then it seems prudent to back out the lucene change under this ticket, and add a new one to pick up the reordering when there is a patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8531&quot; title=&quot;QueryBuilder hard-codes inOrder=true for generated sloppy span near queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8531&quot;&gt;&lt;del&gt;LUCENE-8531&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Updated patch pending shortly.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alessandro.benedetti&quot; class=&quot;user-hover&quot; rel=&quot;alessandro.benedetti&quot;&gt;alessandro.benedetti&lt;/a&gt;, I will include the query expansion test you added, but update it to reflect that the inOrder=false will become inOrder=true.&#160; &#160;I&apos;m not sure what the right way to&#160;coordinate that with the pull request.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16650927" author="lucenesolrqa" created="Mon, 15 Oct 2018 22:56:06 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 1 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  4m  2s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  3m 27s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  3m 27s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 51s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 39s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 39s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 31m 48s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; 80m 45s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; core in the patch failed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;125m 44s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Reason &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Failed junit tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.MultiThreadedOCPTest &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12921951/SOLR-12243.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12921951/SOLR-12243.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene2-us-west.apache.org 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 73a413c &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.6 compiled on July 20 2018 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.8.0_172 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/200/artifact/out/patch-unit-solr_core.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/200/artifact/out/patch-unit-solr_core.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/200/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/200/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: lucene/core solr/core U: . &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/200/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/200/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16653028" author="lucenesolrqa" created="Wed, 17 Oct 2018 06:22:12 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 1 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 40s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 35s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 35s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 35s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 35s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 35s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; 50m  9s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; core in the patch failed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; 55m 59s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Reason &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Failed junit tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.autoscaling.sim.TestSimPolicyCloud &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12944131/SOLR-12243.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12944131/SOLR-12243.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene1-us-west 4.4.0-137-generic #163~14.04.1-Ubuntu SMP Mon Sep 24 17:14:57 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 635d1ea &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.3 compiled on July 24 2018 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.8.0_172 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/203/artifact/out/patch-unit-solr_core.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/203/artifact/out/patch-unit-solr_core.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/203/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/203/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: solr/core U: solr/core &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/203/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/203/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16654888" author="thetaphi" created="Thu, 18 Oct 2018 08:55:21 +0000"  >&lt;p&gt;I am fine with splitting those issues!&lt;/p&gt;</comment>
                            <comment id="16656723" author="elyograg" created="Fri, 19 Oct 2018 12:12:18 +0000"  >&lt;p&gt;The central problem in this issue was unclear to me, so I asked &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehaubert&quot; class=&quot;user-hover&quot; rel=&quot;ehaubert&quot;&gt;ehaubert&lt;/a&gt; if she could explain it.  With that information, I was able to do a test that makes it pretty clear.&lt;/p&gt;

&lt;p&gt;With a 7.5.0 example setup, I created a &quot;title&quot; field using the default text_general fieldType (which uses SynonymGraphFilter at query time), and included the two configs provided in the issue description (synonyms and handler).  Here&apos;s the parsed queries for a couple of examples.  The difference here is one includes &quot;dog&quot; which has a multiterm synonym, and the other includes &quot;rat&quot; which only has single-term synonyms:&lt;/p&gt;

&lt;p&gt;with q=allergic reaction dog&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+((((Synonym(title:allergic title:hypersensitive))^100.0)~0.4
((title:reaction)^100.0)~0.4 ((title:canine (+title:canis +title:familiris)
(+title:k +title:9) title:dog)^100.0)~0.4)~3) () (title:\&quot;(hypersensitive allergic) reaction\&quot;~11)~0.4 ()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with q=allergic reaction rat&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+((((Synonym(title:allergic title:hypersensitive))^100.0)~0.4
((title:reaction)^100.0)~0.4 ((Synonym(title:rat title:rattus))^100.0)~0.4)~3)
((title:\&quot;(hypersensitive allergic) reaction (rattus rat)\&quot;~20)^5000.0)~0.4
((title:\&quot;(hypersensitive allergic) reaction\&quot;~11)~0.4 (title:\&quot;reaction (rattus rat)\&quot;~11)~0.4)
((title:\&quot;(hypersensitive allergic) reaction (rattus rat)\&quot;~22)^1000.0)~0.4
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16656748" author="ehaubert" created="Fri, 19 Oct 2018 12:37:00 +0000"  >&lt;p&gt;There are also tests included with the patch.&lt;/p&gt;

</comment>
                            <comment id="16656862" author="thetaphi" created="Fri, 19 Oct 2018 14:37:29 +0000"  >&lt;p&gt;We have to wait for the Lucene issue to be solved. It also affects Elasticsearch.&lt;/p&gt;</comment>
                            <comment id="16656893" author="ehaubert" created="Fri, 19 Oct 2018 14:57:00 +0000"  >&lt;p&gt;Why do we need to wait for the lucene patch, if that has been backed out of&lt;br/&gt;
this jira?&lt;/p&gt;

&lt;p&gt;I thought the ticket was split, as there are two distinct issues. One that&lt;br/&gt;
the clauses are missing entirely, which would be handled here,  and a&lt;br/&gt;
second one that when the span clauses are generated with the attached&lt;br/&gt;
patch, the semantics between phrase clauses with and without multi term&lt;br/&gt;
synonyns are different without the lucene change.&lt;/p&gt;

&lt;p&gt;Depending on how reordering in span queries is implemented in lucene, there&lt;br/&gt;
may need to be additional logic to edismax to take advantage, but&lt;br/&gt;
presumably that would need another issue?&lt;/p&gt;


</comment>
                            <comment id="16657074" author="thetaphi" created="Fri, 19 Oct 2018 16:50:14 +0000"  >&lt;p&gt;That&apos;s waht I mean, it&apos;s still linked together. The main bug is still in Lucene, because the Lucene Query builder creates a query that does not correctly implement span queries on multi-term synonyms, because it uses the wrong query type. The issues here are coming from the fact that dismax relies on the interal implementation of the lucene code, which is not a good thing. The solr code should not do this and instead we should add something into Lucene that can create those pf auto-phrase queries. I was missing that in an own query parser, too. So basically it would be good to have some additional query builder method in Lucene that analyzes some text and then builds configureable shingles that are connected with span/phrase using a slop. This code should not depend on the structure of a span/boolean query that was parsed before.&lt;/p&gt;

&lt;p&gt;I&apos;d like to wait a few days until the Lucene issue is solved and then review the changes here and adapt them as necessary. On the longer term, I&apos;d like to get rid of the query instanceof spaghetticode and move the query construction for dismax-like queries using term shingles (bigrams, trigrams) to a separate builder class. So it&apos;s better resuseable.&lt;/p&gt;</comment>
                            <comment id="16657094" author="thetaphi" created="Fri, 19 Oct 2018 16:59:58 +0000"  >&lt;p&gt;The Lucene issue is about to be committed, so let&apos;s adapt the instanceof checks here (because it no longer creates SpanQueries for all types of phrases).&lt;/p&gt;</comment>
                            <comment id="16657477" author="thetaphi" created="Fri, 19 Oct 2018 21:44:45 +0000"  >&lt;p&gt;Hi, the Lucene issue was committed. I think we can now test this. Nevertheless, according to my understanding, as for slop!=0 it no longer creates span queries, the bug is fixed anyways. For slop=0 it creates (faster) span queries, so  the fixes here should apply.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehaubert&quot; class=&quot;user-hover&quot; rel=&quot;ehaubert&quot;&gt;ehaubert&lt;/a&gt;: Can you check the patch with the recent Lucene commits included? I can manually try that tomorrow, maybe you&apos;re faster.&lt;/p&gt;</comment>
                            <comment id="16657479" author="thetaphi" created="Fri, 19 Oct 2018 21:45:48 +0000"  >&lt;p&gt;Nevertheless there should be a test for slop=0 and slop!=0 in Edismax tests.&lt;/p&gt;</comment>
                            <comment id="16657603" author="ehaubert" created="Sat, 20 Oct 2018 00:27:43 +0000"  >&lt;p&gt;Pulling to check.&lt;/p&gt;</comment>
                            <comment id="16657638" author="ehaubert" created="Sat, 20 Oct 2018 01:21:23 +0000"  >&lt;p&gt;I think something is not right, but am not sure what.&lt;/p&gt;

&lt;p&gt;Running current master without the patch applied in the debugger. Making a core with the attached configs; the sanity check is curl -XGET &quot;http://localhost:8983/solr/new_core/test_qparse_error?debugQuery=on&amp;amp;defType=edismax&amp;amp;q=aspirin%20dose%20in%20rats&quot;&lt;/p&gt;

&lt;p&gt;where aspirin had the same &quot;aspirin, acetylsalicilic acid&quot; synonyms as previously.&lt;/p&gt;

&lt;p&gt;Query is coming through with the original bug of the empty parens where clauses should be:&lt;/p&gt;

&lt;p&gt;+(((text:&quot;acetylsalicylic acid&quot; text:aspirin)^100.0) ((text:dose)^100.0) ((text:in)^100.0) ((text:rats)^100.0)) () ((text:&quot;dose in&quot;~11) (text:&quot;in rats&quot;~11)) ((text:&quot;dose in rats&quot;~22)^1000.0)&lt;/p&gt;

&lt;p&gt;That is kinda the expected behavior, since my understanding of the Lucene patch was that it wasn&apos;t going to be a SpanQuery object coming through anymore.&#160;&lt;/p&gt;

&lt;p&gt;Put breakpoints at ExtendedDismaxQParser.java in getQuery, and it looks like it is getting a NullPointerException and falling out at ln.1449&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16665837" author="steve_rowe" created="Sat, 27 Oct 2018 02:21:49 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I think something is not right, but am not sure what.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
Put breakpoints at ExtendedDismaxQParser.java in getQuery, and it looks like it is getting a NullPointerException and falling out at ln.1449&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In addition to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehaubert&quot; class=&quot;user-hover&quot; rel=&quot;ehaubert&quot;&gt;ehaubert&lt;/a&gt;&apos;s above-described manual test, &lt;tt&gt;TestMultiWordSynonyms.testPf3WithoutReordering()&lt;/tt&gt; in the patch was failing with the same symptoms.&lt;/p&gt;

&lt;p&gt;The problem: The &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8531&quot; title=&quot;QueryBuilder hard-codes inOrder=true for generated sloppy span near queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8531&quot;&gt;&lt;del&gt;LUCENE-8531&lt;/del&gt;&lt;/a&gt; changes cause &lt;tt&gt;QueryBuilder&lt;/tt&gt; to produce a new kind of query structure for a phrase with multi-term synonyms and non-zero slop: a &lt;tt&gt;BooleanQuery&lt;/tt&gt; of &lt;tt&gt;PhraseQuery&lt;/tt&gt;-s.  &lt;tt&gt;ExtendedDismaxQParser.getQuery()&lt;/tt&gt; assumes that &lt;tt&gt;BooleanQuery&lt;/tt&gt;-s always consist of &lt;tt&gt;TermQuery&lt;/tt&gt;-s, and so unconditionally sets the query&apos;s minShouldMatch, but since the parser used to construct the &lt;tt&gt;pf3&lt;/tt&gt; phrase shingles had never had its minShouldMatch spec set, it remained null, causing an NPE when trim was called on it in &lt;tt&gt;SolrPluginUtils.setMinShouldMatch()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a modified version of Elizabeth&apos;s patch that includes an &lt;tt&gt;ExtendedDismaxQParser.getQuery()&lt;/tt&gt; fix: don&apos;t set a &lt;tt&gt;BooleanQuery&lt;/tt&gt;&apos;s minShouldMatch when &lt;tt&gt;type==QType.PHRASE&lt;/tt&gt;.  The modified patch also uncomments &lt;tt&gt;TestMultiWordSynonyms.testPf3WithReordering()&lt;/tt&gt;.  All the tests in &lt;tt&gt;TestMultiWordSynonyms&lt;/tt&gt; now pass with the patch.  I haven&apos;t tried to run all Solr tests yet.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Hi, the Lucene issue was committed. I think we can now test this. Nevertheless, according to my understanding, as for slop!=0 it no longer creates span queries, the bug is fixed anyways. For slop=0 it creates (faster) span queries, so the fixes here should apply.&lt;/p&gt;

&lt;p&gt;Nevertheless there should be a test for slop=0 and slop!=0 in Edismax tests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Next week I&apos;ll look at adding what else ^^ needs testing.&lt;/p&gt;</comment>
                            <comment id="16666067" author="lucenesolrqa" created="Sat, 27 Oct 2018 12:21:52 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 1 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 49s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 34s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 34s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 34s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 34s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 34s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 55m 32s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; 61m 30s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12945848/SOLR-12243.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12945848/SOLR-12243.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene1-us-west 4.4.0-137-generic #163~14.04.1-Ubuntu SMP Mon Sep 24 17:14:57 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / a298802 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.3 compiled on July 24 2018 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.8.0_172 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/213/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/213/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: solr/core U: solr/core &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/213/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/213/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16667425" author="ehaubert" created="Mon, 29 Oct 2018 16:40:30 +0000"  >&lt;p&gt;Current expansions looks perfect, thank you Steve.&#160;&lt;/p&gt;


&lt;p&gt;Observation with the&#160;current approach is that the combinatorics for larger queries and/or longer expansions could get hefty.&#160; Would it be worth adding a note about this in the edismax documentation around pf/pf2/pf3.&#160;&#160; Similar to the note around aliasing and qf &lt;a href=&quot;https://lucene.apache.org/solr/guide/7_3/the-extended-dismax-query-parser.html#field-aliasing-using-per-field-qf-overrides&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;in the ref guide&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Multi-term synonyms with pf&lt;/p&gt;

&lt;p&gt;When a phrase query specified with PF/PF2/PF3 contains a synonym expansion, then&#160;a separate pf clause will be generated for each permutation of each synonym.&#160; &#160;For example, in a system with synonyms for dog, canine and cat,feline the query &quot;dog chased cat&quot; would generate the following pf clauses:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;dog chased cat&lt;/li&gt;
	&lt;li&gt;canine chased cat&lt;/li&gt;
	&lt;li&gt;dog chased feline&lt;/li&gt;
	&lt;li&gt;canine chased feline&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16667457" author="thetaphi" created="Mon, 29 Oct 2018 17:03:05 +0000"  >&lt;p&gt;Thanks Elizabeth and Steve,&lt;br/&gt;
I think the problem Sarowe mentioned was actually the problem for the failing test (I expected something like this). This is also the reason why I don&apos;t like the current architecture. EDismax relies on the (internal) structure of queries that querybuilder produces! IMHO, we should maybe add a &quot;Lucene&quot; version of the dismax parser for easier testing. Also I figured out that especially the phrase expansions are useful for Lucene users, too. I had several people I made a custom query parser for and for all of those you hd to reinvent the phrase expansion stuff.&lt;/p&gt;

&lt;p&gt;Elizabeth: I think the permutation problem is not new with the recent Lucene fixes. This problem should also have happened with Span expansions, right? Maybe we should add an option to limit the number of phrase expansions (as a safety feature). If those limits are reached, the phrase expansion should be stopped (maybe then only bigrams and no trigrams).&lt;/p&gt;</comment>
                            <comment id="16668790" author="steve_rowe" created="Tue, 30 Oct 2018 14:31:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think the permutation problem is not new with the recent Lucene fixes. This problem should also have happened with Span expansions, right? Maybe we should add an option to limit the number of phrase expansions (as a safety feature). If those limits are reached, the phrase expansion should be stopped (maybe then only bigrams and no trigrams).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t know how Span queries are rewritten, or how the search time complexity would work out, but AFAIK the Lucene fixes didn&apos;t change the permutation problem, just recast it as explicit clauses.&lt;/p&gt;

&lt;p&gt;As far as safety is concerned, doesn&apos;t the Boolean clause limit already apply in this case, since the generated query is a BooleanQuery of PhraseQuery-s?&lt;/p&gt;

&lt;p&gt;Elizabeth, I like the idea of adding something along the lines of the text you suggested to the ref guide. I made a few tweaks (described below) - please let me know if you think this is okay:&lt;/p&gt;
&lt;blockquote&gt;
&lt;h3&gt;&lt;a name=&quot;Synonymsexpansioninphrasequerieswithslop&quot;&gt;&lt;/a&gt;Synonyms expansion in phrase queries with slop&lt;/h3&gt;

&lt;p&gt;When a phrase query with slop (e.g. &lt;tt&gt;pf&lt;/tt&gt; with &lt;tt&gt;ps&lt;/tt&gt;) triggers synonym expansions, a separate clause will be generated for each combination of synonyms. For example, with configured synonyms &lt;tt&gt;dog,canine&lt;/tt&gt; and &lt;tt&gt;cat,feline&lt;/tt&gt;, the query &lt;tt&gt;&quot;dog chased cat&quot;&lt;/tt&gt; will generate the following phrase query clauses:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;&quot;dog chased cat&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;canine chased cat&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;dog chased feline&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;canine chased feline&quot;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;My&#160;changes: this situation happens with all synonyms, not just multi-term synonyms; user-specified phrase queries (in &lt;tt&gt;q&lt;/tt&gt; param)&#160;trigger this situation when &lt;tt&gt;qs&lt;/tt&gt; is specified, so I generalized it a bit to refer to all phrase+slop contexts; and I think &quot;combination&quot; is better than &quot;permutation&quot; here.&lt;/p&gt;</comment>
                            <comment id="16668814" author="ehaubert" created="Tue, 30 Oct 2018 14:49:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt;&#160; The number of clauses relative to the&#160;spans approach kind of depends on how you count clauses, I think&#160;adding top-level clauses comes up as more expensive than the embedded spans, but suppose would need to add a test to say that for sure.&#160; With the Spans, synonyms were implemented as a nested spanOr(syn1, syn2).&#160; Adding in &quot;fido&quot; and &quot;kitty&quot; to the &quot;dog chased cat&quot; example,&#160;the spans would generate&#160;something like:&#160; SpanNear( SpanOr(dog, canine, fido), chased, SpanOr(cat, feline, kitty))&lt;/p&gt;

&lt;p&gt;vs&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;&quot;dog chased cat&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;canine chased cat&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&quot;fido chased cat&quot;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;dog chased feline&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;canine chased feline&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&quot;fido chased feline&quot;&lt;/li&gt;
	&lt;li&gt;&quot;dog chased kitty&quot;&lt;/li&gt;
	&lt;li&gt;&quot;canine chased kitty&quot;&lt;/li&gt;
	&lt;li&gt;&quot;fido chased kitty&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;etc.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16668907" author="mgibney" created="Tue, 30 Oct 2018 15:46:24 +0000"  >&lt;p&gt;I&#160;share&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehaubert&quot; class=&quot;user-hover&quot; rel=&quot;ehaubert&quot;&gt;ehaubert&lt;/a&gt;&apos;s intuition that &quot;adding top-level clauses comes up as more expensive than the embedded spans&quot;, including the caveat: &quot;but suppose would need to add a test to say that for sure&quot;.&lt;/p&gt;

&lt;p&gt;I would characterize the permutation problem as substantially &lt;em&gt;different&lt;/em&gt; as a result of the recent Lucene fixes. The fixes (&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8531&quot; title=&quot;QueryBuilder hard-codes inOrder=true for generated sloppy span near queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8531&quot;&gt;&lt;del&gt;LUCENE-8531&lt;/del&gt;&lt;/a&gt;) essentially reverted &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-7638&quot; title=&quot;Optimize graph query produced by QueryBuilder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-7638&quot;&gt;&lt;del&gt;LUCENE-7638&lt;/del&gt;&lt;/a&gt;, an optimization that explicitly set out to address the potential for combinatoric explosion. A &lt;tt&gt;SpanQuery&lt;/tt&gt;-based implementation still has to deal with the possibility of combinatoric &lt;em&gt;matching&lt;/em&gt; in documents, but the &lt;tt&gt;SpanQuery&lt;/tt&gt; implementation handles graph &quot;branching&quot; natively (as nested Spans), as opposed to running a full, separate, top-level, &lt;tt&gt;PhraseQuery&lt;/tt&gt; for each possible combination of terms.&lt;/p&gt;</comment>
                            <comment id="16668952" author="thetaphi" created="Tue, 30 Oct 2018 16:11:49 +0000"  >&lt;p&gt;I agree with both of you that it&apos;s an issue for many synonyms. This was already discussed in the Lucene issue. As long as span queries don&apos;t support the same type of near matches (in order, out of order, with gaps) it&apos;s hard to apply the optimization correctly. The fix would be to improve SpanNear to produce the same query like PhraseQuery for certain slop values.&lt;/p&gt;

&lt;p&gt;For now, Steve is right, the max clause count will protect users from combinatoric explosion. I was suggesting to improve EDisMax to allow limiting the number of expansions when producing bi and trigrams. As the query is very fuzzy anyways, it might be OK to restrict the combinations (e.g., if trigrams explode, just disable trigrams for the huge query and onyl create bigrams).&lt;/p&gt;</comment>
                            <comment id="16669095" author="mgibney" created="Tue, 30 Oct 2018 17:31:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt;, that makes sense to me.&lt;/p&gt;

&lt;p&gt;&quot;The fix would be to improve SpanNear to produce the same query like PhraseQuery for certain slop values,&quot; see&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8544&quot; title=&quot;In SpanNearQuery, add support for inOrder semantics equivalent to that of (Multi)PhraseQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8544&quot;&gt;LUCENE-8544&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16675134" author="elyograg" created="Mon, 5 Nov 2018 13:20:15 +0000"  >&lt;p&gt;Is there an expected timeframe for this to be committed?  Anything I can do to accelerate it?&lt;/p&gt;

&lt;p&gt;Working with the indexes experiencing the problem and would like to get back to &quot;official&quot; binary Solr instead of a custom build.  I checked the latest patch on branch_7x and it looks like it&apos;s working as expected.&lt;/p&gt;</comment>
                            <comment id="16675137" author="ehaubert" created="Mon, 5 Nov 2018 13:21:54 +0000"  >&lt;p&gt;So does that make consensus that the current patch is sufficient?&lt;/p&gt;</comment>
                            <comment id="16675147" author="thetaphi" created="Mon, 5 Nov 2018 13:32:35 +0000"  >&lt;p&gt;If we are fine here, I can commit this. No problem anymore! I just did not get any response, so I was waiting. I will run tests and do it later this evening. I am currently travelling. At least this is a good bugfix. Everything else here is future work (like improving the Lucene queries for the ordered/unordered cases).&lt;/p&gt;

&lt;p&gt;Uwe&lt;/p&gt;</comment>
                            <comment id="16675162" author="ehaubert" created="Mon, 5 Nov 2018 13:48:13 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="16675205" author="steve_rowe" created="Mon, 5 Nov 2018 14:09:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehaubert&quot; class=&quot;user-hover&quot; rel=&quot;ehaubert&quot;&gt;ehaubert&lt;/a&gt;, I was holding off committing, waiting for your response to my earlier question, which I repeat below:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Elizabeth, I like the idea of adding something along the lines of the text you suggested to the ref guide. I made a few tweaks (described below) - please let me know if you think this is okay:&lt;/p&gt;
&lt;blockquote&gt;
&lt;h3&gt;&lt;a name=&quot;Synonymsexpansioninphrasequerieswithslop&quot;&gt;&lt;/a&gt;Synonyms expansion in phrase queries with slop&lt;/h3&gt;

&lt;p&gt;When a phrase query with slop (e.g. &lt;tt&gt;pf&lt;/tt&gt; with &lt;tt&gt;ps&lt;/tt&gt;) triggers synonym expansions, a separate clause will be generated for each combination of synonyms. For example, with configured synonyms &lt;tt&gt;dog,canine&lt;/tt&gt; and &lt;tt&gt;cat,feline&lt;/tt&gt;, the query &lt;tt&gt;&quot;dog chased cat&quot;&lt;/tt&gt; will generate the following phrase query clauses:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;&quot;dog chased cat&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;canine chased cat&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;dog chased feline&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&quot;canine chased feline&quot;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;My changes: this situation happens with all synonyms, not just multi-term synonyms; user-specified phrase queries (in q param) trigger this situation when qs is specified, so I generalized it a bit to refer to all phrase+slop contexts; and I think &quot;combination&quot; is better than &quot;permutation&quot; here.&lt;/p&gt;
&lt;hr /&gt;</comment>
                            <comment id="16675214" author="ehaubert" created="Mon, 5 Nov 2018 14:16:23 +0000"  >&lt;p&gt;Oops, I saw the edits and missed the question.  Yes, that makes sense.&lt;/p&gt;</comment>
                            <comment id="16675267" author="steve_rowe" created="Mon, 5 Nov 2018 14:44:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;If we are fine here, I can commit this. No problem anymore! I just did not get any response, so I was waiting. I will run tests and do it later this evening. I am currently travelling. At least this is a good bugfix. Everything else here is future work (like improving the Lucene queries for the ordered/unordered cases).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt;: I&apos;ll take it.&lt;/p&gt;</comment>
                            <comment id="16675273" author="thetaphi" created="Mon, 5 Nov 2018 14:50:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;: OK, thanks!&lt;/p&gt;</comment>
                            <comment id="16675303" author="steve_rowe" created="Mon, 5 Nov 2018 15:28:27 +0000"  >&lt;p&gt;Final patch attached, including above-described ref guide edits (with a couple of unrelated minor cleanups on the same page) and a CHANGES.txt entry.&lt;/p&gt;

&lt;p&gt;Precommit and Solr tests pass.  Committing shortly.&lt;/p&gt;</comment>
                            <comment id="16675309" author="jira-bot" created="Mon, 5 Nov 2018 15:32:34 +0000"  >&lt;p&gt;Commit 9a53617e17649e8e0cb3cfc7a76348ba396871d3 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a53617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9a53617&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt;: Edismax missing phrase queries when phrases contain multiterm synonyms&lt;/p&gt;</comment>
                            <comment id="16675311" author="jira-bot" created="Mon, 5 Nov 2018 15:33:11 +0000"  >&lt;p&gt;Commit 01808eee938833b4a1c17a8a92cabdb683732a17 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=01808ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=01808ee&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt;: Edismax missing phrase queries when phrases contain multiterm synonyms&lt;/p&gt;</comment>
                            <comment id="16675450" author="steve_rowe" created="Mon, 5 Nov 2018 17:20:27 +0000"  >&lt;p&gt;Committed.  Thanks everybody!&lt;/p&gt;</comment>
                            <comment id="16836249" author="fmr" created="Thu, 9 May 2019 09:55:19 +0000"  >&lt;p&gt;I am aware that this issue is closed, but nonetheless:&lt;/p&gt;

&lt;p&gt;I think this actually broke something regarding expansion of synonyms for large queries (possibly large &lt;tt&gt;OR&lt;/tt&gt;-queries).&lt;/p&gt;

&lt;p&gt;Having&#160;&lt;tt&gt;pf&lt;/tt&gt; enabled on fields with a substantial amount of synonym resulted in the pf-portion of the query growing &quot;exponentially&quot; and resulted in one single query taking down an entire solr-server.&lt;/p&gt;

&lt;p&gt;By adjusting the number of &lt;tt&gt;OR&lt;/tt&gt;-queries we were able to increase the memory required for running the query.&lt;/p&gt;

&lt;p&gt;example (id has synonyms enabled, companyname has not):&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;tt&gt;A.&lt;/tt&gt;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;q=( samfunnsviter (klima OR milj&#248;) ) NOT ( psykolog%20 OR rus OR ortopedi OR odontologi )&amp;amp;debugQuery=true&amp;amp;pf=companyname&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;results in pf-part of edismax-query&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;(+DisjunctionMaxQuery((companyname:\&quot;? samfunnsviter klima milj&#248; ? ? psykolog rus ortopedi odontologi\&quot;~5)~0.01))&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;tt&gt;B.&lt;/tt&gt;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;q=( samfunnsviter (klima OR milj&#248;) ) NOT ( psykolog%20 OR rus OR ortopedi OR odontologi )&amp;amp;debugQuery=true&amp;amp;pf=id companyname&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;results in pf-part of edismax-query&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;(+DisjunctionMaxQuery(((id:\&quot;samfunnsviter klima milj&#248; psykolog rus ortopedi odontologi\&quot;~5 id:\&quot;samfunnsviter klima milj&#248; psykologspesialist rus ortopedi odontologi\&quot;~5 id:\&quot;samfunnsvitar klima milj&#248; psykolog rus ortopedi odontologi\&quot;~5 id:\&quot;samfunnsvitar klima milj&#248; psykologspesialist rus ortopedi odontologi\&quot;~5 id:\&quot;social scientist klima milj&#248; psykolog rus ortopedi odontologi\&quot;~5 id:\&quot;social scientist klima milj&#248; psykologspesialist rus ortopedi odontologi\&quot;~5 id:\&quot;statsviter klima milj&#248; psykolog rus ortopedi odontologi\&quot;~5 id:\&quot;statsviter klima milj&#248; psykologspesialist rus ortopedi odontologi\&quot;~5 id:\&quot;samfunns&#248;konom klima milj&#248; psykolog rus ortopedi odontologi\&quot;~5 id:\&quot;samfunns&#248;konom klima milj&#248; psykologspesialist rus ortopedi odontologi\&quot;~5) | companyname:\&quot;? samfunnsviter klima milj&#248; ? ? psykolog rus ortopedi odontologi\&quot;~5)~0.01))&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;B. above is just a reasonably short example to show our point.&#160; Our actually queries (and resulting&#160;&lt;tt&gt;pf&lt;/tt&gt; &lt;tt&gt;DisjunctionMaxQuery&lt;/tt&gt; are a &lt;b&gt;lot longer&lt;/b&gt;.&#160; Increasing the number of OR-terms or synonyms results in the id-part of the query growing &quot;exponentially&quot;&lt;/p&gt;</comment>
                            <comment id="16836448" author="mgibney" created="Thu, 9 May 2019 14:57:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fmr&quot; class=&quot;user-hover&quot; rel=&quot;fmr&quot;&gt;fmr&lt;/a&gt;, there are several issues relevant to the problem you&apos;ve encountered:&lt;/p&gt;

&lt;p&gt;Multi-term synonyms invoke graphPhraseQuery, implemented for &lt;tt&gt;6.5 &amp;lt;= &lt;em&gt;version&lt;/em&gt; &amp;lt; 7.6&lt;/tt&gt; as SpanNearQuery, which was not prone to exponential growth; but (also prior to 7.6) that SpanNearQuery was completely ignored. It&apos;s the latter problem (ignoring) that this issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12243&quot; title=&quot;Edismax missing phrase queries when phrases contain multiterm synonyms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12243&quot;&gt;&lt;del&gt;SOLR-12243&lt;/del&gt;&lt;/a&gt;) fixes.&lt;/p&gt;

&lt;p&gt;The exponential expansion is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8531&quot; title=&quot;QueryBuilder hard-codes inOrder=true for generated sloppy span near queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8531&quot;&gt;&lt;del&gt;LUCENE-8531&lt;/del&gt;&lt;/a&gt;, which reverts &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-7699&quot; title=&quot;Apply graph articulation points optimization to phrase graph queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-7699&quot;&gt;&lt;del&gt;LUCENE-7699&lt;/del&gt;&lt;/a&gt; by changing the SpanNearQuery graph phrase query implementation back to the pre-6.5 MultiPhraseQuery implementation (when&#160;slop&amp;gt;0), for semantic compatibility reasons.&lt;/p&gt;

&lt;p&gt;MultiPhraseQuery is inherently susceptible to exponential expansion, so there is no workaround at the moment to fully support a high degree of synonym expansion in conjunction with slop&amp;gt;0. Regarding the manifestation of the problem as &quot;single query taking down an entire solr-server&quot;, this should be mitigated starting in 8.1 (see&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13336&quot; title=&quot;solrconfig.xml maxBooleanClauses ignored by programtic/rewrtten queries; can result in exponential expansion of naive queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13336&quot;&gt;&lt;del&gt;SOLR-13336&lt;/del&gt;&lt;/a&gt;). Individual queries will still fail if expanded beyond a&#160;configurable threshold (number of clauses), but the type of systemic problem that you encountered will be prevented.&lt;/p&gt;

&lt;p&gt;Regarding a potential longer-term solution, it might be worth looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8544&quot; title=&quot;In SpanNearQuery, add support for inOrder semantics equivalent to that of (Multi)PhraseQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8544&quot;&gt;LUCENE-8544&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16836454" author="fmr" created="Thu, 9 May 2019 15:05:00 +0000"  >&lt;p&gt;Thanks for taking the time to explain and link other issues &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgibney&quot; class=&quot;user-hover&quot; rel=&quot;mgibney&quot;&gt;mgibney&lt;/a&gt;.&#160; Good we&apos;re not alone here.&#160; For the time being we&apos;ve limited pf to only allow non-synonym fields as pf is really not that crucial for our site.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13191713">LUCENE-8531</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13169404">SOLR-12532</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13154604">SOLR-12260</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12946924" name="SOLR-12243.patch" size="15938" author="sarowe" created="Mon, 5 Nov 2018 15:27:00 +0000"/>
                            <attachment id="12945848" name="SOLR-12243.patch" size="12114" author="sarowe" created="Sat, 27 Oct 2018 01:53:49 +0000"/>
                            <attachment id="12944131" name="SOLR-12243.patch" size="12116" author="ehaubert" created="Tue, 16 Oct 2018 13:01:03 +0000"/>
                            <attachment id="12921951" name="SOLR-12243.patch" size="10946" author="abenedetti" created="Fri, 4 May 2018 12:44:52 +0000"/>
                            <attachment id="12921615" name="SOLR-12243.patch" size="11500" author="abenedetti" created="Wed, 2 May 2018 17:59:23 +0000"/>
                            <attachment id="12921075" name="SOLR-12243.patch" size="11500" author="abenedetti" created="Fri, 27 Apr 2018 22:13:12 +0000"/>
                            <attachment id="12920318" name="SOLR-12243.patch" size="8956" author="ehaubert" created="Mon, 23 Apr 2018 18:22:47 +0000"/>
                            <attachment id="12944839" name="multiword-synonyms.txt" size="687" author="ehaubert" created="Sat, 20 Oct 2018 01:22:39 +0000"/>
                            <attachment id="12944838" name="schema.xml" size="2085" author="ehaubert" created="Sat, 20 Oct 2018 01:22:39 +0000"/>
                            <attachment id="12944837" name="solrconfig.xml" size="18273" author="ehaubert" created="Sat, 20 Oct 2018 01:22:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ss1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>