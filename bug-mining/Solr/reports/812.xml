<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:25:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2719] REGRESSION ReturnFields incorrect parse fields with hyphen - breaks existing &quot;fl=my-field-name&quot; type usecases</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2719</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;fl=my-hyphen-field in query params parsed as &quot;my&quot; instead of &quot;my-hyphen-field&quot;.&lt;/p&gt;

&lt;p&gt;OAS.search.ReturnFields use method getId() from OAS.search.QueryParsing&lt;br/&gt;
in which check chars &quot;if (!Character.isJavaIdentifierPart(ch) &amp;amp;&amp;amp; ch != &apos;.&apos;)&quot;&lt;br/&gt;
Hyphen is not JavaIdentifierPart and this check break when first &quot;-&quot; is found.&lt;/p&gt;

&lt;p&gt;This problem solve by passing &apos;-&apos; to check:&lt;br/&gt;
if (!Character.isJavaIdentifierPart(ch) &amp;amp;&amp;amp; ch != &apos;.&apos; &amp;amp;&amp;amp; ch != &apos;-&apos;) break;&lt;/p&gt;

&lt;p&gt;But I don&apos;t know how it can affect on whole project.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12519412">SOLR-2719</key>
            <summary>REGRESSION ReturnFields incorrect parse fields with hyphen - breaks existing &quot;fl=my-field-name&quot; type usecases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="sharky">Nik V. Babichev</reporter>
                        <labels>
                            <label>field</label>
                            <label>fl</label>
                            <label>query</label>
                            <label>queryparser</label>
                    </labels>
                <created>Fri, 19 Aug 2011 13:30:24 +0000</created>
                <updated>Fri, 10 May 2013 10:40:56 +0000</updated>
                            <resolved>Tue, 13 Mar 2012 20:08:26 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13124364" author="hossman" created="Mon, 10 Oct 2011 18:25:57 +0000"  >&lt;p&gt;setting this as a blocker for 4.0 since it is a fairly serious regression for anyone using field names with &quot;-&quot; in them&lt;/p&gt;</comment>
                            <comment id="13128223" author="sharky" created="Sat, 15 Oct 2011 15:45:51 +0000"  >&lt;p&gt;Is it so hard to fix it? &lt;br/&gt;
How can I help in fixing?&lt;/p&gt;</comment>
                            <comment id="13219545" author="lucacavanna" created="Wed, 29 Feb 2012 21:02:16 +0000"  >&lt;p&gt;My patch isn&apos;t a fix but just a starting point: it adds a ReturnFieldsTest class which tests some of the new fl features. Some tests are of course failing. The biggest problem is the hyphen within the field name, which I guess is widely used. This could be corrected as suggested by Nik, but we have problems with other characters, even if less used within field names.&lt;/p&gt;

&lt;p&gt;Solr doesn&apos;t validate field names, but now a lot of potential field names can&apos;t actually be used within the fl parameter, or even worse they break the query. Some of my test methods are intentionally weird, like the ~idtest or id$test, but those field names are both allowed by Solr. I&apos;m afraid we might have the same problem with sorting since the QueryParsing#parseSort uses the same StrParser#getId method.&lt;/p&gt;

&lt;p&gt;The main rule to identify the end of a field name in StrParser#getId seems to be the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;.isJavaIdentifierPart(ch) &amp;amp;&amp;amp; ch != &lt;span class=&quot;code-quote&quot;&gt;&apos;.&apos;&lt;/span&gt;)
	&lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I guess it should be extended, not just with the hyphen, but in my opinion the point here is not just correct the hyphen regression. I think we should introduce consistency between fl and decide which characters Solr should accept within a field name. I mean, if Solr accepts everything, we&apos;ll always have this fl problem. What are your thoughts guys?&lt;/p&gt;</comment>
                            <comment id="13221234" author="ryantxu" created="Fri, 2 Mar 2012 20:17:42 +0000"  >&lt;p&gt;I added the tests with @Ignore in revision: 1296434&lt;/p&gt;</comment>
                            <comment id="13222379" author="yseeley@gmail.com" created="Mon, 5 Mar 2012 14:49:04 +0000"  >&lt;p&gt;I&apos;ve been saying for a while that using roughly java identifiers for field names was best practice, but we should document it somewhere.&lt;/p&gt;

&lt;p&gt;I don&apos;t think we should change StrParser.getId to be more permissive though - that will just cause more problems in the future (say when we want to start adding infix and want a-b to be a minus b.  There&apos;s not a regression in that specific code since the function parser has never accepted &quot;-&quot; as part of a field name.&lt;/p&gt;</comment>
                            <comment id="13222394" author="lucacavanna" created="Mon, 5 Mar 2012 15:21:51 +0000"  >&lt;p&gt;Yonik, I see your point. On the other hand, the dash is a widely used character within field names. The regression is on the Solr behaviour, and I think it&apos;s pretty annoying from a user perspective.&lt;/p&gt;

&lt;p&gt;Anyway, if that&apos;s the direction of the project, no problem. What matters more than anything else is consistency. We should document it somewhere as you wrote, but I&apos;d also propose a field names validation at Solr startup, using the StrParser rules, so that Solr accepts only allowed field names and can guarantee the proper behaviour with all allowed field names.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13222401" author="markrmiller@gmail.com" created="Mon, 5 Mar 2012 15:35:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;but I&apos;d also propose a field names validation at Solr startup,&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 - rather than playing loosey goosey on what&apos;s a valid field name, we should doc and validate for it explicitly.&lt;/p&gt;</comment>
                            <comment id="13222408" author="yseeley@gmail.com" created="Mon, 5 Mar 2012 15:41:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yonik, I see your point. On the other hand, the dash is a widely used character within field names. The regression is on the Solr behaviour, and I think it&apos;s pretty annoying from a user perspective.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The easiest way to handle this would be this code in ReturnFields:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; circuit test &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a really simple field name
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; field = sp.getId(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; ch = sp.ch();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Instead of using getId, we should hand-roll something that also accepts &quot;-&quot; as part of the field name.  That would leave function parser (and other users of getId) alone, but allow fieldnames with dashes in the fl param.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What matters more than anything else is consistency.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If we really want to go for consistency, then we should not accept &quot;-&quot; anywhere (rather than attempting to expand it to everywhere).&lt;/p&gt;</comment>
                            <comment id="13222443" author="lucacavanna" created="Mon, 5 Mar 2012 16:44:43 +0000"  >&lt;p&gt;How about trying to achieve both? I mean, are there many other places where we should do the same (adding the dash support)? QueryParsing#parseSort has the same problem. Anything else? I&apos;m probably missing something.&lt;/p&gt;

&lt;p&gt;Depending on where we need to add support for dash to add consistency, I would try to add support for the trailing dash here for backward compatibility (I&apos;d have a patch almost ready), and work on validation as well.&lt;/p&gt;</comment>
                            <comment id="13222449" author="yseeley@gmail.com" created="Mon, 5 Mar 2012 17:00:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;How about trying to achieve both? I mean, are there many other places where we should do the same (adding the dash support)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this &quot;regression&quot; is limited to &quot;fl&quot; since that code was changed to support pseudo-fields.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;QueryParsing#parseSort has the same problem.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I just tried trunk with &quot;sort=a-b_s desc&quot; and it seemed to work fine.&lt;/p&gt;</comment>
                            <comment id="13223261" author="lucacavanna" created="Tue, 6 Mar 2012 13:58:29 +0000"  >&lt;p&gt;Right Yonik, I&apos;ve been misled by the &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; field = sp.getId(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;at the beginning of QueryParsing#parseSort, while the method to look at was getSimpleName. Sorting is ok (but I don&apos;t completely understand the sp.getId at the beginning).&lt;/p&gt;

&lt;p&gt;I attached a new patch: I added to StrParser a getFieldName method and added to getId the possibility to pass a vararg parameter of allowed trailing chars.&lt;br/&gt;
I made also some changes to ReturnFields to make the code a little bit more readable to me, hope is the same for you guys. Tests work.&lt;br/&gt;
I removed the weird tests about trailing tilde and so on, kept just the trailing dash test which now works (removed @Ignore).&lt;/p&gt;

&lt;p&gt;Let me know what you think.&lt;/p&gt;

&lt;p&gt;I&apos;m going to open a new issue to add field names validation.&lt;/p&gt;</comment>
                            <comment id="13227608" author="lucacavanna" created="Mon, 12 Mar 2012 15:28:28 +0000"  >&lt;p&gt;Since this issue is blocker for 4.0, it would great to close it soon. Let me know if there&apos;s something more I can do to help!&lt;/p&gt;</comment>
                            <comment id="13228131" author="yseeley@gmail.com" created="Tue, 13 Mar 2012 01:47:19 +0000"  >&lt;p&gt;Here&apos;s a simpler patch that tries to change less (only that first getId call).&lt;/p&gt;

&lt;p&gt;I didn&apos;t go with the varargs version because it creates objects on every call.&lt;/p&gt;</comment>
                            <comment id="13228302" author="lucacavanna" created="Tue, 13 Mar 2012 09:53:22 +0000"  >&lt;p&gt;Thanks Yonik. I&apos;m of course ok with your patch! &lt;br/&gt;
I agree with your varargs comment, my code was also more generic than it should. But maybe some other changes could be useful to make the code a little more readable here. Furthermore, if we can avoid copy &amp;amp; pasting the same code it&apos;s better I guess.&lt;br/&gt;
Anyway, the most important thing is closing this issue, up to you.&lt;/p&gt;</comment>
                            <comment id="13228655" author="yseeley@gmail.com" created="Tue, 13 Mar 2012 20:08:26 +0000"  >&lt;p&gt;committed.  I also added a note about recommended field naming to the schema.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12526115">SOLR-2815</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12545343">SOLR-3207</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12502401">SOLR-2444</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12518140" name="SOLR-2719.patch" size="1341" author="yseeley@gmail.com" created="Tue, 13 Mar 2012 01:47:19 +0000"/>
                            <attachment id="12517238" name="SOLR-2719.patch" size="11908" author="lucacavanna" created="Tue, 6 Mar 2012 13:58:29 +0000"/>
                            <attachment id="12516605" name="SOLR-2719.patch" size="10695" author="lucacavanna" created="Wed, 29 Feb 2012 21:02:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>540</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03j07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>