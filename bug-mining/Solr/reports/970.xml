<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:29:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3688] Spellchecker or JSONTestUtil has a bug with Java 8 (or possibly Java 7u6+) - randomly failing spellchecker test</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3688</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The Java 8 builds of trunk and branch4x fail &amp;gt;50% of all times with:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.RuntimeException: mismatch: &apos;0&apos;!=&apos;2&apos; @ spellcheck/suggestions/bar/startOffset
	at __randomizedtesting.SeedInfo.seed([9B1635CDE22895EA:5C18C165EA4480A2]:0)
	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:573)
	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:521)
	at org.apache.solr.handler.component.SpellCheckComponentTest.testPerDictionary(SpellCheckComponentTest.java:102)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am scared by JSONTestUtil so I have no idea what causes this. As a lot of other JSON-related things were buggy with Java 8, I think this has same cause. The JSONTestUtil seems to depend on the order of some HashMap/HashSet created by noggit. The order of hashed collections changed in Java 8 in an incompatible way. Later versions of Java 7 (u6+) will do the same with larger collections:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;From: Mike Duigou &amp;lt;mike.duigou@oracle.com&amp;gt;&lt;br/&gt;
Date: Sat, Jul 14, 2012 at 1:09 AM&lt;br/&gt;
Subject: Update on alternative hashing for String keys with hash-based Maps&lt;br/&gt;
To: core-libs-dev Libs &amp;lt;core-libs-dev@openjdk.java.net&amp;gt;, jdk7u-dev@openjdk.java.net&lt;/p&gt;


&lt;p&gt;Hello all;&lt;/p&gt;

&lt;p&gt;About a month ago a significant change was made to the Java SE 7 and 8 hash based Map implementations. This change was previously proposed and discussed on this list&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. The change affects all of the hashing based Map implementations (HashMap, Hashtable, WeakHashMap, LinkedHashMap, ConcurrentHashMap), the derived Set implementations (HashSet, LinkedHashSet,&lt;br/&gt;
etc.) and other classes which depend upon these classes (Properties, UIDefaults). The change to hash based Maps improves performance when a large number of key hash code collisions are encountered. This is accomplished by altering the handling of String keys to use a different (better) hash function.&lt;/p&gt;

&lt;p&gt;As initially proposed, the alternative hashing behaviour was planned to apply to all hash based Maps larger than 512 elements. Smaller maps would continue to use the existing hashing approach.&lt;br/&gt;
ConcurrentHashMap, because reasons related to the complexity of it&apos;s implementation, would always use the improved approach regardless of map capacity. Providing capacity based triggering of the alternative hashing is intended to improve compatibility by ensuring that the order in which elements are iterated does not change. Specifically, at less than the threshold capacity Map elements will be iterated in the same order as today.&lt;br/&gt;
At or above the threshold, the iteration order will be different than the current order. Testing and evaluation of existing Java applications has shown us that some applications have explicit or implicit dependence upon the order that keys, values or entries will be iterated. The vast majority of iteration order dependent cases involve small maps--once a map contains hundreds of elements generally incorrect assumptions about iteration order will have already been found and resolved. We believed that triggering the alternative hashing behaviour at 512 element capacity would protect iteration order in cases which depended upon the existing iteration order.&lt;br/&gt;
Java SE 7 and Java SE 8 have different policies. Java SE 8 is intended to always use alternative hashing of String keys regardless of the capacity of the Map.&lt;/p&gt;

&lt;p&gt;After  integration a number of cases of iteration order dependence were encountered within the OpenJDK code itself, in tests and in user code. Some of these faults were easily diagnosed and correct. Some other cases, because iteration order is not consistent from run-to-run under alternative hashing, proved difficult to isolate and resolve.&lt;/p&gt;

&lt;p&gt;Following this testing and and consultation with Java licensees and developers it was decided disable the alternative hashing behaviour for Java SE 7.  To ensure the greatest degree of compatibility with existing applications it seems best to only enable alternative hashing by explicit control. In Java SE 7u6 it will be necessary to set the system property jdk.map.althashing.threshold in order to enable alternative hashing. It is also still possible that the feature may be enabled by default in future Java SE 7 releases but this will only happen if further testing indicates compatibility can be reasonably assured.&lt;/p&gt;

&lt;p&gt;Because Java 8 is unreleased and we still wish to shake out iteration order dependencies alternative hashing remains enabled in Java SE 8.&lt;br/&gt;
Alternative hashing is very likely to be enabled by default in Java SE 8.&lt;br/&gt;
Doug Lea has been investigating further improvements to handling of key hash code collisions and his design is extremely likely to be the basis for all Java SE 8 hash based Map implementations.&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Developers and deployers are strongly encouraged to test their applications by enabling the alternative String key hashing feature in Java SE 7u6 or later and/or testing with Java SE 8 builds. BE WARNED:&lt;br/&gt;
it will probably not be possible to disable alternative hashing in Java SE 8. Applications MUST remove dependencies upon iteration order before they can be deployed with Java SE 8.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Mike&lt;/p&gt;

&lt;p&gt;TL;DR:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Java SE 7 and 8 both now support alternative hashing for String keys with hash based Maps&lt;/li&gt;
	&lt;li&gt;Alternative hashing improves performance when many String key hash codes collide&lt;/li&gt;
	&lt;li&gt;Alternative hashing impacts key, value and element iteration order&lt;/li&gt;
	&lt;li&gt;Alternative hashing is currently DISABLED by default for Java SE 7&lt;/li&gt;
	&lt;li&gt;Future Java SE 7 releases may enable alternative hashing for &quot;large&quot;&lt;br/&gt;
(&amp;gt;512 capacity) maps&lt;/li&gt;
	&lt;li&gt;Developers can enable the eature in Java SE 7 for testing and deployment with a system property&lt;/li&gt;
	&lt;li&gt;Alternative hashing is ENABLED for all maps in Java SE 8&lt;/li&gt;
	&lt;li&gt;It will probably not be possible to disable alternative hashing in Java SE&lt;br/&gt;
8&lt;/li&gt;
	&lt;li&gt;Hash map key, value and element iteration order WILL be different and unpredictable in Java SE 8&lt;/li&gt;
	&lt;li&gt;Different implementation approaches are still being investigated for Java SE 8 and remain subject to change&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://mail.openjdk.java.net/pipermail/core-libs-dev/2012-May/010238.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail.openjdk.java.net/pipermail/core-libs-dev/2012-May/010238.html&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://cs.oswego.edu/pipermail/concurrency-interest/2012-June/009505.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cs.oswego.edu/pipermail/concurrency-interest/2012-June/009505.html&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If this is not the case, spellchecker has a problem with Java 8.&lt;/p&gt;

&lt;p&gt;There is nothing I am able to do because of the complexity of this test framework for JSON, but I really would like to fix this bug! So please: Somebody please, please, please give me a hint, I can then try to provide a patch!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600595">SOLR-3688</key>
            <summary>Spellchecker or JSONTestUtil has a bug with Java 8 (or possibly Java 7u6+) - randomly failing spellchecker test</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="uschindler">Uwe Schindler</reporter>
                        <labels>
                            <label>Java8</label>
                    </labels>
                <created>Sun, 29 Jul 2012 13:26:53 +0000</created>
                <updated>Fri, 10 May 2013 10:40:39 +0000</updated>
                            <resolved>Mon, 30 Jul 2012 16:09:07 +0000</resolved>
                                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0-BETA</fixVersion>
                                    <component>spellchecker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13424544" author="thetaphi" created="Sun, 29 Jul 2012 13:29:44 +0000"  >&lt;p&gt;I disabled the failing test in trunk and 4.x!&lt;/p&gt;</comment>
                            <comment id="13424612" author="yseeley@gmail.com" created="Sun, 29 Jul 2012 19:34:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;The JSONTestUtil seems to depend on the order of some HashMap/HashSet&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Really?  Can you point to where so it can be fixed?&lt;/p&gt;</comment>
                            <comment id="13424615" author="thetaphi" created="Sun, 29 Jul 2012 19:42:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Really? Can you point to where so it can be fixed?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please read the full issue description.&lt;/p&gt;</comment>
                            <comment id="13424616" author="yseeley@gmail.com" created="Sun, 29 Jul 2012 20:03:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Please read the full issue description.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thank you... that&apos;s a very helpful response.&lt;br/&gt;
I guess I was responding to the part where you thought this was a noggit problem or a JSONTestUtil problem.  But perhaps I should have been paying attention to when you say &quot;I have no idea what causes this&quot; instead.&lt;/p&gt;
</comment>
                            <comment id="13424618" author="thetaphi" created="Sun, 29 Jul 2012 20:17:18 +0000"  >&lt;p&gt;Sorry for being imprecise. I still think this has something to do with hashing order. I thought JSONTestUtil is maybe the problem - because the follwoing: From all tests in this suite, only this test returns a JSON result with 2 entries, all others (and most tests in Solr) return only one. Also the difference here looks exactly like a wrong order issue, because the error message sees the value from one result row, but expects the value from the other.&lt;/p&gt;

&lt;p&gt;Of course this can be something in SpellChecker itsself.&lt;/p&gt;</comment>
                            <comment id="13424620" author="yseeley@gmail.com" created="Sun, 29 Jul 2012 20:26:34 +0000"  >&lt;p&gt;The test is asserting that the startOffset for suggestion &quot;bar&quot; is &quot;0&quot;, while the response clearly shows it as &quot;2&quot;.  So this looks like a bad test or a bug in the spellcheck/suggest component.&lt;/p&gt;

&lt;p&gt;From the log file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;5736 T165 oas.SolrTestCaseJ4.assertJQ SEVERE query failed JSON validation. error=mismatch: &lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;!=&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt; @ spellcheck/suggestions/bar/startOffset
	 expected =/spellcheck/suggestions/bar=={&lt;span class=&quot;code-quote&quot;&gt;&quot;numFound&quot;&lt;/span&gt;:1, &lt;span class=&quot;code-quote&quot;&gt;&quot;startOffset&quot;&lt;/span&gt;:0, &lt;span class=&quot;code-quote&quot;&gt;&quot;endOffset&quot;&lt;/span&gt;:1, &lt;span class=&quot;code-quote&quot;&gt;&quot;suggestion&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;]}
	 response = {
	  &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{
	    &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,
	    &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:0},
	  &lt;span class=&quot;code-quote&quot;&gt;&quot;command&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;build&quot;&lt;/span&gt;,
	  &lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;numFound&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;docs&quot;&lt;/span&gt;:[]
	  },
	  &lt;span class=&quot;code-quote&quot;&gt;&quot;spellcheck&quot;&lt;/span&gt;:{
	    &lt;span class=&quot;code-quote&quot;&gt;&quot;suggestions&quot;&lt;/span&gt;:{
	      &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;:{
	        &lt;span class=&quot;code-quote&quot;&gt;&quot;numFound&quot;&lt;/span&gt;:1,
	        &lt;span class=&quot;code-quote&quot;&gt;&quot;startOffset&quot;&lt;/span&gt;:0,
	        &lt;span class=&quot;code-quote&quot;&gt;&quot;endOffset&quot;&lt;/span&gt;:1,
	        &lt;span class=&quot;code-quote&quot;&gt;&quot;suggestion&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;]},
	      &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;:{
	        &lt;span class=&quot;code-quote&quot;&gt;&quot;numFound&quot;&lt;/span&gt;:1,
	        &lt;span class=&quot;code-quote&quot;&gt;&quot;startOffset&quot;&lt;/span&gt;:2,
	        &lt;span class=&quot;code-quote&quot;&gt;&quot;endOffset&quot;&lt;/span&gt;:3,
	        &lt;span class=&quot;code-quote&quot;&gt;&quot;suggestion&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;]}}}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13424948" author="yseeley@gmail.com" created="Mon, 30 Jul 2012 16:09:07 +0000"  >&lt;p&gt;The issue was a test bug in DummyCustomParamSpellChecker that iterated over map parameters and generated dummy startOffset/endOffset numbers from the param order.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1367125&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1367125&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243295</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03d7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17572</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>