<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:36:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4773] New discovery mode needs to ensure that instanceDir is correct</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4773</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Doing a fresh checkout of 4.x (trunk to to I think) and firing up the example fails because we can&apos;t find solrconfig. The construction of the instanceDir in SolrCoreDiscoverer constructs a path with an extra solr (e.g. solr/solr/core).&lt;/p&gt;

&lt;p&gt;I&apos;ll attach a patch shortly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12645080">SOLR-4773</key>
            <summary>New discovery mode needs to ensure that instanceDir is correct</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Apr 2013 14:45:01 +0000</created>
                <updated>Mon, 9 May 2016 18:45:13 +0000</updated>
                            <resolved>Sun, 16 Mar 2014 13:31:29 +0000</resolved>
                                    <version>4.4</version>
                    <version>6.0</version>
                                    <fixVersion>4.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13644031" author="thetaphi" created="Sun, 28 Apr 2013 14:52:21 +0000"  >&lt;p&gt;Yeah the nightly smoker already failed! I hope this does not affect 4.3?&lt;/p&gt;</comment>
                            <comment id="13644041" author="jkrupan" created="Sun, 28 Apr 2013 15:37:23 +0000"  >&lt;p&gt;4.3 RC3 example runs fine for me.&lt;/p&gt;

&lt;p&gt;branch_4x ant run-example also works fine (although it has the problem with no longer supporting implicit collection name.)&lt;/p&gt;

&lt;p&gt;But ant package for branch_4x, unzip the release, run the example from the release gives me the reported problem.&lt;/p&gt;</comment>
                            <comment id="13644042" author="erickerickson" created="Sun, 28 Apr 2013 15:37:43 +0000"  >&lt;p&gt;Here&apos;s a preliminary patch that I really don&apos;t like much, but it illustrates the problem and has a test case. There&apos;s &lt;em&gt;got&lt;/em&gt; to be a better way of removing the ancestor paths.&lt;/p&gt;</comment>
                            <comment id="13644043" author="erickerickson" created="Sun, 28 Apr 2013 15:45:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; Don&apos;t think this affects 4.3, or if it does only people using the core discovery process. At least I switched to the example solr.xml file that uses core discovery from 4.x to 4.3, compiled and it was OK.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkrupan&quot; class=&quot;user-hover&quot; rel=&quot;jkrupan&quot;&gt;jkrupan&lt;/a&gt; blew up for me when I built 4x.&lt;/p&gt;
</comment>
                            <comment id="13644046" author="erickerickson" created="Sun, 28 Apr 2013 16:08:52 +0000"  >&lt;p&gt;I take it back, the new test in the patch does &lt;em&gt;NOT&lt;/em&gt; fail without the code changes, probably because it&apos;s an absolute rather than relative path... But my plane is descending so I&apos;ll be chopped off pretty soon, I&apos;ll be looking later.&lt;/p&gt;</comment>
                            <comment id="13644135" author="erickerickson" created="Sun, 28 Apr 2013 21:11:40 +0000"  >&lt;p&gt;Different approach, putting up for comment before committing. Are there any good reasons &lt;em&gt;not&lt;/em&gt; to use the absolute path for this (legacy) instanceDir stuff? This patch uses absolute path here....&lt;/p&gt;</comment>
                            <comment id="13644928" author="erickerickson" created="Mon, 29 Apr 2013 21:55:18 +0000"  >&lt;p&gt;Unless someone thinks this is a bad idea, I&apos;ll commit this later this evening (PST).&lt;/p&gt;</comment>
                            <comment id="13645544" author="janhoy" created="Tue, 30 Apr 2013 12:54:47 +0000"  >&lt;p&gt;+1&lt;br/&gt;
Tested on branch_4x&lt;/p&gt;</comment>
                            <comment id="13645567" author="commit-tag-bot" created="Tue, 30 Apr 2013 13:27:05 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; erick&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1477621&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1477621&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4773&quot; title=&quot;New discovery mode needs to ensure that instanceDir is correct&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4773&quot;&gt;&lt;del&gt;SOLR-4773&lt;/del&gt;&lt;/a&gt;, discovery mode needed a change to instanceDir&lt;/p&gt;</comment>
                            <comment id="13645598" author="commit-tag-bot" created="Tue, 30 Apr 2013 14:07:38 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; erick&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1477639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1477639&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4773&quot; title=&quot;New discovery mode needs to ensure that instanceDir is correct&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4773&quot;&gt;&lt;del&gt;SOLR-4773&lt;/del&gt;&lt;/a&gt;, setting instanceDir in core discovery mode&lt;/p&gt;</comment>
                            <comment id="13645600" author="erickerickson" created="Tue, 30 Apr 2013 14:08:36 +0000"  >&lt;p&gt;trunk - r: 1477621&lt;br/&gt;
4.x   - r: 1477639&lt;/p&gt;</comment>
                            <comment id="13645970" author="markrmiller@gmail.com" created="Tue, 30 Apr 2013 20:55:32 +0000"  >&lt;p&gt;It doesn&apos;t look like you committed the test?&lt;/p&gt;</comment>
                            <comment id="13645973" author="markrmiller@gmail.com" created="Tue, 30 Apr 2013 20:57:40 +0000"  >&lt;p&gt;Reopening to track and make sure we get a test in that can catch this.&lt;/p&gt;</comment>
                            <comment id="13646075" author="erickerickson" created="Tue, 30 Apr 2013 22:30:07 +0000"  >&lt;p&gt;That&apos;d be great. I tried to create a test, but I gave up fighting the test infrastructure. The problem I had trying to create a test is that I couldn&apos;t figure out how to create a test that didn&apos;t have absolute paths for the dir in question, and I wasn&apos;t able to create a failure with abs paths.....&lt;/p&gt;

&lt;p&gt;Looking forward to someone showing me how to make that happen.....&lt;/p&gt;
</comment>
                            <comment id="13646139" author="markrmiller@gmail.com" created="Tue, 30 Apr 2013 23:18:34 +0000"  >&lt;p&gt;I&apos;ll tackle it (though probably not until the weekend).&lt;/p&gt;</comment>
                            <comment id="13649960" author="andyfowler" created="Mon, 6 May 2013 18:32:30 +0000"  >&lt;p&gt;I&apos;m thinking this is the cause of a bug I&apos;m seeing in the 4.3.0 release. To reproduce using the multicore example:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;echo &quot;&amp;lt;solr&amp;gt;&amp;lt;/solr&amp;gt;&quot; &amp;gt; multicore/solr.xml to put it into core discovery mode&lt;/li&gt;
	&lt;li&gt;place a core.properties file in core0/ and core1/ directories, just with loadOnStartup and transient properties defined.&lt;/li&gt;
	&lt;li&gt;start example `java -Dsolr.solr.home=multicore -jar start.jar`&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You should receive a &quot;More than one core points to data dir &apos;multicore/data/&apos;&quot; failure on startup. Setting a relative path in each core.properties file doesn&apos;t work &#8212;&#160;it only works when I provide discrete dataDir for each core.&lt;/p&gt;</comment>
                            <comment id="13650032" author="markrmiller@gmail.com" created="Mon, 6 May 2013 19:44:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;You should receive a &quot;More than one core points to data dir &apos;multicore/data/&apos;&quot; failure on startup. Setting a relative path in each core.properties file doesn&apos;t work &#8212; it only works when I provide discrete dataDir for each core.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve ripped all that data dir checking out for 4.4.&lt;/p&gt;</comment>
                            <comment id="13650033" author="andyfowler" created="Mon, 6 May 2013 19:44:56 +0000"  >&lt;p&gt;Confirmed by compiling branch_4x that this fixes the bug I noticed in 4.3.0 release. To future travelers, this means that each core.properties file needs a discrete dataDir property in 4.3.0.&lt;/p&gt;</comment>
                            <comment id="13650042" author="erickerickson" created="Mon, 6 May 2013 19:58:01 +0000"  >&lt;p&gt;bq: I&apos;ve ripped all that data dir checking out for 4.4.&lt;/p&gt;

&lt;p&gt;Does that include the checking for cores with the same name? Seems like that makes it easier for people to shoot themselves in the foot without giving them &lt;em&gt;any&lt;/em&gt; clues what went wrong. And core discovery makes that pretty easy to do, just copy the core.properties file around and forget to change the name parameter.. Or an absolute path to the datadir....&lt;/p&gt;</comment>
                            <comment id="13650058" author="markrmiller@gmail.com" created="Mon, 6 May 2013 20:14:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Does that include the checking for cores with the same name?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, all this checking and how it was done just further complicates the code and we want to get away from pre configuration as a way to create collections anyhow.&lt;/p&gt;

&lt;p&gt;We should just keep this simple - a core should fail to be created in the core container if there is an existing core with the same name, that&apos;s it.&lt;/p&gt;

&lt;p&gt;I feel all the transient and other recent changes to CoreContainer are really starting to significantly complicate what was already a design that needed some love, so I&apos;m trying to simplify as much as possible so we can more easily refactor down the line.&lt;/p&gt;</comment>
                            <comment id="13650098" author="erickerickson" created="Mon, 6 May 2013 20:46:31 +0000"  >&lt;p&gt;Makes sense, I wasn&apos;t altogether happy with the complexification. But we&apos;re leaving the user high and dry when tracking down errors.&lt;/p&gt;

&lt;p&gt;Take 4.x and just copy collection1 to collection2 and fire up solr. No warnings in the log. No errors in the log. But you can&apos;t get to collection2, you get a 404 error. And any index mods are done in the collection2 directory.&lt;/p&gt;

&lt;p&gt;Admittedly the configuration is foo&apos;d and Solr is doing exactly what the defined behavior is (identically named cores last one wins). But how the hell is someone supposed to track that down? Especially with lots of cores? They don&apos;t get a single clue in the place we always say to look, the solr log.&lt;/p&gt;

&lt;p&gt;I see where there are tests for creating a core with the same name as an existing core via the core admin handler, but I don&apos;t see at a glance any coverage for this scenario.&lt;/p&gt;</comment>
                            <comment id="13650104" author="andyfowler" created="Mon, 6 May 2013 20:52:57 +0000"  >&lt;p&gt;Just to throw in my $0.02 as an app developer and solr consumer w/ far less knowledge on the rest of the worlds&apos; use cases: if I accidentally put solr into a state where two cores were sharing a dataDir, I would really want some sort of strong warning, or just an absolute failure.&lt;/p&gt;

&lt;p&gt;I really like the way that cores are moving to being just a simple directory on the FS, rather than a block in a monolithic XML file. But if the cores are moving toward more backing by directory + properties file, it seems like accidentally sharing a dataDir could be a really bad thing.&lt;/p&gt;</comment>
                            <comment id="13650117" author="markrmiller@gmail.com" created="Mon, 6 May 2013 21:24:13 +0000"  >&lt;p&gt;You should get an error as I said - we just shouldn&apos;t be trying to detect it that way. Corecontainer should throw an exception when a core is added with an existing name. &lt;/p&gt;</comment>
                            <comment id="13650123" author="erickerickson" created="Mon, 6 May 2013 21:32:04 +0000"  >&lt;p&gt;New JIRA for same-named cores, see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4790&quot; title=&quot;When defining a core with the same name (discovery mode or not), CoreContainer should throw an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4790&quot;&gt;&lt;del&gt;SOLR-4790&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13659676" author="elyograg" created="Thu, 16 May 2013 16:22:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andyfowler&quot; class=&quot;user-hover&quot; rel=&quot;andyfowler&quot;&gt;andyfowler&lt;/a&gt; - I finally found some time and looked into this more deeply in relation to 4.3.0.  The patch for this issue does not fix the problem with relative dataDirs in the released version.  The patch as-is won&apos;t apply to 4.3.0 because the code in branch_4x was significantly refactored, but I found the right place to apply the change from getPath to getCanonicalPath, and it didn&apos;t help.  It did fix an exception during startup (solrconfig.xml couldn&apos;t be found) when I followed your simple instructions for running the multicore example with discovery, but only core0 started, core1 didn&apos;t, because it had the same dataDir as core0.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; - Do you happen to know how we can fix the problem with relative or missing dataDir properties in the 4.3 branch?  Would the change be trivial enough to make it to 4.3.1?  Discovery mode is essentially broken at the moment in the 4.3.0 release unless you have full absolute paths that are explicitly declared in the properties file.  This is not how I want things to work in my own setup.&lt;/p&gt;</comment>
                            <comment id="13659699" author="markrmiller@gmail.com" created="Thu, 16 May 2013 16:52:20 +0000"  >&lt;p&gt;I don&apos;t know that it would be that easy - I honestly think it could involve multiple bugs - I fixed many little things in this area in 4x and I think erick has as well. With all the refactoring and all the bugs (there is still a critical outstanding one around persistence if I remember right), as I&apos;ve said elsewhere, I don&apos;t consider the new solr.xml format to be usable for 4.3 and I don&apos;t think I can confidently make it solid for 4.3.1 - I&apos;ve dedicated what time I can to make it solid for 4.4 (and I know there is still work to do and work I&apos;ve done but not put up yet), which shouldn&apos;t be too far out.&lt;/p&gt;

&lt;p&gt;I reccomended keeping this stuff in 5x and changing the tests and example to use it before pushing it out in a release - as I said, it didn&apos;t actually bake in 5x by sitting there, essentially hidden from dev use and wide testing for a couple weeks - I pushed back a bit multiple times - because I was worried this would be the result, but at this point, we are where we are, and I can only offer to help make things usable for 4.4 at best.&lt;/p&gt;</comment>
                            <comment id="13659703" author="elyograg" created="Thu, 16 May 2013 16:58:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;at this point, we are where we are, and I can only offer to help make things usable for 4.4 at best.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks, Mark.  I thought that might be the case, just wanted to nail it down.  Now I know what to tell users!&lt;/p&gt;</comment>
                            <comment id="13717161" author="steve_rowe" created="Tue, 23 Jul 2013 18:47:19 +0000"  >&lt;p&gt;Bulk move 4.4 issues to 4.5 and 5.0&lt;/p&gt;</comment>
                            <comment id="13937153" author="erickerickson" created="Sun, 16 Mar 2014 13:31:29 +0000"  >&lt;p&gt;This was fixed a long time ago by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4790&quot; title=&quot;When defining a core with the same name (discovery mode or not), CoreContainer should throw an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4790&quot;&gt;&lt;del&gt;SOLR-4790&lt;/del&gt;&lt;/a&gt;, closing it slipped through the cracks somehow.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12580905" name="SOLR-4773.patch" size="1784" author="erickerickson" created="Sun, 28 Apr 2013 21:11:40 +0000"/>
                            <attachment id="12580891" name="SOLR-4773.patch" size="3279" author="erickerickson" created="Sun, 28 Apr 2013 15:37:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325442</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1k5a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325787</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>