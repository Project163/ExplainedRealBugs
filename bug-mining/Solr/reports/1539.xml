<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:39:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5243] killing a shard in one collection can result in leader election in a different collection</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5243</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Discovered while doing some more ad-hoc testing... if I create two collections with the same shard name and then kill the leader in one, it can sometimes cause a leader election in the other (leaving the first leaderless).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12669068">SOLR-5243</key>
            <summary>killing a shard in one collection can result in leader election in a different collection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Sep 2013 18:42:17 +0000</created>
                <updated>Mon, 9 May 2016 18:43:24 +0000</updated>
                            <resolved>Wed, 18 Sep 2013 03:46:32 +0000</resolved>
                                                    <fixVersion>4.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13769807" author="yseeley@gmail.com" created="Tue, 17 Sep 2013 18:50:02 +0000"  >&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#Bring up 2 nodes....
cp -rp example example2
cd example
java -Dbootstrap_confdir=./solr/collection1/conf -Dcollection.configName=myConf -DzkRun -DnumShards=2 -jar start.jar

cd example2
java -Djetty.port=7574 -DzkHost=localhost:9983 -jar start.jar

#&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; both leaders aren&apos;t on port 8983, kill example2 and then bring it back up.

#look up the core name &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the c2/s1 leader and unload it
curl &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=c2_s1_replica2&quot;&lt;/span&gt;
&lt;/span&gt;
# now see two things:
# 1) c2/s1 is now leaderless
# 2) The leader of c3/s1 has switched to port 7574
# from the logs on port 7574 we can see that leader election was kicked off &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the wrong collection...

102432 [main-EventThread] INFO  org.apache.solr.cloud.ShardLeaderElectionContext  &#8211; Running the leader process &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; shard s1
102484 [main-EventThread] INFO  org.apache.solr.cloud.ShardLeaderElectionContext  &#8211; Checking &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; I should &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and be the leader.
102484 [main-EventThread] INFO  org.apache.solr.cloud.ShardLeaderElectionContext  &#8211; My last published State was Active, it&apos;s okay to be the leader.
102484 [main-EventThread] INFO  org.apache.solr.cloud.ShardLeaderElectionContext  &#8211; I may be the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; leader - &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and sync
102485 [main-EventThread] INFO  org.apache.solr.cloud.SyncStrategy  &#8211; Sync replicas to http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.1.104:7574/solr/c3_s1_replica2/
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13769842" author="yseeley@gmail.com" created="Tue, 17 Sep 2013 19:36:33 +0000"  >&lt;p&gt;It appears like the election process is OK... it&apos;s the unload that results in the wrong ephemeral node being removed.&lt;/p&gt;</comment>
                            <comment id="13769905" author="markrmiller@gmail.com" created="Tue, 17 Sep 2013 20:31:56 +0000"  >&lt;p&gt;It looks like Sami was storing the electionContexts by coreNodeName.&lt;/p&gt;</comment>
                            <comment id="13769913" author="markrmiller@gmail.com" created="Tue, 17 Sep 2013 20:36:27 +0000"  >&lt;p&gt;It would seem this only happens if you have the same core node name in different collections.&lt;/p&gt;</comment>
                            <comment id="13769927" author="markrmiller@gmail.com" created="Tue, 17 Sep 2013 20:44:08 +0000"  >&lt;p&gt;Hmm..not all test passing with that patch yet.&lt;/p&gt;</comment>
                            <comment id="13770024" author="markrmiller@gmail.com" created="Tue, 17 Sep 2013 21:46:47 +0000"  >&lt;p&gt;Another patch.&lt;/p&gt;

&lt;p&gt;Had to remove an assert in unregister, because it actually did not make sense on a fail core start - but this bug was hiding that.&lt;/p&gt;</comment>
                            <comment id="13770377" author="jira-bot" created="Wed, 18 Sep 2013 03:37:54 +0000"  >&lt;p&gt;Commit 1524286 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1524286&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5243&quot; title=&quot;killing a shard in one collection can result in leader election in a different collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5243&quot;&gt;&lt;del&gt;SOLR-5243&lt;/del&gt;&lt;/a&gt;: Killing a shard in one collection can result in leader election in a different collection if they share the same coreNodeName.&lt;/p&gt;</comment>
                            <comment id="13770378" author="jira-bot" created="Wed, 18 Sep 2013 03:40:33 +0000"  >&lt;p&gt;Commit 1524287 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1524287&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5243&quot; title=&quot;killing a shard in one collection can result in leader election in a different collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5243&quot;&gt;&lt;del&gt;SOLR-5243&lt;/del&gt;&lt;/a&gt;: Killing a shard in one collection can result in leader election in a different collection if they share the same coreNodeName.&lt;/p&gt;</comment>
                            <comment id="13770379" author="jira-bot" created="Wed, 18 Sep 2013 03:40:46 +0000"  >&lt;p&gt;Commit 1524288 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1524288&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5243&quot; title=&quot;killing a shard in one collection can result in leader election in a different collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5243&quot;&gt;&lt;del&gt;SOLR-5243&lt;/del&gt;&lt;/a&gt;: CHANGES entry.&lt;/p&gt;</comment>
                            <comment id="13770381" author="jira-bot" created="Wed, 18 Sep 2013 03:42:41 +0000"  >&lt;p&gt;Commit 1524289 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524289&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1524289&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5243&quot; title=&quot;killing a shard in one collection can result in leader election in a different collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5243&quot;&gt;&lt;del&gt;SOLR-5243&lt;/del&gt;&lt;/a&gt;: CHANGES entry.&lt;/p&gt;</comment>
                            <comment id="13770385" author="jira-bot" created="Wed, 18 Sep 2013 03:43:37 +0000"  >&lt;p&gt;Commit 1524290 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_5&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1524290&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5243&quot; title=&quot;killing a shard in one collection can result in leader election in a different collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5243&quot;&gt;&lt;del&gt;SOLR-5243&lt;/del&gt;&lt;/a&gt;: Killing a shard in one collection can result in leader election in a different collection if they share the same coreNodeName.&lt;/p&gt;</comment>
                            <comment id="13770386" author="jira-bot" created="Wed, 18 Sep 2013 03:45:11 +0000"  >&lt;p&gt;Commit 1524291 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_5&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1524291&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5243&quot; title=&quot;killing a shard in one collection can result in leader election in a different collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5243&quot;&gt;&lt;del&gt;SOLR-5243&lt;/del&gt;&lt;/a&gt;: CHANGES entry.&lt;/p&gt;</comment>
                            <comment id="13774752" author="shalinmangar" created="Mon, 23 Sep 2013 17:30:47 +0000"  >&lt;p&gt;I think this fix either caused a bug or uncovered a bug in shard splitting. ShardSplitTest has been failing sporadically since this was committed.&lt;/p&gt;

&lt;p&gt;Mark/Yonik, just off the top of your head, any idea why that would happen?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-4.x-MacOSX/828/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-4.x-MacOSX/828/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/7589/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/7589/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13775833" author="yseeley@gmail.com" created="Tue, 24 Sep 2013 00:07:08 +0000"  >&lt;p&gt;Do the shard split tests start up more than 3 cores per CoreContainer?  If not, there should be no impact.  If so, then the change in timing may have uncovered a different issue.&lt;/p&gt;</comment>
                            <comment id="13787109" author="jpountz" created="Sat, 5 Oct 2013 10:19:16 +0000"  >&lt;p&gt;4.5 release -&amp;gt; bulk close&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12669178">SOLR-5245</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12603685" name="SOLR-5243.patch" size="3020" author="markrmiller@gmail.com" created="Tue, 17 Sep 2013 21:46:47 +0000"/>
                            <attachment id="12603657" name="SOLR-5243.patch" size="2712" author="markrmiller@gmail.com" created="Tue, 17 Sep 2013 20:36:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349000</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1o6ev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349298</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>