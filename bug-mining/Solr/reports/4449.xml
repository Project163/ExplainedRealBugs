<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:43:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14058] IOOBE in PeerSync</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14058</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We hit an exception with 8.3 that someone else also hit on stackoverflow:&lt;br/&gt;
&lt;a href=&quot;https://stackoverflow.com/questions/58891563/problem-in-syncing-replicas-with-solr-8-3-with-zookeeper-3-5-6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/58891563/problem-in-syncing-replicas-with-solr-8-3-with-zookeeper-3-5-6&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I recently converted a solr 7.x + zookeeper 3.4.14 to solr 8.3 + zk 3.5.6, and depending on how I start the solr nodes I&apos;m geting a sync exception.&lt;/p&gt;

&lt;p&gt;My setup uses 3 zk nodes and 2 solr nodes (let&apos;s call it A and B). The collection that has this problem has 1 shard and 2 replicas. I&apos;ve noticed 2 situations: (1) which works fine and (2) which does not work.&lt;/p&gt;

&lt;p&gt;1) This works: I start solr node A, and wait until it&apos;s replica is elected leader (&quot;green&quot; in the Solr interface &apos;Cloud&apos;-&amp;gt;&apos;Graph&apos;) - which takes about 2 min; and only then start solr node B. Both replicas are active and the one in A is the leader.&lt;/p&gt;

&lt;p&gt;2) This does NOT work: I start solr node A, and a few secs after I star solr node B (that is, before the &apos;A&apos; replica is elected leader - still &quot;Down&quot; in the solr interface). In this case I get the following exception:&lt;/p&gt;

&lt;p&gt;ERROR (coreZkRegister-1-thread-2-processing-n:192.168.15.20:8986_solr x:alldata_shard1_replica_n1 c:alldata s:shard1 r:core_node3) &lt;span class=&quot;error&quot;&gt;&amp;#91;c:alldata s:shard1 r:core_node3 x:alldata_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.c.SyncStrategy Sync Failed:java.lang.IndexOutOfBoundsException: Index -1 out of bounds for length 99&lt;/p&gt;

&lt;p&gt;It seems that if both solr node are started soon after each other, then ZK cannot elect one as leader. This error only appears in the solr.log of node A, even if I invert the order of starting nodes.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="13273950">SOLR-14058</key>
            <summary>IOOBE in PeerSync</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                            <label>peerSync</label>
                            <label>recovery</label>
                    </labels>
                <created>Wed, 11 Dec 2019 19:39:11 +0000</created>
                <updated>Tue, 23 May 2023 09:07:06 +0000</updated>
                            <resolved>Tue, 11 Feb 2020 18:57:10 +0000</resolved>
                                    <version>6.2</version>
                    <version>8.3</version>
                    <version>9.0</version>
                                    <fixVersion>8.5</fixVersion>
                                        <due></due>
                            <votes>4</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16993852" author="yseeley@gmail.com" created="Wed, 11 Dec 2019 19:40:41 +0000"  >&lt;p&gt;Here&apos;s our stacktrace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-12-11 19:16:35.028 ERROR (zkCallback-10-thread-29) [c:cre_records_cre300000000B6j_0.1.4_0 s:shard2 r:core_node13 x:cre_records_cre300000000B6j_0.1.4_0_shard2_replica_n10] o.a.s.c.SyncStrategy Sync Failed:java.lang.IndexOutOfBoundsException: Index -1 out of bounds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; length 32
	at java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64)
	at java.base/jdk.internal.util.Preconditions.outOfBoundsCheckIndex(Preconditions.java:70)
	at java.base/jdk.internal.util.Preconditions.checkIndex(Preconditions.java:248)
	at java.base/java.util.Objects.checkIndex(Objects.java:372)
	at java.base/java.util.ArrayList.get(ArrayList.java:458)
	at org.apache.solr.update.PeerSync$MissedUpdatesFinderBase.handleVersionsWithRanges(PeerSync.java:750)
	at org.apache.solr.update.PeerSync$MissedUpdatesFinder.find(PeerSync.java:839)
	at org.apache.solr.update.PeerSync.handleVersions(PeerSync.java:439)
	at org.apache.solr.update.PeerSync.handleResponse(PeerSync.java:373)
	at org.apache.solr.update.PeerSync.sync(PeerSync.java:226)
	at org.apache.solr.cloud.SyncStrategy.syncWithReplicas(SyncStrategy.java:187)
	at org.apache.solr.cloud.SyncStrategy.syncReplicas(SyncStrategy.java:131)
	at org.apache.solr.cloud.SyncStrategy.sync(SyncStrategy.java:109)
	at org.apache.solr.cloud.ShardLeaderElectionContext.runLeaderProcess(ElectionContext.java:400)
	at org.apache.solr.cloud.LeaderElector.runIamLeaderProcess(LeaderElector.java:172)
	at org.apache.solr.cloud.LeaderElector.checkIfIamLeader(LeaderElector.java:137)
	at org.apache.solr.cloud.LeaderElector.access$200(LeaderElector.java:57)
	at org.apache.solr.cloud.LeaderElector$ElectionWatcher.process(LeaderElector.java:350)
	at org.apache.solr.common.cloud.SolrZkClient$ProcessWatchWithExecutor.lambda$process$1(SolrZkClient.java:845)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17030895" author="yseeley@gmail.com" created="Wed, 5 Feb 2020 18:16:42 +0000"  >&lt;p&gt;We don&apos;t have a test that tickles this bug, but after reviewing the code, the fix (attached) is relatively straightforward.  &lt;/p&gt;

&lt;p&gt;otherUpdatesIndex is initialized to be less than otherVersions.size(), and it is only ever decremented (and otherVersions is not modified), hence the correct check is otherUpdatesIndex &amp;gt;= 0.&lt;/p&gt;</comment>
                            <comment id="17034710" author="jira-bot" created="Tue, 11 Feb 2020 18:43:21 +0000"  >&lt;p&gt;Commit c3e44e1fecc7295ace6bbc12d320581a90c41839 in lucene-solr&apos;s branch refs/heads/master from Yonik Seeley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c3e44e1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c3e44e1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14058&quot; title=&quot;IOOBE in PeerSync&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14058&quot;&gt;&lt;del&gt;SOLR-14058&lt;/del&gt;&lt;/a&gt;: fix peersync bounds check iterating over versions&lt;/p&gt;</comment>
                            <comment id="17034711" author="jira-bot" created="Tue, 11 Feb 2020 18:44:12 +0000"  >&lt;p&gt;Commit c2125f331b0d35ea284242476780040675479f6f in lucene-solr&apos;s branch refs/heads/branch_8x from Yonik Seeley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c2125f3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c2125f3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14058&quot; title=&quot;IOOBE in PeerSync&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14058&quot;&gt;&lt;del&gt;SOLR-14058&lt;/del&gt;&lt;/a&gt;: fix peersync bounds check iterating over versions&lt;/p&gt;</comment>
                            <comment id="17034722" author="yseeley@gmail.com" created="Tue, 11 Feb 2020 18:55:18 +0000"  >&lt;p&gt;After some manual git bisecting, I think this bug entered the codebase via &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9207&quot; title=&quot;PeerSync recovery fails if number of updates requested is high&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9207&quot;&gt;&lt;del&gt;SOLR-9207&lt;/del&gt;&lt;/a&gt; in version 6.2&lt;/p&gt;</comment>
                            <comment id="17065712" author="romseygeek" created="Tue, 24 Mar 2020 12:46:27 +0000"  >&lt;p&gt;Bulk close for 8.5.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="12978195">SOLR-9207</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12992706" name="SOLR-14058.patch" size="767" author="yseeley@gmail.com" created="Wed, 5 Feb 2020 18:13:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09ku0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>