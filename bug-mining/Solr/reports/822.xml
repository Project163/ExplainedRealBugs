<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:26:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3204] solr-commons-csv must not use the org.apache.commons.csv package</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3204</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The solr-commons-csv artifact reused the code from the Apache Commons CSV project but the package wasn&apos;t changed to something else than org.apache.commons.csv in the process. This creates a compatibility issue as the Apache Commons team works toward an official release of Commons CSV. It prevents Commons CSV from using its own org.apache.commons.csv package, or forces the renaming of all the classes to avoid a classpath conflict.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12545266">SOLR-3204</key>
            <summary>solr-commons-csv must not use the org.apache.commons.csv package</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uschindler">Uwe Schindler</assignee>
                                    <reporter username="ebourg">Emmanuel Bourg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Mar 2012 01:29:14 +0000</created>
                <updated>Fri, 10 May 2013 10:40:43 +0000</updated>
                            <resolved>Wed, 7 Mar 2012 22:28:38 +0000</resolved>
                                    <version>3.5</version>
                                    <fixVersion>3.6</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>Build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13222911" author="ryantxu" created="Tue, 6 Mar 2012 02:05:42 +0000"  >&lt;p&gt;Solr is using a snapshot commons CSV build (commons-csv-1.0-SNAPSHOT-r966014) &amp;#8211; solr does not change anything and would prefer to use a release build.&lt;/p&gt;

&lt;p&gt;Has there been class refactorings that make replacing the .jar with the dev build impossible?  If so, perhaps we should just update the .jar file we are including.&lt;/p&gt;</comment>
                            <comment id="13222917" author="yseeley@gmail.com" created="Tue, 6 Mar 2012 02:09:13 +0000"  >&lt;p&gt;Background here: &lt;a href=&quot;http://markmail.org/message/lsxtxoetpw7a47uf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/lsxtxoetpw7a47uf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As far as I can determine, this is just a maven meta-data issue?&lt;br/&gt;
i.e. it doesn&apos;t seem like we should change java package names, but just make sure that the maven meta-data is completely distinct from any official commons-csv releases?  (disclaimer: I still really know nothing of maven, other than it&apos;s becoming more a pain all the time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13222930" author="ryantxu" created="Tue, 6 Mar 2012 02:24:08 +0000"  >&lt;p&gt;Emmanuel, can you confirm this is just a maven issue?&lt;/p&gt;

&lt;p&gt;Can it be solved with adding exclusions?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.solr&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;solr-core&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${solr.version}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;exclusions&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;exclusion&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.solr&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;solr-commons-csv&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/exclusion&amp;gt;&lt;/span&gt;
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Obviously the best approach is to work with an official release... but until that exists, what do you suggest?  (Actually forking the project and changing the package names seems pretty bad) &lt;/p&gt;</comment>
                            <comment id="13223080" author="ebourg" created="Tue, 6 Mar 2012 08:09:38 +0000"  >&lt;p&gt;Hi all and thank you for your quick reply. This is not a &quot;simple&quot; Maven metadata issue. Even if you consider solr-commons-csv to be an internal part of Solr it&apos;s now a public Maven artifact that people are starting to use in their projects (The Apache Commons teams even starts receiving bug reports for solr-commons-csv). When Commons CSV is officially released there will be a conflict if solr-commons-csv and commons-csv are both brought to the classpath through the transitive dependencies of a project, because they have the same classes in the same package.&lt;/p&gt;

&lt;p&gt;Imagine a project using Solr and doing CSV stuff with Commons CSV, when the CSVParser classes is instantiated it can be either the one from solr-commons-csv or the one from Commons CSV, this is guaranteed to break badly.&lt;/p&gt;

&lt;p&gt;The right approach is to change the package of solr-commons-csv, for example to org.apache.solr.commons.csv, so both solr-commons-csv and Commons CSV can coexist on the classpath without conflict. This can be automated with the Maven Shade plugin.&lt;/p&gt;
</comment>
                            <comment id="13223193" author="rcmuir" created="Tue, 6 Mar 2012 12:35:39 +0000"  >&lt;p&gt;This is a maven issue. solr-commons-csv only exists to maven.&lt;/p&gt;

&lt;p&gt;Otherwise these are just classes inside the war file (essentially an implementation detail of solr).&lt;br/&gt;
It seems to me, no offense, that the solution is to make an official release of commons-csv!&lt;/p&gt;

&lt;p&gt;Then nothing needs to coexist, as we would rather use a release instead anywaay, and all &lt;br/&gt;
grandfather poms,wagons, nexuses,surefires,whatever in maven will be adjusted and everyone is happy.&lt;/p&gt;</comment>
                            <comment id="13223198" author="ebourg" created="Tue, 6 Mar 2012 12:52:04 +0000"  >&lt;p&gt;I agree a release of Commons CSV is desirable, but that&apos;s not a reason for using the namespace of other projects. The artifact is free to use by anyone from the Maven repository, it&apos;s no longer an implementation detail of Solr, people are starting to use it in the wild, and this will lead to classpath conflicts.&lt;/p&gt;

&lt;p&gt;Repackaging a Commons component and renaming its package isn&apos;t uncommon, Tomcat does this for DBCP:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.jarvana.com/jarvana/inspect/org/apache/tomcat/tomcat-dbcp/7.0.23/tomcat-dbcp-7.0.23.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.jarvana.com/jarvana/inspect/org/apache/tomcat/tomcat-dbcp/7.0.23/tomcat-dbcp-7.0.23.jar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tomcat is released with a tomcat-dbcp artifact containing the DBCP classes but under the org.apache.tomcat.dbcp package. Solr should adopt the same approach until Commons CSV is officially released.&lt;/p&gt;</comment>
                            <comment id="13223228" author="rcmuir" created="Tue, 6 Mar 2012 13:11:42 +0000"  >&lt;p&gt;seriously, this is no blocker. &lt;/p&gt;

&lt;p&gt;I don&apos;t appreciate you reverting my change there.&lt;/p&gt;

&lt;p&gt;now this becomes resolved as won&apos;t fix.&lt;/p&gt;</comment>
                            <comment id="13223242" author="ebourg" created="Tue, 6 Mar 2012 13:25:50 +0000"  >&lt;p&gt;Robert, should I appreciate that you are negating the issue? This is considered a blocker because Solr must not make new releases until this is resolved. This is a serious issue, don&apos;t take it lightly please.&lt;/p&gt;</comment>
                            <comment id="13223255" author="thetaphi" created="Tue, 6 Mar 2012 13:32:47 +0000"  >&lt;p&gt;It is not an issue, as Solr is built with Apache Ant, Apache Maven is not fully supported and only &quot;for convenience&quot;. If it works, it works, if not its of minor priority. It definitely does not block a release.&lt;/p&gt;</comment>
                            <comment id="13223265" author="rcmuir" created="Tue, 6 Mar 2012 14:10:02 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This is considered a blocker because Solr must not make new releases until this is resolved. This is a serious issue, don&apos;t take it lightly please.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Really? who will stop us? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Seriously, all solr does is put commons-csv-1.0-SNAPSHOT-r966014.jar in solr/lib (along with LICENSE/NOTICE information).&lt;/p&gt;

&lt;p&gt;We don&apos;t use any commons-csv-1.0-RELEASE.jar because one doesnt exist.&lt;/p&gt;</comment>
                            <comment id="13223277" author="tcurdt" created="Tue, 6 Mar 2012 14:29:47 +0000"  >&lt;p&gt;Folks, how can you not see that this is an issue?&lt;/p&gt;

&lt;p&gt;This is not a maven problem. You are releasing code in the Commons namespace that eventually will clash. I am sure everyone is on board to get this resolved by releasing commons-csv ...but if you do a release beforehand - please be a good ASF citizen and use some kind of shading technique (e.g. using jarjar).&lt;/p&gt;

&lt;p&gt;Just closing this issue as &quot;Won&apos;t Fix&quot; is not helping.&lt;/p&gt;</comment>
                            <comment id="13223278" author="ebourg" created="Tue, 6 Mar 2012 14:33:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;Really? who will stop us?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Your morality, kindness and innate sense of teamwork among Apache developers ? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;You may have not noticed that solr-commons-csv is in the central Maven repository, it&apos;s not just secretly included in the solr/lib directory:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://search.maven.org/#artifactdetails|org.apache.solr|solr-commons-csv|3.5.0|jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;That means two things:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;People are using this artifact in their Maven projects, independently of Solr&lt;/li&gt;
	&lt;li&gt;Anyone importing the solr-core artifact in its project will be unable to use Commons CSV when it&apos;s released&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13223281" author="rcmuir" created="Tue, 6 Mar 2012 14:36:05 +0000"  >&lt;blockquote&gt;
&lt;p&gt;You are releasing code in the Commons namespace that eventually will clash&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We aren&apos;t releasing any code.&lt;/p&gt;

&lt;p&gt;We have a library in solr/lib. we are &lt;b&gt;depending&lt;/b&gt; upon this library. we don&apos;t release it.&lt;/p&gt;

&lt;p&gt;This issue is only about maven, which is just supplied as convenience, as Uwe mentions.&lt;/p&gt;</comment>
                            <comment id="13223285" author="ebourg" created="Tue, 6 Mar 2012 14:40:46 +0000"  >&lt;p&gt;Here is a patch importing the Commons CSV revision 966014 in the org.apache.solr.csv package to avoid classpath conflicts&lt;/p&gt;</comment>
                            <comment id="13223290" author="rcmuir" created="Tue, 6 Mar 2012 14:44:03 +0000"  >&lt;p&gt;-1&lt;/p&gt;

&lt;p&gt;I don&apos;t think we should code-dup entire packages just because of the viral nature of maven &lt;br/&gt;
(to make a maven release of X, all of its dependencies must also be in maven, too).&lt;/p&gt;

&lt;p&gt;That seems like the root problem here. Perhaps a blocker issue should be opened in maven&apos;s JIRA instead.&lt;/p&gt;</comment>
                            <comment id="13223297" author="thetaphi" created="Tue, 6 Mar 2012 14:54:37 +0000"  >&lt;p&gt;Just to add: Should we also clone/fork the whole Mortbay Jetty repository or Apache Xerces into Solr&apos;s tree? For both libraries we also have bugfixes but upstream did not release an update until now?&lt;/p&gt;

&lt;p&gt;What will user X do, if the probject he is using depends on an older CSV version but Solr needs a new one, although in Maven Central? Yes, he has a conflict. The situation is not different here.&lt;/p&gt;</comment>
                            <comment id="13223306" author="thetaphi" created="Tue, 6 Mar 2012 15:04:30 +0000"  >&lt;p&gt;One idea how to solve the issue: Maybe commons-csv should publish their nightly builds through jenkins to maven? Then Solr could add the snapshot build as a dependency and we are done?&lt;/p&gt;

&lt;p&gt;Uwe&lt;/p&gt;</comment>
                            <comment id="13223319" author="ralph.goers@dslextreme.com" created="Tue, 6 Mar 2012 15:17:30 +0000"  >&lt;p&gt;Robert, if you are not releasing code then how did the artifact find its way into the Maven Central repository? The maintainers of the repository will ONLY accept artifacts when they come from the appropriate place - in this case that would need to be Apache&apos;s repository. I can&apos;t imagine how anyone other than Solr&apos;s team could have caused that to happen.&lt;/p&gt;

&lt;p&gt;As for snapshots, that doesn&apos;t really solve the problem as you can&apos;t release with a dependency on a snapshot.&lt;/p&gt;

&lt;p&gt;If the intent was just to use the jar internally in a war file that your customers don&apos;t change then somewhere in your build you have a mistake as the jar is apparently being made available to the public. If, however, the dependency is required for users or Solr to do builds then you need to change the package names so that they don&apos;t conflict with those in Commons.&lt;/p&gt;</comment>
                            <comment id="13223326" author="rcmuir" created="Tue, 6 Mar 2012 15:28:46 +0000"  >&lt;p&gt;Ralph: see Uwe&apos;s comment.&lt;/p&gt;

&lt;p&gt;Its frequently the case that lucene/solr depend on things that are not in maven. When this is the case, the guys who work on maven here&lt;br/&gt;
do whatever is necessary to make maven work (I really don&apos;t know the details, most of us just use ant).&lt;/p&gt;

&lt;p&gt;This is purely a maven issue, and as mentioned earlier, maven is provided as a convenience for build configuration, no different from&lt;br/&gt;
convenience build configurations provided for Eclipse or Intellij IDEA.&lt;/p&gt;

&lt;p&gt;Thats why I said: we aren&apos;t releasing anything. there is just commons-csv-1.0-SNAPSHOT-r966014.jar in our solr/lib. Our ant build system&lt;br/&gt;
packages this up into solr.war&lt;/p&gt;

&lt;p&gt;As for maven, eclipse, intellij, netbeans, whatever, it doesnt really matter to me how they work, but supporting those alternative&lt;br/&gt;
build configurations != releasing code.&lt;/p&gt;</comment>
                            <comment id="13223328" author="ebourg" created="Tue, 6 Mar 2012 15:31:30 +0000"  >&lt;blockquote&gt;
&lt;p&gt;One idea how to solve the issue: Maybe commons-csv should publish their nightly builds through jenkins to maven? Then Solr could add the snapshot build as a dependency and we are done?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Commons CSV snapshots are available in the Apache snapshot repository, but when you release Solr in the central repository all its dependencies have to be there as well, so that won&apos;t work.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;What will user X do, if the project he is using depends on an older CSV version but Solr needs a new one, although in Maven Central? Yes, he has a conflict. The situation is not different here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Once Commons CSV is released we guarantee the binary compatibility of the next releases. The Apache Commons team takes compatibility issues very seriously because our components are reused in many projects. When we have to break the compatibility the code is moved to a new package to avoid conflicts. For example Commons Lang 3 broke the binary compatibility with the previous releases and used a new namespace org.apache.commons.lang3 to avoid issues.&lt;/p&gt;

&lt;p&gt;If Solr wants to shield its user from incompatibilities, even after Commons CSV is officially released, it&apos;s possible to automate the process of renaming the package of the dependencies. That&apos;s what Tomcat does with Commons DBCP. Tools like the Maven Shade plugin or the JarJar Ant tasks are designed for this purpose.&lt;/p&gt;</comment>
                            <comment id="13223329" author="thetaphi" created="Tue, 6 Mar 2012 15:31:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Robert, if you are not releasing code then how did the artifact find its way into the Maven Central repository? The maintainers of the repository will ONLY accept artifacts when they come from the appropriate place - in this case that would need to be Apache&apos;s repository. I can&apos;t imagine how anyone other than Solr&apos;s team could have caused that to happen.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We are releasing Maven Artifacts of Solr just for convenience using a special ANT script (which is unsupported by our committers). The community wants it, so we do it. Maybe that script also published one of the snapshot artifacts (is there also a Jetty prerelease artifact?); but that was not our intention. We should simply remove it.&lt;/p&gt;</comment>
                            <comment id="13223334" author="tcurdt" created="Tue, 6 Mar 2012 15:37:38 +0000"  >&lt;p&gt;You guys don&apos;t like maven - we get that (who really does?) ...but that&apos;s not the point. For now let&apos;s just assume your bugfix jars did not get released to maven central. (That&apos;s another issue to deal with)&lt;/p&gt;

&lt;p&gt;What about Solr users that now have some unreleases Xerces, Jetty und Commons classes in their classpath? Maybe even without knowing? If you don&apos;t hate your users - don&apos;t do it.&lt;/p&gt;

&lt;p&gt;Maintaining upstreaming patches is painful - but that&apos;s how it is. Push for a release, maintain a patch or (only worst case) fork.&lt;/p&gt;

&lt;p&gt;But there is an option somewhere in the middle is using using tools like minijar/the shade plugin/jarjar. They let you do the rewriting of the package transparently on the byte code level. That makes getting back to the releases version easier. Or you do it like Tomcat - they so some search and replace in their build.&lt;/p&gt;

&lt;p&gt;I your specific case I would keep the bugfix jars in your lib dir (just like you have now) but modify your build to include a relocated&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; version of your bugfix jars into the Solr jar (by using jarjar). Problem solved!&lt;/p&gt;

&lt;p&gt;No one needs those bugfix version in a repo and it&apos;s super easy to fall back to the official release once out. &lt;/p&gt;

&lt;p&gt;There are ways around big code duplications and still avoid the namespace problem.&lt;br/&gt;
Come on guys - be good to the world &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13223335" author="sebb@apache.org" created="Tue, 6 Mar 2012 15:38:02 +0000"  >&lt;p&gt;This is a classpath issue - a class can be loaded only once in a given classpath.&lt;br/&gt;
It&apos;s vitally important to ensure that each class has only a single definition in a classpath, otherwise all sorts of failures can occur. These failures can be extremely difficult to debug.&lt;/p&gt;

&lt;p&gt;Maven uses the groupId/artifactId to resolve multiple references to the same jar.&lt;br/&gt;
It picks one copy of the most recent version. &lt;/p&gt;

&lt;p&gt;This only works properly if the Maven ids are unique for each package.&lt;br/&gt;
It does not read the package names within the jar; it assumes that the POM is correct for the associated jar.&lt;/p&gt;

&lt;p&gt;In this case, the Solr pom uses its own unique groupId/artifactId, but the package names used within the jar (and indeed the pom inside the jar) are for an entirely different package. This is totally contrary to the way Maven is supposed to be used.&lt;/p&gt;

&lt;p&gt;The consequence is that Maven does not know that the renamed &quot;solr&quot; commons-csv jar uses the same package as the &quot;real&quot; commons-csv, so it cannot prevent duplicate classes on the classpath.&lt;/p&gt;</comment>
                            <comment id="13223339" author="steve_rowe" created="Tue, 6 Mar 2012 15:44:43 +0000"  >&lt;p&gt;I think we should fix this.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;We are releasing Maven Artifacts of Solr just for convenience using a special ANT script (which is unsupported by our committers). The community wants it, so we do it. Maybe that script also published one of the snapshot artifacts (is there also a Jetty prerelease artifact?); but that was not our intention. We should simply remove it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Because of Solr&apos;s dependency on a snapshot of commons-csv, and because Maven releases are not allowed to depend on snapshots, we &lt;b&gt;have&lt;/b&gt; to publish the snapshot, renamed not to appear to be a snapshot.  Simply removing it is not an option, assuming we will continue to provide Maven artifacts as part of the Lucene/Solr release process.&lt;/p&gt;</comment>
                            <comment id="13223340" author="rcmuir" created="Tue, 6 Mar 2012 15:44:58 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Maintaining upstreaming patches is painful - but that&apos;s how it is.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If there is a bug in some 3rd party component: i care about fixing the bug.&lt;/p&gt;

&lt;p&gt;I don&apos;t care about maven, I&apos;m not going to do the extra work to deal with these viral issues and its not a blocker for releasing 3.6&lt;/p&gt;</comment>
                            <comment id="13223341" author="ebourg" created="Tue, 6 Mar 2012 15:45:02 +0000"  >&lt;p&gt;There is a similar issue with the solr-carrot2-core, solr-noggit, solr-uima and solr-jsonic artifacts, and probably more.&lt;/p&gt;

&lt;p&gt;You were right to -1 my patch Robert, the issue is much deeper.&lt;/p&gt;</comment>
                            <comment id="13223344" author="thetaphi" created="Tue, 6 Mar 2012 15:51:11 +0000"  >&lt;p&gt;I think the jarjar idea was raised quite often, this seems to be a good solution, so we republish all &quot;changed&quot; dependencies using a different class/pkg name. We should create jarjared versions of all those changed snapshot dpenendecies, so the use o.a.solr.internal.&lt;b&gt;/o.a.lucene.internal.&lt;/b&gt; as package name (like Java does for Xerces/Xalan/Rhino).&lt;/p&gt;

&lt;p&gt;Those jars would be published by maven as it is now, but would never conflict.&lt;/p&gt;</comment>
                            <comment id="13223352" author="tcurdt" created="Tue, 6 Mar 2012 15:59:47 +0000"  >&lt;p&gt;Steve, no you don&apos;t have to publish those snapshots. Please read my previous comment about inlining the bugfix jars.&lt;/p&gt;

&lt;p&gt;Please folks, look at &lt;a href=&quot;http://code.google.com/p/jarjar/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.google.com/p/jarjar/&lt;/a&gt;&lt;br/&gt;
It&apos;s an easy fix and you would make many people happy.&lt;/p&gt;</comment>
                            <comment id="13223354" author="rcmuir" created="Tue, 6 Mar 2012 16:00:37 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I think the jarjar idea was raised quite often, this seems to be a good solution, so we republish all &quot;changed&quot; dependencies using a different class/pkg name.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This sets an unreasonable burden to fix a simple bug in a third-party component (think, the jetty patch).&lt;/p&gt;

&lt;p&gt;Its already hard enough to dive in as &quot;stranger in a strange land&quot; to some other codebase to fix a bug that affects our stuff,&lt;br/&gt;
and then to rename anything that uses it too just because of maven?&lt;/p&gt;

&lt;p&gt;Lets take the jetty case... should we seriously rename all the jetty stuff because it has a unicode bug? what about configuration &lt;br/&gt;
and reflection and stuff for this servlet container? E.g. users will no longer be able to use any normal jetty configuration or&lt;br/&gt;
jetty documentation because we re-jarjared all the package names?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;Configure id=&quot;Server&quot; class=&quot;org.eclipse.jetty.server.Server&quot;&amp;gt;
  &amp;lt;!-- basic configuration here --&amp;gt;
&amp;lt;/Configure&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;etc&lt;/p&gt;

&lt;p&gt;this is insane.&lt;/p&gt;</comment>
                            <comment id="13223356" author="tcurdt" created="Tue, 6 Mar 2012 16:04:07 +0000"  >&lt;p&gt;Uwe, no need to even publish those bugfix jars. I would just inline them into the Solr artifact. (Think ueberjar) Then you don&apos;t even have to change a line of java source code nor the bugfix jars. Just the build.&lt;/p&gt;</comment>
                            <comment id="13223365" author="tcurdt" created="Tue, 6 Mar 2012 16:11:31 +0000"  >&lt;p&gt;Well, I do see the problem with jetty but doubt the other dependencies are that problematic.&lt;/p&gt;</comment>
                            <comment id="13223370" author="rcmuir" created="Tue, 6 Mar 2012 16:16:58 +0000"  >&lt;blockquote&gt;&lt;/blockquote&gt;
&lt;p&gt;Well, I do see the problem with jetty but doubt the other dependencies are that problematic.&lt;br/&gt;
{quote&lt;/p&gt;

&lt;p&gt;Jarjaring is dangerous also because of reflection in from other libraries.&lt;/p&gt;

&lt;p&gt;For example, if we find a bug in ICU, submit it, and they commit it, we should be able to&lt;br/&gt;
depend upon a snapshot unreleased build of ICU, yet, at the same-time, arabic PDF extraction&lt;br/&gt;
should still work (apache PDFBox reflects the icu package names to determine if this works).&lt;/p&gt;

&lt;p&gt;So renaming packages with jarjar is not safe for a number of reasons, I really don&apos;t think&lt;br/&gt;
we should do this just to satisfy maven.&lt;/p&gt;</comment>
                            <comment id="13223389" author="thetaphi" created="Tue, 6 Mar 2012 16:37:05 +0000"  >&lt;p&gt;Robert: Its not only a maven problem, its the DLL &#228;hm JAR-hell &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; So I agree with all others that having patched JARs is a no-go for production, because nobody is able to then satisfy all dependencies.&lt;/p&gt;

&lt;p&gt;On the other hand, Solr is a end-user product, so I have no idea why it is in maven at all. You download the distribution and install it. If you need to compile plugins against it, setup your eclipse classpath. Lucene is different, but it has no patched JARs (it does not depend on any external JAR at all). The Xerces JAR in benchmark is also only a &quot;utility&quot; package, that should not be in maven.&lt;/p&gt;

&lt;p&gt;To come back to the example:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jetty should not be a problem, because Solr will upgrade to Jetty 8 (breaking lots of backwards). For the Jetty 6 series there is no support at all, so there will not be a new release. Our fixed Jetty 6 is just a plain jetty with one broken unicode method patched. If somebody accidently have it in his classpath, he will be happy that Chinese, Japanese, and Mormon UTF8 works correct...&lt;/li&gt;
	&lt;li&gt;For the other JARs that have no other relations except to Solr, JARJARing them is no issue at all. It would be what I would recommend. This affects commons JARs like commons-csv, also noggit,&lt;/li&gt;
	&lt;li&gt;The ICU example is just a minor &quot;example&quot;, we will not need to patch ICU, because they are releasing quite often.&lt;/li&gt;
	&lt;li&gt;If you have reflection dependecies or dependencies from other JARs in you classpath, you can still install the original unpatched version and you are happy. They will not conflict.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13223399" author="ryantxu" created="Tue, 6 Mar 2012 16:42:18 +0000"  >&lt;p&gt;How close is commons-csv to a release?  &lt;/p&gt;</comment>
                            <comment id="13223416" author="ebourg" created="Tue, 6 Mar 2012 16:54:45 +0000"  >&lt;p&gt;Not close enough to satisfy Solr&apos;s pace of releases I think. Any help would be appreciated, the API has been reworked recently to take advantage of Java 5 features. A feedback on how it integrates with Solr would be welcome.&lt;/p&gt;</comment>
                            <comment id="13223435" author="steve_rowe" created="Tue, 6 Mar 2012 17:11:42 +0000"  >&lt;p&gt;I propose we jarjar only the currently used commons-csv snapshot, and leave all other jars as-is.  (Uwe, you mentioned noggit, but it has never been released on its own, so I don&apos;t think it&apos;s necessary to jarjar it.)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;A feedback on how it integrates with Solr would be welcome.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The 3.6 release is going to happen soon; it seems unwise to upgrade on branch_3x at this point.&lt;/p&gt;

&lt;p&gt;On trunk, however, upgrading the commons-csv snapshot to a more recent revision is a good idea, to prepare for the (eventual) release.&lt;/p&gt;</comment>
                            <comment id="13223437" author="ryantxu" created="Tue, 6 Mar 2012 17:13:54 +0000"  >&lt;p&gt;Since we don&apos;t &lt;b&gt;really&lt;/b&gt; deploy with maven, can we just point the maven artifact to the snapshot build?&lt;/p&gt;</comment>
                            <comment id="13223440" author="steve_rowe" created="Tue, 6 Mar 2012 17:17:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;Uwe, no need to even publish those bugfix jars. I would just inline them into the Solr artifact. (Think ueberjar) Then you don&apos;t even have to change a line of java source code nor the bugfix jars. Just the build.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Torsten, in case you&apos;re wondering why nobody is answering you: Lucene/Solr publishes Maven artifacts that are identical to the released Ant-built binary jars, so your proposal would require increasing the size of our released jars, solely to solve a Maven dependency problem.  Changing the Ant build simply to solve Maven problems has historically been a non-starter.&lt;/p&gt;</comment>
                            <comment id="13223443" author="ebourg" created="Tue, 6 Mar 2012 17:22:21 +0000"  >&lt;p&gt;This is not possible Ryan. But you might reference org.apache.solr:solr-commons-csv:3.5.0 in Solr 3.6 and stop publishing new artifacts to Maven central besides the solr/lucene specific ones. This will stop the proliferation of conflicting artifacts in the Maven repository, but it won&apos;t fix the classpath issue for projects using Solr and Commons CSV.&lt;/p&gt;</comment>
                            <comment id="13223445" author="steve_rowe" created="Tue, 6 Mar 2012 17:26:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;Since we don&apos;t really deploy with maven, can we just point the maven artifact to the snapshot build?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t know the answer, but I object to going down this road.  There is a reason for not depending on snapshots: they change, often incompatibly.  Having internal snapshots isn&apos;t just a sneaky workaround - it fixes the underlying problem (potentially incompatible changes), while also, of course, creating a different problem...&lt;/p&gt;

&lt;p&gt;We have an example in the specific case of commons-csv: as Emmanuel said, the API has changed (very likely incompatibly) since our internal snapshot was taken.&lt;/p&gt;
</comment>
                            <comment id="13223448" author="steve_rowe" created="Tue, 6 Mar 2012 17:32:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;But you might reference org.apache.solr:solr-commons-csv:3.5.0 in Solr 3.6&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is a good idea, and would require very little effort.  I&apos;ll make a patch.&lt;/p&gt;</comment>
                            <comment id="13223453" author="ebourg" created="Tue, 6 Mar 2012 17:34:57 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Torsten, in case you&apos;re wondering why nobody is answering you: Lucene/Solr publishes Maven artifacts that are identical to the released Ant-built binary jars, so your proposal would require increasing the size of our released jars, solely to solve a Maven dependency problem. Changing the Ant build simply to solve Maven problems has historically been a non-starter.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Steven, this will not increase the global size of the distribution, it might even reduce it. You are trading a core Solr jar with a few modified dependent jars, all downloaded from the central Maven repository, for a unique jar containing Solr and it dependencies, and possibly only the necessary classes. For example Solr doesn&apos;t use the writer package of Commons CSV, it can be automatically removed in the process to reduce the size of the dependencies.&lt;/p&gt;

&lt;p&gt;Still not interested? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13223458" author="steve_rowe" created="Tue, 6 Mar 2012 17:41:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;Still not interested?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think you missed my point?: Changing the Ant build to fix a Maven problem is a non-starter.&lt;/p&gt;</comment>
                            <comment id="13223463" author="ryantxu" created="Tue, 6 Mar 2012 17:46:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;But you might reference org.apache.solr:solr-commons-csv:3.5.0 in Solr 3.6&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13223486" author="ebourg" created="Tue, 6 Mar 2012 18:07:21 +0000"  >&lt;p&gt;Steven, you created this Maven problem by releasing conflicting artifacts to the central repository. Refusing to fix it is irresponsible.&lt;/p&gt;</comment>
                            <comment id="13223502" author="steve_rowe" created="Tue, 6 Mar 2012 18:18:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;Steven, you created this Maven problem by releasing conflicting artifacts to the central repository.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In fact, I &lt;b&gt;am&lt;/b&gt; personally responsible for putting the conflicting artifacts in the central repository.  It is also largely as a result of my efforts that Lucene/Solr continues to publish Maven artifacts at all.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Refusing to fix it is irresponsible.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Only if one assumes that refusing to implement your proposed fix is equivalent to refusing to do anything?  I suspect we disagree on this point.&lt;/p&gt;

</comment>
                            <comment id="13223527" author="ryantxu" created="Tue, 6 Mar 2012 18:40:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Steven, you created this Maven problem&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Lets keep our heads cool here.  To be clear, &lt;b&gt;Steven&lt;/b&gt; wants to help and is doing what he can.  We need to figure a way to help within the limits of the lucene community.  Previous discussion in this thread should give you a sense of the animosity towards maven &amp;#8211; the question is how to move forward within these limits.&lt;/p&gt;

&lt;p&gt;The obvious best solution is to point to an official commons-csv release.&lt;/p&gt;

&lt;p&gt;Short of that, we need to make sure we don&apos;t make the problem worse;  We can do that by releasing 3.6 pointing to the 3.5 solr-commons-csv package.  &lt;/p&gt;









</comment>
                            <comment id="13223556" author="rcmuir" created="Tue, 6 Mar 2012 19:08:29 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Previous discussion in this thread should give you a sense of the animosity towards maven &#8211; the question is how to move forward within these limits.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Its not unjustified animosity towards maven: this issue is &lt;b&gt;solely&lt;/b&gt; maven &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13223577" author="ebourg" created="Tue, 6 Mar 2012 19:27:16 +0000"  >&lt;p&gt;Steven I wasn&apos;t referring to you explicitly, but to the Solr community. I didn&apos;t know you actually deployed the artifacts. If you dislike Maven you&apos;ll be pleased to learn that it was a great blow to the Maven integrity &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m glad to hear you are willing to do something, what&apos;s your plan? Let me recap the options currently identified:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Embed the Commons CSV source files in the core of Solr. That was the purpose of my patch, but it doesn&apos;t solve the issue for the other dependencies (carrot, noggit, uima, jsonic, etc)&lt;/li&gt;
	&lt;li&gt;Embed the pacthed dependencies in the main Solr jar and rename the packages with jarjar or a similar tool. The additional benefit it a reduction of the global distribution size by keeping only the classes actually used by Solr.&lt;/li&gt;
	&lt;li&gt;Keep publishing Solr specific dependencies but after renaming the packages with JarJar&lt;/li&gt;
	&lt;li&gt;Import the source of the dependencies and rename the package with the Ant replace task (Tomcat solution)&lt;/li&gt;
	&lt;li&gt;Stop releasing Maven artifacts completely, even Solr core.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Pointing to the 3.5 artifacts is a temporary solution, because:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the classpath conflicts still exists for projects importing solr-core&lt;/li&gt;
	&lt;li&gt;the next time Solr needs a patched unreleased dependency it will be problematic&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13223622" author="mikemccand" created="Tue, 6 Mar 2012 20:23:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;To be clear, Steven wants to help and is doing what he can.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would make this statement far stronger:&lt;/p&gt;

&lt;p&gt;Without all of Steven&apos;s hard work struggling with Maven, while working&lt;br/&gt;
within the constraints of the other Lucene/Solr committers (who&lt;br/&gt;
generally, strongly, dislike the impositions Maven places on a&lt;br/&gt;
project&apos;s development, case in point), there would be no Maven&lt;br/&gt;
artifacts for Lucene nor Solr.&lt;/p&gt;

&lt;p&gt;Seriously, Steven is the ONLY reason why Lucene and Solr have, and&lt;br/&gt;
continue to have, Maven artifacts.&lt;/p&gt;

&lt;p&gt;Thank you Steven!!&lt;/p&gt;</comment>
                            <comment id="13223735" author="steve_rowe" created="Tue, 6 Mar 2012 22:19:04 +0000"  >&lt;p&gt;Patch switching solr-commons-csv Maven dependency to v3.5.0.&lt;/p&gt;

&lt;p&gt;I will commit in a couple of hours if there are no objections.&lt;/p&gt;</comment>
                            <comment id="13223770" author="steve_rowe" created="Tue, 6 Mar 2012 23:06:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;Pointing to the 3.5 artifacts is a temporary solution&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree.  I also agree with Ryan: &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;W&amp;#93;&lt;/span&gt;e need to make sure we don&apos;t make the problem worse; We can do that by releasing 3.6 pointing to the 3.5 solr-commons-csv package.&quot;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you dislike Maven you&apos;ll be pleased to learn that it was a great blow to the Maven integrity &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I actually like Maven for some things.&lt;/p&gt;

&lt;p&gt;&quot;Great blow&quot;?  I sincerely doubt that this is the first time something like this has happened.  &lt;/p&gt;

&lt;p&gt;&quot;Maven integrity&quot;?  Oxymoronic much?&lt;/p&gt;
</comment>
                            <comment id="13223829" author="steve_rowe" created="Tue, 6 Mar 2012 23:46:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m glad to hear you are willing to do something, what&apos;s your plan?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t have one yet.  What&apos;s your plan for releasing commons-csv?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Let me recap the options currently identified:&lt;/p&gt;

&lt;p&gt;1. Embed the Commons CSV source files in the core of Solr. That was the purpose of my patch, but it doesn&apos;t solve the issue for the other dependencies (carrot, noggit, uima, jsonic, etc)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;-1. I think this is too intrusive.  Maven&apos;s requirement cannot dictate Lucene/Solr Ant build structure.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2. Embed the pacthed dependencies in the main Solr jar and rename the packages with jarjar or a similar tool. The additional benefit it a reduction of the global distribution size by keeping only the classes actually used by Solr.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;-1.  Again, too intrusive.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;3. Keep publishing Solr specific dependencies but after renaming the packages with JarJar&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is a possibility.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;4. Import the source of the dependencies and rename the package with the Ant replace task (Tomcat solution)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;-0.  The project would require a new module for each dependency.  Seems too heavy to me.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;5. Stop releasing Maven artifacts completely, even Solr core.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Fantastic! Thanks for your input! You&apos;re, like, awesome!&lt;/p&gt;</comment>
                            <comment id="13223842" author="steve_rowe" created="Wed, 7 Mar 2012 00:06:32 +0000"  >&lt;p&gt;Emmanuel, you neglected to include transitive exclusion in your &quot;identified options&quot;:&lt;/p&gt;

&lt;p&gt;6. Ryan suggested excluding solr-commons-csv from solr-core&apos;s transitive dependencies: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3204?focusedCommentId=13222930&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13222930&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-3204?focusedCommentId=13222930&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13222930&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This puts the burden on users, who won&apos;t know it&apos;s necessary until after they run into classpath trouble.  We should figure out something better.&lt;/p&gt;</comment>
                            <comment id="13223865" author="rcmuir" created="Wed, 7 Mar 2012 00:37:45 +0000"  >&lt;blockquote&gt;
&lt;p&gt;We should figure out something better.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not knowing anything about maven, but just comparing this to the releases that solr users download, the main&lt;br/&gt;
difference seems to be that in general the &apos;artifact&apos; for an ordinary user is a .war file, a server-side &lt;br/&gt;
webapp that a user places into their servlet container... maybe the maven artifact should be consistent with that?&lt;/p&gt;

&lt;p&gt;Wouldn&apos;t this avoid exposing any internal implementation details of whats actually inside that .war file,&lt;br/&gt;
such as any external dependencies?&lt;/p&gt;</comment>
                            <comment id="13223868" author="ebourg" created="Wed, 7 Mar 2012 00:40:26 +0000"  >&lt;p&gt;@Steven Yes that&apos;s a possible workaround for Solr users, as long as they don&apos;t touch directly or indirectly the CSV related classes. But that solution doesn&apos;t spare a necessary modification of the Solr build with regard to patched dependencies.&lt;/p&gt;</comment>
                            <comment id="13223872" author="steve_rowe" created="Wed, 7 Mar 2012 00:44:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;Solr is a end-user product, so I have no idea why it is in maven at all. &lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;the &apos;artifact&apos; for an ordinary user is a .war file, a server-side webapp that a user places into their servlet container... maybe the maven artifact should be consistent with that? Wouldn&apos;t this avoid exposing any internal implementation details of whats actually inside that .war file, such as any external dependencies?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Solr can be used in embedded fashion (though I don&apos;t have any experience with that).&lt;/p&gt;

&lt;p&gt;Also, solrj is a client jar.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;edit&lt;/b&gt;: oops, solrj isn&apos;t relevant here - we&apos;re talking about solr-core.&lt;/p&gt;</comment>
                            <comment id="13223881" author="ryantxu" created="Wed, 7 Mar 2012 00:56:27 +0000"  >&lt;p&gt;The real problem (regardless of ant/maven) is for users that want to use o.a.c.csv classes that are &lt;b&gt;not&lt;/b&gt; the ones in the solr distribution.  This can happen when people have plugins using something based on a recent CSV build &amp;#8211; &lt;b&gt;something&lt;/b&gt; will break, either their code, or the CSVResponseWriter&lt;/p&gt;

&lt;p&gt;This is not a maven issue, it is a question of who should put classes into the org.apache.commons.csv namespace.  I understand why the csv folks are pissed, and think it is fair we look for ways to fix it.&lt;/p&gt;

&lt;p&gt;I am now +1 on Emmanuel&apos;s patch to embed o.a.solr.csv in the solr core jar file &amp;#8211; we should have notes that it won&apos;t be supported once a real csv is released.&lt;/p&gt;
</comment>
                            <comment id="13223907" author="rcmuir" created="Wed, 7 Mar 2012 01:53:27 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This is not a maven issue, it is a question of who should put classes into the org.apache.commons.csv namespace.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is a 100% maven and &lt;b&gt;only&lt;/b&gt; maven issue.&lt;/p&gt;

&lt;p&gt;For the ant build we are just using a snapshot jar in solr/lib, not &apos;releasing&apos; nor &apos;putting classes&apos; anywhere.&lt;br/&gt;
Its an implementation detail of solr. Its simply a dependency.&lt;/p&gt;</comment>
                            <comment id="13223920" author="ryantxu" created="Wed, 7 Mar 2012 02:31:32 +0000"  >&lt;p&gt;Sorry, by &apos;put classes&apos;, i mean that when commons-csv-1.0-SNAPSHOT-r966014.jar is in the &lt;b&gt;runtime&lt;/b&gt; classpath it uses classes in the namespace org.apache.commons.csv&lt;/p&gt;

&lt;p&gt;By using this namespace, it prevents people from using other dependencies with that same package name reliably.  The commons-csv folks are understandably upset that that means their jar file does not work as expected within solr.&lt;/p&gt;

&lt;p&gt;Consider the case where someone deploys the solr.war file (built by ant) with a plugin that uses the current commons-csv.jar from /trunk.  &lt;b&gt;something&lt;/b&gt; will break &amp;#8211; either the CSVRequestHandler or their plugin depending on what is first in the classpath.  (I think their plugin would always fail since it is loaded second)&lt;/p&gt;

&lt;p&gt;I think we have gotten lost in the maven discussion, when the real problem is about how our CSV.jar interacts with plugins (or anything else in the &lt;b&gt;runtime&lt;/b&gt; classpath)&lt;/p&gt;




</comment>
                            <comment id="13223922" author="rcmuir" created="Wed, 7 Mar 2012 02:43:37 +0000"  >&lt;p&gt;This issue isnt about plugins, having commons-csv in the classpath only affect users of &lt;b&gt;solr&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;Please don&apos;t try to spin the issue, this issue is all about maven and &lt;b&gt;only&lt;/b&gt; about maven:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the very title of this jira issue &apos;solr-commons-csv&apos; is a maven-only concept&lt;/li&gt;
	&lt;li&gt;as stated by Emmanuel in his first response back &apos;Even if you consider solr-commons-csv to be an internal part of Solr it&apos;s now a public Maven artifact that people are starting to use in their projects&apos;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So thats the only issue, maven artifacts. &lt;/p&gt;</comment>
                            <comment id="13223984" author="ryantxu" created="Wed, 7 Mar 2012 05:08:21 +0000"  >&lt;p&gt;I&apos;m not trying to spin anything &amp;#8211; I&apos;m trying to figure out what the real issue is.  Part of it is obviously the maven release.  Emmanuel can you tell us more about how this came up?&lt;/p&gt;</comment>
                            <comment id="13224116" author="ebourg" created="Wed, 7 Mar 2012 09:22:17 +0000"  >&lt;p&gt;Your analysis is correct Ryan. Anyone building upon the Solr code is affected by this issue. The fact the offending artifacts are in the central Maven repository only makes the problem worse, &lt;/p&gt;

&lt;p&gt;I discovered this issue because someone who imported solr-commons-csv in its project reported an issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-31&quot; title=&quot;CSVParser hangs (goes into infinite loop) on getLine() if it&amp;#39;s a &amp;quot;comment&amp;quot; line that doesn&amp;#39;t contain a delimiter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CSV-31&quot;&gt;&lt;del&gt;SANDBOX-330&lt;/del&gt;&lt;/a&gt;), an infinite loop with trailing comments, that was already fixed on the trunk. I didn&apos;t know about the solr-commons-csv artifact in the central Maven repository until then. So I inspected the jar and gasped in awe at the unmodified namespace.&lt;/p&gt;

&lt;p&gt;I understand that Maven as a build tool is controversial, I&apos;m myself an heavy Ant user on several projects requiring complex build setups. But Maven, as a way to share code through a central repository, is also a very valuable tool. It&apos;s adopted by alternative build tools like Ivy and Gradle. It&apos;s also used by IDEs to import dependencies automatically and to be able to browse their source and Javadoc easily. It&apos;s difficult to understand why this part is also hated by Maven detractors. The constraints on the central repository aren&apos;t that unbearable, the most important rule to follow is to not publish two artifacts identified by distinct groupId:artifactId with conflicting classes. The corollary is that a project A should not publish classes in the namespace of a project B.&lt;/p&gt;</comment>
                            <comment id="13224205" author="rcmuir" created="Wed, 7 Mar 2012 11:09:50 +0000"  >&lt;p&gt;The arguments that this is more than a maven issue are bogus.&lt;br/&gt;
Do you take me for a fool?&lt;/p&gt;

&lt;p&gt;The same arguments could be had for even &lt;b&gt;released&lt;/b&gt; dependencies like httpclient-3.0 that we use. What if a user wants to use 4.0?&lt;/p&gt;

&lt;p&gt;To ant, whether its released or unreleased, its just a jar in a /lib and in the users classpath.&lt;br/&gt;
But thats not the real issue here: These people are angry about maven repositories.&lt;/p&gt;

&lt;p&gt;So quit screwing around with crazy ideas about duplicating whole codebases and fix the real problem:&lt;/p&gt;

&lt;p&gt;open a bug report at Maven with the Description:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Allow maven project A to depend upon project B without B being in maven at all&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Thats the bug, it stops the replication of the virus, and i don&apos;t see any reason why maven wouldnt want to fix it? If they object, then it only proves my point that its really the GPLv3 of build tools.&lt;/p&gt;

</comment>
                            <comment id="13224208" author="gstein" created="Wed, 7 Mar 2012 11:24:32 +0000"  >&lt;p&gt;Maven is a red herring.&lt;/p&gt;

&lt;p&gt;The short answer is that the Lucene PMC is &lt;b&gt;releasing&lt;/b&gt; artifacts (to the maven repository) in the org.apache.commons namespace.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t matter how the release is done. You&apos;re doing it. You have released Commons code to the public. Period. Stop pointing fingers at tools. The Lucene PMC has released code in another project&apos;s namespace, which is &lt;b&gt;incompatible&lt;/b&gt; with the direction that project wants to take the namespace. The Lucene PMC has no right to usurp the direction of other projects here at the ASF.&lt;/p&gt;

&lt;p&gt;If you cannot get the tool to avoid releasing/interfering with other projects&apos; code, then stop using the tool. Seriously.&lt;/p&gt;

&lt;p&gt;The Lucene PMC&apos;s releases should stop interfering with other projects&apos; namespaces. Find a way to fix it. Stop blaming tools. Start fixing.&lt;/p&gt;</comment>
                            <comment id="13224209" author="ebourg" created="Wed, 7 Mar 2012 11:25:48 +0000"  >&lt;p&gt;HTTClient 4 can coexist with HTTPClient 3 in the same classpath, because they are not in the same package.&lt;/p&gt;</comment>
                            <comment id="13224284" author="gsingers" created="Wed, 7 Mar 2012 13:18:16 +0000"  >&lt;p&gt;I guess I&apos;m missing something.  We aren&apos;t part of the Commons project.  The Commons code is Apache licensed, we are using it as we see fit under the T&amp;amp;C of the ASL.  What prevents someone else from going and doing the same thing outside of Apache?  In fact, it happens all the time, even at Apache.  Commons CLI 2 is the biggest one, as I know of several projects that &quot;release&quot; that b/c Commons itself never has.  Here are also several who do it for Lucene.  The problem &lt;b&gt;is&lt;/b&gt; Maven and it isn&apos;t going away.&lt;/p&gt;

&lt;p&gt;Here are some examples:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&quot;http://search.maven.org/#artifactdetails%7Corg.hibernate.apache.lucene.solr%7Capache-solr-analyzer%7C1.2.0%7Cjar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search.maven.org/#artifactdetails%7Corg.hibernate.apache.lucene.solr%7Capache-solr-analyzer%7C1.2.0%7Cjar&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://search.maven.org/#artifactdetails%7Corg.apache.clerezza.ext%7Corg.apache.lucene%7C0.1-incubating%7Cbundle&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search.maven.org/#artifactdetails%7Corg.apache.clerezza.ext%7Corg.apache.lucene%7C0.1-incubating%7Cbundle&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Tomcat does the same thing to Commons (file upload, for example):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&quot;http://search.maven.org/#search%7Cga%7C4%7Ccommons&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search.maven.org/#search%7Cga%7C4%7Ccommons&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I could keep going.  Just do searches for popular Apache libraries in Maven and you will see what I mean.  Maven is not a red herring.  It is the problem.  &lt;/p&gt;</comment>
                            <comment id="13224329" author="ebourg" created="Wed, 7 Mar 2012 13:33:33 +0000"  >&lt;p&gt;That&apos;s not correct for Tomcat, the Commons components in Tomcat have a different namespace to avoid classpath conflicts.&lt;/p&gt;

&lt;p&gt;Clerezza releases will have to be changed too.&lt;/p&gt;

&lt;p&gt;Hibernate probably made a mistake in 2008, they haven&apos;t released a solr artifact since then, so I guess they fixed the issue.&lt;/p&gt;

&lt;p&gt;EDIT: Indeed Hibernate fixed the dependency in Hibernate Search 3.3.0 Beta2, the dependency was introduced with the Beta 1&lt;/p&gt;</comment>
                            <comment id="13224332" author="gsingers" created="Wed, 7 Mar 2012 13:44:08 +0000"  >&lt;p&gt;More that do it:&lt;br/&gt;
Geronimo (Apache) (Digester, Discovery)&lt;br/&gt;
JVNet-Hudson (commons-jelly)&lt;br/&gt;
com.kenai.nbpwr&lt;br/&gt;
ServiceMix (commons-csv)&lt;br/&gt;
Apache Directory does this weird thing where they package the Commons jars inside of another jar.  Not sure what that does, but the nested jar is Commons.  Not quite sure how the classloader would deal with that.&lt;br/&gt;
Mahout does it for Commons-CLI2 (b/c commons never seems to want to release it)&lt;/p&gt;

&lt;p&gt;And that is just me searching for commons.&lt;/p&gt;

&lt;p&gt;BTW, I don&apos;t actually think the problem is Maven.  The problem is Java&apos;s classloader is broken.  The way to fix it is to use a classloader that scopes dependencies properly.  Otherwise, this is simply a known problem with Java and the solution is that one has to be careful about what versions of things one imports.  It&apos;s exactly the same issue as when one has two dependencies that each have dependencies on different versions of commons-lang or Lucene or whats-it-called.jar. &lt;/p&gt;

&lt;p&gt;In other words, I don&apos;t think this is worth us doing anything different than what we are already doing.  Except, for seeing if we can upgrade our version of Commons CSV to an official release as a courtesy. &lt;/p&gt;</comment>
                            <comment id="13224333" author="mikemccand" created="Wed, 7 Mar 2012 13:46:07 +0000"  >&lt;p&gt;There are two very different issues mixed in here:&lt;/p&gt;

&lt;p&gt;Issue 1: a private, internal dependency in Solr on commons-csv (and&lt;br/&gt;
others) has become &quot;publicly released&quot; in Maven as solr-commons-csv.&lt;br/&gt;
I know very little about Maven, but this does sound bad.  That said, I&lt;br/&gt;
don&apos;t think Maven has any right to &quot;peek in&quot; and force Solr&apos;s private&lt;br/&gt;
dependencies to become public; what deps Solr uses is an&lt;br/&gt;
implementation detail of Solr. Short of removing Solr from Maven, is&lt;br/&gt;
there some way to publish Solr&apos;s WAR through Maven while keeping (some&lt;br/&gt;
of?) its dependencies private?&lt;/p&gt;

&lt;p&gt;Issue 2: JAR hell (runtime CLASSPATH pollution): this is an age old,&lt;br/&gt;
widespread issue, completely orthogonal to Maven.  Regardless of how a&lt;br/&gt;
project builds its artifacts, if it has external dependencies, it will&lt;br/&gt;
of course &quot;pollute&quot; the CLASSPATH.  This is a well known problem.&lt;/p&gt;

&lt;p&gt;Really, we should open a new issue for issue 2: it has nothing to do&lt;br/&gt;
with Maven and is long-standing (our ant-produced artifacts have had&lt;br/&gt;
the issue forever).  In practice, this has never seemed to be a&lt;br/&gt;
problem to users, presumably because users don&apos;t usually embed Solr.&lt;br/&gt;
Normally users deploy the WAR and use as-is, except for plugins.  If&lt;br/&gt;
we really think this needs to be fixed (I&apos;m doubtful), there are&lt;br/&gt;
various options... eg OSGI seems to &quot;solve&quot; this, but adds complexity.&lt;br/&gt;
Jarjar, minijar, ant replace, are also options, but I don&apos;t like the&lt;br/&gt;
risk of hard-to-explain bugs.  We can discuss on a separate issue...&lt;/p&gt;</comment>
                            <comment id="13224344" author="gsingers" created="Wed, 7 Mar 2012 13:59:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;That&apos;s not correct for Tomcat, the Commons components in Tomcat have a different namespace to avoid classpath conflicts.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not in the ones I downloaded.&lt;/p&gt;
</comment>
                            <comment id="13224348" author="ebourg" created="Wed, 7 Mar 2012 14:05:58 +0000"  >&lt;p&gt;Grant, get the latest ones:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.jarvana.com/jarvana/inspect/org/apache/tomcat/tomcat-dbcp/7.0.23/tomcat-dbcp-7.0.23.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.jarvana.com/jarvana/inspect/org/apache/tomcat/tomcat-dbcp/7.0.23/tomcat-dbcp-7.0.23.jar&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13224365" author="sokolov" created="Wed, 7 Mar 2012 14:27:04 +0000"  >&lt;p&gt;There is no issue for users of the WAR, I think, which will generally be external to a project, and handles all of these bundling issues internally.&lt;/p&gt;

&lt;p&gt;The issue arises in projects that depend on the various solr jars that are bundled in its WAR.  Using Maven, it&apos;s as if you exploded the WAR, pulled all its jars into your project, and then added your own code too.  As an example, we&apos;ve done this in a project where I work so we can run EmbeddedSolrServer in our tests. I have it on my TODO list to break this dependency though since it&apos;s overkill to include all of solr in our project for this convenience.  &lt;/p&gt;</comment>
                            <comment id="13224377" author="thetaphi" created="Wed, 7 Mar 2012 14:46:12 +0000"  >&lt;p&gt;As noted before, we cannot fix this for Jetty 6 by package-renaming using JarJar, as this would break almost everything in the jetty configuration (Jetty is JarJar unfriendly), but Jetty can be easily solved on our side by upgrading to Jetty 8 (also for Solr 3.6!!!!). The patch/branch is ready, just needs committing. We can then ship with unmodified Jetty 8, as the Unicode bugs should be fixed.&lt;/p&gt;

&lt;p&gt;For the other projects I see no real problem in using jarjar (which is used in lots of projects): Lets simply investigate what foreign namespaces we use in our packages (e.g. we should also rename the Snowball classes, because we heavily forked them and they are still in org.tartarus namespace - as we forked that project, we should do it in the source code). For e.g. commons-csv we have no problem jarjaring our fork and re-release it. In the jarjar issue tracker is also a discussion about &#8220;hiding&#8221; renamed classes from GUIs by prefixing all renamed class names with $, so they are invisible for an autocomplete-using Eclipse developer, so nobody outside can use the jarjared classes outside Lucene/Solr.&lt;/p&gt;

&lt;p&gt;About the remaining issues Robert mentioned: They are all solvable. JarJar renames also class names inside strings used for reflection, it can also rewrite Manifests and META-INF (we use e.g. for codecs, or Apache Xerces uses to plug in the parser impl). I just would like to give it a try, it cannot happen more than our testcases do not run. The example Robert has given with external references to icu4j is exactly what we want to prevent with JarJaring, so it doesn&#8217;t apply in my opinion. If we patch and modify icu4j and ship with a package-renamed version, code that uses reflection outside the Solr/Lucene JAR is completely unaffected. If the external project side-by-side with Lucene/Solr wants to use icu4j it can simply include the original in any version, solr with its patched version is completely unaffected and vice versa.&lt;/p&gt;

&lt;p&gt;So I would strongly suggest to jarjar all dependencies that we modified locally (means all foreign jar-files with solr-prefix). How we do this is a different issue: We can only rename all classes in that jar-file and republish it (but then we have to change our import statements in our code &#8211; I would prefer this), or we jarjar the whole Solr distribution after the complete build.&lt;/p&gt;</comment>
                            <comment id="13224381" author="rcmuir" created="Wed, 7 Mar 2012 14:55:29 +0000"  >&lt;p&gt;How would this work for e.g. the carrot2 example? The carrot2 class names are referenced in user configuration files (solrconfig.xml):&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    &amp;lt;lst name=&quot;engine&quot;&amp;gt;
      &amp;lt;!-- The name, only one can be named &quot;default&quot; --&amp;gt;
      &amp;lt;str name=&quot;name&quot;&amp;gt;default&amp;lt;/str&amp;gt;
      &amp;lt;str name=&quot;carrot.algorithm&quot;&amp;gt;org.carrot2.clustering.lingo.LingoClusteringAlgorithm&amp;lt;/str&amp;gt;
    &amp;lt;/lst&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13224384" author="rcmuir" created="Wed, 7 Mar 2012 14:58:22 +0000"  >&lt;p&gt;Also the UIMA integration has the same issue, configuration files contain their qualified class names, for example:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;type allAnnotatorFeatures=&quot;true&quot;&amp;gt;org.apache.uima.SentenceAnnotation&amp;lt;/type&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13224389" author="ebourg" created="Wed, 7 Mar 2012 15:05:37 +0000"  >&lt;blockquote&gt;
&lt;p&gt;How we do this is a different issue: We can only rename all classes in that jar-file and republish it (but then we have to change our import statements in our code &#8211; I would prefer this), or we jarjar the whole Solr distribution after the complete build.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s preferable to post process the Solr jar rather than renaming the packages imported in the source code. That&apos;s less intrusive and let you upgrade to the official fixed dependency more easily.&lt;/p&gt;</comment>
                            <comment id="13224399" author="markrmiller@gmail.com" created="Wed, 7 Mar 2012 15:19:33 +0000"  >&lt;p&gt;As Mike and Yonik mentioned - most of us don&apos;t know much about maven. I still wish it was a downstream issue. I still wish we would have voted on supporting it. With all due respect to Steve and his great work around it. I really wish it was not our problem - as I know many others do.&lt;/p&gt;

&lt;p&gt;What was the issue with just using a released version of csv? This issue is so long already, its hard to find it. &lt;/p&gt;

&lt;p&gt;And -1 for continuing Maven support within the project for what its worth &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; (Though I love your work and dedication to this Steve &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;</comment>
                            <comment id="13224402" author="rcmuir" created="Wed, 7 Mar 2012 15:23:54 +0000"  >&lt;blockquote&gt;
&lt;p&gt;What was the issue with just using a released version of csv? This issue is so long already, its hard to find it. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think the major issue is that there is not yet a released version. I think we would definitely prefer that.&lt;/p&gt;

&lt;p&gt;Speaking from some experience: In my opinion CSV is deceptively complex and is a perfect example of where we &lt;br/&gt;
would rather &apos;downstream&apos; that knowledge to someone who focuses on it and gives good performance. &lt;br/&gt;
Rolling our own is dangerous.&lt;/p&gt;

&lt;p&gt;But there is not yet any official releases to use...&lt;/p&gt;</comment>
                            <comment id="13224424" author="thetaphi" created="Wed, 7 Mar 2012 15:28:54 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;How we do this is a different issue: We can only rename all classes in that jar-file and republish it (but then we have to change our import statements in our code &#8211; I would prefer this), or we jarjar the whole Solr distribution after the complete build.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s preferable to post process the Solr jar rather than renaming the packages imported in the source code. That&apos;s less intrusive and let you upgrade to the official fixed dependency more easily.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s our committers decision. The fact here is, that Solr or even Lucene is not just a WAR file, its consisting of lot&apos;s of unrelated JAR artifacts and all of them should live on its own, so a user can remove features he does not need. So I prefer to &quot;transform&quot; those &quot;changed&quot; artifacts separately to private &quot;namespace&quot; and simply change maybe 3 import statements (I can even use &quot;sed&quot; for that).&lt;/p&gt;</comment>
                            <comment id="13224429" author="markrmiller@gmail.com" created="Wed, 7 Mar 2012 15:36:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;But there is not yet any official releases to use...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, interesting. Perhaps we could get the favor of a release &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s 5 classes it looks like - and it&apos;s Apache licensed and there is no release - can&apos;t we simply suck this into our code base with a readme and JIRA about removing it and switching to a release when one occurs? Get the whole dependency thing right out of Maven&apos;s claws.&lt;/p&gt;</comment>
                            <comment id="13224433" author="steve_rowe" created="Wed, 7 Mar 2012 15:38:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;So I prefer to &quot;transform&quot; those &quot;changed&quot; artifacts separately to private &quot;namespace&quot; and simply change maybe 3 import statements (I can even use &quot;sed&quot; for that).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13224434" author="ebourg" created="Wed, 7 Mar 2012 15:39:27 +0000"  >&lt;p&gt;That was the purpose of my patch Mark &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13224437" author="rcmuir" created="Wed, 7 Mar 2012 15:43:47 +0000"  >&lt;blockquote&gt;
&lt;p&gt;It&apos;s 5 classes it looks like - and it&apos;s Apache licensed and there is no release - can&apos;t we simply suck this into our code base with a readme and JIRA about removing it and switching to a release when one occurs? Get the whole dependency thing right out of Maven&apos;s claws.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes while this is the case, and as Emmanuel states, the purpose of his patch, its not a scalable solution in general.&lt;br/&gt;
Its also expensive to fork software... there is always the danger that we then become out-of-sync and never sync back up.&lt;/p&gt;

&lt;p&gt;(feel free to hit me, for Uwe&apos;s example of snowball, which is a perfect example)&lt;/p&gt;

&lt;p&gt;What about the other cases that fall into this same &apos;maven namespace&apos; category, e.g. the UIMA case for example?&lt;/p&gt;

&lt;p&gt;How to fix the general problem? Thats why I think that the only proper way to fix the bug is to attack it at the heart:&lt;br/&gt;
Thats the fact that for maven project A to depend upon project B that is not in maven, maven project A must &quot;publish&quot; some &quot;fake maven release&quot; of project B.&lt;/p&gt;</comment>
                            <comment id="13224438" author="rcmuir" created="Wed, 7 Mar 2012 15:48:20 +0000"  >&lt;p&gt;And for the record, i want to withdraw my opposition to Emmanuel&apos;s patch.&lt;/p&gt;

&lt;p&gt;I still feel strongly this doesn&apos;t solve the &apos;real problem&apos;, but if it makes the commons-csv developers happy, lets do it.&lt;/p&gt;

&lt;p&gt;Though I think its fair to say I will speak up if i see any commits/local modifications to this, because ultimately I want&lt;br/&gt;
to see us depending upon a released version of this jar file.&lt;/p&gt;</comment>
                            <comment id="13224441" author="markrmiller@gmail.com" created="Wed, 7 Mar 2012 15:52:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;That was the purpose of my patch Mark &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 - I think this is the way to go, I just haven&apos;t understood any objections to it yet.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I still feel strongly this doesn&apos;t solve the &apos;real problem&apos;,&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hate to sound like a broken record jerk, but again I think the real problem is our support of Maven &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I don&apos;t see how, short of dropping internal Maven support, we solve the real problem. And barring a full glorious solution, this is a small and simple thing we can do that makes the commons guys happy. If all of a sudden we are bombarded by issues like these, I guess we can burn that bridge later. And drop Maven &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13224454" author="thetaphi" created="Wed, 7 Mar 2012 16:02:31 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I still feel strongly this doesn&apos;t solve the &apos;real problem&apos;, but if it makes the commons-csv developers happy, lets do it.&lt;/p&gt;

&lt;p&gt;Though I think its fair to say I will speak up if i see any commits/local modifications to this, because ultimately I want&lt;br/&gt;
to see us depending upon a released version of this jar file.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To prevent this I would prefer jarjar, its not risky here at all (and also not for other usitility libs from commons). I am already plaing around with that. What I did here was repackage the JAR file and used a simple serach/replace on our source files to refer to new package name. Not even maven config has to be changedm Steven Rowe can publish the solr-commons-csv.jar as he likes.&lt;/p&gt;</comment>
                            <comment id="13224465" author="rcmuir" created="Wed, 7 Mar 2012 16:09:21 +0000"  >&lt;p&gt;Uwe: maybe we should do it just for this case (rather than offering a general solution?)&lt;/p&gt;

&lt;p&gt;Basically what i&apos;m trying to say is that the general problem is complex, I think there are enough examples (jetty, carrot2, uima, etc)&lt;br/&gt;
that fall in this category that aren&apos;t really solved by jarjar. I think we either need to solve this issue as a &apos;case-by-case&apos; for commons-csv,&lt;br/&gt;
or fix the entire problem (which definitely, definitely, certainly, without a doubt, involves fixing maven).&lt;/p&gt;

&lt;p&gt;But to be practical, lets come up with something so that commons-csv developers are happy and can issue a release (which we can then depend upon).&lt;/p&gt;

&lt;p&gt;Keeping in mind that this is supposed to be a 3.6 minor release, can we apply the jarjar solution &lt;b&gt;only&lt;/b&gt; to commons-csv?&lt;br/&gt;
I feel the other situations are more dangerous and I think we should be careful, but at the same time we should address&lt;br/&gt;
their concerns and put ourselves in a situation where we don&apos;t end out &apos;forking&apos; it... I don&apos;t want to see that.&lt;/p&gt;</comment>
                            <comment id="13224476" author="markrmiller@gmail.com" created="Wed, 7 Mar 2012 16:25:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;can we apply the jarjar solution only to commons-csv?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13224479" author="steve_rowe" created="Wed, 7 Mar 2012 16:31:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think there are enough examples (jetty, carrot2, uima, etc) &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We are not currently publishing third party solr-uima-* artifacts, though we have in the past (versions prior to 3.5.0).&lt;/p&gt;</comment>
                            <comment id="13224482" author="thetaphi" created="Wed, 7 Mar 2012 16:33:49 +0000"  >&lt;p&gt;Here the patch and the transformed JAR file (and renamed). Most of the patch is my rename of the JAR file to solr- prefix. Code changes is 5 lines of import statements!&lt;/p&gt;

&lt;p&gt;What I did:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;copy the original JAR file to a folder&lt;/li&gt;
	&lt;li&gt;place jarjar-1.2.jar somewhere&lt;/li&gt;
	&lt;li&gt;edit the rules.txt file and change package names&lt;/li&gt;
	&lt;li&gt;run java -jar jarjar-1.2.jar process rule.txt commons-csv-1.0-SNAPSHOT-r966014.jar solr-commons-csv-1.0-SNAPSHOT-r966014.jar&lt;/li&gt;
	&lt;li&gt;place the resulting jar file in solr/core/lib (remove the old one before) and commit it like any other bundled artifact &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All tests pass and the supplied JAR file could be published in maven with the name sarowe gave it.&lt;/p&gt;</comment>
                            <comment id="13224489" author="rcmuir" created="Wed, 7 Mar 2012 16:38:47 +0000"  >&lt;p&gt;Thanks Uwe: i support your change. I think it is the best compromise.&lt;/p&gt;

&lt;p&gt;it seems to me, because the jar is &quot;pre-jar-jar&apos;ed&quot; we don&apos;t fall into various &lt;br/&gt;
IDE configuration conflicts either right? Its just as easy for developers to configure &lt;br/&gt;
their workspace (ant eclipse, ant idea)&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13224491" author="steve_rowe" created="Wed, 7 Mar 2012 16:40:26 +0000"  >&lt;p&gt;+1 for Uwe&apos;s JarJar fix.&lt;/p&gt;</comment>
                            <comment id="13224497" author="thetaphi" created="Wed, 7 Mar 2012 16:48:28 +0000"  >&lt;p&gt;The keep line is not even needed in the rules.txt. There is one small issue: The resulting JAR file contains an empty org.apache.commons folder and some maven relicts (die,die,die), but thats minor.&lt;/p&gt;</comment>
                            <comment id="13224506" author="thetaphi" created="Wed, 7 Mar 2012 17:08:38 +0000"  >&lt;p&gt;Updated patch to make it mor consistent with the naming conventions of Solr. &lt;/p&gt;

&lt;p&gt;I think we should do the same for the other file in lib: noggit&lt;/p&gt;

&lt;p&gt;Steven Rowe: What other modified JARs do we have that are republished through maven?&lt;/p&gt;</comment>
                            <comment id="13224510" author="dweiss" created="Wed, 7 Mar 2012 17:16:05 +0000"  >&lt;p&gt;Don&apos;t jarjar Carrot2, please. We are plugging in our commercial clustering engine into Solr via Carrot2 controllers so if you change package namespace we will no longer be able to do it.&lt;/p&gt;</comment>
                            <comment id="13224515" author="steve_rowe" created="Wed, 7 Mar 2012 17:23:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Steven Rowe: What other modified JARs do we have that are republished through maven?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For branch_3x:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;module&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;jar&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Lucene benchmark&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;lucene/contrib/benchmark/lib/xercesImpl-2.9.1-patched-XERCESJ&amp;#45;1257.jar&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Solr clustering&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;solr/contrib/clustering/carrot2-core-3.5.0.jar&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Solr langid&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;solr/contrib/langid/lib/jsonic-1.2.0.jar&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Solr langid&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;solr/contrib/langid/lib/langdetect-r111-java5.jar&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Solr core&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;solr/lib/apache-solr-noggit-r1099557.jar&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Solr core&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;solr/lib/commons-csv-1.0-SNAPSHOT-r966014.jar&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Trunk is the same, except that the carrot2-core jar is no longer required (it&apos;s required on branch_3x because it&apos;s a specially Java5-compiled jar, but no longer on trunk/4.0, which requires Java 6, and so can use the Maven central artifact.)&lt;/p&gt;

</comment>
                            <comment id="13224516" author="thetaphi" created="Wed, 7 Mar 2012 17:23:29 +0000"  >&lt;p&gt;According to Steven, we don&apos;t republish them so there is no need to do this.&lt;/p&gt;</comment>
                            <comment id="13224524" author="thetaphi" created="Wed, 7 Mar 2012 17:26:54 +0000"  >&lt;p&gt;For carrot: If you can just compile carrot with Java 5 and produce Java 5 JARs, why does Dawid/Carrot not do this? A Java 6 class/jar file is not really useful if just the version number of the file header is different...&lt;/p&gt;</comment>
                            <comment id="13224602" author="rcmuir" created="Wed, 7 Mar 2012 19:08:11 +0000"  >&lt;p&gt;Well the carrot is similar to the uima case, in both cases we have their committers also as committers working&lt;br/&gt;
on integrations within on our project, and they have voiced no problem with how things work so far, so why break it?&lt;/p&gt;</comment>
                            <comment id="13224634" author="mikemccand" created="Wed, 7 Mar 2012 19:35:53 +0000"  >&lt;blockquote&gt;
&lt;p&gt;How to fix the general problem? Thats why I think that the only proper way to fix the bug is to attack it at the heart:&lt;br/&gt;
Thats the fact that for maven project A to depend upon project B that is not in maven, maven project A must &quot;publish&quot; some &quot;fake maven release&quot; of project B.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, this sums up the Maven issue.&lt;/p&gt;

&lt;p&gt;But is it really true?  Is there really no way to stop Maven from&lt;br/&gt;
making project A&apos;s private deps public?  This is horribly invasive.&lt;/p&gt;

&lt;p&gt;CLASSPATH polution is a separate, widespread, longstanding and very&lt;br/&gt;
real issue. I don&apos;t think jarjar&apos;ing every dependency Solr (or our&lt;br/&gt;
modules, contribs, etc.) is a good general solution.&lt;/p&gt;

&lt;p&gt;But I think it&apos;s OK in this case... progress not perfection. Your&lt;br/&gt;
patch looks good Uwe, thanks!&lt;/p&gt;</comment>
                            <comment id="13224645" author="ryantxu" created="Wed, 7 Mar 2012 19:53:13 +0000"  >&lt;p&gt;+1 thanks Uwe&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I don&apos;t think jarjar&apos;ing every dependency Solr&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The only jar files in question are snapshot/unreleased code.  The commons-csv problem is a non issue if we were using a released version.&lt;/p&gt;</comment>
                            <comment id="13224663" author="mikemccand" created="Wed, 7 Mar 2012 20:13:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;The commons-csv problem is a non issue if we were using a released version.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Wait, are you talking about the Maven issue (&quot;my private deps become publicly released to Maven&quot;), or the more general JAR hell problem?&lt;/p&gt;

&lt;p&gt;For JAR hell, I thought even released versions can cause problems too?&lt;/p&gt;

&lt;p&gt;Ie, we include version X of a dep, and the app embedding solr is using version Y, and they may conflict?&lt;/p&gt;

&lt;p&gt;Ie the classic problem: &lt;a href=&quot;http://en.wikipedia.org/wiki/Java_Classloader#JAR_hell&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/Java_Classloader#JAR_hell&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13224678" author="teofili" created="Wed, 7 Mar 2012 20:27:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Well the carrot is similar to the uima case, in both cases we have their committers also as committers working on integrations within on our project, and they have voiced no problem with how things work so far, so why break it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;also starting from 3.5.0 the UIMA dependencies&apos; jars are released artifacts (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2746&quot; title=&quot;Use the released UIMA addons 2.3.1 in Solr-UIMA&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2746&quot;&gt;&lt;del&gt;SOLR-2746&lt;/del&gt;&lt;/a&gt; and thus &lt;a href=&quot;http://mvnrepository.com/artifact/org.apache.solr/solr-uima/3.5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mvnrepository.com/artifact/org.apache.solr/solr-uima/3.5.0&lt;/a&gt; )&lt;/p&gt;</comment>
                            <comment id="13224683" author="thetaphi" created="Wed, 7 Mar 2012 20:32:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;For JAR hell, I thought even released versions can cause problems too?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes of course. But e.g. maven can help to prevent those problems. It will not allow you to add the same dependency in different versions. The issue we had caused by our separate release of unreleased package under the solr group-id was that maven is seeing our repackaged dependency under another artifact id - so it cannot prevent that a project adds solr-commons-xx, version-foo and commony-xx, version-bar, because it is two different things.&lt;/p&gt;</comment>
                            <comment id="13224688" author="teofili" created="Wed, 7 Mar 2012 20:37:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;The issue we had caused by our separate release of unreleased package under the solr group-id was that maven is seeing our repackaged dependency under another artifact id - so it cannot prevent that a project adds solr-commons-xx, version-foo and commony-xx, version-bar, because it is two different things.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yes, that&apos;s also my understanding of this issue with unreleased dependencies&apos; jars.&lt;/p&gt;</comment>
                            <comment id="13224690" author="ryantxu" created="Wed, 7 Mar 2012 20:39:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;Wait, are you talking about the Maven issue (&quot;my private deps become publicly released to Maven&quot;), or the more general JAR hell problem?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I see this entirely as as JAR hell problem.  Maven just makes it easier to discover.  &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;For JAR hell, I thought even released versions can cause problems too?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Of course - but this is an expected side-effect of a release.  This whole discussion is because the commons-csv people never agreed to support the classnames solr is using.  If they request we change the name, it seems only appropriate that we do.&lt;/p&gt;



</comment>
                            <comment id="13224692" author="dweiss" created="Wed, 7 Mar 2012 20:41:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;For carrot: If you can just compile carrot with Java 5 and produce Java 5 JARs, why does Dawid/Carrot not do this? A Java 6 class/jar file is not really useful if just the version number of the file header is different...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s not that simple. We use 1.6 APIs and we have libraries that are compiled under 1.6. The version embedded in Solr is patched and backported using retroweaver if I remember correctly. Like I said, I don&apos;t have a problem if you just publish that particular artefact as is under Solr&apos;s groupid. I don&apos;t see a problem here, really. Classpath conflicts do happen but it&apos;s easier to recover from a classpath conflict than from a jarjared file which happens to use runtime reflection or something like that (just replacing strings is often not enough if class names are constructed dynamically).&lt;/p&gt;
</comment>
                            <comment id="13224723" author="bmargulies" created="Wed, 7 Mar 2012 21:27:33 +0000"  >&lt;p&gt;So, I hear that you all wish that you had more control over the dependencies that you propagate when you publish to maven central. Perhaps I could help?&lt;/p&gt;

&lt;p&gt;Option 1, which you&apos;ve already detected, is to use jarjar or shade so that you can publish your fork of someone else&apos;s stuff in your own package namespace fairly painlessly, either storing it inside some other jar of yours or publishing it under your coordinates.&lt;/p&gt;

&lt;p&gt;Option 2 is optional dependencies: &lt;a href=&quot;http://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This is a way to force the users of your artifacts to explicitly declare some or all of your dependencies, rather than getting them automatically. In other words, virality control.&lt;/p&gt;

&lt;p&gt;Now, if you don&apos;t publish one of these, anyone who uses your published artifact will get past the maven dependency graph &amp;#8211; and then sink or swim based on whether they&apos;ve made their own arrangements to get the code into their classpath. I can&apos;t help wondering how this helps with the original complaint of the Common(s)-Folk: if you release a version of Lucene that requires a forked version of Commons, and you don&apos;t change the packages, you&apos;re setting up for a classpath conflict, sooner or later, with or without maven, aren&apos;t you?&lt;/p&gt;


&lt;p&gt;Option 3 is simply to observe that your users can always use &apos;exclude&apos; to cut off following some dependency link of yours that doesn&apos;t appeal to them.&lt;/p&gt;

&lt;p&gt;Does any of this help?&lt;/p&gt;

&lt;p&gt;p.s. I don&apos;t know much about jarjar, but I know that shade has a lot of fancy options that can, in some cases, compensate for reflection or other problems with the package rename process.&lt;/p&gt;</comment>
                            <comment id="13224740" author="thetaphi" created="Wed, 7 Mar 2012 21:37:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;p.s. I don&apos;t know much about jarjar, but I know that shade has a lot of fancy options that can, in some cases, compensate for reflection or other problems with the package rename process.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;jarjar does the same. Shade is only available to Maven so not really useable for us.&lt;/p&gt;</comment>
                            <comment id="13224742" author="thetaphi" created="Wed, 7 Mar 2012 21:38:21 +0000"  >&lt;p&gt;Dawid: Thanks for insight!&lt;/p&gt;</comment>
                            <comment id="13224745" author="thetaphi" created="Wed, 7 Mar 2012 21:40:16 +0000"  >&lt;p&gt;I prepared my checkout for committing this. It seems that we all agree that this is, until commons-csv is released, the simpliest option. I cleaned up the JAR file a little bit and removed the empty commons directory and removed the wrong maven metadata. I also added a note to NOTICE.txt, that this JAR file is a prerelease of commons-csv and was jarjared to an internal solr package name.&lt;/p&gt;

&lt;p&gt;Any objections?&lt;/p&gt;</comment>
                            <comment id="13224749" author="thetaphi" created="Wed, 7 Mar 2012 21:50:12 +0000"  >&lt;p&gt;Here my final patch and cleaned up jar.&lt;/p&gt;</comment>
                            <comment id="13224751" author="mikemccand" created="Wed, 7 Mar 2012 21:52:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;Any objections?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 to commit.&lt;/p&gt;

&lt;p&gt;But can you please open a follow-on issue that once commons-csv is released we should upgrade...?&lt;/p&gt;</comment>
                            <comment id="13224752" author="steve_rowe" created="Wed, 7 Mar 2012 21:53:04 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Option 2 is optional dependencies: &lt;a href=&quot;http://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This is a way to force the users of your artifacts to explicitly declare some or all of your dependencies, rather than getting them automatically. In other words, virality control.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t like the fact that taking this approach for all of our non-Mavenized dependencies (by which I mean those that are not in Maven Central) would put a much greater burden on our users that consume Lucene/Solr artifacts via Maven.  &lt;/p&gt;

&lt;p&gt;Users would have to either have to a) download the binary release and manually install the non-Maven artifacts one-by-one in their local or internal repository (after consulting both the top-level Maven POM and a list of per-module dependencies that currently only exists in a lib/ directory listing); or b) download the source release, run &lt;tt&gt;ant get-maven-poms&lt;/tt&gt;, then run &lt;tt&gt;mvn -N -Pbootstrap install&lt;/tt&gt;.  Neither of these fall within the expected level of effort for Maven users.&lt;/p&gt;

&lt;p&gt;-1 from me for using optional dependencies to counter Maven&apos;s virality.&lt;/p&gt;</comment>
                            <comment id="13224757" author="thetaphi" created="Wed, 7 Mar 2012 21:56:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;But can you please open a follow-on issue that once commons-csv is released we should upgrade...?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Of course! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13224758" author="ebourg" created="Wed, 7 Mar 2012 21:58:04 +0000"  >&lt;p&gt;Uwe you can also remove the writer package in the jar, Solr doesn&apos;t use it and it has been removed from Commons CSV.&lt;/p&gt;</comment>
                            <comment id="13224770" author="thetaphi" created="Wed, 7 Mar 2012 22:06:13 +0000"  >&lt;p&gt;I think I leave it as it is for now. The jar file name contains the revision no of the Commons-CSV, so it should be unmodified (exept the package name).&lt;/p&gt;

&lt;p&gt;Once Commons-CSV is released, we will drop the JAR file and replace by the official dependency.&lt;/p&gt;</comment>
                            <comment id="13224772" author="bmargulies" created="Wed, 7 Mar 2012 22:08:05 +0000"  >&lt;p&gt;In the unlikely event that you bump into something that makes shade attractive, let me know. I&apos;ll make you an ant task for it.&lt;/p&gt;</comment>
                            <comment id="13224775" author="mikemccand" created="Wed, 7 Mar 2012 22:09:29 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;For JAR hell, I thought even released versions can cause problems too?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes of course. But e.g. maven can help to prevent those problems. It will not allow you to add the same dependency in different versions. The issue we had caused by our separate release of unreleased package under the solr group-id was that maven is seeing our repackaged dependency under another artifact id - so it cannot prevent that a project adds solr-commons-xx, version-foo and commony-xx, version-bar, because it is two different things.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I see.  So then we &quot;subverted&quot; Maven&apos;s ability to catch the&lt;br/&gt;
conflicting versions of the same dep, by not using the same&lt;br/&gt;
coordinates that commons-csv will eventually use, once they release?&lt;/p&gt;

&lt;p&gt;Given that, as crazy as this sounds, maybe we should have published&lt;br/&gt;
using the same coordinates?  Ie this way Maven apps would know they&lt;br/&gt;
had conflicting versions (one, from Solr, of what is basically a&lt;br/&gt;
pre-release snapshot of commons-csv, and another of a real, eventual&lt;br/&gt;
future commons-csv release).&lt;/p&gt;

&lt;p&gt;Or.... maybe Maven should not make it a hard requirement that a&lt;br/&gt;
non-snapshot release (of Solr) cannot depend on a snapshot release (of&lt;br/&gt;
commons-csv)?  After all, this is really a judgement call of the&lt;br/&gt;
committers (in Solr), as to whether a snapshot release is &quot;good&lt;br/&gt;
enough&quot;/well tested, given how the project is using it, for its&lt;br/&gt;
purposes/release?&lt;/p&gt;

&lt;p&gt;Net/net it looks like Maven&apos;s invasive/viral restrictions (&quot;all of&lt;br/&gt;
your deps become publicly released&quot;, and &quot;your deps cannot be&lt;br/&gt;
snapshots&quot;) are tying our hands here?&lt;/p&gt;

&lt;p&gt;Surely this problem has come up before in Maven usage?&lt;/p&gt;</comment>
                            <comment id="13224778" author="bmargulies" created="Wed, 7 Mar 2012 22:14:33 +0000"  >&lt;p&gt;Michael,&lt;/p&gt;

&lt;p&gt;I think you have put your finger on it. If you don&apos;t change the packages, don&apos;t change the gav. If you do change the packages, do change the gav.&lt;/p&gt;

&lt;p&gt;None of which is to claim that Maven isn&apos;t full of flaws in this whole area; it does not model the entire world of things people need to do.&lt;/p&gt;
</comment>
                            <comment id="13224791" author="thetaphi" created="Wed, 7 Mar 2012 22:28:38 +0000"  >&lt;p&gt;Committed trunk revision: 1298164&lt;br/&gt;
Backported 3.x revision: 1298169&lt;/p&gt;

&lt;p&gt;Steven Rowe: If I broke something with maven, can you please fix? I have no idea... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13224816" author="gstein" created="Wed, 7 Mar 2012 23:01:33 +0000"  >&lt;p&gt;Great work, Uwe. Thanks for stepping up help out the Apache Commons people!&lt;/p&gt;</comment>
                            <comment id="13224818" author="steve_rowe" created="Wed, 7 Mar 2012 23:07:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Steven Rowe: If I broke something with maven, can you please fix? I have no idea... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Only one problem: the name of the source file in the bootstrap profile (copies lib/ files to users&apos; local Maven repositories) - I just committed the file renaming to both trunk and branch_3x.&lt;/p&gt;</comment>
                            <comment id="13224822" author="scott_carey" created="Wed, 7 Mar 2012 23:12:23 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This is a maven issue. solr-commons-csv only exists to maven.&lt;/p&gt;

&lt;p&gt;Otherwise these are just classes inside the war file (essentially an implementation detail of solr).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The java classpath is not an implementation detail if you expect any of your jars to share a classloader with others.  At least not until project Jigsaw is complete and Solr is using Java 8 modules.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Yes of course. But e.g. maven can help to prevent those problems. It will not allow you to add the same dependency in different versions. The issue we had caused by our separate release of unreleased package under the solr group-id was that maven is seeing our repackaged dependency under another artifact id - so it cannot prevent that a project adds solr-commons-xx, version-foo and commony-xx, version-bar, because it is two different things.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Exactly.  If you publish a maven artifact under a custom groupId:artifactId the sane thing to do is make sure the classes don&apos;t overlap with the old one.  Maven guards against duplicate artifacts in the same classpath.  Otherwise users will implicitly get both copies on their classpath too easily.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The arguments that this is more than a maven issue are bogus.&lt;br/&gt;
Do you take me for a fool?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What happens if a non-maven user gets both solr-commons-csv.jar and commons-csv.jar on their classpath?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I think you missed my point?: Changing the Ant build to fix a Maven problem is a non-starter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Then specify it as &amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt; or &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;.  If you publish to maven central a pom.xml that says &quot;Solr must have jar FOO!&quot; and then complain that it is a &quot;Maven problem&quot; when jar FOO is actually used, then you&apos;ve used maven incorrectly.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Users would have to either have to a) download the binary release and manually install the non-Maven artifacts one-by-one in their local or internal repository (after consulting both the top-level Maven POM and a list of per-module dependencies that currently only exists in a lib/ directory listing); or b) download the source release, run ant get-maven-poms, then run mvn -N -Pbootstrap install. Neither of these fall within the expected level of effort for Maven users.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;or C)&lt;br/&gt;
you can publish the artifacts, link to them as optional, and users can specify in their pom&apos;s which jar to bring in.  This is not that uncommon &amp;#8211; it is the expected way to deal with slf4j for example, where one and only one of several options must be chosen at runtime.  Same thing with the bytecode re-writing dependency in Hibernate.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;-1 from me for using optional dependencies to counter Maven&apos;s virality.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please consider this further with option C) above for artifacts that live in a custom groupId:artifactId namespace but not a custom package.&lt;/p&gt;
</comment>
                            <comment id="13224906" author="steve_rowe" created="Thu, 8 Mar 2012 01:14:12 +0000"  >&lt;blockquote&gt;
&lt;p&gt;or C)&lt;br/&gt;
you can publish the artifacts, link to them as optional, and users can specify in their pom&apos;s which jar to bring in. This is not that uncommon &amp;#8211; it is the expected way to deal with slf4j for example, where one and only one of several options must be chosen at runtime. Same thing with the bytecode re-writing dependency in Hibernate.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;-1 from me for using optional dependencies to counter Maven&apos;s virality.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please consider this further with option C) above for artifacts that live in a custom groupId:artifactId namespace but not a custom package.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;My implicit assumption was that as a result of using optional dependencies, we would cease publishing any third-party dependencies to Maven Central.  (That&apos;s part of what I was -1&apos;ing.)&lt;/p&gt;</comment>
                            <comment id="13225150" author="mikemccand" created="Thu, 8 Mar 2012 11:32:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;If you don&apos;t change the packages, don&apos;t change the gav. If you do change the packages, do change the gav.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;And... I hate to heap even more invasiveness/virality onto Maven, but... it&lt;br/&gt;
seems like if Maven also checked across artifacts&lt;br/&gt;
(groupID+artifactID?) for package name conflicts... that would prevent&lt;br/&gt;
future cases of accidentally releasing a private dependency?  (Hmmm,&lt;br/&gt;
assuming commons-csv releases snapshots...).&lt;/p&gt;</comment>
                            <comment id="13225951" author="siren" created="Fri, 9 Mar 2012 09:04:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;I discovered this issue because someone who imported solr-commons-csv in its project reported an issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-31&quot; title=&quot;CSVParser hangs (goes into infinite loop) on getLine() if it&amp;#39;s a &amp;quot;comment&amp;quot; line that doesn&amp;#39;t contain a delimiter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CSV-31&quot;&gt;&lt;del&gt;SANDBOX-330&lt;/del&gt;&lt;/a&gt;), an infinite loop with trailing comments, that was already fixed on the trunk&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So is the current solr version affected by this? Should it be updated?&lt;/p&gt;</comment>
                            <comment id="13226046" author="ebourg" created="Fri, 9 Mar 2012 12:46:12 +0000"  >&lt;p&gt;No he used an old version of solr-commons-csv, I checked the commit log and the one used by Solr is fixed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12545576">SOLR-3213</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12517468" name="SOLR-3204.patch" size="34117" author="uschindler" created="Wed, 7 Mar 2012 21:50:12 +0000"/>
                            <attachment id="12517423" name="SOLR-3204.patch" size="32633" author="uschindler" created="Wed, 7 Mar 2012 17:08:38 +0000"/>
                            <attachment id="12517415" name="SOLR-3204.patch" size="28283" author="uschindler" created="Wed, 7 Mar 2012 16:33:49 +0000"/>
                            <attachment id="12517320" name="SOLR-3204.patch" size="1538" author="sarowe" created="Tue, 6 Mar 2012 22:19:04 +0000"/>
                            <attachment id="12517469" name="apache-solr-commons-csv-1.0-SNAPSHOT-r966014.jar" size="26027" author="uschindler" created="Wed, 7 Mar 2012 21:50:12 +0000"/>
                            <attachment id="12517424" name="apache-solr-commons-csv-1.0-SNAPSHOT-r966014.jar" size="28092" author="uschindler" created="Wed, 7 Mar 2012 17:08:38 +0000"/>
                            <attachment id="12517422" name="rule.txt" size="64" author="uschindler" created="Wed, 7 Mar 2012 17:08:38 +0000"/>
                            <attachment id="12517416" name="rule.txt" size="94" author="uschindler" created="Wed, 7 Mar 2012 16:33:49 +0000"/>
                            <attachment id="12517241" name="solr-csv.patch" size="73731" author="ebourg" created="Tue, 6 Mar 2012 14:40:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 37 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03g2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18038</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>