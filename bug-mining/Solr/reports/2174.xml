<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:59:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6085] Suggester crashes when prefixToken is longer than surface form</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6085</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;AnalyzingInfixSuggester class fails when is queried with a &#223; character (ezsett) used in German, but it doesn&apos;t happen for all data or for all words containing this character. The exception reported is the following: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;response&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;&amp;gt;
&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;500&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;&amp;gt;18&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;error&quot;&lt;/span&gt;&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;msg&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; index out of range: 5&amp;lt;/str&amp;gt;
&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt;&amp;gt;
java.lang.StringIndexOutOfBoundsException: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; index out of range: 5 at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.substring(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:1907) at org.apache.lucene.search.suggest.analyzing.AnalyzingInfixSuggester.addPrefixMatch(AnalyzingInfixSuggester.java:575) at org.apache.lucene.search.suggest.analyzing.AnalyzingInfixSuggester.highlight(AnalyzingInfixSuggester.java:525) at org.apache.lucene.search.suggest.analyzing.AnalyzingInfixSuggester.createResults(AnalyzingInfixSuggester.java:479) at org.apache.lucene.search.suggest.analyzing.AnalyzingInfixSuggester.lookup(AnalyzingInfixSuggester.java:437) at org.apache.lucene.search.suggest.analyzing.AnalyzingInfixSuggester.lookup(AnalyzingInfixSuggester.java:338) at org.apache.solr.spelling.suggest.SolrSuggester.getSuggestions(SolrSuggester.java:181) at org.apache.solr.handler.component.SuggestComponent.process(SuggestComponent.java:232) at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:217) at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135) at org.apache.solr.core.RequestHandlers$LazyRequestHandlerWrapper.handleRequest(RequestHandlers.java:241) at org.apache.solr.core.SolrCore.execute(SolrCore.java:1916) at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:780) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:427) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:217) at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419) at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:557) at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075) at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384) at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255) at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116) at org.eclipse.jetty.server.Server.handle(Server.java:368) at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:489) at org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(BlockingHttpConnection.java:53) at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:942) at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:1004) at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640) at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235) at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:72) at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:264) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608) at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&amp;lt;/str&amp;gt;
&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;code&quot;&lt;/span&gt;&amp;gt;500&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;/response&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With this query&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://localhost:8983/solr/suggest_de?suggest.q=gie&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/suggest_de?suggest.q=gie&lt;/a&gt;&#223;  (for gie&#223;en, which is actually in the data)&lt;/p&gt;

&lt;p&gt;The problem seems to be that we use ASCIIFolding to unify ss and &#223;, which are both valid alternatives in German. &lt;/p&gt;

&lt;p&gt;Looking at the code we found that string limits are not properly checked for the method involved in the exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void addPrefixMatch(StringBuilder sb, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; surface, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; analyzed, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; prefixToken) {
    &lt;span class=&quot;code-comment&quot;&gt;// TODO: apps can &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to invert their analysis logic
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// here, e.g. downcase the two before checking prefix:
&lt;/span&gt;    sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;b&amp;gt;&quot;&lt;/span&gt;);
    sb.append(surface.substring(0, prefixToken.length()));
    sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;/b&amp;gt;&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (prefixToken.length() &amp;lt; surface.length()) {
      sb.append(surface.substring(prefixToken.length()));
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For example, when surface is &quot;da&#223;&quot; and prefixToken is &quot;dass&quot;, surface.substring will fail.&lt;/p&gt;

&lt;p&gt;A possible solution would be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void addPrefixMatch(StringBuilder sb, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; surface, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; analyzed, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; prefixToken) {
    &lt;span class=&quot;code-comment&quot;&gt;// TODO: apps can &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to invert their analysis logic
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// here, e.g. downcase the two before checking prefix:
&lt;/span&gt;    sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;b&amp;gt;&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(prefixToken.length() &amp;gt; surface.length()){
      sb.append(surface);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
    {
      sb.append(surface.substring(0, prefixToken.length()));
    }
    sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;/b&amp;gt;&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (prefixToken.length() &amp;lt; surface.length()) {
      sb.append(surface.substring(prefixToken.length()));
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12714722">SOLR-6085</key>
            <summary>Suggester crashes when prefixToken is longer than surface form</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="jferrandez">Jorge Ferr&#225;ndez</reporter>
                        <labels>
                            <label>suggester</label>
                    </labels>
                <created>Fri, 16 May 2014 08:20:17 +0000</created>
                <updated>Mon, 9 May 2016 18:45:15 +0000</updated>
                            <resolved>Wed, 12 Nov 2014 08:47:50 +0000</resolved>
                                    <version>4.7.1</version>
                    <version>4.8</version>
                                    <fixVersion>4.7.3</fixVersion>
                    <fixVersion>4.10.3</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SearchComponents - other</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14186776" author="janhoy" created="Tue, 28 Oct 2014 12:56:06 +0000"  >&lt;p&gt;Hi, is this still an issue?&lt;/p&gt;

&lt;p&gt;Would you be able to write a patch with a failing JUnit test case and your proposed solution and attach to this issue? (&lt;a href=&quot;http://wiki.apache.org/solr/HowToContribute#Generating_a_patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/solr/HowToContribute#Generating_a_patch&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14201995" author="janhoy" created="Fri, 7 Nov 2014 12:36:38 +0000"  >&lt;p&gt;Attaching patch (trunk) with a testcase that provokes the bug and a simple fix.&lt;/p&gt;</comment>
                            <comment id="14202001" author="janhoy" created="Fri, 7 Nov 2014 12:41:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jferrandez&quot; class=&quot;user-hover&quot; rel=&quot;jferrandez&quot;&gt;jferrandez&lt;/a&gt; Can you test the patch in your environment?&lt;/p&gt;</comment>
                            <comment id="14202498" author="jferrandez" created="Fri, 7 Nov 2014 19:15:01 +0000"  >&lt;p&gt;Yes, sure. I will test it next week. I will post the results when I have them.&lt;/p&gt;

&lt;p&gt;Thank you very much for the patch. I apologize because I don&apos;t have much time to do it.&lt;/p&gt;</comment>
                            <comment id="14207807" author="jira-bot" created="Wed, 12 Nov 2014 08:25:33 +0000"  >&lt;p&gt;Commit 1638711 from janhoy@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1638711&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1638711&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6085&quot; title=&quot;Suggester crashes when prefixToken is longer than surface form&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6085&quot;&gt;&lt;del&gt;SOLR-6085&lt;/del&gt;&lt;/a&gt;: Suggester crashes when prefixToken is longer than surface form&lt;/p&gt;</comment>
                            <comment id="14207810" author="jira-bot" created="Wed, 12 Nov 2014 08:30:08 +0000"  >&lt;p&gt;Commit 1638712 from janhoy@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1638712&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1638712&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6085&quot; title=&quot;Suggester crashes when prefixToken is longer than surface form&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6085&quot;&gt;&lt;del&gt;SOLR-6085&lt;/del&gt;&lt;/a&gt;: Suggester crashes when prefixToken is longer than surface form (merge)&lt;/p&gt;</comment>
                            <comment id="14207814" author="jira-bot" created="Wed, 12 Nov 2014 08:38:33 +0000"  >&lt;p&gt;Commit 1638716 from janhoy@apache.org in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1638716&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1638716&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6085&quot; title=&quot;Suggester crashes when prefixToken is longer than surface form&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6085&quot;&gt;&lt;del&gt;SOLR-6085&lt;/del&gt;&lt;/a&gt;: Suggester crashes when prefixToken is longer than surface form (backport)&lt;/p&gt;</comment>
                            <comment id="14207823" author="janhoy" created="Wed, 12 Nov 2014 08:47:50 +0000"  >&lt;p&gt;Fixed, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jferrandez&quot; class=&quot;user-hover&quot; rel=&quot;jferrandez&quot;&gt;jferrandez&lt;/a&gt; you may now build the lucene_solr_4_10 branch if you like to test it&lt;/p&gt;</comment>
                            <comment id="14332738" author="anshumg" created="Mon, 23 Feb 2015 05:01:38 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12680150" name="SOLR-6085.patch" size="3333" author="janhoy" created="Fri, 7 Nov 2014 12:36:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393035</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1voj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393202</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>