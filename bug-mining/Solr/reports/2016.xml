<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:55:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6290] CollectionsAPIAsyncDistributedZkTest failure</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6290</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Found this failure on my local jenkins instance:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Error Message

CreateCollection task did not complete! expected:&amp;lt;[completed]&amp;gt; but was:&amp;lt;[running]&amp;gt;
Stacktrace

org.junit.ComparisonFailure: CreateCollection task did not complete! expected:&amp;lt;[completed]&amp;gt; but was:&amp;lt;[running]&amp;gt;
	at __randomizedtesting.SeedInfo.seed([D4EC4F9D698903B5:550AC1851ED66389]:0)
	at org.junit.Assert.assertEquals(Assert.java:125)
	at org.apache.solr.cloud.CollectionsAPIAsyncDistributedZkTest.testSolrJAPICalls(CollectionsAPIAsyncDistributedZkTest.java:75)
	at org.apache.solr.cloud.CollectionsAPIAsyncDistributedZkTest.doTest(CollectionsAPIAsyncDistributedZkTest.java:61)
	at org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:865)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12730253">SOLR-6290</key>
            <summary>CollectionsAPIAsyncDistributedZkTest failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jul 2014 16:57:49 +0000</created>
                <updated>Mon, 9 May 2016 18:58:45 +0000</updated>
                            <resolved>Mon, 28 Jul 2014 21:46:03 +0000</resolved>
                                                    <fixVersion>4.10</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14076388" author="shalinmangar" created="Mon, 28 Jul 2014 16:59:25 +0000"  >&lt;p&gt;There were a couple of calls which had timeout of 10 seconds and one with just 3 seconds. These were causing the failure. I bumped up the timeout to 5 minutes &amp;#8211; it won&apos;t ever take that long but we should wait for as long as possible.&lt;/p&gt;</comment>
                            <comment id="14076463" author="markrmiller@gmail.com" created="Mon, 28 Jul 2014 17:49:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;had timeout of 10 seconds and one with just 3 seconds.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I bumped up the timeout to 5 minutes &#8211; it won&apos;t ever take that long but we should wait for as long as possible.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t agree that we want to wait as long as possible. We still want tests to fail as fast as possible as well. It&apos;s a balancing act - we want to wait as long as is necessary not to get false fails and no more. I didn&apos;t dig into this, but if tests were usually passing with 3 and 10 seconds, it seems to make more sense to raise them to 2-5x that or something. Just making it huge is annoying when people have to debug these fails later when doing development.&lt;/p&gt;</comment>
                            <comment id="14076476" author="shalinmangar" created="Mon, 28 Jul 2014 17:58:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t agree that we want to wait as long as possible. We still want tests to fail as fast as possible as well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t buy that. Our tests should fail when there&apos;s actually a problem. Out of all the tests that I&apos;ve looked &amp;#8211; all except the SyncSliceTest were false negatives. That sort of flakiness doesn&apos;t buy us anything. I&apos;d rather have our tests take 30 minutes more and make us more confident than forcing us to ignore (sometimes real) failures just because they fail regularly on slow jenkins and we can&apos;t tell the difference easily.&lt;/p&gt;

&lt;p&gt;That being said, 5 minutes may be too much and we can make it something like a minute or so.&lt;/p&gt;</comment>
                            <comment id="14076487" author="markrmiller@gmail.com" created="Mon, 28 Jul 2014 18:01:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;we want to wait as long as is necessary not to get false fails and no more. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s a true statement for the reason I said. If the test won&apos;t fail at 30 seconds (and it seems it won&apos;t if it usually passed at 3 or 10 seconds), then making it 5 minutes is just painful for no gain. We could also make it an hour, and it would be &lt;b&gt;really&lt;/b&gt; painful. I&apos;ve spent a lot of time debugging SolrCloud tests, and making unnecessary huge timeouts is just mean to future devs.&lt;/p&gt;</comment>
                            <comment id="14076495" author="markrmiller@gmail.com" created="Mon, 28 Jul 2014 18:05:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;d rather have our tests take 30 minutes more &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;-1! That would really hurt development!&lt;/p&gt;</comment>
                            <comment id="14076596" author="shalinmangar" created="Mon, 28 Jul 2014 19:02:27 +0000"  >&lt;p&gt;You&apos;re getting very generous with vetoes these days.&lt;/p&gt;

&lt;p&gt;No, it won&apos;t hurt development because these tests take a long time only on slow boxes. You and I, and most people running on decent 2-3 year old machines will not face a problem.&lt;/p&gt;</comment>
                            <comment id="14076613" author="markrmiller@gmail.com" created="Mon, 28 Jul 2014 19:06:36 +0000"  >&lt;p&gt;A -1 is not normally a veto. It&apos;s simply an indication of direction. -1, -0, 0, +0, +1 all have somewhat defined meanings in general Apache discussion.&lt;/p&gt;

&lt;p&gt;A verto is a very specific -1 to a specific code change. It needs to be announced as an official veto and it needs to be supported by a valid technical reason.&lt;/p&gt;

&lt;p&gt;Someone just saying -1 is not a veto.&lt;/p&gt;</comment>
                            <comment id="14076620" author="markrmiller@gmail.com" created="Mon, 28 Jul 2014 19:07:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;You and I, and most people running on decent 2-3 year old machines will not face a problem.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We will face a problem. Longer timeouts do not make the tests longer. I don&apos;t think you are understanding me.&lt;/p&gt;

&lt;p&gt;When developers make future changes, it will often cause tests to fail. If those tests take 5 minutes to fail when they could take 30 seconds or even a minute, it&apos;s very painful. I&apos;ve experienced it. Even with my fast computer - in fact computer speed makes little to no difference in this case.&lt;/p&gt;</comment>
                            <comment id="14076626" author="dweiss" created="Mon, 28 Jul 2014 19:10:57 +0000"  >&lt;p&gt;&amp;gt; I&apos;d rather have our tests take 30 minutes more&lt;/p&gt;

&lt;p&gt;Oh, please no.&lt;/p&gt;

&lt;p&gt;I really appreciate the work you&apos;re doing, Shalin, but I agree with Mark &amp;#8211; many people have stopped running Solr tests at all because they take forever. Adding delays is just making it worse. I understand it&apos;s complex system interaction, lots of code, etc., but wall-time delays are really the worst way of waiting for a condition to happen... If there&apos;s any other way (a http ping request for status or something like this) then spin-looping this for 30 seconds without any progress is I think an indication of a real problem.&lt;/p&gt;</comment>
                            <comment id="14076632" author="markrmiller@gmail.com" created="Mon, 28 Jul 2014 19:12:15 +0000"  >&lt;p&gt;To clarify on my -1 comment, I&apos;ll translate:&lt;/p&gt;

&lt;p&gt;Shalin: I&apos;d rather have our tests take 30 minutes more&lt;/p&gt;

&lt;p&gt;Mark: I don&apos;t agree with that at all! That would really hurt development!&lt;/p&gt;</comment>
                            <comment id="14076635" author="shalinmangar" created="Mon, 28 Jul 2014 19:16:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;When developers make future changes, it will often cause tests to fail. If those tests take 5 minutes to fail when they could take 30 seconds or even a minute, it&apos;s very painful. I&apos;ve experienced it. Even with my fast computer - in fact computer speed makes little to no difference in this case.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I totally get that but I&apos;d rather have a test which fails late sometimes (when someone made a mistake and introduced a bug) than a test which gives up quickly and causes spurious failures often on our jenkins instance, the results of which are broadcasted to our whole dev community. We can agree to disagree.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If there&apos;s any other way (a http ping request for status or something like this) then spin-looping this for 30 seconds without any progress is I think an indication of a real problem.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This. That&apos;s exactly the problem here. We&apos;re not sleeping for 5 minutes. We are willing to wait for upto 5 minutes (we can tune it lower if it makes people happier) for an async task to succeed, invoking a ping status call every 1 second. Unfortunately, instead of going over the technical merits of the patch, we&apos;ve decided to have a philosophical discussion here. &lt;/p&gt;</comment>
                            <comment id="14076647" author="dweiss" created="Mon, 28 Jul 2014 19:22:43 +0000"  >&lt;p&gt;&amp;gt; We are willing to wait for upto 5 minutes (we can tune it lower if it makes people happier) for an async task to succeed, invoking a ping status call every 1 second.&lt;/p&gt;

&lt;p&gt;I think these are insane timeouts though, Shalin. I mean &amp;#8211; the tests never write tons of data; even on heavily loaded systems there should be some detectable progress (or a sensible, short-lived timeout after which you consider this a failure).&lt;/p&gt;

&lt;p&gt;FreeBSD jenkins and its failures are  a whole different subject. I don&apos;t think timeouts will help it, to be honest &amp;#8211; I had many concerns with respect to the openjdk port we&apos;re (forced) to use...&lt;/p&gt;</comment>
                            <comment id="14076652" author="markrmiller@gmail.com" created="Mon, 28 Jul 2014 19:25:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;we&apos;ve decided to have a philosophical discussion here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is not philosophical at all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; It&apos;s purely technical.&lt;/p&gt;

&lt;p&gt;You raised timeouts of 3 and 10 seconds to 5 minutes and declared essentially that we can&apos;t make these timeouts high enough. I&apos;m saying we sure as heck can!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I totally get that&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you totally got that, you wouldn&apos;t just assume 5 minutes is a good number and say that the timouts should just be super high.&lt;/p&gt;

&lt;p&gt;The chances that 2 minutes or 1 minutes or 30 seconds is better seems pretty likely. Why not make it an hour with your philosophy?&lt;/p&gt;

&lt;p&gt;If you are debugging, there is a big difference between 1 minutes and 2 minutes and 5 minutes.&lt;/p&gt;

&lt;p&gt;So you see, I&apos;m focusing on the very specific and technical timeout raise that you made. Your philosophy of &quot;the timeouts can&apos;t be high enough&quot; also concerns me, but what has my focus is that this issue indicates tests usually pass with timeouts of 3 and 10 seconds and you are raising them to 5 minutes and that seems overkill and comes with negative consequences that are pretty likely not necessary.&lt;/p&gt;

&lt;p&gt;It&apos;s pretty easy to spot these kinds of failures. It&apos;s way better to do a more sensible timeout, and if there is another fail, double it again or something. &lt;/p&gt;</comment>
                            <comment id="14076678" author="shalinmangar" created="Mon, 28 Jul 2014 19:41:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think these are insane timeouts though, Shalin. I mean &#8211; the tests never write tons of data; even on heavily loaded systems there should be some detectable progress (or a sensible, short-lived timeout after which you consider this a failure).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, perhaps I went overboard with the timeout. It can be set to a minute and that should avoid this particular failure. Some tasks such as split or migrate require more time e.g. I saw a simple shard split on an empty index not complete within 90 seconds and there was nothing in the logs which showed any problems.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The chances that 2 minutes or 1 minutes or 30 seconds is better seems pretty likely.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And I agreed with you and said that (twice): &quot;That being said, 5 minutes may be too much and we can make it something like a minute or so.&quot; and then again &quot;we can tune it lower if it makes people happier&quot;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why not make it an hour with your philosophy?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Because I am not insane.&lt;/p&gt;

&lt;p&gt;See, all the while, you&apos;ve been talking as if:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;I am actually increasing the time taken by our suite by 30 minutes&lt;/li&gt;
	&lt;li&gt;That increasing a timeout to 5 minutes here will actually slow the test for everyone by 5 minutes&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Both of the above are false. The problem I am trying to solve is that our test suite fails needlessly and often enough that many of us ignore failures on jenkins just because we can&apos;t make a distinction quickly enough. I think there are real benefits to solving that problem right now than an imagined problem which might manifest when you are debugging this particular test (when you can always change the timeout if you really think it is a problem).&lt;/p&gt;

&lt;p&gt;My quote &quot; it won&apos;t ever take that long but we should wait for as long as possible.&quot;  and &quot;I&apos;d rather have our tests take 30 minutes more&quot; have been twisted to mean something that I did not intend.&lt;/p&gt;</comment>
                            <comment id="14076907" author="shalinmangar" created="Mon, 28 Jul 2014 21:24:04 +0000"  >&lt;p&gt;I have toned down the maximum wait to 1 minute. I&apos;ll commit this shortly.&lt;/p&gt;</comment>
                            <comment id="14076927" author="shalinmangar" created="Mon, 28 Jul 2014 21:39:13 +0000"  >&lt;p&gt;Here&apos;s an updated patch which makes the test faster by:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The default collection shard count was fixed at 2 slices and 4 shards but the test doesn&apos;t really use the default collection at all. I set slice and shard count to 1&lt;/li&gt;
	&lt;li&gt;The &apos;testasynccollectioncreation&apos; collection was created with 2 shards but 1 shard is enough to test this functionality.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I increased the timeout for the splitshard call to 2 minutes because I have seen shard splits take longer than 90 seconds on jenkins.&lt;/p&gt;</comment>
                            <comment id="14076935" author="jira-bot" created="Mon, 28 Jul 2014 21:43:10 +0000"  >&lt;p&gt;Commit 1614194 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1614194&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1614194&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6290&quot; title=&quot;CollectionsAPIAsyncDistributedZkTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6290&quot;&gt;&lt;del&gt;SOLR-6290&lt;/del&gt;&lt;/a&gt;: Harden and speed up CollectionsAPIAsyncDistributedZkTest&lt;/p&gt;</comment>
                            <comment id="14076942" author="jira-bot" created="Mon, 28 Jul 2014 21:45:00 +0000"  >&lt;p&gt;Commit 1614195 from shalin@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1614195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1614195&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6290&quot; title=&quot;CollectionsAPIAsyncDistributedZkTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6290&quot;&gt;&lt;del&gt;SOLR-6290&lt;/del&gt;&lt;/a&gt;: Harden and speed up CollectionsAPIAsyncDistributedZkTest&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12658261" name="SOLR-6290.patch" size="2712" author="shalin" created="Mon, 28 Jul 2014 21:39:13 +0000"/>
                            <attachment id="12658254" name="SOLR-6290.patch" size="2144" author="shalin" created="Mon, 28 Jul 2014 21:24:04 +0000"/>
                            <attachment id="12658173" name="SOLR-6290.patch" size="2108" author="shalin" created="Mon, 28 Jul 2014 16:59:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408326</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y9ef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408330</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>