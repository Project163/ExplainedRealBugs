<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:29:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11503] Collections created with legacyCloud=true cannot be opened if legacyCloud=false</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11503</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11122&quot; title=&quot;Creating a core should write a core.properties file first and clean up on failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11122&quot;&gt;&lt;del&gt;SOLR-11122&lt;/del&gt;&lt;/a&gt; introduced a bug starting with 6.6.1 that means if you create a collection with legacyCloud=true then switch to legacyCloud=false, you get an NPE because coreNodeName is not defined in core.properties.&lt;/p&gt;

&lt;p&gt;Since the default for legacyCloud changed from true to false between 6.6.1 and 7.x, this means that any attempt to upgrade Solr with existing collections &lt;b&gt;created with Solr 6.6.1 or 6.6.2 will fail&lt;/b&gt; if the default value for legacyCloud is used in both. Collections created with 6.6.0 would work. Collections created in 6.6.1 or 6.6.2 with legacyCloud=false will work.&lt;/p&gt;

&lt;p&gt;This is not as egregious with any collections &lt;b&gt;created with 7.0&lt;/b&gt; since if the default legacyCloud=false is present when the core is created, properties are persisted with coreNodeName. However, if someone switches legacyCloud to true, then creates a collection, then changes legacyCloud back to false then they&apos;ll hit this even in 7.0+&lt;/p&gt;

&lt;p&gt;This happened because bit of reordering switched the order of the calls below. coreNodeName is added to the descriptor in create/createFromDescriptor(this, cd) via zkContgroller.preRegister so coresLocator.create(this, cd) persists core.properties without coreNodeName.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;original order&lt;/em&gt;&lt;br/&gt;
SolrCore core = createFromDescriptor(cd, true, newCollection);&lt;br/&gt;
coresLocator.create(this, cd);&lt;/p&gt;

&lt;p&gt;(NOTE: private calls to create were renamed to createFromDescriptor in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11122&quot; title=&quot;Creating a core should write a core.properties file first and clean up on failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11122&quot;&gt;&lt;del&gt;SOLR-11122&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;ve got a fix in the works for creating cores, I&apos;ll attach a preliminary patch w/o tests in a bit for discussion, but the question is really what to do about 6.6.1 and 6.6.2 and 7.1 for that matter. &lt;/p&gt;

&lt;p&gt;This is compounded by the fact that with the CVE, there&apos;s strong incentive to move to 6.6.2. siiiigh.&lt;/p&gt;

&lt;p&gt;There are two parts to fixing this completely:&lt;br/&gt;
1&amp;gt; create core.properties correctly&lt;br/&gt;
2&amp;gt; deal with coreNodeName not being in the core.properties file by going to ZK and getting it (and persisting it). Haven&apos;t worked that part out yet though, not in the first patch. Note one point here if it works as I hope it will update the core.properties files first time they&apos;re opened.&lt;/p&gt;


&lt;p&gt;Options that I see, there are really two parts:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;part1 create the core.properties correctly&lt;/b&gt;&lt;br/&gt;
&amp;gt; Release 6.6.3, and/or 7.1.1 with this fix. This still leaves 7.0 a problem.&lt;br/&gt;
&amp;gt; Recommend people not install 7x over collections created with 6x until they have a version with fixes (7.1.1? 7.2?). Switching legacyCloud values and creating collections is at your own risk.&lt;br/&gt;
&amp;gt; Recommend that people change legacyCloud=true in 7.x until they start working with a fixed version, which one TBD.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;part2 deal with coreNodeName not being in the core.properties&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; Not backport and release with 7.2? set legacyCloud=true until then.&lt;br/&gt;
&amp;gt; Backport to point releases like 7.1.1? 6.6.3?&lt;br/&gt;
&amp;gt; and what about 7.0? I don&apos;t think many people will be affected by 7.0 since 7.1 came out so soon after. And setting legacyCloud=true will let people get by.&lt;/p&gt;

&lt;p&gt;Fixing the two parts is not a question, they both need to be fixed. The real question is whether we need to create a point release that incorporates one or both or whether saying &quot;you must set legacyCloud=true prior to Solr version 7.# in order to work with any collections created with Solr versions 6.6.1 through 7.#&quot;.&lt;/p&gt;

&lt;p&gt;Let&apos;s hear opinions......&lt;/p&gt;</description>
                <environment></environment>
        <key id="13110110">SOLR-11503</key>
            <summary>Collections created with legacyCloud=true cannot be opened if legacyCloud=false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Oct 2017 20:10:42 +0000</created>
                <updated>Mon, 27 Jul 2020 12:09:48 +0000</updated>
                            <resolved>Sat, 4 Nov 2017 03:06:14 +0000</resolved>
                                    <version>6.6.1</version>
                                    <fixVersion>6.6.3</fixVersion>
                    <fixVersion>7.2</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16208311" author="erickerickson" created="Tue, 17 Oct 2017 20:48:47 +0000"  >&lt;p&gt;This isn&apos;t ideal in that it writes the core.properties file twice. That said, it&apos;s only when creating the core which is only done when you have a CREATE_OP core command so it&apos;s only done once over the lifetime of the replica.&lt;/p&gt;

&lt;p&gt;I&apos;m a little afraid to call ZkController().preRegister differently than it is now, or extract the guts of it, I&apos;ll look some more though. This seems like the minimally-risky change.&lt;/p&gt;

&lt;p&gt;I suppose we could call ZkController.preRegister core before calling createFromDescriptor everywhere (including before calling coresLocator.create), but then next time somebody needed to rearrange things they could forget to call preRegister.&lt;/p&gt;

&lt;p&gt;Still to come:&lt;br/&gt;
1&amp;gt; tests&lt;br/&gt;
2&amp;gt; dealing with coreNodeName not being in the properties file and legacyCloud=false.&lt;/p&gt;</comment>
                            <comment id="16208809" author="erickerickson" created="Wed, 18 Oct 2017 04:53:56 +0000"  >&lt;p&gt;Patch that has tests and implements both fixes.&lt;/p&gt;

&lt;p&gt;Work in progress. It&apos;s kind of late and I&apos;ll need to look at it with fresh eyes, comments welcome.&lt;/p&gt;

&lt;p&gt;Curiously, the test (without the fixes) succeeds on master, apparently that code has changed a bit. So I&apos;m developing against 7x.&lt;/p&gt;</comment>
                            <comment id="16208831" author="erickerickson" created="Wed, 18 Oct 2017 05:28:44 +0000"  >&lt;p&gt;And, of course looking &quot;just one more time before going to sleep&quot; surfaced a problem, fixed.&lt;/p&gt;</comment>
                            <comment id="16236888" author="erickerickson" created="Fri, 3 Nov 2017 00:46:23 +0000"  >&lt;p&gt;Since there are no objections I&apos;ll commit this tomorrow. I&apos;ll remove the nocommit (just verified that the error still occurs if I comment the fixes out), and I&apos;ll add a CHANGES.txt before putting up the final patch. Final patch will have no code changes, just comment changes.&lt;/p&gt;</comment>
                            <comment id="16238722" author="erickerickson" created="Sat, 4 Nov 2017 02:46:59 +0000"  >&lt;p&gt;Final patch with CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16238723" author="jira-bot" created="Sat, 4 Nov 2017 02:47:17 +0000"  >&lt;p&gt;Commit d501ecd2d1d7e25a73e9cf475d8b8db525d5d42e in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d501ecd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d501ecd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11503&quot; title=&quot;Collections created with legacyCloud=true cannot be opened if legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11503&quot;&gt;&lt;del&gt;SOLR-11503&lt;/del&gt;&lt;/a&gt;: Collections created with legacyCloud=true cannot be opened if legacyCloud=false&lt;/p&gt;</comment>
                            <comment id="16238729" author="jira-bot" created="Sat, 4 Nov 2017 03:05:43 +0000"  >&lt;p&gt;Commit 192204c29219e65ba5d240118de135bf28e726af in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=192204c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=192204c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11503&quot; title=&quot;Collections created with legacyCloud=true cannot be opened if legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11503&quot;&gt;&lt;del&gt;SOLR-11503&lt;/del&gt;&lt;/a&gt;: Collections created with legacyCloud=true cannot be opened if legacyCloud=false&lt;/p&gt;

&lt;p&gt;(cherry picked from commit d501ecd)&lt;/p&gt;</comment>
                            <comment id="16382723" author="jira-bot" created="Thu, 1 Mar 2018 22:00:19 +0000"  >&lt;p&gt;Commit b4e33a038569f97752abd61a26e8af0b652e5b44 in lucene-solr&apos;s branch refs/heads/branch_6_6 from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4e33a0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4e33a0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11503&quot; title=&quot;Collections created with legacyCloud=true cannot be opened if legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11503&quot;&gt;&lt;del&gt;SOLR-11503&lt;/del&gt;&lt;/a&gt;: Collections created with legacyCloud=true cannot be opened if legacyCloud=false&lt;/p&gt;</comment>
                            <comment id="16383053" author="jira-bot" created="Fri, 2 Mar 2018 02:41:19 +0000"  >&lt;p&gt;Commit bad96329a39855ebc5ecbcea5897c53ece18f46b in lucene-solr&apos;s branch refs/heads/branch_6_6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bad9632&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bad9632&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11503&quot; title=&quot;Collections created with legacyCloud=true cannot be opened if legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11503&quot;&gt;&lt;del&gt;SOLR-11503&lt;/del&gt;&lt;/a&gt;: add missing import&lt;/p&gt;</comment>
                            <comment id="16383061" author="steve_rowe" created="Fri, 2 Mar 2018 02:46:00 +0000"  >&lt;p&gt;On the branch_6_6 backport I fixed a missing import in CoreContainer.java.&lt;/p&gt;

&lt;p&gt;There is a reproducing failure a local test run turned up:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=LegacyCloudClusterPropTest -Dtests.method=testCreateCollectionSwitchLegacyCloud -Dtests.seed=3E3D3F067ED986BE -Dtests.slow=true -Dtests.locale=zh-SG -Dtests.timezone=America/Rio_Branco -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 3.60s | LegacyCloudClusterPropTest.testCreateCollectionSwitchLegacyCloud &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: Should have found property replicaType in properties file
   [junit4]    &amp;gt;        at __randomizedtesting.SeedInfo.seed([3E3D3F067ED986BE:EF3ACD83DAD60D8C]:0)
   [junit4]    &amp;gt;        at org.apache.solr.cloud.LegacyCloudClusterPropTest.checkMandatoryProps(LegacyCloudClusterPropTest.java:158)
   [junit4]    &amp;gt;        at org.apache.solr.cloud.LegacyCloudClusterPropTest.createAndTest(LegacyCloudClusterPropTest.java:90)
   [junit4]    &amp;gt;        at org.apache.solr.cloud.LegacyCloudClusterPropTest.testCreateCollectionSwitchLegacyCloud(LegacyCloudClusterPropTest.java:69)
   [junit4]    &amp;gt;        at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;, does this ring a bell?&lt;/p&gt;</comment>
                            <comment id="16383790" author="jira-bot" created="Fri, 2 Mar 2018 16:40:05 +0000"  >&lt;p&gt;Commit 2d0c3e1f9b5c03f024b9d3b1d86eac8b85dc7fe4 in lucene-solr&apos;s branch refs/heads/branch_6_6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2d0c3e1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2d0c3e1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11503&quot; title=&quot;Collections created with legacyCloud=true cannot be opened if legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11503&quot;&gt;&lt;del&gt;SOLR-11503&lt;/del&gt;&lt;/a&gt;: remove &apos;replicaType&apos; from required properties list in LegacyCloudClusterPropTest (not applicable prior to Solr 7.0)&lt;/p&gt;</comment>
                            <comment id="16383964" author="jira-bot" created="Fri, 2 Mar 2018 18:47:01 +0000"  >&lt;p&gt;Commit d1e9bbd333ea55cfa0c75d324424606e857a775b in lucene-solr&apos;s branch refs/heads/branch_6_6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d1e9bbd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d1e9bbd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11503&quot; title=&quot;Collections created with legacyCloud=true cannot be opened if legacyCloud=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11503&quot;&gt;&lt;del&gt;SOLR-11503&lt;/del&gt;&lt;/a&gt;: In ZkController.waitForCoreNodeName(), persist core.properties after setting the coreNodeName&lt;/p&gt;</comment>
                            <comment id="16389699" author="steve_rowe" created="Wed, 7 Mar 2018 15:35:39 +0000"  >&lt;p&gt;Closing for 6.6.3 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13319534">SOLR-14682</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12896023" name="SOLR-11503.patch" size="11746" author="erickerickson" created="Sat, 4 Nov 2017 02:46:45 +0000"/>
                            <attachment id="12892738" name="SOLR-11503.patch" size="10849" author="erickerickson" created="Wed, 18 Oct 2017 05:28:42 +0000"/>
                            <attachment id="12892736" name="SOLR-11503.patch" size="9469" author="erickerickson" created="Wed, 18 Oct 2017 04:52:55 +0000"/>
                            <attachment id="12892682" name="SOLR-11503.patch" size="655" author="erickerickson" created="Tue, 17 Oct 2017 20:33:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ldo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>