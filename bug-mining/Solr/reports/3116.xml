<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:16:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9504] A replica with an empty index becomes the leader even when other more qualified replicas are in line</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9504</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I haven&apos;t tried branch_6x or any release yet. But this is trivially reproducible on master with the following steps:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Start two solr nodes&lt;/li&gt;
	&lt;li&gt;Create a collection with 1 shard, 1 replica so that one node is empty.&lt;/li&gt;
	&lt;li&gt;Index some documents&lt;/li&gt;
	&lt;li&gt;Shutdown the leader node&lt;/li&gt;
	&lt;li&gt;Use addreplica API to create a replica of the collection on the still-running node. For some reason this API hangs until you restart the other node (possibly a bug itself) but do not wait for the API to complete.&lt;/li&gt;
	&lt;li&gt;Restart the former leader node&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;You&apos;ll find that the replica with 0 docs has become the leader. The former leader recovers from the leader without replicating any index files. It still has the old index which has some docs.&lt;/p&gt;

&lt;p&gt;This is from the logs of the 0 doc replica:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;713102 INFO  (zkCallback-4-thread-5-processing-n:127.0.1.1:7574_solr) [   ] o.a.s.c.c.ZkStateReader Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [gettingstarted] from [9] to [10]
714377 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.c.ShardLeaderElectionContext Enough replicas found to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;.
714377 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.c.ShardLeaderElectionContext I may be the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; leader - &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and sync
714377 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.c.SyncStrategy Sync replicas to http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.1.1:7574/solr/gettingstarted_shard1_replica2/
&lt;/span&gt;714380 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.u.PeerSync PeerSync: core=gettingstarted_shard1_replica2 url=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.1.1:7574/solr START replicas=[http://127.0.1.1:8983/solr/gettingstarted_shard1_replica1/] nUpdates=100
&lt;/span&gt;714381 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.u.PeerSync PeerSync: core=gettingstarted_shard1_replica2 url=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.1.1:7574/solr DONE.  We have no versions.  sync failed.
&lt;/span&gt;714382 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.c.SyncStrategy Leader&apos;s attempt to sync with shard failed, moving to the next candidate
714382 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.c.ShardLeaderElectionContext We failed sync, but we have no versions - we can&apos;t sync in that &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; - we were active before, so become leader anyway
714387 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.c.ShardLeaderElectionContextBase Creating leader registration node /collections/gettingstarted/leaders/shard1/leader after winning as /collections/gettingstarted/leader_elect/shard1/election/96579592334475268-core_node2-n_0000000001
714398 INFO  (qtp110456297-15) [c:gettingstarted s:shard1 r:core_node2 x:gettingstarted_shard1_replica2] o.a.s.c.ShardLeaderElectionContext I am the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; leader: http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.1.1:7574/solr/gettingstarted_shard1_replica2/ shard1&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It basically tries to sync but has no versions and because it was active before (it is a new core starting up for the first time), it becomes the leader and publishes itself as active.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13004408">SOLR-9504</key>
            <summary>A replica with an empty index becomes the leader even when other more qualified replicas are in line</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                            <label>impact-high</label>
                    </labels>
                <created>Mon, 12 Sep 2016 19:46:05 +0000</created>
                <updated>Wed, 2 Oct 2019 17:23:18 +0000</updated>
                            <resolved>Thu, 29 Sep 2016 11:55:58 +0000</resolved>
                                    <version>7.0</version>
                                    <fixVersion>6.3</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15485100" author="shalinmangar" created="Mon, 12 Sep 2016 19:51:38 +0000"  >&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15491513" author="markrmiller@gmail.com" created="Wed, 14 Sep 2016 21:36:05 +0000"  >&lt;p&gt;I think this one is known. There is another jira issue around this as well somewhere and it was understood as an ugly limitation when another bug around this was fixed. I had meant to add something to peer sync or something that let you check if another replica looked better because it wasn&apos;t empty or something, but never got to it. &lt;/p&gt;</comment>
                            <comment id="15491668" author="shalinmangar" created="Wed, 14 Sep 2016 22:53:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; - The behavior when leader vote wait expires is well known but for it to happen before expiry of that period is a surprise (at least to me). Perhaps instead of just giving up if the leader candidate have no version, it can request versions anyway from peers and rejoin if others have some versions?&lt;/p&gt;</comment>
                            <comment id="15491672" author="shalinmangar" created="Wed, 14 Sep 2016 22:54:27 +0000"  >&lt;p&gt;Whoops! You wrote the same thing that I did. I&apos;ll work on adding such a check to peer sync.&lt;/p&gt;</comment>
                            <comment id="15491676" author="shalinmangar" created="Wed, 14 Sep 2016 22:55:37 +0000"  >&lt;p&gt;Longer term, we need to work on a bi-directional sync during recovery to really solve these kind of issues.&lt;/p&gt;</comment>
                            <comment id="15524172" author="shalinmangar" created="Mon, 26 Sep 2016 21:07:51 +0000"  >&lt;p&gt;Patch with a test that fails without the fix.&lt;/p&gt;

&lt;p&gt;Basically, when we need to bail out because we have no versions, we peek at the other replicas. If even one has versions, then we return this bit of information to the ShardLeaderElectionContext.runLeaderProcess and rejoin the election, else we proceed as before. The hacky bit is that there is now a PeerSyncResult class which has a success flag as well as an optional otherHasVersions flag.&lt;/p&gt;

&lt;p&gt;I&apos;m going to run some tests in a loop to ensure I haven&apos;t broken anything.&lt;/p&gt;</comment>
                            <comment id="15532552" author="jira-bot" created="Thu, 29 Sep 2016 11:41:47 +0000"  >&lt;p&gt;Commit ce24de5cd65726dd9593512ec4082ba81b9d7801 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ce24de5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ce24de5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9504&quot; title=&quot;A replica with an empty index becomes the leader even when other more qualified replicas are in line&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9504&quot;&gt;&lt;del&gt;SOLR-9504&lt;/del&gt;&lt;/a&gt;: A replica with an empty index becomes the leader even when other more qualified replicas are in line&lt;/p&gt;</comment>
                            <comment id="15532574" author="jira-bot" created="Thu, 29 Sep 2016 11:53:04 +0000"  >&lt;p&gt;Commit effd22457691420982534f47ee71cd52ef64b8b9 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=effd224&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=effd224&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9504&quot; title=&quot;A replica with an empty index becomes the leader even when other more qualified replicas are in line&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9504&quot;&gt;&lt;del&gt;SOLR-9504&lt;/del&gt;&lt;/a&gt;: A replica with an empty index becomes the leader even when other more qualified replicas are in line&lt;/p&gt;

&lt;p&gt;(cherry picked from commit ce24de5)&lt;/p&gt;</comment>
                            <comment id="15650237" author="shalinmangar" created="Wed, 9 Nov 2016 08:37:31 +0000"  >&lt;p&gt;Closing after 6.3.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12830401" name="SOLR-9504.patch" size="19043" author="shalin" created="Mon, 26 Sep 2016 21:07:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33jd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>