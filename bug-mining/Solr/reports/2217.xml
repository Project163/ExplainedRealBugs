<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:59:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6864] Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6864</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I&apos;m marking this Jira as Bug because we already have components that do this (SuggestComponent and SpellcheckComponent), however, listeners registered at this stage not always work.&lt;br/&gt;
From &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6845?focusedCommentId=14250350&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14250350&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-6845?focusedCommentId=14250350&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14250350&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Trying to add some unit tests to this feature I found another issue. SuggestComponent and SpellcheckComponent rely on a &lt;tt&gt;firstSearcherListener&lt;/tt&gt; to load (and in this case, also build) some structures. These firstSearcherListeners are registered on &lt;tt&gt;SolrCoreAware.inform()&lt;/tt&gt;, however the first searcher listener task is only added to the queue of warming tasks if there is at least one listener registered at the time of the first searcher creation (before SolrCoreAware.inform() is ever called). See &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;SolrCore.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (currSearcher == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; firstSearcherListeners.size() &amp;gt; 0) {
          &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = searcherExecutor.submit(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Callable() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; call() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
              &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (SolrEventListener listener : firstSearcherListeners) {
                  listener.newSearcher(newSearcher, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
                }
              } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
                SolrException.log(log, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, e);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Error) {
                  &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; (Error) e;
                }
              }
              &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            }
          });
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;ll create a new Jira for this&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12762430">SOLR-6864</key>
            <summary>Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="tflobbe">Tomas Eduardo Fernandez Lobbe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Dec 2014 23:52:50 +0000</created>
                <updated>Wed, 2 Oct 2019 17:30:35 +0000</updated>
                            <resolved>Mon, 2 Mar 2015 06:41:36 +0000</resolved>
                                    <version>5.0</version>
                    <version>6.0</version>
                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14252536" author="jira-bot" created="Thu, 18 Dec 2014 23:24:31 +0000"  >&lt;p&gt;Commit 1646577 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1646577&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1646577&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6864&quot; title=&quot;Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6864&quot;&gt;&lt;del&gt;SOLR-6864&lt;/del&gt;&lt;/a&gt;: Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method&lt;/p&gt;</comment>
                            <comment id="14252550" author="jira-bot" created="Thu, 18 Dec 2014 23:37:41 +0000"  >&lt;p&gt;Commit 1646581 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1646581&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1646581&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6864&quot; title=&quot;Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6864&quot;&gt;&lt;del&gt;SOLR-6864&lt;/del&gt;&lt;/a&gt;: Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method&lt;/p&gt;</comment>
                            <comment id="14254386" author="hossman" created="Sat, 20 Dec 2014 00:56:34 +0000"  >&lt;p&gt;i&apos;&apos;ve got a seed here that causes the newly added test to fail 100% of the time on trunk...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestIndexSearcher -Dtests.method=testSearcherListeners -Dtests.seed=72D3132D566B9448 -Dtests.slow=true -Dtests.locale=es_PR -Dtests.timezone=America/Blanc-Sablon -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 0.86s | TestIndexSearcher.testSearcherListeners &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([72D3132D566B9448:DB7AC2090729EE8C]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestIndexSearcher.createCoreAndValidateListeners(TestIndexSearcher.java:219)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestIndexSearcher.testSearcherListeners(TestIndexSearcher.java:194)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14254459" author="tomasflobbe" created="Sat, 20 Dec 2014 02:05:33 +0000"  >&lt;p&gt;I&apos;ll take a look&lt;/p&gt;</comment>
                            <comment id="14254499" author="tomasflobbe" created="Sat, 20 Dec 2014 03:51:55 +0000"  >&lt;p&gt;I think this is not a seed issue, it&apos;s a race condition. It never failed on my mac after hundreds of iterations, It did (with this seed and others) fail in other hosts where I ran the tests. &lt;br/&gt;
Adding some sleep time in the mock listeners I can reproduce it on my mac. I&apos;ll commit a fix shortly&lt;/p&gt;</comment>
                            <comment id="14254542" author="tomasflobbe" created="Sat, 20 Dec 2014 06:14:46 +0000"  >&lt;p&gt;Here is my fix. I ran the test 600 times in three different hosts and all passed&lt;/p&gt;</comment>
                            <comment id="14254543" author="jira-bot" created="Sat, 20 Dec 2014 06:18:40 +0000"  >&lt;p&gt;Commit 1646918 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1646918&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1646918&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6864&quot; title=&quot;Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6864&quot;&gt;&lt;del&gt;SOLR-6864&lt;/del&gt;&lt;/a&gt;: Fix test race condition, make test wait for warming in TestIndexSearcher&lt;/p&gt;</comment>
                            <comment id="14254544" author="jira-bot" created="Sat, 20 Dec 2014 06:19:52 +0000"  >&lt;p&gt;Commit 1646919 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1646919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1646919&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6864&quot; title=&quot;Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6864&quot;&gt;&lt;del&gt;SOLR-6864&lt;/del&gt;&lt;/a&gt;: Fix test race condition, make test wait for warming in TestIndexSearcher&lt;/p&gt;</comment>
                            <comment id="14257906" author="tomasflobbe" created="Wed, 24 Dec 2014 03:29:07 +0000"  >&lt;p&gt;There were no failures since the last commit. While looking at these failures I also added unit tests for useColdSearcher that I think can be part of this Jira. Attaching patch&lt;/p&gt;</comment>
                            <comment id="14258492" author="jira-bot" created="Wed, 24 Dec 2014 19:51:53 +0000"  >&lt;p&gt;Commit 1647836 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1647836&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1647836&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6864&quot; title=&quot;Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6864&quot;&gt;&lt;del&gt;SOLR-6864&lt;/del&gt;&lt;/a&gt;: Improved tests, added useColdSearcher test case&lt;/p&gt;</comment>
                            <comment id="14258493" author="jira-bot" created="Wed, 24 Dec 2014 19:55:09 +0000"  >&lt;p&gt;Commit 1647837 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1647837&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1647837&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6864&quot; title=&quot;Support registering searcher listeners in SolrCoreAware.inform(SolrCore) method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6864&quot;&gt;&lt;del&gt;SOLR-6864&lt;/del&gt;&lt;/a&gt;: Improved tests, added useColdSearcher test case&lt;/p&gt;</comment>
                            <comment id="14332908" author="anshumg" created="Mon, 23 Feb 2015 05:02:33 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                            <comment id="14341242" author="erickerickson" created="Sat, 28 Feb 2015 02:35:52 +0000"  >&lt;p&gt;re-opening for inclusion in 4.10.5&lt;/p&gt;</comment>
                            <comment id="14342838" author="erickerickson" created="Mon, 2 Mar 2015 06:41:36 +0000"  >&lt;p&gt;Decided not to back-port to 4.10.5, it was more complex than I thought.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12688981" name="SOLR-6864-tests.patch" size="10446" author="tflobbe" created="Wed, 24 Dec 2014 03:29:07 +0000"/>
                            <attachment id="12687869" name="SOLR-6864.patch" size="9325" author="tflobbe" created="Wed, 17 Dec 2014 23:56:00 +0000"/>
                            <attachment id="12688499" name="fix.patch" size="2864" author="tflobbe" created="Sat, 20 Dec 2014 06:14:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23ju7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>