<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:45:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14653] Replace usages of org.apache.hadoop.fs.Path that are used to construct Zookeeper paths</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14653</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13939&quot; title=&quot;Extract any non-gradle related patches (deprecations, URL fixes, etc.) from gradle effort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13939&quot;&gt;&lt;del&gt;SOLR-13939&lt;/del&gt;&lt;/a&gt;. We construct Zookeeper paths at least in ShardLeaderElectionContextBase.java by using methods in org.apache.hadoop.fs.Path e.g. &quot;String parent = new Path(leaderPath).getParent().toString()&quot;. This works because&#160; the Hadoop method uses forward slashes even on Windows machines.&lt;/p&gt;

&lt;p&gt;If those calls are changed to use nio Paths.get or similar, we can&apos;t run on Windows. Relying on hdfs classes to construct these paths in code unrelated to HDFS is suspicious at best.&lt;/p&gt;

&lt;p&gt;We should examine all inclusions of org.apache.hadoop.fs.Path and replace them with something else. Uwe suggests java.net.URI as one possibility.&lt;/p&gt;

&lt;p&gt;We should check to see what Zookeeper provides.&lt;/p&gt;

&lt;p&gt;There are 5 files that import org.apache.hadoop... that do &lt;em&gt;not&lt;/em&gt; have HDFS in their name, and 4 of those are probably legitimate (SolrSnapshotsTool for instance) so checking all of them won&apos;t take long.&lt;/p&gt;

&lt;p&gt;From Uwe&apos;s comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13939&quot; title=&quot;Extract any non-gradle related patches (deprecations, URL fixes, etc.) from gradle effort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13939&quot;&gt;&lt;del&gt;SOLR-13939&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&quot;Hi,&lt;br/&gt;
 Windows is happy again. So your fix helped. I responded to mailing list, here again:&lt;/p&gt;

&lt;p&gt;In Zookeeper all paths are forward slashes (as it is a &quot;path&quot; inside the zookeeper environment). If you replace that with a NIO Windows Path it creates backslashes. This makes Zookeeper fail (of course).&lt;/p&gt;

&lt;p&gt;Actually using the Hadoop class is broken workaround, it may be better to use the more abstract java.net.URI class for correct &quot;path&quot; transformations. The risk with java.nio.file.Path is also that if the path exists in file system it handles the resolving different. So if some user has for some reason a local path exactly looking like a zookeper node path it would use different behaviour.&lt;/p&gt;

&lt;p&gt;So my suggestion: Use java.net.URI to build the path and use URI.getPath() or similar to make a String out of it. The alternative to replace all backslashes in the path to forwards slashes is a bad idea for the reasons I explained before.&lt;/p&gt;

&lt;p&gt;Now we should replace the hadoop class IMHO by java.net.URI.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="13317164">SOLR-14653</key>
            <summary>Replace usages of org.apache.hadoop.fs.Path that are used to construct Zookeeper paths</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Jul 2020 12:52:55 +0000</created>
                <updated>Wed, 4 Nov 2020 15:22:28 +0000</updated>
                            <resolved>Fri, 17 Jul 2020 20:24:43 +0000</resolved>
                                                    <fixVersion>8.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17159325" author="thetaphi" created="Thu, 16 Jul 2020 16:04:42 +0000"  >&lt;p&gt;Thanks for opening this issue! Indeed we should try to use path-modifying methods coming from zookeeper client library directly. Maybe they were added since Mark Miller implemented this back in time.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;java.net.URI&lt;/tt&gt; would be my fallback, the above example with leaderPath could be written as (untested):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; parent = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, leaderPath, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).resolve(&lt;span class=&quot;code-quote&quot;&gt;&quot;..&quot;&lt;/span&gt;).getPath();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17159595" author="erickerickson" created="Fri, 17 Jul 2020 01:44:58 +0000"  >&lt;p&gt;After looking this over, I decided to just go with some simple string manipulation in a utility class. ZK paths have nothing really to do with URIs, Files, Paths, etc. they&apos;re just simple strings with no sensitivity to the file system etc. I toyed a bit with a utility method that would take a bunch of fragments and assemble them into a Znode path, but then realized that was a whole can of worms. There are lots and lots of places where we construct a path just by putting together strings, look at calls to SolrZkClient.create for instance.&lt;/p&gt;

&lt;p&gt;So this patch takes a minimalist approach. There are three cases where hadoop.fs.Path was brought in outside of something having hdfs in the class name:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;to get the parent from a string. These now call ZkMaintenanceUtils.getZkParent.&lt;/li&gt;
	&lt;li&gt;to pull in Path.SEPARATOR to construct a path. This is silly. These now just hard-code &quot;/&quot; like we do everywhere else.&lt;/li&gt;
	&lt;li&gt;SolrSnapshotsTool and DiskChecker (a test) which I left alone.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If we&apos;re going to do something more robust when it comes to creating ZK paths, it&apos;ll be a much larger undertaking to retrofit all the places we construct them inline now. I think this address the immediate concern.&lt;/p&gt;

&lt;p&gt;All tests pass, I&apos;ll commit tomorrow baring objections.&lt;/p&gt;</comment>
                            <comment id="17160189" author="jira-bot" created="Fri, 17 Jul 2020 20:23:30 +0000"  >&lt;p&gt;Commit 121db63ae99051a22db955e07c7de9c185742de6 in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=121db63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=121db63&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14653&quot; title=&quot;Replace usages of org.apache.hadoop.fs.Path that are used to construct Zookeeper paths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14653&quot;&gt;&lt;del&gt;SOLR-14653&lt;/del&gt;&lt;/a&gt;: Replace usages of org.apache.hadoop.fs.Path that are used to construct Zookeeper paths&lt;/p&gt;</comment>
                            <comment id="17160191" author="jira-bot" created="Fri, 17 Jul 2020 20:24:15 +0000"  >&lt;p&gt;Commit 1a7db1c9f5371df06c18a570f30c2237602ac53d in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=1a7db1c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=1a7db1c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14653&quot; title=&quot;Replace usages of org.apache.hadoop.fs.Path that are used to construct Zookeeper paths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14653&quot;&gt;&lt;del&gt;SOLR-14653&lt;/del&gt;&lt;/a&gt;: Replace usages of org.apache.hadoop.fs.Path that are used to construct Zookeeper paths&lt;/p&gt;</comment>
                            <comment id="17226179" author="atri" created="Wed, 4 Nov 2020 15:22:28 +0000"  >&lt;p&gt;Closing after the 8.7.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13268937">SOLR-13939</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13007826" name="SOLR-14653.patch" size="11426" author="erickerickson" created="Fri, 17 Jul 2020 01:32:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gtpc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>