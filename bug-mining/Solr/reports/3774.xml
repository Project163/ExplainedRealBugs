<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:30:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11782] LatchWatcher.await doesn&#8217;t protect against spurious wakeup</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11782</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I noticed that &lt;tt&gt;LatchWatcher.await&lt;/tt&gt; does:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void await(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeout) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
      &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (lock) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.event != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        lock.wait(timeout);
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;while the recommendation of lock.wait is to check the wait condition even after the method returns in case of spurious wakeup. &lt;tt&gt;lock&lt;/tt&gt; is a private local field to which &lt;tt&gt;notifyAll&lt;/tt&gt; is called only after a zk event is being handled. I think we should check the &lt;tt&gt;await&lt;/tt&gt; method to something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void await(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeout) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
      &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; timeout &amp;gt; 0;
      &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeoutTime = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() + timeout;
      &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (lock) {
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.event == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; nextTimeout = timeoutTime - &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextTimeout &amp;lt;= 0) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
          }
          lock.wait(nextTimeout);
        }
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13126084">SOLR-11782</key>
            <summary>LatchWatcher.await doesn&#8217;t protect against spurious wakeup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tflobbe">Tomas Eduardo Fernandez Lobbe</assignee>
                                    <reporter username="tflobbe">Tomas Eduardo Fernandez Lobbe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Dec 2017 01:56:38 +0000</created>
                <updated>Wed, 2 Oct 2019 17:30:37 +0000</updated>
                            <resolved>Tue, 30 Jan 2018 22:36:39 +0000</resolved>
                                                    <fixVersion>7.3</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16298660" author="dsmiley" created="Wed, 20 Dec 2017 15:51:08 +0000"  >&lt;p&gt;Please use System.nanoTime() for measuring elapsed time, which is not affected by possible clock changes.  Otherwise, +1.&lt;/p&gt;</comment>
                            <comment id="16299270" author="tomasflobbe" created="Wed, 20 Dec 2017 23:46:19 +0000"  >&lt;p&gt;Patch using System.nanoTime() and added a test. Also:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;removed unused constructors&lt;/li&gt;
	&lt;li&gt;modified the only use of await in the current code to keep the lock Object private&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16299846" author="dweiss" created="Thu, 21 Dec 2017 10:37:05 +0000"  >&lt;p&gt;Not to be picky, but it&apos;d be much nicer to use the Lock/Condition from the JDK; these methods have a nicer implementation of timed waiting. The patch is fine though.&lt;/p&gt;</comment>
                            <comment id="16300420" author="dsmiley" created="Thu, 21 Dec 2017 18:43:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dweiss&quot; class=&quot;user-hover&quot; rel=&quot;dweiss&quot;&gt;dweiss&lt;/a&gt; how is Lock/Condition nicer for timed waiting than the corresponding Object methods?  Some of the extra &quot;await&quot; methods on Condition are nice from a convenience point of view (e.g. no explicit TimeUnit conversion necessary); is that all you mean?  I don&apos;t like that awaitUntil accepts a  Date and internally uses System.currentTimeMillis.&lt;/p&gt;</comment>
                            <comment id="16300429" author="tomasflobbe" created="Thu, 21 Dec 2017 18:50:00 +0000"  >&lt;p&gt;Patch using Lock/Condition&lt;/p&gt;</comment>
                            <comment id="16300675" author="dweiss" created="Thu, 21 Dec 2017 22:44:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Condition has a fine-grained awaitNanos (and arbitrary time unit await, converted to nanos). If you glimpse at the openjdk code implementation of these you&apos;ll see what I mean by fine-grained (lock parking, etc.). The method accepting &lt;tt&gt;Date&lt;/tt&gt; is indeed using currentTimeMillis but this isn&apos;t what I was referring to.&lt;/p&gt;

&lt;p&gt;I personally like the latest patch more (thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;!), but I&apos;ll leave it for you guys to decide. One nitpick &amp;#8211;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeoutNanos = TimeUnit.MILLISECONDS.toNanos(timeoutMs);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;you could simply use await(millis, TimeUnit.MILLIS); the conversion to nanos is then internally done anyway.&lt;/p&gt;</comment>
                            <comment id="16317802" author="tomasflobbe" created="Tue, 9 Jan 2018 06:08:38 +0000"  >&lt;p&gt;Thanks for the hints &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dweiss&quot; class=&quot;user-hover&quot; rel=&quot;dweiss&quot;&gt;dweiss&lt;/a&gt;, but, &lt;tt&gt;await(millis, TimeUnit.MILLIS);&lt;/tt&gt; doesn&apos;t return the remaining time, so if I use that method I need to calculate that myself like in the previous patch, is that what you suggest?&lt;/p&gt;</comment>
                            <comment id="16341407" author="jira-bot" created="Fri, 26 Jan 2018 18:36:42 +0000"  >&lt;p&gt;Commit 56f3f6d9484dd353ac50d47717c872ca9dac16ea in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56f3f6d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56f3f6d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11782&quot; title=&quot;LatchWatcher.await doesn&#8217;t protect against spurious wakeup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11782&quot;&gt;&lt;del&gt;SOLR-11782&lt;/del&gt;&lt;/a&gt;: Refactor LatchWatcher.await to protect against spurious wakeup&lt;/p&gt;</comment>
                            <comment id="16341409" author="jira-bot" created="Fri, 26 Jan 2018 18:37:17 +0000"  >&lt;p&gt;Commit a29c2915c79641fc117cc56044d07134f26e8fd7 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a29c291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a29c291&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11782&quot; title=&quot;LatchWatcher.await doesn&#8217;t protect against spurious wakeup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11782&quot;&gt;&lt;del&gt;SOLR-11782&lt;/del&gt;&lt;/a&gt;: Refactor LatchWatcher.await to protect against spurious wakeup&lt;/p&gt;</comment>
                            <comment id="16341577" author="dweiss" created="Fri, 26 Jan 2018 20:51:00 +0000"  >&lt;p&gt;That method already protects against spurious wakeups, so no need to compute anything? &quot;Causes the current thread to wait until it is signalled or interrupted, or the specified waiting time elapses.&quot;&lt;/p&gt;</comment>
                            <comment id="16341665" author="tomasflobbe" created="Fri, 26 Jan 2018 22:07:07 +0000"  >&lt;p&gt;I see. I thought that could be the case, but wasn&apos;t sure, since the javadocs don&apos;t say that explicitly, and they also say:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
This method is behaviorally equivalent to: &amp;lt;pre&amp;gt; {@code awaitNanos(unit.toNanos(time)) &amp;gt; 0}&amp;lt;/pre&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This makes the await method simpler, I can just do:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void await(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeoutMs) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
      lock.lock();
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.event != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
        eventReceived.await(timeoutMs, TimeUnit.MILLISECONDS);
      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        lock.unlock();
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16345927" author="jira-bot" created="Tue, 30 Jan 2018 22:32:54 +0000"  >&lt;p&gt;Commit b310514becf93ff3a9eaf5bd7af632b591b22a80 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b310514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b310514&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11782&quot; title=&quot;LatchWatcher.await doesn&#8217;t protect against spurious wakeup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11782&quot;&gt;&lt;del&gt;SOLR-11782&lt;/del&gt;&lt;/a&gt;: Use await(millis, TimeUnit.MILLIS) in LatchWatcher.await&lt;/p&gt;</comment>
                            <comment id="16345928" author="jira-bot" created="Tue, 30 Jan 2018 22:33:23 +0000"  >&lt;p&gt;Commit c0da6ddb4a196c50cea9996c3944963efb966e28 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c0da6dd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c0da6dd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11782&quot; title=&quot;LatchWatcher.await doesn&#8217;t protect against spurious wakeup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11782&quot;&gt;&lt;del&gt;SOLR-11782&lt;/del&gt;&lt;/a&gt;: Use await(millis, TimeUnit.MILLIS) in LatchWatcher.await&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12903297" name="SOLR-11782.patch" size="8290" author="tflobbe" created="Thu, 21 Dec 2017 18:49:28 +0000"/>
                            <attachment id="12903128" name="SOLR-11782.patch" size="7218" author="tflobbe" created="Wed, 20 Dec 2017 23:44:56 +0000"/>
                            <attachment id="12902958" name="SOLR-11782.patch" size="909" author="tflobbe" created="Wed, 20 Dec 2017 01:58:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3o3i7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>