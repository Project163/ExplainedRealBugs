<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:11:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16976] ClassNotFoundException: org.apache.logging.log4j.jul.LogManager with JMX enabled</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16976</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When starting Solr 9.3 with remote JMX enabled, an exception is logged&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;java.lang.ClassNotFoundException: org.apache.logging.log4j.jul.LogManager&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:520)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.logging/java.util.logging.LogManager$1.run(LogManager.java:239)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.logging/java.util.logging.LogManager$1.run(LogManager.java:223)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.security.AccessController.doPrivileged(AccessController.java:318)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.logging/java.util.logging.LogManager.&amp;lt;clinit&amp;gt;(LogManager.java:222)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.lang.reflect.Method.invoke(Method.java:568)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.management/sun.management.ManagementFactoryHelper$LoggingMXBeanAccess.getMXBeanImplementation(ManagementFactoryHelper.java:243)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.management/sun.management.ManagementFactoryHelper$LoggingMXBeanAccess.&amp;lt;init&amp;gt;(ManagementFactoryHelper.java:259)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.management/sun.management.ManagementFactoryHelper$PlatformLoggingImpl.getInstance(ManagementFactoryHelper.java:339)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.management/sun.management.ManagementFactoryHelper$PlatformLoggingImpl.&amp;lt;clinit&amp;gt;(ManagementFactoryHelper.java:342)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.management/sun.management.ManagementFactoryHelper.getPlatformLoggingMXBean(ManagementFactoryHelper.java:160)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.management/java.lang.management.DefaultPlatformMBeanProvider$9.nameToMBeanMap(DefaultPlatformMBeanProvider.java:378)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.management/java.lang.management.ManagementFactory.lambda$getPlatformMBeanServer$0(ManagementFactory.java:488)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:273)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.HashMap$ValueSpliterator.forEachRemaining(HashMap.java:1779)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at java.management/java.lang.management.ManagementFactory.getPlatformMBeanServer(ManagementFactory.java:489)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at jdk.management.agent/sun.management.jmxremote.ConnectorBootstrap.startRemoteConnectorServer(ConnectorBootstrap.java:476)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at jdk.management.agent/jdk.internal.agent.Agent.startAgent(Agent.java:447)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;at jdk.management.agent/jdk.internal.agent.Agent.startAgent(Agent.java:599)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Waiting up to 30 seconds to see Solr running on port 8983&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Started Solr server on port 8983. Happy searching!&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Solr Node (id node1) on port 8983: Started&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13550565">SOLR-16976</key>
            <summary>ClassNotFoundException: org.apache.logging.log4j.jul.LogManager with JMX enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="colvinco">Colvin Cowie</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 13 Sep 2023 17:03:22 +0000</created>
                <updated>Tue, 28 Jan 2025 22:17:47 +0000</updated>
                            <resolved>Wed, 30 Oct 2024 03:38:46 +0000</resolved>
                                    <version>9.3</version>
                                    <fixVersion>9.8</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="9600">2h 40m</timespent>
                                <comments>
                            <comment id="17765433" author="elyograg" created="Fri, 15 Sep 2023 03:53:51 +0000"  >&lt;p&gt;Why did we need to include the log4j JUL jar?&#160; We already had jul-to-slf4j-2.0.7.jar to route JUL to slf4j, which then routes to log4j2.&lt;/p&gt;

&lt;p&gt;There shouldn&apos;t have been any changes required to have Lucene&apos;s logs end up in solr.log because we already had JUL handling.&lt;/p&gt;</comment>
                            <comment id="17765514" author="elyograg" created="Fri, 15 Sep 2023 09:15:50 +0000"  >&lt;p&gt;With the log4j jul jar and the sysprop telling log4j to use it, lucene classes get added to the logging-&amp;gt;level page.&#160; Without them, those classes aren&apos;t in the level page.&#160; I wonder if that means there&apos;s a bug in jul-to-slf4j.&lt;/p&gt;</comment>
                            <comment id="17765603" author="elyograg" created="Fri, 15 Sep 2023 12:39:38 +0000"  >&lt;p&gt;Not a bug.&#160; The JUL bridge for slf4j does not activate automatically just by having the jar in the classpath like the other bridges do.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/a/11245040/2665648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/a/11245040/2665648&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tried adding those SLF4JBridgeHandler calls to SolrDispatchFilter (which is where Solr execution starts), which required a new line in solr/core/build.gradle, and I reverted the change for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16878&quot; title=&quot;Include Lucene JUL logs with Solr logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16878&quot;&gt;&lt;del&gt;SOLR-16878&lt;/del&gt;&lt;/a&gt; in my local tree ... but still didn&apos;t see the lucene classes in the logging tab of the admin UI.&#160; Probably time to ask the slf4j project for some guidance.&lt;/p&gt;</comment>
                            <comment id="17766098" author="elyograg" created="Sun, 17 Sep 2023 15:22:48 +0000"  >&lt;p&gt;I will attach a patch that switches Solr to use the slf4j bridge for JUL.&#160; The patch contains a NOCOMMIT... the test logger that I added shouldn&apos;t be in the committed code.&lt;/p&gt;

&lt;p&gt;With this patch active, I started Solr with remote jmx configured, and connected jconsole to the 18983 port.&#160; There was no exception logged.&lt;/p&gt;</comment>
                            <comment id="17766100" author="elyograg" created="Sun, 17 Sep 2023 15:43:31 +0000"  >&lt;p&gt;I think it&apos;s better the use the slf4j bridge.&#160; Doing so allows the end user to switch their logging implementation to something other than log4j2 and still get logs from Lucene.&lt;/p&gt;</comment>
                            <comment id="17893945" author="dsmiley" created="Tue, 29 Oct 2024 18:09:54 +0000"  >&lt;p&gt;Other than the ugly exception in the console, is there any other problems?  Are certain logs not shown, like code using JUL (e.g. Lucene)?&lt;/p&gt;</comment>
                            <comment id="17894050" author="jira-bot" created="Wed, 30 Oct 2024 01:38:13 +0000"  >&lt;p&gt;Commit dbf1c50a67b2e23758ae2381745898f191f0bd47 in solr&apos;s branch refs/heads/main from szhou1998&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=dbf1c50a67b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=dbf1c50a67b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16976&quot; title=&quot;ClassNotFoundException: org.apache.logging.log4j.jul.LogManager with JMX enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16976&quot;&gt;&lt;del&gt;SOLR-16976&lt;/del&gt;&lt;/a&gt;: Remove log4j-jul jar and use Slf4j bridge for JUL (#2703)&lt;/p&gt;

&lt;p&gt;Remove log4j-jul jar and use slf4j bridge for JUL to prevent exception from being logged when remote JMX&lt;br/&gt;
  is enabled .&lt;br/&gt;
Updated jetty.xml to initialize the bridge super early.&lt;/p&gt;


&lt;p&gt;Co-authored-by: Eric Pugh &amp;lt;epugh@opensourceconnections.com&amp;gt;&lt;br/&gt;
Co-authored-by: David Smiley &amp;lt;dsmiley@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17894059" author="jira-bot" created="Wed, 30 Oct 2024 03:34:25 +0000"  >&lt;p&gt;Commit e9e034154a608bcd937575f3cb23f86e230e7df9 in solr&apos;s branch refs/heads/branch_9x from szhou1998&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=e9e034154a6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=e9e034154a6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16976&quot; title=&quot;ClassNotFoundException: org.apache.logging.log4j.jul.LogManager with JMX enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16976&quot;&gt;&lt;del&gt;SOLR-16976&lt;/del&gt;&lt;/a&gt;: Remove log4j-jul jar and use Slf4j bridge for JUL (#2703)&lt;/p&gt;

&lt;p&gt;Remove log4j-jul jar and use slf4j bridge for JUL to prevent exception from being logged when remote JMX&lt;br/&gt;
  is enabled .&lt;br/&gt;
Updated jetty.xml to initialize the bridge super early.&lt;/p&gt;

&lt;p&gt;Co-authored-by: Eric Pugh &amp;lt;epugh@opensourceconnections.com&amp;gt;&lt;br/&gt;
Co-authored-by: David Smiley &amp;lt;dsmiley@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;(cherry picked from commit dbf1c50a67b2e23758ae2381745898f191f0bd47)&lt;/p&gt;</comment>
                            <comment id="17894061" author="dsmiley" created="Wed, 30 Oct 2024 03:38:46 +0000"  >&lt;p&gt;Merged.  Thanks for contributing Stephen Zhou!&lt;/p&gt;</comment>
                            <comment id="17921891" author="anshumg" created="Tue, 28 Jan 2025 22:17:47 +0000"  >&lt;p&gt;Closing after the 9.8.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13542820">SOLR-16878</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13062969" name="use-slf4j-jul-bridge.patch" size="4355" author="elyograg" created="Sun, 17 Sep 2023 15:23:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1kc8o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>