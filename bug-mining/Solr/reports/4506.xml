<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:44:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14498] BlockCache gets stuck not accepting new stores</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14498</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;tt&gt;BlockCache&lt;/tt&gt; uses two components: &quot;storage&quot;, i.e. &lt;tt&gt;banks&lt;/tt&gt;&#160;and &quot;eviction mechanism&quot;, i.e &lt;tt&gt;cache&lt;/tt&gt;, implemented by caffeine cache.&lt;br/&gt;
The relation between them is that &quot;storage&quot; enforces a strict limit for the number of entries (&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;numberOfBlocksPerBank * numberOfBanks&lt;/tt&gt;) whereas the &quot;eviction mechanism&quot; takes care of freeing entries from the storage thanks to &lt;tt&gt;maximumSize&lt;/tt&gt; set for the caffeine cache to&#160;&lt;tt&gt;numberOfBlocksPerBank * numberOfBanks - 1&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The storage relies on caffeine cache to eventually free at least 1 entry from the storage. If that doesn&apos;t happen the &lt;tt&gt;BlockCache&lt;/tt&gt; starts to fail all new stores.&lt;/p&gt;

&lt;p&gt;As it turns out, the caffeine cache may not reduce it&apos;s size to the desired &lt;tt&gt;maximumSize&lt;/tt&gt;&#160;for as long as no &lt;tt&gt;put&lt;/tt&gt;&#160;or &lt;tt&gt;getIfPresent&lt;/tt&gt; which &lt;b&gt;finds an entry&lt;/b&gt; is executed.&lt;/p&gt;

&lt;p&gt;With a sufficiently unlucky read pattern, the block cache may be rendered useless (0 hit ratio):&lt;br/&gt;
cache poisoned by non-reusable entries; new, reusable entries are not stored and thus not reused.&lt;/p&gt;

&lt;p&gt;Further info may be found in&#160;&lt;a href=&quot;https://github.com/ben-manes/caffeine/issues/420&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ben-manes/caffeine/issues/420&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Change in caffeine that triggers it&apos;s internal cleanup mechanism regardless of whether getIfPresent gets a hit has been implemented in &lt;a href=&quot;https://github.com/ben-manes/caffeine/commit/7239bb0dda2af1e7301e8f66a5df28215b5173bc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ben-manes/caffeine/commit/7239bb0dda2af1e7301e8f66a5df28215b5173bc&lt;/a&gt;&lt;br/&gt;
and is due to be released in caffeine 2.8.4&lt;/p&gt;</description>
                <environment></environment>
        <key id="13305929">SOLR-14498</key>
            <summary>BlockCache gets stuck not accepting new stores</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ab">Andrzej Bialecki</assignee>
                                    <reporter username="jakubzytka">Jakub Zytka</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 May 2020 13:25:37 +0000</created>
                <updated>Wed, 15 Jul 2020 15:11:24 +0000</updated>
                            <resolved>Thu, 28 May 2020 12:15:56 +0000</resolved>
                                    <version>6.5</version>
                    <version>6.6.5</version>
                    <version>7.7.3</version>
                    <version>8.5.1</version>
                    <version>9.0</version>
                                    <fixVersion>8.6</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17115903" author="ab" created="Mon, 25 May 2020 09:55:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jakubzytka&quot; class=&quot;user-hover&quot; rel=&quot;jakubzytka&quot;&gt;jakubzytka&lt;/a&gt; If I understand this correctly simply upgrading to Caffeine 2.8.4 should solve the problem?&lt;/p&gt;</comment>
                            <comment id="17116144" author="jakubzytka" created="Mon, 25 May 2020 16:42:20 +0000"  >&lt;p&gt;Upgrading to caffeine 2.8.4 should solve the problem;&lt;/p&gt;</comment>
                            <comment id="17116624" author="jira-bot" created="Tue, 26 May 2020 10:56:39 +0000"  >&lt;p&gt;Commit 22044fcabb84b17909a90abe9b411ab838f01d26 in lucene-solr&apos;s branch refs/heads/master from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=22044fc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=22044fc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14498&quot; title=&quot;BlockCache gets stuck not accepting new stores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14498&quot;&gt;&lt;del&gt;SOLR-14498&lt;/del&gt;&lt;/a&gt;: Upgrade to Caffeine 2.8.4, which fixes the cache poisoning issue.&lt;/p&gt;</comment>
                            <comment id="17116668" author="jira-bot" created="Tue, 26 May 2020 11:55:34 +0000"  >&lt;p&gt;Commit d8542354072c05a060aa542f6107bcf6eee7ba4a in lucene-solr&apos;s branch refs/heads/branch_8x from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d854235&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d854235&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14498&quot; title=&quot;BlockCache gets stuck not accepting new stores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14498&quot;&gt;&lt;del&gt;SOLR-14498&lt;/del&gt;&lt;/a&gt;: Upgrade to Caffeine 2.8.4, which fixes the cache poisoning issue.&lt;/p&gt;</comment>
                            <comment id="17116669" author="ab" created="Tue, 26 May 2020 11:57:04 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jakubzytka&quot; class=&quot;user-hover&quot; rel=&quot;jakubzytka&quot;&gt;jakubzytka&lt;/a&gt;&#160;for reporting this and for your analysis.&lt;/p&gt;</comment>
                            <comment id="17118019" author="mdrob" created="Wed, 27 May 2020 18:58:51 +0000"  >&lt;p&gt;This causes precommit failures on master, need to update the version in a few more places.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt; Task :solr:core:validateJarChecksums FAILED

FAILURE: Build failed with an exception.

* Where:
Script &apos;/Users/mdrob/code/lucene-solr/gradle/validation/jar-checks.gradle&apos; line: 195

* What went wrong:
Execution failed for task &apos;:solr:core:validateJarChecksums&apos;.
&amp;gt; Dependency checksum validation failed:
    - Dependency checksum missing (&apos;com.github.ben-manes.caffeine:caffeine:2.8.0&apos;), expected it at: /Users/mdrob/code/lucene-solr/solr/licenses/caffeine-2.8.0.jar.sha1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mdrob-imp:~/code/lucene-solr $ git grep 2[.]8[.]0
versions.lock:com.github.ben-manes.caffeine:caffeine:2.8.0 (1 constraints: 0c050d36)
versions.props:com.github.ben-manes.caffeine:caffeine=2.8.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not actually sure what the correct way to update these is, however.&lt;/p&gt;</comment>
                            <comment id="17118175" author="erickerickson" created="Thu, 28 May 2020 00:23:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; I&apos;ll fix this momentarily, I&apos;m sure &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt; is asleep. The magic is &lt;/p&gt;

&lt;p&gt;if changing depencencies first excute:&lt;br/&gt;
gradlew --write-locks&lt;/p&gt;

&lt;p&gt;then: &lt;br/&gt;
gradlew updateLicenses&lt;/p&gt;

&lt;p&gt;BTW, gradlew helpAnt gives useful commands for &quot;how do I do something in Gradle that I used to in Ant&quot;... &lt;/p&gt;</comment>
                            <comment id="17118177" author="jira-bot" created="Thu, 28 May 2020 00:25:02 +0000"  >&lt;p&gt;Commit 598cbc5c737b3953fbe0312c011d3de0f2bb58cb in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=598cbc5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=598cbc5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14498&quot; title=&quot;BlockCache gets stuck not accepting new stores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14498&quot;&gt;&lt;del&gt;SOLR-14498&lt;/del&gt;&lt;/a&gt;: BlockCache gets stuck not accepting new stores. Fix gradle :solr:core:validateJarChecksums&lt;/p&gt;</comment>
                            <comment id="17118236" author="jira-bot" created="Thu, 28 May 2020 02:20:12 +0000"  >&lt;p&gt;Commit 84c5dfc277d25735b17b1493daa98693286f4aed in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=84c5dfc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=84c5dfc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14498&quot; title=&quot;BlockCache gets stuck not accepting new stores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14498&quot;&gt;&lt;del&gt;SOLR-14498&lt;/del&gt;&lt;/a&gt;: BlockCache gets stuck not accepting new stores fixing checksums&lt;/p&gt;</comment>
                            <comment id="17118589" author="erickerickson" created="Thu, 28 May 2020 11:53:11 +0000"  >&lt;p&gt;OK, this is going to be harder than I thought. If I run the gradle udateLicenses, then gradlew check passes but ant precommit doesn&apos;t and vice versa. I&apos;m not quite sure how to resolve,  haven&apos;t seen this before. Note that they both produce exactly the same checksum AFAICT.&lt;/p&gt;</comment>
                            <comment id="17118611" author="erickerickson" created="Thu, 28 May 2020 12:15:56 +0000"  >&lt;p&gt;I&apos;m gradually learning that when things totally stop making sense it&apos;s time to go to bed and look again in the morning.&lt;/p&gt;

&lt;p&gt;The problem was that the gradle dependencies needed to be updated by updating versions.props, then running gradlew --write-lock in addition to creating the checksum file with either &quot;ant jar-checksums&quot; or &quot;gradlew updateLicenses&quot;. Last night I just totally misread which one was being added and which deleted when I ran the unmodified gradle tasks.&lt;/p&gt;

&lt;p&gt;It&apos;s awkward to have to update both, but at least with the checks we&apos;ll be in sync when we switch over.&lt;/p&gt;</comment>
                            <comment id="17158428" author="broustant" created="Wed, 15 Jul 2020 15:11:24 +0000"  >&lt;p&gt;Closing after the 8.6.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ewq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>