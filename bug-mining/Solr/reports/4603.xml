<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:46:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14934] Multiple Code Paths for determining &quot;solr home&quot; can return differnet answers</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14934</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;While looking into some possible ways to make our tests more closely match &quot;real&quot; solr installs, I realized that we currently have 2 different methods for determining the &quot;solr home&quot; for a node...&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SolrPaths.locateSolrHome()&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;static method that uses a hueristic that typically results in using &lt;tt&gt;System.getProperty(&quot;solr.solr.home&quot;);&lt;/tt&gt;
		&lt;ul&gt;
			&lt;li&gt;NOTE: the result is not stored in any static/final variables&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;this method&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SolrDispatchFilter&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;starts by checking if an explicit &lt;tt&gt;ServletContext&lt;/tt&gt; attribute is specified
		&lt;ul&gt;
			&lt;li&gt;falls back to using &lt;tt&gt;SolrPaths.locateSolrHome()&lt;/tt&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;whatever value is found gets set on &lt;tt&gt;CoreContainer&lt;/tt&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In a typical Solr install, the &lt;tt&gt;&quot;solr.solr.home&quot;&lt;/tt&gt; system property is set by &lt;tt&gt;bin/solr&lt;/tt&gt; and we get a consistent value for the life of the server instance regardless of code path.&lt;/p&gt;

&lt;p&gt;In tests, we have &lt;tt&gt;SolrTestCaseJ4&lt;/tt&gt; (and a handful of other places) that calls &lt;tt&gt;System.setProperty(&quot;solr.solr.home&quot;,...)&lt;/tt&gt; &lt;b&gt;AND&lt;/b&gt; in jetty based tests (including &lt;tt&gt;MiniSolrCloudCluster&lt;/tt&gt; based tests) we rely on the &lt;tt&gt;ServletContext&lt;/tt&gt; attribute based approach to have a unique &quot;Solr Home&quot; for each node. (&lt;tt&gt;JettySOlrRunner&lt;/tt&gt; injects the value when wiring up the &lt;tt&gt;Server&lt;/tt&gt; instance)&lt;/p&gt;

&lt;p&gt;This means that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;in jetty based test - even if it&apos;s a single jetty instance - each of the node&apos;s CoreContainer has a unique value of &quot;solr home&quot;, but any code paths in solr that directly call &lt;tt&gt;SolrPaths.locateSolrHome()&lt;/tt&gt; will get a consistent value across all nodes (different from the value in the CoreContainer for any node)&lt;/li&gt;
	&lt;li&gt;allthough i don&apos;t think it happens now: a test could call &lt;tt&gt;System.setProperty(&quot;solr.solr.home&quot;,...)&lt;/tt&gt; while a node is running, and potentially get inconsistent behavior from even a&#160; jetty node over time.&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;
&lt;p&gt;In practice, I don&apos;t think that any of this is currently causing &quot;real bugs&quot; in actual solr code; nor do i &lt;em&gt;think&lt;/em&gt; we&apos;re seeing any &quot;false positives&quot; or &quot;false failures&quot; in tests as a result of this - but it is a big huge land mine just waiting to go off if we step too close, and i think we should recitfy this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13335508">SOLR-14934</key>
            <summary>Multiple Code Paths for determining &quot;solr home&quot; can return differnet answers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Oct 2020 23:21:24 +0000</created>
                <updated>Thu, 12 May 2022 00:26:32 +0000</updated>
                            <resolved>Thu, 3 Dec 2020 00:20:04 +0000</resolved>
                                                    <fixVersion>8.8</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17214335" author="hossman" created="Wed, 14 Oct 2020 23:24:42 +0000"  >
&lt;p&gt;The most prominent place I&apos;ve seen &lt;tt&gt;SolrPaths.locateSolrHome()&lt;/tt&gt; get used (outside of the &lt;tt&gt;SolrDispatchFilter&lt;/tt&gt;) is in the no-arg constructor to &lt;tt&gt;SolrResourceLoader&lt;/tt&gt;, or in the case that &lt;tt&gt;new SolrResourceLoader(...)&lt;/tt&gt; is called with a null &lt;tt&gt;Path&lt;/tt&gt; &amp;#8211; something that doesn&apos;t seem like it was ever ment to be a valid useage, it looks like it was just there so the no-arg constructor could call the multi-arg constructor)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Here&apos;s my straw man proposal....&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;on master &amp;amp; backported to 8x
	&lt;ul&gt;
		&lt;li&gt;&lt;tt&gt;SolrPaths.locateSolrHome()&lt;/tt&gt;
		&lt;ul&gt;
			&lt;li&gt;mark deprecated&lt;/li&gt;
			&lt;li&gt;move the &quot;guts&quot; of this logic directly into &lt;tt&gt;SolrDispatchFilter&lt;/tt&gt;&lt;/li&gt;
			&lt;li&gt;fix sole remaining &quot;real code&quot; usage (XmlConfigFile, in what appears to be a dead code path) to throw NullPointerException if situation encountered&lt;/li&gt;
			&lt;li&gt;replace all direct usage in tests with direct access to the &lt;tt&gt;Path&lt;/tt&gt; created by the test framework&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;&lt;tt&gt;SolrResourceLoader&lt;/tt&gt;
		&lt;ul&gt;
			&lt;li&gt;mark the no-arg constructor deprecated&lt;/li&gt;
			&lt;li&gt;update the javadocs of other constructors to note that the behavior with a null &lt;tt&gt;Path&lt;/tt&gt; is specified is un-specified and will fail in 9.x&lt;/li&gt;
			&lt;li&gt;fix sole &quot;real code&quot; usage (SolrCoreParser, in what appears to be a dead code path) to throw NullPointerException if situation encountered&lt;/li&gt;
			&lt;li&gt;replace all direct usage of &lt;tt&gt;new SolrResourceLoader()&lt;/tt&gt; in tests with constructor that takes in the (test&apos;s) &lt;tt&gt;solrHome&lt;/tt&gt; Path.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;update test&apos;s security policy to blacklist &lt;tt&gt;System.setProperty(&quot;solr.solr.home&quot;,...)&lt;/tt&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;on master only
	&lt;ul&gt;
		&lt;li&gt;delete &lt;tt&gt;SolrPaths.locateSolrHome()&lt;/tt&gt;&lt;/li&gt;
		&lt;li&gt;delete no-arg &lt;tt&gt;SolrResourceLoader&lt;/tt&gt; constructor&lt;/li&gt;
		&lt;li&gt;make remaining &lt;tt&gt;SolrResourceLoader&lt;/tt&gt; constructors throw NullPointerException if &lt;tt&gt;Path&lt;/tt&gt; arg is null&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17241930" author="hossman" created="Tue, 1 Dec 2020 23:10:24 +0000"  >&lt;p&gt;I&apos;ve attached a &quot;PoC&quot; patch implementing (most of) the strawman changes i suggested &amp;#8211; with some nocommit comments showing where certain changes would only be committed to master w/o backporting to 8x (but are included to demonstrate tests would still pass) and other nocommit comments indicating where additional steps would be taken after backporting the &quot;meat&quot; of the changes to refactor/remove functionality from master.&lt;/p&gt;

&lt;p&gt;(The idea here  is that this patch gives an overview of &quot;the long view&quot; and helps prove that tests will pass even once the methods we want to deprecate are removed)&lt;/p&gt;</comment>
                            <comment id="17242546" author="jira-bot" created="Wed, 2 Dec 2020 17:24:57 +0000"  >&lt;p&gt;Commit 2e6a02394ec4eea6ba72d5bc2bf02c0139a54f39 in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2e6a023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2e6a023&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14934&quot; title=&quot;Multiple Code Paths for determining &amp;quot;solr home&amp;quot; can return differnet answers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14934&quot;&gt;&lt;del&gt;SOLR-14934&lt;/del&gt;&lt;/a&gt;: Refactored duplicate &quot;Solr Home&quot; logic into a single place to eliminate risk of tests using divergent values for a single solr node.&lt;/p&gt;</comment>
                            <comment id="17242645" author="jira-bot" created="Wed, 2 Dec 2020 19:14:12 +0000"  >&lt;p&gt;Commit 8732df8c505eec9109cd8a7bdd553e908447af5f in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8732df8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8732df8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14934&quot; title=&quot;Multiple Code Paths for determining &amp;quot;solr home&amp;quot; can return differnet answers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14934&quot;&gt;&lt;del&gt;SOLR-14934&lt;/del&gt;&lt;/a&gt;: test workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15026&quot; title=&quot;MiniSolrCloudCluster can inconsistently get confused about when it&amp;#39;s using SSL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15026&quot;&gt;SOLR-15026&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17242702" author="jira-bot" created="Wed, 2 Dec 2020 20:35:47 +0000"  >&lt;p&gt;Commit 05a8477a362beb6b0e5a02b6ee4dfa106a2e6a76 in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=05a8477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=05a8477&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14934&quot; title=&quot;Multiple Code Paths for determining &amp;quot;solr home&amp;quot; can return differnet answers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14934&quot;&gt;&lt;del&gt;SOLR-14934&lt;/del&gt;&lt;/a&gt;: Fix some additional test helper methods that aren&apos;t used on master but triggered problems when when backporting to branch_8x&lt;/p&gt;</comment>
                            <comment id="17242787" author="jira-bot" created="Wed, 2 Dec 2020 22:40:38 +0000"  >&lt;p&gt;Commit 5caadc12f4b00b882ec6235d317c82d823d21ff7 in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5caadc1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5caadc1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14934&quot; title=&quot;Multiple Code Paths for determining &amp;quot;solr home&amp;quot; can return differnet answers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14934&quot;&gt;&lt;del&gt;SOLR-14934&lt;/del&gt;&lt;/a&gt;: Refactored duplicate &quot;Solr Home&quot; logic into a single place to eliminate risk of tests using divergent values for a single solr node.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2e6a02394ec4eea6ba72d5bc2bf02c0139a54f39)&lt;br/&gt;
(cherry picked from commit 05a8477a362beb6b0e5a02b6ee4dfa106a2e6a76)&lt;/p&gt;</comment>
                            <comment id="17242828" author="jira-bot" created="Thu, 3 Dec 2020 00:19:16 +0000"  >&lt;p&gt;Commit 5208d47e1a2030dc51396db74d42b52ba378756d in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5208d47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5208d47&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14934&quot; title=&quot;Multiple Code Paths for determining &amp;quot;solr home&amp;quot; can return differnet answers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14934&quot;&gt;&lt;del&gt;SOLR-14934&lt;/del&gt;&lt;/a&gt;: Remove redundent deprecated &quot;solr.solr.home&quot; logic&lt;/p&gt;</comment>
                            <comment id="17535470" author="janhoy" created="Thu, 12 May 2022 00:26:32 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13336593">SOLR-14958</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13016312" name="SOLR-14934.poc.patch" size="45432" author="hossman" created="Tue, 1 Dec 2020 23:05:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jpq8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>