<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:11:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17597] CaffeineCache ramBytes incorrect accounting on `put()`</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17597</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In most cases, usage of &lt;tt&gt;CaffeineCache.put()&lt;/tt&gt; results in incorrect ramBytes accounting. Replaced values (and keys) decrement &lt;tt&gt;ramBytes&lt;/tt&gt; via &lt;tt&gt;onRemoval()&lt;/tt&gt;, so replaced values currently end up double-decrementing for the replaced value in &lt;a href=&quot;https://github.com/apache/solr/blob/a4229e76771da0125b38204db01ea0934e09c4f4/solr/core/src/java/org/apache/solr/search/CaffeineCache.java#L297-L301&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;recordRamBytes()&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;After a sufficient number of replacements via &lt;tt&gt;put()&lt;/tt&gt;, &lt;tt&gt;ramBytes&lt;/tt&gt; becomes permanently negative, and is thus useless.&lt;/p&gt;

&lt;p&gt;The problem was masked in existing tests due to the behavior of the Caffeine library in the case of reference equality between the old (replaced) value and the new (replacement) value for the same (&lt;tt&gt;.equals()&lt;/tt&gt;) key &amp;#8211; &lt;a href=&quot;https://github.com/apache/solr/blob/a4229e76771da0125b38204db01ea0934e09c4f4/solr/core/src/test/org/apache/solr/search/TestCaffeineCache.java#L342-L345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the case exercised in existing tests&lt;/a&gt; &amp;#8211; in which case &lt;tt&gt;onRemoval()&lt;/tt&gt; is &lt;em&gt;not&lt;/em&gt; invoked (so there is no double decrement).&lt;/p&gt;

&lt;p&gt;The problem is also masked in normal usage, since existing/default cache implementations and invocation all currently use &lt;tt&gt;computeIfAbsent()&lt;/tt&gt; instead of &lt;tt&gt;put()&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13602597">SOLR-17597</key>
            <summary>CaffeineCache ramBytes incorrect accounting on `put()`</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="magibney">Michael Gibney</assignee>
                                    <reporter username="magibney">Michael Gibney</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 18 Dec 2024 16:45:44 +0000</created>
                <updated>Fri, 17 Oct 2025 20:05:52 +0000</updated>
                            <resolved>Fri, 20 Dec 2024 21:25:01 +0000</resolved>
                                    <version>9.7</version>
                    <version>10.0</version>
                                    <fixVersion>9.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17907493" author="jira-bot" created="Fri, 20 Dec 2024 21:12:43 +0000"  >&lt;p&gt;Commit a40826eae6d0dd3b60166844a3be048a6dfee40f in solr&apos;s branch refs/heads/main from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=a40826eae6d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=a40826eae6d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17597&quot; title=&quot;CaffeineCache ramBytes incorrect accounting on `put()`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17597&quot;&gt;&lt;del&gt;SOLR-17597&lt;/del&gt;&lt;/a&gt;: Fix `CaffeineCache.put()` ramBytes decrement (#2917)&lt;/p&gt;
</comment>
                            <comment id="17907496" author="jira-bot" created="Fri, 20 Dec 2024 21:23:37 +0000"  >&lt;p&gt;Commit a7a4765ef6f72f4508caf2f6264dd3df134eba84 in solr&apos;s branch refs/heads/branch_9x from Michael Gibney&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=a7a4765ef6f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=a7a4765ef6f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17597&quot; title=&quot;CaffeineCache ramBytes incorrect accounting on `put()`&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17597&quot;&gt;&lt;del&gt;SOLR-17597&lt;/del&gt;&lt;/a&gt;: Fix `CaffeineCache.put()` ramBytes decrement (#2917)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit a40826eae6d0dd3b60166844a3be048a6dfee40f)&lt;/p&gt;</comment>
                            <comment id="18009795" author="houston" created="Thu, 24 Jul 2025 22:50:56 +0000"  >&lt;p&gt;Closing after the 9.9.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1t7g8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>