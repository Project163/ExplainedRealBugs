<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:35:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7804] TestCloudPivotFacet failures: expected:&lt;X&gt; but was:&lt;Y&gt;</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7804</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;A couple failures recently on my Jenkins (Linux), both on branch_5x and trunk - here&apos;s one on trunk: &lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-trunk/766/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-trunk/766/&lt;/a&gt;, and another on branch_5x: &lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-5.x-Java8/546/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-5.x-Java8/546/&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I reproduced another branch_5x failure from a few days ago (Jenkins job has been removed already) on OS X, using both java7 and java8:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=D8E5204E25B3DB16 -Dtests.slow=true -Dtests.locale=es_PA -Dtests.timezone=America/El_Salvador -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 46.6s | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {main(facet=true&amp;amp;facet.pivot=%7B%21stats%3Dst0%7Dpivot_ti1&amp;amp;facet.pivot=%7B%21stats%3Dst0%7Dpivot_ti1&amp;amp;facet.limit=4&amp;amp;facet.offset=6&amp;amp;facet.missing=true&amp;amp;facet.overrequest.ratio=-0.9744149),extra(rows=0&amp;amp;q=id%3A%5B*+TO+448%5D&amp;amp;fq=id%3A%5B*+TO+516%5D&amp;amp;_test_miss=true)} num pivots expected:&amp;lt;2&amp;gt; but was:&amp;lt;1&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([D8E5204E25B3DB16:50B11F948B4FB6EE]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:251)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.test(TestCloudPivotFacet.java:228)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:960)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:935)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12845887">SOLR-7804</key>
            <summary>TestCloudPivotFacet failures: expected:&lt;X&gt; but was:&lt;Y&gt;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jul 2015 13:42:17 +0000</created>
                <updated>Fri, 2 Nov 2018 17:03:30 +0000</updated>
                                            <version>5.3</version>
                    <version>6.0</version>
                                                    <component>faceting</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14634228" author="steve_rowe" created="Mon, 20 Jul 2015 22:59:27 +0000"  >&lt;p&gt;Another trunk failure on Linux: &lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-trunk/901/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-trunk/901/&lt;/a&gt; - reproduces for me on OS X, both on trunk and on branch_5x, the latter with both Java7 and Java8: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=957BC6861F510BE -Dtests.slow=true -Dtests.locale=sr_BA -Dtests.timezone=America/Guadeloupe -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 36.2s J3  | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {main(facet=true&amp;amp;facet.pivot=pivot_b%2Cpivot_f%2Cpivot_dt1&amp;amp;facet.pivot=%7B%21stats%3Dst3%7Dpivot_td%2Cpivot_z_s1&amp;amp;facet.limit=5&amp;amp;facet.pivot.mincount=16&amp;amp;facet.missing=true&amp;amp;facet.sort=index&amp;amp;facet.overrequest.ratio=1.1832508),extra(rows=0&amp;amp;q=*%3A*&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tl&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_tdt1&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_y_s&amp;amp;_test_min=16&amp;amp;_test_miss=true&amp;amp;_test_sort=index)} ==&amp;gt; pivot_b,pivot_f,pivot_dt1: {params(rows=0),defaults({main(rows=0&amp;amp;q=*%3A*&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tl&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_tdt1&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_y_s&amp;amp;_test_min=16&amp;amp;_test_miss=true&amp;amp;_test_sort=index),extra(fq=-pivot_b%3A%5B*+TO+*%5D)})} expected:&amp;lt;17&amp;gt; but was:&amp;lt;22&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([957BC6861F510BE:810383B2CF097D46]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:281)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.test(TestCloudPivotFacet.java:228)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:963)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:938)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError: pivot_b,pivot_f,pivot_dt1: {params(rows=0),defaults({main(rows=0&amp;amp;q=*%3A*&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tl&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_tdt1&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_y_s&amp;amp;_test_min=16&amp;amp;_test_miss=true&amp;amp;_test_sort=index),extra(fq=-pivot_b%3A%5B*+TO+*%5D)})} expected:&amp;lt;17&amp;gt; but was:&amp;lt;22&amp;gt;
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertNumFound(TestCloudPivotFacet.java:680)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotData(TestCloudPivotFacet.java:335)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:302)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:271)
   [junit4]    &amp;gt; 	... 42 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14640773" author="hossman" created="Fri, 24 Jul 2015 17:32:52 +0000"  >&lt;p&gt;There&apos;s two distinct types of failures here..&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;assertPivotCountsAreCorrect fails directly (and very early in it&apos;s cycle) because &lt;tt&gt;num pivots expected:&amp;lt;X&amp;gt; but was:&amp;lt;X-1&amp;gt;&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;this is a straightforward test bug - it&apos;s not accounting for the 1 in ~1000 chance that it will generate the exact same &quot;facet.pivot&quot; param twice in a single request&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;assertNumFound fails with {{expected:&amp;lt;X&amp;gt; but was:&amp;lt;X+Y&amp;gt;
	&lt;ul&gt;
		&lt;li&gt;this is ... something else.  it&apos;s not immediately obvious to me why these are failing
		&lt;ul&gt;
			&lt;li&gt;in both of the examples give so far, the specific failure msg indicates that it&apos;s trying to verify the count from a &quot;missing&quot; constraint (ie: dos that do not have a pivot constrain value) and when adding an &lt;tt&gt;fq=-fieldname:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt; to the original query, it gets &lt;em&gt;more&lt;/em&gt; documents then the facet said it should.&lt;/li&gt;
			&lt;li&gt;besides the fact that they are both the &quot;missing&quot; counts, the only other commonality that jumps out at me is that facet.mincount is used in both queries, and in both cases the facet.mincount is just slightly below the count returned &amp;#8211; making me wonder if there is a bug in how the we&apos;re dealing with counts from individual shards below the mincount? (pure speculation)&lt;/li&gt;
			&lt;li&gt;i should not explicitly that in one of the failures, the facet.limit=5 and the incorrect count is from a boolean field which is the very first field in the pivot &amp;#8211; so refinement shouldn&apos;t be a factor in whatever is going wrong.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;

&lt;p&gt;I&apos;ve got a trivial patch for the first problem that i&apos;ll commit soon &amp;#8211; it doens&apos;t affect the entropy of the randomized test, so the other seeds (for the second problem) still fail and can be used to continue to test that remaining problem...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=957BC6861F510BE -Dtests.slow=true -Dtests.locale=sr_BA -Dtests.timezone=America/Guadeloupe -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 36.2s J3  | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {main(facet=true&amp;amp;facet.pivot=pivot_b%2Cpivot_f%2Cpivot_dt1&amp;amp;facet.pivot=%7B%21stats%3Dst3%7Dpivot_td%2Cpivot_z_s1&amp;amp;facet.limit=5&amp;amp;facet.pivot.mincount=16&amp;amp;facet.missing=true&amp;amp;facet.sort=index&amp;amp;facet.overrequest.ratio=1.1832508),extra(rows=0&amp;amp;q=*%3A*&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tl&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_tdt1&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_y_s&amp;amp;_test_min=16&amp;amp;_test_miss=true&amp;amp;_test_sort=index)} ==&amp;gt; pivot_b,pivot_f,pivot_dt1: {params(rows=0),defaults({main(rows=0&amp;amp;q=*%3A*&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tl&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_tdt1&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_y_s&amp;amp;_test_min=16&amp;amp;_test_miss=true&amp;amp;_test_sort=index),extra(fq=-pivot_b%3A%5B*+TO+*%5D)})} expected:&amp;lt;17&amp;gt; but was:&amp;lt;22&amp;gt;


   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=4FE0B7EDE128DBAA -Dtests.slow=true -Dtests.locale=ga -Dtests.timezone=America/Detroit -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 34.7s J10 | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {main(facet=true&amp;amp;facet.pivot=%7B%21stats%3Dst2%7Dpivot_f%2Cdense_pivot_i1&amp;amp;facet.pivot=pivot_f%2Cdense_pivot_x_s1%2Cbogus_not_in_any_doc_s&amp;amp;facet.limit=13&amp;amp;facet.pivot.mincount=5&amp;amp;facet.missing=true&amp;amp;facet.sort=index&amp;amp;facet.overrequest.count=0&amp;amp;facet.overrequest.ratio=0),extra(rows=0&amp;amp;q=*%3A*&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_x_s1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_i1&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Dpivot_dt1&amp;amp;_test_min=5&amp;amp;_test_miss=true&amp;amp;_test_sort=index)} ==&amp;gt; pivot_f,dense_pivot_i1: {params(rows=0),defaults({main({main(rows=0&amp;amp;q=*%3A*&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_x_s1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_i1&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Dpivot_dt1&amp;amp;_test_min=5&amp;amp;_test_miss=true&amp;amp;_test_sort=index),extra(fq=%7B%21term+f%3Dpivot_f%7D0.33333334)}),extra(fq=-dense_pivot_i1%3A%5B*+TO+*%5D)})} expected:&amp;lt;6&amp;gt; but was:&amp;lt;7&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14640775" author="jira-bot" created="Fri, 24 Jul 2015 17:34:09 +0000"  >&lt;p&gt;Commit 1692552 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1692552&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1692552&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7804&quot; title=&quot;TestCloudPivotFacet failures: expected:&amp;lt;X&amp;gt; but was:&amp;lt;Y&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7804&quot;&gt;SOLR-7804&lt;/a&gt;: Fix test bug where it was randomly generating 2 identical facet.pivot params w/o realizing it&lt;/p&gt;</comment>
                            <comment id="14640785" author="jira-bot" created="Fri, 24 Jul 2015 17:40:38 +0000"  >&lt;p&gt;Commit 1692554 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1692554&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1692554&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7804&quot; title=&quot;TestCloudPivotFacet failures: expected:&amp;lt;X&amp;gt; but was:&amp;lt;Y&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7804&quot;&gt;SOLR-7804&lt;/a&gt;: Fix test bug where it was randomly generating 2 identical facet.pivot params w/o realizing it (merge r1692552)&lt;/p&gt;</comment>
                            <comment id="14640899" author="hossman" created="Fri, 24 Jul 2015 18:40:17 +0000"  >&lt;p&gt;Confirmed the facet.missing count discrepency is a definite code bug, and split it off into it&apos;s own issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7829&quot; title=&quot;Pivot Facet Bug: facet.missing=true + facet.sort=index facet.pivot.mincount &amp;gt; ? == incorrect &amp;quot;missing&amp;quot; count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7829&quot;&gt;&lt;del&gt;SOLR-7829&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Will resolve this issue once that fix is in place and i confirm these seeds start working again.&lt;/p&gt;</comment>
                            <comment id="14641036" author="steve_rowe" created="Fri, 24 Jul 2015 20:35:04 +0000"  >&lt;p&gt;I looked through recent failures on my Jenkins for more seeds, and found no more seeds for the previously identified failure modes (I don&apos;t think anyway).  I found two that look like they trigger an OOM (I&apos;ll give info in a following comment), and one that looks like another test bug (rounding/no epsilon?) - branch_5x / r1692571 / Java8:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=2701C0115CD1BF95 -Dtests.slow=true -Dtests.locale=ja_JP -Dtests.timezone=Asia/Riyadh -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 46.9s | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {main(facet=true&amp;amp;facet.pivot=%7B%21stats%3Dst1%7Dpivot_y_s1%2Cdense_pivot_y_s%2Cdense_pivot_ti1&amp;amp;facet.limit=9&amp;amp;facet.sort=index),extra(rows=0&amp;amp;q=id%3A%5B*+TO+304%5D&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tf1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_x_s&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_ti1&amp;amp;_test_sort=index)} ==&amp;gt; Sum of sk1 =&amp;gt; pivot_y_s1,dense_pivot_y_s,dense_pivot_ti1: {params(rows=0),defaults({main(rows=0&amp;amp;q=id%3A%5B*+TO+304%5D&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tf1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_x_s&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_ti1&amp;amp;_test_sort=index),extra(fq=%7B%21term+f%3Dpivot_y_s1%7Dh)})} expected:&amp;lt;-1.2722582464444444E9&amp;gt; but was:&amp;lt;-1.2722582464444442E9&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([2701C0115CD1BF95:AF55FFCBF22DD26D]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:286)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.test(TestCloudPivotFacet.java:233)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:963)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:938)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError: Sum of sk1 =&amp;gt; pivot_y_s1,dense_pivot_y_s,dense_pivot_ti1: {params(rows=0),defaults({main(rows=0&amp;amp;q=id%3A%5B*+TO+304%5D&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tf1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_x_s&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_ti1&amp;amp;_test_sort=index),extra(fq=%7B%21term+f%3Dpivot_y_s1%7Dh)})} expected:&amp;lt;-1.2722582464444444E9&amp;gt; but was:&amp;lt;-1.2722582464444442E9&amp;gt;
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertNumerics(TestCloudPivotFacet.java:738)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotStats(TestCloudPivotFacet.java:394)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotData(TestCloudPivotFacet.java:344)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:307)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:276)
   [junit4]    &amp;gt; 	... 42 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14641088" author="steve_rowe" created="Fri, 24 Jul 2015 21:20:19 +0000"  >&lt;p&gt;About the OOM failure mode: I don&apos;t have time to fully investigate ATM (and it&apos;s not clear that this is directly as a result of TestCloudPivotFacet or pivot faceting), but here&apos;s the only Jenkins job I still have (the other one was removed after X builds had been run) - one of these two (forget which one) reproduced for me, even with &lt;tt&gt;-Xmx2g&lt;/tt&gt; : &lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-5.x-Java8/744/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-5.x-Java8/744/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 604839 ERROR (qtp1541684701-1973) [n:127.0.0.1:52056_i%2Fi c:collection1 s:shard1 r:core_node4 x:collection1] o.a.s.s.SolrDispatchFilter null:java.lang.RuntimeException: java.lang.OutOfMemoryError: GC overhead limit exceeded
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=758FAB738FCA688C -Dtests.slow=true -Dtests.locale=in -Dtests.timezone=Africa/Libreville -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR    471s J2  | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.RuntimeException: init query failed: {main(facet=true&amp;amp;facet.pivot=%7B%21stats%3Dst2%7Dpivot_f1%2Cpivot_tdt%2Cpivot_tl&amp;amp;facet.pivot=%7B%21stats%3Dst2%7Dpivot_tdt%2Cpivot_y_s%2Cdense_pivot_i1&amp;amp;facet.limit=17&amp;amp;facet.offset=7&amp;amp;facet.missing=true&amp;amp;facet.overrequest.count=5),extra(rows=0&amp;amp;q=id%3A%5B*+TO+351%5D&amp;amp;fq=id%3A%5B*+TO+717%5D&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Ddense_pivot_y_s1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Ddense_pivot_y_s1&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Dpivot_tdt&amp;amp;_test_miss=true)}: No live SolrServers available to handle this request:[http://127.0.0.1:55265/i/i/collection1, http://127.0.0.1:52056/i/i/collection1]
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([758FAB738FCA688C:FDDB94A921360574]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:255)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.test(TestCloudPivotFacet.java:228)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:963)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:938)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request:[http://127.0.0.1:55265/i/i/collection1, http://127.0.0.1:52056/i/i/collection1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The other one I only have an email from Jenkins, which doesn&apos;t include the repro line, but has the seed in the stack trace:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.RuntimeException: init query failed: {main(facet=true&amp;amp;facet.pivot=%7B%21stats%3Dst3%7Dpivot_dt1%2Cpivot_x_s%2Cpivot_i&amp;amp;facet.pivot=%7B%21stats%3Dst1%7Dpivot_z_s%2Cpivot_y_s%2Cpivot_x_s&amp;amp;facet.limit=17&amp;amp;facet.offset=5&amp;amp;facet.pivot.mincount=314&amp;amp;facet.missing=false&amp;amp;facet.sort=count&amp;amp;facet.overrequest.ratio=1.4131997),extra(rows=0&amp;amp;q=*%3A*&amp;amp;fq=id%3A%5B*+TO+235%5D&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_z_s&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dbogus_not_in_any_doc_s&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Dpivot_l1&amp;amp;_test_min=314&amp;amp;_test_miss=false&amp;amp;_test_sort=count)}: No live SolrServers available to handle this request:[http://127.0.0.1:56936/collection1, http://127.0.0.1:50452/collection1]
	at __randomizedtesting.SeedInfo.seed([2CA9EAEEE4A8D506:A4FDD5344A54B8FE]:0)
	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:255)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14645038" author="jira-bot" created="Tue, 28 Jul 2015 21:01:58 +0000"  >&lt;p&gt;Commit 1693160 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1693160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1693160&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7804&quot; title=&quot;TestCloudPivotFacet failures: expected:&amp;lt;X&amp;gt; but was:&amp;lt;Y&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7804&quot;&gt;SOLR-7804&lt;/a&gt;: fix test bug that caused incorrect epsilon comparisons when expected value is negative.  also fix bug in &quot;test the test&quot; sanity checks of epsilon comparisons&lt;/p&gt;</comment>
                            <comment id="14645040" author="jira-bot" created="Tue, 28 Jul 2015 21:04:31 +0000"  >&lt;p&gt;Commit 1693162 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1693162&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1693162&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7804&quot; title=&quot;TestCloudPivotFacet failures: expected:&amp;lt;X&amp;gt; but was:&amp;lt;Y&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7804&quot;&gt;SOLR-7804&lt;/a&gt;: fix test bug that caused incorrect epsilon comparisons when expected value is negative.  also fix bug in &quot;test the test&quot; sanity checks of epsilon comparisons (merge r1693160)&lt;/p&gt;</comment>
                            <comment id="14645048" author="hossman" created="Tue, 28 Jul 2015 21:08:55 +0000"  >&lt;p&gt;There was definitely an epsilon bug when dealing with expected values that were negative ... unrelated to that, while update the sanity check of the epsilon assertion function i realized all the existing sanity checks where flawed (it expected an assert which was then ignored for being &quot;correct&quot;, but if we didn&apos;t get the assert we expected, it threw a new assert ... which the same catch block ignored.)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;The OOM situation is tricky ... basically some random permutations are just the worst of all possible worlds (max# of facet.pivot params, max# fields in each pivot, sparse fields that need lots of refinement, max randomized facet.offset, max randomized facet.limit, max randomized overrequest, stats on all pivots, etc...)   I need to figure out how to tweak things so that if one set of params are already &quot;worst case&quot; then other param randomization is dialed back &amp;#8211; I don&apos;t just wan to hobble all the randomization to be small enough that it still works in the wosrt case situation.&lt;/p&gt;

&lt;p&gt;i&apos;ll think about this a bit more....&lt;/p&gt;</comment>
                            <comment id="16048908" author="shalinmangar" created="Wed, 14 Jun 2017 09:18:14 +0000"  >&lt;p&gt;I found another failure while testing some changes recently. Then I managed to reproduce the same failure on stock master. I can reproduce the failure with the same seed 1/3 times.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=DAF5E62F5FF49AE9 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=be -Dtests.timezone=Europe/Skopje -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 23.5s | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {main(facet=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;facet.pivot={!stats%3Dst2}dense_pivot_i&amp;amp;facet.limit=8&amp;amp;facet.offset=3&amp;amp;facet.sort=index),extra(rows=0&amp;amp;q=*:*&amp;amp;fq=id:[*+TO+581]&amp;amp;stats=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;stats.field={!key%3Dsk1+tag%3Dst1,st2}pivot_tdt1&amp;amp;stats.field={!key%3Dsk2+tag%3Dst2,st3}pivot_z_s&amp;amp;stats.field={!key%3Dsk3+tag%3Dst3,st4}pivot_f&amp;amp;_test_sort=index)} ==&amp;gt; Stddev of sk1 =&amp;gt; dense_pivot_i: {params(rows=0),defaults({main(rows=0&amp;amp;q=*:*&amp;amp;fq=id:[*+TO+581]&amp;amp;stats=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;stats.field={!key%3Dsk1+tag%3Dst1,st2}pivot_tdt1&amp;amp;stats.field={!key%3Dsk2+tag%3Dst2,st3}pivot_z_s&amp;amp;stats.field={!key%3Dsk3+tag%3Dst3,st4}pivot_f&amp;amp;_test_sort=index),extra(fq={!term+f%3Ddense_pivot_i}24)})} expected:&amp;lt;16921.32243846995&amp;gt; but was:&amp;lt;23930.363685772376&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([DAF5E62F5FF49AE9:52A1D9F5F108F711]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:297)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.test(TestCloudPivotFacet.java:244)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:985)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:960)
   [junit4]    &amp;gt; 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError: Stddev of sk1 =&amp;gt; dense_pivot_i: {params(rows=0),defaults({main(rows=0&amp;amp;q=*:*&amp;amp;fq=id:[*+TO+581]&amp;amp;stats=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;stats.field={!key%3Dsk1+tag%3Dst1,st2}pivot_tdt1&amp;amp;stats.field={!key%3Dsk2+tag%3Dst2,st3}pivot_z_s&amp;amp;stats.field={!key%3Dsk3+tag%3Dst3,st4}pivot_f&amp;amp;_test_sort=index),extra(fq={!term+f%3Ddense_pivot_i}24)})} expected:&amp;lt;16921.32243846995&amp;gt; but was:&amp;lt;23930.363685772376&amp;gt;
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertNumerics(TestCloudPivotFacet.java:748)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotStats(TestCloudPivotFacet.java:407)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotData(TestCloudPivotFacet.java:355)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:318)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:287)
   [junit4]    &amp;gt; 	... 42 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16670242" author="steve_rowe" created="Wed, 31 Oct 2018 15:27:48 +0000"  >&lt;p&gt;Another failure from &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-NightlyTests-7.x/363&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-NightlyTests-7.x/363&lt;/a&gt;, reproduces for me 10/10 iterations:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Checking out Revision e8503da7c43b8ff3eb968c631ca2ac718a2c736b (refs/remotes/origin/branch_7x)
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=E8745FA6D96CE260 -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/jenkins-slave/workspace/Lucene-Solr-NightlyTests-7.x/test-data/enwiki.random.lines.txt -Dtests.locale=ko-KR -Dtests.timezone=Pacific/Samoa -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 37.2s J1 | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {main(facet=true&amp;amp;facet.pivot={!stats%3Dst0}bogus_not_in_any_doc_s&amp;amp;facet.pivot={!stats%3Dst2}pivot_z_s1,pivot_x_s,pivot_tdt&amp;amp;facet.limit=15&amp;amp;facet.missing=true&amp;amp;facet.sort=index&amp;amp;facet.overrequest.count=0),extra(rows=0&amp;amp;q=*:*&amp;amp;stats=true&amp;amp;stats.field={!key%3Dsk1+tag%3Dst1,st2}pivot_d&amp;amp;stats.field={!key%3Dsk2+tag%3Dst2,st3}pivot_dt1&amp;amp;stats.field={!key%3Dsk3+tag%3Dst3,st4}pivot_z_s&amp;amp;_test_miss=true&amp;amp;_test_sort=index)} ==&amp;gt; Stddev of sk2 =&amp;gt; pivot_z_s1,pivot_x_s,pivot_tdt: {params(rows=0),defaults({main({main(rows=0&amp;amp;q=*:*&amp;amp;stats=true&amp;amp;stats.field={!key%3Dsk1+tag%3Dst1,st2}pivot_d&amp;amp;stats.field={!key%3Dsk2+tag%3Dst2,st3}pivot_dt1&amp;amp;stats.field={!key%3Dsk3+tag%3Dst3,st4}pivot_z_s&amp;amp;_test_miss=true&amp;amp;_test_sort=index),extra(fq={!term+f%3Dpivot_z_s1}a)}),extra(fq={!term+f%3Dpivot_x_s}b)})} expected:&amp;lt;0.0&amp;gt; but was:&amp;lt;20724.30287367949&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([E8745FA6D96CE260:6020607C77908F98]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:292)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.test(TestCloudPivotFacet.java:239)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:1010)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:985)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError: Stddev of sk2 =&amp;gt; pivot_z_s1,pivot_x_s,pivot_tdt: {params(rows=0),defaults({main({main(rows=0&amp;amp;q=*:*&amp;amp;stats=true&amp;amp;stats.field={!key%3Dsk1+tag%3Dst1,st2}pivot_d&amp;amp;stats.field={!key%3Dsk2+tag%3Dst2,st3}pivot_dt1&amp;amp;stats.field={!key%3Dsk3+tag%3Dst3,st4}pivot_z_s&amp;amp;_test_miss=true&amp;amp;_test_sort=index),extra(fq={!term+f%3Dpivot_z_s1}a)}),extra(fq={!term+f%3Dpivot_x_s}b)})} expected:&amp;lt;0.0&amp;gt; but was:&amp;lt;20724.30287367949&amp;gt;
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertNumerics(TestCloudPivotFacet.java:743)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotStats(TestCloudPivotFacet.java:402)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotData(TestCloudPivotFacet.java:350)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:313)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:324)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:282)
   [junit4]    &amp;gt; 	... 42 more
[...]
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene70): {dense_pivot_y_s=FSTOrd50, multiDefault=FSTOrd50, pivot_x_s=PostingsFormat(name=Memory), pivot_b1=FSTOrd50, pivot_x_s1=PostingsFormat(name=Direct), pivot_y_s=FSTOrd50, pivot_z_s=PostingsFormat(name=MockRandom), pivot_y_s1=PostingsFormat(name=Memory), pivot_z_s1=FSTOrd50, id=PostingsFormat(name=MockRandom), dense_pivot_x_s1=PostingsFormat(name=Direct), pivot_b=PostingsFormat(name=MockRandom), dense_pivot_y_s1=PostingsFormat(name=Memory), dense_pivot_x_s=PostingsFormat(name=MockRandom)}, docValues:{pivot_dt1=DocValuesFormat(name=Direct), dense_pivot_i1=DocValuesFormat(name=Asserting), pivot_l1=DocValuesFormat(name=Lucene70), range_facet_l_dv=DocValuesFormat(name=Asserting), multiDefault=DocValuesFormat(name=Direct), pivot_f1=DocValuesFormat(name=Direct), intDefault=DocValuesFormat(name=Lucene70), pivot_d1=DocValuesFormat(name=Lucene70), pivot_x_s=DocValuesFormat(name=Memory), pivot_b1=DocValuesFormat(name=Direct), pivot_dt=DocValuesFormat(name=Asserting), dense_pivot_ti1=DocValuesFormat(name=Asserting), range_facet_l=DocValuesFormat(name=Lucene70), pivot_y_s=DocValuesFormat(name=Direct), pivot_x_s1=DocValuesFormat(name=Lucene70), pivot_z_s=DocValuesFormat(name=Asserting), dense_pivot_ti=DocValuesFormat(name=Lucene70), pivot_z_s1=DocValuesFormat(name=Direct), pivot_tl1=DocValuesFormat(name=Direct), id=DocValuesFormat(name=Asserting), intDvoDefault=DocValuesFormat(name=Memory), dense_pivot_x_s1=DocValuesFormat(name=Lucene70), timestamp=DocValuesFormat(name=Lucene70), pivot_td1=DocValuesFormat(name=Direct), dense_pivot_y_s=DocValuesFormat(name=Direct), pivot_tdt=DocValuesFormat(name=Memory), pivot_i1=DocValuesFormat(name=Asserting), pivot_tf1=DocValuesFormat(name=Lucene70), pivot_td=DocValuesFormat(name=Asserting), pivot_tf=DocValuesFormat(name=Memory), pivot_f=DocValuesFormat(name=Asserting), pivot_ti=DocValuesFormat(name=Lucene70), pivot_tl=DocValuesFormat(name=Asserting), pivot_i=DocValuesFormat(name=Direct), _version_=DocValuesFormat(name=Lucene70), pivot_l=DocValuesFormat(name=Memory), pivot_y_s1=DocValuesFormat(name=Memory), id_i1=DocValuesFormat(name=Direct), pivot_ti1=DocValuesFormat(name=Memory), range_facet_i_dv=DocValuesFormat(name=Lucene70), dense_pivot_i=DocValuesFormat(name=Direct), pivot_b=DocValuesFormat(name=Asserting), pivot_tdt1=DocValuesFormat(name=Lucene70), pivot_d=DocValuesFormat(name=Memory), dense_pivot_y_s1=DocValuesFormat(name=Memory), dense_pivot_x_s=DocValuesFormat(name=Asserting)}, maxPointsInLeafNode=1001, maxMBSortInHeap=7.105595273305583, sim=RandomSimilarity(queryNorm=false): {}, locale=ko-KR, timezone=Pacific/Samoa
   [junit4]   2&amp;gt; NOTE: Linux 4.4.0-137-generic amd64/Oracle Corporation 1.8.0_172 (64-bit)/cpus=4,threads=1,free=228378136,total=520617984
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16672035" author="hossman" created="Thu, 1 Nov 2018 19:07:32 +0000"  >&lt;p&gt;Ok ... so here&apos;s what&apos;s happening in both the seed sarowe mentioned, (and I believe the failure shalin mentioned a year ago that i didn&apos;t notice at the time)...&lt;/p&gt;

&lt;p&gt;When I wrote this test way way back, I knew &amp;amp; recognized that when dealing with floating point values, the order that the docs were collected in a shard, and the intermediate stats (sum &amp;amp; sumOfSquares) were accumulated from multiple shards, could intoduce subtle variations in the final values &#8211; the classic &quot;due to precision loss, the &lt;em&gt;order&lt;/em&gt; of a sequence of additions of flots|doubles matters&quot;&lt;/p&gt;

&lt;p&gt;I even tried to be smart, and wrote the test to expect a bit of epsillon when looking at stats on Doubles and Floats.&lt;/p&gt;

&lt;p&gt;What I forgot at the time was that when computing stats for &lt;b&gt;Date&lt;/b&gt; fields, floating point intermediate values are used (because the sum|sumOfSquares for a lot of big longs can easily overflow a long) ... so while the final &quot;mean&quot; value may be a Date object, the &quot;millisSinceEpoch&quot; used to build that date comes from a &lt;tt&gt;(long)(((double)sum)/((long)count))&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I also didn&apos;t account for the fact that my &quot;pick an epsilon based on the magnitude of the expected value&quot; wasn&apos;t going to work well when the expected value is &quot;0.0&quot;.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;I could update the test to make the Date comparisons also use an epsilon and be lossy to account for hte intermediate floating point math, and update the epsilon calculation for things like stddev to be based on the min/max ... but ultimatley i think we should just completely remove the checks of lossy stats ....&lt;/p&gt;

&lt;p&gt;This test really isn&apos;t about stats. It tries to verify that stats computed on pivot facet buckets match equivilent stats for queries against those bucket constraints because it wants to ensure the delegation of pivot faceting to stats works &#8211; but this same type of subtle inconsistentcies that cause these failures can exist if you just did a top level stats request against a query (w/o using faceting) over and over and get differnet replica orders on the distributed merge.&lt;/p&gt;

&lt;p&gt;So i think what makes sense is to simplify the test and only bother collecting the basic stats that should &lt;b&gt;never&lt;/b&gt; be lossy (count, missing, min, max) regardless of field type, and disable the other stats.&#160; that will give us plenty of sanity checking that hanging stats on pivots works correctly.&lt;/p&gt;

&lt;p&gt;I&apos;ll work this up, hammer on it, and commit ASAP.&lt;/p&gt;</comment>
                            <comment id="16672571" author="jira-bot" created="Fri, 2 Nov 2018 05:06:21 +0000"  >&lt;p&gt;Commit a807cd234b6a8c148a90c1418ee56d31e872f533 in lucene-solr&apos;s branch refs/heads/branch_7x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a807cd2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a807cd2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7804&quot; title=&quot;TestCloudPivotFacet failures: expected:&amp;lt;X&amp;gt; but was:&amp;lt;Y&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7804&quot;&gt;SOLR-7804&lt;/a&gt;: remove problematic assertions on lossy stats.field values that aren&apos;t fundemental to the purpose of the test anyway&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1e0e8d45e5f30ed08853db1e8a941ef82c6977a4)&lt;/p&gt;</comment>
                            <comment id="16672572" author="jira-bot" created="Fri, 2 Nov 2018 05:06:23 +0000"  >&lt;p&gt;Commit 1e0e8d45e5f30ed08853db1e8a941ef82c6977a4 in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1e0e8d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1e0e8d4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7804&quot; title=&quot;TestCloudPivotFacet failures: expected:&amp;lt;X&amp;gt; but was:&amp;lt;Y&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7804&quot;&gt;SOLR-7804&lt;/a&gt;: remove problematic assertions on lossy stats.field values that aren&apos;t fundemental to the purpose of the test anyway&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12848969">SOLR-7829</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13195817">SOLR-12954</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hdxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>