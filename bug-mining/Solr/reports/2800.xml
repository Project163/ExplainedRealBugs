<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:11:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8496] Facet search count numbers are falsified by older document versions when multi-select is used</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8496</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Our setup is based on multiple cores. In One core we have a multi-filed with integer values. and some other unimportant fields. We&apos;re using multi-faceting for this field.&lt;/p&gt;

&lt;p&gt;We&apos;re querying a test scenario with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/core-name/select?q=dummyask: (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) AND manufacturer: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; AND id: (15039 16882 10850 20781)&amp;amp;fq={!tag=professions}professions: (59)&amp;amp;fl=id&amp;amp;wt=json&amp;amp;indent=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;facet=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;facet.field={!ex=professions}professions&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Query: (numDocs:48545, maxDoc:48545)
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;response&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;0&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;1&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;result name=&lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt; numFound=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; start=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;10850&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;16882&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;15039&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;20781&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/result&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_counts&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_queries&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_fields&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;professions&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;59&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;4&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_dates&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_ranges&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_intervals&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_heatmaps&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/response&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Then we update one document and change some fields (numDocs:48545, maxDoc:48546) &lt;b&gt;The number of maxDocs is increased&lt;/b&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;response&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;0&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;1&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;result name=&lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt; numFound=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; start=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;10850&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;16882&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;15039&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;20781&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/doc&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/result&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_counts&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_queries&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_fields&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;professions&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;int name=&lt;span class=&quot;code-quote&quot;&gt;&quot;59&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;5&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/int&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_dates&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_ranges&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_intervals&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;facet_heatmaps&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/lst&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/response&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;The Problem:&lt;/b&gt;&lt;br/&gt;
In the first query, we&apos;re getting a facet count of 4, which is correct. After updating one document, we&apos;re getting 5 as a result wich is not correct.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux 3.16.0-4-amd64 x86_64 Debian 8.2&lt;br/&gt;
openjdk-7-jre-headless:amd64   version 7u91-2.6.3-1~deb8u1&lt;br/&gt;
solr-5.4.0, extracted from official tar&lt;br/&gt;
Default solr settings from install script:SOLR_HEAP=&quot;512m&quot;&lt;br/&gt;
GC_LOG_OPTS=&quot;-verbose:gc -XX:+PrintHeapAtGC -XX:+PrintGCDetails \&lt;br/&gt;
-XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime&quot;&lt;br/&gt;
GC_TUNE=&quot;-XX:NewRatio=3 \&lt;br/&gt;
-XX:SurvivorRatio=4 \&lt;br/&gt;
-XX:TargetSurvivorRatio=90 \&lt;br/&gt;
-XX:MaxTenuringThreshold=8 \&lt;br/&gt;
-XX:+UseConcMarkSweepGC \&lt;br/&gt;
-XX:+UseParNewGC \&lt;br/&gt;
-XX:ConcGCThreads=4 -XX:ParallelGCThreads=4 \&lt;br/&gt;
-XX:+CMSScavengeBeforeRemark \&lt;br/&gt;
-XX:PretenureSizeThreshold=64m \&lt;br/&gt;
-XX:+UseCMSInitiatingOccupancyOnly \&lt;br/&gt;
-XX:CMSInitiatingOccupancyFraction=50 \&lt;br/&gt;
-XX:CMSMaxAbortablePrecleanTime=6000 \&lt;br/&gt;
-XX:+CMSParallelRemarkEnabled \&lt;br/&gt;
-XX:+ParallelRefProcEnabled&quot;&lt;br/&gt;
SOLR_OPTS=&quot;$SOLR_OPTS -Xss256k&quot;&lt;/p&gt;</environment>
        <key id="12928072">SOLR-8496</key>
            <summary>Facet search count numbers are falsified by older document versions when multi-select is used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="amueller2504">Andreas M&#252;ller</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Jan 2016 17:43:29 +0000</created>
                <updated>Thu, 20 Sep 2018 18:42:19 +0000</updated>
                            <resolved>Sat, 16 Jan 2016 18:30:23 +0000</resolved>
                                    <version>5.4</version>
                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15096369" author="elyograg" created="Wed, 13 Jan 2016 15:44:52 +0000"  >&lt;p&gt;This should really be handled on the mailing list.  I see that you asked on IRC, but you had already been gone from the IRC channel for 45 minutes before I got reconnected to my IRC session (at 8:45 AM in my timezone).&lt;/p&gt;

&lt;p&gt;What exactly does &quot;based on multiple cores&quot; mean?&lt;/p&gt;</comment>
                            <comment id="15098172" author="elyograg" created="Thu, 14 Jan 2016 14:33:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8540&quot; title=&quot;Multi select facets give incorrect results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8540&quot;&gt;&lt;del&gt;SOLR-8540&lt;/del&gt;&lt;/a&gt; is the same problem.  They said they tried docValues and it did not fix the problem.&lt;/p&gt;

&lt;p&gt;Related to your attempts to replicate the problem with simple tests ... if all of the documents in a segment are deleted, the entire segment will be deleted, and the problem will disappear.  You&apos;ll need to run a test where you index several documents at once (so they end up in the same segment), then replace only &lt;b&gt;some&lt;/b&gt; of those documents.  The segment will continue to exist as long as at least one document is not replaced.&lt;/p&gt;</comment>
                            <comment id="15098324" author="elyograg" created="Thu, 14 Jan 2016 16:12:51 +0000"  >&lt;p&gt;One workaround is optimizing the index, but this is not a good workaround for most people, especially when changes are small and very frequent.&lt;/p&gt;</comment>
                            <comment id="15098335" author="elyograg" created="Thu, 14 Jan 2016 16:19:38 +0000"  >&lt;p&gt;Summary of the fundamental symptoms for a committer or contributor that knows the facet code:  In recent versions, facets are no longer excluding deleted documents from the counts.  It looks like this is the case whether facets are using docValues or not.&lt;/p&gt;</comment>
                            <comment id="15098463" author="hossman" created="Thu, 14 Jan 2016 17:29:12 +0000"  >&lt;p&gt;can we get some more details about your configs/schema? ... i&apos;m trying to figure out enough details to be able to reproduce this.&lt;/p&gt;

&lt;p&gt;Using a trivial test with the techproducts example, i can&apos;t seem to reproduce...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@tray:~/lucene/5x_dev/solr$ bin/solr -e techproducts
...
hossman@tray:~/lucene/5x_dev/solr$ curl &apos;http://localhost:8983/solr/techproducts/query?facet=true&amp;amp;facet.field=inStock&amp;amp;q=solr&amp;amp;omitHeader=true&amp;amp;rows=0&apos;
{
  &quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;docs&quot;:[]
  },
  &quot;facet_counts&quot;:{
    &quot;facet_queries&quot;:{},
    &quot;facet_fields&quot;:{
      &quot;inStock&quot;:[
        &quot;true&quot;,1,
        &quot;false&quot;,0]},
    &quot;facet_dates&quot;:{},
    &quot;facet_ranges&quot;:{},
    &quot;facet_intervals&quot;:{},
    &quot;facet_heatmaps&quot;:{}}}
...
hossman@tray:~/lucene/5x_dev/solr$ bin/post -c techproducts example/exampledocs/solr.xml 
...
hossman@tray:~/lucene/5x_dev/solr$ curl &apos;http://localhost:8983/solr/techproducts/query?facet=true&amp;amp;facet.field=inStock&amp;amp;q=solr&amp;amp;omitHeader=true&amp;amp;rows=0&apos;
{
  &quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;docs&quot;:[]
  },
  &quot;facet_counts&quot;:{
    &quot;facet_queries&quot;:{},
    &quot;facet_fields&quot;:{
      &quot;inStock&quot;:[
        &quot;true&quot;,1,
        &quot;false&quot;,0]},
    &quot;facet_dates&quot;:{},
    &quot;facet_ranges&quot;:{},
    &quot;facet_intervals&quot;:{},
    &quot;facet_heatmaps&quot;:{}}}
hossman@tray:~/lucene/5x_dev/solr$ curl -sS &apos;http://localhost:8983/solr/techproducts/admin/luke?wt=json&amp;amp;indent=true&apos; | egrep &quot;maxDoc|numDoc&quot;
    &quot;numDocs&quot;:32,
    &quot;maxDoc&quot;:33,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15098779" author="erickerickson" created="Thu, 14 Jan 2016 20:22:30 +0000"  >&lt;p&gt;I couldn&apos;t reproduce with a test case either in a JUnit test (non Cloud, one core).&lt;/p&gt;</comment>
                            <comment id="15098922" author="hossman" created="Thu, 14 Jan 2016 21:36:38 +0000"  >&lt;p&gt;Also: does this reproduce for you when indexing from scratch, or is this an index you originally built with an older version of Solr and then upgraded to 5.4? (trying to figure out if there are older segments and maybe the bug is specific to 5.4 reading deleted docs from those older segments)&lt;/p&gt;

&lt;p&gt;can you also run CheckIndex (command line) and provide all of that output?&lt;/p&gt;</comment>
                            <comment id="15101708" author="vasiliy.bout" created="Fri, 15 Jan 2016 12:28:34 +0000"  >&lt;p&gt;You do not use multi-select faceting in your simple test. Multi select local parameters are necessary to reproduce this issue. You can see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8540&quot; title=&quot;Multi select facets give incorrect results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8540&quot;&gt;&lt;del&gt;SOLR-8540&lt;/del&gt;&lt;/a&gt;, there is a complete description of when this issue occurs.&lt;/p&gt;</comment>
                            <comment id="15101737" author="vasiliy.bout" created="Fri, 15 Jan 2016 13:02:37 +0000"  >&lt;p&gt;When I tried to reproduce this issue on a new empty test core, I did the following:&lt;/p&gt;

&lt;p&gt;1. Fill the core with a number of documents&lt;br/&gt;
2. Overwrite some documents in the core, i.e. add new documents with the same &lt;tt&gt;id&lt;/tt&gt; as were added before.&lt;/p&gt;

&lt;p&gt;After that you can see, that in &quot;Schema Browser&quot; when you select your field and press &quot;Load Term Info&quot; counts for your field are incorrect (they take into account also old versions of the overwritten documents). And you can see that normal faceting gives correct results but multi select faceting gives incorrect results (the same you saw in &quot;Load Term Info&quot; counts).&lt;/p&gt;</comment>
                            <comment id="15101815" author="amueller2504" created="Fri, 15 Jan 2016 14:17:41 +0000"  >&lt;p&gt;We did a complete new index from scratch. There 48545 docs in the index. The effect only occurred if there are 10k docs in the index. In the following our solr configuration and scheme and the output of CacheIndex&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;solrconfig.xml&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;config&amp;gt;
  &amp;lt;luceneMatchVersion&amp;gt;4.5&amp;lt;/luceneMatchVersion&amp;gt;
  &amp;lt;!--  The DirectoryFactory to use &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; indexes.
        solr.StandardDirectoryFactory, the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, is filesystem based.
        solr.RAMDirectoryFactory is memory based, not persistent, and doesn&apos;t work with replication. --&amp;gt;
  &amp;lt;directoryFactory name=&lt;span class=&quot;code-quote&quot;&gt;&quot;DirectoryFactory&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;${solr.directoryFactory:solr.StandardDirectoryFactory}&quot;&lt;/span&gt;/&amp;gt;

  &amp;lt;updateHandler class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.DirectUpdateHandler2&quot;&lt;/span&gt;&amp;gt;
   &amp;lt;autoSoftCommit&amp;gt;
        &amp;lt;maxTime&amp;gt;1000&amp;lt;/maxTime&amp;gt;
    &amp;lt;/autoSoftCommit&amp;gt;
    &amp;lt;autoCommit&amp;gt;
        &amp;lt;maxTime&amp;gt;60000&amp;lt;/maxTime&amp;gt; 
        &amp;lt;openSearcher&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/openSearcher&amp;gt;
    &amp;lt;/autoCommit&amp;gt;
  &amp;lt;/updateHandler&amp;gt;


  &amp;lt;requestDispatcher handleSelect=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; &amp;gt;
    &amp;lt;requestParsers enableRemoteStreaming=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; multipartUploadLimitInKB=&lt;span class=&quot;code-quote&quot;&gt;&quot;2048&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;/requestDispatcher&amp;gt;
  
  &amp;lt;requestHandler name=&lt;span class=&quot;code-quote&quot;&gt;&quot;standard&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.StandardRequestHandler&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;requestHandler name=&lt;span class=&quot;code-quote&quot;&gt;&quot;/update&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.UpdateRequestHandler&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;requestHandler name=&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin/&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.handler.admin.AdminHandlers&quot;&lt;/span&gt; /&amp;gt;
      
  &amp;lt;!-- config &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the admin &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; --&amp;gt; 
  &amp;lt;admin&amp;gt;
    &amp;lt;defaultQuery&amp;gt;solr&amp;lt;/defaultQuery&amp;gt;
  &amp;lt;/admin&amp;gt;

&amp;lt;/config&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;schema.xml&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;schema name=&lt;span class=&quot;code-quote&quot;&gt;&quot;company comptest3&quot;&lt;/span&gt; version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.1&quot;&lt;/span&gt;&amp;gt;

    &amp;lt;types&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.StrField&quot;&lt;/span&gt; sortMissingLast=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;!-- &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; type: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; --&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.BoolField&quot;&lt;/span&gt; sortMissingLast=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;!-- Default numeric field types. For faster range queries, consider the tint/tfloat/tlong/tdouble types. --&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TrieIntField&quot;&lt;/span&gt; precisionStep=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;date&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TrieDateField&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; precisionStep=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TrieLongField&quot;&lt;/span&gt; precisionStep=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;!-- lat &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; fields --&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TrieDoubleField&quot;&lt;/span&gt; precisionStep=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;!-- A Trie based date field &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; faster date range queries and date faceting. --&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;tdate&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TrieDateField&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; precisionStep=&lt;span class=&quot;code-quote&quot;&gt;&quot;6&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;!-- A text field that only splits on whitespace &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; exact matching of words --&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;text_ws&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;analyzer&amp;gt;
                &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/analyzer&amp;gt;
        &amp;lt;/fieldType&amp;gt;

        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;analyzer type=&lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WordDelimiterFilterFactory&quot;&lt;/span&gt; generateWordParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; generateNumberParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateWords=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateNumbers=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateAll=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; splitOnCaseChange=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/analyzer&amp;gt;
            &amp;lt;analyzer type=&lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WordDelimiterFilterFactory&quot;&lt;/span&gt; generateWordParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; generateNumberParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateWords=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; catenateNumbers=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; catenateAll=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; splitOnCaseChange=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/analyzer&amp;gt;
        &amp;lt;/fieldType&amp;gt;

        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;text_rev&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt;&amp;gt;

            &amp;lt;analyzer type=&lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WordDelimiterFilterFactory&quot;&lt;/span&gt; generateWordParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; generateNumberParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateWords=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateNumbers=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateAll=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; splitOnCaseChange=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.ReversedWildcardFilterFactory&quot;&lt;/span&gt; withOriginal=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; maxPosAsterisk=&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt; maxPosQuestion=&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt; maxFractionAsterisk=&lt;span class=&quot;code-quote&quot;&gt;&quot;0.33&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/analyzer&amp;gt;
            &amp;lt;analyzer type=&lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;&amp;gt;
                &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WordDelimiterFilterFactory&quot;&lt;/span&gt; generateWordParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; generateNumberParts=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; catenateWords=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; catenateNumbers=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; catenateAll=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; splitOnCaseChange=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/analyzer&amp;gt;

        &amp;lt;/fieldType&amp;gt;

        &amp;lt;fieldtype name=&lt;span class=&quot;code-quote&quot;&gt;&quot;phonetic&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; &amp;gt;
            &amp;lt;analyzer&amp;gt;
                &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.StandardTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.DoubleMetaphoneFilterFactory&quot;&lt;/span&gt; inject=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/analyzer&amp;gt;
        &amp;lt;/fieldtype&amp;gt;

        &amp;lt;!-- lowercases the entire field value, keeping it as a single token.   --&amp;gt;
        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;analyzer&amp;gt;
                &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.KeywordTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt; /&amp;gt;
            &amp;lt;/analyzer&amp;gt;
        &amp;lt;/fieldType&amp;gt;

        &amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;location&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LatLonType&quot;&lt;/span&gt; subFieldSuffix=&lt;span class=&quot;code-quote&quot;&gt;&quot;_coordinate&quot;&lt;/span&gt;/&amp;gt;

    &amp;lt;/types&amp;gt;

    &amp;lt;fields&amp;gt;
        &amp;lt;!-- general --&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;                    type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;           indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; required=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;dummyask&quot;&lt;/span&gt;              type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;&quot;&lt;/span&gt;       indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;disabled&quot;&lt;/span&gt;              type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;&quot;&lt;/span&gt;       indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;closed&quot;&lt;/span&gt;                type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;&quot;&lt;/span&gt;       indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;show&quot;&lt;/span&gt;                  type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;&quot;&lt;/span&gt;       indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;pagecalls&quot;&lt;/span&gt;             type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;           indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;publicated&quot;&lt;/span&gt;            type=&lt;span class=&quot;code-quote&quot;&gt;&quot;tdate&quot;&lt;/span&gt;         indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;

        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;                  type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text_rev&quot;&lt;/span&gt;      indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name_filtered&quot;&lt;/span&gt;         type=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt;     indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name_phonetic&quot;&lt;/span&gt;         type=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt;     indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;manufacturer&quot;&lt;/span&gt;          type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;&quot;&lt;/span&gt;       indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fulltext&quot;&lt;/span&gt;              type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text_rev&quot;&lt;/span&gt;      indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;owner&quot;&lt;/span&gt;                 type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text_rev&quot;&lt;/span&gt;      indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;member&quot;&lt;/span&gt;                type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;&quot;&lt;/span&gt;       indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;professions&quot;&lt;/span&gt;           type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&quot;&lt;/span&gt;          indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;founding&quot;&lt;/span&gt;              type=&lt;span class=&quot;code-quote&quot;&gt;&quot;tdate&quot;&lt;/span&gt;         indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;employee_number&quot;&lt;/span&gt;       type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;           indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;jobs&quot;&lt;/span&gt;                  type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;&quot;&lt;/span&gt;       indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;image&quot;&lt;/span&gt;                 type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt;          indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;

        &amp;lt;!-- geografic options --&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;ort&quot;&lt;/span&gt;                   type=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt;     indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;plz&quot;&lt;/span&gt;                   type=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt;     indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;land&quot;&lt;/span&gt;                  type=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt;     indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;bundesland&quot;&lt;/span&gt;            type=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt;     indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;lat&quot;&lt;/span&gt;                   type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;&quot;&lt;/span&gt;        indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;lon&quot;&lt;/span&gt;                   type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;&quot;&lt;/span&gt;        indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;geo&quot;&lt;/span&gt;                   type=&lt;span class=&quot;code-quote&quot;&gt;&quot;location&quot;&lt;/span&gt;      indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;geo_0_coordinate&quot;&lt;/span&gt;      type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;&quot;&lt;/span&gt;        indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;geo_1_coordinate&quot;&lt;/span&gt;      type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;&quot;&lt;/span&gt;        indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;

        &amp;lt;!-- display fields --&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;profession_display&quot;&lt;/span&gt;    type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt;          indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;address_display&quot;&lt;/span&gt;       type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text_rev&quot;&lt;/span&gt;      indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;  stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;

        &amp;lt;!-- realized projects --&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;done_projects&quot;&lt;/span&gt;         type=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt;     indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;  stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;!-- projects in planing / projects in construction --&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;projects&quot;&lt;/span&gt;              type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&quot;&lt;/span&gt;          indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;  stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;!-- references --&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;references&quot;&lt;/span&gt;            type=&lt;span class=&quot;code-quote&quot;&gt;&quot;lowercase&quot;&lt;/span&gt;     indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;reference_info&quot;&lt;/span&gt;        type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt;          indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;relevance&quot;&lt;/span&gt;             type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;           indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; multiValued=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;

        &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;_version_&quot;&lt;/span&gt;             type=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&quot;&lt;/span&gt;          indexed=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; stored=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;

    &amp;lt;/fields&amp;gt;

    &amp;lt;!-- field to use to determine and enforce document uniqueness. --&amp;gt;
    &amp;lt;uniqueKey&amp;gt;id&amp;lt;/uniqueKey&amp;gt;

    &amp;lt;!-- field &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the QueryParser to use when an explicit fieldname is absent --&amp;gt;
    &amp;lt;defaultSearchField&amp;gt;name&amp;lt;/defaultSearchField&amp;gt;

    &amp;lt;!-- SolrQueryParser configuration: defaultOperator=&lt;span class=&quot;code-quote&quot;&gt;&quot;AND|OR&quot;&lt;/span&gt; --&amp;gt;
    &amp;lt;solrQueryParser defaultOperator=&lt;span class=&quot;code-quote&quot;&gt;&quot;OR&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/schema&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;java -cp ../server/solr-webapp/webapp/WEB-INF/lib/lucene-core-5.4.0.jar -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex ../server/solr/companies/data/index&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Opening index @ ../server/solr/companies/data/index

Segments file=segments_4t numSegments=10 version=5.4.0 id=8b82erk4sdq7dvuluswzgthh5 format= userData={commitTimeMSec=1452862011769}
  1 of 10: name=_3fw maxDoc=44624
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgth5m
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    numFiles=11
    size (MB)=54.18
    diagnostics = {os=Linux, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, mergeMaxNumSegments=-1, os.arch=amd64, java.runtime.version=1.8.0_66-internal-b17, source=merge, mergeFactor=10, os.version=3.11-2-amd64, timestamp=1452857890899}
    has deletions [delGen=5]
    test: open reader.........OK [took 1.244 sec]
    test: check integrity.....OK [took 0.148 sec]
    test: check live docs.....OK [500 deleted docs] [took 0.011 sec]
    test: field infos.........OK [35 fields] [took 0.001 sec]
    test: field norms.........OK [12 fields] [took 0.048 sec]
    test: terms, freq, prox...OK [1119766 terms; 5522980 terms/docs pairs; 6617236 tokens] [took 5.664 sec]
    test: stored fields.......OK [1786969 total field count; avg 40.5 fields per doc] [took 2.215 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.001 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.001 sec]

  2 of 10: name=_3pc maxDoc=1476
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthf8
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
    numFiles=3
    size (MB)=1.988
    diagnostics = {os=Linux, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, mergeMaxNumSegments=-1, os.arch=amd64, java.runtime.version=1.8.0_66-internal-b17, source=merge, mergeFactor=10, os.version=3.11-2-amd64, timestamp=1452861829493}
    no deletions
    test: open reader.........OK [took 0.034 sec]
    test: check integrity.....OK [took 0.006 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [35 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.001 sec]
    test: terms, freq, prox...OK [67708 terms; 174468 terms/docs pairs; 204435 tokens] [took 0.938 sec]
    test: stored fields.......OK [59440 total field count; avg 40.3 fields per doc] [took 0.052 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.000 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.001 sec]

  3 of 10: name=_3pw maxDoc=1426
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthfs
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
    numFiles=3
    size (MB)=2.08
    diagnostics = {os=Linux, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, mergeMaxNumSegments=-1, os.arch=amd64, java.runtime.version=1.8.0_66-internal-b17, source=merge, mergeFactor=10, os.version=3.11-2-amd64, timestamp=1452861864304}
    no deletions
    test: open reader.........OK [took 0.019 sec]
    test: check integrity.....OK [took 0.015 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [35 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.001 sec]
    test: terms, freq, prox...OK [67794 terms; 175792 terms/docs pairs; 216683 tokens] [took 0.836 sec]
    test: stored fields.......OK [62036 total field count; avg 43.5 fields per doc] [took 0.056 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.000 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.000 sec]

  4 of 10: name=_3pm maxDoc=1398
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthfi
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
    numFiles=3
    size (MB)=2.035
    diagnostics = {os=Linux, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, mergeMaxNumSegments=-1, os.arch=amd64, java.runtime.version=1.8.0_66-internal-b17, source=merge, mergeFactor=10, os.version=3.11-2-amd64, timestamp=1452861844413}
    no deletions
    test: open reader.........OK [took 0.016 sec]
    test: check integrity.....OK [took 0.017 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [35 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.001 sec]
    test: terms, freq, prox...OK [67878 terms; 173372 terms/docs pairs; 213758 tokens] [took 0.162 sec]
    test: stored fields.......OK [59498 total field count; avg 42.6 fields per doc] [took 0.048 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.000 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.000 sec]

  5 of 10: name=_3r1 maxDoc=114
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthgy
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
    numFiles=3
    size (MB)=0.658
    diagnostics = {os=Linux, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, mergeMaxNumSegments=-1, os.arch=amd64, java.runtime.version=1.8.0_66-internal-b17, source=merge, mergeFactor=10, os.version=3.11-2-amd64, timestamp=1452861925974}
    no deletions
    test: open reader.........OK [took 0.008 sec]
    test: check integrity.....OK [took 0.002 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [35 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.000 sec]
    test: terms, freq, prox...OK [18002 terms; 41857 terms/docs pairs; 64375 tokens] [took 0.061 sec]
    test: stored fields.......OK [14505 total field count; avg 127.2 fields per doc] [took 0.018 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.000 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.000 sec]

  6 of 10: name=_3r2 maxDoc=1
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthgz
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    numFiles=10
    size (MB)=0.026
    diagnostics = {java.runtime.version=1.8.0_66-internal-b17, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, os=Linux, os.arch=amd64, os.version=3.11-2-amd64, source=flush, timestamp=1452861930569}
    no deletions
    test: open reader.........OK [took 0.017 sec]
    test: check integrity.....OK [took 0.007 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [34 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.000 sec]
    test: terms, freq, prox...OK [809 terms; 809 terms/docs pairs; 1374 tokens] [took 0.010 sec]
    test: stored fields.......OK [324 total field count; avg 324.0 fields per doc] [took 0.001 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.000 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.001 sec]

  7 of 10: name=_3r3 maxDoc=1
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthh0
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    numFiles=10
    size (MB)=0.046
    diagnostics = {java.runtime.version=1.8.0_66-internal-b17, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, os=Linux, os.arch=amd64, os.version=3.11-2-amd64, source=flush, timestamp=1452861931845}
    no deletions
    test: open reader.........OK [took 0.022 sec]
    test: check integrity.....OK [took 0.000 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [35 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.000 sec]
    test: terms, freq, prox...OK [1611 terms; 1611 terms/docs pairs; 2890 tokens] [took 0.008 sec]
    test: stored fields.......OK [805 total field count; avg 805.0 fields per doc] [took 0.001 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.000 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.000 sec]

  8 of 10: name=_3r4 maxDoc=2
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthh1
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    numFiles=10
    size (MB)=0.097
    diagnostics = {java.runtime.version=1.8.0_66-internal-b17, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, os=Linux, os.arch=amd64, os.version=3.11-2-amd64, source=flush, timestamp=1452861933112}
    no deletions
    test: open reader.........OK [took 0.024 sec]
    test: check integrity.....OK [took 0.001 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [35 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.000 sec]
    test: terms, freq, prox...OK [3333 terms; 3742 terms/docs pairs; 8204 tokens] [took 0.010 sec]
    test: stored fields.......OK [1176 total field count; avg 588.0 fields per doc] [took 0.005 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.000 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.000 sec]

  9 of 10: name=_3r5 maxDoc=2
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthh2
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    numFiles=10
    size (MB)=0.07
    diagnostics = {java.runtime.version=1.8.0_66-internal-b17, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, os=Linux, os.arch=amd64, os.version=3.11-2-amd64, source=flush, timestamp=1452861935365}
    no deletions
    test: open reader.........OK [took 0.010 sec]
    test: check integrity.....OK [took 0.001 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [35 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.001 sec]
    test: terms, freq, prox...OK [2346 terms; 2583 terms/docs pairs; 4660 tokens] [took 0.010 sec]
    test: stored fields.......OK [1051 total field count; avg 525.5 fields per doc] [took 0.002 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.000 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.000 sec]

  10 of 10: name=_3r6 maxDoc=1
    version=5.4.0
    id=8b82erk4sdq7dvuluswzgthh4
    codec=Lucene54
    compound=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    numFiles=10
    size (MB)=0.073
    diagnostics = {java.runtime.version=1.8.0_66-internal-b17, java.vendor=Oracle Corporation, java.version=1.8.0_66-internal, java.vm.version=25.66-b17, lucene.version=5.4.0, os=Linux, os.arch=amd64, os.version=3.11-2-amd64, source=flush, timestamp=1452861952782}
    no deletions
    test: open reader.........OK [took 0.008 sec]
    test: check integrity.....OK [took 0.001 sec]
    test: check live docs.....OK [took 0.000 sec]
    test: field infos.........OK [35 fields] [took 0.000 sec]
    test: field norms.........OK [12 fields] [took 0.000 sec]
    test: terms, freq, prox...OK [2581 terms; 2581 terms/docs pairs; 5101 tokens] [took 0.011 sec]
    test: stored fields.......OK [1241 total field count; avg 1241.0 fields per doc] [took 0.001 sec]
    test: term vectors........OK [0 total term vector count; avg 0.0 term/freq vector fields per doc] [took 0.003 sec]
    test: docvalues...........OK [0 docvalues fields; 0 BINARY; 0 NUMERIC; 0 SORTED; 0 SORTED_NUMERIC; 0 SORTED_SET] [took 0.000 sec]

No problems were detected with &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; index.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15101910" author="elyograg" created="Fri, 15 Jan 2016 15:25:32 +0000"  >&lt;p&gt;My apologies, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;.  My summary of the issue was incomplete and did not mention multi-select, which it should have.&lt;/p&gt;</comment>
                            <comment id="15101985" author="yseeley@gmail.com" created="Fri, 15 Jan 2016 16:10:37 +0000"  >&lt;p&gt;I can confirm this bug. Looking into it...&lt;/p&gt;</comment>
                            <comment id="15102003" author="vasiliy.bout" created="Fri, 15 Jan 2016 16:22:03 +0000"  >&lt;p&gt;I developed a small example on how to reproduce this problem with the completely new core with a very simple schema and about 20 documents in the core.&lt;/p&gt;

&lt;p&gt;First of all, I created a new core with the following schema.xml:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;?xml version=&quot;1.0&quot; ?&amp;gt;
&amp;lt;schema name=&quot;basic&quot; version=&quot;1.1&quot;&amp;gt;
    &amp;lt;types&amp;gt;
        &amp;lt;fieldType name=&quot;string&quot; class=&quot;solr.StrField&quot; omitNorms=&quot;true&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;
        &amp;lt;fieldType name=&quot;int&quot; class=&quot;solr.TrieIntField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;
    &amp;lt;/types&amp;gt;
    &amp;lt;fields&amp;gt;
        &amp;lt;field name=&quot;id&quot; type=&quot;string&quot; required=&quot;true&quot;/&amp;gt;
        &amp;lt;field name=&quot;foo_s&quot; type=&quot;string&quot;/&amp;gt;
        &amp;lt;field name=&quot;bar_s&quot; type=&quot;string&quot; docValues=&quot;true&quot;/&amp;gt;
        &amp;lt;field name=&quot;foo_i&quot; type=&quot;int&quot;/&amp;gt;
        &amp;lt;field name=&quot;bar_i&quot; type=&quot;int&quot; docValues=&quot;true&quot;/&amp;gt;
    &amp;lt;/fields&amp;gt;
    &amp;lt;uniqueKey&amp;gt;id&amp;lt;/uniqueKey&amp;gt;
    &amp;lt;solrQueryParser defaultOperator=&quot;OR&quot;/&amp;gt;
&amp;lt;/schema&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that, I generated a set of documents to fill the core with. I launched &lt;tt&gt;python&lt;/tt&gt; interpreter in the terminal and typed the following oneliner:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ {&quot;id&quot;:i,&quot;foo_i&quot;:i,&quot;bar_i&quot;:i,&quot;foo_s&quot;:i,&quot;bar_s&quot;:i} for i in range(1, 21) ]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It gave me a set of 20 documents. This is the same set but slightly formatted to be human readable:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[
    {&apos;bar_s&apos;: 1, &apos;foo_i&apos;: 1, &apos;bar_i&apos;: 1, &apos;foo_s&apos;: 1, &apos;id&apos;: 1},
    {&apos;bar_s&apos;: 2, &apos;foo_i&apos;: 2, &apos;bar_i&apos;: 2, &apos;foo_s&apos;: 2, &apos;id&apos;: 2},
    {&apos;bar_s&apos;: 3, &apos;foo_i&apos;: 3, &apos;bar_i&apos;: 3, &apos;foo_s&apos;: 3, &apos;id&apos;: 3},
    {&apos;bar_s&apos;: 4, &apos;foo_i&apos;: 4, &apos;bar_i&apos;: 4, &apos;foo_s&apos;: 4, &apos;id&apos;: 4},
    {&apos;bar_s&apos;: 5, &apos;foo_i&apos;: 5, &apos;bar_i&apos;: 5, &apos;foo_s&apos;: 5, &apos;id&apos;: 5},
    {&apos;bar_s&apos;: 6, &apos;foo_i&apos;: 6, &apos;bar_i&apos;: 6, &apos;foo_s&apos;: 6, &apos;id&apos;: 6},
    {&apos;bar_s&apos;: 7, &apos;foo_i&apos;: 7, &apos;bar_i&apos;: 7, &apos;foo_s&apos;: 7, &apos;id&apos;: 7},
    {&apos;bar_s&apos;: 8, &apos;foo_i&apos;: 8, &apos;bar_i&apos;: 8, &apos;foo_s&apos;: 8, &apos;id&apos;: 8},
    {&apos;bar_s&apos;: 9, &apos;foo_i&apos;: 9, &apos;bar_i&apos;: 9, &apos;foo_s&apos;: 9, &apos;id&apos;: 9},
    {&apos;bar_s&apos;: 10, &apos;foo_i&apos;: 10, &apos;bar_i&apos;: 10, &apos;foo_s&apos;: 10, &apos;id&apos;: 10},
    {&apos;bar_s&apos;: 11, &apos;foo_i&apos;: 11, &apos;bar_i&apos;: 11, &apos;foo_s&apos;: 11, &apos;id&apos;: 11},
    {&apos;bar_s&apos;: 12, &apos;foo_i&apos;: 12, &apos;bar_i&apos;: 12, &apos;foo_s&apos;: 12, &apos;id&apos;: 12},
    {&apos;bar_s&apos;: 13, &apos;foo_i&apos;: 13, &apos;bar_i&apos;: 13, &apos;foo_s&apos;: 13, &apos;id&apos;: 13},
    {&apos;bar_s&apos;: 14, &apos;foo_i&apos;: 14, &apos;bar_i&apos;: 14, &apos;foo_s&apos;: 14, &apos;id&apos;: 14},
    {&apos;bar_s&apos;: 15, &apos;foo_i&apos;: 15, &apos;bar_i&apos;: 15, &apos;foo_s&apos;: 15, &apos;id&apos;: 15},
    {&apos;bar_s&apos;: 16, &apos;foo_i&apos;: 16, &apos;bar_i&apos;: 16, &apos;foo_s&apos;: 16, &apos;id&apos;: 16},
    {&apos;bar_s&apos;: 17, &apos;foo_i&apos;: 17, &apos;bar_i&apos;: 17, &apos;foo_s&apos;: 17, &apos;id&apos;: 17},
    {&apos;bar_s&apos;: 18, &apos;foo_i&apos;: 18, &apos;bar_i&apos;: 18, &apos;foo_s&apos;: 18, &apos;id&apos;: 18},
    {&apos;bar_s&apos;: 19, &apos;foo_i&apos;: 19, &apos;bar_i&apos;: 19, &apos;foo_s&apos;: 19, &apos;id&apos;: 19},
    {&apos;bar_s&apos;: 20, &apos;foo_i&apos;: 20, &apos;bar_i&apos;: 20, &apos;foo_s&apos;: 20, &apos;id&apos;: 20}
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that I opened Solr Admin page in my browser, went to the &quot;Documents&quot; tab of my core and filled the core with the set of documents above. I selected the following parameters:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Request-Handler (qt): &lt;tt&gt;/update/json&lt;/tt&gt;;&lt;/li&gt;
	&lt;li&gt;Document Type: &lt;tt&gt;Solr Command (raw XML or JSON)&lt;/tt&gt;;&lt;/li&gt;
	&lt;li&gt;Documents set to the above JSON generate in python interpreter.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;After the Solr core is filled with documents, I add a single document once again, so this document overwrites the previous one:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{&apos;bar_s&apos;: 2, &apos;foo_i&apos;: 2, &apos;bar_i&apos;: 2, &apos;foo_s&apos;: 2, &apos;id&apos;: 2}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now when I look at the &quot;Overview&quot; tab I see the following statistics:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Last Modified: less than a minute ago
Num Docs: 20
Max Doc: 21
Heap Memory Usage: -1
Deleted Docs: 1
Version: 7
Segment Count: 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And at this stage all multi select facet queries give incorrect results. Since all the documents in the core have unique values for all fields, all facet queries should give count &lt;tt&gt;1&lt;/tt&gt; for all values for all fields. Simple facet queries return correct results:&lt;/p&gt;

&lt;p&gt;query is &lt;tt&gt;q=&amp;#42;:&amp;#42;&amp;amp;rows=0&amp;amp;facet=true&amp;amp;facet.limit=1&amp;amp;facet.field=foo_s&amp;amp;facet.field=foo_i&amp;amp;facet.field=bar_s&amp;amp;facet.field=bar_i&lt;/tt&gt;&lt;br/&gt;
response is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
  &quot;responseHeader&quot;:{&quot;status&quot;:0,&quot;QTime&quot;:1},
  &quot;response&quot;:{&quot;numFound&quot;:20,&quot;start&quot;:0,&quot;docs&quot;:[]},
  &quot;facet_counts&quot;:{
    &quot;facet_queries&quot;:{},
    &quot;facet_fields&quot;:{
      &quot;foo_s&quot;:[&quot;1&quot;,1],
      &quot;foo_i&quot;:[&quot;1&quot;,1],
      &quot;bar_s&quot;:[&quot;1&quot;,1],
      &quot;bar_i&quot;:[&quot;1&quot;,1]
    },
    &quot;facet_dates&quot;:{},
    &quot;facet_ranges&quot;:{},
    &quot;facet_intervals&quot;:{},
    &quot;facet_heatmaps&quot;:{}}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this is what we get for multi select facet query:&lt;/p&gt;

&lt;p&gt;query is &lt;tt&gt;q=&amp;#42;:&amp;#42;&amp;amp;fq={!tag=a}id:&amp;#42;&amp;amp;rows=0&amp;amp;facet=true&amp;amp;facet.limit=1&amp;amp;facet.field={!ex=a}foo_s&amp;amp;facet.field={!ex=a}foo_i&amp;amp;facet.field={!ex=a}bar_s&amp;amp;facet.field={!ex=a}bar_i&lt;/tt&gt;&lt;br/&gt;
response is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
  &quot;responseHeader&quot;:{&quot;status&quot;:0,&quot;QTime&quot;:2},
  &quot;response&quot;:{&quot;numFound&quot;:20,&quot;start&quot;:0,&quot;docs&quot;:[]},
  &quot;facet_counts&quot;:{
    &quot;facet_queries&quot;:{},
    &quot;facet_fields&quot;:{
      &quot;foo_s&quot;:[&quot;2&quot;,2],
      &quot;foo_i&quot;:[&quot;2&quot;,2],
      &quot;bar_s&quot;:[&quot;2&quot;,2],
      &quot;bar_i&quot;:[&quot;2&quot;,2]},
    &quot;facet_dates&quot;:{},
    &quot;facet_ranges&quot;:{},
    &quot;facet_intervals&quot;:{},
    &quot;facet_heatmaps&quot;:{}}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we get count &lt;tt&gt;2&lt;/tt&gt; for value &lt;tt&gt;&quot;2&quot;&lt;/tt&gt;, i.e. replaced (old) version of the document with &lt;tt&gt;id=2&lt;/tt&gt; is taken into account when using multi selection facets.&lt;/p&gt;</comment>
                            <comment id="15102257" author="hossman" created="Fri, 15 Jan 2016 18:30:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;...My summary of the issue was incomplete and did not mention multi-select, which it should have.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Interesting &amp;#8211; i noticed the taged/excluded filters in the original example and definitely tried that when i was trying to reproduce, but I didn&apos;t see any change in the results so i didn&apos;t include it in my &quot;can&apos;t reproduce&quot; example ... i must have either made a mistake somewhere, or tickled an excluded filter code path that &lt;b&gt;doesn&apos;t&lt;/b&gt; have this bug.&lt;/p&gt;
</comment>
                            <comment id="15103227" author="yseeley@gmail.com" created="Sat, 16 Jan 2016 15:22:31 +0000"  >&lt;p&gt;Patch attached, running complete tests now.&lt;/p&gt;</comment>
                            <comment id="15103228" author="yseeley@gmail.com" created="Sat, 16 Jan 2016 15:24:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;i noticed the taged/excluded filters in the original example and definitely tried that when i was trying to reproduce&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Try uncached... i.e. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;q={!cache=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}*:*&amp;amp;...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15103250" author="jpountz" created="Sat, 16 Jan 2016 16:48:24 +0000"  >&lt;p&gt;Should we only have the bugfix here that applies deleted docs in getDocSet and open another issue to discuss the &lt;tt&gt;hasDeletedDocs&lt;/tt&gt; optimization?&lt;/p&gt;</comment>
                            <comment id="15103253" author="jira-bot" created="Sat, 16 Jan 2016 16:56:39 +0000"  >&lt;p&gt;Commit 1725005 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1725005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1725005&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8496&quot; title=&quot;Facet search count numbers are falsified by older document versions when multi-select is used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8496&quot;&gt;&lt;del&gt;SOLR-8496&lt;/del&gt;&lt;/a&gt;: multi-select faceting and getDocSet(List&amp;lt;Query&amp;gt;) can match deleted docs&lt;/p&gt;</comment>
                            <comment id="15103258" author="yseeley@gmail.com" created="Sat, 16 Jan 2016 17:06:19 +0000"  >&lt;p&gt;Crossed messages - I had finished testing and committed by the time I saw this.&lt;br/&gt;
Anyway, I didn&apos;t see it as an optimization - I simply wrote it how I would have originally by checking deleted docs in just the case where it was missing.&lt;/p&gt;</comment>
                            <comment id="15103266" author="jira-bot" created="Sat, 16 Jan 2016 17:22:09 +0000"  >&lt;p&gt;Commit 1725008 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1725008&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1725008&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8496&quot; title=&quot;Facet search count numbers are falsified by older document versions when multi-select is used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8496&quot;&gt;&lt;del&gt;SOLR-8496&lt;/del&gt;&lt;/a&gt;: multi-select faceting and getDocSet(List&amp;lt;Query&amp;gt;) can match deleted docs&lt;/p&gt;</comment>
                            <comment id="15103271" author="jira-bot" created="Sat, 16 Jan 2016 17:34:13 +0000"  >&lt;p&gt;Commit 1725010 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_4&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1725010&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1725010&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8496&quot; title=&quot;Facet search count numbers are falsified by older document versions when multi-select is used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8496&quot;&gt;&lt;del&gt;SOLR-8496&lt;/del&gt;&lt;/a&gt;: multi-select faceting and getDocSet(List&amp;lt;Query&amp;gt;) can match deleted docs&lt;/p&gt;</comment>
                            <comment id="15103284" author="jpountz" created="Sat, 16 Jan 2016 17:47:14 +0000"  >&lt;p&gt;I have concerns that this part of the code is playing with live docs a bit too much: there are several ways that live docs might get applied, which multiplies the risks to have other livedocs-related bugs in the future. I would have rather liked something that just applies live docs all the time in getDocSet or that does &lt;tt&gt;if (answer == null) answer = getLiveDocs();&lt;/tt&gt; instead of the current &lt;tt&gt;pf.hasDeletedDocs = (answer == null)&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15103296" author="jira-bot" created="Sat, 16 Jan 2016 18:07:47 +0000"  >&lt;p&gt;Commit 1725012 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_3&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1725012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1725012&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8496&quot; title=&quot;Facet search count numbers are falsified by older document versions when multi-select is used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8496&quot;&gt;&lt;del&gt;SOLR-8496&lt;/del&gt;&lt;/a&gt;: multi-select faceting and getDocSet(List&amp;lt;Query&amp;gt;) can match deleted docs&lt;/p&gt;</comment>
                            <comment id="15103306" author="yseeley@gmail.com" created="Sat, 16 Jan 2016 18:29:09 +0000"  >&lt;p&gt;The original code was missing the case when liveDocs should be consulted, so I added a patch that consulted liveDocs only in the case when it was needed (when all clauses are uncached).&lt;br/&gt;
If we want to investigate further code cleanups, I think that can be done in another issue what won&apos;t hold up the releases.&lt;/p&gt;</comment>
                            <comment id="15103309" author="joel.bernstein" created="Sat, 16 Jan 2016 18:32:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt;, can you provide a quick summary of the issue. I see lot&apos;s of symptoms in the ticket but I don&apos;t see the details of the inner workings of the bug.&lt;/p&gt;

&lt;p&gt;I&apos;m concerned this bug may be hitting us in many different places besides facets, such as field collapsing, and exporting.&lt;/p&gt;</comment>
                            <comment id="15103317" author="joel.bernstein" created="Sat, 16 Jan 2016 18:40:05 +0000"  >&lt;p&gt;One of the things that is mentioned in this ticket is that the doc counts in the schema browser were also effected. I&apos;m wondering how far this bug reaches.&lt;/p&gt;</comment>
                            <comment id="15103376" author="yseeley@gmail.com" created="Sat, 16 Jan 2016 19:05:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m concerned this bug may be hitting us in many different places besides facets, such as field collapsing, and exporting.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed.  We may still be vulnerable , but not due to &lt;b&gt;this&lt;/b&gt; bug in particular.&lt;/p&gt;

&lt;p&gt;The change in general was &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-6553&quot; title=&quot;Simplify how we handle deleted docs in read APIs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-6553&quot;&gt;&lt;del&gt;LUCENE-6553&lt;/del&gt;&lt;/a&gt;, and that may yet cause bugs (like this one) in different areas.&lt;br/&gt;
Deleted docs are now only screened out before hitting the Collector.  So any place that does something lower level, like Weight.scorer(), is vulnerable &lt;b&gt;if&lt;/b&gt; used in a context was was expecting only live docs.&lt;/p&gt;

&lt;p&gt;This specific bug:&lt;br/&gt;
The DocSet returned from SolrIndexSearcher.getDocSet(List&amp;lt;Query&amp;gt;) could contain deleted documents (and that breaks our current invariants that DocSets never contain deleted docs).&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-6553&quot; title=&quot;Simplify how we handle deleted docs in read APIs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-6553&quot;&gt;&lt;del&gt;LUCENE-6553&lt;/del&gt;&lt;/a&gt; changed (among many others) this line: &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java#L2473&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java#L2473&lt;/a&gt;&lt;br/&gt;
We used to pass liveDocs at that point, but that method signature was removed.&lt;br/&gt;
So now, if all clauses to be intersected are uncached, then Weight.scorer() is used for all of them and the intersection can thus still contain deleted docs.  If even one clause is a normal DocSet, we&apos;re good since they do reflect liveDocs.&lt;/p&gt;

&lt;p&gt;So the fix was, detect the case where all clauses are uncached (i.e. will use Weight.scorer) and check liveDocs in that specific case.&lt;/p&gt;</comment>
                            <comment id="15103384" author="yseeley@gmail.com" created="Sat, 16 Jan 2016 19:13:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m concerned this bug may be hitting us in many different places besides facets, such as field collapsing, and exporting.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you&apos;re wondering about post filters, I think it depends on how they get their docs.&lt;br/&gt;
If it&apos;s through the normal mechanism (search(query, collector)) then we&apos;re good.  Lucene filters out deleted docs before they hit the collector.&lt;br/&gt;
If you ever feed a collector yourself, you need to ensure that it isn&apos;t fed deleted docs.&lt;/p&gt;</comment>
                            <comment id="15103397" author="joel.bernstein" created="Sat, 16 Jan 2016 19:23:18 +0000"  >&lt;p&gt;One candidate I can think of right off is the HashQParserPlugin which handles shuffling for the streaming API. I&apos;ll review that code. The schema browser bug reported in this issue is also important to track down. &lt;/p&gt;</comment>
                            <comment id="15103412" author="yseeley@gmail.com" created="Sat, 16 Jan 2016 19:35:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;After that you can see, that in &quot;Schema Browser&quot; when you select your field and press &quot;Load Term Info&quot; counts for your field are incorrect (they take into account also old versions of the overwritten documents).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Either behavior could be correct, so we should first verify that this behavior has changed (i.e. did 5.2 take into account deleted documents?)&lt;br/&gt;
Not that for tull-text scoring, term statistics like ttf, idf, etc, do not take deletions into account. &lt;/p&gt;</comment>
                            <comment id="15137883" author="jira-bot" created="Mon, 8 Feb 2016 22:35:49 +0000"  >&lt;p&gt;Commit 7b42653a274962f50661f4bed52dad298f7064d5 in lucene-solr&apos;s branch refs/heads/branch_5_4 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7b42653&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7b42653&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8496&quot; title=&quot;Facet search count numbers are falsified by older document versions when multi-select is used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8496&quot;&gt;&lt;del&gt;SOLR-8496&lt;/del&gt;&lt;/a&gt;: multi-select faceting and getDocSet(List&amp;lt;Query&amp;gt;) can match deleted docs&lt;/p&gt;

&lt;p&gt;git-svn-id: &lt;a href=&quot;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene_solr_5_4@1725010&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene_solr_5_4@1725010&lt;/a&gt; 13f79535-47bb-0310-9956-ffa450edef68&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12929843">SOLR-8540</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12782726" name="SOLR-8496.patch" size="5749" author="yseeley@gmail.com" created="Sat, 16 Jan 2016 15:22:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qxxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>