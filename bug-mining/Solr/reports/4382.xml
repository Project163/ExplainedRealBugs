<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:41:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13966] LatLonPointSpatialField doesn&apos;t work with RealTimeGetComponent</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13966</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;LatLonDocValuesField is used by LatLonPointSpatialField field type to store doc values. It does this by encoding the two double values into a long. If the field is part of a document which takes place within a atomic update operation RealTimeGetComponent is used to load the field values from the index. &lt;/p&gt;

&lt;p&gt;If the request is a nested request (line number 654:&#160;isNestedRequest is set by&#160;DistributedUpdateProcessor to Resolution.ROOT_WITH_CHILDREN) all field values from the schema are copied into a SolrInputDocument (line 678).&lt;/p&gt;

&lt;p&gt;The copy is implemented by toSolrInputDocument method (line 728 of RealTimeGetComponent). The method retrieves the FieldType of the SchemaField and calls the toObject method (line 740). In case of LatLonPointSpatialField type, when docValues is set to true and stored is set to false, the fieldData is stored by a&#160; LatLonDocValuesField instance.&lt;/p&gt;

&lt;p&gt;The toObject method is implemented by the base class FieldType toExternal with the LatLonDocValuesField instance (line 373). In line 359 the method stringValue of the Field is called. The default implementation (line 259) checks if the fieldsData is either CharSequence or a Number and calls fieldsData.toString.&lt;/p&gt;

&lt;p&gt;Because fieldsData is of type Long in LatLonDocValuesField class the value is not decoded correctly.&lt;/p&gt;

&lt;p&gt;From my opinion LatLonDocValuesField must implement (override) the stringValue method and return the decoded value.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13270349">SOLR-13966</key>
            <summary>LatLonPointSpatialField doesn&apos;t work with RealTimeGetComponent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="thomas.woeckinger">Thomas W&#246;ckinger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Nov 2019 01:13:05 +0000</created>
                <updated>Tue, 21 Jan 2020 17:00:10 +0000</updated>
                            <resolved>Tue, 10 Dec 2019 04:09:43 +0000</resolved>
                                    <version>8.3</version>
                    <version>8.3.1</version>
                    <version>9.0</version>
                                    <fixVersion>8.4</fixVersion>
                                    <component>Schema and Analysis</component>
                    <component>UpdateRequestProcessors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16981235" author="thomas.woeckinger" created="Mon, 25 Nov 2019 01:16:28 +0000"  >&lt;p&gt;The fix works, but i need to write a unit test for this behavior. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; my you can forward this issue to the responsible person, in the meantime i will try to implement a test, thx a lot.&lt;/p&gt;</comment>
                            <comment id="16983702" author="thomas.woeckinger" created="Wed, 27 Nov 2019 16:41:38 +0000"  >&lt;p&gt;Added test case to verify correct implementation, changed the implementation to not override stringValue(), seems to be a huge impact, so for now i am using the same approach in RealTimeGetComponent as already done in SolrDocumentFetcher: Check for the field type and do the conversion if necessary.&lt;/p&gt;

&lt;p&gt;Seems to be a lower impact as the first approach.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; you may have a look on it, thx!&lt;/p&gt;</comment>
                            <comment id="16983938" author="dsmiley" created="Wed, 27 Nov 2019 21:27:05 +0000"  >&lt;p&gt;I will look. &#160;What do you mean by &quot;seems to be a huge impact&quot; vs &quot;lower impact&quot;? &#160;Performance in your environment? &#160;Tests? &#160;Complexity?&lt;/p&gt;</comment>
                            <comment id="16983952" author="thomas.woeckinger" created="Wed, 27 Nov 2019 21:46:00 +0000"  >&lt;p&gt;Huge on the affected code behavior, because no field does currently overrides stringValue() , so i was a bit worried about the consequences. Therefore i choose the same way as used in SolrDocumentFetcher, which does not mean that i can&apos;t be done by overriding stringValue() on&#160; LatLonDocValuesField&lt;/p&gt;</comment>
                            <comment id="16985689" author="thomas.woeckinger" created="Sun, 1 Dec 2019 21:52:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Did you already have time to look at the changes?&#160;&lt;/p&gt;</comment>
                            <comment id="16987682" author="thomas.woeckinger" created="Wed, 4 Dec 2019 09:29:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Anything new on this one?&lt;/p&gt;

&lt;p&gt;Would be great to get it into 8.4!&lt;/p&gt;

&lt;p&gt;Thx Tom&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16991006" author="thomas.woeckinger" created="Sun, 8 Dec 2019 22:23:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Anything new on this one?&lt;/p&gt;</comment>
                            <comment id="16991158" author="dsmiley" created="Mon, 9 Dec 2019 05:46:26 +0000"  >&lt;p&gt;Definitely don&apos;t have LLDVF override stringValue; I&apos;m not surprised that didn&apos;t work.  Your chosen path of checking instanceof in RTG is a code smell; I didn&apos;t love it in SolrDocumentFetcher either.  Enhancing the appropriate FieldType is the best place.  In LLPSF override Solr&apos;s FieldType.toExternal.  If f.stringValue() is non-null then return that, else assume numeric and call decodeDocValueToString.  &lt;/p&gt;

&lt;p&gt;In my code review on GH I have one comment there too concerning the test.&lt;/p&gt;</comment>
                            <comment id="16991500" author="thomas.woeckinger" created="Mon, 9 Dec 2019 11:14:52 +0000"  >&lt;p&gt;I don&apos;t like the instance of too, so i refactored it according to your comments. All tests are successful, changed the test case too, all should be ready now and is pushed on github&lt;/p&gt;</comment>
                            <comment id="16992159" author="jira-bot" created="Tue, 10 Dec 2019 03:52:32 +0000"  >&lt;p&gt;Commit e250f3e82cb1b07192a9f07326059b01fde2c62c in lucene-solr&apos;s branch refs/heads/master from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e250f3e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e250f3e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13966&quot; title=&quot;LatLonPointSpatialField doesn&amp;#39;t work with RealTimeGetComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13966&quot;&gt;&lt;del&gt;SOLR-13966&lt;/del&gt;&lt;/a&gt;: LatLonPointSpatialField fix for RealTimeGetComponent&lt;br/&gt;
 used in atomic/partial updates.&lt;br/&gt;
Closes #1035&lt;/p&gt;</comment>
                            <comment id="16992167" author="jira-bot" created="Tue, 10 Dec 2019 04:05:28 +0000"  >&lt;p&gt;Commit 87aa11baf83f59365a30b12e2e41048bd8394182 in lucene-solr&apos;s branch refs/heads/branch_8x from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=87aa11b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=87aa11b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13966&quot; title=&quot;LatLonPointSpatialField doesn&amp;#39;t work with RealTimeGetComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13966&quot;&gt;&lt;del&gt;SOLR-13966&lt;/del&gt;&lt;/a&gt;: LatLonPointSpatialField fix for RealTimeGetComponent&lt;br/&gt;
 used in atomic/partial updates.&lt;br/&gt;
Closes #1035&lt;/p&gt;

&lt;p&gt;(cherry picked from commit e250f3e82cb1b07192a9f07326059b01fde2c62c)&lt;/p&gt;</comment>
                            <comment id="16992169" author="dsmiley" created="Tue, 10 Dec 2019 04:09:43 +0000"  >&lt;p&gt;I trivially modified the import statement order and also moved the static method to a more pleasing spot to me.&lt;/p&gt;

&lt;p&gt;Thanks for reporting and fixing the problem Thomas!&lt;/p&gt;</comment>
                            <comment id="16992563" author="jira-bot" created="Tue, 10 Dec 2019 13:52:55 +0000"  >&lt;p&gt;Commit e250f3e82cb1b07192a9f07326059b01fde2c62c in lucene-solr&apos;s branch refs/heads/gradle-master from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e250f3e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e250f3e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13966&quot; title=&quot;LatLonPointSpatialField doesn&amp;#39;t work with RealTimeGetComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13966&quot;&gt;&lt;del&gt;SOLR-13966&lt;/del&gt;&lt;/a&gt;: LatLonPointSpatialField fix for RealTimeGetComponent&lt;br/&gt;
 used in atomic/partial updates.&lt;br/&gt;
Closes #1035&lt;/p&gt;</comment>
                            <comment id="16992912" author="thomas.woeckinger" created="Tue, 10 Dec 2019 20:23:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Found a small issue during review your commit &lt;a href=&quot;https://github.com/apache/lucene-solr/commit/87aa11baf83f59365a30b12e2e41048bd8394182#diff-da0588524488fa7ae0433126c1d687a8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;NestedAtomicUpdateTest.java:&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Line 694:&lt;/p&gt;

&lt;p&gt;doc = sdoc(&quot;id&quot;, &quot;1&quot;, &quot;child1&quot;, Collections.singletonMap(&quot;set&quot;, null));&lt;/p&gt;

&lt;p&gt;should be:&lt;/p&gt;

&lt;p&gt;doc = sdoc(&quot;id&quot;, &quot;1&quot;, &quot;child1&quot;, Collections.singletonMap(&quot;set&quot;, empty ? new ArrayList&amp;lt;&amp;gt;() : null));&lt;/p&gt;

&lt;p&gt;Was also wrong in my last PR, sorry for that.&lt;/p&gt;</comment>
                            <comment id="16992962" author="jira-bot" created="Tue, 10 Dec 2019 21:29:38 +0000"  >&lt;p&gt;Commit 9e84da95a288c8aa07dec6d4159c51f13ef54860 in lucene-solr&apos;s branch refs/heads/master from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9e84da9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9e84da9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13966&quot; title=&quot;LatLonPointSpatialField doesn&amp;#39;t work with RealTimeGetComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13966&quot;&gt;&lt;del&gt;SOLR-13966&lt;/del&gt;&lt;/a&gt;: forgot to test empty list&lt;/p&gt;</comment>
                            <comment id="16992964" author="jira-bot" created="Tue, 10 Dec 2019 21:30:07 +0000"  >&lt;p&gt;Commit f4b208bc4e8ec04e6718718c64639804f9a7c41e in lucene-solr&apos;s branch refs/heads/branch_8x from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f4b208b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f4b208b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13966&quot; title=&quot;LatLonPointSpatialField doesn&amp;#39;t work with RealTimeGetComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13966&quot;&gt;&lt;del&gt;SOLR-13966&lt;/del&gt;&lt;/a&gt;: forgot to test empty list&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 9e84da95a288c8aa07dec6d4159c51f13ef54860)&lt;/p&gt;</comment>
                            <comment id="16993283" author="jira-bot" created="Wed, 11 Dec 2019 08:11:38 +0000"  >&lt;p&gt;Commit 9e84da95a288c8aa07dec6d4159c51f13ef54860 in lucene-solr&apos;s branch refs/heads/gradle-master from Thomas W&#246;ckinger&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9e84da9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9e84da9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13966&quot; title=&quot;LatLonPointSpatialField doesn&amp;#39;t work with RealTimeGetComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13966&quot;&gt;&lt;del&gt;SOLR-13966&lt;/del&gt;&lt;/a&gt;: forgot to test empty list&lt;/p&gt;</comment>
                            <comment id="17005006" author="jpountz" created="Sun, 29 Dec 2019 20:51:25 +0000"  >&lt;p&gt;Closing after the 8.4.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 46 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08ym0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>