<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:17:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9519] Check sub-facets of empty facet buckets for operations that may expand the domain (like filter exclusions)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9519</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;http://markmail.org/message/bgplt2qdxc7gqga5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/bgplt2qdxc7gqga5&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Background: the JSON Facet API does not execute sub-facets for a facet&lt;br/&gt;
bucket with a 0 count (and the root facet bucket is like any other&lt;br/&gt;
facet bucket).&lt;br/&gt;
This was to help prevent the combinatorial explosion of deeply nested&lt;br/&gt;
sub-facets with useless information.&lt;/p&gt;

&lt;p&gt;This is obviously incorrect though, when a sub-facet does something&lt;br/&gt;
that can expand the domain rather than just restrict it.  Facet&lt;br/&gt;
exclusions are one of these cases.&lt;br/&gt;
For zero facet buckets, we should check if any sub-facets have these&lt;br/&gt;
properties and then recurse if so.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Aside: not processing empty sets also helped with issues like what junk values to fill in for statistics... min, max, average, std, etc.  JSON doesn&apos;t even officially support NaN, so it&apos;s nice to be able to leave these junk values out in many circumstances.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13005158">SOLR-9519</key>
            <summary>Check sub-facets of empty facet buckets for operations that may expand the domain (like filter exclusions)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Sep 2016 13:25:31 +0000</created>
                <updated>Sat, 8 Jun 2019 15:33:43 +0000</updated>
                            <resolved>Tue, 8 Nov 2016 18:19:40 +0000</resolved>
                                                    <fixVersion>6.4</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>Facet Module</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15497717" author="michael.sun" created="Fri, 16 Sep 2016 23:26:26 +0000"  >&lt;p&gt;Here is a patch. It basically does a check if a zero domain has any sub-facet that can alter domain.&lt;/p&gt;</comment>
                            <comment id="15507109" author="michael.sun" created="Tue, 20 Sep 2016 16:51:53 +0000"  >&lt;p&gt;Here is a new patch with fix and test.&lt;/p&gt;</comment>
                            <comment id="15540889" author="yseeley@gmail.com" created="Sun, 2 Oct 2016 19:51:28 +0000"  >&lt;p&gt;The domain check may need to be recursive.  A direct child may not change the domain in a non-narrowing way, but a child of that child may.&lt;/p&gt;

&lt;p&gt;Further, I wonder if we should only execute those sub-facets that do have the domain change.&lt;/p&gt;</comment>
                            <comment id="15555922" author="michael.sun" created="Fri, 7 Oct 2016 18:46:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;The domain check may need to be recursive. A direct child may not change the domain in a non-narrowing way, but a child of that child may.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; for reviewing. Can you also give an example for this use case? I tried a query like the following and got expected result. &lt;/p&gt;

&lt;p&gt;One guess for the use case is a query without domain in first level facet but that seems not right.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;curl http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/films/select -d &apos;q=*:*&amp;amp;fq={!tag=GENRE}genre:xxx``&amp;amp;wt=json&amp;amp;indent=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;json.facet={
&lt;/span&gt;top_genre: {
  type:terms,
  field:genre,
  numBucket:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,
  limit:3,
  domain:{excludeTags:GENRE},
  facet: {
    top_director: {
        type:terms,
        field:directed_by,
        numBuckets:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,
        limit:3,
        domain:{excludeTags:GENRE}
    }
  }
}
}&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15636962" author="michael.sun" created="Fri, 4 Nov 2016 16:50:21 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; for suggestions. A new patch is uploaded which checks domain change recursively.&lt;/p&gt;</comment>
                            <comment id="15642305" author="yseeley@gmail.com" created="Sun, 6 Nov 2016 19:50:57 +0000"  >&lt;p&gt;Here&apos;s an update that only executes sub-facets that can produce something from an empty bucket, rather than executing all sub-facets if any of them can.&lt;br/&gt;
Updated tests as well.&lt;/p&gt;</comment>
                            <comment id="15642346" author="yseeley@gmail.com" created="Sun, 6 Nov 2016 20:20:15 +0000"  >&lt;p&gt;Another update, this time just more tests to ensure that the constraint filters for intermediate facets are still applied when the domain becomes non-empty in the sub-facets.&lt;/p&gt;</comment>
                            <comment id="15648184" author="jira-bot" created="Tue, 8 Nov 2016 17:26:31 +0000"  >&lt;p&gt;Commit cfcf4081fcf04cf2e1d6293a05a2005f0a99942c in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cfcf408&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cfcf408&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9519&quot; title=&quot;Check sub-facets of empty facet buckets for operations that may expand the domain (like filter exclusions)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9519&quot;&gt;&lt;del&gt;SOLR-9519&lt;/del&gt;&lt;/a&gt;: recurse sub-facets of empty buckets if they can widen domain again&lt;/p&gt;</comment>
                            <comment id="15648190" author="jira-bot" created="Tue, 8 Nov 2016 17:28:25 +0000"  >&lt;p&gt;Commit ecff32633119687eb2cd9fc4bd78a865cbdd6893 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ecff326&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ecff326&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9519&quot; title=&quot;Check sub-facets of empty facet buckets for operations that may expand the domain (like filter exclusions)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9519&quot;&gt;&lt;del&gt;SOLR-9519&lt;/del&gt;&lt;/a&gt;: recurse sub-facets of empty buckets if they can widen domain again&lt;/p&gt;</comment>
                            <comment id="15648337" author="yseeley@gmail.com" created="Tue, 8 Nov 2016 18:19:40 +0000"  >&lt;p&gt;Committed.  Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12837659" name="SOLR-9519.patch" size="6281" author="yseeley@gmail.com" created="Sun, 6 Nov 2016 20:20:15 +0000"/>
                            <attachment id="12837658" name="SOLR-9519.patch" size="5670" author="yseeley@gmail.com" created="Sun, 6 Nov 2016 19:50:57 +0000"/>
                            <attachment id="12837182" name="SOLR-9519.patch" size="2520" author="michael.sun" created="Fri, 4 Nov 2016 16:49:19 +0000"/>
                            <attachment id="12829412" name="SOLR-9519.patch" size="2437" author="michael.sun" created="Tue, 20 Sep 2016 16:51:20 +0000"/>
                            <attachment id="12828929" name="SOLR-9519.patch" size="1272" author="michael.sun" created="Fri, 16 Sep 2016 23:24:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33nzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>