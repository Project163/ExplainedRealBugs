<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:50:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5951] SolrDispatchFilter no longer displays useful error message on statup when logging jars are missing</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5951</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We no longer have logging jars in the webapp since &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3706&quot; title=&quot;Ship setup to log with log4j.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3706&quot;&gt;&lt;del&gt;SOLR-3706&lt;/del&gt;&lt;/a&gt;. Because of this we added a extra check in SolrDispatchFilter&apos;s ctor to print a nice exception if the logging jars were failing. This check was unfortunately never tests and recently broke:&lt;/p&gt;

&lt;p&gt;The check delays initialization of the Logger instance to inside a try-catch block inside the explicit ctor. If it fails with ClassNotFound, it throws Exception.&lt;/p&gt;

&lt;p&gt;Recently we upgraded to a newer HttpClient version. Unfortunately SolrDispatchFliter also has an implicit constructor a few lines before the main constructor:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpClient httpClient = HttpClientUtil.createClient(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ModifiableSolrParams()); &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;-- &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; breaks the detection
&lt;/span&gt;  
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Charset UTF8 = StandardCharsets.UTF_8;

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SolrDispatchFilter() {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      log = LoggerFactory.getLogger(SolrDispatchFilter.class);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (NoClassDefFoundError e) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException(
          ErrorCode.SERVER_ERROR,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;Could not find necessary SLF4j logging jars. If using Jetty, the SLF4j logging jars need to go in &quot;&lt;/span&gt;
          +&lt;span class=&quot;code-quote&quot;&gt;&quot;the jetty lib/ext directory. For other containers, the corresponding directory should be used. &quot;&lt;/span&gt;
          +&lt;span class=&quot;code-quote&quot;&gt;&quot;For more information, see: http:&lt;span class=&quot;code-comment&quot;&gt;//wiki.apache.org/solr/SolrLogging&quot;&lt;/span&gt;,
&lt;/span&gt;          e);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first line above &lt;tt&gt;HttpClientUtil.createClient(new ModifiableSolrParams());&lt;/tt&gt; breaks the whole thing, because it is executed before the declared constructor. The user just sees a ClassNotFoundEx at this line of code, the nice error message is hidden.&lt;/p&gt;

&lt;p&gt;Because this is so easy to break, we should make the whole thing more safe (any maybe test it). 2 options:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Into the webapp add a fake Servlet (not bound to anything, just loaded first) that does not use any Solr classes at all, nothing only plain java&lt;/li&gt;
	&lt;li&gt;Alternatively add a Superclass between ServletFilter and SolrDispatchFilter (pkg-private). When the servlet container loads SolrDispatchFilter, it has in any case to first load the superclass. And this superclass does the check and throws ServletException or whatever (no Solr Exception) with the message from the current code.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I tend to the second approach, because it does not need to modify web-inf. It will also work with other Solr servlets, they must just extend this hidden class. I will provide a patch for that.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12706273">SOLR-5951</key>
            <summary>SolrDispatchFilter no longer displays useful error message on statup when logging jars are missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uschindler">Uwe Schindler</assignee>
                                    <reporter username="uschindler">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Apr 2014 20:09:00 +0000</created>
                <updated>Wed, 9 Oct 2024 03:02:13 +0000</updated>
                            <resolved>Wed, 2 Apr 2014 23:34:35 +0000</resolved>
                                    <version>4.7</version>
                    <version>4.7.1</version>
                                    <fixVersion>4.7.2</fixVersion>
                    <fixVersion>4.8</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13958197" author="thetaphi" created="Wed, 2 Apr 2014 21:30:16 +0000"  >&lt;p&gt;Patch that implements the second approach. The good thing: All user-visible servlets and filters extend those hidden abstract base classes. Because of this the checking code is executed in any case, although maybe some other servlet or filter is loaded before SolrDispatchFilter (e.g., user modified web.xml file).&lt;/p&gt;

&lt;p&gt;When starting the example with the Jetty &lt;tt&gt;ext&lt;/tt&gt; folder emptied, the following is displayed:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-04-02 23:21:10.009:WARN:oejuc.AbstractLifeCycle:FAILED SolrRequestFilter: java.lang.NoClassDefFoundError: Failed to initialize
Apache Solr: Could not find necessary SLF4j logging jars. If using Jetty, the SLF4j logging jars need to go in the jetty lib/ext dir
ectory. For other containers, the corresponding directory should be used. For more information, see: http://wiki.apache.org/solr/Sol
rLogging
java.lang.NoClassDefFoundError: Failed to initialize Apache Solr: Could not find necessary SLF4j logging jars. If using Jetty, the S
LF4j logging jars need to go in the jetty lib/ext directory. For other containers, the corresponding directory should be used. For m
ore information, see: http://wiki.apache.org/solr/SolrLogging
        at org.apache.solr.servlet.CheckLoggingConfiguration.check(CheckLoggingConfiguration.java:28)
        at org.apache.solr.servlet.BaseSolrFilter.&amp;lt;clinit&amp;gt;(BaseSolrFilter.java:25)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:526)
        at java.lang.Class.newInstance(Class.java:374)
        at org.eclipse.jetty.servlet.ServletContextHandler$Context.createFilter(ServletContextHandler.java:1053)
        at org.eclipse.jetty.servlet.FilterHolder.doStart(FilterHolder.java:105)
        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64)
        at org.eclipse.jetty.servlet.ServletHandler.initialize(ServletHandler.java:719)
        at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:265)
        at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1252)
        at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:710)
        at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:494)
        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64)
        at org.eclipse.jetty.deploy.bindings.StandardStarter.processBinding(StandardStarter.java:39)
        at org.eclipse.jetty.deploy.AppLifeCycle.runBindings(AppLifeCycle.java:186)
        at org.eclipse.jetty.deploy.DeploymentManager.requestAppGoal(DeploymentManager.java:494)
        at org.eclipse.jetty.deploy.DeploymentManager.addApp(DeploymentManager.java:141)
        at org.eclipse.jetty.deploy.providers.ScanningAppProvider.fileAdded(ScanningAppProvider.java:145)
        at org.eclipse.jetty.deploy.providers.ScanningAppProvider$1.fileAdded(ScanningAppProvider.java:56)
        at org.eclipse.jetty.util.Scanner.reportAddition(Scanner.java:609)
        at org.eclipse.jetty.util.Scanner.reportDifferences(Scanner.java:540)
        at org.eclipse.jetty.util.Scanner.scan(Scanner.java:403)
        at org.eclipse.jetty.util.Scanner.doStart(Scanner.java:337)
        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64)
        at org.eclipse.jetty.deploy.providers.ScanningAppProvider.doStart(ScanningAppProvider.java:121)
        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64)
        at org.eclipse.jetty.deploy.DeploymentManager.startAppProvider(DeploymentManager.java:555)
        at org.eclipse.jetty.deploy.DeploymentManager.doStart(DeploymentManager.java:230)
        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64)
        at org.eclipse.jetty.util.component.AggregateLifeCycle.doStart(AggregateLifeCycle.java:81)
        at org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:58)
        at org.eclipse.jetty.server.handler.HandlerWrapper.doStart(HandlerWrapper.java:96)
        at org.eclipse.jetty.server.Server.doStart(Server.java:280)
        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64)
        at org.eclipse.jetty.xml.XmlConfiguration$1.run(XmlConfiguration.java:1259)
        at java.security.AccessController.doPrivileged(Native Method)
        at org.eclipse.jetty.xml.XmlConfiguration.main(XmlConfiguration.java:1182)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.eclipse.jetty.start.Main.invokeMain(Main.java:473)
        at org.eclipse.jetty.start.Main.start(Main.java:615)
        at org.eclipse.jetty.start.Main.main(Main.java:96)
2014-04-02 23:21:10.013:WARN:oejuc.AbstractLifeCycle:FAILED o.e.j.w.WebAppContext{/solr,file:/C:/Users/Uwe%20Schindler/Projects/luce
ne/trunk-lusolr2/solr/example/solr-webapp/webapp/},C:\Users\Uwe Schindler\Projects\lucene\trunk-lusolr2\solr\example/webapps/solr.wa
r: java.lang.NoClassDefFoundError: Failed to initialize Apache Solr: Could not find necessary SLF4j logging jars. If using Jetty, th
e SLF4j logging jars need to go in the jetty lib/ext directory. For other containers, the corresponding directory should be used. Fo
r more information, see: http://wiki.apache.org/solr/SolrLogging
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will also backport this to Solr 4.7 branch, if we release another bugfix release.&lt;/p&gt;</comment>
                            <comment id="13958324" author="jira-bot" created="Wed, 2 Apr 2014 23:24:21 +0000"  >&lt;p&gt;Commit 1584213 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1584213&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1584213&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5951&quot; title=&quot;SolrDispatchFilter no longer displays useful error message on statup when logging jars are missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5951&quot;&gt;&lt;del&gt;SOLR-5951&lt;/del&gt;&lt;/a&gt;: Fixed SolrDispatchFilter to throw useful exception on startup if SLF4j logging jars are missing&lt;/p&gt;</comment>
                            <comment id="13958326" author="jira-bot" created="Wed, 2 Apr 2014 23:27:16 +0000"  >&lt;p&gt;Commit 1584214 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1584214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1584214&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1584213 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5951&quot; title=&quot;SolrDispatchFilter no longer displays useful error message on statup when logging jars are missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5951&quot;&gt;&lt;del&gt;SOLR-5951&lt;/del&gt;&lt;/a&gt;: Fixed SolrDispatchFilter to throw useful exception on startup if SLF4j logging jars are missing&lt;/p&gt;</comment>
                            <comment id="13958333" author="jira-bot" created="Wed, 2 Apr 2014 23:33:27 +0000"  >&lt;p&gt;Commit 1584215 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_7&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1584215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1584215&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1584214 from lucene/dev/branches/branch_4x:&lt;br/&gt;
Merged revision(s) 1584213 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5951&quot; title=&quot;SolrDispatchFilter no longer displays useful error message on statup when logging jars are missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5951&quot;&gt;&lt;del&gt;SOLR-5951&lt;/del&gt;&lt;/a&gt;: Fixed SolrDispatchFilter to throw useful exception on startup if SLF4j logging jars are missing&lt;/p&gt;</comment>
                            <comment id="13958336" author="thetaphi" created="Wed, 2 Apr 2014 23:34:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org&quot; class=&quot;user-hover&quot; rel=&quot;hossman_lucene@fucit.org&quot;&gt;hossman_lucene@fucit.org&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg&quot; class=&quot;user-hover&quot; rel=&quot;elyograg&quot;&gt;elyograg&lt;/a&gt; for help on IRC!&lt;/p&gt;</comment>
                            <comment id="13982622" author="thetaphi" created="Sun, 27 Apr 2014 23:25:59 +0000"  >&lt;p&gt;Close issue after release of 4.8.0&lt;/p&gt;</comment>
                            <comment id="17884083" author="dsmiley" created="Tue, 24 Sep 2024 02:29:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uschindler&quot; class=&quot;user-hover&quot; rel=&quot;uschindler&quot;&gt;uschindler&lt;/a&gt; , I think the problem of not having the right logging JARs should be a non-issue since Solr 5, where Solr insists on Jetty pre-packaged with our opinionated choice of logging JARs. &#160;If someone messes with them; they are on their own to figure out the right ones. &#160;I&apos;m skeptical a person would really need the code change here to figure that out. &#160;I&apos;d like to remove CheckLoggingConfiguration and BaseSolrFilter and BaseSolrServlet, which are in servitude of it. &#160;WDYT? &#160;My motivation is merely a small simplification.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12601393">SOLR-3706</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="13594716">SOLR-17485</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12638342" name="SOLR-5951.patch" size="11158" author="uschindler" created="Wed, 2 Apr 2014 21:30:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384596</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u99j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>