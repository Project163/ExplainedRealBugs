<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:34:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4538] DateMath strings truncated to 32 chars by lucene qparser in simple term queries</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4538</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using the &quot;lucene&quot; QParser, term queries on date fields cause the field value portion of the query clause to be truncated at 32 characters. This can cause visible errors about invalid date math expressions, or may result in silently returning incorrect results if the truncation results in a valid (but incomplete) date math expression.&lt;/p&gt;

&lt;p&gt;For example...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Example...

last_modified:&quot;2013-03-08T00:46:15Z/DAY+6MONTHS+3DAYS&quot;
...truncates to...
last_modified:&quot;2013-03-08T00:46:15Z/DAY+6MONTHS&quot;
(silently incorrect)

foo_tdt:&quot;2013-03-10T08:00:00.1Z/MINUTE+6MONTHS&quot;
...truncates to...
foo_tdt:2013-03-10T08:00:00.1Z/MINUTE+6M
(&quot;Invalid Date Math String&quot; error msg)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This problem does not affect range queries, or queries using either the term or field qparsers...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Examples that work fine even though the math is longer then 32 chars...

foo_tdt:[2013-03-10T08:00:00.1Z/MINUTE+6MONTHS TO 2013-03-10T08:00:00.1Z/MINUTE+6MONTHS]

{!term f=bday}1976-07-04T12:08:56.45Z/SECOND+235MILLIS
foo_tdt:&quot;2013-03-10T08:00:00.1Z/MINUTE+6MONTHS&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Original problem report&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;DateMathParser doesn&apos;t work correctly.&lt;br/&gt;
&lt;a href=&quot;http://lucene.apache.org/solr/4_1_0/solr-core/org/apache/solr/util/DateMathParser.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.apache.org/solr/4_1_0/solr-core/org/apache/solr/util/DateMathParser.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;fq=last_modified:&quot;2013-03-08T00:46:15Z/DAY+6MONTHS+3DAYS&quot;&lt;/p&gt;

&lt;p&gt;expected; last_modified:2013-09-11T00:00:00Z&lt;br/&gt;
actual; last_modified:2013-09-08T00:00:00Z&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12635942">SOLR-4538</key>
            <summary>DateMath strings truncated to 32 chars by lucene qparser in simple term queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="minoru">Minoru Osuka</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Mar 2013 01:56:43 +0000</created>
                <updated>Fri, 10 May 2013 10:32:52 +0000</updated>
                            <resolved>Mon, 11 Mar 2013 21:55:11 +0000</resolved>
                                    <version>4.1</version>
                                    <fixVersion>4.3</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13596773" author="hossman" created="Fri, 8 Mar 2013 03:46:23 +0000"  >&lt;p&gt;Weird.  &lt;/p&gt;

&lt;p&gt;This appears to be a query parsing issue, not a DateMathParser issue.&lt;/p&gt;

&lt;p&gt;Works...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://localhost:8983/solr/select?q={!field%20f=foo_dt}2013-03-08T00:46:15Z/DAY%2B6MONTHS%2B3DAYS&amp;amp;debug=query
--&amp;gt; &amp;lt;str name=&quot;parsedquery&quot;&amp;gt;foo_dt:2013-09-11T00:00:00Z&amp;lt;/str&amp;gt;

http://localhost:8983/solr/select?q={!term%20f=foo_dt}2013-03-08T00:46:15Z/DAY%2B6MONTHS%2B3DAYS&amp;amp;debug=query
--&amp;gt; &amp;lt;str name=&quot;parsedquery&quot;&amp;gt;foo_dt:2013-09-11T00:00:00Z&amp;lt;/str&amp;gt;


http://localhost:8983/solr/select?q=*:*&amp;amp;rows=0&amp;amp;debug=query&amp;amp;facet=true&amp;amp;facet.range=foo_dt&amp;amp;facet.range.start=2013-03-08T00:46:15Z/DAY%2B6MONTHS%2B3DAYS&amp;amp;facet.range.end=2013-03-08T00:46:15Z/DAY%2B6MONTHS%2B3DAYS&amp;amp;facet.range.gap=%2B1DAY
--&amp;gt; &amp;lt;date name=&quot;start&quot;&amp;gt;2013-09-11T00:00:00Z&amp;lt;/date&amp;gt;
--&amp;gt; &amp;lt;date name=&quot;end&quot;&amp;gt;2013-09-11T00:00:00Z&amp;lt;/date&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fails...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://localhost:8983/solr/select?q=foo_dt:2013-03-08T00\:46\:15Z/DAY%2B6MONTHS%2B3DAYS&amp;amp;debug=query
--&amp;gt; &amp;lt;str name=&quot;parsedquery&quot;&amp;gt;foo_dt:2013-09-08T00:00:00Z&amp;lt;/str&amp;gt;

http://localhost:8983/solr/select?q=foo_dt:%222013-03-08T00:46:15Z/DAY%2B6MONTHS%2B3DAYS%22&amp;amp;debug=query
--&amp;gt; &amp;lt;str name=&quot;parsedquery&quot;&amp;gt;foo_dt:2013-09-08T00:00:00Z&amp;lt;/str&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(all URLs using Solr 4.1.0 with example configs)&lt;/p&gt;</comment>
                            <comment id="13597513" author="hossman" created="Fri, 8 Mar 2013 20:19:30 +0000"  >&lt;p&gt;This is so weird.  Somehow the query parser is deciding to ignore the last N chars of the string, where N can vary depending on the string.  in the examples posted to this issue so far, it just so happens that N winds up being the exact length of the last clause in the math, but in other cases you&apos;ll get an invalid date math expression which causes an error..&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://localhost:8983/solr/select?q=foo_tdt:%222013-03-10T08:00:00Z/MONTH%2B6MONTHS%22
Invalid Date Math String:&apos;2013-03-10T08:00:00Z/MONTH+6MONT&apos;

http://localhost:8983/solr/select?q=foooooo_tdt:%222013-03-10T08:00:00Z/MONTH%2B6MONTHS%22
Invalid Date Math String:&apos;2013-03-10T08:00:00Z/MONTH+6MONT&apos;

http://localhost:8983/solr/select?debug=query&amp;amp;q=foo_tdt:2013-03-10T08\:00\:00.1Z/MONTH%2B6MONTHS%2B1DAY
Invalid Date Math String:&apos;2013-03-10T08:00:00.1Z/MONTH+6MO&apos;

http://localhost:8983/solr/select?debug=query&amp;amp;q=foo_tdt:2013-03-10T08\:00\:00.123Z/MONTH%2B6MONTHS%2B1DAY
Invalid Date Math String:&apos;2013-03-10T08:00:00.123Z/MONTH+6&apos;

http://localhost:8983/solr/select?debug=query&amp;amp;q=foo_tdt:%222013-03-10T08:00:00Z/MINUTE%2B6MONTHS%22
Invalid Date Math String:&apos;2013-03-10T08:00:00Z/MINUTE+6MON&apos;

http://localhost:8983/solr/select?debug=query&amp;amp;q=foo_tdt:%222013-03-10T08:00:00.1Z/MINUTE%2B6MONTHS%22
Invalid Date Math String:&apos;2013-03-10T08:00:00.1Z/MINUTE+6M&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(all URLs using Solr 4.1.0 with example configs)&lt;/p&gt;</comment>
                            <comment id="13597534" author="hossman" created="Fri, 8 Mar 2013 20:41:53 +0000"  >&lt;p&gt;still no idea where the problem is, but here&apos;s a patch with tests showing off some of hte various problems&lt;/p&gt;</comment>
                            <comment id="13597546" author="yseeley@gmail.com" created="Fri, 8 Mar 2013 20:50:16 +0000"  >&lt;p&gt;I do know at this point that the difference is due to the query parser electing to use newFieldQuery() (which goes through the analyzer) rather than FieldType.getFieldQuery().&lt;br/&gt;
Not yet sure what&apos;s the issue with the analyzer though.&lt;/p&gt;</comment>
                            <comment id="13597603" author="yseeley@gmail.com" created="Fri, 8 Mar 2013 21:47:55 +0000"  >&lt;p&gt;Here&apos;s a patch that should fix the issue.  The TrieTokenizer previously assumed a max buffer length of 32 chars.  I just changed it to 128 for date fields.&lt;/p&gt;</comment>
                            <comment id="13597794" author="hossman" created="Sat, 9 Mar 2013 01:53:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;I just changed it to 128 for date fields.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t like the idea of kicking the can from 32 chars to 128 chars ... particularly since we&apos;ve already seen from the original report of this issue how simple truncation can lead to silently incorrect results instead of any clear and obvious error message.&lt;/p&gt;

&lt;p&gt;it seems simple enough to just grow the buffer if the input is long then expected &amp;#8211; it doesn&apos;t add any overhead to the common case of &quot;normal&quot; date (math) strings.&lt;/p&gt;

&lt;p&gt;New patch includes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;my previous tests&lt;/li&gt;
	&lt;li&gt;yonik&apos;s test&lt;/li&gt;
	&lt;li&gt;yonik&apos;s change to default the buffer size to 128 if it&apos;s a DATE field&lt;/li&gt;
	&lt;li&gt;a change to grow the buffer if it&apos;s not long enough&lt;/li&gt;
	&lt;li&gt;a test demonstrating date math strings longer then 128 chars&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13597810" author="hossman" created="Sat, 9 Mar 2013 02:16:15 +0000"  >&lt;p&gt;updated summary &amp;amp; description know that hte scope &amp;amp; root issue is known.&lt;/p&gt;</comment>
                            <comment id="13599066" author="thetaphi" created="Mon, 11 Mar 2013 18:03:54 +0000"  >&lt;p&gt;&lt;del&gt;Hoss: The term attribute is misused in the patch (as it is populated in ctor/reset()). It is also shared with the inner NumericTokenStream, which makes me nervous in combination with your changes. I just want to be sure, that the termattribute&apos;s contents are not used after thee ctor finishes, so incrementToken() can do what it wants with the attribute.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;You should maybe add a comment or use a separate growable instance like StringBuilder to get the chars and not misuse the term attribute.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;EDIT:&lt;/b&gt; The patch is fine, it uses a completely private term attribute instance, just to have a growable &quot;charsref-like&quot; instance. I would still prefer to use a StringBuilder for that, which can also be reset to zero length &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13599083" author="commit-tag-bot" created="Mon, 11 Mar 2013 18:16:31 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1455269&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1455269&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4538&quot; title=&quot;DateMath strings truncated to 32 chars by lucene qparser in simple term queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4538&quot;&gt;&lt;del&gt;SOLR-4538&lt;/del&gt;&lt;/a&gt;: Date Math expressions were being truncated to 32 characters when used in field:value queries in the lucene QParser&lt;/p&gt;</comment>
                            <comment id="13599370" author="hossman" created="Mon, 11 Mar 2013 21:55:11 +0000"  >&lt;p&gt;Committed revision 1455269.&lt;br/&gt;
Committed revision 1455348.&lt;br/&gt;
h&lt;/p&gt;</comment>
                            <comment id="13599375" author="thetaphi" created="Mon, 11 Mar 2013 21:58:46 +0000"  >&lt;p&gt;Thanks, all is fine! Although I don&apos;t like the pattern-misuse of CharTermAttribute, I am fine with the fix.&lt;/p&gt;</comment>
                            <comment id="13599384" author="commit-tag-bot" created="Mon, 11 Mar 2013 22:04:22 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1455348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1455348&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4538&quot; title=&quot;DateMath strings truncated to 32 chars by lucene qparser in simple term queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4538&quot;&gt;&lt;del&gt;SOLR-4538&lt;/del&gt;&lt;/a&gt;: Date Math expressions were being truncated to 32 characters when used in field:value queries in the lucene QParser (merge r1455269)&lt;/p&gt;</comment>
                            <comment id="13599389" author="hossman" created="Mon, 11 Mar 2013 22:09:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;Although I don&apos;t like the pattern-misuse of CharTermAttribute&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;as mentioned in IRC: the patch initially started trying to be consistent with how KeywordTokenizer works, but since NumericTokenStream doesn&apos;t support CharTermAttribute i made it private instead of using addAttribute().&lt;/p&gt;

&lt;p&gt;If anyone feels strongly about changing the implementation to not using CharTermAttributeImpl (and replace with StringBuilder, io-utils reader2String, whatever..) feel free, but i just choose to leave CharTermAttributeImpl in here because: a) i&apos;d already written the code &amp;amp; committed it to trunk before i even saw uwe&apos;s comment; b) it keeps the buffer resizing abstracted away out of the tokenizer and consistent with the behaviour of other tokenizers.&lt;/p&gt;</comment>
                            <comment id="13653750" author="thetaphi" created="Fri, 10 May 2013 10:32:52 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12572882" name="SOLR-4538.patch" size="6873" author="hossman" created="Sat, 9 Mar 2013 01:53:43 +0000"/>
                            <attachment id="12572838" name="SOLR-4538.patch" size="1662" author="yseeley@gmail.com" created="Fri, 8 Mar 2013 21:47:55 +0000"/>
                            <attachment id="12572823" name="SOLR-4538_test.patch" size="3432" author="hossman" created="Fri, 8 Mar 2013 20:41:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>316434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ilpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>316777</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>