<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:56:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6187] facet.mincount ignored in range faceting using distributed search</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6187</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;While I was trying to do a range faceting with gap +1YEAR using shards, I noticed that facet.mincount parameter seems to be ignored.&lt;/p&gt;

&lt;p&gt;Issue can be reproduced in this way:&lt;br/&gt;
Create 2 cores &quot;testshard1&quot; and &quot;testshard2&quot; with:&lt;/p&gt;

&lt;p&gt;solrconfig.xml&lt;br/&gt;
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&lt;br/&gt;
&amp;lt;config&amp;gt;&lt;br/&gt;
  &amp;lt;luceneMatchVersion&amp;gt;LUCENE_41&amp;lt;/luceneMatchVersion&amp;gt;&lt;br/&gt;
  &amp;lt;lib dir=&quot;/opt/solr/dist&quot; regex=&quot;solr-cell-.*\.jar&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;directoryFactory name=&quot;DirectoryFactory&quot; class=&quot;${solr.directoryFactory:solr.NRTCachingDirectoryFactory}&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;updateHandler class=&quot;solr.DirectUpdateHandler2&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;requestHandler name=&quot;/select&quot; class=&quot;solr.SearchHandler&quot;&amp;gt;&lt;br/&gt;
     &amp;lt;lst name=&quot;defaults&quot;&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;echoParams&quot;&amp;gt;explicit&amp;lt;/str&amp;gt;&lt;br/&gt;
       &amp;lt;int name=&quot;rows&quot;&amp;gt;10&amp;lt;/int&amp;gt;&lt;br/&gt;
       &amp;lt;str name=&quot;df&quot;&amp;gt;id&amp;lt;/str&amp;gt;&lt;br/&gt;
     &amp;lt;/lst&amp;gt;&lt;br/&gt;
  &amp;lt;/requestHandler&amp;gt;&lt;br/&gt;
  &amp;lt;requestHandler name=&quot;/update&quot; class=&quot;solr.UpdateRequestHandler&quot;  /&amp;gt;&lt;br/&gt;
  &amp;lt;requestHandler name=&quot;/admin/&quot; class=&quot;org.apache.solr.handler.admin.AdminHandlers&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;requestHandler name=&quot;/admin/ping&quot; class=&quot;solr.PingRequestHandler&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;lst name=&quot;invariants&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;str name=&quot;q&quot;&amp;gt;solrpingquery&amp;lt;/str&amp;gt;&lt;br/&gt;
    &amp;lt;/lst&amp;gt;&lt;br/&gt;
    &amp;lt;lst name=&quot;defaults&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;str name=&quot;echoParams&quot;&amp;gt;all&amp;lt;/str&amp;gt;&lt;br/&gt;
    &amp;lt;/lst&amp;gt;&lt;br/&gt;
  &amp;lt;/requestHandler&amp;gt;&lt;br/&gt;
&amp;lt;/config&amp;gt;&lt;/p&gt;

&lt;p&gt;schema.xml&lt;br/&gt;
&amp;lt;?xml version=&quot;1.0&quot; ?&amp;gt;&lt;br/&gt;
&amp;lt;schema name=&quot;${solr.core.name}&quot; version=&quot;1.5&quot; xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;fieldType name=&quot;int&quot; class=&quot;solr.TrieIntField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;fieldType name=&quot;long&quot; class=&quot;solr.TrieLongField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;fieldType name=&quot;date&quot; class=&quot;solr.TrieDateField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;field name=&quot;&lt;em&gt;version&lt;/em&gt;&quot; type=&quot;long&quot;     indexed=&quot;true&quot;  stored=&quot;true&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;field name=&quot;id&quot; type=&quot;int&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;false&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;field name=&quot;date&quot; type=&quot;date&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;false&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;uniqueKey&amp;gt;id&amp;lt;/uniqueKey&amp;gt;&lt;br/&gt;
  &amp;lt;defaultSearchField&amp;gt;id&amp;lt;/defaultSearchField&amp;gt;&lt;br/&gt;
&amp;lt;/schema&amp;gt;&lt;/p&gt;

&lt;p&gt;Insert in testshard1:&lt;br/&gt;
&amp;lt;add&amp;gt;&lt;br/&gt;
 &amp;lt;doc&amp;gt;&lt;br/&gt;
  &amp;lt;field name=&quot;id&quot;&amp;gt;1&amp;lt;/field&amp;gt;&lt;br/&gt;
  &amp;lt;field name=&quot;date&quot;&amp;gt;2014-06-20T12:51:00Z&amp;lt;/field&amp;gt;&lt;br/&gt;
 &amp;lt;/doc&amp;gt;&lt;br/&gt;
&amp;lt;/add&amp;gt;&lt;/p&gt;

&lt;p&gt;Insert into testshard2:&lt;br/&gt;
&amp;lt;add&amp;gt;&lt;br/&gt;
 &amp;lt;doc&amp;gt;&lt;br/&gt;
  &amp;lt;field name=&quot;id&quot;&amp;gt;2&amp;lt;/field&amp;gt;&lt;br/&gt;
  &amp;lt;field name=&quot;date&quot;&amp;gt;2013-06-20T12:51:00Z&amp;lt;/field&amp;gt;&lt;br/&gt;
 &amp;lt;/doc&amp;gt;&lt;br/&gt;
&amp;lt;/add&amp;gt;&lt;/p&gt;

&lt;p&gt;Now if I execute:&lt;/p&gt;

&lt;p&gt;curl &quot;http://localhost:8983/solr/testshard1/select?q=id:1&amp;amp;facet=true&amp;amp;facet.mincount=1&amp;amp;facet.range=date&amp;amp;f.date.facet.range.start=1900-01-01T00:00:00Z&amp;amp;f.date.facet.range.end=NOW&amp;amp;f.date.facet.range.gap=%2B1YEAR&amp;amp;shards=localhost%3A8983%2Fsolr%2Ftestshard1%2Clocalhost%3A8983%2Fsolr%2Ftestshard2&amp;amp;shards.info=true&amp;amp;wt=json&quot;&lt;/p&gt;

&lt;p&gt;I obtain:&lt;br/&gt;
{&quot;responseHeader&quot;:{&quot;status&quot;:0,&quot;QTime&quot;:88,&quot;params&quot;:{&quot;f.date.facet.range.gap&quot;:&quot;+1YEAR&quot;,&quot;f.date.facet.range.start&quot;:&quot;1900-01-01T00:00:00Z&quot;,&quot;facet&quot;:&quot;true&quot;,&quot;shards&quot;:&quot;localhost:8983/solr/testshard1,localhost:8983/solr/testshard2&quot;,&quot;facet.mincount&quot;:&quot;1&quot;,&quot;q&quot;:&quot;id:1&quot;,&quot;shards.info&quot;:&quot;true&quot;,&quot;facet.range&quot;:&quot;date&quot;,&quot;wt&quot;:&quot;json&quot;,&quot;f.date.facet.range.end&quot;:&quot;NOW&quot;}},&quot;shards.info&quot;:{&quot;localhost:8983/solr/testshard2&quot;:&lt;/p&gt;
{&quot;numFound&quot;:0,&quot;maxScore&quot;:0.0,&quot;shardAddress&quot;:&quot;http://localhost:8983/solr/testshard2&quot;,&quot;time&quot;:76}
&lt;p&gt;,&quot;localhost:8983/solr/testshard1&quot;:{&quot;numFound&quot;:1,&quot;maxScore&quot;:0.30685282,&quot;shardAddress&quot;:&quot;http://localhost:8983/solr/testshard1&quot;,&quot;time&quot;:79}},&quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;maxScore&quot;:0.30685282,&quot;docs&quot;:[&lt;/p&gt;
{&quot;id&quot;:1,&quot;date&quot;:&quot;2014-06-20T12:51:00Z&quot;}
&lt;p&gt;]},&quot;facet_counts&quot;:{&quot;facet_queries&quot;:{},&quot;facet_fields&quot;:{},&quot;facet_dates&quot;:{},&quot;facet_ranges&quot;:{&quot;date&quot;:{&quot;counts&quot;:&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;1900-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1901-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1902-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1903-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1904-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1905-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1906-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1907-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1908-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1909-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1910-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1911-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1912-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1913-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1914-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1915-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1916-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1917-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1918-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1919-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1920-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1921-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1922-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1923-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1924-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1925-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1926-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1927-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1928-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1929-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1930-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1931-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1932-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1933-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1934-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1935-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1936-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1937-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1938-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1939-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1940-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1941-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1942-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1943-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1944-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1945-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1946-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1947-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1948-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1949-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1950-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1951-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1952-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1953-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1954-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1955-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1956-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1957-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1958-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1959-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1960-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1961-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1962-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1963-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1964-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1965-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1966-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1967-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1968-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1969-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1970-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1971-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1972-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1973-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1974-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1975-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1976-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1977-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1978-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1979-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1980-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1981-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1982-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1983-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1984-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1985-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1986-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1987-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1988-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1989-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1990-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1991-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1992-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1993-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1994-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1995-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1996-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1997-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1998-01-01T00:00:00Z&amp;quot;,0,&amp;quot;1999-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2000-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2001-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2002-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2003-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2004-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2005-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2006-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2007-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2008-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2009-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2010-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2011-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2012-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2013-01-01T00:00:00Z&amp;quot;,0,&amp;quot;2014-01-01T00:00:00Z&amp;quot;,1&amp;#93;&lt;/span&gt;,&quot;gap&quot;:&quot;+1YEAR&quot;,&quot;start&quot;:&quot;1900-01-01T00:00:00Z&quot;,&quot;end&quot;:&quot;2015-01-01T00:00:00Z&quot;}}}}&lt;/p&gt;

&lt;p&gt;though facet.mincount is set to 1.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12722768">SOLR-6187</key>
            <summary>facet.mincount ignored in range faceting using distributed search</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="zaccheob">Zaccheo Bagnati</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Jun 2014 12:58:41 +0000</created>
                <updated>Mon, 9 May 2016 18:45:41 +0000</updated>
                            <resolved>Mon, 8 Sep 2014 17:43:58 +0000</resolved>
                                    <version>4.8</version>
                    <version>4.8.1</version>
                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14106479" author="erickerickson" created="Fri, 22 Aug 2014 05:20:40 +0000"  >&lt;p&gt;OK, a patch with tests. It&apos;s not ready to commit, but I&apos;d like some comments.&lt;/p&gt;

&lt;p&gt;The approach just doesn&apos;t feel very good. Unfortunately I don&apos;t see any good way to apply mincounts to distributed facets except to post-process the fully-counted list. I hope I did it in the right place. Suggestions for other approaches welcome!&lt;/p&gt;

&lt;p&gt;I&apos;ve got some code in there that processes (deprecated) date facets that is really questionable. Problem is that there&apos;s no good way to tell where the counts are for an old-style date facet. You get pairs like&lt;br/&gt;
&quot;2001-01-01T00:00:00Z&quot;&lt;br/&gt;
34 (as an integer)&lt;/p&gt;

&lt;p&gt;which is fine, but pretty soon you get things like&lt;br/&gt;
&quot;gap&quot;&lt;br/&gt;
&quot;+1YEAR&quot; (as a String)&lt;/p&gt;

&lt;p&gt;The current code says &quot;if the value is an integer, it must be a count so test it&quot; which is bogus at best. I propose to rip it out and just not support date facets for this issue, but wanted people to see it. I&apos;d rather have people who want mincounts for dates use the modern range faceting rather than introduce this kind of fragility and, perhaps, unintended consequences.&lt;/p&gt;

&lt;p&gt;This patch doesn&apos;t handle Pivot Facets, Interval Facets or Query Facets. The first one scares me, the second one I just haven&apos;t figured out how to test yet and the third doesn&apos;t strike me as very important since there aren&apos;t likely to be very many individual Query Facets. I may tackle Query and Interval if this approach isn&apos;t shot down.&lt;/p&gt;

&lt;p&gt;I&apos;m not very willing to try to put this in 4.10, even if the approach is OK. I&apos;d like to get this more in the 4.11 time-frame if at all.&lt;/p&gt;

&lt;p&gt;Probably handles &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6154&quot; title=&quot;SolrCloud: facet range option f.&amp;lt;field&amp;gt;.facet.mincount=1 omits buckets on response&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6154&quot;&gt;&lt;del&gt;SOLR-6154&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6300&quot; title=&quot;facet.mincount fails to work if SolrCloud distrib=true is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6300&quot;&gt;&lt;del&gt;SOLR-6300&lt;/del&gt;&lt;/a&gt; although I haven&apos;t tested those yet.&lt;/p&gt;

&lt;p&gt;All tests pass, although I haven&apos;t run precommit yet.&lt;/p&gt;</comment>
                            <comment id="14117895" author="erickerickson" created="Tue, 2 Sep 2014 05:05:29 +0000"  >&lt;p&gt;Another version of the patch. If testing is OK I&apos;ll commit this tomorrow unless there are objections:&lt;/p&gt;

&lt;p&gt;This patch has:&lt;br/&gt;
1&amp;gt; the date stuff ripped out&lt;br/&gt;
2&amp;gt; not doing the purging of facets &amp;lt; mincount until STAGE_DONE. I&apos;d &lt;em&gt;really&lt;/em&gt; like anyone who knows this code to comment if they can! My understanding is that we&apos;re ready to return the final-final packet to the original requester at this point, so it&apos;s an appropriate place to prune the response.&lt;/p&gt;

&lt;p&gt;On the plus side, I now know a bit more about the distributed facet code. On the minus side, I spent far too much time figuring it out...&lt;/p&gt;

&lt;p&gt;The bug I introduced with the previous patch (and I thank my lucky stars that there was a lot of unit testing in place) was that I was pruning the facets at each stage. So during the first stage there&apos;s some faceting done with some heuristics in place to trigger whether particular terms need to get fetched &quot;for real&quot;. By pruning the list before STAGE_DONE, the second round-trip wasn&apos;t being made and some facets were incorrectly pruned. Why am I going through all this? So anyone looking at the bug before I commit can tell me I&apos;m totally off base.&lt;/p&gt;

&lt;p&gt;I&apos;ll look at the other couple of JIRAs that might be associated with this one before committing.&lt;/p&gt;</comment>
                            <comment id="14117916" author="erickerickson" created="Tue, 2 Sep 2014 05:58:13 +0000"  >&lt;p&gt;OK, this one removes the &lt;em&gt;tests&lt;/em&gt; associated with the date facets.&lt;/p&gt;

&lt;p&gt;But it also makes me even more nervous. To get query facets and range facets to work, I had to use STAGE_EXECUTEQUERY rather than STAGE_DONE. Which just feels really, really wrong. I&apos;ll try some other stuff tomorrow unless someone has some wisdom to offer here.&lt;/p&gt;</comment>
                            <comment id="14118530" author="erickerickson" created="Tue, 2 Sep 2014 18:53:05 +0000"  >&lt;p&gt;Final patch I hope. I&apos;ll commit tomorrow or Thursday, I want to give people a chance to object to using STAGE_EXECUTEQUERY in all situations.&lt;/p&gt;

&lt;p&gt;I ran this through 300 iterations last night and didn&apos;t get a failure, I want to run the full test suite a few times today as well as think about it a bit more.&lt;/p&gt;</comment>
                            <comment id="14123743" author="erickerickson" created="Fri, 5 Sep 2014 22:52:40 +0000"  >&lt;p&gt;About date ranges. Since they&apos;re deprecated and the same functionality can be had with range facets and the fix would be fragile, I&apos;m not going to include fixing date ranges for mincount and distributed processing.&lt;/p&gt;

&lt;p&gt;The problem is this: The response packet is jumbled together, so you might have something like&lt;br/&gt;
2001-01-01T00:00:00Z 78&lt;br/&gt;
2002-01-01T00:00:00Z 33&lt;br/&gt;
gap: +1YEAR&lt;br/&gt;
start: &quot;2000-01-01T00:00:00Z&quot;&lt;/p&gt;

&lt;p&gt;So recognizing which parts of the response are numbers associated with dates is fragile. They are pairs, but even trying to recognize the date format regex will fail if the labels are changed with the &quot;key&quot; trick.&lt;/p&gt;

&lt;p&gt;And the objects are different in the response. In the above, 78 and 33 are integers, but not, of course, &quot;+1YEAR&quot;. I did try a hack that said, essentially, &quot;if it&apos;s a date facet and if the second member of the pair is an integer, it must be a count so see if it exceeds mincount and remove it if not&quot;. Yuuuuck.&lt;/p&gt;

&lt;p&gt;None of this applies to non-distributed modes since the things being examined for mincount are numerics &lt;em&gt;before&lt;/em&gt; they&apos;re put into a response packet. For distributed, we have to do things after they&apos;re put in a response packet and collated.&lt;/p&gt;</comment>
                            <comment id="14124951" author="erickerickson" created="Sun, 7 Sep 2014 16:18:10 +0000"  >&lt;p&gt;A significantly cleaned-up patch. Seems to fix this issue up, as well as &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6157&quot; title=&quot;ReplicationFactorTest hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6157&quot;&gt;&lt;del&gt;SOLR-6157&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Still want to see what&apos;s up with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6386&quot; title=&quot;make secondary ordering of facet.field values (and facet.pivot?) consistently deterministic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6386&quot;&gt;SOLR-6386&lt;/a&gt; before committing.&lt;/p&gt;</comment>
                            <comment id="14125725" author="jira-bot" created="Mon, 8 Sep 2014 16:34:24 +0000"  >&lt;p&gt;Commit 1623429 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1623429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1623429&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6187&quot; title=&quot;facet.mincount ignored in range faceting using distributed search&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6187&quot;&gt;&lt;del&gt;SOLR-6187&lt;/del&gt;&lt;/a&gt;: facet.mincount ignored in range faceting using distributed search&lt;/p&gt;</comment>
                            <comment id="14125732" author="erickerickson" created="Mon, 8 Sep 2014 16:39:34 +0000"  >&lt;p&gt;With CHANGES.txt entries&lt;/p&gt;</comment>
                            <comment id="14125796" author="jira-bot" created="Mon, 8 Sep 2014 17:38:09 +0000"  >&lt;p&gt;Commit 1623447 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1623447&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1623447&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6187&quot; title=&quot;facet.mincount ignored in range faceting using distributed search&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6187&quot;&gt;&lt;del&gt;SOLR-6187&lt;/del&gt;&lt;/a&gt;: facet.mincount ignored in range faceting using distributed search&lt;/p&gt;</comment>
                            <comment id="14129728" author="zaccheob" created="Thu, 11 Sep 2014 07:12:48 +0000"  >&lt;p&gt;Sorry for not giving feedback but I&apos;,m not familiar with SOLR source code.&lt;br/&gt;
Can you please correct my name in CHANGES.txt: it&apos;s misspelled. Thank you.&lt;/p&gt;</comment>
                            <comment id="14187092" author="jira-bot" created="Tue, 28 Oct 2014 16:57:42 +0000"  >&lt;p&gt;Commit 1634915 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1634915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1634915&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6187&quot; title=&quot;facet.mincount ignored in range faceting using distributed search&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6187&quot;&gt;&lt;del&gt;SOLR-6187&lt;/del&gt;&lt;/a&gt;: fix Zaccheo&apos;s name in CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="14187095" author="jira-bot" created="Tue, 28 Oct 2014 16:58:39 +0000"  >&lt;p&gt;Commit 1634916 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1634916&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1634916&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6187&quot; title=&quot;facet.mincount ignored in range faceting using distributed search&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6187&quot;&gt;&lt;del&gt;SOLR-6187&lt;/del&gt;&lt;/a&gt;: fix Zaccheo&apos;s name in CHANGES.txt (merge r1634915)&lt;/p&gt;</comment>
                            <comment id="14187101" author="hossman" created="Tue, 28 Oct 2014 17:02:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you please correct my name in CHANGES.txt: it&apos;s misspelled.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Zaccheo: sorry about that, all fixed now. &lt;/p&gt;</comment>
                            <comment id="14187246" author="erickerickson" created="Tue, 28 Oct 2014 18:37:52 +0000"  >&lt;p&gt;Hoss:&lt;/p&gt;

&lt;p&gt;Thanks, slipped off my radar..&lt;/p&gt;

&lt;p&gt;Apologies Zaccheo...&lt;/p&gt;</comment>
                            <comment id="14332949" author="anshumg" created="Mon, 23 Feb 2015 05:02:46 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12720167">SOLR-6154</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12730688">SOLR-6300</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12720167">SOLR-6154</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12667190" name="SOLR-6187.patch" size="20859" author="erickerickson" created="Mon, 8 Sep 2014 16:39:34 +0000"/>
                            <attachment id="12667089" name="SOLR-6187.patch" size="19373" author="erickerickson" created="Sun, 7 Sep 2014 16:18:10 +0000"/>
                            <attachment id="12665951" name="SOLR-6187.patch" size="17095" author="erickerickson" created="Tue, 2 Sep 2014 18:53:05 +0000"/>
                            <attachment id="12665845" name="SOLR-6187.patch" size="17086" author="erickerickson" created="Tue, 2 Sep 2014 05:58:13 +0000"/>
                            <attachment id="12665839" name="SOLR-6187.patch" size="18180" author="erickerickson" created="Tue, 2 Sep 2014 05:05:29 +0000"/>
                            <attachment id="12663595" name="SOLR-6187.patch" size="14756" author="erickerickson" created="Fri, 22 Aug 2014 05:20:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400955</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x0o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401040</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>