<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:47:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5628] Cloud test harness can cause index files to be deleted before IndexWriter is closed</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5628</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This bug was orriginally opened because Jenkins uncovered a test seed that causes a reproducible IndexWriter assertion failure in TestDistribDocBasedVersion on the 4x branch.&lt;/p&gt;

&lt;p&gt;McCandless helped dig in and believe that something in the way the solr test framework is setup is causing the test to delete the index dirs before the IndexWriter is being closed. Meanwhile, the failures later reproduced in other seeds on both 4x and trunk &amp;#8211; and it appears that recent changes caused the nature of the failure to change, so that now &amp;#8211; in addition to the IndexWriter assertion failure &amp;#8211; the test cleanup also stalls out and the test runner has to terminate some stalled threads.&lt;/p&gt;

&lt;p&gt;One interesting factor about this test is that at the end of the test there were docs that had been added that were not committed &amp;#8211; which is probably unusually for most tests, and may explain why more cloud tests aren&apos;t exhibiting similar symptoms more often.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;When a useless (from perspective of what the test is trying to verify) &quot;commit&quot; was added to the test, the failing seed stoped reproducing.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;An example of how to reliably reproduce this problem on an (older version of) trunk...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;svn update -r 1574381 &amp;amp;&amp;amp; ant clean &amp;amp;&amp;amp; cd solr/core &amp;amp;&amp;amp; ant test  -Dtestcase=TestDistribDocBasedVersion -Dtests.seed=1249227945045A2E -Dtests.slow=true -Dtests.locale=ko_KR -Dtests.timezone=America/Monterrey -Dtests.file.encoding=ISO-8859-1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Original email thread...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://mail-archives.apache.org/mod_mbox/lucene-dev/201401.mbox/%3Calpine.DEB.2.02.1401100930260.20275@frisbee%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mail-archives.apache.org/mod_mbox/lucene-dev/201401.mbox/%3Calpine.DEB.2.02.1401100930260.20275@frisbee%3E&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12688589">SOLR-5628</key>
            <summary>Cloud test harness can cause index files to be deleted before IndexWriter is closed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jan 2014 18:31:55 +0000</created>
                <updated>Thu, 11 Jan 2018 16:37:47 +0000</updated>
                                                                            <component>SolrCloud</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13869802" author="hossman" created="Mon, 13 Jan 2014 18:32:22 +0000"  >&lt;p&gt;Comments from McCandless based on his investigation...&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;OK, this seems to be a test bug: somehow, the main thread is removing&lt;br/&gt;
the entire index directory from the filesystem, before another thread&lt;br/&gt;
calls IW.close.&lt;/p&gt;

&lt;p&gt;I can see the test opens 5 IW instances, and then things run fine, and&lt;br/&gt;
then the 5 IWs are closed in sequence in a thread, but in the main&lt;br/&gt;
thread is returning (randomized testing prints &quot;OK      20.1s |&lt;br/&gt;
TestDistribDocBasedVersion.testDistribSearch&quot;) before the last 2 IWs&lt;br/&gt;
are closed.&lt;/p&gt;

&lt;p&gt;So somewhere in the main thread, something is concurrently removing&lt;br/&gt;
the index directory before the last 2 IWs are closed.&lt;/p&gt;

&lt;p&gt;I tried passing -Dtests.leaveTemporary=true and the test still fails,&lt;br/&gt;
so I don&apos;t think it&apos;s test-framework that&apos;s removing the index dir; I&lt;br/&gt;
think it&apos;s something somewhere in Solr&apos;s test infrastructure?&lt;/p&gt;

&lt;p&gt;Probably there is just a missing call somewhere to cleanly shutdown&lt;br/&gt;
all cores before cleaning up?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;OK, indeed, I tried passing -Dsolr.test.leavedatadir=true (thanks&lt;br/&gt;
Rob!) and that makes the test pass.&lt;/p&gt;

&lt;p&gt;So somewhere this test just needs to properly close things before&lt;br/&gt;
removing filesystem directories.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;However, when i attempted to add &lt;tt&gt;-Dsolr.test.leavedatadir=true -Dtests.leaveTemporary=true&lt;/tt&gt; I could still reproduce the failure.&lt;/p&gt;

&lt;p&gt;Meanwhile, the specific behavior of the failure seems to have changed slightly between  r1556643 and r1557798&lt;/p&gt;

&lt;p&gt;Here&apos;s the failure on branch_4x as of r1556643 ...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=137, name=Lucene Merge Thread #0, state=RUNNABLE, group=TGRP-TestDistribDocBasedVersion]
   [junit4]    &amp;gt; Caused by: org.apache.lucene.index.MergePolicy$MergeException: java.lang.AssertionError
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([791402573DC76F3C]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:545)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:518)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter._mergeInit(IndexWriter.java:3807)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.mergeInit(IndexWriter.java:3791)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3644)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:405)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:482)Throwable #2: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=138, name=Lucene Merge Thread #0, state=RUNNABLE, group=TGRP-TestDistribDocBasedVersion]
   [junit4]    &amp;gt; Caused by: org.apache.lucene.index.MergePolicy$MergeException: java.lang.AssertionError
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([791402573DC76F3C]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:545)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:518)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter._mergeInit(IndexWriter.java:3807)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.mergeInit(IndexWriter.java:3791)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3644)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:405)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:482)
   [junit4] Completed in 29.76s, 1 test, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
   [junit4] 
   [junit4] 
   [junit4] Tests with failures:
   [junit4]   - org.apache.solr.cloud.TestDistribDocBasedVersion (suite)
   [junit4] 
   [junit4] 
   [junit4] JVM J0:     0.41 ..    31.03 =    30.62s
   [junit4] Execution time total: 31 seconds
   [junit4] Tests summary: 1 suite, 1 test, 2 suite-level errors
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... but if you then svn update to r1557798...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 167814 T9 ccr.ThreadLeakControl.checkThreadLeaks SEVERE 2 threads leaked from SUITE scope at org.apache.solr.cloud.TestDistribDocBasedVersion: 
   [junit4]   2&amp;gt; 	   1) Thread[id=113, name=searcherExecutor-42-thread-1, state=WAITING, group=TGRP-TestDistribDocBasedVersion]
   [junit4]   2&amp;gt; 	        at sun.misc.Unsafe.park(Native Method)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:386)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1069)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1131)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
   [junit4]   2&amp;gt; 	        at java.lang.Thread.run(Thread.java:701)
   [junit4]   2&amp;gt; 	   2) Thread[id=93, name=searcherExecutor-32-thread-1, state=WAITING, group=TGRP-TestDistribDocBasedVersion]
   [junit4]   2&amp;gt; 	        at sun.misc.Unsafe.park(Native Method)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:386)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1069)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1131)
   [junit4]   2&amp;gt; 	        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
   [junit4]   2&amp;gt; 	        at java.lang.Thread.run(Thread.java:701)

...

   [junit4] ERROR   0.00s | TestDistribDocBasedVersion (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: ERROR: SolrIndexSearcher opens=19 closes=17
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([791402573DC76F3C]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.endTrackingSearchers(SolrTestCaseJ4.java:335)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.afterClass(SolrTestCaseJ4.java:139)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:701)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: 2 threads leaked from SUITE scope at org.apache.solr.cloud.TestDistribDocBasedVersion: 
   [junit4]    &amp;gt;    1) Thread[id=113, name=searcherExecutor-42-thread-1, state=WAITING, group=TGRP-TestDistribDocBasedVersion]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
   [junit4]    &amp;gt;         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:386)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1069)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1131)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
   [junit4]    &amp;gt;         at java.lang.Thread.run(Thread.java:701)
   [junit4]    &amp;gt;    2) Thread[id=93, name=searcherExecutor-32-thread-1, state=WAITING, group=TGRP-TestDistribDocBasedVersion]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
   [junit4]    &amp;gt;         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:386)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1069)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1131)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
   [junit4]    &amp;gt;         at java.lang.Thread.run(Thread.java:701)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([791402573DC76F3C]:0)Throwable #3: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
   [junit4]    &amp;gt;    1) Thread[id=113, name=searcherExecutor-42-thread-1, state=WAITING, group=TGRP-TestDistribDocBasedVersion]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
   [junit4]    &amp;gt;         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:386)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1069)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1131)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
   [junit4]    &amp;gt;         at java.lang.Thread.run(Thread.java:701)
   [junit4]    &amp;gt;    2) Thread[id=93, name=searcherExecutor-32-thread-1, state=WAITING, group=TGRP-TestDistribDocBasedVersion]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
   [junit4]    &amp;gt;         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:386)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1069)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1131)
   [junit4]    &amp;gt;         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
   [junit4]    &amp;gt;         at java.lang.Thread.run(Thread.java:701)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([791402573DC76F3C]:0)Throwable #4: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=137, name=Lucene Merge Thread #0, state=RUNNABLE, group=TGRP-TestDistribDocBasedVersion]
   [junit4]    &amp;gt; Caused by: org.apache.lucene.index.MergePolicy$MergeException: java.lang.AssertionError
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([791402573DC76F3C]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:545)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:518)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter._mergeInit(IndexWriter.java:3817)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.mergeInit(IndexWriter.java:3801)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3654)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:405)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:482)Throwable #5: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=138, name=Lucene Merge Thread #0, state=RUNNABLE, group=TGRP-TestDistribDocBasedVersion]
   [junit4]    &amp;gt; Caused by: org.apache.lucene.index.MergePolicy$MergeException: java.lang.AssertionError
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([791402573DC76F3C]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:545)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:518)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter._mergeInit(IndexWriter.java:3817)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.mergeInit(IndexWriter.java:3801)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3654)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:405)
   [junit4]    &amp;gt; 	at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:482)
   [junit4] Completed in 171.33s, 1 test, 1 failure, 4 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
   [junit4] 
   [junit4] 
   [junit4] Tests with failures:
   [junit4]   - org.apache.solr.cloud.TestDistribDocBasedVersion (suite)
   [junit4] 
   [junit4] 
   [junit4] JVM J0:     0.41 ..   172.56 =   172.15s
   [junit4] Execution time total: 2 minutes 52 seconds
   [junit4] Tests summary: 1 suite, 1 test, 5 suite-level errors

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The key question being: what changed on 4x between these two versions that causes these zombie threads on top of the existing problem?&lt;/p&gt;</comment>
                            <comment id="13869826" author="hossman" created="Mon, 13 Jan 2014 18:50:19 +0000"  >&lt;p&gt;One thing that may be making this test special is that at the end of the test, docs have been added that are not committed &amp;#8211; which may be why more cloud tests aren&apos;t exhibiting similar symptoms more often.&lt;/p&gt;

&lt;p&gt;I attempted to clone this test and then prune it down to try and distill out the bare bones of what was wrong, but ran into an interesting discovery: the exact same test class, with only the name changed, doesn&apos;t fail using the same seed.&lt;/p&gt;

&lt;p&gt;(note: i&apos;ve verified the following steps on branch_4x both using r1556643 and r1557806)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@frisbee:~/lucene/4x_dev$ cat solr/core/src/test/org/apache/solr/cloud/TestDistribDocBasedVersion.java | perl -pe &apos;s/TestDistribDocBasedVersion/TestUncommitedDocsInCloudTest/s&apos; &amp;gt; solr/core/src/test/org/apache/solr/cloud/TestUncommitedDocsInCloudTest.java
hossman@frisbee:~/lucene/4x_dev$ diff solr/core/src/test/org/apache/solr/cloud/TestDistribDocBasedVersion.java solr/core/src/test/org/apache/solr/cloud/TestUncommitedDocsInCloudTest.java
37c37
&amp;lt; public class TestDistribDocBasedVersion extends AbstractFullDistribZkTestBase {
---
&amp;gt; public class TestUncommitedDocsInCloudTest extends AbstractFullDistribZkTestBase {
55c55
&amp;lt;   public TestDistribDocBasedVersion() {
---
&amp;gt;   public TestUncommitedDocsInCloudTest() {
hossman@frisbee:~/lucene/4x_dev$ ant clean &amp;amp;&amp;amp; cd solr/core &amp;amp;&amp;amp; ant test  -Dtestcase=TestUncommitedDocsInCloudTest -Dtests.seed=791402573DC76F3C -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=ar_IQ -Dtests.timezone=Antarctica/Rothera -Dtests.file.encoding=US-ASCII

...

   [junit4] JVM J0:     0.41 ..    32.98 =    32.56s
   [junit4] Execution time total: 33 seconds
   [junit4] Tests summary: 1 suite, 1 test
     [echo] 5 slowest tests:
[junit4:tophints] 231.44s | org.apache.solr.util.SimplePostToolTest
[junit4:tophints] 203.23s | org.apache.solr.cloud.BasicDistributedZkTest
[junit4:tophints] 126.58s | org.apache.solr.cloud.TriLevelCompositeIdRoutingTest
[junit4:tophints] 111.38s | org.apache.solr.cloud.CollectionsAPIDistributedZkTest
[junit4:tophints] 106.55s | org.apache.solr.cloud.BasicDistributedZk2Test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13870084" author="dweiss" created="Mon, 13 Jan 2014 22:45:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;the exact same test class, with only the name changed, doesn&apos;t fail using the same seed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is by design, Hoss. The input seed for a class is mangled with class name. See LuceneTestCase&apos;s header:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@SeedDecorators({MixWithSuiteName.class}) &lt;span class=&quot;code-comment&quot;&gt;// See LUCENE-3995 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; rationale.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and refer to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3995&quot; title=&quot;In LuceneTestCase.beforeClass, make a new random (also using the class hashcode) to vary defaults&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-3995&quot;&gt;&lt;del&gt;LUCENE-3995&lt;/del&gt;&lt;/a&gt; for  more.&lt;/p&gt;

&lt;p&gt;In general, the seed is valid for repros only if nothing changes at the code level. It&apos;s much like uncertainty principle &amp;#8211; if you change the tiniest bit that affects randomization the execution paths may (and should) change (a lot).&lt;/p&gt;</comment>
                            <comment id="13870123" author="hossman" created="Mon, 13 Jan 2014 23:34:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;In general, the seed is valid for repros only if nothing changes at the code level&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, i completely understand the value add ... it just caught me off guard and was really confusing and unexpected.  Makes it tricky to try and create new tests that reproduce the essence of individual random failures.&lt;/p&gt;

&lt;p&gt;(I tried to clone the failing test with a new name, and then run lots of random iters to find a seed that would fail so i could start pruning the test down to just it&apos;s essenace for reproducing, and after 300 loops of &quot;&lt;tt&gt;while ant test -Dtestcase=NewTestName ... ; do echo &quot;Still Going&quot; &amp;gt;&amp;gt; counter.txt; done&lt;/tt&gt;&quot; i still hadn&apos;t found one so i gave up for now)&lt;/p&gt;</comment>
                            <comment id="13922687" author="jira-bot" created="Thu, 6 Mar 2014 16:13:21 +0000"  >&lt;p&gt;Commit 1574941 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1574941&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1574941&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5628&quot; title=&quot;Cloud test harness can cause index files to be deleted before IndexWriter is closed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5628&quot;&gt;SOLR-5628&lt;/a&gt;: work arround for this test to avoid whatever bug is in the cloud test framework&lt;/p&gt;</comment>
                            <comment id="13922694" author="hossman" created="Thu, 6 Mar 2014 16:15:03 +0000"  >&lt;p&gt;I&apos;ve edited the description to reflect the updated state of things, since i&apos;ve been able to commit a work around to the original test that manifested the problem with the cloud test framework.&lt;/p&gt;</comment>
                            <comment id="13922697" author="jira-bot" created="Thu, 6 Mar 2014 16:17:19 +0000"  >&lt;p&gt;Commit 1574942 from hossman@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1574942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1574942&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5628&quot; title=&quot;Cloud test harness can cause index files to be deleted before IndexWriter is closed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5628&quot;&gt;SOLR-5628&lt;/a&gt;: work arround for this test to avoid whatever bug is in the cloud test framework (merge r1574941)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367608</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rd47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367916</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>