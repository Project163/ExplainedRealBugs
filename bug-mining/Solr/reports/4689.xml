<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:47:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15311] MODIFYCOLLECTION configName with async fails</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15311</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Hi, &lt;br/&gt;
If you perform a `MODIFYCOLLECTION` with an `async` number, it will fail after about 30 seconds.  However the exact same request without async works just fine and returns successfully instantly.&lt;/p&gt;

&lt;p&gt;{{&lt;br/&gt;
11:34:01.057 &lt;span class=&quot;error&quot;&gt;&amp;#91;OverseerThreadFactory-20-thread-5-processing-n:solr-0.search-solr.svc.cluster.local:80_solr&amp;#93;&lt;/span&gt; ERROR org.apache.solr.cloud.api.collections.OverseerCollectionMessageHandler - Collection: at-uk-004 operation: modifycollection failed:org.apache.solr.common.SolrException: Could not modify collection &lt;/p&gt;
{
  &quot;collection&quot;:&quot;at-uk-004&quot;,
  &quot;async&quot;:&quot;1617449610&quot;,
  &quot;operation&quot;:&quot;modifycollection&quot;}
&lt;p&gt;        at org.apache.solr.cloud.api.collections.OverseerCollectionMessageHandler.modifyCollection(OverseerCollectionMessageHandler.java:669)&lt;br/&gt;
        at org.apache.solr.cloud.api.collections.OverseerCollectionMessageHandler.processMessage(OverseerCollectionMessageHandler.java:266)&lt;br/&gt;
        at org.apache.solr.cloud.OverseerTaskProcessor$Runner.run(OverseerTaskProcessor.java:524)&lt;br/&gt;
        at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:218)&lt;br/&gt;
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)&lt;br/&gt;
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)&lt;br/&gt;
        at java.base/java.lang.Thread.run(Thread.java:834)&lt;br/&gt;
}}&lt;/p&gt;

&lt;p&gt;The request i&apos;m sending (POST):&lt;br/&gt;
{{&lt;br/&gt;
    const url = `${this.host}/solr/admin/collections`&lt;br/&gt;
    const searchParams = &lt;/p&gt;
{
      action: &apos;MODIFYCOLLECTION&apos;,
      collection: collectionName,
      &apos;collection.configName&apos;: newConfigName
    }
&lt;p&gt;}}&lt;/p&gt;</description>
                <environment></environment>
        <key id="13369403">SOLR-15311</key>
            <summary>MODIFYCOLLECTION configName with async fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kstoney">Karl Stoney</reporter>
                        <labels>
                    </labels>
                <created>Sat, 3 Apr 2021 11:53:27 +0000</created>
                <updated>Tue, 28 Sep 2021 20:23:01 +0000</updated>
                            <resolved>Thu, 3 Jun 2021 21:52:00 +0000</resolved>
                                    <version>8.8</version>
                    <version>8.8.1</version>
                                    <fixVersion>8.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10200">2h 50m</timespent>
                                <comments>
                            <comment id="17320171" author="cpoerschke" created="Tue, 13 Apr 2021 13:17:50 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kstoney&quot; class=&quot;user-hover&quot; rel=&quot;kstoney&quot;&gt;kstoney&lt;/a&gt;, thanks for reporting this issue! I can reproduce locally via the following steps:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./gradlew -p solr dev

solr/packaging/build/solr-9.0.0-SNAPSHOT/bin/solr start -e cloud -noprompt

curl &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/admin/collections?action=MODIFYCOLLECTION&amp;amp;collection=gettingstarted&amp;amp;collection.configName=_default&amp;amp;async=1234&quot;&lt;/span&gt;
&lt;/span&gt;
curl &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/admin/collections?action=REQUESTSTATUS&amp;amp;requestid=1234&quot;&lt;/span&gt;
&lt;/span&gt;
solr/packaging/build/solr-9.0.0-SNAPSHOT/bin/solr stop -all
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As an aside, I note that &lt;a href=&quot;https://solr.apache.org/guide/8_8/collection-management.html#modifycollection&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://solr.apache.org/guide/8_8/collection-management.html#modifycollection&lt;/a&gt; does &lt;em&gt;not yet&lt;/em&gt; document the &lt;tt&gt;async&lt;/tt&gt; parameter i.e. when the issue is fixed we can hopefully document it as supported and in the meantime optimistically we assume that it was intended to be supported (since it&apos;s not explicitly rejected when supplied) and the non-documentation was an oversight.&lt;/p&gt;

&lt;p&gt;What I&apos;m seeing is that the modification itself works but the collection reload fails, is that what you are seeing too?&lt;/p&gt;

&lt;p&gt;From a cursory look at the code around &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.8.2/solr/core/src/java/org/apache/solr/cloud/api/collections/OverseerCollectionMessageHandler.java#L638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.8.2/solr/core/src/java/org/apache/solr/cloud/api/collections/OverseerCollectionMessageHandler.java#L638&lt;/a&gt; I wonder (thinking out aloud) what the required code pattern or user expectations are in this scenario e.g. as a user do we expect to be given only &quot;1234&quot; back as the request id to track (and that covers all the necessary work) or do we expect to be given back &quot;1234&quot; and possibly additional request ids to track i.e. a separate request id for async reload? If the user expects no additional ids then how does that look like from an implementation perspective, will there be an internal async id for the reload or does the reload happen synchronously within the task tracked by the &quot;1234&quot; request id? &amp;lt;end of thinking out aloud&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17320175" author="kstoney" created="Tue, 13 Apr 2021 13:22:09 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt; - thanks for looking at it.&lt;br/&gt;
That&apos;s correct, the operation completes just fine - so it isn&apos;t a major issue.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure about the thinking out loud part, from a naive end user perspective, i&apos;d like it to just work like the rest of the collections api in that i send a RELOADCOLLECTION with an asyncid, and i can status that until the whole operation is done.&lt;/p&gt;</comment>
                            <comment id="17321223" author="cpoerschke" created="Wed, 14 Apr 2021 18:20:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;... That&apos;s correct, the operation completes just fine ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks for confirming!&lt;/p&gt;

&lt;p&gt;So taking another look at the code this evening, I have a partially explored theory:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;see at &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.8.2/solr/core/src/java/org/apache/solr/cloud/api/collections/OverseerCollectionMessageHandler.java#L646-L648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.8.2/solr/core/src/java/org/apache/solr/cloud/api/collections/OverseerCollectionMessageHandler.java#L646-L648&lt;/a&gt; how it inspects the cluster state w.r.t. the collection and how it checks it against the details of the &quot;modify collection&quot; request to see it&apos;s been fully applied?&lt;/li&gt;
	&lt;li&gt;now first i thought that well, the &lt;tt&gt;configName&lt;/tt&gt; is not stored in the cluster state and so it&apos;s never gonna find it there but then I noticed that that&apos;s accounted for by the &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.8.2/solr/core/src/java/org/apache/solr/cloud/api/collections/OverseerCollectionMessageHandler.java#L631&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.8.2/solr/core/src/java/org/apache/solr/cloud/api/collections/OverseerCollectionMessageHandler.java#L631&lt;/a&gt; removal which also has a very helpful comment to that effect.&lt;/li&gt;
	&lt;li&gt;alright, so it&apos;s not that then plus that wouldn&apos;t have explained why the issue only happens with &quot;async&quot; mode.&lt;/li&gt;
	&lt;li&gt;So then I saw on &lt;tt&gt;solr/main&lt;/tt&gt; branch the &lt;tt&gt;getZkStateReader().waitForState&lt;/tt&gt;&#160;and I wondered what happens if after the removal of the &lt;tt&gt;collection.configName&lt;/tt&gt; there is nothing left in the properties, would it be waiting around forever?&lt;/li&gt;
	&lt;li&gt;And anyway, what exactly is in the &lt;tt&gt;message.getProperties()&lt;/tt&gt; at this point?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, my theory is that in the &quot;async&quot; case the &quot;async&quot; is in them properties and well it can wait around forever it ain&apos;t never gonna find the &quot;async&quot; key and its value in the collection state or cluster state, is it?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kstoney&quot; class=&quot;user-hover&quot; rel=&quot;kstoney&quot;&gt;kstoney&lt;/a&gt;, would you be interested in investigating the theory further e.g. via a locally built Solr version you may already have and/or via &lt;tt&gt;solr/main&lt;/tt&gt; branch changes i.e. &lt;a href=&quot;https://github.com/apache/solr/blob/51e749d40486815d70b249ef1a02ce1cd3a644c1/solr/core/src/java/org/apache/solr/cloud/api/collections/CollApiCmds.java#L251-L263&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/51e749d40486815d70b249ef1a02ce1cd3a644c1/solr/core/src/java/org/apache/solr/cloud/api/collections/CollApiCmds.java#L251-L263&lt;/a&gt; loop adjustments?&lt;/p&gt;</comment>
                            <comment id="17329304" author="cpoerschke" created="Thu, 22 Apr 2021 17:19:50 +0000"  >&lt;p&gt;ticket linking via comment:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15311&quot; title=&quot;MODIFYCOLLECTION configName with async fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15311&quot;&gt;&lt;del&gt;SOLR-15311&lt;/del&gt;&lt;/a&gt; theory (here) is based on &lt;tt&gt;configName&lt;/tt&gt; not being stored in the state (currently)&lt;/li&gt;
	&lt;li&gt;the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14341&quot; title=&quot;Move a collection&amp;#39;s configSet name to state.json&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14341&quot;&gt;&lt;del&gt;SOLR-14341&lt;/del&gt;&lt;/a&gt; ticket is about moving &lt;tt&gt;configName&lt;/tt&gt; into the state (in future)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17356709" author="jira-bot" created="Thu, 3 Jun 2021 20:51:17 +0000"  >&lt;p&gt;Commit 387527a4747fbe11c67ff2c0480ce183fb18d13e in solr&apos;s branch refs/heads/main from Nazerke Seidan&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=387527a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=387527a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15311&quot; title=&quot;MODIFYCOLLECTION configName with async fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15311&quot;&gt;&lt;del&gt;SOLR-15311&lt;/del&gt;&lt;/a&gt;: MODIFYCOLLECTION now supports async (#152)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Nazerke Seidan &amp;lt;nseidan@salesforce.com&amp;gt;&lt;br/&gt;
Co-authored-by: David Smiley &amp;lt;dsmiley@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17356745" author="jira-bot" created="Thu, 3 Jun 2021 21:42:44 +0000"  >&lt;p&gt;Commit ec3e445104c365adc0eb09a10caad0c3baaa7d16 in lucene-solr&apos;s branch refs/heads/branch_8x from Nazerke Seidan&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ec3e445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ec3e445&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15311&quot; title=&quot;MODIFYCOLLECTION configName with async fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15311&quot;&gt;&lt;del&gt;SOLR-15311&lt;/del&gt;&lt;/a&gt;: MODIFYCOLLECTION now supports async (#152)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Nazerke Seidan &amp;lt;nseidan@salesforce.com&amp;gt;&lt;br/&gt;
Co-authored-by: David Smiley &amp;lt;dsmiley@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17356749" author="dsmiley" created="Thu, 3 Jun 2021 21:52:00 +0000"  >&lt;p&gt;Thanks everyone, and to Nazerke for working on the PR!&lt;/p&gt;</comment>
                            <comment id="17357477" author="jira-bot" created="Fri, 4 Jun 2021 16:38:01 +0000"  >&lt;p&gt;Commit 112585ee082d7e46aa416623f2624c5d854d442b in solr&apos;s branch refs/heads/main from Christine Poerschke&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=112585e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=112585e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15311&quot; title=&quot;MODIFYCOLLECTION configName with async fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15311&quot;&gt;&lt;del&gt;SOLR-15311&lt;/del&gt;&lt;/a&gt;: docs: document &apos;async&apos; as MODIFYCOLLECTION parameter (#161)&lt;/p&gt;

&lt;p&gt; instead of collection attribute/property&lt;br/&gt;
This is also consistent with other commands.&lt;/p&gt;</comment>
                            <comment id="17421740" author="thelabdude" created="Tue, 28 Sep 2021 20:23:01 +0000"  >&lt;p&gt;Closing after the 8.10.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0pi3k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>