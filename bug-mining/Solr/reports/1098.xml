<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:31:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3993] SolrCloud leader election on single node stucks the initialization</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3993</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt; setup:&lt;br/&gt;
1 node, 4 cores, 2 shards.&lt;br/&gt;
15 documents indexed.&lt;/p&gt;

&lt;p&gt;problem:&lt;br/&gt;
init stage times out.&lt;/p&gt;

&lt;p&gt;probable cause:&lt;br/&gt;
According to the init flow, cores are initialized one by one synchronously.&lt;br/&gt;
Actually, the main thread waits ShardLeaderElectionContext.waitForReplicasToComeUp until retry threshold, while replica cores are not yet initialized, in other words there is no chance other replicas go up in the meanwhile.&lt;br/&gt;
stack trace:&lt;br/&gt;
Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; (Suspended)&lt;br/&gt;
        owns: HashMap&amp;lt;K,V&amp;gt;  (id=3876)&lt;br/&gt;
        owns: StandardContext  (id=3877)&lt;br/&gt;
        owns: HashMap&amp;lt;K,V&amp;gt;  (id=3878)&lt;br/&gt;
        owns: StandardHost  (id=3879)&lt;br/&gt;
        owns: StandardEngine  (id=3880)&lt;br/&gt;
        owns: Service[]  (id=3881)&lt;br/&gt;
        Thread.sleep(long) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;&lt;br/&gt;
        ShardLeaderElectionContext.waitForReplicasToComeUp(boolean, String) line: 298&lt;br/&gt;
        ShardLeaderElectionContext.runLeaderProcess(boolean) line: 143&lt;br/&gt;
        LeaderElector.runIamLeaderProcess(ElectionContext, boolean) line: 152&lt;br/&gt;
        LeaderElector.checkIfIamLeader(int, ElectionContext, boolean) line: 96&lt;br/&gt;
        LeaderElector.joinElection(ElectionContext) line: 262&lt;br/&gt;
        ZkController.joinElection(CoreDescriptor, boolean) line: 733&lt;br/&gt;
        ZkController.register(String, CoreDescriptor, boolean, boolean) line: 566&lt;br/&gt;
        ZkController.register(String, CoreDescriptor) line: 532&lt;br/&gt;
        CoreContainer.registerInZk(SolrCore) line: 709&lt;br/&gt;
        CoreContainer.register(String, SolrCore, boolean) line: 693&lt;br/&gt;
        CoreContainer.load(String, InputSource) line: 535&lt;br/&gt;
        CoreContainer.load(String, File) line: 356&lt;br/&gt;
        CoreContainer$Initializer.initialize() line: 308&lt;br/&gt;
        SolrDispatchFilter.init(FilterConfig) line: 107&lt;br/&gt;
        ApplicationFilterConfig.getFilter() line: 295&lt;br/&gt;
        ApplicationFilterConfig.setFilterDef(FilterDef) line: 422&lt;br/&gt;
        ApplicationFilterConfig.&amp;lt;init&amp;gt;(Context, FilterDef) line: 115&lt;br/&gt;
        StandardContext.filterStart() line: 4072&lt;br/&gt;
        StandardContext.start() line: 4726&lt;br/&gt;
        StandardHost(ContainerBase).addChildInternal(Container) line: 799&lt;br/&gt;
        StandardHost(ContainerBase).addChild(Container) line: 779&lt;br/&gt;
        StandardHost.addChild(Container) line: 601&lt;br/&gt;
        HostConfig.deployDescriptor(String, File, String) line: 675&lt;br/&gt;
        HostConfig.deployDescriptors(File, String[]) line: 601&lt;br/&gt;
        HostConfig.deployApps() line: 502&lt;br/&gt;
        HostConfig.start() line: 1317&lt;br/&gt;
        HostConfig.lifecycleEvent(LifecycleEvent) line: 324&lt;br/&gt;
        LifecycleSupport.fireLifecycleEvent(String, Object) line: 142&lt;br/&gt;
        StandardHost(ContainerBase).start() line: 1065&lt;br/&gt;
        StandardHost.start() line: 840&lt;br/&gt;
        StandardEngine(ContainerBase).start() line: 1057&lt;br/&gt;
        StandardEngine.start() line: 463&lt;br/&gt;
        StandardService.start() line: 525&lt;br/&gt;
        StandardServer.start() line: 754&lt;br/&gt;
        Catalina.start() line: 595&lt;br/&gt;
        NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;&lt;br/&gt;
        NativeMethodAccessorImpl.invoke(Object, Object[]) line: not available&lt;br/&gt;
        DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: not available&lt;br/&gt;
        Method.invoke(Object, Object...) line: not available&lt;br/&gt;
        Bootstrap.start() line: 289&lt;br/&gt;
        Bootstrap.main(String[]) line: 414&lt;/p&gt;


&lt;p&gt;After a while, the session times out and following exception appears:&lt;br/&gt;
Oct 25, 2012 1:16:56 PM org.apache.solr.cloud.ShardLeaderElectionContext waitForReplicasToComeUp&lt;br/&gt;
INFO: Waiting until we see more replicas up: total=2 found=0 timeoutin=-95&lt;br/&gt;
Oct 25, 2012 1:16:56 PM org.apache.solr.cloud.ShardLeaderElectionContext waitForReplicasToComeUp&lt;br/&gt;
INFO: Was waiting for replicas to come up, but they are taking too long - assuming they won&apos;t come back till later&lt;br/&gt;
Oct 25, 2012 1:16:56 PM org.apache.solr.common.SolrException log&lt;br/&gt;
SEVERE: Errir checking for the number of election participants:org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /collections/collection1/leader_elect/shard2/election&lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:118)&lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:42)&lt;br/&gt;
        at org.apache.zookeeper.ZooKeeper.getChildren(ZooKeeper.java:1249)&lt;br/&gt;
        at org.apache.solr.common.cloud.SolrZkClient$6.execute(SolrZkClient.java:227)&lt;br/&gt;
        at org.apache.solr.common.cloud.SolrZkClient$6.execute(SolrZkClient.java:224)&lt;br/&gt;
        at org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:63)&lt;br/&gt;
        at org.apache.solr.common.cloud.SolrZkClient.getChildren(SolrZkClient.java:224)&lt;br/&gt;
        at org.apache.solr.cloud.ShardLeaderElectionContext.waitForReplicasToComeUp(ElectionContext.java:276)&lt;br/&gt;
        at org.apache.solr.cloud.ShardLeaderElectionContext.runLeaderProcess(ElectionContext.java:143)&lt;br/&gt;
        at org.apache.solr.cloud.LeaderElector.runIamLeaderProcess(LeaderElector.java:152)&lt;br/&gt;
        at org.apache.solr.cloud.LeaderElector.checkIfIamLeader(LeaderElector.java:96)&lt;br/&gt;
        at org.apache.solr.cloud.LeaderElector.joinElection(LeaderElector.java:262)&lt;br/&gt;
        at org.apache.solr.cloud.ZkController.joinElection(ZkController.java:733)&lt;br/&gt;
        at org.apache.solr.cloud.ZkController.register(ZkController.java:566)&lt;br/&gt;
        at org.apache.solr.cloud.ZkController.register(ZkController.java:532)&lt;br/&gt;
        at org.apache.solr.core.CoreContainer.registerInZk(CoreContainer.java:709)&lt;br/&gt;
        at org.apache.solr.core.CoreContainer.register(CoreContainer.java:693)&lt;br/&gt;
        at org.apache.solr.core.CoreContainer.load(CoreContainer.java:535)&lt;br/&gt;
        at org.apache.solr.core.CoreContainer.load(CoreContainer.java:356)&lt;br/&gt;
        at org.apache.solr.core.CoreContainer$Initializer.initialize(CoreContainer.java:308)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:107)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:295)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterConfig.setFilterDef(ApplicationFilterConfig.java:422)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterConfig.&amp;lt;init&amp;gt;(ApplicationFilterConfig.java:115)&lt;br/&gt;
        at org.apache.catalina.core.StandardContext.filterStart(StandardContext.java:4072)&lt;br/&gt;
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4726)&lt;br/&gt;
        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:799)&lt;br/&gt;
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:779)&lt;br/&gt;
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:601)&lt;br/&gt;
        at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:675)&lt;br/&gt;
        at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:601)&lt;br/&gt;
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:502)&lt;br/&gt;
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1317)&lt;br/&gt;
        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:324)&lt;br/&gt;
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:142)&lt;br/&gt;
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1065)&lt;br/&gt;
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:840)&lt;br/&gt;
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1057)&lt;br/&gt;
        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:463)&lt;br/&gt;
        at org.apache.catalina.core.StandardService.start(StandardService.java:525)&lt;br/&gt;
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:754)&lt;br/&gt;
        at org.apache.catalina.startup.Catalina.start(Catalina.java:595)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:289)&lt;br/&gt;
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414)&lt;/p&gt;

&lt;p&gt;Followed by:&lt;br/&gt;
Oct 25, 2012 1:17:27 PM org.apache.solr.cloud.RecoveryStrategy doRecovery&lt;br/&gt;
SEVERE: Recovery failed - trying again... core=collection1&lt;br/&gt;
Oct 25, 2012 1:18:32 PM org.apache.solr.common.SolrException log&lt;br/&gt;
SEVERE: Error while trying to recover. core=collection1&lt;br/&gt;
Oct 25, 2012 1:18:32 PM org.apache.solr.common.SolrException log&lt;br/&gt;
SEVERE: Error while trying to recover. core=collection1:org.apache.solr.common.SolrException: No registered leader was found, collection:collection1 slice:shard1&lt;br/&gt;
        at org.apache.solr.common.cloud.ZkStateReader.getLeaderProps(ZkStateReader.java:413)&lt;br/&gt;
        at org.apache.solr.common.cloud.ZkStateReader.getLeaderProps(ZkStateReader.java:399)&lt;br/&gt;
        at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:318)&lt;br/&gt;
        at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:220)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7, Tomcat 6&lt;/p&gt;</environment>
        <key id="12613505">SOLR-3993</key>
            <summary>SolrCloud leader election on single node stucks the initialization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="alexeyk">Alexey Kudinov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Oct 2012 15:25:07 +0000</created>
                <updated>Mon, 9 May 2016 18:50:55 +0000</updated>
                            <resolved>Sat, 1 Dec 2012 21:41:27 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13488596" author="markus17" created="Thu, 1 Nov 2012 10:36:35 +0000"  >&lt;p&gt;We&apos;re seeing this too using a current trunk on a 10 node test cluster. We can trigger this state if we restart all servlet containers sequentially or roughly at the same time, most nodes are stuck in this state too while others sometimes change to a different state throwing all kinds of exceptions (see list). We can only get out of this state by restarting some servlet containers again. It does &lt;em&gt;not&lt;/em&gt; happen at all with Zookeeper&apos;s data directory wiped clean. The cluster then starts very nicely.&lt;/p&gt;</comment>
                            <comment id="13490016" author="markrmiller@gmail.com" created="Sat, 3 Nov 2012 13:17:38 +0000"  >&lt;p&gt;Hey guys - I&apos;ve been out of power for the week and am headed to ApacheCon for next week, but I&apos;ll try and look into this soon. 4.1 is coming soon and I&apos;d like all these issues fixed in it.&lt;/p&gt;</comment>
                            <comment id="13494935" author="markrmiller@gmail.com" created="Sun, 11 Nov 2012 18:53:35 +0000"  >&lt;p&gt;I think a good way to solve this might be &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4063&quot; title=&quot;CoreContainer should be able to load multiple SolrCore&amp;#39;s in parallel rather than just serially.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4063&quot;&gt;&lt;del&gt;SOLR-4063&lt;/del&gt;&lt;/a&gt;: CoreContainer should be able to load multiple SolrCore&apos;s in parallel rather than just serially.&lt;/p&gt;

&lt;p&gt;Then just require a value of at least 2 when running in SolrCloud mode.&lt;/p&gt;</comment>
                            <comment id="13495057" author="markrmiller@gmail.com" created="Mon, 12 Nov 2012 00:42:14 +0000"  >&lt;p&gt;I&apos;ve written a test for that issue that fails before &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4063&quot; title=&quot;CoreContainer should be able to load multiple SolrCore&amp;#39;s in parallel rather than just serially.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4063&quot;&gt;&lt;del&gt;SOLR-4063&lt;/del&gt;&lt;/a&gt; and passes after it.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit it shortly.&lt;/p&gt;</comment>
                            <comment id="13495342" author="commit-tag-bot" created="Mon, 12 Nov 2012 15:35:23 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1408313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1408313&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3993&quot; title=&quot;SolrCloud leader election on single node stucks the initialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3993&quot;&gt;&lt;del&gt;SOLR-3993&lt;/del&gt;&lt;/a&gt;: If multiple SolrCore&apos;s for a shard coexist on a node, on cluster restart, leader election would stall until timeout, waiting to see all of  the replicas come up.&lt;/p&gt;
</comment>
                            <comment id="13495346" author="commit-tag-bot" created="Mon, 12 Nov 2012 15:39:28 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1408323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1408323&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3993&quot; title=&quot;SolrCloud leader election on single node stucks the initialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3993&quot;&gt;&lt;del&gt;SOLR-3993&lt;/del&gt;&lt;/a&gt;: If multiple SolrCore&apos;s for a shard coexist on a node, on cluster restart, leader election would stall until timeout, waiting to see all of  the replicas come up.&lt;/p&gt;
</comment>
                            <comment id="13495348" author="markrmiller@gmail.com" created="Mon, 12 Nov 2012 15:39:52 +0000"  >&lt;p&gt;Thanks Alexey!&lt;/p&gt;</comment>
                            <comment id="13497874" author="alexeyk" created="Thu, 15 Nov 2012 09:34:49 +0000"  >&lt;p&gt;Thanks Mark!&lt;br/&gt;
I will test it as soon as possible&lt;/p&gt;</comment>
                            <comment id="13498840" author="dl4ner" created="Fri, 16 Nov 2012 14:49:24 +0000"  >&lt;p&gt;Thanks Mark, works better. &lt;br/&gt;
tested nightly 2012-11-16  on a 1-shard-3-node-cluster (hardware, each core on different server, jetty container).&lt;/p&gt;

&lt;p&gt;I still can reproduce a problem:&lt;br/&gt;
1) simulate a power outage on the cluster (kill -9 on all servers), leaving the zookeeper ensemble running.&lt;br/&gt;
2) start only ONE core that has NOT been the former leader.&lt;/p&gt;

&lt;p&gt;Result: loop in Running recovery...&lt;/p&gt;

&lt;p&gt;3) restart that core (clean shutdown with kill instead of kill -9):&lt;/p&gt;

&lt;p&gt;Result: all will be fine.&lt;br/&gt;
(the node connects to zookeeper, registeres as leader, runs all changes, cleans the zookeeper queue, and finally &lt;br/&gt;
waits for other replicas to come up. After that timeout it declares itself as leader and all is fine).&lt;/p&gt;

&lt;p&gt;Second Problem (might be the at least similar):&lt;br/&gt;
1) setup: 1 shard, 3 codes, zookeeper ensemble on three servers. node 1 is leader. &lt;br/&gt;
2) thistime killall -9 java (shuts down zookeeper ensemble and solr cores - simulated power outage on all three servers)&lt;br/&gt;
3) start solr core on server 2 and 3 (which has NOT been leader). tries to connect to zookeeper, but can&apos;t)&lt;br/&gt;
4) start zookeeper on server 2 and 3 (that still simulates hardware failure of server #1)&lt;/p&gt;

&lt;p&gt;sometiomes both a core loops in recovery. &lt;br/&gt;
sometimes a core keeps stuck in &quot;shutting down&quot;. &quot;INFO: Client-&amp;gt;ZooKeeper status change trigger but we are already closed&quot;.&lt;/p&gt;

&lt;p&gt;restarting the cores helps everytime. &lt;/p&gt;

&lt;p&gt;kind regards.&lt;/p&gt;

</comment>
                            <comment id="13499543" author="markrmiller@gmail.com" created="Sat, 17 Nov 2012 22:48:31 +0000"  >&lt;p&gt;Bummer - hard to make a test that simulates kill -9. I imagine the key issue is that the nodes going down are having the leader ephemerals timeout - perhaps when I get some time I can work on simulating that.&lt;/p&gt;</comment>
                            <comment id="13502629" author="brui" created="Thu, 22 Nov 2012 07:49:34 +0000"  >&lt;p&gt;TO Werner :&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2) start only ONE core that has NOT been the former leader.&lt;br/&gt;
&#8230;&#8230;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Result: loop in Running recovery...&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;this only one core will be the leader finally. this will take a long time cause the waitForReplicasComeup() will end for timeout. this core will cancelRecovery() after he is the leader. it wouldn&apos;t run in loop cause cancelRecovery() will stop recovery thread. But before this core become the leader the recovery thread try to connect to old leader and do recovery. recovery thread will throw a lot of exceptions along this process duo to the dead leader. it&apos;s fine since the recovery thread will die too &lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Second Problem (might be the at least similar):&lt;br/&gt;
live zookeeper is a precondition of solr cluster and also the zookeeper service  must ready before start a solr instance. you&apos;d better use zookeeper service separately&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="13502672" author="dl4ner" created="Thu, 22 Nov 2012 09:28:10 +0000"  >&lt;p&gt;To Po: (thanks for your comment)&lt;/p&gt;

&lt;p&gt;1) &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;this only one core will be the leader finally. this will take a long time cause the waitForReplicasComeup() &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I don&apos;t see a WaitForReplicasComeUp in the logs in that case. Maybe I missinterpreted the lots of exceptions in the log.&lt;br/&gt;
After power fail or kill -9 it shows (for me) a recovery loop. Maybe this loop will end eventually (I stopped watching &lt;br/&gt;
after some 10..15min). I&apos;ll try that again if I have some minutes. &lt;/p&gt;

&lt;p&gt;2) Zookeeper:&lt;br/&gt;
I know. But I&apos;m a sysadmin dealing with real hardware (and failures) - not a programmer that just uses failure-free hardware and proposes preconditions &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I have seen a ROW of 19&quot;-cabinets going down - even though each of them had TWO redundant Power Lines and the compunting center had a N+2 UPS. So I&apos;m just trying all possible scenarios that I can imagine - and one of theese is a power outage for zookeeper and solr at the same time. Some things can be controlled with startup order (first zookeeper then solr) on single machines, but if multiple machines are involed, this gets difficult.&lt;br/&gt;
If such a problem can easily circumvented by the solar instance reconnecting to the zookeeper, then the solr instance should just do that.&lt;/p&gt;

&lt;p&gt;So I tried these things and wrote the bug report - as maybe the developers (that do a very good job!) might just not have considered these cases. &lt;/p&gt;</comment>
                            <comment id="13503023" author="brui" created="Fri, 23 Nov 2012 05:14:45 +0000"  >&lt;p&gt;To Werner:&lt;/p&gt;

&lt;p&gt;1)are you sure your solr is 4.0 rather than 4.0alpha or 4.0beta?  generally, the situation you described lead a lot of waitForReplicasComeup log produced. if no exception it will stop 3 mins latter. those logs due to zookeeper keep those old server&apos;s info in clustersate.&lt;/p&gt;

&lt;p&gt;2) above situation both refer to zookeeper leader reelection.all solr service can&apos;t work before this election procedure over. the solr node may die if the election time over the solr connect-zookeeper retry time. so the problem is hard to deal with since the zook leader reelection procedure is uncontrollable.     &lt;/p&gt;</comment>
                            <comment id="13503179" author="dl4ner" created="Fri, 23 Nov 2012 12:32:31 +0000"  >&lt;p&gt;1) Yes I&apos;m sure. as I wrote: &quot;tested nightly 2012-11-16&quot; after Mark&apos;s fix for the leader election. Sorry, I wrote &quot;nightly&quot; instead of &quot;nightly build&quot; that would have been more spefific.&lt;br/&gt;
The nodes were running:&lt;br/&gt;
solr-impl 4.1-2012-11-16_01-01-43 1410134 - hudson - 2012-11-16 01:10:49&lt;br/&gt;
lucene-impl 4.1-2012-11-16_01-01-43 1410134 - hudson - 2012-11-16 01:08:46&lt;br/&gt;
(and zookeeper 3.4.4)&lt;/p&gt;

&lt;p&gt;2) I understand. Then it might be a solution for us just to test the zookeeper connections before starting the solr nodes. this could be done using 4-letter-commands like &apos;ruok&apos; + &apos;stat&apos; in the startup script for solr, if I&apos;m not wrong. &lt;/p&gt;</comment>
                            <comment id="13508064" author="markrmiller@gmail.com" created="Sat, 1 Dec 2012 21:41:16 +0000"  >&lt;p&gt;So I just tested out this scenario, and it seemed to work as expected for me. I killed all the replicas in a shard and then started one that had not been the leader before - it waited to see the other replicas come back - it does this for safety reasons. Once the timeout went by (I think it&apos;s 5 minutes), or I started the other replicas, everything went green.&lt;/p&gt;

&lt;p&gt;You can lower the timeout or turn it off if you want. Just set the leaderVoteWait attribute on &apos;cores&apos; in solr.xml.&lt;/p&gt;</comment>
                            <comment id="13610562" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:17:46 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1408323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1408323&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3993&quot; title=&quot;SolrCloud leader election on single node stucks the initialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3993&quot;&gt;&lt;del&gt;SOLR-3993&lt;/del&gt;&lt;/a&gt;: If multiple SolrCore&apos;s for a shard coexist on a node, on cluster restart, leader election would stall until timeout, waiting to see all of  the replicas come up.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>251045</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b3hj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62677</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>