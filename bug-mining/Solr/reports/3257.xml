<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:19:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10114] Reordered delete-by-query can delete or omit child documents</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10114</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;It looks like when a block of documents is indexed, child documents get no &amp;#95;version&amp;#95; field.  This means (among other potential issues) that a delete-by-query that is reordered will cause matching child documents to be deleted.  DBQ normally prevents deleting newer docs by including a restriction on &amp;#95;version&amp;#95;, which doesn&apos;t work for anything lacking that field.  Re-ordered delete-by-term of any child docs would also be affected (although it should be a much rarer issue.)&lt;/p&gt;

&lt;p&gt;The leading candidate for a fix is to use the exact same &amp;#95;version&amp;#95; for all child docs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13041887">SOLR-10114</key>
            <summary>Reordered delete-by-query can delete or omit child documents</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Feb 2017 23:40:52 +0000</created>
                <updated>Sat, 8 Jun 2019 15:30:27 +0000</updated>
                            <resolved>Thu, 16 Feb 2017 03:52:13 +0000</resolved>
                                    <version>4.5</version>
                                    <fixVersion>6.5</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15861377" author="manokovacs" created="Fri, 10 Feb 2017 15:04:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;, confirmed by running parallel insert/updates and deletes of documents with child documents. Replication gets out of sync eventually. &lt;/p&gt;</comment>
                            <comment id="15861763" author="yseeley@gmail.com" created="Fri, 10 Feb 2017 19:50:56 +0000"  >&lt;p&gt;Great!&lt;br/&gt;
A simple non-concurrent way to reproduce would be to fake reordering (by faking updates from a leader).&lt;br/&gt;
Lowest level examples of this are in TestRecovery.testLogReplayWithReorderedDBQ&lt;br/&gt;
or at slightly higher levels in PeerSyncTest and others (look for users of DistribPhase.FROMLEADER for more examples)&lt;/p&gt;</comment>
                            <comment id="15863988" author="manokovacs" created="Mon, 13 Feb 2017 17:06:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;, thanks for the hints, makes it much easier to test it. I am preparing the tests first, then make them pass with a fix. I was wondering, if the fix is to store the version with the child docs, it requires reindexing to resolve the issue. I was thinking of adding another iteration to fetch parent version for childdocs without version. It might have significant performance impact on DBQ, though.&lt;/p&gt;</comment>
                            <comment id="15864038" author="yseeley@gmail.com" created="Mon, 13 Feb 2017 17:34:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;if the fix is to store the version with the child docs, it requires reindexing to resolve the issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right, this won&apos;t fix old indexes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I was thinking of adding another iteration to fetch parent version for childdocs without version. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That seems difficult, unless we just assume that any doc w/o a version is a child doc.&lt;br/&gt;
Also, another thing to watch out for is that the version field is technically not mandatory for non-solrcloud.  The presence of a &amp;#95;root&amp;#95; field could be used to further determine if a doc is a child doc, but that may be expensive too. &lt;/p&gt;</comment>
                            <comment id="15864086" author="mdrob" created="Mon, 13 Feb 2017 17:55:53 +0000"  >&lt;p&gt;I think it makes sense to split the fix into two parts - one patch to take care of future indices and a separate fix to look at existing indices. Especially if one half of that is much easier and can be done significantly faster.&lt;/p&gt;</comment>
                            <comment id="15865388" author="manokovacs" created="Tue, 14 Feb 2017 08:57:27 +0000"  >&lt;p&gt;Make sense, thank you. I&apos;ll go with the new index fix now.&lt;/p&gt;</comment>
                            <comment id="15865831" author="manokovacs" created="Tue, 14 Feb 2017 14:22:13 +0000"  >&lt;p&gt;It seems like childnodes are not being inserted at all if there is any reordered DBQ. In case of reordering, the neither the insertion for children documents, nor the delete for previous child during update are being execute. Created new test cases for those too. Is that ok if I add the fixes altogether and we extend the title of this jira? Suggesting &quot;Reordered delete-by-query cause inconsistency in child documents&quot;.&lt;/p&gt;</comment>
                            <comment id="15865840" author="manokovacs" created="Tue, 14 Feb 2017 14:28:55 +0000"  >&lt;p&gt;Adding &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10114&quot; title=&quot;Reordered delete-by-query can delete or omit child documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10114&quot;&gt;&lt;del&gt;SOLR-10114&lt;/del&gt;&lt;/a&gt;-validation.patch with 4 new tests, 3 of them are failing currently. This is not the actual patch, just to reproduce incorrect behaviors. Uploading fix shortly.&lt;/p&gt;</comment>
                            <comment id="15866241" author="manokovacs" created="Tue, 14 Feb 2017 17:53:30 +0000"  >&lt;p&gt;Adding patch with&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fix by adding version for childdocs if there is&lt;/li&gt;
	&lt;li&gt;fix by using same insert-or-update logic when handling reordered DBQ&lt;/li&gt;
	&lt;li&gt;recovery and peersync tests.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15868106" author="mdrob" created="Wed, 15 Feb 2017 16:14:44 +0000"  >&lt;p&gt;Use existing &lt;tt&gt;ThrowingRunnable&lt;/tt&gt; instead of new &lt;tt&gt;RunnableWithException&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;We might possibly want to hide this new functionality behind a version check? Does the patch apply relatively easily to 6.5 as well?&lt;/p&gt;


&lt;p&gt;Can you help me understand the full scope of the problem here - child docs are only in danger of spurious delete until the next commit point, right? So if they make it to disk, even though they don&apos;t have versions, they are still safe from disappearing in the future.&lt;/p&gt;</comment>
                            <comment id="15868183" author="manokovacs" created="Wed, 15 Feb 2017 17:06:01 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;, I did not know about ThworingRunnable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We might possibly want to hide this new functionality behind a version check? Does the patch apply relatively easily to 6.5 as well?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The patch relies on some changes of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5944&quot; title=&quot;Support updates of numeric DocValues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5944&quot;&gt;&lt;del&gt;SOLR-5944&lt;/del&gt;&lt;/a&gt;, which is AFAIK will be backported too, however, I can create a 6.x patch too.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can you help me understand the full scope of the problem here - child docs are only in danger of spurious delete until the next commit point, right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So the reordered DBQ could happen if an update with an earlier version arrives after a DBQ with a later version to the replicas, or vica-versa. Solr handles the two cases the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If a DBQ arrives that has lower version than the latest updates, the DBQ gets an additional version filter to protect documents added earlier, with higher version.
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;If the DBQ is not by ID (or something limiting), but for example range or any, it will delete child-docs added with higher versioned parent doc. This is what the jira is originally about and &lt;tt&gt;testLogReplayWithReorderedDBQByAsterixAndChildDocs&lt;/tt&gt; tests the case.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;If an update arrives that has lower version than the latest DBQs, the DirectUpdateHandler2 goes on an add-and-delete path, where the earlier DBQs with higher versions are replayed after the update.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Now, the &lt;tt&gt;doNormalUpdate(cmd)&lt;/tt&gt; was checking if the document is block document (has children) and does two main differences based on that:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Calls &lt;tt&gt;updateDocuments&lt;/tt&gt; (plural) that accepts an Iterable and inserts every child document&lt;/li&gt;
	&lt;li&gt;Builds idTerm by &amp;#95;root&amp;#95; field, instead of id-field, so before adding the document, lucene would delete the parent AND the child documents as well.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;On the other hand, addAndDelete() did not do any differentiation for block docs, resulting the child-nodes ignored during the inserts and overwrites.&lt;br/&gt;
So basically any reordered DBQ caused:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Losing child-docs when new document was inserted (&lt;tt&gt;testLogReplayWithReorderedDBQInsertingChildnodes&lt;/tt&gt;)&lt;/li&gt;
	&lt;li&gt;Making the child-docs untouched on update. This caused replica numDocs inconsistency when the update contained different count of child-docs. (&lt;tt&gt;testLogReplayWithReorderedDBQUpdateWithDifferentChildCount&lt;/tt&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So basically, any child-docs replication was dropped if there was a reordered DBQ.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So if they make it to disk, even though they don&apos;t have versions, they are still safe from disappearing in the future.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;AFAIK, the reordering cannot happen on the leader, this does not affects leader version, only replicas. I assume any peersync would fail due to fingerprint check, and would eventually replicate the correct index. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;, could you, please, verify my assumption?&lt;/p&gt;</comment>
                            <comment id="15868197" author="manokovacs" created="Wed, 15 Feb 2017 17:16:45 +0000"  >&lt;p&gt;Using &lt;tt&gt;ThrowingRunnable&lt;/tt&gt; in tests.&lt;/p&gt;</comment>
                            <comment id="15868667" author="yseeley@gmail.com" created="Wed, 15 Feb 2017 22:13:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;On the other hand, addAndDelete() did not do any differentiation for block docs&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nice catch!  Looks like that oversight has been there since the original block-join patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;AFAIK, the reordering cannot happen on the leader, this does not affects leader version, only replicas. I assume any peersync would fail due to fingerprint check, and would eventually replicate the correct index.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, sounds right.&lt;/p&gt;</comment>
                            <comment id="15869098" author="jira-bot" created="Thu, 16 Feb 2017 03:51:29 +0000"  >&lt;p&gt;Commit 99188ae00c0c46d9af47b9773d492de40de4aa83 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=99188ae&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=99188ae&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10114&quot; title=&quot;Reordered delete-by-query can delete or omit child documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10114&quot;&gt;&lt;del&gt;SOLR-10114&lt;/del&gt;&lt;/a&gt;: add &lt;em&gt;version&lt;/em&gt; field to child documents, fix reordered-dbq to not drop child docs&lt;/p&gt;</comment>
                            <comment id="15869099" author="yseeley@gmail.com" created="Thu, 16 Feb 2017 03:52:13 +0000"  >&lt;p&gt;Committed. Thanks!&lt;/p&gt;</comment>
                            <comment id="15869755" author="manokovacs" created="Thu, 16 Feb 2017 11:19:03 +0000"  >&lt;p&gt;Failed to upload the latest patch yesterday, attaching cleanup patch.&lt;/p&gt;</comment>
                            <comment id="15869929" author="manokovacs" created="Thu, 16 Feb 2017 13:40:02 +0000"  >&lt;p&gt;Attaching second patch with more tests. First patch was missing a commit. Includes additional tests in &lt;tt&gt;PeerSyncTest.java&lt;/tt&gt;, also made every branch of the test running, instead of randomization.&lt;/p&gt;

&lt;p&gt;This includes the test-cleanup patch too.&lt;/p&gt;</comment>
                            <comment id="15870353" author="jira-bot" created="Thu, 16 Feb 2017 17:45:44 +0000"  >&lt;p&gt;Commit d49edabf8992c2b2f9e2583e289cc58a4e71fd31 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d49edab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d49edab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10114&quot; title=&quot;Reordered delete-by-query can delete or omit child documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10114&quot;&gt;&lt;del&gt;SOLR-10114&lt;/del&gt;&lt;/a&gt;: test cleanup&lt;/p&gt;</comment>
                            <comment id="15870367" author="steve_rowe" created="Thu, 16 Feb 2017 17:53:19 +0000"  >&lt;p&gt;&lt;tt&gt;git bisect&lt;/tt&gt; points the finger at the &lt;tt&gt;99188ae00c0c46d9af47b9773d492de40de4aa83&lt;/tt&gt; commit under this issue for reproducing &lt;tt&gt;TestRecovery&lt;/tt&gt; failures - all three succeed just before this commit and fail after it.  I had to remove the &lt;tt&gt;-Dtests.method=testCorruptLog&lt;/tt&gt; cmdline param to get these to reproduce, so maybe there&apos;s some method order dependence here?:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/18975/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/18975/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestRecovery -Dtests.method=testCorruptLog -Dtests.seed=87E0BD7E2E527DCE -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=sah-RU -Dtests.timezone=America/North_Dakota/Center -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   1.29s J1 | TestRecovery.testCorruptLog &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.RuntimeException: mismatch: &apos;3&apos;!=&apos;0&apos; @ response/numFound
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([87E0BD7E2E527DCE:753D09ADD46A2C12]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:1006)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:953)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestRecovery.testCorruptLog(TestRecovery.java:1274)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
   [junit4]    &amp;gt; 	at java.base/java.lang.reflect.Method.invoke(Method.java:543)
[...]
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene70): {val_i=Lucene50(blocksize=128), _root_=PostingsFormat(name=Direct), id=Lucene50(blocksize=128)}, docValues:{_version_=DocValuesFormat(name=Lucene70), val_i_dvo=DocValuesFormat(name=Lucene70)}, maxPointsInLeafNode=1693, maxMBSortInHeap=6.736398983719205, sim=RandomSimilarity(queryNorm=true): {}, locale=sah-RU, timezone=America/North_Dakota/Center
   [junit4]   2&amp;gt; NOTE: Linux 4.4.0-53-generic i386/Oracle Corporation 9-ea (32-bit)/cpus=12,threads=1,free=183244888,total=536870912
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Solaris/1136/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Solaris/1136/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestRecovery -Dtests.method=testCorruptLog -Dtests.seed=79A0B057C8C8D5DB -Dtests.slow=true -Dtests.locale=ar-OM -Dtests.timezone=Asia/Krasnoyarsk -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   0.45s J1 | TestRecovery.testCorruptLog &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.RuntimeException: mismatch: &apos;3&apos;!=&apos;0&apos; @ response/numFound
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([79A0B057C8C8D5DB:8B7D048432F08407]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:1006)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:953)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestRecovery.testCorruptLog(TestRecovery.java:1274)
[...]
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene70): {val_i=BlockTreeOrds(blocksize=128), _root_=PostingsFormat(name=LuceneFixedGap), id=BlockTreeOrds(blocksize=128)}, docValues:{_version_=DocValuesFormat(name=Memory), val_i_dvo=DocValuesFormat(name=Direct)}, maxPointsInLeafNode=586, maxMBSortInHeap=6.1661193810062755, sim=RandomSimilarity(queryNorm=false): {}, locale=ar-OM, timezone=Asia/Krasnoyarsk
   [junit4]   2&amp;gt; NOTE: SunOS 5.11 amd64/Oracle Corporation 1.8.0_121 (64-bit)/cpus=3,threads=1,free=163066016,total=536870912
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-MacOSX/3836/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-MacOSX/3836/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestRecovery -Dtests.method=testCorruptLog -Dtests.seed=A33AFB76746001BE -Dtests.slow=true -Dtests.locale=ar -Dtests.timezone=Universal -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   0.66s J1 | TestRecovery.testCorruptLog &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.RuntimeException: mismatch: &apos;3&apos;!=&apos;0&apos; @ response/numFound
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([A33AFB76746001BE:51E74FA58E585062]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:1006)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:953)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestRecovery.testCorruptLog(TestRecovery.java:1274)
[...]
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene70): {val_i=BlockTreeOrds(blocksize=128), _root_=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), id=BlockTreeOrds(blocksize=128)}, docValues:{_version_=DocValuesFormat(name=Direct), val_i_dvo=DocValuesFormat(name=Memory)}, maxPointsInLeafNode=1861, maxMBSortInHeap=5.220105645523462, sim=RandomSimilarity(queryNorm=false): {}, locale=ar, timezone=Universal
   [junit4]   2&amp;gt; NOTE: Mac OS X 10.11.6 x86_64/Oracle Corporation 1.8.0_121 (64-bit)/cpus=3,threads=1,free=171695816,total=536870912
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15870419" author="steve_rowe" created="Thu, 16 Feb 2017 18:08:32 +0000"  >&lt;p&gt;FYI all three repro lines above still reproduce after commit &lt;tt&gt;d49edabf8992c2b2f9e2583e289cc58a4e71fd31&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15870430" author="manokovacs" created="Thu, 16 Feb 2017 18:13:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;, thanks for pointing it out. I just noticed that too locally. Its some interdependency between the tests that I am trying to work out.&lt;/p&gt;</comment>
                            <comment id="15870509" author="manokovacs" created="Thu, 16 Feb 2017 18:55:31 +0000"  >&lt;p&gt;Yeah, conflict between tests.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;26292 INFO  (TEST-TestRecovery.testCorruptLog-seed#[BC979C5AA13AC6F7]) [    ] o.a.s.u.DirectUpdateHandler2 Reordered DBQs detected.  Update=add{_version_=104,id=G4} DBQs=[DBQ{version=1017,q=id:*}]
26331 INFO  (TEST-TestRecovery.testCorruptLog-seed#[BC979C5AA13AC6F7]) [    ] o.a.s.s.SolrIndexSearcher Opening [Searcher@26c39adc[collection1] realtime]
26331 INFO  (TEST-TestRecovery.testCorruptLog-seed#[BC979C5AA13AC6F7]) [    ] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=null path=null params={update.distrib=FROMLEADER&amp;amp;wt=json&amp;amp;indent=true}{add=[G4 (104)]} 0 40
26332 INFO  (TEST-TestRecovery.testCorruptLog-seed#[BC979C5AA13AC6F7]) [    ] o.a.s.u.DirectUpdateHandler2 Reordered DBQs detected.  Update=add{_version_=105,id=G5} DBQs=[DBQ{version=1017,q=id:*}]
26349 INFO  (TEST-TestRecovery.testCorruptLog-seed#[BC979C5AA13AC6F7]) [    ] o.a.s.s.SolrIndexSearcher Opening [Searcher@17fd92d4[collection1] realtime]
26349 INFO  (TEST-TestRecovery.testCorruptLog-seed#[BC979C5AA13AC6F7]) [    ] o.a.s.u.p.LogUpdateProcessorFactory [collection1]  webapp=null path=null params={update.distrib=FROMLEADER&amp;amp;wt=json&amp;amp;indent=true}{add=[G5 (105)]} 0 17
26350 INFO  (TEST-TestRecovery.testCorruptLog-seed#[BC979C5AA13AC6F7]) [    ] o.a.s.u.DirectUpdateHandler2 Reordered DBQs detected.  Update=add{_version_=106,id=G6} DBQs=[DBQ{version=1017,q=id:*}]
26374 INFO  (TEST-TestRecovery.testCorruptLog-seed#[BC979C5AA13AC6F7]) [    ] o.a.s.s.SolrIndexSearcher Opening [Searcher@6453c66a[collection1] realtime]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;tt&gt;id:*&lt;/tt&gt; is from the newly added tests. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9941&quot; title=&quot;log replay redundently (pre-)applies DBQs as if they were out of order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9941&quot;&gt;&lt;del&gt;SOLR-9941&lt;/del&gt;&lt;/a&gt; was supposed to resolve this, but it does not, I am trying to work it out but any idea is welcome.&lt;/p&gt;</comment>
                            <comment id="15870532" author="yseeley@gmail.com" created="Thu, 16 Feb 2017 19:11:40 +0000"  >&lt;p&gt;Test methods of a test class are run in a randomized order.  Transaction log tests are tricky since tests can see what the previous tests left behind in the transaction logs.  This is why I used different ID spaces for some of these tests (id:A1,A2,... for one test, id:B1,B2, etc for another test).&lt;/p&gt;

&lt;p&gt;Perhaps try making any delete-by-queries test-specific?&lt;/p&gt;</comment>
                            <comment id="15870563" author="manokovacs" created="Thu, 16 Feb 2017 19:29:11 +0000"  >&lt;p&gt;Yeah, that could be simple solution, but saying that we cannot test &lt;tt&gt;id:*&lt;/tt&gt; for that reason is not too robust. I am thinking of creating an only incrementing version counter, so tests could not insert future deletes for each other. It would be a future-proof solution, I guess.&lt;/p&gt;</comment>
                            <comment id="15870611" author="manokovacs" created="Thu, 16 Feb 2017 20:04:06 +0000"  >&lt;p&gt;Adding test fix &lt;br/&gt;
I went with namespacing, as monotonic counter would be a bigger change (added jira for that &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10151&quot; title=&quot;TestRecovery.java - use monotonic increasing version number among all the tests to avoid unintentional reordering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10151&quot;&gt;&lt;del&gt;SOLR-10151&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
I changed the &lt;tt&gt;id:*&lt;/tt&gt; to delete by id and by root, since the purpose of the test was to validate that DBQ replayed version filter protects child-docs as well.&lt;/p&gt;

&lt;p&gt;Sorry for the inconvenience.&lt;/p&gt;</comment>
                            <comment id="15870625" author="jira-bot" created="Thu, 16 Feb 2017 20:12:57 +0000"  >&lt;p&gt;Commit 7a45f1015e73bc4f793a63be6b7414d53e008e05 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7a45f10&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7a45f10&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10114&quot; title=&quot;Reordered delete-by-query can delete or omit child documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10114&quot;&gt;&lt;del&gt;SOLR-10114&lt;/del&gt;&lt;/a&gt;: fix flakey TestRecovery&lt;/p&gt;</comment>
                            <comment id="15873550" author="jira-bot" created="Sun, 19 Feb 2017 08:35:12 +0000"  >&lt;p&gt;Commit ad9195d757c298a241ef2488b4b17623a44afdd7 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ad9195d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ad9195d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10114&quot; title=&quot;Reordered delete-by-query can delete or omit child documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10114&quot;&gt;&lt;del&gt;SOLR-10114&lt;/del&gt;&lt;/a&gt;: add &lt;em&gt;version&lt;/em&gt; field to child documents, fix reordered-dbq to not drop child docs&lt;/p&gt;</comment>
                            <comment id="15873551" author="jira-bot" created="Sun, 19 Feb 2017 08:35:15 +0000"  >&lt;p&gt;Commit 5c76710f08225d6909c96e584888bb6f036b4cfe in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5c76710&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5c76710&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10114&quot; title=&quot;Reordered delete-by-query can delete or omit child documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10114&quot;&gt;&lt;del&gt;SOLR-10114&lt;/del&gt;&lt;/a&gt;: test cleanup&lt;/p&gt;</comment>
                            <comment id="15873552" author="jira-bot" created="Sun, 19 Feb 2017 08:35:19 +0000"  >&lt;p&gt;Commit 98133b21961c7c9672bcd85d2a2713e46f3242db in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=98133b2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=98133b2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10114&quot; title=&quot;Reordered delete-by-query can delete or omit child documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10114&quot;&gt;&lt;del&gt;SOLR-10114&lt;/del&gt;&lt;/a&gt;: fix flakey TestRecovery&lt;/p&gt;</comment>
                            <comment id="15873576" author="jira-bot" created="Sun, 19 Feb 2017 09:00:55 +0000"  >&lt;p&gt;Commit ea19bf5101817bae5b7b133a7d9d40ab41aac6ec in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ea19bf5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ea19bf5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Move solr/CHANGES.txt entries to appropriate sections after backporting &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5944&quot; title=&quot;Support updates of numeric DocValues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5944&quot;&gt;&lt;del&gt;SOLR-5944&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10114&quot; title=&quot;Reordered delete-by-query can delete or omit child documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10114&quot;&gt;&lt;del&gt;SOLR-10114&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12853053" name="SOLR-10114-2.patch" size="12244" author="manokovacs" created="Thu, 16 Feb 2017 14:06:12 +0000"/>
                            <attachment id="12853050" name="SOLR-10114-2.patch" size="13292" author="manokovacs" created="Thu, 16 Feb 2017 13:40:02 +0000"/>
                            <attachment id="12853120" name="SOLR-10114-3.patch" size="7762" author="manokovacs" created="Thu, 16 Feb 2017 20:04:06 +0000"/>
                            <attachment id="12853032" name="SOLR-10114-test-cleanup.patch" size="1186" author="manokovacs" created="Thu, 16 Feb 2017 11:19:03 +0000"/>
                            <attachment id="12852577" name="SOLR-10114-validation.patch" size="8101" author="manokovacs" created="Tue, 14 Feb 2017 14:28:55 +0000"/>
                            <attachment id="12852857" name="SOLR-10114.patch" size="12253" author="manokovacs" created="Wed, 15 Feb 2017 17:16:45 +0000"/>
                            <attachment id="12852617" name="SOLR-10114.patch" size="12253" author="manokovacs" created="Tue, 14 Feb 2017 17:53:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39vn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>