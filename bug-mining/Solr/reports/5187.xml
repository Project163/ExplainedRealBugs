<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:10:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17049] Marking replicas down at startup and waiting does not wait</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17049</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We observed an unexpected behaviour where a node was taking traffic for a replica that was not ready to take it. It seems to happen when the node is marked as live and the replica is marked as active, while the corresponding core is not loaded yet on the node.&lt;br/&gt;
&#160;&lt;br/&gt;
I looked at the code and in theory it should not happen, since the following happens in &lt;tt&gt;ZkController#init&lt;/tt&gt;: mark node as down, wait for replicas to be marked as down, and then register the node as live. However, after looking at the code of&#160;&lt;tt&gt;publishAndWaitForDownStates&lt;/tt&gt;, I observed that we wait for down states for replicas associated with cores as returned by &lt;tt&gt;CoreContainer#getCoreDescriptors&lt;/tt&gt;... which is empty at this point since &lt;tt&gt;ZkController#init&lt;/tt&gt; is called before cores are discovered (which happens later in &lt;tt&gt;CoreContainer#load&lt;/tt&gt;).&lt;br/&gt;
&#160;&lt;br/&gt;
It hence seems to me that we basically never wait for any replicas to be marked as down, and continue the startup sequence by marking the node as live, and hence&#160;&lt;em&gt;might&lt;/em&gt;&#160;take traffic for a short period of time for a replica that is not ready (e.g., if the node previously crashed and the replica stayed active).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13554953">SOLR-17049</key>
            <summary>Marking replicas down at startup and waiting does not wait</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houston">Houston Putman</assignee>
                                    <reporter username="vprimault">Vincent Primault</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 20 Oct 2023 14:06:02 +0000</created>
                <updated>Sun, 8 Dec 2024 17:54:32 +0000</updated>
                            <resolved>Tue, 14 May 2024 19:41:43 +0000</resolved>
                                    <version>8.6</version>
                                    <fixVersion>9.7</fixVersion>
                    <fixVersion>9.6.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10200">2h 50m</timespent>
                                <comments>
                            <comment id="17779897" author="JIRAUSER302103" created="Thu, 26 Oct 2023 13:44:53 +0000"  >&lt;p&gt;Thread on dev@solr.apache.org: &lt;a href=&quot;https://lists.apache.org/thread/3q5t2kxbpq7poc6nb06qgs1gld2f6ny0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/3q5t2kxbpq7poc6nb06qgs1gld2f6ny0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I could see two ways of fixing this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;By relying on cluster state to see which collections have a local replica&lt;/li&gt;
	&lt;li&gt;By relying on CoresLocator to be consistent with what is done at startup&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17846403" author="jira-bot" created="Tue, 14 May 2024 19:16:53 +0000"  >&lt;p&gt;Commit 1b582e90de228bd5db3f0e884f0bcb7ec3de2868 in solr&apos;s branch refs/heads/main from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=1b582e90de2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=1b582e90de2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17049&quot; title=&quot;Marking replicas down at startup and waiting does not wait&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17049&quot;&gt;&lt;del&gt;SOLR-17049&lt;/del&gt;&lt;/a&gt;: Fix Replica Down on startup logic (#2432)&lt;/p&gt;
</comment>
                            <comment id="17846405" author="jira-bot" created="Tue, 14 May 2024 19:27:12 +0000"  >&lt;p&gt;Commit e04095c5bf46bd668f2e42876b15f8f1e8025636 in solr&apos;s branch refs/heads/branch_9x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=e04095c5bf4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=e04095c5bf4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17049&quot; title=&quot;Marking replicas down at startup and waiting does not wait&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17049&quot;&gt;&lt;del&gt;SOLR-17049&lt;/del&gt;&lt;/a&gt;: Fix Replica Down on startup logic (#2432)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1b582e90de228bd5db3f0e884f0bcb7ec3de2868)&lt;/p&gt;</comment>
                            <comment id="17846408" author="jira-bot" created="Tue, 14 May 2024 19:37:33 +0000"  >&lt;p&gt;Commit 08e6054469ef05ddf9af9ad883332851b2b09494 in solr&apos;s branch refs/heads/branch_9_6 from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=08e6054469e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=08e6054469e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17049&quot; title=&quot;Marking replicas down at startup and waiting does not wait&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17049&quot;&gt;&lt;del&gt;SOLR-17049&lt;/del&gt;&lt;/a&gt;: Fix Replica Down on startup logic (#2432)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1b582e90de228bd5db3f0e884f0bcb7ec3de2868)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1l3ag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>