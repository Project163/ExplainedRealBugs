<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:44:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14371] Zk StatusHandler should know about dynamic zk config</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14371</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;With v3.5, Zookeeper supports &lt;a href=&quot;https://zookeeper.apache.org/doc/r3.6.0/zookeeperReconfig.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dynamic reconfig&lt;/a&gt;. Solr will happily connect to an ensemble with dynamic reconfiguration enabled, but it is not &quot;aware of it&quot;. The ZK Status screen does not display whether the ensemble is in reconfig mode and is not able to load the dynamic set of hosts from zk.&lt;/p&gt;

&lt;p&gt;This JIRA aims to make the ZookeeperStatusHandler able to display zk status as well as show status for all zk hosts in the ensemble, even ones that are not part of the static connection string that Solr is aware of. It will also show warnings if Solr&apos;s static zk connection string is out of sync with the truth.&lt;/p&gt;

&lt;p&gt;Currently Solr has a static ZK connection string and is not able to re-configure itself when zk cluster is reconfigured. Fixing this is not part of this issue but is deferred to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14389&quot; title=&quot;Support dynamic reconfiguration of Zookeeper ensemble&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14389&quot;&gt;SOLR-14389&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I discovered this while experimenting with the &lt;a href=&quot;https://github.com/bloomberg/solr-operator&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;solr-operator for Kubernetes&lt;/a&gt;. It configures a reconfigurable ZK ensemble and configures a single LB host:port as its zk connection string. This issue will flag a warning in this case since the connection string is different from the set of zk hosts in zk node &lt;tt&gt;/zookeeper/config&lt;/tt&gt;. This warning can be removed once Solr fully supports dynamic reconfiguration.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13294707">SOLR-14371</key>
            <summary>Zk StatusHandler should know about dynamic zk config</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                    </labels>
                <created>Sat, 28 Mar 2020 10:31:05 +0000</created>
                <updated>Thu, 13 Aug 2020 12:25:20 +0000</updated>
                            <resolved>Fri, 17 Apr 2020 15:12:36 +0000</resolved>
                                                    <fixVersion>8.6</fixVersion>
                                    <component>Admin UI</component>
                    <component>SolrCloud</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17069380" author="janhoy" created="Sat, 28 Mar 2020 10:32:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt; FYI &lt;/p&gt;</comment>
                            <comment id="17071840" author="janhoy" created="Tue, 31 Mar 2020 14:29:11 +0000"  >&lt;p&gt;Ok, first PR draft is out &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/1392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/1392&lt;/a&gt;&lt;br/&gt;
Tries to unify the old parsing of ZK_HOST and parsing of dynamic config.&lt;br/&gt;
Needs more testing. I&apos;ll try to test with the Solr Operator and see if we get info for all ZKs.&lt;br/&gt;
Also needs some more work in UI for how to interpret leader vs follower vs participant vs observer as zk-node roles. Now we require exactly one leader and assume the rest are followers, but I think there are other allowed mixes too.&lt;/p&gt;</comment>
                            <comment id="17073223" author="janhoy" created="Wed, 1 Apr 2020 22:39:52 +0000"  >&lt;p&gt;The PR is now ready for broader review, for those interested.&lt;/p&gt;

&lt;p&gt;Since embedded ZK and ZK in tests are hardcoded to a standalone variant, and big code changes are needed to spin up a Quorum, there are no unit tests for the new &lt;tt&gt;getConfig()&lt;/tt&gt; method in &lt;tt&gt;SolrZkClient&lt;/tt&gt;. I have tested manually with an external zk cluster that it works though.&lt;/p&gt;

&lt;p&gt;Here is a condensed summary of the current PR&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;If zk quorum has dynamic reconfiguration, the ZkStatus handler and Admin UI view will now display info for each of the currently active Zookeepers, even if they differ from initial ZK_HOST&lt;/li&gt;
	&lt;li&gt;That meanns you can configure ZK_HOST with a single LB address in front of all ZKs (like Solr Operator for k8s) and it will &quot;just work&quot;&lt;/li&gt;
	&lt;li&gt;New info in JSON response and UI: &lt;tt&gt;dynamicReconfig=true/false&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;New info for each ZK host: &lt;tt&gt;role=participant/observer&lt;/tt&gt;&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12998531/12998531_dynamic-reconfig.png&quot; width=&quot;600&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17073243" author="janhoy" created="Wed, 1 Apr 2020 23:23:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt;, I wanted to test dynamic reconfiguration with 3 external ZKs like in the screenshot above. Sadly it does not work, so your assumption in Solr Operator seems to be wrong - Solr will only be able to connect to the zookeeper(s) listed in ZK_HOST connection string. Each solr node will select one of them and connect, and on connection loss, the &lt;tt&gt;ConnectionManager&lt;/tt&gt; will try one of the other addresses in ZK_HOST. I thought this failover was handled by Zookeeper&apos;s client code, but seems it is not.&lt;/p&gt;

&lt;p&gt;So the reason the Solr Operator approach may still work, is that at connection loss, Solr will retry and connect to one of the other ZK nodes through the same host:port and succeed. But since Zookeeper assumes a persistent 2-way connection with its clients, I wonder if that connection will frequently go up and down or switch between ZK servers like a pogo stick? Can you test that?&lt;/p&gt;

&lt;p&gt;When I killed zoo1 in my setup above (which is the one on localhost:2181, no LB), Solr stopped working and was not able to &quot;find&quot; zoo2 or zoo3. More research is needed to figure out if the official ZK java client gives us something here, or if we need to make our own &lt;tt&gt;ConnectionManager&lt;/tt&gt; put a watch on &lt;tt&gt;/zookeeper/config&lt;/tt&gt; and only use ZK_HOST as a bootstrap to get to the dynamic config?&lt;/p&gt;</comment>
                            <comment id="17073569" author="janhoy" created="Thu, 2 Apr 2020 09:56:19 +0000"  >&lt;p&gt;I suggest as a first step, we handle this by letting the Admin UI display a clear warning if it detects that ZK connection string is different than the dynamic list of hosts. That way people are aware of the risks, until we fix Solr&apos;s zk code to actually be aware of dynamic reconfiguration.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12998586/12998586_dynamic-reconfig-warning.png&quot; width=&quot;900&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;As that effort overlaps/collides with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14306&quot; title=&quot;Refactor coordination code into separate module and evaluate using Curator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14306&quot;&gt;SOLR-14306&lt;/a&gt;, let&apos;s defer that part to that issue. I&apos;ll commit the proposed warning logic to the PR.&lt;/p&gt;</comment>
                            <comment id="17075949" author="janhoy" created="Sun, 5 Apr 2020 22:19:28 +0000"  >&lt;p&gt;So I feel the current PR solves the intention of the issue, and at the same time warning users that Solr does not support dynamic reconfig yet, and I plan to commit this on Tuesday.&lt;/p&gt;

&lt;p&gt;I also spun off &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14389&quot; title=&quot;Support dynamic reconfiguration of Zookeeper ensemble&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14389&quot;&gt;SOLR-14389&lt;/a&gt; to investigate whether we can support dynamic reconfig for real.&lt;/p&gt;</comment>
                            <comment id="17076245" author="janhoy" created="Mon, 6 Apr 2020 11:14:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt; what do you think about the current patch with the new warning? That warning will then show up when using solr-operator, since Solr cannot know whether the host:port in connection string is in fact a load-balancer or just some alias for one of the zk hsots.&lt;/p&gt;

&lt;p&gt;I also changed the issue description to match my current understanding of what is going on.&lt;/p&gt;</comment>
                            <comment id="17076402" author="houston" created="Mon, 6 Apr 2020 15:16:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I like the new patch, and I think it&apos;s a great intermediary step until we can get Solr to work with reconfiguration.&lt;/p&gt;

&lt;p&gt;I did a bit of research into the ZK client libraries late last week to see why the reconfiguration wasn&apos;t supported there. I didn&apos;t really find anything except for the fact that the only HostProvider available is still the &lt;tt&gt;StaticHostProvider&lt;/tt&gt;, which merely loops through the hosts provided in the connection string.&lt;/p&gt;

&lt;p&gt;Thanks so much for doing all of this testing and research. I&apos;ll dive into the solr-operator issue when I get the chance, but fixing that should be relatively easier.&lt;/p&gt;</comment>
                            <comment id="17085813" author="jira-bot" created="Fri, 17 Apr 2020 14:30:42 +0000"  >&lt;p&gt;Commit 03363f413f2134594b012175deb3f10ec9384400 in lucene-solr&apos;s branch refs/heads/master from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=03363f4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=03363f4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14371&quot; title=&quot;Zk StatusHandler should know about dynamic zk config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14371&quot;&gt;&lt;del&gt;SOLR-14371&lt;/del&gt;&lt;/a&gt; Zk StatusHandler should know about dynamic zk config (#1392)&lt;/p&gt;
</comment>
                            <comment id="17085858" author="jira-bot" created="Fri, 17 Apr 2020 15:12:32 +0000"  >&lt;p&gt;Commit 59cffaa9c6a7702a6f3313266c88698dcbb899d2 in lucene-solr&apos;s branch refs/heads/branch_8x from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=59cffaa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=59cffaa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14371&quot; title=&quot;Zk StatusHandler should know about dynamic zk config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14371&quot;&gt;&lt;del&gt;SOLR-14371&lt;/del&gt;&lt;/a&gt; Zk StatusHandler should know about dynamic zk config (#1392)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 03363f413f2134594b012175deb3f10ec9384400)&lt;br/&gt;
with java11 -&amp;gt; java8 modifications&lt;/p&gt;</comment>
                            <comment id="17085859" author="janhoy" created="Fri, 17 Apr 2020 15:12:36 +0000"  >&lt;p&gt;Pushed. Thanks for reviewing!&lt;/p&gt;</comment>
                            <comment id="17158288" author="broustant" created="Wed, 15 Jul 2020 15:09:27 +0000"  >&lt;p&gt;Closing after the 8.6.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13322533">SOLR-14751</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12998586" name="dynamic-reconfig-warning.png" size="102262" author="janhoy" created="Thu, 2 Apr 2020 09:52:17 +0000"/>
                            <attachment id="12998531" name="dynamic-reconfig.png" size="179100" author="janhoy" created="Wed, 1 Apr 2020 23:06:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0d0xc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>