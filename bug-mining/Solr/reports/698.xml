<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:23:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2654] &lt;lockType/&gt; not used consistently in all places Directory objects are instantiated</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2654</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;nipunb noted on the mailing list then when configuring solr to use an alternate &amp;lt;lockType/&amp;gt; (ie: simple) the stats for the SolrIndexSearcher list NativeFSLockFactory being used by the Directory.&lt;/p&gt;

&lt;p&gt;The problem seems to be that SolrIndexConfig is not consulted when constructing Directory objects used for IndexReader (it&apos;s only used by SolrIndexWriter)&lt;/p&gt;

&lt;p&gt;I don&apos;t &lt;em&gt;think&lt;/em&gt; this is a problem in most cases since the IndexReaders should all be readOnly in the core solr code) but plugins could attempt to use them in other ways.  In general it seems like a really bad bug waiting to happen.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12514137">SOLR-2654</key>
            <summary>&lt;lockType/&gt; not used consistently in all places Directory objects are instantiated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jul 2011 23:37:54 +0000</created>
                <updated>Fri, 10 May 2013 10:39:37 +0000</updated>
                            <resolved>Thu, 29 Dec 2011 16:43:37 +0000</resolved>
                                                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13065608" author="hossman" created="Thu, 14 Jul 2011 23:38:47 +0000"  >&lt;p&gt;Original report...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;From: nipunb 
To: solr-user
Date: Thu, 14 Jul 2011 00:50:21 -0700 (PDT)
Subject: Lockfactory indicated by ../solr/admin/cores different from the setting in solrconfig.xml

hey
We have set locktype to simple in solrconfig.xml using:
&amp;lt;lockType&amp;gt;simple&amp;lt;/lockType&amp;gt;. However on the page
localhost:8983/solr/admin/cores shows:
&amp;lt;str name=&quot;directory&quot;&amp;gt;
org.apache.lucene.store.MMapDirectory:org.apache.lucene.store.MMapDirectory..../solr-cores/core0/data/index
lockFactory=*org.apache.lucene.store.NativeFSLockFactory*@3415ddf5
&amp;lt;/str&amp;gt;
I can see a write.lock file in the index directory. But shouldn&apos;t the page
solr/admin/cores also be showing the the lockFactory to be
org.apache.lucene.store.SimpleFSLockFactory.SimpleFSLockFactory
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13065614" author="hossman" created="Thu, 14 Jul 2011 23:42:15 +0000"  >&lt;p&gt;In general i wonder if there isn&apos;t a largely problem here: shouldn&apos;t the IndexReader and SolrIndexWriter usually be using the exact same &lt;em&gt;instance&lt;/em&gt; of a Directory object &amp;#8211; not just two instances generated by the same DirectoryFactory?)&lt;/p&gt;

&lt;p&gt;(I&apos;m not sure given the various work being done with reopen and what not)&lt;/p&gt;</comment>
                            <comment id="13072527" author="markrmiller@gmail.com" created="Thu, 28 Jul 2011 20:59:33 +0000"  >&lt;p&gt;I think practically it&apos;s not a large problem - since the write lock is used for IndexWriter only as you say. Other than that, it would depend on the lock factory impl. It also depends on the Directory impl. I think in general, current impls work fine this way.&lt;/p&gt;

&lt;p&gt;We should address this I think though - we shouldn&apos;t count on this to work correctly.&lt;/p&gt;

&lt;p&gt;It&apos;s tricky in a couple areas though. I&apos;ll address on trunk before considering 3.4.&lt;/p&gt;</comment>
                            <comment id="13079477" author="markrmiller@gmail.com" created="Thu, 4 Aug 2011 17:17:02 +0000"  >&lt;p&gt;So the lock issue is not really a problem - but not sharing the dir is depending on the impl as I mentioned.&lt;/p&gt;

&lt;p&gt;I first tried tackling this outside of the directory factory - this quickly gets very difficult, most due to the newIndexPath that replication uses to avoid copying a full index.&lt;/p&gt;

&lt;p&gt;I&apos;m now exploring simply have the base directory factory cache all directories with the path as a key - how the ram directory factory works now.&lt;/p&gt;</comment>
                            <comment id="13080224" author="markrmiller@gmail.com" created="Fri, 5 Aug 2011 21:00:54 +0000"  >&lt;p&gt;first rough patch - &lt;/p&gt;

&lt;p&gt;TestReplicationHandler does not pass - &lt;/p&gt;

&lt;p&gt;doTestReplicateAfterWrite2Slave causes any of the other replication tests run after it to fail. Commenting it out, all tests pass.&lt;/p&gt;

&lt;p&gt;This allows us to use the same dir instance everywhere (kind of important - we hacked around this for ram dir specifically by using a static cache - mainly for tests).&lt;/p&gt;

&lt;p&gt;It does kind of make it so you must use the new approved SolrCore reload method rather than just starting a new clore and closing the old one. But you really should do that anyhow, so...and it&apos;s better than using a static cache IMO.&lt;/p&gt;</comment>
                            <comment id="13080525" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 03:16:32 +0000"  >&lt;p&gt;Hmmm...the problem has something to do with this new index stuff that replication uses - this thing always gets in my way &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13080526" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 03:29:28 +0000"  >&lt;p&gt;So with this patch, tests pass for me - but it scares me because I had to change two places that used the std index path to use the newIndex path. That&apos;s odd stuff - need to figure out how this was working as is on trunk...&lt;/p&gt;</comment>
                            <comment id="13080532" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 03:44:48 +0000"  >&lt;p&gt;My initial suspicion is actually that these where bugs in trunk that where being hidden by the old behavior.&lt;/p&gt;</comment>
                            <comment id="13080632" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 19:39:30 +0000"  >&lt;p&gt;Nope, it was my bug. SolrIndexSearcher only supplies the right index dir if the directory is an instance of FSDirectory - since we now used a Directory wrapper, the index dir was not properly coming from the SolrIndexSearcher. This indexdir newIndexDir stuff is dicey &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Got it fixed locally, but I&apos;ll do a few more cleanup chores before supply another patch.&lt;/p&gt;</comment>
                            <comment id="13080634" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 19:55:04 +0000"  >&lt;p&gt;I&apos;m actually going to kill this RefCntDirectory now - I had it because I was copying our RamDirectoryFactory hack - but the way things have changed, I don&apos;t think we need it at all anymore (not that we where closing Directories anyway - I think we actually can close them properly now though)&lt;/p&gt;</comment>
                            <comment id="13080643" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 20:31:24 +0000"  >&lt;p&gt;new patch:&lt;/p&gt;

&lt;p&gt;*removes the refcnt dir wrappers&lt;br/&gt;
*cleans up a bunch of other nocommits / cleanup work&lt;br/&gt;
*adds a new NRTCachingDirectoryFactory - completely untested, but half the reason I&apos;m working on improving this area &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Uses hack ram / merge settings of 64. Needs to be set to reasonable defaults, plus be easily configurable eventually.&lt;/p&gt;

&lt;p&gt;Tests pass for me.&lt;/p&gt;</comment>
                            <comment id="13080662" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 20:49:59 +0000"  >&lt;p&gt;So I have one last nocommit - directories pile up in the cache over time, and are only released when the SolrCore is finally truly closed (usually end of program). Ideally, we like to close them earlier when we can, and pull them from the cache (think clearing a RamDirectory).&lt;/p&gt;

&lt;p&gt;So I think we can fix this by having SolrIndexSearcher and SolrIndexWriter close their directories in their close methods - of course that likely brings back my friend the ref cnt directory &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13080664" author="rcmuir" created="Sun, 7 Aug 2011 20:55:17 +0000"  >&lt;p&gt;so we can remove the closeDirectories() hack in SolrTestCaseJ4?&lt;/p&gt;</comment>
                            <comment id="13080668" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 21:12:18 +0000"  >&lt;p&gt;Yeah, we def should be able to after this.&lt;/p&gt;</comment>
                            <comment id="13080669" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 21:18:03 +0000"  >&lt;p&gt;Current patch, directories are all closed when a SolrCore is finally closed (not reloaded). This is new, and should alleviate the need for the test close dir hack.&lt;/p&gt;

&lt;p&gt;The reason I want to sometimes close them early is that the index dir for a core can change - either on reload (unlikely) or by the replication handler. So if you had a Solr instance up for a long time, and used replication, you could end up, over time, with a lot of open Directories in the directory cache - currently, this is not much of a problem - replication only works with FSDirectories anyway. But I&apos;d like to see that limitation fixed too - so that something like a RAMDirectory could work with replication - and in that case, this would be slightly more important*, as an unclosed RAMDirectory will take up much more RAM than an FSDirectory, which does nothing on close anyway (*only slightly more important because replication only uses a new index dir in a minority of cases).&lt;/p&gt;</comment>
                            <comment id="13080687" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 22:29:32 +0000"  >&lt;p&gt;So I removed the close directories hack for tests and realized that I need the solution I proposed above regardless - when we force open a new directory, we need to close the old one - because we replace it in the map (well, close it, or keep it around in another list/set). We cannot close it right then, because something still might be using it. The ref cnt dir is def coming back.&lt;/p&gt;</comment>
                            <comment id="13080968" author="markrmiller@gmail.com" created="Mon, 8 Aug 2011 14:28:00 +0000"  >&lt;p&gt;Yeesh - much more difficult to get this right than I expected. I may just go back to only closing when the SolrCore is finally closed - trying to get the searchers/writers to do the closing is just driving me nuts.&lt;/p&gt;</comment>
                            <comment id="13081016" author="markrmiller@gmail.com" created="Mon, 8 Aug 2011 15:57:52 +0000"  >&lt;p&gt;Okay, so first a step backwards - back to keeping the dirs around till the core is really closed, and no ref cnt dirs. Tests now pass without the test close directory hack.&lt;/p&gt;

&lt;p&gt;I have not given up on something better, but I probably will take a break on this madness.&lt;/p&gt;

&lt;p&gt;Eclipse has been doing weird stuff creating my patches on my Ubuntu machine - hopefully this one is legit, but I&apos;ll check it on my mac eventually to be sure.&lt;/p&gt;</comment>
                            <comment id="13081021" author="rcmuir" created="Mon, 8 Aug 2011 16:04:04 +0000"  >&lt;p&gt;Not sure its really a step backwards if tests pass without the test close directory hack!&lt;/p&gt;

&lt;p&gt;couldn&apos;t we go with this as an iterative improvement, currently no directories are ever getting closed right?&lt;/p&gt;</comment>
                            <comment id="13081024" author="markrmiller@gmail.com" created="Mon, 8 Aug 2011 16:12:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;couldn&apos;t we go with this as an iterative improvement&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, that&apos;s been on my mind - just didn&apos;t want to give up completely yet. If I commit this now, it will take the pressure off for figuring out something better. Give me a bit more time to defeat myself.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;currently no directories are ever getting closed right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right - but the tradeoff with this is, I think, is that before Directories would be garbage collected when they where no longer used - and now they will stick around till the SolrCore is really closed. Not a big deal for FSDirectory impls in general, but more troublesome for the ram based variety.&lt;/p&gt;</comment>
                            <comment id="13081065" author="markrmiller@gmail.com" created="Mon, 8 Aug 2011 17:16:08 +0000"  >&lt;p&gt;P.S. to clarify, by step backwards, I meant vs the approach I was banging my head against. It&apos;s def a step forward from trunk mostly, and a step forward from the last patch (it now keeps all dirs seen in a list, so none are lost by the time we close them all).&lt;/p&gt;</comment>
                            <comment id="13081466" author="markrmiller@gmail.com" created="Tue, 9 Aug 2011 06:26:34 +0000"  >&lt;p&gt;Okay, looks like i am close to having this figured out - I changed tactics to do the ref counting in the dir factory, and then having the user release the directory. For whatever reason, this made things easier to debug. I found an issue I had that was making the previous attempt difficult, and also what looks like a nasty bug (more to come) that was compounding the issue. Still a fair amount to try and do to finish this off as I want, but making progress.&lt;/p&gt;</comment>
                            <comment id="13081473" author="markrmiller@gmail.com" created="Tue, 9 Aug 2011 06:43:05 +0000"  >&lt;p&gt;Latest rough patch&lt;/p&gt;</comment>
                            <comment id="13084738" author="markrmiller@gmail.com" created="Sat, 13 Aug 2011 23:00:32 +0000"  >&lt;p&gt;new patch - the problem with pure ref counting is that sometimes you might hit a point where you don&apos;t need the directory for a moment - and then you do - if its a ram based dir that means you lose your dir data. So this is something of a hybrid - it still ref counts, but only when a new index writer is forced open does it allow a directory to actually be closed. So when the indexwriter jumps to a new index, that should allow the old one to be removed once all the refs are released. The current working directory will always be kept around. All created directories are are tracked so that any that are not closed can be closed when the SolrCore is actually closed (not reloaded).&lt;/p&gt;

&lt;p&gt;All tests currently passing.&lt;/p&gt;</comment>
                            <comment id="13086040" author="markrmiller@gmail.com" created="Tue, 16 Aug 2011 23:34:07 +0000"  >&lt;p&gt;I&apos;ve cleaned up this patch quite a bit.&lt;/p&gt;</comment>
                            <comment id="13086078" author="markrmiller@gmail.com" created="Wed, 17 Aug 2011 01:45:36 +0000"  >&lt;p&gt;Another slightly better patch - we don&apos;t need to also track the set of all dirs anymore.&lt;/p&gt;</comment>
                            <comment id="13086618" author="markrmiller@gmail.com" created="Wed, 17 Aug 2011 21:48:45 +0000"  >&lt;p&gt;This makes one change in lucene that I could break out into it&apos;s own issue, but it&apos;s rather small - so I will collect any opinions here for now: &lt;/p&gt;

&lt;p&gt;I take the ensureOpen check out of IndexWriter on getDirectory. Anyone object? I don&apos;t know why we care if the IndexWriter is still open if we want to grab which Directory it used. You can hack around it, but I don&apos;t see why we don&apos;t just remove the check. Thoughts?&lt;/p&gt;</comment>
                            <comment id="13086648" author="markrmiller@gmail.com" created="Wed, 17 Aug 2011 22:29:06 +0000"  >&lt;p&gt;Another, more cleaned up, patch.&lt;/p&gt;</comment>
                            <comment id="13086709" author="rcmuir" created="Thu, 18 Aug 2011 00:42:33 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I take the ensureOpen check out of IndexWriter on getDirectory. Anyone object? I don&apos;t know why we care if the IndexWriter is still open if we want to grab which Directory it used. You can hack around it, but I don&apos;t see why we don&apos;t just remove the check. Thoughts?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1... its just a getter for the Dir, no reason to ensure its open. you might just want to do instanceof or something.&lt;/p&gt;

&lt;p&gt;In any case, the Directory &lt;b&gt;itself&lt;/b&gt; not indexwriter should be calling ensureOpen before doing things that require an open dir.&lt;/p&gt;

&lt;p&gt;Maybe we could spin off a separate issue to make a test for this, i know its inconsistent everywhere.&lt;/p&gt;</comment>
                            <comment id="13086999" author="markrmiller@gmail.com" created="Thu, 18 Aug 2011 13:21:21 +0000"  >&lt;p&gt;Cool - I&apos;m growing tempted to commit this then.&lt;/p&gt;</comment>
                            <comment id="13087106" author="rcmuir" created="Thu, 18 Aug 2011 16:38:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13087241" author="markrmiller@gmail.com" created="Thu, 18 Aug 2011 20:12:42 +0000"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;

&lt;p&gt;This cannot be done the same way on 3.x. 3.x does not have a mechanism to pass state across core reloads, and that&apos;s a change I&apos;d rather leave to 4.x.&lt;/p&gt;

&lt;p&gt;Might simply be best to track all directories and close them on shutdown.&lt;/p&gt;</comment>
                            <comment id="13106265" author="rcmuir" created="Fri, 16 Sep 2011 14:50:19 +0000"  >&lt;p&gt;3.4 -&amp;gt; 3.5&lt;/p&gt;</comment>
                            <comment id="13177259" author="markrmiller@gmail.com" created="Thu, 29 Dec 2011 16:43:30 +0000"  >&lt;p&gt;I don&apos;t think there is enough gain to tackle something on the 3x branch here. If further info changes that, or someone else wants to tackle it, we should just open a new issue. I&apos;m going to resolve this for 4 since we have a solution there.&lt;/p&gt;</comment>
                            <comment id="13398874" author="rkarallus" created="Thu, 21 Jun 2012 21:25:55 +0000"  >&lt;p&gt;We just occured this problem using the spellchecking component. We got Solr 3.5 running.&lt;/p&gt;

&lt;p&gt;Our configuration is:&lt;br/&gt;
...&lt;br/&gt;
&amp;lt;indexDefaults&amp;gt;&lt;br/&gt;
 ...&lt;br/&gt;
 &amp;lt;lockType&amp;gt;simple&amp;lt;/lockType&amp;gt;&lt;br/&gt;
&amp;lt;/indexDefaults&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;searchComponent name=&quot;spellcheck&quot; class=&quot;solr.SpellCheckComponent&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;str name=&quot;queryAnalyzerFieldType&quot;&amp;gt;textSpell&amp;lt;/str&amp;gt;&lt;br/&gt;
    &amp;lt;lst name=&quot;spellchecker&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;str name=&quot;name&quot;&amp;gt;default&amp;lt;/str&amp;gt;&lt;br/&gt;
      &amp;lt;str name=&quot;field&quot;&amp;gt;_spell&amp;lt;/str&amp;gt;&lt;br/&gt;
      &amp;lt;str name=&quot;spellcheckIndexDir&quot;&amp;gt;./spellchecker1&amp;lt;/str&amp;gt;&lt;br/&gt;
	  &amp;lt;str name=&quot;buildOnCommit&quot;&amp;gt;true&amp;lt;/str&amp;gt; &lt;br/&gt;
    &amp;lt;/lst&amp;gt;&lt;br/&gt;
...&lt;br/&gt;
&amp;lt;/searchComponent&amp;gt;&lt;/p&gt;

&lt;p&gt;That results in:&lt;/p&gt;

&lt;p&gt;Caused by: org.apache.lucene.store.LockObtainFailedException: Lock obtain timed out: NativeFSLock@.../data/spellchecker1/write.lock&lt;br/&gt;
	at org.apache.lucene.store.Lock.obtain(Lock.java:84)&lt;br/&gt;
	at org.apache.lucene.index.IndexWriter.&amp;lt;init&amp;gt;(IndexWriter.java:1108)&lt;br/&gt;
	at org.apache.lucene.search.spell.SpellChecker.setSpellIndex(SpellChecker.java:169)&lt;br/&gt;
	at org.apache.lucene.search.spell.SpellChecker.&amp;lt;init&amp;gt;(SpellChecker.java:149)&lt;br/&gt;
	at org.apache.solr.spelling.AbstractLuceneSpellChecker.init(AbstractLuceneSpellChecker.java:127)&lt;br/&gt;
	... 22 more&lt;/p&gt;

&lt;p&gt;Our FS doesnt support native locking. That&apos;s why we configured locktype to simple. However, the Spellchecker code doesn&apos;t use this setting ... That can be read pretty easy from the code:&lt;/p&gt;

&lt;p&gt;Solr AbstractLuceneSpellChecker:&lt;br/&gt;
  protected void initIndex() throws IOException {&lt;br/&gt;
    if (indexDir != null) &lt;/p&gt;
{
      index = FSDirectory.open(new File(indexDir));
    }
&lt;p&gt; else &lt;/p&gt;
{
      index = new RAMDirectory();
    }
&lt;p&gt;  }&lt;br/&gt;
=&amp;gt; doesnt give a locking factory so the default is used&lt;/p&gt;

&lt;p&gt;Lucene FSDirectory:&lt;br/&gt;
  protected FSDirectory(File path, LockFactory lockFactory) throws IOException {&lt;br/&gt;
    // new ctors use always NativeFSLockFactory as default:&lt;br/&gt;
    if (lockFactory == null) &lt;/p&gt;
{
      lockFactory = new NativeFSLockFactory();
    }
&lt;p&gt;    directory = getCanonicalPath(path);&lt;/p&gt;

&lt;p&gt;    if (directory.exists() &amp;amp;&amp;amp; !directory.isDirectory())&lt;br/&gt;
      throw new NoSuchDirectoryException(&quot;file &apos;&quot; + directory + &quot;&apos; exists but is not a directory&quot;);&lt;/p&gt;

&lt;p&gt;    setLockFactory(lockFactory);&lt;br/&gt;
  }&lt;br/&gt;
=&amp;gt; the default is NativeFSLock&lt;/p&gt;

&lt;p&gt;I think that makes the problem a little less theoretical and more severe then the read scenario&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12536594">SOLR-2991</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12518145">SOLR-2702</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12490705" name="SOLR-2654.patch" size="63560" author="markrmiller@gmail.com" created="Wed, 17 Aug 2011 22:29:06 +0000"/>
                            <attachment id="12490590" name="SOLR-2654.patch" size="63008" author="markrmiller@gmail.com" created="Wed, 17 Aug 2011 01:45:35 +0000"/>
                            <attachment id="12490582" name="SOLR-2654.patch" size="63698" author="markrmiller@gmail.com" created="Tue, 16 Aug 2011 23:34:07 +0000"/>
                            <attachment id="12490359" name="SOLR-2654.patch" size="65856" author="markrmiller@gmail.com" created="Sat, 13 Aug 2011 23:00:32 +0000"/>
                            <attachment id="12489701" name="SOLR-2654.patch" size="54293" author="markrmiller@gmail.com" created="Mon, 8 Aug 2011 15:57:52 +0000"/>
                            <attachment id="12489638" name="SOLR-2654.patch" size="50968" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 20:31:24 +0000"/>
                            <attachment id="12489613" name="SOLR-2654.patch" size="42969" author="markrmiller@gmail.com" created="Sun, 7 Aug 2011 03:29:28 +0000"/>
                            <attachment id="12489533" name="SOLR-2654.patch" size="43275" author="markrmiller@gmail.com" created="Fri, 5 Aug 2011 21:00:54 +0000"/>
                            <attachment id="12489815" name="SOLR-2698.patch" size="64167" author="markrmiller@gmail.com" created="Tue, 9 Aug 2011 06:43:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4896</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03jgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>