<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:37:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4941] useCompoundFile default has changed, simple config option no longer seems to work</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4941</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Spin off of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4934&quot; title=&quot;Prevent runtime failure if users use initargs &amp;quot;useCompoundFile&amp;quot; setting on LogMergePolicy or TieredMergePolicy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4934&quot;&gt;&lt;del&gt;SOLR-4934&lt;/del&gt;&lt;/a&gt;.  We should updated tests to ensure that the various ways of specifying useCompoundFile as well as the expected default are working properly after &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-5038&quot; title=&quot;Don&amp;#39;t call MergePolicy / IndexWriter during DWPT Flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-5038&quot;&gt;&lt;del&gt;LUCENE-5038&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12653755">SOLR-4941</key>
            <summary>useCompoundFile default has changed, simple config option no longer seems to work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Jun 2013 17:24:59 +0000</created>
                <updated>Mon, 9 May 2016 18:47:34 +0000</updated>
                            <resolved>Thu, 20 Jun 2013 02:10:39 +0000</resolved>
                                                    <fixVersion>4.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13688270" author="hossman" created="Wed, 19 Jun 2013 18:29:23 +0000"  >&lt;p&gt;I understand what happend now..&lt;/p&gt;

&lt;p&gt;when simon asked on the mailing list for help reviewing the solr changes affected by  &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-5038&quot; title=&quot;Don&amp;#39;t call MergePolicy / IndexWriter during DWPT Flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-5038&quot;&gt;&lt;del&gt;LUCENE-5038&lt;/del&gt;&lt;/a&gt; i didn&apos;t fully understand the scope of the change, and only focused on how it affected the existing MergePolicy settings (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4934&quot; title=&quot;Prevent runtime failure if users use initargs &amp;quot;useCompoundFile&amp;quot; setting on LogMergePolicy or TieredMergePolicy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4934&quot;&gt;&lt;del&gt;SOLR-4934&lt;/del&gt;&lt;/a&gt;) &amp;#8211; but i only noticed that &quot;setUseCompoundFile&quot; had been removed from the merge policies in facvor us only using the ratio &amp;#8211; i didn&apos;t realize that setUseCompoundFile was actaully moved to IndexWriterConfig.&lt;/p&gt;

&lt;p&gt;i&apos;ll work up a patch to make the existing solr settings apply to the IndexWriterConfig.&lt;/p&gt;</comment>
                            <comment id="13688378" author="hossman" created="Wed, 19 Jun 2013 20:08:54 +0000"  >&lt;p&gt;Patch that improves the tests and updates the logic added in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4934&quot; title=&quot;Prevent runtime failure if users use initargs &amp;quot;useCompoundFile&amp;quot; setting on LogMergePolicy or TieredMergePolicy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4934&quot;&gt;&lt;del&gt;SOLR-4934&lt;/del&gt;&lt;/a&gt; so that if there is explicit useCompoundFile configuration as an init arg for a (known) MergePolicy we pass that to the IndexWriterConfig&apos;s setUseCompoundFile method and log a warning instead of just ignoring it.&lt;/p&gt;

&lt;p&gt;patch also removes the warnings about the simple legacy &amp;lt;useCompoundFile&amp;gt; syntax since that actually makes sense now that it&apos;s a setting on IWC.&lt;/p&gt;

&lt;p&gt;I&apos;ve also updated the tests to inspect the useCompoundFile on the IWC as well as checking the results of adding some segments.&lt;/p&gt;

&lt;p&gt;there is still a failure in testTieredMergePolicyConfig where (as i understand it from talking to mike on IRC) the merged segment after the optimize command should &lt;b&gt;not&lt;/b&gt; be in CFS format because of the noCFSRatio setting &amp;#8211; but the merged segment is still in CFS. i&apos;ve attached the infostream log from running &quot;ant test -Dtestcase=TestMergePolicyConfig -Dtests.method=testTieredMergePolicyConfig&quot; to see if it helps illuminate the problem ... i suspect it&apos;s either a test bug because i still missunderstand something about how the MergePolicy settings come into play, or a genuine bug in the lower level TieredMP code &amp;#8211; i don&apos;t see how it could be specific to the solr config parsing logic since the IWC and TMP getters say they got the expected settings.&lt;/p&gt;

&lt;p&gt;(NOTE: the patch includes a nocommit in solrconfig-mergepolicy.xml to turn off the infostream before committing)&lt;/p&gt;</comment>
                            <comment id="13688444" author="mikemccand" created="Wed, 19 Jun 2013 20:54:11 +0000"  >&lt;p&gt;Indeed I can see that TMP has noCFSRatio=0.6, and two segments are flushed &amp;amp; turned into CFS, then those two segments are merged, and then the merged segment is turned into a CFS.&lt;/p&gt;

&lt;p&gt;I think this means that the merged segment&apos;s files (pre-CFS) are &amp;lt; 0.6 the size of the two flushed CFS segments ... e.g. maybe the CFS headers of the first 2 segments are tipping the scale?  Try indexing more docs for each segment maybe?&lt;/p&gt;</comment>
                            <comment id="13688534" author="hossman" created="Wed, 19 Jun 2013 22:11:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;maybe the CFS headers of the first 2 segments are tipping the scale? Try indexing more docs for each segment maybe?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yeah .. i guess i was just naive in considering 0.6 a low enough threshold.&lt;/p&gt;

&lt;p&gt;i increased the size of the docs and the number of docs per segment &amp;#8211; and when that still didn&apos;t work i also decreased the ratio to 0.1 and that seemed to do the trick.&lt;/p&gt;

&lt;p&gt;updated patch fixes the test, removes the nocommit, and updates the &quot;upgrading&quot; instructions in CHANGES.txt (still need an explicit &quot;Bug Fix&quot; entry though)&lt;/p&gt;

&lt;p&gt;still running more test iters, but i think this is pretty good.&lt;/p&gt;</comment>
                            <comment id="13688794" author="hossman" created="Thu, 20 Jun 2013 02:10:39 +0000"  >&lt;p&gt;Committed revision 1494837.&lt;br/&gt;
Committed revision 1494839.&lt;/p&gt;</comment>
                            <comment id="13716806" author="steve_rowe" created="Tue, 23 Jul 2013 18:38:38 +0000"  >&lt;p&gt;Bulk close resolved 4.4 issues&lt;/p&gt;</comment>
                            <comment id="15242322" author="dsmiley" created="Fri, 15 Apr 2016 02:48:01 +0000"  >&lt;p&gt;Before I go file a new issue, I at least want to comment here to see what you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; and of course anyone else who may notice (  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt; touched this stuff too I think?).  I claim that &quot;useCompoundFile&quot; in solrconfig.xml (directly within &amp;lt;indexConfig&amp;gt;) is named in a way that is misleading, and Solr chooses a default that is not ideal. &lt;/p&gt;

&lt;p&gt;&amp;lt;useCompoundFile&amp;gt; is only about flushed segments from newly indexed documents, yet its setting name doesn&apos;t reflect it&apos;s limited to just those new segments.  We don&apos;t even say this in comments or the ref guide (I&apos;ll happily fix this).  I can understand how this came to be, it&apos;s mimicking a like-setting in Lucene IndexWriter which arguably is also misleading for the same reason.  But I don&apos;t think we need to mimick the name Lucene chose.  I could propose alternative names but I just want to throw this statement out there to see if it resonates or not.&lt;/p&gt;

&lt;p&gt;Secondly, note that Solr defaults to useCompoundFile=false; Lucene does true. Given a merge policy with a noCFSRatio of &amp;gt; 0 (by default we use TieredMergePolicy which uses 0.1), merged segments with fewer than 10% of the index will become CFS.  This is a schizophrenic configuration!  Segments start off non-CFS, then get merged to CFS (assuming it&apos;s still small enough), and then eventually become non-CFS again.  It flipped back then forth.  That&apos;s weird.  Instead, I propose that only if noCFSRatio is 0, &lt;em&gt;then&lt;/em&gt; default useCompoundFile to false since it&apos;ll never flip-flop.  Otherwise, default useCompoundFile=true (which given default MP settings, this will generally be the case).&lt;/p&gt;

&lt;p&gt;Make sense?&lt;/p&gt;</comment>
                            <comment id="15242456" author="hossman" created="Fri, 15 Apr 2016 05:23:43 +0000"  >&lt;p&gt;I honestly don&apos;t even remember this issue, let alone what the (expected) impact of the changes were or what cascading sets of decisions led to the situation we were in.  More then likeley i was just trying to keep existing configs working as closely as possible to how they worked before new stuff was added to Lucene.&lt;/p&gt;

&lt;p&gt;I would absolutely open a new issue proposing whatever new configs/defaults you think are best, and I would absolutely rope &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt; in &amp;#8211; i personally would defer to her judgement on what makes the most sense for these types of things before i would trust my own judgement.&lt;/p&gt;</comment>
                            <comment id="15242965" author="cpoerschke" created="Fri, 15 Apr 2016 13:41:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; - thanks for including me on this. In &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8621&quot; title=&quot;solrconfig.xml: deprecate/replace &amp;lt;mergePolicy&amp;gt; with &amp;lt;mergePolicyFactory&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8621&quot;&gt;&lt;del&gt;SOLR-8621&lt;/del&gt;&lt;/a&gt; myself and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shaie&quot; class=&quot;user-hover&quot; rel=&quot;shaie&quot;&gt;shaie&lt;/a&gt; changed MergePolicy related config in &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/update/SolrIndexConfig.java#L135&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SolrIndexConfig.java&lt;/a&gt; where &amp;lt;useCompoundFile&amp;gt; is configured also.&lt;/p&gt;

&lt;p&gt;The &amp;lt;useCompoundFile&amp;gt; setting name not reflecting exact use i.e. new segments vs. segments created through merge, I agree that&apos;s not ideal and that the ref guide at least mentioning it would be good. Though unless we can come up with a very much clearer alternative name, would there be value in continuing to mimic/match the Lucene setting name?&lt;/p&gt;

&lt;p&gt;I agree, the &apos;initially uncompounded, then compounded-via-merge, then uncompound-via-merge-since-too-large&apos; lifecycle seems unusual as a default. &lt;/p&gt;

&lt;p&gt;Making the default useCompoundFile value depend on the merge policy&apos;s noCFSRatio value, would that not be confusing for users? (The XML paths in solrconfig.xml are &lt;tt&gt;indexConfig/useCompoundFile&lt;/tt&gt; and &lt;tt&gt;indexConfig/mergePolicyFactory/int(noCFSRatio)&lt;/tt&gt; respectively.)&lt;/p&gt;

&lt;p&gt;How about changing the overall default (to useCompoundFile=true) and logging WARNings for unusual combinations? Unusual combinations would be:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;useCompoundFile==false&lt;/tt&gt; and &lt;tt&gt;noCFSRatio&amp;gt;0.0&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;useCompoundFile==true&lt;/tt&gt; and &lt;tt&gt;noCFSRatio==0.0&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15243065" author="dsmiley" created="Fri, 15 Apr 2016 14:56:24 +0000"  >&lt;p&gt;Sounds great &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;.  I&apos;ll file an issue referencing this discussion and we&apos;ll continue from there.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12653358">SOLR-4934</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12959200">SOLR-8997</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12651325">LUCENE-5038</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12652713">SOLR-4926</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12588702" name="SOLR-4941.patch" size="15822" author="hossman" created="Wed, 19 Jun 2013 22:11:30 +0000"/>
                            <attachment id="12588676" name="SOLR-4941.patch" size="13551" author="hossman" created="Wed, 19 Jun 2013 20:08:54 +0000"/>
                            <attachment id="12588677" name="infostream.txt" size="58846" author="hossman" created="Wed, 19 Jun 2013 20:08:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334032</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lme7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334358</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>