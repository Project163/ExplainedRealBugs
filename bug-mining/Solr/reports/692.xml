<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:23:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2705] On reload, IndexWriterProvider holds onto the initial SolrCore it was created with</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2705</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;dug up by Yury Kats in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2326&quot; title=&quot;Replication command indexversion fails to return index version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2326&quot;&gt;SOLR-2326&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The IWP needs to be updated to ref the new core on reload - else if some settings have changed (eg newIndexDir change caused by replication), the IndexWriter will be incorrectly reopened.&lt;/p&gt;

&lt;p&gt;This should really only be an issue when replication and core reloads are involved for the most part.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12518490">SOLR-2705</key>
            <summary>On reload, IndexWriterProvider holds onto the initial SolrCore it was created with</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Aug 2011 17:59:48 +0000</created>
                <updated>Fri, 10 May 2013 10:41:11 +0000</updated>
                            <resolved>Thu, 11 Aug 2011 02:01:21 +0000</resolved>
                                                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13082531" author="markrmiller@gmail.com" created="Wed, 10 Aug 2011 18:25:12 +0000"  >&lt;p&gt;Test case + fix&lt;/p&gt;</comment>
                            <comment id="13082538" author="ykats" created="Wed, 10 Aug 2011 18:29:10 +0000"  >&lt;p&gt;The problem is reproducible on the stock multicore example&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;configure multicore&apos;s ReplicationHandler to replicate after startup and commit&lt;/li&gt;
	&lt;li&gt;launch multicore example&lt;/li&gt;
	&lt;li&gt;index some example docs&lt;/li&gt;
	&lt;li&gt;ask for commits: &lt;a href=&quot;http://localhost:8983/solr/core0/replication?command=commits&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/core0/replication?command=commits&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;reload core0: &lt;a href=&quot;http://localhost:8983/solr/admin/cores?action=RELOAD&amp;amp;core=core0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/admin/cores?action=RELOAD&amp;amp;core=core0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;ask for commits again: &lt;a href=&quot;http://localhost:8983/solr/core0/replication?command=commits&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/core0/replication?command=commits&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;observe no commits being returned after reload.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13082545" author="markrmiller@gmail.com" created="Wed, 10 Aug 2011 18:34:07 +0000"  >&lt;p&gt;I&apos;m going to pop this one in now. Ugly little bug.&lt;/p&gt;</comment>
                            <comment id="13082547" author="markrmiller@gmail.com" created="Wed, 10 Aug 2011 18:35:15 +0000"  >&lt;p&gt;Committed - Yury, can you confirm this works for you use case now?&lt;/p&gt;</comment>
                            <comment id="13082549" author="ykats" created="Wed, 10 Aug 2011 18:37:25 +0000"  >&lt;p&gt;Thanks, I will try. &lt;br/&gt;
Looking at the patch, it&apos;s not clear to me whether the reloaded core would return proper Commits right after it&apos;s been reloaded, or only after the subsequent commit. &lt;br/&gt;
Can Junit check for indexversion/commits to be same right before and right after coreReload?&lt;/p&gt;</comment>
                            <comment id="13082567" author="ykats" created="Wed, 10 Aug 2011 19:06:10 +0000"  >&lt;p&gt;First quick test looks good!&lt;/p&gt;</comment>
                            <comment id="13082578" author="markrmiller@gmail.com" created="Wed, 10 Aug 2011 19:14:01 +0000"  >&lt;p&gt;Sure, likely easy enough to add.&lt;/p&gt;

&lt;p&gt;The current test fails without the fix because the SolrCore is changed on the reload, and replication will sometimes kick off the creation of a new index writer. If it does this using the old SolrCore&apos;s settings/fields, as was happening, it might not even be writing to the right index! And it&apos;s DeletionPolicy will be the incorrect instance from the old core, and... When the new writer is made, it needs it&apos;s info to come from the new SolrCore of course. This bug was nasty - unfortunately we didn&apos;t have a test that could tickle it.&lt;/p&gt;

&lt;p&gt;So in this test, after the reload, if you add any further documents, they won&apos;t show up in any searches, even after commit.&lt;/p&gt;

&lt;p&gt;So the test adds 10 docs, ensures they are in the index, then adds 2 more docs, and ensures 12 docs are in the index - without the fix it would find 10 rather than 12 - until you restart the server.&lt;/p&gt;</comment>
                            <comment id="13082589" author="ykats" created="Wed, 10 Aug 2011 19:24:45 +0000"  >&lt;p&gt;Tested some more, all is well. Thanks a lot, Mark. This is outstanding support and turn around time from a committer. Hats off!&lt;/p&gt;

&lt;p&gt;I saw in the patch that you&apos;ve added getIndexversion and getCommits, but haven&apos;t used them. Would be a shame not to put them to work. It would also ensure that replication works right after a RELOAD, which can be a case in my app, so I&apos;m in favor of testing that angle as well. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13082597" author="markrmiller@gmail.com" created="Wed, 10 Aug 2011 19:29:39 +0000"  >&lt;p&gt;Hmm...so that improved things, but it&apos;s not quite the right fix. If multiple SolrCores are going to share the IndexWriterProvider for any length of time, it cannot hold a ref to a SolrCore. It&apos;s rare to have multiple reloaded SolrCores up at the same time with a Writer (I know because it wasn&apos;t even possible a short time ago without running into IndexLock exceptions), but this should now be fine to do. So a better solution is to pass the SolrCore to the methods of IndexWriterProver.&lt;/p&gt;</comment>
                            <comment id="13082860" author="markrmiller@gmail.com" created="Thu, 11 Aug 2011 02:01:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;I saw in the patch that you&apos;ve added getIndexversion and getCommits, but haven&apos;t used them.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right - they where good for debugging and I figured I would use them to investigate &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2326&quot; title=&quot;Replication command indexversion fails to return index version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2326&quot;&gt;SOLR-2326&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can Junit check for indexversion/commits to be same right before and right after coreReload?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve committed this check.&lt;/p&gt;</comment>
                            <comment id="13082861" author="markrmiller@gmail.com" created="Thu, 11 Aug 2011 02:01:21 +0000"  >&lt;p&gt;Thanks Yury!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12490027" name="SOLR-2705.patch" size="14337" author="markrmiller@gmail.com" created="Wed, 10 Aug 2011 19:29:39 +0000"/>
                            <attachment id="12490021" name="SOLR-2705.patch" size="12224" author="markrmiller@gmail.com" created="Wed, 10 Aug 2011 18:25:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3143</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03j33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18525</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>