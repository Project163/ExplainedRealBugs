<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:52:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16416] Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16416</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;OverseerRolesTest.testDesignatedOverseerRestarts has been failing consistently (around 2.5% of the time). I think this is because LeaderElection.joinElection does not respect the joinAtHead flag, if connectionIssues happen while setting the leader election nodes.&lt;/p&gt;

&lt;p&gt;LeaderElection does not use the automatic retryOnConnLoss flags when doing zk operations. Instead, it waits for an error to come back, and it handles the retry itself. This is fine for the normal case, because it checks if node is represented in the leaderElection child nodes, and if so it ignores the connection loss. However when doing joinAtHead, if the childNode exists, but isn&apos;t at the place it should be, then the manual retry should be exercised.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13482197">SOLR-16416</key>
            <summary>Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houston">Houston Putman</assignee>
                                    <reporter username="houston">Houston Putman</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Sep 2022 16:10:56 +0000</created>
                <updated>Fri, 17 Oct 2025 20:04:41 +0000</updated>
                            <resolved>Wed, 26 Oct 2022 17:11:39 +0000</resolved>
                                                    <fixVersion>9.1</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17607805" author="houston" created="Wed, 21 Sep 2022 15:08:12 +0000"  >&lt;p&gt;Ok after more digging, this does not seem to be the case. What actually happens is that at the end of OverseerNodePrioritizer.prioritizeOverseerNodes(), the prioritizer will send a command to the prioritized leader to take the second spot in the leader election, then send a second command to the current second spot to rejoin at the end.&lt;/p&gt;

&lt;p&gt;The logging in the failed tests show that the second command is received, but the first is never logged. After going through the HttpShardHandler, it seems like the error message is just swallowed and never even logged. As a first step, I&apos;ll add logging if an error comes back from either command. Then we can actually start debugging these failures.&lt;/p&gt;</comment>
                            <comment id="17607944" author="jira-bot" created="Wed, 21 Sep 2022 19:35:57 +0000"  >&lt;p&gt;Commit 0aa9b333d94f7573f83a414586f0ae34fe1c13a5 in solr&apos;s branch refs/heads/main from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=0aa9b333d94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=0aa9b333d94&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16416&quot; title=&quot;Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16416&quot;&gt;&lt;del&gt;SOLR-16416&lt;/del&gt;&lt;/a&gt;: Add error logging to allow debugging of OverseerNodePrioritizer&lt;/p&gt;</comment>
                            <comment id="17608380" author="jira-bot" created="Thu, 22 Sep 2022 18:37:05 +0000"  >&lt;p&gt;Commit f529154f74078e9012be486a684bdd021072df72 in solr&apos;s branch refs/heads/branch_9x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=f529154f740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=f529154f740&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16416&quot; title=&quot;Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16416&quot;&gt;&lt;del&gt;SOLR-16416&lt;/del&gt;&lt;/a&gt;: Add error logging to allow debugging of OverseerNodePrioritizer&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 0aa9b333d94f7573f83a414586f0ae34fe1c13a5)&lt;/p&gt;</comment>
                            <comment id="17619735" author="houston" created="Tue, 18 Oct 2022 18:39:03 +0000"  >&lt;p&gt;So looking at the errors, the issue is that the &lt;tt&gt;JettySolrRunner&lt;/tt&gt; has not registered the Solr handlers when the OverseerNodePrioritizer decides to send the overseer request to it. This NodePrioritization stems from an overseer action sent from the end of &lt;tt&gt;CoreContainer.load()&lt;/tt&gt;. If we make sure that the &lt;tt&gt;JettySolrRunner&lt;/tt&gt; has registered the Solr handlers as soon as this is called, we should be safe.&lt;/p&gt;

&lt;p&gt;I see you&apos;ve done a lot of work here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gus&quot; class=&quot;user-hover&quot; rel=&quot;gus&quot;&gt;gus&lt;/a&gt;, any suggestions?&lt;/p&gt;</comment>
                            <comment id="17624143" author="jira-bot" created="Wed, 26 Oct 2022 02:36:37 +0000"  >&lt;p&gt;Commit 1738098b348a27b3dd5c4f64e12115de20b74b17 in solr&apos;s branch refs/heads/main from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=1738098b348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=1738098b348&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16416&quot; title=&quot;Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16416&quot;&gt;&lt;del&gt;SOLR-16416&lt;/del&gt;&lt;/a&gt;: Register all handlers before doing overseer operations (#1129)&lt;/p&gt;

&lt;p&gt;Also retry overseerPrioritizer ops on failure.&lt;/p&gt;</comment>
                            <comment id="17624145" author="jira-bot" created="Wed, 26 Oct 2022 02:39:51 +0000"  >&lt;p&gt;Commit 5656eb4c5a3513d7e14ea5ea3b35f1389d1aa037 in solr&apos;s branch refs/heads/branch_9x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=5656eb4c5a3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=5656eb4c5a3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16416&quot; title=&quot;Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16416&quot;&gt;&lt;del&gt;SOLR-16416&lt;/del&gt;&lt;/a&gt;: Register all handlers before doing overseer operations (#1129)&lt;/p&gt;

&lt;p&gt;Also retry overseerPrioritizer ops on failure.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1738098b348a27b3dd5c4f64e12115de20b74b17)&lt;/p&gt;</comment>
                            <comment id="17624156" author="jira-bot" created="Wed, 26 Oct 2022 03:11:49 +0000"  >&lt;p&gt;Commit e636590600206c8cae9f88fabab5f962fe984937 in solr&apos;s branch refs/heads/branch_9_1 from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=e6365906002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=e6365906002&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16416&quot; title=&quot;Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16416&quot;&gt;&lt;del&gt;SOLR-16416&lt;/del&gt;&lt;/a&gt;: retry overseerPrioritizer ops on failure. (#1129)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1738098b348a27b3dd5c4f64e12115de20b74b17)&lt;/p&gt;</comment>
                            <comment id="17624616" author="houston" created="Wed, 26 Oct 2022 16:56:58 +0000"  >&lt;p&gt;The test is still failing due to overseer elections happening in the beginning of the test. These elections are started when the test removes the overseer role from each node, in order of the overseer election queue. Since we are removing these roles in order, after each role is removed the next node (that has the role) is elected (because its role hasn&apos;t been removed yet).&lt;/p&gt;

&lt;p&gt;The simple fix is to remove roles in reverse election order, this way the last node to have its role removed is the current overseer. Therefore no overseer election will take place until the test wants overseer elections to take place.&lt;/p&gt;</comment>
                            <comment id="17624622" author="jira-bot" created="Wed, 26 Oct 2022 17:05:24 +0000"  >&lt;p&gt;Commit b01ae1783946b7fee43cd2faace0b721f7f7d29f in solr&apos;s branch refs/heads/main from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=b01ae178394&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=b01ae178394&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16416&quot; title=&quot;Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16416&quot;&gt;&lt;del&gt;SOLR-16416&lt;/del&gt;&lt;/a&gt;: Fix testDesignatedOverseerRestarts&lt;/p&gt;

&lt;p&gt;Remove roles for all nodes in reverse election order.&lt;br/&gt;
This will make sure no elections take place at the beginning of the&lt;br/&gt;
test, which can cause problems later on in the test.&lt;/p&gt;</comment>
                            <comment id="17624624" author="jira-bot" created="Wed, 26 Oct 2022 17:08:17 +0000"  >&lt;p&gt;Commit 756287fec73a3fab83bbb268a20d50a7297d6079 in solr&apos;s branch refs/heads/branch_9x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=756287fec73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=756287fec73&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16416&quot; title=&quot;Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16416&quot;&gt;&lt;del&gt;SOLR-16416&lt;/del&gt;&lt;/a&gt;: Fix testDesignatedOverseerRestarts&lt;/p&gt;

&lt;p&gt;Remove roles for all nodes in reverse election order.&lt;br/&gt;
This will make sure no elections take place at the beginning of the&lt;br/&gt;
test, which can cause problems later on in the test.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b01ae1783946b7fee43cd2faace0b721f7f7d29f)&lt;/p&gt;</comment>
                            <comment id="17624626" author="jira-bot" created="Wed, 26 Oct 2022 17:10:05 +0000"  >&lt;p&gt;Commit a21e8bc4f3c3efcc94bb5a3d6bf76a4a562d3dd0 in solr&apos;s branch refs/heads/branch_9_1 from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=a21e8bc4f3c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=a21e8bc4f3c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16416&quot; title=&quot;Fix silently failing Overseer Election joinAtHead during testDesignatedOverseerRestarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16416&quot;&gt;&lt;del&gt;SOLR-16416&lt;/del&gt;&lt;/a&gt;: Fix testDesignatedOverseerRestarts&lt;/p&gt;

&lt;p&gt;Remove roles for all nodes in reverse election order.&lt;br/&gt;
This will make sure no elections take place at the beginning of the&lt;br/&gt;
test, which can cause problems later on in the test.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b01ae1783946b7fee43cd2faace0b721f7f7d29f)&lt;/p&gt;</comment>
                            <comment id="17656956" author="ishan" created="Tue, 10 Jan 2023 20:45:39 +0000"  >&lt;p&gt;Bulk closing 9.1 issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18o74:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>