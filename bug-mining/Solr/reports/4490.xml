<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:44:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14426] forbidden api error during precommit DateMathFunction</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14426</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When running `./gradlew precommit` I&apos;ll occasionally see&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
* What went wrong:
Execution failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task &lt;span class=&quot;code-quote&quot;&gt;&apos;:solr:contrib:analytics:forbiddenApisMain&apos;&lt;/span&gt;.
&amp;gt; de.thetaphi.forbiddenapis.ForbiddenApiException: Check &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; forbidden API calls failed &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; scanning class &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.solr.analytics.function.mapping.DateMathFunction&apos;&lt;/span&gt; (DateMathFunction.java): java.lang.ClassNotFoundException: org.apache.solr.analytics.function.mapping.DateMathValueFunction (&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; looking up details about referenced class &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.solr.analytics.function.mapping.DateMathValueFunction&apos;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;`./gradlew clean` fixes this, but I don&apos;t understand what or why this happens. Feels like a gradle issue?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13300308">SOLR-14426</key>
            <summary>forbidden api error during precommit DateMathFunction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mdrob">Mike Drob</assignee>
                                    <reporter username="mdrob">Mike Drob</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Apr 2020 15:47:28 +0000</created>
                <updated>Thu, 12 May 2022 00:26:45 +0000</updated>
                            <resolved>Thu, 4 Jun 2020 11:19:46 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                                    <component>Build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17099798" author="romseygeek" created="Tue, 5 May 2020 11:29:40 +0000"  >&lt;p&gt;I&apos;ve also run into this, it seems like it&apos;s due to DateMathValueFunction being defined as an old-style package-private class after the main class, rather than as a static nested class.  We should probably try and find all instances of these in the codebase and clear them up.&lt;/p&gt;</comment>
                            <comment id="17099808" author="romseygeek" created="Tue, 5 May 2020 11:39:41 +0000"  >&lt;p&gt;OK, from a quick grep it appears that there are 290 old-style package-private classes in the Solr code base.  It seems odd that it&apos;s always this one that fails forbiddenApis though - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uschindler&quot; class=&quot;user-hover&quot; rel=&quot;uschindler&quot;&gt;uschindler&lt;/a&gt; any ideas?&lt;/p&gt;</comment>
                            <comment id="17100004" author="thetaphi" created="Tue, 5 May 2020 15:27:25 +0000"  >&lt;p&gt;This is the usual problem with the old-style package-private classes which are in same source file than the main class. I fixed some of them already, but they are bad Java style. The only workaround is to do ant clean. The problem is that Java/Javac/Gradle/Ant can&apos;t figure out where the class file is coming from. When it gets recompiled, the leftover class without source file is a relic leading to those failures. It&apos;s not really forbiddenapis fault, because the class file should not be there at all.&lt;/p&gt;

&lt;p&gt;We can only fix that at some point. Eclipse is also getting angry about those quite often.&lt;/p&gt;

&lt;p&gt;To fix this, the classes should be moverd as static inner class into the main class. In most cases this can be done with copypaste, but there&apos;s no automated  refactoring in Eclipse. Maybe other IDEs have better refactoring tools.&lt;/p&gt;</comment>
                            <comment id="17100221" author="mdrob" created="Tue, 5 May 2020 20:01:58 +0000"  >&lt;p&gt;Thanks for explaining what is going on, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uschindler&quot; class=&quot;user-hover&quot; rel=&quot;uschindler&quot;&gt;uschindler&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;IntelliJ has a report for this, we have 437 instances of this issue apparently. I&apos;ll try to tackle a few of them and see how well it works.&lt;/p&gt;</comment>
                            <comment id="17100563" author="dweiss" created="Wed, 6 May 2020 08:10:40 +0000"  >&lt;p&gt;Hmm... How do you reproduce the bahavior you guys describe? Because my thinking would be that if you touch the source file (DateMathFunction.java) both class files should be regenerated. And both class files should have source attribute pointing back at DateMathFunction.java (so tools should be able to tell where a class comes from).&lt;/p&gt;</comment>
                            <comment id="17101754" author="jira-bot" created="Thu, 7 May 2020 15:04:26 +0000"  >&lt;p&gt;Commit 31b350e8040cbe30c4e85b7fb82eab4b6afd81c7 in lucene-solr&apos;s branch refs/heads/master from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=31b350e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=31b350e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14426&quot; title=&quot;forbidden api error during precommit DateMathFunction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14426&quot;&gt;&lt;del&gt;SOLR-14426&lt;/del&gt;&lt;/a&gt; Move auxiliary classes to nested classes (#1487)&lt;/p&gt;
</comment>
                            <comment id="17101758" author="mdrob" created="Thu, 7 May 2020 15:07:28 +0000"  >&lt;p&gt;resolving this for now, somebody please reopen if they see the issue again&lt;/p&gt;</comment>
                            <comment id="17103452" author="dsmiley" created="Sat, 9 May 2020 19:52:43 +0000"  >&lt;p&gt;Moving these classes to within another class disturbed the API (i.e. the very identity of these classes).  If it&apos;s only used within the same source file then this makes sense to me, but not otherwise.  The other solution I don&apos;t see discussed here is giving them their own source file.  When I look at FaceContext in particular, it appears it&apos;s used widely and thus would make a good top level class, not inside FacetRequest.  Please revisit this Mike.&lt;/p&gt;</comment>
                            <comment id="17103737" author="dweiss" created="Sun, 10 May 2020 09:36:50 +0000"  >&lt;p&gt;I still don&apos;t quite understand how to reproduce the original problem. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17104717" author="mdrob" created="Mon, 11 May 2020 17:50:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Moving these classes to within another class disturbed the API (i.e. the very identity of these classes).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is for 9.0, so I was under the impression that some API change is acceptable? Probably needs a CHANGES entry though, which I didn&apos;t include.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The other solution I don&apos;t see discussed here is giving them their own source file&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If I understand things correctly, then this wouldn&apos;t actually change the API, right?&lt;/p&gt;


&lt;p&gt;I think a good choice here would be to stick with inner classes on the analytics contrib module, since I do not believe those classes are instantiated directly. And then for core classes, we can do separate source files?&lt;/p&gt;</comment>
                            <comment id="17104770" author="mdrob" created="Mon, 11 May 2020 19:13:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; - This addressed a bunch of auxiliary classes, but there&apos;s some concern that I simply moving them to static inner classes might not have been the right thing to do. FYI.&lt;/p&gt;</comment>
                            <comment id="17105001" author="dsmiley" created="Tue, 12 May 2020 01:39:10 +0000"  >&lt;p&gt;Since it&apos;s package private, this isn&apos;t a public API change so it&apos;s not about compatibility. &#160;It&apos;s about disturbing many references in many source files that now refer to &lt;tt&gt;FacetRequest.FacetContext&lt;/tt&gt;&#160;instead of simply as it was &#8211; &lt;tt&gt;FacetContext&lt;/tt&gt;. &#160;I think FC is fine as a top level (package private) class, as it was. &#160;It just needs to be declared in its own source file; that&apos;s all.&lt;/p&gt;

&lt;p&gt;The analytics contrib module changes look fine.&lt;/p&gt;</comment>
                            <comment id="17105428" author="erickerickson" created="Tue, 12 May 2020 13:31:11 +0000"  >&lt;p&gt;Also, I don&apos;t see any reason this couldn&apos;t  be backported to 8x?&lt;/p&gt;

&lt;p&gt;I&apos;m going to start a bit of a discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10778&quot; title=&quot;Address precommit WARNINGS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10778&quot;&gt;&lt;del&gt;SOLR-10778&lt;/del&gt;&lt;/a&gt; about how to approach this in general rather than have to debate one-by-one. It&apos;s a sub-task &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14474&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-14474&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let&apos;s get some kind of sense of how to approach all this before having more rework requests.&lt;/p&gt;</comment>
                            <comment id="17106536" author="mdrob" created="Wed, 13 May 2020 18:04:07 +0000"  >&lt;p&gt;I didn&apos;t back port yet because there wasn&apos;t consensus yet that this was the right approach. I&apos;ll defer to you on what we should do Erick, you&apos;re thinking about this much more than I am at the moment and I trust that your head is in the right space.&lt;/p&gt;</comment>
                            <comment id="17106605" author="erickerickson" created="Wed, 13 May 2020 19:23:58 +0000"  >&lt;p&gt;NP, besides backporting is a waste until there&apos;s agreement on the version in master...&lt;/p&gt;</comment>
                            <comment id="17106740" author="erickerickson" created="Wed, 13 May 2020 23:54:51 +0000"  >&lt;p&gt;I thought I&apos;d reopen this to address David&apos;s comments and&#160; resolve the backport question.&lt;/p&gt;</comment>
                            <comment id="17107452" author="houston" created="Thu, 14 May 2020 16:32:41 +0000"  >&lt;p&gt;I agree that the static inner classes is a good fix for the analytics contrib changes. Since those should only be used within the same files as the classes are defined, if my memory is correct.&lt;/p&gt;</comment>
                            <comment id="17119697" author="mdrob" created="Fri, 29 May 2020 15:16:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; - what&apos;s the state here? I&apos;m happy to follow your lead and move classes to top level, but I&apos;m not clear on what the consensus is.&lt;/p&gt;</comment>
                            <comment id="17120235" author="erickerickson" created="Sat, 30 May 2020 12:22:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; I fixed all the &quot;auxiliary class&quot; compile-time warnings in both Lucene and Solr, but I don&apos;t remember there being as many as you and Alan reported.&lt;/p&gt;

&lt;p&gt;What&apos;s the IntelliJ report magic? And can you run it again and see what what it spits out? Maybe it spits out the usages rather than definitions?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; could you run your &quot;quick grep&quot; over again and maybe attach the output to this JIRA? I can spot-check to see how well your grep agrees with compiler output.&lt;/p&gt;

&lt;p&gt;Depending on the results, maybe we can close this JIRA.&lt;/p&gt;</comment>
                            <comment id="17125840" author="erickerickson" created="Thu, 4 Jun 2020 11:19:46 +0000"  >&lt;p&gt;I believe all the package-private classes are now either static nested classes or in their own file and this issue won&apos;t happen again.&lt;/p&gt;

&lt;p&gt;Since nobody objected, I&apos;ll close it again. We can reopen if necessary.&lt;/p&gt;</comment>
                            <comment id="17535595" author="janhoy" created="Thu, 12 May 2022 00:26:45 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13271713">LUCENE-9077</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dyco:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>