<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:43:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12550] ConcurrentUpdateSolrClient doesn&apos;t respect timeouts for commits and optimize</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12550</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We&apos;re in a situation where we need to optimize some of our collections. These optimizations are done with waitSearcher=true as a simple throttling mechanism to prevent too many collections from being optimized at once.&lt;/p&gt;

&lt;p&gt;We&apos;re seeing these optimize commands return without error after 10 minutes but well before the end of the operation. Our Solr logs show errors with socketTimeout stack traces. Setting distribUpdateSoTimeout to a higher value has no effect.&lt;/p&gt;

&lt;p&gt;See the links section for my patch.&lt;/p&gt;

&lt;p&gt;It turns out that ConcurrentUpdateSolrClient delegates commit and optimize commands to a private HttpSolrClient but fails to pass along its builder&apos;s timeouts to that client.&lt;/p&gt;

&lt;p&gt;A patch is attached in the links section.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13171833">SOLR-12550</key>
            <summary>ConcurrentUpdateSolrClient doesn&apos;t respect timeouts for commits and optimize</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="marc.morissette">Marc Morissette</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Jul 2018 21:22:06 +0000</created>
                <updated>Wed, 8 Dec 2021 13:24:02 +0000</updated>
                            <resolved>Thu, 20 Feb 2020 12:57:57 +0000</resolved>
                                                    <fixVersion>8.5</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>SolrJ</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6000">1h 40m</timespent>
                                <comments>
                            <comment id="16542261" author="marc.morissette" created="Thu, 12 Jul 2018 22:21:49 +0000"  >&lt;p&gt;By the way, I have not investigated why the optimize() command returns without an error despite the fact that it did not complete normally. &lt;/p&gt;</comment>
                            <comment id="16542336" author="elyograg" created="Thu, 12 Jul 2018 23:51:59 +0000"  >&lt;p&gt;Without seeing exactly what code you&apos;ve written and what configuration options you have, it is difficult to determine whether this is a bug or a usage problem.  Can you provide those details?  We will also need to know the Solr version, and may need logs from the server.  Without the Solr version, we can&apos;t even start looking at source code.&lt;/p&gt;

&lt;p&gt;This should have been brought up on the mailing list or IRC channel before opening an issue in Jira.  If it turns out that it&apos;s actually a bug, then Jira is appropriate.&lt;/p&gt;

&lt;p&gt;Note:  ConcurrentUpdateSolrClient is not a good choice for production index updating.  It swallows all indexing errors, so your Solr server could be completely down and all document updates that you send will appear to your program to have succeeded.&lt;/p&gt;</comment>
                            <comment id="16542374" author="marc.morissette" created="Fri, 13 Jul 2018 00:43:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elyograg&quot; class=&quot;user-hover&quot; rel=&quot;elyograg&quot;&gt;elyograg&lt;/a&gt; I am going to assume you didn&apos;t see that a patch with a unit test is attached to this bug (It&apos;s in the links section. It looks Github has stopped adding comments when a new pull request is detected).&lt;/p&gt;

&lt;p&gt;Also, maybe I wasn&apos;t clear in my description but we don&apos;t use ConcurrentUpdateSolrClient in our client code. The issue is in SolrCloud itself where timeouts may occur in the ConcurrentUpdateSolrClient Solr uses to relay commit and optimize commands to its shards.&lt;/p&gt;</comment>
                            <comment id="16870859" author="rahul196452@gmail.com" created="Mon, 24 Jun 2019 06:57:55 +0000"  >&lt;p&gt;As discussed on the Solr user list, I found this issue on Solr 7.2.1.&#160;Providing&#160;a patch on 7.2 with GitHub pull request #740 as attached to this Jira with the appropriate description of and solution&#160;to the problem.&lt;br/&gt;
I tried the&#160;patch in pull request #417 as submitted by Marc&#160;but it won&apos;t work, reason being that&#160;the builder object which is used to instantiate a ConcurrentUpdateSolrClient itself doesn&apos;t contain the timeout values.&lt;/p&gt;</comment>
                            <comment id="17038966" author="bim" created="Tue, 18 Feb 2020 10:28:50 +0000"  >&lt;p&gt;Hi, I&apos;m under Solr 8.3 and the problem is still there, it&apos;s very inconvenient. This patch seems to be a good solution, why it isn&apos;t integrate yet ?&lt;/p&gt;</comment>
                            <comment id="17039009" author="mkhludnev" created="Tue, 18 Feb 2020 11:39:02 +0000"  >&lt;p&gt;I like #417. Are there any concerns with merging it?&lt;/p&gt;</comment>
                            <comment id="17039017" author="shalinmangar" created="Tue, 18 Feb 2020 11:51:06 +0000"  >&lt;p&gt;I added a review comment to #417. Other than that it looks good.&lt;/p&gt;</comment>
                            <comment id="17039158" author="bim" created="Tue, 18 Feb 2020 15:09:30 +0000"  >&lt;p&gt;I also added a comment to this PR.&lt;/p&gt;</comment>
                            <comment id="17040626" author="marc.morissette" created="Thu, 20 Feb 2020 04:57:50 +0000"  >&lt;p&gt;Thank you for your comments &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bim&quot; class=&quot;user-hover&quot; rel=&quot;bim&quot;&gt;bim&lt;/a&gt;&#160;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;.&#160;I have amended my pull request to address them.&lt;/p&gt;

&lt;p&gt;It has also been rebased and tested on a more recent pull of master.&lt;/p&gt;</comment>
                            <comment id="17040917" author="jira-bot" created="Thu, 20 Feb 2020 12:29:39 +0000"  >&lt;p&gt;Commit 051133c13f982e72aabf914350c65e3dd8aa961d in lucene-solr&apos;s branch refs/heads/master from Marc A. Morissette&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=051133c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=051133c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12550&quot; title=&quot;ConcurrentUpdateSolrClient doesn&amp;#39;t respect timeouts for commits and optimize&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12550&quot;&gt;&lt;del&gt;SOLR-12550&lt;/del&gt;&lt;/a&gt;: ConcurrentUpdateSolrClient doesn&apos;t respect timeouts for commits and optimize (#417)&lt;/p&gt;

&lt;p&gt;ConcurrentUpdateSolrClient now propagates its connection and read timeouts to the private HttpSolrClient used to commit and optimize.&lt;/p&gt;</comment>
                            <comment id="17040922" author="jira-bot" created="Thu, 20 Feb 2020 12:34:05 +0000"  >&lt;p&gt;Commit 2fdd3b02bb02a63c7a5d7eba6f14189b0193e31b in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2fdd3b0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2fdd3b0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12550&quot; title=&quot;ConcurrentUpdateSolrClient doesn&amp;#39;t respect timeouts for commits and optimize&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12550&quot;&gt;&lt;del&gt;SOLR-12550&lt;/del&gt;&lt;/a&gt;: Adding entry to CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="17040938" author="jira-bot" created="Thu, 20 Feb 2020 12:55:41 +0000"  >&lt;p&gt;Commit 8eb6b03d51c005448f0f046a20eed07039e14606 in lucene-solr&apos;s branch refs/heads/branch_8x from Marc A. Morissette&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8eb6b03&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8eb6b03&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12550&quot; title=&quot;ConcurrentUpdateSolrClient doesn&amp;#39;t respect timeouts for commits and optimize&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12550&quot;&gt;&lt;del&gt;SOLR-12550&lt;/del&gt;&lt;/a&gt;: ConcurrentUpdateSolrClient doesn&apos;t respect timeouts for commits and optimize (#417)&lt;/p&gt;

&lt;p&gt;ConcurrentUpdateSolrClient now propagates its connection and read timeouts to the private HttpSolrClient used to commit and optimize.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 051133c13f982e72aabf914350c65e3dd8aa961d)&lt;/p&gt;</comment>
                            <comment id="17040944" author="shalinmangar" created="Thu, 20 Feb 2020 12:57:57 +0000"  >&lt;p&gt;Thanks Marc and B&#233;r&#233;nice!&lt;/p&gt;</comment>
                            <comment id="17041084" author="bim" created="Thu, 20 Feb 2020 15:34:22 +0000"  >&lt;p&gt;Thanks to you guys!&lt;/p&gt;</comment>
                            <comment id="17041090" author="bim" created="Thu, 20 Feb 2020 15:44:54 +0000"  >&lt;p&gt;Is it possible to backport it on 8.3 please ?&lt;/p&gt;</comment>
                            <comment id="17041147" author="erickerickson" created="Thu, 20 Feb 2020 17:10:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bim&quot; class=&quot;user-hover&quot; rel=&quot;bim&quot;&gt;bim&lt;/a&gt; This change isn&apos;t critical enough to backport to a point release that&apos;s not even the current minor version.&lt;/p&gt;

&lt;p&gt;That said, the change to the code is trivial, just a couple of lines and a  test case.&lt;/p&gt;

&lt;p&gt;Your options are either upgrade to 8.5, which should be released over the next several weeks or apply the patch to the 8.3 code line yourself. This page can get you started on getting the code and compiling Solr, it&apos;s surprisingly easy: &lt;a href=&quot;https://cwiki.apache.org/confluence/display/solr/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/solr/HowToContribute&lt;/a&gt;. From there applying this patch should be straightforward.&lt;/p&gt;</comment>
                            <comment id="17041717" author="bim" created="Fri, 21 Feb 2020 09:56:24 +0000"  >&lt;p&gt;On Solr 7.x, timeouts weren&apos;t initiliazed by the ConcurrentUpdateSolrClient.Builder, but now, there is a default value to connection and socket timeout (15 and 120s). So update requests that takes longer than 2 minutes before didn&apos;t return a SocketTimeoutException and now, this exception is throw.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It can be blocker for projects that use Solr and have exceptions because of this behavior.&lt;/p&gt;</comment>
                            <comment id="17065658" author="romseygeek" created="Tue, 24 Mar 2020 12:45:42 +0000"  >&lt;p&gt;Bulk close for 8.5.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13157330">SOLR-12314</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13243094">SOLR-13605</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13232493">SOLR-13457</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vubr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>