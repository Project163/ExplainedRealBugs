<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:00:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16819] (nightly) HttpPartitionTest  broken regardless of seed</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16819</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;tt&gt;HttpPartitionTest&lt;/tt&gt; (which is a nightly test) has been failing 100% of the time on jenkins for the past month (2023-05-01 to 2023-05-25 at time of writting)&lt;/p&gt;

&lt;p&gt;Before that &#8211; we have no reported failures since 2022-07, which is weird because up to that point this test was always a bit flakey.&lt;/p&gt;

&lt;p&gt;Checking out older version of main from april and running &lt;tt&gt;./gradlew -p solr/core test -Ptests.nightly=true --tests HttpPartitionTest&lt;/tt&gt; show that this test definitely &lt;b&gt;should&lt;/b&gt; have failed a lot of nightly builds prior to 2023-05-01 ... so i&apos;m assuming we had some jenkins or gradle build glitch that prevented it from being run? (i didn&apos;t dig into this)&lt;/p&gt;

&lt;p&gt;picking an arbitrary commit point from a few months ago when i could confirm the test &lt;b&gt;did&lt;/b&gt; pass i then ran &lt;tt&gt;git bisect&lt;/tt&gt; and it identified 708524315bf64ed5dbcfd470c8fadd435c861f78 / &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10466&quot; title=&quot;setDefaultCollection should be deprecated in favor of SolrClientBuilder methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10466&quot;&gt;&lt;del&gt;SOLR-10466&lt;/del&gt;&lt;/a&gt; as the first bad commit (which is also the most recent commit to this file)&lt;/p&gt;


&lt;p&gt;(NOTE: this problem also seems to affect the subclass &lt;tt&gt;HttpPartitionWithTlogReplicasTest&lt;/tt&gt; which has also been failing 100% of the time for the past month)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13537703">SOLR-16819</key>
            <summary>(nightly) HttpPartitionTest  broken regardless of seed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 May 2023 18:23:52 +0000</created>
                <updated>Fri, 17 Oct 2025 20:05:05 +0000</updated>
                            <resolved>Fri, 26 May 2023 01:33:57 +0000</resolved>
                                                    <fixVersion>9.3</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17726349" author="hossman" created="Thu, 25 May 2023 18:29:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh&quot; class=&quot;user-hover&quot; rel=&quot;epugh&quot;&gt;epugh&lt;/a&gt; do you think you can take a look at this?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   &amp;gt;     java.lang.AssertionError: Doc with id=1 not found due to: Path not found: /id; rsp={doc=null} expected null, but was:&amp;lt;Path not found: /id&amp;gt;
   &amp;gt;         at __randomizedtesting.SeedInfo.seed([C9255B5C5820E99F:41716486F6DC8467]:0)
   &amp;gt;         at org.junit.Assert.fail(Assert.java:89)
   &amp;gt;         at org.junit.Assert.failNotNull(Assert.java:756)
   &amp;gt;         at org.junit.Assert.assertNull(Assert.java:738)
   &amp;gt;         at org.apache.solr.cloud.HttpPartitionTest.assertDocExists(HttpPartitionTest.java:585)
   &amp;gt;         at org.apache.solr.cloud.HttpPartitionTest.assertDocsExistInAllReplicas(HttpPartitionTest.java:528)
   &amp;gt;         at org.apache.solr.cloud.HttpPartitionTest.testRf3(HttpPartitionTest.java:387)
   &amp;gt;         at org.apache.solr.cloud.HttpPartitionTest.test(HttpPartitionTest.java:125)

...

ERROR: The following test(s) have failed:
  - org.apache.solr.cloud.HttpPartitionTest.test (:solr:core)
    Test output: /home/hossman/lucene/solr/solr/core/build/test-results/test/outputs/OUTPUT-org.apache.solr.cloud.HttpPartitionTest.txt
    Reproduce with: gradlew :solr:core:test --tests &quot;org.apache.solr.cloud.HttpPartitionTest.test&quot; -Ptests.jvms=5 &quot;-Ptests.jvmargs=-XX:TieredStopAtLevel=1 -XX:+UseParallelGC -XX:ActiveProcessorCount=1 -XX:ReservedCodeCacheSize=120m&quot; -Ptests.seed=C9255B5C5820E99F -Ptests.nightly=true -Ptests.file.encoding=UTF-8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ git bisect log 
# bad: [8c83faadfa37eaee318b583c03ec92e72659c235] SOLR-16811: fix echo and mapUniqueKeyOnly params at /update/json/docs. (#1656)
# good: [21bc46c43c94cc90589cc536ffc7518908e64240] SOLR-16573:SolrClientTestRule for EmbeddedSolrServer (#1218)
git bisect start &apos;8c83faadfa37eaee318b583c03ec92e72659c235&apos; &apos;21bc46c43c9&apos;
# bad: [dbab7359479cb9c90eb22fd5dbcf74d82afef601] SOLR-16601: Remove Deprecated Methods from SolrClients (#1496)
git bisect bad dbab7359479cb9c90eb22fd5dbcf74d82afef601
# good: [6f81d55c68fe53e9d4accdf05edebcc0af86b0dc] Update dependency org.bitbucket.b_c:jose4j to v0.9.3 (#1416)
git bisect good 6f81d55c68fe53e9d4accdf05edebcc0af86b0dc
# good: [a3374039860ab074fdd64a2f2c7a5eb49698da1b] SOLR-8803: Some doc changes.  More is needed for docker.
git bisect good a3374039860ab074fdd64a2f2c7a5eb49698da1b
# good: [e3ee0aeb2e70f25dc882ada79f378cb90395fc0e] SOLR-16708: Small formating fixes
git bisect good e3ee0aeb2e70f25dc882ada79f378cb90395fc0e
# bad: [a2f6565415663908163f9490856cf0fcfda88b41] Make fixes for release wizard
git bisect bad a2f6565415663908163f9490856cf0fcfda88b41
# bad: [708524315bf64ed5dbcfd470c8fadd435c861f78] SOLR-10466: setDefaultCollection should be deprecated in favor of SolrClientBuilder methods (#1256)
git bisect bad 708524315bf64ed5dbcfd470c8fadd435c861f78
# good: [d8f57f084d59f2e4b5a74dbe772d6af09a21dbb8] SOLR-16664: Add missing Thread.sleep
git bisect good d8f57f084d59f2e4b5a74dbe772d6af09a21dbb8
# good: [81fe0045aaa63b115808a8c3d87ce96dc7921e8b] SOLR-16697: Add API to install indices into specific shards (#1458)
git bisect good 81fe0045aaa63b115808a8c3d87ce96dc7921e8b
# first bad commit: [708524315bf64ed5dbcfd470c8fadd435c861f78] SOLR-10466: setDefaultCollection should be deprecated in favor of SolrClientBuilder methods (#1256)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17726351" author="epugh" created="Thu, 25 May 2023 18:32:41 +0000"  >&lt;p&gt;Just so I am clear...  your analysis is that something changed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10466&quot; title=&quot;setDefaultCollection should be deprecated in favor of SolrClientBuilder methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10466&quot;&gt;&lt;del&gt;SOLR-10466&lt;/del&gt;&lt;/a&gt; that is causeing it to die?  I can definitly look, though I&apos;ve struggled in the past with grokking these complex tests &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17726354" author="hossman" created="Thu, 25 May 2023 18:44:09 +0000"  >&lt;p&gt;correct.&lt;/p&gt;

&lt;p&gt;if you &lt;tt&gt;`git co 708524315bf64ed5dbcfd470c8fadd435c861f78`&lt;/tt&gt; then the test fails&lt;/p&gt;

&lt;p&gt;if you &lt;tt&gt;`git co 708524315bf64ed5dbcfd470c8fadd435c861f78~1`&lt;/tt&gt; (the previous commit) then the test passes.&lt;/p&gt;</comment>
                            <comment id="17726411" author="hossman" created="Thu, 25 May 2023 22:47:51 +0000"  >&lt;p&gt;i think i understand what happened here ... working on a patch to test my hypothosis.&lt;/p&gt;</comment>
                            <comment id="17726415" author="hossman" created="Thu, 25 May 2023 23:15:37 +0000"  >&lt;p&gt;Most of the changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10466&quot; title=&quot;setDefaultCollection should be deprecated in favor of SolrClientBuilder methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10466&quot;&gt;&lt;del&gt;SOLR-10466&lt;/del&gt;&lt;/a&gt; look like this...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-      cloudClient.setDefaultCollection(testCollectionName);
 
-      sendDoc(1);
+      sendDoc(testCollectionName, 1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which made this change stick out like a sore thumb...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-    cloudClient.setDefaultCollection(testCollectionName);
-
     sendDoc(1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attached patch adresses this, removing the one arg &lt;tt&gt;sendDoc(int)&lt;/tt&gt; to ensure nobody ever makes that mistake in any future test edits.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;FWIW: the section of the test that fails is gated like this...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (TEST_NIGHTLY) {
      &lt;span class=&quot;code-comment&quot;&gt;// each time
&lt;/span&gt;      testRf3();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...i&apos;m guessing that when you were &quot;...currently working on making sure the nightly tests pass...&quot; you did something like this...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; -Ptests.filter=&apos;@Nightly&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...to beast the nightlies while ignoring the other tests you had already fixed.  But that only ensures that tests with the &amp;#64;Nightly annotation get run &amp;#8211; it doesn&apos;t impact things like &lt;tt&gt;TEST_NIGHTLY&lt;/tt&gt; or &lt;tt&gt;TEST_MULTIPLER&lt;/tt&gt; the way &lt;tt&gt;-Ptests.nightly=true&lt;/tt&gt; does.&lt;/p&gt;

&lt;p&gt;So you probably saw failures from other lines in the test, fixed those, and not noticed that these lines also needed fixed because they wouldn&apos;t have caused failures w/o &lt;tt&gt;-Ptests.nightly=true&lt;/tt&gt; being explicitly set.&lt;/p&gt;</comment>
                            <comment id="17726427" author="epugh" created="Fri, 26 May 2023 00:12:05 +0000"  >&lt;p&gt;That totally makes sense....    It was something that I definitly wrestled with for a long time, before finally just rewriting all the tests to take a collectionName, though of course, that was the more error-prone way...  and you spotted a goof!&lt;/p&gt;

&lt;p&gt;Your patch totally makes sense to me.  Thanks for digging into this.   &lt;/p&gt;</comment>
                            <comment id="17726432" author="jira-bot" created="Fri, 26 May 2023 00:30:48 +0000"  >&lt;p&gt;Commit 358d01d3354e2489d8399f800b2cc1a6d156ae50 in solr&apos;s branch refs/heads/main from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=358d01d3354&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=358d01d3354&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16819&quot; title=&quot;(nightly) HttpPartitionTest  broken regardless of seed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16819&quot;&gt;&lt;del&gt;SOLR-16819&lt;/del&gt;&lt;/a&gt;: Fix HttpPartitionTest&lt;/p&gt;

&lt;p&gt;Completes partial changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10466&quot; title=&quot;setDefaultCollection should be deprecated in favor of SolrClientBuilder methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10466&quot;&gt;&lt;del&gt;SOLR-10466&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17726440" author="jira-bot" created="Fri, 26 May 2023 01:32:32 +0000"  >&lt;p&gt;Commit bfc1f17063f9cdc786e594269acabccc18a480f2 in solr&apos;s branch refs/heads/branch_9x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=bfc1f17063f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=bfc1f17063f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16819&quot; title=&quot;(nightly) HttpPartitionTest  broken regardless of seed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16819&quot;&gt;&lt;del&gt;SOLR-16819&lt;/del&gt;&lt;/a&gt;: Fix HttpPartitionTest&lt;/p&gt;

&lt;p&gt;Completes partial changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10466&quot; title=&quot;setDefaultCollection should be deprecated in favor of SolrClientBuilder methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10466&quot;&gt;&lt;del&gt;SOLR-10466&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 358d01d3354e2489d8399f800b2cc1a6d156ae50)&lt;/p&gt;</comment>
                            <comment id="17745756" author="houston" created="Fri, 21 Jul 2023 20:40:35 +0000"  >&lt;p&gt;Closing after the 9.3.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13062500">SOLR-10466</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13058562" name="SOLR-16819.patch" size="1436" author="hossman" created="Thu, 25 May 2023 23:15:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1i5eg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>