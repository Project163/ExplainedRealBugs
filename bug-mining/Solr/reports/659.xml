<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:22:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2538] Math overflow in LongRangeEndpointCalculator and DoubleRangeEndpointCalculator </title>
                <link>https://issues.apache.org/jira/browse/SOLR-2538</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In the classes LongRangeEndpointCalculator and DoubleRangeEndpointCalculator, in the method &quot;parseAndAddGap&quot;, there is a loss of precision:&lt;/p&gt;

&lt;p&gt;1318  private static class DoubleRangeEndpointCalculator&lt;br/&gt;
1319	    extends RangeEndpointCalculator {&lt;br/&gt;
1320	 &lt;br/&gt;
1321	    public DoubleRangeEndpointCalculator(final SchemaField f) &lt;/p&gt;
{ super(f); }&lt;br/&gt;
1322	    @Override&lt;br/&gt;
1323	    protected Double parseVal(String rawval) {
1324	      return Double.valueOf(rawval);
1325	    }&lt;br/&gt;
1326	    @Override&lt;br/&gt;
1327	    public Double parseAndAddGap(Double value, String gap) {
1328 ---&amp;gt;      return new Double(value.floatValue() + Double.valueOf(gap).floatValue()); &amp;lt;------
1329	    }&lt;br/&gt;
1330	&lt;br/&gt;
&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;..&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;br/&gt;
1344	  private static class LongRangeEndpointCalculator&lt;br/&gt;
1345	    extends RangeEndpointCalculator {&lt;br/&gt;
1346	 &lt;br/&gt;
1347	    public LongRangeEndpointCalculator(final SchemaField f) { super(f); }
&lt;p&gt;1348	    @Override&lt;br/&gt;
1349	    protected Long parseVal(String rawval) &lt;/p&gt;
{
1350	      return Long.valueOf(rawval);
1351	    }
&lt;p&gt;1352	    @Override&lt;br/&gt;
1353	    public Long parseAndAddGap(Long value, String gap) &lt;/p&gt;
{
1354 ----&amp;gt;     return new Long(value.intValue() + Long.valueOf(gap).intValue()); &amp;lt;-------
1355	    }
&lt;p&gt;1356	  }&lt;/p&gt;

&lt;p&gt;As result, the following code is detecting a data overflow because the long number is being treated as an integer:&lt;/p&gt;

&lt;p&gt;1068	    while (low.compareTo(end) &amp;lt; 0) {&lt;br/&gt;
1069	      T high = calc.addGap(low, gap);&lt;br/&gt;
1070	      if (end.compareTo(high) &amp;lt; 0) {&lt;br/&gt;
1071	        if (params.getFieldBool(f,FacetParams.FACET_RANGE_HARD_END,false)) &lt;/p&gt;
{
1072	          high = end;
1073	        }
&lt;p&gt; else &lt;/p&gt;
{
1074	          end = high;
1075	        }
&lt;p&gt;1076	      }&lt;br/&gt;
1077	      if (high.compareTo(low) &amp;lt; 0) &lt;/p&gt;
{
1078	        throw new SolrException
1079	          (SolrException.ErrorCode.BAD_REQUEST,
1080	           &quot;range facet infinite loop (is gap negative? did the math overflow?)&quot;);
1081	      }
&lt;p&gt;1082	       &lt;/p&gt;

&lt;p&gt;Changing the &apos;intValue()&apos; by a &apos;longValue()&apos; and  the &apos;floatValue()&apos; by &apos;doubleValue()&apos; should work. We have detected this bug when faceting a very long start and end values. We have tested edge values (the transition from 32 to 64 bits) and any value below the threshold works fine. Any value greater than 2^32 doesn&apos;t work. We have not tested the &apos;double&apos; version, but seems that can suffer from the same problem.&lt;/p&gt;</description>
                <environment>&lt;p&gt;AMD64+Ubuntu 10.10&lt;/p&gt;</environment>
        <key id="12508073">SOLR-2538</key>
            <summary>Math overflow in LongRangeEndpointCalculator and DoubleRangeEndpointCalculator </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="erbihanka">Erbi Hanka</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 May 2011 15:49:50 +0000</created>
                <updated>Fri, 16 Sep 2011 14:48:54 +0000</updated>
                            <resolved>Thu, 7 Jul 2011 20:26:04 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.4</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13061568" author="hossman" created="Thu, 7 Jul 2011 20:26:04 +0000"  >&lt;p&gt;Erbi: thanks for catching this.  looks like a cut/paste error, but i went ahead and added a test to reduce the risk of future regression.&lt;/p&gt;

&lt;p&gt;Committed revision 1144014. - trunk&lt;br/&gt;
Committed revision 1144016. - 3x&lt;/p&gt;</comment>
                            <comment id="13106226" author="rcmuir" created="Fri, 16 Sep 2011 14:48:54 +0000"  >&lt;p&gt;bulk close for 3.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5002</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03k5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18698</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>