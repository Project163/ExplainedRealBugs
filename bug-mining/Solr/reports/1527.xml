<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:39:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3852] Admin UI - Cloud Tree ArrayIndexOutOfBoundsException if binary files anywhere in ZK tree</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3852</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Original bug description indicated that when using Solr with embedded ZK everything was fine, but with an external ZK you&apos;d get an ArrayIndexOutOfBoundsException.&lt;/p&gt;

&lt;p&gt;Crux of the problem is some bad assumptions about any ZK node containing data &amp;#8211; the ZookeeperInfoServlet powering the tree view of the Cloud Admin UI assumed that any data would be utf8 text.&lt;/p&gt;

&lt;p&gt;If you are using extenral ZK, and other systems are writing data into ZK, then you are more likely to see this problem, because those other systems might be writing binary data in to ZK nodes &amp;#8211; if you are using ZK embedded in solr, or using solr with it&apos;s own private (external) ZK instance, then you would only see this problem if you explicitly put binary files into solr configs and upconfig them into ZK.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;One workarround for people encountering this problem when using Solr with a ZK instance shared by other tools is to make sure you use a &quot;chroot&quot; patch when pointing Solr at ZK, so that it won&apos;t know about any other paths in your ZK tree that might have binary data...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wiki.apache.org/solr/SolrCloud#Zookeeper_chroot&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/SolrCloud#Zookeeper_chroot&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you are having this problem because you put binay files into your own config dir (ie: images for velocity or something like that) then there is no straight forward workarround.&lt;/p&gt;

&lt;p&gt;Example stack trace for this bug...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;43242 [qtp965223859-14] WARN  org.eclipse.jetty.servlet.ServletHandler /solr/zookeeper
java.lang.ArrayIndexOutOfBoundsException: 213
        at org.apache.lucene.util.UnicodeUtil.UTF8toUTF16(UnicodeUtil.java:620)
        at org.apache.lucene.util.BytesRef.utf8ToString(BytesRef.java:168)
        at org.apache.solr.servlet.ZookeeperInfoServlet$ZKPrinter.printTree(ZookeeperInfoServlet.java:303)
        at org.apache.solr.servlet.ZookeeperInfoServlet$ZKPrinter.printTree(ZookeeperInfoServlet.java:339)
        at org.apache.solr.servlet.ZookeeperInfoServlet$ZKPrinter.printTree(ZookeeperInfoServlet.java:339)
...
org.apache.solr.servlet.ZookeeperInfoServlet$ZKPrinter.print(ZookeeperInfoServlet.java:228)
        at org.apache.solr.servlet.ZookeeperInfoServlet.doGet(ZookeeperInfoServlet.java:106)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Tomcat 6, external zookeeper-3.3.5 &lt;/p&gt;</environment>
        <key id="12608210">SOLR-3852</key>
            <summary>Admin UI - Cloud Tree ArrayIndexOutOfBoundsException if binary files anywhere in ZK tree</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="ldb">Vadim Kisselmann</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Sep 2012 08:46:52 +0000</created>
                <updated>Mon, 9 May 2016 18:45:13 +0000</updated>
                            <resolved>Tue, 3 Sep 2013 18:13:59 +0000</resolved>
                                    <version>4.0-BETA</version>
                                    <fixVersion>4.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13458775" author="steffkes" created="Wed, 19 Sep 2012 15:57:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; would you mind having a look here? With the given response the UI is not able to display that Tree, that&apos;s pretty sure .. but no idea what causes the ArrayIndexOutOfBounds?&lt;/p&gt;</comment>
                            <comment id="13458800" author="markrmiller@gmail.com" created="Wed, 19 Sep 2012 16:18:18 +0000"  >&lt;p&gt;Woah - i got pinged in email because you mentioned my name - never saw that before. Cool.&lt;/p&gt;

&lt;p&gt;Yeah, I can take a look.&lt;/p&gt;</comment>
                            <comment id="13719193" author="shikhar" created="Thu, 25 Jul 2013 03:35:00 +0000"  >&lt;p&gt;We&apos;ve run into this. Was an ArrayIndexOutOfBoundsException arising out of: &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/4ce168a/solr/core/src/java/org/apache/solr/servlet/ZookeeperInfoServlet.java#L303&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/4ce168a/solr/core/src/java/org/apache/solr/servlet/ZookeeperInfoServlet.java#L303&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We have some znodes storing binary data but that bit above assumes that if a znode has data, it&apos;ll be a UTF-8 encoded string.&lt;/p&gt;

&lt;p&gt;That block doesn&apos;t actually do anything post-decode, so maybe it should just be removed.&lt;/p&gt;</comment>
                            <comment id="13755126" author="hossman" created="Fri, 30 Aug 2013 20:52:53 +0000"  >&lt;p&gt;This has popped up on the mailing list again recently, so i took a look...&lt;/p&gt;

&lt;p&gt;As Shikhar noted, the particular exception is happening in a bit of dead code which is easy enough to remove &amp;#8211; but that&apos;s only part of hte problem.&lt;/p&gt;

&lt;p&gt;the dead code is part of the tree walk of every ZK node that happens anytime you load the tree view page at all &amp;#8211; so having any non utf8 files anywhere in your ZK tree is going to cause that exception as soon as you try to look at the Solr ZK UI &amp;#8211; to reproduce just copy favicon.ico into your collection1/conf dir for example.&lt;/p&gt;

&lt;p&gt;but even if we purge that dead code, a similar bit of logic exists in the function for fetching the details about a node if someone clicks on it.&lt;/p&gt;

&lt;p&gt;Looking through the history of the file, it seems like this problem was introduced back in r1298010 when the code was switched to use BytesRef &amp;#8211; the existing logic to hex escape anything that wasn&apos;t in unicode wasn&apos;t preserved  &amp;#8211; but from what i can tell, i don&apos;t think that ever worked (catching UnsupportedEncodingException from &quot;new String(byte[],String)&quot; doesn&apos;t seem right there according to the docs) and i&apos;m not sure what use that would be anyway.&lt;/p&gt;

&lt;p&gt;In the attached patch, i purged the dead code, added some error handling around the remaining attempt to serialize the &quot;data&quot; of any node the user clicks on, and in the event that the data can&apos;t be converted to String add a new &quot;dataNote&quot; property explaining why &quot;data&quot; is empty (even though dataLengh is non zero)&lt;/p&gt;

&lt;p&gt;If no one sees any problems with this, i&apos;ll commit ASAP ... if we want to revist adding teh hex encoding output of bin conent we should probably hash that out in a new issue as an improvement, since i&apos;m not convinced it&apos;s a good idea to just blindly do that in the same &quot;data&quot; field of the response ... could confuse people.&lt;/p&gt;</comment>
                            <comment id="13755141" author="hossman" created="Fri, 30 Aug 2013 21:04:33 +0000"  >&lt;p&gt;updated description with some notes and workaround for common trigger of underlying problem.&lt;/p&gt;

&lt;p&gt;(thanks to joeo&apos;s comments on the solr mailing list for pointing out hte work arround)&lt;/p&gt;</comment>
                            <comment id="13756809" author="jira-bot" created="Tue, 3 Sep 2013 17:29:50 +0000"  >&lt;p&gt;Commit 1519763 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1519763&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1519763&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3852&quot; title=&quot;Admin UI - Cloud Tree ArrayIndexOutOfBoundsException if binary files anywhere in ZK tree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3852&quot;&gt;&lt;del&gt;SOLR-3852&lt;/del&gt;&lt;/a&gt;: Fixed ZookeeperInfoServlet so that the SolrCloud Admin UI pages will work even if ZK contains nodes with data which are not utf8 text&lt;/p&gt;</comment>
                            <comment id="13756855" author="jira-bot" created="Tue, 3 Sep 2013 18:13:24 +0000"  >&lt;p&gt;Commit 1519779 from hossman@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1519779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1519779&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3852&quot; title=&quot;Admin UI - Cloud Tree ArrayIndexOutOfBoundsException if binary files anywhere in ZK tree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3852&quot;&gt;&lt;del&gt;SOLR-3852&lt;/del&gt;&lt;/a&gt;: Fixed ZookeeperInfoServlet so that the SolrCloud Admin UI pages will work even if ZK contains nodes with data which are not utf8 text (merge r1519763)&lt;/p&gt;</comment>
                            <comment id="13787063" author="jpountz" created="Sat, 5 Oct 2013 10:19:01 +0000"  >&lt;p&gt;4.5 release -&amp;gt; bulk close&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12600854" name="SOLR-3852.patch" size="3443" author="hossman" created="Fri, 30 Aug 2013 20:52:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243143</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03c9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17420</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>