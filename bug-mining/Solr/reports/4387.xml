<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:42:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14025] CVE-2019-17558: Velocity response writer RCE vulnerability persists after 8.3.1</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14025</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gezapeti&quot; class=&quot;user-hover&quot; rel=&quot;gezapeti&quot;&gt;gezapeti&lt;/a&gt; from Cloudera kindly reported this to me:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Hi Ishan! I&#8217;d like to raise (yet an other) issue with SOLR-13971 and the Velocity templates. I&#8217;m working at Cloudera on Solr and have taken the time to test out whether the fix in 8.3.1 is sufficient to mitigate the issue. The sad thing is: It&#8217;s possible to upload a properties file into ZK and add the resource loaders in that file. I think we should add yet-an-other option to make the init-from-property file functionality off by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.

https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/apache/lucene-solr/blob/master/solr/contrib/velocity/src/java/org/apache/solr/response/VelocityResponseWriter.java#L73 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; property loads the file here https://github.com/apache/lucene-solr/blob/master/solr/contrib/velocity/src/java/org/apache/solr/response/VelocityResponseWriter.java#L141
&lt;/span&gt;solr/contrib/velocity/src/java/org/apache/solr/response/VelocityResponseWriter.java:73
&amp;lt;https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/apache/lucene-solr|apache/lucene-solr&amp;gt;apache/lucene-solr | Added by GitHub
&lt;/span&gt;solr/contrib/velocity/src/java/org/apache/solr/response/VelocityResponseWriter.java:141
&amp;lt;https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/apache/lucene-solr|apache/lucene-solr&amp;gt;apache/lucene-solr | Added by GitHub&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems like our mitigation wasn&apos;t good enough, there&apos;s another way to load resources.&lt;/p&gt;

&lt;p&gt;I&apos;ve requested him to follow procedure here (&lt;a href=&quot;https://cwiki.apache.org/confluence/display/solr/SolrSecurity&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/solr/SolrSecurity&lt;/a&gt;). Meanwhile, I opened this JIRA anyway.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13272752">SOLR-14025</key>
            <summary>CVE-2019-17558: Velocity response writer RCE vulnerability persists after 8.3.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ehatcher">Erik Hatcher</assignee>
                                    <reporter username="ichattopadhyaya">Ishan Chattopadhyaya</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Dec 2019 13:33:38 +0000</created>
                <updated>Wed, 19 Feb 2020 20:15:29 +0000</updated>
                            <resolved>Thu, 12 Dec 2019 05:35:35 +0000</resolved>
                                    <version>8.3.1</version>
                                    <fixVersion>7.7.3</fixVersion>
                    <fixVersion>8.4</fixVersion>
                                    <component>contrib - Velocity</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16989767" author="ichattopadhyaya" created="Fri, 6 Dec 2019 13:42:19 +0000"  >&lt;p&gt;Linking to earlier issue.&lt;/p&gt;</comment>
                            <comment id="16989772" author="ichattopadhyaya" created="Fri, 6 Dec 2019 13:46:33 +0000"  >&lt;p&gt;FYI, I haven&apos;t reproduced this, but if this can be reproduced, then we should remove velocity or at least remove from _default configset ASAP and release 8.3.2 or 8.4. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir&quot; class=&quot;user-hover&quot; rel=&quot;rcmuir&quot;&gt;rcmuir&lt;/a&gt;,  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher&quot; class=&quot;user-hover&quot; rel=&quot;ehatcher&quot;&gt;ehatcher&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;,  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt;. WDYT?&lt;/p&gt;</comment>
                            <comment id="16989825" author="risdenk" created="Fri, 6 Dec 2019 14:38:16 +0000"  >&lt;p&gt;So I wouldn&apos;t be surprised if this works without ZK authentication and authorization ACLs. The config API and any other upload config set API is just a thin wrapper around interacting with ZK. If you have access to ZK, you can not only upload configs, but basically destroy the cluster.&lt;/p&gt;

&lt;p&gt;Either way according to the docs, the init.properties.file must be in a Solr owned directory. The report seems to indicate this file can be loaded from ZK?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;`init.properties.file`:: Specifies a properties file name which must exist in the Solr `conf/` directory (&lt;b&gt;not&lt;/b&gt; under a `velocity/` subdirectory) or root of a JAR file in a &amp;lt;lib&amp;gt;.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16989826" author="rcmuir" created="Fri, 6 Dec 2019 14:38:32 +0000"  >&lt;p&gt;The issue was reported privately so there is some time to take care properly. It would be great if, whatever gets done to the velocity scripting feature, also gets applied to the scripting update processor and the DIH scripting feature. Some of these scripting features have better defaults than others (eg. the scripting update processor refuses to work unless basic auth etc is enabled), that&apos;s a nice check. why don&apos;t the other uses of scripting do the same thing?&lt;/p&gt;

&lt;p&gt;These scripting features are immensely dangerous. Whatever happens should be consistent across all of them. It shouldn&apos;t just be whack-a-mole in response to the latest RCE.&lt;/p&gt;</comment>
                            <comment id="16990029" author="ichattopadhyaya" created="Fri, 6 Dec 2019 17:51:45 +0000"  >&lt;p&gt;i think:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;We should disable entire velocity, DIH, tika, SUP etc. components if configset is &quot;untrusted&quot; (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6736&quot; title=&quot;A collections-like request handler to manage solr configurations on zookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6736&quot;&gt;&lt;del&gt;SOLR-6736&lt;/del&gt;&lt;/a&gt; only stops known-to-be-vulnerable-at-the-time functionality, like DIH ScriptTransformer, etc. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6736?focusedCommentId=15941684&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-15941684&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-6736?focusedCommentId=15941684&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-15941684&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Remove velocity, DIH etc. from default configset (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13978&quot; title=&quot;Remove bloat from default configset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13978&quot;&gt;&lt;del&gt;SOLR-13978&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;Remove the ability to load startup params in velocity from that properties file in ZK (and do the same for other components who are doing something similar)&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16990041" author="rcmuir" created="Fri, 6 Dec 2019 18:02:58 +0000"  >&lt;p&gt;sounds good to me. we can also open JIRAs to wrap sandboxing around the two other risky places doing scripting, I will help with those. &lt;/p&gt;

&lt;p&gt;i agree with you that tika is also dangerous due to the nature of what it must do, but would rather not burn the time to sandbox it in solr if time would be better changing the tika integration to use their server (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7633&quot; title=&quot;Change the ExtractingRequestHandler to use Tika-Server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7633&quot;&gt;&lt;del&gt;SOLR-7633&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="16990161" author="janhoy" created="Fri, 6 Dec 2019 20:52:21 +0000"  >&lt;p&gt;Thanks for investigating Ishan. The first we should do is determine how to respond. As I understand it, this attack requires that 1) Solr is directly exposed to untrusted users and 2) the attacker has write access either to Solr&apos;s file system, to Zookeeper API or to to Solr&apos;s Configset API and 3) that Velocity contrib is installed on the system and 4) that Velocity handler is configured for a collection or the attacker has access to enable that handler.&lt;/p&gt;

&lt;p&gt;Even if it is hard to exploit, that property file &lt;b&gt;must&lt;/b&gt; be disabled, and 8.4 seems like a good target for a fix given it is not public. +1 also to Robert&apos;s script sandboxing.&lt;/p&gt;</comment>
                            <comment id="16991406" author="janhoy" created="Mon, 9 Dec 2019 09:25:29 +0000"  >&lt;p&gt;Ping, 8.4 branch cut on thursday, is there a patch for the init.properties loading? Can the whole init.properties feature be removed or is it in code we don&apos;t control?&lt;/p&gt;</comment>
                            <comment id="16991466" author="ichattopadhyaya" created="Mon, 9 Dec 2019 10:09:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Ping, 8.4 branch cut on thursday, is there a patch for the init.properties loading?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Bugs can be fixed even after branch cut, no need to rush into this one by Thursday.&lt;/p&gt;

&lt;p&gt;Erik privately shared a scary way to attack velocity in another way. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; and I are discussing about it offline, and seems like it needs to be addressed together with this. I&apos;ll open a private JIRA issue for that soon.&lt;/p&gt;</comment>
                            <comment id="16991676" author="ichattopadhyaya" created="Mon, 9 Dec 2019 15:02:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Erik privately shared a scary way to attack velocity in another way. Noble Paul and I are discussing about it offline, and seems like it needs to be addressed together with this. I&apos;ll open a private JIRA issue for that soon.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Seems like there was a mistake in the steps to reproduce it, and is no longer an issue. So, please ignore my comment here ^&lt;br/&gt;
FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ehatcher&quot; class=&quot;user-hover&quot; rel=&quot;ehatcher&quot;&gt;ehatcher&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16991751" author="ehatcher" created="Mon, 9 Dec 2019 16:35:23 +0000"  >&lt;p&gt;Hi - I&apos;m trying to take my time to thoroughly research the possibilities here.&#160;&#160; While the Velocity init properties is a way to affect the resource loaders, the vulnerable ones (SolrParamResourceLoader and SolrVelocityResourceLoader) must be constructed with a single-arg constructor requiring request context.&#160;&#160; I don&apos;t see how we can exploit the init properties facility to enable these particular resource loaders.&lt;/p&gt;

&lt;p&gt;Perhaps I&apos;m missing a conduit though?&#160;&#160; Can some details be provided that show how this could work (with Solr 8.3.1&apos;s disabling by system property)?&lt;/p&gt;</comment>
                            <comment id="16991757" author="ichattopadhyaya" created="Mon, 9 Dec 2019 16:39:38 +0000"  >&lt;p&gt;Maybe you could check with Gezapeti on Slack or mail him on the private@ thread directly?&lt;/p&gt;</comment>
                            <comment id="16991869" author="ehatcher" created="Mon, 9 Dec 2019 19:27:31 +0000"  >&lt;p&gt;After chatting with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gezapeti&quot; class=&quot;user-hover&quot; rel=&quot;gezapeti&quot;&gt;gezapeti&lt;/a&gt; - my current assessment is that init properties won&apos;t expose the built-in resource loaders, but could enable Velocity&apos;s&#160; &lt;a href=&quot;https://velocity.apache.org/engine/2.0/apidocs/org/apache/velocity/runtime/resource/loader/URLResourceLoader.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://velocity.apache.org/engine/2.0/apidocs/org/apache/velocity/runtime/resource/loader/URLResourceLoader.html&lt;/a&gt;- which would make template rendering vulnerable to an outside template.&lt;/p&gt;</comment>
                            <comment id="16991871" author="ehatcher" created="Mon, 9 Dec 2019 19:33:33 +0000"  >&lt;p&gt;Current proposal: 1. leverage the `trusted` flag for a configset, and when a configset is not trusted, disable the params and solr resource loaders. 2. move the resource loader configuration after the init properties loading such that only our provided resource loaders can be configured, with untrusted ones not available (from step 1). &#160;&#160; 3. Set the Velocity introspection to use the&#160;&lt;a href=&quot;http://velocity.apache.org/engine/2.1/apidocs/org/apache/velocity/util/introspection/SecureUberspector.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SecureUberspector&lt;/a&gt; (such that it is not overridable by init properties either) 4. Remove SolrParamResourceLoader altogether (it&apos;s superfluous and not used in the real world, only for tests)&lt;br/&gt;
 &#160;&lt;/p&gt;</comment>
                            <comment id="16991997" author="ehatcher" created="Mon, 9 Dec 2019 22:31:39 +0000"  >&lt;p&gt;The attached patch adds the Velocity SecureUberspector and tests that it works.  It actually prevents both the outside_the_box and sandbox_intersection tests from working (without an exception, though without rendering anything either) so those tests were marked as ignored in this patch.   Patch also removes the params resource loader entirely.  Other items mentioned in numbered list above not tackled yet.&lt;/p&gt;</comment>
                            <comment id="16992041" author="rcmuir" created="Mon, 9 Dec 2019 23:50:55 +0000"  >&lt;p&gt;Hi Erik, thanks for integrating this velocity security feature. We should enable it, but I want to issue a warning that it is a little disappointing that it is implementing blacklisting instead of whitelisting.&lt;/p&gt;

&lt;p&gt;This is a big problem combined with the stuff that solr is passing into the velocity &quot;context&quot;.&lt;/p&gt;

&lt;p&gt;So e.g. even with this SecureUberspector, I can read the contents of any file on the system with something like this, just poking around and not even opening a beer yet:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$request.getCore().getResourceLoader().getLines(&quot;/etc/passwd&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If a security manager is enabled, it may stop tricks like this. But we don&apos;t have one yet, and in the meantime I am afraid once i get to objects like SolrCore and SolrResourceLoader, it is only a matter of time before i find the necessary &quot;gadgets&quot; to do something bad.&lt;/p&gt;

&lt;p&gt;Sorry to add more to the list, but I strongly recommend only passing in simple POJO to the velocity context, where we should assume user can invoke any method on them.&lt;/p&gt;

&lt;p&gt;In the meantime is it possible to fix the currently failing unit test in the patch? Hopefully it fails for everyone and not just on my system. Then I can play with it easier:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; [junit4] FAILURE 0.02s | VelocityResponseWriterTest.testCustomTools &amp;lt;&amp;lt;&amp;lt;
 [junit4] &amp;gt; Throwable #1: org.junit.ComparisonFailure: expected:&amp;lt;[]&amp;gt; but was:&amp;lt;[mytool.locale==response.star=]&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16992057" author="ehatcher" created="Tue, 10 Dec 2019 00:33:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir&quot; class=&quot;user-hover&quot; rel=&quot;rcmuir&quot;&gt;rcmuir&lt;/a&gt; A new patch attached.  I hope all tests now pass in your environment - if not let me know I&apos;ll dig.&lt;/p&gt;

&lt;p&gt;With this latest patch, it also implements the trusted mode, such that the Solr resource loader (where templates can come from the configset) is only enabled when the configset is trusted.&lt;/p&gt;

&lt;p&gt;Hopefully you can finish the beer now before breaking it again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - a template shouldn&apos;t be editable now, with the trusted configset flag being used.   This should mirror the power/control of the script update processor and script transformer, where they all have power but it shouldn&apos;t be leveragable without trusting a configset.&lt;/p&gt;</comment>
                            <comment id="16992059" author="ehatcher" created="Tue, 10 Dec 2019 00:37:33 +0000"  >&lt;p&gt;Also, in last patch the init properties should not affect the uberspector or the resource loader, as these are set after the properties are loaded.&lt;/p&gt;</comment>
                            <comment id="16992060" author="ehatcher" created="Tue, 10 Dec 2019 00:40:16 +0000"  >&lt;p&gt;I do agree that a POJO wrapper is safest here, however with the trusted flag we should be on par with at least the other capabilities in Solr that could be this powerful.   &lt;/p&gt;</comment>
                            <comment id="16992064" author="rcmuir" created="Tue, 10 Dec 2019 00:47:57 +0000"  >&lt;p&gt;Thank you for updating the patch! I will try it out. Yeah, maybe the POJO stuff should be a medium/long-term thing. I don&apos;t know the difficulty or even that much of everything going on here. But give me a sandbox, I&apos;ll escape it: and that&apos;s a pretty common skill for red-team folks to have. So I just want everyone to know that the velocity one is weak unless we clean up what objects we pass in the context, and the security manager one ain&apos;t ready for prime-time yet.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16992071" author="ehatcher" created="Tue, 10 Dec 2019 00:58:02 +0000"  >&lt;p&gt;The whitelist of the SecureUberspector is configurable, so we could add the resource loader to it, and any other generally known risky things.&lt;/p&gt;

&lt;p&gt;Note that the SecureUberspector is enabled on all template rendering, not just trusted ones.   This is in contrast to the other uses of trusted that make bad things possible.  Here, trusted decides whether configset provided templates are renderable, and when renderable they are still restricted in object usage.&lt;/p&gt;</comment>
                            <comment id="16992072" author="rcmuir" created="Tue, 10 Dec 2019 01:01:24 +0000"  >&lt;p&gt;It isn&apos;t a whitelist though, its a blacklist which is what makes me sad. So yeah, if request/response have dangerous methods like getSolrCore() on them that this thing shouldn&apos;t access, we can disable them.&lt;/p&gt;

&lt;p&gt;That&apos;s the source of my depression about the blacklist though, then in an unrelated commit someone adds a new method to these request/response classes and we have a new security issue introduced. An explicit POJO prevents that from creeping in.&lt;/p&gt;</comment>
                            <comment id="16992112" author="rcmuir" created="Tue, 10 Dec 2019 02:04:22 +0000"  >&lt;p&gt;The current blacklist is default values for the properties in velocity: &lt;a href=&quot;https://github.com/apache/velocity-engine/blob/2.0/velocity-engine-core/src/main/resources/org/apache/velocity/runtime/defaults/velocity.properties#L206-L232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/velocity-engine/blob/2.0/velocity-engine-core/src/main/resources/org/apache/velocity/runtime/defaults/velocity.properties#L206-L232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So is the &quot;velocityInitProps&quot; trusted? wherever it comes from? Because if its not trusted, it can basically neuter the SecureUberspector.&lt;/p&gt;

&lt;p&gt;I also think its a bit scary that the whole VelocityEngine is passed to the script via context as &lt;tt&gt;$engine&lt;/tt&gt; and I can invoke methods it directly. Not sure what I can do with that (maybe disable the uberspector and render another template that has my RCE payload?). Just more along the same lines of POJO stuff, we should be careful what we pass.&lt;/p&gt;</comment>
                            <comment id="16992117" author="rcmuir" created="Tue, 10 Dec 2019 02:13:47 +0000"  >&lt;p&gt;another idea is that it seems the uberspector can be a custom one. So we could implement our own impl that is whitelist-based instead of blacklist based. It is just an option/alternative to using POJO classes to keep it limited.&lt;/p&gt;</comment>
                            <comment id="16992175" author="ehatcher" created="Tue, 10 Dec 2019 04:28:49 +0000"  >&lt;p&gt;I&apos;ve tried to code a test to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rcmuir&quot; class=&quot;user-hover&quot; rel=&quot;rcmuir&quot;&gt;rcmuir&lt;/a&gt;&apos;s example, however that code produces an already safety valve exception:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.apache.velocity.exception.MethodInvocationException: Invocation of method &apos;getLines&apos; in class org.apache.solr.core.SolrResourceLoader threw exception java.io.IOException: File /etc/passwd is outside resource loader dir /Users/erikhatcher/dev/lucene-solr/idea-build/solr/contrib/solr-velocity/classes/test/velocity/solr/collection1; set -Dsolr.allow.unsafe.resourceloading=true to allow unsafe loading at outside_the_box.vm&lt;span class=&quot;error&quot;&gt;&amp;#91;line 4, column 41&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16992183" author="ehatcher" created="Tue, 10 Dec 2019 04:34:54 +0000"  >&lt;p&gt;This latest (3rd) patch changes init properties loading to only a trusted configset.&#160;&#160; Also the SecureUberspector was modified to include SolrResourceLoader in the blacklist (perhaps unnecessarily, given it has its own protections on what it can load).&lt;/p&gt;</comment>
                            <comment id="16992210" author="rcmuir" created="Tue, 10 Dec 2019 05:45:16 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I&apos;ve tried to code a test to Robert Muir&apos;s example, however that code produces an already safety valve exception&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed, but its not good that the exception is different depending on whether or not the file exists: Seems like SolrResourceLoader does the check too late in the game?&lt;/p&gt;

&lt;p&gt;Also i don&apos;t think the SolrResourceLoader protection is really that useful. Its not hard for me to read your password file another way instead. I am sure there are more.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#set($solrHome=$request.getCore().getResourceLoader().locateSolrHome())
#set($passwdFile=$solrHome.resolve(&quot;/etc/passwd&quot;))
#set($filesystem=$passwdFile.getFileSystem())
#set($provider=$filesystem.provider())
$provider.newInputStream($passwdFile)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16992672" author="ehatcher" created="Tue, 10 Dec 2019 15:45:59 +0000"  >&lt;p&gt;Latest (4th) patch adds SolrResourceLoader to blacklist.&#160;&#160; I did a review of the objects in the context and nothing else dramatic stands out.&#160; I can&apos;t wait to see the next loophole in the object navigation though!&lt;/p&gt;

&lt;p&gt;I&apos;ve also made custom tool loading require a trusted configset.&#160; This didn&apos;t really matter since one can&apos;t render provided templates in an untrusted scenario, but maybe some risk of a custom tool defined that overrode usage of an object in a builtin trusted template.&lt;/p&gt;</comment>
                            <comment id="16992686" author="rcmuir" created="Tue, 10 Dec 2019 15:57:40 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#set($anyOldPath=$request.getCore().getCoreContainer().getCoreRootDirectory())
#set($passwdFile=$anyOldPath.resolve(&quot;/etc/passwd&quot;))
#set($filesystem=$passwdFile.getFileSystem())
#set($provider=$filesystem.provider())
$provider.newInputStream($passwdFile)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16992699" author="ehatcher" created="Tue, 10 Dec 2019 16:14:23 +0000"  >&lt;p&gt;Nice one.&#160; Wack-a-mole.&#160; Definitely got me convinced on the POJO.&lt;/p&gt;

&lt;p&gt;Do note, dear reader, that the examples provided here do require a trusted configset (given the latest patch here) and thus require a user craft a configuration and with authentication provide it as a configset.&lt;/p&gt;</comment>
                            <comment id="16992717" author="ehatcher" created="Tue, 10 Dec 2019 16:30:51 +0000"  >&lt;p&gt;I&apos;d add `SolrCore` to the blacklist, except it is used to get the core name and necessary in the /browse templates.&#160;&#160; That can be worked around just for the core name, of course.&#160;&lt;/p&gt;</comment>
                            <comment id="16993679" author="ehatcher" created="Wed, 11 Dec 2019 16:19:16 +0000"  >&lt;p&gt;Latest (5th) patch updates the writer documentation and adds CoreContainer to the blacklist.&#160;&lt;/p&gt;</comment>
                            <comment id="16993781" author="ehatcher" created="Wed, 11 Dec 2019 18:05:19 +0000"  >&lt;p&gt;Committed to master: &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;a=commit;h=128360856d50d7b39473644e6c1c21ba11766195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;a=commit;h=128360856d50d7b39473644e6c1c21ba11766195&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;branch_8x: &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;a=commit;h=9dfee35b9facbcbc9342d8bbbe52667cb6d1dced&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;a=commit;h=9dfee35b9facbcbc9342d8bbbe52667cb6d1dced&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16994235" author="ichattopadhyaya" created="Thu, 12 Dec 2019 05:35:35 +0000"  >&lt;p&gt;Thanks Gezapeti, Erik, Kevin, Robert!&lt;/p&gt;</comment>
                            <comment id="17005011" author="jpountz" created="Sun, 29 Dec 2019 20:51:30 +0000"  >&lt;p&gt;Closing after the 8.4.0 release.&lt;/p&gt;</comment>
                            <comment id="17014352" author="jira-bot" created="Mon, 13 Jan 2020 14:13:35 +0000"  >&lt;p&gt;Commit 1b21ba78ba3198ea7829e551eb2194ceccba3592 in lucene-solr&apos;s branch refs/heads/branch_7_7 from Ishan Chattopadhyaya&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=1b21ba7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=1b21ba7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14025&quot; title=&quot;CVE-2019-17558: Velocity response writer RCE vulnerability persists after 8.3.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14025&quot;&gt;&lt;del&gt;SOLR-14025&lt;/del&gt;&lt;/a&gt;: VelocityResponseWriter has been hardened&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13270753">SOLR-13971</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12988563" name="SOLR-14025.patch" size="35158" author="ehatcher" created="Wed, 11 Dec 2019 16:18:27 +0000"/>
                            <attachment id="12988442" name="SOLR-14025.patch" size="35048" author="ehatcher" created="Tue, 10 Dec 2019 15:42:07 +0000"/>
                            <attachment id="12988387" name="SOLR-14025.patch" size="28563" author="ehatcher" created="Tue, 10 Dec 2019 04:33:16 +0000"/>
                            <attachment id="12988377" name="SOLR-14025.patch" size="23998" author="ehatcher" created="Tue, 10 Dec 2019 00:27:24 +0000"/>
                            <attachment id="12988373" name="SOLR-14025.patch" size="20367" author="ehatcher" created="Mon, 9 Dec 2019 22:28:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09dfk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>