<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7765] TokenizerChain methods may return null depending on how constructor is called -- causes NPE in luke request handler</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7765</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;tt&gt;TokenizerChain&lt;/tt&gt; created using 2-arg constructor has &lt;tt&gt;null&lt;/tt&gt; in &lt;tt&gt;charFilters&lt;/tt&gt;, so &lt;tt&gt;LukeRequestHandler&lt;/tt&gt; throws NPE on iterating it.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;TokenizerChain&lt;/tt&gt; constructor&apos;s should be hardened to do explicit null checks, throwing early NPE where appropriate (tokenizer factory), or initializing internal arrays to have 0 length when optional (factories for char filters and token filters)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12843564">SOLR-7765</key>
            <summary>TokenizerChain methods may return null depending on how constructor is called -- causes NPE in luke request handler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="grossws">Konstantin Gribov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jul 2015 16:44:20 +0000</created>
                <updated>Mon, 9 May 2016 18:54:27 +0000</updated>
                            <resolved>Tue, 21 Jul 2015 17:31:03 +0000</resolved>
                                    <version>5.2.1</version>
                                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14618905" author="githubbot" created="Wed, 8 Jul 2015 16:46:15 +0000"  >&lt;p&gt;GitHub user grossws opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/185&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fix NPE in LukeRequestHandler in getAnalyzerInfo&lt;/p&gt;

&lt;p&gt;    NPE in thrown when luke tries to iterate `TokenizerChain#getCharFilterFactories()`&lt;br/&gt;
    which is null if 2-arg `TokenizerChain` constructor is used.&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7765&quot; title=&quot;TokenizerChain methods may return null depending on how constructor is called -- causes NPE in luke request handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7765&quot;&gt;&lt;del&gt;SOLR-7765&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/grossws/lucene-solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/grossws/lucene-solr&lt;/a&gt; fix-solr-7765&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/185.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/185.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #185&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7a0f08915e73f0ef28d4b9af8bd613612ca39946&lt;br/&gt;
Author: Konstantin Gribov &amp;lt;grossws@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-07-08T16:30:04Z&lt;/p&gt;

&lt;p&gt;    Fix NPE in LukeRequestHandler in getAnalyzerInfo&lt;/p&gt;

&lt;p&gt;    NPE in thrown when luke tries to iterate `TokenizerChain#getCharFilterFactories()`&lt;br/&gt;
    which is null if 2-arg `TokenizerChain` constructor is used.&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7765&quot; title=&quot;TokenizerChain methods may return null depending on how constructor is called -- causes NPE in luke request handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7765&quot;&gt;&lt;del&gt;SOLR-7765&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14627321" author="hossman" created="Wed, 15 Jul 2015 00:13:00 +0000"  >&lt;p&gt;Konstantin: i tried to whip up a quick patch to demonstrate the bug you were fixing (we always like to have test cases to help minimize the chance of regression in bug fixes) but i couldn&apos;t reproduce the problem (ie: the test passed)&lt;/p&gt;

&lt;p&gt;can you please elaborate on the steps to reproduce in order to trigger an NPE in the Luke handler?&lt;/p&gt;</comment>
                            <comment id="14628046" author="grossws" created="Wed, 15 Jul 2015 13:26:16 +0000"  >&lt;p&gt;I am not familiar with lucene-solr test suite. It seems that &lt;tt&gt;TokenizerChain&lt;/tt&gt; was created standard way from schema (via &lt;tt&gt;FieldTypePluginLoader&lt;/tt&gt;, line 403@lucene_solr_5_2_1), so it was created with &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TokenizerChain(charFilters.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CharFilterFactory[charFilters.size()]), tokenizers.get(0), filters.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TokenFilterFactory[filters.size()]));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;which is three-arg constructor with non-null first argument (it will be empty array when &lt;tt&gt;charFilters&lt;/tt&gt; is empty).&lt;/p&gt;

&lt;p&gt;I&apos;ll add a test to my PR.&lt;/p&gt;</comment>
                            <comment id="14628258" author="grossws" created="Wed, 15 Jul 2015 15:51:00 +0000"  >&lt;p&gt;Updated PR with test case&lt;/p&gt;</comment>
                            <comment id="14634196" author="hossman" created="Mon, 20 Jul 2015 22:40:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll add a test to my PR.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;I missunderstood what you ment before, but with the testcase you provided it all makes sense.&lt;/p&gt;

&lt;p&gt;In my opinion, the root bug here is that TokenizerChain should be more explicit about what is allowed in it&apos;s construtor, and more resilient to null args when things are optional &amp;#8211; that way callers like LukeAdminHandler don&apos;t have to constantly do null checks.&lt;/p&gt;

&lt;p&gt;The attached path fixes what i consider the root of the bug and gets your test to pass w/o modifying LukeAdminHandler.  It also adds more randomization to your test to cover more permutations of options, and updates MultiTermTest to account for the improved behavior of getCharFilterFactories() (which you can see from looking at that test was annoying inconsistent before depending on what analyzer was used and where it came from)&lt;/p&gt;

&lt;p&gt;I&apos;m going to do a quick audit of all TokenizerChain clients to see where else null checks are currently be doing that can be optimized away with this fix and post an updated patch.&lt;/p&gt;
</comment>
                            <comment id="14634329" author="hossman" created="Tue, 21 Jul 2015 00:27:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m going to do a quick audit of all TokenizerChain clients to see where else null checks are currently be doing that can be optimized away with this fix and post an updated patch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;attached.&lt;/p&gt;</comment>
                            <comment id="14635043" author="grossws" created="Tue, 21 Jul 2015 12:44:37 +0000"  >&lt;p&gt;Fixing this in &lt;tt&gt;TokenizerChain&lt;/tt&gt; itself seems better to me. &lt;/p&gt;

&lt;p&gt;Is there any reason to use reversed order in ifs (like &lt;tt&gt;if (0 &amp;lt; cfiltfacs.length)&lt;/tt&gt;)? It looks quite strange since most of lucene &amp;amp; solr code use more usual &lt;tt&gt;if (var &amp;gt; 0)&lt;/tt&gt; style.&lt;/p&gt;</comment>
                            <comment id="14635385" author="jira-bot" created="Tue, 21 Jul 2015 16:49:39 +0000"  >&lt;p&gt;Commit 1692170 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1692170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1692170&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7765&quot; title=&quot;TokenizerChain methods may return null depending on how constructor is called -- causes NPE in luke request handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7765&quot;&gt;&lt;del&gt;SOLR-7765&lt;/del&gt;&lt;/a&gt;: Hardened the behavior of TokenizerChain when null arguments are used in constructor. This prevents NPEs in some code paths.&lt;/p&gt;</comment>
                            <comment id="14635438" author="jira-bot" created="Tue, 21 Jul 2015 17:20:34 +0000"  >&lt;p&gt;Commit 1692174 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1692174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1692174&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7765&quot; title=&quot;TokenizerChain methods may return null depending on how constructor is called -- causes NPE in luke request handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7765&quot;&gt;&lt;del&gt;SOLR-7765&lt;/del&gt;&lt;/a&gt;: Hardened the behavior of TokenizerChain when null arguments are used in constructor. This prevents NPEs in some code paths. (merge r1692170)&lt;/p&gt;</comment>
                            <comment id="14635444" author="hossman" created="Tue, 21 Jul 2015 17:31:03 +0000"  >&lt;p&gt;Thanks for rasiing this issue and helping out with the tests Konstantin,&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there any reason to use reversed order in ifs...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s just a defensive coding habbit i developed from doing a lot of C and perl coding in my early years as a developer ... trained my brain to default to putting constants on the left in comparisons in cause i misstype &quot;=&quot; instead of &quot;==&quot; or &quot;&amp;lt;=&quot; &lt;/p&gt;</comment>
                            <comment id="14637291" author="grossws" created="Wed, 22 Jul 2015 17:53:36 +0000"  >&lt;p&gt;I understand you point, I write in C time to time. My point is that it leads to inconsistency in code style without any profit (like eliminating error-prone constructs in C). It makes no sense in java, since for types other than boolean it will produce compile-time error (because type incompatibility) and for boolean ifs will look like &lt;tt&gt;if (val)&lt;/tt&gt; or &lt;tt&gt;if (!val)&lt;/tt&gt;. It seems that there&apos;s no place to make this types of error in java.&lt;/p&gt;</comment>
                            <comment id="14638830" author="githubbot" created="Thu, 23 Jul 2015 13:58:42 +0000"  >&lt;p&gt;Github user grossws closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/185&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14638840" author="githubbot" created="Thu, 23 Jul 2015 14:02:21 +0000"  >&lt;p&gt;Github user grossws commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/185#issuecomment-124117829&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/185#issuecomment-124117829&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fixed by @hossman in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7765&quot; title=&quot;TokenizerChain methods may return null depending on how constructor is called -- causes NPE in luke request handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7765&quot;&gt;&lt;del&gt;SOLR-7765&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14713206" author="shalinmangar" created="Wed, 26 Aug 2015 13:06:04 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12746229" name="SOLR-7765.patch" size="17308" author="hossman" created="Tue, 21 Jul 2015 00:27:20 +0000"/>
                            <attachment id="12746198" name="SOLR-7765.patch" size="9353" author="hossman" created="Mon, 20 Jul 2015 22:40:01 +0000"/>
                            <attachment id="12745357" name="SOLR-7765.patch" size="1082" author="hossman" created="Wed, 15 Jul 2015 00:13:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2h02v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>