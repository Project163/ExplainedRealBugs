<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:20:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10237] Poly-Fields should work with subfield that have docValues=true</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10237</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;DocValues aren&#8217;t really supported in poly-fields at this point, but they don&#8217;t complain if the schema definition of the subfield has docValues=true. This leaves the index in an inconsistent state, since the SchemaField has docValues=true but there are no DV for the field.&lt;br/&gt;
Since this breaks compatibility, I think we should just emit a warning unless the subfield is an instance of &lt;tt&gt;PointField&lt;/tt&gt;. With &lt;tt&gt;[Int/Long/Float/Double/Date]PointField&lt;/tt&gt; subfields, this is particularly important, since they use &lt;tt&gt;IndexOrDocValuesQuery&lt;/tt&gt;, that would return incorrect results.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13048728">SOLR-10237</key>
            <summary>Poly-Fields should work with subfield that have docValues=true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tflobbe">Tomas Eduardo Fernandez Lobbe</assignee>
                                    <reporter username="tflobbe">Tomas Eduardo Fernandez Lobbe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Mar 2017 02:07:26 +0000</created>
                <updated>Sat, 8 Jun 2019 15:31:58 +0000</updated>
                            <resolved>Fri, 17 Mar 2017 19:53:55 +0000</resolved>
                                                    <fixVersion>6.5</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15900120" author="dsmiley" created="Tue, 7 Mar 2017 20:46:52 +0000"  >&lt;p&gt;I&apos;m trying to understand the problem here.  &lt;tt&gt;solr.PointType&lt;/tt&gt; (an x,y generic spatial field) supports DocValues in its coordinate fields so they can be used in ValueSource/&quot;function queries&quot;; or am I wrong here?&lt;/p&gt;</comment>
                            <comment id="15900215" author="tomasflobbe" created="Tue, 7 Mar 2017 21:36:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;solr.PointType&lt;/tt&gt; (an x,y generic spatial field) supports DocValues in its coordinate fields so they can be used in ValueSource/&quot;function queries&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t believe it does. When a PointType field is created it calls &lt;tt&gt;SchemaField.createField(...)&lt;/tt&gt; on it coordinates, instead of &lt;tt&gt;SchemaField.createField*&lt;b&gt;s&lt;/b&gt;*(...)&lt;/tt&gt;. The first one of those only creates the &quot;Index field&quot;, and doesn&apos;t create the DocValues field:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;IndexableField&amp;gt; createFields(SchemaField field, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value, &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; boost) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; externalVal = value.toString();
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] point = parseCommaSeparatedList(externalVal, dimension);

    &lt;span class=&quot;code-comment&quot;&gt;// TODO: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; doesn&apos;t currently support polyFields as sub-field types
&lt;/span&gt;    List&amp;lt;IndexableField&amp;gt; f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(dimension+1);

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field.indexed()) {
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;dimension; i++) {
        SchemaField sf = subField(field, i, schema);
        f.add(sf.createField(point[i], sf.indexed() &amp;amp;&amp;amp; !sf.omitNorms() ? boost : 1f));
      }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field.stored()) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; storedVal = externalVal;  &lt;span class=&quot;code-comment&quot;&gt;// normalize or not?
&lt;/span&gt;      f.add(createField(field.getName(), storedVal, StoredField.TYPE, 1f));
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; f;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Another option is to start supporting DV in the coordinates by creating the DV fields when requested, they could be used as you said when ValueSource is needed, probably inheriting the configuration (docValues=true/false) from the PointType field?&lt;/p&gt;</comment>
                            <comment id="15900293" author="dsmiley" created="Tue, 7 Mar 2017 22:22:49 +0000"  >&lt;p&gt;Oh I see; thanks for the explanation.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another option is to start supporting DV in the coordinates by creating the DV fields when requested, they could be used as you said when ValueSource is needed, probably inheriting the configuration (docValues=true/false) from the PointType field?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this is the path forward.  Doing anything else is worse &amp;#8211; why &lt;em&gt;shouldn&apos;t&lt;/em&gt; we let users use DocValues for purposes that DocValues were created for?&lt;/p&gt;

&lt;p&gt;As a related aside... I&apos;m wondering if we may want to deprecate/remove the singular &lt;tt&gt;SchemaField.createField&lt;/tt&gt; and simply have all field types do their logic in one method &lt;tt&gt;createFields&lt;/tt&gt;.  Perhaps further, it might accept the Lucene &lt;tt&gt;Document&lt;/tt&gt; as a destination to thus avoid some needless &lt;tt&gt;Field[]&lt;/tt&gt; creation.  If you agree, the method might then be named &lt;tt&gt;addFieldsToDoc&lt;/tt&gt;.  I&apos;m bumping into this a bit as I contemplate a TextField that can optionally put it&apos;s stored value embedded in a separate (compressed) BinaryDocValuesField &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10117&quot; title=&quot;Big docs and the DocumentCache; umbrella issue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10117&quot;&gt;SOLR-10117&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15900464" author="tomasflobbe" created="Wed, 8 Mar 2017 00:35:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think this is the path forward.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;ll upload a patch shortly&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;m wondering if we may want to deprecate/remove the singular &lt;tt&gt;SchemaField.createField&lt;/tt&gt; and simply have all field types do their logic in one method &lt;tt&gt;createFields&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think that would make sense, at least the reason for which both were created separately is not being used:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  /**
   * If &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, then use {@link #createFields(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)}, &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; use {@link #createField} to save an extra allocation
   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; field is a poly field
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isPolyField(){
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type.isPolyField();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There are a couple of calls to &lt;tt&gt;createField(...)&lt;/tt&gt; that should be replaced though, I didn&apos;t look into them in detail.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Perhaps further, it might accept the Lucene &lt;tt&gt;Document&lt;/tt&gt; as a destination to thus avoid some needless &lt;tt&gt;Field[]&lt;/tt&gt; creation&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Maybe... I&apos;m not totally sold. I think there are valid use cases for wanting to modify the returned list before adding it to the &lt;tt&gt;Document&lt;/tt&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m bumping into this a bit as I contemplate a TextField that can optionally put it&apos;s stored value embedded in a separate (compressed) BinaryDocValuesField &#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10117&quot; title=&quot;Big docs and the DocumentCache; umbrella issue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10117&quot;&gt;SOLR-10117&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not sure I follow, how would this refactor help?&lt;/p&gt;</comment>
                            <comment id="15901444" author="dsmiley" created="Wed, 8 Mar 2017 15:39:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe... I&apos;m not totally sold. I think there are valid use cases for wanting to modify the returned list before adding it to the Document.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Remember Document is just a wrapper around an ArrayList.  A caller that wanted to manipulate the list could simply use a Document instance for a transient purpose; even re-using it by calling doc.clear().&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Not sure I follow, how would this refactor help?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s not a necessity.  &lt;/p&gt;</comment>
                            <comment id="15927227" author="tomasflobbe" created="Thu, 16 Mar 2017 00:08:32 +0000"  >&lt;p&gt;Here is the patch with DV supported. Unfortunately, due to the way poly-fields are implemented, docValues=&quot;true&quot; can&apos;t be configured in the &quot;field&quot; definition, it has to be configured in the field type, or in the subfields. This should be OK and compatible with that we have now. I modified the existing  UnsupportedOperationException to have a clearer message&lt;/p&gt;</comment>
                            <comment id="15927239" author="tomasflobbe" created="Thu, 16 Mar 2017 00:17:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;Remember Document is just a wrapper around an ArrayList...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, I know, but in that case the usage would be weird, something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Document doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Document();
type.addFieldsToDoc(doc);
doc.removeField(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Not too much of an issue anyway.&lt;/p&gt;</comment>
                            <comment id="15927312" author="dsmiley" created="Thu, 16 Mar 2017 01:55:50 +0000"  >&lt;p&gt;+1 to the patch&lt;/p&gt;</comment>
                            <comment id="15928656" author="dsmiley" created="Thu, 16 Mar 2017 19:03:29 +0000"  >&lt;p&gt;note: I&apos;m committing &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10286&quot; title=&quot;Declare a field as &amp;quot;large&amp;quot;, don&amp;#39;t keep value in the document cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10286&quot;&gt;&lt;del&gt;SOLR-10286&lt;/del&gt;&lt;/a&gt; as we speak which refactors out a FieldType.checkSupportsDocValues() method.  The patch here will be affected by that and need to override that instead of checkSchemaField().&lt;/p&gt;</comment>
                            <comment id="15930418" author="tomasflobbe" created="Fri, 17 Mar 2017 18:21:13 +0000"  >&lt;p&gt;Thanks for the heads up David, I moved the DV validation to &lt;tt&gt;checkSupportsDocValues&lt;/tt&gt;. Otherwise the same patch updated to master. &lt;/p&gt;</comment>
                            <comment id="15930437" author="dsmiley" created="Fri, 17 Mar 2017 18:31:19 +0000"  >&lt;p&gt;You mentioned in an email recently:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This is specially tricky since the users will get results, but will sometimes be incorrect&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So I&apos;m curious how you discovered the problem here and how, without it, results may be inconsistent.&lt;/p&gt;

&lt;p&gt;BTW commit away when you feel it&apos;s ready.&lt;/p&gt;</comment>
                            <comment id="15930482" author="tomasflobbe" created="Fri, 17 Mar 2017 18:51:29 +0000"  >&lt;p&gt;Results will be incorrect if &lt;tt&gt;IndexOrDocValuesQuery&lt;/tt&gt; decides to use the DocValues query. In my tests it would always return incorrect results because the DV query was always chosen (because there were no values in the DV field). The &quot;sometimes&quot; would happen in odd situations I guess, if someone has a field that has some documents with DV and some without (e.g. if we fix this in 6.6 and someone has an index built with 6.5 using point fields and upgrades without re-indexing).&lt;/p&gt;</comment>
                            <comment id="15930492" author="jira-bot" created="Fri, 17 Mar 2017 18:57:59 +0000"  >&lt;p&gt;Commit 3b660018457234387558ff626c8b95bb6f4ce853 in lucene-solr&apos;s branch refs/heads/master from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3b66001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3b66001&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10237&quot; title=&quot;Poly-Fields should work with subfield that have docValues=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10237&quot;&gt;&lt;del&gt;SOLR-10237&lt;/del&gt;&lt;/a&gt;: Poly-Fields should work with subfield that have docValues=true&lt;/p&gt;</comment>
                            <comment id="15930591" author="jira-bot" created="Fri, 17 Mar 2017 19:48:04 +0000"  >&lt;p&gt;Commit f947cbc461c961007b268d701e6b415f7882aa03 in lucene-solr&apos;s branch refs/heads/branch_6x from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f947cbc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f947cbc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10237&quot; title=&quot;Poly-Fields should work with subfield that have docValues=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10237&quot;&gt;&lt;del&gt;SOLR-10237&lt;/del&gt;&lt;/a&gt;: Poly-Fields should work with subfield that have docValues=true&lt;/p&gt;</comment>
                            <comment id="15930594" author="jira-bot" created="Fri, 17 Mar 2017 19:49:47 +0000"  >&lt;p&gt;Commit 3f6a15fd797081a6f6383a623ae2a794bcd6f800 in lucene-solr&apos;s branch refs/heads/branch_6_5 from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3f6a15f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3f6a15f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10237&quot; title=&quot;Poly-Fields should work with subfield that have docValues=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10237&quot;&gt;&lt;del&gt;SOLR-10237&lt;/del&gt;&lt;/a&gt;: Poly-Fields should work with subfield that have docValues=true&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12859333" name="SOLR-10237.patch" size="14066" author="tflobbe" created="Fri, 17 Mar 2017 18:21:13 +0000"/>
                            <attachment id="12858978" name="SOLR-10237.patch" size="12589" author="tflobbe" created="Thu, 16 Mar 2017 00:08:32 +0000"/>
                            <attachment id="12856424" name="SOLR-10237.patch" size="6003" author="tflobbe" created="Tue, 7 Mar 2017 03:16:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3b153:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>