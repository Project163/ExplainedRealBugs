<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:48:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14758] NPE in QueryComponent.mergeIds when using timeAllowed and sorting</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14758</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Only tested on 7.7.3 and master, but the offending code hasn&apos;t been changed for a while, so this presumably affects other versions as well. &lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;SolrCloud&lt;/li&gt;
	&lt;li&gt;Create a query which is complex enough to take a while&lt;/li&gt;
	&lt;li&gt;Add a sort clause to the query (e.g. &amp;amp;sort=creationTimestamp asc)&lt;/li&gt;
	&lt;li&gt;Add a short value timeAllowed (10ms in my test)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Result: NPE in QueryComponent.mergeIds:935&lt;/p&gt;

&lt;p&gt;It may take a couple of attempts to hit the error.&lt;/p&gt;

&lt;p&gt;Offending code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        NamedList sortFieldValues = (NamedList)(srsp.getSolrResponse().getResponse().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;sort_values&quot;&lt;/span&gt;));
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sortFieldValues.size()==0 &amp;amp;&amp;amp; &lt;span class=&quot;code-comment&quot;&gt;// we bypass merging &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; response only &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it&apos;s partial itself
&lt;/span&gt;                            thisResponseIsPartial) { &lt;span class=&quot;code-comment&quot;&gt;// but not the previous one!!
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;//fsv timeout yields empty sort_vlaues
&lt;/span&gt;        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;sortFieldValues can apparently be null in some cases, depending on when the query hits the timeAllowed. Adding an extra null check fixes the issue.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        NamedList sortFieldValues = (NamedList)(srsp.getSolrResponse().getResponse().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;sort_values&quot;&lt;/span&gt;));
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; == sortFieldValues || sortFieldValues.size()==0) &amp;amp;&amp;amp; &lt;span class=&quot;code-comment&quot;&gt;// we bypass merging &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; response only &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it&apos;s partial itself
&lt;/span&gt;                            thisResponseIsPartial) { &lt;span class=&quot;code-comment&quot;&gt;// but not the previous one!!
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;//fsv timeout yields empty sort_vlaues
&lt;/span&gt;        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll attach a patch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13323581">SOLR-14758</key>
            <summary>NPE in QueryComponent.mergeIds when using timeAllowed and sorting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uschindler">Uwe Schindler</assignee>
                                    <reporter username="bvd">Bram VD</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Aug 2020 15:50:48 +0000</created>
                <updated>Tue, 28 Sep 2021 20:22:01 +0000</updated>
                            <resolved>Sun, 15 Aug 2021 11:19:37 +0000</resolved>
                                    <version>7.7.3</version>
                    <version>8.6.3</version>
                    <version>9.0</version>
                    <version>8.8.1</version>
                    <version>8.8.2</version>
                                    <fixVersion>9.0</fixVersion>
                    <fixVersion>8.10</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>10</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17181155" author="mdrob" created="Thu, 20 Aug 2020 12:43:10 +0000"  >&lt;p&gt;The fix looks straightforward enough, could you add a unit test for this to prevent regressions in the future? Thanks!&lt;/p&gt;</comment>
                            <comment id="17181244" author="bvd" created="Thu, 20 Aug 2020 15:02:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;, I added an updated version of the patch which contains a quick regression test. It&apos;s a pretty big codebase and somewhat out of my comfort zone, so I&apos;m not sure if the test is in the right place. Added it to a test which was already testing distributed sorting, so that seemed like a good fit. &lt;/p&gt;</comment>
                            <comment id="17181415" author="mdrob" created="Thu, 20 Aug 2020 20:00:19 +0000"  >&lt;p&gt;The test without you patch isn&apos;t failing for me locally, I think we&apos;re going to have to be a bit more involved, unfortunately. Maybe once&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14413&quot; title=&quot;allow timeAllowed and cursorMark parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14413&quot;&gt;&lt;del&gt;SOLR-14413&lt;/del&gt;&lt;/a&gt;&#160;is merged we can copy the example there using DelayingSearchComponent, I think that would be the most reliable way to verify. I think this is an important patch, let&apos;s wait a few days to make sure we can get it right.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;To clarify, this only happens when there are multiple shards involved, right?&lt;/p&gt;</comment>
                            <comment id="17182525" author="bvd" created="Sat, 22 Aug 2020 21:17:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; I&apos;ve only encountered this in multi-shard situations. I assumed that mergeIds() is only called when there are multiple shards at play, though I have to admit that I&apos;m mostly ignorant as to how query distribution and result merging works. A previous patch (b8d569aff0c4417b0f9cd52d54455ab9b66236a1) by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhl&quot; class=&quot;user-hover&quot; rel=&quot;mkhl&quot;&gt;mkhl&lt;/a&gt; added a catch(ExitableDirectoryReader.ExitingReaderException) clause to doFieldSortValues(), which seems like the only place where sort_values is set. But I suspect there must be another way to exit that method which doesn&apos;t hit that particular catch clause. &lt;/p&gt;

&lt;p&gt;I&apos;ll try to spend some more time next week to reproduce this in test. But my null check seems to have fixed it, and it hasn&apos;t caused any regressions in the test build we&apos;ve been running internally for a couple of days, so at the very least it didn&apos;t make things worse. &lt;/p&gt;</comment>
                            <comment id="17354747" author="hudong" created="Tue, 1 Jun 2021 02:27:39 +0000"  >&lt;p&gt;I ran into the same problem with multi-shards + timeAllowed parameter, using solr 8.8.1.&lt;/p&gt;</comment>
                            <comment id="17379906" author="gus_heck" created="Tue, 13 Jul 2021 14:07:01 +0000"  >&lt;p&gt;Am seeing this NPE for a customer as well, showed up in a Gatling run replaying requests into 8.8.2 from their production. Also &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14674&quot; title=&quot;NPE when TimeAllowed exceeded with sorting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14674&quot;&gt;&lt;del&gt;SOLR-14674&lt;/del&gt;&lt;/a&gt; has some information and appears to be about the same issue. Based on links there, this may have been lurking for 2-3 years.&lt;/p&gt;</comment>
                            <comment id="17395196" author="thetaphi" created="Sat, 7 Aug 2021 11:25:06 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I have seen this also at one of my customers. In my opinion, the problem is not severe, as it only happens when a query timeouts, so the use won&apos;t get results anyways, or do I miss something. The only thing that would break are partial results.&lt;/p&gt;

&lt;p&gt;IMHO, when I looked at the issue, I would have said: add a null check, nothing bad can happen.&lt;/p&gt;

&lt;p&gt;Should I merge that patch?&lt;br/&gt;
Uwe&lt;/p&gt;</comment>
                            <comment id="17395212" author="bvd" created="Sat, 7 Aug 2021 12:45:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uschindler&quot; class=&quot;user-hover&quot; rel=&quot;uschindler&quot;&gt;uschindler&lt;/a&gt;, we&apos;ve been using this patch in production for almost a year now, and nothing bad has happened so far &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17395243" author="thetaphi" created="Sat, 7 Aug 2021 15:08:22 +0000"  >&lt;p&gt;Yeah, that&apos;s my impression, too. Thanks also for the added test!&lt;/p&gt;

&lt;p&gt;There is also a place in QueryComponent where an explicit empty named list is created as sentinel in the error case. To spare object allocations: with your null check, this  could be removed, too. Do you think it&apos;s worth to remove the sentinel?&lt;/p&gt;

&lt;p&gt;see here: &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/branch_8x/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/branch_8x/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L508&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17395478" author="bvd" created="Sun, 8 Aug 2021 07:11:05 +0000"  >&lt;p&gt;I&apos;m not sure whether any downstream code depends on it, my first instinct would be to play it safe and leave it in place, but you know the code base a lot better than I do, so I&apos;ll defer to you rbetter judgement!&lt;/p&gt;</comment>
                            <comment id="17395483" author="thetaphi" created="Sun, 8 Aug 2021 07:50:49 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I created a pull request on main: &lt;a href=&quot;https://github.com/apache/solr/pull/251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/251&lt;/a&gt; with your changes.&lt;/p&gt;</comment>
                            <comment id="17395485" author="thetaphi" created="Sun, 8 Aug 2021 07:57:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure whether any downstream code depends on it, my first instinct would be to play it safe and leave it in place, but you know the code base a lot better than I do, so I&apos;ll defer to you rbetter judgement!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, I won&apos;t do any changes yet. The problem is no hard typing so nobody knows (not even me) if it is used anywhere. You can only search for the key used in NamedList. In short: &quot;NamedList must die, die, die!&quot;&lt;/p&gt;</comment>
                            <comment id="17395487" author="thetaphi" created="Sun, 8 Aug 2021 08:26:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bvd&quot; class=&quot;user-hover&quot; rel=&quot;bvd&quot;&gt;bvd&lt;/a&gt;, can you check if the commit author in the PR matches you?&lt;/p&gt;</comment>
                            <comment id="17395492" author="bvd" created="Sun, 8 Aug 2021 08:47:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uschindler&quot; class=&quot;user-hover&quot; rel=&quot;uschindler&quot;&gt;uschindler&lt;/a&gt;, yup, that&apos;s my work account &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17395494" author="thetaphi" created="Sun, 8 Aug 2021 09:30:18 +0000"  >&lt;p&gt;I changed the check for partial results to use SolrJ API. In main branch this failed because the type of the NamedList value was different. Now it expects a boolean.&lt;/p&gt;</comment>
                            <comment id="17395495" author="thetaphi" created="Sun, 8 Aug 2021 09:31:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;Uwe Schindler, yup, that&apos;s my work account &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I checked the Lucene/Solr-Dev mailing list and found your mail address. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17396767" author="jira-bot" created="Tue, 10 Aug 2021 16:27:47 +0000"  >&lt;p&gt;Commit a72c99312380ef88fedd57d5f9806dc0f48406a1 in solr&apos;s branch refs/heads/main from Uwe Schindler&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=a72c993&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=a72c993&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14758&quot; title=&quot;NPE in QueryComponent.mergeIds when using timeAllowed and sorting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14758&quot;&gt;&lt;del&gt;SOLR-14758&lt;/del&gt;&lt;/a&gt;: Fix NPE in QueryComponent.mergeIds when using timeAllowed and sorting (#251)&lt;/p&gt;

&lt;p&gt;Signed-off-by: Uwe Schindler &amp;lt;uschindler@apache.org&amp;gt;&lt;br/&gt;
Co-authored-by: Bram Van Dam &amp;lt;bram.vandam@intix.eu&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17396778" author="jira-bot" created="Tue, 10 Aug 2021 16:40:49 +0000"  >&lt;p&gt;Commit d99980516bd3470e9e120428914d1270d5ddf91b in lucene-solr&apos;s branch refs/heads/branch_8x from Uwe Schindler&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d999805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d999805&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14758&quot; title=&quot;NPE in QueryComponent.mergeIds when using timeAllowed and sorting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14758&quot;&gt;&lt;del&gt;SOLR-14758&lt;/del&gt;&lt;/a&gt;: Fix NPE in QueryComponent.mergeIds when using timeAllowed and sorting (#251)&lt;/p&gt;

&lt;p&gt;Signed-off-by: Uwe Schindler &amp;lt;uschindler@apache.org&amp;gt;&lt;br/&gt;
Co-authored-by: Bram Van Dam &amp;lt;bram.vandam@intix.eu&amp;gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17396780" author="thetaphi" created="Tue, 10 Aug 2021 16:42:51 +0000"  >&lt;p&gt;Merged into solr/main and backported to 8.x branch. Thanks Bram Van Dam!&lt;/p&gt;</comment>
                            <comment id="17398428" author="dsmiley" created="Fri, 13 Aug 2021 04:03:46 +0000"  >&lt;p&gt;Tim observed that this commit triggers frequent failures on CI:&#160;&lt;a href=&quot;http://fucit.org/solr-jenkins-reports/history-trend-of-recent-failures.html#series/org.apache.solr.handler.component.DistributedQueryComponentCustomSortTest.test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fucit.org/solr-jenkins-reports/history-trend-of-recent-failures.html#series/org.apache.solr.handler.component.DistributedQueryComponentCustomSortTest.test&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17398504" author="thetaphi" created="Fri, 13 Aug 2021 08:15:09 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
That&apos;s actually a good sign, because the failing test may help us to understand why this actually failed in the past.&lt;br/&gt;
I&apos;ll dig.&lt;br/&gt;
Can we filter on main and 8.x? &lt;/p&gt;</comment>
                            <comment id="17398533" author="thetaphi" created="Fri, 13 Aug 2021 09:20:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;: the statistics by Tim end on Aug 8, so I don&apos;t see any failure after Aug 10 (when this was committed). Seems to be a false alarm.&lt;/p&gt;</comment>
                            <comment id="17398536" author="thetaphi" created="Fri, 13 Aug 2021 09:24:27 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;sorry, I found a failure, but it is not in the statistics posted before!&lt;/p&gt;

&lt;p&gt;java.lang.AssertionError: Number of documents (1) is different from number of expected values (3)&lt;/p&gt;

&lt;p&gt;But this one is exactly what I expected. It looks like sometimes the flag &quot;partialResults&quot; is not set correctly when the query timeouts while sorting. The new test added by this commit just showed the issue, but it is unrelated to this original NPE issue.&lt;/p&gt;</comment>
                            <comment id="17398541" author="thetaphi" created="Fri, 13 Aug 2021 09:33:23 +0000"  >&lt;p&gt;I think I know where the issue is: If it figures out that there are missing sort values for one shard it calls &quot;continue&quot;. Somewhere at the end it set the partial results flag. The porblem is now, if the last shard times out, it continues the loop, but as it is the last one the code that sets the &quot;partial results&quot; is not executed.&lt;/p&gt;

&lt;p&gt;This is really a timing porblem, but i is good that we hit this by extensive testing. I have seen the same locally one time, but was not able to reproduce after I changed the SolrJ code that checks for partial results in the test. I am out of office, but will check later and possible I can get this sorted out during the next days.&lt;/p&gt;

&lt;p&gt;Great that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bvd&quot; class=&quot;user-hover&quot; rel=&quot;bvd&quot;&gt;bvd&lt;/a&gt;&apos;s test found a bug in the merging code!&lt;/p&gt;</comment>
                            <comment id="17398601" author="thetaphi" created="Fri, 13 Aug 2021 11:11:40 +0000"  >&lt;p&gt;It looks like this is not caused by the &quot;continue&quot;. I was wrong when looking at the code. I need more time to figure out what&apos;s wrong with result merging.&lt;/p&gt;

&lt;p&gt;What happens: Previously the whole query crashed with NPE if some shard timed out. Now it no longer does this, but it returns partial results, while at same time the response header for partialResults is not set to TRUE.&lt;/p&gt;

&lt;p&gt;So this is still anew problem, uncovered by the new test.&lt;/p&gt;</comment>
                            <comment id="17399334" author="thetaphi" created="Sun, 15 Aug 2021 11:09:56 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I found the issue: It was just a bug in the test. It failed when the server was too fast, so it did not time out. The reason was that the shards parameter was not correctly set.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit a fix in a minute.&lt;/p&gt;</comment>
                            <comment id="17399336" author="jira-bot" created="Sun, 15 Aug 2021 11:15:11 +0000"  >&lt;p&gt;Commit 47c1fdcfb70d68a4e96da74f61a5b56ebc924f4a in solr&apos;s branch refs/heads/main from Uwe Schindler&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=47c1fdc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=47c1fdc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14758&quot; title=&quot;NPE in QueryComponent.mergeIds when using timeAllowed and sorting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14758&quot;&gt;&lt;del&gt;SOLR-14758&lt;/del&gt;&lt;/a&gt;: Fix query execution to pass shards&lt;/p&gt;</comment>
                            <comment id="17399337" author="jira-bot" created="Sun, 15 Aug 2021 11:17:22 +0000"  >&lt;p&gt;Commit a4ef0fc1d012029e0fe4acf4a5ed0df1ea785687 in lucene-solr&apos;s branch refs/heads/branch_8x from Uwe Schindler&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a4ef0fc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a4ef0fc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14758&quot; title=&quot;NPE in QueryComponent.mergeIds when using timeAllowed and sorting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14758&quot;&gt;&lt;del&gt;SOLR-14758&lt;/del&gt;&lt;/a&gt;: Fix query execution to pass shards&lt;/p&gt;</comment>
                            <comment id="17399338" author="thetaphi" created="Sun, 15 Aug 2021 11:19:37 +0000"  >&lt;p&gt;Fixed the test bug, sorry for false alarm. Distibuted sorting and partial results are working correctly.&lt;/p&gt;</comment>
                            <comment id="17421671" author="thelabdude" created="Tue, 28 Sep 2021 20:22:01 +0000"  >&lt;p&gt;Closing after the 8.10.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="13318503">SOLR-14674</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13029540">SOLR-9882</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13299179">SOLR-14413</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13010147" name="SOLR-14758.patch" size="3723" author="bvd" created="Thu, 20 Aug 2020 14:59:53 +0000"/>
                            <attachment id="13010101" name="SOLR-14758.patch" size="1137" author="bvd" created="Wed, 19 Aug 2020 15:52:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hx5s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>