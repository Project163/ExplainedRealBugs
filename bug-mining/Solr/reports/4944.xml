<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:52:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14679] TLOGs grow forever, never get out of BUFFERING state</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14679</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;From the user&apos;s list, &lt;br/&gt;
 (Gael Jourdan-Weil)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.mail-archive.com/solr-user@lucene.apache.org/msg151867.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/solr-user@lucene.apache.org/msg151867.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think I&apos;ve come down to the root cause of this mess in our case.&lt;/p&gt;

&lt;p&gt;Everything is confirming that the TLOG state is &quot;BUFFERING&quot; rather than &quot;ACTIVE&quot;.&lt;br/&gt;
1/ This can be seen with the metrics API as well where we observe:&lt;br/&gt;
&quot;TLOG.replay.remaining.bytes&quot;:48997506,&lt;br/&gt;
&quot;TLOG.replay.remaining.logs&quot;:1,&lt;br/&gt;
&quot;TLOG.state&quot;:1,&lt;br/&gt;
2/ When a hard commit occurs, we can see it in the logs and as the index files are updated ; but we can also see that postCommit and preCommit UpdateLog methods are called but exits immediately which looking at the code indicates the state is &quot;BUFFERING&quot;.&lt;/p&gt;

&lt;p&gt;So, why is this TLOG still in &quot;BUFFERING&quot; state?&lt;/p&gt;

&lt;p&gt;From the code, the only place where state is set to &quot;BUFFERING&quot; seems to be UpdateLog.bufferUpdates.&lt;br/&gt;
From the logs, in our case it comes from recovery process. We see the message &quot;Begin buffering updates. core=&lt;span class=&quot;error&quot;&gt;&amp;#91;col_blue_shard1&amp;#93;&lt;/span&gt;&quot;.&lt;br/&gt;
Just after we can see &quot;Publishing state of core &lt;span class=&quot;error&quot;&gt;&amp;#91;col_blue_shard1&amp;#93;&lt;/span&gt; as recovering, leader is &lt;a href=&quot;http://srv2/solr/col_blue_shard1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://srv2/solr/col_blue_shard1/&lt;/a&gt; and I am &lt;a href=&quot;http://srv1/solr/col_blue_shard1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://srv1/solr/col_blue_shard1/&lt;/a&gt;&quot;.&lt;/p&gt;

&lt;p&gt;Until here, everything is expected I guess but why the TLOG state is not set to &quot;ACTIVE&quot; a bit later?&lt;/p&gt;

&lt;p&gt;Well, the &quot;Begin buffering updates&quot; occured and 500ms later we can see:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;Updated live nodes from ZooKeeper... (2) -&amp;gt; (1)&quot; (I think at this time we shut down srv2, this is our main cause of problem)&lt;/li&gt;
	&lt;li&gt;&quot;I am going to be the leader srv1&quot;&lt;/li&gt;
	&lt;li&gt;&quot;Stopping recovery for core=&lt;span class=&quot;error&quot;&gt;&amp;#91;col_blue_shard1&amp;#93;&lt;/span&gt; coreNodeName=&lt;span class=&quot;error&quot;&gt;&amp;#91;core_node1&amp;#93;&lt;/span&gt;&quot;&lt;br/&gt;
And 2s later:&lt;/li&gt;
	&lt;li&gt;&quot;Attempting to PeerSync from &lt;a href=&quot;http://srv2/solr/es_blue_shard1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://srv2/solr/es_blue_shard1/&lt;/a&gt; - recoveringAfterStartup=&lt;span class=&quot;error&quot;&gt;&amp;#91;true&amp;#93;&lt;/span&gt;&quot;&lt;/li&gt;
	&lt;li&gt;&quot;Error while trying to recover. core=es_blue_shard1:org.apache.solr.common.SolrException: Failed to get fingerprint from leader&quot;&lt;/li&gt;
	&lt;li&gt;&quot;Finished recovery process, successful=&lt;span class=&quot;error&quot;&gt;&amp;#91;false&amp;#93;&lt;/span&gt;&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;At this point, I think the root cause on our side is a rolling update that we did too quickly: we stopped node2 while node1 while recovering from it.&lt;/p&gt;

&lt;p&gt;It&apos;s still not clear how everything went back to &quot;active&quot; state after such a failed recovery and a TLOG still in &quot;BUFFERING&quot;.&lt;/p&gt;

&lt;p&gt;We shouldn&apos;t have been in recovery in the first place and I think we know why, this is a first thing that we have adressed.&lt;br/&gt;
Then we need to add some pauses in our rolling update strategy.&lt;/p&gt;

&lt;p&gt;Does it makes sense? Can you think of something else to check/improve?&lt;/p&gt;

&lt;p&gt;Best Regards,&lt;br/&gt;
Ga&#235;l&lt;/p&gt;</description>
                <environment></environment>
        <key id="13319157">SOLR-14679</key>
            <summary>TLOGs grow forever, never get out of BUFFERING state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houston">Houston Putman</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jul 2020 11:22:59 +0000</created>
                <updated>Wed, 22 Oct 2025 06:29:01 +0000</updated>
                            <resolved>Wed, 26 Oct 2022 18:18:49 +0000</resolved>
                                                    <fixVersion>9.1</fixVersion>
                    <fixVersion>8.11.3</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>11</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17164388" author="erickerickson" created="Fri, 24 Jul 2020 11:40:44 +0000"  >&lt;p&gt;And here&apos;s another bit of information from Carlos Ugarte:&lt;/p&gt;

&lt;p&gt;We see similar behavior from time to time.  The main difference seems to be&lt;br/&gt;
that you see it while using NRT replication and we see it while using TLOG&lt;br/&gt;
replication.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Solr 7.5.0.&lt;/li&gt;
	&lt;li&gt;1 collection with 12 shards, each with 2 TLOG and 2 PULL replicas.&lt;/li&gt;
	&lt;li&gt;12 machines, each machine hosting one node/JVM.  Each node contains 4&lt;br/&gt;
replicas (different shards).&lt;/li&gt;
	&lt;li&gt;No explicit commits in the update requests.  AutoCommit=15s,&lt;br/&gt;
AutoSoftCommit=1s.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The symptoms we observe are as follows:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;It&apos;s on a TLOG replica that is not currently the leader.&lt;/li&gt;
	&lt;li&gt;For that replica, there is a single transaction log that keeps on growing.&lt;/li&gt;
	&lt;li&gt;For that replica, new segments are not being fetched from that shard&apos;s&lt;br/&gt;
TLOG leader.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In this configuration, one node contains four TLOG cores.  We have observed&lt;br/&gt;
the problem occurring on a single one of the cores as well as on multiple&lt;br/&gt;
cores in one node.&lt;/p&gt;

&lt;p&gt;Anecdotally, it seems to occur more frequently on those collections that&lt;br/&gt;
are large (number of documents, size on disk) and that have a higher ingest&lt;br/&gt;
rate.  These are vague terms and I don&apos;t know that I&apos;m allowed to share&lt;br/&gt;
specifics, but I can say that we run a number of different clouds with a&lt;br/&gt;
similar setup and that this problem occurs more frequently for the more&lt;br/&gt;
loaded clouds.&lt;/p&gt;

&lt;p&gt;Initially we couldn&apos;t tell that this was occurring (queries were directed&lt;br/&gt;
to PULL replicas so not evident to the applications, the TLOG cores with&lt;br/&gt;
this problem reported as active and in a good state so nothing obviously&lt;br/&gt;
wrong).  Our early alarm system now consists of checking for large&lt;br/&gt;
transaction logs.  When we see this, we restart the problem node.  Upon&lt;br/&gt;
restart it recovers from its leader (fetching whatever segments it had&lt;br/&gt;
missed - hours, days, ...).  Eventually the large transaction log&lt;br/&gt;
disappears and that core starts to cycle through a series of smaller&lt;br/&gt;
transaction logs (the normal behavior).&lt;/p&gt;

&lt;p&gt;We noticed that the ctime of the large transaction log seemed to be&lt;br/&gt;
slightly later than that node&apos;s restart time.  After that discovery, we saw&lt;br/&gt;
the following pattern every time we observed the problem:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Everything is in a good state at the beginning.  A is a node containing a&lt;br/&gt;
TLOG replica that is leader for its shard and B is a node containing a TLOG&lt;br/&gt;
replica that is not a leader.  Ingest is ongoing.&lt;/li&gt;
	&lt;li&gt;A is stopped for a short period of time (&amp;lt; 30s) and then is started up&lt;br/&gt;
again.  If it makes a difference, our way of stopping this relies on&lt;br/&gt;
systemd&apos;s default behavior - send SIGTERM, wait for 5s, send SIGKILL.&lt;/li&gt;
	&lt;li&gt;The TLOG replica in B emerges from this as the leader for its shard.&lt;br/&gt;
Everything about B appears to suggest B is operating correctly.  The TLOG&lt;br/&gt;
replica in A has the ever-growing transaction log and never fetches new&lt;br/&gt;
segments.&lt;/li&gt;
	&lt;li&gt;The malfunctioning TLOG replica in A can be &quot;fixed&quot; by restarting A.&lt;/li&gt;
	&lt;li&gt;As noted earlier, this can affect cores (in a single node) individually.&lt;br/&gt;
It can be a problem for one and not the others (or for all of the cores in&lt;br/&gt;
a node).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17348803" author="thelabdude" created="Thu, 20 May 2021 21:07:55 +0000"  >&lt;p&gt;Going to research this issue a bit ...&lt;/p&gt;</comment>
                            <comment id="17496134" author="JIRAUSER283091" created="Tue, 22 Feb 2022 14:29:16 +0000"  >&lt;p&gt;I have a same issue with TLOG replication. Some tlog files just keeps growing and are never rotated, until solr service (instance) is restarted.&#160;&lt;/p&gt;

&lt;p&gt;Any workaround without restarting the service?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m using solr 8.11.0&lt;/p&gt;</comment>
                            <comment id="17509700" author="JIRAUSER283091" created="Mon, 21 Mar 2022 09:03:23 +0000"  >&lt;p&gt;I ran into the same problem: forever growing TLOG for some shards in TLOG followers.&lt;/p&gt;

&lt;p&gt;I did my own research (with &lt;b&gt;Solr 8.11.0&lt;/b&gt; sources) and I may have found a bug and also fixed it.&#160;&lt;/p&gt;

&lt;p&gt;In &lt;b&gt;ZkController.java&lt;/b&gt;, function &lt;b&gt;rejoinShardLeaderElection(SolrParams params&lt;/b&gt;&lt;b&gt;)&lt;/b&gt; there is a code:&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (SolrCore core = cc.getCore(coreName)) {
&#160; &#160; &#160; &#160; Replica.Type replicaType = core.getCoreDescriptor().getCloudDescriptor().getReplicaType();
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (replicaType == Type.TLOG) {
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; leaderUrl = getLeader(core.getCoreDescriptor().getCloudDescriptor(), cloudConfig.getLeaderVoteWait());
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!leaderUrl.equals(ourUrl)) {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// restart the replication thread to ensure the replication is running in each &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; replica
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// especially &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; previous role is &lt;span class=&quot;code-quote&quot;&gt;&quot;leader&quot;&lt;/span&gt; (i.e., no replication thread)
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; stopReplicationFromLeader(coreName);
&#160; &#160; &#160; &#160; &#160; &#160; startReplicationFromLeader(coreName, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When calling &lt;b&gt;startReplicationFromLeader(String coreName, boolean switchTransactionLog)&lt;/b&gt;, &lt;b&gt;second argument&lt;/b&gt; is &lt;b&gt;FALSE&lt;/b&gt;, but I think &lt;b&gt;it should be TRUE&lt;/b&gt;, so we will switch/rotate transaction log. I changed it to TRUE and tested it quickly and I it &lt;b&gt;seems to be fixed&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;Could you please look into this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you&lt;/p&gt;</comment>
                            <comment id="17512100" author="houston" created="Thu, 24 Mar 2022 21:52:07 +0000"  >&lt;p&gt;Thanks for looking into the &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vmolnar&quot; class=&quot;user-hover&quot; rel=&quot;vmolnar&quot;&gt;vmolnar&lt;/a&gt; !&lt;/p&gt;

&lt;p&gt;Unfortunately, I think we have to pass &lt;tt&gt;false&lt;/tt&gt; there, otherwise it will try to commit the information in the TLOG. The tlog replicas only want to get the index from the leader, so they can&apos;t be doing local commits.&lt;/p&gt;</comment>
                            <comment id="17512394" author="JIRAUSER283091" created="Fri, 25 Mar 2022 13:58:46 +0000"  >&lt;p&gt;Well, I thought we want to commit the information in the TLOG, since the code is executed only if replica type is TLOG. And TLOG replica should keep it&apos;s own transaction log.&lt;/p&gt;

&lt;p&gt;There are also other places in the code, where startReplicationFromLeader() is called with TRUE as the second argument and it&apos;s also related to TLOG replica type:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//RecoveryStrategy.java:
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (successfulRecovery) {
    log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Registering as Active after recovery.&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (replicaType == Replica.Type.TLOG) {
            zkController.startReplicationFromLeader(coreName, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
      &#160; }
     ...


&lt;span class=&quot;code-comment&quot;&gt;//ZkController.java
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!didRecovery) {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isTlogReplicaAndNotLeader) {
&#160; &#160; &#160; &#160; startReplicationFromLeader(coreName, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&#160; &#160; }
    ...


&lt;span class=&quot;code-comment&quot;&gt;//CoreContainer.java
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (replica.getType() == Replica.Type.TLOG) {
&#160; &#160; getZkController().stopReplicationFromLeader(core.getName());
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!cd.getCloudDescriptor().isLeader()) {
&#160; &#160; &#160; &#160; getZkController().startReplicationFromLeader(newCore.getName(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&#160; &#160; }
    ...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;All other places, where second argument is FALSE are related to PULL replica type or recovery when transaction log is not required.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Could you please re-check it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt; ? Thank you&lt;/p&gt;</comment>
                            <comment id="17516762" author="JIRAUSER287554" created="Mon, 4 Apr 2022 11:46:31 +0000"  >&lt;p&gt;This bug is affecting our services a lot. Yesterday we had a replica with T-LOG with a size of 81+ GB.&#160;&lt;/p&gt;

&lt;p&gt;Just the replica itself. As a quick fix, it would be good to have a workaround for this until we have a final solution.&lt;/p&gt;</comment>
                            <comment id="17517412" author="JIRAUSER283091" created="Tue, 5 Apr 2022 12:33:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coelhodeoliveira&quot; class=&quot;user-hover&quot; rel=&quot;coelhodeoliveira&quot;&gt;coelhodeoliveira&lt;/a&gt; you could try your own build with mentioned fix.&lt;/p&gt;

&lt;p&gt;I&apos;m testing it and until now, I indexed more than 5 billion small documents without any visible issues.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; do you think it&apos;s possible to change type of this issue to &lt;b&gt;BUG&lt;/b&gt; instead of IMPROVEMENT?&lt;/p&gt;</comment>
                            <comment id="17622992" author="gjourdan" created="Mon, 24 Oct 2022 07:05:38 +0000"  >&lt;p&gt;FYI we&apos;re still having the issue on a regular basis (Solr 8.11.1) but we only have NRT replicas (no TLOG).&lt;/p&gt;</comment>
                            <comment id="17624529" author="houston" created="Wed, 26 Oct 2022 14:52:10 +0000"  >&lt;p&gt;I&apos;m so sorry for dropping the ball on this everyone.&lt;/p&gt;

&lt;p&gt;I think you are completely right &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vmolnar&quot; class=&quot;user-hover&quot; rel=&quot;vmolnar&quot;&gt;vmolnar&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I will convert this to a bug and get this committed.&lt;/p&gt;</comment>
                            <comment id="17624625" author="jira-bot" created="Wed, 26 Oct 2022 17:10:02 +0000"  >&lt;p&gt;Commit 2d1a7485f00bd7e116463a09407d98f49348914b in solr&apos;s branch refs/heads/main from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=2d1a7485f00&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=2d1a7485f00&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14679&quot; title=&quot;TLOGs grow forever, never get out of BUFFERING state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14679&quot;&gt;&lt;del&gt;SOLR-14679&lt;/del&gt;&lt;/a&gt;: Fix evergrowing tlogs on TLOG replicas (#1131)&lt;/p&gt;
</comment>
                            <comment id="17624630" author="jira-bot" created="Wed, 26 Oct 2022 17:13:17 +0000"  >&lt;p&gt;Commit 5e9dbc2e19545cdc2b595de682868bf1ff857d88 in solr&apos;s branch refs/heads/branch_9x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=5e9dbc2e195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=5e9dbc2e195&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14679&quot; title=&quot;TLOGs grow forever, never get out of BUFFERING state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14679&quot;&gt;&lt;del&gt;SOLR-14679&lt;/del&gt;&lt;/a&gt;: Fix evergrowing tlogs on TLOG replicas (#1131)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2d1a7485f00bd7e116463a09407d98f49348914b)&lt;/p&gt;</comment>
                            <comment id="17624633" author="jira-bot" created="Wed, 26 Oct 2022 17:15:45 +0000"  >&lt;p&gt;Commit eadc4178b30af782a21cb739122a1bafbc6ae99b in solr&apos;s branch refs/heads/branch_9_1 from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=eadc4178b30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=eadc4178b30&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14679&quot; title=&quot;TLOGs grow forever, never get out of BUFFERING state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14679&quot;&gt;&lt;del&gt;SOLR-14679&lt;/del&gt;&lt;/a&gt;: Fix evergrowing tlogs on TLOG replicas (#1131)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2d1a7485f00bd7e116463a09407d98f49348914b)&lt;/p&gt;</comment>
                            <comment id="17624662" author="jira-bot" created="Wed, 26 Oct 2022 18:17:42 +0000"  >&lt;p&gt;Commit 4ccfb8fcf021f87d3dac967ce58f280793a2c163 in lucene-solr&apos;s branch refs/heads/branch_8_11 from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4ccfb8fcf02&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4ccfb8fcf02&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14679&quot; title=&quot;TLOGs grow forever, never get out of BUFFERING state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14679&quot;&gt;&lt;del&gt;SOLR-14679&lt;/del&gt;&lt;/a&gt;: Fix evergrowing tlogs on TLOG replicas (#1131)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2d1a7485f00bd7e116463a09407d98f49348914b)&lt;/p&gt;</comment>
                            <comment id="17624664" author="houston" created="Wed, 26 Oct 2022 18:18:49 +0000"  >&lt;p&gt;Thank you for tracking down the error and providing a solution &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vmolnar&quot; class=&quot;user-hover&quot; rel=&quot;vmolnar&quot;&gt;vmolnar&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17624890" author="JIRAUSER283091" created="Thu, 27 Oct 2022 06:57:43 +0000"  >&lt;p&gt;You are welcome, I&apos;m glad it&apos;s going to be fixed in official releases&lt;/p&gt;</comment>
                            <comment id="17656963" author="ishan" created="Tue, 10 Jan 2023 20:45:40 +0000"  >&lt;p&gt;Bulk closing 9.1 issues.&lt;/p&gt;</comment>
                            <comment id="18031964" author="gjourdan" created="Wed, 22 Oct 2025 06:28:13 +0000"  >&lt;p&gt;Hello folks,&lt;/p&gt;

&lt;p&gt;We didn&apos;t had the issue again until recently but it seems to be coming back from time to time.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Solr version: 9.9.0 386ed096a1946c488cfe576a19a147bdb1153508&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here&apos;s what I observe:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ll -h .../collection_shard1_replica_n4/data/tlog/
total 11G
-rw-r--r-- 1 xxx xxx 85M Oct 16 04:05 tlog.0000000000000000119
-rw-r--r-- 1 xxx xxx 11G Oct 22 04:05 tlog.0000000000000000120 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That is a gigantic TLOG file (11G).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And If I look at the Admin Metrics, I can, like in the original issue, that the TLOG is still in BUFFERING state (state=1):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TLOG.replay.remaining.bytes&quot;&lt;/span&gt;:88853809,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TLOG.replay.remaining.logs&quot;&lt;/span&gt;:1,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TLOG.state&quot;&lt;/span&gt;:1, 

      &lt;span class=&quot;code-quote&quot;&gt;&quot;TLOG.applyingBuffered.ops&quot;&lt;/span&gt;:{
        &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;:0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;meanRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;1minRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;5minRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;15minRate&quot;&lt;/span&gt;:0.0
      },
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TLOG.buffered.ops&quot;&lt;/span&gt;:0,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TLOG.copyOverOldUpdates.ops&quot;&lt;/span&gt;:{
        &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;:0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;meanRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;1minRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;5minRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;15minRate&quot;&lt;/span&gt;:0.0
      },
      &lt;span class=&quot;code-quote&quot;&gt;&quot;TLOG.replay.ops&quot;&lt;/span&gt;:{
        &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;:0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;meanRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;1minRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;5minRate&quot;&lt;/span&gt;:0.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;15minRate&quot;&lt;/span&gt;:0.0
      },&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is there a chance that the fix got reverted or maybe there&apos;s another situation when this can happen.&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13234669">SOLR-13486</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0h5zc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>