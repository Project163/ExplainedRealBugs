<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:28:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11456] HealthCheckHandlerTest.testHealthCheckHandler() asserts nothing useful</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11456</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The meat of &lt;tt&gt;HealthCheckHandlerTest.testHealthCheckHandler()&lt;/tt&gt; currently looks like this...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (live_nodes.size() == 1 &amp;amp;&amp;amp; counter++ &amp;lt; 100) {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(100);
        live_nodes = cluster.getSolrClient().getZkStateReader().getClusterState().getLiveNodes();
      }

      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        req.process(httpSolrClient);
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (HttpSolrClient.RemoteSolrException e) {
        assertTrue(e.getMessage(), e.getMessage().contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;Host Unavailable&quot;&lt;/span&gt;));
        assertEquals(SolrException.ErrorCode.SERVICE_UNAVAILABLE.code, e.code());
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;nothing actually asserts that &lt;tt&gt;live_nodes.size() != 1&lt;/tt&gt; &amp;#8211; so the loop could just exit after 100 iterations w/o any changes to hte system happening.&lt;/li&gt;
	&lt;li&gt;instead of using expectThrows, the only assertions are inside the catch block &amp;#8211; if the code (unexpectedly) succeeds the test will not fail (false positive)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13108163">SOLR-11456</key>
            <summary>HealthCheckHandlerTest.testHealthCheckHandler() asserts nothing useful</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Oct 2017 01:04:10 +0000</created>
                <updated>Thu, 16 Jan 2020 06:34:28 +0000</updated>
                            <resolved>Wed, 11 Oct 2017 22:32:36 +0000</resolved>
                                                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16198010" author="hossman" created="Tue, 10 Oct 2017 01:40:44 +0000"  >&lt;p&gt;here&apos;s a patch with an attempted fix using &lt;tt&gt;expectThrows&lt;/tt&gt; but on my machine it fails &amp;#8211; no RemoteSolrException is thrown.&lt;/p&gt;

&lt;p&gt;best guess: the reconnect logic seems to be happening very quickly, so maybe the node thinks it&apos;s healthy again by the time the healthcheck call is made?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 1780 INFO  (TEST-HealthCheckHandlerTest.testHealthCheckHandler-seed#[D95E86B813E36BF4]) [    ] o.a.s.SolrTestCaseJ4 ###Starting testHealthCheckHandler
   [junit4]   2&amp;gt; 2020 INFO  (qtp1914125569-26) [n:127.0.0.1:52504_solr    ] o.a.s.s.HttpSolrCall [admin] webapp=null path=/admin/health params={wt=javabin&amp;amp;version=2} status=0 QTime=22
   [junit4]   2&amp;gt; 2055 INFO  (TEST-HealthCheckHandlerTest.testHealthCheckHandler-seed#[D95E86B813E36BF4]) [    ] o.a.s.c.MiniSolrCloudCluster Expired zookeeper session 98802019973332995 from node http://127.0.0.1:52504/solr
   [junit4]   2&amp;gt; 2056 WARN  (jetty-launcher-1-thread-1-SendThread(127.0.0.1:53478)) [n:127.0.0.1:52504_solr    ] o.a.z.ClientCnxn Session 0x15f03e9e79a0003 for server 127.0.0.1/127.0.0.1:53478, unexpected error, closing socket connection and attempting reconnect
   [junit4]   2&amp;gt; java.nio.channels.ClosedChannelException
   [junit4]   2&amp;gt; 	at sun.nio.ch.SocketChannelImpl.ensureReadOpen(SocketChannelImpl.java:257)
   [junit4]   2&amp;gt; 	at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:300)
   [junit4]   2&amp;gt; 	at org.apache.zookeeper.ClientCnxnSocketNIO.doIO(ClientCnxnSocketNIO.java:68)
   [junit4]   2&amp;gt; 	at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:366)
   [junit4]   2&amp;gt; 	at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1141)
   [junit4]   2&amp;gt; 2057 INFO  (zkCallback-13-thread-1) [    ] o.a.s.c.c.ZkStateReader Updated live nodes from ZooKeeper... (1) -&amp;gt; (0)
   [junit4]   2&amp;gt; 2159 INFO  (qtp1914125569-28) [n:127.0.0.1:52504_solr    ] o.a.s.s.HttpSolrCall [admin] webapp=null path=/admin/health params={wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 2160 WARN  (zkCallback-8-thread-1-processing-n:127.0.0.1:52504_solr) [n:127.0.0.1:52504_solr    ] o.a.s.c.c.ConnectionManager Watcher org.apache.solr.common.cloud.ConnectionManager@614458f5 name: ZooKeeperConnection Watcher:127.0.0.1:53478/solr got event WatchedEvent state:Disconnected type:None path:null path: null type: None
   [junit4]   2&amp;gt; 2160 WARN  (zkCallback-8-thread-1-processing-n:127.0.0.1:52504_solr) [n:127.0.0.1:52504_solr    ] o.a.s.c.c.ConnectionManager zkClient has disconnected
   [junit4]   2&amp;gt; 2162 INFO  (TEST-HealthCheckHandlerTest.testHealthCheckHandler-seed#[D95E86B813E36BF4]) [    ] o.a.s.SolrTestCaseJ4 ###Ending testHealthCheckHandler
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=HealthCheckHandlerTest -Dtests.method=testHealthCheckHandler -Dtests.seed=D95E86B813E36BF4 -Dtests.multiplier=2 -Dtests.slow=true -Dtests.locale=es-EC -Dtests.timezone=AGT -Dtests.asserts=true -Dtests.file.encoding=UTF-8q
   [junit4] FAILURE 0.41s | HealthCheckHandlerTest.testHealthCheckHandler &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: junit.framework.AssertionFailedError: Expected exception RemoteSolrException but no exception was thrown
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([D95E86B813E36BF4:F84CC1A626ECEF60]:0)
   [junit4]    &amp;gt; 	at org.apache.lucene.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2672)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.HealthCheckHandlerTest.testHealthCheckHandler(HealthCheckHandlerTest.java:69)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16199050" author="hossman" created="Tue, 10 Oct 2017 17:41:27 +0000"  >&lt;p&gt;here&apos;s a patch that adds a new noe to the cluster for hte express purpos of breaking it by completley shutting down it&apos;s ZkClient &amp;#8211; so expiration reconnecting isn&apos;t a factor&lt;/p&gt;

&lt;p&gt;And because it&apos;s a completely new jetty node (which the test method shutsdown in it&apos;s finally method) i&apos;m pretty sure this fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11457&quot; title=&quot;HealthCheckHandlerTest.testHealthCheckHandlerSolrJ() non-reproducible failures -- test order/timing realted?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11457&quot;&gt;&lt;del&gt;SOLR-11457&lt;/del&gt;&lt;/a&gt; as well&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; &amp;#8211; can you please sanity check this?&lt;/p&gt;</comment>
                            <comment id="16201088" author="jira-bot" created="Wed, 11 Oct 2017 22:32:12 +0000"  >&lt;p&gt;Commit 8c39b37c5ac7baa384fe9362924ce714edcb6f57 in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8c39b37&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8c39b37&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11456&quot; title=&quot;HealthCheckHandlerTest.testHealthCheckHandler() asserts nothing useful&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11456&quot;&gt;&lt;del&gt;SOLR-11456&lt;/del&gt;&lt;/a&gt;: Fix HealthCheckHandlerTest&apos;s bogus asserts and timing/order related flakiness&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                                                <inwardlinks description="is fixed by">
                                        <issuelink>
            <issuekey id="13279755">SOLR-14191</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="13108167">SOLR-11457</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13088485">SOLR-11126</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13108167">SOLR-11457</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12891312" name="SOLR-11456.patch" size="4736" author="hossman" created="Tue, 10 Oct 2017 17:39:45 +0000"/>
                            <attachment id="12891188" name="SOLR-11456.patch" size="1802" author="hossman" created="Tue, 10 Oct 2017 01:35:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3l27r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>