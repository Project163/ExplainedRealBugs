<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:10:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8337] Add ReduceOperation and wire it into the ReducerStream</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8337</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The current ReducerStream groups all documents that share the same key(s) into a list and emits a single Tuple that contains this list. There is no way to tell the ReducerStream to do something more interesting with groups, for example summing a column within a group, or joining tuples. &lt;/p&gt;

&lt;p&gt;This ticket adds a new type of operation called a ReduceOperation which is passed to the ReducerStream so that the reduce behavior can be specialized.&lt;/p&gt;

&lt;p&gt;The ReduceOperation has two methods:&lt;/p&gt;

&lt;p&gt;1) operate(Tuple) : This is called once for each Tuple in a group. This method can be used to aggregate Tuples as they added to a group. &lt;br/&gt;
2) reduce() : This is called when the group keys change. This method returns a single Tuple which is output by the ReducerStream. The ReduceOperation must clear it&apos;s internal structures when reduce is called as well, to prepare for the next group.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12915911">SOLR-8337</key>
            <summary>Add ReduceOperation and wire it into the ReducerStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jbernste">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Nov 2015 19:51:00 +0000</created>
                <updated>Tue, 8 Oct 2019 14:50:42 +0000</updated>
                            <resolved>Fri, 11 Dec 2015 02:33:20 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15025241" author="joel.bernstein" created="Tue, 24 Nov 2015 20:03:23 +0000"  >&lt;p&gt;Patch adds a single &lt;b&gt;reduce()&lt;/b&gt; method for the ReduceOperation that returns a single Tuple, which is the final reduction.&lt;/p&gt;

&lt;p&gt;The &lt;b&gt;operate(Tuple)&lt;/b&gt; method will be called for each Tuple that is read by the &lt;b&gt;ReducerStream&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;The reduce() method will be called each time the group by key changes. This will give the ReduceOperation a chance to finish the reduce algorithm and return a single Tuple. The ReduceOperation will also clear it&apos;s internal memory after each call to reduce() to prepare for the next Tuple grouping.&lt;/p&gt;</comment>
                            <comment id="15025291" author="joel.bernstein" created="Tue, 24 Nov 2015 20:26:57 +0000"  >&lt;p&gt;Currently the ReducerStream is referred to by the &lt;b&gt;group&lt;/b&gt; Streaming Expression function. Now that we will be passing in a ReduceOperation it makes sense to call this function &lt;b&gt;reduce&lt;/b&gt;. For example the syntax would be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;reduce(                                      
             search(collection1, 
                         q=&lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;,
                         qt=&lt;span class=&quot;code-quote&quot;&gt;&quot;/export&quot;&lt;/span&gt;, 
                         fl=&lt;span class=&quot;code-quote&quot;&gt;&quot;id,a_s,a_i,a_f&quot;&lt;/span&gt;, 
                         sort=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s asc, a_f asc&quot;&lt;/span&gt;),
              by=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s&quot;&lt;/span&gt;,
              operation(...))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15025697" author="joel.bernstein" created="Tue, 24 Nov 2015 23:27:14 +0000"  >&lt;p&gt;First crack at adding the ReduceOperation to the ReducerStream.&lt;/p&gt;

&lt;p&gt;I&apos;ll create a GroupOperation that will emit a single Tuple with a list of all the Tuples in a group.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;reduce(  
             search(collection1, 
                          q=&lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;,
                          qt=&lt;span class=&quot;code-quote&quot;&gt;&quot;/export&quot;&lt;/span&gt;, 
                          fl=&lt;span class=&quot;code-quote&quot;&gt;&quot;id,a_s,a_i,a_f&quot;&lt;/span&gt;, 
                          sort=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s asc, a_f asc&quot;&lt;/span&gt;),
             by=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s&quot;&lt;/span&gt;,
             group(sort=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_f asc&quot;&lt;/span&gt;, n=&lt;span class=&quot;code-quote&quot;&gt;&quot;20&quot;&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  </comment>
                            <comment id="15026025" author="dpgove" created="Wed, 25 Nov 2015 02:24:12 +0000"  >&lt;p&gt;I might change the operationExpressions line to get operands of type ReduceOperation.class. This would ensure that only expressions adhering to the ReduceOperation interface are returned. That said, from a user perspective it might be nice to be told you provided a StreamOperation when a ReduceOperation is expected.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;List&amp;lt;StreamExpression&amp;gt; operationExpressions = factory.getExpressionOperandsRepresentingTypes(expression, ReduceOperation.class);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15026066" author="joel.bernstein" created="Wed, 25 Nov 2015 02:53:24 +0000"  >&lt;p&gt;Sounds good. I&apos;ll make that change in the next iteration.&lt;/p&gt;</comment>
                            <comment id="15027297" author="joel.bernstein" created="Wed, 25 Nov 2015 18:05:19 +0000"  >&lt;p&gt;Added the GroupOperation. Now we just need some tests.&lt;/p&gt;</comment>
                            <comment id="15051280" author="joel.bernstein" created="Thu, 10 Dec 2015 17:19:27 +0000"  >&lt;p&gt;Patch with passing StreamExpressionTests. Still need to work on the StreamingTests.&lt;/p&gt;</comment>
                            <comment id="15051455" author="joel.bernstein" created="Thu, 10 Dec 2015 18:51:59 +0000"  >&lt;p&gt;New patch with StreamingTests passing.&lt;/p&gt;</comment>
                            <comment id="15052041" author="jira-bot" created="Fri, 11 Dec 2015 02:28:26 +0000"  >&lt;p&gt;Commit 1719246 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1719246&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1719246&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8337&quot; title=&quot;Add ReduceOperation and wire it into the ReducerStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8337&quot;&gt;&lt;del&gt;SOLR-8337&lt;/del&gt;&lt;/a&gt;: Add ReduceOperation and wire it into the ReducerStream&lt;/p&gt;</comment>
                            <comment id="15114389" author="risdenk" created="Sun, 24 Jan 2016 17:26:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; - Any reason that this patch removed &quot;.withFunctionName(&quot;count&quot;, RecordCountStream.class)&quot; from StreamingTest? It looks like RecordCountStream is never used without that line.&lt;/p&gt;</comment>
                            <comment id="15114395" author="joel.bernstein" created="Sun, 24 Jan 2016 17:35:20 +0000"  >&lt;p&gt;It was conflicting with the count metric function call and it was only being used for some very early test cases. I just removed it a changed the test cases.&lt;/p&gt;</comment>
                            <comment id="15114396" author="risdenk" created="Sun, 24 Jan 2016 17:37:15 +0000"  >&lt;p&gt;So that means that the RecordCountStream file can be deleted? Looks like its an unused file.&lt;/p&gt;</comment>
                            <comment id="15114418" author="joel.bernstein" created="Sun, 24 Jan 2016 18:17:05 +0000"  >&lt;p&gt;Yes&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12776863" name="SOLR-8337.patch" size="36705" author="jbernste" created="Thu, 10 Dec 2015 18:51:59 +0000"/>
                            <attachment id="12776840" name="SOLR-8337.patch" size="28295" author="jbernste" created="Thu, 10 Dec 2015 17:19:27 +0000"/>
                            <attachment id="12774388" name="SOLR-8337.patch" size="13041" author="jbernste" created="Wed, 25 Nov 2015 18:05:19 +0000"/>
                            <attachment id="12774197" name="SOLR-8337.patch" size="7385" author="jbernste" created="Tue, 24 Nov 2015 23:27:14 +0000"/>
                            <attachment id="12774140" name="SOLR-8337.patch" size="1609" author="jbernste" created="Tue, 24 Nov 2015 19:56:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ovxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>