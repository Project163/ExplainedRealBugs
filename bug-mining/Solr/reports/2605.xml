<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:07:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7950] Invalid auth scheme configuration of Http client when using Kerberos (SPNEGO)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7950</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using kerberos authentication mechanism (SPNEGO auth scheme), the Apache Http client is incorrectly configured with &lt;b&gt;all&lt;/b&gt; auth schemes (e.g. Basic, Digest, NTLM, Kerberos, Negotiate etc.) instead of just &apos;Negotiate&apos;. &lt;/p&gt;

&lt;p&gt;This issue was identified after configuring Solr with both Basic + Negotiate authentication schemes simultaneously. The problem in this case is that Http client is configured with Kerberos credentials and the default (and incorrect) auth scheme configuration prefers Basic authentication over Kerberos. Since the basic authentication credentials are missing, the authentication and as a result the Http request fails. (I ran into this problem while creating a collection where there is an internal communication between Solr servers).&lt;/p&gt;

&lt;p&gt;The root cause for this issue is that, AbstractHttpClient::getAuthSchemes() API call prepares an AuthSchemeRegistry instance with all possible authentication schemes. Hence when we register the SPNEGO auth scheme in Solr codebase, it overrides the previous configuration for SPNEGO - but doesn&apos;t remove the other auth schemes from the client configuration. Please take a look at relevant code snippet.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/trunk/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Krb5HttpClientConfigurer.java#L80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Krb5HttpClientConfigurer.java#L80&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A trivial fix would be to prepare a new AuthSchemeRegistry instance configured with just SPENGO mechanism and set it in the HttpClient.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12857573">SOLR-7950</key>
            <summary>Invalid auth scheme configuration of Http client when using Kerberos (SPNEGO)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gchanan">Gregory Chanan</assignee>
                                    <reporter username="hgadre">Hrishikesh Gadre</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Aug 2015 15:58:49 +0000</created>
                <updated>Mon, 9 May 2016 18:43:15 +0000</updated>
                            <resolved>Thu, 27 Aug 2015 00:03:13 +0000</resolved>
                                    <version>4.10.3</version>
                    <version>6.0</version>
                                    <fixVersion>5.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14705499" author="gchanan" created="Thu, 20 Aug 2015 18:25:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/trunk/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Krb5HttpClientConfigurer.java#L80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Krb5HttpClientConfigurer.java#L80&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;press &quot;y&quot; when linked these so you get a static sha, i.e. &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/f9799d3b7f62405b96480dead52c5611e99ab3e7/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Krb5HttpClientConfigurer.java#L80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/f9799d3b7f62405b96480dead52c5611e99ab3e7/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Krb5HttpClientConfigurer.java#L80&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14705780" author="hgadre" created="Thu, 20 Aug 2015 21:22:17 +0000"  >&lt;p&gt;Please find the patch for this issue attached.&lt;/p&gt;</comment>
                            <comment id="14709922" author="gchanan" created="Mon, 24 Aug 2015 19:35:21 +0000"  >&lt;p&gt;Patch looks correct to me; not sure I understand the symptoms though.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This issue was identified after configuring Solr with both Basic + Negotiate authentication schemes simultaneously. The problem in this case is that Http client is configured with Kerberos credentials and the default (and incorrect) auth scheme configuration prefers Basic authentication over Kerberos. Since the basic authentication credentials are missing, the authentication and as a result the Http request fails. (I ran into this problem while creating a collection where there is an internal communication between Solr servers).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We don&apos;t support Basic + Negotiate now, right?  So we need another solr patch to expose the underlying problem?&lt;/p&gt;

&lt;p&gt;There&apos;s no fall back mechanism?  E.g. if you fail basic you can fall back to SPNego?  Or can you prefer SPNego over basic?&lt;/p&gt;</comment>
                            <comment id="14715487" author="hgadre" created="Wed, 26 Aug 2015 20:49:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gchanan&quot; class=&quot;user-hover&quot; rel=&quot;gchanan&quot;&gt;gchanan&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;We don&apos;t support Basic + Negotiate now, right? So we need another solr patch to expose the underlying problem?&lt;/p&gt;

&lt;p&gt;Yes that is correct. I identified this issue while working on LDAP integration (Please refer to  &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12082&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HADOOP-12082&lt;/a&gt;). I don&apos;t think we use the Hadoop security framework in Solr. So we may have to introduce Basic authentication scheme (in addition to SPNEGO) in Solr by some other way.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;There&apos;s no fall back mechanism?&lt;/p&gt;

&lt;p&gt;No. When server supports multiple authentication schemes, client needs to pick one scheme to use (based on list of preferences). The default configuration prefers BASIC scheme over SPENGO. Hence the client attempts to use basic auth scheme. But since the username/password credentials are not configured - the authentication fails. With my patch, we explicitly configure client to use SPNEGO.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Or can you prefer SPNego over basic?&lt;/p&gt;

&lt;p&gt;Yes. This can be done by adding SPNEGO before BASIC in the preference list. Here is how the default preferences are initialized.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/org.apache.httpcomponents/httpclient/4.4.1/org/apache/http/impl/client/AbstractHttpClient.java#AbstractHttpClient.createAuthSchemeRegistry%28%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grepcode.com/file/repo1.maven.org/maven2/org.apache.httpcomponents/httpclient/4.4.1/org/apache/http/impl/client/AbstractHttpClient.java#AbstractHttpClient.createAuthSchemeRegistry%28%29&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think when we configure HttpClientUtil with Krb5HttpClientConfigurer, we intend to use Kerberos authentication mechanism on the client side. Hence I think just configuring one auth scheme (SPNEGO in this case) is preferable than SPNEGO &amp;amp; BASIC&lt;/p&gt;

&lt;p&gt;I have also updated the patch to fix a unit test failure.&lt;/p&gt;</comment>
                            <comment id="14715499" author="ichattopadhyaya" created="Wed, 26 Aug 2015 20:57:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;So we may have to introduce Basic authentication scheme (in addition to SPNEGO) in Solr by some other way.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We already have basic auth, &lt;a href=&quot;https://cwiki.apache.org/confluence/display/solr/Basic+Authentication+Plugin&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/solr/Basic+Authentication+Plugin&lt;/a&gt;&lt;br/&gt;
However, we still don&apos;t have it working together as yet.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I don&apos;t think we use the Hadoop security framework in Solr.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The hadoop-auth&apos;s kerberos authentication filters are used. The support for delegation tokens still isn&apos;t there.&lt;/p&gt;</comment>
                            <comment id="14715574" author="gchanan" created="Wed, 26 Aug 2015 21:41:54 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;Patch looks good and thanks for the explanation.  It sounds like from what Ishan is saying there may be some more work integrating the &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12082&quot; title=&quot;Support multiple authentication schemes via AuthenticationFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12082&quot;&gt;&lt;del&gt;HADOOP-12082&lt;/del&gt;&lt;/a&gt; change with Solr&apos;s own Basic Auth Plugin, but that can be done in another jira.&lt;/p&gt;</comment>
                            <comment id="14715776" author="jira-bot" created="Thu, 27 Aug 2015 00:00:57 +0000"  >&lt;p&gt;Commit 1698037 from gchanan@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1698037&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1698037&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7950&quot; title=&quot;Invalid auth scheme configuration of Http client when using Kerberos (SPNEGO)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7950&quot;&gt;&lt;del&gt;SOLR-7950&lt;/del&gt;&lt;/a&gt;: Invalid auth scheme configuration of Http client when using Kerberos (SPNEGO)&lt;/p&gt;</comment>
                            <comment id="14715777" author="jira-bot" created="Thu, 27 Aug 2015 00:02:45 +0000"  >&lt;p&gt;Commit 1698039 from gchanan@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1698039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1698039&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7950&quot; title=&quot;Invalid auth scheme configuration of Http client when using Kerberos (SPNEGO)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7950&quot;&gt;&lt;del&gt;SOLR-7950&lt;/del&gt;&lt;/a&gt;: Invalid auth scheme configuration of Http client when using Kerberos (SPNEGO)&lt;/p&gt;</comment>
                            <comment id="14715778" author="gchanan" created="Thu, 27 Aug 2015 00:03:13 +0000"  >&lt;p&gt;Thanks for the patch Hrishikesh, committed to Trunk and 5x.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12752569" name="solr-7950-v2.patch" size="3788" author="hgadre" created="Wed, 26 Aug 2015 20:49:40 +0000"/>
                            <attachment id="12751591" name="solr-7950.patch" size="3634" author="hgadre" created="Thu, 20 Aug 2015 21:22:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j5xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>