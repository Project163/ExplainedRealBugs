<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:29:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3659] non-reproducible failures from RecoveryZkTest - mostly NRTCachingDirectory.deleteFile</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3659</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Since getting my new laptop, i&apos;ve noticed some sporadic failures from RecoveryZkTest, so last night tried running 100 iterations againts trunk (r1363555), and got 5 errors/failures...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;3 asertion failures from NRTCachingDirectory.deleteFile&lt;/li&gt;
	&lt;li&gt;1 node recovery assertion from AbstractDistributedZkTestCase.waitForRecoveriesToFinish caused by OOM&lt;/li&gt;
	&lt;li&gt;1 searcher leak assertion: opens=1658 closes=1652 (possibly lingering affects from OOM?)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;see comments/attachments for details&lt;/p&gt;</description>
                <environment></environment>
        <key id="12599656">SOLR-3659</key>
            <summary>non-reproducible failures from RecoveryZkTest - mostly NRTCachingDirectory.deleteFile</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Jul 2012 18:40:03 +0000</created>
                <updated>Mon, 17 Oct 2016 12:30:44 +0000</updated>
                            <resolved>Mon, 17 Oct 2016 12:30:43 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13419425" author="hossman" created="Fri, 20 Jul 2012 18:42:50 +0000"  >&lt;p&gt;Full tests-failures.txt (compressed) and a summary file containing just the failure stack traces (no log output) &lt;/p&gt;</comment>
                            <comment id="13419429" author="markrmiller@gmail.com" created="Fri, 20 Jul 2012 18:48:44 +0000"  >&lt;p&gt;Probably related to &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-4238&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-4238&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I didn&apos;t see it in that test, but I&apos;ve seen it. I have a small test case that demonstarts one of the problems.&lt;/p&gt;</comment>
                            <comment id="13419438" author="rcmuir" created="Fri, 20 Jul 2012 18:53:18 +0000"  >&lt;p&gt;Don&apos;t you think the problem is likely that solr&apos;s replication doesnt use the Directory api, instead works on Files directly, and its accessing NRTCachingDir&apos;s delegate FSDir, then modifying files in that directory all &quot;underneath&quot; nrtcachingdir?&lt;/p&gt;</comment>
                            <comment id="13419447" author="markrmiller@gmail.com" created="Fri, 20 Jul 2012 19:02:51 +0000"  >&lt;p&gt;I don&apos;t know what&apos;s causing it...&lt;/p&gt;

&lt;p&gt;But the assert that is generally tripped on delete is tripped because its trying to uncache a file and finds it in the delegate - and its trying to assert the file is not in both - and I can seem to cause that condition kind of easily in a simple multi threaded nrtdir test.&lt;/p&gt;

&lt;p&gt;I&apos;m also not sure that removing files underneath this dir would cause that situation - it would seem not.&lt;/p&gt;</comment>
                            <comment id="13419451" author="rcmuir" created="Fri, 20 Jul 2012 19:07:35 +0000"  >&lt;p&gt;ok, i know i ran into hellacious problems trying to get all tests using mockdirectorywrapper, i had to disable it&lt;br/&gt;
in the TestReplicationHandler for this reason because it adds files outside of the directory api, calling sync itself&lt;br/&gt;
(but mockdirectorywrapper doesnt know about this).&lt;/p&gt;

&lt;p&gt;This also makes it impossible to re-use MDW&apos;s facilities for testing disk full etc (e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3023&quot; title=&quot;IndexOutOfBoundsException after disk full on replication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3023&quot;&gt;SOLR-3023&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13419459" author="markrmiller@gmail.com" created="Fri, 20 Jul 2012 19:15:30 +0000"  >&lt;p&gt;Yeah, I&apos;m not ruling it out either - I try to be very careful before filing lucene bugs based on replication stuff and solrcloud especially (with all its jetty killing and what not). But I seemed to be able to cause the same situation with an isolated test (im not tripping the same assert, but causing a different exception in close because of the same invariant). So I&apos;m somewhat sure it&apos;s a real issue with the dir, but since I don&apos;t have a fix, I don&apos;t know for sure. I tried just over syncing by synchronizing every method in that dir, but no luck &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13419496" author="thetaphi" created="Fri, 20 Jul 2012 19:46:38 +0000"  >&lt;p&gt;I hope this will solve the tests on SDDS Jenkins, too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;BTW: Can somebody disable testing DIH? It fails 50% of all time in any test out of all.&lt;/p&gt;</comment>
                            <comment id="13419506" author="markrmiller@gmail.com" created="Fri, 20 Jul 2012 20:01:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;BTW: Can somebody disable testing DIH? It fails 50% of all time in any test out of all.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you be more specific &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;m trying to decipher 50% of all time in any test out of all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I know one particular test keeps failing that I see on jenkins - am I missing something, or is it more tests than that?&lt;/p&gt;

&lt;p&gt;Lets open an issue with the particulars and perhaps we can draw some attention to it.&lt;/p&gt;</comment>
                            <comment id="13419507" author="markrmiller@gmail.com" created="Fri, 20 Jul 2012 20:03:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;I hope this will solve the tests on SDDS Jenkins, too &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Usually when I see this particular test fail in jenkins runs, its that merge exception right? That is something else - I&apos;d need to dig back in emails, but I figured out what was causing that and we had a short discussion about it - the issue itself is harmless - we just have to figure out a way to make it so that it doesn&apos;t fail the test. If I&apos;m remembering right.&lt;/p&gt;</comment>
                            <comment id="13419509" author="jdyer" created="Fri, 20 Jul 2012 20:04:42 +0000"  >&lt;p&gt;Please don&apos;t disable DIH tests.  Its &quot;TestSqlEntityProcessorDelta2.testCompositePk_DeltaImport_add_delete&quot; that fails, right? Could we just @Ignore that one for now?  I do have it in mind to re-do all the SqlEntityProcessor tests, hopefully this Summer. (I&apos;m trying here to help save DIH from the &quot;svn rm&quot; that was proposed back in February!)&lt;/p&gt;</comment>
                            <comment id="13419517" author="thetaphi" created="Fri, 20 Jul 2012 20:13:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;Please don&apos;t disable DIH tests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t want to disable all tests &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But those who fail, I have no idea a bout the code, so somebody working on DIH should do it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Its &quot;TestSqlEntityProcessorDelta2.testCompositePk_DeltaImport_add_delete&quot; that fails, right? Could we just @Ignore that one for now?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you do this, please! It fails all the time. I am trying to ignore DIH completely, but this test failure annoys me. I tried to work on DIH and change all the API from Reader -&amp;gt; InputStream in the past (because the input can be anything else than text, like XML - which is not text, it just looks like it, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2347&quot; title=&quot;Use InputStream and not Reader for XML parsing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2347&quot;&gt;&lt;del&gt;SOLR-2347&lt;/del&gt;&lt;/a&gt;), but gave up.&lt;/p&gt;</comment>
                            <comment id="13419520" author="thetaphi" created="Fri, 20 Jul 2012 20:14:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;Usually when I see this particular test fail in jenkins runs, its that merge exception right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I dont know, it is quite often that TestZkRecover fails, too. I always see failing Solr tests, I have no idea anymore about what different types of patterns we have in the failures.&lt;/p&gt;</comment>
                            <comment id="13419567" author="markrmiller@gmail.com" created="Fri, 20 Jul 2012 20:59:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;I dont know, it is quite often that TestZkRecover fails, too&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, with that merge exception - it&apos;s not a real fail. The merge exception should be ignored and not fail the test.&lt;/p&gt;</comment>
                            <comment id="13419570" author="thetaphi" created="Fri, 20 Jul 2012 21:08:05 +0000"  >&lt;p&gt;Ah OK, it is still strange that this merge exception occurs. In my opinion that should not happen!&lt;/p&gt;</comment>
                            <comment id="13419584" author="markrmiller@gmail.com" created="Fri, 20 Jul 2012 21:23:38 +0000"  >&lt;p&gt;Off-topic now, but to keep this discussion in one place:&lt;/p&gt;

&lt;p&gt;See the discussion here: &lt;a href=&quot;http://markmail.org/message/txiwakxolegjqafv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/txiwakxolegjqafv&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I close the IW and tell it to wait for merges to finish. Then I close the directory. Because this is a cloud test with lost of jetties running, at the end of the test I have to shut them down - in many cases i want to test non graceful shutdowns - I want to shut them down quickly. That causes an interrupt, that causes IW.close to return, that causes the dir to be closed while merge threads are still running.&lt;/p&gt;

&lt;p&gt;From my tests perspective, I really don&apos;t care that this happens.&lt;/p&gt;

&lt;p&gt;I played around with always doing graceful shutdowns, but not only do I want to test none graceful shutdowns, making everything graceful makes the tests a lot longer. Also, I don&apos;t care about that exception even if it was killer, because either im going to restart jetty and replace that index with recovery or we are shutting down and the test is over. &lt;/p&gt;

&lt;p&gt;I&apos;m using the API&apos;s sanely - I can&apos;t control that interrupt easily.&lt;/p&gt;</comment>
                            <comment id="13419587" author="thetaphi" created="Fri, 20 Jul 2012 21:28:55 +0000"  >&lt;p&gt;Thanks for update! Sorry, I did not want to interrupt you working on that issue, it just looked similar to me.&lt;/p&gt;</comment>
                            <comment id="13443160" author="markrmiller@gmail.com" created="Tue, 28 Aug 2012 13:32:25 +0000"  >&lt;p&gt;This should be fixed now.&lt;/p&gt;</comment>
                            <comment id="13443162" author="dweiss" created="Tue, 28 Aug 2012 13:35:40 +0000"  >&lt;p&gt;Thanks Mark.&lt;/p&gt;</comment>
                            <comment id="15566548" author="arafalov" created="Tue, 11 Oct 2016 20:45:13 +0000"  >&lt;p&gt;Issues says &quot;all fixed&quot; 4 years ago. Close?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12599486">LUCENE-4238</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537382" name="RecoveryZkTest.testDistribSearch-100-tests-failures.txt.tgz" size="4947937" author="hossman" created="Fri, 20 Jul 2012 18:42:49 +0000"/>
                            <attachment id="12537383" name="just-failures.txt" size="24666" author="hossman" created="Fri, 20 Jul 2012 18:42:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03ddr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>