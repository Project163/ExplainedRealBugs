<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:22:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10472] Fix uninversioning of (single valued) PointFields &amp; clean up some related code</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10472</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>
&lt;p&gt;In getting caught up with the new PointsField work in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8396&quot; title=&quot;Add support for PointFields in Solr&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8396&quot;&gt;&lt;del&gt;SOLR-8396&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9987&quot; title=&quot;Implement support for multi-valued DocValues in PointFields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9987&quot;&gt;&lt;del&gt;SOLR-9987&lt;/del&gt;&lt;/a&gt; I realized:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;There&apos;s some inconsistencies/contridictions in how the new field types implement &lt;tt&gt;FieldType.getUninversionType&lt;/tt&gt; vs some of the error handling added to methods like &lt;tt&gt;SchemaField.checkSortability&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9987&quot; title=&quot;Implement support for multi-valued DocValues in PointFields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9987&quot;&gt;&lt;del&gt;SOLR-9987&lt;/del&gt;&lt;/a&gt;, &lt;tt&gt;SORTED_foo&lt;/tt&gt; constants were added to &lt;tt&gt;UninvertingReader&lt;/tt&gt; and used in the &lt;tt&gt;getUninversionType&lt;/tt&gt; methods for PointFields &amp;#8211; even though those constants are useless (because &lt;tt&gt;UninvertingReader&lt;/tt&gt; doesn&apos;t support uninverting multivalued points: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9202&quot; title=&quot;UninvertingReader needs multi-valued points support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9202&quot;&gt;SOLR-9202&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;the changes made to methods like &lt;tt&gt;SchemaField.checkSortability&lt;/tt&gt; to explicitly check &lt;tt&gt;isPointsField&lt;/tt&gt; should have never been needed if those methods were paying attention to &lt;tt&gt;getUninversionType&lt;/tt&gt; &amp;#8211; but those types of checks weren&apos;t added when &lt;tt&gt;getUninversionType&lt;/tt&gt; was introduced (the existing checks pre-date the DocValues API, back where any single-valued indexed field was implicitily &quot;uninvertable&quot;)&lt;/li&gt;
	&lt;li&gt;If all of the above is corrected, the only thing preventing &lt;tt&gt;UninvertedReader&lt;/tt&gt; from working properly with Solr&apos;s new PointField types (in the single valued case) is a trivial bug in &lt;tt&gt;IndexSchema&lt;/tt&gt; (being presumptutious about what is uninvertable)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m opening this issue to track fixing all of this, such that the end result will be:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;single valued PointFields will be uninvertable (ie: sortable even if they don&apos;t have docvalues)&lt;/li&gt;
	&lt;li&gt;error handling code will be simplified&lt;/li&gt;
	&lt;li&gt;unused/unsupported/misleading constants in &lt;tt&gt;UninvertingReader&lt;/tt&gt; will be removed.&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
        <key id="13062599">SOLR-10472</key>
            <summary>Fix uninversioning of (single valued) PointFields &amp; clean up some related code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Sat, 8 Apr 2017 00:55:06 +0000</created>
                <updated>Sat, 8 Jun 2019 15:20:11 +0000</updated>
                            <resolved>Tue, 18 Apr 2017 22:05:15 +0000</resolved>
                                                    <fixVersion>6.6</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15961612" author="hossman" created="Sat, 8 Apr 2017 00:56:50 +0000"  >
&lt;p&gt;Here&apos;s my starting point of a patch, showing:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the logic fixes for all &lt;tt&gt;IndexSchema&lt;/tt&gt; &amp;amp; all &lt;tt&gt;FooPointField&lt;/tt&gt; classes&lt;/li&gt;
	&lt;li&gt;corrected &lt;tt&gt;check*&lt;/tt&gt; methods in &lt;tt&gt;SchemaField&lt;/tt&gt;  (and simplifying the logic so it&apos;s more future proof for other similar classes down the road)&lt;/li&gt;
	&lt;li&gt;removal of usless/missleading constants from &lt;tt&gt;UninvertingReader&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;TestPointFields&lt;/tt&gt; changes demonstrating this new logic for sorting &lt;tt&gt;IntPointField&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;most of the remaining work needed is here, changing the tests for other types, fixing the FunctionQuery tests, and beefing up the test coverage&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;

&lt;p&gt;Note: i&apos;ll be offline for (at least) a week (vacation, then possible jury duty) so if there are comments/questions about this i won&apos;t be around to answer them for a while ... i&apos;ll plan on picking this back up when i return unless someone else beats me to it.&lt;/p&gt;</comment>
                            <comment id="15971455" author="hossman" created="Mon, 17 Apr 2017 18:30:53 +0000"  >&lt;p&gt;patch updated to master.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;LukeRequestHandlerTest.testLuke&lt;/tt&gt; is currently failing (reliably) in a weird way for reason i haven&apos;t wrapped by head around yet &amp;#8211; not sure if that&apos;s a new consequence of other changes on master, or something i overlooked before.&lt;/p&gt;

&lt;p&gt;since i haven&apos;t seen any objections/concerns to the overall idea of this jira, i&apos;ll plan on moving forward with fixing up the remaining nocommits and beefing up the tests &amp;#8211; starting with a dive into what&apos;s going wrong in &lt;tt&gt;testLuke&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15971952" author="hossman" created="Tue, 18 Apr 2017 01:22:29 +0000"  >
&lt;ul&gt;
	&lt;li&gt;the root cause of the testLuke failure was (evidently) because the &lt;tt&gt;IndexSchema&lt;/tt&gt; changes i had made for got to check if a field was &lt;tt&gt;indexed=true&lt;/tt&gt; before including it in the uninversion map - that seemed to trigger some unexpected code path in the &lt;tt&gt;LukeRequestHandler&lt;/tt&gt; which caused no response for non-indexed (non-docvalue) fields.&lt;/li&gt;
	&lt;li&gt;I resolved all the nocommits &amp;amp; beefed up the Points Sorting &amp;amp; ValueSource testing
	&lt;ul&gt;
		&lt;li&gt;i also fleshed out some more TODO items relating to sort missing first/last (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10501&quot; title=&quot;numeric PointsFields: need more testing of sortMissing=last|first for&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10501&quot;&gt;&lt;del&gt;SOLR-10501&lt;/del&gt;&lt;/a&gt;: there were already TODO items about this, improving the test coverage in this way shouldn&apos;t block the uninverting improvements)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Changing &lt;tt&gt;SchemaField.checkFieldCacheSource()&lt;/tt&gt; to check &lt;tt&gt;getUninversionType&lt;/tt&gt; led me to discover bugs in &lt;tt&gt;CurrencyField&lt;/tt&gt; &amp;#8211; it&apos;s &lt;tt&gt;getValueSource(field)&lt;/tt&gt; method was calling &lt;tt&gt;field.checkFieldCacheSource()&lt;/tt&gt; even though there is no reason why the &lt;tt&gt;field&lt;/tt&gt; itself needs to be indexed/docvalues &amp;#8211; that&apos;s the job of the underlying poly-fields, which were &lt;em&gt;NOT&lt;/em&gt; being checked, so i fixed that as well.
	&lt;ul&gt;
		&lt;li&gt;see also: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10502&quot; title=&quot;CurrencyField should support/default to docvalues for underlying polyfields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10502&quot;&gt;&lt;del&gt;SOLR-10502&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10503&quot; title=&quot;CurrencyField should be changed from TrieLongField to LongPointField for underlying raw-polyfield&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10503&quot;&gt;&lt;del&gt;SOLR-10503&lt;/del&gt;&lt;/a&gt;, both other CurrencyField improvements for the future i noticed while working looking into this.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15973287" author="jira-bot" created="Tue, 18 Apr 2017 18:58:44 +0000"  >&lt;p&gt;Commit 10772121eee97023aed415751e49a06d116b26ad in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1077212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1077212&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10472&quot; title=&quot;Fix uninversioning of (single valued) PointFields &amp;amp; clean up some related code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10472&quot;&gt;&lt;del&gt;SOLR-10472&lt;/del&gt;&lt;/a&gt;: Fixed uninversion (aka: FieldCache) bugs with the numeric PointField classes, and CurrencyField&lt;/p&gt;</comment>
                            <comment id="15973290" author="hossman" created="Tue, 18 Apr 2017 18:59:28 +0000"  >&lt;p&gt;on master, planning to backport to 6x this afternoon/tomorrow.&lt;/p&gt;</comment>
                            <comment id="15973597" author="jira-bot" created="Tue, 18 Apr 2017 22:02:55 +0000"  >&lt;p&gt;Commit dedb0255947ed936e001b244ff1859075398dc40 in lucene-solr&apos;s branch refs/heads/branch_6x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dedb025&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dedb025&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10472&quot; title=&quot;Fix uninversioning of (single valued) PointFields &amp;amp; clean up some related code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10472&quot;&gt;&lt;del&gt;SOLR-10472&lt;/del&gt;&lt;/a&gt;: Fixed uninversion (aka: FieldCache) bugs with the numeric PointField classes, and CurrencyField&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 10772121eee97023aed415751e49a06d116b26ad)&lt;/p&gt;

&lt;p&gt;Conflicts in test due to slightly diff internal DocValues APIs on master vs 6x&lt;br/&gt;
	solr/core/src/test/org/apache/solr/schema/TestPointFields.java&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13079254">SOLR-10872</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12863720" name="SOLR-10472.patch" size="53068" author="hossman" created="Tue, 18 Apr 2017 01:22:29 +0000"/>
                            <attachment id="12863670" name="SOLR-10472.patch" size="20523" author="hossman" created="Mon, 17 Apr 2017 18:30:53 +0000"/>
                            <attachment id="12862550" name="SOLR-10472.patch" size="20199" author="hossman" created="Sat, 8 Apr 2017 00:56:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ddvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>