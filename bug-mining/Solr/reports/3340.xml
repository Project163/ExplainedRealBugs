<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:21:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10387] zkTransfer normalizes destination path incorrectly if source is a windows directory </title>
                <link>https://issues.apache.org/jira/browse/SOLR-10387</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;While normalizing dest it is looking only for &apos;/&apos; in source path but this will not work for windows style delimiter.&lt;/p&gt;

&lt;p&gt;/lucene-solr/solr/solrj/src/java/org/apache/solr/common/cloud/ZkMaintenanceUtils.java&lt;/p&gt;

&lt;p&gt;  private static String normalizeDest(String srcName, String dstName) {&lt;br/&gt;
    if (dstName.endsWith(&quot;/&quot;)) { // Dest is a directory.&lt;br/&gt;
      int pos = srcName.lastIndexOf(&quot;/&quot;);&lt;br/&gt;
      if (pos &amp;lt; 0) {&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13060109">SOLR-10387</key>
            <summary>zkTransfer normalizes destination path incorrectly if source is a windows directory </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="gopikannan">gopikannan venugopalsamy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Mar 2017 18:38:46 +0000</created>
                <updated>Sat, 8 Jun 2019 15:32:04 +0000</updated>
                            <resolved>Thu, 30 Mar 2017 04:22:32 +0000</resolved>
                                                    <fixVersion>6.6</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15947835" author="erickerickson" created="Wed, 29 Mar 2017 20:30:26 +0000"  >&lt;p&gt;Ah, thanks. This may well be the recent test failures that I was about to try to track down. Figured it would be something to do with file separators. I just did a visual check and I think I&apos;ve corrected the problems. All of the remaining references to forward slash are ZooKeeper paths which don&apos;t have this problem.&lt;/p&gt;

&lt;p&gt;I don&apos;t have access to Windows machines to test, so if you could do any or all of these it would be an enormous favor:&lt;/p&gt;

&lt;p&gt;1&amp;gt; try running &lt;/p&gt;

&lt;p&gt;ant test  -Dtestcase=SolrCLIZkUtilsTest -Dtests.method=testCp -Dtests.seed=65C25EBE642D0428 -Dtests.slow=true -Dtests.locale=zh-CN -Dtests.timezone=Indian/Comoro -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1&lt;/p&gt;

&lt;p&gt;That&apos;s the failing Jenkins test. I want it to fail for you too before the patch.&lt;/p&gt;

&lt;p&gt;2&amp;gt; Apply the patch I&apos;ll attach to this JIRA. It&apos;s against trunk but it should apply to 6x.&lt;/p&gt;

&lt;p&gt;3&amp;gt; run the test in &amp;lt;1&amp;gt; again, I want it to succeed.... &lt;/p&gt;

&lt;p&gt;4&amp;gt; run through the scenario I outlined in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10108&quot; title=&quot;bin/solr script recursive copy broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10108&quot;&gt;&lt;del&gt;SOLR-10108&lt;/del&gt;&lt;/a&gt; on 19-Feb (here are the steps, there&apos;s some more explanation on that JIRA):&lt;br/&gt;
&amp;gt; Create a collection on Solr, any collection will do.&lt;br/&gt;
&amp;gt; &apos;bin/solr zk cp -r zk:/ &lt;a href=&quot;file:/some/dir&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/some/dir&lt;/a&gt; -z localhost:2181&apos;&lt;br/&gt;
&amp;gt; Shut down Solr&lt;br/&gt;
&amp;gt; Re-initialize ZK (wipe all the data)&lt;br/&gt;
&amp;gt; &apos;bin/solr zk cp -r &lt;a href=&quot;file:/some/dir/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/some/dir/&lt;/a&gt; zk:/ -z localhost:2181&apos;&lt;br/&gt;
&amp;gt; start Solr again&lt;br/&gt;
&amp;gt; You should see everything just as it was before.&lt;/p&gt;

&lt;p&gt;5&amp;gt; take a quick look at the help screens for cp (&apos;bin/solr.cmd zk -help&apos; should do it).&lt;/p&gt;

&lt;p&gt;Please feel free to attach a patch or just a corrected solr.cmd would be great too.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;
</comment>
                            <comment id="15947861" author="erickerickson" created="Wed, 29 Mar 2017 20:49:23 +0000"  >&lt;p&gt;Uploaded too soon, give me a few. Never mind, must have been hallucinating. Go ahead and try if if you can.&lt;/p&gt;</comment>
                            <comment id="15948075" author="gopikannan" created="Wed, 29 Mar 2017 23:20:56 +0000"  >&lt;p&gt;No, That did not work. The comment and code is not matching, As per comment we have to make checks on src not dest. Which one is right?&lt;br/&gt;
// Pull the last element of the src path and add it to the dst if the src does NOT end in a slash&lt;br/&gt;
// If the source ends in a slash, do not append the last segment to the dest&lt;br/&gt;
if (dstName.endsWith(&quot;/&quot;)) { // Dest is a directory.&lt;/p&gt;</comment>
                            <comment id="15948137" author="gopikannan" created="Thu, 30 Mar 2017 00:08:19 +0000"  >&lt;p&gt;Please check the patch I have attached, Tests succeed with it.&lt;/p&gt;

&lt;p&gt;If dest ends with separator or &apos;/&apos; depending on whether it is zk or local path, last component of source (again separator of source is &apos;/&apos; if is zk else local delimiter) is appended to dest.&lt;/p&gt;</comment>
                            <comment id="15948180" author="erickerickson" created="Thu, 30 Mar 2017 01:01:39 +0000"  >&lt;p&gt;I did change the comment as you&apos;re right it&apos;s confused. I dressed it up and put it above the method.&lt;/p&gt;

&lt;p&gt;That&apos;s not the code in the patch though. The first patch reads:&lt;/p&gt;

&lt;p&gt;    // If the dest ends in a file separator, it&apos;s a directory so append the last element of the src to it.    &lt;br/&gt;
    if (dstName.endsWith(File.separator)) { // Dest is a directory.&lt;br/&gt;
      int pos = srcName.lastIndexOf(File.separator);&lt;/p&gt;

&lt;p&gt;Actually, looking at it some more the patch is wrong anyway, I&apos;ll upload another version. The old one worked for me since the local fs separator is &apos;/&apos;. The above now reads as below: &lt;/p&gt;

&lt;p&gt;    String dstSeparator = (dstIsZk) ? &quot;/&quot; : File.separator;&lt;br/&gt;
    String srcSeparator = (srcIsZk) ? &quot;/&quot; : File.separator;&lt;/p&gt;

&lt;p&gt;    if (dstName.endsWith(dstSeparator)) { // Dest is a directory or non-leaf znode.&lt;br/&gt;
      int pos = srcName.lastIndexOf(srcSeparator);&lt;/p&gt;

&lt;p&gt;If this doesn&apos;t work for you, can you tell me a little more about &lt;em&gt;how&lt;/em&gt; it fails?&lt;/p&gt;

&lt;p&gt;Sorry for the run-around...&lt;/p&gt;
</comment>
                            <comment id="15948190" author="gopikannan" created="Thu, 30 Mar 2017 01:07:37 +0000"  >&lt;p&gt;Did you check the second patch I attached ? Tests passed with it.&lt;/p&gt;</comment>
                            <comment id="15948212" author="erickerickson" created="Thu, 30 Mar 2017 01:19:00 +0000"  >&lt;p&gt;Too funny! We both did he &lt;em&gt;exact&lt;/em&gt; same solution in the normalizeDest method, clear to naming the variables identically and passing in srcIsZk and dstIsZk as booleans.&lt;/p&gt;

&lt;p&gt;I was looking at the code in detail though, and I believe your patch doesn&apos;t handle the case of copying a single file from ZK to a local directory. This is the &lt;em&gt;last&lt;/em&gt; section in the method, the patch I just put up has this comment just above the code in question:&lt;/p&gt;

&lt;p&gt;// Single file ZK -&amp;gt; local copy where ZK is a leaf node&lt;br/&gt;
The test there is still &lt;br/&gt;
if (dst.endsWith(&quot;/&quot;) == false) dst += &quot;/&quot;;&lt;/p&gt;

&lt;p&gt;give me a minute to incorporate your test changes though.&lt;/p&gt;</comment>
                            <comment id="15948227" author="erickerickson" created="Thu, 30 Mar 2017 01:27:54 +0000"  >&lt;p&gt;I didn&apos;t notice you&apos;d put up a patch until after I had put up mine.&lt;/p&gt;

&lt;p&gt;See the comment though about copying single files from ZK-&amp;gt;local. Do you agree?&lt;/p&gt;

&lt;p&gt;This patch incorporates your test changes and our code fix.&lt;/p&gt;</comment>
                            <comment id="15948255" author="gopikannan" created="Thu, 30 Mar 2017 01:50:29 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Agreed, Tried the last patch, Tests went through. Thanks.&lt;/p&gt;</comment>
                            <comment id="15948277" author="erickerickson" created="Thu, 30 Mar 2017 02:10:40 +0000"  >&lt;p&gt;And thank &lt;em&gt;you&lt;/em&gt;. I&apos;ve been feeling guilty that I haven&apos;t been able to test this on Windows. I&apos;ll commit this this evening.&lt;/p&gt;</comment>
                            <comment id="15948394" author="erickerickson" created="Thu, 30 Mar 2017 04:14:31 +0000"  >&lt;p&gt;Final patch with CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15948395" author="jira-bot" created="Thu, 30 Mar 2017 04:14:42 +0000"  >&lt;p&gt;Commit edcdc3052ba95840593ace32d6d9a7a6e4ebe7ea in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=edcdc30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=edcdc30&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10387&quot; title=&quot;zkTransfer normalizes destination path incorrectly if source is a windows directory &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10387&quot;&gt;&lt;del&gt;SOLR-10387&lt;/del&gt;&lt;/a&gt;: zkTransfer normalizes destination path incorrectly if source is a windows directory&lt;/p&gt;</comment>
                            <comment id="15948403" author="jira-bot" created="Thu, 30 Mar 2017 04:20:26 +0000"  >&lt;p&gt;Commit 65982895f9d8c7437d912c12008ae4d9c4d87220 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6598289&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6598289&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10387&quot; title=&quot;zkTransfer normalizes destination path incorrectly if source is a windows directory &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10387&quot;&gt;&lt;del&gt;SOLR-10387&lt;/del&gt;&lt;/a&gt;: zkTransfer normalizes destination path incorrectly if source is a windows directory&lt;/p&gt;

&lt;p&gt;(cherry picked from commit edcdc30)&lt;/p&gt;</comment>
                            <comment id="15948405" author="erickerickson" created="Thu, 30 Mar 2017 04:22:32 +0000"  >&lt;p&gt;Thanks gopikannan!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13041577">SOLR-10108</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12861158" name="SOLR-10387.patch" size="8076" author="erickerickson" created="Thu, 30 Mar 2017 04:14:31 +0000"/>
                            <attachment id="12861139" name="SOLR-10387.patch" size="7610" author="erickerickson" created="Thu, 30 Mar 2017 01:27:54 +0000"/>
                            <attachment id="12861135" name="SOLR-10387.patch" size="4716" author="erickerickson" created="Thu, 30 Mar 2017 01:02:20 +0000"/>
                            <attachment id="12861127" name="SOLR-10387.patch" size="5206" author="gopikannan" created="Thu, 30 Mar 2017 00:08:19 +0000"/>
                            <attachment id="12861094" name="SOLR-10387.patch" size="1531" author="erickerickson" created="Wed, 29 Mar 2017 20:31:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cyi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>