<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:45:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11656] TLOG replication doesn&apos;t work properly after rebalancing leaders.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11656</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;With TLOG replica type, the replication may stop after invoking rebalance leaders API.&lt;br/&gt;
This can be reproduced by following steps:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Create SolrCloud with TLOG replica type.&lt;/li&gt;
	&lt;li&gt;Set perferredleader flag to some of no-leader nodes.&lt;/li&gt;
	&lt;li&gt;Invoke rebalance leaders API.&lt;/li&gt;
	&lt;li&gt;The replication stops in nodes which were &quot;leader&quot; before rebalancing.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Because the leader node doesn&apos;t have the replication thread, we need to create it when the status is changed from &quot;leader&quot; to &quot;replica&quot;. On the other hand, rebalance leaders API doesn&apos;t consider this matter, and the replication may stop if the status is changed from &quot;leader&quot; to &quot;replica&quot; by rebalance leaders.&lt;/p&gt;

&lt;p&gt;Note that, we can avoid this problem if we reload or restart Solr after rebalancing leaders.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13119193">SOLR-11656</key>
            <summary>TLOG replication doesn&apos;t work properly after rebalancing leaders.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="yuyano">Yuki Yano</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Nov 2017 10:48:46 +0000</created>
                <updated>Wed, 4 Nov 2020 15:21:35 +0000</updated>
                            <resolved>Fri, 24 Jul 2020 20:54:59 +0000</resolved>
                                    <version>7.1</version>
                                    <fixVersion>8.7</fixVersion>
                                    <component>replication (java)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16256830" author="yuyano" created="Fri, 17 Nov 2017 10:52:10 +0000"  >&lt;p&gt;Add code for restarting replication threads while rebalancing leaders.&lt;/p&gt;</comment>
                            <comment id="16257055" author="erickerickson" created="Fri, 17 Nov 2017 14:44:10 +0000"  >&lt;p&gt;I&apos;ll take a look over the weekend. Meanwhile I&apos;d note that the whole REBALANCELEADER functionality is only there for extreme cases (i.e. 100+ of leaders happened to land on the same node). The additional burden of being a leader is pretty miminal, to the point of being hard to measure if there just a few leaders on a particular node.&lt;/p&gt;

&lt;p&gt;This is still a bug, thanks for bringing it up and providing a patch. I&apos;m just suggesting you may just be better off avoiding REBALANCELEADERS altogether, but then I don&apos;t know your setup so it may indeed be beneficial.&lt;/p&gt;
</comment>
                            <comment id="16304974" author="erickerickson" created="Thu, 28 Dec 2017 01:22:57 +0000"  >&lt;p&gt;Now I&apos;m wondering if there&apos;s some generic issue with replicas changing roles and coordinating with non NRT replica types?&lt;/p&gt;

&lt;p&gt;These may not be related, but they seem like they&apos;re in the same ballpark.&lt;/p&gt;</comment>
                            <comment id="16305680" author="samuel.tatipamula" created="Thu, 28 Dec 2017 19:26:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; I have observed that, once a reload command is issued on a collection, all PULL replicas stop replicating. Thought this may be similar to the issue being discussed here. Check &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11794&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-11794&lt;/a&gt; for more details.&lt;/p&gt;</comment>
                            <comment id="17160825" author="erickerickson" created="Sun, 19 Jul 2020 22:02:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; Any comments? The fix is a small chunk of code. I&apos;ve updated the patch so it applies to trunk making a couple of very minor changes along the way.&lt;/p&gt;

&lt;p&gt;Apologies to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuyano&quot; class=&quot;user-hover&quot; rel=&quot;yuyano&quot;&gt;yuyano&lt;/a&gt;&#160; for taking sooooo long to get to this.&lt;/p&gt;</comment>
                            <comment id="17164625" author="jira-bot" created="Fri, 24 Jul 2020 20:50:11 +0000"  >&lt;p&gt;Commit 4b2e90b3aaf6d49034727fb5dad59a8bd37f131e in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4b2e90b3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4b2e90b3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11656&quot; title=&quot;TLOG replication doesn&amp;#39;t work properly after rebalancing leaders.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11656&quot;&gt;&lt;del&gt;SOLR-11656&lt;/del&gt;&lt;/a&gt;: TLOG replication doesn&apos;t work properly after rebalancing leaders.&lt;/p&gt;</comment>
                            <comment id="17164626" author="jira-bot" created="Fri, 24 Jul 2020 20:50:29 +0000"  >&lt;p&gt;Commit f95e485d9467a13df3abf1f9383abda92eab1486 in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f95e485&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f95e485&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11656&quot; title=&quot;TLOG replication doesn&amp;#39;t work properly after rebalancing leaders.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11656&quot;&gt;&lt;del&gt;SOLR-11656&lt;/del&gt;&lt;/a&gt;: TLOG replication doesn&apos;t work properly after rebalancing leaders.&lt;/p&gt;</comment>
                            <comment id="17164676" author="tomasflobbe" created="Fri, 24 Jul 2020 23:25:21 +0000"  >&lt;p&gt;Sorry Erick, I couldn&apos;t find the time to get to this (and review everything I don&apos;t remember about this part of the code). commit LGTM. &lt;/p&gt;</comment>
                            <comment id="17165719" author="jira-bot" created="Mon, 27 Jul 2020 13:42:47 +0000"  >&lt;p&gt;Commit 4b2e90b3aaf6d49034727fb5dad59a8bd37f131e in lucene-solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14608&quot; title=&quot;Faster sorting for the /export handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14608&quot;&gt;&lt;del&gt;SOLR-14608&lt;/del&gt;&lt;/a&gt;-export from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4b2e90b3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4b2e90b3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11656&quot; title=&quot;TLOG replication doesn&amp;#39;t work properly after rebalancing leaders.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11656&quot;&gt;&lt;del&gt;SOLR-11656&lt;/del&gt;&lt;/a&gt;: TLOG replication doesn&apos;t work properly after rebalancing leaders.&lt;/p&gt;</comment>
                            <comment id="17226120" author="atri" created="Wed, 4 Nov 2020 15:21:35 +0000"  >&lt;p&gt;Closing after the 8.7.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13048668">SOLR-10233</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13127222">SOLR-11794</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13007974" name="SOLR-11656.patch" size="7030" author="erickerickson" created="Sun, 19 Jul 2020 22:01:09 +0000"/>
                            <attachment id="12898186" name="SOLR-11656.patch" size="6488" author="yuyano" created="Fri, 17 Nov 2017 10:51:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mx73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>