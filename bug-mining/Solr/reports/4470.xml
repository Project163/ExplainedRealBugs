<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:43:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12353] SolrDispatchFilter expensive non-conditional debug line degrades performance</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12353</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;We use Solr 6.6.3. Recently on one network when switching on authentication (security.json) began experiencing significant delays (5-10 seconds) to fulfill each request to /solr index.&lt;/p&gt;

&lt;p&gt;I debugged the issue and it was essentially triggered by line 456 of SolrDispatchFilter.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Request to authenticate: {}, domain: {}, port: {}&quot;&lt;/span&gt;, request, request.getLocalName(), request.getLocalPort());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The issue is that on machines and networks with poor configuration or DNS issues in particular, request.getLocalName() can trigger expensive reverse DNS queries for the ethernet interfaces, and will only return within reasonable timeframe if manually written into /etc/hosts.&lt;/p&gt;

&lt;p&gt;More to the point, request.getLocalName() should be considered an expensive operation in general, and in SolrDispatchFilter it runs unconditionally even if debug is disabled.&lt;/p&gt;

&lt;p&gt;I would suggest to either replace request.getLocalName/Port here, or at the least, wrap the debug operation so it doesn&apos;t affect any production systems:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (log.isDebugEnabled()) {
    log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Request to authenticate: {}, domain: {}, port: {}&quot;&lt;/span&gt;, request, request.getLocalName(), request.getLocalPort());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The authenticateRequest method in question is private so we could not override it and making another HttpServletRequestWrapper to circumvent the servlet API was doubtful.&lt;/p&gt;

&lt;p&gt;Thank you&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13159206">SOLR-12353</key>
            <summary>SolrDispatchFilter expensive non-conditional debug line degrades performance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="pplx">Pascal Proulx</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 May 2018 20:59:16 +0000</created>
                <updated>Wed, 15 Jul 2020 15:09:02 +0000</updated>
                            <resolved>Thu, 19 Mar 2020 19:46:56 +0000</resolved>
                                    <version>6.6.3</version>
                                    <fixVersion>8.6</fixVersion>
                                    <component>Admin UI</component>
                    <component>Authentication</component>
                    <component>logging</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16474821" author="elyograg" created="Mon, 14 May 2018 21:27:49 +0000"  >&lt;p&gt;General advice for logger usage is to NOT wrap with the isXxxxEnabled call except in cases where obtaining logging parameters is likely to be slow and the level being tested is not enabled by default.&lt;/p&gt;

&lt;p&gt;The quick solution, which we could do as a stepping stone, is to wrap this logging in isDebugEnabled as you have suggested.&lt;/p&gt;

&lt;p&gt;Thinking larger ... I don&apos;t see any point to having hostname and port information in the debug log at all.  If it is actually useful, then getLocalName could be replaced with getLocalAddr.  Such log entries are unlikely to be viewed by anybody who doesn&apos;t know how the system is configured, so having an IP address in the log would not introduce a significant administrative burden.  Possible replacements without isDebugEnabled, my preferred first:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Request to authenticate: {}&quot;&lt;/span&gt;, request);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Request to authenticate: {}, address: {}, port: {}&quot;&lt;/span&gt;, request, request.getLocalAddr(), request.getLocalPort());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Side note: IMHO the /etc/hosts file should always contain an entry for every network interface on the machine.  But the simple fact is that users have configurations that aren&apos;t perfect, and Solr should work well even if the system config is not ideal.  Thanks for bringing the issue to our attention!&lt;/p&gt;</comment>
                            <comment id="16484441" author="pplx" created="Tue, 22 May 2018 19:19:01 +0000"  >&lt;p&gt;Sorry I thought I had replied. I believe any of that would remedy the issue in our case. I suppose I&apos;d agree about hosts file on prod machines. But in our case it affects developer(s) as well, where that&apos;s impractical, so it does happen. Thanks&lt;/p&gt;</comment>
                            <comment id="17062889" author="jira-bot" created="Thu, 19 Mar 2020 19:40:26 +0000"  >&lt;p&gt;Commit 5fd55d77e9f5e3da620171e4348a9450c2ee3482 in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5fd55d7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5fd55d7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12353&quot; title=&quot;SolrDispatchFilter expensive non-conditional debug line degrades performance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12353&quot;&gt;&lt;del&gt;SOLR-12353&lt;/del&gt;&lt;/a&gt;: SolrDispatchFilter expensive non-conditional debug line degrades performance&lt;/p&gt;</comment>
                            <comment id="17062892" author="jira-bot" created="Thu, 19 Mar 2020 19:46:14 +0000"  >&lt;p&gt;Commit 338784214525a3c92a5c9593d2db948c7b40d3b0 in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3387842&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3387842&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12353&quot; title=&quot;SolrDispatchFilter expensive non-conditional debug line degrades performance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12353&quot;&gt;&lt;del&gt;SOLR-12353&lt;/del&gt;&lt;/a&gt;: SolrDispatchFilter expensive non-conditional debug line degrades performance&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 5fd55d77e9f5e3da620171e4348a9450c2ee3482)&lt;/p&gt;</comment>
                            <comment id="17158258" author="broustant" created="Wed, 15 Jul 2020 15:09:02 +0000"  >&lt;p&gt;Closing after the 8.6.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3toyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>