<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:34:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12130] Investigate why CdcrReplicationDistributedZkTest is slow</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12130</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;CdcrReplicationDistributedZkTest seems to be a very slow test and probably why it was marked nightly in the first place?&lt;/p&gt;

&lt;p&gt;Investigate why the test is so slow and see if we can speed it up&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13146579">SOLR-12130</key>
            <summary>Investigate why CdcrReplicationDistributedZkTest is slow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Mar 2018 15:43:00 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:33 +0000</updated>
                            <resolved>Thu, 6 Sep 2018 02:11:33 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16407929" author="sarkaramrit2@gmail.com" created="Wed, 21 Mar 2018 13:46:13 +0000"  >&lt;p&gt;Tests total time: &lt;b&gt;30 minutes&lt;/b&gt; approx.&lt;/p&gt;

&lt;p&gt;Following is the approx time taken by each test-method in the testclass:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;test method&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;time in ms&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;time&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testBatchBoundaries()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;120651&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2min&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testReplicationStartStop()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;240897&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4min&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testReplicationAfterLeaderChange()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;231003&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4min&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testUpdateLogSynchronisation()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;121818&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2min&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testDeleteCreateSourceCollection()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;37309&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;36sec&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testReplicationAfterRestart()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;300130&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5min&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testBatchAddsWithDelete()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4143&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4sec&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testOps()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5048&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5sec&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testResilienceWithDeleteByQueryOnTarget()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;122769&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2min&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testTargetCollectionNotAvailable()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5860&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6sec&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;testBufferOnNonLeader()&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;33203&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;33sec&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;total: round about &lt;b&gt;18 minutes, 20 seconds&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;In the test-class for each test-method, 2x2 collection of source and target are created. meaning we are creating 8 cores for every test-method, 4 for source, 4 for target.&lt;/p&gt;

&lt;p&gt;so total &lt;b&gt;11 minutes 40&#160;seconds&lt;/b&gt;&#160;are consumed in preparation (get collections up and running) and destruction (purging of cores and its data) for all the test methods.&lt;/p&gt;

&lt;p&gt;Next thing to do is to understand what each test is doing and if we can optimise / avoid.&lt;/p&gt;</comment>
                            <comment id="16415504" author="sarkaramrit2@gmail.com" created="Tue, 27 Mar 2018 12:20:31 +0000"  >&lt;p&gt;Understood what each test method is doing and isolated test methods which doesn&apos;t need multiple shards and able to lower down tests time from 30 minutes to 22 minutes, didn&apos;t even change code until now.&lt;/p&gt;</comment>
                            <comment id="16440371" author="varunthacker" created="Tue, 17 Apr 2018 04:33:16 +0000"  >&lt;p&gt;I spoke to Amrit offline , let&apos;s&#160;leverage&#160;SolrCloudTestCase and create the collections only once. This refactoring should save us a ton of time&lt;/p&gt;</comment>
                            <comment id="16463703" author="sarkaramrit2@gmail.com" created="Fri, 4 May 2018 10:53:43 +0000"  >&lt;p&gt;Thanks Varun,&lt;/p&gt;

&lt;p&gt;I have broken down the testClass in two; uploaded patch with first test class which centers on operations, resilience and indexing boundaries, doesn&apos;t require server restarts. Ran successfully, patch precommit pass; this should be a good start to fixing this test class.&lt;/p&gt;

&lt;p&gt;I am already working on second half of this test class which needs graceful server restarts, still struggling with &lt;tt&gt;BaseCdcrDistributedZkTest&lt;/tt&gt;, will update as soon as I finish this.&lt;/p&gt;</comment>
                            <comment id="16570392" author="shalinmangar" created="Mon, 6 Aug 2018 15:53:59 +0000"  >&lt;p&gt;What&apos;s the status on these improvements? Is it just waiting for a review+commit?&lt;/p&gt;</comment>
                            <comment id="16573206" author="sarkaramrit2@gmail.com" created="Wed, 8 Aug 2018 13:06:35 +0000"  >&lt;p&gt;Thanks Shalin, I updated jira as per master. Not able to run precommit successfully, broken HTML files. These are few of test methods of the problematic test class which I am not sure when stopped running successfully (after what improvement / jira). I am still working on other set of test methods.&lt;/p&gt;</comment>
                            <comment id="16582281" author="shalinmangar" created="Thu, 16 Aug 2018 09:43:10 +0000"  >&lt;p&gt;Hi Amrit, your patch only adds a new test. Did you mean to remove those methods from the CdcrReplicationDistributedZkTest test as well?&lt;/p&gt;</comment>
                            <comment id="16582358" author="sarkaramrit2@gmail.com" created="Thu, 16 Aug 2018 11:07:47 +0000"  >&lt;p&gt;Thanks Shalin. Yes, those methods will be removed from CdcrReplicationDistributedZkTest. I am running last beast run for the new test, will upload fresh patch with respective methods removed from problematic test class.&lt;/p&gt;</comment>
                            <comment id="16582378" author="sarkaramrit2@gmail.com" created="Thu, 16 Aug 2018 11:31:52 +0000"  >&lt;p&gt;Uploaded fresh patch, against master. updated CdcrReplicationDistributedZkTest.&lt;/p&gt;</comment>
                            <comment id="16583233" author="shalinmangar" created="Fri, 17 Aug 2018 01:02:37 +0000"  >&lt;p&gt;The latest patch has a BadApple annotation removed from the following tests:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;testReplicationStartStop&lt;/li&gt;
	&lt;li&gt;testOps&lt;/li&gt;
	&lt;li&gt;testBatchAddsWithDelete&lt;/li&gt;
	&lt;li&gt;testBatchBoundaries&lt;/li&gt;
	&lt;li&gt;testResilienceWithDeleteByQueryOnTarget&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Is that intentional? Otherwise, we are just displacing the failures to a different test. I&apos;d rather fix the failures first and then work on making the test run faster.&lt;/p&gt;</comment>
                            <comment id="16583805" author="sarkaramrit2@gmail.com" created="Fri, 17 Aug 2018 11:40:07 +0000"  >&lt;p&gt;Hi Shalin, thanks for reviewing the patch. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Is that intentional? Otherwise, we are just displacing the failures to a different test.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We are solving these test failures along with making them faster. All the test methods are almost failing due to &lt;tt&gt;BaseCdcrDistributedZkTest&lt;/tt&gt; base test class, extended by CdcrReplicationDistributedZkTest.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;CdcrOpsAndBoundariesTest&lt;/tt&gt; extends SolrCaseTest4j, along with removal of irrelevant checks / assertions at multiple places. I did a beast testing of 50 rounds, CdcrOpsAndBoundariesTest runs successfully. Made small amendments in latest patch to remove further irrelevant assertions.&lt;/p&gt;</comment>
                            <comment id="16584271" author="sarkaramrit2@gmail.com" created="Fri, 17 Aug 2018 18:44:04 +0000"  >&lt;p&gt;Updated new patch with remaining tests, I need to add proper comments for the assertions to make sense. Will upload another patch shortly.&lt;/p&gt;</comment>
                            <comment id="16585525" author="sarkaramrit2@gmail.com" created="Mon, 20 Aug 2018 07:23:06 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;, updated patch uploaded, added more assertions to make it more tight. Beast run round 100 passed.&lt;/p&gt;</comment>
                            <comment id="16585679" author="jira-bot" created="Mon, 20 Aug 2018 09:19:26 +0000"  >&lt;p&gt;Commit 1c0f95ee044af5e0c072fabb3ad423c61f0e033b in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1c0f95e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1c0f95e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12130&quot; title=&quot;Investigate why CdcrReplicationDistributedZkTest is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12130&quot;&gt;&lt;del&gt;SOLR-12130&lt;/del&gt;&lt;/a&gt;: CdcrReplicationDistributedZkTest is broken into two test classes, CdcrOpsAndBoundariesTest which does not require node restarts and CdcrWithNodesRestartsTest which does. The tests themselves are made faster and more resilient to spurious failures&lt;/p&gt;</comment>
                            <comment id="16585680" author="jira-bot" created="Mon, 20 Aug 2018 09:20:00 +0000"  >&lt;p&gt;Commit 569d77103e8c38dc8f5b78b3ac88a7dde4da5f86 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=569d771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=569d771&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12130&quot; title=&quot;Investigate why CdcrReplicationDistributedZkTest is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12130&quot;&gt;&lt;del&gt;SOLR-12130&lt;/del&gt;&lt;/a&gt;: CdcrReplicationDistributedZkTest is broken into two test classes, CdcrOpsAndBoundariesTest which does not require node restarts and CdcrWithNodesRestartsTest which does. The tests themselves are made faster and more resilient to spurious failures&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1c0f95ee044af5e0c072fabb3ad423c61f0e033b)&lt;/p&gt;</comment>
                            <comment id="16585796" author="shalinmangar" created="Mon, 20 Aug 2018 11:12:44 +0000"  >&lt;p&gt;Thanks Amrit. I&apos;ll keep this issue open for a few days and keep an eye on how jenkins does on these tests.&lt;/p&gt;</comment>
                            <comment id="16586762" author="jira-bot" created="Tue, 21 Aug 2018 01:30:38 +0000"  >&lt;p&gt;Commit 1c0f95ee044af5e0c072fabb3ad423c61f0e033b in lucene-solr&apos;s branch refs/heads/jira/http2 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1c0f95e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1c0f95e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12130&quot; title=&quot;Investigate why CdcrReplicationDistributedZkTest is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12130&quot;&gt;&lt;del&gt;SOLR-12130&lt;/del&gt;&lt;/a&gt;: CdcrReplicationDistributedZkTest is broken into two test classes, CdcrOpsAndBoundariesTest which does not require node restarts and CdcrWithNodesRestartsTest which does. The tests themselves are made faster and more resilient to spurious failures&lt;/p&gt;</comment>
                            <comment id="16605174" author="shalinmangar" created="Thu, 6 Sep 2018 02:11:33 +0000"  >&lt;p&gt;The test failures are mostly fixed although I do see 0.26% (1 in 375) failures on CdcrWithNodesRestartsTest. Since 7.5 release is imminent, I&apos;ll close this issue. We can open others to fix the rare failures.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarkaramrit2%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sarkaramrit2@gmail.com&quot;&gt;sarkaramrit2@gmail.com&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12936147" name="SOLR-12130.patch" size="59519" author="sarkaramrit2@gmail.com" created="Sat, 18 Aug 2018 13:09:26 +0000"/>
                            <attachment id="12936082" name="SOLR-12130.patch" size="57034" author="sarkaramrit2@gmail.com" created="Fri, 17 Aug 2018 20:33:59 +0000"/>
                            <attachment id="12936066" name="SOLR-12130.patch" size="55807" author="sarkaramrit2@gmail.com" created="Fri, 17 Aug 2018 18:45:50 +0000"/>
                            <attachment id="12936010" name="SOLR-12130.patch" size="28165" author="sarkaramrit2@gmail.com" created="Fri, 17 Aug 2018 12:27:51 +0000"/>
                            <attachment id="12935857" name="SOLR-12130.patch" size="28219" author="sarkaramrit2@gmail.com" created="Thu, 16 Aug 2018 12:44:32 +0000"/>
                            <attachment id="12934792" name="SOLR-12130.patch" size="14983" author="sarkaramrit2@gmail.com" created="Wed, 8 Aug 2018 10:38:50 +0000"/>
                            <attachment id="12921920" name="SOLR-12130.patch" size="14800" author="sarkaramrit2@gmail.com" created="Fri, 4 May 2018 10:47:34 +0000"/>
                            <attachment id="12917182" name="SOLR-12130.patch" size="24078" author="sarkaramrit2@gmail.com" created="Mon, 2 Apr 2018 11:07:42 +0000"/>
                            <attachment id="12916390" name="SOLR-12130.patch" size="24478" author="sarkaramrit2@gmail.com" created="Tue, 27 Mar 2018 12:20:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3rjv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>