<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:10:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17160] Bulk admin operations may fail because of max tracked requests</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17160</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In&#160;&lt;tt&gt;CoreAdminHandler&lt;/tt&gt;, we maintain in-memory the list of in-flight requests and completed/failed request.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note they are core/replica level async requests, and not top level requests which mostly at the collection level. Top level requests are tracked by storing the async ID in a Zookeeper node, which is not related to this ticket.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For completed/failed requests, we only track a maximum of 100 requests by dropping the oldest ones. The typical client in &lt;tt&gt;CollectionHandlingUtils.waitForCoreAdminAsyncCallToComplete()&lt;/tt&gt; polls status of the submitted requests, with a retry loop until requests are completed. If for some reason we have more than 100 requests that complete or fail on a node before all statuses are polled by the client, the statuses are lost and the client will fail with an unexpected error similar to:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Invalid status request for requestId: &apos;&lt;em&gt;&amp;lt;id&amp;gt;&lt;/em&gt;&apos; - &apos;notfound&apos;. Retried &lt;em&gt;&amp;lt;n&amp;gt;&lt;/em&gt; times&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Instead of having a hard limit for the number of requests we track, we could have time based eviction. I think it makes sense to keep status of a request until a given timeout, and then drop it ignoring how many requests we currently track.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13568454">SOLR-17160</key>
            <summary>Bulk admin operations may fail because of max tracked requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pierre.salagnac">Pierre Salagnac</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 14 Feb 2024 16:19:00 +0000</created>
                <updated>Fri, 25 Oct 2024 17:18:57 +0000</updated>
                            <resolved>Tue, 16 Jul 2024 23:55:45 +0000</resolved>
                                    <version>8.11</version>
                    <version>9.5</version>
                                    <fixVersion>9.7</fixVersion>
                                    <component>Backup/Restore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10800">3h</timespent>
                                <comments>
                            <comment id="17821680" author="gus_heck" created="Wed, 28 Feb 2024 14:04:49 +0000"  >&lt;p&gt;This concept worries me. I think it&apos;s fine to have this as an option, but not as a default. By default it should be limited to a set memory footprint otherwise it becomes a DOS target.&lt;/p&gt;</comment>
                            <comment id="17821812" author="pierre.salagnac" created="Wed, 28 Feb 2024 18:32:50 +0000"  >&lt;p&gt;Thanks for raising this concern &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gus&quot; class=&quot;user-hover&quot; rel=&quot;gus&quot;&gt;gus&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Currently, this code is already somehow vulnerable to DOS. Even if we don&apos;t grow forever in memory, we only track 100 requests. So if we bomb Solr with unwanted admin requests, the legitimate ones will fail from the client point of view, because the client won&apos;t be able to retrieve the completion statuses?&lt;/p&gt;

&lt;p&gt;But I agree not having any limited memory footprint at all is not ideal. In addition to time based eviction, I can add a max size for the cache. I was thinking it doing this initially, but I dropped it as it showed to be unnecessary.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I thinking of adding a limit much higher than the 100 requests tracked tracked, can be 10K. Most of the time, we should never hit this limit, and in case of a DOS, it should be sufficient to protect the host from an abusive memory utilization here.&lt;/p&gt;</comment>
                            <comment id="17821831" author="gus_heck" created="Wed, 28 Feb 2024 19:06:35 +0000"  >&lt;p&gt;Interfering with some requests is perhaps less problematic than running the server out of memory IMHO YMMV. Also, the client sees failure, but the original request still gets executed right? So client code that &lt;b&gt;really&lt;/b&gt; cares can trap this case and re-verify heuristically, or re-send if idempotent...&lt;/p&gt;</comment>
                            <comment id="17822029" author="pierre.salagnac" created="Thu, 29 Feb 2024 09:22:36 +0000"  >&lt;p&gt;I added a max limit at 10K tracked requests in the pull requests.&lt;br/&gt;
Please let me know if you still have concerns on memory utilization.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="17822738" author="dsmiley" created="Sat, 2 Mar 2024 02:21:04 +0000"  >&lt;p&gt;Even at the top level (ZK), the async IDs are capped at 10K before getting purged &amp;#8211; SizeLimitedDistributedMap with org.apache.solr.cloud.Overseer#NUM_RESPONSES_TO_STORE (10K).&lt;/p&gt;

&lt;p&gt;100 is clearly way too low.&lt;/p&gt;</comment>
                            <comment id="17842698" author="gerlowskija" created="Wed, 1 May 2024 15:57:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;100 is clearly way too low.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1...to tweaking the &quot;maxItems&quot;.  A value like 500 (or even 1000) makes it much much less likely that IDs will &quot;disappear&quot; in the normal case, and still provides some protection against DOS or memory leak concerns.&lt;/p&gt;</comment>
                            <comment id="17842732" author="dsmiley" created="Wed, 1 May 2024 18:08:10 +0000"  >&lt;p&gt;BTW I think Denial of Service should be a non-concern for admin APIs.&lt;/p&gt;</comment>
                            <comment id="17864007" author="dsmiley" created="Tue, 9 Jul 2024 04:47:06 +0000"  >&lt;p&gt;FYI I plan to merge the linked PR soon with the following CHANGES.txt summary:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Core Admin &quot;async&quot; request status tracking is no longer capped at 100; it&apos;s 10k.  Statuses are now removed 5 minutes after the read of a completed/failed status.   &lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17866175" author="jira-bot" created="Mon, 15 Jul 2024 21:04:41 +0000"  >&lt;p&gt;Commit d3b4c2e1ae39b8ecc5428798531f8b7cf723d787 in solr&apos;s branch refs/heads/main from Pierre Salagnac&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=d3b4c2e1ae3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=d3b4c2e1ae3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17160&quot; title=&quot;Bulk admin operations may fail because of max tracked requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17160&quot;&gt;&lt;del&gt;SOLR-17160&lt;/del&gt;&lt;/a&gt;: Core admin async ID status, 10k limit and time expire (#2304)&lt;/p&gt;

&lt;p&gt;Core Admin &quot;async&quot; request status tracking is no longer capped at 100; it&apos;s 10k.&lt;br/&gt;
Statuses are now removed 5 minutes after the read of a completed/failed status.&lt;br/&gt;
Helps collection async backup/restore and other operations scale to 100+ shards.&lt;/p&gt;

&lt;p&gt;Co-authored-by: David Smiley &amp;lt;dsmiley@salesforce.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17866499" author="jira-bot" created="Tue, 16 Jul 2024 18:08:23 +0000"  >&lt;p&gt;Commit 338fbdacbecaba76741fe5f8b755e2374f88d8a0 in solr&apos;s branch refs/heads/branch_9x from Pierre Salagnac&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=338fbdacbec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=338fbdacbec&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17160&quot; title=&quot;Bulk admin operations may fail because of max tracked requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17160&quot;&gt;&lt;del&gt;SOLR-17160&lt;/del&gt;&lt;/a&gt;: Core admin async ID status, 10k limit and time expire (#2304)&lt;/p&gt;

&lt;p&gt;Core Admin &quot;async&quot; request status tracking is no longer capped at 100; it&apos;s 10k.&lt;br/&gt;
Statuses are now removed 5 minutes after the read of a completed/failed status.&lt;br/&gt;
Helps collection async backup/restore and other operations scale to 100+ shards.&lt;/p&gt;

&lt;p&gt;Co-authored-by: David Smiley &amp;lt;dsmiley@salesforce.com&amp;gt;&lt;br/&gt;
(cherry picked from commit d3b4c2e1ae39b8ecc5428798531f8b7cf723d787)&lt;/p&gt;</comment>
                            <comment id="17866531" author="jira-bot" created="Tue, 16 Jul 2024 20:28:43 +0000"  >&lt;p&gt;Commit 338fbdacbecaba76741fe5f8b755e2374f88d8a0 in solr&apos;s branch refs/heads/backport_&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16842&quot; title=&quot;Eliminate special case code in solrCLI by introducing VersionTool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16842&quot;&gt;&lt;del&gt;SOLR-16842&lt;/del&gt;&lt;/a&gt;_to_branch_9x from Pierre Salagnac&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=338fbdacbec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=338fbdacbec&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17160&quot; title=&quot;Bulk admin operations may fail because of max tracked requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17160&quot;&gt;&lt;del&gt;SOLR-17160&lt;/del&gt;&lt;/a&gt;: Core admin async ID status, 10k limit and time expire (#2304)&lt;/p&gt;

&lt;p&gt;Core Admin &quot;async&quot; request status tracking is no longer capped at 100; it&apos;s 10k.&lt;br/&gt;
Statuses are now removed 5 minutes after the read of a completed/failed status.&lt;br/&gt;
Helps collection async backup/restore and other operations scale to 100+ shards.&lt;/p&gt;

&lt;p&gt;Co-authored-by: David Smiley &amp;lt;dsmiley@salesforce.com&amp;gt;&lt;br/&gt;
(cherry picked from commit d3b4c2e1ae39b8ecc5428798531f8b7cf723d787)&lt;/p&gt;</comment>
                            <comment id="17866558" author="dsmiley" created="Tue, 16 Jul 2024 23:55:45 +0000"  >&lt;p&gt;Merged.  Thanks for contributing!&lt;/p&gt;</comment>
                            <comment id="17892949" author="anshumg" created="Fri, 25 Oct 2024 17:18:57 +0000"  >&lt;p&gt;Closing after the 9.7.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ne8o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>