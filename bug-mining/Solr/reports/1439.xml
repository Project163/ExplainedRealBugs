<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:37:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4923] Replica index is one version behind sending the commit to non-leader instance</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4923</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I was actually trying to debug an issue we experiencing in production where the replica version is ahead from the leader when I noticed this problem.&lt;/p&gt;

&lt;p&gt;For my tests I&apos;m running two Solr instances with distributed updates (SolrCloud). ZK runs embedded within one of the instances.&lt;/p&gt;

&lt;p&gt;The test consists on updating one field in single document. If I send an update to the leader the index is replicated correctly. However, if I run the update against the follower replica only the leader is updated correctly. I can reproduce this using both hard and soft commits. Here is the command I&apos;m running:&lt;/p&gt;

&lt;p&gt;curl &quot;http://localhost:8999/solr/rulePreview/update?commit=true&amp;amp;softCommit=true&quot; -H &quot;Content-Type: text/xml&quot; --data-binary &apos;&amp;lt;add&amp;gt;...&amp;lt;/add&amp;gt;&lt;/p&gt;

&lt;p&gt;If I execute a second commit against the follower the leader will have the most recent update and the follower will be update from the first commit.&lt;/p&gt;

&lt;p&gt;For example, my field is named category and initially it contains the value cat_1. If update the value to cat_2 the leader sees the change but the follower doesn&apos;t. If a second commit updates the field to cat_3 the leader will return cat_3 but the follower return cat_2. &lt;/p&gt;

&lt;p&gt;Reloading the core in the follower fixes the problem.&lt;/p&gt;

&lt;p&gt;The logs seem to confirm the follower gets the latest index version. However, the version in the logs doesn&apos;t matches the on in the Core Admin UI nor Luke. Here are some logs from the leader:&lt;/p&gt;

&lt;p&gt;Jun 12, 2013 10:34:19 PM org.apache.solr.update.processor.LogUpdateProcessor finish&lt;br/&gt;
INFO: &lt;span class=&quot;error&quot;&gt;&amp;#91;rulePreview_en&amp;#93;&lt;/span&gt; webapp=/solr path=/update params=&lt;/p&gt;
{distrib.from=http://192.168.1.106:8998/solr/rulePreview_en/&amp;amp;update.distrib=TOLEADER&amp;amp;wt=javabin&amp;amp;version=2}
&lt;p&gt; &lt;/p&gt;
{add=[importedRedirect1 (1437700518392627200)]} 0 11&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.update.DirectUpdateHandler2 commit&lt;br/&gt;
INFO: start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=true,prepareCommit=false}&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.search.SolrIndexSearcher &amp;lt;init&amp;gt;&lt;br/&gt;
INFO: Opening Searcher@47e4e06c main&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.update.DirectUpdateHandler2 commit&lt;br/&gt;
INFO: end_commit_flush&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.core.QuerySenderListener newSearcher&lt;br/&gt;
INFO: QuerySenderListener sending requests to Searcher@47e4e06c main{StandardDirectoryReader(segments_3g:467:nrt _2a(4.2.1):C134/1 _3c(4.2.1):C1)}&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.core.QuerySenderListener newSearcher&lt;br/&gt;
INFO: QuerySenderListener done.&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.core.SolrCore registerSearcher&lt;br/&gt;
INFO: &lt;span class=&quot;error&quot;&gt;&amp;#91;rulePreview_en&amp;#93;&lt;/span&gt; Registered new searcher Searcher@47e4e06c main{StandardDirectoryReader(segments_3g:467:nrt _2a(4.2.1):C134/1 _3c(4.2.1):C1)}&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.update.processor.LogUpdateProcessor finish&lt;br/&gt;
INFO: &lt;span class=&quot;error&quot;&gt;&amp;#91;rulePreview_en&amp;#93;&lt;/span&gt; webapp=/solr path=/update params={waitSearcher=true&amp;amp;commit=true&amp;amp;wt=javabin&amp;amp;expungeDeletes=false&amp;amp;commit_end_point=true&amp;amp;version=2&amp;amp;softCommit=true} {commit=} 0 12&lt;br/&gt;
&lt;br/&gt;
And the logs from the follower:&lt;br/&gt;
&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.update.DirectUpdateHandler2 commit&lt;br/&gt;
INFO: start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=true,prepareCommit=false}&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.search.SolrIndexSearcher &amp;lt;init&amp;gt;&lt;br/&gt;
INFO: Opening Searcher@1e23cfc main&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.update.DirectUpdateHandler2 commit&lt;br/&gt;
INFO: end_commit_flush&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.core.QuerySenderListener newSearcher&lt;br/&gt;
INFO: QuerySenderListener sending requests to Searcher@1e23cfc main{StandardDirectoryReader(segments_3i:463:nrt _2a(4.2.1):C134/1 _3b(4.2.1):C1)}&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.core.QuerySenderListener newSearcher&lt;br/&gt;
INFO: QuerySenderListener done.&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.core.SolrCore registerSearcher&lt;br/&gt;
INFO: &lt;span class=&quot;error&quot;&gt;&amp;#91;rulePreview_en&amp;#93;&lt;/span&gt; Registered new searcher Searcher@1e23cfc main{StandardDirectoryReader(segments_3i:463:nrt _2a(4.2.1):C134/1 _3b(4.2.1):C1)}&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.update.processor.LogUpdateProcessor finish&lt;br/&gt;
INFO: &lt;span class=&quot;error&quot;&gt;&amp;#91;rulePreview_en&amp;#93;&lt;/span&gt; webapp=/solr path=/update params={distrib.from=http://192.168.1.106:8999/solr/rulePreview_en/&amp;amp;update.distrib=FROMLEADER&amp;amp;wt=javabin&amp;amp;version=2} {add=[importedRedirect1 (1437700518392627200)]}
&lt;p&gt; 0 4&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.update.SolrCmdDistributor distribCommit&lt;br/&gt;
INFO: Distrib commit to:&lt;span class=&quot;error&quot;&gt;&amp;#91;StdNode: http://192.168.1.106:8999/solr/rulePreview_en/&amp;#93;&lt;/span&gt; params:commit_end_point=true&amp;amp;commit=true&amp;amp;softCommit=true&amp;amp;waitSearcher=true&amp;amp;expungeDeletes=false&lt;br/&gt;
Jun 12, 2013 10:34:19 PM org.apache.solr.update.processor.LogUpdateProcessor finish&lt;br/&gt;
INFO: &lt;span class=&quot;error&quot;&gt;&amp;#91;rulePreview_en&amp;#93;&lt;/span&gt; webapp=/solr path=/update params=&lt;/p&gt;
{softCommit=true}
&lt;p&gt; &lt;/p&gt;
{add=[importedRedirect1],commit=}
&lt;p&gt; 0 41&lt;/p&gt;</description>
                <environment>&lt;p&gt;Solr 4.2.1&lt;br/&gt;
OS X 10.8.3&lt;/p&gt;</environment>
        <key id="12652557">SOLR-4923</key>
            <summary>Replica index is one version behind sending the commit to non-leader instance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="rmerizalde">Ricardo Merizalde</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Jun 2013 04:41:41 +0000</created>
                <updated>Mon, 9 May 2016 18:43:56 +0000</updated>
                            <resolved>Mon, 17 Jun 2013 20:02:39 +0000</resolved>
                                    <version>4.2</version>
                                    <fixVersion>4.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>replication (java)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13682853" author="hossman" created="Thu, 13 Jun 2013 22:42:22 +0000"  >&lt;p&gt;Hmmm...&lt;/p&gt;

&lt;p&gt;I can&apos;t explain it &amp;#8211; but i can reproduce this fairly trivially on trunk using the example configs...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Spin up two ports using numShards=1...&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ java -Dbootstrap_confdir=./solr/collection1/conf -Dcollection.configName=myconf -DzkRun -DnumShards=1 -jar start.jar 
$ java -Djetty.port=7574 -DzkHost=localhost:9983 -jar start.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;use UI to confirm that 8983 is the leader and 7574 is it&apos;s replica&lt;/li&gt;
	&lt;li&gt;send a doc to the 7574 replica and observe the results of querying against the two distinct replicas...&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ curl &quot;http://localhost:8983/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:7574/solr/collection1/update?commit=true&amp;amp;wt=json&amp;amp;omitHeader=true&quot; -H &apos;Content-Type: text/xml&apos; --data-binary &apos;&amp;lt;add&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;field name=&quot;id&quot;&amp;gt;HOSS&amp;lt;/field&amp;gt;&amp;lt;field name=&quot;cat_s&quot;&amp;gt;1&amp;lt;/field&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/add&amp;gt;&apos;
{}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:8983/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;docs&quot;:[{&quot;id&quot;:&quot;HOSS&quot;,&quot;cat_s&quot;:&quot;1&quot;,&quot;_version_&quot;:1437767149083951104}]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;wait a bit and retry in case there is some delay in replication...&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;send a new version of the doc to the 7574 replica and observe the results of querying against the two distinct replicas...&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ curl &quot;http://localhost:7574/solr/collection1/update?commit=true&amp;amp;wt=json&amp;amp;omitHeader=true&quot; -H &apos;Content-Type: text/xml&apos; --data-binary &apos;&amp;lt;add&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;field name=&quot;id&quot;&amp;gt;HOSS&amp;lt;/field&amp;gt;&amp;lt;field name=&quot;cat_s&quot;&amp;gt;2&amp;lt;/field&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/add&amp;gt;&apos;
{}
$ curl &quot;http://localhost:7574/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;docs&quot;:[{&quot;id&quot;:&quot;HOSS&quot;,&quot;cat_s&quot;:&quot;1&quot;,&quot;_version_&quot;:1437767149083951104}]}}
$ curl &quot;http://localhost:8983/solr/collection1/select?q=id:HOSS&amp;amp;wt=json&amp;amp;omitHeader=true&quot;
{&quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;docs&quot;:[{&quot;id&quot;:&quot;HOSS&quot;,&quot;cat_s&quot;:&quot;2&quot;,&quot;_version_&quot;:1437767405646381056}]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll see if i can work up a JUnit test.&lt;/p&gt;</comment>
                            <comment id="13682873" author="hossman" created="Thu, 13 Jun 2013 23:04:32 +0000"  >&lt;p&gt;Sample logs from the replica during my manual testing...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;replica @ moment of update&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;580025 [qtp541763983-15] INFO  org.apache.solr.update.UpdateHandler  &#8211; start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}
580142 [qtp541763983-15] INFO  org.apache.solr.core.SolrCore  &#8211; SolrDeletionPolicy.onCommit: commits: num=2
	commit{dir=NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/home/hossman/lucene/dev/solr/example2/solr/collection1/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@2d508aed; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_b,generation=11}
	commit{dir=NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/home/hossman/lucene/dev/solr/example2/solr/collection1/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@2d508aed; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_c,generation=12}
580143 [qtp541763983-15] INFO  org.apache.solr.core.SolrCore  &#8211; newest commit generation = 12
580144 [qtp541763983-15] INFO  org.apache.solr.search.SolrIndexSearcher  &#8211; Opening Searcher@60d2cd99 main
580145 [qtp541763983-15] INFO  org.apache.solr.update.UpdateHandler  &#8211; end_commit_flush
580145 [searcherExecutor-5-thread-1] INFO  org.apache.solr.core.SolrCore  &#8211; QuerySenderListener sending requests to Searcher@60d2cd99 main{StandardDirectoryReader(segments_b:15:nrt _3(5.0):c1)}
580146 [searcherExecutor-5-thread-1] INFO  org.apache.solr.core.SolrCore  &#8211; QuerySenderListener done.
580151 [searcherExecutor-5-thread-1] INFO  org.apache.solr.core.SolrCore  &#8211; [collection1] Registered new searcher Searcher@60d2cd99 main{StandardDirectoryReader(segments_b:15:nrt _3(5.0):c1)}
580170 [qtp541763983-18] INFO  org.apache.solr.update.processor.LogUpdateProcessor  &#8211; [collection1] webapp=/solr path=/update params={distrib.from=http://127.0.1.1:8983/solr/collection1/&amp;amp;update.distrib=FROMLEADER&amp;amp;wt=javabin&amp;amp;version=2} {add=[HOSS (1437769792183336960)]} 0 4
580173 [qtp541763983-15] INFO  org.apache.solr.update.SolrCmdDistributor  &#8211; Distrib commit to:[StdNode: http://127.0.1.1:8983/solr/collection1/] params:commit_end_point=true&amp;amp;commit=true&amp;amp;softCommit=false&amp;amp;waitSearcher=true&amp;amp;expungeDeletes=false
580426 [qtp541763983-15] INFO  org.apache.solr.update.processor.LogUpdateProcessor  &#8211; [collection1] webapp=/solr path=/update params={omitHeader=true&amp;amp;commit=true&amp;amp;wt=json} {add=[HOSS],commit=} 0 402
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;replica a few seconds later&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;595170 [commitScheduler-7-thread-1] INFO  org.apache.solr.update.UpdateHandler  &#8211; start commit{,optimize=false,openSearcher=false,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}
595355 [commitScheduler-7-thread-1] INFO  org.apache.solr.core.SolrCore  &#8211; SolrDeletionPolicy.onCommit: commits: num=2
	commit{dir=NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/home/hossman/lucene/dev/solr/example2/solr/collection1/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@2d508aed; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_c,generation=12}
	commit{dir=NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/home/hossman/lucene/dev/solr/example2/solr/collection1/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@2d508aed; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_d,generation=13}
595355 [commitScheduler-7-thread-1] INFO  org.apache.solr.core.SolrCore  &#8211; newest commit generation = 13
595359 [commitScheduler-7-thread-1] INFO  org.apache.solr.search.SolrIndexSearcher  &#8211; Opening Searcher@140ffc1 realtime
595360 [commitScheduler-7-thread-1] INFO  org.apache.solr.update.UpdateHandler  &#8211; end_commit_flush
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see that the &quot;explicit&quot; commit (with &quot;openSearcher=true&quot;) seems to be happening first, then the replica recieves the distrib update back from the leader, then a &quot;Distrib commit to: &amp;lt;leader&amp;gt;&quot; (that i&apos;m not familiar with) is logged by the replica.  A few seconds later, the autoCommit on the replica kicks in, but this uses openSearcher=false since that&apos;s what&apos;s in solrconfig.xml&lt;/p&gt;</comment>
                            <comment id="13682880" author="markrmiller@gmail.com" created="Thu, 13 Jun 2013 23:12:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;You can see that the &quot;explicit&quot; commit (with &quot;openSearcher=true&quot;) seems to be happening first, then the replica recieves the distrib update back from the leader&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That sounds like the issue here - the local commit on the replica really needs to come after that update comes back?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;then a &quot;Distrib commit to: &amp;lt;leader&amp;gt;&quot; (that i&apos;m not familiar with) is logged by the replica.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;After the local commit, we ask everyone else in the colleciton to commit.&lt;/p&gt;</comment>
                            <comment id="13682889" author="markrmiller@gmail.com" created="Thu, 13 Jun 2013 23:17:30 +0000"  >&lt;p&gt;I think your test will be key hossman.&lt;/p&gt;

&lt;p&gt;The following patch is also a good idea, though it does not catch this. It randomly turns off sending only to leaders on CloudSolrServers in tests.&lt;/p&gt;</comment>
                            <comment id="13683034" author="markrmiller@gmail.com" created="Fri, 14 Jun 2013 02:50:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman_lucene%40fucit.org&quot; class=&quot;user-hover&quot; rel=&quot;hossman_lucene@fucit.org&quot;&gt;hossman_lucene@fucit.org&lt;/a&gt; if you can write a test, I &lt;b&gt;think&lt;/b&gt; the attached patch will likely make it pass.&lt;/p&gt;

&lt;p&gt;It&apos;s also an improvement in general as we were doing a local commit and then committing on everyone else in the collection - it really took the length of two commits at least essentially. This does them all in parallel, and should address the issue by having the replica push it&apos;s commit through the solr cmd distributor so that it should play nicer with buffering - rather than just nailing it locally right away.&lt;/p&gt;</comment>
                            <comment id="13683885" author="hossman" created="Fri, 14 Jun 2013 22:53:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; here&apos;s a patch that modifies BasicDistributedZkTest to reliably produce a failure which i &lt;em&gt;think&lt;/em&gt; is the same as the one being dicussed here.&lt;/p&gt;

&lt;p&gt;with your patch applied, my patch stops failing.&lt;/p&gt;</comment>
                            <comment id="13685614" author="commit-tag-bot" created="Mon, 17 Jun 2013 14:31:22 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; markrmiller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493779&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4923&quot; title=&quot;Replica index is one version behind sending the commit to non-leader instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4923&quot;&gt;&lt;del&gt;SOLR-4923&lt;/del&gt;&lt;/a&gt;: Commits to non leaders as part of a request that also contain updates can execute out of order.&lt;/p&gt;</comment>
                            <comment id="13685621" author="commit-tag-bot" created="Mon, 17 Jun 2013 14:37:49 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; markrmiller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493782&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4923&quot; title=&quot;Replica index is one version behind sending the commit to non-leader instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4923&quot;&gt;&lt;del&gt;SOLR-4923&lt;/del&gt;&lt;/a&gt;: add optimization CHANGES entry&lt;/p&gt;</comment>
                            <comment id="13685674" author="commit-tag-bot" created="Mon, 17 Jun 2013 16:13:38 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; markrmiller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493829&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493829&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4923&quot; title=&quot;Replica index is one version behind sending the commit to non-leader instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4923&quot;&gt;&lt;del&gt;SOLR-4923&lt;/del&gt;&lt;/a&gt;: add missing credit&lt;/p&gt;</comment>
                            <comment id="13685717" author="commit-tag-bot" created="Mon, 17 Jun 2013 17:05:03 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; markrmiller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493846&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4923&quot; title=&quot;Replica index is one version behind sending the commit to non-leader instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4923&quot;&gt;&lt;del&gt;SOLR-4923&lt;/del&gt;&lt;/a&gt;: Commits to non leaders as part of a request that also contain updates can execute out of order.&lt;/p&gt;</comment>
                            <comment id="13685771" author="commit-tag-bot" created="Mon, 17 Jun 2013 17:58:07 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; markrmiller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493861&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493861&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4923&quot; title=&quot;Replica index is one version behind sending the commit to non-leader instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4923&quot;&gt;&lt;del&gt;SOLR-4923&lt;/del&gt;&lt;/a&gt;: do not test if not sending to leaders first&lt;/p&gt;</comment>
                            <comment id="13685846" author="commit-tag-bot" created="Mon, 17 Jun 2013 18:53:32 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; markrmiller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493885&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1493885&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4923&quot; title=&quot;Replica index is one version behind sending the commit to non-leader instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4923&quot;&gt;&lt;del&gt;SOLR-4923&lt;/del&gt;&lt;/a&gt;: Commits to non leaders as part of a request that also contain updates can execute out of order.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4923&quot; title=&quot;Replica index is one version behind sending the commit to non-leader instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4923&quot;&gt;&lt;del&gt;SOLR-4923&lt;/del&gt;&lt;/a&gt;: add optimization CHANGES entry&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4923&quot; title=&quot;Replica index is one version behind sending the commit to non-leader instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4923&quot;&gt;&lt;del&gt;SOLR-4923&lt;/del&gt;&lt;/a&gt;: add missing credit&lt;/p&gt;</comment>
                            <comment id="13685911" author="markrmiller@gmail.com" created="Mon, 17 Jun 2013 20:02:39 +0000"  >&lt;p&gt;Thanks guys!&lt;/p&gt;</comment>
                            <comment id="13716852" author="steve_rowe" created="Tue, 23 Jul 2013 18:38:46 +0000"  >&lt;p&gt;Bulk close resolved 4.4 issues&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12587727" name="SOLR-4923-test-1.patch" size="3799" author="markrmiller@gmail.com" created="Thu, 13 Jun 2013 23:17:30 +0000"/>
                            <attachment id="12587761" name="SOLR-4923.patch" size="6902" author="markrmiller@gmail.com" created="Fri, 14 Jun 2013 02:50:27 +0000"/>
                            <attachment id="12587918" name="SOLR-4923_hoss_test.patch" size="8521" author="hossman" created="Fri, 14 Jun 2013 22:53:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lfav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333209</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>