<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:30:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11794] PULL replicas stop replicating after a RELOAD collection action</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11794</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;UPDATE&quot;&gt;&lt;/a&gt;&lt;b&gt;UPDATE&lt;/b&gt;&lt;/h3&gt;
&lt;p&gt;PULL replica replication stops after calling the RELOAD collection API, even without any config/schema changes!&lt;br/&gt;
It&apos;s also happening when schema API is used to add a new field.&lt;/p&gt;


&lt;p&gt;An operating SolrCloud with NRT, TLOG, and PULL replicas.&lt;br/&gt;
Solr - 7.1.0&lt;br/&gt;
ZK - 3.4.10&lt;/p&gt;

&lt;p&gt;Used config set - sample_techproducts_configs&lt;br/&gt;
Shards - 1&lt;/p&gt;

&lt;p&gt;Whenever a schema change (adding of new fields/changing field types) is pushed to ZK and the collection is reloaded using&lt;br/&gt;
/solr/admin/collections?action=RELOAD&amp;amp;name=sample, the index changes stop replicating to PULL replicas. NRT and TLOG are able to replicate the index.&lt;/p&gt;

&lt;p&gt;Before the schema change, I can see the indexFetcher thread running on PULL replica&lt;br/&gt;
2017-12-26 10:17:11.802 INFO  (indexFetcher-14-thread-1) &lt;span class=&quot;error&quot;&gt;&amp;#91;c:sample s:shard1 r:core_node6 x:sample_shard1_replica_p5&amp;#93;&lt;/span&gt; o.a.s.h.IndexFetcher Master&apos;s generation: 2&lt;br/&gt;
2017-12-26 10:17:11.802 INFO  (indexFetcher-14-thread-1) &lt;span class=&quot;error&quot;&gt;&amp;#91;c:sample s:shard1 r:core_node6 x:sample_shard1_replica_p5&amp;#93;&lt;/span&gt; o.a.s.h.IndexFetcher Master&apos;s version: 1514283298419&lt;br/&gt;
2017-12-26 10:17:11.802 INFO  (indexFetcher-14-thread-1) &lt;span class=&quot;error&quot;&gt;&amp;#91;c:sample s:shard1 r:core_node6 x:sample_shard1_replica_p5&amp;#93;&lt;/span&gt; o.a.s.h.IndexFetcher Slave&apos;s generation: 2&lt;br/&gt;
2017-12-26 10:17:11.802 INFO  (indexFetcher-14-thread-1) &lt;span class=&quot;error&quot;&gt;&amp;#91;c:sample s:shard1 r:core_node6 x:sample_shard1_replica_p5&amp;#93;&lt;/span&gt; o.a.s.h.IndexFetcher Slave&apos;s version: 1514283298419&lt;br/&gt;
2017-12-26 10:17:11.802 INFO  (indexFetcher-14-thread-1) &lt;span class=&quot;error&quot;&gt;&amp;#91;c:sample s:shard1 r:core_node6 x:sample_shard1_replica_p5&amp;#93;&lt;/span&gt; o.a.s.h.IndexFetcher Slave in sync with master.&lt;/p&gt;

&lt;p&gt;After that, the following change in schema that is made to managed-schema of sample_techproducts_configs, pushed to ZK, and collection reloaded.&lt;br/&gt;
&amp;lt;field name=&quot;testpoint_1&quot; type=&quot;point&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;field name=&quot;testpoint_2&quot; type=&quot;point&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;field name=&quot;testpoint_3&quot; type=&quot;point&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;I can no longer see IndexFetcher thread running on PULL replica. No logs are printed. The logs end with the collection reload log&lt;br/&gt;
2017-12-26 10:22:09.256 INFO  (qtp128526626-16) &lt;span class=&quot;error&quot;&gt;&amp;#91;c:sample s:shard1 r:core_node6 x:sample_shard1_replica_p5&amp;#93;&lt;/span&gt; o.a.s.s.HttpSolrCall &lt;span class=&quot;error&quot;&gt;&amp;#91;admin&amp;#93;&lt;/span&gt; webapp=null path=/admin/cores params=&lt;/p&gt;
{core=sample_shard1_replica_p5&amp;amp;qt=/admin/cores&amp;amp;action=RELOAD&amp;amp;wt=javabin&amp;amp;version=2}
&lt;p&gt; status=0 QTime=624&lt;/p&gt;

&lt;p&gt;The index is never modified after this, and leader doesn&apos;t get the polls from the PULL replica.&lt;/p&gt;

&lt;p&gt;Observations:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Manually forcing an index fetch using /replication?command=fetchindex syncs the index, but doesn&apos;t start the IndexFetcher polling.&lt;/li&gt;
	&lt;li&gt;Restarting the replica will sync the index, starts IndexFetcher thread and polling.&lt;/li&gt;
	&lt;li&gt;Removing and adding the replica back as PULL will sync the index, starts IndexFetcher thread and polling.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Linux version 2.6.32-642.15.1.el6.x86_64 (mockbuild@c1bm.rdu2.centos.org) (gcc version 4.4.7 20120313 (Red Hat 4.4.7-17) (GCC) ) #1 SMP Fri Feb 24 14:31:22 UTC 2017&lt;/p&gt;</environment>
        <key id="13127222">SOLR-11794</key>
            <summary>PULL replicas stop replicating after a RELOAD collection action</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tflobbe">Tomas Eduardo Fernandez Lobbe</assignee>
                                    <reporter username="samuel.tatipamula">Samuel Tatipamula</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Tue, 26 Dec 2017 15:38:01 +0000</created>
                <updated>Wed, 2 Oct 2019 17:30:43 +0000</updated>
                            <resolved>Tue, 16 Jan 2018 00:20:07 +0000</resolved>
                                    <version>7.1</version>
                    <version>7.2</version>
                                    <fixVersion>7.3</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>replication (java)</component>
                    <component>Schema and Analysis</component>
                    <component>SolrCloud</component>
                    <component>update</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16303896" author="samuel.tatipamula" created="Tue, 26 Dec 2017 15:39:13 +0000"  >&lt;p&gt;I have faced the same issue on Mac environment also, OS X EI Capitan 10.11.6.&lt;br/&gt;
Please let me know if any information is missing. I can add the full logs and any missing information.&lt;/p&gt;</comment>
                            <comment id="16304397" author="samuel.tatipamula" created="Wed, 27 Dec 2017 09:45:08 +0000"  >&lt;p&gt;I have tried just hitting the RELOAD collection API without making any changes to any config files, and able to replicate the same issue.&lt;br/&gt;
Able to replicate the issue in 7.2 also.&lt;br/&gt;
Able to replicate the issue even if the schema change is added via /schema (v2) api, which is predictable given the API internally calls the reload collection API on all nodes.&lt;/p&gt;

&lt;p&gt;Really surprised that nobody else has noticed this issue till now.&lt;/p&gt;</comment>
                            <comment id="16305720" author="samuel.tatipamula" created="Thu, 28 Dec 2017 20:26:57 +0000"  >&lt;p&gt;Adding a working patch - not sure if it is the optimal way to go about starting the replication after the core reload.&lt;/p&gt;</comment>
                            <comment id="16306650" author="tomasflobbe" created="Sat, 30 Dec 2017 02:38:00 +0000"  >&lt;p&gt;I&#8217;m on vacations now, I can take a look once I get back, unless someone else beats me to it. There is a test that performs a RELOAD on a collection with PULL replicas, not sure why that would work and not in this case.&lt;/p&gt;</comment>
                            <comment id="16326641" author="tomasflobbe" created="Mon, 15 Jan 2018 23:50:13 +0000"  >&lt;p&gt;Attached a new patch with a test case.&lt;/p&gt;</comment>
                            <comment id="16326646" author="jira-bot" created="Tue, 16 Jan 2018 00:15:23 +0000"  >&lt;p&gt;Commit 1c4b417c50cc167818a9baf656c8f1f21614262f in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1c4b417&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1c4b417&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11794&quot; title=&quot;PULL replicas stop replicating after a RELOAD collection action&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11794&quot;&gt;&lt;del&gt;SOLR-11794&lt;/del&gt;&lt;/a&gt;: Restart replicate from ledaer on core reload on PULL replicas&lt;/p&gt;</comment>
                            <comment id="16326647" author="jira-bot" created="Tue, 16 Jan 2018 00:16:26 +0000"  >&lt;p&gt;Commit 2df83cfd3b0d1c746e6e5132d2641ba82217c69c in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2df83cf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2df83cf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11794&quot; title=&quot;PULL replicas stop replicating after a RELOAD collection action&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11794&quot;&gt;&lt;del&gt;SOLR-11794&lt;/del&gt;&lt;/a&gt;: Restart replicate from ledaer on core reload on PULL replicas&lt;/p&gt;</comment>
                            <comment id="16326648" author="tomasflobbe" created="Tue, 16 Jan 2018 00:19:36 +0000"  >&lt;p&gt;Unfortunately I didn&apos;t get to this on time for 7.2.1, I&apos;ll mark it fixed for 7.3 and backport if there is a 7.2.2&lt;/p&gt;</comment>
                            <comment id="16326649" author="tomasflobbe" created="Tue, 16 Jan 2018 00:20:07 +0000"  >&lt;p&gt;Thanks Samuel!&lt;/p&gt;</comment>
                            <comment id="16326850" author="samuel.tatipamula" created="Tue, 16 Jan 2018 08:08:54 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; for the fix.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13119193">SOLR-11656</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12906148" name="SOLR-11794.patch" size="5965" author="tflobbe" created="Mon, 15 Jan 2018 23:49:38 +0000"/>
                            <attachment id="12903938" name="SOLR-11794.patch" size="693" author="samuel.tatipamula" created="Thu, 28 Dec 2017 20:25:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3oai7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>