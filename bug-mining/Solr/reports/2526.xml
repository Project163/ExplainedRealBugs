<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7667] If more cores are loaded at startup than the transient core size, cores become unavailable.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7667</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Edwin Lee from the user&apos;s list caught this, the original post is titled &quot;loadOnStartup &amp;amp; transientCoreSize &amp;amp; BUG Report on CoreContainer.java&quot;&lt;/p&gt;

&lt;p&gt;Nice catch Edwin!&lt;/p&gt;

&lt;p&gt;More details to follow:&lt;/p&gt;</description>
                <environment></environment>
        <key id="12837192">SOLR-7667</key>
            <summary>If more cores are loaded at startup than the transient core size, cores become unavailable.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Jun 2015 16:32:10 +0000</created>
                <updated>Wed, 17 Jun 2015 04:41:45 +0000</updated>
                            <resolved>Wed, 17 Jun 2015 04:41:45 +0000</resolved>
                                    <version>4.10.3</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14583586" author="edwinjhlee" created="Fri, 12 Jun 2015 15:44:26 +0000"  >&lt;p&gt;A situation like this,&lt;/p&gt;

&lt;p&gt;    transientSize=2&lt;br/&gt;
    create 6 transient cores, and all of them are loadOnStarup=True&lt;br/&gt;
    Restart solr.&lt;/p&gt;

&lt;p&gt;    Then, you will find 2 cores loaded, let say core5, core6. They work fine.&lt;br/&gt;
    But you cannot access core1, core2, core3, core4. There is no failure, no error message. But you just need to keep waiting&#8230; Forever.&lt;/p&gt;

&lt;p&gt;    What make thing even funnier, you open the JConsole, you will find 6 core&#8217;s metrics are there &#8212; In a normal situation, there should only be two cores metrics.&lt;/p&gt;</comment>
                            <comment id="14583587" author="edwinjhlee" created="Fri, 12 Jun 2015 15:45:37 +0000"  >&lt;p&gt;Reason:&lt;br/&gt;
-----------------------&lt;br/&gt;
Read the log, you will find core1, core2, core3, core4 are closing &#8212;- But actually they are not.&lt;br/&gt;
In Solr code, you will find core1-4 are just remove from the list in core container. But the actual closing operation are not done. Because the closer thread are hang!&lt;/p&gt;

&lt;p&gt;How to bypass it:&lt;br/&gt;
-----------------------&lt;br/&gt;
There may be plenty ways to bypass this bug. And I am listing the 1 way:&lt;/p&gt;

&lt;p&gt;    make sure there is at lease one transient core(let call it &#8220;SaviorCore&#8221;) who is loadOnStarup=False&lt;br/&gt;
    When the Situation described above happen, send luke/mbean/any request to load &#8220;SaviorCore&#8221;. Then you will find core1, core2, core3, core4 are actually closed in the JConsole.&lt;/p&gt;

&lt;p&gt;&#8203;&lt;/p&gt;</comment>
                            <comment id="14583590" author="edwinjhlee" created="Fri, 12 Jun 2015 15:48:14 +0000"  >&lt;p&gt;The code involved are SolreCores.java allowCateLazyCores() and CoreContainer.java CloserThread.run()&lt;br/&gt;
---------------------------------------------------------------------------------------&lt;br/&gt;
I modify the solr code to confirm my conclusion. I give the wait a time out by&lt;/p&gt;

&lt;p&gt;     log.info(&quot;Edwin&apos;s Log: We are trying to fix the startup problem&quot;);&lt;br/&gt;
     solrCores.getModifyLock().wait(1000);&lt;br/&gt;
     log.info(&quot;end waiting.&quot;);&lt;br/&gt;
--------------------------------------------------------------------------------------&lt;br/&gt;
Situation gone. But that is only a proof of concept. It is hard to specify a reasonable timeout value on which every one agree.&lt;/p&gt;</comment>
                            <comment id="14583603" author="edwinjhlee" created="Fri, 12 Jun 2015 15:58:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erike4711%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;erike4711@yahoo.com&quot;&gt;erike4711@yahoo.com&lt;/a&gt; Thanks for your help to set this up.&lt;/p&gt;

&lt;p&gt;I think it is a classical producer/consumer scenario,  a right place for the BlockingQueue. But it involves several code modification and the modifylock hold us back. &lt;/p&gt;

&lt;p&gt;I am only also thinking whether we can expand the modifylock scope to include the actual core close operation, like it. But it didn&apos;t work.&lt;/p&gt;

&lt;p&gt;  @Override&lt;br/&gt;
  public void run() {&lt;br/&gt;
    while (! container.isShutDown()) {&lt;br/&gt;
      synchronized (solrCores.getModifyLock()) { // need this so we can wait and be awoken.&lt;br/&gt;
        try &lt;/p&gt;
{
          solrCores.getModifyLock().wait();
        }
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
          // Well, if we&apos;ve been told to stop, we will. Otherwise, continue on and check to see if there are
          // any cores to close.
        }
&lt;p&gt;      }&lt;br/&gt;
      for (SolrCore removeMe = solrCores.getCoreToClose();&lt;br/&gt;
           removeMe != null &amp;amp;&amp;amp; !container.isShutDown();&lt;br/&gt;
           removeMe = solrCores.getCoreToClose()) {&lt;br/&gt;
        try &lt;/p&gt;
{
          removeMe.close();
        }
&lt;p&gt; finally &lt;/p&gt;
{
          solrCores.removeFromPendingOps(removeMe.getName());
        }
&lt;p&gt;      }&lt;br/&gt;
    }&lt;br/&gt;
  }&lt;/p&gt;


&lt;p&gt;Since Solr is new to me, it is a chance for me to look into the CoreContainer code.  I will think of a unit test case to cover the situation as you suggested in the mail.&lt;/p&gt;

&lt;p&gt;Thank you. And I would like to engaging the contribution to such a wonderful project.&lt;/p&gt;
</comment>
                            <comment id="14583832" author="elyograg" created="Fri, 12 Jun 2015 18:19:37 +0000"  >&lt;p&gt;An alternate idea is to detect the configuration where the transient cache is too small as an invalid config and stop loading cores entirely, with a nice red error message in the admin UI.  If it&apos;s possible to get a loadOnStartup count before any core loading starts, Solr could refuse to start ANY cores.  I&apos;m a fan of the &quot;fail fast and fail hard&quot; approach.&lt;/p&gt;</comment>
                            <comment id="14584105" author="hossman" created="Fri, 12 Jun 2015 21:20:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m a fan of the &quot;fail fast and fail hard&quot; approach.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;While I share this philosophy in general, it&apos;s doesn&apos;t really make sense here...&lt;/p&gt;

&lt;p&gt;Consider specifically how a system can get in a situation like this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;a completley new solr install, with no cores/collections&lt;/li&gt;
	&lt;li&gt;user configures transientSize=2&lt;/li&gt;
	&lt;li&gt;user adds 2 cores which are loadOnStartup=true.  everything is happy&lt;/li&gt;
	&lt;li&gt;user adds some more cores which are loadOnStartup=false. everything is still happy. the transient cache has automatically closes/opens cores as needed&lt;/li&gt;
	&lt;li&gt;user restarts solr. everything is still happy - the 2 loadOnStartup=true cores are loaded.&lt;/li&gt;
	&lt;li&gt;as requests come in, the transient cache closes/opens cores as needed&lt;/li&gt;
	&lt;li&gt;a user adds 1 more new loadOnStartup=true core.  everything is still happy&lt;/li&gt;
	&lt;li&gt;as requests come in, the transient cache closes/opens cores as needed&lt;/li&gt;
	&lt;li&gt;user restarts solr &amp;#8211; suddenly, solr complains about a configuration error ... WTF? the configuration hasn&apos;t changed? Solr was operating just fine before restart, now it says transientSize is too small for the number of cores i have? WTF?!?!?!&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;...the philosophy of &quot;fail fast and fail hard&quot; just doesn&apos;t apply here &amp;#8211; unless you&apos;re going to fail fast and hard in the CoreAdmin and not even let a new core be created with loadOnStartup=true unless you count all the loadOnStartup=true cores (even the ones that may not currently be loaded due to either the trnasient cache or due to the user explicitly closing them).&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;I think the only sane behavior here is that if transientSize is used, the Core discovery should prioritize initializing loadOnStartup=true cores and if there are more of those then the transientSize=N, it should just pick N to load and log a warning about: &quot;Core foo not initialized even though it is loadOnStartup=true because transientSize=N exceeded.&quot;&lt;/p&gt;</comment>
                            <comment id="14584630" author="edwinjhlee" created="Sat, 13 Jun 2015 14:48:40 +0000"  >&lt;p&gt;In my understanding,&lt;br/&gt;
1. when loadOnStarup transientCores &amp;gt; transientCacheSize, I think it is a reasonable configuration. In our project, we would like to monitor the solr core state, we have to load the core one by one to get the snapshot of it. So load it one by one make sense to us.&lt;br/&gt;
2. The loadOnStartup is only one of the problem of it. The problem is &quot;improper core close&quot; operation. This bug is haunting solr whenever there is core closing involved.&lt;/p&gt;

&lt;p&gt;And...&lt;/p&gt;

&lt;p&gt;The reason why it keep happenning on &quot;loadOnStartup=true&quot; mainly because the closeThread initialize after the all of transient cores creation.&lt;/p&gt;

&lt;p&gt;In CoreContainter.java&lt;/p&gt;

&lt;p&gt;      try &lt;/p&gt;
{
        coreLoadExecutor.invokeAll(creators);
      }
&lt;p&gt;      catch (InterruptedException e) &lt;/p&gt;
{
        throw new SolrException(SolrException.ErrorCode.SERVICE_UNAVAILABLE, &quot;Interrupted while loading cores&quot;);
      }

&lt;p&gt;      // Start the background thread&lt;br/&gt;
      backgroundCloser = new CloserThread(this, solrCores, cfg);&lt;br/&gt;
      backgroundCloser.start();&lt;/p&gt;

&lt;p&gt;    } finally &lt;/p&gt;
{
      ExecutorUtil.shutdownNowAndAwaitTermination(coreLoadExecutor);
    }</comment>
                            <comment id="14584636" author="edwinjhlee" created="Sat, 13 Jun 2015 14:55:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erike4711%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;erike4711@yahoo.com&quot;&gt;erike4711@yahoo.com&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hi Erick,&lt;/p&gt;

&lt;p&gt;After discussion with my colleagues, we come up a solution like it.&lt;br/&gt;
Although I like using blockingqueue for this scenario, it involve several code modification. &lt;br/&gt;
Right now, I think that is a simple and long term fix.&lt;/p&gt;

&lt;p&gt;We just need to replace the code in CoreContainter.CloserThread.run() to the code below.&lt;br/&gt;
By the way, can this fix back port the solr 4.10.3 ? Thank you.&lt;/p&gt;

&lt;p&gt;    public void run() {&lt;br/&gt;
      while (! container.isShutDown()) {&lt;br/&gt;
        SolrCore removeMe = null;&lt;br/&gt;
        synchronized (solrCores.getModifyLock()) { // need this so we can wait and be awoken.&lt;br/&gt;
          removeMe = solrCores.getCoreToClose();&lt;br/&gt;
          if( removeMe == null ) { // no use while because closer might have to wake up when container is down.&lt;br/&gt;
              try &lt;/p&gt;
{
                 solrCores.getModifyLock().wait();
              }
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
                 // Well, if we&apos;ve been told to stop, we will. Otherwise, continue on and check to see if there are
                // any cores to close.
              }
&lt;p&gt;              continue;&lt;br/&gt;
          }&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        for (;&lt;br/&gt;
             removeMe != null &amp;amp;&amp;amp; !container.isShutDown();&lt;br/&gt;
             removeMe = solrCores.getCoreToClose()) {&lt;br/&gt;
          try {&lt;br/&gt;
            removeMe.close();&lt;br/&gt;
            log.info(&quot;Transient Core&lt;span class=&quot;error&quot;&gt;&amp;#91;{}&amp;#93;&lt;/span&gt; is closed.&quot;, removeMe.getName());&lt;br/&gt;
          } finally &lt;/p&gt;
{
            solrCores.removeFromPendingOps(removeMe.getName());
          }
&lt;p&gt;        }&lt;br/&gt;
      }&lt;br/&gt;
    }&lt;/p&gt;</comment>
                            <comment id="14584665" author="elyograg" created="Sat, 13 Jun 2015 15:36:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;While I share this philosophy in general, it&apos;s doesn&apos;t really make sense here... Consider specifically how a system can get in a situation like this:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That was a scenario I had not considered, and that is a good reason to not fail the way I described.  Doing so would not conform to another design philosophy &amp;#8211; the &quot;principle of least surprise.&quot;&lt;/p&gt;

&lt;p&gt;During startup, if cores have been asked to load that exceed the transient size, it could be handled one of two ways:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Treat them just like a manual core load &amp;#8211; and unload one of the cores that got loaded previously.&lt;/li&gt;
	&lt;li&gt;Skip the automatic load entirely, rather than do the partial load that causes the buggy state.&lt;/li&gt;
&lt;/ul&gt;


&lt;blockquote&gt;&lt;p&gt;unless you&apos;re going to fail fast and hard in the CoreAdmin and not even let a new core be created with loadOnStartup=true unless you count all the loadOnStartup=true cores&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Another great idea from Hoss.  Fail core creation with a useful error message in the exception.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;By the way, can this fix back port the solr 4.10.3 ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can certainly backport the fix to the 4_10 branch, but this is a problem with a simple workaround, so I don&apos;t think it will lead to an actual 4.10.3 release.&lt;/p&gt;

&lt;p&gt;Are there any errors or warnings in the log when this problem happens?  If there are, they should be documented here so that others can find this issue by searching for those messages.&lt;/p&gt;</comment>
                            <comment id="14584673" author="edwinjhlee" created="Sat, 13 Jun 2015 15:48:36 +0000"  >&lt;p&gt;We propose a solution here to refer.&lt;/p&gt;

&lt;p&gt;Mainly, I only change the code in CloserThread.run().&lt;br/&gt;
And also, I add protected static final Logger log = LoggerFactory.getLogger(CloserThread.class); to add more logs on CloserThread.&lt;/p&gt;

&lt;p&gt;Our colleague suggest adding the timeout.&lt;br/&gt;
It will not hurt the performance to add the timeout. Concurrent issue is hard to predict sometime. Just in case.&lt;br/&gt;
I don&apos;t add it into this file because I don&apos;t know which value is proper.&lt;/p&gt;</comment>
                            <comment id="14584678" author="edwinjhlee" created="Sat, 13 Jun 2015 15:51:27 +0000"  >&lt;p&gt;No error printed. It drove us crazy. I think it would better to add some log in the closer thread. And just in case, perhaps add the timeout. It won&apos;t hurt the performance. Thx.&lt;/p&gt;</comment>
                            <comment id="14584685" author="elyograg" created="Sat, 13 Jun 2015 16:01:59 +0000"  >&lt;p&gt;We very much prefer patches to full source files, unless they&apos;re entirely new files.&lt;/p&gt;

&lt;p&gt;Which code branch did you modify to create this new source file?&lt;/p&gt;</comment>
                            <comment id="14584686" author="edwinjhlee" created="Sat, 13 Jun 2015 16:04:41 +0000"  >&lt;p&gt;I simply attach the file here. CoreContainer.java&lt;br/&gt;
I don&apos;t know how to submit patch yet... Sorry... Would you help me to submit it? Thx.&lt;/p&gt;</comment>
                            <comment id="14584691" author="elyograg" created="Sat, 13 Jun 2015 16:22:39 +0000"  >&lt;p&gt;It looks like you applied this to either the 4_10 branch or the 4_10_2 tag.  Attaching a patch created by replacing the CoreContainer.java file in tags/lucene_solr_4_10_2 with the file included here.&lt;/p&gt;</comment>
                            <comment id="14584692" author="erickerickson" created="Sat, 13 Jun 2015 16:23:28 +0000"  >&lt;p&gt;See: &lt;a href=&quot;http://wiki.apache.org/solr/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/solr/HowToContribute&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The short form is that if you checked the code out with subversion, just to go the top-level directory and type&lt;br/&gt;
svn diff &amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7667&quot; title=&quot;If more cores are loaded at startup than the transient core size, cores become unavailable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7667&quot;&gt;&lt;del&gt;SOLR-7667&lt;/del&gt;&lt;/a&gt;.patch&lt;br/&gt;
Git has it&apos;s own diff generation that&apos;s usable too.&lt;/p&gt;

&lt;p&gt;And if you use IntelliJ, there&apos;s a menu choice VCS&amp;gt;&amp;gt;Create Patch.&lt;br/&gt;
I&apos;m sure that other IDEs have equivalents.&lt;/p&gt;

&lt;p&gt;Do note that if, say, you decide to create a second (or third or fourth) patch because you think of something else, name them &lt;em&gt;all&lt;/em&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7667&quot; title=&quot;If more cores are loaded at startup than the transient core size, cores become unavailable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7667&quot;&gt;&lt;del&gt;SOLR-7667&lt;/del&gt;&lt;/a&gt;.patch and upload them. Multiple copies of a patch with the same name are the most convenient, the JIRA will gray out all the older ones, making it easy to know exactly what the latest patch is.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14584695" author="elyograg" created="Sat, 13 Jun 2015 16:23:50 +0000"  >&lt;p&gt;Is there any chance that you can write a test that fails without your change and passes once it&apos;s applied?&lt;/p&gt;</comment>
                            <comment id="14584708" author="edwinjhlee" created="Sat, 13 Jun 2015 16:50:29 +0000"  >&lt;p&gt;Ok. I will follow the instructions of the link.&lt;br/&gt;
Thx.&lt;/p&gt;</comment>
                            <comment id="14584711" author="elyograg" created="Sat, 13 Jun 2015 16:54:18 +0000"  >&lt;p&gt;Updated patch against branch_5x.  The patch wouldn&apos;t apply cleanly, had to do it manually.&lt;/p&gt;</comment>
                            <comment id="14584712" author="edwinjhlee" created="Sat, 13 Jun 2015 16:54:21 +0000"  >&lt;p&gt;Ok. It may take days, since I am new to Solr, configuration and code still confuse me sometime.&lt;br/&gt;
I just found CoreContainerCoreInitFailuresTest.java in test package might be a good reference.&lt;br/&gt;
I will do the work based upon 4.10.3. It will be OK, right?&lt;/p&gt;</comment>
                            <comment id="14584721" author="elyograg" created="Sat, 13 Jun 2015 17:05:08 +0000"  >&lt;p&gt;It would be better against trunk or branch_5x, but you should do it where you are comfortable, and we will adjust if we must.&lt;/p&gt;</comment>
                            <comment id="14584723" author="elyograg" created="Sat, 13 Jun 2015 17:07:26 +0000"  >&lt;p&gt;I mentioned a 4.10.3 release above, but forgot that we are already up to 4.10.4, so that would in fact be a 4.10.5 release.&lt;/p&gt;</comment>
                            <comment id="14584725" author="elyograg" created="Sat, 13 Jun 2015 17:13:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;, you&apos;re much more familiar with the CoreContainer code due to your LotsOfCores work.  Does &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edwinjhlee&quot; class=&quot;user-hover&quot; rel=&quot;edwinjhlee&quot;&gt;edwinjhlee&lt;/a&gt;&apos;s patch look good, or would you tackle it another way?&lt;/p&gt;

&lt;p&gt;I have started working on getting it incorporated, but I am willing to step aside and let you handle it if that interests you.&lt;/p&gt;</comment>
                            <comment id="14584748" author="elyograg" created="Sat, 13 Jun 2015 18:03:40 +0000"  >&lt;p&gt;Patch against 5x that includes code in CoreAdminHandler to fail core creation when the number of cores set to load on startup equals or exceeds transientCacheSize.&lt;/p&gt;

&lt;p&gt;The added code doesn&apos;t feel very elegant to me.  Part of that is the length of the error messages, but I wonder if maybe CoreContainer should keep track of statistics like the number of cores set to load on startup.&lt;/p&gt;</comment>
                            <comment id="14585906" author="elyograg" created="Mon, 15 Jun 2015 13:19:00 +0000"  >&lt;p&gt;I made a slight adjustment to the patch where CoreAdmin fails to create a core when the number of cores with loadOnStartup would exceed transientCacheSize.&lt;/p&gt;

&lt;p&gt;This patch does cause one test failure that I&apos;ve seen so far &amp;#8211; here&apos;s the point in the test run where it logs the warning before throwing the exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 80803 WARN  (TEST-TestLazyCores.testCreateTransientFromAdmin-seed#[63584E21E9EC83F]) [    x:core2] o.a.s.h.a.CoreAdminHandler 4 cores already marked to load on startup, with a transient cache size of 4.  Raise transientCacheSize in solr.xml.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s the exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4] ERROR   0.24s J0 | TestLazyCores.testCreateTransientFromAdmin &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.solr.common.SolrException: Core creation failed.  Number of cores marked to load on startup would exceed transient cache size.  Raise transientCacheSize in solr.xml and try again.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14587488" author="erickerickson" created="Tue, 16 Jun 2015 05:10:21 +0000"  >&lt;p&gt;I can reproduce this on 4.10, but not on 5x or trunk. Part of deprecating the old solr.xml format where cores were defined in solr.xml involved lots of simplification in the whole core loading/discovery process. I suspect that this problem went away with that simplification, although I also think this was serendipitous.&lt;/p&gt;

&lt;p&gt;I&apos;ll attached a test case that fails in 4.10 and succeeds in both 5x and trunk and I&apos;ll change the &quot;affected versions&quot; to 4.10.3 (I suspect this has been around forever so probably affects releases much earlier than 4.10). The &quot;failure mode&quot; in these tests is it hangs forever, which is what I believe you&apos;re reporting.&lt;/p&gt;

&lt;p&gt;There are really no plans to release any new 4.10 versions at present, and this the first report of this. So I&apos;m afraid there&apos;s little chance of releasing a fix specifically for 4.10 and it&apos;s unnecessary (apparently) for 5.x+&lt;/p&gt;

&lt;p&gt;So  if you really need this, I think you&apos;ll have to patch it locally I&apos;m afraid, unless we can show it happening on 5.x+.&lt;/p&gt;</comment>
                            <comment id="14587490" author="erickerickson" created="Tue, 16 Jun 2015 05:11:53 +0000"  >&lt;p&gt;Failure for this on 4.10.3. Test case succeeds on 5.x and trunk&lt;/p&gt;</comment>
                            <comment id="14588406" author="elyograg" created="Tue, 16 Jun 2015 17:25:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll attached a test case that fails in 4.10 and succeeds in both 5x and trunk&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 to committing the new test in trunk and 5x, and leaving 4.10 as it is.  It&apos;s a problem with an easy config fix, and now we are aware of it, so it will be part of our troubleshooting arsenal.&lt;/p&gt;</comment>
                            <comment id="14588415" author="erickerickson" created="Tue, 16 Jun 2015 17:29:04 +0000"  >&lt;p&gt;Yeah, adding the test case occurred to me after I unassigned it. I took it back and I&apos;ll commit it sometime Real Soon Now.&lt;/p&gt;</comment>
                            <comment id="14589273" author="jira-bot" created="Wed, 17 Jun 2015 04:23:52 +0000"  >&lt;p&gt;Commit 1685930 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1685930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1685930&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7667&quot; title=&quot;If more cores are loaded at startup than the transient core size, cores become unavailable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7667&quot;&gt;&lt;del&gt;SOLR-7667&lt;/del&gt;&lt;/a&gt;: If more cores are loaded at startup than the transient core size, cores become unavailable. This is a test for this case to guard against regression. This test will fail in 4.x and succeeds in 5x/trunk&lt;/p&gt;</comment>
                            <comment id="14589284" author="erickerickson" created="Wed, 17 Jun 2015 04:40:24 +0000"  >&lt;p&gt;Patch against 5x (because I forgot to take the diff on trunk before committing). But it&apos;s simple and doesn&apos;t really fix anything. It just fails on 4.x but succeeds on 5x and trunk so it&apos;s here to guard against regression.&lt;/p&gt;</comment>
                            <comment id="14589286" author="jira-bot" created="Wed, 17 Jun 2015 04:40:57 +0000"  >&lt;p&gt;Commit 1685931 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1685931&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1685931&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7667&quot; title=&quot;If more cores are loaded at startup than the transient core size, cores become unavailable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7667&quot;&gt;&lt;del&gt;SOLR-7667&lt;/del&gt;&lt;/a&gt;: If more cores are loaded at startup than the transient core size, cores become unavailable. This is a test for this case to guard against regression. This test will fail in 4.x and succeeds in 5x/trunk&lt;/p&gt;</comment>
                            <comment id="14589288" author="erickerickson" created="Wed, 17 Jun 2015 04:41:45 +0000"  >&lt;p&gt;This is not a problem in 5x and trunk so closing as &quot;won&apos;t fix&quot;. If we re-open 4.x for more releases we can reconsider.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12739426" name="CoreContainer.java" size="31499" author="edwinjhlee" created="Sat, 13 Jun 2015 15:48:36 +0000"/>
                            <attachment id="12739782" name="SOLR-7667-test-fails.patch" size="6284" author="erickerickson" created="Tue, 16 Jun 2015 05:11:53 +0000"/>
                            <attachment id="12740037" name="SOLR-7667-test.patch" size="4312" author="erickerickson" created="Wed, 17 Jun 2015 04:40:24 +0000"/>
                            <attachment id="12739609" name="SOLR-7667-with-CoreAdmin-create-fail.patch" size="4058" author="elyograg" created="Mon, 15 Jun 2015 13:19:00 +0000"/>
                            <attachment id="12739439" name="SOLR-7667-with-CoreAdmin-create-fail.patch" size="4032" author="elyograg" created="Sat, 13 Jun 2015 18:03:40 +0000"/>
                            <attachment id="12739432" name="SOLR-7667.patch" size="2109" author="elyograg" created="Sat, 13 Jun 2015 16:54:18 +0000"/>
                            <attachment id="12739429" name="SOLR-7667.patch" size="2272" author="elyograg" created="Sat, 13 Jun 2015 16:22:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fxu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>