<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:46:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14992] TestPullReplicaErrorHandling.testCantConnectToPullReplica Failures</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14992</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I&apos;ve noticed this test started failing very frequently with an error like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Error Message:
Error from server at http://127.0.0.1:39037/solr: Cannot create collection pull_replica_error_handling_test_cant_connect_to_pull_replica. Value of maxShardsPerNode is 1, and the number of nodes currently live or live and part of your createNodeSet is 3. This allows a maximum of 3 to be created. Value of numShards is 2, value of nrtReplicas is 1, value of tlogReplicas is 0 and value of pullReplicas is 1. This requires 4 shards to be created (higher than the allowed number)

Stack Trace:
org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:39037/solr: Cannot create collection pull_replica_error_handling_test_cant_connect_to_pull_replica. Value of maxShardsPerNode is 1, and the number of nodes currently live or live and part of your createNodeSet is 3. This allows a maximum of 3 to be created. Value of numShards is 2, value of nrtReplicas is 1, value of tlogReplicas is 0 and value of pullReplicas is 1. This requires 4 shards to be created (higher than the allowed number)
        at __randomizedtesting.SeedInfo.seed([3D670DC4BEABD958:3550EB0C6505ADD6]:0)
        at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:681)
        at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:266)
        at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:248)
        at org.apache.solr.client.solrj.impl.LBSolrClient.doRequest(LBSolrClient.java:369)
        at org.apache.solr.client.solrj.impl.LBSolrClient.request(LBSolrClient.java:297)
        at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.sendRequest(BaseCloudSolrClient.java:1173)
        at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.requestWithRetryOnStaleState(BaseCloudSolrClient.java:934)
        at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.request(BaseCloudSolrClient.java:866)
        at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:214)
        at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:231)
        at org.apache.solr.cloud.TestPullReplicaErrorHandling.testCantConnectToPullReplica(TestPullReplicaErrorHandling.java:149)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1750)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:938)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:974)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:988)
        at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
        at org.junit.rules.RunRules.evaluate(RunRules.java:20)
        at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)
        at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
        at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)
        at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
        at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
        at org.junit.rules.RunRules.evaluate(RunRules.java:20)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)
        at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:947)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:832)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:883)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:894)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
        at org.junit.rules.RunRules.evaluate(RunRules.java:20)
        at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)
        at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
        at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
        at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
        at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
        at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)
        at org.junit.rules.RunRules.evaluate(RunRules.java:20)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)
        at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;These failures started In October 27 (and I can&apos;t find similar failures before that), so it&apos;s likely that either a bug was introduced or a change that made an existing but reproduce.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13339566">SOLR-14992</key>
            <summary>TestPullReplicaErrorHandling.testCantConnectToPullReplica Failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mdrob">Mike Drob</assignee>
                                    <reporter username="tflobbe">Tomas Eduardo Fernandez Lobbe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Nov 2020 17:29:38 +0000</created>
                <updated>Thu, 12 May 2022 00:26:35 +0000</updated>
                            <resolved>Fri, 4 Dec 2020 00:50:31 +0000</resolved>
                                                    <fixVersion>8.8</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17229765" author="tomasflobbe" created="Wed, 11 Nov 2020 06:15:29 +0000"  >&lt;p&gt;Maybe related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14940&quot; title=&quot;ReplicationHandler memory leak through SolrCore.closeHooks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14940&quot;&gt;&lt;del&gt;SOLR-14940&lt;/del&gt;&lt;/a&gt;. It&apos;s strange that it only fails in 8.x&lt;/p&gt;</comment>
                            <comment id="17241640" author="erickerickson" created="Tue, 1 Dec 2020 15:38:15 +0000"  >&lt;p&gt;A couple of things:&lt;/p&gt;

&lt;p&gt;1&amp;gt; the failure talks about numshards, so it&apos;s possible that the code has changed when that parameter was changed?&lt;/p&gt;

&lt;p&gt;2&amp;gt; this test &lt;em&gt;always&lt;/em&gt; fails when testCloseHooksDeletedOnReconnect runs before it and never fails when it runs after (AFAIK)....&lt;/p&gt;

&lt;p&gt;I&apos;m looking at this very intermittently...&lt;/p&gt;</comment>
                            <comment id="17241715" author="tomasflobbe" created="Tue, 1 Dec 2020 17:17:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;the failure talks about numshards&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I believe the problem is that &lt;tt&gt;testCloseHooksDeletedOnReconnect&lt;/tt&gt; disconnects nodes, so when &lt;tt&gt;testCantConnectToPullReplica&lt;/tt&gt; tries to create a collection with a certain number of shards, there aren&apos;t enough nodes to match the &lt;tt&gt;maxShardsPerNode&lt;/tt&gt; setting. If that&apos;s the case, the fix should be to make sure all nodes are up after running &lt;tt&gt;testCloseHooksDeletedOnReconnect&lt;/tt&gt; (or any other test in this suite). &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14940?focusedCommentId=17229764&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17229764&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;This comment&lt;/a&gt; has a suggestion for a possible fix I haven&apos;t had tie to try.&lt;/p&gt;</comment>
                            <comment id="17241735" author="erickerickson" created="Tue, 1 Dec 2020 17:49:09 +0000"  >&lt;p&gt;Figured it was something like that, I&apos;ll see what I can do over the next day or two...&lt;/p&gt;
</comment>
                            <comment id="17241896" author="mdrob" created="Tue, 1 Dec 2020 21:56:19 +0000"  >&lt;p&gt;I&apos;m taking a look at this as well, but I can&apos;t get ant to run the tests in the reproducing order for failures. Is there a magic invocation to make it happen?&lt;/p&gt;</comment>
                            <comment id="17242331" author="erickerickson" created="Wed, 2 Dec 2020 12:45:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; No magic, I just use Mark Miller&apos;s &quot;beasting&quot; script. This fails about 20% of the time for me (MBP). I really hate these, you change code, beast for a while and are never completely sure you&apos;ve found the problem...&lt;/p&gt;

&lt;p&gt;If you have a possibility for a fix, I&apos;d be glad to beast it, even if it&apos;s just a wild stab...&lt;/p&gt;

&lt;p&gt;Next time it&apos;s nasty out side I&apos;ll be taking a closer look at it.&lt;/p&gt;</comment>
                            <comment id="17242626" author="mdrob" created="Wed, 2 Dec 2020 19:00:44 +0000"  >&lt;p&gt;Ok, I think I figured this out, the PR I opened is for master but patch should apply to 8x as well. I beasted it and was able to get failures from 5% to 0% on my machine.&lt;/p&gt;</comment>
                            <comment id="17243194" author="erickerickson" created="Thu, 3 Dec 2020 13:58:47 +0000"  >&lt;p&gt;See, if I delay long enough, I have less work to do &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I&apos;ll pull this down and try it on 8x....&lt;/p&gt;</comment>
                            <comment id="17243283" author="erickerickson" created="Thu, 3 Dec 2020 15:34:12 +0000"  >&lt;p&gt;OK, 100 iterations later on 8x (BTW, I tested with the full 5 iterations) and no failures. I&apos;ll run a longer one, but this seems to have cured the failures I was seeing which were closer to 15-20% depending on the run....&lt;/p&gt;</comment>
                            <comment id="17243589" author="erickerickson" created="Thu, 3 Dec 2020 23:47:31 +0000"  >&lt;p&gt;650 more iterations under 8x and this failure is gone. I did see one probably unrelated failure, &quot;Underlying core creation failed while creating collection: &quot; which happens intermittently on quite a few tests so I think we&apos;re good for this fix. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; !&lt;/p&gt;

&lt;p&gt;Oh, I&apos;m assuming you&apos;ll commit?&lt;/p&gt;</comment>
                            <comment id="17243603" author="jira-bot" created="Fri, 4 Dec 2020 00:32:32 +0000"  >&lt;p&gt;Commit cef928171fa8962ee5c826dc831f3d6401c6a8bd in lucene-solr&apos;s branch refs/heads/master from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=cef9281&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=cef9281&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14992&quot; title=&quot;TestPullReplicaErrorHandling.testCantConnectToPullReplica Failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14992&quot;&gt;&lt;del&gt;SOLR-14992&lt;/del&gt;&lt;/a&gt; Wait for node down before checking for node up (#2115)&lt;/p&gt;
</comment>
                            <comment id="17243613" author="jira-bot" created="Fri, 4 Dec 2020 00:50:09 +0000"  >&lt;p&gt;Commit f7af02ebe39d448f74413ddba575ba1d96059210 in lucene-solr&apos;s branch refs/heads/branch_8x from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f7af02e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f7af02e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14992&quot; title=&quot;TestPullReplicaErrorHandling.testCantConnectToPullReplica Failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14992&quot;&gt;&lt;del&gt;SOLR-14992&lt;/del&gt;&lt;/a&gt; Wait for node down before checking for node up (#2115)&lt;/p&gt;
</comment>
                            <comment id="17535499" author="janhoy" created="Thu, 12 May 2022 00:26:35 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13335786">SOLR-14940</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13344120">SOLR-15032</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0keqg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>