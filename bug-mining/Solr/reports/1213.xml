<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:33:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4265] Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4265</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When you type an accent (in french language for example) in the console query tester, there&apos;s no charset conversion (servlet request charset conversion)&lt;br/&gt;
Eg.: &quot;m&#234;me&quot; is converted into it&apos;s ISO-8859-1 representation ==&amp;gt; fail&lt;/p&gt;

&lt;p&gt;The reason : getCharacterEncoding from HTTPRequest is not tested. Il it&apos;s null, il will assume to convert an UTF-8 encoding charset.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Windows but, environment independent&lt;/p&gt;</environment>
        <key id="12626085">SOLR-4265</key>
            <summary>Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uschindler">Uwe Schindler</assignee>
                                    <reporter username="gnx_androidoman">Alex Rocher</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Jan 2013 19:02:51 +0000</created>
                <updated>Thu, 16 Feb 2017 15:55:29 +0000</updated>
                            <resolved>Sun, 6 Jan 2013 15:33:00 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Admin UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13544114" author="gnx_androidoman" created="Fri, 4 Jan 2013 19:08:51 +0000"  >&lt;p&gt;For me the patch is simple: 2 sources have been modified.&lt;/p&gt;

&lt;p&gt;org.apache.solr.common.params&lt;br/&gt;
  public MultiMapSolrParams(Map&amp;lt;String,String[]&amp;gt; map,String charset) {&lt;br/&gt;
      this.map =map;&lt;br/&gt;
      // If not null, assume that the job is ever done.&lt;br/&gt;
      if (charset ==null) {&lt;br/&gt;
        // Update values of parameter in regard to charset encoding.&lt;br/&gt;
        // By default, if charset encoding is not known we assume&lt;br/&gt;
        // that it&apos;s UTF-8 encoded from HTTP client (mainly browser).&lt;br/&gt;
        // Question : this rule is true in Servlet params, the code may no be here ?&lt;br/&gt;
        for (Entry&amp;lt;String, String[]&amp;gt; entry : map.entrySet()) {&lt;br/&gt;
          String[] values =entry.getValue();&lt;br/&gt;
          if (values !=null) {&lt;br/&gt;
            for (int i = 0; i &amp;lt; values.length; i++) {&lt;br/&gt;
              try &lt;/p&gt;
{
                // Charset.XXX is better for performances.
                values[i] =new String(values[i].getBytes(&quot;ISO-8859-1&quot;), &quot;UTF-8&quot;);
              }
&lt;p&gt;              catch (UnsupportedEncodingException e) &lt;/p&gt;
{
                // FIXME : what to do in this case ? Should never occurs ?
              }
&lt;p&gt;            }&lt;br/&gt;
            // Refresh entry : remark, cannot create a new Map for unknown reason, have to update the current one.&lt;br/&gt;
            entry.setValue(values);&lt;br/&gt;
          }&lt;br/&gt;
        }&lt;br/&gt;
      }&lt;br/&gt;
  }&lt;/p&gt;



&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;/**&lt;br/&gt;
 *&lt;br/&gt;
 */&lt;br/&gt;
public class ServletSolrParams extends MultiMapSolrParams {&lt;br/&gt;
  public ServletSolrParams(ServletRequest req) &lt;/p&gt;
{
	  super(req.getParameterMap(), req.getCharacterEncoding());
  }

&lt;p&gt;I think that my patch should only impact HTTP layer.&lt;/p&gt;

</comment>
                            <comment id="13544121" author="dweiss" created="Fri, 4 Jan 2013 19:15:33 +0000"  >&lt;p&gt;This isn&apos;t the right approach. The double conversion from iso8859-1 to UTF-8 is simply wrong &amp;#8211; you assume identity conversion to bytes but in fact the characters may be screwed up already by that time.&lt;/p&gt;

&lt;p&gt;This is a container configuration issue. Jetty (or Tomcat, or whatever else) should be configured to decode servlet parameters using UTF-8. For Tomcat the instructions are here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/tomcat/FAQ/CharacterEncoding#Q8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/tomcat/FAQ/CharacterEncoding#Q8&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you find a similar configuration setting for Jetty it should be applied for the default distribution.&lt;/p&gt;</comment>
                            <comment id="13544156" author="thetaphi" created="Fri, 4 Jan 2013 19:34:56 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I never understood why you have to set the parameter encoding in your servlet container. Although this is somehow &quot;undocumented&quot;, you can use ServletResponse.setCharacterEncoding() to set the encoding of your serlet input. Unfortunately this sets also the encoding for the request body, but thats irrelevant for us, because we use InputStream only.&lt;/p&gt;

&lt;p&gt;The attached patch simply does this on SolrDispatchFilter&apos;s startup of GET method (important: &lt;b&gt;before any parameter is read&lt;/b&gt;).&lt;/p&gt;

&lt;p&gt;I am just not sure if this works with ServletFilters, but with conventional Servlets this works 100% and used in all my servlets I ever wrote. I never need to configure my Jetty or Sun Java System Webserver - no test on Tomcat.&lt;/p&gt;

&lt;p&gt;Can somebody try this and report back?&lt;/p&gt;</comment>
                            <comment id="13544170" author="dweiss" created="Fri, 4 Jan 2013 19:41:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;I am just not sure if this works with ServletFilters, but with conventional Servlets this works 100% and used in all my servlets I ever wrote.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I can guarantee you that this won&apos;t always work (there were/are servlet containers that parse parameters eagerly in which case that call is ignored). You can double check in the J2EE spec if you want but I&apos;m pretty sure there are no guarantees about when URI parsing/ parameter decoding takes place.&lt;/p&gt;</comment>
                            <comment id="13544183" author="dweiss" created="Fri, 4 Jan 2013 19:48:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/bugzilla/show_bug.cgi?id=23929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/bugzilla/show_bug.cgi?id=23929&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This thread has some background info on the issue. I don&apos;t want to go into the debate on what&apos;s the proper behavior; like I said though &amp;#8211; I&apos;m confident it&apos;s not a reliable method to enforce proper encoding of query parameters (passed via GET/ URI string). &lt;/p&gt;</comment>
                            <comment id="13544186" author="dweiss" created="Fri, 4 Jan 2013 19:49:53 +0000"  >&lt;p&gt;Also, see this one:&lt;br/&gt;
&lt;a href=&quot;http://download.oracle.com/otn-pub/jcp/servlet-3.0-mrel-full-oth-JSpec/servlet-3_0-mrel-spec.pdf?AuthParam=1357328692_53ed082343de48588685d44e37c09e7f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.oracle.com/otn-pub/jcp/servlet-3.0-mrel-full-oth-JSpec/servlet-3_0-mrel-spec.pdf?AuthParam=1357328692_53ed082343de48588685d44e37c09e7f&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;section 3.10 talks about setCharacterEncoding. This is for forcing HTTP body decoding (for form-encoded POSTs), not URI/headers.&lt;/p&gt;</comment>
                            <comment id="13544198" author="thetaphi" created="Fri, 4 Jan 2013 20:02:13 +0000"  >&lt;p&gt;Dawid: I know this problem, but for &lt;b&gt;some&lt;/b&gt; servlet containers this brings the correct effect (at least for jetty and SJSWS/iPlanet). Another idea is to let the request parameters be and write an own decoder for HttpServletRequest.getQueryString(). Then you can enforce encoding as you like. Thats what I also did in the past to make it portable around servlet containers.&lt;br/&gt;
A decoder for form-encoded query-strings is very simple.&lt;/p&gt;</comment>
                            <comment id="13544201" author="thetaphi" created="Fri, 4 Jan 2013 20:03:12 +0000"  >&lt;p&gt;Of course after doing this, you know what to add to forbidden APIS? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13544202" author="gnx_androidoman" created="Fri, 4 Jan 2013 20:04:07 +0000"  >&lt;p&gt;OKA guy&apos;s, I&apos;m pretty sure on my facts : when you want to use HTTP protocol trough Servlets, the character encoding (when null !) should have a default value.&lt;br/&gt;
My proposal is for HTTP protocol, and nothing else.&lt;/p&gt;

&lt;p&gt;You can test my testcase, there&apos;s really a problem.&lt;/p&gt;

&lt;p&gt;ISO-8859-1 is the major test case but for me, at this time, sol&apos;y is not UTF-8 compliant.&lt;/p&gt;</comment>
                            <comment id="13544217" author="thetaphi" created="Fri, 4 Jan 2013 20:17:19 +0000"  >&lt;p&gt;Alex: Solr expects all URL parameters encoded as UTF-8 - PERIOD. The problem we are discussing about here is that some servlet containers use ISO-8859-1 to decode the parameters, so although you pass UTF-8-URL-encoded values (e.g. your example would be &quot;q=m%C3%AAme&quot;) the servlet container may not use UTF-8 to decode the %-encoded parts. This causes the issue you have seen. And this is currently a configuration issue (in Tomcat you have to change connector), in Jetty you have to set the body encoding (sorry, Dawid, in Jetty this works definitely).&lt;/p&gt;

&lt;p&gt;The HTTP protocol by itsself has nothing to do with this. The whole issue is about the request URI and the decoding of the URL parameters (URLDecorder java class).&lt;/p&gt;

&lt;p&gt;My proposal to fix this in a portable way (like we did with the InputStreams/OutputStreams instead of using Readers/Writers to prevent the buggy Jetty Readers/Writers)): For POST requests, let us set the body encoding (as demonstrated in the patch) to UTF-8. And for the GET-parameters lets decode them manually. Its just a series of String.split() and URLDecoder.decode(..., &quot;UTF-8&quot;)&lt;/p&gt;</comment>
                            <comment id="13544221" author="dweiss" created="Fri, 4 Jan 2013 20:20:49 +0000"  >&lt;p&gt;I&apos;ve checked on Tomcat and setting request encoding doesn&apos;t work (you need to specify either useBodyEncodingForURI or an explicit encoding in the connector config). &lt;/p&gt;

&lt;p&gt;Anyway, I like Uwe&apos;s idea &amp;#8211; parse the query string manually. This could be split to only cover GETs, setCharacterEncoding will be fine for POSTs.... or just handle both since POSTs with form-encoding are pretty much identical to GETs only placed in the request body.&lt;/p&gt;

&lt;p&gt;Alex: this has nothing to do with HTTP, it&apos;s how servlet specification is formulated. HTTP encoding says one thing (character encoding should be sent from the browser along with forms, for example) but browsers do another (they usually don&apos;t send anything). The default encoding for decoding URIs in the servlet spec. is US-ASCII I believe (a subset of ISO-8859-1); you&apos;d need to double check though, I may be wrong here.&lt;/p&gt;</comment>
                            <comment id="13544224" author="dweiss" created="Fri, 4 Jan 2013 20:23:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;(sorry, Dawid, in Jetty this works definitely).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This isn&apos;t clearly explained in the spec and hence the confusion I guess. The setCharacterEncoding method&apos;s documentation is pretty clear that it applies to POSTs only, not URIs. But any open interpretation area like this will be prone to different implementations. It&apos;s a pity they just didn&apos;t include URI character encoding scheme as part of web application&apos;s deployment descriptor &amp;#8211; then you&apos;d be in control of what you want it to be.&lt;/p&gt;</comment>
                            <comment id="13544231" author="gnx_androidoman" created="Fri, 4 Jan 2013 20:37:18 +0000"  >&lt;p&gt;Funny subject I Think ... finally &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;F&#252;r mich, the problem is quite simple : when you retrieve a &quot;null&quot; from a Servlet component for request.getCharacterEncoding(), you&apos;ll to suppose that you&apos;re HTTP client send in a chartset. By default, we can imagine that it&apos;s UTF-8.&lt;br/&gt;
I&apos;ve never found any Servlet/rule/http/browser on this this subjetc. My experience telle me : no encoding, please encode me from UTF-8 :-/&lt;/p&gt;

&lt;p&gt;PS: sorry for my english, I&apos;m french and as you we have a pity translation education&lt;/p&gt;</comment>
                            <comment id="13544235" author="gnx_androidoman" created="Fri, 4 Jan 2013 20:41:23 +0000"  >&lt;p&gt;In all case, there&apos;s is a problem. I&apos;ve tested through 2 JEE container and the problematic is the same (Oracle + Tomcat).&lt;/p&gt;

&lt;p&gt;Thanks for your responses&lt;/p&gt;</comment>
                            <comment id="13544246" author="yseeley@gmail.com" created="Fri, 4 Jan 2013 20:56:22 +0000"  >&lt;blockquote&gt;
&lt;p&gt;When you type an accent (in french language for example) in the console query tester, there&apos;s no charset conversion (servlet request charset conversion)&lt;br/&gt;
Eg.: &quot;m&#234;me&quot; is converted into it&apos;s ISO-8859-1 representation ==&amp;gt; fail&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I thought we had all this UTF8 stuff nailed long ago... I just tried it out on the new admin console and it seems to be working fine (although I just tried Chrome on OS-X).&lt;/p&gt;

&lt;p&gt;I assume what you meant by &quot;console query tester&quot; is&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/#/collection1/query&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/#/collection1/query&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tried cutting and pasting in h&#233;llo (hello with an accent over the e), and it worked fine.  As did m&#234;me.  Can you provide more detailed instructions on how to reproduce what you are seeing?&lt;/p&gt;</comment>
                            <comment id="13544254" author="yseeley@gmail.com" created="Fri, 4 Jan 2013 21:05:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;In all case, there&apos;s is a problem. I&apos;ve tested through 2 JEE container and the problematic is the same (Oracle + Tomcat).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, there ya go.  That explains some things.  Tomcat at least doesn&apos;t do UTF8 encoding by default in the URI (as is required by the standards).&lt;/p&gt;

&lt;p&gt;Can you reproduce your bug with the stock jetty server included in the Solr distribution?&lt;/p&gt;</comment>
                            <comment id="13544271" author="yseeley@gmail.com" created="Fri, 4 Jan 2013 21:33:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;The default encoding for decoding URIs in the servlet spec. is US-ASCII I believe (a subset of ISO-8859-1); you&apos;d need to double check though, I may be wrong here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, it&apos;s actually &quot;double encoded&quot;... it&apos;s UTF8 encoded and then percent encoded, which maps any characters outside of the US-ASCII range into percent encoded UTF-8 bytes.&lt;br/&gt;
&lt;a href=&quot;http://www.ietf.org/rfc/rfc3986.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ietf.org/rfc/rfc3986.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13544278" author="thetaphi" created="Fri, 4 Jan 2013 21:48:34 +0000"  >&lt;p&gt;Yonik,&lt;br/&gt;
this is a similar problem like the broken Reader/Writer implementations we had in Jetty, that corrupted UTF-8. We no longer user ServletRequest.getReader() nor ServletResponse.getWriter() as the definition waht they do is too vague and the implementations in e.g. Jetty (but also Tomcat) are broken. The solution to this is to ignore this addon-functionality in the servlet container and use the InputStream and OutputStream only (this is what I did in an earlier issue).&lt;br/&gt;
We should do the same here to get invariant from configuration directives outside of Solr&apos;s influence. The solution to this is to get the query string and decode it (undo &amp;amp;, =, percent encoding) with a URLDecoder configured to use UTF-8. I am currently looking into doing this. When we fixed this, SolrDispatchFilter and the other servlets is container invariant.&lt;/p&gt;</comment>
                            <comment id="13544289" author="yseeley@gmail.com" created="Fri, 4 Jan 2013 22:00:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;The solution to this is to get the query string and decode it (undo &amp;amp;, =, percent encoding)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Makes sense, I just wasn&apos;t sure there was always a way to get the raw string before the container tried to do some decoding for you.&lt;/p&gt;

&lt;p&gt;IIRC, we added some code a long time ago to decode request parameters on the URI in certain circumstances.&lt;br/&gt;
See SolrRequestParsers.parseQueryString&lt;/p&gt;</comment>
                            <comment id="13544300" author="thetaphi" created="Fri, 4 Jan 2013 22:18:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Makes sense, I just wasn&apos;t sure there was always a way to get the raw string before the container tried to do some decoding for you.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;getQueryString() does not do any decoding, the part after the ? in the request URL is returned unmodified. And this one contains only ASCII, if the URL is correct, because the HTTP protocol only knows ASCII in the protocol part (warning: this differes from URI definition, but URI != URL).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;See SolrRequestParsers.parseQueryString&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Great, we should use this also for the request parameters in getQueryString()! Then you can put the Solr WAR file into Tomcat and it would just work(tm) without configuration issues.&lt;/p&gt;</comment>
                            <comment id="13544309" author="yseeley@gmail.com" created="Fri, 4 Jan 2013 22:32:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;getQueryString() does not do any decoding, the part after the ? in the request URL is returned unmodified. And this one contains only ASCII, if the URL is correct, because the HTTP protocol only knows ASCII&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s also nice to be able to handle bare UTF-8 (i.e. not necessarily percent encoded if outside of the ASCII range).  I&apos;ve run across one browser that does this, and curl itself - for example:&lt;br/&gt;
curl &apos;http://localhost:8983/solr/query?q=h&#233;llo&apos;&lt;/p&gt;

&lt;p&gt;So if the container is still decoding the bytes into a String before we get it (and assumes latin-1), we still can&apos;t fix that part.  It would still an improvement to be able to handle percent encoded UTF-8 by default though, and the bare-UTF8 should still work for containers configured correctly (like Jetty by default).&lt;/p&gt;</comment>
                            <comment id="13544315" author="thetaphi" created="Fri, 4 Jan 2013 22:38:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;It&apos;s also nice to be able to handle bare UTF-8 (i.e. not necessarily percent encoded if outside of the ASCII range). I&apos;ve run across one browser that does this, and curl itself - for example:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;curl &apos;http://localhost:8983/solr/query?q=h&#233;llo&apos;&lt;/p&gt;

&lt;p&gt;That&apos;s an invalid HTTP request. Browsers generally automatically transform this and URLEncode before sending to the server - look into the access.log.&lt;/p&gt;</comment>
                            <comment id="13544318" author="thetaphi" created="Fri, 4 Jan 2013 22:42:57 +0000"  >&lt;p&gt;I started here and added a new forbidden API file for Solr: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#  Licensed to the Apache Software Foundation (ASF) under one or more
#  contributor license agreements.  See the NOTICE file distributed with
#  this work for additional information regarding copyright ownership.
#  The ASF licenses this file to You under the Apache License, Version 2.0
#  (the &quot;License&quot;); you may not use this file except in compliance with
#  the License.  You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.

# These methods from the Servlet API should not be used, because they are
# either broken and slow in some environments (e.g., Jetty&apos;s UTF-8 readers),
# or the parsing of request parameters is not using the correct encoding
# without extra configuration in the servlet container:
javax.servlet.ServletRequest#getReader()
javax.servlet.ServletRequest#getParameter(java.lang.String) 
javax.servlet.ServletRequest#getParameterMap() 
javax.servlet.ServletRequest#getParameterNames() 
javax.servlet.ServletRequest#getParameterValues(java.lang.String) 
javax.servlet.ServletResponse#getWriter()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks actuall quite good. Only SolrRequestParser and SolrParsm uses the parameter methods, but we can remove those methods. Interestingly SolrDispatchFilter only uses the Parameter maps for GET request, POST is handled automatically in a correct way (also the URL parameters). So the fix is easy: Just use the method from SolrRequestParsers also for GET and not only for post and pass the result to MultiParams.&lt;/p&gt;

&lt;p&gt;The remaining issues are the use of getReader() and getWriter() in Zookeeper servlets. We should fix that, too. getReader/getWriter is slow and broken for supplementary chars in Jetty and possibly other servers. We should always use InputStreams/OutputStreams and wrap the reader ourselves (like we do in DispatchFilter).&lt;/p&gt;</comment>
                            <comment id="13544324" author="yseeley@gmail.com" created="Fri, 4 Jan 2013 22:49:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;That&apos;s an invalid HTTP request.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I know... but it&apos;s still nice to support it when possible.&lt;/p&gt;</comment>
                            <comment id="13544329" author="thetaphi" created="Fri, 4 Jan 2013 22:56:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes, I know... but it&apos;s still nice to support it when possible.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We have no chance to do this, unless we add our own HTTP layer, e.g. with Netty. Tomcat and Jetty are only required to parse HTTP headers and the request line with US-ASCII.&lt;/p&gt;

&lt;p&gt;But we can fix the correct URLs by disallowing the forbidden APIs above. In addition I only have to fix ZookeeperInfoServlet, the remaining stuff is fine.&lt;/p&gt;</comment>
                            <comment id="13544336" author="yseeley@gmail.com" created="Fri, 4 Jan 2013 23:07:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;We have no chance to do this, unless we add our own HTTP layer, e.g. with Netty. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, I know... that&apos;s what I was pointing out.&lt;br/&gt;
Anyway, it works with pretty much all containers that I&apos;ve ever tried once they are configured to accept percent-encoded UTF-8 URIS (and works with Jetty out of the box), so as long as we don&apos;t mess up what currently does work, I&apos;m happy.&lt;/p&gt;</comment>
                            <comment id="13544340" author="yseeley@gmail.com" created="Fri, 4 Jan 2013 23:14:18 +0000"  >&lt;p&gt;For people looking to play around with this stuff, there is a helper script to test out a container:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/opt/code/lusolr/solr/example/exampledocs$ ./test_utf8.sh
Solr server is up.
HTTP GET is accepting UTF-8
HTTP POST is accepting UTF-8
HTTP POST defaults to UTF-8
HTTP GET is accepting UTF-8 beyond the basic multilingual plane
HTTP POST is accepting UTF-8 beyond the basic multilingual plane
HTTP POST + URL params is accepting UTF-8 beyond the basic multilingual plane
Response correctly returns UTF-8 beyond the basic multilingual plane
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13544493" author="thetaphi" created="Sat, 5 Jan 2013 01:13:02 +0000"  >&lt;p&gt;Patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;adds several ServletRequest and ServletResponse methods to forbidden apis (getReader/getWriter/getParameter as those are unsafe with charsets)&lt;/li&gt;
	&lt;li&gt;Uses SolrRequestParsers to parse URL parameters and also form-encoded POST according to the standards. It also support form-encoded post data with different charsets than UTF-8 (but this charset is then also used for eventually given URL parameters)&lt;/li&gt;
	&lt;li&gt;Fixes the ZookeeperInfoServlet, too (not use unsafe Readers, Writers, getParameter)&lt;/li&gt;
	&lt;li&gt;The DebugServlet in the SolrJ tests is exclued from forbidden API&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All tests pass. I will do more tests with other servlet containers (Tomcat) and see if Solr works with UTF without any modifications.&lt;/p&gt;</comment>
                            <comment id="13544510" author="thetaphi" created="Sat, 5 Jan 2013 01:48:01 +0000"  >&lt;p&gt;Improvement: Use FastWriter instead of PrintWriter in the Zookeeper- and AdminServlet.&lt;/p&gt;</comment>
                            <comment id="13544517" author="thetaphi" created="Sat, 5 Jan 2013 02:09:12 +0000"  >&lt;p&gt;I quickly deployed solr.war from the unpatched and patched build to Tomcat 6.0.36 (which one is known to have problems). I only changed the port number in Tomcat to 8983 to make my test script working:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;On Tomcat with unpatched Solr test_utf8.sh fails:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;bash-4.1$ ./test_utf8.sh
Solr server is up.
ERROR: HTTP GET is not accepting UTF-8
HTTP POST is accepting UTF-8
HTTP POST does not default to UTF-8
ERROR: HTTP GET is not accepting UTF-8 beyond the basic multilingual plane
HTTP POST is accepting UTF-8 beyond the basic multilingual plane
ERROR: HTTP POST + URL params is not accepting UTF-8 beyond the basic multilingual plane
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;With this patch all is fine:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;bash-4.1$ ./test_utf8.sh
Solr server is up.
HTTP GET is accepting UTF-8
HTTP POST is accepting UTF-8
HTTP POST defaults to UTF-8
HTTP GET is accepting UTF-8 beyond the basic multilingual plane
HTTP POST is accepting UTF-8 beyond the basic multilingual plane
HTTP POST + URL params is accepting UTF-8 beyond the basic multilingual plane
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is identical to Jetty. So we have a fix and no reconfiguration is needed in Tomcat anymore!&lt;/p&gt;

&lt;p&gt;Please note: The last test (ERROR: Response can&apos;t return UTF-8 beyond the basic multilingual plane) fails for me on cygwin with any servlet container, but passes on linux with UTF-8; but this is caused by the shell script which does not work on windows default locale (windows-1252).&lt;/p&gt;</comment>
                            <comment id="13544560" author="yseeley@gmail.com" created="Sat, 5 Jan 2013 03:28:50 +0000"  >&lt;p&gt;I did some manual testing, and one difference I notice is that on IE10 (Windows 8), pasting this into the address bar&lt;br/&gt;
  &lt;a href=&quot;http://rogue.local:8983/solr/query?q=h&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://rogue.local:8983/solr/query?q=h&lt;/a&gt;&#233;llo&lt;br/&gt;
Results in &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;HTTP ERROR 500

Problem accessing /solr/query. Reason: 
    {msg=Not valid UTF8! &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; 6c in state 3,trace=org.eclipse.jetty.util.Utf8Appendable$NotUtf8Exception: Not valid UTF8! &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; 6c in state 3
	at org.eclipse.jetty.util.Utf8Appendable.appendByte(Utf8Appendable.java:174)
	at org.eclipse.jetty.util.Utf8Appendable.append(Utf8Appendable.java:113)
	at org.eclipse.jetty.http.HttpURI.toUtf8String(HttpURI.java:503)
	at org.eclipse.jetty.http.HttpURI.getQuery(HttpURI.java:672)
	at org.eclipse.jetty.server.Request.getQueryString(Request.java:835)
	at org.apache.solr.servlet.StandardRequestParser.parseParamsAndFillStreams(SolrRequestParsers.java:395)
	at org.apache.solr.servlet.SolrRequestParsers.parse(SolrRequestParsers.java:115)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it looks like IE10 doesn&apos;t percent encode the international character, but it wouldn&apos;t matter even if they did because it would be percent encoded latin-1 instead of UTF-8.  It would probably work with Tomcat however (with or without this current patch).&lt;/p&gt;

&lt;p&gt;The old behavior did not result in an HTTP error, but I actually think this new behavior is preferable!&lt;br/&gt;
Before this patch, the request was just incorrect and did not match the users intentions.  At least now it will fail more quickly.&lt;/p&gt;</comment>
                            <comment id="13544638" author="dweiss" created="Sat, 5 Jan 2013 09:14:59 +0000"  >&lt;p&gt;See Uwe, not all browsers respect the new URI spec &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I checked on IE9 and it&apos;s the same. More interestingly, it converts somewhat intelligently because &quot;&#322;&#243;d&#378;&quot; becomes &quot;l&#243;dz&quot; (&#243; is present in ISO8859-1, other accented characters and &#322; need to be mapped to their ASCII equivalents; this isn&apos;t a simple codepage conversion from Unicode).&lt;/p&gt;</comment>
                            <comment id="13544643" author="thetaphi" created="Sat, 5 Jan 2013 09:45:27 +0000"  >&lt;p&gt;Yonik: Internet Exploder is wrong you are right. What we enforce here is that all URLs coming in are in valid-encoded UTF-8, which is also documented in the official Solr docs.&lt;/p&gt;

&lt;p&gt;The problem with IE is the standard one: Microsoft&apos;s sense of backwards compatibility, but should be easy to fix (but for some reason did not work here): Internet Options -&amp;gt; Advanced (tab) -&amp;gt; International -&amp;gt; Send UTF-8-URLs&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The old behavior did not result in an HTTP error, but I actually think this new behavior is preferable!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would also prefer the new behaviour: The user knows that he is wrong and will not complain with horrible discussions making Solr the bad guy being wrong with unicode in the end. User gets clear message that his URL was wrong -&amp;gt; and the stack trace contains Jetty on the top!&lt;/p&gt;

&lt;p&gt;I will do some small improvements in the patch soon and upload a new one. There is one inconsistency currently: When you have a POST request (form-encoded) but also add ?-parameters into the URL, the reported form-encoded charset (the one the client sends in the POST Content-Type) will be used to decode everything, also the URL params. This should be done separately. I have to refactor some code to do this correct &lt;span class=&quot;error&quot;&gt;&amp;#91;currently StandardRequestParser appends both the POST content and the URL-Query and decodes in one turn&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                            <comment id="13544644" author="dweiss" created="Sat, 5 Jan 2013 09:49:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yeah, it&apos;s actually &quot;double encoded&quot;... &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I know. I wasn&apos;t talking about the HTTP layer, I was referring to the servlet spec where the encoding for query string parsing in URIs is not defined and form-encoded POSTs are to use ISO-8859-1 by default. So neither Jetty nor Tomcat are &quot;right&quot; in how they handle parameter parsing from URIs, it was just underspecified from the beginning.&lt;/p&gt;

&lt;p&gt;When you add the HTTP layer above things get even more confusing because, according to the spec, HTTP headers must be in US-ASCII. This includes the URI line so any character outside of US-ASCII (including your example) is a violation of the HTTP protocol. In practice (perhaps sadly) the rules and implementations are much more relaxed and just accept any bytes (until eols) (as per your curl example).&lt;/p&gt;

&lt;p&gt;In theory it should be quite simple: if the encoding cannot be determined otherwise (from the origin page for forms, etc.) then it should be UTF-8 encoded, then URL-escaped. In practice you get all the combinations of behaviors both on the browser/http client side and on the server side.&lt;/p&gt;

&lt;p&gt;Talking about this &amp;#8211; I think I know what IE is trying to do. Since the URL you&apos;re typing in the browser is pretty much an indication where to send a GET request + the resource locator (URI) of the resource you&apos;re trying to access (which will end up in the HTTP header section), it&apos;s probably trying it&apos;s best to convert non-ASCII characters to their ASCII equivalents. So &quot;&#322;&quot; becomes &quot;l&quot; etc. If my explanation is anywhere near right then you need to admit it does make some sense... although it is absolutely useless and absurd in practical terms since any resource accessible via &apos;&#322;&apos; in its path shouldn&apos;t be aliased to &quot;l&quot;: (pl) &quot;&#322;a&#322;&quot; -&amp;gt; (en) &quot;whoa&quot;, &quot;la&#322;&quot; -&amp;gt; (&lt;span class=&quot;error&quot;&gt;&amp;#91;he&amp;#93;&lt;/span&gt; was pissing)...&lt;/p&gt;

&lt;p&gt;Talk about standards, eh? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13544663" author="dweiss" created="Sat, 5 Jan 2013 10:38:36 +0000"  >&lt;p&gt;Some fun with IE and non-ASCII parameters. I have a Polish Windows (Windows-1250) but even Polish codepage characters are normalized to ASCII. A more interesting example is Russian where some glyphs could be translated into ASCII but are not (and some are &amp;#8211; see &#1052;&#1086;&#1089;&#1082;&#1074;&#1072;).&lt;/p&gt;</comment>
                            <comment id="13544677" author="gnx_androidoman" created="Sat, 5 Jan 2013 11:54:58 +0000"  >&lt;p&gt;On my experience, all the application servers I&apos;ve used have the same behavior : Tomcat, JBoss, GlassFish, Oracle Application Server, WebLogic and WebSphere.&lt;br/&gt;
If character encoding is known through the HTTP request, then the parameter Map is correctly converted in unicode. If not known, the conversion is done in 8859-1 and its the servlet (or other) responsability to reencode each parameter properly.&lt;br/&gt;
From html pages, I think it&apos;s the meta tag charset that define the charset in which the URL parameters should be encoded.&lt;/p&gt;

&lt;p&gt;As mentionned in a previous post, browsers never send the character encoding in the http request (IEx, Firefox, Chrome, Opera). The only way to force the charset in request is to use XMLHttpRequest JS API.&lt;/p&gt;

&lt;p&gt;OK with you : a parameter should always be in US7ASCII range, much more simple &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13544678" author="thetaphi" created="Sat, 5 Jan 2013 12:02:24 +0000"  >&lt;p&gt;Alex: We have already fixed the problem by not using the servlet API&apos;s parameter decoder. Solr was already using an own one for the query string, but npot yet used everywhere.&lt;/p&gt;

&lt;p&gt;The documentation in Solr says: All request parameters must be %-encoded with UTF-8, so we cannot depend on what the application server thinks is right. So we decode as UTF-8 as e.g. Jetty does. If it is not UTF-8 you get an error.&lt;/p&gt;</comment>
                            <comment id="13544679" author="gnx_androidoman" created="Sat, 5 Jan 2013 12:09:28 +0000"  >&lt;p&gt;I&apos;ve just look at the .patch and I understand the way in which you made the patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Thank&apos;s for all.&lt;/p&gt;</comment>
                            <comment id="13544726" author="thetaphi" created="Sat, 5 Jan 2013 14:37:45 +0000"  >&lt;p&gt;Here the final patch with some improvements, security fixes and refactoring:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The parser for POSTed application/x-www-form-urlencoded is now a separate SolrRequestParser. This makes code more clean. StnadrdRequestParser just delegates&lt;/li&gt;
	&lt;li&gt;The POST form data now is also limited in size as given in SolrConfig (like multipart messages). Defaults to 2 MB. This was also done previously in Jetty, but not configureable through solrconfig. Now its at one place and consistent between all servlet containers.&lt;/li&gt;
	&lt;li&gt;when posting form data but also give parameters in URL, the URL form contents appear &lt;b&gt;before&lt;/b&gt; the POST form data. This is also how it is done in Jetty/Tomcat. This only affects duplicate parameters. Also I fixed the previous code to use UTF-8 always for the URL form data, but for the POSTed one the content-type is visited.&lt;/li&gt;
	&lt;li&gt;Some cleanups in the other Solr servlets, also reenable POST is the ZookeeperInfoServlet (it now uses SolrRequestParsers - so all servlets are consistent in how they get input parameters)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I want to commit this later this evening. I hope all is fine. If you have some time, you can check it.&lt;/p&gt;

&lt;p&gt;It might be good to backport this to 3.6.3 (if it comes out), as this is a serious issue for many people using Tomcat instead of Jetty and that don&apos;t read the Solr Wiki how to correctly configure their container.&lt;/p&gt;</comment>
                            <comment id="13544735" author="thetaphi" created="Sat, 5 Jan 2013 15:10:17 +0000"  >&lt;p&gt;I am currently investigation to be more srict with parameter encoding: Currently it is not an error if the %-encoded terms are not valid UTF-8 (URLDecoder of JDK replaces all invalid chars with ?). To make this more strict and fail correctly (not silently doing the wrong thing), we could use commons-codec&apos;s (we already use that library) to do a binary URL decoding: &lt;a href=&quot;http://commons.apache.org/codec/api-release/org/apache/commons/codec/net/URLCodec.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/codec/api-release/org/apache/commons/codec/net/URLCodec.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;URLCodec.decodeUrl takes byte[] and returns byte[]. Using this method we have full flexibility on throwing encoding errors. We can in that case also pass the byte[] contents from POST stream directly! Should we do this or not? The current approach is greedy like webservers that also accept almost any wrong encoded %XX stuff.&lt;/p&gt;</comment>
                            <comment id="13544747" author="thetaphi" created="Sat, 5 Jan 2013 16:28:56 +0000"  >&lt;p&gt;Previous patch had an integer overflow in limitUploadMB. Fixed.&lt;/p&gt;</comment>
                            <comment id="13544764" author="dweiss" created="Sat, 5 Jan 2013 17:08:14 +0000"  >&lt;p&gt;I&apos;m fine with this patch if you want to commit it although I&apos;d rather see out-of-the-box compliance against a typical browser behavior? Namely, if you have a POST form, with a target URL that contains (unescaped) unicode characters, the browser will use the originating page&apos;s encoding for both POST parameters and the URL. Say, something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &amp;lt;form action=&lt;span class=&quot;code-quote&quot;&gt;&quot;echo.jsp?abc=&#322;&#243;d&#378;&quot;&lt;/span&gt; method=&lt;span class=&quot;code-quote&quot;&gt;&quot;post&quot;&lt;/span&gt; enctype=&lt;span class=&quot;code-quote&quot;&gt;&quot;application/x-www-form-urlencoded&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;input type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;blah&quot;&lt;/span&gt;&amp;gt;&amp;lt;br&amp;gt;
      &amp;lt;input type=&lt;span class=&quot;code-quote&quot;&gt;&quot;submit&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Submit&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;/form&amp;gt;    
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enforcing UTF-8 but respecting POST encoding for the body seems like we&apos;re creating custom rules which, given the mess we talked about above, should probably be avoided. The rules for me should be fairly simple:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try to get character encoding from HTTP header; if not present, assume UTF-8&lt;/li&gt;
	&lt;li&gt;decode the URI and the body (if POST) using the above encoding. If decoder failures occur, return HTTP BAD_REQUEST.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The advantage here is that these rules won&apos;t surprise people that have simple HTML forms (for some reason with partial query string already hardcoded in the action attribute). If you apply your patch, you&apos;ll have to url-escape UTF-8 yourself (assuming the page&apos;s encoding is not UTF-8).&lt;/p&gt;

&lt;p&gt;Just a thought, I don&apos;t have a strong opinion about this.&lt;/p&gt;
</comment>
                            <comment id="13544767" author="thetaphi" created="Sat, 5 Jan 2013 17:26:10 +0000"  >&lt;p&gt;Dawid: If the encoding for the URL would be different than UTF-8 we are again at the problems we had before. So everything that comes in as part of the URL has to be UTF-8 URLEncoded.&lt;/p&gt;

&lt;p&gt;The additional formdata in POST has to be handled like the standard wants: You have to respect the encoding given in the Content-Type. But you can be sure: No browser actually sends it, so it is also always defaulting to UTF-8. But &lt;b&gt;if&lt;/b&gt; somebody sets the encoding, it must be rrespected.&lt;/p&gt;

&lt;p&gt;For URLS you have no chance, as the encoding cannot be submitted wih the HTTP request, unless HTTP/1.2 defines a new header that defines encoding for the URL &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The polish example above is broken alltogether, as the URL in action is not a valid URL. It also has the same problems as it is is not cross-browser supported in the same way. The user will get Jetty errors like discussed above (with IE) or otherwise broken behaviour. There is nothing we can do.&lt;/p&gt;

&lt;blockquote&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try to get character encoding from HTTP header; if not present, assume UTF-8&lt;/li&gt;
	&lt;li&gt;decode the URI and the body (if POST) using the above encoding. If decoder failures occur, return HTTP BAD_REQUEST.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;The body encoding says nothing about the URL encoding. Also you cannot give it for GET requests. So enforcing URLs to be UTF-8 is consistent.&lt;/p&gt;

&lt;p&gt;Uwe&lt;/p&gt;</comment>
                            <comment id="13544768" author="thetaphi" created="Sat, 5 Jan 2013 17:28:32 +0000"  >&lt;p&gt;More cleanup, make the maximum form data size separately configureable.&lt;/p&gt;</comment>
                            <comment id="13544770" author="dweiss" created="Sat, 5 Jan 2013 17:35:16 +0000"  >&lt;p&gt;I disagree with you here. The example is fine because browsers will escape the action URI for you; they&apos;ll just use the codepage of the origin HTML, whatever it was. So it&apos;s a perfectly valid HTTP request and a perfectly valid query. The fact that browser don&apos;t send the information which encoding they used for doing so is of no relevance. You can try it, the form above would be sent (from an Windows1250 encoded Web page) as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ nc -l 8081
POST /echo.jsp?abc=%B3%F3d%9F HTTP/1.1
Host: localhost:8081
Connection: keep-alive
Content-Length: 15
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The URL is invalid in the HTML source but browsers will &quot;fix&quot; it for you (url-escape) and many people accept it as something ordinary.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The body encoding says nothing about the URL encoding.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It does in the context of browsers. See my example above or try it yourself:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;%@ page language=&lt;span class=&quot;code-quote&quot;&gt;&quot;java&quot;&lt;/span&gt; contentType=&lt;span class=&quot;code-quote&quot;&gt;&quot;text/html; charset=Cp1250&quot;&lt;/span&gt; pageEncoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;%&amp;gt;
&amp;lt;html&amp;gt;
  &amp;lt;body&amp;gt;
    &amp;lt;form action=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8081/echo.jsp?abc=&#322;&#243;d&#378;&quot;&lt;/span&gt; method=&lt;span class=&quot;code-quote&quot;&gt;&quot;post&quot;&lt;/span&gt; enctype=&lt;span class=&quot;code-quote&quot;&gt;&quot;application/x-www-form-urlencoded&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;      &amp;lt;input type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;blah&quot;&lt;/span&gt;&amp;gt;&amp;lt;br&amp;gt;
      &amp;lt;input type=&lt;span class=&quot;code-quote&quot;&gt;&quot;submit&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Submit&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;/form&amp;gt;    
  &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13544772" author="dweiss" created="Sat, 5 Jan 2013 17:45:54 +0000"  >&lt;p&gt;I still think it would have been more consistent to apply this to both the body and the URI (like Tomcat does if you request so in the config) but you can disregard me here. Maybe I&apos;m paranoid.&lt;/p&gt;</comment>
                            <comment id="13544774" author="thetaphi" created="Sat, 5 Jan 2013 17:48:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;The URL is invalid in the HTML source but browsers will &quot;fix&quot; it for you (url-escape) and many people accept it as something ordinary.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thats the whole problem, I agree. But we don&apos;t know what the browser used as encoding for encoding the URL. So without a charset given somewhere we cannot decode the URL. You have the problem with GET and POST requests. Because of this you cannot fix this for SOLR.&lt;/p&gt;

&lt;p&gt;The patch does not change any behaviour in guessing charsets from before, the &lt;b&gt;only&lt;/b&gt; change here is the encoding used to decode URLs (which is now &quot;UTF-8&quot; because several web containers handle this in a different way). Jetty and Tomcat both handled POST content respecting the charset of the POST BODY - and that did not change.&lt;/p&gt;

&lt;p&gt;Where is your problem with Solr? The whole discussion could be flame-wared on the Jetty or Tomcat lists as before, unfortunately the HTTP spec and the Servlet spec and the URL spec are not precise enough. For Solr it is not an issue: Solr is documented to only accept URL encoded request parameters as UTF-8.&lt;/p&gt;

&lt;p&gt;The only way to change this would be to do it like search engine. They allow to pass in an &quot;ie=&quot; extra GET parameter that defines the &quot;input encoding&quot; of the URL parameters. In that case you could do a 2-step URL parsing approach (or use commons-codec: decode the binary url from the byte[] and then interpret the &quot;ie&quot; parameter as US-ASCII and use it to decode the remaining parameters.&lt;/p&gt;</comment>
                            <comment id="13544775" author="thetaphi" created="Sat, 5 Jan 2013 17:52:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;I still think it would have been more consistent to apply this to both the body and the URI (like Tomcat does if you request so in the config) but you can disregard me here. Maybe I&apos;m paranoid.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Tomcat and Jetty default to a charset (according to the config). This charset is used in any case for the URL (it is always used for the URL!!!) - and it is used for the POST content if the charset is not given. If the Content-Type of the POST body is given, Jetty and Tomcat use the one given in content type.&lt;/p&gt;

&lt;p&gt;If you have a pure GET request its disallowed to set &quot;Content-Type&quot; so the charset is lost.&lt;/p&gt;</comment>
                            <comment id="13544776" author="thetaphi" created="Sat, 5 Jan 2013 18:03:44 +0000"  >&lt;p&gt;Just to mention finally: No browser is ever setting a charset in the Content-Type header for &quot;application/x-www-form-urlencoded&quot;, so we will always use UTF-8 (in fact its an &quot;application/&quot; mime type that requires no charset as it is strongly spoken binary data).&lt;/p&gt;

&lt;p&gt;The special case you are talking about is just that somebody explicitely sets a charset for the BODY (not the URL!) in a hand-made HTTP request. If somebody does this, he knows what he does. But in that case, the URL is still defined to be UTF-8 encoded (as the standard says and Solr requires). But as we have a encoding given in the conent type, we must parse the body using the given charset. There is no way around.&lt;/p&gt;</comment>
                            <comment id="13544777" author="dweiss" created="Sat, 5 Jan 2013 18:06:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;Tomcat and Jetty default to a charset (according to the config). This charset is used in any case for the URL (it is always used for the URL!!!) - and it is used for the POST content if the charset is not given.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s actually the other way around: you can force the charset for decoding URIs of POSTs and GETs that don&apos;t specify their own charset in HTTP headers using useBodyEncodingForURI (Tomcat).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/tomcat/FAQ/CharacterEncoding#Q2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/tomcat/FAQ/CharacterEncoding#Q2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Anyway, it&apos;s fine, I think this patch takes it a lot further than it was anyway.&lt;/p&gt;</comment>
                            <comment id="13544783" author="thetaphi" created="Sat, 5 Jan 2013 19:14:30 +0000"  >&lt;p&gt;In Tomcat you can do this. Unfortunately, the default for Tomcat is to always use ISO-8859-1 as encoding for URL parameters and use the submitted body encoding (if available) for the form data. Jetty does the same, see &lt;a href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/org.eclipse.jetty/jetty-server/8.1.7.v20120910/org/eclipse/jetty/server/Request.java#Request.extractParameters%28%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grepcode.com/file/repo1.maven.org/maven2/org.eclipse.jetty/jetty-server/8.1.7.v20120910/org/eclipse/jetty/server/Request.java#Request.extractParameters%28%29&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I will commit this patch later if nobody objects. We can open another issue to improve error handling on invalid encodings using commons-codec for URL decoding. This could also add the &quot;ie=charset&quot; request parameter (like Google and BING and others do), to specify the encoding of the URL request parameters.&lt;/p&gt;</comment>
                            <comment id="13544797" author="yseeley@gmail.com" created="Sat, 5 Jan 2013 19:35:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Jetty does the same&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In my experience, Jetty defaulted to UTF-8 for the URL encoding.  AFAIK, we&apos;ve never needed to tweak jetty charset config.&lt;/p&gt;</comment>
                            <comment id="13544799" author="thetaphi" created="Sat, 5 Jan 2013 19:42:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;In my experience, Jetty defaulted to UTF-8 for the URL encoding. AFAIK, we&apos;ve never needed to tweak jetty charset config.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, thats right. Dawid and I were discussing about the behaviour regarding the encoding from POST content (if it overrides the URL encoding or not), although the used defaults were different in both web container. The difference with Jetty was simply that the encoding for URL parameters is UTF-8, see the above code from Request.java where it parses the query string.&lt;/p&gt;

&lt;p&gt;The final patch does exactly the same like jetty always did, only the default is fixed to be UTF-8 on any web container.&lt;/p&gt;</comment>
                            <comment id="13545412" author="thetaphi" created="Sun, 6 Jan 2013 14:37:42 +0000"  >&lt;p&gt;Final patch for trunk, now committing it.&lt;/p&gt;

&lt;p&gt;I added the new maximum formdata setting to example solrconfigs.&lt;/p&gt;

&lt;p&gt;I also added some checks in the formdata request parser, so it fails when you have changed the solr webapplication and added an incompatible Filter before SolrDispatchFilter that calls Request#getParameter*() and causes the servlet container to incorrectly jump in.&lt;/p&gt;</comment>
                            <comment id="13545418" author="commit-tag-bot" created="Sun, 6 Jan 2013 14:58:30 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Uwe Schindler&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429534&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429534&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4265&quot; title=&quot;Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4265&quot;&gt;&lt;del&gt;SOLR-4265&lt;/del&gt;&lt;/a&gt;: Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)&lt;/p&gt;</comment>
                            <comment id="13545419" author="thetaphi" created="Sun, 6 Jan 2013 15:00:07 +0000"  >&lt;p&gt;OK, I committed the new stuff. I will now check and update Solr Wiki.&lt;/p&gt;</comment>
                            <comment id="13545420" author="commit-tag-bot" created="Sun, 6 Jan 2013 15:04:22 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Uwe Schindler&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429535&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429535&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1429534 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4265&quot; title=&quot;Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4265&quot;&gt;&lt;del&gt;SOLR-4265&lt;/del&gt;&lt;/a&gt;: Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)&lt;/p&gt;</comment>
                            <comment id="13545426" author="thetaphi" created="Sun, 6 Jan 2013 15:33:00 +0000"  >&lt;p&gt;I fixed also the Solr Wiki pages of Tomcat, Glassfish,...&lt;/p&gt;</comment>
                            <comment id="13545926" author="commit-tag-bot" created="Mon, 7 Jan 2013 14:44:20 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Uwe Schindler&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429822&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4265&quot; title=&quot;Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4265&quot;&gt;&lt;del&gt;SOLR-4265&lt;/del&gt;&lt;/a&gt;: Remove useless setting in Jetty&apos;s server config file, as maximum form content is now handled by solr&apos;s RequestParser and not the web container.&lt;/p&gt;</comment>
                            <comment id="13545927" author="thetaphi" created="Mon, 7 Jan 2013 14:44:35 +0000"  >&lt;p&gt;I committed the removal of the Jetty-specifi example setting for maximum POST formdata size (as the webapp now handles this by its own code and own limits).&lt;/p&gt;</comment>
                            <comment id="13545930" author="commit-tag-bot" created="Mon, 7 Jan 2013 14:48:21 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Uwe Schindler&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429824&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1429822 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4265&quot; title=&quot;Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4265&quot;&gt;&lt;del&gt;SOLR-4265&lt;/del&gt;&lt;/a&gt;: Remove useless setting in Jetty&apos;s server config file, as maximum form content is now handled by solr&apos;s RequestParser and not the web container.&lt;/p&gt;</comment>
                            <comment id="13546154" author="commit-tag-bot" created="Mon, 7 Jan 2013 18:58:20 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Uwe Schindler&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429958&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429958&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4265&quot; title=&quot;Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4265&quot;&gt;&lt;del&gt;SOLR-4265&lt;/del&gt;&lt;/a&gt;: Fix charset bug... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13546157" author="commit-tag-bot" created="Mon, 7 Jan 2013 19:00:20 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Uwe Schindler&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1429959&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1429958 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4265&quot; title=&quot;Fix decoding of GET/POST parameters for servlet containers with non-UTF-8 URL parsing (Tomcat)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4265&quot;&gt;&lt;del&gt;SOLR-4265&lt;/del&gt;&lt;/a&gt;: Fix charset bug... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12628843">SOLR-4336</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12624808">SOLR-4223</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12626438">SOLR-4283</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12563412" name="CropperCapture[4].png" size="41860" author="dweiss" created="Sat, 5 Jan 2013 10:38:36 +0000"/>
                            <attachment id="12563413" name="CropperCapture[5].png" size="33790" author="dweiss" created="Sat, 5 Jan 2013 10:38:36 +0000"/>
                            <attachment id="12563414" name="CropperCapture[6].png" size="32463" author="dweiss" created="Sat, 5 Jan 2013 10:38:36 +0000"/>
                            <attachment id="12563484" name="SOLR-4265.patch" size="45277" author="uschindler" created="Sun, 6 Jan 2013 14:37:42 +0000"/>
                            <attachment id="12563435" name="SOLR-4265.patch" size="34042" author="uschindler" created="Sat, 5 Jan 2013 17:28:32 +0000"/>
                            <attachment id="12563432" name="SOLR-4265.patch" size="32971" author="uschindler" created="Sat, 5 Jan 2013 16:28:56 +0000"/>
                            <attachment id="12563424" name="SOLR-4265.patch" size="32364" author="uschindler" created="Sat, 5 Jan 2013 14:37:45 +0000"/>
                            <attachment id="12563387" name="SOLR-4265.patch" size="18788" author="uschindler" created="Sat, 5 Jan 2013 01:48:01 +0000"/>
                            <attachment id="12563385" name="SOLR-4265.patch" size="16848" author="uschindler" created="Sat, 5 Jan 2013 01:13:02 +0000"/>
                            <attachment id="12563349" name="SolrDispatchFilter.java.patch" size="645" author="uschindler" created="Fri, 4 Jan 2013 19:34:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302668</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 46 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i174mn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249718</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>