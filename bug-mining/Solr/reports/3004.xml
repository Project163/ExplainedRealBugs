<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:14:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8777] Duplicate Solr process can cripple a running process</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8777</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mewmewball&quot; class=&quot;user-hover&quot; rel=&quot;mewmewball&quot;&gt;mewmewball&lt;/a&gt; for catching this one.&lt;/p&gt;

&lt;p&gt;Accidentally executing the same instance of Solr twice causes the second start instance to die with an &quot;Address already in use&quot;, but not before deleting the first instance&apos;s live_node entry, emitting &quot;Found a previous node that still exists while trying to register a new live node &amp;lt;node&amp;gt; - removing existing node to create another&quot;.&lt;/p&gt;

&lt;p&gt;The second start instance dies and its ephemeral node is then removed, causing /live_nodes/&amp;lt;node&amp;gt; to be empty since the first start instance&apos;s live_node was deleted by the second.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12946203">SOLR-8777</key>
            <summary>Duplicate Solr process can cripple a running process</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2016 17:03:31 +0000</created>
                <updated>Wed, 2 Oct 2019 17:23:35 +0000</updated>
                            <resolved>Wed, 29 Jun 2016 11:53:04 +0000</resolved>
                                    <version>5.3.1</version>
                                    <fixVersion>6.2</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15176360" author="dragonsinth" created="Wed, 2 Mar 2016 19:57:54 +0000"  >&lt;p&gt;I can take a crack at this.  My thought would be to attempt the bind the port earlier on, and exit more quickly.  BTW, looking at just the code, it looks like the live_node isn&apos;t the only possible disruption: ZkController.init() also tries to join overseer election and publish all nodes as down.&lt;/p&gt;</comment>
                            <comment id="15176886" author="dragonsinth" created="Thu, 3 Mar 2016 01:07:12 +0000"  >&lt;p&gt;Oh yuck, looks like jetty controls the ordering, and doesn&apos;t bind the port until after all the ServletFilters are initialized, which is what ultimately starts up ZkController.&lt;/p&gt;</comment>
                            <comment id="15178770" author="dragonsinth" created="Thu, 3 Mar 2016 22:53:42 +0000"  >&lt;p&gt;Not completely related, but it seems like there&apos;s a bug in jetty&apos;s SocketConnector.  It uses the ServerSocket constructor that automatically binds the port, then attempts to set setReuseAddress(), which makes no sense.  It should use the other constructor, set the reuse_address option, then call bind() manually.&lt;/p&gt;

&lt;p&gt;In other news, I don&apos;t know that there&apos;s a way to change Jetty&apos;s startup sequence.. the best I could do is try to use reflection to pull the connectors off the Server and start them early.  But that seems ungood.&lt;/p&gt;

&lt;p&gt;I suppose we could spin for a while waiting for the previous ephemeral node to disappear, and if it doesn&apos;t, error out and refuse to start?&lt;/p&gt;</comment>
                            <comment id="15187828" author="shalinmangar" created="Wed, 9 Mar 2016 20:08:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;I suppose we could spin for a while waiting for the previous ephemeral node to disappear, and if it doesn&apos;t, error out and refuse to start?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, spinning for say 2 * sessionTimeout should do the trick. This effectively removes this optimisation for fast node restarts and we can look into bringing it back in some form at a later date.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Not completely related, but it seems like there&apos;s a bug in jetty&apos;s SocketConnector. It uses the ServerSocket constructor that automatically binds the port, then attempts to set setReuseAddress(), which makes no sense. It should use the other constructor, set the reuse_address option, then call bind() manually.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Perhaps &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joakime&quot; class=&quot;user-hover&quot; rel=&quot;joakime&quot;&gt;joakime&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gregw&quot; class=&quot;user-hover&quot; rel=&quot;gregw&quot;&gt;gregw&lt;/a&gt; can chime in here?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In other news, I don&apos;t know that there&apos;s a way to change Jetty&apos;s startup sequence.. the best I could do is try to use reflection to pull the connectors off the Server and start them early. But that seems ungood.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Theoretically, now that we control the app server &amp;#8211; we could move to using embedded Jetty (like we do for tests with JettySolrRunner) and control the lifecycle pretty much exactly but that is way overkill for this issue.&lt;/p&gt;</comment>
                            <comment id="15353584" author="shalinmangar" created="Tue, 28 Jun 2016 19:27:07 +0000"  >&lt;p&gt;Here&apos;s a patch which waits for upto twice the session timeout for the ephemeral node to go away before setting up overseer election and creating live node. If the node doesn&apos;t go away, we raise an exception and bail out.&lt;/p&gt;</comment>
                            <comment id="15353715" author="dragonsinth" created="Tue, 28 Jun 2016 21:02:02 +0000"  >&lt;p&gt;LGTM.  One suggestion, it&apos;s almost as easy to make checkForExistingEphemeralNode() to use a watcher instead of a loop.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void checkForExistingEphemeralNode() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; KeeperException, InterruptedException {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (zkRunOnly) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
  }
  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; nodeName = getNodeName();
  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; nodePath = ZkStateReader.LIVE_NODES_ZKNODE + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + nodeName;

  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!zkClient.exists(nodePath, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
  }

  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CountDownLatch deletedLatch = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CountDownLatch(1);
  Stat stat = zkClient.exists(nodePath, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watcher() {
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(WatchedEvent event) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Event.EventType.None.equals(event.getType())) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
      }
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Event.EventType.NodeDeleted.equals(event.getType())) {
        deletedLatch.countDown();
      }
    }
  }, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);

  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stat == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-comment&quot;&gt;// suddenly disappeared
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
  }

  &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; deleted = deletedLatch.await(zkClient.getSolrZooKeeper().getSessionTimeout() * 2, TimeUnit.MILLISECONDS);
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!deleted) {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException(ErrorCode.SERVER_ERROR, &lt;span class=&quot;code-quote&quot;&gt;&quot;A previous ephemeral live node still exists. &quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;Solr cannot &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;. Please ensure that no other Solr process using the same port is running already.&quot;&lt;/span&gt;);
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15354609" author="shalinmangar" created="Wed, 29 Jun 2016 05:57:00 +0000"  >&lt;p&gt;Thanks Scott! I like your solution better so this patch uses your code. I&apos;ll commit this shortly.&lt;/p&gt;</comment>
                            <comment id="15354863" author="jira-bot" created="Wed, 29 Jun 2016 09:20:29 +0000"  >&lt;p&gt;Commit 4ea95bf8f11a9fb0b4226a0cd4b6840b845cf611 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4ea95bf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4ea95bf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8777&quot; title=&quot;Duplicate Solr process can cripple a running process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8777&quot;&gt;&lt;del&gt;SOLR-8777&lt;/del&gt;&lt;/a&gt;: Duplicate Solr process can cripple a running process&lt;/p&gt;</comment>
                            <comment id="15355082" author="jira-bot" created="Wed, 29 Jun 2016 11:52:20 +0000"  >&lt;p&gt;Commit 812fd346f7a136ccfe550a6ba0d7b0e634d68769 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=812fd34&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=812fd34&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8777&quot; title=&quot;Duplicate Solr process can cripple a running process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8777&quot;&gt;&lt;del&gt;SOLR-8777&lt;/del&gt;&lt;/a&gt;: Duplicate Solr process can cripple a running process&lt;br/&gt;
(cherry picked from commit 4ea95bf)&lt;/p&gt;</comment>
                            <comment id="15355084" author="shalinmangar" created="Wed, 29 Jun 2016 11:53:04 +0000"  >&lt;p&gt;Thanks Jessica and Scott!&lt;/p&gt;</comment>
                            <comment id="15438964" author="mikemccand" created="Fri, 26 Aug 2016 13:58:56 +0000"  >&lt;p&gt;Bulk close resolved issues after 6.2.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12814580" name="SOLR-8777.patch" size="5588" author="shalin" created="Wed, 29 Jun 2016 05:57:00 +0000"/>
                            <attachment id="12814167" name="SOLR-8777.patch" size="3529" author="shalin" created="Tue, 28 Jun 2016 19:27:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u1fr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>