<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:21:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2348] No error reported when using a FieldCached backed ValueSource for a field Solr knows won&apos;t work</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2348</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;For the same reasons outlined in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2339&quot; title=&quot;No error reported when sorting on a multiValued field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2339&quot;&gt;&lt;del&gt;SOLR-2339&lt;/del&gt;&lt;/a&gt;, Solr FieldTypes that return FieldCached backed ValueSources should explicitly check for situations where knows the FieldCache is meaningless.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12497636">SOLR-2348</key>
            <summary>No error reported when using a FieldCached backed ValueSource for a field Solr knows won&apos;t work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Feb 2011 23:15:56 +0000</created>
                <updated>Tue, 17 Nov 2015 17:51:31 +0000</updated>
                            <resolved>Thu, 17 Feb 2011 02:23:22 +0000</resolved>
                                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12991771" author="hossman" created="Tue, 8 Feb 2011 02:23:27 +0000"  >&lt;p&gt;My hope had been that this would be really straightforward, and a simple inspection of the SchemaField (or FieldType) could be done inside the FieldCacheSource to cover all cases &amp;#8211; except that FieldCacheSource (and it&apos;s subclasses) is only ever given a field name, and never gets a copy of the FieldType, SchemaField of even the IndexSchema to inspect to ensure that using the FieldCache is viable.&lt;/p&gt;

&lt;p&gt;This means that we have to take the same basic approach as &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2339&quot; title=&quot;No error reported when sorting on a multiValued field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2339&quot;&gt;&lt;del&gt;SOLR-2339&lt;/del&gt;&lt;/a&gt; - every FieldType impl that utilizes a FieldCacheSource in it&apos;s getValueSource method needs to check if FieldCache is viable for that field (ie: indexed, not multivalued)&lt;/p&gt;

&lt;p&gt;We could rename the checkSortability method I just added in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2339&quot; title=&quot;No error reported when sorting on a multiValued field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2339&quot;&gt;&lt;del&gt;SOLR-2339&lt;/del&gt;&lt;/a&gt; into a &quot;checkFieldCachibility&quot; type method and use it for both purposes, but:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;it currently throws exceptions with specific messages like &quot;can not sort on unindexed field: &quot;&lt;/li&gt;
	&lt;li&gt;I seem to recall some folks talking about the idea of expanding FieldCache to support more things like UninvertedField does, in which case being multivalued won&apos;t prevent you from using the FieldCache on a field which would ultimately mean the pre-conditions for using a FieldCacheSource would change.  We could imagine the user specifing a function that takes in vector args to use to collapse the multiple values per doc on a per usage basis (ie: in this function query case, use the max value of the multiple values for each doc; in this function query, use the average value of the multiple values for each doc; etc...)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;with that in mind, i think for now the most straight forward thing to do is to add a &quot;checkFieldCacheSource(QParser)&quot; method to SchemaField that would be cut/paste of checkSortability (with the error message wording changed) and make all of the (applicable) FieldType.getValueSource methods call it.  In the future, it could evolve differently then checkSortability &amp;#8211; either removing the &quot;!multivalued&quot; assertion completley, or introspecting the Qparser context in some way to determine that neccessary info has been provided to know how to use the (hypothetical) multivalued FieldCache (hard t ospeculate at this point)&lt;/p&gt;
</comment>
                            <comment id="12994065" author="rcmuir" created="Sun, 13 Feb 2011 10:35:30 +0000"  >&lt;p&gt;There isn&apos;t any patch here yet, can we move out to 3.2?&lt;/p&gt;</comment>
                            <comment id="12994777" author="rcmuir" created="Tue, 15 Feb 2011 12:59:12 +0000"  >&lt;p&gt;moving to 3.2&lt;/p&gt;</comment>
                            <comment id="12994943" author="hossman" created="Tue, 15 Feb 2011 19:27:45 +0000"  >&lt;p&gt;patch with needed functionality, breaks some tests (most likely tests abusing multiValued field types)...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@bester:~/lucene/dev/solr$ grep -L &quot;Failures: 0, Errors: 0&quot; build/test-results/TEST-org.apache.solr.*
build/test-results/TEST-org.apache.solr.schema.PolyFieldTest.txt
build/test-results/TEST-org.apache.solr.search.function.distance.DistanceFunctionTest.txt
build/test-results/TEST-org.apache.solr.search.function.SortByFunctionTest.txt
build/test-results/TEST-org.apache.solr.search.QueryParsingTest.txt
build/test-results/TEST-org.apache.solr.search.SpatialFilterTest.txt
build/test-results/TEST-org.apache.solr.search.TestIndexSearcher.txt
build/test-results/TEST-org.apache.solr.search.TestQueryTypes.txt
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12994945" author="hossman" created="Tue, 15 Feb 2011 19:28:07 +0000"  >&lt;p&gt;i&apos;m actively working on this today .. moving back in line for 3.1&lt;/p&gt;</comment>
                            <comment id="12994949" author="rcmuir" created="Tue, 15 Feb 2011 19:33:36 +0000"  >&lt;p&gt;Hoss, sorry to move it out, glad to see you are working on it!&lt;/p&gt;</comment>
                            <comment id="12995058" author="hossman" created="Tue, 15 Feb 2011 23:25:54 +0000"  >&lt;p&gt;Updated patch that fixes the test failures.&lt;/p&gt;

&lt;p&gt;For the most part, this is fairly straight forward: tests that were abusing multiValued fields as if they were single valued.&lt;/p&gt;

&lt;p&gt;The one situation where i made a genuine code change was in AbstractSubTypeFieldType and the way it deals with the &quot;subFieldType&quot; attribute.  When it&apos;s used, the registerPolyFieldDynamicPrototype function registers a new dynamic field based on the specified fieldType instance.  I updated the properties used to generate these dynamicFields so that it explicitly specifies multiValued=false (it was already specifying indexed=true and stored=false)&lt;/p&gt;

&lt;p&gt;I could have just updated the test schemas so that the fieldType specified was already multiValued, but i think this makes more sense from a functional standpoint.  the existing code already enabled a use case like this...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;fieldType name=&quot;double&quot; class=&quot;solr.TrieDoubleField&quot; indexed=&quot;false&quot; multiValued=&quot;false&quot; ... /&amp;gt;
&amp;lt;fieldType name=&quot;xy&quot; class=&quot;solr.PointType&quot; dimension=&quot;2&quot; subFieldType=&quot;double&quot;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...so it makes sense that this should work equally well automatically...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;fieldType name=&quot;double&quot; class=&quot;solr.TrieDoubleField&quot; indexed=&quot;true&quot; multiValued=&quot;true&quot; ... /&amp;gt;
&amp;lt;fieldType name=&quot;xy&quot; class=&quot;solr.PointType&quot; dimension=&quot;2&quot; subFieldType=&quot;double&quot;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="12995612" author="hossman" created="Thu, 17 Feb 2011 00:38:35 +0000"  >&lt;p&gt;Committed revision 1071459. - trunk&lt;/p&gt;

&lt;p&gt;working on 3x backporting now&lt;/p&gt;</comment>
                            <comment id="12995640" author="hossman" created="Thu, 17 Feb 2011 02:23:22 +0000"  >&lt;p&gt;Committed revision 1071480. - 3x&lt;/p&gt;</comment>
                            <comment id="13013143" author="gsingers" created="Wed, 30 Mar 2011 15:45:41 +0000"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12497007">SOLR-2339</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12912956">SOLR-8290</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12471130" name="SOLR-2348.patch" size="25759" author="hossman" created="Tue, 15 Feb 2011 23:25:54 +0000"/>
                            <attachment id="12471098" name="SOLR-2348.patch" size="11472" author="hossman" created="Tue, 15 Feb 2011 19:27:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5178</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03lbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18886</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>