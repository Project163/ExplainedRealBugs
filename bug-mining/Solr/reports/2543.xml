<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7712] TestCloudPivotFacet failure</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7712</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;java8, branch_5x &amp;amp; trunk, r1686892&lt;/p&gt;

&lt;p&gt;Original failure here (Linux): &amp;lt;&lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-5.x-Java8/144/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-5.x-Java8/144/&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;Reproduces for me on OS X 10.10 on branch_5x, but on trunk failed to reproduce the one time I tried it.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=test -Dtests.seed=2701C0115CD1BF95 -Dtests.slow=true -Dtests.locale=ja_JP -Dtests.timezone=America/Scoresbysund -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 42.6s | TestCloudPivotFacet.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: {main(facet=true&amp;amp;facet.pivot=%7B%21stats%3Dst1%7Dpivot_y_s1%2Cdense_pivot_y_s%2Cdense_pivot_ti1&amp;amp;facet.limit=9&amp;amp;facet.sort=index),extra(rows=0&amp;amp;q=id%3A%5B*+TO+304%5D&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tf1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_x_s&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_ti1&amp;amp;_test_sort=index)} ==&amp;gt; Mean of sk1 =&amp;gt; pivot_y_s1,dense_pivot_y_s,dense_pivot_ti1: {params(rows=0),defaults({main(rows=0&amp;amp;q=id%3A%5B*+TO+304%5D&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tf1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_x_s&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_ti1&amp;amp;_test_sort=index),extra(fq=%7B%21term+f%3Dpivot_y_s1%7Dh)})} expected:&amp;lt;-1.4136202738271603E8&amp;gt; but was:&amp;lt;-1.4136202738271606E8&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([2701C0115CD1BF95:AF55FFCBF22DD26D]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:281)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.test(TestCloudPivotFacet.java:228)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:960)
   [junit4]    &amp;gt; 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:935)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: java.lang.AssertionError: Mean of sk1 =&amp;gt; pivot_y_s1,dense_pivot_y_s,dense_pivot_ti1: {params(rows=0),defaults({main(rows=0&amp;amp;q=id%3A%5B*+TO+304%5D&amp;amp;stats=true&amp;amp;stats.field=%7B%21key%3Dsk1+tag%3Dst1%2Cst2%7Dpivot_tf1&amp;amp;stats.field=%7B%21key%3Dsk2+tag%3Dst2%2Cst3%7Dpivot_x_s&amp;amp;stats.field=%7B%21key%3Dsk3+tag%3Dst3%2Cst4%7Ddense_pivot_ti1&amp;amp;_test_sort=index),extra(fq=%7B%21term+f%3Dpivot_y_s1%7Dh)})} expected:&amp;lt;-1.4136202738271603E8&amp;gt; but was:&amp;lt;-1.4136202738271606E8&amp;gt;
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotStats(TestCloudPivotFacet.java:383)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotData(TestCloudPivotFacet.java:339)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:302)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:271)
   [junit4]    &amp;gt; 	... 42 more
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12839593">SOLR-7712</key>
            <summary>TestCloudPivotFacet failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Jun 2015 16:28:32 +0000</created>
                <updated>Mon, 9 May 2016 18:53:59 +0000</updated>
                            <resolved>Mon, 29 Jun 2015 17:33:19 +0000</resolved>
                                    <version>5.3</version>
                                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14596792" author="hossman" created="Mon, 22 Jun 2015 22:52:41 +0000"  >&lt;p&gt;TL;DR: I think this test needs some some small deltas when doing float/double comparisons &amp;#8211; but i want to think about it a bit more.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;FYI: I couldn&apos;t immediately reproduce that seed at r1686892 on 5x, the first time i to beast it made it 5 iterations before it failed with the exact same numeric values.&lt;/p&gt;

&lt;p&gt;What this test is doing is executing a pivot fact request with stats enabled, then executing a &quot;drill down&quot; queries on each pivot field value (by adding an fq) and confirming the numResults matches the previously returned pivot count, and that the top level stats of the drill down query equal the previously returned per-pivot stats.&lt;/p&gt;

&lt;p&gt;I remember when writing this test that i expected i would need to do some 3 arg asserts on the floating point stat values to account for a small epsilon that might be introduced in the floating point match because of the different order of computation &amp;#8211; but when i ran the initial straw man test i never got any errors.&lt;/p&gt;

&lt;p&gt;I also remember working through the problem in my head for a few minutes to try and figure out &lt;em&gt;why&lt;/em&gt; it wasn&apos;t failing &amp;#8211; and figuring that regardless of whether it was top level stats or pivot stats, the same code was going to accumulate the (per-index) values in the same order  (the test doesn&apos;t do any index updates concurrent to searching for obvious reasons) and i just left it alone.&lt;/p&gt;

&lt;p&gt;looking at these failures now, and adding some extra logging and thinking about it a bit more, i think we&apos;ve just been getting lucky that this hasn&apos;t failed yet.&lt;/p&gt;

&lt;p&gt;I can think of 2 ways for this type of validation to fail on exact floating point comparison:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&lt;em&gt;if&lt;/em&gt; different replicas get hit by the top level diff queries, &lt;em&gt;or&lt;/em&gt; a diff replica was used to refine a pivot then is used by the verification query, and &lt;em&gt;if&lt;/em&gt; those diff replicas have slightly diff segments (due ot recovery, or retry or whatever so the accumulation of the &quot;sum&quot; of a field for all the matching docs adds the numbers up in a diff order.&lt;/li&gt;
	&lt;li&gt;if there are more then 2 shards, and the 2 top level queries (or the refinement of a pivot query) gets responses from the shards in a diff order) then the sum of the aggregate &quot;sum&quot; involves adding numbers in a diff order.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;if the &quot;sum&quot; is diff, then the &quot;mean&quot; &lt;b&gt;might&lt;/b&gt; be diff as well (depending on precision loss due to dividing by the count)&lt;/p&gt;

&lt;p&gt;But most times, we deal with numeric values that either don&apos;t lose precision when added up, or lose precision the same amount in both ways.&lt;/p&gt;
</comment>
                            <comment id="14603798" author="hossman" created="Fri, 26 Jun 2015 23:52:24 +0000"  >&lt;p&gt;here&apos;s a patch i&apos;m currently beasting on both branches.&lt;/p&gt;</comment>
                            <comment id="14603800" author="hossman" created="Fri, 26 Jun 2015 23:55:31 +0000"  >&lt;p&gt;bah .. ignore that patch.  i totally forgot we support stats on dates and the handful of manual runs i did with that patch never triggered date stats.  new patch soon.&lt;/p&gt;</comment>
                            <comment id="14604477" author="hossman" created="Sun, 28 Jun 2015 02:55:59 +0000"  >&lt;p&gt;beasted this new patch 1500 x2 times last night (trunk + 5x)&lt;/p&gt;

&lt;p&gt;I&apos;ll keep beasting and plan on committing monday.&lt;/p&gt;</comment>
                            <comment id="14605907" author="jira-bot" created="Mon, 29 Jun 2015 17:06:29 +0000"  >&lt;p&gt;Commit 1688266 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1688266&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1688266&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7712&quot; title=&quot;TestCloudPivotFacet failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7712&quot;&gt;&lt;del&gt;SOLR-7712&lt;/del&gt;&lt;/a&gt;: fixed test to account for aggregate floating point precision loss&lt;/p&gt;</comment>
                            <comment id="14605935" author="jira-bot" created="Mon, 29 Jun 2015 17:26:53 +0000"  >&lt;p&gt;Commit 1688267 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1688267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1688267&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7712&quot; title=&quot;TestCloudPivotFacet failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7712&quot;&gt;&lt;del&gt;SOLR-7712&lt;/del&gt;&lt;/a&gt;: fixed test to account for aggregate floating point precision loss (merge r1688266)&lt;/p&gt;</comment>
                            <comment id="14605947" author="hossman" created="Mon, 29 Jun 2015 17:33:19 +0000"  >&lt;p&gt;thanks steve&lt;/p&gt;</comment>
                            <comment id="14713223" author="shalinmangar" created="Wed, 26 Aug 2015 13:06:07 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12742366" name="SOLR-7712.patch" size="8242" author="hossman" created="Sun, 28 Jun 2015 02:55:59 +0000"/>
                            <attachment id="12742265" name="SOLR-7712.patch" size="7635" author="hossman" created="Fri, 26 Jun 2015 23:52:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gcen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>