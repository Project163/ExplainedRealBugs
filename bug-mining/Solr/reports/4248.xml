<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:39:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13367] Highlighting fails for Range queries on Multi-valued String fields</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13367</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Range queries against multi-valued string fields produces useless highlighting, even though &quot;hl.highlightMultiTerm&quot;:&quot;true&quot;&lt;/p&gt;

&lt;p&gt;I have uncovered what I believe is a bug. At the very lease it is a difference in behavior between Solr v5.1.0 and v7.5.0 (and v7.7.1).&lt;/p&gt;

&lt;p&gt;I have a multi-valued string Field defined in my schema as:&lt;/p&gt;

&lt;p&gt;&amp;lt;fieldType name=&quot;string&quot; class=&quot;solr.StrField&quot; sortMissingLast=&quot;true&quot;/&amp;gt; &lt;br/&gt;
 &amp;lt;field name=&quot;MyStringField&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;true&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;I am using a query containing a Range clause and I am using highlighting to get the list of values that actually matched the range query.&lt;/p&gt;

&lt;p&gt;All examples below were using the appropriate Solr Admin Server SolrCore Query page.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;RedHat Linux v7&lt;/p&gt;

&lt;p&gt;Java 1.8.0_201&lt;/p&gt;</environment>
        <key id="13225871">SOLR-13367</key>
            <summary>Highlighting fails for Range queries on Multi-valued String fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="wolfyman">Karl Wolf</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Apr 2019 17:45:21 +0000</created>
                <updated>Fri, 26 Jul 2019 08:56:14 +0000</updated>
                            <resolved>Tue, 25 Jun 2019 04:15:48 +0000</resolved>
                                    <version>7.5</version>
                    <version>7.7.1</version>
                                    <fixVersion>8.2</fixVersion>
                                    <component>highlighter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16858553" author="janhoy" created="Fri, 7 Jun 2019 11:58:44 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;I wonder if the reason is a bug in the Admin UI query section which sets parameter &quot;hightlightMultiTerm&quot; instead of the correct &quot;highlightMultiTerm&quot;. Can you try your query again manually from browser address bar with correct param? See &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/704&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/704&lt;/a&gt;&#160;for a fix&lt;/p&gt;</comment>
                            <comment id="16858556" author="janhoy" created="Fri, 7 Jun 2019 12:02:31 +0000"  >&lt;p&gt;Moved large section from description to this comment:&lt;/p&gt;

&lt;p&gt;***************************************************************************&lt;br/&gt;
 First, a correctly working example of a range query using Solr v5.1.0 which produces useful results:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;
{
 &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;: {
 &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;: 0,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;: 366,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;: &quot;MyStringField:[A TO B}

&quot;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;indent&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl.preserveMulti&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField,MyUniqueID&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl.requireFieldMatch&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl.usePhraseHighlighter&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl.fl&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;wt&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;json&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl.highlightMultiTerm&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;_&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;1553275722025&quot;&lt;/span&gt;
 }
 },
 &lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt;: {
 &lt;span class=&quot;code-quote&quot;&gt;&quot;numFound&quot;&lt;/span&gt;: 999,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;: 0,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;docs&quot;&lt;/span&gt;: [

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;Stanley, Wendell M.&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Avery, Roy&quot;&lt;/span&gt; ], &lt;span class=&quot;code-quote&quot;&gt;&quot;MyUniqueID&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID1&quot;&lt;/span&gt; }

,

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;Avery, Roy&quot;&lt;/span&gt; ], &lt;span class=&quot;code-quote&quot;&gt;&quot;MyUniqueID&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID2&quot;&lt;/span&gt; }

,
 * 
 ** 
 *** lots more docs correctly found
 ]
 },
 *** we get to the highlighting portion of the response
 *** &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; indicates which values of each MyStringField
 *** that actually matched the query

&lt;span class=&quot;code-quote&quot;&gt;&quot;highlighting&quot;&lt;/span&gt;: {
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID1&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;em&amp;gt;Avery, Roy&amp;lt;/em&amp;gt;&quot;&lt;/span&gt; ] }

,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID2&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;em&amp;gt;Avery, Roy&amp;lt;/em&amp;gt;&quot;&lt;/span&gt; ] }

,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID3&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;em&amp;gt;American Institute of Biological Sciences&amp;lt;/em&amp;gt;&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;em&amp;gt;Albritton, Errett C.&amp;lt;/em&amp;gt;&quot;&lt;/span&gt; ] }

,
 ... etc.
 * 
 ** 
 *** lots more useful highlight values. Note the two matching values
 *** &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; document UniqueID3.
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;***************************************************************************&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;THE PROBLEM&lt;/li&gt;
	&lt;li&gt;Now using newer versions of Solr&lt;br/&gt;
 ***************************************************************************&lt;br/&gt;
 Using the exact same parameters with Solr v7.5.0 or v7.7.1, the top portion of the &lt;br/&gt;
 response is basically the same including the number of documents found&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;
{
 &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{
 &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:245,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;params&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;:&quot;MyStringField:[A TO B}

&quot;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;on&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl.preserveMulti&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;MyUniqueID, MyStringField&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl.requireFieldMatch&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hl.fl&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;hightlightMultiTerm&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;wt&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;json&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;_&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1553105129887&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;usePhraseHighLighter&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;}},
 &lt;span class=&quot;code-quote&quot;&gt;&quot;response&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;numFound&quot;&lt;/span&gt;:999,&lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;docs&quot;&lt;/span&gt;:[
 * 
 ** 
 *** The problem is &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; the lighlighting portion of the results, which is effectively empty.
 *** There is no way to know what values &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; each document that actually matched the query:

&lt;span class=&quot;code-quote&quot;&gt;&quot;highlighting&quot;&lt;/span&gt;:{
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID1&quot;&lt;/span&gt;:{},
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID2&quot;&lt;/span&gt;:{},
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID3&quot;&lt;/span&gt;:{},
 ... etc.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;NOTE: The source data is the same for all of the tested Solr versions and the Solr indexes&lt;/li&gt;
			&lt;li&gt;were properly rebuilt for each Solr version.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;***************************************************************************&lt;br/&gt;
 Changing the request to using the &quot;unified&quot; highlighter: &quot;hl.method=unified&quot;, the highlighting looks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;highlighting&quot;&lt;/span&gt;:{
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID1&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;:[]}

,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID2&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;:[]}

,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID3&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;:[]}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;,&lt;br/&gt;
 ... etc.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;The highlighting now properly lists the matching field but still no useful values are listed.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;***************************************************************************&lt;br/&gt;
 NOTE: if I change the query from using a Range clause to using a Wildcard query: q=&quot;MyStringField:A*&quot;&lt;/p&gt;

&lt;p&gt;the highlighting is correct in both Solr v7.5.0 and v7.7.1: These are GOOD results!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;highlighting&quot;&lt;/span&gt;:{
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID1&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;em&amp;gt;Avery, Roy&amp;lt;/em&amp;gt;&quot;&lt;/span&gt;]}

,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID2&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;em&amp;gt;Avery, Roy&amp;lt;/em&amp;gt;&quot;&lt;/span&gt;]}

,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;UniqueID3&quot;&lt;/span&gt;:

{ &lt;span class=&quot;code-quote&quot;&gt;&quot;MyStringField&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;em&amp;gt;American Institute of Biological Sciences&amp;lt;/em&amp;gt;&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;em&amp;gt;Albritton, Errett C.&amp;lt;/em&amp;gt;&quot;&lt;/span&gt; ] }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;,&lt;br/&gt;
 ... etc.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;This makes me think there is some problem with the way a Range query&lt;/li&gt;
			&lt;li&gt;feeds the search results to the Solr Highlighter code.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;***************************************************************************&lt;br/&gt;
 All attempts to vary the hl specs or any other query parameters do not solve the problem.&lt;br/&gt;
 The wildcard query is my current work around but there still is a problem with&lt;br/&gt;
 range queries:&lt;/p&gt;

&lt;p&gt;In summary, there is some incompatibility among:&lt;/p&gt;

&lt;p&gt;1) A multi-valued string field AND&lt;br/&gt;
 2) A range query against that field AND&lt;br/&gt;
 3) The result Highlighting. It is effectively empty.&lt;/p&gt;

&lt;p&gt;I don&apos;t know when this issue was first introduced. I have recently been updating from 5.1.0&lt;br/&gt;
 to 7.5.0 in one big leap. I have attempted to read through the change logs for the intervening&lt;br/&gt;
 versions but I gave up to save my sanity.&lt;/p&gt;

&lt;p&gt;You should be able to reproduce this issue using any multi-valued, indexed and stored string field.&lt;/p&gt;</comment>
                            <comment id="16858584" author="wolfyman" created="Fri, 7 Jun 2019 12:37:00 +0000"  >&lt;p&gt;The word &quot; hightlightMultiTerm&quot; was due to my fumble fingers when I was typing up the bug report.  The admin UI uses the correct term. &lt;/p&gt;

&lt;p&gt;The bug I reported on is real. I first noticed it in my own application code. As part of debugging the issue I decided to use the Admin UI to replicate my query and keep my own Java code out of the equation. The admin UI demonstrates the same problem so that seems to indicate an underlying problem in Solr.&lt;/p&gt;

&lt;p&gt;Thanks for looking into this.&lt;/p&gt;

&lt;p&gt;-Karl&lt;/p&gt;
</comment>
                            <comment id="16858664" author="dsmiley" created="Fri, 7 Jun 2019 13:53:37 +0000"  >&lt;p&gt;Thanks for reporting this. &#160;The regression was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8037&quot; title=&quot;speed up term range queries, use filter cache for embedded ranges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8037&quot;&gt;&lt;del&gt;SOLR-8037&lt;/del&gt;&lt;/a&gt; (CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;) which introduced an new Query class internally &#8211;SolrRangeQuery one that the highlighters don&apos;t know about. &#160;Thanks to recent improvements in Lucene that the hl.method=unified will use when hl.weightMatches=true, the highlighter (or at least this one) needn&apos;t be updated to know about new queries, at least usually not. &#160;But this does require that each Query that is highlightable properly implement the &quot;Weight Matches&quot; API. &#160;That API did not exist when &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8037&quot; title=&quot;speed up term range queries, use filter cache for embedded ranges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8037&quot;&gt;&lt;del&gt;SOLR-8037&lt;/del&gt;&lt;/a&gt; was done, and when the API was added, some niche queries like this were not updated.&lt;/p&gt;</comment>
                            <comment id="16858719" author="dsmiley" created="Fri, 7 Jun 2019 14:54:15 +0000"  >&lt;p&gt;I think a part of the solution would involve having SolrRangeQuery extend MultiTermQuery if for no other reason but to advertise it&apos;s an MTQ (just like the standard TermRangeQuery does indirectly via AutomatonQuery). &#160;Maybe I&apos;ll look later.&lt;/p&gt;</comment>
                            <comment id="16858794" author="wolfyman" created="Fri, 7 Jun 2019 16:33:00 +0000"  >&lt;p&gt;I checked again and I see that the Admin UI does put the incorrect word &quot;hightlightMultiTerm&quot; in the query URL. So that is a bug in the Admin UI. However, even when I edit the URL and remove the &quot;t&quot;, I still get the same results. So my bug still stands.&lt;/p&gt;

&lt;p&gt;-Karl&lt;/p&gt;
</comment>
                            <comment id="16860187" author="dsmiley" created="Mon, 10 Jun 2019 17:37:10 +0000"  >&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8848&quot; title=&quot;UnifiedHighlighter should highlight all Query types that implement Weight.matches&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8848&quot;&gt;&lt;del&gt;LUCENE-8848&lt;/del&gt;&lt;/a&gt; (not committed yet; I posted this today), I think the only thing remaining is for SolrRangeQuery.ConstWeight to implement matches().  Attached is a patch copying the implementation from MultiTermQueryConstantScoreWrapper.  I needed to use DisjunctionMatchesIterator which was package accessible but seemed appropriate to be public as &quot;lucene.experimental&quot;.  Does this seem fine &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16860302" author="romseygeek" created="Mon, 10 Jun 2019 20:22:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; you should be able to use MatchesUtils.disjunction() rather than making DMI public&lt;/p&gt;</comment>
                            <comment id="16860312" author="dsmiley" created="Mon, 10 Jun 2019 20:37:41 +0000"  >&lt;p&gt;In particular the DisjunctionMatchesIterator.fromTermsEnum static method is not exposed via MatchesUtils.&lt;/p&gt;</comment>
                            <comment id="16860656" author="romseygeek" created="Tue, 11 Jun 2019 08:19:10 +0000"  >&lt;p&gt;Let&apos;s move fromTermsEnum() into MatchesUtils.  +1 otherwise&lt;/p&gt;</comment>
                            <comment id="16869898" author="dsmiley" created="Fri, 21 Jun 2019 21:29:51 +0000"  >&lt;p&gt;In the latest patch I did that but called the method simply &quot;disjunction&quot; since there is in fact another disjunction method and this is another disjunction.&#160; So parameters differentiate them and imply what the disjunction is over/from.&lt;/p&gt;</comment>
                            <comment id="16869901" author="dsmiley" created="Fri, 21 Jun 2019 21:33:47 +0000"  >&lt;p&gt;Updated ref guide to point out the UnifiedHighlighter&apos;s advantage here.&lt;/p&gt;</comment>
                            <comment id="16870906" author="romseygeek" created="Mon, 24 Jun 2019 08:06:46 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16871978" author="jira-bot" created="Tue, 25 Jun 2019 04:10:24 +0000"  >&lt;p&gt;Commit 85ec39d931c742b68cc1873da2fe17800eefda23 in lucene-solr&apos;s branch refs/heads/master from David Wayne Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=85ec39d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=85ec39d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13367&quot; title=&quot;Highlighting fails for Range queries on Multi-valued String fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13367&quot;&gt;&lt;del&gt;SOLR-13367&lt;/del&gt;&lt;/a&gt;: Range queries will now highlight in hl.method=unified mode.&lt;br/&gt;
Lucene MatchesUtils.disjunction method for disjunction over&lt;br/&gt;
 BytesRefIterator terms.&lt;/p&gt;</comment>
                            <comment id="16871979" author="jira-bot" created="Tue, 25 Jun 2019 04:11:25 +0000"  >&lt;p&gt;Commit 5259e964b5665d726ccd1391925057a1cab39ef2 in lucene-solr&apos;s branch refs/heads/branch_8x from David Wayne Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5259e96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5259e96&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13367&quot; title=&quot;Highlighting fails for Range queries on Multi-valued String fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13367&quot;&gt;&lt;del&gt;SOLR-13367&lt;/del&gt;&lt;/a&gt;: Range queries will now highlight in hl.method=unified mode.&lt;br/&gt;
Lucene MatchesUtils.disjunction method for disjunction over&lt;br/&gt;
 BytesRefIterator terms.&lt;/p&gt;</comment>
                            <comment id="16871980" author="dsmiley" created="Tue, 25 Jun 2019 04:15:48 +0000"  >&lt;p&gt;I know this is debatable but I categorized this in CHANGES.txt under new features instead of as a bug, because I think of highlighting&apos;s support for certain queries as this way.  &quot;Improvement&quot; would have been my first choice but I didn&apos;t see a category for it on this release; I may raise an issue about that.&lt;/p&gt;</comment>
                            <comment id="16893552" author="ivera" created="Fri, 26 Jul 2019 08:56:14 +0000"  >&lt;p&gt;Closing after the 8.2.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="12863271">SOLR-8037</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="13238559">LUCENE-8848</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12972481" name="SOLR-13367.patch" size="6788" author="dsmiley" created="Fri, 21 Jun 2019 21:32:23 +0000"/>
                            <attachment id="12972480" name="SOLR-13367.patch" size="4083" author="dsmiley" created="Fri, 21 Jun 2019 21:28:37 +0000"/>
                            <attachment id="12971356" name="SOLR-13367.patch" size="4486" author="dsmiley" created="Mon, 10 Jun 2019 17:34:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01f94:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>