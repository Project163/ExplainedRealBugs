<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7172] addreplica API fails with incorrect error msg &quot;cannot create collection&quot;</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7172</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create 1 node solr cloud cluster&lt;/li&gt;
	&lt;li&gt;Create collection &apos;test&apos; with numShards=1&amp;amp;replicationFactor=1&amp;amp;maxShardsPerNode=1&lt;/li&gt;
	&lt;li&gt;Call addreplica API:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/admin/collections?action=addreplica&amp;amp;collection=test&amp;amp;shard=shard1&amp;amp;wt=json &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;API fails with the following response:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
responseHeader: {
status: 400,
QTime: 9
},
Operation ADDREPLICA caused exception:: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.common.SolrException:org.apache.solr.common.SolrException: Cannot create collection test. No live Solr-instances&quot;&lt;/span&gt;,
exception: {
msg: &lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot create collection test. No live Solr-instances&quot;&lt;/span&gt;,
rspCode: 400
},
error: {
msg: &lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot create collection test. No live Solr-instances&quot;&lt;/span&gt;,
code: 400
}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12778123">SOLR-7172</key>
            <summary>addreplica API fails with incorrect error msg &quot;cannot create collection&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Feb 2015 04:37:21 +0000</created>
                <updated>Wed, 2 Oct 2019 17:23:52 +0000</updated>
                            <resolved>Sat, 11 Jul 2015 05:11:57 +0000</resolved>
                                    <version>4.10.3</version>
                    <version>5.0</version>
                                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14363788" author="hossman" created="Mon, 16 Mar 2015 19:55:08 +0000"  >&lt;p&gt;i&apos;m confused by the problem statement here.&lt;/p&gt;

&lt;p&gt;is the problem that there is a bug in addreplica which needs fixed?, or is the problem that when addreplica fails, it fails with a confusion/misleading error message about creating a collection?&lt;/p&gt;</comment>
                            <comment id="14363799" author="shalinmangar" created="Mon, 16 Mar 2015 20:02:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;is the problem that there is a bug in addreplica which needs fixed?, or is the problem that when addreplica fails, it fails with a confusion/misleading error message about creating a collection?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s the latter. The error message is wrong/confusing.&lt;/p&gt;</comment>
                            <comment id="14619473" author="erickerickson" created="Wed, 8 Jul 2015 22:12:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; I happen to be in this code for another JIRA, if I find this should I just fix it or are you already working on it?&lt;/p&gt;</comment>
                            <comment id="14619830" author="shalinmangar" created="Thu, 9 Jul 2015 03:38:29 +0000"  >&lt;p&gt;Please go ahead!&lt;/p&gt;</comment>
                            <comment id="14619924" author="erickerickson" created="Thu, 9 Jul 2015 05:23:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; Pinging you two since you&apos;ve been into Assign more recently than I have and this looks bogus. But then again it&apos;s late and I suspect I&apos;m missing something obvious. So before I dive into this am I off base?&lt;/p&gt;

&lt;p&gt;Anyway, Assign.getNodesForNewShard doesn&apos;t make sense to me. First of all, it&apos;s only called from CREATESHARD and ADDREPLICA. It looks like copy/paste from CREATE though, and some assumptions just don&apos;t seem to work. The error message about &quot;cannot create collection&quot; is totally bogus since this is never called from CREATE. (thus this JIRA, which is much more serious I think than a wonky error message).&lt;/p&gt;

&lt;p&gt;Anyway, part of the problem is in the calculations around line 208:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxCoresAllowedToCreate = maxShardsPerNode * nodeList.size();
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; requestedCoresToCreate = numSlices * repFactor;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; minCoresToCreate = requestedCoresToCreate;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (maxCoresAllowedToCreate &amp;lt; minCoresToCreate) { &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, complex error}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In these two operations, this doesn&apos;t take into account the replicas for the collection already on the nodes in nodeList. It seems to me that nodeList is the wrong thing to be looking at as well, we&apos;ve already collected a list of nodes we could put additional replicas on, and the counts of replicas belonging to the collection in question already on those nodes in nodeNameVsShardCount, shouldn&apos;t we be using those? And shouldn&apos;t the error be thrown if the number of available slots &amp;lt; numberOfNodes? The number of available slots isn&apos;t calculated correctly I don&apos;t think.&lt;/p&gt;

&lt;p&gt;How this interacts with rules is a mystery to me though, don&apos;t want to wade around in this without a check. The attached patch is full of nocommits but shows what I had in mind. But it&apos;s late so don&apos;t look too closely, if you two think this is on track I&apos;ll make it a &lt;em&gt;real&lt;/em&gt; patch.&lt;/p&gt;</comment>
                            <comment id="14620340" author="noble.paul" created="Thu, 9 Jul 2015 11:23:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;It seems to me that nodeList is the wrong thing to be looking at as well, we&apos;ve already collected a list of nodes we could put additional replicas on&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. your observation is correct. &lt;tt&gt;nodeNameVsShardCount&lt;/tt&gt; has the appropriate nodes and it should be used to arrive at  &lt;tt&gt;maxCoresAllowedToCreate&lt;/tt&gt;  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How this interacts with rules is a mystery to me though&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Rules actually ignores the &lt;tt&gt;maxShardsPerNode&lt;/tt&gt; param. It totally relies on the rules to identify the nodes&lt;/p&gt;

&lt;p&gt;While you are working on this please rename the class &lt;tt&gt;Node&lt;/tt&gt; to something like &lt;tt&gt;ReplicaCount&lt;/tt&gt; or whatever is suitable &lt;/p&gt;</comment>
                            <comment id="14622876" author="erickerickson" created="Fri, 10 Jul 2015 20:53:46 +0000"  >&lt;p&gt;I think this patch is ready. It does several things:&lt;/p&gt;

&lt;p&gt;1&amp;gt; returns more appropriate error messages&lt;br/&gt;
2&amp;gt; calculates whether we should be able to create a replica when adding a shard or replica correctly&lt;br/&gt;
3&amp;gt; adds a bunch of tests.&lt;br/&gt;
4&amp;gt; uses the same logic for allowing replicas to be added when node/nodeset is specified on ADDREPLICA and CREATESHARD&lt;/p&gt;

&lt;p&gt;I haven&apos;t run this through precommit or the full test suite yet, putting this version up for people to look at if you want.&lt;/p&gt;</comment>
                            <comment id="14623093" author="erickerickson" created="Sat, 11 Jul 2015 00:02:16 +0000"  >&lt;p&gt;I&apos;ll have a new patch up today/tomorrow. Fixes up a precommit problem (String.format) and closes a test resource, no real functional changes.&lt;/p&gt;</comment>
                            <comment id="14623221" author="erickerickson" created="Sat, 11 Jul 2015 04:17:01 +0000"  >&lt;p&gt;Final patch, all tests pass, precommit etc.&lt;/p&gt;</comment>
                            <comment id="14623222" author="jira-bot" created="Sat, 11 Jul 2015 04:17:51 +0000"  >&lt;p&gt;Commit 1690341 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1690341&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1690341&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7172&quot; title=&quot;addreplica API fails with incorrect error msg &amp;quot;cannot create collection&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7172&quot;&gt;&lt;del&gt;SOLR-7172&lt;/del&gt;&lt;/a&gt;: addreplica API fails with incorrect error msg &apos;cannot create collection&apos;&lt;/p&gt;</comment>
                            <comment id="14623241" author="jira-bot" created="Sat, 11 Jul 2015 05:11:33 +0000"  >&lt;p&gt;Commit 1690348 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1690348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1690348&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7172&quot; title=&quot;addreplica API fails with incorrect error msg &amp;quot;cannot create collection&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7172&quot;&gt;&lt;del&gt;SOLR-7172&lt;/del&gt;&lt;/a&gt;: addreplica API fails with incorrect error msg &apos;cannot create collection&apos;&lt;/p&gt;</comment>
                            <comment id="14713161" author="shalinmangar" created="Wed, 26 Aug 2015 13:05:57 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12744868" name="SOLR-7172.patch" size="29289" author="erickerickson" created="Sat, 11 Jul 2015 04:17:01 +0000"/>
                            <attachment id="12744804" name="SOLR-7172.patch" size="28725" author="erickerickson" created="Fri, 10 Jul 2015 20:53:46 +0000"/>
                            <attachment id="12744411" name="SOLR-7172.patch" size="10172" author="erickerickson" created="Thu, 9 Jul 2015 05:23:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i264tr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>