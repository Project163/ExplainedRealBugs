<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:12:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17819] HttpShardHandler non-tolerant request cancellation bleeds across requests</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17819</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;However, after fixing that and beasting the tests, there is a really weird error around cancelling requests. The &#160;does a non-tolerant search then does a tolerant search. The error I described above was breaking the non-tolerant search. That is easily fixable. The second part of the test, testing tolerant search fails very occasionally (but only when the non-tolerant search is done first, when that is commented out, the tolerant search does not fail).&lt;/p&gt;

&lt;p&gt;When beasting &lt;tt&gt;DistributedDebugComponentTest.testTolerantSearch&lt;/tt&gt; , and adding a loop to do the requests 1,000 times, the tolerant search fails because all three shard requests fail instead of just 1 of the shard requests failing (because of a non-exisistant endpoint). the bad shard has the failure that the test expects, but the good shards both fail with &lt;tt&gt;java.io.IOException: cancel_stream_error/unexpected_data_frame&lt;/tt&gt; meaning that the requests were cancelled, even thought the request is &quot;tolerant&quot;. I did a lot of debugging here, and noticed that Solr is behaving correctly and we are not cancelling shard requests for tolerant solr requests. And the fact that if the &quot;non-tolerant search&quot; request case right before the tolerant search request is commented out, the failures stop, tell us that the cancellations from the non-tolerant request are bleeding into the tolerant request. This is bad. I also confirmed this by commenting out the line that actually cancels the HTTP requests (when commented out, the test succeeds): &lt;a href=&quot;https://github.com/apache/solr/blob/branch_9_9/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Http2SolrClient.java#L570-L574&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/branch_9_9/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Http2SolrClient.java#L570-L574&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This only happens on branch_9x (and presumable branch_9_9), not on main. So I believe it&apos;s a bug in Jetty 10, which Jetty 12 has solved. So we are probably fine just fixing this part on branch_9x and branch_9_9, and leaving the request cancellation enabled on main (10.x).&lt;/p&gt;

&lt;p&gt;Amazingly, when beasting, there is a big difference in whether the non-existent endpoint is put first or last in the list of shards. The failure rate is much higher when the bad shard is the first listed rather the last one listed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13623498">SOLR-17819</key>
            <summary>HttpShardHandler non-tolerant request cancellation bleeds across requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houston">Houston Putman</assignee>
                                    <reporter username="houston">Houston Putman</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 15 Jul 2025 17:53:03 +0000</created>
                <updated>Thu, 24 Jul 2025 22:50:53 +0000</updated>
                            <resolved>Fri, 18 Jul 2025 21:18:35 +0000</resolved>
                                                    <fixVersion>9.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="18008152" author="jira-bot" created="Fri, 18 Jul 2025 20:31:43 +0000"  >&lt;p&gt;Commit f4ba87ea67237887b161062e26f18c572ab41ca5 in solr&apos;s branch refs/heads/branch_9x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=f4ba87ea672&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=f4ba87ea672&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17819&quot; title=&quot;HttpShardHandler non-tolerant request cancellation bleeds across requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17819&quot;&gt;&lt;del&gt;SOLR-17819&lt;/del&gt;&lt;/a&gt;: Disable http2 request cancellation for Jetty 10 (#3428)&lt;/p&gt;
</comment>
                            <comment id="18008153" author="jira-bot" created="Fri, 18 Jul 2025 20:34:21 +0000"  >&lt;p&gt;Commit 386ed096a1946c488cfe576a19a147bdb1153508 in solr&apos;s branch refs/heads/branch_9_9 from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=386ed096a19&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=386ed096a19&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17819&quot; title=&quot;HttpShardHandler non-tolerant request cancellation bleeds across requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17819&quot;&gt;&lt;del&gt;SOLR-17819&lt;/del&gt;&lt;/a&gt;: Disable http2 request cancellation for Jetty 10 (#3428)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f4ba87ea67237887b161062e26f18c572ab41ca5)&lt;/p&gt;</comment>
                            <comment id="18008159" author="jira-bot" created="Fri, 18 Jul 2025 20:52:09 +0000"  >&lt;p&gt;Commit 17f318e2d7b97d11c9017fa966ef81021ec620dd in solr&apos;s branch refs/heads/main from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=17f318e2d7b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=17f318e2d7b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17819&quot; title=&quot;HttpShardHandler non-tolerant request cancellation bleeds across requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17819&quot;&gt;&lt;del&gt;SOLR-17819&lt;/del&gt;&lt;/a&gt;: Improve DistributedDebugComponentTest.testTolerantSearch&lt;/p&gt;</comment>
                            <comment id="18009740" author="houston" created="Thu, 24 Jul 2025 22:50:53 +0000"  >&lt;p&gt;Closing after the 9.9.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wrw0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>