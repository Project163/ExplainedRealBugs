<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:33:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4203] An ephemeral directory implementation should cause the transaction log to be ignored on startup.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4203</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If you are using something like ram dir, you can restart a node and if no updates have come in, it will think its up to date but be empty - we should clear the update log in these cases on startup.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12624147">SOLR-4203</key>
            <summary>An ephemeral directory implementation should cause the transaction log to be ignored on startup.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Sat, 15 Dec 2012 21:55:34 +0000</created>
                <updated>Mon, 9 May 2016 18:44:57 +0000</updated>
                            <resolved>Wed, 26 Dec 2012 17:32:38 +0000</resolved>
                                                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13533186" author="markrmiller@gmail.com" created="Sat, 15 Dec 2012 22:35:42 +0000"  >&lt;p&gt;Simple patch. Not sure the best way to clear the update log yet, but here is one.&lt;/p&gt;</comment>
                            <comment id="13533190" author="markrmiller@gmail.com" created="Sat, 15 Dec 2012 22:43:13 +0000"  >&lt;p&gt;I&apos;m going to commit so I can get tests cranking on this - I&apos;ll leave it open for yonik to review - I think the tranlog clear could be cleaned up a little. I stole the current code for it from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4174&quot; title=&quot;Optionally allow dropping the update log when merging indexes.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4174&quot;&gt;&lt;del&gt;SOLR-4174&lt;/del&gt;&lt;/a&gt; where I&apos;m optionally dropping the update log on index merge.&lt;/p&gt;</comment>
                            <comment id="13533199" author="commit-tag-bot" created="Sat, 15 Dec 2012 23:12:40 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422400&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: An ephemeral directory implementation should cause the transaction log to be ignored on startup.&lt;/p&gt;
</comment>
                            <comment id="13533200" author="commit-tag-bot" created="Sat, 15 Dec 2012 23:12:51 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422399&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: An ephemeral directory implementation should cause the transaction log to be ignored on startup.&lt;/p&gt;
</comment>
                            <comment id="13533279" author="commit-tag-bot" created="Sun, 16 Dec 2012 06:16:34 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: don&apos;t clear the tlog when using ephemeral directory on core reload&lt;/p&gt;</comment>
                            <comment id="13533281" author="commit-tag-bot" created="Sun, 16 Dec 2012 06:24:12 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422469&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: don&apos;t clear the tlog when using ephemeral directory on core reload&lt;/p&gt;</comment>
                            <comment id="13533437" author="commit-tag-bot" created="Sun, 16 Dec 2012 17:12:21 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422609&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: tweak how delete is handled so this test passes on windows&lt;/p&gt;</comment>
                            <comment id="13533438" author="commit-tag-bot" created="Sun, 16 Dec 2012 17:12:25 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422608&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: tweak how delete is handled so this test passes on windows&lt;/p&gt;</comment>
                            <comment id="13533452" author="markrmiller@gmail.com" created="Sun, 16 Dec 2012 18:01:43 +0000"  >&lt;p&gt;So this will pass on Windows now, but I think something is still off. When I close an UpdateLog I can&apos;t seem to delete all it&apos;s files on Windows - so it appears perhaps something is not getting closed...that&apos;s my guess anyway, I still have to investigate.&lt;/p&gt;</comment>
                            <comment id="13533472" author="yseeley@gmail.com" created="Sun, 16 Dec 2012 18:56:04 +0000"  >&lt;p&gt;Trying to wrap my head around non-persistent Directories...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     initLog();
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!core.getDirectoryFactory().isPersistent()) {
+      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+        clearLog();
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
+        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(e);
+      }
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Doing it this way seems tricky... The UpdateLog wasn&apos;t originally really written with rebooting in mind, and I don&apos;t know what traps might be there (and this may be the cause of tlog files that can&apos;t be removed under windows now).&lt;br/&gt;
Seems more straightforward to delete the directory before initializing the log.&lt;br/&gt;
Only tricky part there is finding out where the directory is.&lt;/p&gt;

&lt;p&gt;Perhaps this clearing logic should just be done directly in the UpdateLog.init()&lt;/p&gt;
</comment>
                            <comment id="13533474" author="markrmiller@gmail.com" created="Sun, 16 Dec 2012 18:59:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Seems more straightforward to delete the directory before initializing the log. Only tricky part there is finding out where the directory is.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, that is actually what I was going to do first. But the getting the tlog dir was no so straightforward and that is why I went this way.&lt;/p&gt;

&lt;p&gt;This only happens on startup though, so I&apos;m not sure why it would be a problem? It will be single threaded and before anything is being accessed.&lt;/p&gt;

&lt;p&gt;It does still seem strange to me that I cannot close the update log and delete it&apos;s data dir. That fails and we are not even to opening a new one yet.&lt;/p&gt;</comment>
                            <comment id="13533487" author="yseeley@gmail.com" created="Sun, 16 Dec 2012 19:23:58 +0000"  >&lt;p&gt;TestRecovery.testCorruptLog does a deleteLogs at the end, which should fail on Windows if we had a descriptor leak through the normal path of operations.&lt;/p&gt;</comment>
                            <comment id="13533511" author="yseeley@gmail.com" created="Sun, 16 Dec 2012 20:53:40 +0000"  >&lt;p&gt;Seems like another issue is that it could introduce a race...&lt;br/&gt;
starting the update log could start recovery, which may or may not finish before the update log is closed.&lt;/p&gt;

&lt;p&gt;edit: actually init() doesn&apos;t kick off recovery.&lt;br/&gt;
But the fact remains, UpdateLog was not meant to be closed and re-inited (there is other state that probably doesn&apos;t get cleared, etc).&lt;/p&gt;</comment>
                            <comment id="13533613" author="commit-tag-bot" created="Mon, 17 Dec 2012 03:18:46 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422746&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422746&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: empty the tlog dir without instantiating an updatelog&lt;/p&gt;</comment>
                            <comment id="13533614" author="commit-tag-bot" created="Mon, 17 Dec 2012 03:26:46 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422747&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1422747&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: empty the tlog dir without instantiating an updatelog&lt;/p&gt;</comment>
                            <comment id="13535248" author="commit-tag-bot" created="Tue, 18 Dec 2012 20:02:43 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1423608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1423608&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: dont check if ulog is set to delete tlogs files on startup - check if the tlog dir exists&lt;/p&gt;</comment>
                            <comment id="13535258" author="commit-tag-bot" created="Tue, 18 Dec 2012 20:10:13 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1423611&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1423611&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: dont check if ulog is set to delete tlogs files on startup - check if the tlog dir exists&lt;/p&gt;</comment>
                            <comment id="13535275" author="commit-tag-bot" created="Tue, 18 Dec 2012 20:32:16 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1423625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1423625&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: whoops - fix npe&lt;/p&gt;</comment>
                            <comment id="13535286" author="commit-tag-bot" created="Tue, 18 Dec 2012 20:38:38 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Mark Robert Miller&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1423627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1423627&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4203&quot; title=&quot;An ephemeral directory implementation should cause the transaction log to be ignored on startup.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4203&quot;&gt;&lt;del&gt;SOLR-4203&lt;/del&gt;&lt;/a&gt;: whoops - fix npe&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12561151" name="SOLR-4203.patch" size="3624" author="markrmiller@gmail.com" created="Sat, 15 Dec 2012 22:35:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>298520</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i15t53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242021</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>